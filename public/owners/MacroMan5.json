{
  "owner": {
    "id": "MacroMan5",
    "display_name": "macroMan",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/119378668?v=4",
    "url": "https://github.com/MacroMan5",
    "bio": "Dev, IA enjoyer",
    "stats": {
      "total_repos": 1,
      "total_plugins": 1,
      "total_commands": 0,
      "total_skills": 6,
      "total_stars": 1,
      "total_forks": 1
    }
  },
  "repos": [
    {
      "full_name": "MacroMan5/AutomationHelper_plugins",
      "url": "https://github.com/MacroMan5/AutomationHelper_plugins",
      "description": "Skills based claude code plugins for generating automation on multiple platform. ",
      "homepage": "",
      "signals": {
        "stars": 1,
        "forks": 1,
        "pushed_at": "2025-11-03T14:23:07Z",
        "created_at": "2025-10-31T22:07:12Z",
        "license": "MIT"
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 1606
        },
        {
          "path": ".claude-plugin/plugin.json",
          "type": "blob",
          "size": 1065
        },
        {
          "path": ".claude",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/agents/README.md",
          "type": "blob",
          "size": 3133
        },
        {
          "path": ".claude/agents/docs-researcher.md",
          "type": "blob",
          "size": 13422
        },
        {
          "path": ".claude/agents/flow-builder.md",
          "type": "blob",
          "size": 16601
        },
        {
          "path": ".claude/agents/flow-debugger.md",
          "type": "blob",
          "size": 8604
        },
        {
          "path": ".claude/agents/flow-documenter.md",
          "type": "blob",
          "size": 7616
        },
        {
          "path": ".claude/hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/hooks/README.md",
          "type": "blob",
          "size": 6547
        },
        {
          "path": ".claude/hooks/validate_json.py",
          "type": "blob",
          "size": 10410
        },
        {
          "path": ".claude/output-style",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/output-style/FILES-CREATED.md",
          "type": "blob",
          "size": 9638
        },
        {
          "path": ".claude/output-style/INDEX.md",
          "type": "blob",
          "size": 9713
        },
        {
          "path": ".claude/output-style/README.md",
          "type": "blob",
          "size": 2666
        },
        {
          "path": ".claude/output-style/SUMMARY.md",
          "type": "blob",
          "size": 12691
        },
        {
          "path": ".claude/output-style/debug-report.md",
          "type": "blob",
          "size": 5214
        },
        {
          "path": ".claude/output-style/example-usage.md",
          "type": "blob",
          "size": 9222
        },
        {
          "path": ".claude/output-style/research-findings.md",
          "type": "blob",
          "size": 7866
        },
        {
          "path": ".claude/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/README.md",
          "type": "blob",
          "size": 10287
        },
        {
          "path": ".claude/skills/automation-brainstorm",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/automation-brainstorm/SKILL.md",
          "type": "blob",
          "size": 18016
        },
        {
          "path": ".claude/skills/automation-build-flow",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/automation-build-flow/SKILL.md",
          "type": "blob",
          "size": 18575
        },
        {
          "path": ".claude/skills/automation-debugger",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/automation-debugger/ERROR-PATTERNS.md",
          "type": "blob",
          "size": 13386
        },
        {
          "path": ".claude/skills/automation-debugger/EXAMPLE.md",
          "type": "blob",
          "size": 17151
        },
        {
          "path": ".claude/skills/automation-debugger/SKILL.md",
          "type": "blob",
          "size": 25861
        },
        {
          "path": ".claude/skills/automation-quick-fix",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/automation-quick-fix/SKILL.md",
          "type": "blob",
          "size": 19474
        },
        {
          "path": ".claude/skills/automation-refactor",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/automation-refactor/EXAMPLE.md",
          "type": "blob",
          "size": 26789
        },
        {
          "path": ".claude/skills/automation-refactor/SKILL.md",
          "type": "blob",
          "size": 36032
        },
        {
          "path": ".claude/skills/automation-validator",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/automation-validator/SKILL.md",
          "type": "blob",
          "size": 17393
        },
        {
          "path": ".github",
          "type": "tree",
          "size": null
        },
        {
          "path": ".github/workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": ".github/workflows/release.yml",
          "type": "blob",
          "size": 3085
        },
        {
          "path": ".github/workflows/validate.yml",
          "type": "blob",
          "size": 3435
        },
        {
          "path": ".gitignore",
          "type": "blob",
          "size": 1525
        },
        {
          "path": "BEST_PRACTICES.md",
          "type": "blob",
          "size": 10150
        },
        {
          "path": "CHANGELOG.md",
          "type": "blob",
          "size": 3559
        },
        {
          "path": "CLAUDE.md",
          "type": "blob",
          "size": 24503
        },
        {
          "path": "CONTRIBUTING.md",
          "type": "blob",
          "size": 13861
        },
        {
          "path": "Docs",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/N8NDocs",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/N8NDocs/AI",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/N8NDocs/AI/openai.md",
          "type": "blob",
          "size": 22785
        },
        {
          "path": "Docs/N8NDocs/AI/overview.md",
          "type": "blob",
          "size": 11964
        },
        {
          "path": "Docs/N8NDocs/Apps",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/N8NDocs/Apps/gmail.md",
          "type": "blob",
          "size": 23327
        },
        {
          "path": "Docs/N8NDocs/Apps/google-drive.md",
          "type": "blob",
          "size": 23814
        },
        {
          "path": "Docs/N8NDocs/Apps/google-sheets.md",
          "type": "blob",
          "size": 25373
        },
        {
          "path": "Docs/N8NDocs/Core",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/N8NDocs/Core/code.md",
          "type": "blob",
          "size": 20938
        },
        {
          "path": "Docs/N8NDocs/Core/http-request.md",
          "type": "blob",
          "size": 24694
        },
        {
          "path": "Docs/N8NDocs/Core/if.md",
          "type": "blob",
          "size": 29671
        },
        {
          "path": "Docs/N8NDocs/Core/overview.md",
          "type": "blob",
          "size": 8983
        },
        {
          "path": "Docs/N8NDocs/Core/schedule.md",
          "type": "blob",
          "size": 20323
        },
        {
          "path": "Docs/N8NDocs/Core/set.md",
          "type": "blob",
          "size": 17208
        },
        {
          "path": "Docs/N8NDocs/Core/webhook.md",
          "type": "blob",
          "size": 23759
        },
        {
          "path": "Docs/N8NDocs/DOCUMENTATION_STATUS.md",
          "type": "blob",
          "size": 20109
        },
        {
          "path": "Docs/N8NDocs/Database",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/N8NDocs/Database/pinecone.md",
          "type": "blob",
          "size": 37178
        },
        {
          "path": "Docs/N8NDocs/Database/postgresql.md",
          "type": "blob",
          "size": 33387
        },
        {
          "path": "Docs/N8NDocs/Database/redis.md",
          "type": "blob",
          "size": 33270
        },
        {
          "path": "Docs/N8NDocs/README.md",
          "type": "blob",
          "size": 7300
        },
        {
          "path": "Docs/N8NDocs/Templates",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/N8NDocs/Templates/template-node-operations.md",
          "type": "blob",
          "size": 13019
        },
        {
          "path": "Docs/N8NDocs/Templates/template-node-overview.md",
          "type": "blob",
          "size": 12589
        },
        {
          "path": "Docs/PowerAutomateDocs",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/Approvals",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/Approvals/overview.md",
          "type": "blob",
          "size": 7466
        },
        {
          "path": "Docs/PowerAutomateDocs/BuiltIn",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/BuiltIn/control.md",
          "type": "blob",
          "size": 4882
        },
        {
          "path": "Docs/PowerAutomateDocs/BuiltIn/data-operation.md",
          "type": "blob",
          "size": 6853
        },
        {
          "path": "Docs/PowerAutomateDocs/BuiltIn/http.md",
          "type": "blob",
          "size": 7769
        },
        {
          "path": "Docs/PowerAutomateDocs/BuiltIn/overview.md",
          "type": "blob",
          "size": 1634
        },
        {
          "path": "Docs/PowerAutomateDocs/BuiltIn/schedule.md",
          "type": "blob",
          "size": 6718
        },
        {
          "path": "Docs/PowerAutomateDocs/BuiltIn/variable.md",
          "type": "blob",
          "size": 9818
        },
        {
          "path": "Docs/PowerAutomateDocs/DOCUMENTATION_STATUS.md",
          "type": "blob",
          "size": 17123
        },
        {
          "path": "Docs/PowerAutomateDocs/Dataverse",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/Dataverse/overview.md",
          "type": "blob",
          "size": 8125
        },
        {
          "path": "Docs/PowerAutomateDocs/Excel",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/Excel/actions.md",
          "type": "blob",
          "size": 47823
        },
        {
          "path": "Docs/PowerAutomateDocs/Excel/overview.md",
          "type": "blob",
          "size": 23900
        },
        {
          "path": "Docs/PowerAutomateDocs/Excel/triggers.md",
          "type": "blob",
          "size": 14931
        },
        {
          "path": "Docs/PowerAutomateDocs/Forms",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/Forms/actions.md",
          "type": "blob",
          "size": 27561
        },
        {
          "path": "Docs/PowerAutomateDocs/Forms/overview.md",
          "type": "blob",
          "size": 21512
        },
        {
          "path": "Docs/PowerAutomateDocs/Forms/triggers.md",
          "type": "blob",
          "size": 25664
        },
        {
          "path": "Docs/PowerAutomateDocs/M365Users",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/M365Users/overview.md",
          "type": "blob",
          "size": 6883
        },
        {
          "path": "Docs/PowerAutomateDocs/OneDrive",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/OneDrive/actions.md",
          "type": "blob",
          "size": 37726
        },
        {
          "path": "Docs/PowerAutomateDocs/OneDrive/overview.md",
          "type": "blob",
          "size": 26744
        },
        {
          "path": "Docs/PowerAutomateDocs/OneDrive/triggers.md",
          "type": "blob",
          "size": 21979
        },
        {
          "path": "Docs/PowerAutomateDocs/Outlook",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/Outlook/actions.md",
          "type": "blob",
          "size": 30174
        },
        {
          "path": "Docs/PowerAutomateDocs/Outlook/overview.md",
          "type": "blob",
          "size": 13339
        },
        {
          "path": "Docs/PowerAutomateDocs/Outlook/triggers.md",
          "type": "blob",
          "size": 16787
        },
        {
          "path": "Docs/PowerAutomateDocs/Planner",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/Planner/overview.md",
          "type": "blob",
          "size": 6120
        },
        {
          "path": "Docs/PowerAutomateDocs/PowerApps",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/PowerApps/overview.md",
          "type": "blob",
          "size": 3675
        },
        {
          "path": "Docs/PowerAutomateDocs/README.md",
          "type": "blob",
          "size": 1395
        },
        {
          "path": "Docs/PowerAutomateDocs/SQLServer",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/SQLServer/overview.md",
          "type": "blob",
          "size": 12064
        },
        {
          "path": "Docs/PowerAutomateDocs/SharePoint",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/SharePoint/actions.md",
          "type": "blob",
          "size": 49078
        },
        {
          "path": "Docs/PowerAutomateDocs/SharePoint/overview.md",
          "type": "blob",
          "size": 22380
        },
        {
          "path": "Docs/PowerAutomateDocs/SharePoint/triggers.md",
          "type": "blob",
          "size": 3015
        },
        {
          "path": "Docs/PowerAutomateDocs/Teams",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/PowerAutomateDocs/Teams/actions.md",
          "type": "blob",
          "size": 35731
        },
        {
          "path": "Docs/PowerAutomateDocs/Teams/overview.md",
          "type": "blob",
          "size": 15291
        },
        {
          "path": "Docs/PowerAutomateDocs/Teams/triggers.md",
          "type": "blob",
          "size": 21663
        },
        {
          "path": "Docs/PowerAutomateDocs/power-automate-json-format.md",
          "type": "blob",
          "size": 10404
        },
        {
          "path": "Docs/Template",
          "type": "tree",
          "size": null
        },
        {
          "path": "Docs/Template/README.md",
          "type": "blob",
          "size": 4778
        },
        {
          "path": "Docs/Template/agent-optimized-format.md",
          "type": "blob",
          "size": 9879
        },
        {
          "path": "Docs/Template/migration-guide.md",
          "type": "blob",
          "size": 12730
        },
        {
          "path": "Docs/Template/template-actions-v2.md",
          "type": "blob",
          "size": 8885
        },
        {
          "path": "Docs/Template/template-overview-v2.md",
          "type": "blob",
          "size": 9514
        },
        {
          "path": "Docs/Template/template-triggers-v2.md",
          "type": "blob",
          "size": 15658
        },
        {
          "path": "INSTALLATION.md",
          "type": "blob",
          "size": 9872
        },
        {
          "path": "LICENSE",
          "type": "blob",
          "size": 1065
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 8810
        }
      ],
      "marketplace": {
        "name": "automation-helper-marketplace",
        "version": null,
        "description": null,
        "owner_info": {
          "name": "MacroMan5",
          "email": "[email protected]",
          "url": "https://github.com/MacroMan5"
        },
        "keywords": [],
        "plugins": [
          {
            "name": "automation-helper",
            "description": "AI assistant for Power Automate and n8n workflows. 6 skills in active development. Documentation-driven (no hallucinations). Power Automate: 4 connectors complete. n8n: Core nodes complete. Make/Zapier: Not yet supported. Contributions, issues, and forks welcome!",
            "source": "./",
            "category": "automation",
            "version": "0.1.0-alpha",
            "author": {
              "name": "MacroMan5",
              "email": "[email protected]"
            },
            "install_commands": [
              "/plugin marketplace add MacroMan5/AutomationHelper_plugins",
              "/plugin install automation-helper@automation-helper-marketplace"
            ],
            "signals": {
              "stars": 1,
              "forks": 1,
              "pushed_at": "2025-11-03T14:23:07Z",
              "created_at": "2025-10-31T22:07:12Z",
              "license": "MIT"
            },
            "commands": [],
            "skills": [
              {
                "name": "automation-brainstorm",
                "description": "Interactive workflow design advisor for Power Automate, n8n, Make, Zapier and other platforms. Guides users through planning automation workflows with smart questions about triggers, actions, data flow, and error handling. Uses research sub-agent to find best practices and generates detailed implementation plan. Triggers when user mentions \"create workflow\", \"build flow\", \"design automation\", \"need ideas for\", or describes workflow requirements without having a complete design.",
                "path": ".claude/skills/automation-brainstorm/SKILL.md",
                "frontmatter": {
                  "name": "automation-brainstorm",
                  "description": "Interactive workflow design advisor for Power Automate, n8n, Make, Zapier and other platforms. Guides users through planning automation workflows with smart questions about triggers, actions, data flow, and error handling. Uses research sub-agent to find best practices and generates detailed implementation plan. Triggers when user mentions \"create workflow\", \"build flow\", \"design automation\", \"need ideas for\", or describes workflow requirements without having a complete design."
                },
                "content": "# Automation Brainstorm\n\nInteractive workflow design advisor that helps plan and architect automation workflows through guided conversations.\n\n## Supported Platforms\n\n- **Power Automate** (Microsoft)\n- **n8n** (Open-source)\n- **Make** (formerly Integromat)\n- **Zapier**\n- **Other JSON-based workflow platforms**\n\n## Purpose\n\nThis skill provides expert guidance for planning automation workflows by:\n1. Understanding user requirements through interactive questions\n2. Recommending triggers, actions, and data flow patterns\n3. Researching platform-specific best practices\n4. Identifying potential issues early\n5. Generating detailed implementation plan for automation-build-flow\n\n## When This Skill Activates\n\nAutomatically activates when user:\n- Mentions creating/building a new workflow: \"I want to create a flow that...\"\n- Asks for ideas/advice: \"What's the best way to automate...\"\n- Describes requirements without complete design: \"I need to sync data between...\"\n- Requests planning help: \"Help me design a workflow for...\"\n- Keywords: \"create flow\", \"build automation\", \"design workflow\", \"need ideas\"\n\n**Does NOT activate when**:\n- User has complete plan and wants to build (use automation-build-flow)\n- User has error and needs debugging (use automation-debugger)\n- User wants to validate existing flow (use automation-validator)\n\n## Core Workflow\n\n### Phase 1: Platform & Context Discovery\n\n**CRITICAL**: Always determine the platform first!\n\n1. **Check if Platform Specified**\n   - Look for platform mention in user message\n   - Power Automate, n8n, Make, Zapier, etc.\n\n2. **Ask for Platform if Missing**\n   ```\n   Use AskUserQuestion tool:\n\n   Question: \"Which automation platform will you be using for this workflow?\"\n   Header: \"Platform\"\n   Options:\n   - Power Automate (Microsoft cloud platform with Office 365 integration)\n   - n8n (Open-source, self-hosted, node-based automation)\n   - Make (Visual scenario builder, formerly Integromat)\n   - Zapier (SaaS automation platform, easy to use)\n   - Other (Specify in custom response)\n   ```\n\n3. **Gather Initial Requirements**\n   - What problem are they solving?\n   - What systems need to connect?\n   - What's the expected frequency?\n   - Any specific constraints?\n\n### Phase 2: Interactive Design Session\n\nUse AskUserQuestion tool for guided discovery. Ask 2-4 questions per iteration.\n\n#### Question Set 1: Trigger Design\n\n```\nUse AskUserQuestion tool:\n\nQuestion 1: \"What should trigger this workflow?\"\nHeader: \"Trigger Type\"\nOptions:\n- Schedule (Run on a regular schedule - hourly, daily, etc.)\n- Event (Triggered by an event - new email, file upload, etc.)\n- Webhook (Triggered by HTTP request from external system)\n- Manual (Run on demand by user)\n\nQuestion 2: \"How frequently will this workflow run?\"\nHeader: \"Frequency\"\nOptions:\n- High (Multiple times per minute or real-time)\n- Medium (Every few minutes to hourly)\n- Low (Daily, weekly, or on-demand)\n- Variable (Depends on external events)\n```\n\n#### Question Set 2: Data & Actions\n\n```\nUse AskUserQuestion tool:\n\nQuestion 1: \"What data sources will you read from?\"\nHeader: \"Data Sources\"\nMultiSelect: true\nOptions:\n- Databases (SQL, NoSQL, cloud databases)\n- APIs (REST APIs, webhooks, web services)\n- Files (CSV, Excel, JSON, XML, documents)\n- Email (Read emails, attachments, process content)\n- Other (Cloud storage, messaging systems, etc.)\n\nQuestion 2: \"What actions will the workflow perform?\"\nHeader: \"Actions\"\nMultiSelect: true\nOptions:\n- Transform data (Parse, filter, map, aggregate)\n- Create/Update records (Database, CRM, systems)\n- Send notifications (Email, Slack, Teams, SMS)\n- File operations (Upload, download, convert)\n- Other (Custom API calls, complex logic)\n```\n\n#### Question Set 3: Error Handling & Requirements\n\n```\nUse AskUserQuestion tool:\n\nQuestion 1: \"How critical is this workflow?\"\nHeader: \"Criticality\"\nOptions:\n- Critical (Must not fail, needs immediate alerts)\n- Important (Should retry on failure, log errors)\n- Standard (Basic error handling, can fail occasionally)\n- Low (Minimal error handling, best effort)\n\nQuestion 2: \"What are your main concerns?\"\nHeader: \"Concerns\"\nMultiSelect: true\nOptions:\n- Performance (Speed, processing large volumes)\n- Reliability (Must not lose data, retry logic)\n- Security (Handle sensitive data, authentication)\n- Monitoring (Need visibility, logging, alerts)\n- Cost (API limits, execution costs, efficiency)\n```\n\n### Phase 3: Research Best Practices\n\n**CRITICAL**: Use Task tool to launch research sub-agent.\n\n```\nUse Task tool with subagent_type=\"Explore\" and thoroughness=\"very thorough\"\n\nPrompt: \"Research best practices for [PLATFORM] workflow with the following requirements:\n\nPlatform: [Power Automate / n8n / Make / Zapier]\nTrigger: [USER_SELECTED_TRIGGER]\nData Sources: [USER_SELECTED_SOURCES]\nActions: [USER_SELECTED_ACTIONS]\nCriticality: [USER_SELECTED_CRITICALITY]\n\nSearch in Docs/{Platform}_Documentation/ for:\n1. Recommended patterns for this trigger type\n2. Best practices for the selected data sources\n3. Error handling patterns for this criticality level\n4. Performance optimization (API limits, batching, etc.)\n5. Security best practices for this use case\n6. Common pitfalls to avoid\n\nReturn:\n- Specific connector/node recommendations\n- Architectural patterns\n- Error handling strategies\n- Performance considerations\n- Security recommendations\n- Example implementations if available\"\n```\n\n**Expected Research Output**:\n- Platform-specific connector/node recommendations\n- Best practice patterns from documentation\n- Known limitations and workarounds\n- Error handling strategies\n- Performance optimization tips\n\n### Phase 4: Design Recommendations\n\nBased on user requirements and research findings:\n\n1. **Architecture Overview**\n   - Recommended trigger configuration\n   - Data flow diagram (textual)\n   - Key actions/nodes sequence\n   - Branching/conditional logic\n\n2. **Implementation Considerations**\n   - API rate limits and throttling\n   - Data transformation needs\n   - Error handling strategy\n   - Retry logic recommendations\n   - Monitoring and logging\n\n3. **Platform-Specific Recommendations**\n   - Best connectors/nodes for the platform\n   - Platform quirks to be aware of\n   - Performance optimizations\n   - Cost considerations\n\n4. **Potential Issues & Solutions**\n   - Common problems for this pattern\n   - Preventive measures\n   - Fallback strategies\n\n### Phase 5: Generate Implementation Plan\n\nCreate detailed, structured plan ready for automation-build-flow skill.\n\n## Implementation Plan Format\n\n```markdown\n# Workflow Implementation Plan\n\n## Platform\n[Power Automate / n8n / Make / Zapier]\n\n## Overview\n[1-2 sentence description of what the workflow does]\n\n## Requirements Summary\n- **Trigger**: [Trigger type and configuration]\n- **Frequency**: [Expected execution frequency]\n- **Data Sources**: [List of sources]\n- **Actions**: [List of main actions]\n- **Criticality**: [Criticality level]\n\n## Architecture\n\n### 1. Trigger Configuration\n**Type**: [Schedule / Event / Webhook / Manual]\n**Configuration**:\n- Parameter 1: [Value]\n- Parameter 2: [Value]\n\n**Platform-Specific**:\n- Connector/Node: [Name]\n- Special considerations: [Any platform quirks]\n\n### 2. Data Flow\n\n#### Step 1: [Action Name]\n**Purpose**: [What this step does]\n**Connector/Node**: [Platform-specific component]\n**Configuration**:\n- Input: [Data source/format]\n- Processing: [What happens]\n- Output: [Result format]\n\n**Error Handling**:\n- On failure: [Retry / Skip / Alert]\n- Fallback: [Alternative action if needed]\n\n#### Step 2: [Action Name]\n[Same structure as Step 1]\n\n#### Step N: [Action Name]\n[Same structure]\n\n### 3. Conditional Logic\n\n**Condition 1**: [Description]\n- If true → [Action path]\n- If false → [Alternative path]\n\n**Condition 2**: [Description]\n[Same structure]\n\n### 4. Error Handling Strategy\n\n**Global Error Handler**:\n- Wrap critical sections in: [Scope / Try-Catch / Error boundary]\n- On error:\n  1. Log error details\n  2. [Retry logic if applicable]\n  3. Send notification to: [Email / Slack / Teams]\n\n**Action-Specific Error Handling**:\n- [Action 1]: [Specific handling]\n- [Action 2]: [Specific handling]\n\n### 5. Performance Optimization\n\n**API Rate Limiting**:\n- [Connector/API]: [Limit] calls per [time period]\n- Mitigation: [Delays / Batching / Throttling strategy]\n\n**Data Processing**:\n- Batch size: [Number] items per iteration\n- Pagination: [Strategy if needed]\n- Filtering: [Filter at source to reduce volume]\n\n**Concurrency**:\n- Parallel execution: [Yes/No and configuration]\n- Sequential processing: [When and why]\n\n### 6. Security Considerations\n\n**Authentication**:\n- [Connector/API]: [Auth method]\n- Credential storage: [Secure parameters / Connection references]\n\n**Data Handling**:\n- Sensitive data: [Encryption / Masking strategy]\n- Logging: [What to log / What to exclude]\n- Compliance: [GDPR / HIPAA / Other requirements]\n\n### 7. Monitoring & Logging\n\n**Logging Strategy**:\n- Log points: [Where to log]\n- Log level: [Info / Warning / Error]\n- Log destination: [Platform logs / External system]\n\n**Monitoring**:\n- Success metrics: [What indicates success]\n- Failure alerts: [When to alert]\n- Performance metrics: [Execution time / Volume processed]\n\n## Best Practices Applied\n\n1. **[Platform] Best Practice 1**\n   - Applied in: [Step/Action]\n   - Benefit: [Why this helps]\n\n2. **[Platform] Best Practice 2**\n   - Applied in: [Step/Action]\n   - Benefit: [Why this helps]\n\n[Continue for all relevant best practices]\n\n## Known Limitations & Workarounds\n\n1. **Limitation**: [Description]\n   - Impact: [How it affects the workflow]\n   - Workaround: [Solution implemented]\n   - Reference: [Docs/{Platform}_Documentation/file.md]\n\n2. **Limitation**: [Description]\n   [Same structure]\n\n## Testing Strategy\n\n**Test Cases**:\n1. Happy path: [Normal execution scenario]\n2. Error scenarios: [What failures to test]\n3. Edge cases: [Boundary conditions]\n4. Load testing: [If high volume]\n\n**Validation**:\n- Data accuracy: [How to verify]\n- Performance: [Acceptable execution time]\n- Error handling: [Verify failures handled correctly]\n\n## Deployment Checklist\n\n- [ ] All credentials configured securely\n- [ ] Error handling tested\n- [ ] Monitoring/alerts set up\n- [ ] Documentation created\n- [ ] Stakeholders notified\n- [ ] Backup/rollback plan ready\n\n## Next Steps\n\n1. Review this plan with stakeholders\n2. Use **automation-build-flow** skill to generate workflow JSON\n3. Deploy to test environment\n4. Execute test cases\n5. Monitor initial runs\n6. Deploy to production\n\n## References\n\n**Documentation**:\n- [Docs/{Platform}_Documentation/[relevant-files].md]\n\n**Best Practices Source**:\n- [Specific sections from platform docs]\n\n---\n\n*This plan was generated by automation-brainstorm skill and is ready for automation-build-flow*\n```\n\n## Output Delivery\n\nAfter generating the plan:\n\n1. **Present Complete Plan**\n   - Show full structured plan above\n   - Highlight key decisions and rationale\n\n2. **Summarize Key Points**\n   - Platform and trigger choice\n   - Main actions and data flow\n   - Critical considerations (performance, security, errors)\n\n3. **Next Steps**\n   - Suggest: \"Ready to build? Use automation-build-flow with this plan\"\n   - Or: \"Need changes? I can refine any section\"\n\n4. **Save Plan** (Optional)\n   - Suggest saving plan to file: `workflow_plan_{name}.md`\n   - Makes it easy to reference later\n\n## Best Practices\n\n### 1. Always Ask for Platform First\n```\nIf platform not specified → Use AskUserQuestion immediately\nDo not proceed with generic advice\nPlatform determines connectors, patterns, limitations\n```\n\n### 2. Iterative Questioning\n```\nDon't ask all questions at once\n2-4 questions per iteration\nAdjust questions based on previous answers\nUse multiSelect for non-exclusive choices\n```\n\n### 3. Research Documentation\n```\nAlways use research sub-agent\nDon't rely on general knowledge\nCite specific documentation files\nPlatform-specific recommendations only\n```\n\n### 4. Structured Plan Output\n```\nFollow the plan format exactly\nInclude all sections\nBe specific (no placeholders or TODOs)\nReady for automation-build-flow consumption\n```\n\n### 5. Consider User Experience Level\n```\nBeginner → More explanation, simpler patterns\nIntermediate → Best practices, common patterns\nAdvanced → Performance optimization, complex patterns\n```\n\n## Integration with Other Skills\n\n### Workflow Progression\n\n```\nUser idea\n    ↓\nautomation-brainstorm (this skill)\n    ↓\nImplementation Plan\n    ↓\nautomation-build-flow\n    ↓\nComplete workflow JSON\n    ↓\nautomation-validator\n    ↓\nDeploy to platform\n```\n\n### Skill Handoffs\n\n**To automation-build-flow**:\n- Output: Complete implementation plan\n- Format: Markdown with all sections\n- Contains: All technical details for JSON generation\n\n**To automation-debugger** (if user mentions problems):\n- Redirect: \"Sounds like you have an error. Let me activate automation-debugger\"\n\n**To automation-validator** (if user wants to check existing flow):\n- Redirect: \"For validation, use automation-validator skill\"\n\n## Example Interactions\n\n### Example 1: From Scratch\n\n**User**: \"I want to create a workflow that syncs customer data from Salesforce to our database\"\n\n**Skill**:\n1. Asks: Platform? → User selects \"n8n\"\n2. Asks: Trigger type? → User selects \"Schedule\"\n3. Asks: Frequency? → User selects \"Medium (hourly)\"\n4. Asks: Data sources? → User selects \"APIs, Databases\"\n5. Asks: Criticality? → User selects \"Important\"\n6. Research agent → Finds n8n Salesforce + database best practices\n7. Generates plan → Complete implementation plan for n8n\n8. Suggests → \"Use automation-build-flow to generate the workflow JSON\"\n\n### Example 2: Vague Requirements\n\n**User**: \"I need something to handle incoming emails\"\n\n**Skill**:\n1. Asks: Platform? → User selects \"Power Automate\"\n2. Asks: What should happen when email arrives?\n3. Asks: Which emails (all, specific sender, subject filter)?\n4. Asks: What to do with email content?\n5. Asks: Where to save/forward/process?\n6. Research agent → Finds Power Automate email handling patterns\n7. Generates plan → Detailed implementation plan\n8. User reviews and approves\n\n### Example 3: Performance-Critical\n\n**User**: \"Build high-volume API sync workflow for Make\"\n\n**Skill**:\n1. Platform already specified → Make ✓\n2. Asks: Trigger type? → User selects \"Schedule\"\n3. Asks: Expected volume? → User: \"10,000+ records/hour\"\n4. Asks: Data sources? → User selects \"APIs\"\n5. Asks: Concerns? → User selects \"Performance, Reliability, Cost\"\n6. Research agent → Finds Make performance best practices, API limits\n7. Generates plan → Includes batching, throttling, error recovery\n8. Highlights → Performance optimizations, cost considerations\n\n## Quality Checklist\n\nBefore delivering plan, verify:\n\n- [ ] Platform specified and confirmed\n- [ ] All user requirements captured\n- [ ] Research sub-agent consulted documentation\n- [ ] Best practices from documentation applied\n- [ ] All plan sections complete (no TODOs/placeholders)\n- [ ] Platform-specific connectors/nodes recommended\n- [ ] Error handling strategy defined\n- [ ] Performance considerations addressed\n- [ ] Security recommendations included\n- [ ] Testing strategy provided\n- [ ] Plan is actionable and specific\n- [ ] Ready for automation-build-flow skill\n\n## Advanced Features\n\n### Refining the Plan\n\nIf user asks for changes:\n```\n\"Can you add email notifications?\"\n→ Update relevant section\n→ Add email action to data flow\n→ Update error handling if needed\n→ Regenerate updated plan\n```\n\n### Multiple Workflows\n\nIf requirements suggest multiple workflows:\n```\n\"This should be split into 2 workflows:\n1. [Workflow 1 purpose]\n2. [Workflow 2 purpose]\n\nShould I create separate plans?\"\n```\n\n### Comparison Mode\n\nIf user unsure about platform:\n```\n\"Would you like me to compare how this would work on:\n- n8n vs Power Automate?\n- Make vs Zapier?\n\nI can show pros/cons for your use case\"\n```\n\n## Common Patterns\n\n### High-Volume Data Sync\n- Schedule trigger with pagination\n- Batching and throttling\n- Incremental sync (track last run)\n- Robust error handling\n\n### Event-Driven Processing\n- Webhook or event trigger\n- Immediate processing\n- Idempotency (handle duplicates)\n- Fast response time\n\n### File Processing\n- File upload/creation trigger\n- File size validation\n- Chunked processing for large files\n- Error handling per file\n\n### Multi-System Integration\n- Orchestration pattern\n- Sequential or parallel execution\n- Transaction handling\n- Rollback strategy\n\n## Troubleshooting\n\n### User Unsure About Requirements\n\nGuide with examples:\n```\n\"Let me give you examples:\n- E-commerce order processing\n- Customer onboarding automation\n- Report generation and distribution\n- Data synchronization between systems\n\nWhich is closest to your use case?\"\n```\n\n### Platform Choice Unclear\n\nProvide guidance:\n```\n\"Platform selection depends on:\n- Power Automate: Best if you use Microsoft 365, cloud-native\n- n8n: Best if you want self-hosted, open-source, full control\n- Make: Best for visual design, many pre-built templates\n- Zapier: Best for quick setup, ease of use, SaaS\n\nWhat's your priority?\"\n```\n\n## Documentation References\n\nSkills should reference:\n- `Docs/{Platform}_Documentation/` - Platform-specific docs\n- `output-style/` - Output formatting standards\n- Other skills for workflow context\n\n---\n\n**This skill is the starting point for creating new automation workflows. Always generates a complete, actionable plan ready for automation-build-flow skill.**"
              },
              {
                "name": "automation-build-flow",
                "description": "Workflow builder for Power Automate, n8n, Make, Zapier and other platforms. Generates complete, production-ready workflow JSON from implementation plans or requirements. Uses flow-builder sub-agent to create valid platform-specific JSON with all triggers, actions, error handling, and configurations. Triggers when user has a plan/requirements and wants to generate workflow JSON, or says \"build this workflow\", \"create the flow\", \"generate JSON\". Output ready for import into target platform.",
                "path": ".claude/skills/automation-build-flow/SKILL.md",
                "frontmatter": {
                  "name": "automation-build-flow",
                  "description": "Workflow builder for Power Automate, n8n, Make, Zapier and other platforms. Generates complete, production-ready workflow JSON from implementation plans or requirements. Uses flow-builder sub-agent to create valid platform-specific JSON with all triggers, actions, error handling, and configurations. Triggers when user has a plan/requirements and wants to generate workflow JSON, or says \"build this workflow\", \"create the flow\", \"generate JSON\". Output ready for import into target platform."
                },
                "content": "# Automation Build Flow\n\nProfessional workflow builder that generates complete, production-ready JSON for any automation platform.\n\n## Supported Platforms\n\n- **Power Automate** (Microsoft)\n- **n8n** (Open-source)\n- **Make** (formerly Integromat)\n- **Zapier**\n- **Other JSON-based workflow platforms**\n\n## Purpose\n\nThis skill generates complete automation workflows by:\n1. Taking implementation plan or requirements as input\n2. Validating platform compatibility\n3. Using flow-builder sub-agent to generate complete JSON\n4. Ensuring all best practices are implemented\n5. Producing ready-to-import workflow JSON\n\n## When This Skill Activates\n\nAutomatically activates when user:\n- Has implementation plan: \"Build this workflow from the plan\"\n- Provides requirements: \"Create a workflow that does X, Y, Z\"\n- Requests JSON generation: \"Generate the flow JSON\"\n- Has plan from automation-brainstorm: \"Use this plan to build the flow\"\n- Keywords: \"build flow\", \"create workflow\", \"generate JSON\", \"implement this\"\n\n**Prerequisites**:\n- Platform must be specified (or will ask)\n- Requirements must be clear (or will request clarification)\n\n**Does NOT activate when**:\n- User needs help planning (use automation-brainstorm)\n- User has error to debug (use automation-debugger)\n- User wants validation only (use automation-validator)\n\n## Core Workflow\n\n### Phase 1: Input Analysis\n\n1. **Determine Input Type**\n\n   **Type A: Implementation Plan** (from automation-brainstorm)\n   - Structured markdown plan\n   - Contains all sections (trigger, actions, error handling, etc.)\n   - Platform specified\n   - Ready to build → Proceed to Phase 2\n\n   **Type B: Direct Requirements** (user provided)\n   - User describes what they want\n   - May be less structured\n   - Needs clarification → Gather requirements\n\n2. **Verify Platform**\n\n   Check if platform specified:\n   - In plan: Check \"Platform\" section\n   - In message: Look for platform mention\n   - If missing: Ask using AskUserQuestion\n\n   ```\n   Use AskUserQuestion tool:\n\n   Question: \"Which platform should I generate this workflow for?\"\n   Header: \"Platform\"\n   Options:\n   - Power Automate (Microsoft, generates .json for \"Paste code\" feature)\n   - n8n (Open-source, generates workflow.json for import)\n   - Make (Integromat, generates scenario blueprint.json)\n   - Zapier (Generates zap JSON for import API)\n   - Other (Specify platform and format needed)\n   ```\n\n3. **Validate Requirements Completeness**\n\n   Essential elements needed:\n   - ✅ Trigger type and configuration\n   - ✅ Main actions/steps\n   - ✅ Data flow between steps\n   - ✅ Error handling requirements\n   - ⚠️  Optional: Specific connectors, advanced config\n\n   If missing critical info:\n   ```\n   Use AskUserQuestion tool to gather missing pieces:\n\n   Example for missing trigger:\n   Question: \"What should trigger this workflow?\"\n   Header: \"Trigger\"\n   Options: [Schedule/Event/Webhook/Manual]\n\n   Example for missing actions:\n   Question: \"What are the main actions this workflow should perform?\"\n   Header: \"Actions\"\n   MultiSelect: true\n   Options: [Based on context]\n   ```\n\n### Phase 2: Build Workflow with Sub-Agent\n\n**CRITICAL**: Use Task tool to launch flow-builder sub-agent.\n\n```\nUse Task tool with subagent_type=\"general-purpose\" or \"Plan\"\n\nPrompt: \"Generate complete workflow JSON for [PLATFORM] with the following specification:\n\n## Platform\n[Power Automate / n8n / Make / Zapier / Other]\n\n## Complete Specification\n\n[IF FROM PLAN: Paste entire implementation plan here]\n\n[IF FROM REQUIREMENTS: Structure requirements as:]\n\n### Trigger\nType: [Schedule/Event/Webhook/Manual]\nConfiguration:\n- [Parameter 1]: [Value]\n- [Parameter 2]: [Value]\nPlatform connector/node: [Specific component]\n\n### Actions/Steps\n\n#### Step 1: [Name]\nPurpose: [What it does]\nConnector/Node: [Platform-specific component]\nInputs:\n- [Input 1]: [Value/Expression]\n- [Input 2]: [Value/Expression]\nOutputs: [What this step produces]\n\n#### Step 2: [Name]\n[Same structure]\n\n[Continue for all steps]\n\n### Conditional Logic\n[If applicable, describe conditions and branching]\n\n### Error Handling\nGlobal strategy: [Scope/Try-catch/Error boundary]\nStep-specific handling:\n- [Step 1]: [On error behavior]\n- [Step 2]: [On error behavior]\n\n### Performance Configuration\n- API rate limits: [Delays/Throttling needed]\n- Batching: [Batch size if applicable]\n- Concurrency: [Sequential/Parallel configuration]\n\n### Security\n- Authentication: [Method for each connector]\n- Sensitive data: [Handling strategy]\n\n### Monitoring\n- Logging: [What to log]\n- Alerts: [When to alert]\n\n## Requirements for Generated JSON\n\nCRITICAL - The output must be:\n\n1. **Complete and Valid**\n   - Syntactically correct JSON for [PLATFORM]\n   - All required fields present\n   - No placeholders or TODOs\n   - Valid IDs/GUIDs as required by platform\n\n2. **Platform-Specific Structure**\n   - Follow [PLATFORM] schema exactly\n   - Reference: Docs/{Platform}_Documentation/format-specification.md\n   - Use correct connector/node names for platform\n   - Follow platform naming conventions\n\n3. **Fully Configured**\n   - All triggers properly configured\n   - All actions have complete inputs\n   - Error handlers in place\n   - Dependencies/runAfter chains correct\n   - Variables initialized if needed\n\n4. **Best Practices Implemented**\n   - Error handling as specified\n   - Performance optimizations (delays, batching)\n   - Security configurations\n   - Retry logic for transient errors\n   - Idempotency where applicable\n\n5. **Ready for Import**\n   - Can be directly imported/pasted into [PLATFORM]\n   - No manual editing needed\n   - All expressions/formulas valid for platform\n   - Connection placeholders where appropriate\n\n## Platform-Specific Requirements\n\n[IF Power Automate]:\n- Schema: https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#\n- Include $connections parameter\n- Use correct operationId for each action\n- Proper runAfter chains\n- GUID format for operationMetadataId\n\n[IF n8n]:\n- nodes array with proper IDs\n- connections object linking nodes\n- position coordinates for visual layout\n- Proper credential references\n- Node versions specified\n\n[IF Make]:\n- modules array with proper IDs\n- Proper connections/routing\n- Scenario metadata\n- Module configurations\n\n[IF Zapier]:\n- steps array\n- Proper step types\n- Action configurations\n- Trigger setup\n\nReturn ONLY the complete JSON - no explanations, no markdown code blocks, no additional text.\nJust the pure JSON ready for import.\"\n```\n\n**Expected Output from Flow-Builder Agent**:\n- Complete, syntactically valid JSON\n- Platform-specific format\n- All triggers and actions configured\n- Error handling implemented\n- Performance optimizations applied\n- Ready for immediate import\n\n### Phase 3: Validate Generated JSON\n\nBefore presenting to user:\n\n1. **Syntax Check**\n   - Valid JSON (balanced brackets, proper escaping)\n   - No trailing commas\n   - Correct structure\n\n2. **Completeness Check**\n   - All actions from plan included\n   - Trigger properly configured\n   - Error handlers present\n   - Dependencies/connections valid\n\n3. **Platform Compliance**\n   - Follows platform schema\n   - Uses valid connector/node names\n   - Correct ID/GUID format\n   - Platform-specific requirements met\n\nIf validation fails → Retry with flow-builder agent with specific corrections needed\n\n### Phase 4: Present Workflow JSON\n\nFormat output for user:\n\n```markdown\n# Workflow JSON Generated ✅\n\n## Platform\n[Platform Name]\n\n## Summary\n- **Trigger**: [Trigger type]\n- **Actions**: [Count] actions/nodes\n- **Error Handling**: [Strategy implemented]\n- **Status**: Ready for import\n\n---\n\n## Complete Workflow JSON\n\n**Instructions**: Copy the entire JSON below and import into [PLATFORM]:\n\n[IF Power Automate]: Paste into Power Automate using \"Paste code\" feature\n[IF n8n]: Import via Settings → Import Workflow\n[IF Make]: Import via Scenarios → Create new → Import Blueprint\n[IF Zapier]: Use Zapier CLI or import API\n\n```json\n{\n  // Complete workflow JSON here\n}\n```\n\n---\n\n## What's Included\n\n✅ **Trigger Configuration**\n- Type: [Trigger type]\n- Configuration: [Key settings]\n\n✅ **Actions/Steps** ([Count] total)\n1. [Action 1 name]: [What it does]\n2. [Action 2 name]: [What it does]\n[Continue for all actions]\n\n✅ **Error Handling**\n- Global error handler: [Yes/No]\n- Step-level handlers: [Which steps]\n- Retry logic: [Where applied]\n- Notifications: [Where configured]\n\n✅ **Performance Optimizations**\n- API throttling: [Delays/Limits]\n- Batching: [If applicable]\n- Concurrency: [Configuration]\n\n✅ **Security**\n- Authentication: [Methods used]\n- Sensitive data: [How handled]\n\n---\n\n## Next Steps\n\n1. **Import into [PLATFORM]**\n   - [Platform-specific import instructions]\n\n2. **Configure Connections**\n   - [List of connections to configure]\n   - [Authentication requirements]\n\n3. **Test the Workflow**\n   - Run with sample data\n   - Verify error handling\n   - Check all actions execute correctly\n\n4. **Validate with automation-validator** (Recommended)\n   - Run: \"Validate this workflow JSON\"\n   - Checks for best practices and potential issues\n\n5. **Deploy**\n   - Test environment first\n   - Monitor initial runs\n   - Deploy to production\n\n---\n\n## Configuration Notes\n\n[Any platform-specific notes]:\n- After import, configure [connections/credentials]\n- Verify [specific settings]\n- Adjust [parameters] for your environment\n\n---\n\n## Testing Recommendations\n\n**Test Cases**:\n1. Happy path: [Normal execution]\n2. Error scenarios: [What to test]\n3. Edge cases: [Boundary conditions]\n\n**Validation Points**:\n- All actions execute in correct order\n- Error handling triggers correctly\n- Data transforms as expected\n- Performance is acceptable\n\n---\n\n*Generated by automation-build-flow skill. Ready for immediate import into [PLATFORM].*\n```\n\n## Output Format Variations by Platform\n\n### Power Automate\n\n```json\n{\n  \"definition\": {\n    \"$schema\": \"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n      \"$connections\": {\n        \"defaultValue\": {},\n        \"type\": \"Object\"\n      }\n    },\n    \"triggers\": {\n      \"trigger_name\": {\n        \"type\": \"Recurrence\",\n        \"recurrence\": {\n          \"frequency\": \"Hour\",\n          \"interval\": 1\n        }\n      }\n    },\n    \"actions\": {\n      \"action_1\": {\n        \"type\": \"ApiConnection\",\n        \"inputs\": { /* ... */ },\n        \"runAfter\": {}\n      }\n    }\n  },\n  \"schemaVersion\": \"1.0.0.0\"\n}\n```\n\n### n8n\n\n```json\n{\n  \"name\": \"Workflow Name\",\n  \"nodes\": [\n    {\n      \"parameters\": { /* ... */ },\n      \"name\": \"Node Name\",\n      \"type\": \"n8n-nodes-base.nodeName\",\n      \"typeVersion\": 1,\n      \"position\": [250, 300],\n      \"id\": \"uuid\"\n    }\n  ],\n  \"connections\": {\n    \"Node1\": {\n      \"main\": [[{\"node\": \"Node2\", \"type\": \"main\", \"index\": 0}]]\n    }\n  }\n}\n```\n\n### Make\n\n```json\n{\n  \"name\": \"Scenario Name\",\n  \"flow\": [\n    {\n      \"id\": 1,\n      \"module\": \"gateway:CustomWebHook\",\n      \"parameters\": { /* ... */ }\n    }\n  ],\n  \"metadata\": {\n    \"version\": 1\n  }\n}\n```\n\n### Zapier\n\n```json\n{\n  \"title\": \"Zap Name\",\n  \"steps\": [\n    {\n      \"type\": \"trigger\",\n      \"app\": \"app_name\",\n      \"event\": \"event_name\",\n      \"params\": { /* ... */ }\n    }\n  ]\n}\n```\n\n## Best Practices\n\n### 1. Complete Specification to Sub-Agent\n\n```\nProvide ALL details to flow-builder:\n- Complete plan or requirements\n- Platform-specific connector names\n- All configurations and parameters\n- Error handling requirements\n- Performance settings\n\nDon't assume sub-agent knows context!\n```\n\n### 2. Validate Before Presenting\n\n```\nAlways check generated JSON:\n✅ Syntax valid\n✅ Structure complete\n✅ Platform schema compliance\n✅ No placeholders/TODOs\n✅ All actions present\n\nIf issues found → Regenerate with corrections\n```\n\n### 3. Clear Import Instructions\n\n```\nProvide platform-specific import steps:\n- Where to import (exact menu path)\n- What to configure after import\n- Common issues to watch for\n- Validation recommendations\n```\n\n### 4. Error Handling Always Included\n\n```\nNever skip error handling:\n- Global error handler (scope/try-catch)\n- Action-level handlers where needed\n- Retry logic for transient errors\n- Notifications on critical failures\n```\n\n### 5. Performance by Default\n\n```\nAlways include performance optimizations:\n- API rate limit respect (delays)\n- Batching for high-volume\n- Concurrency configuration\n- Filtering at source\n```\n\n## Integration with Other Skills\n\n### Workflow Progression\n\n```\nautomation-brainstorm\n    ↓\nImplementation Plan\n    ↓\nautomation-build-flow (this skill)\n    ↓\nComplete Workflow JSON\n    ↓\nautomation-validator (recommended)\n    ↓\nDeploy to Platform\n```\n\n### From automation-brainstorm\n\n**Perfect Integration**:\n- Receives complete implementation plan\n- All sections populated\n- Platform specified\n- Best practices researched\n- Ready to build immediately\n\n**How to Handle**:\n1. Extract platform from plan\n2. Pass entire plan to flow-builder sub-agent\n3. Generate JSON\n4. Present to user\n\n### To automation-validator\n\n**Recommended Flow**:\n```\nAfter JSON generation:\n\"Would you like me to validate this workflow before you import it?\nI can run automation-validator to check for potential issues.\"\n```\n\n**If user agrees**:\n- Save JSON to temp file\n- Trigger automation-validator\n- Show validation report\n- Fix any issues found\n- Regenerate if needed\n\n### From Direct Requirements\n\n**If user provides requirements without plan**:\n1. Gather essential info (platform, trigger, actions)\n2. Use AskUserQuestion for missing pieces\n3. Generate JSON from requirements\n4. May be simpler than brainstorm output\n5. Suggest brainstorm for complex workflows\n\n## Common Scenarios\n\n### Scenario 1: Build from Brainstorm Plan\n\n**User**: \"Build the workflow from the plan above\"\n\n**Skill**:\n1. Identifies plan in conversation history\n2. Extracts platform (e.g., \"n8n\")\n3. Passes complete plan to flow-builder sub-agent\n4. Receives complete n8n workflow JSON\n5. Validates JSON structure\n6. Presents to user with import instructions\n\n### Scenario 2: Build from Simple Requirements\n\n**User**: \"Create a Power Automate flow that runs daily and emails me a list of new files from OneDrive\"\n\n**Skill**:\n1. Platform specified → Power Automate ✓\n2. Trigger clear → Schedule (daily) ✓\n3. Actions clear → Get files, Send email ✓\n4. Generates structured spec for flow-builder\n5. Receives Power Automate JSON\n6. Presents with configuration notes\n\n### Scenario 3: Missing Platform\n\n**User**: \"Build a workflow that syncs database to API\"\n\n**Skill**:\n1. Platform not specified → Ask user\n2. User selects \"Make\"\n3. Clarifies: Which database? Which API?\n4. Gathers configuration details\n5. Generates Make scenario JSON\n6. Presents with import instructions\n\n### Scenario 4: Complex Multi-Step\n\n**User**: \"Implement the workflow plan for high-volume Salesforce sync\"\n\n**Skill**:\n1. References plan (contains all details)\n2. Platform: n8n (from plan)\n3. Passes comprehensive spec to flow-builder:\n   - Scheduled trigger (every 5 minutes)\n   - Salesforce query with pagination\n   - Data transformation nodes\n   - Batch processing (100 records)\n   - Error handling with retry\n   - Notification on failure\n4. Receives complex n8n workflow (20+ nodes)\n5. Validates all connections\n6. Presents with testing recommendations\n\n## Quality Checklist\n\nBefore delivering JSON, verify:\n\n- [ ] Platform correctly identified\n- [ ] Flow-builder sub-agent used (never hand-code JSON)\n- [ ] Generated JSON is syntactically valid\n- [ ] All actions from plan/requirements included\n- [ ] Trigger properly configured\n- [ ] Error handling implemented\n- [ ] Performance optimizations applied\n- [ ] Platform schema compliance verified\n- [ ] No placeholders or TODOs in JSON\n- [ ] Import instructions provided\n- [ ] Configuration notes included\n- [ ] Next steps clearly explained\n- [ ] Validation recommended\n\n## Advanced Features\n\n### Iterative Refinement\n\nIf user wants changes:\n```\n\"Add email notification when it fails\"\n→ Regenerate with updated spec\n→ Add email action to error handler\n→ Present updated JSON\n```\n\n### Partial JSON Updates\n\nIf user has JSON and wants to modify:\n```\n\"This workflow needs better error handling\"\n→ Read existing JSON\n→ Identify error handling gaps\n→ Regenerate with improvements\n→ Present updated JSON\n```\n\n### Multi-Platform Generation\n\nIf user wants same workflow for different platforms:\n```\n\"Generate this for both Power Automate and n8n\"\n→ Generate for Power Automate\n→ Generate for n8n\n→ Present both with comparison notes\n```\n\n## Troubleshooting\n\n### Sub-Agent Returns Invalid JSON\n\n**Problem**: JSON has syntax errors or missing elements\n\n**Solution**:\n1. Validate with JSON parser\n2. Identify specific issues\n3. Regenerate with detailed corrections:\n   ```\n   \"Previous generation had [SPECIFIC_ISSUE].\n   Regenerate with correct [CORRECTION].\"\n   ```\n\n### Platform Schema Mismatch\n\n**Problem**: JSON doesn't match platform schema\n\n**Solution**:\n1. Reference platform format documentation\n2. Identify schema violations\n3. Provide correct schema example to sub-agent\n4. Regenerate with schema compliance focus\n\n### Missing Critical Configuration\n\n**Problem**: Generated JSON missing key settings\n\n**Solution**:\n1. Review original spec\n2. Identify what's missing\n3. Add explicit requirement to sub-agent prompt\n4. Regenerate with complete spec\n\n### Ambiguous Requirements\n\n**Problem**: Requirements unclear, can't generate reliably\n\n**Solution**:\n1. Don't guess!\n2. Use AskUserQuestion to clarify\n3. Get specific details\n4. Generate only when requirements clear\n\n## Documentation References\n\nSkills should reference:\n- `Docs/{Platform}_Documentation/` - Platform docs\n- Platform-specific format specifications\n- Connector/node documentation\n- Best practices guides\n\n---\n\n**This skill is the build engine for automation workflows. Always generates complete, production-ready JSON using flow-builder sub-agent. Never hand-codes workflow JSON.**"
              },
              {
                "name": "automation-debugger",
                "description": "Expert automation platform error debugger for Power Automate, n8n, Make, Zapier and other workflow platforms. Analyzes JSON flow definitions with error messages, researches official documentation, and generates complete fixed JSON ready for copy-paste. Triggers when user provides error JSON files, workflow JSON with errors, error messages, debug requests, or failing automation content. Returns structured debug report with root cause analysis and working fixed JSON.",
                "path": ".claude/skills/automation-debugger/SKILL.md",
                "frontmatter": {
                  "name": "automation-debugger",
                  "description": "Expert automation platform error debugger for Power Automate, n8n, Make, Zapier and other workflow platforms. Analyzes JSON flow definitions with error messages, researches official documentation, and generates complete fixed JSON ready for copy-paste. Triggers when user provides error JSON files, workflow JSON with errors, error messages, debug requests, or failing automation content. Returns structured debug report with root cause analysis and working fixed JSON."
                },
                "content": "# Automation Debugger\n\nExpert system for debugging automation workflow errors across multiple platforms and generating production-ready fixes.\n\n## Supported Platforms\n\n- **Power Automate** (Microsoft)\n- **n8n** (Open-source automation)\n- **Make** (formerly Integromat)\n- **Zapier**\n- **Other JSON-based workflow platforms**\n\n## Purpose\n\nThis skill provides comprehensive debugging for automation workflows by:\n1. Analyzing error messages and failing JSON flow definitions\n2. Researching official documentation to find root causes (Docs/ directory)\n3. Generating complete, valid fixed JSON ready for copy-paste (outputs as fixed_flow.json or similar)\n4. Avoiding hallucinations by strictly referencing platform documentation\n5. Adapting solutions to platform-specific requirements\n\n## When This Skill Activates\n\nAutomatically activates when user provides:\n- **Error JSON files** - Any JSON file containing error information (examples: error.json, erreur.json, error_bloc.json, workflow_error.json)\n- **Workflow JSON with errors** - Flow/workflow JSON content with error description (any platform)\n- **Error messages** - Error messages from workflow runs, logs, or execution history\n- **Debug requests** - Explicit requests to \"debug\", \"fix\", \"analyze\", or \"troubleshoot\" automation errors\n- **Status codes** - HTTP status codes (401, 403, 404, 429, 500, etc.) with workflow context\n- **Platform-specific errors** - \"Power Automate error\", \"n8n workflow failing\", \"Make scenario issue\", \"Zapier zap broken\"\n- **Failure descriptions** - \"My flow keeps failing\", \"this automation stopped working\", \"getting errors in workflow\"\n\n## Common Pitfalls to AVOID\n\n### ❌ CRITICAL ERROR #1: Assuming Data Structures (Most Common!)\n\n**The Mistake**:\n```json\n// You see a filter in the error flow\n\"where\": \"@contains(toLower(item()), 'keyword')\"\n\n// And you ASSUME it's filtering objects, so you fix with:\n\"value\": \"@items('Loop')?['PropertyName']\"  // ← WRONG IF ARRAY OF STRINGS!\n```\n\n**How to Avoid**:\n1. **ALWAYS analyze filter syntax first**: `item()` vs `item()?['Prop']`\n2. `item()` without property → Array of **primitives** (strings/numbers)\n3. `item()?['Property']` → Array of **objects**\n4. **Ask user when uncertain** - never guess data structures!\n5. Trace data sources back to understand actual types\n\n**Our Real Bug Example**:\n```json\n// Filter showed it was strings:\n\"where\": \"@contains(toLower(item()), 'cnesst')\"\n\n// But I incorrectly suggested accessing property:\n\"value\": \"@items('LoopCNESST')?['Nom']\"  // ← BUG!\n\n// Correct fix was:\n\"value\": \"@items('LoopCNESST')\"  // ← Just the string!\n```\n\n---\n\n### ❌ ERROR #2: Guessing Connector Outputs\n\n**The Mistake**: Assuming SharePoint GetFileItems returns objects with 'Name' property without checking\n\n**How to Avoid**:\n1. Search Docs/{Platform}_Documentation/ for output schemas\n2. Use WebSearch for official documentation if local docs don't have it\n3. Ask user to confirm property names if uncertain\n4. Check Select action mappings (they reveal structure)\n\n---\n\n### ❌ ERROR #3: Not Validating Fixes Against Data Flow\n\n**The Mistake**: Creating fixes that work syntactically but fail with actual data types\n\n**How to Avoid**:\n1. Complete Phase 0 (Data Structure Analysis) before fixing\n2. Trace entire data flow from source to error point\n3. Validate item access patterns match data types\n4. Test logic against actual data structures\n\n---\n\n## Core Workflow\n\n### Phase 0: Data Structure Analysis (CRITICAL - NEW!)\n\n**NEVER assume data structures without verification**. Before debugging, ALWAYS analyze actual data structures in the failing flow.\n\n1. **Examine the Error Context**\n   - Identify which action/variable contains the problematic data\n   - Look for variable declarations to understand types\n   - Check if error mentions property access on undefined/null\n\n2. **Analyze Filter/Query Operations** (MOST IMPORTANT!)\n   - **CRITICAL CHECK**: Look at `where` clauses in Query actions\n   - `item()` without property → **Array of primitives (strings/numbers)**\n     ```json\n     \"where\": \"@contains(toLower(item()), 'keyword')\"\n     // ↑ This means: Array of strings [\"string1\", \"string2\"]\n     ```\n   - `item()?['PropertyName']` → **Array of objects**\n     ```json\n     \"where\": \"@contains(item()?['Name'], 'keyword')\"\n     // ↑ This means: Array of objects [{\"Name\": \"...\"}, ...]\n     ```\n\n3. **Trace Data Sources**\n   - Follow `from` in Query actions back to source\n   - Check SharePoint/connector outputs\n   - Check Select action mappings (these define output structure!)\n   - Verify Compose action inputs\n   - Look for Array variable initializations\n\n4. **Validate Item Access Consistency**\n   - In loops: Check if `items('LoopName')` or `items('LoopName')?['Property']`\n   - In filters: Check if `item()` or `item()?['Property']`\n   - **MISMATCH = BUG**: Filter uses `item()` but loop uses `items('Loop')?['Prop']` → ERROR!\n\n5. **Ask User When Uncertain** (Use AskUserQuestion tool)\n   - If data structure is ambiguous after analysis\n   - If documentation doesn't clarify the structure\n   - If multiple valid interpretations exist\n   - If error message doesn't make structure clear\n\n   **Example questions**:\n   - \"I see your filter uses `contains(item(), 'text')`. Is your variable an array of strings like `['text1', 'text2']`, or an array of objects?\"\n   - \"Can you confirm the output structure from [ActionName]? Is it strings or objects with properties?\"\n   - \"The flow accesses `items('Loop')?['Nom']` but the filter suggests strings. Which is correct?\"\n\n### Phase 1: Error Analysis\n\n1. **Extract Error Information**\n   - Parse the provided JSON (error file, flow snippet, or workflow JSON)\n   - Identify the failing action or trigger\n   - Classify error type (Authentication/Throttling/Data Format/Timeout/Not Found/Permission)\n   - Extract exact error message text\n\n2. **Identify Context**\n   - Determine which platform (Power Automate, n8n, Make, Zapier, etc.)\n   - Identify connector/node involved (SharePoint, HTTP, Database, etc.)\n   - Find the specific action or trigger causing the failure\n   - Note any relevant workflow configuration or parameters\n\n### Phase 2: Documentation Research (Multi-Source Strategy - NEW!)\n\n**CRITICAL**: Research thoroughly using multiple sources in order. Never skip or guess!\n\n#### Step 1: Local Documentation Research (Use Task Tool with Explore Agent)\n\nLaunch research sub-agent with thorough investigation:\n\n```\nUse Task tool with subagent_type=\"Explore\" and thoroughness=\"very thorough\"\n\nPrompt: \"Research [PLATFORM] documentation for [ERROR_TYPE] error in [CONNECTOR/NODE_NAME], specifically the [ACTION_NAME] action/node.\n\nPlatform: [Power Automate / n8n / Make / Zapier / Other]\n\nSearch in Docs/ directory for platform-specific documentation:\n1. Platform documentation (Docs/{Platform}_Documentation/)\n2. Connector/node overview - find limitations and constraints\n3. **Data structure specifications** (output schemas, property names, data types)\n4. Action/node documentation - find parameter requirements\n5. Common error patterns for this platform\n\nFocus on finding:\n- **DATA STRUCTURE DETAILS** (output schemas, property names, array vs object)\n- Known limitations causing this error\n- Required parameters and their formats (platform-specific)\n- API limits or throttling constraints\n- Authentication/permission requirements\n- Platform-specific quirks or known issues\n- Common error scenarios and solutions\n\nReturn specific file paths, section names, and exact limitations found.\"\n```\n\n**Expected Output from Research Agent**:\n- **Data structure specifications** (schemas, property names, types)\n- Specific documentation file paths (Docs/{Platform}_Documentation/)\n- Relevant limitations or constraints\n- Required parameter formats (platform-specific)\n- Known workarounds or solutions\n- Platform-specific considerations\n\n#### Step 2: Web Research (Use WebSearch Tool - If Local Docs Insufficient)\n\n**ONLY if local documentation doesn't provide needed information**, use WebSearch:\n\n```\nUse WebSearch tool with targeted queries:\n\nExamples:\n- \"[PLATFORM] [CONNECTOR] output schema\"\n- \"[PLATFORM] [ACTION_NAME] return properties\"\n- \"[ERROR_CODE] [PLATFORM] [CONNECTOR] solution\"\n- \"Microsoft Learn [PLATFORM] [CONNECTOR] documentation\"\n\nSearch for:\n- Official platform documentation (Microsoft Learn, n8n docs, etc.)\n- Platform-specific community forums (verified answers only)\n- Official API documentation\n- Recent Stack Overflow solutions (check dates!)\n```\n\n**Validation Requirements**:\n- Prefer official documentation over community posts\n- Cross-reference multiple sources\n- Verify information is current (check publication dates)\n- Cite sources in output\n\n#### Step 3: Ask User for Clarification (Use AskUserQuestion Tool)\n\n**If both local docs and web search are unclear or contradictory**, ask the user:\n\n```\nUse AskUserQuestion tool with specific targeted questions:\n\nExample:\n{\n  \"questions\": [{\n    \"question\": \"Your flow uses `contains(item(), 'CNESST')` in the filter. Can you confirm what type of data is in this variable?\",\n    \"header\": \"Data Type\",\n    \"options\": [\n      {\n        \"label\": \"Array of strings\",\n        \"description\": \"Like ['CNESST 2025-01', 'INVALIDITÉ 2025-02']\"\n      },\n      {\n        \"label\": \"Array of objects\",\n        \"description\": \"Like [{'Nom': 'CNESST 2025-01'}, {'Nom': 'INVALIDITÉ 2025-02'}]\"\n      }\n    ],\n    \"multiSelect\": false\n  }]\n}\n```\n\n**When to Ask**:\n- Data structure is ambiguous after documentation search\n- Multiple valid interpretations exist for the error\n- Documentation contradicts observed flow patterns\n- Risk of creating a fix that introduces new bugs\n\n### Phase 3: Solution Design\n\nBased on research findings:\n\n1. **Root Cause Identification**\n   - Link error to specific documentation constraint\n   - Explain WHY the error occurs (technical reasoning)\n   - Reference exact file and section from Docs/{Platform}_Documentation/\n   - Consider platform-specific behaviors\n\n2. **Solution Strategy**\n   - Design fix addressing root cause\n   - Consider connector limitations\n   - Include error handling patterns\n   - Add retry logic if needed for transient errors\n   - Optimize for API limits\n\n3. **Validation**\n   - Verify solution against documentation constraints\n   - Check for unintended side effects\n   - Ensure compliance with Power Automate best practices\n   - Validate all parameters and data types\n\n### Phase 4: Fix Generation (Use Task Tool with Flow-Builder Agent)\n\n**CRITICAL**: Use the Task tool to launch a flow-builder agent for JSON generation.\n\nLaunch flow-builder sub-agent:\n\n```\nUse Task tool with subagent_type=\"Plan\" or \"general-purpose\"\n\nPrompt: \"Generate complete fixed workflow JSON for [PLATFORM] with the following requirements:\n\nPlatform: [Power Automate / n8n / Make / Zapier / Other]\nOriginal Error: [ERROR_DETAILS]\nRoot Cause: [ROOT_CAUSE_FROM_RESEARCH]\nRequired Fixes: [SPECIFIC_CHANGES_NEEDED]\n\nCreate a complete, valid workflow JSON following the platform-specific format in Docs/{Platform}_Documentation/ that:\n1. Includes all fixes for the identified error\n2. Maintains existing workflow logic that works\n3. Adds proper error handling (platform-specific)\n4. Includes retry logic if dealing with transient errors\n5. Respects API limits with delays if needed\n6. Uses valid IDs/GUIDs as required by platform\n7. Has correct dependencies/execution order\n8. Follows platform-specific syntax and structure\n9. Is ready for copy-paste into platform's import/code feature\n\nReturn ONLY the complete JSON with no placeholders or TODOs.\"\n```\n\n**Expected Output from Flow-Builder Agent**:\n- Complete, syntactically valid JSON (platform-specific format)\n- All required structure elements for the platform\n- Proper IDs/GUIDs for all operations\n- Correct expression/formula syntax\n- Complete execution chains/dependencies\n\n### Phase 5: Structured Output\n\nGenerate final output using the template from `output-style/template-debug-output.md`:\n\n1. **Error Analysis Section**\n   - Error type classification\n   - Failing action/trigger identification\n   - Original error message\n   - Impact description\n\n2. **Root Cause Section**\n   - Primary cause explanation\n   - Documentation references with specific file paths\n   - Technical details of the issue\n\n3. **Solution Section**\n   - Recommended fix approach\n   - Step-by-step implementation instructions\n   - Additional improvements (error handling, performance, reliability)\n   - Validation checklist\n\n4. **Fixed JSON Section**\n   - Complete, working JSON ready for copy-paste\n   - Platform-specific format\n   - List of changes applied\n   - Configuration notes for after pasting/importing\n\n5. **Alternative Approaches Section** (if applicable)\n   - Other viable solutions\n   - When to use each alternative\n   - Pros/cons comparison\n\n6. **Prevention Section**\n   - Best practices to avoid similar errors\n   - Monitoring recommendations\n   - Regular maintenance tasks\n\n## Output Format\n\n**ALWAYS** follow the XML-structured format from `output-style/template-debug-output.md`:\n\n```xml\n<debug_report>\n<error_analysis>\n[Error classification and details]\n</error_analysis>\n\n<root_cause>\n[Root cause with documentation references]\n</root_cause>\n\n<solution>\n[Step-by-step fix instructions]\n</solution>\n\n<fixed_json>\n[Complete valid JSON ready for copy-paste]\n</fixed_json>\n\n<alternative_approaches>\n[Other viable solutions if applicable]\n</alternative_approaches>\n\n<prevention>\n[Best practices and monitoring]\n</prevention>\n</debug_report>\n```\n\n## Critical Requirements\n\n### Documentation-First Approach\n\n**NEVER hallucinate or guess**. Always:\n1. Use Task tool with Explore agent to research Docs/{Platform}_Documentation/\n2. Reference specific files and sections\n3. Quote exact limitations from documentation\n4. Verify solutions against documented constraints\n5. Adapt to platform-specific requirements and syntax\n\n### Complete JSON Output\n\n**NEVER output partial or placeholder JSON**. Always:\n1. Use Task tool with flow-builder agent to generate complete JSON\n2. Include all required structure elements (platform-specific)\n3. Generate valid IDs/GUIDs as required by platform\n4. Ensure syntactic validity (balanced brackets, escaped strings)\n5. Validate against platform-specific format documentation\n6. Make JSON immediately copy-paste/import ready\n7. Follow platform naming conventions and structure\n\n### Quality Assurance\n\nBefore delivering output, verify:\n\n**Data Structure Validation** (CRITICAL - New!):\n- [ ] Completed Phase 0 (Data Structure Analysis) before creating fix\n- [ ] Analyzed all filter/query `where` clauses for data type indicators\n- [ ] Verified `item()` vs `item()?['Property']` consistency in fix\n- [ ] Checked loop `items()` usage matches actual data structure\n- [ ] Traced variable sources to understand actual data types\n- [ ] Asked user for clarification if structure was ambiguous\n- [ ] No assumptions made about object properties without verification\n- [ ] Fix validates against actual data flow (not just syntax)\n\n**Research & Documentation**:\n- [ ] Platform identified correctly\n- [ ] Research agent consulted Docs/{Platform}_Documentation/\n- [ ] Searched web if local docs insufficient (cited sources)\n- [ ] Root cause references actual documentation files\n- [ ] All claims backed by documentation (local or web)\n\n**Technical Validation**:\n- [ ] Flow-builder agent generated complete JSON\n- [ ] JSON follows platform-specific format\n- [ ] JSON is syntactically valid (no placeholders)\n- [ ] All expressions syntactically correct\n- [ ] Data type handling matches actual structures (primitives vs objects)\n- [ ] Platform-specific syntax and conventions followed\n\n**Output Quality**:\n- [ ] All sections of debug report template populated\n- [ ] Changes explained clearly with WHY (not just WHAT)\n- [ ] Solution is actionable and specific\n- [ ] Alternative approaches provided if applicable\n- [ ] Prevention tips included to avoid future similar errors\n\n## Error Pattern Knowledge Base\n\n### Common Error Types\n\n1. **Authentication (401/403)**\n   - Research: Docs/{Platform}_Documentation/{Connector}/overview.md → Authentication section\n   - Check: Permission requirements, connection credentials\n   - Fix: Proper authentication configuration, permission grants\n\n2. **Throttling (429)**\n   - Research: Docs/{Platform}_Documentation/{Connector}/overview.md → API Limits section\n   - Check: Call frequency, batch operations\n   - Fix: Add delays, implement exponential backoff, use batch operations\n\n3. **Data Format**\n   - Research: Docs/{Platform}_Documentation/BuiltIn/data-operation.md\n   - Check: Schema requirements, data types, required fields\n   - Fix: Proper Parse JSON schema, type conversions\n\n4. **Timeout**\n   - Research: Docs/{Platform}_Documentation/{Connector}/overview.md → Known Limitations\n   - Check: File sizes, operation duration, Do until loops\n   - Fix: Implement chunking, set proper timeouts, optimize queries\n\n5. **Not Found (404)**\n   - Research: Docs/{Platform}_Documentation/{Connector}/actions.md\n   - Check: Resource paths, IDs, permissions, resource existence\n   - Fix: Validate paths, check permissions, add existence checks\n\n## Sub-Agent Coordination\n\n### Research Agent (Explore)\n\n**Purpose**: Find relevant documentation and constraints\n\n**Input Requirements**:\n- Error type\n- Connector name\n- Action/trigger name\n\n**Expected Output**:\n- File paths: `Docs/{Platform}_Documentation/{Connector}/overview.md`\n- Specific sections: \"Known Limitations\", \"API Limits\", etc.\n- Exact constraints: \"Max 50MB file size\", \"600 calls per 60 seconds\"\n\n**Invocation**:\n```\nTask tool, subagent_type=\"Explore\", thoroughness=\"very thorough\"\n```\n\n### Flow-Builder Agent\n\n**Purpose**: Generate complete, valid Power Automate JSON\n\n**Input Requirements**:\n- Original error details\n- Root cause analysis\n- Specific fixes needed\n- Documentation constraints\n\n**Expected Output**:\n- Complete JSON structure\n- Valid GUIDs\n- Proper runAfter chains\n- No placeholders or TODOs\n\n**Invocation**:\n```\nTask tool, subagent_type=\"general-purpose\" or \"Plan\"\n```\n\n## Examples\n\n### Example 1: Data Structure Bug (Real Case Study - NEW!)\n\n**User Input**: \"Fix the DossierPlusRécent variable - the filter works but loop assignment fails\"\n\n**Error Flow Snippet**:\n```json\n{\n  \"Filtrer_dossier_CNESST\": {\n    \"type\": \"Query\",\n    \"inputs\": {\n      \"from\": \"@variables('ListeDesDossier')\",\n      \"where\": \"@contains(toLower(item()), 'cnesst')\"  // ← KEY: item() without property!\n    }\n  },\n  \"LoopCNESST\": {\n    \"foreach\": \"@body('Filtrer_dossier_CNESST')\",\n    \"actions\": {\n      \"DossierPlusRécent_CNESST\": {\n        \"type\": \"SetVariable\",\n        \"inputs\": {\n          \"name\": \"DossierPlusRecent\",\n          \"value\": \"@items('LoopCNESST')?['Nom']\"  // ← BUG: Accessing property on string!\n        }\n      },\n      \"DEBUG_jour_CNESST\": {\n        \"type\": \"Compose\",\n        \"inputs\": \"@int(substring(\n          split(items('LoopCNESST')?['Nom'], '.')[0],  // ← BUG: Also accessing Nom\n          8, 2))\"\n      }\n    }\n  }\n}\n```\n\n**Debugging Workflow**:\n\n1. **Phase 0 - Data Structure Analysis**:\n   - ✅ Examined filter: `\"where\": \"@contains(toLower(item()), 'cnesst')\"`\n   - ✅ **CRITICAL INSIGHT**: `item()` without property → Array of **strings**!\n   - ✅ Not `item()?['Nom']` → So NOT array of objects\n   - ✅ **Conclusion**: `ListeDesDossier` = `[\"CNESST 2025-01-15\", \"CNESST 2025-02-20\"]`\n\n2. **Phase 1 - Error Analysis**:\n   - Loop iterates over strings from filter\n   - But tries to access: `items('LoopCNESST')?['Nom']`\n   - **ERROR**: Can't access property 'Nom' on string primitive!\n   - Same bug in DEBUG_jour_CNESST action\n\n3. **Phase 2 - Research** (Skipped - structure analysis sufficient):\n   - Data structure analysis revealed the issue\n   - No need for documentation research for this bug type\n\n4. **Phase 3 - Solution Design**:\n   - Remove `?['Nom']` property access throughout\n   - Access string directly: `@items('LoopCNESST')`\n   - Update all actions that incorrectly access 'Nom' property\n\n5. **Phase 4 - Generate Fix**:\n```json\n{\n  \"DossierPlusRécent_CNESST\": {\n    \"type\": \"SetVariable\",\n    \"inputs\": {\n      \"name\": \"DossierPlusRecent\",\n      \"value\": \"@items('LoopCNESST')\"  // ← FIXED: Direct string access\n    }\n  },\n  \"DEBUG_jour_CNESST\": {\n    \"type\": \"Compose\",\n    \"inputs\": \"@int(substring(\n      split(items('LoopCNESST'), '.')[0],  // ← FIXED: Removed ?['Nom']\n      8, 2))\"\n  }\n}\n```\n\n**Key Lessons**:\n- ✅ **ALWAYS check filter syntax first**: `item()` reveals data type\n- ✅ `item()` = primitives, `item()?['Prop']` = objects\n- ✅ Complete Phase 0 before jumping to solutions\n- ✅ Trace data flow from source through transformations\n- ❌ **NEVER assume** objects with properties without verification\n\n**Prevention**:\n- Use consistent data structures throughout flow\n- If you need object properties, use Select action to create them\n- Add comments explaining data structure at key points\n- Validate filter patterns match loop usage\n\n---\n\n### Example 2: SharePoint Throttling Error\n\n**Input**:\n```json\n{\n  \"error\": \"Status code: 429, TooManyRequests\",\n  \"action\": \"sharepointonline_getitems\",\n  \"connector\": \"SharePoint\"\n}\n```\n\n**Workflow**:\n1. Classify: Throttling error\n2. Research: Launch Explore agent → Docs/{Platform}_Documentation/SharePoint/overview.md\n3. Find: \"600 API calls per 60 seconds per connection\"\n4. Design: Add delays between calls, implement paging\n5. Build: Launch flow-builder agent → Generate complete JSON with delays\n6. Output: Structured debug report with fixed JSON\n\n### Example 2: OneDrive File Size Error\n\n**Input**:\n```json\n{\n  \"error\": \"File not processed\",\n  \"trigger\": \"onedrive_whenfilecreated\",\n  \"connector\": \"OneDrive\"\n}\n```\n\n**Workflow**:\n1. Classify: File processing error\n2. Research: Launch Explore agent → Docs/{Platform}_Documentation/OneDrive/overview.md\n3. Find: \"Files over 50MB skipped by triggers\"\n4. Design: Add file size check, alternative large file handling\n5. Build: Launch flow-builder agent → Generate JSON with size validation\n6. Output: Structured debug report with fixed JSON\n\n## Supporting Files\n\nSee also:\n- [Output Template](../../../output-style/template-debug-output.md) - Complete output format specification\n- [Power Automate JSON Format](../../../Docs/{Platform}_Documentation/power-automate-json-format.md) - Valid JSON structure requirements\n- [Repository Guide](../../../CLAUDE.md) - Full repository documentation and patterns\n\n## Best Practices\n\n1. **Always use sub-agents** - Never skip research or flow-builder phases\n2. **Reference real documentation** - Every claim must cite Docs/{Platform}_Documentation/\n3. **Output complete JSON** - No placeholders, no TODOs, production-ready\n4. **Explain changes** - User must understand WHY each fix is needed\n5. **Include error handling** - Every fix should have proper error handling\n6. **Validate thoroughly** - Check JSON syntax, structure, and compliance\n7. **Be specific** - Name exact parameters, values, file paths\n8. **Provide alternatives** - Offer multiple approaches when applicable\n\n## Skill Invocation Examples\n\nUser messages that trigger this skill:\n\n- \"Debug this error.json file\"\n- \"I'm getting a 429 error in my SharePoint flow, here's the JSON: {...}\"\n- \"Fix this Power Automate error: [error message]\"\n- \"My OneDrive trigger isn't working, here's the error JSON\"\n- \"Analyze this flow failure: [JSON content]\"\n- \"Help me fix this authentication error in Power Automate\"\n- \"My workflow is broken, here's the error file\"\n- \"Debug my failing automation, error attached\"\n- \"This n8n workflow keeps erroring out\"\n\n---\n\n**Version**: 2.0\n**Last Updated**: 2025-10-31\n**Platforms**: Power Automate, n8n, Make, Zapier + extensible\n\n## Changelog\n\n### Version 2.0 (2025-10-31)\n\n**Major Improvements**:\n- ✅ Added **Phase 0: Data Structure Analysis** (CRITICAL) - Prevents incorrect fixes based on wrong data type assumptions\n- ✅ Added **Multi-Source Research Strategy** - Local docs → Web → Ask user (never guess!)\n- ✅ Added **Common Pitfalls section** - Highlights critical debugging errors to avoid\n- ✅ Added **Real Case Study example** - Data structure bug from actual debugging session\n- ✅ Enhanced **Quality Assurance Checklist** - Now includes comprehensive data structure validation\n- ✅ Added **AskUserQuestion workflow** - Clarify ambiguous structures before creating fixes\n- ✅ Added **WebSearch integration** - Fallback when local docs don't have the answer\n\n**Key Changes**:\n- Never assume array structures (strings vs objects) without verification\n- Always analyze `item()` vs `item()?['Property']` patterns in filters/queries\n- Ask user when uncertain rather than guessing and potentially creating bugs\n- Search web for official documentation if local docs are insufficient\n- Validate data type consistency throughout flow before generating fixes\n- Trace data sources back to understand actual structures\n\n**Lessons Learned from Real Bugs**:\n- Mismatched data structure assumptions are the #1 source of incorrect debugging fixes\n- Filter syntax is the most reliable indicator: `contains(item(), 'x')` = array of primitives\n- Property access on primitives (`items('Loop')?['Prop']` on strings) causes runtime errors\n- Always complete Phase 0 before jumping to solutions\n- User confirmation beats confident but wrong assumptions"
              },
              {
                "name": "automation-quick-fix",
                "description": "Fast automation platform error resolver for Power Automate, n8n, Make, Zapier and other platforms. Handles common patterns like 401/403 auth errors, 429 throttling, and data format issues. Provides immediate fixes without deep research for well-known error patterns. Use when error matches common scenarios (status codes 401, 403, 404, 429, timeout, parse JSON failures). For complex or unknown errors, defer to automation-debugger skill. When the user outputs some code/json snippets and ask for a quick fix, this skill will provide immediate solutions.",
                "path": ".claude/skills/automation-quick-fix/SKILL.md",
                "frontmatter": {
                  "name": "automation-quick-fix",
                  "description": "Fast automation platform error resolver for Power Automate, n8n, Make, Zapier and other platforms. Handles common patterns like 401/403 auth errors, 429 throttling, and data format issues. Provides immediate fixes without deep research for well-known error patterns. Use when error matches common scenarios (status codes 401, 403, 404, 429, timeout, parse JSON failures). For complex or unknown errors, defer to automation-debugger skill. When the user outputs some code/json snippets and ask for a quick fix, this skill will provide immediate solutions."
                },
                "content": "# Automation Quick Fix\n\nFast-track resolver for common automation workflow error patterns across multiple platforms with immediate, proven solutions.\n\n## Supported Platforms\n\n- **Power Automate** (Microsoft)\n- **n8n** (Open-source)\n- **Make** (formerly Integromat)\n- **Zapier**\n- **Other JSON-based workflow platforms**\n\n## Purpose\n\nProvides rapid fixes for frequently encountered automation workflow errors across all platforms:\n- Authentication errors (401/403)\n- Throttling errors (429)\n- Data format issues (JSON parsing, data transformation)\n- Timeout errors\n- Not found errors (404)\n- Basic expression/formula errors\n\n**When to use this skill**: Error matches a well-known pattern\n**When to use automation-debugger instead**: Unknown error, complex scenario, or quick fix doesn't resolve\n\n## Activation Triggers\n\nActivates for messages like:\n- \"Quick fix for 429 error in SharePoint/API/webhook\"\n- \"Fast solution for authentication error in n8n\"\n- \"I'm getting throttled in Make, need immediate fix\"\n- \"Parse JSON is failing in Zapier, quick help\"\n- \"Function expects one parameter but was invoked with 2\"\n- \"Unable to process template language expressions\"\n- \"Fix this expression/filter/query/condition\"\n- User provides code snippet and asks for \"quick fix\" or \"fix this\"\n- Status codes: 401, 403, 404, 429 with platform/connector context\n- Platform-specific: \"n8n node error\", \"Make scenario failing\", \"Power Automate action issue\"\n\n## ⚠️ IMPORTANT: Data Structure Check (NEW!)\n\n**Before applying any quick fix**, quickly verify data structures in your flow:\n\n### Quick Data Type Check\n```javascript\n// In filters/queries, check the where clause:\n\n// Array of STRINGS (primitives):\n\"where\": \"@contains(item(), 'text')\"  // ← item() without property\n\n// Array of OBJECTS:\n\"where\": \"@contains(item()?['Name'], 'text')\"  // ← item()?['Property']\n```\n\n**If your flow has data structure mismatches** (filter uses `item()` but loop uses `items('Loop')?['Property']`), this is NOT a quick fix scenario → use **automation-debugger** instead.\n\n**Quick Fix applies to**: Authentication, throttling, timeouts, parse JSON, NOT structural bugs.\n\n---\n\n## Quick Fix Patterns\n\n### Data Structure Mismatch (Quick Check - NEW!)\n\n**Pattern Recognition**:\n- Error: \"Cannot evaluate property on undefined/null\"\n- Loop accessing `items('Loop')?['Property']` but source is array of strings\n\n**Quick Diagnosis**:\n```javascript\n// Check your filter:\n\"where\": \"@contains(item(), 'value')\"  // ← This means array of STRINGS!\n\n// But loop tries:\n\"value\": \"@items('Loop')?['PropertyName']\"  // ← ERROR: Can't access property on string!\n```\n\n**Quick Decision**:\n- ❌ **NOT a quick fix** → Use **automation-debugger skill**\n- This requires analyzing full data flow and structure\n- Quick fix = known patterns; structural bugs = deep debugging\n\n---\n\n### Authentication Errors (401/403)\n\n**Pattern Recognition**:\n- Status: 401 or 403\n- Keywords: \"unauthorized\", \"forbidden\", \"access denied\"\n\n**Immediate Fix**:\n\n```json\n{\n  \"actions\": {\n    \"Scope_With_Auth_Handling\": {\n      \"type\": \"Scope\",\n      \"actions\": {\n        \"Your_Action\": {\n          \"type\": \"ApiConnection\",\n          \"inputs\": { /* your config */ },\n          \"authentication\": {\n            \"type\": \"Raw\",\n            \"value\": \"@parameters('$connections')['shared_sharepointonline']['connectionId']\"\n          }\n        }\n      }\n    },\n    \"Catch_Auth_Error\": {\n      \"type\": \"Terminate\",\n      \"inputs\": {\n        \"runStatus\": \"Failed\",\n        \"runError\": {\n          \"code\": \"AuthenticationFailed\",\n          \"message\": \"Please re-authenticate the connection in Power Automate\"\n        }\n      },\n      \"runAfter\": {\n        \"Scope_With_Auth_Handling\": [\"Failed\"]\n      }\n    }\n  }\n}\n```\n\n**Instructions**:\n1. Copy the Scope structure above\n2. Replace \"Your_Action\" with your failing action\n3. Update connection name if not SharePoint\n4. Save and re-authenticate connection in Power Automate UI\n\n---\n\n### Throttling Errors (429)\n\n**Pattern Recognition**:\n- Status: 429\n- Keywords: \"TooManyRequests\", \"throttled\", \"rate limit\"\n\n**Immediate Fix - SharePoint/OneDrive**:\n\n```json\n{\n  \"actions\": {\n    \"Apply_to_each_FIXED\": {\n      \"type\": \"Foreach\",\n      \"foreach\": \"@body('Get_items')?['value']\",\n      \"runtimeConfiguration\": {\n        \"concurrency\": {\n          \"repetitions\": 1\n        }\n      },\n      \"actions\": {\n        \"Your_API_Action\": {\n          \"type\": \"ApiConnection\",\n          \"inputs\": { /* your config */ },\n          \"runAfter\": {}\n        },\n        \"Delay_1_Second\": {\n          \"type\": \"Wait\",\n          \"inputs\": {\n            \"interval\": {\n              \"count\": 1,\n              \"unit\": \"Second\"\n            }\n          },\n          \"runAfter\": {\n            \"Your_API_Action\": [\"Succeeded\"]\n          }\n        }\n      }\n    }\n  }\n}\n```\n\n**Instructions**:\n1. Find your Apply to each loop\n2. Add `runtimeConfiguration.concurrency.repetitions: 1`\n3. Add Delay action after API calls (1 second for SharePoint, 3 seconds for OneDrive)\n4. Save and test\n\n**Quick calculation**:\n- SharePoint limit: 600/minute → 1-second delay = 60/minute (safe)\n- OneDrive limit: 100/minute → 3-second delay = 20/minute (safe)\n\n---\n\n### Parse JSON Failures\n\n**Pattern Recognition**:\n- Error: \"InvalidTemplate\", \"cannot be evaluated\"\n- Keywords: \"Parse JSON\", \"dynamic content\", \"schema\"\n\n**Immediate Fix**:\n\n```json\n{\n  \"actions\": {\n    \"Parse_JSON_FIXED\": {\n      \"type\": \"ParseJson\",\n      \"inputs\": {\n        \"content\": \"@body('HTTP')\",\n        \"schema\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"id\": {\"type\": \"string\"},\n            \"name\": {\"type\": \"string\"},\n            \"value\": {\"type\": [\"string\", \"null\"]}\n          }\n        }\n      }\n    },\n    \"Safe_Access_Property\": {\n      \"type\": \"Compose\",\n      \"inputs\": \"@coalesce(body('Parse_JSON_FIXED')?['value'], 'default')\",\n      \"runAfter\": {\n        \"Parse_JSON_FIXED\": [\"Succeeded\"]\n      }\n    }\n  }\n}\n```\n\n**Instructions**:\n1. Add Parse JSON action with proper schema\n2. Use `?['property']` for safe navigation (optional chaining)\n3. Use `coalesce()` for default values with null properties\n4. Test with sample payload first\n\n**Schema generation tip**:\n- Copy sample JSON response\n- Use \"Generate from sample\" in Parse JSON action\n- Add `\"null\"` to type array for optional fields: `{\"type\": [\"string\", \"null\"]}`\n\n---\n\n### Timeout Errors\n\n**Pattern Recognition**:\n- Error: \"timeout\", \"timed out\"\n- Context: Large files, long operations, Do until loops\n\n**Immediate Fix - Do Until**:\n\n```json\n{\n  \"actions\": {\n    \"Do_until_FIXED\": {\n      \"type\": \"Until\",\n      \"expression\": \"@equals(variables('Complete'), true)\",\n      \"limit\": {\n        \"count\": 60,\n        \"timeout\": \"PT1H\"\n      },\n      \"actions\": {\n        \"Your_Action\": {\n          \"type\": \"Compose\",\n          \"inputs\": \"@variables('Data')\"\n        },\n        \"Check_Complete\": {\n          \"type\": \"SetVariable\",\n          \"inputs\": {\n            \"name\": \"Complete\",\n            \"value\": \"@greater(length(variables('Data')), 0)\"\n          },\n          \"runAfter\": {\n            \"Your_Action\": [\"Succeeded\"]\n          }\n        }\n      }\n    }\n  }\n}\n```\n\n**Instructions**:\n1. Always set `limit.count` and `limit.timeout` in Do until\n2. Recommended: count=60, timeout=\"PT1H\" (1 hour)\n3. Add exit condition that WILL eventually be true\n4. Test with smaller iterations first\n\n**Immediate Fix - Large Files**:\n\n```json\n{\n  \"actions\": {\n    \"Check_File_Size_FIXED\": {\n      \"type\": \"If\",\n      \"expression\": {\n        \"and\": [{\n          \"lessOrEquals\": [\n            \"@triggerBody()?['Size']\",\n            50000000\n          ]\n        }]\n      },\n      \"actions\": {\n        \"Process_Normal_File\": {\n          \"type\": \"ApiConnection\",\n          \"inputs\": { /* your file action */ }\n        }\n      },\n      \"else\": {\n        \"actions\": {\n          \"Log_Large_File\": {\n            \"type\": \"Compose\",\n            \"inputs\": \"File over 50MB - skipping\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\n**Instructions**:\n1. Add file size check before processing\n2. OneDrive: 50MB limit (50000000 bytes)\n3. SharePoint attachments: 90MB limit (94371840 bytes)\n4. Alternative: Use different API for large files\n\n---\n\n### Not Found Errors (404)\n\n**Pattern Recognition**:\n- Status: 404\n- Keywords: \"not found\", \"does not exist\"\n\n**Immediate Fix**:\n\n```json\n{\n  \"actions\": {\n    \"Try_Get_Item\": {\n      \"type\": \"Scope\",\n      \"actions\": {\n        \"Get_Item\": {\n          \"type\": \"ApiConnection\",\n          \"inputs\": { /* your get action */ }\n        }\n      }\n    },\n    \"Handle_Not_Found\": {\n      \"type\": \"If\",\n      \"expression\": {\n        \"and\": [{\n          \"equals\": [\n            \"@result('Try_Get_Item')[0]['status']\",\n            \"Failed\"\n          ]\n        }]\n      },\n      \"runAfter\": {\n        \"Try_Get_Item\": [\"Failed\", \"Succeeded\"]\n      },\n      \"actions\": {\n        \"Create_If_Missing\": {\n          \"type\": \"ApiConnection\",\n          \"inputs\": { /* your create action */ }\n        }\n      },\n      \"else\": {\n        \"actions\": {\n          \"Use_Existing\": {\n            \"type\": \"Compose\",\n            \"inputs\": \"@body('Get_Item')\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\n**Instructions**:\n1. Wrap Get action in Scope\n2. Check result status with `result()` function\n3. Create item if not found (or handle alternative)\n4. Use dynamic IDs from previous actions (don't hardcode)\n\n---\n\n### Expression Errors\n\n**Pattern Recognition**:\n- Error: \"Unable to process template language expressions\"\n- Keywords: \"property doesn't exist\", \"invalid expression\"\n\n**Common Quick Fixes**:\n\n**Missing Property**:\n```javascript\n// BAD\n@body('Get_Item')['MissingProperty']\n\n// GOOD\n@body('Get_Item')?['MissingProperty']\n\n// BETTER (with default)\n@coalesce(body('Get_Item')?['MissingProperty'], 'default_value')\n```\n\n**Type Mismatch**:\n```javascript\n// BAD - concatenating string and number\n@concat('Value: ', variables('NumberVariable'))\n\n// GOOD\n@concat('Value: ', string(variables('NumberVariable')))\n```\n\n**Array Access**:\n```javascript\n// BAD - array might be empty\n@first(body('Get_Items')?['value'])\n\n// GOOD\n@if(greater(length(body('Get_Items')?['value']), 0), first(body('Get_Items')?['value']), null)\n```\n\n**Null Checks**:\n```javascript\n// BAD\n@variables('NullableVar')\n\n// GOOD\n@if(empty(variables('NullableVar')), 'default', variables('NullableVar'))\n```\n\n**Function Parenthesis Placement** (NEW!):\n```javascript\n// BAD - format parameter outside formatDateTime()\ntoLower(formatDateTime(outputs('Action')?['body/Date'], 'yyyy-MM'))\n//                                                     ↑\n//                              This closes formatDateTime BEFORE format string!\n\n// ERROR MESSAGE:\n// \"The template language function 'toLower' expects one parameter:\n//  the string to convert to lower casing. The function was invoked with '2' parameters.\"\n\n// GOOD - format parameter INSIDE formatDateTime()\ntoLower(formatDateTime(outputs('Action')?['body/Date'], 'yyyy-MM'))\n//                                                      ↑\n//                          Format string is now INSIDE formatDateTime()\n```\n\n**Copy-Paste Fix for Filter Query**:\n```javascript\n// Original (broken):\n@and(\n  contains(toLower(item()), 'cnesst'),\n  contains(\n    toLower(item()),\n    toLower(formatDateTime(outputs('Ajouter_une_ligne_à_un_tableau')?['body/Date d''événement CNESST']),'yyyy-MM'))\n  )\n\n// Fixed expression (ready to copy-paste into Filter Query action):\n@and(\n  contains(toLower(item()), 'cnesst'),\n  contains(\n    toLower(item()),\n    toLower(formatDateTime(outputs('Ajouter_une_ligne_à_un_tableau')?['body/Date d''événement CNESST'], 'yyyy-MM'))\n  )\n)\n```\n\n---\n\n## Quick Fix Decision Tree\n\n```\nError Code/Type\n│\n├── Data Structure Mismatch (item() vs item()?['Prop']) → ❌ Use automation-debugger (NOT quick fix)\n│\n├── 401/403 → Re-authenticate connection + Add error handling\n│\n├── 429 → Set concurrency=1 + Add delays\n│\n├── 404 → Add existence check + Handle not found case\n│\n├── Timeout → Add limits to Do until OR check file sizes\n│\n├── Parse JSON → Add schema + Use safe navigation (?[])\n│\n└── Expression Errors\n    ├── \"Function expects N parameters but was invoked with M\" → Check parenthesis placement\n    ├── Missing/null properties → Add ?[] + coalesce()\n    ├── Type mismatch → Add string(), int() conversions\n    └── Array access → Add length checks + first()/last()\n```\n\n## When Quick Fix Isn't Enough\n\nEscalate to automation-debugger skill if:\n- Quick fix doesn't resolve the error\n- Error doesn't match common patterns\n- Multiple interrelated errors\n- Complex flow logic involved\n- Need deep documentation research\n- Unclear root cause\n\n## Output Format\n\nQuick fixes provide:\n1. **Pattern identification** (which common error)\n2. **Immediate fix** (JSON snippet for actions/nodes)\n3. **Copy-paste ready expressions** (for Filter Query, Condition, Variable, etc.) - ALWAYS include the complete @{...} expression ready to copy directly into Power Automate\n4. **Instructions** (how to apply)\n5. **Validation** (how to test)\n\n**IMPORTANT**: For expression errors (Filter Query, Condition, Variable, Compose, etc.), ALWAYS provide:\n- ❌ **Original (broken)**: The full broken expression\n- ✅ **Fixed expression**: The complete corrected expression ready to copy-paste\n\n**Example output format**:\n```\nQuick Fix: Function Parenthesis Placement Error\n\nPattern: formatDateTime() format parameter placed outside function call\n\nOriginal (broken):\n@and(contains(toLower(item()), 'text'), contains(toLower(item()), toLower(formatDateTime(outputs('Action')?['body/Date']),'yyyy-MM')))\n\nFixed expression (copy-paste ready):\n@and(contains(toLower(item()), 'text'), contains(toLower(item()), toLower(formatDateTime(outputs('Action')?['body/Date'], 'yyyy-MM'))))\n\nWhat changed: Moved 'yyyy-MM' format string INSIDE formatDateTime() parentheses\n```\n\nNo need for full debug report structure - focus on speed and copy-paste ready fixes.\n\n## Best Practices\n\n1. **Test first**: Apply quick fix to copy of flow\n2. **Verify limits**: Confirm connector-specific constraints\n3. **Monitor**: Check flow run history after fix\n4. **Escalate if needed**: Use automation-debugger for persistent issues\n\n## Common Connector Limits (Quick Reference)\n\n| Connector | API Limit | Recommended Delay |\n|-----------|-----------|-------------------|\n| SharePoint | 600/60s | 1 second |\n| OneDrive | 100/60s | 3 seconds |\n| HTTP | 600/60s | 1 second |\n| Apply to each | 50 concurrent | Set to 1 for APIs |\n\n## Examples\n\n**User**: \"I'm getting throttled in SharePoint, need quick fix\"\n\n**Output**:\n```\nQuick Fix: SharePoint Throttling (429)\n\nReduce concurrency and add delays:\n\n[JSON snippet with concurrency + delay]\n\nApply these changes:\n1. Set concurrency to 1\n2. Add 1-second delay\n3. Save and test\n\nThis limits you to 60 API calls/minute (well under 600/minute limit).\n```\n\n**User**: \"Parse JSON failing with 'property doesn't exist'\"\n\n**Output**:\n```\nQuick Fix: Parse JSON Property Access\n\nUse safe navigation (?[]) and defaults:\n\n[JSON snippet with coalesce()]\n\nChanges needed:\n1. Replace ['property'] with ?['property']\n2. Add coalesce() for defaults\n3. Test with sample data\n\nThis handles null/missing properties gracefully.\n```\n\n**User**: \"Getting error 'toLower expects one parameter but was invoked with 2 parameters' in my Filter Query\"\n\n**Output**:\n```\nQuick Fix: Function Parenthesis Placement Error\n\nPattern: formatDateTime() format parameter placed outside function call\n\nOriginal (broken):\n@and(\n  contains(toLower(item()), 'cnesst'),\n  contains(\n    toLower(item()),\n    toLower(formatDateTime(outputs('Ajouter_une_ligne_à_un_tableau')?['body/Date d''événement CNESST']),'yyyy-MM'))\n  )\n\nFixed expression (copy-paste ready):\n@and(\n  contains(toLower(item()), 'cnesst'),\n  contains(\n    toLower(item()),\n    toLower(formatDateTime(outputs('Ajouter_une_ligne_à_un_tableau')?['body/Date d''événement CNESST'], 'yyyy-MM'))\n  )\n)\n\nWhat changed:\n1. Moved 'yyyy-MM' format string INSIDE formatDateTime() parentheses (before the closing parenthesis)\n2. The format parameter is now the second parameter of formatDateTime(), not a second parameter to toLower()\n\nHow to apply:\n1. Open your Filter Query action in Power Automate\n2. Delete the current expression\n3. Paste the fixed expression above\n4. Save and test with your data\n```\n\n---\n\n## Integration with Other Skills\n\n- **Quick fix succeeds** → Done!\n- **Quick fix fails** → Automatically suggest automation-debugger\n- **Unknown error** → Immediately defer to automation-debugger\n\nThis skill optimizes for speed on common patterns while maintaining quality through specialized skill delegation when needed.\n\n---\n\n**Version**: 1.2\n**Last Updated**: 2025-10-31\n\n## Changelog\n\n### Version 1.2 (2025-10-31)\n\n**Major Enhancements**:\n- ✅ Added **Function Parenthesis Placement Error** pattern to Expression Errors\n- ✅ Enhanced **Output Format** to emphasize copy-paste ready expressions for all expression types\n- ✅ Updated **Activation Triggers** to include expression error patterns\n- ✅ Expanded **Decision Tree** with detailed expression error breakdown\n- ✅ Added **complete example** showing function parenthesis error fix\n\n**Key Additions**:\n- Function parameter placement detection (e.g., `toLower(formatDateTime(...), 'format')` → error)\n- Copy-paste ready expression format with ❌ broken / ✅ fixed sections\n- Direct support for Filter Query, Condition, Variable, Compose expression fixes\n- Clear before/after comparison showing exactly what changed\n\n**New Triggers**:\n- \"Function expects one parameter but was invoked with 2\"\n- \"Unable to process template language expressions\"\n- \"Fix this expression/filter/query/condition\"\n- User provides code snippet and asks for \"quick fix\"\n\n**Output Philosophy**:\n- Always provide complete, ready-to-paste expressions\n- Show original (broken) and fixed versions side-by-side\n- Explain exactly what changed and why\n- Include step-by-step application instructions\n\n### Version 1.1 (2025-10-31)\n\n**Minor Improvements**:\n- ✅ Added **Data Structure Check section** - Quick validation before applying fixes\n- ✅ Added **Data Structure Mismatch pattern** - Recognizes when NOT to quick fix\n- ✅ Updated **Decision Tree** - Now includes structural bug detection\n- ✅ Clarified escalation to **automation-debugger** for structural issues\n\n**Key Additions**:\n- Quick data type check: `item()` vs `item()?['Property']` indicator\n- Clear guidance on when quick fix is inappropriate\n- Structural bugs (string vs object mismatch) → Use automation-debugger\n\n**Philosophy**:\n- Quick fixes are for **known, simple patterns**\n- Data structure bugs require **deep analysis** → Not quick fix territory\n- Fast triage: Recognize when to escalate immediately"
              },
              {
                "name": "automation-refactor",
                "description": "Expert automation workflow refactoring tool for Power Automate, n8n, Make, Zapier and other platforms. Optimizes existing flows by improving performance, reliability, maintainability, and best practices compliance. Triggers when user wants to improve, optimize, refactor, correct values, enhance, or modernize workflows. Analyzes JSON, suggests improvements, outputs refactored flow maintaining original functionality unless changes requested.",
                "path": ".claude/skills/automation-refactor/SKILL.md",
                "frontmatter": {
                  "name": "automation-refactor",
                  "description": "Expert automation workflow refactoring tool for Power Automate, n8n, Make, Zapier and other platforms. Optimizes existing flows by improving performance, reliability, maintainability, and best practices compliance. Triggers when user wants to improve, optimize, refactor, correct values, enhance, or modernize workflows. Analyzes JSON, suggests improvements, outputs refactored flow maintaining original functionality unless changes requested."
                },
                "content": "# Automation Refactor\n\nExpert system for refactoring and optimizing automation workflows across multiple platforms while maintaining functional equivalence and improving code quality.\n\n## Supported Platforms\n\n- **Power Automate** (Microsoft)\n- **n8n** (Open-source automation)\n- **Make** (formerly Integromat)\n- **Zapier**\n- **Other JSON-based workflow platforms**\n\n## Purpose\n\nThis skill provides comprehensive workflow refactoring by:\n1. Analyzing existing workflow JSON for improvement opportunities\n2. Applying platform-specific best practices from documentation (Docs/ directory)\n3. Optimizing performance, reliability, and maintainability\n4. Generating refactored JSON that maintains original functionality\n5. Providing detailed report of changes and additional optimization suggestions\n6. Ensuring no hallucinations by strictly referencing platform documentation\n\n## Common Pitfalls to AVOID\n\n### ❌ CRITICAL ERROR #1: Assuming Data Structures (Most Common!)\n\n**The Mistake**:\n```json\n// You see a variable used in a filter\n\"where\": \"@contains(item(), 'keyword')\"\n\n// And you ASSUME it's an array of objects, so you write:\n\"value\": \"@items('Loop')?['PropertyName']\"  // ← WRONG!\n```\n\n**The Reality**:\n```json\n// item() without property → Array of STRINGS!\n// Correct usage:\n\"value\": \"@items('Loop')\"  // ← RIGHT!\n```\n\n**How to Avoid**:\n1. **ALWAYS look at the filter's `where` clause first**\n2. `item()` = array of primitives (strings/numbers)\n3. `item()?['Prop']` = array of objects\n4. **Ask user if unsure** - never guess!\n\n---\n\n### ❌ ERROR #2: Not Researching Documentation\n\n**The Mistake**: Guessing connector outputs, property names, or behaviors\n\n**How to Avoid**:\n1. Search local Docs/ directory FIRST\n2. Use WebSearch for official docs if not found locally\n3. Ask user to confirm if documentation is unclear\n4. Reference specific documentation sections in your output\n\n---\n\n### ❌ ERROR #3: Overconfidence Without Validation\n\n**The Mistake**: Providing fixes without verifying against actual data structures\n\n**How to Avoid**:\n1. Complete Phase 0 (Data Structure Analysis) BEFORE any changes\n2. Use AskUserQuestion tool when ambiguous\n3. Test your logic against the actual data flow\n4. Verify all `item()` / `items()` usages match data types\n\n---\n\n## When This Skill Activates\n\nAutomatically activates when user requests:\n- **Optimization keywords**: \"optimize\", \"improve\", \"enhance\", \"refactor\", \"modernize\"\n- **Correction keywords**: \"correct\", \"fix values\", \"update parameters\", \"change configuration\"\n- **Performance keywords**: \"make faster\", \"reduce API calls\", \"improve performance\"\n- **Best practices**: \"apply best practices\", \"follow standards\", \"clean up\"\n- **Maintenance**: \"simplify\", \"make more readable\", \"reduce complexity\"\n- **Provides flow JSON**: User shares workflow JSON asking for improvements\n- **Platform-specific**: \"refactor my Power Automate flow\", \"optimize this n8n workflow\", \"improve Make scenario\"\n\n**Examples of triggering phrases**:\n- \"Optimize this flow to reduce API calls\"\n- \"Refactor this workflow to follow best practices\"\n- \"Improve the error handling in this flow\"\n- \"Make this automation more reliable\"\n- \"Correct the values in this flow\"\n- \"Enhance this workflow's performance\"\n- \"Simplify this complex flow\"\n- \"Modernize this old workflow\"\n\n## Core Workflow\n\n### Phase 0: Data Structure Analysis (CRITICAL)\n\n**NEVER assume data structures without verification**. Before any refactoring, ALWAYS analyze the actual data structures in the flow.\n\n1. **Examine Variable Declarations**\n   - Check all variable initializations to understand data types\n   - Look for: `\"type\": \"Array\"`, `\"type\": \"String\"`, `\"type\": \"Object\"`\n   - Document the structure of each variable\n\n2. **Analyze Filter/Query Operations**\n   - **CRITICAL CHECK**: Look at `where` clauses in Query actions\n   - If you see `item()` without property access → **Array of primitives (strings/numbers)**\n     ```json\n     \"where\": \"@contains(toLower(item()), 'keyword')\"\n     // ↑ This means: Array of strings, NOT array of objects!\n     ```\n   - If you see `item()?['PropertyName']` → **Array of objects**\n     ```json\n     \"where\": \"@contains(item()?['Name'], 'keyword')\"\n     // ↑ This means: Array of objects with 'Name' property\n     ```\n\n3. **Trace Data Sources**\n   - Follow `from` parameter in Query actions back to source\n   - Check SharePoint GetFileItems/GetItems outputs\n   - Check Select action mappings (these define output structure)\n   - Verify Compose action inputs\n\n4. **Validate Item Access Patterns**\n   - In loops: `items('LoopName')` vs `items('LoopName')?['Property']`\n   - In filters: `item()` vs `item()?['Property']`\n   - **MISMATCH = BUG**: If filter uses `item()` but loop uses `items('Loop')?['Prop']` → ERROR!\n\n5. **Ask User When Uncertain** (Use AskUserQuestion tool)\n   - If data structure is ambiguous\n   - If documentation doesn't clarify the structure\n   - If multiple interpretations are possible\n\n   **Example questions to ask**:\n   - \"I see your filter uses `contains(item(), 'keyword')`. Does this mean your variable contains an array of strings like `['string1', 'string2']`, or does it contain an array of objects?\"\n   - \"Can you confirm whether the output from [ActionName] is an array of strings or an array of objects with properties?\"\n   - \"I notice a mismatch: the filter treats data as strings but the loop accesses it as objects. Which is correct?\"\n\n### Phase 1: Initial Analysis\n\n1. **Extract Flow Information**\n   - Parse the provided JSON (flow.json or workflow snippet)\n   - Identify platform (Power Automate, n8n, Make, Zapier, etc.)\n   - Map all triggers, actions, and dependencies\n   - Understand the flow's purpose and logic\n   - Note current configuration and parameters\n\n2. **Identify User Requirements**\n   - Parse user's refactoring brief/request\n   - Determine specific changes requested (if any)\n   - Identify optimization goals (performance, reliability, maintainability)\n   - Note constraints (must maintain functionality, specific requirements)\n\n3. **Baseline Documentation**\n   - Document current flow behavior\n   - List all connectors/nodes used\n   - Map data flow and transformations\n   - Note existing error handling (or lack thereof)\n\n### Phase 2: Comprehensive Analysis (Multi-Source Research)\n\n**CRITICAL**: Always research thoroughly before making changes. Use multiple sources in this order:\n\n#### Step 1: Local Documentation Research (Use Task Tool with Explore Agent)\n\nLaunch research sub-agent with thorough investigation:\n\n```\nUse Task tool with subagent_type=\"Explore\" and thoroughness=\"very thorough\"\n\nPrompt: \"Research [PLATFORM] best practices and optimization guidelines for workflow refactoring, focusing on [CONNECTORS/NODES USED].\n\nPlatform: [Power Automate / n8n / Make / Zapier / Other]\n\nSearch in Docs/ directory for:\n1. Platform best practices documentation (Docs/{Platform}_Documentation/)\n2. Connector/node-specific optimization guidelines\n3. Data structure specifications (what properties exist, array vs object)\n4. Common performance anti-patterns\n5. Error handling best practices\n6. API rate limit optimization strategies\n7. Expression/formula optimization patterns\n8. Security best practices\n\nFocus on finding:\n- **DATA STRUCTURE DETAILS** (output schemas, property names, data types)\n- Performance optimization opportunities\n- Reliability improvements (error handling, retry logic)\n- Maintainability enhancements (naming, structure, comments)\n- Security improvements (credential handling, input validation)\n- API efficiency (batching, filtering, pagination)\n- Platform-specific recommendations\n\nFor each connector/node in the flow, find:\n- Output schema/structure (CRITICAL!)\n- Recommended configuration patterns\n- Known limitations to consider\n- Optimization techniques\n- Common mistakes to avoid\n\nReturn specific file paths, sections, and exact recommendations.\"\n```\n\n**Expected Output from Research Agent**:\n- Data structure specifications (schemas, property names)\n- Best practices documentation references\n- Connector-specific optimization guidelines\n- Performance improvement patterns\n- Error handling recommendations\n- Security considerations\n- Platform-specific optimizations\n\n#### Step 2: Web Research (Use WebSearch Tool - If Local Documentation Insufficient)\n\n**ONLY if local documentation doesn't provide needed information**, use WebSearch:\n\n```\nUse WebSearch tool with targeted queries:\n\nExamples:\n- \"Power Automate GetFileItems output schema properties\"\n- \"Power Automate array of strings vs array of objects filter syntax\"\n- \"n8n HTTP Request node output structure\"\n- \"Make iterator data structure format\"\n\nSearch for:\n- Official Microsoft Learn documentation\n- Platform-specific forums (Power Users Community)\n- Official API documentation\n- Verified Stack Overflow answers (check dates!)\n```\n\n**Validation Requirements**:\n- Prefer official documentation over community posts\n- Cross-reference multiple sources\n- Verify information is current (check dates)\n- Test with user if uncertain\n\n#### Step 3: Ask User for Clarification (Use AskUserQuestion Tool)\n\n**If both local docs and web search are unclear**, ask the user:\n\n```\nUse AskUserQuestion tool with specific questions:\n\nExample:\n{\n  \"questions\": [{\n    \"question\": \"Your flow uses `contains(item(), 'CNESST')`. Can you confirm what type of data is in your variable?\",\n    \"header\": \"Data Type\",\n    \"options\": [\n      {\n        \"label\": \"Array of strings\",\n        \"description\": \"Like ['CNESST 2025-01', 'INVALIDITÉ 2025-02']\"\n      },\n      {\n        \"label\": \"Array of objects\",\n        \"description\": \"Like [{'Nom': 'CNESST 2025-01'}, {'Nom': 'INVALIDITÉ 2025-02'}]\"\n      }\n    ],\n    \"multiSelect\": false\n  }]\n}\n```\n\n**When to Ask**:\n- Data structure is ambiguous\n- Multiple valid interpretations exist\n- Documentation contradicts observed patterns\n- Risk of introducing bugs with assumptions\n\n### Phase 3: Improvement Identification\n\nBased on research findings, identify opportunities in these categories:\n\n#### 1. Performance Optimizations\n- **API call reduction**: Batch operations, filtering at source\n- **Concurrency**: Parallel execution where safe\n- **Data minimization**: Fetch only needed fields\n- **Caching**: Reuse data within flow\n- **Loop optimization**: Reduce iterations, early exits\n\n#### 2. Reliability Improvements\n- **Error handling**: Add Scopes with Configure run after\n- **Retry logic**: Implement exponential backoff for transient failures\n- **Timeout handling**: Set appropriate limits\n- **Data validation**: Check inputs before processing\n- **Idempotency**: Ensure operations can be retried safely\n\n#### 3. Maintainability Enhancements\n- **Naming conventions**: Clear, descriptive action names\n- **Comments**: Document complex logic\n- **Structure**: Organize related actions in Scopes\n- **Variables**: Proper initialization and naming\n- **Modularity**: Break complex flows into logical sections\n\n#### 4. Security Hardening\n- **Credential management**: Use secure connections\n- **Input validation**: Sanitize user inputs\n- **Data exposure**: Minimize sensitive data in logs\n- **Least privilege**: Use minimal required permissions\n- **Secret handling**: Never hardcode credentials\n\n#### 5. Best Practices Compliance\n- **Platform standards**: Follow official guidelines\n- **Connector patterns**: Use recommended approaches\n- **Expression optimization**: Simplify complex expressions\n- **Resource cleanup**: Ensure proper disposal\n- **Monitoring**: Add telemetry for critical operations\n\n### Phase 4: Prioritization & Change Planning\n\n1. **Categorize Improvements**\n   - **Critical**: Must fix (security, reliability issues)\n   - **High impact**: Significant performance/reliability gains\n   - **Medium impact**: Moderate improvements\n   - **Low impact**: Nice-to-have enhancements\n\n2. **User Request Alignment**\n   - Prioritize changes explicitly requested by user\n   - Ensure requested changes are safe and valid\n   - Propose alternatives if request conflicts with best practices\n\n3. **Functional Equivalence Check**\n   - Verify refactoring maintains original behavior\n   - Document any intentional behavior changes\n   - Ensure data transformations remain identical\n   - Validate output compatibility\n\n4. **Create Change Plan**\n   - List all improvements to implement\n   - Note improvements identified but not implemented (for suggestions)\n   - Explain rationale for each change\n   - Reference documentation sources\n\n### Phase 5: Refactored JSON Generation (Use Task Tool with Flow-Builder Agent)\n\n**CRITICAL**: Use the Task tool to launch a flow-builder agent for JSON generation.\n\nLaunch flow-builder sub-agent:\n\n```\nUse Task tool with subagent_type=\"general-purpose\"\n\nPrompt: \"Generate complete refactored workflow JSON for [PLATFORM] with the following requirements:\n\nPlatform: [Power Automate / n8n / Make / Zapier / Other]\nOriginal Flow: [ORIGINAL_JSON]\nUser Requirements: [USER_REFACTORING_REQUEST]\nBest Practices Found: [RESEARCH_FINDINGS]\nImprovements to Implement: [CHANGE_PLAN]\n\nCreate a complete, valid workflow JSON that:\n1. Maintains 100% functional equivalence to original (unless user requested changes)\n2. Implements all high-priority improvements\n3. Adds comprehensive error handling (platform-specific)\n4. Optimizes for performance (batching, filtering, concurrency)\n5. Follows platform best practices from documentation\n6. Includes clear, descriptive action names\n7. Adds comments explaining complex logic\n8. Uses valid IDs/GUIDs as required by platform\n9. Has correct dependencies/execution order\n10. Is ready for copy-paste into platform's import/code feature\n11. Respects API limits with appropriate delays/batching\n12. Includes proper initialization of all variables\n13. Validates inputs before processing\n14. Implements retry logic for transient failures\n\nPlatform-specific requirements:\n- Power Automate: Use Scopes for error handling, proper runAfter chains\n- n8n: Use Error Trigger nodes, proper node connections\n- Make: Use error handlers, proper routing\n- Zapier: Use error paths, filters\n\nReturn ONLY the complete JSON with no placeholders or TODOs.\"\n```\n\n**Expected Output from Flow-Builder Agent**:\n- Complete, syntactically valid JSON (platform-specific format)\n- All required structure elements for the platform\n- Proper IDs/GUIDs for all operations\n- Correct expression/formula syntax\n- Complete execution chains/dependencies\n- Comprehensive error handling\n- Performance optimizations applied\n\n### Phase 6: Validation & Quality Check\n\nBefore finalizing output:\n\n1. **Functional Validation**\n   - [ ] Original triggers maintained\n   - [ ] Original actions preserved (unless change requested)\n   - [ ] Data transformations identical\n   - [ ] Outputs remain compatible\n   - [ ] Error paths handled\n\n2. **Technical Validation**\n   - [ ] JSON syntax valid\n   - [ ] Platform-specific format correct\n   - [ ] All IDs/GUIDs unique\n   - [ ] Dependencies properly ordered\n   - [ ] Expressions syntactically correct\n\n3. **Optimization Validation**\n   - [ ] Performance improvements applied\n   - [ ] Error handling comprehensive\n   - [ ] Best practices followed\n   - [ ] Security considerations addressed\n   - [ ] Documentation references accurate\n\n4. **Platform Validation**\n   - [ ] Connector limits respected\n   - [ ] API patterns correct\n   - [ ] Authentication properly configured\n   - [ ] Platform-specific features used correctly\n\n### Phase 7: Report Generation\n\nGenerate comprehensive refactoring report:\n\n#### Report Structure\n\n```markdown\n# Workflow Refactoring Report\n\n## Summary\n- **Platform**: [Platform name]\n- **Flow Name**: [Flow identifier]\n- **Refactoring Goals**: [User's objectives]\n- **Changes Applied**: [Number of improvements implemented]\n- **Functional Impact**: [Maintained equivalence / Intentional changes]\n\n## Changes Implemented\n\n### Performance Optimizations\n- [List of performance improvements with before/after impact]\n- Example: \"Reduced API calls from 100 to 10 by implementing batch operations\"\n\n### Reliability Improvements\n- [List of reliability enhancements]\n- Example: \"Added error handling scope with retry logic for transient failures\"\n\n### Maintainability Enhancements\n- [List of code quality improvements]\n- Example: \"Renamed 15 actions for clarity, organized into logical scopes\"\n\n### Security Hardening\n- [List of security improvements]\n- Example: \"Replaced hardcoded credentials with secure connection references\"\n\n### Best Practices Applied\n- [List of platform best practices implemented]\n- Example: \"Implemented proper variable initialization per Power Automate guidelines\"\n\n## Documentation References\n\n[List of specific documentation files and sections consulted]\n- Docs/{Platform}_Documentation/{Connector}/overview.md - [Section name]\n- Docs/{Platform}_Documentation/best-practices.md - [Section name]\n\n## Additional Optimization Opportunities\n\n### High Priority (Recommended)\n- [Improvements identified but not implemented, with rationale]\n- Example: \"Consider implementing caching for frequently accessed data (requires architectural change)\"\n\n### Medium Priority\n- [Medium-impact optimizations for future consideration]\n\n### Low Priority\n- [Nice-to-have improvements]\n\n## Testing Recommendations\n\n### Functional Testing\n1. [Step-by-step testing plan to verify functional equivalence]\n2. Test with same inputs as original flow\n3. Verify outputs match expected results\n\n### Performance Testing\n1. [How to measure performance improvements]\n2. Compare run duration with original flow\n3. Monitor API call counts\n\n### Error Testing\n1. [How to verify error handling works]\n2. Test failure scenarios\n3. Verify retry logic\n\n## Migration Guide\n\n### Deployment Steps\n1. [Step-by-step instructions to deploy refactored flow]\n2. Backup original flow\n3. Import refactored JSON\n4. Update connections if needed\n5. Test thoroughly before production\n\n### Rollback Plan\n[How to revert if issues arise]\n\n## Next Steps\n\n1. Review changes and approve\n2. Test in development environment\n3. Deploy to production\n4. Monitor for first 24-48 hours\n5. Consider additional optimizations listed above\n\n---\n\n**Refactoring Completed**: [Timestamp]\n**Documentation Consulted**: [Number of docs referenced]\n**Confidence Level**: High (all changes based on official documentation)\n```\n\n## Output Format\n\n**ALWAYS** provide two deliverables:\n\n### 1. Refactored JSON File\n```json\n{\n  \"comment\": \"Refactored workflow - [Date] - Implements [key improvements]\",\n  \"definition\": {\n    // Complete, valid, platform-specific JSON\n    // Ready for copy-paste/import\n    // No placeholders or TODOs\n  }\n}\n```\n\n### 2. Refactoring Report\n- Structured markdown report as detailed above\n- Clear explanation of all changes\n- Documentation references\n- Additional suggestions\n- Testing and deployment guidance\n\n## Critical Requirements\n\n### Documentation-First Approach\n\n**NEVER hallucinate or guess**. Always:\n1. Use Task tool with Explore agent to research Docs/{Platform}_Documentation/\n2. Reference specific files and sections\n3. Quote exact best practices from documentation\n4. Verify optimizations against documented constraints\n5. Adapt to platform-specific requirements\n\n### Functional Equivalence Guarantee\n\n**NEVER change behavior unless explicitly requested**. Always:\n1. Maintain exact same triggers\n2. Preserve all actions and their logic\n3. Keep data transformations identical\n4. Ensure outputs remain compatible\n5. Document any intentional changes clearly\n\n### Complete JSON Output\n\n**NEVER output partial or placeholder JSON**. Always:\n1. Use Task tool with flow-builder agent\n2. Include all required structure elements\n3. Generate valid IDs/GUIDs\n4. Ensure syntactic validity\n5. Make JSON immediately ready for import\n6. Follow platform-specific format\n\n### Quality Assurance Checklist\n\nBefore delivering output, verify:\n\n**Data Structure Validation** (CRITICAL - New!):\n- [ ] Analyzed all filter/query `where` clauses for data type indicators\n- [ ] Verified `item()` vs `item()?['Property']` consistency throughout flow\n- [ ] Checked loop `items()` usage matches source data structure\n- [ ] Traced all variable sources to understand actual data types\n- [ ] Asked user for clarification if structure was ambiguous\n- [ ] No assumptions made about object properties without verification\n\n**Technical Validation**:\n- [ ] Platform identified correctly\n- [ ] Research agent consulted Docs/{Platform}_Documentation/\n- [ ] Searched web if local docs insufficient\n- [ ] All improvements reference documentation (local or web)\n- [ ] Flow-builder agent generated complete JSON\n- [ ] JSON follows platform-specific format\n- [ ] JSON syntax valid (no placeholders)\n- [ ] All expressions syntactically correct\n\n**Functional Validation**:\n- [ ] Functional equivalence maintained (unless changes requested)\n- [ ] Data transformations work with actual data types\n- [ ] No property access on primitive types (strings, numbers)\n- [ ] Array handling matches actual array content type\n\n**Deliverables**:\n- [ ] Report includes all required sections\n- [ ] Additional optimizations suggested\n- [ ] Testing recommendations provided\n- [ ] Deployment guidance included\n- [ ] Data structure bugs identified and fixed\n\n## Refactoring Patterns\n\n### Pattern 1: API Call Reduction\n\n**Before** (100 API calls):\n```json\n{\n  \"Apply_to_each\": {\n    \"foreach\": \"@body('Get_all_items')?['value']\",\n    \"actions\": {\n      \"Get_user_details\": {\n        \"type\": \"ApiConnection\",\n        \"inputs\": {\n          \"host\": {\"connectionName\": \"shared_office365users\"},\n          \"method\": \"get\",\n          \"path\": \"/users/@{items('Apply_to_each')?['Email']}\"\n        }\n      }\n    }\n  }\n}\n```\n\n**After** (1 API call with $expand):\n```json\n{\n  \"Get_all_items_with_users\": {\n    \"type\": \"ApiConnection\",\n    \"inputs\": {\n      \"host\": {\"connectionName\": \"shared_sharepointonline\"},\n      \"method\": \"get\",\n      \"path\": \"/datasets/@{parameters('site')}/tables/@{parameters('list')}/items\",\n      \"queries\": {\n        \"$expand\": \"Author,Editor\",\n        \"$select\": \"Id,Title,Author/DisplayName,Author/Email\"\n      }\n    }\n  }\n}\n```\n\n**Impact**: 99% API call reduction, 10x faster execution\n\n---\n\n### Pattern 2: Error Handling Addition\n\n**Before** (no error handling):\n```json\n{\n  \"Send_email\": {\n    \"type\": \"ApiConnection\",\n    \"inputs\": {\n      \"host\": {\"connectionName\": \"shared_office365\"},\n      \"method\": \"post\",\n      \"path\": \"/Mail\"\n    }\n  }\n}\n```\n\n**After** (comprehensive error handling):\n```json\n{\n  \"Try_Send_Email\": {\n    \"type\": \"Scope\",\n    \"actions\": {\n      \"Send_email\": {\n        \"type\": \"ApiConnection\",\n        \"inputs\": {\n          \"host\": {\"connectionName\": \"shared_office365\"},\n          \"method\": \"post\",\n          \"path\": \"/Mail\"\n        }\n      }\n    }\n  },\n  \"Catch_Email_Error\": {\n    \"type\": \"Scope\",\n    \"runAfter\": {\n      \"Try_Send_Email\": [\"Failed\", \"TimedOut\"]\n    },\n    \"actions\": {\n      \"Log_Error\": {\n        \"type\": \"Compose\",\n        \"inputs\": {\n          \"error\": \"@result('Try_Send_Email')\",\n          \"timestamp\": \"@utcNow()\"\n        }\n      },\n      \"Notify_Admin\": {\n        \"type\": \"ApiConnection\",\n        \"inputs\": {\n          \"host\": {\"connectionName\": \"shared_office365\"},\n          \"method\": \"post\",\n          \"path\": \"/Mail\",\n          \"body\": {\n            \"To\": \"admin@company.com\",\n            \"Subject\": \"Flow Error: Email Send Failed\",\n            \"Body\": \"@body('Log_Error')\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\n**Impact**: Failures tracked, admin notified, debugging simplified\n\n---\n\n### Pattern 3: Performance - Concurrency Optimization\n\n**Before** (sequential, slow):\n```json\n{\n  \"Apply_to_each\": {\n    \"foreach\": \"@body('Get_items')?['value']\",\n    \"actions\": {\n      \"Independent_HTTP_Call\": {\n        \"type\": \"Http\",\n        \"inputs\": {\n          \"method\": \"POST\",\n          \"uri\": \"https://api.example.com/process\",\n          \"body\": \"@item()\"\n        }\n      }\n    }\n  }\n}\n```\n\n**After** (parallel, 5x faster):\n```json\n{\n  \"Apply_to_each\": {\n    \"foreach\": \"@body('Get_items')?['value']\",\n    \"runtimeConfiguration\": {\n      \"concurrency\": {\n        \"repetitions\": 10\n      }\n    },\n    \"actions\": {\n      \"Independent_HTTP_Call\": {\n        \"type\": \"Http\",\n        \"inputs\": {\n          \"method\": \"POST\",\n          \"uri\": \"https://api.example.com/process\",\n          \"body\": \"@item()\"\n        }\n      }\n    }\n  }\n}\n```\n\n**Impact**: 5x faster for independent operations (use only when operations don't depend on each other)\n\n---\n\n### Pattern 4: Maintainability - Clear Naming\n\n**Before** (cryptic names):\n```json\n{\n  \"actions\": {\n    \"Compose\": {\n      \"type\": \"Compose\",\n      \"inputs\": \"@body('HTTP')?['data']\"\n    },\n    \"Compose_2\": {\n      \"type\": \"Compose\",\n      \"inputs\": \"@first(body('Compose'))\"\n    },\n    \"HTTP_2\": {\n      \"type\": \"Http\",\n      \"inputs\": {\n        \"uri\": \"https://api.example.com/send\",\n        \"body\": \"@body('Compose_2')\"\n      }\n    }\n  }\n}\n```\n\n**After** (descriptive names):\n```json\n{\n  \"actions\": {\n    \"Extract_User_Data_From_API_Response\": {\n      \"type\": \"Compose\",\n      \"inputs\": \"@body('Get_Users_From_External_API')?['data']\"\n    },\n    \"Get_First_Active_User\": {\n      \"type\": \"Compose\",\n      \"inputs\": \"@first(body('Extract_User_Data_From_API_Response'))\"\n    },\n    \"Send_Welcome_Email_To_User\": {\n      \"type\": \"Http\",\n      \"inputs\": {\n        \"uri\": \"https://api.example.com/send\",\n        \"body\": \"@body('Get_First_Active_User')\"\n      }\n    }\n  }\n}\n```\n\n**Impact**: Immediately understandable logic, easier maintenance\n\n---\n\n### Pattern 5: Security - Credential Hardening\n\n**Before** (insecure):\n```json\n{\n  \"HTTP_Call\": {\n    \"type\": \"Http\",\n    \"inputs\": {\n      \"uri\": \"https://api.example.com/data\",\n      \"headers\": {\n        \"Authorization\": \"Bearer sk-1234567890abcdef\"\n      }\n    }\n  }\n}\n```\n\n**After** (secure):\n```json\n{\n  \"Initialize_API_Key\": {\n    \"type\": \"InitializeVariable\",\n    \"inputs\": {\n      \"variables\": [{\n        \"name\": \"APIKey\",\n        \"type\": \"String\",\n        \"value\": \"@parameters('SecureAPIKey')\"\n      }]\n    }\n  },\n  \"HTTP_Call\": {\n    \"type\": \"Http\",\n    \"inputs\": {\n      \"uri\": \"https://api.example.com/data\",\n      \"authentication\": {\n        \"type\": \"Raw\",\n        \"value\": \"@concat('Bearer ', variables('APIKey'))\"\n      }\n    },\n    \"runAfter\": {\n      \"Initialize_API_Key\": [\"Succeeded\"]\n    }\n  }\n}\n```\n\n**Impact**: Credentials in secure parameters, not hardcoded in JSON\n\n---\n\n## Platform-Specific Considerations\n\n### Power Automate\n\n**Key Optimizations**:\n- Use `$expand` and `$select` in OData queries\n- Implement Scopes for error handling\n- Set concurrency for independent operations\n- Use \"Get items\" over \"List items\" (pagination support)\n- Filter at source with `$filter` queries\n\n**Best Practices Documentation**: `Docs/PowerAutomateDocs/`\n\n---\n\n### n8n\n\n**Key Optimizations**:\n- Use \"Split in Batches\" node for large datasets\n- Implement Error Trigger nodes\n- Enable \"Always Output Data\" for better debugging\n- Use \"HTTP Request\" node with batching\n- Leverage \"Code\" node for complex transformations\n\n**Best Practices Documentation**: `Docs/N8NDocs/`\n\n---\n\n### Make\n\n**Key Optimizations**:\n- Use filters to reduce operations\n- Implement error handlers on all routes\n- Use aggregators for batch operations\n- Set appropriate scheduling intervals\n- Use routers for conditional logic\n\n---\n\n### Zapier\n\n**Key Optimizations**:\n- Use multi-step zaps efficiently\n- Implement error paths\n- Use filters to reduce task usage\n- Leverage built-in apps over webhooks\n- Use formatter for data transformation\n\n---\n\n## Sub-Agent Coordination\n\n### Research Agent (Explore)\n\n**Purpose**: Find best practices and optimization guidelines\n\n**Input Requirements**:\n- Platform name\n- Connectors/nodes used\n- Current pain points (if known)\n\n**Expected Output**:\n- Documentation file paths\n- Specific optimization recommendations\n- Limitation warnings\n- Security considerations\n\n**Invocation**:\n```\nTask tool, subagent_type=\"Explore\", thoroughness=\"very thorough\"\n```\n\n### Flow-Builder Agent\n\n**Purpose**: Generate complete, optimized workflow JSON\n\n**Input Requirements**:\n- Original flow JSON\n- User requirements\n- Research findings\n- Change plan\n\n**Expected Output**:\n- Complete JSON structure\n- All optimizations applied\n- Valid syntax\n- No placeholders\n\n**Invocation**:\n```\nTask tool, subagent_type=\"general-purpose\"\n```\n\n## Examples\n\n### Example 1: Data Structure Bug (Real Case Study)\n\n**User**: \"Fix the DossierPlusRécent variable assignment - it's filtering on array but accessing wrong property\"\n\n**Input Flow**:\n```json\n{\n  \"Filtrer_dossier_CNESST\": {\n    \"type\": \"Query\",\n    \"inputs\": {\n      \"from\": \"@variables('ListeDesDossier')\",\n      \"where\": \"@contains(toLower(item()), 'cnesst')\"  // ← item() without property!\n    }\n  },\n  \"LoopCNESST\": {\n    \"foreach\": \"@body('Filtrer_dossier_CNESST')\",\n    \"actions\": {\n      \"DossierPlusRécent_CNESST\": {\n        \"type\": \"SetVariable\",\n        \"inputs\": {\n          \"name\": \"DossierPlusRecent\",\n          \"value\": \"@items('LoopCNESST')?['Nom']\"  // ← BUG: Accessing 'Nom' property!\n        }\n      }\n    }\n  }\n}\n```\n\n**Analysis Process**:\n1. **Phase 0 - Data Structure Analysis**:\n   - Check filter: `contains(toLower(item()), 'cnesst')` uses `item()` without property\n   - **CONCLUSION**: `ListeDesDossier` is **array of strings**, NOT array of objects!\n   - Examples: `[\"CNESST 2025-01-15\", \"CNESST 2025-02-20\", \"INVALIDITÉ 2025-01-10\"]`\n\n2. **Identify Bug**:\n   - Loop iterates over strings: `[\"CNESST 2025-01-15\", ...]`\n   - But tries to access: `items('LoopCNESST')?['Nom']` (treating string as object)\n   - **ERROR**: Can't access property on string primitive!\n\n3. **Correct Fix**:\n   ```json\n   \"DossierPlusRécent_CNESST\": {\n     \"type\": \"SetVariable\",\n     \"inputs\": {\n       \"name\": \"DossierPlusRecent\",\n       \"value\": \"@items('LoopCNESST')\"  // ← CORRECT: Direct string value\n     }\n   }\n   ```\n\n4. **Also Fix DEBUG Action**:\n   ```json\n   \"DEBUG_jour_CNESST\": {\n     \"type\": \"Compose\",\n     \"inputs\": \"@int(substring(substring(\n       if(\n         contains(split(items('LoopCNESST'), '.')[0], '_'),  // ← Remove ?['Nom']\n         last(split(split(items('LoopCNESST'), '.')[0], '_')),\n         last(split(split(items('LoopCNESST'), '.')[0], ' '))\n       ), 0, 10), 8, 2))\"\n   }\n   ```\n\n**Key Lesson**:\n- **ALWAYS check filter syntax first**: `item()` vs `item()?['Prop']` tells you the data structure\n- **NEVER assume** objects with properties without verification\n- **ASK USER** if ambiguous\n\n**Output**:\n- Corrected JSON with proper string handling\n- Explanation of the bug and why it occurred\n- Prevention tips for future\n\n---\n\n### Example 2: Performance Optimization Request\n\n**User**: \"Optimize this Power Automate flow to reduce execution time\"\n\n**Input Flow**: Flow with 100 sequential API calls\n\n**Workflow**:\n1. Analyze: Identify sequential API calls bottleneck\n2. Research: Launch Explore agent → Find batching and concurrency guidelines\n3. Plan: Replace sequential calls with batch operation + parallel processing\n4. Build: Launch flow-builder agent → Generate optimized JSON\n5. Report: Document 90% execution time reduction\n6. Suggest: Additional caching opportunities\n\n**Output**:\n- Refactored JSON with batch operations\n- Report showing before/after metrics\n- Additional optimization suggestions\n\n---\n\n### Example 2: Best Practices Application\n\n**User**: \"Refactor this flow to follow Power Automate best practices\"\n\n**Input Flow**: Working but poorly structured flow\n\n**Workflow**:\n1. Analyze: Identify deviations from best practices\n2. Research: Launch Explore agent → Find official best practices documentation\n3. Plan: Add error handling, improve naming, add comments\n4. Build: Launch flow-builder agent → Generate refactored JSON\n5. Report: Document all improvements with documentation references\n6. Suggest: Consider breaking into child flows for modularity\n\n**Output**:\n- Refactored JSON with best practices applied\n- Report listing all improvements\n- Future enhancement suggestions\n\n---\n\n### Example 3: Error Handling Enhancement\n\n**User**: \"Add comprehensive error handling to this workflow\"\n\n**Input Flow**: Flow with no error handling\n\n**Workflow**:\n1. Analyze: Map all failure points\n2. Research: Launch Explore agent → Find error handling patterns\n3. Plan: Add Scopes, Configure run after, retry logic\n4. Build: Launch flow-builder agent → Generate hardened JSON\n5. Report: Document error handling strategy\n6. Suggest: Add monitoring and alerting\n\n**Output**:\n- Refactored JSON with comprehensive error handling\n- Report explaining error handling approach\n- Monitoring recommendations\n\n---\n\n## When to Escalate\n\nUse **automation-debugger** instead if:\n- Flow has existing errors that need fixing first\n- Root cause analysis needed before refactoring\n- Complex error patterns require investigation\n\nUse **automation-validator** after refactoring to:\n- Validate refactored JSON before deployment\n- Ensure no issues introduced\n- Get pre-deployment confidence\n\n## Best Practices\n\n1. **Always preserve functionality** unless explicitly requested to change\n2. **Document every change** with rationale and documentation reference\n3. **Suggest additional improvements** beyond what was implemented\n4. **Provide testing guidance** to verify functional equivalence\n5. **Include deployment instructions** for smooth rollout\n6. **Reference documentation** for every optimization decision\n7. **Be transparent** about limitations and trade-offs\n8. **Validate thoroughly** before delivering output\n\n## Skill Invocation Examples\n\nUser messages that trigger this skill:\n\n- \"Optimize this Power Automate flow for better performance\"\n- \"Refactor this workflow to follow best practices\"\n- \"Improve the error handling in this flow.json\"\n- \"Make this automation more reliable\"\n- \"Correct the API call parameters in this flow\"\n- \"Enhance this workflow to reduce execution time\"\n- \"Simplify this complex n8n workflow\"\n- \"Modernize this old Make scenario\"\n- \"Add retry logic to this flow\"\n- \"Reduce the number of API calls in this automation\"\n- \"Make this flow more maintainable\"\n- \"Apply security best practices to this workflow\"\n\n---\n\n**Version**: 2.0\n**Last Updated**: 2025-10-31\n**Platforms**: Power Automate, n8n, Make, Zapier + extensible\n\n## Changelog\n\n### Version 2.0 (2025-10-31)\n\n**Major Improvements**:\n- ✅ Added **Phase 0: Data Structure Analysis** (CRITICAL) - Prevents hallucinations about data types\n- ✅ Added **Multi-Source Research Strategy** - Local docs → Web → Ask user\n- ✅ Added **Common Pitfalls section** - Highlights most frequent errors\n- ✅ Added **Real Case Study example** - Data structure bug from actual debugging session\n- ✅ Enhanced **Quality Assurance Checklist** - Now includes data structure validation\n- ✅ Added **AskUserQuestion workflow** - Clarify ambiguous structures proactively\n- ✅ Added **WebSearch integration** - Fallback when local docs insufficient\n\n**Key Changes**:\n- Never assume array structures (strings vs objects) without verification\n- Always check `item()` vs `item()?['Property']` patterns in filters\n- Ask user when uncertain rather than guessing\n- Search web for official documentation if local docs don't have answer\n- Validate data type consistency throughout flow before making changes\n\n**Lessons Learned**:\n- Mismatched data structure assumptions are the #1 source of refactoring bugs\n- Filter syntax reveals data types: `contains(item(), 'x')` = array of strings\n- Always trace data sources back to understand actual structures\n- User confirmation beats confident assumptions"
              },
              {
                "name": "automation-validator",
                "description": "Validates automation workflow JSON before deployment for Power Automate, n8n, Make, Zapier and other platforms. Checks syntax, structure, best practices, and potential issues. Analyzes workflow JSON files for platform compliance, missing error handling, performance issues, and security concerns. Use when user wants to validate, review, or check a workflow before deployment/import.",
                "path": ".claude/skills/automation-validator/SKILL.md",
                "frontmatter": {
                  "name": "automation-validator",
                  "description": "Validates automation workflow JSON before deployment for Power Automate, n8n, Make, Zapier and other platforms. Checks syntax, structure, best practices, and potential issues. Analyzes workflow JSON files for platform compliance, missing error handling, performance issues, and security concerns. Use when user wants to validate, review, or check a workflow before deployment/import.",
                  "allowed-tools": "Read, Grep, Glob"
                },
                "content": "# Automation Workflow Validator\n\nComprehensive pre-deployment validator for automation workflow JSON definitions across multiple platforms.\n\n## Supported Platforms\n\n- **Power Automate** (Microsoft)\n- **n8n** (Open-source)\n- **Make** (formerly Integromat)\n- **Zapier**\n- **Other JSON-based workflow platforms**\n\n## Purpose\n\nValidates automation workflows against:\n1. **Syntax correctness** - Valid JSON, proper structure\n2. **Platform compliance** - Schema, required fields, valid operations (platform-specific)\n3. **Best practices** - Error handling, performance, reliability\n4. **Security** - Hardcoded credentials, injection risks\n5. **Documentation compliance** - Connector/node limits, known constraints\n\n## When This Skill Activates\n\nTriggers on:\n- \"Validate this workflow JSON\"\n- \"Check this workflow JSON before deployment\"\n- \"Review my workflow JSON for [platform]\"\n- \"Is this flow ready to paste into Power Automate/n8n/Make?\"\n- \"Validate my n8n workflow\"\n- \"Lint this automation\"\n- \"Pre-deployment check\"\n- **Workflow JSON files** - Any JSON with workflow/flow/automation context (examples: flow.json, workflow.json, scenario.json, automation.json, fixed_flow.json)\n\n## Validation Checklist\n\n### 1. Syntax Validation\n\n**JSON Structure**:\n- [ ] Valid JSON syntax (balanced brackets, proper escaping)\n- [ ] No trailing commas\n- [ ] Proper string escaping for expressions\n- [ ] No invalid characters\n\n**Power Automate Schema**:\n- [ ] Correct $schema URL\n- [ ] Required root elements: definition, schemaVersion\n- [ ] Parameters include $connections\n- [ ] Valid contentVersion format\n\n**Structure**:\n```json\n{\n  \"definition\": {\n    \"$schema\": \"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": { /* Required */ },\n    \"triggers\": { /* Required */ },\n    \"actions\": { /* Required */ },\n    \"outputs\": {}\n  },\n  \"schemaVersion\": \"1.0.0.0\"\n}\n```\n\n### 2. Triggers Validation\n\n**Required Fields**:\n- [ ] At least one trigger defined\n- [ ] Trigger has \"type\" field\n- [ ] Trigger has \"inputs\" object\n- [ ] Valid trigger types: Request, Recurrence, ApiConnection, etc.\n\n**Common Issues**:\n- Missing \"kind\" in Request triggers\n- Invalid recurrence frequency\n- Missing required parameters for ApiConnection triggers\n\n**Example Check**:\n```json\n// GOOD\n\"triggers\": {\n  \"manual\": {\n    \"type\": \"Request\",\n    \"kind\": \"Button\",  // Required for manual triggers\n    \"inputs\": {\n      \"schema\": {}\n    }\n  }\n}\n\n// BAD - missing kind\n\"triggers\": {\n  \"manual\": {\n    \"type\": \"Request\",\n    \"inputs\": {}\n  }\n}\n```\n\n### 3. Actions Validation\n\n**Required Fields**:\n- [ ] Each action has \"type\"\n- [ ] Each action has \"inputs\"\n- [ ] Each action has \"runAfter\" (or is first action)\n- [ ] Valid action types\n\n**runAfter Chain**:\n- [ ] No orphaned actions (all connected to trigger)\n- [ ] No circular dependencies\n- [ ] runAfter references exist\n- [ ] Proper status values: Succeeded, Failed, Skipped, TimedOut\n\n**GUID Validation**:\n- [ ] All GUIDs are valid format (if present)\n- [ ] No duplicate GUIDs\n- [ ] operationMetadataId unique per action\n\n**Example Check**:\n```json\n// GOOD\n\"actions\": {\n  \"Action_1\": {\n    \"type\": \"Compose\",\n    \"inputs\": \"test\",\n    \"runAfter\": {}  // First action\n  },\n  \"Action_2\": {\n    \"type\": \"Compose\",\n    \"inputs\": \"test2\",\n    \"runAfter\": {\n      \"Action_1\": [\"Succeeded\"]  // References existing action\n    }\n  }\n}\n\n// BAD - Action_2 references non-existent action\n\"actions\": {\n  \"Action_2\": {\n    \"type\": \"Compose\",\n    \"inputs\": \"test\",\n    \"runAfter\": {\n      \"NonExistent\": [\"Succeeded\"]\n    }\n  }\n}\n```\n\n### 4. Expression Validation\n\n**Common Expression Errors**:\n- [ ] All expressions start with @\n- [ ] Proper function syntax\n- [ ] Valid function names\n- [ ] Correct parameter counts\n- [ ] Proper string quoting inside expressions\n\n**Check Patterns**:\n```javascript\n// GOOD\n\"@body('Get_Item')?['property']\"\n\"@concat('Hello ', variables('Name'))\"\n\"@if(equals(1, 1), 'true', 'false')\"\n\n// BAD\n\"body('Get_Item')['property']\"  // Missing @\n\"@concat(Hello, variables('Name'))\"  // Unquoted string\n\"@if(equals(1, 1) 'true', 'false')\"  // Missing comma\n```\n\n**Safe Navigation**:\n- [ ] Use ?[] for optional properties\n- [ ] Null checks for nullable values\n- [ ] Default values with coalesce()\n\n### 4.5. Data Structure Validation (NEW!)\n\n**CRITICAL CHECK**: Verify data type consistency throughout flow\n\n**Array Type Consistency**:\n- [ ] Check Query/Filter actions for data type indicators\n- [ ] Verify `item()` vs `item()?['Property']` usage consistency\n- [ ] Validate loop `items()` usage matches source data structure\n- [ ] Ensure Select actions output correct structure\n\n**Pattern Detection**:\n```javascript\n// INCONSISTENT (BUG RISK):\n// Filter uses:\n\"where\": \"@contains(item(), 'text')\"  // ← Array of strings\n\n// But loop uses:\n\"value\": \"@items('Loop')?['PropertyName']\"  // ← Accessing property on string = ERROR\n\n// CONSISTENT (CORRECT):\n// Filter uses:\n\"where\": \"@contains(item(), 'text')\"  // ← Array of strings\n\n// Loop uses:\n\"value\": \"@items('Loop')\"  // ← Direct string access = CORRECT\n```\n\n**Validation Checks**:\n- [ ] All Query actions: Check if `where` uses `item()` or `item()?['Prop']`\n- [ ] All Foreach loops: Verify `items()` access matches source type\n- [ ] All Select actions: Verify mappings create expected structure\n- [ ] Cross-reference: Filter → Loop → SetVariable consistency\n\n**Common Bugs to Detect**:\n```json\n// BUG PATTERN 1: Property access on primitives\n{\n  \"Filter\": {\n    \"where\": \"@contains(item(), 'value')\"  // String array\n  },\n  \"Loop\": {\n    \"foreach\": \"@body('Filter')\",\n    \"actions\": {\n      \"BugAction\": {\n        \"value\": \"@items('Loop')?['Nom']\"  // ❌ ERROR: Can't access property on string\n      }\n    }\n  }\n}\n\n// BUG PATTERN 2: Empty Select mapping\n{\n  \"Select\": {\n    \"select\": {\n      \"Nom\": \"\"  // ❌ ERROR: Empty mapping creates useless output\n    }\n  }\n}\n\n// BUG PATTERN 3: Inconsistent data access\n{\n  \"Compose1\": {\n    \"inputs\": \"@item()?['Name']\"  // Expects objects\n  },\n  \"Compose2\": {\n    \"inputs\": \"@item()\"  // Treats as primitives\n  }\n  // ❌ ERROR: Inconsistent - which is it?\n}\n```\n\n**Validation Actions**:\n- ⚠️ **WARNING** if data structure inconsistency detected\n- ⚠️ **WARNING** if Select action has empty mappings\n- ⚠️ **WARNING** if `item()` usage is inconsistent across actions\n- ❌ **ERROR** if property access clearly mismatches source type\n\n### 5. Best Practices Validation\n\n**Error Handling**:\n- [ ] Critical actions wrapped in Scope\n- [ ] Scope has corresponding error handler\n- [ ] Error handler uses \"Configure run after\"\n- [ ] Proper handling of Failed, TimedOut states\n\n**Example**:\n```json\n\"Scope_Main\": {\n  \"type\": \"Scope\",\n  \"actions\": { /* critical actions */ }\n},\n\"Handle_Errors\": {\n  \"type\": \"Compose\",\n  \"inputs\": \"Error occurred\",\n  \"runAfter\": {\n    \"Scope_Main\": [\"Failed\", \"TimedOut\"]\n  }\n}\n```\n\n**Performance**:\n- [ ] Apply to each has concurrency configured for API calls\n- [ ] Delays present in loops with API calls\n- [ ] Filtering at source (not in Apply to each)\n- [ ] Do until has timeout and count limits\n\n**Reliability**:\n- [ ] Retry policies for transient errors\n- [ ] Idempotent operations where possible\n- [ ] Proper timeout configuration\n- [ ] Variable initialization at flow start\n\n### 6. Security Validation\n\n**Critical Issues**:\n- [ ] No hardcoded passwords or API keys\n- [ ] No hardcoded connection strings\n- [ ] Credentials use secure parameters\n- [ ] Sensitive data not logged in plain text\n\n**Check for**:\n```json\n// BAD - hardcoded credentials\n\"inputs\": {\n  \"authentication\": {\n    \"password\": \"MyPassword123\",  // SECURITY ISSUE\n    \"username\": \"admin@contoso.com\"\n  }\n}\n\n// GOOD - parameterized\n\"inputs\": {\n  \"authentication\": {\n    \"password\": \"@parameters('$connections')['connection']['password']\",\n    \"username\": \"@parameters('$connections')['connection']['username']\"\n  }\n}\n```\n\n**Injection Risks**:\n- [ ] User input sanitized\n- [ ] SQL queries parameterized\n- [ ] Dynamic URLs validated\n- [ ] File paths validated\n\n### 7. Connector-Specific Validation\n\n**SharePoint**:\n- [ ] API calls respect 600/60s limit\n- [ ] Delays present in loops\n- [ ] List names don't contain periods\n- [ ] Attachment size checks (90MB)\n\n**OneDrive**:\n- [ ] API calls respect 100/60s limit\n- [ ] File size checks (50MB for triggers)\n- [ ] Proper delays (3 seconds recommended)\n\n**HTTP**:\n- [ ] Timeout configured\n- [ ] Retry policy for transient failures\n- [ ] Authentication configured\n- [ ] URL validation for user input\n\n**Control (Apply to each)**:\n- [ ] Concurrency set for API operations\n- [ ] Max 5000 items (default)\n- [ ] Proper error handling inside loop\n\n**Do Until**:\n- [ ] Timeout configured\n- [ ] Count limit configured\n- [ ] Exit condition will eventually be true\n\n### 8. Documentation Compliance\n\n**Reference PowerAutomateDocs**:\n- [ ] Actions use documented parameters\n- [ ] Respect documented limitations\n- [ ] Follow recommended patterns\n- [ ] Match documented examples\n\n**Check against**:\n- PowerAutomateDocs/{Connector}/overview.md → Limitations\n- PowerAutomateDocs/{Connector}/actions.md → Parameters\n- PowerAutomateDocs/BuiltIn/ → Built-in connector patterns\n\n## Validation Output Format\n\n```markdown\n# Power Automate Flow Validation Report\n\n## Overall Status: ✅ PASS / ⚠️ WARNINGS / ❌ FAIL\n\n---\n\n## Syntax Validation\n**Status**: ✅ Pass\n\n- ✅ Valid JSON syntax\n- ✅ Correct Power Automate schema\n- ✅ All required root elements present\n\n---\n\n## Structure Validation\n**Status**: ✅ Pass\n\n### Triggers\n- ✅ 1 trigger defined: \"manual\"\n- ✅ Trigger type valid: Request\n- ✅ Required fields present\n\n### Actions\n- ✅ 5 actions defined\n- ✅ All actions have required fields\n- ✅ runAfter chain valid (no orphans)\n- ✅ No circular dependencies\n\n---\n\n## Best Practices\n**Status**: ⚠️ Warnings\n\n### Error Handling\n- ⚠️ **Missing error handling** for \"Get_Items\" action\n  - Recommendation: Wrap in Scope with error handler\n  - Impact: Flow fails completely on error\n\n### Performance\n- ✅ Apply to each has concurrency configured\n- ⚠️ **No delay in API loop**\n  - Recommendation: Add 1-second delay after \"Get_Items\"\n  - Impact: Risk of throttling (429 errors)\n\n### Reliability\n- ✅ Variables initialized\n- ✅ Do until has timeout configured\n\n---\n\n## Security\n**Status**: ✅ Pass\n\n- ✅ No hardcoded credentials\n- ✅ Using connection parameters\n- ✅ No SQL injection risks\n- ✅ Sensitive data properly handled\n\n---\n\n## Connector-Specific\n**Status**: ⚠️ Warnings\n\n### SharePoint (Get Items)\n- ⚠️ **Throttling risk**: 100 iterations with no delays\n  - Limit: 600 calls/60 seconds\n  - Recommendation: Add 1-second delay or reduce concurrency\n  - Reference: PowerAutomateDocs/SharePoint/overview.md\n\n- ✅ Attachment size checks present\n- ✅ List names valid (no periods)\n\n---\n\n## Critical Issues: 0\n## Warnings: 3\n## Passed Checks: 28\n\n---\n\n## Recommendations (Priority Order)\n\n### High Priority\n1. **Add error handling for Get_Items**\n   ```json\n   \"Scope_GetItems\": {\n     \"type\": \"Scope\",\n     \"actions\": {\n       \"Get_Items\": { /* existing action */ }\n     }\n   },\n   \"Handle_Errors\": {\n     \"runAfter\": {\n       \"Scope_GetItems\": [\"Failed\", \"TimedOut\"]\n     }\n   }\n   ```\n\n2. **Add delay to prevent throttling**\n   ```json\n   \"Delay\": {\n     \"type\": \"Wait\",\n     \"inputs\": {\n       \"interval\": {\n         \"count\": 1,\n         \"unit\": \"Second\"\n       }\n     },\n     \"runAfter\": {\n       \"Get_Items\": [\"Succeeded\"]\n     }\n   }\n   ```\n\n### Medium Priority\n3. **Add timeout to HTTP action**\n   - Current: No timeout (default 2 minutes)\n   - Recommended: Explicit timeout configuration\n\n---\n\n## Ready for Deployment?\n\n✅ **YES** - Flow is syntactically valid and can be pasted into Power Automate\n\n⚠️ **WITH WARNINGS** - Flow will work but has performance/reliability risks\n\n❌ **NO** - Critical issues must be fixed before deployment\n\n---\n\n## Next Steps\n\n1. Review warnings above\n2. Apply high-priority recommendations\n3. Test with sample data\n4. Monitor first runs for issues\n5. Revisit validation after changes\n\n---\n\n## Validation Metadata\n\n- Validated: [timestamp]\n- Flow Actions: 5\n- Triggers: 1\n- Connectors Used: SharePoint, Control\n- Total Checks: 31\n```\n\n## Validation Levels\n\n### Level 1: Syntax (Blocking)\n**Must pass** - Flow won't paste into Power Automate\n- Invalid JSON\n- Missing required structure\n- Invalid schema\n\n### Level 2: Structure (Blocking)\n**Must pass** - Flow won't run\n- Invalid runAfter chains\n- Missing action types\n- Invalid expression syntax\n\n### Level 3: Best Practices (Warnings)\n**Should fix** - Flow runs but has risks\n- Missing error handling\n- No throttling mitigation\n- Poor performance patterns\n\n### Level 4: Optimization (Suggestions)\n**Nice to have** - Improvements\n- Better variable naming\n- More efficient queries\n- Enhanced logging\n\n## Quick Validation Commands\n\nFor specific checks without full validation:\n\n### Check Syntax Only\n```\n\"Validate JSON syntax in workflow JSON\"\n```\n\n### Check Best Practices Only\n```\n\"Review best practices in this flow\"\n```\n\n### Check Specific Connector\n```\n\"Validate SharePoint usage in workflow JSON\"\n```\n\n### Security Scan Only\n```\n\"Security scan this Power Automate flow\"\n```\n\n## Integration with Other Skills\n\n**Before using workflow-builder**:\n- Validate requirements are complete\n- Check for known limitations\n\n**After using automation-debugger**:\n- Validate the fixed workflow JSON\n- Ensure all issues resolved\n- Verify no new issues introduced\n\n**Before deployment**:\n- Always run full validation\n- Review warnings\n- Document any accepted risks\n\n## Common Validation Failures\n\n### 1. Missing runAfter\n```json\n// FAIL\n\"actions\": {\n  \"Action_2\": {\n    \"type\": \"Compose\",\n    \"inputs\": \"test\"\n    // Missing runAfter\n  }\n}\n```\n**Fix**: Add `\"runAfter\": {}` for first action or reference predecessor\n\n### 2. Invalid Expression\n```json\n// FAIL\n\"inputs\": \"@body('Get_Item')['property']\"  // Will fail if property missing\n```\n**Fix**: `\"@body('Get_Item')?['property']\"` with safe navigation\n\n### 3. No Error Handling\n```json\n// FAIL\n\"Get_Items\": { /* API call with no error handling */ }\n```\n**Fix**: Wrap in Scope with error handler\n\n### 4. Throttling Risk\n```json\n// FAIL\n\"Apply_to_each\": {\n  \"foreach\": \"@range(0, 1000)\",  // 1000 API calls\n  \"runtimeConfiguration\": {\n    \"concurrency\": {\n      \"repetitions\": 50  // 50 parallel\n    }\n  }\n}\n```\n**Fix**: Reduce concurrency to 1, add delays\n\n### 5. Missing Timeout\n```json\n// FAIL\n\"Do_until\": {\n  \"expression\": \"@equals(variables('Done'), true)\"\n  // No limit\n}\n```\n**Fix**: Add `\"limit\": {\"count\": 60, \"timeout\": \"PT1H\"}`\n\n## Best Practices Enforcement\n\nEnable strict mode for production flows:\n- All errors must have handlers\n- All loops must have limits\n- All API calls must have delays\n- All expressions must be safe\n- No hardcoded values\n- Full documentation compliance\n\n## Examples\n\n**User**: \"Validate my workflow JSON before I paste it\"\n\n**Skill Response**:\n1. Reads workflow JSON file\n2. Runs all validation checks\n3. Generates detailed report\n4. Highlights critical issues\n5. Provides fix recommendations\n6. Gives deployment readiness status\n\n**User**: \"Quick syntax check on my fixed workflow JSON\"\n\n**Skill Response**:\n1. Reads workflow JSON file\n2. Validates JSON syntax\n3. Checks platform-specific schema\n4. Confirms structure validity\n5. Returns pass/fail status\n\n## Supporting Files\n\nSee also:\n- [Power Automate JSON Format](../../../PowerAutomateDocs/platform-specific format documentation) - Schema requirements\n- [Error Patterns](../automation-debugger/ERROR-PATTERNS.md) - Common issues to check for\n- [Repository Guide](../../../CLAUDE.md) - Full documentation standards\n\n---\n\n**Version**: 1.1\n**Last Updated**: 2025-10-31\n\n## Changelog\n\n### Version 1.1 (2025-10-31)\n\n**Major Improvements**:\n- ✅ Added **Section 4.5: Data Structure Validation** (NEW!) - Validates data type consistency\n- ✅ Detects **property access on primitives** (critical bug pattern)\n- ✅ Validates **Select action mappings** for empty/incorrect values\n- ✅ Checks **Filter → Loop → SetVariable consistency**\n- ✅ Identifies **`item()` vs `item()?['Property']` mismatches**\n\n**New Validation Checks**:\n- Array type consistency validation\n- Query/Filter pattern detection (`item()` vs `item()?['Prop']`)\n- Foreach loop data access validation\n- Select action output structure verification\n- Cross-action data flow consistency\n\n**Bug Patterns Now Detected**:\n1. Property access on string primitives (`items('Loop')?['Prop']` on string array)\n2. Empty Select mappings (`\"Nom\": \"\"`)\n3. Inconsistent data access patterns across actions\n\n**Impact**:\n- Catches critical structural bugs before deployment\n- Prevents runtime errors from data type mismatches\n- Reduces failed deployments due to data structure issues\n- Complements automation-debugger for pre-deployment validation"
              }
            ]
          }
        ]
      }
    }
  ]
}