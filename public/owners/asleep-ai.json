{
  "owner": {
    "id": "asleep-ai",
    "display_name": "Asleep",
    "type": "Organization",
    "avatar_url": "https://avatars.githubusercontent.com/u/68939395?v=4",
    "url": "https://github.com/asleep-ai",
    "bio": null,
    "stats": {
      "total_repos": 1,
      "total_plugins": 1,
      "total_commands": 0,
      "total_skills": 4,
      "total_stars": 0,
      "total_forks": 0
    }
  },
  "repos": [
    {
      "full_name": "asleep-ai/sleeptrack-skills",
      "url": "https://github.com/asleep-ai/sleeptrack-skills",
      "description": null,
      "homepage": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2025-11-12T11:11:38Z",
        "created_at": "2025-11-12T05:29:13Z",
        "license": null
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 716
        },
        {
          "path": ".gitignore",
          "type": "blob",
          "size": 75
        },
        {
          "path": "CLAUDE.md",
          "type": "blob",
          "size": 918
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 1597
        },
        {
          "path": "skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/.gitkeep",
          "type": "blob",
          "size": null
        },
        {
          "path": "skills/sleeptrack-android",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/sleeptrack-android/SKILL.md",
          "type": "blob",
          "size": 17530
        },
        {
          "path": "skills/sleeptrack-android/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/sleeptrack-android/references/android_architecture_patterns.md",
          "type": "blob",
          "size": 13685
        },
        {
          "path": "skills/sleeptrack-android/references/complete_viewmodel_implementation.md",
          "type": "blob",
          "size": 17999
        },
        {
          "path": "skills/sleeptrack-android/references/gradle_setup.md",
          "type": "blob",
          "size": 4062
        },
        {
          "path": "skills/sleeptrack-android/references/testing_guide.md",
          "type": "blob",
          "size": 13249
        },
        {
          "path": "skills/sleeptrack-android/references/ui_implementation_guide.md",
          "type": "blob",
          "size": 15162
        },
        {
          "path": "skills/sleeptrack-be",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/sleeptrack-be/SKILL.md",
          "type": "blob",
          "size": 15502
        },
        {
          "path": "skills/sleeptrack-be/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/sleeptrack-be/references/nodejs_client_implementation.md",
          "type": "blob",
          "size": 11945
        },
        {
          "path": "skills/sleeptrack-be/references/production_patterns.md",
          "type": "blob",
          "size": 20106
        },
        {
          "path": "skills/sleeptrack-be/references/python_client_implementation.md",
          "type": "blob",
          "size": 18325
        },
        {
          "path": "skills/sleeptrack-be/references/rest_api_reference.md",
          "type": "blob",
          "size": 15204
        },
        {
          "path": "skills/sleeptrack-be/references/webhook_implementation_guide.md",
          "type": "blob",
          "size": 15474
        },
        {
          "path": "skills/sleeptrack-be/references/webhook_reference.md",
          "type": "blob",
          "size": 20898
        },
        {
          "path": "skills/sleeptrack-foundation",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/sleeptrack-foundation/SKILL.md",
          "type": "blob",
          "size": 14837
        },
        {
          "path": "skills/sleeptrack-foundation/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/sleeptrack-foundation/references/asleep_api_reference.md",
          "type": "blob",
          "size": 6243
        },
        {
          "path": "skills/sleeptrack-ios",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/sleeptrack-ios/SKILL.md",
          "type": "blob",
          "size": 15442
        },
        {
          "path": "skills/sleeptrack-ios/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/sleeptrack-ios/references/advanced_patterns.md",
          "type": "blob",
          "size": 11580
        },
        {
          "path": "skills/sleeptrack-ios/references/complete_viewmodel_implementation.md",
          "type": "blob",
          "size": 12270
        },
        {
          "path": "skills/sleeptrack-ios/references/ios_specific_features.md",
          "type": "blob",
          "size": 7694
        }
      ],
      "marketplace": {
        "name": "sleeptrack-skills",
        "version": null,
        "description": null,
        "owner_info": {
          "name": "asleep-ai",
          "email": "marcus.kyung@asleep.ai"
        },
        "keywords": [],
        "plugins": [
          {
            "name": "sleeptrack-skills",
            "description": "Collection of Asleep API integration skills covering foundation concepts, Android SDK, iOS SDK, and backend REST API integration",
            "source": "./",
            "category": null,
            "version": null,
            "author": null,
            "install_commands": [
              "/plugin marketplace add asleep-ai/sleeptrack-skills",
              "/plugin install sleeptrack-skills@sleeptrack-skills"
            ],
            "signals": {
              "stars": 0,
              "forks": 0,
              "pushed_at": "2025-11-12T11:11:38Z",
              "created_at": "2025-11-12T05:29:13Z",
              "license": null
            },
            "commands": [],
            "skills": [
              {
                "name": "sleeptrack-android",
                "description": "This skill helps Android developers integrate the Asleep SDK for sleep tracking functionality. Use this skill when developers ask about Android implementation, MVVM architecture patterns, permission handling, Jetpack Compose UI, Kotlin coroutines integration, or Android-specific sleep tracking features. This skill provides working code examples from the official sample app.",
                "path": "skills/sleeptrack-android/SKILL.md",
                "frontmatter": {
                  "name": "sleeptrack-android",
                  "description": "This skill helps Android developers integrate the Asleep SDK for sleep tracking functionality. Use this skill when developers ask about Android implementation, MVVM architecture patterns, permission handling, Jetpack Compose UI, Kotlin coroutines integration, or Android-specific sleep tracking features. This skill provides working code examples from the official sample app."
                },
                "content": "# Sleeptrack Android\n\n## Overview\n\nThis skill provides comprehensive guidance for integrating the Asleep sleep tracking SDK into Android applications. It covers Android-specific implementation details including MVVM architecture, permission handling, state management, UI patterns, and lifecycle management.\n\nUse this skill when developers need to:\n- Set up Asleep SDK in Android projects\n- Implement sleep tracking with proper Android architecture\n- Handle Android-specific permissions (microphone, notifications, battery optimization)\n- Manage tracking lifecycle with state machines\n- Build UI with ViewBinding or Jetpack Compose\n- Handle errors and edge cases in Android environment\n- Implement foreground services for background tracking\n\n**Prerequisites**: Review the `sleeptrack-foundation` skill first for core concepts including session lifecycle, error codes, and API fundamentals.\n\n## Quick Start\n\n### 1. Add Dependencies\n\nAdd to your app-level `build.gradle`:\n\n```gradle\ndependencies {\n    // Core dependencies\n    implementation 'androidx.core:core-ktx:1.12.0'\n    implementation 'androidx.appcompat:appcompat:1.6.1'\n    implementation 'androidx.lifecycle:lifecycle-service:2.7.0'\n\n    // Required for Asleep SDK\n    implementation 'com.squareup.okhttp3:okhttp:4.11.0'\n    implementation 'com.google.code.gson:gson:2.10'\n    implementation 'ai.asleep:asleepsdk:3.1.4'\n\n    // Optional: Hilt for DI\n    implementation \"com.google.dagger:hilt-android:2.48\"\n    kapt \"com.google.dagger:hilt-compiler:2.48\"\n}\n```\n\n**Minimum Requirements**:\n- minSdk: 24 (Android 7.0)\n- targetSdk: 34\n- Java: 17\n- Kotlin: 1.9.24+\n\nSee `references/gradle_setup.md` for complete Gradle configuration.\n\n### 2. Configure Permissions\n\nAdd to `AndroidManifest.xml`:\n\n```xml\n<manifest>\n    <!-- Essential permissions -->\n    <uses-permission android:name=\"android.permission.INTERNET\" />\n    <uses-permission android:name=\"android.permission.RECORD_AUDIO\" />\n    <uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\" />\n    <uses-permission android:name=\"android.permission.FOREGROUND_SERVICE_MICROPHONE\" />\n\n    <!-- Battery optimization -->\n    <uses-permission android:name=\"android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS\" />\n\n    <!-- Notifications (Android 13+) -->\n    <uses-permission android:name=\"android.permission.POST_NOTIFICATIONS\" />\n</manifest>\n```\n\n### 3. Initialize SDK\n\n```kotlin\nAsleep.initAsleepConfig(\n    context = applicationContext,\n    apiKey = \"your_api_key_here\",\n    userId = \"unique_user_id\",\n    baseUrl = \"https://api.asleep.ai\",\n    callbackUrl = null, // Optional webhook URL\n    service = \"YourAppName\",\n    asleepConfigListener = object : Asleep.AsleepConfigListener {\n        override fun onSuccess(userId: String?, asleepConfig: AsleepConfig?) {\n            // SDK initialized successfully\n        }\n\n        override fun onFail(errorCode: Int, detail: String) {\n            Log.e(\"Asleep\", \"Init failed: $errorCode - $detail\")\n        }\n    }\n)\n```\n\n### 4. Start Sleep Tracking\n\n```kotlin\nAsleep.beginSleepTracking(\n    asleepConfig = asleepConfig,\n    asleepTrackingListener = object : Asleep.AsleepTrackingListener {\n        override fun onStart(sessionId: String) {\n            // Tracking started successfully\n        }\n\n        override fun onPerform(sequence: Int) {\n            // Called every ~30 seconds (1 sequence)\n        }\n\n        override fun onFinish(sessionId: String?) {\n            // Tracking completed\n        }\n\n        override fun onFail(errorCode: Int, detail: String) {\n            // Handle tracking errors\n        }\n    },\n    notificationTitle = \"Sleep Tracking Active\",\n    notificationText = \"Tap to return to app\",\n    notificationIcon = R.drawable.ic_notification,\n    notificationClass = MainActivity::class.java\n)\n```\n\n### 5. Stop Tracking\n\n```kotlin\nAsleep.endSleepTracking()\n```\n\n## Android Architecture Pattern (MVVM + Hilt)\n\nThe recommended architecture follows Android best practices with MVVM pattern, Hilt dependency injection, and proper state management.\n\n### State Management\n\nDefine tracking states using sealed classes:\n\n```kotlin\nsealed class AsleepState {\n    data object STATE_IDLE: AsleepState()\n    data object STATE_INITIALIZING : AsleepState()\n    data object STATE_INITIALIZED : AsleepState()\n    data object STATE_TRACKING_STARTING : AsleepState()\n    data object STATE_TRACKING_STARTED : AsleepState()\n    data object STATE_TRACKING_STOPPING : AsleepState()\n    data class STATE_ERROR(val errorCode: AsleepError) : AsleepState()\n}\n\ndata class AsleepError(val code: Int, val message: String)\n```\n\n### Basic ViewModel Pattern\n\n```kotlin\n@HiltViewModel\nclass SleepTrackingViewModel @Inject constructor(\n    @ApplicationContext private val app: Application\n) : ViewModel() {\n\n    private val _trackingState = MutableStateFlow<AsleepState>(AsleepState.STATE_IDLE)\n    val trackingState: StateFlow<AsleepState> = _trackingState\n\n    private var config: AsleepConfig? = null\n\n    fun initializeSDK(userId: String) {\n        Asleep.initAsleepConfig(\n            context = app,\n            apiKey = BuildConfig.ASLEEP_API_KEY,\n            userId = userId,\n            baseUrl = \"https://api.asleep.ai\",\n            callbackUrl = null,\n            service = \"MyApp\",\n            asleepConfigListener = object : Asleep.AsleepConfigListener {\n                override fun onSuccess(userId: String?, asleepConfig: AsleepConfig?) {\n                    config = asleepConfig\n                    _trackingState.value = AsleepState.STATE_INITIALIZED\n                }\n                override fun onFail(errorCode: Int, detail: String) {\n                    _trackingState.value = AsleepState.STATE_ERROR(AsleepError(errorCode, detail))\n                }\n            }\n        )\n    }\n\n    fun startTracking() {\n        config?.let {\n            Asleep.beginSleepTracking(\n                asleepConfig = it,\n                asleepTrackingListener = trackingListener,\n                notificationTitle = \"Sleep Tracking\",\n                notificationText = \"Active\",\n                notificationIcon = R.drawable.ic_notification,\n                notificationClass = MainActivity::class.java\n            )\n        }\n    }\n\n    fun stopTracking() {\n        Asleep.endSleepTracking()\n    }\n}\n```\n\n**For complete production-ready ViewModel with real-time data, error handling, and lifecycle management**, see `references/complete_viewmodel_implementation.md`.\n\n### Basic Activity Pattern\n\n```kotlin\n@AndroidEntryPoint\nclass MainActivity : AppCompatActivity() {\n\n    private lateinit var binding: ActivityMainBinding\n    private val viewModel: SleepTrackingViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        binding = ActivityMainBinding.inflate(layoutInflater)\n        setContentView(binding.root)\n\n        // Setup button\n        binding.btnTrack.setOnClickListener {\n            when (viewModel.trackingState.value) {\n                AsleepState.STATE_INITIALIZED -> viewModel.startTracking()\n                AsleepState.STATE_TRACKING_STARTED -> viewModel.stopTracking()\n                else -> {}\n            }\n        }\n\n        // Observe state\n        lifecycleScope.launch {\n            viewModel.trackingState.collect { state ->\n                updateUI(state)\n            }\n        }\n    }\n}\n```\n\n**For complete Activity implementation with permission handling**, see `references/complete_viewmodel_implementation.md`.\n\n## Permission Handling\n\nAndroid requires multiple runtime permissions for sleep tracking:\n\n### Required Permissions\n\n1. **RECORD_AUDIO**: Microphone access for sleep sound recording\n2. **POST_NOTIFICATIONS**: Android 13+ notification permission\n3. **Battery Optimization**: Prevent app from being killed during tracking\n\n### Permission Request Flow\n\n```kotlin\n// Request permissions sequentially\nwhen {\n    !hasMicrophonePermission() -> requestMicrophone()\n    !hasNotificationPermission() -> requestNotification()\n    !isBatteryOptimizationIgnored() -> requestBatteryOptimization()\n    else -> allPermissionsGranted()\n}\n```\n\n### Best Practices\n\n1. **Request in sequence**: Request one permission at a time for better UX\n2. **Show rationale**: Explain why each permission is needed before requesting\n3. **Handle denial**: Provide fallback or guide users to settings\n4. **Check on resume**: Re-check permissions when app resumes\n\n```kotlin\noverride fun onResume() {\n    super.onResume()\n    if (!hasRequiredPermissions() && Asleep.isSleepTrackingAlive(applicationContext)) {\n        handlePermissionLoss()\n    }\n}\n```\n\n**For complete PermissionManager implementation**, see `references/complete_viewmodel_implementation.md`.\n\n## Error Handling\n\nDistinguish between critical errors and warnings:\n\n### Error Classification\n\n```kotlin\nfun isWarning(errorCode: Int): Boolean {\n    return errorCode in setOf(\n        AsleepErrorCode.ERR_AUDIO_SILENCED,\n        AsleepErrorCode.ERR_UPLOAD_FAILED\n    )\n}\n\nfun handleError(error: AsleepError) {\n    if (isWarning(error.code)) {\n        // Show warning, continue tracking\n        Toast.makeText(context, getUserFriendlyMessage(error), Toast.LENGTH_SHORT).show()\n    } else {\n        // Critical error - stop tracking\n        stopTracking()\n        showErrorDialog(getUserFriendlyMessage(error))\n    }\n}\n```\n\n## UI Patterns\n\n### ViewBinding Example\n\n```kotlin\nclass TrackingFragment : Fragment() {\n    private var _binding: FragmentTrackingBinding? = null\n    private val binding get() = _binding!!\n    private val viewModel: SleepTrackingViewModel by viewModels()\n\n    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n        super.onViewCreated(view, savedInstanceState)\n\n        viewLifecycleOwner.lifecycleScope.launch {\n            viewModel.trackingState.collect { state ->\n                when (state) {\n                    AsleepState.STATE_TRACKING_STARTED -> {\n                        binding.btnTrack.text = \"Stop Tracking\"\n                    }\n                    AsleepState.STATE_INITIALIZED -> {\n                        binding.btnTrack.text = \"Start Tracking\"\n                    }\n                    else -> {}\n                }\n            }\n        }\n    }\n\n    override fun onDestroyView() {\n        super.onDestroyView()\n        _binding = null\n    }\n}\n```\n\n### Jetpack Compose Example\n\n```kotlin\n@Composable\nfun SleepTrackingScreen(\n    viewModel: SleepTrackingViewModel = hiltViewModel()\n) {\n    val trackingState by viewModel.trackingState.collectAsState()\n\n    Column(\n        modifier = Modifier.fillMaxSize(),\n        horizontalAlignment = Alignment.CenterHorizontally,\n        verticalArrangement = Arrangement.Center\n    ) {\n        when (trackingState) {\n            AsleepState.STATE_TRACKING_STARTED -> {\n                Button(onClick = { viewModel.stopTracking() }) {\n                    Text(\"Stop Tracking\")\n                }\n            }\n            AsleepState.STATE_INITIALIZED -> {\n                Button(onClick = { viewModel.startTracking() }) {\n                    Text(\"Start Sleep Tracking\")\n                }\n            }\n            is AsleepState.STATE_ERROR -> {\n                ErrorDisplay(error = (trackingState as AsleepState.STATE_ERROR).errorCode)\n            }\n            else -> {\n                CircularProgressIndicator()\n            }\n        }\n    }\n}\n```\n\n**For complete UI implementations with Material3 components**, see `references/ui_implementation_guide.md`.\n\n## Lifecycle Management\n\n### Handle App Lifecycle Events\n\n```kotlin\n@AndroidEntryPoint\nclass MainActivity : AppCompatActivity() {\n\n    override fun onStart() {\n        super.onStart()\n        // Reconnect to existing tracking session\n        if (Asleep.isSleepTrackingAlive(applicationContext)) {\n            viewModel.reconnectToTracking()\n        }\n    }\n\n    override fun onStop() {\n        super.onStop()\n        // Tracking continues in background via foreground service\n        // No action needed\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        // Do NOT call endSleepTracking() here\n        // Service continues in background\n    }\n}\n```\n\n### Foreground Service\n\nThe Asleep SDK automatically manages a foreground service during tracking. The notification keeps the service alive:\n\n```kotlin\nAsleep.beginSleepTracking(\n    asleepConfig = config,\n    asleepTrackingListener = listener,\n    notificationTitle = \"Sleep Tracking Active\",\n    notificationText = \"Tracking your sleep patterns\",\n    notificationIcon = R.drawable.ic_sleep,\n    notificationClass = MainActivity::class.java  // Tapping notification opens this\n)\n```\n\nThe service will:\n- Keep the app alive during sleep tracking\n- Show persistent notification\n- Maintain microphone access\n- Continue even if user swipes away the app\n\n## Real-Time Sleep Data\n\nAccess preliminary sleep data during tracking:\n\n```kotlin\n// In ViewModel\noverride fun onPerform(sequence: Int) {\n    // Check after sequence 10, then every 10 sequences\n    if (sequence > 10 && sequence % 10 == 0) {\n        getCurrentSleepData()\n    }\n}\n\nprivate fun getCurrentSleepData() {\n    Asleep.getCurrentSleepData(\n        asleepSleepDataListener = object : Asleep.AsleepSleepDataListener {\n            override fun onSleepDataReceived(session: Session) {\n                val currentSleepStage = session.sleepStages?.lastOrNull()\n                val currentSnoringStage = session.snoringStages?.lastOrNull()\n\n                Log.d(\"Sleep\", \"Current stage: $currentSleepStage\")\n            }\n\n            override fun onFail(errorCode: Int, detail: String) {\n                Log.e(\"Sleep\", \"Failed to get current data: $errorCode\")\n            }\n        }\n    )\n}\n```\n\n**Note**: Real-time data is preliminary and may differ from final report after processing.\n\n## Testing\n\n### Unit Testing\n```kotlin\nclass SleepTrackingViewModelTest {\n    @get:Rule val mainDispatcherRule = MainDispatcherRule()\n\n    @Test\n    fun `startTracking should fail if not initialized`() = runTest {\n        viewModel.startTracking()\n        assertNotEquals(AsleepState.STATE_TRACKING_STARTED, viewModel.trackingState.value)\n    }\n}\n```\n\n### Integration Testing\n```kotlin\n@Test\nfun trackingFlow_complete() {\n    onView(withId(R.id.btn_start_stop)).perform(click())\n    onView(withId(R.id.tracking_indicator)).check(matches(isDisplayed()))\n}\n```\n\n**For complete testing guide with Compose UI tests and test utilities**, see `references/testing_guide.md`.\n\n## Common Issues & Solutions\n\n### Tracking stops unexpectedly\n**Causes**: Battery optimization, notification dismissed, permission revoked, microphone conflict\n\n**Solution**: Check battery optimization and permissions on resume:\n```kotlin\noverride fun onResume() {\n    super.onResume()\n    if (!hasRequiredPermissions() && Asleep.isSleepTrackingAlive(applicationContext)) {\n        handlePermissionLoss()\n    }\n}\n```\n\n### No real-time data available\n**Cause**: Checking before sequence 10\n\n**Solution**: Only call `getCurrentSleepData()` after sequence 10\n\n### ERR_UPLOAD_FORBIDDEN error\n**Cause**: Same user_id tracking on multiple devices\n\n**Solution**: Use unique user IDs per device or check for active sessions before starting\n\n## Resources\n\nThis skill includes detailed reference documentation:\n\n- `references/complete_viewmodel_implementation.md`: Complete ViewModel, Activity, and PermissionManager implementations\n- `references/ui_implementation_guide.md`: Complete ViewBinding and Jetpack Compose UI examples\n- `references/testing_guide.md`: Comprehensive unit, integration, and UI testing guides\n- `references/android_architecture_patterns.md`: Complete architecture examples from the official sample app\n- `references/gradle_setup.md`: Comprehensive Gradle configuration including dependencies and ProGuard rules\n\n### Official Documentation\n\n- **Android Getting Started**: https://docs-en.asleep.ai/docs/android-get-started.md\n- **AsleepConfig Reference**: https://docs-en.asleep.ai/docs/android-asleep-config.md\n- **SleepTrackingManager**: https://docs-en.asleep.ai/docs/android-sleep-tracking-manager.md\n- **Error Codes**: https://docs-en.asleep.ai/docs/android-error-codes.md\n\n### Android Resources\n\n- **Android Permissions**: https://developer.android.com/guide/topics/permissions/overview\n- **Foreground Services**: https://developer.android.com/develop/background-work/services/foreground-services\n- **StateFlow Guide**: https://developer.android.com/kotlin/flow/stateflow-and-sharedflow\n- **Hilt Documentation**: https://developer.android.com/training/dependency-injection/hilt-android\n\n## Next Steps\n\nAfter implementing Android sleep tracking:\n\n1. **Test thoroughly**: Test on different Android versions (especially 13+ for notifications)\n2. **Handle edge cases**: Low battery, airplane mode, app updates during tracking\n3. **Fetch reports**: Use REST API or backend integration to retrieve sleep reports\n4. **Build UI**: Create compelling visualizations of sleep data\n5. **Analytics**: Track user engagement and sleep patterns\n\nFor backend report fetching and webhook integration, use the `sleeptrack-be` skill."
              },
              {
                "name": "sleeptrack-be",
                "description": "This skill provides comprehensive backend REST API integration for Asleep sleep tracking platform. Use this skill when building server-side applications, API proxies for mobile apps, webhook event handlers, cross-platform backends (React Native, Flutter), analytics dashboards, or multi-tenant sleep tracking systems. Covers authentication, user management, session retrieval, statistics, webhook integration, and production-ready patterns with code examples in Python, Node.js, and curl.",
                "path": "skills/sleeptrack-be/SKILL.md",
                "frontmatter": {
                  "name": "sleeptrack-be",
                  "description": "This skill provides comprehensive backend REST API integration for Asleep sleep tracking platform. Use this skill when building server-side applications, API proxies for mobile apps, webhook event handlers, cross-platform backends (React Native, Flutter), analytics dashboards, or multi-tenant sleep tracking systems. Covers authentication, user management, session retrieval, statistics, webhook integration, and production-ready patterns with code examples in Python, Node.js, and curl."
                },
                "content": "# Sleeptrack Backend API Integration\n\n## Overview\n\nThis skill provides comprehensive guidance for integrating the Asleep REST API into backend applications. It covers server-side user management, session data retrieval, statistics aggregation, webhook event handling, and production-ready patterns for building robust sleep tracking backends.\n\n**Use this skill when:**\n- Building backend/server-side sleep tracking integrations\n- Creating API proxies for mobile applications\n- Implementing webhook handlers for real-time sleep data\n- Developing cross-platform backends (React Native, Flutter)\n- Building analytics dashboards and reporting systems\n- Creating multi-tenant sleep tracking applications\n- Integrating sleep data with other health platforms\n\n## Quick Start\n\n### 1. Get Your API Key\n\n1. Sign up at https://dashboard.asleep.ai\n2. Generate an API key for your application\n3. Store securely in environment variables (never commit to version control)\n\n### 2. Basic Authentication\n\nAll API requests require the `x-api-key` header:\n\n**curl:**\n```bash\ncurl -X GET \"https://api.asleep.ai/ai/v1/users/USER_ID\" \\\n  -H \"x-api-key: YOUR_API_KEY\"\n```\n\n**Python:**\n```python\nimport requests\n\nheaders = {\"x-api-key\": \"YOUR_API_KEY\"}\nresponse = requests.get(\n    \"https://api.asleep.ai/ai/v1/users/USER_ID\",\n    headers=headers\n)\n```\n\n**Node.js:**\n```javascript\nconst axios = require('axios');\n\nconst response = await axios.get(\n  'https://api.asleep.ai/ai/v1/users/USER_ID',\n  {\n    headers: { 'x-api-key': 'YOUR_API_KEY' }\n  }\n);\n```\n\n## API Client Structure\n\nBuild a reusable API client to handle authentication, error handling, and common operations.\n\n**Key Components:**\n- Base URL configuration (`https://api.asleep.ai`)\n- API key authentication in headers\n- Error handling for common HTTP status codes (401, 403, 404)\n- Request methods for all API endpoints\n- Session management with persistent connections\n\n**For complete implementations:**\n- Python: See `references/python_client_implementation.md`\n- Node.js: See `references/nodejs_client_implementation.md`\n- REST API details: See `references/rest_api_reference.md`\n\n**Basic Client Structure:**\n```python\nclass AsleepClient:\n    def __init__(self, api_key: str):\n        self.api_key = api_key\n        self.base_url = \"https://api.asleep.ai\"\n        self.session = requests.Session()\n        self.session.headers.update({\"x-api-key\": api_key})\n\n    def _request(self, method: str, path: str, **kwargs):\n        # Handle authentication and errors\n        # See python_client_implementation.md for full code\n        pass\n```\n\n## User Management\n\n### Creating Users\n\nCreate users before tracking sleep. User IDs are managed by your application.\n\n```python\n# Create user with metadata\nuser_id = client.create_user(metadata={\n    \"birth_year\": 1990,\n    \"gender\": \"male\",\n    \"height\": 175.5,  # cm\n    \"weight\": 70.0    # kg\n})\n```\n\n**Available Metadata Fields:**\n- `birth_year` (Integer): Birth year\n- `birth_month` (Integer): 1-12\n- `birth_day` (Integer): 1-31\n- `gender` (String): `male`, `female`, `non_binary`, `other`, `prefer_not_to_say`\n- `height` (Float): Height in cm (0-300)\n- `weight` (Float): Weight in kg (0-1000)\n\n### Retrieving User Information\n\n```python\nuser_data = client.get_user(user_id)\n# Returns: user_id, to_be_deleted status, last_session_info, metadata\n```\n\n**Response includes:**\n- User ID and deletion status\n- Last session information (if available)\n- User metadata (demographic information)\n\n### Deleting Users\n\nPermanently removes user and all associated data (sessions, reports).\n\n```python\nclient.delete_user(user_id)\n```\n\n**For detailed examples and response structures:**\n- See `references/rest_api_reference.md` (User Management section)\n- See `references/python_client_implementation.md` or `references/nodejs_client_implementation.md`\n\n## Session Management\n\n### Retrieving Session Details\n\nGet comprehensive sleep analysis for a specific session.\n\n```python\nsession = client.get_session(\n    session_id=\"session123\",\n    user_id=\"user123\",\n    timezone=\"America/New_York\"\n)\n\n# Access key metrics\nprint(f\"Sleep efficiency: {session['stat']['sleep_efficiency']:.1f}%\")\nprint(f\"Total sleep time: {session['stat']['sleep_time']}\")\nprint(f\"Sleep stages: {session['session']['sleep_stages']}\")\n```\n\n**Sleep Stage Values:**\n- `-1`: Unknown/No data\n- `0`: Wake\n- `1`: Light sleep\n- `2`: Deep sleep\n- `3`: REM sleep\n\n**Key Metrics:**\n- `sleep_efficiency`: (Total sleep time / Time in bed) × 100%\n- `sleep_latency`: Time to fall asleep (seconds)\n- `waso_count`: Wake after sleep onset episodes\n- `time_in_bed`: Total time in bed (seconds)\n- `time_in_sleep`: Actual sleep time (seconds)\n- `time_in_light/deep/rem`: Stage durations (seconds)\n\n### Listing Sessions\n\nRetrieve multiple sessions with date filtering and pagination.\n\n```python\nsessions = client.list_sessions(\n    user_id=\"user123\",\n    date_gte=\"2024-01-01\",\n    date_lte=\"2024-01-31\",\n    limit=50,\n    order_by=\"DESC\"\n)\n```\n\n**Pagination Example:**\n```python\nall_sessions = []\noffset = 0\nlimit = 100\n\nwhile True:\n    result = client.list_sessions(\n        user_id=\"user123\",\n        offset=offset,\n        limit=limit\n    )\n    sessions = result['sleep_session_list']\n    all_sessions.extend(sessions)\n\n    if len(sessions) < limit:\n        break\n    offset += limit\n```\n\n### Deleting Sessions\n\n```python\nclient.delete_session(session_id=\"session123\", user_id=\"user123\")\n```\n\n**For detailed session data structures and examples:**\n- See `references/rest_api_reference.md` (Session Management section)\n- See client implementation references for language-specific examples\n\n## Statistics and Analytics\n\n### Average Statistics\n\nGet aggregated sleep metrics over a time period (max 100 days).\n\n```python\nstats = client.get_average_stats(\n    user_id=\"user123\",\n    start_date=\"2024-01-01\",\n    end_date=\"2024-01-31\",\n    timezone=\"UTC\"\n)\n\navg = stats['average_stats']\nprint(f\"Average sleep time: {avg['sleep_time']}\")\nprint(f\"Average efficiency: {avg['sleep_efficiency']:.1f}%\")\nprint(f\"Light sleep ratio: {avg['light_ratio']:.1%}\")\nprint(f\"Number of sessions: {len(stats['slept_sessions'])}\")\n```\n\n**Returned Metrics:**\n- Average sleep time, bedtime, wake time\n- Average sleep efficiency\n- Sleep stage ratios (light, deep, REM)\n- List of sessions included in calculation\n\n**For trend analysis and advanced analytics:**\n- See `references/python_client_implementation.md` (Analytics section)\n- See `references/rest_api_reference.md` (Statistics section)\n\n## Webhook Integration\n\nWebhooks enable real-time notifications for sleep session events.\n\n### Webhook Event Types\n\n1. **INFERENCE_COMPLETE**: Incremental sleep data during tracking (every 5-40 minutes)\n2. **SESSION_COMPLETE**: Final comprehensive sleep analysis when session ends\n\n### Setting Up Webhook Endpoint\n\n**Basic Structure:**\n```python\n@app.route('/asleep-webhook', methods=['POST'])\ndef asleep_webhook():\n    # 1. Verify authentication (x-api-key header)\n    # 2. Parse event data\n    # 3. Handle event type (INFERENCE_COMPLETE or SESSION_COMPLETE)\n    # 4. Process and store data\n    # 5. Return 200 response\n    pass\n```\n\n**Key Implementation Points:**\n- Verify `x-api-key` header matches your API key\n- Validate `x-user-id` header\n- Handle both INFERENCE_COMPLETE and SESSION_COMPLETE events\n- Implement idempotency (check if event already processed)\n- Process asynchronously for better performance\n- Return 200 status immediately\n\n**For complete webhook implementations:**\n- Python (Flask): See `references/webhook_implementation_guide.md`\n- Node.js (Express): See `references/webhook_implementation_guide.md`\n- Webhook payloads: See `references/webhook_reference.md`\n\n### Webhook Best Practices\n\n**Idempotency:**\nCheck if webhook event was already processed to avoid duplicates.\n\n**Asynchronous Processing:**\nQueue webhook events for background processing and respond immediately.\n\n**Error Handling:**\nReturn 200 even if processing fails internally to prevent retries.\n\n**For detailed patterns:**\n- See `references/webhook_implementation_guide.md`\n- See `references/production_patterns.md` (Background Jobs section)\n\n## Common Backend Patterns\n\n### 1. API Proxy for Mobile Apps\n\nCreate a backend proxy to:\n- Hide API keys from mobile clients\n- Add custom authentication\n- Implement business logic\n- Track usage and analytics\n\n**Key endpoints:**\n- POST `/api/users` - Create Asleep user for authenticated app user\n- GET `/api/sessions/{id}` - Proxy session retrieval with auth\n- GET `/api/sessions` - List sessions with filtering\n- GET `/api/statistics` - Get aggregated statistics\n\n**For complete implementation:**\n- See `references/python_client_implementation.md` (API Proxy section)\n\n### 2. Analytics Dashboard Backend\n\nAggregate and analyze sleep data across multiple users:\n- Calculate comprehensive sleep scores\n- Generate weekly/monthly reports\n- Analyze cohort sleep patterns\n- Provide personalized insights\n\n**Key features:**\n- Sleep score calculation (efficiency + consistency + duration)\n- Trend analysis over time\n- Multi-user aggregation\n- Report generation\n\n**For complete implementation:**\n- See `references/python_client_implementation.md` (Analytics section)\n\n### 3. Multi-Tenant Application\n\nManage sleep tracking for multiple organizations or teams:\n- Organization-level user management\n- Aggregated organization statistics\n- Role-based access control\n- Per-organization settings\n\n**For complete implementation:**\n- See `references/python_client_implementation.md` (Multi-Tenant section)\n\n## Error Handling\n\n### Common Error Codes\n\n- **401 Unauthorized**: Invalid API key\n- **403 Forbidden**: Rate limit exceeded or insufficient permissions\n- **404 Not Found**: Resource does not exist\n- **422 Unprocessable Entity**: Invalid request parameters\n\n### Retry Logic with Exponential Backoff\n\n```python\ndef retry_with_exponential_backoff(func, max_retries=3, base_delay=1.0):\n    for attempt in range(max_retries):\n        try:\n            return func()\n        except requests.exceptions.HTTPError as e:\n            if e.response.status_code == 403 and \"rate limit\" in str(e):\n                if attempt < max_retries - 1:\n                    delay = min(base_delay * (2 ** attempt), 60.0)\n                    time.sleep(delay)\n                    continue\n            raise\n```\n\n### Custom Exception Classes\n\n```python\nclass AsleepAPIError(Exception):\n    \"\"\"Base exception for Asleep API errors\"\"\"\n    pass\n\nclass RateLimitError(AsleepAPIError):\n    \"\"\"Rate limit exceeded\"\"\"\n    pass\n\nclass ResourceNotFoundError(AsleepAPIError):\n    \"\"\"Resource not found\"\"\"\n    pass\n```\n\n**For comprehensive error handling:**\n- See `references/python_client_implementation.md` or `references/nodejs_client_implementation.md`\n- See `references/production_patterns.md` (Error Recovery section)\n\n## Testing\n\n### Local Webhook Testing\n\nUse ngrok to expose local server for webhook testing:\n\n```bash\n# Start local server\npython app.py  # or npm start\n\n# Expose with ngrok\nngrok http 5000\n\n# Use ngrok URL in webhook configuration\n# Example: https://abc123.ngrok.io/asleep-webhook\n```\n\n### Mock API Responses\n\n```python\n@patch('requests.Session.request')\ndef test_create_user(mock_request):\n    mock_response = Mock()\n    mock_response.json.return_value = {\n        \"result\": {\"user_id\": \"test_user_123\"}\n    }\n    mock_request.return_value = mock_response\n\n    user_id = client.create_user()\n    assert user_id == \"test_user_123\"\n```\n\n**For complete testing examples:**\n- See `references/python_client_implementation.md` (Testing section)\n\n## Production Best Practices\n\n### Security\n\n1. **API Key Management:**\n   - Store in environment variables or secret management system\n   - Never commit to version control\n   - Rotate keys periodically\n   - Use different keys for dev/staging/production\n\n2. **Webhook Security:**\n   - Verify `x-api-key` header\n   - Use HTTPS endpoints only\n   - Implement rate limiting\n   - Log all webhook attempts\n\n3. **User Data Privacy:**\n   - Encrypt sensitive data at rest\n   - Implement proper access controls\n   - Handle data deletion requests\n   - Comply with GDPR/CCPA\n\n### Performance\n\n1. **Caching:** Cache immutable session data\n2. **Rate Limiting:** Protect your backend from overload\n3. **Connection Pooling:** Reuse HTTP connections\n4. **Batch Processing:** Process multiple requests in parallel\n\n### Monitoring\n\n1. **Logging:** Structured logging for all API requests\n2. **Metrics:** Track request duration, error rates, throughput\n3. **Health Checks:** Implement `/health`, `/ready`, `/live` endpoints\n4. **Alerting:** Alert on error rate spikes or API failures\n\n### Deployment\n\n1. **Configuration:** Environment-based settings with validation\n2. **Health Checks:** Support Kubernetes liveness/readiness probes\n3. **Graceful Shutdown:** Handle termination signals properly\n4. **Error Recovery:** Circuit breaker pattern for API failures\n\n**For comprehensive production patterns:**\n- Caching strategies: See `references/production_patterns.md`\n- Rate limiting: See `references/production_patterns.md`\n- Monitoring: See `references/production_patterns.md`\n- Deployment: See `references/production_patterns.md`\n\n## Resources\n\n### Reference Documentation\n\nThis skill includes comprehensive reference files:\n\n- `references/python_client_implementation.md`: Complete Python client with all methods, analytics classes, and examples\n- `references/nodejs_client_implementation.md`: Complete Node.js client with Express integration\n- `references/webhook_implementation_guide.md`: Full webhook handlers in Python and Node.js with best practices\n- `references/rest_api_reference.md`: Complete REST API endpoint documentation with request/response examples\n- `references/webhook_reference.md`: Webhook integration guide with payload structures\n- `references/production_patterns.md`: Caching, rate limiting, monitoring, deployment, and performance optimization\n\nTo access detailed information:\n```\nRead references/python_client_implementation.md\nRead references/nodejs_client_implementation.md\nRead references/webhook_implementation_guide.md\nRead references/rest_api_reference.md\nRead references/webhook_reference.md\nRead references/production_patterns.md\n```\n\n### Official Documentation\n\n- **Main Documentation**: https://docs-en.asleep.ai\n- **API Basics**: https://docs-en.asleep.ai/docs/api-basics.md\n- **Webhook Guide**: https://docs-en.asleep.ai/docs/webhook.md\n- **Dashboard**: https://dashboard.asleep.ai\n- **LLM-Optimized Reference**: https://docs-en.asleep.ai/llms.txt\n\n### Related Skills\n\n- **sleeptrack-foundation**: Core concepts, authentication, data structures, and platform-agnostic patterns\n- **sleeptrack-ios**: iOS SDK integration for native iOS applications\n- **sleeptrack-android**: Android SDK integration for native Android applications\n\n### Support\n\nFor technical support and API issues:\n- Check Dashboard for API usage and status\n- Review error logs and response codes\n- Contact support through Asleep Dashboard"
              },
              {
                "name": "sleeptrack-foundation",
                "description": "This skill provides foundational knowledge about Asleep sleep tracking platform, covering core concepts, authentication, data structures, error handling, and platform-agnostic best practices. Use this skill when developers ask about Asleep fundamentals, API concepts, error codes, sleep data structures, or need to understand how the platform works before implementing platform-specific integration. This skill serves as prerequisite knowledge for sleeptrack-ios, sleeptrack-android, and sleeptrack-be skills.",
                "path": "skills/sleeptrack-foundation/SKILL.md",
                "frontmatter": {
                  "name": "sleeptrack-foundation",
                  "description": "This skill provides foundational knowledge about Asleep sleep tracking platform, covering core concepts, authentication, data structures, error handling, and platform-agnostic best practices. Use this skill when developers ask about Asleep fundamentals, API concepts, error codes, sleep data structures, or need to understand how the platform works before implementing platform-specific integration. This skill serves as prerequisite knowledge for sleeptrack-ios, sleeptrack-android, and sleeptrack-be skills."
                },
                "content": "# Sleeptrack Foundation\n\n## Overview\n\nThis skill provides essential foundational knowledge for integrating the Asleep sleep tracking platform. It covers core concepts, authentication patterns, data structures, error handling, and platform-agnostic best practices that apply across all implementation approaches (iOS, Android, and backend API).\n\nUse this skill when developers need to understand:\n- What Asleep is and how sleep tracking works\n- API authentication and key management\n- Sleep session concepts and lifecycle\n- Data structures (Sessions, Reports, Statistics)\n- Error codes and troubleshooting\n- Platform-agnostic integration patterns\n\n## Core Concepts\n\n### What is Asleep?\n\nAsleep is a sleep tracking platform that analyzes sleep using audio-based monitoring through device microphones. The platform provides:\n\n- **Real-time sleep stage analysis**: Wake, Light, Deep, REM detection\n- **Comprehensive sleep metrics**: Efficiency, latency, total sleep time, wake after sleep onset\n- **Snoring detection and analysis**: Snoring stages and patterns\n- **Multi-platform SDKs**: Native iOS and Android SDKs plus REST API\n- **Dashboard analytics**: Web-based analytics and user management\n\n### User Management\n\nEach application user must be registered with Asleep before tracking sleep.\n\n**Key Points**:\n- User ID is managed by the host application (not generated by Asleep)\n- One user can have multiple sleep sessions\n- User data persists across sessions for trend analysis\n- Users can be created, retrieved, updated, and deleted via API\n\n**Example User ID Schemes**:\n```\n- UUID: \"550e8400-e29b-41d4-a716-446655440000\"\n- Email-based: \"user@example.com\"\n- App-specific: \"app_user_12345\"\n```\n\n### Sleep Sessions\n\nA session represents one complete sleep tracking period from start to stop.\n\n**Session Lifecycle States**:\n1. **IDLE**: No tracking in progress\n2. **INITIALIZING**: SDK preparing resources\n3. **INITIALIZED**: Ready to start tracking\n4. **TRACKING_STARTED**: Active tracking in progress\n5. **TRACKING_STOPPING**: Ending session and uploading data\n\n**Session Requirements**:\n- Minimum tracking duration: 5 minutes for valid session\n- Microphone access required throughout tracking\n- Network connectivity needed for data upload\n- One active session per user at a time\n\n**Real-time Data Access**:\n- Available after sequence 10\n- Check every 10 sequences thereafter\n- Provides preliminary sleep stage data during tracking\n\n### Sleep Reports\n\nReports contain comprehensive analysis of completed sleep sessions.\n\n**Report Structure**:\n```\nReport\n├── Session Metadata\n│   ├── session_id\n│   ├── user_id\n│   ├── start_time\n│   └── end_time\n├── Sleep Stages Timeline\n│   ├── Wake periods\n│   ├── Light sleep periods\n│   ├── Deep sleep periods\n│   └── REM sleep periods\n├── Sleep Statistics\n│   ├── Total sleep time\n│   ├── Time in bed\n│   ├── Sleep efficiency (%)\n│   ├── Sleep latency (time to fall asleep)\n│   ├── Wake after sleep onset (WASO)\n│   ├── Sleep stage durations\n│   └── Sleep stage ratios\n└── Snoring Analysis\n    ├── Snoring detected (yes/no)\n    ├── Snoring stages timeline\n    └── Snoring statistics\n```\n\n**Key Metrics Explained**:\n\n- **Sleep Efficiency**: (Total sleep time / Time in bed) × 100%\n  - Good: > 85%\n  - Fair: 75-85%\n  - Poor: < 75%\n\n- **Sleep Latency**: Time from lying down to falling asleep\n  - Normal: 10-20 minutes\n  - Fast: < 10 minutes (may indicate sleep deprivation)\n  - Slow: > 20 minutes (may indicate insomnia)\n\n- **WASO**: Total wake time after initial sleep onset\n  - Lower is better (indicates fewer disruptions)\n\n### Statistics\n\nAggregated metrics across multiple sessions for trend analysis.\n\n**Available Statistics**:\n- Average sleep duration over time range\n- Average sleep efficiency\n- Sleep stage distribution averages\n- Trends and patterns\n\n**Statistics API**:\n```\nGET /users/{user_id}/statistics/average?from={date}&to={date}\n```\n\n## Authentication\n\n### API Key Management\n\nAll Asleep integrations require an API key for authentication.\n\n**Obtaining an API Key**:\n1. Sign up at https://dashboard.asleep.ai\n2. Navigate to API key generation section\n3. Create API key for the application\n4. Store securely (never commit to version control)\n\n**Using API Keys**:\n\nFor SDK Integration (iOS/Android):\n```kotlin\n// Android\nAsleepConfig.init(\n    apiKey = \"your_api_key_here\",\n    userId = \"user_unique_id\",\n    ...\n)\n```\n\n```swift\n// iOS\nAsleepConfig.init(\n    apiKey: \"your_api_key_here\",\n    userId: \"user_unique_id\",\n    ...\n)\n```\n\nFor REST API Integration:\n```http\nGET /sessions/{session_id}\nX-API-Key: your_api_key_here\n```\n\n**Security Best Practices**:\n- Store API keys in environment variables or secure storage\n- Never hardcode keys in source code\n- Use different keys for development and production\n- Rotate keys periodically\n- Monitor usage in Dashboard to detect unauthorized access\n- Revoke compromised keys immediately\n\n## Error Handling\n\nUnderstanding error codes is critical for robust integration.\n\n### Error Categories\n\n**Critical Errors** (must stop tracking):\nThese errors indicate conditions that prevent continued tracking and require user intervention or code fixes.\n\n**Warning Errors** (can continue tracking):\nThese are transient issues that the SDK handles automatically while tracking continues.\n\n### Error Code Reference\n\n#### Critical Errors\n\n**ERR_MIC_PERMISSION**\n- **Cause**: App lacks microphone access permission\n- **Action**: Request microphone permission from user\n- **Platform Notes**:\n  - Android: Check RECORD_AUDIO permission\n  - iOS: Check NSMicrophoneUsageDescription and authorization status\n\n**ERR_AUDIO**\n- **Cause**: Microphone unavailable or in use by another app\n- **Action**:\n  - Close conflicting apps using microphone\n  - Check microphone hardware functionality\n  - Verify no audio conflicts in device settings\n\n**ERR_INVALID_URL**\n- **Cause**: Malformed API endpoint URL in configuration\n- **Action**: Verify AsleepConfig URL format\n- **Example Fix**: Ensure base URL is valid HTTPS endpoint\n\n**ERR_COMMON_EXPIRED**\n- **Cause**: API rate limit exceeded or subscription plan expired\n- **Action**:\n  - Check Dashboard for plan status\n  - Review API usage patterns\n  - Upgrade plan if needed\n  - Implement rate limiting in application\n\n**ERR_UPLOAD_FORBIDDEN**\n- **Cause**: Multiple simultaneous tracking attempts with same user_id\n- **Action**:\n  - Ensure only one device tracks per user at a time\n  - Check for orphaned sessions\n  - Implement proper session cleanup\n\n**ERR_UPLOAD_NOT_FOUND** / **ERR_CLOSE_NOT_FOUND**\n- **Cause**: Attempting to interact with non-existent or already-ended session\n- **Action**:\n  - Verify session exists before operations\n  - Handle session expiration properly\n  - Implement session state management\n\n#### Warning Errors\n\n**ERR_AUDIO_SILENCED**\n- **Cause**: Audio temporarily unavailable but tracking continues\n- **Impact**: Minimal, SDK handles gracefully\n- **Action**: Log for monitoring, tracking continues\n\n**ERR_AUDIO_UNSILENCED**\n- **Cause**: Audio restored after silence period\n- **Impact**: Tracking resumes normally\n- **Action**: Log for monitoring\n\n**ERR_UPLOAD_FAILED**\n- **Cause**: Network connectivity issue during data upload\n- **Impact**: SDK will retry automatically\n- **Action**:\n  - Verify network connectivity\n  - Check for firewall/proxy issues\n  - Monitor retry success\n\n### Error Handling Patterns\n\n**Distinguish Error Severity**:\n```kotlin\n// Android example\nwhen (errorCode) {\n    in criticalErrors -> {\n        // Stop tracking, notify user\n        stopTracking()\n        showErrorDialog(errorCode)\n    }\n    in warningErrors -> {\n        // Log and continue\n        logWarning(errorCode)\n    }\n}\n```\n\n**Provide User-Friendly Messages**:\n```kotlin\nfun getUserFriendlyMessage(errorCode: AsleepErrorCode): String {\n    return when (errorCode) {\n        ERR_MIC_PERMISSION -> \"Please allow microphone access to track sleep\"\n        ERR_AUDIO -> \"Another app is using the microphone. Please close it and try again\"\n        ERR_COMMON_EXPIRED -> \"Your subscription has expired. Please renew to continue tracking\"\n        // ... more mappings\n    }\n}\n```\n\n**Implement Retry Logic**:\n```kotlin\n// For network-related errors\nsuspend fun uploadWithRetry(maxRetries: Int = 3) {\n    repeat(maxRetries) { attempt ->\n        try {\n            upload()\n            return\n        } catch (e: NetworkException) {\n            if (attempt == maxRetries - 1) throw e\n            delay(2.0.pow(attempt) * 1000) // Exponential backoff\n        }\n    }\n}\n```\n\n## Data Plan Considerations\n\nAsleep operates on different data plans that affect API usage.\n\n**Plan Limits**:\n- Request rate limits\n- Total sessions per month\n- Data retention periods\n- Feature availability\n\n**Monitoring Usage**:\n- Check Dashboard regularly\n- Implement usage tracking in application\n- Set up alerts for approaching limits\n- Plan capacity for user growth\n\n## Integration Workflows\n\n### Typical Integration Flow\n\n1. **Setup Phase**:\n   - Obtain API key from Dashboard\n   - Install SDK (iOS/Android) or configure REST API client\n   - Configure authentication\n\n2. **User Registration**:\n   - Create user in Asleep system\n   - Store user_id mapping in application\n\n3. **Sleep Tracking Session**:\n   - Request necessary permissions\n   - Initialize SDK with user credentials\n   - Start tracking session\n   - Monitor session state\n   - Handle real-time data (optional)\n   - Stop tracking session\n\n4. **Report Generation**:\n   - Wait for report processing (automatic)\n   - Fetch completed report\n   - Display sleep analysis to user\n\n5. **Statistics & Trends**:\n   - Query historical sessions\n   - Calculate aggregated statistics\n   - Display trends over time\n\n### Common Integration Scenarios\n\n**Scenario 1: First-Time User Setup**\n```\nUser downloads app\n  → Request microphone permission\n  → Create Asleep user (POST /users)\n  → Initialize SDK with API key + user_id\n  → Guide user through first tracking session\n```\n\n**Scenario 2: Returning User**\n```\nUser opens app\n  → Load user_id from local storage\n  → Initialize SDK with credentials\n  → Check for existing running session (reconnect if found)\n  → Display previous sleep reports\n```\n\n**Scenario 3: Background Tracking**\n```\nUser starts tracking before sleep\n  → Start foreground service (Android) / background mode (iOS)\n  → Maintain microphone access\n  → Handle app lifecycle events\n  → Continue tracking through sleep\n  → Stop tracking in morning\n  → Process and display report\n```\n\n## Platform Selection Guide\n\nChoose the appropriate integration approach based on application type:\n\n**Use iOS SDK (sleeptrack-ios)**:\n- Native iOS application\n- Need deep iOS integration (Siri, HealthKit, etc.)\n- Require iOS-specific UI patterns\n- Swift/SwiftUI development\n\n**Use Android SDK (sleeptrack-android)**:\n- Native Android application\n- Need Android-specific features (foreground service, etc.)\n- Require Android UI patterns\n- Kotlin/Jetpack Compose development\n\n**Use REST API (sleeptrack-be)**:\n- Backend/server-side integration\n- Multi-platform web application\n- Data aggregation and analytics\n- Webhook-based event processing\n- Cross-platform mobile framework (React Native, Flutter) with custom bridge\n\n## Resources\n\n### Official Documentation\n\n- **Main Documentation**: https://docs-en.asleep.ai\n- **LLM-Optimized Reference**: https://docs-en.asleep.ai/llms.txt\n- **Dashboard**: https://dashboard.asleep.ai\n\n### Key Documentation Pages\n\n- **QuickStart Guide**: https://docs-en.asleep.ai/docs/quickstart.md\n- **Sleep Data Overview**: https://docs-en.asleep.ai/docs/sleep-data.md\n- **System Overview**: https://docs-en.asleep.ai/docs/system-overview.md\n- **API Basics**: https://docs-en.asleep.ai/docs/api-basics.md\n- **Webhook Guide**: https://docs-en.asleep.ai/docs/webhook.md\n- **Sleep Environment Guidelines**: https://docs-en.asleep.ai/docs/sleep-environment-guideline.md\n\n### Platform-Specific Documentation\n\n**Android**:\n- Get Started: https://docs-en.asleep.ai/docs/android-get-started.md\n- Error Codes: https://docs-en.asleep.ai/docs/android-error-codes.md\n- AsleepConfig: https://docs-en.asleep.ai/docs/android-asleep-config.md\n- SleepTrackingManager: https://docs-en.asleep.ai/docs/android-sleep-tracking-manager.md\n\n**iOS**:\n- Get Started: https://docs-en.asleep.ai/docs/ios-get-started.md\n- Error Codes: https://docs-en.asleep.ai/docs/ios-error-codes.md\n- AsleepConfig: https://docs-en.asleep.ai/docs/ios-asleep-config.md\n- SleepTrackingManager: https://docs-en.asleep.ai/docs/ios-sleep-tracking-manager.md\n\n### Reference Files\n\nThis skill includes detailed API reference documentation:\n\n- `references/asleep_api_reference.md`: Comprehensive API endpoint reference, data structures, and integration patterns\n\nTo load this reference for detailed API information:\n```\nRead references/asleep_api_reference.md\n```\n\n## Best Practices Summary\n\n### Security\n- Never expose API keys in client code\n- Implement secure storage for credentials\n- Use HTTPS for all API communications\n- Validate user permissions before operations\n\n### Performance\n- Cache reports when appropriate\n- Batch API requests to respect rate limits\n- Implement efficient session state management\n- Monitor real-time data access patterns\n\n### User Experience\n- Provide clear permission rationales\n- Show friendly error messages\n- Display progress during tracking\n- Handle app lifecycle gracefully\n\n### Reliability\n- Implement comprehensive error handling\n- Add retry logic for transient failures\n- Log errors for debugging\n- Test edge cases (interruptions, low battery, etc.)\n\n### Data Management\n- Clean up old sessions appropriately\n- Respect user privacy and data retention\n- Implement proper user deletion flows\n- Backup critical session data\n\n## Next Steps\n\nAfter understanding these foundational concepts, proceed to platform-specific skills:\n\n- **iOS Development**: Use `sleeptrack-ios` skill\n- **Android Development**: Use `sleeptrack-android` skill\n- **Backend API Integration**: Use `sleeptrack-be` skill\n\nEach platform-specific skill builds on this foundation with implementation details, code examples, and platform-specific patterns."
              },
              {
                "name": "sleeptrack-ios",
                "description": "This skill helps iOS developers integrate the Asleep SDK for sleep tracking functionality. Use this skill when building native iOS apps with Swift/SwiftUI that need sleep tracking capabilities, implementing delegate patterns, configuring iOS permissions (microphone, notifications, background modes), managing tracking lifecycle, integrating Siri Shortcuts, or working with Combine framework for reactive state management.",
                "path": "skills/sleeptrack-ios/SKILL.md",
                "frontmatter": {
                  "name": "sleeptrack-ios",
                  "description": "This skill helps iOS developers integrate the Asleep SDK for sleep tracking functionality. Use this skill when building native iOS apps with Swift/SwiftUI that need sleep tracking capabilities, implementing delegate patterns, configuring iOS permissions (microphone, notifications, background modes), managing tracking lifecycle, integrating Siri Shortcuts, or working with Combine framework for reactive state management."
                },
                "content": "# Sleeptrack iOS\n\n## Overview\n\nThis skill provides comprehensive guidance for integrating the Asleep SDK into native iOS applications using Swift and SwiftUI. It covers SDK setup, iOS-specific permissions, delegate-based architecture, tracking lifecycle management, Combine framework integration, and Siri Shortcuts support.\n\nUse this skill when:\n- Building native iOS sleep tracking applications\n- Implementing SwiftUI-based tracking interfaces\n- Managing iOS permissions and background modes\n- Working with delegate patterns for SDK callbacks\n- Integrating Siri Shortcuts for voice-activated tracking\n- Using Combine framework for reactive state management\n\n**Prerequisites**: Developers should first review the `sleeptrack-foundation` skill to understand core Asleep concepts, authentication, data structures, and error handling before implementing iOS-specific integration.\n\n## Quick Start\n\n### 1. Installation\n\nAdd AsleepSDK to your Xcode project using Swift Package Manager:\n\n```swift\n// In Xcode: File → Add Packages\n// Enter package URL: https://github.com/asleep-ai/asleep-sdk-ios\n```\n\nOr add to `Package.swift`:\n\n```swift\ndependencies: [\n    .package(url: \"https://github.com/asleep-ai/asleep-sdk-ios\", from: \"2.0.0\")\n]\n```\n\n### 2. Configure iOS Permissions\n\nAdd required permissions to `Info.plist`:\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n    <!-- Microphone access for audio-based sleep tracking -->\n    <key>NSMicrophoneUsageDescription</key>\n    <string>This app uses your microphone to track sleep stages and detect snoring during sleep.</string>\n\n    <!-- Background audio mode for continuous tracking -->\n    <key>UIBackgroundModes</key>\n    <array>\n        <string>audio</string>\n    </array>\n\n    <!-- Optional: For notification reminders -->\n    <key>NSUserNotificationsUsageDescription</key>\n    <string>Get reminders to start and stop sleep tracking.</string>\n</dict>\n</plist>\n```\n\n### 3. Basic Setup\n\n```swift\nimport SwiftUI\nimport AsleepSDK\n\n@main\nstruct SleepTrackerApp: App {\n    var body: some Scene {\n        WindowGroup {\n            MainView()\n        }\n    }\n}\n```\n\n## SDK Architecture\n\nThe Asleep iOS SDK follows a delegate-based architecture with three main components:\n\n### 1. AsleepConfig - Configuration and User Management\n\n**Purpose**: Initialize SDK with API credentials and manage user lifecycle.\n\n**Key Delegate**: `AsleepConfigDelegate`\n\n```swift\nprotocol AsleepConfigDelegate {\n    func userDidJoin(userId: String, config: Asleep.Config)\n    func didFailUserJoin(error: Asleep.AsleepError)\n    func userDidDelete(userId: String)\n}\n```\n\n### 2. SleepTrackingManager - Tracking Lifecycle\n\n**Purpose**: Control sleep tracking start, stop, and monitor session state.\n\n**Key Delegate**: `AsleepSleepTrackingManagerDelegate`\n\n```swift\nprotocol AsleepSleepTrackingManagerDelegate {\n    func didCreate()                          // Session created\n    func didUpload(sequence: Int)             // Data uploaded\n    func didClose(sessionId: String)          // Tracking stopped\n    func didFail(error: Asleep.AsleepError)  // Error occurred\n    func didInterrupt()                       // Interrupted (e.g., phone call)\n    func didResume()                          // Resumed after interruption\n    func micPermissionWasDenied()             // Mic permission denied\n    func analysing(session: Asleep.Model.Session) // Real-time data (optional)\n}\n```\n\n### 3. Reports - Retrieving Sleep Data\n\n**Purpose**: Fetch sleep reports and session lists after tracking completes.\n\n```swift\n// Reports API is async/await based, not delegate-driven\nlet reports = Asleep.createReports(config: config)\n\n// Get single report\nlet report = try await reports.report(sessionId: \"session_id\")\n\n// Get report list\nlet reportList = try await reports.reports(\n    fromDate: \"2024-01-01\",\n    toDate: \"2024-01-31\"\n)\n```\n\n## Implementation Overview\n\n### Minimal ViewModel Example\n\n```swift\nimport Foundation\nimport Combine\nimport AsleepSDK\n\nfinal class SleepTrackingViewModel: ObservableObject {\n    private(set) var trackingManager: Asleep.SleepTrackingManager?\n    private(set) var reports: Asleep.Reports?\n\n    @Published var isTracking = false\n    @Published var error: String?\n    @Published private(set) var config: Asleep.Config?\n\n    func initAsleepConfig(apiKey: String, userId: String) {\n        Asleep.initAsleepConfig(\n            apiKey: apiKey,\n            userId: userId,\n            delegate: self\n        )\n    }\n\n    func startTracking() {\n        trackingManager?.startTracking()\n    }\n\n    func stopTracking() {\n        trackingManager?.stopTracking()\n    }\n}\n\n// Implement delegates\nextension SleepTrackingViewModel: AsleepConfigDelegate {\n    func userDidJoin(userId: String, config: Asleep.Config) {\n        Task { @MainActor in\n            self.config = config\n            self.trackingManager = Asleep.createSleepTrackingManager(\n                config: config,\n                delegate: self\n            )\n        }\n    }\n\n    func didFailUserJoin(error: Asleep.AsleepError) {\n        Task { @MainActor in\n            self.error = error.localizedDescription\n        }\n    }\n\n    func userDidDelete(userId: String) {\n        // Handle user deletion\n    }\n}\n\nextension SleepTrackingViewModel: AsleepSleepTrackingManagerDelegate {\n    func didCreate() {\n        Task { @MainActor in\n            self.isTracking = true\n        }\n    }\n\n    func didClose(sessionId: String) {\n        Task { @MainActor in\n            self.isTracking = false\n            // Initialize reports to fetch session data\n            self.reports = Asleep.createReports(config: config!)\n        }\n    }\n\n    func didFail(error: Asleep.AsleepError) {\n        Task { @MainActor in\n            self.error = error.localizedDescription\n        }\n    }\n\n    // Implement other delegate methods as needed\n}\n```\n\nFor complete ViewModel implementation with all delegate methods, see [references/complete_viewmodel_implementation.md](references/complete_viewmodel_implementation.md)\n\n## iOS-Specific Features\n\n### 1. Siri Shortcuts\n\nEnable voice-activated tracking with App Intents (iOS 16+). Users can say \"Hey Siri, start sleep\" or \"Hey Siri, stop sleep\".\n\nFor complete Siri Shortcuts implementation, see [references/ios_specific_features.md](references/ios_specific_features.md#siri-shortcuts-integration)\n\n### 2. Background Audio Mode\n\nConfigure background audio to maintain tracking during sleep. Simply add `audio` to `UIBackgroundModes` in Info.plist - iOS handles the rest automatically.\n\nFor details, see [references/ios_specific_features.md](references/ios_specific_features.md#background-audio-mode)\n\n### 3. Microphone Permission\n\nRequest microphone permission before starting tracking:\n\n```swift\nimport AVFoundation\n\nfunc requestMicrophonePermission() async -> Bool {\n    switch AVAudioSession.sharedInstance().recordPermission {\n    case .granted: return true\n    case .denied: return false\n    case .undetermined:\n        return await AVAudioSession.sharedInstance().requestRecordPermission()\n    @unknown default: return false\n    }\n}\n```\n\nFor complete permission handling, see [references/ios_specific_features.md](references/ios_specific_features.md#microphone-permission-handling)\n\n### 4. App Lifecycle Management\n\nHandle app state transitions using SwiftUI's `scenePhase`:\n\n```swift\nstruct SleepTrackingView: View {\n    @Environment(\\.scenePhase) private var scenePhase\n\n    var body: some View {\n        // ... view content ...\n        .onChange(of: scenePhase) { newPhase in\n            switch newPhase {\n            case .active: print(\"App is active\")\n            case .inactive: print(\"App is inactive\")\n            case .background: print(\"App in background - tracking continues\")\n            @unknown default: break\n            }\n        }\n    }\n}\n```\n\nFor advanced lifecycle patterns, see [references/ios_specific_features.md](references/ios_specific_features.md#app-lifecycle-management)\n\n### 5. Persistent Storage\n\nStore configuration using AppStorage:\n\n```swift\nstruct SleepTrackingView: View {\n    @AppStorage(\"sleepapp+apikey\") private var apiKey = \"\"\n    @AppStorage(\"sleepapp+userid\") private var userId = \"\"\n    // Values automatically persist across app launches\n}\n```\n\n## Error Handling\n\n### Common Error Patterns\n\n```swift\nfunc handleError(_ error: Asleep.AsleepError) {\n    switch error {\n    case .micPermission:\n        // Guide user to Settings\n        showMicPermissionAlert()\n\n    case .audioSessionError:\n        // Another app is using microphone\n        showAudioUnavailableAlert()\n\n    case let .httpStatus(code, _, message):\n        switch code {\n        case 403: // Session already active on another device\n        case 404: // Session not found\n        default: break\n        }\n\n    default:\n        showGenericError(error.localizedDescription)\n    }\n}\n```\n\n### Retry with Exponential Backoff\n\n```swift\nfunc startTrackingWithRetry() {\n    trackingManager?.startTracking()\n}\n\nfunc didFail(error: Asleep.AsleepError) {\n    if isTransientError(error) && retryCount < maxRetries {\n        retryCount += 1\n        DispatchQueue.main.asyncAfter(deadline: .now() + pow(2.0, Double(retryCount))) {\n            self.startTrackingWithRetry()\n        }\n    } else {\n        handleError(error)\n    }\n}\n```\n\nFor comprehensive error handling patterns, see [references/advanced_patterns.md](references/advanced_patterns.md#error-recovery-patterns)\n\n## Best Practices\n\n### 1. State Management\n\nUse `@Published` properties for reactive UI updates:\n\n```swift\nfinal class SleepTrackingViewModel: ObservableObject {\n    @Published var isTracking = false\n    @Published var error: String?\n    // UI automatically updates when values change\n}\n```\n\n### 2. Main Thread Safety\n\nAlways update UI on main thread:\n\n```swift\nfunc didCreate() {\n    Task { @MainActor in  // Ensures main thread\n        self.isTracking = true\n    }\n}\n```\n\n### 3. Resource Cleanup\n\n```swift\nfinal class SleepTrackingViewModel: ObservableObject {\n    deinit {\n        trackingManager = nil\n        reports = nil\n    }\n}\n```\n\n### 4. User Experience\n\nProvide clear visual feedback with loading states, progress indicators, and error messages. Disable controls appropriately during tracking.\n\n### 5. Testing Considerations\n\nUse dependency injection for testable code:\n\n```swift\nprotocol SleepTrackingManagerProtocol {\n    func startTracking()\n    func stopTracking()\n}\n\n// Production and mock implementations\n```\n\nFor complete testing patterns, see [references/advanced_patterns.md](references/advanced_patterns.md#testing-patterns)\n\n## Common Integration Patterns\n\n### Pattern 1: Simple Single-View App\n\nBest for basic sleep tracking with minimal features. Single view with tracking controls.\n\n### Pattern 2: Multi-View App with Navigation\n\nBest for apps with reports, settings, and history. Uses TabView for navigation between Track, History, and Settings.\n\n### Pattern 3: Centralized SDK Manager\n\nBest for complex apps sharing SDK instance across views. Single source of truth with `AsleepSDKManager.shared`.\n\nFor complete implementation of all patterns, see [references/advanced_patterns.md](references/advanced_patterns.md)\n\n## Real-time Data Access\n\nAccess preliminary sleep data during tracking (available after sequence 10):\n\n```swift\nfunc analysing(session: Asleep.Model.Session) {\n    Task { @MainActor in\n        if let sleepStages = session.sleepStages {\n            updateRealtimeChart(stages: sleepStages)\n        }\n    }\n}\n\nfunc didUpload(sequence: Int) {\n    // Real-time data available every 10 sequences after sequence 10\n    if sequence >= 10 && sequence % 10 == 0 {\n        // SDK automatically calls analysing() delegate\n    }\n}\n```\n\n## Fetching Reports\n\nRetrieve sleep session data after tracking:\n\n```swift\nfunc fetchReport(sessionId: String) async {\n    do {\n        let report = try await reports?.report(sessionId: sessionId)\n        // Process report data\n    } catch {\n        // Handle error\n    }\n}\n\n// Fetch multiple sessions\nfunc fetchReportList() async {\n    let reportList = try await reports?.reports(\n        fromDate: \"2024-01-01\",\n        toDate: \"2024-01-31\"\n    )\n}\n```\n\n## Troubleshooting\n\n### Tracking Doesn't Start\n\n**Causes**: Missing microphone permission, empty API key/user ID, another app using microphone\n\n**Solution**: Validate configuration and check microphone permission before starting\n\n### Background Tracking Stops\n\n**Causes**: Background audio mode not configured, memory pressure, force-closed app\n\n**Solution**: Ensure `UIBackgroundModes` includes `audio` in Info.plist\n\n### Reports Not Available\n\n**Causes**: Session processing incomplete (takes time), minimum duration not met (5 minutes), network issues\n\n**Solution**: Implement retry logic with exponential backoff when fetching reports\n\nFor detailed troubleshooting, see the complete implementation examples in references/\n\n## Sample Code Reference\n\nThis skill is based on the official Asleep iOS sample app:\n\n- **MainViewModel.swift**: Complete ViewModel with all delegates\n- **MainView.swift**: SwiftUI view with tracking controls\n- **StartSleepIntent.swift / StopSleepIntent.swift**: Siri Shortcuts\n- **ReportView.swift**: Sleep report display\n- **Info.plist**: Required iOS permissions\n\nSample app: [Asleep iOS Sample App](https://github.com/asleep-ai/asleep-sdk-ios-sampleapp-public)\n\n## Resources\n\n### Official Documentation\n\n- **iOS Get Started**: https://docs-en.asleep.ai/docs/ios-get-started.md\n- **iOS Error Codes**: https://docs-en.asleep.ai/docs/ios-error-codes.md\n- **AsleepConfig Reference**: https://docs-en.asleep.ai/docs/ios-asleep-config.md\n- **SleepTrackingManager Reference**: https://docs-en.asleep.ai/docs/ios-sleep-tracking-manager.md\n- **Sample App Guide**: https://docs-en.asleep.ai/docs/sample-app.md\n\n### Apple Documentation\n\n- **SwiftUI**: https://developer.apple.com/documentation/swiftui\n- **Combine**: https://developer.apple.com/documentation/combine\n- **AVAudioSession**: https://developer.apple.com/documentation/avfaudio/avaudiosession\n- **App Intents**: https://developer.apple.com/documentation/appintents\n- **Background Modes**: https://developer.apple.com/documentation/xcode/configuring-background-execution-modes\n\n### Related Skills\n\n- **sleeptrack-foundation**: Core Asleep concepts, authentication, and data structures\n- **sleeptrack-android**: Android-specific implementation guide\n- **sleeptrack-be**: Backend API integration\n\n## Next Steps\n\nAfter integrating the iOS SDK:\n\n1. Test thoroughly across different iOS devices and versions\n2. Implement proper error handling for all edge cases\n3. Add user-friendly error messages and recovery flows\n4. Consider HealthKit integration for data export\n5. Implement notification reminders for tracking\n6. Add data visualization for sleep trends\n7. Consider Apple Watch companion app\n8. Submit to App Store with proper privacy declarations"
              }
            ]
          }
        ]
      }
    }
  ]
}