{
  "owner": {
    "id": "basher83",
    "display_name": "basher83",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/129473091?v=4",
    "url": "https://github.com/basher83",
    "bio": "I'm a proud US Army veteran with 23+ years of experience in IT, spanning global telecom, network security, and enterprise systems.",
    "stats": {
      "total_repos": 1,
      "total_plugins": 11,
      "total_commands": 63,
      "total_skills": 63,
      "total_stars": 10,
      "total_forks": 1
    }
  },
  "repos": [
    {
      "full_name": "basher83/lunar-claude",
      "url": "https://github.com/basher83/lunar-claude",
      "description": "Repo for my personal Claude Code configs",
      "homepage": null,
      "signals": {
        "stars": 10,
        "forks": 1,
        "pushed_at": "2026-01-12T18:08:17Z",
        "created_at": "2025-10-24T02:41:21Z",
        "license": "MIT"
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 5790
        },
        {
          "path": ".claude",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/agents/agent-sdk-verifier.md",
          "type": "blob",
          "size": 6143
        },
        {
          "path": ".claude/agents/ansible-strategy-planner.md",
          "type": "blob",
          "size": 8324
        },
        {
          "path": ".claude/agents/jina-search.md",
          "type": "blob",
          "size": 2749
        },
        {
          "path": ".claude/agents/markdown-fixer.md",
          "type": "blob",
          "size": 2903
        },
        {
          "path": ".claude/agents/markdown-investigator.md",
          "type": "blob",
          "size": 4061
        },
        {
          "path": ".claude/agents/markdown-orchestrator.md",
          "type": "blob",
          "size": 2034
        },
        {
          "path": ".claude/agents/pr-message-reviewer.md",
          "type": "blob",
          "size": 8132
        },
        {
          "path": ".claude/agents/project-goal-evaluator.md",
          "type": "blob",
          "size": 4629
        },
        {
          "path": ".claude/agents/skill-audit-agent.md",
          "type": "blob",
          "size": 11616
        },
        {
          "path": ".claude/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/commands/convert-to-agent.md",
          "type": "blob",
          "size": 7699
        },
        {
          "path": ".claude/commands/convert-to-slash.md",
          "type": "blob",
          "size": 7006
        },
        {
          "path": ".claude/commands/design-validation",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/commands/design-validation/adr-alternatives-analysis.md",
          "type": "blob",
          "size": 6563
        },
        {
          "path": ".claude/commands/design-validation/build-vs-integrate-swot.md",
          "type": "blob",
          "size": 6569
        },
        {
          "path": ".claude/commands/design-validation/comprehensive-design-review.md",
          "type": "blob",
          "size": 5561
        },
        {
          "path": ".claude/commands/design-validation/landscape-research-protocol.md",
          "type": "blob",
          "size": 7284
        },
        {
          "path": ".claude/commands/design-validation/premortem-design-validation.md",
          "type": "blob",
          "size": 5574
        },
        {
          "path": ".claude/commands/design-validation/self-critique-design-review.md",
          "type": "blob",
          "size": 5483
        },
        {
          "path": ".claude/commands/research-validation",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/commands/research-validation/parallel-poc.md",
          "type": "blob",
          "size": 1439
        },
        {
          "path": ".claude/commands/verify-pr.md",
          "type": "blob",
          "size": 7656
        },
        {
          "path": ".claude/git-workflow-command-testing.local.md",
          "type": "blob",
          "size": 6925
        },
        {
          "path": ".claude/git-workflow-plugin-review.local.md",
          "type": "blob",
          "size": 7168
        },
        {
          "path": ".claude/hookify.prevent-audit-taint.local.md",
          "type": "blob",
          "size": 1937
        },
        {
          "path": ".claude/hookify.require-uv.local.md",
          "type": "blob",
          "size": 644
        },
        {
          "path": ".claude/hookify.skill-forced-eval.local.md",
          "type": "blob",
          "size": 1029
        },
        {
          "path": ".claude/plugin-dev-bugs.local.md",
          "type": "blob",
          "size": 1281
        },
        {
          "path": ".claude/plugin-dev-considerations.local.md",
          "type": "blob",
          "size": 6258
        },
        {
          "path": ".claude/rules",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/rules/audit-protocol.md",
          "type": "blob",
          "size": 986
        },
        {
          "path": ".claude/rules/documentation.md",
          "type": "blob",
          "size": 1274
        },
        {
          "path": ".claude/rules/plugin-structure.md",
          "type": "blob",
          "size": 1658
        },
        {
          "path": ".claude/rules/python-scripts.md",
          "type": "blob",
          "size": 1057
        },
        {
          "path": ".claude/rules/skill-development.md",
          "type": "blob",
          "size": 2028
        },
        {
          "path": ".claude/settings.json",
          "type": "blob",
          "size": 467
        },
        {
          "path": ".claude/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/crawl4ai",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/crawl4ai/SKILL.md",
          "type": "blob",
          "size": 15248
        },
        {
          "path": ".claude/skills/crawl4ai/references",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/crawl4ai/references/complete-sdk-reference.md",
          "type": "blob",
          "size": 224524
        },
        {
          "path": ".claude/skills/crawl4ai/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/crawl4ai/scripts/basic_crawler.py",
          "type": "blob",
          "size": 2660
        },
        {
          "path": ".claude/skills/crawl4ai/scripts/batch_crawler.py",
          "type": "blob",
          "size": 7674
        },
        {
          "path": ".claude/skills/crawl4ai/scripts/extraction_pipeline.py",
          "type": "blob",
          "size": 13312
        },
        {
          "path": ".claude/skills/crawl4ai/tests",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/crawl4ai/tests/README.md",
          "type": "blob",
          "size": 1400
        },
        {
          "path": ".claude/skills/crawl4ai/tests/run_all_tests.py",
          "type": "blob",
          "size": 1415
        },
        {
          "path": ".claude/skills/crawl4ai/tests/test_advanced_patterns.py",
          "type": "blob",
          "size": 2233
        },
        {
          "path": ".claude/skills/crawl4ai/tests/test_basic_crawling.py",
          "type": "blob",
          "size": 1594
        },
        {
          "path": ".claude/skills/crawl4ai/tests/test_data_extraction.py",
          "type": "blob",
          "size": 2189
        },
        {
          "path": ".claude/skills/crawl4ai/tests/test_markdown_generation.py",
          "type": "blob",
          "size": 3123
        },
        {
          "path": ".claude/skills/doc-generator",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/skills/doc-generator/SKILL.md",
          "type": "blob",
          "size": 2571
        },
        {
          "path": ".coderabbit.yaml",
          "type": "blob",
          "size": 8148
        },
        {
          "path": ".cursor",
          "type": "tree",
          "size": null
        },
        {
          "path": ".cursor/plans",
          "type": "tree",
          "size": null
        },
        {
          "path": ".cursor/plans/rumdl-python-sdk-and-mcp-69b61dd5.plan.md",
          "type": "blob",
          "size": 9636
        },
        {
          "path": ".cursor/rules",
          "type": "tree",
          "size": null
        },
        {
          "path": ".cursor/rules/github-content.mdc",
          "type": "blob",
          "size": 3374
        },
        {
          "path": ".cursor/rules/jina.mdc",
          "type": "blob",
          "size": 6685
        },
        {
          "path": ".cursor/worktrees.json",
          "type": "blob",
          "size": 57
        },
        {
          "path": ".github",
          "type": "tree",
          "size": null
        },
        {
          "path": ".github/workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": ".github/workflows/pr-check.yml",
          "type": "blob",
          "size": 2353
        },
        {
          "path": ".github/workflows/release.yml",
          "type": "blob",
          "size": 1902
        },
        {
          "path": ".gitignore",
          "type": "blob",
          "size": 190
        },
        {
          "path": ".infisical.json",
          "type": "blob",
          "size": 135
        },
        {
          "path": ".pre-commit-config.yaml",
          "type": "blob",
          "size": 1316
        },
        {
          "path": ".rumdl.toml",
          "type": "blob",
          "size": 474
        },
        {
          "path": ".safety-project.ini",
          "type": "blob",
          "size": 87
        },
        {
          "path": "CHANGELOG.md",
          "type": "blob",
          "size": 29816
        },
        {
          "path": "CLAUDE.md",
          "type": "blob",
          "size": 1649
        },
        {
          "path": "LICENSE",
          "type": "blob",
          "size": 1065
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 4908
        },
        {
          "path": "ai_docs",
          "type": "tree",
          "size": null
        },
        {
          "path": "ai_docs/Python-uv-Script-Examples-and-References.md",
          "type": "blob",
          "size": 9538
        },
        {
          "path": "ai_docs/README.md",
          "type": "blob",
          "size": 1509
        },
        {
          "path": "ai_docs/continuous-improvement",
          "type": "tree",
          "size": null
        },
        {
          "path": "ai_docs/continuous-improvement/lessons-learned-2025-11-08.md",
          "type": "blob",
          "size": 9715
        },
        {
          "path": "ai_docs/continuous-improvement/lessons-learned-raw-data.md",
          "type": "blob",
          "size": 7103
        },
        {
          "path": "ai_docs/continuous-improvement/rules.md",
          "type": "blob",
          "size": 2027
        },
        {
          "path": "ai_docs/firecrawl-python-sdk.md",
          "type": "blob",
          "size": 7918
        },
        {
          "path": "ai_docs/firecrawl-scrape-github.md",
          "type": "blob",
          "size": null
        },
        {
          "path": "ai_docs/gitingest.md",
          "type": "blob",
          "size": 12216
        },
        {
          "path": "ai_docs/monorepo-marketplace.md",
          "type": "blob",
          "size": 5362
        },
        {
          "path": "ai_docs/verify-structure-analysis.md",
          "type": "blob",
          "size": 13421
        },
        {
          "path": "cliff.toml",
          "type": "blob",
          "size": 3999
        },
        {
          "path": "docs",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/TODO.md",
          "type": "blob",
          "size": 3941
        },
        {
          "path": "docs/architecture",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/architecture/intelligent-markdown-linting-agent.md",
          "type": "blob",
          "size": 18778
        },
        {
          "path": "docs/checklists",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/checklists/claude.md-validation-checklist.md",
          "type": "blob",
          "size": 15329
        },
        {
          "path": "docs/checklists/sdk-validation-checklist.md",
          "type": "blob",
          "size": 10843
        },
        {
          "path": "docs/checklists/slash-command-validation-checklist.md",
          "type": "blob",
          "size": 13075
        },
        {
          "path": "docs/checklists/subagent-validation-checklist.md",
          "type": "blob",
          "size": 16175
        },
        {
          "path": "docs/developer",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/developer/coderabbit.md",
          "type": "blob",
          "size": 44103
        },
        {
          "path": "docs/developer/git-cliff-configuration.md",
          "type": "blob",
          "size": 31980
        },
        {
          "path": "docs/developer/new-project-setup.md",
          "type": "blob",
          "size": 1016
        },
        {
          "path": "docs/ideas",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/ideas/create-review-validate.md",
          "type": "blob",
          "size": 3388
        },
        {
          "path": "docs/ideas/docs-maint-agent.md",
          "type": "blob",
          "size": 17330
        },
        {
          "path": "docs/ideas/extend-deepwiki.md",
          "type": "blob",
          "size": 1405
        },
        {
          "path": "docs/ideas/ideas.md",
          "type": "blob",
          "size": 2493
        },
        {
          "path": "docs/ideas/markdown-agent.md",
          "type": "blob",
          "size": 4401
        },
        {
          "path": "docs/notes",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/notes/ai-failure-mode-pattern.md",
          "type": "blob",
          "size": 2831
        },
        {
          "path": "docs/notes/checklists-and-templates-best-practices.md",
          "type": "blob",
          "size": 14129
        },
        {
          "path": "docs/notes/checklists-templates-subagent-pattern.md",
          "type": "blob",
          "size": 16213
        },
        {
          "path": "docs/notes/claude-mem-usage-guide.md",
          "type": "blob",
          "size": 18494
        },
        {
          "path": "docs/notes/core-4-analysis.md",
          "type": "blob",
          "size": 20947
        },
        {
          "path": "docs/notes/debug-skill-auidtor-agent.md",
          "type": "blob",
          "size": 874
        },
        {
          "path": "docs/notes/deep-dive-prompt.md",
          "type": "blob",
          "size": 416
        },
        {
          "path": "docs/notes/emergence-analysis-2025-11-06.md",
          "type": "blob",
          "size": 13931
        },
        {
          "path": "docs/notes/github-issue-path-matching-bug-review.md",
          "type": "blob",
          "size": 2250
        },
        {
          "path": "docs/notes/github-issue-path-matching-bug.md",
          "type": "blob",
          "size": 11775
        },
        {
          "path": "docs/notes/issue-73-maintainer-feedback.md",
          "type": "blob",
          "size": 6385
        },
        {
          "path": "docs/notes/issue-73-patch-verification.md",
          "type": "blob",
          "size": 22318
        },
        {
          "path": "docs/notes/issue-73-test-plan.md",
          "type": "blob",
          "size": 6750
        },
        {
          "path": "docs/notes/metacognitive-scaffolding-session-2025-11-05.md",
          "type": "blob",
          "size": 10606
        },
        {
          "path": "docs/notes/omni-scale.md",
          "type": "blob",
          "size": 11626
        },
        {
          "path": "docs/notes/opps-i-did-it-again.md",
          "type": "blob",
          "size": 68720
        },
        {
          "path": "docs/notes/plan1-v-2.md",
          "type": "blob",
          "size": 11625
        },
        {
          "path": "docs/notes/prompts.md",
          "type": "blob",
          "size": 9495
        },
        {
          "path": "docs/notes/skill-auditor-improvements-v2.md",
          "type": "blob",
          "size": 23661
        },
        {
          "path": "docs/notes/skill-auditor-improvements.md",
          "type": "blob",
          "size": 28474
        },
        {
          "path": "docs/notes/skill-creator-testing.md",
          "type": "blob",
          "size": 72291
        },
        {
          "path": "docs/notes/task-6-implementation-report.md",
          "type": "blob",
          "size": 7511
        },
        {
          "path": "docs/notes/task-8-validation-summary.md",
          "type": "blob",
          "size": 8933
        },
        {
          "path": "docs/notes/token-efficiency-architectural-patterns.md",
          "type": "blob",
          "size": 22407
        },
        {
          "path": "docs/notes/workflow-analysis-2.md",
          "type": "blob",
          "size": 29128
        },
        {
          "path": "docs/notes/workflow-analysis.md",
          "type": "blob",
          "size": 15710
        },
        {
          "path": "docs/plans",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/plans/2025-01-19-skill-auditor-fixes.md",
          "type": "blob",
          "size": 37387
        },
        {
          "path": "docs/plans/2025-01-19-skill-auditor-sdk.md",
          "type": "blob",
          "size": 23974
        },
        {
          "path": "docs/plans/2025-10-24-documentation-agent-design.md",
          "type": "blob",
          "size": 14430
        },
        {
          "path": "docs/plans/2025-10-24-marketplace-implementation.md",
          "type": "blob",
          "size": 48008
        },
        {
          "path": "docs/plans/2025-10-24-marketplace-structure-design.md",
          "type": "blob",
          "size": 5276
        },
        {
          "path": "docs/plans/2025-10-29-claude-docs-sync-implementation.md",
          "type": "blob",
          "size": 20609
        },
        {
          "path": "docs/plans/2025-10-29-claude-docs-sync-plugin-design.md",
          "type": "blob",
          "size": 7954
        },
        {
          "path": "docs/plans/2025-10-31-python-tools-expansion-design.md",
          "type": "blob",
          "size": 6942
        },
        {
          "path": "docs/plans/2025-10-31-python-tools-expansion.md",
          "type": "blob",
          "size": 34476
        },
        {
          "path": "docs/plans/2025-11-02-intelligent-markdown-linting-agent-mvp.md",
          "type": "blob",
          "size": 47142
        },
        {
          "path": "docs/plans/2025-11-06-plugin-auditor-design.md",
          "type": "blob",
          "size": 8492
        },
        {
          "path": "docs/plans/2025-11-06-research-pipeline-design-feedback.md",
          "type": "blob",
          "size": 20336
        },
        {
          "path": "docs/plans/2025-11-06-research-pipeline-design.md",
          "type": "blob",
          "size": 23164
        },
        {
          "path": "docs/plans/2025-11-07-coderabbit-configuration-design.md",
          "type": "blob",
          "size": 8113
        },
        {
          "path": "docs/plans/2025-11-07-coderabbit-configuration.md",
          "type": "blob",
          "size": 16859
        },
        {
          "path": "docs/plans/2025-11-07-coding-challenge-evaluation-design.md",
          "type": "blob",
          "size": 15214
        },
        {
          "path": "docs/plans/2025-11-09-command-audit-design.md",
          "type": "blob",
          "size": 6742
        },
        {
          "path": "docs/plans/2025-11-09-command-audit-implementation.md",
          "type": "blob",
          "size": 29076
        },
        {
          "path": "docs/plans/2025-11-14-fix-pr15-critical-issues.md",
          "type": "blob",
          "size": 31600
        },
        {
          "path": "docs/plans/2025-11-14-verify-structure-enhancements-design.md",
          "type": "blob",
          "size": 16744
        },
        {
          "path": "docs/plans/2025-11-14-verify-structure-enhancements.md",
          "type": "blob",
          "size": 35154
        },
        {
          "path": "docs/plans/2025-11-16-skill-factory-design.md",
          "type": "blob",
          "size": 28438
        },
        {
          "path": "docs/plans/2025-11-20-skill-auditor-pattern-enhancement.md",
          "type": "blob",
          "size": 21422
        },
        {
          "path": "docs/plans/2025-12-01-research-pipeline-v2-design-feedback.md",
          "type": "blob",
          "size": 38095
        },
        {
          "path": "docs/plans/2025-12-01-research-pipeline-v2-design.md",
          "type": "blob",
          "size": 19691
        },
        {
          "path": "docs/plans/2025-12-01-research-pipeline-v2-implementation.md",
          "type": "blob",
          "size": 13703
        },
        {
          "path": "docs/plans/2025-12-02-research-pipeline-v2-phase-0-validation.md",
          "type": "blob",
          "size": 19965
        },
        {
          "path": "docs/plans/claude-docs-upgrade",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/plans/claude-docs-upgrade/cc-plan.md",
          "type": "blob",
          "size": 5924
        },
        {
          "path": "docs/plans/claude-docs-upgrade/challenge-plan.md",
          "type": "blob",
          "size": 47967
        },
        {
          "path": "docs/plans/claude-docs-upgrade/challenge-plan2.md",
          "type": "blob",
          "size": 55341
        },
        {
          "path": "docs/plans/claude-docs-upgrade/co-plan.md",
          "type": "blob",
          "size": 1879
        },
        {
          "path": "docs/plans/claude-docs-upgrade/create-claude-docs-variations.md",
          "type": "blob",
          "size": 2445
        },
        {
          "path": "docs/plans/claude-docs-upgrade/cu-plan.md",
          "type": "blob",
          "size": 12072
        },
        {
          "path": "docs/plans/claude-docs-upgrade/independent-review.md",
          "type": "blob",
          "size": 14512
        },
        {
          "path": "docs/plans/claude-docs-upgrade/pr-comparison-analysis.md",
          "type": "blob",
          "size": 22573
        },
        {
          "path": "docs/plans/claude-docs-upgrade/pr-comparison-review.md",
          "type": "blob",
          "size": 15493
        },
        {
          "path": "docs/plans/claude-docs-upgrade/task.md",
          "type": "blob",
          "size": 3003
        },
        {
          "path": "docs/plans/phase-0-results",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/plans/phase-0-results/DECISION.md",
          "type": "blob",
          "size": 6851
        },
        {
          "path": "docs/plans/phase-0-results/ab-test-queries.md",
          "type": "blob",
          "size": 897
        },
        {
          "path": "docs/plans/phase-0-results/ab-test-results.md",
          "type": "blob",
          "size": 9092
        },
        {
          "path": "docs/plans/phase-0-results/cache-precision-results.md",
          "type": "blob",
          "size": 5124
        },
        {
          "path": "docs/plans/phase-0-results/cache-test-data.md",
          "type": "blob",
          "size": 1700
        },
        {
          "path": "docs/plans/phase-0-results/parallel-dispatch-results.md",
          "type": "blob",
          "size": 3126
        },
        {
          "path": "docs/plans/phase-0-results/schema-validation-results.md",
          "type": "blob",
          "size": 582
        },
        {
          "path": "docs/plans/phase-0-results/user-validation-results.md",
          "type": "blob",
          "size": 8378
        },
        {
          "path": "docs/pr-12-verification-aar.md",
          "type": "blob",
          "size": 6908
        },
        {
          "path": "docs/research",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/5-nov-revelations-full.md",
          "type": "blob",
          "size": 142713
        },
        {
          "path": "docs/research/5-nov-revelations.md",
          "type": "blob",
          "size": 30993
        },
        {
          "path": "docs/research/6-nov-planing.md",
          "type": "blob",
          "size": 1367
        },
        {
          "path": "docs/research/6-nov-revelations.md",
          "type": "blob",
          "size": 47607
        },
        {
          "path": "docs/research/audit-skill",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/audit-skill/01-architecture-deterministic-vs-semantic.md",
          "type": "blob",
          "size": 3561
        },
        {
          "path": "docs/research/audit-skill/02-root-cause-analysis.md",
          "type": "blob",
          "size": 3917
        },
        {
          "path": "docs/research/audit-skill/03-determinism-test-results.md",
          "type": "blob",
          "size": 5707
        },
        {
          "path": "docs/research/audit-skill/04-effectiveness-improvements-v1.md",
          "type": "blob",
          "size": 28474
        },
        {
          "path": "docs/research/audit-skill/05-effectiveness-improvements-v2.md",
          "type": "blob",
          "size": 23661
        },
        {
          "path": "docs/research/audit-skill/06-python-sdk-implementation.md",
          "type": "blob",
          "size": 3891
        },
        {
          "path": "docs/research/audit-skill/07-git-history-timeline.txt",
          "type": "blob",
          "size": 7527
        },
        {
          "path": "docs/research/audit-skill/08-agent-evolution-matrix.md",
          "type": "blob",
          "size": 5255
        },
        {
          "path": "docs/research/audit-skill/09-sdk-test-results.md",
          "type": "blob",
          "size": 3886
        },
        {
          "path": "docs/research/audit-skill/10-b4-pattern-gap-analysis.md",
          "type": "blob",
          "size": 9587
        },
        {
          "path": "docs/research/audit-skill/11-implementation-validation.md",
          "type": "blob",
          "size": 9020
        },
        {
          "path": "docs/research/audit-skill/12-external-review.md",
          "type": "blob",
          "size": 10048
        },
        {
          "path": "docs/research/audit-skill/13-claude-code-review.md",
          "type": "blob",
          "size": 1968
        },
        {
          "path": "docs/research/audit-skill/README.md",
          "type": "blob",
          "size": 6891
        },
        {
          "path": "docs/research/audit-skill/RESEARCH-FINDINGS.md",
          "type": "blob",
          "size": 17693
        },
        {
          "path": "docs/research/audit-skill/SYNTHESIS.md",
          "type": "blob",
          "size": 16049
        },
        {
          "path": "docs/research/audit-skill/implementation-plan.md",
          "type": "blob",
          "size": 17944
        },
        {
          "path": "docs/research/bash",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/bash/bash-best-practices-research.md",
          "type": "blob",
          "size": 324475
        },
        {
          "path": "docs/research/bash/howtogeek-bash-scripts.md",
          "type": "blob",
          "size": 6482
        },
        {
          "path": "docs/research/beyond-mcp-v2",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/beyond-mcp-v2/01-mcp-server.md",
          "type": "blob",
          "size": 6319
        },
        {
          "path": "docs/research/beyond-mcp-v2/02-cli.md",
          "type": "blob",
          "size": 11831
        },
        {
          "path": "docs/research/beyond-mcp-v2/03-file-scripts.md",
          "type": "blob",
          "size": 4944
        },
        {
          "path": "docs/research/beyond-mcp-v2/04-skill.md",
          "type": "blob",
          "size": 17946
        },
        {
          "path": "docs/research/beyond-mcp-v2/comparison-matrix.md",
          "type": "blob",
          "size": 15275
        },
        {
          "path": "docs/research/beyond-mcp-v2/decision-framework.md",
          "type": "blob",
          "size": 19577
        },
        {
          "path": "docs/research/beyond-mcp",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/beyond-mcp/01-mcp-server.md",
          "type": "blob",
          "size": 10054
        },
        {
          "path": "docs/research/beyond-mcp/02-cli.md",
          "type": "blob",
          "size": 9304
        },
        {
          "path": "docs/research/beyond-mcp/03-file-scripts.md",
          "type": "blob",
          "size": 14136
        },
        {
          "path": "docs/research/beyond-mcp/04-skill.md",
          "type": "blob",
          "size": 25758
        },
        {
          "path": "docs/research/beyond-mcp/comparison-matrix.md",
          "type": "blob",
          "size": 12738
        },
        {
          "path": "docs/research/beyond-mcp/decision-framework.md",
          "type": "blob",
          "size": 27220
        },
        {
          "path": "docs/research/call-me-a-jerk.md",
          "type": "blob",
          "size": 12678
        },
        {
          "path": "docs/research/coderabbit",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/coderabbit/cli",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/coderabbit/cli/claude-code-integration.md",
          "type": "blob",
          "size": 10027
        },
        {
          "path": "docs/research/coderabbit/configuration",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/coderabbit/configuration/tools-reference.md",
          "type": "blob",
          "size": 16961
        },
        {
          "path": "docs/research/coderabbit/configuration/yaml-configuration-guide.md",
          "type": "blob",
          "size": 19976
        },
        {
          "path": "docs/research/coderabbit/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/coderabbit/examples/README.md",
          "type": "blob",
          "size": 7132
        },
        {
          "path": "docs/research/coderabbit/examples/python",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/coderabbit/examples/python/README.md",
          "type": "blob",
          "size": 3079
        },
        {
          "path": "docs/research/coderabbit/examples/python/coderabbit-python-portal.yaml",
          "type": "blob",
          "size": 10587
        },
        {
          "path": "docs/research/coderabbit/examples/python/coderabbit-wg-utilities.yaml",
          "type": "blob",
          "size": 1299
        },
        {
          "path": "docs/research/coderabbit/examples/python/pytest-google-style-config.yaml",
          "type": "blob",
          "size": 1273
        },
        {
          "path": "docs/research/coderabbit/examples/python/python-ruff-config.yaml",
          "type": "blob",
          "size": 708
        },
        {
          "path": "docs/research/coderabbit/referance",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/coderabbit/referance/configuration.md",
          "type": "blob",
          "size": 55564
        },
        {
          "path": "docs/research/coderabbit/referance/github-commands.md",
          "type": "blob",
          "size": 12023
        },
        {
          "path": "docs/research/coderabbit/referance/overview.md",
          "type": "blob",
          "size": 12003
        },
        {
          "path": "docs/research/jina-python-guide-firecrawl.md",
          "type": "blob",
          "size": 11249
        },
        {
          "path": "docs/research/md-autofixing-research.md",
          "type": "blob",
          "size": 32925
        },
        {
          "path": "docs/research/mintlify",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/mintlify/create-content-guide.md",
          "type": "blob",
          "size": 13796
        },
        {
          "path": "docs/research/mintlify/customize-themes-fonts-scripts-react-guide.md",
          "type": "blob",
          "size": 10587
        },
        {
          "path": "docs/research/mintlify/docs-json-site-settings-guide.md",
          "type": "blob",
          "size": 6290
        },
        {
          "path": "docs/research/mintlify/hide-pages-navigation-guide.md",
          "type": "blob",
          "size": 8124
        },
        {
          "path": "docs/research/mintlify/mint-cli-local-preview-guide.md",
          "type": "blob",
          "size": 3514
        },
        {
          "path": "docs/research/mintlify/monorepo-configuration-guide.md",
          "type": "blob",
          "size": 3440
        },
        {
          "path": "docs/research/mintlify/navigation-property-guide.md",
          "type": "blob",
          "size": 10346
        },
        {
          "path": "docs/research/mintlify/page-metadata-frontmatter-guide.md",
          "type": "blob",
          "size": 7923
        },
        {
          "path": "docs/research/persuasion.md",
          "type": "blob",
          "size": 22814
        },
        {
          "path": "docs/research/prompt-engineering-verification-failure-modes.md",
          "type": "blob",
          "size": 6758
        },
        {
          "path": "docs/research/rumdl",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/rumdl/RULES.md",
          "type": "blob",
          "size": 10619
        },
        {
          "path": "docs/research/rumdl/global-settings.md",
          "type": "blob",
          "size": 18269
        },
        {
          "path": "docs/research/rumdl/inline-configuration.md",
          "type": "blob",
          "size": 7316
        },
        {
          "path": "docs/research/rumdl/markdownlint-comparison.md",
          "type": "blob",
          "size": 12231
        },
        {
          "path": "docs/research/rumdl/pre-commit-integration.md",
          "type": "blob",
          "size": 2232
        },
        {
          "path": "docs/research/rumdl/using-rumdl-with-ai-coding-assistants.md",
          "type": "blob",
          "size": 38531
        },
        {
          "path": "docs/research/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/skills/documentation-sync-vs-skill-generation.md",
          "type": "blob",
          "size": 2911
        },
        {
          "path": "docs/research/skills/resources.md",
          "type": "blob",
          "size": 1844
        },
        {
          "path": "docs/research/skills/skill-generation-comparison.md",
          "type": "blob",
          "size": 3825
        },
        {
          "path": "docs/research/skills/slash-command-creator",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/research/skills/slash-command-creator/agent-skills-best-practices.md",
          "type": "blob",
          "size": 40996
        },
        {
          "path": "docs/research/skills/slash-command-creator/agent-skills-overview.md",
          "type": "blob",
          "size": 17204
        },
        {
          "path": "docs/research/skills/slash-command-creator/agent-skills-quickstart.md",
          "type": "blob",
          "size": 12212
        },
        {
          "path": "docs/research/skills/slash-command-creator/anthropic-slash-commands.md",
          "type": "blob",
          "size": 25438
        },
        {
          "path": "docs/research/skills/slash-command-creator/hooks-guide.md",
          "type": "blob",
          "size": 9685
        },
        {
          "path": "docs/research/skills/slash-command-creator/hooks.md",
          "type": "blob",
          "size": 35410
        },
        {
          "path": "docs/research/skills/slash-command-creator/mcp.md",
          "type": "blob",
          "size": 22721
        },
        {
          "path": "docs/research/skills/slash-command-creator/memory.md",
          "type": "blob",
          "size": 6593
        },
        {
          "path": "docs/research/skills/slash-command-creator/output-styles.md",
          "type": "blob",
          "size": 4549
        },
        {
          "path": "docs/research/skills/slash-command-creator/plugin-marketplaces.md",
          "type": "blob",
          "size": 14737
        },
        {
          "path": "docs/research/skills/slash-command-creator/plugins-reference.md",
          "type": "blob",
          "size": 13099
        },
        {
          "path": "docs/research/skills/slash-command-creator/plugins.md",
          "type": "blob",
          "size": 12054
        },
        {
          "path": "docs/research/skills/slash-command-creator/settings.md",
          "type": "blob",
          "size": 53011
        },
        {
          "path": "docs/research/skills/slash-command-creator/skills.md",
          "type": "blob",
          "size": 14895
        },
        {
          "path": "docs/research/skills/slash-command-creator/slash-commands.md",
          "type": "blob",
          "size": 21557
        },
        {
          "path": "docs/research/skills/slash-command-creator/statusline.md",
          "type": "blob",
          "size": 5970
        },
        {
          "path": "docs/research/skills/slash-command-creator/sub-agents.md",
          "type": "blob",
          "size": 21953
        },
        {
          "path": "docs/research/web-scraping-methods-comparison.md",
          "type": "blob",
          "size": 15725
        },
        {
          "path": "docs/reviews",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/audits",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/audits/claude-dev-sandbox",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/audits/claude-dev-sandbox/example-skill.md",
          "type": "blob",
          "size": 7380
        },
        {
          "path": "docs/reviews/audits/claude-dev-sandbox/video-processor.md",
          "type": "blob",
          "size": 8066
        },
        {
          "path": "docs/reviews/audits/homelab",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/audits/homelab/netbox-powerdns-integration.md",
          "type": "blob",
          "size": 4971
        },
        {
          "path": "docs/reviews/audits/infrastructure",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/audits/infrastructure/ansible-best-practices.md",
          "type": "blob",
          "size": 7188
        },
        {
          "path": "docs/reviews/audits/infrastructure/proxmox-infrastructure.md",
          "type": "blob",
          "size": 5906
        },
        {
          "path": "docs/reviews/audits/meta-claude",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/audits/meta-claude/agent-creator.md",
          "type": "blob",
          "size": 6169
        },
        {
          "path": "docs/reviews/audits/meta-claude/audit-report.md",
          "type": "blob",
          "size": 9910
        },
        {
          "path": "docs/reviews/audits/meta-claude/command-creator.md",
          "type": "blob",
          "size": 5255
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands/README.md",
          "type": "blob",
          "size": 2779
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands/audit-log.md",
          "type": "blob",
          "size": 7720
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands/skill-create.md",
          "type": "blob",
          "size": 3469
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands/skill-format.md",
          "type": "blob",
          "size": 6430
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands/skill-research.md",
          "type": "blob",
          "size": 4555
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands/skill-review-compliance.md",
          "type": "blob",
          "size": 4640
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands/skill-review-content.md",
          "type": "blob",
          "size": 4839
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands/skill-validate-audit.md",
          "type": "blob",
          "size": 8863
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands/skill-validate-integration.md",
          "type": "blob",
          "size": 12331
        },
        {
          "path": "docs/reviews/audits/meta-claude/commands/skill-validate-runtime.md",
          "type": "blob",
          "size": 10063
        },
        {
          "path": "docs/reviews/audits/meta-claude/deterministic-vs-semantic-checks.md",
          "type": "blob",
          "size": 3561
        },
        {
          "path": "docs/reviews/audits/meta-claude/hook-creator.md",
          "type": "blob",
          "size": 6747
        },
        {
          "path": "docs/reviews/audits/meta-claude/multi-agent-composition.md",
          "type": "blob",
          "size": 4638
        },
        {
          "path": "docs/reviews/audits/meta-claude/skill-auditor-determinism-root-cause.md",
          "type": "blob",
          "size": 3917
        },
        {
          "path": "docs/reviews/audits/meta-claude/skill-factory-determinism-test.md",
          "type": "blob",
          "size": 5707
        },
        {
          "path": "docs/reviews/audits/meta",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/audits/meta/claude-docs.md",
          "type": "blob",
          "size": 7636
        },
        {
          "path": "docs/reviews/audits/python-tools",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/audits/python-tools/claude-agent-sdk.md",
          "type": "blob",
          "size": 8080
        },
        {
          "path": "docs/reviews/audits/python-tools/python-code-quality.md",
          "type": "blob",
          "size": 7955
        },
        {
          "path": "docs/reviews/audits/python-tools/python-json-parsing.md",
          "type": "blob",
          "size": 8464
        },
        {
          "path": "docs/reviews/audits/python-tools/python-uv-scripts.md",
          "type": "blob",
          "size": 8027
        },
        {
          "path": "docs/reviews/bugs",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/bugs/claude-docs-old-directory-cleanup.md",
          "type": "blob",
          "size": 4528
        },
        {
          "path": "docs/reviews/design-validation",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/design-validation/comprehensive",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/design-validation/comprehensive/parts",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/design-validation/comprehensive/parts/adr.md",
          "type": "blob",
          "size": 29848
        },
        {
          "path": "docs/reviews/design-validation/comprehensive/parts/landscape.md",
          "type": "blob",
          "size": 18329
        },
        {
          "path": "docs/reviews/design-validation/comprehensive/parts/premortem.md",
          "type": "blob",
          "size": 15094
        },
        {
          "path": "docs/reviews/design-validation/comprehensive/parts/self-critique.md",
          "type": "blob",
          "size": 17941
        },
        {
          "path": "docs/reviews/design-validation/comprehensive/parts/swot.md",
          "type": "blob",
          "size": 16551
        },
        {
          "path": "docs/reviews/design-validation/comprehensive/research-pipeline-v2-comprehensive-review.md",
          "type": "blob",
          "size": 11739
        },
        {
          "path": "docs/reviews/plugins",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/plugins/meta-claude-review.md",
          "type": "blob",
          "size": 9621
        },
        {
          "path": "docs/reviews/pr",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/pr/pr-14-review-toolkit-analysis.md",
          "type": "blob",
          "size": 8762
        },
        {
          "path": "docs/reviews/pr/pr-24-review.md",
          "type": "blob",
          "size": 19820
        },
        {
          "path": "docs/reviews/skill-audit-log.md",
          "type": "blob",
          "size": 8683
        },
        {
          "path": "docs/reviews/skill-auditor",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/reviews/skill-auditor/auditor-comparison.md",
          "type": "blob",
          "size": 10393
        },
        {
          "path": "docs/reviews/skill-auditor/auditor-quick-reference.md",
          "type": "blob",
          "size": 7611
        },
        {
          "path": "docs/reviews/skill-auditor/claude-skill-auditor-v2.md",
          "type": "blob",
          "size": 21473
        },
        {
          "path": "docs/reviews/skill-auditor/skill-creator-reference-files.md",
          "type": "blob",
          "size": 4144
        },
        {
          "path": "docs/reviews/summary.md",
          "type": "blob",
          "size": 7469
        },
        {
          "path": "docs/slash-commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/slash-commands/improve.md",
          "type": "blob",
          "size": 2952
        },
        {
          "path": "docs/slash-commands/pr-review.md",
          "type": "blob",
          "size": 4080
        },
        {
          "path": "docs/slash-commands/review-pr-msg.md",
          "type": "blob",
          "size": 8255
        },
        {
          "path": "docs/sub-agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/sub-agents/testing-skill-creator.md",
          "type": "blob",
          "size": 5757
        },
        {
          "path": "docs/templates",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/templates/claude-md-validation-report-template.md",
          "type": "blob",
          "size": 3340
        },
        {
          "path": "docs/templates/slash-command-validation-report-template.md",
          "type": "blob",
          "size": 5069
        },
        {
          "path": "docs/templates/subagent-validation-report-template.md",
          "type": "blob",
          "size": 8713
        },
        {
          "path": "docs/yt_transcripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "docs/yt_transcripts/claude_agent_sdk.md",
          "type": "blob",
          "size": 18548
        },
        {
          "path": "docs/yt_transcripts/multi-agent.md",
          "type": "blob",
          "size": 23875
        },
        {
          "path": "docs/yt_transcripts/skills.md",
          "type": "blob",
          "size": 29751
        },
        {
          "path": "examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/agents/fetch-docs.md",
          "type": "blob",
          "size": 1094
        },
        {
          "path": "examples/hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/hooks/bash_cmd_validator",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/hooks/bash_cmd_validator/bash_command_validator_example.py",
          "type": "blob",
          "size": 2704
        },
        {
          "path": "examples/hooks/bash_cmd_validator/hook.json",
          "type": "blob",
          "size": 277
        },
        {
          "path": "examples/hooks/lint-on-save",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/hooks/lint-on-save/lint-on-save.json",
          "type": "blob",
          "size": 434
        },
        {
          "path": "examples/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/skills/mcp-builder",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/skills/mcp-builder/LICENSE.txt",
          "type": "blob",
          "size": 11358
        },
        {
          "path": "examples/skills/mcp-builder/SKILL.md",
          "type": "blob",
          "size": 13850
        },
        {
          "path": "examples/skills/mcp-builder/reference",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/skills/mcp-builder/reference/evaluation.md",
          "type": "blob",
          "size": 21664
        },
        {
          "path": "examples/skills/mcp-builder/reference/mcp_best_practices.md",
          "type": "blob",
          "size": 25234
        },
        {
          "path": "examples/skills/mcp-builder/reference/node_mcp_server.md",
          "type": "blob",
          "size": 28551
        },
        {
          "path": "examples/skills/mcp-builder/reference/python_mcp_server.md",
          "type": "blob",
          "size": 25100
        },
        {
          "path": "examples/skills/mcp-builder/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/skills/mcp-builder/scripts/connections.py",
          "type": "blob",
          "size": 4875
        },
        {
          "path": "examples/skills/mcp-builder/scripts/evaluation.py",
          "type": "blob",
          "size": 12579
        },
        {
          "path": "examples/skills/mcp-builder/scripts/example_evaluation.xml",
          "type": "blob",
          "size": 1194
        },
        {
          "path": "examples/skills/mcp-builder/scripts/requirements.txt",
          "type": "blob",
          "size": 29
        },
        {
          "path": "examples/skills/skill-creator",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/skills/skill-creator/LICENSE.txt",
          "type": "blob",
          "size": 11358
        },
        {
          "path": "examples/skills/skill-creator/SKILL.md",
          "type": "blob",
          "size": 11579
        },
        {
          "path": "examples/skills/skill-creator/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/skills/skill-creator/scripts/init_skill.py",
          "type": "blob",
          "size": 10863
        },
        {
          "path": "examples/skills/skill-creator/scripts/package_skill.py",
          "type": "blob",
          "size": 3247
        },
        {
          "path": "examples/skills/skill-creator/scripts/quick_validate.py",
          "type": "blob",
          "size": 2138
        },
        {
          "path": "examples/skills/video-processor",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/skills/video-processor/SKILL.md",
          "type": "blob",
          "size": 8889
        },
        {
          "path": "examples/skills/video-processor/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "examples/skills/video-processor/scripts/video_processor.py",
          "type": "blob",
          "size": 14464
        },
        {
          "path": "lychee.toml",
          "type": "blob",
          "size": 4098
        },
        {
          "path": "mise.toml",
          "type": "blob",
          "size": 3379
        },
        {
          "path": "plugins",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/git-workflow",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/git-workflow/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/git-workflow/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 463
        },
        {
          "path": "plugins/devops/git-workflow/README.md",
          "type": "blob",
          "size": 3718
        },
        {
          "path": "plugins/devops/git-workflow/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/git-workflow/agents/commit-craft.md",
          "type": "blob",
          "size": 6580
        },
        {
          "path": "plugins/devops/git-workflow/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/git-workflow/commands/branch-cleanup.md",
          "type": "blob",
          "size": 4214
        },
        {
          "path": "plugins/devops/git-workflow/commands/generate-changelog.md",
          "type": "blob",
          "size": 3587
        },
        {
          "path": "plugins/devops/git-workflow/commands/git-commit.md",
          "type": "blob",
          "size": 1982
        },
        {
          "path": "plugins/devops/git-workflow/commands/git-status.md",
          "type": "blob",
          "size": 657
        },
        {
          "path": "plugins/devops/git-workflow/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/git-workflow/skills/git-workflow",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/git-workflow/skills/git-workflow/SKILL.md",
          "type": "blob",
          "size": 5688
        },
        {
          "path": "plugins/devops/python-tools",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 465
        },
        {
          "path": "plugins/devops/python-tools/README.md",
          "type": "blob",
          "size": 4049
        },
        {
          "path": "plugins/devops/python-tools/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/agents/agent-sdk-verifier.md",
          "type": "blob",
          "size": 6489
        },
        {
          "path": "plugins/devops/python-tools/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/commands/new-sdk-app.md",
          "type": "blob",
          "size": 8658
        },
        {
          "path": "plugins/devops/python-tools/commands/review-sdk-app.md",
          "type": "blob",
          "size": 9127
        },
        {
          "path": "plugins/devops/python-tools/commands/review-uv-script.md",
          "type": "blob",
          "size": 8292
        },
        {
          "path": "plugins/devops/python-tools/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/SKILL.md",
          "type": "blob",
          "size": 17218
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/assets",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/assets/sdk-template.py",
          "type": "blob",
          "size": 2951
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/assets/sdk-validation-checklist.md",
          "type": "blob",
          "size": 11279
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples/agents.py",
          "type": "blob",
          "size": 4261
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples/basic-orchestrator.py",
          "type": "blob",
          "size": 3801
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples/hooks.py",
          "type": "blob",
          "size": 12136
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples/mcp_calculator.py",
          "type": "blob",
          "size": 5870
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples/plugin_example.py",
          "type": "blob",
          "size": 2164
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples/quick_start.py",
          "type": "blob",
          "size": 2075
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples/setting_sources.py",
          "type": "blob",
          "size": 5683
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples/streaming_mode.py",
          "type": "blob",
          "size": 17605
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples/system_prompt.py",
          "type": "blob",
          "size": 2554
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/examples/tool_permission_callback.py",
          "type": "blob",
          "size": 5417
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/agent-patterns.md",
          "type": "blob",
          "size": 5611
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/api-reference.md",
          "type": "blob",
          "size": 59306
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/best-practices.md",
          "type": "blob",
          "size": 9261
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/custom-tools.md",
          "type": "blob",
          "size": 21907
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/hooks-guide.md",
          "type": "blob",
          "size": 10351
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/sessions.md",
          "type": "blob",
          "size": 7967
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/skills.md",
          "type": "blob",
          "size": 10248
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/slash-commands.md",
          "type": "blob",
          "size": 12407
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/subagents.md",
          "type": "blob",
          "size": 10767
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/system-prompts.md",
          "type": "blob",
          "size": 6440
        },
        {
          "path": "plugins/devops/python-tools/skills/claude-agent-sdk/references/tool-permissions.md",
          "type": "blob",
          "size": 12218
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/SKILL.md",
          "type": "blob",
          "size": 3653
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/examples/pyrightconfig-starter.json",
          "type": "blob",
          "size": 352
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/examples/pyrightconfig-strict.json",
          "type": "blob",
          "size": 432
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/examples/ruff-comprehensive.toml",
          "type": "blob",
          "size": 766
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/examples/ruff-minimal.toml",
          "type": "blob",
          "size": 270
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/patterns",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/patterns/ci-cd-quality-gates.md",
          "type": "blob",
          "size": 4153
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/patterns/pre-commit-integration.md",
          "type": "blob",
          "size": 1812
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/reference",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/reference/pyright-configuration.md",
          "type": "blob",
          "size": 48584
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/reference/ruff-configuration.md",
          "type": "blob",
          "size": 31046
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/reference/ruff-formatting-settings.md",
          "type": "blob",
          "size": 18649
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/reference/ruff-linting-settings.md",
          "type": "blob",
          "size": 15124
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/tools",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/tools/python_formatter.py",
          "type": "blob",
          "size": 3991
        },
        {
          "path": "plugins/devops/python-tools/skills/python-code-quality/tools/python_ruff_checker.py",
          "type": "blob",
          "size": 2169
        },
        {
          "path": "plugins/devops/python-tools/skills/python-json-parsing",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-json-parsing/SKILL.md",
          "type": "blob",
          "size": 6065
        },
        {
          "path": "plugins/devops/python-tools/skills/python-json-parsing/reference",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-json-parsing/reference/python-json-parsing-best-practices-2025.md",
          "type": "blob",
          "size": 13898
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/SKILL.md",
          "type": "blob",
          "size": 12998
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/anti-patterns",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/anti-patterns/common-mistakes.md",
          "type": "blob",
          "size": 7287
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/anti-patterns/when-not-to-use.md",
          "type": "blob",
          "size": 7267
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/assets",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/assets/templates",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/assets/templates/api-client.py",
          "type": "blob",
          "size": 1763
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/assets/templates/basic-script.py",
          "type": "blob",
          "size": 463
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/assets/templates/cli-app.py",
          "type": "blob",
          "size": 1458
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/assets/templates/data-processor.py",
          "type": "blob",
          "size": 2111
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/examples/03-production-ready",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/examples/03-production-ready/check_cluster_health_enhanced.py",
          "type": "blob",
          "size": 7521
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/examples/04-api-clients",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/examples/04-api-clients/netbox_client.py",
          "type": "blob",
          "size": 10722
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/patterns",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/patterns/api-clients.md",
          "type": "blob",
          "size": 4270
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/patterns/cli-applications.md",
          "type": "blob",
          "size": 2236
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/patterns/data-processing.md",
          "type": "blob",
          "size": 1162
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/patterns/error-handling.md",
          "type": "blob",
          "size": 3940
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/patterns/security-patterns.md",
          "type": "blob",
          "size": 895
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/patterns/system-automation.md",
          "type": "blob",
          "size": 1474
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/reference",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/reference/bash-to-python.md",
          "type": "blob",
          "size": 5378
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/reference/dependency-management.md",
          "type": "blob",
          "size": 1338
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/reference/pep-723-spec.md",
          "type": "blob",
          "size": 7094
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/reference/security-patterns.md",
          "type": "blob",
          "size": 11708
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/tools",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/tools/convert_to_uv.py",
          "type": "blob",
          "size": 16011
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/tools/validate_script.py",
          "type": "blob",
          "size": 10809
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/workflows/ci-cd-integration.md",
          "type": "blob",
          "size": 1338
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/workflows/team-adoption.md",
          "type": "blob",
          "size": 1402
        },
        {
          "path": "plugins/devops/python-tools/skills/python-uv-scripts/workflows/testing-strategies.md",
          "type": "blob",
          "size": 1381
        },
        {
          "path": "plugins/homelab",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 429
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/README.md",
          "type": "blob",
          "size": 3442
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/SKILL.md",
          "type": "blob",
          "size": 12153
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/anti-patterns",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/anti-patterns/common-mistakes.md",
          "type": "blob",
          "size": 10410
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/examples/01-vm-with-dns",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/examples/01-vm-with-dns/README.md",
          "type": "blob",
          "size": 8808
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/examples/01-vm-with-dns/main.tf",
          "type": "blob",
          "size": 4975
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/examples/01-vm-with-dns/variables.tf",
          "type": "blob",
          "size": 2386
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/reference",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/reference/netbox-api-guide.md",
          "type": "blob",
          "size": 22502
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/reference/netbox-best-practices.md",
          "type": "blob",
          "size": 22823
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/reference/netbox-data-models.md",
          "type": "blob",
          "size": 23189
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/reference/sync-plugin-reference.md",
          "type": "blob",
          "size": 6943
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/reference/terraform-provider-guide.md",
          "type": "blob",
          "size": 8950
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/tools",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/tools/netbox_api_client.py",
          "type": "blob",
          "size": 22481
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/tools/netbox_ipam_query.py",
          "type": "blob",
          "size": 14957
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/tools/netbox_vm_create.py",
          "type": "blob",
          "size": 12869
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/tools/validate_dns_naming.py",
          "type": "blob",
          "size": 7033
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/workflows/ansible-dynamic-inventory.md",
          "type": "blob",
          "size": 10912
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/workflows/dns-automation.md",
          "type": "blob",
          "size": 13738
        },
        {
          "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/workflows/naming-conventions.md",
          "type": "blob",
          "size": 10534
        },
        {
          "path": "plugins/homelab/omni-scale",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 489
        },
        {
          "path": "plugins/homelab/omni-scale/.mcp.json",
          "type": "blob",
          "size": 184
        },
        {
          "path": "plugins/homelab/omni-scale/README.md",
          "type": "blob",
          "size": 3410
        },
        {
          "path": "plugins/homelab/omni-scale/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/agents/gitops-reviewer.md",
          "type": "blob",
          "size": 6752
        },
        {
          "path": "plugins/homelab/omni-scale/agents/omni-reviewer.md",
          "type": "blob",
          "size": 6318
        },
        {
          "path": "plugins/homelab/omni-scale/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/commands/analyze-spec.md",
          "type": "blob",
          "size": 2781
        },
        {
          "path": "plugins/homelab/omni-scale/commands/bootstrap-gitops.md",
          "type": "blob",
          "size": 2858
        },
        {
          "path": "plugins/homelab/omni-scale/commands/disaster-recovery.md",
          "type": "blob",
          "size": 5206
        },
        {
          "path": "plugins/homelab/omni-scale/commands/omni-prime.md",
          "type": "blob",
          "size": 2430
        },
        {
          "path": "plugins/homelab/omni-scale/commands/status.md",
          "type": "blob",
          "size": 1595
        },
        {
          "path": "plugins/homelab/omni-scale/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/references/kernel.md",
          "type": "blob",
          "size": 6444
        },
        {
          "path": "plugins/homelab/omni-scale/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-proxmox",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-proxmox/SKILL.md",
          "type": "blob",
          "size": 3872
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/SKILL.md",
          "type": "blob",
          "size": 3860
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/examples/cluster-template.yaml",
          "type": "blob",
          "size": 1812
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/examples/machineclass-ceph.yaml",
          "type": "blob",
          "size": 641
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/examples/machineclass-local.yaml",
          "type": "blob",
          "size": 394
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/examples/proxmox-gpu-worker.yaml",
          "type": "blob",
          "size": 408
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/examples/proxmox-storage-node.yaml",
          "type": "blob",
          "size": 493
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/examples/proxmox-worker-multi-net.yaml",
          "type": "blob",
          "size": 395
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/references/architecture.md",
          "type": "blob",
          "size": 4940
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/references/cel-storage-selectors.md",
          "type": "blob",
          "size": 2355
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/references/cluster-templates.md",
          "type": "blob",
          "size": 2491
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/references/debugging.md",
          "type": "blob",
          "size": 6360
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/references/machine-classes.md",
          "type": "blob",
          "size": 3592
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/references/omnictl-auth.md",
          "type": "blob",
          "size": 3545
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/references/provider-setup.md",
          "type": "blob",
          "size": 1709
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/references/proxmox-permissions.md",
          "type": "blob",
          "size": 4062
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/references/recovery-procedures.md",
          "type": "blob",
          "size": 3226
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/skills/omni-talos/scripts/provider-ctl.py",
          "type": "blob",
          "size": 6514
        },
        {
          "path": "plugins/homelab/omni-scale/specs",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/specs/README.md",
          "type": "blob",
          "size": 2805
        },
        {
          "path": "plugins/homelab/omni-scale/specs/gitops-bootstrap.yaml",
          "type": "blob",
          "size": 8214
        },
        {
          "path": "plugins/homelab/omni-scale/specs/omni.yaml",
          "type": "blob",
          "size": 16644
        },
        {
          "path": "plugins/homelab/omni-scale/templates",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/homelab/omni-scale/templates/plan-template.md",
          "type": "blob",
          "size": 884
        },
        {
          "path": "plugins/infrastructure",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 541
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/.gitignore",
          "type": "blob",
          "size": 84
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/README.md",
          "type": "blob",
          "size": 8354
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/agents/ansible-debugger.md",
          "type": "blob",
          "size": 11919
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/agents/ansible-generator.md",
          "type": "blob",
          "size": 10819
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/agents/ansible-orchestrator.md",
          "type": "blob",
          "size": 12779
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/agents/ansible-reviewer.md",
          "type": "blob",
          "size": 14045
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/agents/ansible-validator.md",
          "type": "blob",
          "size": 9201
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/commands/analyze.md",
          "type": "blob",
          "size": 1326
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/commands/create-playbook.md",
          "type": "blob",
          "size": 2527
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/commands/create-role.md",
          "type": "blob",
          "size": 2594
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/commands/lint.md",
          "type": "blob",
          "size": 723
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/hooks/check-pipeline-state.py",
          "type": "blob",
          "size": 4770
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/hooks/hooks.json",
          "type": "blob",
          "size": 362
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/hooks/subagent-complete.py",
          "type": "blob",
          "size": 8003
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-error-handling",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-error-handling/SKILL.md",
          "type": "blob",
          "size": 9329
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-error-handling/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-error-handling/references/error-handling.md",
          "type": "blob",
          "size": 13757
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-fundamentals",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-fundamentals/SKILL.md",
          "type": "blob",
          "size": 7518
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-idempotency",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-idempotency/SKILL.md",
          "type": "blob",
          "size": 9395
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-idempotency/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-idempotency/scripts/check_idempotency.py",
          "type": "blob",
          "size": 12355
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-playbook-design",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-playbook-design/SKILL.md",
          "type": "blob",
          "size": 9024
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-playbook-design/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-playbook-design/references/playbook-role-patterns.md",
          "type": "blob",
          "size": 9734
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-proxmox",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-proxmox/SKILL.md",
          "type": "blob",
          "size": 9457
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-proxmox/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-proxmox/references/ceph-automation.md",
          "type": "blob",
          "size": 20798
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-proxmox/references/cluster-automation.md",
          "type": "blob",
          "size": 8976
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-proxmox/references/community-proxmox-plugin-index.md",
          "type": "blob",
          "size": 9137
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-proxmox/references/network-automation.md",
          "type": "blob",
          "size": 13103
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-role-design",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-role-design/SKILL.md",
          "type": "blob",
          "size": 9424
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-role-design/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-role-design/references/documentation-templates.md",
          "type": "blob",
          "size": 31941
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-role-design/references/handler-best-practices.md",
          "type": "blob",
          "size": 32363
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-role-design/references/meta-dependencies.md",
          "type": "blob",
          "size": 27933
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-role-design/references/role-structure-standards.md",
          "type": "blob",
          "size": 42479
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-role-design/references/variable-management-patterns.md",
          "type": "blob",
          "size": 27346
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-secrets",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-secrets/SKILL.md",
          "type": "blob",
          "size": 8844
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-secrets/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-secrets/references/secrets-management.md",
          "type": "blob",
          "size": 13246
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-testing",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-testing/SKILL.md",
          "type": "blob",
          "size": 7317
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-testing/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/ansible-workflows/skills/ansible-testing/references/testing-comprehensive.md",
          "type": "blob",
          "size": 32859
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 418
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/README.md",
          "type": "blob",
          "size": 3323
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/SKILL.md",
          "type": "blob",
          "size": 7502
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/anti-patterns",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/anti-patterns/common-mistakes.md",
          "type": "blob",
          "size": 7655
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/examples/01-basic-vm",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/examples/01-basic-vm/README.md",
          "type": "blob",
          "size": 5462
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/examples/01-basic-vm/main.tf",
          "type": "blob",
          "size": 3742
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/examples/01-basic-vm/variables.tf",
          "type": "blob",
          "size": 924
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/reference",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/reference/api-reference.md",
          "type": "blob",
          "size": 8643
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/reference/cloud-init-patterns.md",
          "type": "blob",
          "size": 3941
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/reference/networking.md",
          "type": "blob",
          "size": 7417
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/reference/qemu-guest-agent.md",
          "type": "blob",
          "size": 9257
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/reference/storage-management.md",
          "type": "blob",
          "size": 9126
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/tools",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/tools/check_ceph_health.py",
          "type": "blob",
          "size": 15866
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/tools/check_cluster_health.py",
          "type": "blob",
          "size": 10950
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/tools/cluster_status.py",
          "type": "blob",
          "size": 8943
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/tools/validate_template.py",
          "type": "blob",
          "size": 7523
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/workflows/ceph-deployment.md",
          "type": "blob",
          "size": 22814
        },
        {
          "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/workflows/cluster-formation.md",
          "type": "blob",
          "size": 17168
        },
        {
          "path": "plugins/meta",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 329
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/README.md",
          "type": "blob",
          "size": 2405
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/agents/.gitkeep",
          "type": "blob",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/agents/example-agent.md",
          "type": "blob",
          "size": 983
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/commands/.gitkeep",
          "type": "blob",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/commands/hello.md",
          "type": "blob",
          "size": 60
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/hooks/.gitkeep",
          "type": "blob",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/hooks/hooks.json.example",
          "type": "blob",
          "size": 439
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/scripts/.gitkeep",
          "type": "blob",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/scripts/README.md",
          "type": "blob",
          "size": 2442
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/scripts/TEST_RESULTS.md",
          "type": "blob",
          "size": 6271
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/scripts/sync_docs.py",
          "type": "blob",
          "size": 33744
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit/SKILL.md",
          "type": "blob",
          "size": 4610
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit/references/claude-code-integration.md",
          "type": "blob",
          "size": 9796
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit/references/configuration.md",
          "type": "blob",
          "size": 55012
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit/references/github-commands.md",
          "type": "blob",
          "size": 12085
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit/references/overview.md",
          "type": "blob",
          "size": 12020
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit/references/tools-reference.md",
          "type": "blob",
          "size": 16961
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit/references/yaml-configuration-guide.md",
          "type": "blob",
          "size": 19979
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/official_docs",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/official_docs/.gitignore",
          "type": "blob",
          "size": 98
        },
        {
          "path": "plugins/meta/claude-dev-sandbox/skills/official_docs/SKILL.md",
          "type": "blob",
          "size": 108
        },
        {
          "path": "plugins/meta/hookify",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 234
        },
        {
          "path": "plugins/meta/hookify/.gitignore",
          "type": "blob",
          "size": 291
        },
        {
          "path": "plugins/meta/hookify/README.md",
          "type": "blob",
          "size": 7767
        },
        {
          "path": "plugins/meta/hookify/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/agents/conversation-analyzer.md",
          "type": "blob",
          "size": 5694
        },
        {
          "path": "plugins/meta/hookify/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/commands/configure.md",
          "type": "blob",
          "size": 2894
        },
        {
          "path": "plugins/meta/hookify/commands/help.md",
          "type": "blob",
          "size": 4653
        },
        {
          "path": "plugins/meta/hookify/commands/hookify.md",
          "type": "blob",
          "size": 7697
        },
        {
          "path": "plugins/meta/hookify/commands/list.md",
          "type": "blob",
          "size": 2049
        },
        {
          "path": "plugins/meta/hookify/core",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/core/__init__.py",
          "type": "blob",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/core/config_loader.py",
          "type": "blob",
          "size": 10075
        },
        {
          "path": "plugins/meta/hookify/core/rule_engine.py",
          "type": "blob",
          "size": 11387
        },
        {
          "path": "plugins/meta/hookify/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/examples/console-log-warning.local.md",
          "type": "blob",
          "size": 316
        },
        {
          "path": "plugins/meta/hookify/examples/dangerous-rm.local.md",
          "type": "blob",
          "size": 279
        },
        {
          "path": "plugins/meta/hookify/examples/require-tests-stop.local.md",
          "type": "blob",
          "size": 501
        },
        {
          "path": "plugins/meta/hookify/examples/sensitive-files-warning.local.md",
          "type": "blob",
          "size": 422
        },
        {
          "path": "plugins/meta/hookify/hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/hooks/__init__.py",
          "type": "blob",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/hooks/hooks.json",
          "type": "blob",
          "size": 1020
        },
        {
          "path": "plugins/meta/hookify/hooks/posttooluse.py",
          "type": "blob",
          "size": 1738
        },
        {
          "path": "plugins/meta/hookify/hooks/pretooluse.py",
          "type": "blob",
          "size": 2167
        },
        {
          "path": "plugins/meta/hookify/hooks/stop.py",
          "type": "blob",
          "size": 1519
        },
        {
          "path": "plugins/meta/hookify/hooks/userpromptsubmit.py",
          "type": "blob",
          "size": 1505
        },
        {
          "path": "plugins/meta/hookify/matchers",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/matchers/__init__.py",
          "type": "blob",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/skills/writing-rules",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/skills/writing-rules/SKILL.md",
          "type": "blob",
          "size": 8448
        },
        {
          "path": "plugins/meta/hookify/utils",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/hookify/utils/__init__.py",
          "type": "blob",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 452
        },
        {
          "path": "plugins/meta/meta-claude/.gitignore",
          "type": "blob",
          "size": 291
        },
        {
          "path": "plugins/meta/meta-claude/README.md",
          "type": "blob",
          "size": 1249
        },
        {
          "path": "plugins/meta/meta-claude/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/commands/prime.md",
          "type": "blob",
          "size": 1320
        },
        {
          "path": "plugins/meta/meta-claude/commands/skill",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/commands/skill/create.md",
          "type": "blob",
          "size": 1649
        },
        {
          "path": "plugins/meta/meta-claude/commands/skill/format.md",
          "type": "blob",
          "size": 2110
        },
        {
          "path": "plugins/meta/meta-claude/commands/skill/research.md",
          "type": "blob",
          "size": 9708
        },
        {
          "path": "plugins/meta/meta-claude/commands/skill/review-compliance.md",
          "type": "blob",
          "size": 1909
        },
        {
          "path": "plugins/meta/meta-claude/commands/skill/review-content.md",
          "type": "blob",
          "size": 6654
        },
        {
          "path": "plugins/meta/meta-claude/commands/skill/validate-audit.md",
          "type": "blob",
          "size": 1888
        },
        {
          "path": "plugins/meta/meta-claude/commands/skill/validate-integration.md",
          "type": "blob",
          "size": 10612
        },
        {
          "path": "plugins/meta/meta-claude/commands/skill/validate-runtime.md",
          "type": "blob",
          "size": 7981
        },
        {
          "path": "plugins/meta/meta-claude/commands/skill/write.md",
          "type": "blob",
          "size": 4637
        },
        {
          "path": "plugins/meta/meta-claude/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/SKILL.md",
          "type": "blob",
          "size": 8966
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/anti-patterns",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/anti-patterns/common-mistakes.md",
          "type": "blob",
          "size": 13522
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/examples/case-studies.md",
          "type": "blob",
          "size": 30475
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/examples/progression-example.md",
          "type": "blob",
          "size": 7924
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/patterns",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/patterns/context-in-composition.md",
          "type": "blob",
          "size": 4409
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/patterns/context-management.md",
          "type": "blob",
          "size": 17663
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/patterns/decision-framework.md",
          "type": "blob",
          "size": 15298
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/patterns/hooks-in-composition.md",
          "type": "blob",
          "size": 24767
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/patterns/orchestrator-pattern.md",
          "type": "blob",
          "size": 18419
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/reference",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/reference/architecture.md",
          "type": "blob",
          "size": 18362
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/reference/core-4-framework.md",
          "type": "blob",
          "size": 12965
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/multi-agent-composition/workflows/decision-tree.md",
          "type": "blob",
          "size": 20428
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/SKILL.md",
          "type": "blob",
          "size": 17657
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/references/design-principles.md",
          "type": "blob",
          "size": 1106
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/references/error-handling.md",
          "type": "blob",
          "size": 4806
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/references/troubleshooting.md",
          "type": "blob",
          "size": 1503
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/references/workflow-architecture.md",
          "type": "blob",
          "size": 2169
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/references/workflow-examples.md",
          "type": "blob",
          "size": 7163
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/references/workflow-execution.md",
          "type": "blob",
          "size": 2390
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/scripts/format_skill_research.py",
          "type": "blob",
          "size": 2666
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/scripts/package_skill.py",
          "type": "blob",
          "size": 6877
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/scripts/quick_validate.py",
          "type": "blob",
          "size": 4028
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/skills/skill-factory/workflows/visual-guide.md",
          "type": "blob",
          "size": 13012
        },
        {
          "path": "plugins/meta/meta-claude/tests",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/meta-claude/tests/README.md",
          "type": "blob",
          "size": 768
        },
        {
          "path": "plugins/meta/meta-claude/tests/__init__.py",
          "type": "blob",
          "size": 49
        },
        {
          "path": "plugins/meta/meta-claude/tests/conftest.py",
          "type": "blob",
          "size": 262
        },
        {
          "path": "plugins/meta/meta-claude/tests/test_package_skill.py",
          "type": "blob",
          "size": 4649
        },
        {
          "path": "plugins/meta/meta-claude/tests/test_quick_validate.py",
          "type": "blob",
          "size": 4415
        },
        {
          "path": "plugins/meta/plugin-dev",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 424
        },
        {
          "path": "plugins/meta/plugin-dev/README.md",
          "type": "blob",
          "size": 15779
        },
        {
          "path": "plugins/meta/plugin-dev/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/agents/agent-creator.md",
          "type": "blob",
          "size": 7636
        },
        {
          "path": "plugins/meta/plugin-dev/agents/plugin-validator.md",
          "type": "blob",
          "size": 7144
        },
        {
          "path": "plugins/meta/plugin-dev/agents/skill-reviewer.md",
          "type": "blob",
          "size": 7935
        },
        {
          "path": "plugins/meta/plugin-dev/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/commands/consider.md",
          "type": "blob",
          "size": 1666
        },
        {
          "path": "plugins/meta/plugin-dev/commands/create-plugin.md",
          "type": "blob",
          "size": 14869
        },
        {
          "path": "plugins/meta/plugin-dev/commands/plugin-review.md",
          "type": "blob",
          "size": 15491
        },
        {
          "path": "plugins/meta/plugin-dev/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/SKILL.md",
          "type": "blob",
          "size": 11616
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/examples/agent-creation-prompt.md",
          "type": "blob",
          "size": 9435
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/examples/complete-agent-examples.md",
          "type": "blob",
          "size": 14131
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/references/agent-creation-system-prompt.md",
          "type": "blob",
          "size": 8879
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/references/agent-spec.md",
          "type": "blob",
          "size": 4262
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/references/system-prompt-design.md",
          "type": "blob",
          "size": 9998
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/references/triggering-examples.md",
          "type": "blob",
          "size": 11613
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/agent-development/scripts/validate-agent.sh",
          "type": "blob",
          "size": 6222
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/README.md",
          "type": "blob",
          "size": 7662
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/SKILL.md",
          "type": "blob",
          "size": 19193
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/examples/plugin-commands.md",
          "type": "blob",
          "size": 14021
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/examples/simple-commands.md",
          "type": "blob",
          "size": 8725
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/references/advanced-workflows.md",
          "type": "blob",
          "size": 13618
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/references/command-spec.md",
          "type": "blob",
          "size": 2972
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/references/documentation-patterns.md",
          "type": "blob",
          "size": 14971
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/references/frontmatter-reference.md",
          "type": "blob",
          "size": 9162
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/references/interactive-commands.md",
          "type": "blob",
          "size": 20980
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/references/marketplace-considerations.md",
          "type": "blob",
          "size": 16437
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/references/plugin-features-reference.md",
          "type": "blob",
          "size": 14622
        },
        {
          "path": "plugins/meta/plugin-dev/skills/command-development/references/testing-strategies.md",
          "type": "blob",
          "size": 14803
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/SKILL.md",
          "type": "blob",
          "size": 16355
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/examples/load-context.sh",
          "type": "blob",
          "size": 1690
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/examples/validate-bash.sh",
          "type": "blob",
          "size": 1304
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/examples/validate-write.sh",
          "type": "blob",
          "size": 1222
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/references/advanced.md",
          "type": "blob",
          "size": 10148
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/references/hook-spec.md",
          "type": "blob",
          "size": 4705
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/references/migration.md",
          "type": "blob",
          "size": 8299
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/references/patterns.md",
          "type": "blob",
          "size": 7144
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/scripts/README.md",
          "type": "blob",
          "size": 3695
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/scripts/hook-linter.sh",
          "type": "blob",
          "size": 4200
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/scripts/test-hook.sh",
          "type": "blob",
          "size": 5336
        },
        {
          "path": "plugins/meta/plugin-dev/skills/hook-development/scripts/validate-hook-schema.sh",
          "type": "blob",
          "size": 5687
        },
        {
          "path": "plugins/meta/plugin-dev/skills/mcp-integration",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/mcp-integration/SKILL.md",
          "type": "blob",
          "size": 12543
        },
        {
          "path": "plugins/meta/plugin-dev/skills/mcp-integration/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/mcp-integration/examples/http-server.json",
          "type": "blob",
          "size": 502
        },
        {
          "path": "plugins/meta/plugin-dev/skills/mcp-integration/examples/sse-server.json",
          "type": "blob",
          "size": 413
        },
        {
          "path": "plugins/meta/plugin-dev/skills/mcp-integration/examples/stdio-server.json",
          "type": "blob",
          "size": 686
        },
        {
          "path": "plugins/meta/plugin-dev/skills/mcp-integration/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/mcp-integration/references/authentication.md",
          "type": "blob",
          "size": 10196
        },
        {
          "path": "plugins/meta/plugin-dev/skills/mcp-integration/references/server-types.md",
          "type": "blob",
          "size": 10613
        },
        {
          "path": "plugins/meta/plugin-dev/skills/mcp-integration/references/tool-usage.md",
          "type": "blob",
          "size": 11674
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/SKILL.md",
          "type": "blob",
          "size": 12104
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/examples/create-settings-command.md",
          "type": "blob",
          "size": 2179
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/examples/example-settings.md",
          "type": "blob",
          "size": 2930
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/examples/read-settings-hook.sh",
          "type": "blob",
          "size": 2205
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/references/parsing-techniques.md",
          "type": "blob",
          "size": 11513
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/references/real-world-examples.md",
          "type": "blob",
          "size": 9496
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/scripts/parse-frontmatter.sh",
          "type": "blob",
          "size": 1269
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-settings/scripts/validate-settings.sh",
          "type": "blob",
          "size": 2712
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure/README.md",
          "type": "blob",
          "size": 3215
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure/SKILL.md",
          "type": "blob",
          "size": 13928
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure/examples/advanced-plugin.md",
          "type": "blob",
          "size": 18755
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure/examples/minimal-plugin.md",
          "type": "blob",
          "size": 1739
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure/examples/standard-plugin.md",
          "type": "blob",
          "size": 13322
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure/references/component-patterns.md",
          "type": "blob",
          "size": 12086
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure/references/manifest-reference.md",
          "type": "blob",
          "size": 12061
        },
        {
          "path": "plugins/meta/plugin-dev/skills/plugin-structure/references/plugin-spec.md",
          "type": "blob",
          "size": 3824
        },
        {
          "path": "plugins/meta/plugin-dev/skills/skill-development",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/skill-development/SKILL.md",
          "type": "blob",
          "size": 25823
        },
        {
          "path": "plugins/meta/plugin-dev/skills/skill-development/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/meta/plugin-dev/skills/skill-development/references/agent-skills-spec.md",
          "type": "blob",
          "size": 1678
        },
        {
          "path": "plugins/meta/plugin-dev/skills/skill-development/references/skill-creator-original.md",
          "type": "blob",
          "size": 17810
        },
        {
          "path": "pyproject.toml",
          "type": "blob",
          "size": 411
        },
        {
          "path": "pyrightconfig.json",
          "type": "blob",
          "size": 978
        },
        {
          "path": "renovate.json",
          "type": "blob",
          "size": 185
        },
        {
          "path": "ruff.toml",
          "type": "blob",
          "size": 1660
        },
        {
          "path": "scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "scripts/README.md",
          "type": "blob",
          "size": 7021
        },
        {
          "path": "scripts/bash_command_validator_example.py",
          "type": "blob",
          "size": 2150
        },
        {
          "path": "scripts/cleanup_bash_research.py",
          "type": "blob",
          "size": 10336
        },
        {
          "path": "scripts/extract_docs_example.py",
          "type": "blob",
          "size": 2524
        },
        {
          "path": "scripts/firecrawl_scrape_url.py",
          "type": "blob",
          "size": 5897
        },
        {
          "path": "scripts/firecrawl_sdk_research.py",
          "type": "blob",
          "size": 16524
        },
        {
          "path": "scripts/intelligent-markdown-lint.py",
          "type": "blob",
          "size": 22447
        },
        {
          "path": "scripts/jina_reader_docs.py",
          "type": "blob",
          "size": 10521
        },
        {
          "path": "scripts/markdown_formatter.py",
          "type": "blob",
          "size": 9417
        },
        {
          "path": "scripts/markdown_linter.py",
          "type": "blob",
          "size": 34587
        },
        {
          "path": "scripts/note_smith.py",
          "type": "blob",
          "size": 12554
        },
        {
          "path": "scripts/notes",
          "type": "tree",
          "size": null
        },
        {
          "path": "scripts/notes/note_2025-11-24_20-40-24.txt",
          "type": "blob",
          "size": 63
        },
        {
          "path": "scripts/notes/note_2025-11-24_21-28-38.txt",
          "type": "blob",
          "size": 41
        },
        {
          "path": "scripts/rumdl-parser.py",
          "type": "blob",
          "size": 9450
        },
        {
          "path": "scripts/test_cache_precision.py",
          "type": "blob",
          "size": 10137
        },
        {
          "path": "scripts/tests",
          "type": "tree",
          "size": null
        },
        {
          "path": "scripts/tests/.gitignore",
          "type": "blob",
          "size": 119
        },
        {
          "path": "scripts/tests/README.md",
          "type": "blob",
          "size": 894
        },
        {
          "path": "scripts/tests/__init__.py",
          "type": "blob",
          "size": 40
        },
        {
          "path": "scripts/tests/conftest.py",
          "type": "blob",
          "size": 217
        },
        {
          "path": "scripts/tests/test_firecrawl_sdk_research.py",
          "type": "blob",
          "size": 10055
        },
        {
          "path": "scripts/validate_research_schema.py",
          "type": "blob",
          "size": 6428
        },
        {
          "path": "scripts/verify-pr.py",
          "type": "blob",
          "size": 17166
        },
        {
          "path": "scripts/verify-structure.py",
          "type": "blob",
          "size": 49894
        },
        {
          "path": "tests",
          "type": "tree",
          "size": null
        },
        {
          "path": "tests/fixtures",
          "type": "tree",
          "size": null
        },
        {
          "path": "tests/fixtures/test-repo",
          "type": "tree",
          "size": null
        },
        {
          "path": "tests/fixtures/test-repo/.rumdl.toml",
          "type": "blob",
          "size": 267
        },
        {
          "path": "tests/fixtures/test-repo/ambiguous-errors.md",
          "type": "blob",
          "size": 326
        },
        {
          "path": "tests/fixtures/test-repo/references.md",
          "type": "blob",
          "size": 114
        },
        {
          "path": "tests/fixtures/test-repo/simple-errors.md",
          "type": "blob",
          "size": 279
        },
        {
          "path": "tests/test_aggregation.py",
          "type": "blob",
          "size": 2473
        },
        {
          "path": "tests/test_e2e_intelligent_linting.py",
          "type": "blob",
          "size": 2452
        },
        {
          "path": "tests/test_sdk_migration.py",
          "type": "blob",
          "size": 13128
        },
        {
          "path": "tests/test_verify_structure.py",
          "type": "blob",
          "size": 21503
        },
        {
          "path": "uv.lock",
          "type": "blob",
          "size": 250804
        }
      ],
      "marketplace": {
        "name": "lunar-claude",
        "version": null,
        "description": null,
        "owner_info": {
          "name": "basher83",
          "email": "basher83@mail.spaceships.work"
        },
        "keywords": [],
        "plugins": [
          {
            "name": "meta-claude",
            "description": "Meta tools for creating and composing Claude Code components including skills, agents, hooks, commands, and multi-component system architecture",
            "source": "./plugins/meta/meta-claude",
            "category": "meta",
            "version": "0.3.0",
            "author": {
              "name": "basher83"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install meta-claude@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [
              {
                "name": "/prime",
                "description": "Load context for a new agent session by analyzing codebase structure and README",
                "path": "plugins/meta/meta-claude/commands/prime.md",
                "frontmatter": {
                  "description": "Load context for a new agent session by analyzing codebase structure and README",
                  "argument-hint": "[path|--deep|--minimal]",
                  "allowed-tools": "Bash, Read"
                },
                "content": "# Prime\n\nLoad essential context for a new agent session: $ARGUMENTS\n\n## Arguments\n\n- `<path>` - Focus on a specific directory or file pattern\n- `--deep` - Include detailed file contents from key areas\n- `--minimal` - Only show structure, skip README/CHANGELOG\n- (none) - Default full context load\n\n## Context\n\n### Codebase Structure\n\nGit-tracked files: !`git ls-files $ARGUMENTS 2>/dev/null | head -100 || git ls-files | head -100`\n\nDirectory tree: !`eza . --tree --level=3 --git-ignore 2>/dev/null || find . -type f -name \"*.md\" -o -name \"*.py\" -o -name \"*.ts\" -o -name \"*.json\" | head -50`\n\n### Project Documentation\n\n@README.md\n@CHANGELOG.md\n\n## Instructions\n\n1. Analyze the codebase structure to understand file organization\n2. Read README.md to understand project purpose and setup\n3. Note key directories and their purposes\n4. Provide a concise overview including:\n   - Project purpose\n   - Key directories/components\n   - Important patterns or conventions\n   - Next steps if applicable\n\nIf `$ARGUMENTS` contains a path, focus analysis on that area.\nIf `--minimal`, skip documentation reading.\nIf `--deep`, also examine key configuration files."
              }
            ],
            "skills": [
              {
                "name": "multi-agent-composition",
                "description": "This skill should be used when the user asks to \"choose between skill and agent\", \"compose multi-agent system\", \"orchestrate agents\", \"manage agent context\", \"design component architecture\", \"should I use a skill or agent\", \"when to use hooks vs MCP\", \"build orchestrator workflow\", needs decision frameworks for Claude Code components (skills, sub-agents, hooks, MCP servers, slash commands), context management patterns, or wants to build effective multi-component agentic systems with proper orchestration and anti-patterns guidance.\n",
                "path": "plugins/meta/meta-claude/skills/multi-agent-composition/SKILL.md",
                "frontmatter": {
                  "name": "multi-agent-composition",
                  "description": "This skill should be used when the user asks to \"choose between skill and agent\", \"compose multi-agent system\", \"orchestrate agents\", \"manage agent context\", \"design component architecture\", \"should I use a skill or agent\", \"when to use hooks vs MCP\", \"build orchestrator workflow\", needs decision frameworks for Claude Code components (skills, sub-agents, hooks, MCP servers, slash commands), context management patterns, or wants to build effective multi-component agentic systems with proper orchestration and anti-patterns guidance.\n"
                },
                "content": "# Multi-Agent Composition\n\n**Master Claude Code's components, patterns, and principles** to build effective agentic systems.\n\n## When to Use This Knowledge\n\nUse this knowledge when:\n\n- **Learning Claude Code** - Understanding what each component does\n- **Making architectural decisions** - Choosing Skills vs Sub-Agents vs MCP vs Slash Commands\n- **Building custom solutions** - Creating specialized agents or orchestration systems\n- **Scaling agentic workflows** - Moving from single agents to multi-agent orchestration\n- **Debugging issues** - Understanding why components behave certain ways\n- **Adding observability** - Implementing hooks for monitoring and control\n\n## Quick Reference\n\n### The Core 4 Framework\n\nEvery agent is built on these four elements:\n\n1. **Context** - What information does the agent have?\n2. **Model** - What capabilities does the model provide?\n3. **Prompt** - What instruction are you giving?\n4. **Tools** - What actions can the agent take?\n\n> \"Everything comes down to just four pieces. If you understand these, you will win.\"\n\n### Component Overview\n\n| Component | Trigger | Use When | Best For |\n|-----------|---------|----------|----------|\n| **Skills** | Agent-invoked | Repeat problems needing management | Domain-specific workflows |\n| **Sub-Agents** | Tool-invoked | Parallelization & context isolation | Scale & batch operations |\n| **MCP Servers** | As needed | External data/services | Integration with external systems |\n| **Slash Commands** | Manual/tool | One-off tasks | Simple repeatable prompts |\n| **Hooks** | Lifecycle events | Observability & control | Monitoring & blocking |\n\n### Composition Hierarchy\n\n```text\nSkills (Top Layer)\n   Can use: Sub-Agents, Slash Commands, MCP Servers, Other Skills\n   Purpose: Orchestrate primitives for repeatable workflows\n\nSub-Agents (Execution Layer)\n   Can use: Slash Commands, Skills\n   Cannot nest other Sub-Agents\n\nSlash Commands (Primitive Layer)\n   The fundamental building block\n\nMCP Servers (Integration Layer)\n   Connect external systems\n```\n\n### Golden Rules\n\n1. **Always start with prompts** - Master the primitive first\n2. **\"Parallel\" = Sub-Agents** - Nothing else supports parallel execution\n3. **External = MCP, Internal = Skills** - Clear separation of concerns\n4. **One-off = Slash Command** - Don't over-engineer\n5. **Repeat + Management = Skill** - Only scale when needed\n6. **Don't convert all slash commands to skills** - Huge mistake\n7. **Context, Model, Prompt, Tools** - Never forget the foundation\n\n## Documentation Structure\n\nThis skill uses progressive disclosure. Start here, then navigate to specific topics as needed.\n\n### Reference Documentation\n\n**Architecture fundamentals** - What each component is and how they work\n\n- **[architecture.md](reference/architecture.md)** - Component definitions, capabilities, restrictions\n- **[core-4-framework.md](reference/core-4-framework.md)** - Deep dive into Context, Model, Prompt, Tools\n\n### Implementation Patterns\n\n**How to use components effectively** - Decision-making and implementation\n\n- **[decision-framework.md](patterns/decision-framework.md)** - When to use Skills vs Sub-Agents vs MCP vs Slash Commands\n- **[hooks-in-composition.md](patterns/hooks-in-composition.md)** - Implementing hooks for observability and control\n- **[orchestrator-pattern.md](patterns/orchestrator-pattern.md)** - Multi-agent orchestration at scale\n- **[context-management.md](patterns/context-management.md)** - Managing context across agents\n- **[context-in-composition.md](patterns/context-in-composition.md)** - Context handling in multi-agent systems\n\n### Anti-Patterns\n\n#### Common mistakes to avoid\n\n- **[common-mistakes.md](anti-patterns/common-mistakes.md)** - Converting all slash commands to\n  skills, using skills for one-offs, context explosion, and more\n\n### Examples\n\n#### Real-world case studies and progression paths\n\n- **[progression-example.md](examples/progression-example.md)** - Evolution from prompt  sub-agent  skill (work tree manager example)\n- **[case-studies.md](examples/case-studies.md)** - Scout-builder patterns, orchestration workflows, multi-agent systems\n\n### Workflows\n\n#### Visual guides and decision trees\n\n- **[decision-tree.md](workflows/decision-tree.md)** - Decision trees, mindmaps, and visual guides for choosing components\n\n## Getting Started\n\n### If you're new to Claude Code\n\n1. Start with **[reference/architecture.md](reference/architecture.md)** to understand components\n2. Read **[reference/core-4-framework.md](reference/core-4-framework.md)** to grasp the foundation\n3. Use **[patterns/decision-framework.md](patterns/decision-framework.md)** to make your first architectural choice\n4. Check **[anti-patterns/common-mistakes.md](anti-patterns/common-mistakes.md)** to avoid pitfalls\n\n### If you're making an architectural decision\n\n1. Open **[patterns/decision-framework.md](patterns/decision-framework.md)**\n2. Follow the decision tree to identify the right component\n3. Review the specific component in **[reference/architecture.md](reference/architecture.md)**\n4. Check **[examples/](examples/)** for similar use cases\n\n### If you're adding observability\n\n1. Read **[patterns/hooks-in-composition.md](patterns/hooks-in-composition.md)** to understand available hooks and implementation\n2. Use isolated scripts pattern (UV, bun, or shell)\n\n### If you're scaling to multi-agent orchestration\n\n1. Ensure you've mastered custom agents first\n2. Read **[patterns/orchestrator-pattern.md](patterns/orchestrator-pattern.md)**\n3. Study **[examples/case-studies.md](examples/case-studies.md)**\n4. Review **[patterns/context-management.md](patterns/context-management.md)**\n\n## Key Principles from the Field\n\n### Prompts Are the Primitive\n\n> \"Do not give away the prompt. The prompt is the fundamental unit of knowledge work and of programming. If you don't know how to build and manage prompts, you will lose.\"\n\n**Everything is prompts in the end.** Master slash commands before skills. Have a strong bias toward slash commands.\n\n### Skills Are Compositional, Not Replacements\n\n> \"It is very clear this does not replace any existing feature or capability. It is a higher compositional level.\"\n\nSkills orchestrate other components; they don't replace them. Don't convert all your\nslash commands to skillsthat's a huge mistake.\n\n### Observability is Everything\n\n> \"When it comes to agentic coding, observability is everything. How well you can observe, iterate, and improve your agentic system is going to be a massive differentiating factor.\"\n\nIf you can't measure it, you can't improve it. If you can't measure it, you can't scale it.\n\n### Context Window Protection\n\n> \"200k context window is plenty. You're just stuffing a single agent with too much work. Don't force your agent to context switch.\"\n\nCreate focused agents with single purposes. Delete them when done. Treat agents as temporary, deletable resources.\n\n### The Agentic Engineering Progression\n\n```text\nLevel 1: Base agents        Use agents out of the box\nLevel 2: Better agents      Customize prompts and workflows\nLevel 3: More agents        Run multiple agents\nLevel 4: Custom agents      Build specialized solutions\nLevel 5: Orchestration      Manage fleets of agents\n```\n\n## Source Attribution\n\nThis knowledge synthesizes:\n\n- Video presentations by Claude Code engineering team\n- Official Claude Code documentation (docs.claude.com)\n- Hands-on experimentation and validation\n- Multi-agent orchestration patterns from the field\n\n## Quick Navigation\n\n**Need to understand what a component is?**  [reference/architecture.md](reference/architecture.md)\n\n**Need to choose the right component?**  [patterns/decision-framework.md](patterns/decision-framework.md)\n\n**Need to implement hooks?**  [patterns/hooks-in-composition.md](patterns/hooks-in-composition.md)\n\n**Need to scale to multiple agents?**  [patterns/orchestrator-pattern.md](patterns/orchestrator-pattern.md)\n\n**Need to see real examples?**  [examples/](examples/)\n\n**Need visual guides?**  [workflows/decision-tree.md](workflows/decision-tree.md)\n\n**Want to avoid mistakes?**  [anti-patterns/common-mistakes.md](anti-patterns/common-mistakes.md)\n\n---\n\n**Remember:** Context, Model, Prompt, Tools. Master these four, and you master Claude Code."
              },
              {
                "name": "skill-factory",
                "description": "Research-backed skill creation workflow with automated firecrawl research gathering, multi-tier validation, and comprehensive auditing. Use when \"create skills with research automation\", \"build research-backed skills\", \"validate skills end-to-end\", \"automate skill research and creation\", needs 9-phase workflow from research through final audit, wants firecrawl-powered research combined with validation, or requires quality-assured skill creation following Anthropic specifications for Claude Code.\n",
                "path": "plugins/meta/meta-claude/skills/skill-factory/SKILL.md",
                "frontmatter": {
                  "name": "skill-factory",
                  "description": "Research-backed skill creation workflow with automated firecrawl research gathering, multi-tier validation, and comprehensive auditing. Use when \"create skills with research automation\", \"build research-backed skills\", \"validate skills end-to-end\", \"automate skill research and creation\", needs 9-phase workflow from research through final audit, wants firecrawl-powered research combined with validation, or requires quality-assured skill creation following Anthropic specifications for Claude Code.\n"
                },
                "content": "# Skill Factory\n\nComprehensive workflow orchestrator for creating high-quality Claude Code skills with automated research, content\nreview, and multi-tier validation.\n\n## When to Use This Skill\n\nUse skill-factory when:\n\n- **Creating any new skill** - From initial idea to validated, production-ready skill\n- **Research needed** - Automate gathering of documentation, examples, and best practices\n- **Quality assurance required** - Ensure skills meet official specifications and best practices\n- **Guided workflow preferred** - Step-by-step progression with clear checkpoints\n- **Validation needed** - Runtime testing, integration checks, and comprehensive auditing\n\n**Scope:** Creates skills for ANY purpose (not limited to meta-claude plugin):\n\n- Infrastructure skills (terraform-best-practices, ansible-vault-security)\n- Development skills (docker-compose-helper, git-workflow-automation)\n- Domain-specific skills (brand-guidelines, conventional-git-commits)\n- Any skill that extends Claude's capabilities\n\n## Available Operations\n\nThe skill-factory provides 9 specialized commands for the create-review-validate lifecycle:\n\n| Command | Purpose | Use When |\n|---------|---------|----------|\n| `/meta-claude:skill:research` | Gather domain knowledge using firecrawl API | Need automated web scraping for skill research |\n| `/meta-claude:skill:format` | Clean and structure research materials | Have raw research needing markdown formatting |\n| `/meta-claude:skill:create` | Initialize skill structure with references | Ready to scaffold skill directory from research |\n| `/meta-claude:skill:write` | Synthesize references into SKILL.md content | Skill initialized but needs content written |\n| `/meta-claude:skill:review-content` | Validate content quality and clarity | Need content review before compliance check |\n| `/meta-claude:skill:review-compliance` | Run quick_validate.py on SKILL.md | Validate YAML frontmatter and naming conventions |\n| `/meta-claude:skill:validate-runtime` | Test skill loading in Claude context | Verify skill loads without syntax errors |\n| `/meta-claude:skill:validate-integration` | Check for conflicts with existing skills | Ensure no duplicate names or overlaps |\n| `/meta-claude:skill:validate-audit` | Invoke claude-skill-auditor agent | Get comprehensive audit against Anthropic specs |\n\n**Power user tip:** Commands work standalone or orchestrated. Use individual commands for targeted fixes,\nor invoke the skill for full workflow automation.\n\n**Visual learners:** See [workflows/visual-guide.md](workflows/visual-guide.md) for decision trees, state diagrams,\nand workflow visualizations.\n\n## Quick Decision Guide\n\n### Full Workflow vs Individual Commands\n\n**Creating new skill (full workflow):**\n\n- With research  `skill-factory <skill-name> <research-path>`\n- Without research  `skill-factory <skill-name>` (includes firecrawl research)\n- From knowledge only  `skill-factory <skill-name>`  Select \"Skip research\"\n\n**Using individual commands (power users):**\n\n| Scenario | Command | Why |\n|----------|---------|-----|\n| Need web research for skill topic | `/meta-claude:skill:research <name> [sources]` | Automated firecrawl scraping |\n| Have messy research files | `/meta-claude:skill:format <research-dir>` | Clean markdown formatting |\n| Ready to scaffold skill directory | `/meta-claude:skill:create <name> <research-dir>` | Creates structure with references |\n| Skill initialized, needs content | `/meta-claude:skill:write <skill-path>` | Synthesizes references into SKILL.md |\n| Content unclear or incomplete | `/meta-claude:skill:review-content <skill-path>` | Quality gate before compliance |\n| Check frontmatter syntax | `/meta-claude:skill:review-compliance <skill-path>` | Runs quick_validate.py |\n| Skill won't load in Claude | `/meta-claude:skill:validate-runtime <skill-path>` | Tests actual loading |\n| Worried about name conflicts | `/meta-claude:skill:validate-integration <skill-path>` | Checks existing skills |\n| Want Anthropic spec audit | `/meta-claude:skill:validate-audit <skill-path>` | Runs claude-skill-auditor |\n\n**When to use full workflow:** Creating new skills from scratch\n**When to use individual commands:** Fixing specific issues, power user iteration\n\nFor full workflow details, see Quick Start section below.\n\n## Quick Start\n\n### Path 1: Research Already Gathered\n\nIf you have research materials ready:\n\n```bash\n# Research exists at docs/research/skills/<skill-name>/\nskill-factory <skill-name> docs/research/skills/<skill-name>/\n```\n\nThe skill will:\n\n1. Format research materials\n2. Create skill structure (scaffold)\n3. Write skill content (synthesize references)\n4. Review content quality\n5. Review technical compliance\n6. Validate runtime loading\n7. Validate integration\n8. Run comprehensive audit\n9. Present completion options\n\n### Path 2: Research Needed\n\nIf starting from scratch:\n\n```bash\n# Let skill-factory handle research\nskill-factory <skill-name>\n```\n\nThe skill will ask about research sources and proceed through full workflow.\n\n### Example Usage\n\n```text\nUser: \"Create a skill for CodeRabbit code review best practices\"\n\nskill-factory detects no research path provided, asks:\n\n\"Have you already gathered research for this skill?\n[Yes - I have research at <path>]\n[No - Help me gather research]\n[Skip - I'll create from knowledge only]\"\n\nUser: \"No - Help me gather research\"\n\nskill-factory proceeds through Path 2:\n1. Research skill domain\n2. Format research materials\n3. Create skill structure\n... (continues through all phases)\n```\n\n## When This Skill Is Invoked\n\n**Your role:** You are the skill-factory orchestrator. Your task is to guide the user through creating\na high-quality, validated skill using 9 primitive slash commands.\n\n### Step 1: Entry Point Detection\n\nAnalyze the user's prompt to determine which workflow path to use:\n\n**If research path is explicitly provided:**\n\n```text\nUser: \"skill-factory coderabbit docs/research/skills/coderabbit/\"\n Use Path 1 (skip research phase)\n```\n\n**If no research path is provided:**\n\nAsk the user using AskUserQuestion:\n\n```text\n\"Have you already gathered research for this skill?\"\n\nOptions:\n[Yes - I have research at a specific location]\n[No - Help me gather research]\n[Skip - I'll create from knowledge only]\n```\n\n**Based on user response:**\n\n- **Yes**  Ask for research path, use Path 1\n- **No**  Use Path 2 (include research phase)\n- **Skip**  Use Path 1 without research (create from existing knowledge)\n\n### Step 2: Initialize TodoWrite\n\nCreate a TodoWrite list based on the selected path:\n\n**Path 2 (Full Workflow with Research):**\n\n```javascript\nTodoWrite([\n  {\"content\": \"Research skill domain\", \"status\": \"pending\", \"activeForm\": \"Researching skill domain\"},\n  {\"content\": \"Format research materials\", \"status\": \"pending\", \"activeForm\": \"Formatting research materials\"},\n  {\"content\": \"Create skill structure\", \"status\": \"pending\", \"activeForm\": \"Creating skill structure\"},\n  {\"content\": \"Write skill content\", \"status\": \"pending\", \"activeForm\": \"Writing skill content\"},\n  {\"content\": \"Review content quality\", \"status\": \"pending\", \"activeForm\": \"Reviewing content quality\"},\n  {\"content\": \"Review technical compliance\", \"status\": \"pending\", \"activeForm\": \"Reviewing technical compliance\"},\n  {\"content\": \"Validate runtime loading\", \"status\": \"pending\", \"activeForm\": \"Validating runtime loading\"},\n  {\"content\": \"Validate integration\", \"status\": \"pending\", \"activeForm\": \"Validating integration\"},\n  {\"content\": \"Run comprehensive audit\", \"status\": \"pending\", \"activeForm\": \"Running comprehensive audit\"},\n  {\"content\": \"Complete workflow\", \"status\": \"pending\", \"activeForm\": \"Completing workflow\"}\n])\n```\n\n**Path 1 (Research Exists or Skipped):**\n\nOmit the first \"Research skill domain\" task. Start with \"Format research materials\" or\n\"Create skill structure\" depending on whether research exists.\n\n### Step 3: Execute Workflow Sequentially\n\nFor each phase in the workflow, follow this pattern:\n\n#### 1. Mark phase as in_progress\n\nUpdate the corresponding TodoWrite item to `in_progress` status.\n\n#### 2. Check dependencies\n\nBefore running a command, verify prior phases completed:\n\n- Write requires create to complete (needs skill structure with references)\n- Review-content requires write to complete (needs actual content to review)\n- Review-compliance requires review-content to pass\n- Validate-runtime requires review-compliance to pass\n- Validate-integration requires validate-runtime to pass\n- Validate-audit runs regardless (non-blocking feedback)\n\n#### 3. Invoke command using SlashCommand tool\n\n```text\n/meta-claude:skill:research <skill-name> [sources]\n/meta-claude:skill:format <research-dir>\n/meta-claude:skill:create <skill-name> <research-dir>\n/meta-claude:skill:write <skill-path>\n/meta-claude:skill:review-content <skill-path>\n/meta-claude:skill:review-compliance <skill-path>\n/meta-claude:skill:validate-runtime <skill-path>\n/meta-claude:skill:validate-integration <skill-path>\n/meta-claude:skill:validate-audit <skill-path>\n```\n\n**IMPORTANT:** Wait for each command to complete before proceeding to the next phase.\nDo not invoke multiple commands in parallel.\n\n#### 4. Check command result\n\nEach command returns success or failure with specific error details.\n\n#### 5. Apply fix strategy if needed\n\nThe workflow uses a three-tier fix strategy:\n\n- **Tier 1 (Simple):** Auto-fix formatting, frontmatter, markdown syntax\n- **Tier 2 (Medium):** Guided fixes with user approval\n- **Tier 3 (Complex):** Stop and report - requires manual fixes\n\n**One-shot policy:** Each fix applied once, re-run once, then fail fast if still broken.\n\n**For complete tier definitions, issue categorization, examples, and fix workflows:**\nSee [references/error-handling.md](references/error-handling.md)\n\n#### 6. Mark phase completed\n\nUpdate TodoWrite item to `completed` status.\n\n#### 7. Continue to next phase\n\nProceed to the next workflow phase, or exit if fail-fast triggered.\n\n### Step 4: Completion\n\nWhen all phases pass successfully:\n\n**Present completion summary:**\n\n```text\n Skill created and validated successfully!\n\nLocation: <skill-output-path>/\n\nResearch materials: docs/research/skills/<skill-name>/\n```\n\n**Ask about artifact cleanup:**\n\n```text\nKeep research materials? [Keep/Remove] (default: Keep)\n```\n\n**Present next steps using AskUserQuestion:**\n\n```text\nNext steps - choose an option:\n[Test in new session - Skills require session reload to be discoverable]\n[Create PR - Submit skill to repository]\n[Done - Exit workflow]\n```\n\n**Execute user's choice:**\n\n- **Test in new session**  Skills load at session start. User must restart Claude Code to test.\n- **Create PR**  Create git branch, commit, push, open PR\n- **Done**  Clean exit\n\n**Note:** Skills auto-discover based on directory structure - no plugin.json registration needed.\n\n### Key Execution Principles\n\n**Sequential Execution:** Do not run commands in parallel. Wait for each phase to complete before proceeding.\n\n**Context Window Protection:** You are orchestrating commands, not sub-agents. Your context window is safe\nbecause you're invoking slash commands sequentially, not spawning multiple agents.\n\n**State Management:** TodoWrite provides real-time progress visibility. Update it at every phase\ntransition.\n\n**Fail Fast:** When Tier 3 issues occur or user declines fixes, exit immediately with clear guidance.\nDon't attempt complex recovery.\n\n**Dependency Enforcement:** Never skip dependency checks. Review phases are sequential, validation\nphases are tiered.\n\n**One-shot Fixes:** Apply each fix once, re-run once, then fail if still broken. This prevents infinite loops.\n\n**User Communication:** Report progress clearly. Show which phase is running, what the result was,\nand what's happening next.\n\n## Workflow Architecture\n\nTwo paths based on research availability: Path 1 (research exists) and Path 2 (research needed).\nTodoWrite tracks progress through 8-10 phases. Entry point detection uses prompt analysis and AskUserQuestion.\n\n**Details:** See [references/workflow-architecture.md](references/workflow-architecture.md)\n\n## Workflow Execution\n\nSequential phase invocation pattern: mark in_progress  check dependencies  invoke command \ncheck result  apply fixes  mark completed  continue. Dependencies enforced (review sequential,\nvalidation tiered). Commands invoked via SlashCommand tool with wait-for-completion pattern.\n\n**Details:** See [references/workflow-execution.md](references/workflow-execution.md)\n\n## Success Completion\n\nWhen all phases pass successfully:\n\n```text\n Skill created and validated successfully!\n\nLocation: <skill-output-path>/\n\nResearch materials: docs/research/skills/<skill-name>/\nKeep research materials? [Keep/Remove] (default: Keep)\n```\n\n**Artifact Cleanup:**\n\nAsk user about research materials:\n\n- **Keep** (default): Preserves research for future iterations, builds knowledge base\n- **Remove**: Cleans up workspace, research can be re-gathered if needed\n\n**Next Steps:**\n\nPresent options to user:\n\n```text\nNext steps - choose an option:\n  [1] Test in new session - Skills require session reload to be discoverable\n  [2] Create PR - Submit skill to repository\n  [3] Done - Exit workflow\n\nWhat would you like to do?\n```\n\n**User Actions:**\n\n1. **Test in new session**  Skills load at session start. User must restart Claude Code to test.\n2. **Create PR**  Create git branch, commit, push, open PR\n3. **Done**  Clean exit\n\n**Note:** Skills auto-discover based on directory structure - no plugin.json registration needed.\n\nExecute the user's choice, then exit cleanly.\n\n## Examples\n\nThe skill-factory workflow supports various scenarios:\n\n1. **Path 2 (Full Workflow):** Creating skills from scratch with automated research gathering\n2. **Path 1 (Existing Research):** Creating skills when research materials already exist\n3. **Guided Fix Workflow:** Applying Tier 2 fixes with user approval\n4. **Fail-Fast Pattern:** Handling Tier 3 complex issues with immediate exit\n\n**Detailed Examples:** See [references/workflow-examples.md](references/workflow-examples.md) for complete walkthrough\nscenarios showing TodoWrite state transitions, command invocations, error handling, and success paths.\n\n## Design Principles\n\nSix core principles: (1) Primitives First (slash commands foundation), (2) KISS State Management (TodoWrite only),\n(3) Fail Fast (no complex recovery), (4) Context-Aware Entry (prompt analysis), (5) Composable & Testable\n(standalone or orchestrated), (6) Quality Gates (sequential dependencies).\n\n**Details:** See [references/design-principles.md](references/design-principles.md)\n\n## Implementation Notes\n\n### Command-Based Architecture\n\nskill-factory orchestrates 9 primitive slash commands through a sequential workflow:\n\n**Creation Phase:**\n\n- `/meta-claude:skill:research`  Gather domain knowledge via firecrawl\n- `/meta-claude:skill:format`  Clean and structure research materials\n- `/meta-claude:skill:create`  Scaffold skill directory with references (runs init_skill.py)\n- `/meta-claude:skill:write`  Synthesize references into SKILL.md content\n\n**Validation Phase:**\n\n- `/meta-claude:skill:review-content`  Quality gate for clarity and completeness\n- `/meta-claude:skill:review-compliance`  Technical validation via quick_validate.py\n- `/meta-claude:skill:validate-runtime`  Test actual skill loading\n- `/meta-claude:skill:validate-integration`  Check for naming conflicts\n- `/meta-claude:skill:validate-audit`  Comprehensive audit via claude-skill-auditor agent\n\nEach command is standalone and testable. skill-factory provides orchestration, not abstraction.\n\n### Progressive Disclosure\n\nThis skill provides:\n\n1. **Quick Start** - Fast path for common use cases\n2. **Workflow Architecture** - Understanding the orchestration model\n3. **Detailed Phase Documentation** - Deep dive into each phase\n4. **Error Handling** - Comprehensive fix strategies\n5. **Examples** - Real-world scenarios\n\nLoad sections as needed for your use case.\n\n## Troubleshooting\n\nCommon issues: research phase failures (check FIRECRAWL_API_KEY), content review loops (Tier 3 issues need\nredesign), compliance validation (run quick_validate.py manually), integration conflicts (check duplicate names).\n\n**Details:** See [references/troubleshooting.md](references/troubleshooting.md)\n\n## Success Metrics\n\nYou know skill-factory succeeds when:\n\n1. **Time to create skill:** Reduced from hours to minutes\n2. **Skill quality:** 100% compliance with official specs on first validation\n3. **User satisfaction:** Beginners create high-quality skills without deep knowledge\n4. **Maintainability:** Primitives are independently testable and reusable\n5. **Workflow clarity:** Users understand current phase and next steps at all times\n\n## Related Resources\n\n- **multi-agent-composition skill** - Architectural patterns and composition rules\n- **Primitive commands** - Individual slash commands under `/meta-claude:skill:*` namespace\n- **quick_validate.py** - Compliance validation script\n- **skill-audit-agent** - Comprehensive skill audit agent"
              }
            ]
          },
          {
            "name": "claude-dev-sandbox",
            "description": "Development sandbox for testing and prototyping Claude Code components (hooks, skills, commands, agents) before promoting to production plugins",
            "source": "./plugins/meta/claude-dev-sandbox",
            "category": "meta",
            "version": "0.1.0",
            "author": {
              "name": "basher83"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install claude-dev-sandbox@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [
              {
                "name": "/hello",
                "description": "A hello world command",
                "path": "plugins/meta/claude-dev-sandbox/commands/hello.md",
                "frontmatter": {
                  "description": "A hello world command"
                },
                "content": "# Hello Command"
              }
            ],
            "skills": [
              {
                "name": "coderabbit",
                "description": "AI-powered code review using CodeRabbit CLI and GitHub integration. Use when running local code reviews before commits (\"run coderabbit\", \"review my changes\"), configuring .coderabbit.yaml files, integrating CodeRabbit with Claude Code for autonomous review workflows, using @coderabbitai commands in pull requests, or setting up automated code review pipelines.\n",
                "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit/SKILL.md",
                "frontmatter": {
                  "name": "coderabbit",
                  "description": "AI-powered code review using CodeRabbit CLI and GitHub integration. Use when running local code reviews before commits (\"run coderabbit\", \"review my changes\"), configuring .coderabbit.yaml files, integrating CodeRabbit with Claude Code for autonomous review workflows, using @coderabbitai commands in pull requests, or setting up automated code review pipelines.\n"
                },
                "content": "# CodeRabbit\n\nAI code review tool that catches race conditions, memory leaks, and security vulnerabilities.\nIntegrates with Claude Code for autonomous review-and-fix workflows.\n\n## Quick Start: Claude Code Integration\n\nRun CodeRabbit as part of your development workflow:\n\n```text\nImplement the feature from the spec, then run coderabbit --prompt-only\nin the background and fix any issues found.\n```\n\nKey flags for Claude Code:\n\n- `--prompt-only` - Minimal output optimized for AI agents\n- `--plain` - Plain text mode (no interactive UI)\n- `--type uncommitted` - Review only uncommitted changes\n\n## CLI Commands\n\n```bash\n# Install\ncurl -fsSL https://cli.coderabbit.ai/install.sh | sh\n\n# Authenticate (run once per Claude Code session)\ncoderabbit auth login\n\n# Review code\ncoderabbit                          # Interactive mode\ncoderabbit --plain                  # Plain text output\ncoderabbit --prompt-only            # AI-optimized output\ncoderabbit --type uncommitted       # Only uncommitted changes\ncoderabbit --base develop           # Compare against develop branch\n```\n\n## Claude Code Workflow\n\nRecommended prompt pattern:\n\n```text\nPlease implement [feature] and then run coderabbit --prompt-only,\nlet it run as long as it needs (run it in the background) and fix any issues.\n```\n\nCodeRabbit reviews take 7-30+ minutes. Run in background and check periodically.\n\n**Fix prioritization:** Fix critical issues first, ignore nits. Run CodeRabbit\nagain after fixes to verify no new issues introduced. Limit to 2 iterations.\n\n## GitHub Commands\n\nUse `@coderabbitai` in PR comments:\n\n| Command | Description |\n|---------|-------------|\n| `@coderabbitai review` | Incremental review of new changes |\n| `@coderabbitai full review` | Complete review from scratch |\n| `@coderabbitai pause` | Stop automatic reviews |\n| `@coderabbitai resume` | Restart reviews |\n| `@coderabbitai summary` | Regenerate PR summary |\n| `@coderabbitai generate docstrings` | Generate function docs (Pro) |\n| `@coderabbitai generate unit tests` | Generate tests (Pro) |\n| `@coderabbitai resolve` | Resolve all CR comments |\n| `@coderabbitai configuration` | Show current settings |\n\nAdd `@coderabbitai ignore` to PR **description** to disable reviews for that PR.\n\n## Configuration (.coderabbit.yaml)\n\n```yaml\n# yaml-language-server: $schema=https://coderabbit.ai/integrations/schema.v2.json\nlanguage: en-US\ntone_instructions: \"Be concise and focus on critical issues only\"\n\nreviews:\n  profile: chill  # or \"assertive\" for comprehensive feedback\n  high_level_summary: true\n  auto_review:\n    enabled: true\n    drafts: false\n    ignore_title_keywords:\n      - \"wip\"\n      - \"draft\"\n\nknowledge_base:\n  code_guidelines:\n    enabled: true\n    filePatterns:\n      - \"**/.cursorrules\"\n      - \"**/claude.md\"\n```\n\nCodeRabbit auto-reads `claude.md` and `.cursorrules` for coding standards.\n\n## Supported Tools\n\nCodeRabbit integrates 40+ linters and security analyzers:\n\n- **JavaScript/TypeScript:** ESLint, Biome, Oxlint\n- **Python:** Ruff, Pylint, Flake8\n- **Go:** golangci-lint\n- **Security:** Gitleaks, Semgrep, OSV Scanner\n- **Infrastructure:** Checkov, Hadolint\n- **CI/CD:** actionlint, CircleCI\n\n**Full tools reference:** See [references/tools-reference.md](references/tools-reference.md)\n\n## Troubleshooting\n\n**CodeRabbit not finding issues:**\n\n1. Check auth: `coderabbit auth status`\n2. Verify git status: `git status`\n3. Specify review type: `--type uncommitted`\n4. Specify base branch: `--base develop`\n\n**Claude Code not applying fixes:**\n\n1. Use `--prompt-only` mode\n2. Include \"run in background\" in prompt\n3. Explicitly ask to \"fix issues found by CodeRabbit\"\n\n## References\n\n- **Overview:** [references/overview.md](references/overview.md)\n- **Claude Code Integration:** [references/claude-code-integration.md](references/claude-code-integration.md)\n- **YAML Configuration:** [references/yaml-configuration-guide.md](references/yaml-configuration-guide.md)\n- **GitHub Commands:** [references/github-commands.md](references/github-commands.md)\n- **Tools Reference:** [references/tools-reference.md](references/tools-reference.md)\n- **Full Configuration:** [references/configuration.md](references/configuration.md)"
              },
              {
                "name": "official_docs",
                "description": "Skills for accessing official documentation",
                "path": "plugins/meta/claude-dev-sandbox/skills/official_docs/SKILL.md",
                "frontmatter": {
                  "name": "official_docs",
                  "description": "Skills for accessing official documentation"
                },
                "content": "# Official Docs Skill"
              }
            ]
          },
          {
            "name": "ansible-workflows",
            "description": "End-to-end Ansible workflow automation: design, create, validate, and review playbooks and roles with orchestrated multi-agent pipelines",
            "source": "./plugins/infrastructure/ansible-workflows",
            "category": "infrastructure",
            "version": "1.0.1",
            "author": {
              "name": "basher83"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install ansible-workflows@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [
              {
                "name": "/analyze",
                "description": "Analyze Ansible code for improvements or suggest enhancements",
                "path": "plugins/infrastructure/ansible-workflows/commands/analyze.md",
                "frontmatter": {
                  "description": "Analyze Ansible code for improvements or suggest enhancements",
                  "argument-hint": "<path> [--mode review|enhance]",
                  "allowed-tools": [
                    "Read",
                    "Grep",
                    "Glob",
                    "Bash",
                    "WebSearch"
                  ],
                  "model": "sonnet"
                },
                "content": "Analyze Ansible code at `$1` in mode `$2` (default: review).\n\nLoad ALL ansible-* skills before analyzing.\n\n**Mode: review** (analyze existing code)\n\nCheck for:\n- **Idempotency:** changed_when on commands, check-before-create patterns\n- **Security:** no_log on secrets, no hardcoded credentials\n- **Structure:** FQCN, descriptive task names, role-prefixed variables\n- **Error handling:** Validation, graceful failures, clear messages\n- **Proxmox:** Native modules over CLI where possible\n\nOutput findings as structured report with file:line references and fixes.\n\n**Mode: enhance** (suggest forward-looking improvements)\n\nIdentify:\n- Automation gaps (manual processes to automate)\n- Best practice upgrades (newer patterns not adopted)\n- Integration opportunities (additional Proxmox automation)\n- Scalability improvements (role refactoring, variable organization)\n\nOutput prioritized enhancement roadmap.\n\nAfter analysis:\n- **review mode:** Hand findings to `ansible-reviewer` for formal report\n- **enhance mode:** Present roadmap for user prioritization\n\nReport: scope analyzed, mode used, key findings, recommendations."
              },
              {
                "name": "/create-playbook",
                "description": "Scaffold a state-based Ansible playbook with present/absent pattern",
                "path": "plugins/infrastructure/ansible-workflows/commands/create-playbook.md",
                "frontmatter": {
                  "description": "Scaffold a state-based Ansible playbook with present/absent pattern",
                  "argument-hint": "<playbook-name> [--hosts <target>]",
                  "allowed-tools": [
                    "Write",
                    "Read",
                    "Bash"
                  ],
                  "model": "sonnet"
                },
                "content": "Create a state-based Ansible playbook named `$1`.\n\nLoad the `ansible-playbook-design` and `ansible-fundamentals` skills first.\n\nIf no playbook name provided, ask for one.\n\n**Playbook location:** `ansible/playbooks/$1.yml` (add .yml if missing)\n\n**Target hosts:** Use `$2` if provided with --hosts, otherwise default to `all`\n\n**Create state-based playbook supporting present/absent:**\n\n```yaml\n---\n# Usage:\n#   Create: uv run ansible-playbook playbooks/$1.yml\n#   Remove: uv run ansible-playbook playbooks/$1.yml -e \"resource_state=absent\"\n\n- name: [Descriptive play name]\n  hosts: [target]\n  become: true\n  gather_facts: true\n\n  vars:\n    resource_state: present\n\n  tasks:\n    - name: Validate state variable\n      ansible.builtin.assert:\n        that:\n          - resource_state in ['present', 'absent']\n        fail_msg: \"resource_state must be 'present' or 'absent'\"\n\n    # Main tasks here\n```\n\n**After scaffolding, initialize the pipeline:**\n\n1. Create the `.claude/` directory if it doesn't exist:\n   ```bash\n   mkdir -p \"$CLAUDE_PROJECT_DIR/.claude\"\n   ```\n\n2. Ensure `.gitignore` contains ansible-workflows patterns (append if missing):\n```text\n# Ansible Workflows plugin state (auto-added)\n.claude/ansible-workflows.local.md\n.claude/ansible-workflows.*.bundle.md\n```\n\n3. Write state file `$CLAUDE_PROJECT_DIR/.claude/ansible-workflows.local.md`:\n```yaml\n---\nactive: true\npipeline_phase: generating\ntarget_path: ansible/playbooks/$1.yml\ncurrent_agent: ansible-generator\nstarted_at: \"[ISO timestamp]\"\nvalidation_attempts: 0\nlast_validation_passed: true\n---\n\n# Ansible Workflows Pipeline\n\nTarget: ansible/playbooks/$1.yml\nType: playbook\n```\n\n4. Write scaffolding bundle `$CLAUDE_PROJECT_DIR/.claude/ansible-workflows.scaffolding.bundle.md`:\n```yaml\n---\nsource_agent: create-playbook\ntarget_agent: ansible-generator\ntimestamp: \"[ISO timestamp]\"\ntarget_path: ansible/playbooks/$1.yml\ntarget_type: playbook\n---\n\n# Scaffolding Bundle\n\n## Target Path\nansible/playbooks/$1.yml\n\n## User Requirements\n[Capture any user-specified requirements, hosts, or context]\n\n## Files Created\n- ansible/playbooks/$1.yml (scaffolded)\n\n## Next Steps\nImplement the playbook tasks based on user requirements.\n```\n\n5. Hand off to `ansible-generator` agent with the playbook path\n\nReport: playbook path, state pattern implemented, pipeline initialized."
              },
              {
                "name": "/create-role",
                "description": "Scaffold a new Ansible role with standard directory structure",
                "path": "plugins/infrastructure/ansible-workflows/commands/create-role.md",
                "frontmatter": {
                  "description": "Scaffold a new Ansible role with standard directory structure",
                  "argument-hint": "<role-name>",
                  "allowed-tools": [
                    "Write",
                    "Bash",
                    "Read"
                  ],
                  "model": "sonnet"
                },
                "content": "Create an Ansible role named `$ARGUMENTS` following production patterns.\n\nLoad the `ansible-role-design` and `ansible-fundamentals` skills first.\n\nIf no role name provided, ask for one.\n\n**Role location:** `ansible/roles/$ARGUMENTS/`\n\n**Create this structure:**\n\n```text\nansible/roles/$ARGUMENTS/\n defaults/main.yml\n tasks/main.yml\n handlers/main.yml\n meta/main.yml\n README.md\n```\n\n**Variable prefix:** Convert role name to snake_case (e.g., `docker-host`  `docker_host_*`)\n\n**defaults/main.yml:** Role-prefixed variables with defaults\n**tasks/main.yml:** Main task router with validation\n**handlers/main.yml:** Service restart handlers (if applicable)\n**meta/main.yml:** Galaxy metadata with platform support\n**README.md:** Usage documentation\n\n**After scaffolding, initialize the pipeline:**\n\n1. Create the `.claude/` directory if it doesn't exist:\n   ```bash\n   mkdir -p \"$CLAUDE_PROJECT_DIR/.claude\"\n   ```\n\n2. Ensure `.gitignore` contains ansible-workflows patterns (append if missing):\n```text\n# Ansible Workflows plugin state (auto-added)\n.claude/ansible-workflows.local.md\n.claude/ansible-workflows.*.bundle.md\n```\n\n3. Write state file `$CLAUDE_PROJECT_DIR/.claude/ansible-workflows.local.md`:\n```yaml\n---\nactive: true\npipeline_phase: generating\ntarget_path: ansible/roles/$ARGUMENTS/\ncurrent_agent: ansible-generator\nstarted_at: \"[ISO timestamp]\"\nvalidation_attempts: 0\nlast_validation_passed: true\n---\n\n# Ansible Workflows Pipeline\n\nTarget: ansible/roles/$ARGUMENTS/\nType: role\n```\n\n4. Write scaffolding bundle `$CLAUDE_PROJECT_DIR/.claude/ansible-workflows.scaffolding.bundle.md`:\n```yaml\n---\nsource_agent: create-role\ntarget_agent: ansible-generator\ntimestamp: \"[ISO timestamp]\"\ntarget_path: ansible/roles/$ARGUMENTS/\ntarget_type: role\n---\n\n# Scaffolding Bundle\n\n## Target Path\nansible/roles/$ARGUMENTS/\n\n## User Requirements\n[Capture any user-specified requirements or context]\n\n## Files Created\n- ansible/roles/$ARGUMENTS/defaults/main.yml\n- ansible/roles/$ARGUMENTS/tasks/main.yml\n- ansible/roles/$ARGUMENTS/handlers/main.yml\n- ansible/roles/$ARGUMENTS/meta/main.yml\n- ansible/roles/$ARGUMENTS/README.md\n\n## Variable Prefix\n[snake_case version of role name]\n\n## Next Steps\nImplement the role tasks based on user requirements.\n```\n\n5. Hand off to `ansible-generator` agent with the role path\n\nReport: role path, files created, variable prefix, pipeline initialized."
              },
              {
                "name": "/lint",
                "description": "Run ansible-lint with guidance on fixing issues",
                "path": "plugins/infrastructure/ansible-workflows/commands/lint.md",
                "frontmatter": {
                  "description": "Run ansible-lint with guidance on fixing issues",
                  "argument-hint": [
                    "path"
                  ],
                  "allowed-tools": [
                    "Bash",
                    "Read"
                  ],
                  "model": "haiku"
                },
                "content": "Run ansible-lint on `$ARGUMENTS` (or `ansible/` if no path provided).\n\nExecute: `uv run ansible-lint $ARGUMENTS 2>&1 || true`\n\nParse results and categorize:\n- **Errors:** Must fix\n- **Warnings:** Should fix\n- **Info:** Optional\n\nFor each issue, explain:\n1. What the rule checks\n2. How to fix it\n\n**Common fixes:**\n\n| Rule | Fix |\n|------|-----|\n| fqcn[action-core] | Use `ansible.builtin.module` not `module` |\n| no-changed-when | Add `changed_when: false` to command tasks |\n| name[missing] | Add `name:` to all tasks |\n\nReport: total issues, by severity, top issues, fix suggestions."
              }
            ],
            "skills": [
              {
                "name": "ansible-error-handling",
                "description": "This skill should be used when implementing error handling in Ansible, using block/rescue/always patterns, creating retry logic with until/retries, handling expected failures gracefully, or providing clear error messages with assert and fail.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-error-handling/SKILL.md",
                "frontmatter": {
                  "name": "ansible-error-handling",
                  "description": "This skill should be used when implementing error handling in Ansible, using block/rescue/always patterns, creating retry logic with until/retries, handling expected failures gracefully, or providing clear error messages with assert and fail.\n"
                },
                "content": "# Ansible Error Handling\n\nPatterns for robust error handling in Ansible playbooks and roles.\n\n## Block/Rescue/Always Pattern\n\nHandle errors and perform cleanup:\n\n```yaml\n- name: Deploy application\n  block:\n    - name: Stop application\n      ansible.builtin.systemd:\n        name: myapp\n        state: stopped\n\n    - name: Deploy new version\n      ansible.builtin.copy:\n        src: myapp-v2.0\n        dest: /usr/bin/myapp\n\n    - name: Start application\n      ansible.builtin.systemd:\n        name: myapp\n        state: started\n\n  rescue:\n    - name: Rollback to previous version\n      ansible.builtin.copy:\n        src: myapp-backup\n        dest: /usr/bin/myapp\n\n    - name: Start application (rollback)\n      ansible.builtin.systemd:\n        name: myapp\n        state: started\n\n    - name: Report failure\n      ansible.builtin.fail:\n        msg: \"Deployment failed, rolled back to previous version\"\n\n  always:\n    - name: Cleanup temp files\n      ansible.builtin.file:\n        path: /tmp/deploy-*\n        state: absent\n```\n\n### Execution Flow\n\n- **block**: Main tasks execute sequentially\n- **rescue**: Runs if ANY task in block fails\n- **always**: Runs regardless of success/failure\n\n## Retry with Until\n\nHandle transient failures with retries:\n\n```yaml\n- name: Wait for service to be ready\n  ansible.builtin.uri:\n    url: http://localhost:8080/health\n    status_code: 200\n  register: health_check\n  until: health_check.status == 200\n  retries: 30\n  delay: 10\n  # Total wait: up to 5 minutes (30 * 10s)\n```\n\n### With Command Module\n\n```yaml\n- name: Wait for cluster to stabilize\n  ansible.builtin.command: pvecm status\n  register: cluster_status\n  until: \"'Quorate: Yes' in cluster_status.stdout\"\n  retries: 12\n  delay: 5\n  changed_when: false\n```\n\n### Retry Parameters\n\n| Parameter | Description |\n|-----------|-------------|\n| `until` | Condition that must be true to stop retrying |\n| `retries` | Maximum number of attempts |\n| `delay` | Seconds between attempts |\n\n## Assert for Validation\n\nValidate inputs with clear error messages:\n\n```yaml\n- name: Validate required variables\n  ansible.builtin.assert:\n    that:\n      - vm_name is defined\n      - vm_name | length > 0\n      - vm_memory >= 1024\n      - vm_cores >= 1\n    fail_msg: |\n      Invalid VM configuration:\n      - vm_name: {{ vm_name | default('NOT SET') }}\n      - vm_memory: {{ vm_memory | default('NOT SET') }} (min: 1024)\n      - vm_cores: {{ vm_cores | default('NOT SET') }} (min: 1)\n    success_msg: \"VM configuration validated\"\n    quiet: true\n```\n\n### Common Assertions\n\n```yaml\n# Variable defined and non-empty\n- vm_name is defined and vm_name | trim | length > 0\n\n# Numeric range\n- vm_memory >= 1024 and vm_memory <= 65536\n\n# Regex match\n- vm_name is match('^[a-z0-9-]+$')\n\n# List has items\n- vm_networks | length > 0\n\n# Value in allowed list\n- vm_ostype in ['l26', 'win10', 'win11']\n```\n\n## Fail with Context\n\nProvide actionable error messages:\n\n```yaml\n- name: Check prerequisites\n  ansible.builtin.command: which docker\n  register: docker_check\n  changed_when: false\n  failed_when: false\n\n- name: Fail if Docker not installed\n  ansible.builtin.fail:\n    msg: |\n      Docker is not installed on {{ inventory_hostname }}.\n\n      To install Docker:\n        sudo apt update\n        sudo apt install docker.io\n\n      Or use the docker role:\n        ansible-playbook playbooks/install-docker.yml\n  when: docker_check.rc != 0\n```\n\n## Graceful Failure Handling\n\nAllow expected \"failures\":\n\n```yaml\n- name: Try to stop service\n  ansible.builtin.systemd:\n    name: myservice\n    state: stopped\n  register: stop_result\n  failed_when:\n    - stop_result.failed\n    - \"'not found' not in stop_result.msg\"\n  # Only fail if error is NOT \"service not found\"\n```\n\n### Multiple Acceptable Conditions\n\n```yaml\n- name: Join cluster\n  ansible.builtin.command: pvecm add {{ primary_node }}\n  register: cluster_join\n  failed_when:\n    - cluster_join.rc != 0\n    - \"'already in a cluster' not in cluster_join.stderr\"\n    - \"'cannot join' not in cluster_join.stderr\"\n  changed_when: cluster_join.rc == 0\n```\n\n## Check Before Fail\n\nSeparate checking from failing for better control:\n\n```yaml\n- name: Check if resource exists\n  ansible.builtin.command: check-resource {{ resource_id }}\n  register: resource_check\n  changed_when: false\n  failed_when: false  # Don't fail here\n\n- name: Fail with context if missing\n  ansible.builtin.fail:\n    msg: |\n      Resource {{ resource_id }} not found.\n      Command output: {{ resource_check.stderr }}\n      Hint: Ensure resource was created first.\n  when: resource_check.rc != 0\n```\n\n## Error Recovery Pattern\n\nAttempt operation, handle specific errors:\n\n```yaml\n- name: Attempt primary approach\n  block:\n    - name: Connect via primary endpoint\n      ansible.builtin.uri:\n        url: \"https://{{ primary_host }}:8006/api2/json\"\n        validate_certs: true\n      register: primary_result\n\n  rescue:\n    - name: Log primary failure\n      ansible.builtin.debug:\n        msg: \"Primary endpoint failed: {{ primary_result.msg | default('unknown error') }}\"\n\n    - name: Try fallback endpoint\n      ansible.builtin.uri:\n        url: \"https://{{ fallback_host }}:8006/api2/json\"\n        validate_certs: false\n      register: fallback_result\n```\n\n## Delegate Error Handling\n\nRun checks from controller for better error context:\n\n```yaml\n- name: Verify API endpoint from controller\n  ansible.builtin.uri:\n    url: \"https://{{ inventory_hostname }}:8006/api2/json/version\"\n    validate_certs: false\n  delegate_to: localhost\n  register: api_check\n  failed_when: false\n\n- name: Report API status\n  ansible.builtin.fail:\n    msg: |\n      Cannot reach Proxmox API on {{ inventory_hostname }}\n      Status: {{ api_check.status | default('connection failed') }}\n      Check: Network connectivity, firewall rules, pveproxy service\n  when: api_check.status | default(0) != 200\n```\n\n## Ignore Errors (Use Sparingly)\n\n```yaml\n- name: Remove optional backup\n  ansible.builtin.file:\n    path: /backup/old-backup.tar.gz\n    state: absent\n  ignore_errors: true\n  register: cleanup_result\n\n- name: Report cleanup status\n  ansible.builtin.debug:\n    msg: \"Cleanup {{ 'successful' if not cleanup_result.failed else 'skipped' }}\"\n```\n\n### When ignore_errors is Acceptable\n\n- Non-critical cleanup tasks\n- Optional operations that shouldn't block playbook\n- When the result is immediately checked anyway\n\n### Prefer failed_when\n\n```yaml\n# BETTER than ignore_errors\n- name: Remove backup\n  ansible.builtin.file:\n    path: /backup/old-backup.tar.gz\n    state: absent\n  register: cleanup_result\n  failed_when:\n    - cleanup_result.failed\n    - \"'does not exist' not in cleanup_result.msg | default('')\"\n```\n\n## Complete Example\n\n```yaml\n---\n- name: Deploy with comprehensive error handling\n  hosts: app_servers\n  become: true\n\n  tasks:\n    - name: Validate configuration\n      ansible.builtin.assert:\n        that:\n          - app_version is defined\n          - app_version is match('^\\d+\\.\\d+\\.\\d+$')\n        fail_msg: \"Invalid app_version: {{ app_version | default('NOT SET') }}\"\n\n    - name: Deploy application\n      block:\n        - name: Download release\n          ansible.builtin.get_url:\n            url: \"https://releases.example.com/{{ app_version }}.tar.gz\"\n            dest: /tmp/app.tar.gz\n          register: download\n          until: download is succeeded\n          retries: 3\n          delay: 5\n\n        - name: Stop current version\n          ansible.builtin.systemd:\n            name: myapp\n            state: stopped\n\n        - name: Extract release\n          ansible.builtin.unarchive:\n            src: /tmp/app.tar.gz\n            dest: /opt/myapp\n            remote_src: true\n\n        - name: Start new version\n          ansible.builtin.systemd:\n            name: myapp\n            state: started\n\n        - name: Verify health\n          ansible.builtin.uri:\n            url: http://localhost:8080/health\n          register: health\n          until: health.status == 200\n          retries: 6\n          delay: 10\n\n      rescue:\n        - name: Restore previous version\n          ansible.builtin.copy:\n            src: /opt/myapp-backup/\n            dest: /opt/myapp/\n            remote_src: true\n\n        - name: Start previous version\n          ansible.builtin.systemd:\n            name: myapp\n            state: started\n\n        - name: Report deployment failure\n          ansible.builtin.fail:\n            msg: |\n              Deployment of {{ app_version }} failed.\n              Previous version restored.\n              Check logs: journalctl -u myapp\n\n      always:\n        - name: Cleanup download\n          ansible.builtin.file:\n            path: /tmp/app.tar.gz\n            state: absent\n```\n\n## Additional Resources\n\nFor detailed error handling patterns and techniques, consult:\n\n- **`references/error-handling.md`** - Comprehensive error handling patterns, block/rescue/always examples, retry strategies\n\n## Related Skills\n\n- **ansible-idempotency** - changed_when/failed_when patterns\n- **ansible-fundamentals** - Core Ansible concepts"
              },
              {
                "name": "ansible-fundamentals",
                "description": "This skill should be used when writing Ansible playbooks, creating Ansible tasks, running ansible-playbook commands, selecting Ansible modules, or working with Ansible collections. Provides golden rules, FQCN requirements, module selection guidance, and execution patterns using uv run.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-fundamentals/SKILL.md",
                "frontmatter": {
                  "name": "ansible-fundamentals",
                  "description": "This skill should be used when writing Ansible playbooks, creating Ansible tasks, running ansible-playbook commands, selecting Ansible modules, or working with Ansible collections. Provides golden rules, FQCN requirements, module selection guidance, and execution patterns using uv run.\n"
                },
                "content": "# Ansible Fundamentals\n\nCore principles and golden rules for writing production-quality Ansible automation.\n\n## Golden Rules\n\nThese rules apply to ALL Ansible code in this repository:\n\n1. **Use `uv run` prefix** - Execute all Ansible commands through uv:\n\n   ```bash\n   uv run ansible-playbook playbooks/my-playbook.yml\n   uv run ansible-lint\n   uv run ansible-galaxy collection install -r requirements.yml\n   ```\n\n2. **Fully Qualified Collection Names (FQCN)** - Avoid short module names:\n\n   ```yaml\n   # CORRECT\n   - name: Install package\n     ansible.builtin.apt:\n       name: nginx\n       state: present\n\n   # WRONG - deprecated short names\n   - name: Install package\n     apt:\n       name: nginx\n   ```\n\n3. **Control command/shell modules** - Add `changed_when` and `failed_when`:\n\n   ```yaml\n   - name: Check if service exists\n     ansible.builtin.command: systemctl status myservice\n     register: service_check\n     changed_when: false\n     failed_when: false\n   ```\n\n4. **Use `set -euo pipefail`** - In all shell scripts and shell module calls:\n\n   ```yaml\n   - name: Run pipeline command\n     ansible.builtin.shell: |\n       set -euo pipefail\n       cat file.txt | grep pattern | wc -l\n     args:\n       executable: /bin/bash\n   ```\n\n5. **Tag sensitive tasks** - Use `no_log: true` for secrets:\n\n   ```yaml\n   - name: Set database password\n     ansible.builtin.command: set-password {{ db_password }}\n     no_log: true\n   ```\n\n6. **Idempotency first** - Check before create, verify after.\n\n7. **Descriptive task names** - Start with action verbs (Ensure, Configure, Install, Create).\n\n## Module Selection Guide\n\n### Decision Matrix\n\n| Need | Use | Why |\n|------|-----|-----|\n| Install packages | `ansible.builtin.apt/yum/dnf` | Native modules handle state |\n| Manage files | `ansible.builtin.copy/template/file` | Idempotent by default |\n| Edit config lines | `ansible.builtin.lineinfile` | Surgical edits, not full replace |\n| Run commands | `ansible.builtin.command` | When no native module exists |\n| Need shell features | `ansible.builtin.shell` | Pipes, redirects, globs |\n| Manage services | `ansible.builtin.systemd/service` | State management built-in |\n| Manage users | `ansible.builtin.user` | Cross-platform, idempotent |\n\n### Prefer Native Modules\n\nNative modules provide:\n\n- Built-in idempotency (no need for `changed_when`)\n- Better error handling\n- Cross-platform compatibility\n- Clear documentation\n\n```yaml\n# PREFER native module\n- name: Create user\n  ansible.builtin.user:\n    name: deploy\n    groups: docker\n    state: present\n\n# AVOID command when module exists\n- name: Create user\n  ansible.builtin.command: useradd -G docker deploy\n  # Requires: changed_when, failed_when, idempotency logic\n```\n\n### When Command/Shell is Acceptable\n\nUse `command` or `shell` modules when:\n\n1. No native module exists for the operation\n2. Interacting with vendor CLI tools (pvecm, pveceph, kubectl)\n3. Running one-off scripts\n\nAdd proper controls:\n\n```yaml\n- name: Create Proxmox API token\n  ansible.builtin.command: >\n    pveum user token add {{ username }}@pam {{ token_name }}\n  register: token_result\n  changed_when: \"'already exists' not in token_result.stderr\"\n  failed_when:\n    - token_result.rc != 0\n    - \"'already exists' not in token_result.stderr\"\n  no_log: true\n```\n\n## Collections in Use\n\nThis repository uses these Ansible collections:\n\n| Collection | Purpose | Example Modules |\n|------------|---------|-----------------|\n| `ansible.builtin` | Core functionality | copy, template, command, user |\n| `ansible.posix` | POSIX systems | authorized_key, synchronize |\n| `community.general` | General utilities | interfaces_file, ini_file |\n| `community.proxmox` | Proxmox VE | proxmox_vm, proxmox_kvm |\n| `infisical.vault` | Secrets management | read_secrets |\n| `community.docker` | Docker management | docker_container, docker_image |\n\n### Installing Collections\n\n```bash\n# Install from requirements\ncd ansible && uv run ansible-galaxy collection install -r requirements.yml\n\n# Install specific collection\nuv run ansible-galaxy collection install community.proxmox\n```\n\n## Common Execution Patterns\n\n### Running Playbooks\n\n```bash\n# Basic execution\nuv run ansible-playbook playbooks/my-playbook.yml\n\n# With extra variables\nuv run ansible-playbook playbooks/create-vm.yml \\\n  -e \"vm_name=docker-01\" \\\n  -e \"vm_memory=4096\"\n\n# Limit to specific hosts\nuv run ansible-playbook playbooks/update.yml --limit proxmox\n\n# Check mode (dry run)\nuv run ansible-playbook playbooks/deploy.yml --check --diff\n\n# With tags\nuv run ansible-playbook playbooks/setup.yml --tags \"network,storage\"\n```\n\n### Linting\n\n```bash\n# Run ansible-lint\nmise run ansible-lint\n\n# Or directly\nuv run ansible-lint ansible/playbooks/\n```\n\n## Task Naming Conventions\n\nUse descriptive names with action verbs:\n\n| Verb | Use When |\n|------|----------|\n| Ensure | Verifying state exists |\n| Configure | Modifying settings |\n| Install | Adding packages |\n| Create | Making new resources |\n| Remove | Deleting resources |\n| Deploy | Releasing applications |\n| Update | Modifying existing resources |\n\nExamples:\n\n```yaml\n- name: Ensure Docker is installed\n- name: Configure SSH security settings\n- name: Create admin user account\n- name: Deploy application configuration\n```\n\n## Variable Naming\n\nUse snake_case with descriptive names:\n\n```yaml\n# GOOD - clear, descriptive\nproxmox_api_user: terraform@pam\ndocker_compose_version: \"2.24.0\"\nvm_memory_mb: 4096\n\n# BAD - vague, abbreviated\npve_usr: terraform@pam\ndc_ver: \"2.24.0\"\nmem: 4096\n```\n\n## Quick Reference Commands\n\n```bash\n# Lint all Ansible files\nmise run ansible-lint\n\n# Run playbook with secrets from Infisical\ncd ansible && uv run ansible-playbook playbooks/my-playbook.yml\n\n# Check syntax\nuv run ansible-playbook --syntax-check playbooks/my-playbook.yml\n\n# List hosts in inventory\nuv run ansible-inventory --list\n\n# Test connection\nuv run ansible all -m ping\n```\n\n## Common Anti-Patterns\n\n### Missing FQCN\n\n```yaml\n# BAD\n- name: Copy file\n  copy:\n    src: file.txt\n    dest: /tmp/\n\n# GOOD\n- name: Copy file\n  ansible.builtin.copy:\n    src: file.txt\n    dest: /tmp/\n```\n\n### Uncontrolled Commands\n\n```yaml\n# BAD - always shows changed, no error handling\n- name: Check status\n  ansible.builtin.command: systemctl status app\n\n# GOOD\n- name: Check status\n  ansible.builtin.command: systemctl status app\n  register: status_check\n  changed_when: false\n  failed_when: false\n```\n\n### Using shell When command Suffices\n\n```yaml\n# BAD - shell not needed\n- name: List files\n  ansible.builtin.shell: ls -la /tmp\n\n# GOOD - command is sufficient\n- name: List files\n  ansible.builtin.command: ls -la /tmp\n  changed_when: false\n```\n\n### Missing no_log on Secrets\n\n```yaml\n# BAD - password in logs\n- name: Set password\n  ansible.builtin.command: set-password {{ password }}\n\n# GOOD\n- name: Set password\n  ansible.builtin.command: set-password {{ password }}\n  no_log: true\n```\n\n## Related Skills\n\n- **ansible-idempotency** - Detailed changed_when/failed_when patterns\n- **ansible-secrets** - Infisical integration and security\n- **ansible-proxmox** - Proxmox-specific module selection\n- **ansible-error-handling** - Block/rescue, retry patterns"
              },
              {
                "name": "ansible-idempotency",
                "description": "This skill should be used when writing idempotent Ansible tasks, using command or shell modules, implementing changed_when and failed_when directives, creating check-before-create patterns, or troubleshooting tasks that always show \"changed\".\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-idempotency/SKILL.md",
                "frontmatter": {
                  "name": "ansible-idempotency",
                  "description": "This skill should be used when writing idempotent Ansible tasks, using command or shell modules, implementing changed_when and failed_when directives, creating check-before-create patterns, or troubleshooting tasks that always show \"changed\".\n"
                },
                "content": "# Ansible Idempotency Patterns\n\nTechniques for ensuring Ansible tasks are truly idempotent - producing the same result\nwhether run once or multiple times.\n\n## Core Directives\n\n### changed_when\n\nControls when Ansible reports a task as \"changed\". Critical for `command` and `shell` modules\nwhich always report changed by default.\n\n```yaml\n- name: Check if service exists\n  ansible.builtin.command: systemctl status myservice\n  register: service_check\n  changed_when: false  # Read-only operation, never changes anything\n```\n\n### failed_when\n\nControls when Ansible considers a task failed. Allows graceful handling of expected errors.\n\n```yaml\n- name: Check resource existence\n  ansible.builtin.command: check-resource {{ resource_id }}\n  register: check_result\n  failed_when: false  # Don't fail, we'll check the result ourselves\n```\n\n### register\n\nCaptures task output for use in `changed_when` and `failed_when` expressions.\n\n```yaml\n- name: Run command\n  ansible.builtin.command: some-command\n  register: cmd_result\n  # Now cmd_result.rc, cmd_result.stdout, cmd_result.stderr are available\n```\n\n## Pattern 1: Detect Actual Changes\n\nMake commands report \"changed\" only when something actually changed:\n\n```yaml\n- name: Create Proxmox API token\n  ansible.builtin.command: >\n    pveum user token add {{ username }}@pam {{ token_name }}\n  register: token_result\n  changed_when: \"'already exists' not in token_result.stderr\"\n  failed_when:\n    - token_result.rc != 0\n    - \"'already exists' not in token_result.stderr\"\n  no_log: true\n```\n\n**Key pattern**: Detect specific output that indicates no change occurred.\n\n## Pattern 2: Check Before Create\n\nCheck if a resource exists before creating it:\n\n```yaml\n- name: Check if VM template exists\n  ansible.builtin.shell: |\n    set -o pipefail\n    qm list | awk '{print $1}' | grep -q \"^{{ template_id }}$\"\n  args:\n    executable: /bin/bash\n  register: template_exists\n  changed_when: false  # Checking doesn't change anything\n  failed_when: false   # Not finding it isn't a failure\n\n- name: Create VM template\n  ansible.builtin.command: >\n    qm create {{ template_id }}\n    --name {{ template_name }}\n    --memory 2048\n  when: template_exists.rc != 0  # Only create if doesn't exist\n  register: create_result\n  changed_when: create_result.rc == 0\n```\n\n## Pattern 3: Verify After Create\n\nConfirm resource creation succeeded:\n\n```yaml\n- name: Create VM\n  ansible.builtin.command: >\n    qm create {{ vmid }} --name {{ vm_name }}\n  register: create_result\n  changed_when: true\n\n- name: Verify VM was created\n  ansible.builtin.shell: |\n    set -o pipefail\n    qm list | grep \"{{ vmid }}\"\n  args:\n    executable: /bin/bash\n  register: verify_result\n  changed_when: false\n  failed_when: verify_result.rc != 0\n```\n\n## Pattern 4: Conditional Change Detection\n\nUse output content to determine if change occurred:\n\n```yaml\n- name: Update cluster configuration\n  ansible.builtin.command: update-config --apply\n  register: update_result\n  changed_when: \"'Configuration updated' in update_result.stdout\"\n  failed_when: \"'Error' in update_result.stderr\"\n```\n\n### Common Patterns\n\n| Output Indicator | changed_when Expression |\n|-----------------|------------------------|\n| \"already exists\" | `\"'already exists' not in result.stderr\"` |\n| \"no changes\" | `\"'no changes' not in result.stdout\"` |\n| \"created\" | `\"'created' in result.stdout\"` |\n| \"updated\" | `\"'updated' in result.stdout\"` |\n| Exit code 0 = created | `result.rc == 0` |\n\n## Pattern 5: Multiple Failure Conditions\n\nAllow specific \"failures\" that are actually expected:\n\n```yaml\n- name: Run database migration\n  ansible.builtin.command: /usr/bin/migrate-database\n  register: migrate_result\n  failed_when:\n    - migrate_result.rc != 0\n    - \"'already applied' not in migrate_result.stdout\"\n    - \"'no pending migrations' not in migrate_result.stdout\"\n  changed_when: \"'applied' in migrate_result.stdout and 'already' not in migrate_result.stdout\"\n```\n\n## Pattern 6: Read-Only Operations\n\nMark read-only operations as never changed:\n\n```yaml\n# Checking status\n- name: Get cluster status\n  ansible.builtin.command: pvecm status\n  register: cluster_status\n  changed_when: false\n  failed_when: false\n\n# Gathering information\n- name: List available images\n  ansible.builtin.command: qm list\n  register: vm_list\n  changed_when: false\n\n# Verification checks\n- name: Verify service is running\n  ansible.builtin.command: systemctl is-active nginx\n  register: nginx_status\n  changed_when: false\n  failed_when: false\n```\n\n## Pattern 7: Retry Until Success\n\nUse `until` for operations that may need retries:\n\n```yaml\n- name: Wait for service to be ready\n  ansible.builtin.uri:\n    url: http://localhost:8080/health\n    status_code: 200\n  register: health_check\n  until: health_check.status == 200\n  retries: 30\n  delay: 10\n  # Total wait: up to 5 minutes\n```\n\nWith command:\n\n```yaml\n- name: Wait for VM to get IP address\n  ansible.builtin.command: qm agent {{ vmid }} network-get-interfaces\n  register: vm_network\n  until: vm_network.rc == 0\n  retries: 12\n  delay: 5\n  changed_when: false\n```\n\n## Pattern 8: Set Facts for State\n\nUse facts to track state across tasks:\n\n```yaml\n- name: Check existing cluster status\n  ansible.builtin.command: pvecm status\n  register: cluster_status\n  failed_when: false\n  changed_when: false\n\n- name: Set cluster facts\n  ansible.builtin.set_fact:\n    is_cluster_member: \"{{ cluster_status.rc == 0 }}\"\n    in_target_cluster: \"{{ cluster_name in cluster_status.stdout }}\"\n\n- name: Create cluster\n  ansible.builtin.command: pvecm create {{ cluster_name }}\n  when: not in_target_cluster\n  register: cluster_create\n  changed_when: cluster_create.rc == 0\n```\n\n## Anti-Patterns to Avoid\n\n### Always Changed\n\n```yaml\n# BAD - Always shows changed\n- name: Check status\n  ansible.builtin.command: systemctl status app\n\n# GOOD\n- name: Check status\n  ansible.builtin.command: systemctl status app\n  register: status_check\n  changed_when: false\n  failed_when: false\n```\n\n### Silent Failure Suppression\n\n```yaml\n# BAD - Hides all errors\n- name: Critical operation\n  ansible.builtin.command: important-command\n  failed_when: false\n\n# GOOD - Only allow expected \"errors\"\n- name: Critical operation\n  ansible.builtin.command: important-command\n  register: result\n  failed_when:\n    - result.rc != 0\n    - \"'expected condition' not in result.stderr\"\n```\n\n### No Output Capture\n\n```yaml\n# BAD - Can't check results\n- name: Run command\n  ansible.builtin.command: create-resource\n\n# GOOD\n- name: Run command\n  ansible.builtin.command: create-resource\n  register: result\n  changed_when: \"'created' in result.stdout\"\n```\n\n## Shell Script Requirements\n\nUse strict error handling in shell scripts:\n\n```yaml\n- name: Run pipeline\n  ansible.builtin.shell: |\n    set -euo pipefail\n    cat data.txt | grep pattern | sort | uniq\n  args:\n    executable: /bin/bash\n  register: pipeline_result\n  changed_when: false\n```\n\n### Why set -euo pipefail?\n\n| Flag | Purpose |\n|------|---------|\n| `-e` | Exit on any command failure |\n| `-u` | Error on undefined variables |\n| `-o pipefail` | Catch errors in pipelines |\n\n## Testing Idempotency\n\nVerify playbooks are idempotent by running twice:\n\n```bash\n# First run - may show changes\nuv run ansible-playbook playbooks/setup.yml\n\n# Second run - should show 0 changes\nuv run ansible-playbook playbooks/setup.yml\n\n# If second run shows changes, playbook is NOT idempotent\n```\n\n## Common changed_when Expressions\n\n```yaml\n# Never changed (read-only)\nchanged_when: false\n\n# Always changed (one-time operations)\nchanged_when: true\n\n# Based on output content\nchanged_when: \"'created' in result.stdout\"\nchanged_when: \"'already exists' not in result.stderr\"\nchanged_when: \"'updated' in result.stdout\"\n\n# Based on return code\nchanged_when: result.rc == 0\nchanged_when: result.rc != 1\n\n# Complex conditions\nchanged_when:\n  - result.rc == 0\n  - \"'no changes' not in result.stdout\"\n```\n\n## Utility Script\n\nUse the idempotency checker to analyze playbooks for common issues:\n\n```bash\n# Check a single playbook\n${CLAUDE_PLUGIN_ROOT}/skills/ansible-idempotency/scripts/check_idempotency.py ansible/playbooks/my-playbook.yml\n\n# Check multiple playbooks\n${CLAUDE_PLUGIN_ROOT}/skills/ansible-idempotency/scripts/check_idempotency.py ansible/playbooks/*.yml\n\n# Strict mode (info issues become warnings)\n${CLAUDE_PLUGIN_ROOT}/skills/ansible-idempotency/scripts/check_idempotency.py --strict ansible/playbooks/my-playbook.yml\n\n# Summary only\n${CLAUDE_PLUGIN_ROOT}/skills/ansible-idempotency/scripts/check_idempotency.py --summary ansible/playbooks/*.yml\n```\n\nThe script detects:\n\n- Command/shell tasks without `changed_when`\n- Shell tasks without `set -euo pipefail`\n- Tasks missing `no_log` that may contain secrets\n- Tasks missing name attribute\n- Use of deprecated short module names (non-FQCN)\n\nScript location: `${CLAUDE_PLUGIN_ROOT}/skills/ansible-idempotency/scripts/check_idempotency.py`\n\n## Related Skills\n\n- **ansible-error-handling** - Block/rescue patterns\n- **ansible-fundamentals** - Module selection (prefer native modules)\n- **ansible-proxmox** - Proxmox-specific idempotency patterns"
              },
              {
                "name": "ansible-playbook-design",
                "description": "This skill should be used when creating new Ansible playbooks, designing playbook structure, implementing state-based playbooks with present/absent patterns, organizing plays and tasks, or structuring playbook variables. Covers play organization, variable scoping, and state-based design patterns.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-playbook-design/SKILL.md",
                "frontmatter": {
                  "name": "ansible-playbook-design",
                  "description": "This skill should be used when creating new Ansible playbooks, designing playbook structure, implementing state-based playbooks with present/absent patterns, organizing plays and tasks, or structuring playbook variables. Covers play organization, variable scoping, and state-based design patterns.\n"
                },
                "content": "# Ansible Playbook Design\n\nPatterns for designing well-structured, maintainable Ansible playbooks.\n\n## State-Based Playbook Pattern\n\nDesign playbooks to handle both creation and removal via a `state` variable.\n\n### Core Pattern\n\n```yaml\n---\n- name: Manage admin user account\n  hosts: all\n  become: true\n\n  vars:\n    admin_state: present  # or absent\n\n  tasks:\n    - name: Create admin user\n      ansible.builtin.user:\n        name: \"{{ admin_name }}\"\n        groups: \"{{ admin_groups }}\"\n        state: \"{{ admin_state }}\"\n\n    - name: Configure SSH key\n      ansible.posix.authorized_key:\n        user: \"{{ admin_name }}\"\n        key: \"{{ admin_ssh_key }}\"\n        state: \"{{ admin_state }}\"\n      when: admin_state == 'present'\n```\n\n### Usage\n\n```bash\n# Create user (default)\nuv run ansible-playbook playbooks/manage-admin.yml \\\n  -e \"admin_name=alice\" \\\n  -e \"admin_ssh_key='ssh-ed25519 AAAA...'\"\n\n# Remove user\nuv run ansible-playbook playbooks/manage-admin.yml \\\n  -e \"admin_name=alice\" \\\n  -e \"admin_state=absent\"\n```\n\n### Benefits\n\n- Single source of truth\n- Consistent interface\n- Less code duplication\n- Follows community role conventions\n\n## Play Structure\n\n### Recommended Play Sections\n\nOrder sections consistently across all playbooks:\n\n```yaml\n---\n- name: Descriptive play name\n  hosts: target_group\n  become: true\n  gather_facts: true\n\n  vars:\n    # Play-level variables\n    app_version: \"2.0.0\"\n\n  vars_files:\n    # External variable files\n    - vars/secrets.yml\n\n  pre_tasks:\n    # Tasks that must run before roles\n    - name: Update apt cache\n      ansible.builtin.apt:\n        update_cache: true\n        cache_valid_time: 3600\n\n  roles:\n    # Role includes\n    - role: common\n    - role: app_deploy\n      vars:\n        deploy_version: \"{{ app_version }}\"\n\n  tasks:\n    # Play-specific tasks\n    - name: Verify deployment\n      ansible.builtin.uri:\n        url: http://localhost:8080/health\n\n  post_tasks:\n    # Cleanup or finalization\n    - name: Send deployment notification\n      ansible.builtin.debug:\n        msg: \"Deployment complete\"\n\n  handlers:\n    # Event-triggered tasks\n    - name: restart app\n      ansible.builtin.systemd:\n        name: myapp\n        state: restarted\n```\n\n## Variable Organization\n\n### Variable Precedence (Key Levels)\n\nFrom lowest to highest precedence:\n\n1. Role defaults (`roles/x/defaults/main.yml`)\n2. Inventory group_vars (`group_vars/all.yml`)\n3. Inventory host_vars (`host_vars/hostname.yml`)\n4. Play vars (`vars:` in playbook)\n5. Task vars (`vars:` on task)\n6. Extra vars (`-e` on command line) - **highest**\n\n### Organizing Variables\n\n```text\nansible/\n group_vars/\n    all.yml           # Variables for ALL hosts\n    proxmox.yml       # Proxmox cluster hosts\n    docker_hosts.yml  # Docker host group\n host_vars/\n    node01.yml        # Host-specific overrides\n    node02.yml\n playbooks/\n     deploy.yml        # Uses vars: for playbook-specific\n```\n\n### Variable Naming by Scope\n\n```yaml\n# group_vars/all.yml - Global defaults\ndefault_timezone: \"UTC\"\nntp_servers:\n  - 0.pool.ntp.org\n  - 1.pool.ntp.org\n\n# group_vars/proxmox.yml - Group-specific\nproxmox_api_host: \"192.168.1.10\"\nproxmox_cluster_name: \"production\"\n\n# host_vars/node01.yml - Host-specific overrides\nproxmox_node_id: 1\nceph_osd_devices:\n  - /dev/sdb\n  - /dev/sdc\n```\n\n## Task Organization with Includes\n\n### When to Split Tasks\n\nSplit playbook tasks into separate files when:\n\n- Tasks exceed 50 lines\n- Logical groupings emerge (networking, storage, users)\n- Conditional sections can be skipped entirely\n\n### Include Patterns\n\n```yaml\n# playbooks/setup-cluster.yml\n---\n- name: Setup Proxmox cluster\n  hosts: proxmox\n  become: true\n\n  tasks:\n    - name: Configure networking\n      ansible.builtin.include_tasks: tasks/networking.yml\n\n    - name: Setup storage\n      ansible.builtin.include_tasks: tasks/storage.yml\n      when: setup_storage | default(true)\n\n    - name: Initialize cluster\n      ansible.builtin.include_tasks: tasks/cluster-init.yml\n      when: inventory_hostname == groups['proxmox'][0]\n```\n\n### import_tasks vs include_tasks\n\n| Feature | import_tasks | include_tasks |\n|---------|--------------|---------------|\n| When evaluated | Parse time (static) | Runtime (dynamic) |\n| Supports loops | No | Yes |\n| Supports conditionals on import | Limited | Full |\n| Use case | Ordered execution | Conditional/looped |\n\n```yaml\n# Static import - always loaded, order matters\n- ansible.builtin.import_tasks: users.yml\n- ansible.builtin.import_tasks: permissions.yml\n\n# Dynamic include - conditional, looped\n- ansible.builtin.include_tasks: \"setup-{{ ansible_os_family }}.yml\"\n- ansible.builtin.include_tasks: deploy-app.yml\n  loop: \"{{ applications }}\"\n```\n\n## Multi-Play Playbooks\n\nUse multiple plays for different host groups or privilege levels:\n\n```yaml\n---\n# Play 1: Gather facts from all nodes\n- name: Gather cluster information\n  hosts: proxmox\n  gather_facts: true\n  tasks:\n    - name: Set cluster facts\n      ansible.builtin.set_fact:\n        cluster_node_count: \"{{ groups['proxmox'] | length }}\"\n\n# Play 2: Initialize primary node\n- name: Initialize cluster on primary\n  hosts: proxmox[0]\n  become: true\n  tasks:\n    - name: Create cluster\n      ansible.builtin.command: pvecm create {{ cluster_name }}\n      when: not cluster_exists\n\n# Play 3: Join secondary nodes\n- name: Join cluster on secondary nodes\n  hosts: proxmox[1:]\n  become: true\n  serial: 1  # One node at a time\n  tasks:\n    - name: Join cluster\n      ansible.builtin.command: pvecm add {{ primary_node }}\n      when: not node_in_cluster\n```\n\n## Handler Best Practices\n\n### Define Handlers at Play Level\n\n```yaml\n---\n- name: Configure web server\n  hosts: webservers\n  become: true\n\n  tasks:\n    - name: Update nginx config\n      ansible.builtin.template:\n        src: nginx.conf.j2\n        dest: /etc/nginx/nginx.conf\n      notify: reload nginx\n\n    - name: Update SSL certificates\n      ansible.builtin.copy:\n        src: \"{{ item }}\"\n        dest: /etc/nginx/ssl/\n      loop:\n        - cert.pem\n        - key.pem\n      notify: reload nginx\n\n  handlers:\n    - name: reload nginx\n      ansible.builtin.systemd:\n        name: nginx\n        state: reloaded\n```\n\n### Handler Execution Order\n\nHandlers run:\n\n1. At the end of each play\n2. In the order they are defined (not notified)\n3. Only once, even if notified multiple times\n\nForce immediate handler execution:\n\n```yaml\n- name: Update critical config\n  ansible.builtin.template:\n    src: config.j2\n    dest: /etc/app/config.yml\n  notify: restart app\n\n- name: Flush handlers now\n  ansible.builtin.meta: flush_handlers\n\n- name: Verify app is running\n  ansible.builtin.uri:\n    url: http://localhost:8080/health\n```\n\n## Playbook Validation\n\n### Pre-flight Checks\n\nAdd validation at the start of playbooks:\n\n```yaml\n---\n- name: Deploy application\n  hosts: app_servers\n  become: true\n\n  tasks:\n    - name: Validate required variables\n      ansible.builtin.assert:\n        that:\n          - app_version is defined\n          - app_version | regex_search('^\\d+\\.\\d+\\.\\d+$')\n          - deploy_env in ['staging', 'production']\n        fail_msg: \"Invalid configuration. Check app_version and deploy_env.\"\n\n    - name: Check disk space\n      ansible.builtin.assert:\n        that: ansible_mounts | selectattr('mount', 'equalto', '/') | map(attribute='size_available') | first > 1073741824\n        fail_msg: \"Insufficient disk space. Need at least 1GB free.\"\n```\n\n## Template Patterns\n\n### Playbook Template Structure\n\n```yaml\n---\n# playbooks/template-playbook.yml\n# Description: [What this playbook does]\n# Usage: uv run ansible-playbook playbooks/template-playbook.yml -e \"var=value\"\n# Requirements: [Any prerequisites]\n\n- name: [Descriptive play name]\n  hosts: [target_group]\n  become: [true/false]\n  gather_facts: [true/false]\n\n  vars:\n    # Configurable variables with defaults\n    resource_state: present\n\n  tasks:\n    - name: Validate inputs\n      ansible.builtin.assert:\n        that:\n          - required_var is defined\n        fail_msg: \"required_var must be defined\"\n\n    # Main tasks...\n\n    - name: Verify completion\n      ansible.builtin.debug:\n        msg: \"Playbook completed successfully\"\n```\n\n## Additional Resources\n\nFor detailed playbook patterns and techniques, consult:\n\n- **`references/playbook-role-patterns.md`** - Comprehensive playbook organization patterns, play structure, import strategies\n\n## Related Skills\n\n- **ansible-role-design** - When to use roles vs playbooks\n- **ansible-fundamentals** - Core module selection and naming\n- **ansible-error-handling** - Block/rescue patterns in playbooks"
              },
              {
                "name": "ansible-proxmox",
                "description": "This skill should be used when automating Proxmox VE with Ansible, creating VMs or templates, managing Proxmox clusters, using community.proxmox collection, or deciding between native modules and CLI commands (pvecm, pveceph, qm).\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-proxmox/SKILL.md",
                "frontmatter": {
                  "name": "ansible-proxmox",
                  "description": "This skill should be used when automating Proxmox VE with Ansible, creating VMs or templates, managing Proxmox clusters, using community.proxmox collection, or deciding between native modules and CLI commands (pvecm, pveceph, qm).\n"
                },
                "content": "# Ansible Proxmox Integration\n\nExpert Proxmox automation using community.proxmox collection with minimal CLI usage.\n\n## Module Selection\n\n### Prefer Native Modules\n\nUse `community.proxmox` modules when available:\n\n| Operation | Use Module | NOT CLI |\n|-----------|------------|---------|\n| Create VM | `community.proxmox.proxmox_kvm` | `qm create` |\n| Clone VM | `community.proxmox.proxmox_kvm` | `qm clone` |\n| Manage users | `community.proxmox.proxmox_user` | `pveum user` |\n| Manage groups | `community.proxmox.proxmox_group` | `pveum group` |\n| Manage pools | `community.proxmox.proxmox_pool` | `pveum pool` |\n| Manage ACLs | `community.proxmox.proxmox_acl` | `pveum acl` |\n| Storage | `community.proxmox.proxmox_storage` | `pvesm` |\n\n### When CLI is Required\n\nSome operations lack native modules:\n\n| Operation | Requires CLI | Reason |\n|-----------|--------------|--------|\n| Cluster create | `pvecm create` | No module exists |\n| Cluster join | `pvecm add` | No module exists |\n| CEPH init | `pveceph init` | Complex workflow |\n| CEPH OSD | `pveceph osd create` | Complex workflow |\n\n## Native Module Examples\n\n### Create VM from Template\n\n```yaml\n- name: Create VM from template\n  community.proxmox.proxmox_kvm:\n    api_host: \"{{ proxmox_api_host }}\"\n    api_user: \"{{ proxmox_api_user }}\"\n    api_token_id: \"{{ proxmox_token_id }}\"\n    api_token_secret: \"{{ proxmox_token_secret }}\"\n    node: \"{{ proxmox_node }}\"\n    vmid: \"{{ vm_id }}\"\n    name: \"{{ vm_name }}\"\n    clone: \"{{ template_name }}\"\n    full: true\n    storage: local-lvm\n    memory: \"{{ vm_memory | default(4096) }}\"\n    cores: \"{{ vm_cores | default(2) }}\"\n    state: present\n  delegate_to: localhost\n```\n\n### Manage Proxmox User\n\n```yaml\n- name: Create Terraform user\n  community.proxmox.proxmox_user:\n    api_host: \"{{ proxmox_api_host }}\"\n    api_user: \"root@pam\"\n    api_password: \"{{ proxmox_root_password }}\"\n    userid: \"terraform@pve\"\n    comment: \"Terraform automation user\"\n    groups:\n      - automation\n    state: present\n  no_log: true\n  delegate_to: localhost\n```\n\n### Configure ACLs\n\n```yaml\n- name: Grant terraform permissions\n  community.proxmox.proxmox_acl:\n    api_host: \"{{ proxmox_api_host }}\"\n    api_user: \"{{ proxmox_api_user }}\"\n    api_token_id: \"{{ proxmox_token_id }}\"\n    api_token_secret: \"{{ proxmox_token_secret }}\"\n    path: \"/\"\n    users:\n      - terraform@pve\n    roles:\n      - Administrator\n    state: present\n  delegate_to: localhost\n```\n\n## CLI with Idempotency\n\nWhen CLI is required, add proper idempotency controls:\n\n### Cluster Formation\n\n```yaml\n- name: Check existing cluster status\n  ansible.builtin.command: pvecm status\n  register: cluster_status\n  failed_when: false\n  changed_when: false\n\n- name: Set cluster facts\n  ansible.builtin.set_fact:\n    is_cluster_member: \"{{ cluster_status.rc == 0 }}\"\n    in_target_cluster: \"{{ cluster_name in cluster_status.stdout }}\"\n\n- name: Create cluster on primary node\n  ansible.builtin.command: pvecm create {{ cluster_name }}\n  when:\n    - inventory_hostname == groups['proxmox'][0]\n    - not in_target_cluster\n  register: cluster_create\n  changed_when: cluster_create.rc == 0\n\n- name: Join cluster on secondary nodes\n  ansible.builtin.command: pvecm add {{ hostvars[groups['proxmox'][0]].ansible_host }}\n  when:\n    - inventory_hostname != groups['proxmox'][0]\n    - not is_cluster_member\n  register: cluster_join\n  changed_when: cluster_join.rc == 0\n```\n\n### API Token Creation\n\n```yaml\n- name: Create API token\n  ansible.builtin.command: >\n    pveum user token add {{ username }}@pam {{ token_name }}\n    --privsep 0\n  register: token_result\n  changed_when: \"'already exists' not in token_result.stderr\"\n  failed_when:\n    - token_result.rc != 0\n    - \"'already exists' not in token_result.stderr\"\n  no_log: true\n```\n\n## Authentication Patterns\n\n### API Token (Recommended)\n\n```yaml\n# Store token in variables or Infisical\nproxmox_api_host: \"192.168.1.10\"\nproxmox_api_user: \"terraform@pve\"\nproxmox_token_id: \"automation\"\nproxmox_token_secret: \"{{ lookup('infisical', 'PROXMOX_TOKEN_SECRET') }}\"\n\n- name: Create VM\n  community.proxmox.proxmox_kvm:\n    api_host: \"{{ proxmox_api_host }}\"\n    api_user: \"{{ proxmox_api_user }}\"\n    api_token_id: \"{{ proxmox_token_id }}\"\n    api_token_secret: \"{{ proxmox_token_secret }}\"\n    # ... rest of config\n```\n\n### Root Password (Local Operations)\n\nFor operations on Proxmox nodes themselves:\n\n```yaml\n- name: Retrieve root password\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'PROXMOX_ROOT_PASSWORD'\n    secret_var_name: 'proxmox_root_password'\n\n- name: Configure via API\n  community.proxmox.proxmox_user:\n    api_host: \"{{ inventory_hostname }}\"\n    api_user: \"root@pam\"\n    api_password: \"{{ proxmox_root_password }}\"\n    # ... config\n  no_log: true\n```\n\n## Cluster Operations\n\n### Idempotent Cluster Status Check\n\n```yaml\n- name: Get cluster status\n  ansible.builtin.command: pvecm status\n  register: cluster_status\n  changed_when: false\n  failed_when: false\n\n- name: Get cluster nodes\n  ansible.builtin.command: pvecm nodes\n  register: cluster_nodes\n  changed_when: false\n  failed_when: false\n  when: cluster_status.rc == 0\n\n- name: Set cluster facts\n  ansible.builtin.set_fact:\n    cluster_exists: \"{{ cluster_status.rc == 0 }}\"\n    cluster_node_count: \"{{ cluster_nodes.stdout_lines | length | default(0) }}\"\n    is_quorate: \"{{ 'Quorate: Yes' in cluster_status.stdout | default('') }}\"\n```\n\n### Verify Cluster Health\n\n```yaml\n- name: Verify cluster quorum\n  ansible.builtin.command: pvecm status\n  register: cluster_health\n  changed_when: false\n  failed_when: \"'Quorate: Yes' not in cluster_health.stdout\"\n\n- name: Verify expected node count\n  ansible.builtin.command: pvecm nodes\n  register: nodes_check\n  changed_when: false\n  failed_when: nodes_check.stdout_lines | length != groups['proxmox'] | length\n```\n\n## CEPH Integration\n\n### Initialize CEPH\n\n```yaml\n- name: Check if CEPH is initialized\n  ansible.builtin.command: pveceph status\n  register: ceph_status\n  changed_when: false\n  failed_when: false\n\n- name: Initialize CEPH\n  ansible.builtin.command: >\n    pveceph init --network {{ ceph_network }}\n  when:\n    - inventory_hostname == groups['proxmox'][0]\n    - ceph_status.rc != 0\n  register: ceph_init\n  changed_when: ceph_init.rc == 0\n```\n\n### Create OSD\n\n```yaml\n- name: Check if OSD exists on device\n  ansible.builtin.command: >\n    pveceph osd list\n  register: osd_list\n  changed_when: false\n\n- name: Create OSD\n  ansible.builtin.command: >\n    pveceph osd create {{ item }}\n  loop: \"{{ ceph_osd_devices }}\"\n  when: item not in osd_list.stdout\n  register: osd_create\n  changed_when: osd_create.rc == 0\n```\n\n## Network Configuration\n\nUse `community.general.interfaces_file` for network config:\n\n```yaml\n- name: Configure VLAN-aware bridge\n  community.general.interfaces_file:\n    iface: vmbr1\n    option: bridge-vlan-aware\n    value: \"yes\"\n    backup: true\n    state: present\n  notify: reload network\n\n- name: Set bridge ports\n  community.general.interfaces_file:\n    iface: vmbr1\n    option: bridge-ports\n    value: \"bond0\"\n    backup: true\n    state: present\n  notify: reload network\n```\n\n## Anti-Patterns\n\n### Using CLI When Module Exists\n\n```yaml\n# BAD - Module exists for this\n- name: Create user\n  ansible.builtin.command: pveum user add terraform@pve\n\n# GOOD\n- name: Create user\n  community.proxmox.proxmox_user:\n    api_host: \"{{ proxmox_api_host }}\"\n    api_user: \"root@pam\"\n    api_password: \"{{ password }}\"\n    userid: \"terraform@pve\"\n    state: present\n```\n\n### Missing Idempotency on CLI\n\n```yaml\n# BAD - Will fail on second run\n- name: Create cluster\n  ansible.builtin.command: pvecm create MyCluster\n\n# GOOD\n- name: Check cluster status\n  ansible.builtin.command: pvecm status\n  register: cluster_check\n  changed_when: false\n  failed_when: false\n\n- name: Create cluster\n  ansible.builtin.command: pvecm create MyCluster\n  when: cluster_check.rc != 0\n```\n\n### Running on Wrong Host\n\n```yaml\n# BAD - API calls from managed node\n- name: Create VM\n  community.proxmox.proxmox_kvm:\n    api_host: \"{{ inventory_hostname }}\"  # Calling itself\n    # ...\n\n# GOOD - Delegate API calls to localhost\n- name: Create VM\n  community.proxmox.proxmox_kvm:\n    api_host: \"{{ proxmox_api_host }}\"\n    # ...\n  delegate_to: localhost\n```\n\n## Installing the Collection\n\n```bash\n# Install community.proxmox\nuv run ansible-galaxy collection install community.proxmox\n\n# Or via requirements.yml\ncd ansible\nuv run ansible-galaxy collection install -r requirements.yml\n```\n\n## Additional Resources\n\nFor detailed Proxmox automation patterns, consult:\n\n- **`references/ceph-automation.md`** - CEPH storage deployment and OSD management\n- **`references/cluster-automation.md`** - Proxmox cluster creation and node joining\n- **`references/network-automation.md`** - VLAN-aware bridges and network configuration\n- **`references/community-proxmox-plugin-index.md`** - Complete community.proxmox module reference\n\n## Related Skills\n\n- **ansible-fundamentals** - Core module selection patterns\n- **ansible-idempotency** - Making CLI commands idempotent\n- **ansible-error-handling** - Error recovery for cluster operations"
              },
              {
                "name": "ansible-role-design",
                "description": "This skill should be used when creating Ansible roles, designing role directory structure, organizing role variables in defaults vs vars, writing role handlers, or structuring role tasks. Based on analysis of 7 production geerlingguy roles.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-role-design/SKILL.md",
                "frontmatter": {
                  "name": "ansible-role-design",
                  "description": "This skill should be used when creating Ansible roles, designing role directory structure, organizing role variables in defaults vs vars, writing role handlers, or structuring role tasks. Based on analysis of 7 production geerlingguy roles.\n"
                },
                "content": "# Ansible Role Design\n\nProduction-grade role structure patterns derived from analysis of 7 geerlingguy roles.\n\n## Standard Directory Structure\n\nEvery Ansible role follows this organizational pattern:\n\n```text\nrole-name/\n defaults/\n    main.yml          # User-configurable defaults (lowest precedence)\n vars/\n    Debian.yml        # OS-specific internal values\n    RedHat.yml\n tasks/\n    main.yml          # Task router\n    install.yml       # Feature-specific tasks\n    configure.yml\n handlers/\n    main.yml          # Event-triggered tasks\n templates/\n    config.conf.j2    # Jinja2 templates\n files/\n    static-file.txt   # Static files\n meta/\n    main.yml          # Role metadata, dependencies\n README.md             # Documentation\n```\n\n### Directory Purposes\n\n| Directory | Purpose | Precedence |\n|-----------|---------|------------|\n| `defaults/` | User-overridable values | Lowest |\n| `vars/` | Internal/OS-specific values | High |\n| `tasks/` | Ansible tasks | N/A |\n| `handlers/` | Service restarts, reloads | N/A |\n| `templates/` | Jinja2 config files | N/A |\n| `files/` | Static files to copy | N/A |\n| `meta/` | Galaxy info, dependencies | N/A |\n\n### When to Omit Directories\n\nOnly create directories that are actually needed:\n\n- **Omit `templates/`** if using only `lineinfile` or `copy`\n- **Omit `handlers/`** if role doesn't manage services\n- **Omit `vars/`** if no OS-specific differences\n- **Omit `files/`** if no static files to copy\n\n## Task Organization\n\n### Main Task File as Router\n\nUse `tasks/main.yml` as a routing file that includes feature-specific files:\n\n```yaml\n# tasks/main.yml\n---\n- name: Include OS-specific variables\n  ansible.builtin.include_vars: \"{{ ansible_os_family }}.yml\"\n\n- name: Install packages\n  ansible.builtin.include_tasks: install.yml\n\n- name: Configure service\n  ansible.builtin.include_tasks: configure.yml\n\n- name: Setup users\n  ansible.builtin.include_tasks: users.yml\n  when: role_users | length > 0\n```\n\n### When to Split Tasks\n\n| Scenario | Approach |\n|----------|----------|\n| < 30 lines | Keep in main.yml |\n| 30-100 lines | Consider splitting |\n| > 100 lines | Definitely split |\n| Optional features | Separate file with `when:` |\n| OS-specific logic | Separate files per OS |\n\n### Task File Naming\n\nUse descriptive, feature-based names:\n\n```text\ntasks/\n main.yml              # Router only\n install.yml           # Package installation\n configure.yml         # Configuration tasks\n users.yml             # User management\n install-Debian.yml    # Debian-specific install\n install-RedHat.yml    # RedHat-specific install\n```\n\n## Variable Organization\n\n### defaults/ vs vars/\n\n| Location | Purpose | User Override? |\n|----------|---------|----------------|\n| `defaults/main.yml` | User configuration | Yes (easily) |\n| `vars/main.yml` | Internal constants | Possible but discouraged |\n| `vars/Debian.yml` | OS-specific values | No (internal) |\n\n### defaults/main.yml Example\n\n```yaml\n# defaults/main.yml\n---\n# User-configurable options\ndocker_edition: \"ce\"\ndocker_service_state: started\ndocker_service_enabled: true\ndocker_users: []\n\n# Feature toggles\ndocker_install_compose: true\ndocker_compose_version: \"2.24.0\"\n```\n\n### vars/Debian.yml Example\n\n```yaml\n# vars/Debian.yml\n---\n# OS-specific internal values (not for user override)\ndocker_package_name: docker-ce\ndocker_service_name: docker\ndocker_config_path: /etc/docker/daemon.json\n```\n\n### Loading OS-Specific Variables\n\nSimple pattern:\n\n```yaml\n- name: Include OS-specific variables\n  ansible.builtin.include_vars: \"{{ ansible_os_family }}.yml\"\n```\n\nAdvanced pattern with fallback:\n\n```yaml\n- name: Load OS-specific vars\n  ansible.builtin.include_vars: \"{{ lookup('first_found', params) }}\"\n  vars:\n    params:\n      files:\n        - \"{{ ansible_distribution }}.yml\"\n        - \"{{ ansible_os_family }}.yml\"\n        - main.yml\n      paths:\n        - vars\n```\n\n## Variable Naming Convention\n\nPrefix variables with role name:\n\n```yaml\n# Pattern: {role_name}_{feature}_{attribute}\n\n# Examples\ndocker_edition: \"ce\"\ndocker_service_state: started\ndocker_compose_version: \"2.24.0\"\ndocker_users: []\n\n# Grouped by feature\nsecurity_ssh_port: 22\nsecurity_ssh_password_auth: \"no\"\nsecurity_fail2ban_enabled: true\n```\n\n### Benefits\n\n- Prevents conflicts with other roles\n- Clear ownership of variables\n- Easy to grep across codebase\n- Self-documenting\n\n## Handler Patterns\n\n### Simple Handler Definitions\n\n```yaml\n# handlers/main.yml\n---\n- name: restart docker\n  ansible.builtin.systemd:\n    name: docker\n    state: restarted\n\n- name: reload nginx\n  ansible.builtin.systemd:\n    name: nginx\n    state: reloaded\n```\n\n### Handler Naming\n\nUse lowercase with action + service pattern:\n\n```yaml\n- name: restart ssh      # Not \"Restart SSH Service\"\n- name: reload nginx     # Not \"Reload Nginx Config\"\n- name: reload systemd   # For daemon-reload\n```\n\n### Throttled Handlers\n\nFor cluster operations, restart one node at a time:\n\n```yaml\n- name: restart pve-cluster\n  ansible.builtin.systemd:\n    name: pve-cluster\n    state: restarted\n  throttle: 1\n```\n\n## Template Organization\n\n### When to Use Templates\n\nUse `templates/` when:\n\n- Configuration has conditional content\n- Need variable substitution\n- Complex multi-line configuration\n- Users may need to extend/override\n\nUse `lineinfile` when:\n\n- Simple single-line changes\n- Modifying existing system files\n\n### Template Variables\n\nExpose template paths as variables for user override:\n\n```yaml\n# defaults/main.yml\nnginx_conf_template: nginx.conf.j2\nnginx_vhost_template: vhost.j2\n```\n\n```yaml\n# tasks/configure.yml\n- name: Deploy nginx config\n  ansible.builtin.template:\n    src: \"{{ nginx_conf_template }}\"\n    dest: /etc/nginx/nginx.conf\n  notify: reload nginx\n```\n\n## Meta Configuration\n\n### meta/main.yml Structure\n\n```yaml\n# meta/main.yml\n---\ngalaxy_info:\n  author: your_name\n  description: Role description\n  license: MIT\n  min_ansible_version: \"2.12\"\n  platforms:\n    - name: Debian\n      versions:\n        - bullseye\n        - bookworm\n    - name: Ubuntu\n      versions:\n        - focal\n        - jammy\n\ndependencies:\n  - role: common\n  - role: geerlingguy.docker\n    when: install_docker | default(false)\n```\n\n## Role Complexity Scaling\n\nBased on geerlingguy role analysis:\n\n| Role Complexity | Directories | Task Files | Examples |\n|-----------------|-------------|------------|----------|\n| Minimal | 3-4 | 1 (main.yml) | pip, git |\n| Standard | 5-6 | 2-4 | security, docker |\n| Complex | 7+ | 5-8 | postgresql, nginx |\n\n### Minimal Role\n\n```text\npip/\n defaults/main.yml\n tasks/main.yml\n meta/main.yml\n README.md\n```\n\n### Standard Role\n\n```text\ndocker/\n defaults/main.yml\n vars/{Debian,RedHat}.yml\n tasks/{main,install,configure}.yml\n handlers/main.yml\n meta/main.yml\n README.md\n```\n\n### Complex Role\n\n```text\npostgresql/\n defaults/main.yml\n vars/{Debian,RedHat,Archlinux}.yml\n tasks/{main,install,configure,users,databases}.yml\n handlers/main.yml\n templates/{postgresql.conf,pg_hba.conf}.j2\n meta/main.yml\n README.md\n```\n\n## Task Naming Convention\n\nStart task names with action verbs:\n\n```yaml\n# GOOD\n- name: Ensure Docker is installed\n- name: Configure SSH security settings\n- name: Add user to docker group\n\n# BAD\n- name: Docker installation\n- name: SSH settings\n- name: User docker group\n```\n\n## File Validation\n\nValidate critical configuration files:\n\n```yaml\n- name: Update SSH configuration\n  ansible.builtin.lineinfile:\n    path: /etc/ssh/sshd_config\n    regexp: \"^PermitRootLogin\"\n    line: \"PermitRootLogin no\"\n    validate: 'sshd -T -f %s'\n  notify: restart ssh\n\n- name: Update sudoers\n  ansible.builtin.lineinfile:\n    path: /etc/sudoers\n    line: \"{{ user }} ALL=(ALL) NOPASSWD: ALL\"\n    validate: 'visudo -cf %s'\n```\n\n## Documentation\n\nEvery role needs a README.md with:\n\n1. **Description** - What the role does\n2. **Requirements** - Prerequisites\n3. **Role Variables** - All variables with defaults\n4. **Dependencies** - Other roles needed\n5. **Example Playbook** - How to use it\n\n## Additional Resources\n\nFor detailed role design patterns and techniques, consult:\n\n- **`references/role-structure-standards.md`** - Production role structure patterns from geerlingguy analysis\n- **`references/handler-best-practices.md`** - Handler design, notification patterns, flush strategies\n- **`references/meta-dependencies.md`** - Role dependencies, Galaxy metadata, platform support\n- **`references/variable-management-patterns.md`** - Variable naming, scoping, precedence patterns\n- **`references/documentation-templates.md`** - README templates and documentation standards\n\n## Related Skills\n\n- **ansible-playbook-design** - When to use roles vs playbooks\n- **ansible-fundamentals** - Module selection and naming\n- **ansible-testing** - Role testing with molecule"
              },
              {
                "name": "ansible-secrets",
                "description": "This skill should be used when working with secrets in Ansible playbooks, integrating Infisical vault, using no_log directive, retrieving credentials securely, or implementing fallback patterns for secrets. Covers the reusable Infisical lookup task.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-secrets/SKILL.md",
                "frontmatter": {
                  "name": "ansible-secrets",
                  "description": "This skill should be used when working with secrets in Ansible playbooks, integrating Infisical vault, using no_log directive, retrieving credentials securely, or implementing fallback patterns for secrets. Covers the reusable Infisical lookup task.\n"
                },
                "content": "# Ansible Secrets Management\n\nSecure secrets handling with Infisical integration and proper security practices.\n\n## Architecture Overview\n\n```text\n\n   Ansible    \n   Playbook   \n\n       \n        include_tasks: infisical-secret-lookup.yml\n       \n       \n\n Infisical Lookup \n      Task        \n\n       \n       > Try Universal Auth (preferred)\n          - INFISICAL_UNIVERSAL_AUTH_CLIENT_ID\n          - INFISICAL_UNIVERSAL_AUTH_CLIENT_SECRET\n       \n       > Fallback to Environment Variable (optional)\n          - Uses specified fallback_env_var\n       \n       \n\n  Infisical    (Vault)\n     API      \n\n```\n\n## Reusable Task Pattern\n\nThe repository provides a reusable task for secret retrieval at `ansible/tasks/infisical-secret-lookup.yml`.\n\n### Basic Usage\n\n```yaml\n- name: Retrieve Proxmox password\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'PROXMOX_PASSWORD'\n    secret_var_name: 'proxmox_password'\n    infisical_project_id: '7b832220-24c0-45bc-a5f1-ce9794a31259'\n    infisical_env: 'prod'\n    infisical_path: '/proxmox-cluster'\n\n# Now use the secret\n- name: Create Proxmox user\n  community.proxmox.proxmox_user:\n    api_password: \"{{ proxmox_password }}\"\n    # ... other config ...\n  no_log: true\n```\n\n### With Fallback\n\n```yaml\n- name: Retrieve database password\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'DB_PASSWORD'\n    secret_var_name: 'db_password'\n    fallback_env_var: 'DB_PASSWORD'  # Falls back to $DB_PASSWORD\n    infisical_project_id: '7b832220-24c0-45bc-a5f1-ce9794a31259'\n    infisical_env: 'prod'\n    infisical_path: '/database'\n```\n\n### Task Parameters\n\n| Variable | Required | Default | Description |\n|----------|----------|---------|-------------|\n| `secret_name` | Yes | - | Name of secret in Infisical |\n| `secret_var_name` | Yes | - | Variable name to store secret |\n| `infisical_project_id` | No | (repo default) | Infisical project ID |\n| `infisical_env` | No | `prod` | Environment (prod, dev, staging) |\n| `infisical_path` | No | `/apollo-13/vault` | Path within project |\n| `fallback_env_var` | No | - | Env var to use as fallback |\n| `allow_empty` | No | `false` | Allow empty secret values |\n\n## Authentication\n\n### Universal Auth (Recommended)\n\nSet environment variables before running playbooks:\n\n```bash\nexport INFISICAL_UNIVERSAL_AUTH_CLIENT_ID=\"ua-abc123\"\nexport INFISICAL_UNIVERSAL_AUTH_CLIENT_SECRET=\"secret-xyz789\"\n\ncd ansible\nuv run ansible-playbook playbooks/my-playbook.yml\n```\n\n### Environment Fallback\n\nFor local development or CI without Infisical:\n\n```bash\nexport PROXMOX_PASSWORD=\"local-dev-password\"\n\ncd ansible\nuv run ansible-playbook playbooks/my-playbook.yml\n```\n\n## Security Best Practices\n\n### 1. Use no_log\n\nOn tasks that handle secrets:\n\n```yaml\n- name: Set database password\n  ansible.builtin.command: set-password {{ password }}\n  no_log: true\n\n- name: Deploy config with secrets\n  ansible.builtin.template:\n    src: config.j2\n    dest: /etc/app/config.yml\n  no_log: true\n```\n\n### 2. Avoid Hard-Coded Secrets\n\n```yaml\n# BAD - Exposes secrets\n- name: Create user\n  community.proxmox.proxmox_user:\n    api_password: \"my-password-123\"  # EXPOSED!\n\n# GOOD\n- name: Retrieve password\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'PROXMOX_PASSWORD'\n    secret_var_name: 'proxmox_password'\n\n- name: Create user\n  community.proxmox.proxmox_user:\n    api_password: \"{{ proxmox_password }}\"\n  no_log: true\n```\n\n### 3. Validate Secret Retrieval\n\nAdd validation for critical secrets:\n\n```yaml\n- name: Get database password\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'DB_PASSWORD'\n    secret_var_name: 'db_password'\n\n- name: Validate password complexity\n  ansible.builtin.assert:\n    that:\n      - db_password | length >= 16\n    fail_msg: \"Password doesn't meet complexity requirements\"\n  no_log: true\n```\n\n### 4. Limit Secret Scope\n\nRetrieve secrets only when needed:\n\n```yaml\n# GOOD - Retrieve only when needed\n- name: System tasks (no secrets)\n  ansible.builtin.apt:\n    name: nginx\n    state: present\n\n- name: Get credentials (only when needed)\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'DB_PASSWORD'\n    secret_var_name: 'db_password'\n\n- name: Configure database connection\n  ansible.builtin.template:\n    src: db-config.j2\n    dest: /etc/app/db.yml\n  no_log: true\n```\n\n### 5. Use Environment Isolation\n\nSeparate secrets by environment:\n\n```yaml\n# Production\n- name: Get prod secret\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'DB_PASSWORD'\n    secret_var_name: 'db_password'\n    infisical_env: 'prod'\n    infisical_path: '/production/database'\n\n# Development\n- name: Get dev secret\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'DB_PASSWORD'\n    secret_var_name: 'db_password'\n    infisical_env: 'dev'\n    infisical_path: '/development/database'\n```\n\n## Multiple Secrets Pattern\n\n```yaml\n---\n- name: Deploy application with secrets\n  hosts: app_servers\n  become: true\n\n  vars:\n    infisical_project_id: '7b832220-24c0-45bc-a5f1-ce9794a31259'\n    infisical_env: 'prod'\n    infisical_path: '/app-config'\n\n  tasks:\n    - name: Retrieve database password\n      ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n      vars:\n        secret_name: 'DB_PASSWORD'\n        secret_var_name: 'db_password'\n\n    - name: Retrieve API key\n      ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n      vars:\n        secret_name: 'API_KEY'\n        secret_var_name: 'api_key'\n\n    - name: Retrieve Redis password\n      ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n      vars:\n        secret_name: 'REDIS_PASSWORD'\n        secret_var_name: 'redis_password'\n\n    - name: Deploy application config\n      ansible.builtin.template:\n        src: app-config.j2\n        dest: /etc/app/config.yml\n        owner: app\n        group: app\n        mode: '0600'\n      no_log: true\n```\n\n## CI/CD Integration\n\n### GitHub Actions\n\n```yaml\nname: Deploy\non: push\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Set up Infisical\n        env:\n          INFISICAL_CLIENT_ID: ${{ secrets.INFISICAL_CLIENT_ID }}\n          INFISICAL_CLIENT_SECRET: ${{ secrets.INFISICAL_CLIENT_SECRET }}\n        run: |\n          echo \"INFISICAL_UNIVERSAL_AUTH_CLIENT_ID=$INFISICAL_CLIENT_ID\" >> $GITHUB_ENV\n          echo \"INFISICAL_UNIVERSAL_AUTH_CLIENT_SECRET=$INFISICAL_CLIENT_SECRET\" >> $GITHUB_ENV\n\n      - name: Run Ansible\n        run: |\n          cd ansible\n          uv run ansible-playbook playbooks/deploy.yml\n```\n\n## Troubleshooting\n\n### Missing Authentication\n\n**Error**: Missing Infisical authentication credentials\n\n**Solution**:\n\n```bash\nexport INFISICAL_UNIVERSAL_AUTH_CLIENT_ID=\"ua-abc123\"\nexport INFISICAL_UNIVERSAL_AUTH_CLIENT_SECRET=\"secret-xyz789\"\n```\n\n### Secret Not Found\n\n**Error**: Failed to retrieve secret from Infisical\n\n**Check**:\n\n1. Secret exists at specified path in Infisical\n2. Correct project_id/env/path\n3. Service account has read permission\n\n### Empty Secret Value\n\n**Error**: Secret validation failed (empty value)\n\n**Solutions**:\n\n```yaml\n# Option 1: Allow empty (not recommended for required secrets)\n- name: Get optional secret\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'OPTIONAL_KEY'\n    secret_var_name: 'optional_key'\n    allow_empty: true\n\n# Option 2: Use fallback\n- name: Get secret with fallback\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'API_KEY'\n    secret_var_name: 'api_key'\n    fallback_env_var: 'DEFAULT_API_KEY'\n```\n\n## Additional Resources\n\nFor detailed secrets management patterns, consult:\n\n- **`references/secrets-management.md`** - Infisical integration patterns, no_log best practices, credential security\n\n## Related Skills\n\n- **ansible-fundamentals** - Core Ansible patterns\n- **ansible-error-handling** - Error handling for secret retrieval failures"
              },
              {
                "name": "ansible-testing",
                "description": "This skill should be used when running ansible-lint, configuring linting rules, testing Ansible playbooks, validating playbook syntax, or setting up integration tests. Covers ansible-lint configuration and testing strategies.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-testing/SKILL.md",
                "frontmatter": {
                  "name": "ansible-testing",
                  "description": "This skill should be used when running ansible-lint, configuring linting rules, testing Ansible playbooks, validating playbook syntax, or setting up integration tests. Covers ansible-lint configuration and testing strategies.\n"
                },
                "content": "# Ansible Testing\n\nTesting strategies and ansible-lint configuration for Ansible automation.\n\n## ansible-lint\n\n### Running Lint\n\n```bash\n# Via mise (recommended)\nmise run ansible-lint\n\n# Directly with uv\nuv run ansible-lint ansible/playbooks/\n\n# Specific file\nuv run ansible-lint ansible/playbooks/my-playbook.yml\n\n# With verbose output\nuv run ansible-lint -v ansible/\n```\n\n### Configuration File\n\nLocated at `ansible/.ansible-lint`:\n\n```yaml\n---\n# Profile: null, min, basic, moderate, safety, shared, production\nprofile: moderate\n\n# Offline mode - don't download Galaxy requirements\noffline: true\n\n# Exclude paths\nexclude_paths:\n  - .cache/\n  - .venv/\n  - .git/\n  - \"*/templates/\"\n  - \"*.j2\"\n  - .deprecated/\n\n# Rules to skip completely\nskip_list:\n  - var-naming[no-role-prefix]  # We use descriptive names\n  - run-once[task]              # Safe with our strategy\n  - command-instead-of-module   # CLI tools require command\n  - yaml[line-length]           # Long lines in infra configs\n\n# Rules to warn but not fail\nwarn_list:\n  - fqcn[action-core]\n  - fqcn[action]\n  - no-handler\n  - name[play]\n```\n\n### Common Rule Categories\n\n| Category | Description |\n|----------|-------------|\n| `fqcn` | Fully qualified collection names |\n| `yaml` | YAML formatting (indentation, line length) |\n| `name` | Task/play naming conventions |\n| `command-instead-of-module` | Using command when module exists |\n| `no-changed-when` | Missing changed_when on command |\n| `risky-file-permissions` | Missing explicit file permissions |\n\n### Fixing Common Issues\n\n**Missing name on task:**\n\n```yaml\n# BAD\n- ansible.builtin.apt:\n    name: nginx\n\n# GOOD\n- name: Install nginx\n  ansible.builtin.apt:\n    name: nginx\n```\n\n**Short module name:**\n\n```yaml\n# BAD (triggers fqcn warning)\n- name: Install package\n  apt:\n    name: nginx\n\n# GOOD\n- name: Install package\n  ansible.builtin.apt:\n    name: nginx\n```\n\n**Using shell instead of command:**\n\n```yaml\n# BAD (when no shell features needed)\n- name: List files\n  ansible.builtin.shell: ls -la /tmp\n\n# GOOD\n- name: List files\n  ansible.builtin.command: ls -la /tmp\n  changed_when: false\n```\n\n**Missing changed_when:**\n\n```yaml\n# BAD (always shows changed)\n- name: Check status\n  ansible.builtin.command: systemctl status app\n\n# GOOD\n- name: Check status\n  ansible.builtin.command: systemctl status app\n  register: status_check\n  changed_when: false\n  failed_when: false\n```\n\n## Syntax Checking\n\nValidate playbook syntax before running:\n\n```bash\n# Check syntax only\nuv run ansible-playbook --syntax-check playbooks/my-playbook.yml\n\n# Check mode (dry run)\nuv run ansible-playbook playbooks/my-playbook.yml --check\n\n# Diff mode (show changes)\nuv run ansible-playbook playbooks/my-playbook.yml --check --diff\n```\n\n## Idempotency Testing\n\nVerify playbooks are idempotent by running twice:\n\n```bash\n# First run - may show changes\nuv run ansible-playbook playbooks/setup.yml\n\n# Second run - should show 0 changes\nuv run ansible-playbook playbooks/setup.yml\n\n# If second run shows changes, playbook is NOT idempotent\n```\n\n### Automated Idempotency Check\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\nPLAYBOOK=\"$1\"\n\necho \"First run...\"\nuv run ansible-playbook \"$PLAYBOOK\"\n\necho \"Second run (checking idempotency)...\"\nOUTPUT=$(uv run ansible-playbook \"$PLAYBOOK\" 2>&1)\n\nif echo \"$OUTPUT\" | grep -q \"changed=0\"; then\n    echo \" Playbook is idempotent\"\n    exit 0\nelse\n    echo \" Playbook is NOT idempotent\"\n    echo \"$OUTPUT\" | grep -E \"(changed|failed)=\"\n    exit 1\nfi\n```\n\n## Integration Testing\n\n### Test Against Real Infrastructure\n\n```bash\n# Limit to test hosts\nuv run ansible-playbook playbooks/deploy.yml --limit test_hosts\n\n# With verbose output\nuv run ansible-playbook playbooks/deploy.yml --limit test_hosts -vv\n```\n\n### Pre-flight Validation\n\nAdd validation tasks at playbook start:\n\n```yaml\n---\n- name: Deploy with validation\n  hosts: all\n  become: true\n\n  pre_tasks:\n    - name: Validate target environment\n      ansible.builtin.assert:\n        that:\n          - ansible_distribution == \"Debian\"\n          - ansible_distribution_major_version | int >= 11\n        fail_msg: \"Requires Debian 11+\"\n\n    - name: Check connectivity\n      ansible.builtin.ping:\n\n    - name: Verify disk space\n      ansible.builtin.assert:\n        that:\n          - ansible_mounts | selectattr('mount', 'equalto', '/') | map(attribute='size_available') | first > 1073741824\n        fail_msg: \"Insufficient disk space\"\n```\n\n## Test Playbook Pattern\n\nCreate test playbooks for validation:\n\n```yaml\n# playbooks/test-role.yml\n---\n- name: Test role functionality\n  hosts: test_hosts\n  become: true\n\n  vars:\n    test_mode: true\n\n  roles:\n    - role: my_role\n\n  tasks:\n    - name: Verify service is running\n      ansible.builtin.systemd:\n        name: myservice\n      register: service_status\n      failed_when: service_status.status.ActiveState != \"active\"\n\n    - name: Verify config file exists\n      ansible.builtin.stat:\n        path: /etc/myservice/config.yml\n      register: config_stat\n      failed_when: not config_stat.stat.exists\n\n    - name: Verify port is listening\n      ansible.builtin.wait_for:\n        port: 8080\n        timeout: 10\n```\n\n## CI/CD Integration\n\n### GitHub Actions\n\n```yaml\nname: Ansible Lint\n\non: [push, pull_request]\n\njobs:\n  lint:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Set up Python\n        uses: actions/setup-python@v5\n        with:\n          python-version: '3.13'\n\n      - name: Install uv\n        run: pip install uv\n\n      - name: Install dependencies\n        run: uv sync\n\n      - name: Run ansible-lint\n        run: uv run ansible-lint ansible/\n```\n\n## Debugging Playbooks\n\n### Verbose Output\n\n```bash\n# Increase verbosity\nuv run ansible-playbook playbook.yml -v    # Basic\nuv run ansible-playbook playbook.yml -vv   # More detail\nuv run ansible-playbook playbook.yml -vvv  # Connection debugging\nuv run ansible-playbook playbook.yml -vvvv # Maximum detail\n```\n\n### Debug Tasks\n\n```yaml\n- name: Debug variable value\n  ansible.builtin.debug:\n    var: my_variable\n\n- name: Debug with message\n  ansible.builtin.debug:\n    msg: \"The value is {{ my_variable }}\"\n\n- name: Debug registered result\n  ansible.builtin.debug:\n    var: command_result\n  when: ansible_verbosity > 0\n```\n\n### Step Mode\n\n```bash\n# Pause after each task\nuv run ansible-playbook playbook.yml --step\n```\n\n## Lint Profiles\n\nChoose appropriate profile based on needs:\n\n| Profile | Strictness | Use Case |\n|---------|------------|----------|\n| `min` | Lowest | Legacy code, quick fixes |\n| `basic` | Low | Development |\n| `moderate` | Medium | General infrastructure |\n| `safety` | High | Security-sensitive |\n| `production` | Highest | Production deployments |\n\n## Additional Resources\n\nFor detailed testing patterns and techniques, consult:\n\n- **`references/testing-comprehensive.md`** - ansible-lint configuration, integration testing strategies, CI/CD patterns\n\n## Related Skills\n\n- **ansible-fundamentals** - Core Ansible patterns\n- **ansible-idempotency** - Ensuring tasks are idempotent"
              }
            ]
          },
          {
            "name": "proxmox-infrastructure",
            "description": "Proxmox VE cluster management including VM provisioning, templates, VLAN networking, and CEPH storage",
            "source": "./plugins/infrastructure/proxmox-infrastructure",
            "category": "infrastructure",
            "version": "1.0.0",
            "author": {
              "name": "basher83"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install proxmox-infrastructure@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [],
            "skills": [
              {
                "name": "proxmox-infrastructure",
                "description": "Proxmox VE cluster management including VM provisioning, template creation with cloud-init, QEMU guest agent integration, storage pool management, VLAN-aware bridge configuration, and Proxmox API interactions. Use when working with Proxmox VE, creating VM templates, configuring Proxmox networking, managing CEPH storage, troubleshooting VM deployment issues, or interacting with Proxmox API.",
                "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/SKILL.md",
                "frontmatter": {
                  "name": "proxmox-infrastructure",
                  "description": "Proxmox VE cluster management including VM provisioning, template creation with cloud-init, QEMU guest agent integration, storage pool management, VLAN-aware bridge configuration, and Proxmox API interactions. Use when working with Proxmox VE, creating VM templates, configuring Proxmox networking, managing CEPH storage, troubleshooting VM deployment issues, or interacting with Proxmox API."
                },
                "content": "# Proxmox Infrastructure Management\n\nExpert guidance for managing Proxmox VE clusters, creating templates, provisioning VMs, and configuring network\ninfrastructure.\n\n## Quick Start\n\n### Common Tasks\n\n**Create VM Template:**\n\n```bash\n# See tools/build-template.yml for automated playbook\ncd ansible && uv run ansible-playbook playbooks/proxmox-build-template.yml\n```\n\n**Clone Template to VM:**\n\n```bash\nqm clone <template-id> <new-vmid> --name <vm-name>\nqm set <new-vmid> --sshkey ~/.ssh/id_rsa.pub\nqm set <new-vmid> --ipconfig0 ip=192.168.1.100/24,gw=192.168.1.1\nqm start <new-vmid>\n```\n\n**Check Cluster Status:**\n\n```bash\n# Use tools/cluster_status.py\n./tools/cluster_status.py\n```\n\n## When to Use This Skill\n\nActivate this skill when:\n\n- Creating or managing Proxmox VM templates\n- Provisioning VMs via cloning or Terraform\n- Configuring Proxmox networking (bridges, VLANs, bonds)\n- Troubleshooting VM deployment or network issues\n- Managing CEPH storage pools\n- Working with QEMU guest agent\n- Interacting with Proxmox API via Python or Ansible\n\n## Core Workflows\n\n### 1. Template Creation\n\n#### Method 1: Using Ansible (Recommended)\n\nSee [tools/build-template.yml](tools/build-template.yml) for complete automation.\n\n#### Method 2: Manual CLI\n\nSee [reference/cloud-init-patterns.md](reference/cloud-init-patterns.md) for detailed steps.\n\nKey points:\n\n- Use `virtio-scsi-pci` controller for Ubuntu images\n- Add cloud-init CD-ROM drive (`ide2`)\n- Configure serial console for cloud images\n- Convert to template with `qm template <vmid>`\n\n### 2. VM Provisioning\n\n**From Ansible:**\nAnalyze existing playbook: [../../ansible/playbooks/proxmox-build-template.yml](../../ansible/playbooks/proxmox-build-template.yml)\n\n**From Terraform:**\nSee examples in [../../terraform/netbox-vm/](../../terraform/netbox-vm/)\n\n**Key Configuration:**\n\n```yaml\n# Ansible example\nproxmox_kvm:\n  node: foxtrot\n  api_host: 192.168.3.5\n  vmid: 101\n  name: docker-01\n  clone: ubuntu-template\n  storage: local-lvm\n  # Network with VLAN\n  net:\n    net0: 'virtio,bridge=vmbr0,tag=30'\n  ipconfig:\n    ipconfig0: 'ip=192.168.3.100/24,gw=192.168.3.1'\n```\n\n### 3. Network Configuration\n\nThis Virgo-Core cluster uses:\n\n- **vmbr0**: Management (192.168.3.0/24, VLAN 9 for Corosync)\n- **vmbr1**: CEPH Public (192.168.5.0/24, MTU 9000)\n- **vmbr2**: CEPH Private (192.168.7.0/24, MTU 9000)\n\nSee [reference/networking.md](reference/networking.md) for:\n\n- VLAN-aware bridge configuration\n- Bond setup (802.3ad LACP)\n- Routed vs bridged vs NAT setups\n\n## Architecture Reference\n\n### This Cluster (\"Matrix\")\n\n**Nodes:** Foxtrot, Golf, Hotel (3 MINISFORUM MS-A2)\n\n**Hardware per Node:**\n\n- AMD Ryzen 9 9955HX (16C/32T)\n- 64GB DDR5 @ 5600 MT/s\n- 3 NVMe: 1 1TB (boot), 2 4TB (CEPH)\n- 4 NICs: 2 10GbE SFP+, 2 2.5GbE\n\n**Network Architecture:**\n\n```text\nenp4s0  vmbr0 (mgmt + vlan9 for corosync)\nenp5s0f0np0  vmbr1 (ceph public, MTU 9000)\nenp5s0f1np1  vmbr2 (ceph private, MTU 9000)\n```\n\nSee [../../docs/goals.md](../../docs/goals.md) for complete specs.\n\n## Tools Available\n\n### Python Scripts (uv)\n\n**validate_template.py** - Validate template health via API\n\n```bash\n./tools/validate_template.py --template-id 9000\n```\n\n**vm_diagnostics.py** - VM health checks\n\n```bash\n./tools/vm_diagnostics.py --vmid 101\n```\n\n**cluster_status.py** - Cluster health metrics\n\n```bash\n./tools/cluster_status.py\n```\n\n### Ansible Playbooks\n\n**build-template.yml** - Automated template creation\n\n- Downloads cloud image\n- Creates VM with proper configuration\n- Converts to template\n\n**configure-networking.yml** - VLAN bridge setup\n\n- Creates VLAN-aware bridges\n- Configures bonds\n- Sets MTU for storage networks\n\n### OpenTofu Modules\n\n**vm-module-example/** - Reusable VM provisioning\n\n- Clone-based deployment\n- Cloud-init integration\n- Network configuration\n\nSee [examples/](examples/) directory.\n\n**Real Examples from Repository**:\n\n- **Multi-VM Cluster**: [../../terraform/examples/microk8s-cluster](../../terraform/examples/microk8s-cluster) - Comprehensive\n  3-node MicroK8s deployment using `for_each` pattern, cross-node cloning, **dual NIC with VLAN** (VLAN 30 primary,\n  VLAN 2 secondary), Ansible integration\n- **Template with Cloud-Init**:\n  [../../terraform/examples/template-with-custom-cloudinit](../../terraform/examples/template-with-custom-cloudinit) -\n  Custom cloud-init snippet configuration\n- **VLAN Bridge Configuration**:\n  [../../ansible/playbooks/proxmox-enable-vlan-bridging.yml](../../ansible/playbooks/proxmox-enable-vlan-bridging.yml) -\n  Enable VLAN-aware bridging on Proxmox nodes (supports VLANs 2-4094)\n\n## Troubleshooting\n\nCommon issues and solutions:\n\n### Template Creation Issues\n\n**Serial console required:**\nMany cloud images need serial console configured.\n\n```bash\nqm set <vmid> --serial0 socket --vga serial0\n```\n\n**Boot order:**\n\n```bash\nqm set <vmid> --boot order=scsi0\n```\n\n### Network Issues\n\n**VLAN not working:**\n\n1. Check bridge is VLAN-aware:\n\n   ```bash\n   grep \"bridge-vlan-aware\" /etc/network/interfaces\n   ```\n\n2. Verify VLAN in bridge-vids:\n\n   ```bash\n   bridge vlan show\n   ```\n\n**MTU problems (CEPH):**\nEnsure MTU 9000 on storage networks:\n\n```bash\nip link show vmbr1 | grep mtu\n```\n\n### VM Won't Start\n\n1. Check QEMU guest agent:\n\n   ```bash\n   qm agent <vmid> ping\n   ```\n\n2. Review cloud-init logs (in VM):\n\n   ```bash\n   cloud-init status --wait\n   cat /var/log/cloud-init.log\n   ```\n\n3. Validate template exists:\n\n   ```bash\n   qm list | grep template\n   ```\n\nFor more issues, see [troubleshooting/](troubleshooting/) directory.\n\n## Best Practices\n\n1. **Always use templates** - Clone for consistency\n2. **SSH keys only** - Never use password auth\n3. **VLAN-aware bridges** - Enable for flexibility\n4. **MTU 9000 for storage** - Essential for CEPH performance\n5. **Serial console** - Required for most cloud images\n6. **Guest agent** - Enable for IP detection and graceful shutdown\n7. **Tag VMs** - Use meaningful tags for organization\n\n## Progressive Disclosure\n\nFor deeper knowledge:\n\n### Advanced Automation Workflows (from ProxSpray Analysis)\n\n- [Cluster Formation](workflows/cluster-formation.md) - Complete cluster automation with idempotency\n- [CEPH Deployment](workflows/ceph-deployment.md) - Automated CEPH storage deployment\n\n### Core Reference\n\n- [Cloud-Init patterns](reference/cloud-init-patterns.md) - Complete template creation guide\n- [Network configuration](reference/networking.md) - VLANs, bonds, routing, NAT\n- [API reference](reference/api-reference.md) - Proxmox API interactions\n- [Storage management](reference/storage-management.md) - CEPH, LVM, datastores\n- [QEMU guest agent](reference/qemu-guest-agent.md) - Integration and troubleshooting\n\n### Anti-Patterns & Common Mistakes\n\n- [Common Mistakes](anti-patterns/common-mistakes.md) - Real-world pitfalls from OpenTofu/Ansible deployments, template\n  creation, and remote backend configuration\n\n## Related Skills\n\n- **NetBox + PowerDNS Integration** - Automatic DNS for Proxmox VMs\n- **Ansible Best Practices** - Playbook patterns used in this cluster"
              }
            ]
          },
          {
            "name": "python-tools",
            "description": "Comprehensive Python development toolkit covering scripting (uv), code quality (ruff/pyright), and common patterns (JSON parsing)",
            "source": "./plugins/devops/python-tools",
            "category": "devops",
            "version": "1.0.0",
            "author": {
              "name": "basher83"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install python-tools@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [
              {
                "name": "/new-sdk-app",
                "description": "Create and setup a new Claude Agent SDK application (Python)",
                "path": "plugins/devops/python-tools/commands/new-sdk-app.md",
                "frontmatter": {
                  "description": "Create and setup a new Claude Agent SDK application (Python)",
                  "argument-hint": [
                    "project-name"
                  ]
                },
                "content": "You are tasked with helping the user create a new Claude Agent SDK application using Python. Follow these steps carefully:\n\n## Reference Documentation\n\nBefore starting, use the **claude-agent-sdk skill** to ensure you follow SDK best practices:\n\n```bash\n# Load the skill to access patterns and examples\n/skill claude-agent-sdk\n```\n\nThe skill provides:\n\n- SDK templates (assets/sdk-template.py)\n- Official examples (examples/)\n- Best practices and patterns (references/)\n- Validation checklist (assets/sdk-validation-checklist.md)\n\nAlso reference the official documentation:\n\n- Python SDK reference: <https://docs.claude.com/en/api/agent-sdk/python>\n\n**IMPORTANT**: Always check for and use the latest SDK version (targeting >= 0.1.6).\n\n## Gather Requirements\n\nIMPORTANT: Ask these questions one at a time. Wait for the user's response before asking the next question. This makes it easier for the user to respond.\n\nAsk the questions in this order (skip any that the user has already provided via arguments):\n\n1. **Project name** (ask first): \"What would you like to name your project?\"\n\n   - If $ARGUMENTS is provided, use that as the project name and skip this question\n   - Wait for response before continuing\n\n2. **Agent type** (ask second, but skip if #1 was sufficiently detailed): \"What kind of agent are you building? Some examples:\n\n   - Coding agent (SRE, security review, code review)\n   - Orchestrator with subagents (multi-agent workflows)\n   - Business agent (customer support, content creation)\n   - Custom agent (describe your use case)\"\n   - Wait for response before continuing\n\n3. **Starting point** (ask third): \"Would you like:\n\n   - A minimal query() example for simple tasks\n   - A ClaudeSDKClient example for multi-turn conversations\n   - An orchestrator with subagents\n   - Start from the SDK template (assets/sdk-template.py)\"\n   - Wait for response before continuing\n\n4. **Project structure** (ask fourth): \"What project structure would you prefer:\n\n   - Single-file uv script (self-contained with `# /// script` header)\n   - Standard Python project with pyproject.toml\"\n   - Wait for response before continuing\n\nAfter all questions are answered, proceed to create the setup plan.\n\n## Setup Plan\n\nBased on the user's answers, create a plan that includes:\n\n1. **Project initialization**:\n\n   - Create project directory (if it doesn't exist)\n   - **For uv scripts**: Create single Python file with `# /// script` header including `claude-agent-sdk` dependency\n   - **For standard projects**:\n     - Initialize with `pyproject.toml`\n     - Add `claude-agent-sdk` to dependencies\n     - Configure Python version requirements (>= 3.8)\n\n2. **Check for Latest Versions**:\n\n   - BEFORE installing, check PyPI for the latest version: <https://pypi.org/project/claude-agent-sdk/>\n   - Inform the user which version you're using (targeting >= 0.1.6)\n\n3. **SDK Installation**:\n\n   - **For uv scripts**: Dependencies specified in script header, no separate installation needed\n   - **For standard projects**:\n     - Install with `pip install claude-agent-sdk` or add to pyproject.toml\n     - After installation, verify with `pip show claude-agent-sdk`\n\n4. **Create starter files**:\n\n   Based on user's choice:\n\n   - **query() example**: Simple one-shot task (no conversation memory)\n   - **ClaudeSDKClient example**: Multi-turn conversation with context\n   - **Orchestrator**: Main orchestrator with programmatically registered subagents\n   - **SDK template**: Copy from `assets/sdk-template.py` and customize\n\n   All files should include:\n   - Proper imports (`claude_agent_sdk`, `anyio`)\n   - SDK best practices (system_prompt, allowed_tools, permission_mode)\n   - Error handling\n   - Clear comments explaining each part\n\n5. **Authentication setup**:\n\n   - Explain that the SDK uses local Claude Code authentication\n   - No `.env` files needed when running with Claude Code\n   - If running standalone, API key can be set via environment variable\n\n6. **Optional: Create .claude directory structure**:\n   - Offer to create `.claude/agents/` directory for subagent definitions\n   - Provide example agent markdown files if building an orchestrator\n\n## Implementation\n\nAfter gathering requirements and getting user confirmation on the plan:\n\n1. Check for latest SDK version on PyPI\n2. Execute the setup steps\n3. Create all necessary files based on project structure choice:\n   - **Uv script**: Single file with proper script header\n   - **Standard project**: pyproject.toml + source files\n4. Install dependencies if standard project (uv scripts handle deps automatically)\n5. Verify installed versions and inform the user\n6. Create a working example based on their starting point:\n   - Use patterns from the claude-agent-sdk skill\n   - Reference examples from `examples/` directory\n   - Follow SDK best practices\n7. Add helpful comments explaining SDK concepts:\n   - What `ClaudeAgentOptions` does\n   - Why `system_prompt=\"claude_code\"` for orchestrators\n   - Tool restrictions and permission modes\n   - Async runtime choice (anyio vs asyncio)\n8. **VERIFY THE CODE WORKS BEFORE FINISHING**:\n   - Verify imports are correct\n   - Check for syntax errors\n   - Validate SDK patterns match documentation\n   - Ensure agent names match if using orchestrator\n   - **DO NOT consider the setup complete until the code verifies successfully**\n\n## Verification\n\nAfter all files are created and dependencies are installed, launch the **agent-sdk-verifier-py** agent to validate that the Agent SDK application is properly configured and ready for use:\n\n1. Use the Task tool to launch the `agent-sdk-verifier-py` subagent\n2. The agent will check:\n   - SDK installation and configuration\n   - Proper imports and SDK patterns\n   - query() vs ClaudeSDKClient usage\n   - Orchestrator requirements (system_prompt, Task tool, agent registration)\n   - Permission and security settings\n   - Best practices adherence\n3. Review the verification report and address any issues before completing setup\n\n## Getting Started Guide\n\nOnce setup is complete and verified, provide the user with:\n\n1. **Next steps**:\n\n   - **For uv scripts**: Run with `uv run <script-name>.py` (automatically handles dependencies)\n   - **For standard projects**:\n     - Activate virtual environment if needed\n     - Run with `python main.py` or `python src/main.py`\n   - Authentication uses local Claude Code session (no API key setup needed)\n\n2. **Useful resources**:\n\n   - Python SDK reference: <https://docs.claude.com/en/api/agent-sdk/python>\n   - claude-agent-sdk skill: `/skill claude-agent-sdk` for patterns and examples\n   - Key concepts to explore:\n     - System prompts (preset vs custom)\n     - Permissions (permission_mode and callbacks)\n     - Tools (allowed_tools restrictions)\n     - MCP servers (custom tools)\n     - Subagents (programmatic registration)\n\n3. **Common next steps**:\n   - Customize the system prompt for your use case\n   - Add custom tools via SDK MCP servers (see `examples/mcp_calculator.py`)\n   - Configure permission callbacks for fine-grained control\n   - Create and register subagents programmatically\n   - Review examples in the skill: `examples/hooks.py`, `examples/streaming_mode.py`\n   - Validate changes with `assets/sdk-validation-checklist.md`\n\n## Important Notes\n\n- **ALWAYS USE LATEST SDK VERSION**: Check PyPI for the latest version (targeting >= 0.1.6)\n- **VERIFY CODE WORKS BEFORE FINISHING**:\n  - Verify imports are correct\n  - Check syntax\n  - Validate SDK patterns (query() vs ClaudeSDKClient, system_prompt, tools)\n  - Ensure agent names match if using orchestrator\n  - Launch agent-sdk-verifier-py for comprehensive validation\n  - Do NOT consider the task complete until verification passes\n- **USE THE CLAUDE-AGENT-SDK SKILL**: Reference patterns and examples from the skill\n- **FOLLOW SDK BEST PRACTICES**:\n  - Use `system_prompt=\"claude_code\"` for orchestrators\n  - Register agents programmatically via `agents={}`\n  - Include `\"Task\"` in orchestrator's allowed_tools\n  - Choose appropriate runtime (anyio.run or asyncio.run)\n  - Restrict tools to minimum needed per agent\n- Always check if directories/files already exist before creating them\n- Ensure all code examples are functional and include proper error handling\n- Use patterns compatible with the latest SDK version\n- Make the experience interactive and educational\n- **ASK QUESTIONS ONE AT A TIME** - Do not ask multiple questions in a single response\n\nBegin by asking the FIRST requirement question only. Wait for the user's answer before proceeding to the next question."
              },
              {
                "name": "/review-sdk-app",
                "description": "Review and validate a Claude Agent SDK application against best practices",
                "path": "plugins/devops/python-tools/commands/review-sdk-app.md",
                "frontmatter": {
                  "description": "Review and validate a Claude Agent SDK application against best practices",
                  "argument-hint": [
                    "path-to-app"
                  ]
                },
                "content": "# Review Claude Agent SDK Application\n\nYou are tasked with reviewing a Claude Agent SDK (Python) application to ensure\nit follows SDK best practices and official documentation patterns. Follow these\nsteps carefully:\n\n## Reference Documentation\n\nBefore starting, load the **claude-agent-sdk skill** to access patterns, examples, and the validation checklist:\n\n```bash\n# Load the skill for comprehensive SDK knowledge\n/skill claude-agent-sdk\n```\n\nThe skill provides:\n\n- **Validation checklist**: `assets/sdk-validation-checklist.md` (comprehensive review guide)\n- **SDK patterns**: `SKILL.md` and `references/` (official best practices)\n- **Working examples**: `examples/` (reference implementations)\n- **Template**: `assets/sdk-template.py` (ideal structure)\n\n## Review Approach\n\nYou have TWO options for reviewing SDK applications:\n\n### Option 1: Automated Validation (Recommended)\n\nLaunch the **agent-sdk-verifier-py** subagent for comprehensive automated review:\n\n```bash\n# The subagent will:\n# - Read all application files\n# - Check SDK patterns and configuration\n# - Validate against official documentation\n# - Provide detailed report with specific issues and recommendations\n```\n\n**Best for:**\n\n- Quick validation\n- New applications\n- Pre-deployment checks\n- Comprehensive coverage\n\n### Option 2: Manual Guided Review\n\nFollow the validation checklist step-by-step with guided assistance.\n\n**Best for:**\n\n- Learning SDK patterns\n- Understanding specific issues\n- Deep dive into SDK concepts\n- Educational reviews\n\n## Gather Information\n\nAsk the user (if not provided via $ARGUMENTS):\n\n1. **Application path**: \"What is the path to your SDK application?\"\n   - If $ARGUMENTS is provided, use that as the application path\n   - Wait for response before continuing\n\n2. **Review type**: \"Would you like:\n   - Automated validation (launch agent-sdk-verifier)\n   - Manual guided review (step-by-step checklist)\n   - Both (automated first, then deep dive on issues)\"\n   - Wait for response before continuing\n\n## Automated Validation Flow\n\nIf user chooses automated validation:\n\n1. **Launch verifier agent**:\n   - Use Task tool to launch `agent-sdk-verifier` subagent\n   - Provide the application path to the agent\n   - Wait for verification report\n\n2. **Review the report**:\n   - **Overall Status**: PASS | PASS WITH WARNINGS | FAIL\n   - **Critical Issues**: Must be fixed before deployment\n   - **Warnings**: Suboptimal patterns or improvements\n   - **Passed Checks**: Correctly configured elements\n   - **Recommendations**: Specific improvements with references\n\n3. **Address issues**:\n   - For each critical issue: explain the problem and provide fix\n   - For warnings: explain why the recommendation matters\n   - Reference specific skill documentation for context\n\n4. **Re-validate if changes made**:\n   - After fixes, offer to re-run validation\n   - Ensure all critical issues are resolved\n\n## Manual Guided Review Flow\n\nIf user chooses manual review, systematically work through the validation\nchecklist (`assets/sdk-validation-checklist.md`):\n\n### Section 1: Imports & Dependencies\n\nRead the application files and check:\n\n- [ ] Async runtime import (anyio or asyncio)\n- [ ] Claude SDK imports are accurate\n- [ ] UV script headers (if single-file script)\n\n**Ask user**: \"Found any issues with imports? (Y/N)\"\n\nIf yes, explain the issue and show correct pattern from skill examples.\n\n### Section 2: Async Runtime\n\nCheck:\n\n- [ ] Runtime execution (`anyio.run()` or `asyncio.run()`)\n- [ ] Async/await patterns are correct\n- [ ] Context managers for ClaudeSDKClient\n\n**Ask user**: \"Found any issues with async patterns? (Y/N)\"\n\n### Section 3: query() vs ClaudeSDKClient Choice\n\nCheck:\n\n- [ ] Correct approach for use case\n- [ ] Not using hooks/custom tools with query()\n\n**Ask user**: \"Is the query()/ClaudeSDKClient choice appropriate? (Y/N)\"\n\nIf no, explain when to use each approach (reference SKILL.md lines 29-44).\n\n### Section 4: Orchestrator Configuration (if applicable)\n\nCheck:\n\n- [ ] System prompt is `\"claude_code\"` for orchestrators\n- [ ] Task tool is included in allowed_tools\n- [ ] Agents are registered programmatically\n\n**Ask user**: \"Found any orchestrator configuration issues? (Y/N)\"\n\n### Section 5: Agent Definitions (if applicable)\n\nCheck:\n\n- [ ] Agent structure is correct (description, prompt, tools, model)\n- [ ] Agent names match between definition and usage\n- [ ] Tools are restricted to minimum needed\n\n**Ask user**: \"Found any agent definition issues? (Y/N)\"\n\n### Section 6: Permission Control\n\nCheck:\n\n- [ ] Permission strategy is appropriate\n- [ ] Permission mode is valid\n- [ ] Permission callback (if used) is correct\n\n**Ask user**: \"Found any permission issues? (Y/N)\"\n\n### Section 7: Hooks (if used)\n\nCheck:\n\n- [ ] Hooks ONLY used with ClaudeSDKClient\n- [ ] Hook types are supported (not using SessionStart, etc.)\n- [ ] Hook signature is correct\n- [ ] Hook output structure is valid\n\n**Ask user**: \"Found any hook issues? (Y/N)\"\n\n### Section 8: ClaudeSDKClient Usage (if applicable)\n\nCheck:\n\n- [ ] Context manager pattern is used\n- [ ] Query  receive_response flow\n- [ ] Interrupts (if used) are correct\n\n**Ask user**: \"Found any ClaudeSDKClient usage issues? (Y/N)\"\n\n### Section 9: Message Handling\n\nCheck:\n\n- [ ] Message types are checked correctly\n- [ ] TextBlock extraction is correct\n- [ ] ResultMessage handling\n\n**Ask user**: \"Found any message handling issues? (Y/N)\"\n\n### Section 10: Error Handling\n\nCheck:\n\n- [ ] API key validation (if running standalone)\n- [ ] Safe dictionary access\n- [ ] Async exception handling\n\n**Ask user**: \"Found any error handling issues? (Y/N)\"\n\n### Section 11: Settings & Configuration\n\nCheck:\n\n- [ ] setting_sources is configured appropriately\n- [ ] Model selection is appropriate\n- [ ] Budget limits (if needed)\n\n**Ask user**: \"Found any configuration issues? (Y/N)\"\n\n### Section 12: Best Practices\n\nCheck:\n\n- [ ] Follows DRY principle\n- [ ] Clear comments and documentation\n- [ ] Type hints are used\n- [ ] No anti-patterns\n\n**Ask user**: \"Found any best practice violations? (Y/N)\"\n\n### Manual Review Summary\n\nAfter completing all sections, provide:\n\n```markdown\n## Validation Summary\n\n###  Passed Checks:\n- [List of passed checks]\n\n###  Issues Found:\n- [List of issues with severity: CRITICAL | WARNING | INFO]\n\n###  Fixes Required:\n1. [Specific fix with file:line reference and code example]\n2. [Specific fix with file:line reference and code example]\n\n###  Overall Assessment:\n- **SDK Pattern Adherence**: [High/Medium/Low]\n- **Production Ready**: [Yes/No/With Fixes]\n- **Recommended Next Steps**: [Specific actions]\n```\n\n## Providing Fixes\n\nFor each issue identified:\n\n1. **Explain the problem**:\n   - Why it's an issue\n   - What SDK pattern is being violated\n   - Reference to skill documentation\n\n2. **Show the correct pattern**:\n   - Code example from skill examples or template\n   - Explain why this pattern is preferred\n   - Link to relevant skill reference\n\n3. **Provide specific fix**:\n   - Exact code change needed\n   - File and line reference\n   - Before/after comparison if helpful\n\n## Follow-up Actions\n\nAfter review:\n\n1. **Offer to implement fixes**:\n   - \"Would you like me to implement these fixes?\"\n   - If yes, make changes and re-validate\n\n2. **Suggest re-validation**:\n   - \"Would you like to run automated validation to confirm fixes?\"\n   - Launch agent-sdk-verifier-py if requested\n\n3. **Recommend next steps**:\n   - Additional features to consider\n   - Testing recommendations\n   - Deployment considerations\n\n## Important Notes\n\n- **USE THE VALIDATION CHECKLIST**: `assets/sdk-validation-checklist.md` is your comprehensive guide\n- **REFERENCE SKILL DOCUMENTATION**: Always link to specific skill files for context\n- **SHOW WORKING EXAMPLES**: Use examples from `examples/` directory\n- **BE SPECIFIC**: Provide file:line references and exact code changes\n- **EXPLAIN WHY**: Don't just identify issues, explain the SDK reasoning\n- **PRIORITIZE ISSUES**: CRITICAL (breaks functionality) > WARNING (suboptimal) > INFO (nice to have)\n- **VERIFY FIXES**: Re-validate after making changes\n- **USE AGENT-SDK-VERIFIER-PY**: Leverage automated validation for comprehensive coverage\n\n## Key SDK Patterns to Verify\n\nAlways check these common issues:\n\n1. **Orchestrator missing system_prompt**: Must use `\"claude_code\"`\n2. **Orchestrator missing Task tool**: Cannot delegate without it\n3. **Agent name mismatches**: Definition name must match usage\n4. **Hooks with query()**: Not supported, use ClaudeSDKClient\n5. **Custom tools with query()**: Not supported, use ClaudeSDKClient\n6. **Excessive tool permissions**: Restrict to minimum needed\n7. **Missing agent registration**: Use `agents={}` parameter\n8. **Wrong async runtime call**: Use `anyio.run()` or `asyncio.run()`\n9. **Missing context manager**: ClaudeSDKClient requires `async with`\n10. **Unsafe dictionary access**: Use `.get()` for optional fields\n\nBegin by asking about the application path (if not provided) and review type preference."
              },
              {
                "name": "/review-uv-script",
                "description": "Review uv Python script for PEP 723 compliance and best practices",
                "path": "plugins/devops/python-tools/commands/review-uv-script.md",
                "frontmatter": {
                  "description": "Review uv Python script for PEP 723 compliance and best practices",
                  "argument-hint": [
                    "script-path"
                  ],
                  "allowed-tools": "Read, Grep, Glob"
                },
                "content": "# UV Python Script Review\n\nReview the uv Python script at `$ARGUMENTS` against best practices.\n\n## Script to Review\n\n@$ARGUMENTS\n\n## Confidence Scoring\n\nRate each potential issue from 0-100:\n\n| Score | Meaning |\n|-------|---------|\n| 0-25 | Likely false positive or stylistic preference |\n| 26-50 | Minor nitpick, not explicitly in best practices |\n| 51-75 | Valid but low-impact issue |\n| 76-90 | Important issue requiring attention |\n| 91-100 | Critical bug or explicit best practice violation |\n\n**Only report issues with confidence  80.** Quality over quantity.\n\n## Review Categories\n\n### 1. PEP 723 Metadata Block (Critical)\n\n**Required elements:**\n\n- Has `# /// script` opening marker (exactly `/// script`, not `/// scripts` or `//`)\n- Has `# ///` closing marker\n- `requires-python` is specified (e.g., `>=3.11`)\n- `dependencies` array is present (even if empty)\n- Each TOML line starts with `#`\n\n**Forbidden patterns:**\n\n- `[tool.uv.metadata]` - Invalid field, causes runtime error\n- Custom top-level fields (`author`, `version`, `description`) - Only `requires-python` and `dependencies` allowed\n- Missing `#` prefix on TOML lines\n\n**Valid [tool.uv] usage** (without `.metadata`):\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = []\n# [tool.uv]\n# exclude-newer = \"2025-01-01T00:00:00Z\"  # Valid\n# ///\n```\n\n### 2. Shebang Line (Important)\n\n- Has proper shebang: `#!/usr/bin/env -S uv run --script`\n- Consider `--quiet` flag for production scripts\n- Shebang must be first line (before metadata block)\n\n### 3. Dependency Management (Important)\n\n**Version pinning:**\n\n- Use `>=X.Y.Z` for utilities (allows updates)\n- Use `==X.Y.Z` only for deployment scripts requiring reproducibility\n- No bare package names (`\"httpx\"`  `\"httpx>=0.27.0\"`)\n\n**Heavy dependencies flag:**\n\n- Flag `tensorflow`, `torch`, `transformers` - Too heavy for single-file scripts\n- Suggest using proper uv project instead\n\n### 4. Documentation (Medium)\n\n- Module docstring present after metadata block\n- Docstring includes: purpose, usage, examples\n- Metadata (team, author, version) in docstring, NOT in TOML\n\n### 5. Silent Failure Detection (Critical)\n\nHunt for error handling that hides failures:\n\n**Absolutely Forbidden:**\n\n- Empty `except:` blocks\n- `except Exception: pass` or `except: pass`\n- Catching exceptions without logging or re-raising\n- Returning `None`/default on error without indication\n\n**Scrutinize Each Handler:**\n\n- Does the except block catch only expected error types?\n- Could this catch block accidentally suppress unrelated errors?\n- Is the error logged with sufficient context?\n- Does the user receive clear, actionable feedback?\n\n**Common Python Silent Failure Patterns:**\n\n```python\n# BAD: Silent swallowing\ntry:\n    result = api_call()\nexcept:\n    result = None  # User has no idea it failed\n\n# BAD: Overly broad catch\ntry:\n    data = json.loads(response)\nexcept Exception:\n    pass  # Hides syntax errors, type errors, etc.\n\n# GOOD: Specific handling with feedback\ntry:\n    data = json.loads(response)\nexcept json.JSONDecodeError as e:\n    print(f\"Error: Invalid JSON response: {e}\", file=sys.stderr)\n    sys.exit(1)\n```\n\n### 6. Security Patterns (Critical)\n\n**Secrets Management:**\n\n- No hardcoded secrets (API keys, passwords, tokens, database URLs)\n- Use `os.getenv()` with validation for missing values\n- Consider keyring or Infisical for production\n\n**Command Injection:**\n\n- Flag `subprocess.run(..., shell=True)` with user input\n- Prefer list form: `subprocess.run([\"cmd\", arg1, arg2])`\n- Validate all user-provided arguments\n\n**Path Traversal:**\n\n- Flag paths containing `..`\n- Use `Path.resolve()` and `.relative_to()` for validation\n- Validate paths are within expected directories\n\n**JSON Security:**\n\n- **NEVER** use `eval()` for JSON parsing - use `json.loads()`\n- Use `json.dumps()` for serialization (prevents injection)\n- Always specify `encoding=\"utf-8\"` for file operations\n\n**Network Security:**\n\n- HTTPS-only for external requests\n- Certificate verification enabled (`verify=True`)\n- Timeouts on all external calls\n\n### 7. Type Design Analysis (Medium)\n\n**Type Hints Quality (1-10):**\n\n- Are parameters typed?\n- Are return types specified?\n- Are complex types properly annotated (Optional, Union, TypedDict)?\n\n**Common Issues:**\n\n- `def foo(data):`  `def foo(data: dict[str, Any]) -> bool:`\n- Missing `Optional[]` for nullable parameters\n- Using `Any` when specific type is known\n\n**Suppression patterns:**\n\n- Check `# type: ignore` comments - are they justified?\n- Check `# noqa` comments - are they necessary?\n\n### 8. Code Quality (Medium)\n\n**Clarity over brevity:**\n\n- Avoid nested ternary operators\n- Avoid overly dense one-liners\n- Functions do one thing\n- Variable names are descriptive\n\n**Script complexity:**\n\n- Script exceeds 500 lines  Should be a uv project\n- 15+ dependencies  Should be a uv project\n- Multiple modules needed  Should be a uv project\n\n**Platform compatibility:**\n\n- Platform-specific imports without guards (e.g., `import pwd` on Windows)\n- Use `sys.platform` checks for platform-specific code\n\n### 9. External Operations (Important)\n\n**File operations:**\n\n- Always use `encoding=\"utf-8\"` for `open()`\n- Check file size before reading large files\n- Use context managers (`with` statements)\n\n**Subprocess calls:**\n\n- Include `timeout` parameter\n- Use `capture_output=True` for error handling\n- Check `returncode` or use `check=True`\n\n**HTTP requests:**\n\n- Include timeout: `httpx.get(url, timeout=10.0)`\n- Call `response.raise_for_status()`\n- Handle specific exceptions (HTTPStatusError, RequestError)\n\n## Output Format\n\n```markdown\n## Review: [filename]\n\n**Overall: [PASS/NEEDS WORK]** - [Brief assessment]\n\n### Critical Issues (confidence 90)\n\n| Issue | Location | Confidence | Fix |\n|-------|----------|------------|-----|\n| [Description] | `file.py:42` | 95 | [Specific fix] |\n\n### Important Issues (confidence 80-89)\n\n| Issue | Location | Confidence | Fix |\n|-------|----------|------------|-----|\n| [Description] | `file.py:15` | 85 | [Specific fix] |\n\n### Suggestions (confidence 70-79, optional)\n\n- [Suggestion with rationale]\n\n### Strengths\n\n- [What the script does well]\n\n## Recommended Action\n\n1. [First priority fix]\n2. [Second priority fix]\n```\n\n## Anti-Pattern Quick Reference\n\n| Anti-Pattern | Detection | Severity |\n|--------------|-----------|----------|\n| `[tool.uv.metadata]` | In script block | Critical |\n| Custom TOML fields | `author`, `version` at top level | Critical |\n| Wrong marker | `/// scripts`, `//`, missing closer | Critical |\n| Missing `#` prefix | TOML lines without `#` | Critical |\n| `eval()` for JSON | `eval(json_string)` | Critical |\n| Hardcoded secrets | API keys, passwords in code | Critical |\n| Bare `except:` | Empty or pass-only catch | Critical |\n| `shell=True` + user input | Command injection risk | Critical |\n| Path with `..` | Path traversal risk | Critical |\n| Missing shebang | No `#!/usr/bin/env` line | Important |\n| Unpinned deps | `\"httpx\"` vs `\"httpx>=0.27.0\"` | Important |\n| Heavy deps | tensorflow, torch in script | Important |\n| Broad `except Exception` | Without specific handling | Important |\n| Missing `requires-python` | Not in metadata block | Important |\n| No timeout | External calls without timeout | Important |\n| Missing `encoding` | `open()` without encoding | Important |\n| No type hints | Functions without annotations | Medium |\n| Over 500 lines | Script too large | Medium |\n| Platform-specific | `import pwd` without guard | Medium |\n\n## Review Principles\n\n1. **Be thorough but filter aggressively** - Report only high-confidence issues\n2. **Provide actionable feedback** - Every issue needs a specific fix\n3. **Include line numbers** - `file.py:42` format for all issues\n4. **Acknowledge good patterns** - Note what's done well\n5. **Consider maintenance burden** - Suggest pragmatic improvements\n\n## Tooling Recommendations\n\nAfter manual review, suggest running:\n\n```bash\n# Lint and format\nruff check --fix $ARGUMENTS\nruff format $ARGUMENTS\n\n# Type check\npyright $ARGUMENTS\n\n# Validate PEP 723 metadata\nuv run --script $ARGUMENTS --help  # Quick syntax check\n```"
              }
            ],
            "skills": [
              {
                "name": "claude-agent-sdk",
                "description": "This skill should be used when building applications with the Claude Agent SDK (Python). Use for creating orchestrators with subagents, configuring agents programmatically, setting up hooks and permissions, and following SDK best practices. Trigger when implementing agentic workflows, multi-agent systems, or SDK-based automation.",
                "path": "plugins/devops/python-tools/skills/claude-agent-sdk/SKILL.md",
                "frontmatter": {
                  "name": "claude-agent-sdk",
                  "description": "This skill should be used when building applications with the Claude Agent SDK (Python). Use for creating orchestrators with subagents, configuring agents programmatically, setting up hooks and permissions, and following SDK best practices. Trigger when implementing agentic workflows, multi-agent systems, or SDK-based automation."
                },
                "content": "# Claude Agent SDK\n\nBuild production-ready applications using the Claude Agent SDK for Python.\n\n**SDK Version:** This skill targets `claude-agent-sdk>=0.1.6` (Python)\n\n## Overview\n\nThis skill provides patterns, examples, and best practices for building SDK applications that orchestrate Claude agents.\n\n## Quick Start\n\nCopy the template and customize:\n\n```bash\ncp assets/sdk-template.py my-app.py\n# Edit my-app.py - customize agents and workflow\nchmod +x my-app.py\n./my-app.py\n```\n\nThe template includes proper uv script headers, agent definitions, and async patterns.\n\n## Choosing Between query() and ClaudeSDKClient\n\nThe SDK provides two ways to interact with Claude: the `query()` function for simple one-shot tasks, and `ClaudeSDKClient` for continuous conversations.\n\n### Quick Comparison\n\n| Feature | `query()` | `ClaudeSDKClient` |\n|---------|-----------|-------------------|\n| **Conversation memory** | No - each call is independent | Yes - maintains context across queries |\n| **Use case** | One-off tasks, single questions | Multi-turn conversations, complex workflows |\n| **Complexity** | Simple - one function call | More setup - context manager pattern |\n| **Hooks support** | No | Yes |\n| **Custom tools** | No | Yes |\n| **Interrupts** | No | Yes - can interrupt ongoing operations |\n| **Session control** | New session each time | Single persistent session |\n\n> **Important:** Hooks and custom tools (SDK MCP servers) are **only supported with `ClaudeSDKClient`**, not with `query()`. If you need hooks or custom tools, you must use `ClaudeSDKClient`.\n>\n> **Note on Async Runtimes:** The SDK works with both `asyncio` and `anyio`. The official SDK examples prefer `anyio.run()` for better async library compatibility, but `asyncio.run()` works equally well. Use whichever fits your project's async runtime.\n\n### When to Use query()\n\nUse `query()` for simple, independent tasks where you don't need conversation history:\n\n```python\nimport anyio  # or: import asyncio\nfrom claude_agent_sdk import query, ClaudeAgentOptions\n\nasync def analyze_file():\n    \"\"\"One-shot file analysis - no conversation needed.\"\"\"\n    options = ClaudeAgentOptions(\n        system_prompt=\"You are a code analyzer\",\n        allowed_tools=[\"Read\", \"Grep\", \"Glob\"],\n        permission_mode=\"acceptEdits\"\n    )\n\n    async for message in query(\n        prompt=\"Analyze /path/to/file.py for bugs\",\n        options=options\n    ):\n        print(message)\n\nanyio.run(analyze_file)  # or: asyncio.run(analyze_file())\n```\n\n**Best for:**\n\n- Single analysis tasks\n- Independent file operations\n- Quick questions without follow-up\n- Scripts that run once and exit\n\n**Key limitation:** Each `query()` call creates a new session with no memory of previous calls.\n\n### When to Use ClaudeSDKClient\n\nUse `ClaudeSDKClient` when you need conversation context across multiple interactions:\n\n```python\nimport anyio  # or: import asyncio\nfrom claude_agent_sdk import ClaudeSDKClient, ClaudeAgentOptions, AssistantMessage, TextBlock\n\nasync def interactive_debugging():\n    \"\"\"Multi-turn debugging conversation with context.\"\"\"\n    options = ClaudeAgentOptions(\n        system_prompt=\"You are a debugging assistant\",\n        allowed_tools=[\"Read\", \"Grep\", \"Bash\"],\n        permission_mode=\"acceptEdits\"\n    )\n\n    async with ClaudeSDKClient(options=options) as client:\n        # First query\n        await client.query(\"Find all TODO comments in /path/to/project\")\n        async for message in client.receive_response():\n            if isinstance(message, AssistantMessage):\n                for block in message.content:\n                    if isinstance(block, TextBlock):\n                        print(f\"Claude: {block.text}\")\n\n        # Follow-up - Claude remembers the TODOs found above\n        await client.query(\"Now prioritize them by complexity\")\n        async for message in client.receive_response():\n            if isinstance(message, AssistantMessage):\n                for block in message.content:\n                    if isinstance(block, TextBlock):\n                        print(f\"Claude: {block.text}\")\n\n        # Another follow-up - still in same conversation\n        await client.query(\"Create a plan to address the top 3\")\n        async for message in client.receive_response():\n            if isinstance(message, AssistantMessage):\n                for block in message.content:\n                    if isinstance(block, TextBlock):\n                        print(f\"Claude: {block.text}\")\n\nanyio.run(interactive_debugging)  # or: asyncio.run(interactive_debugging())\n```\n\n**Best for:**\n\n- Multi-turn conversations\n- Interactive workflows\n- Tasks requiring context from previous responses\n- Applications with interrupt capability\n- Orchestrators managing complex workflows\n\n**Key advantage:** Claude remembers all previous queries and responses in the session.\n\n**See:** `examples/streaming_mode.py` - Comprehensive ClaudeSDKClient examples with all patterns\n\n### Advanced: Interrupts with ClaudeSDKClient\n\nOnly `ClaudeSDKClient` supports interrupting ongoing operations:\n\n```python\nimport anyio  # or: import asyncio\nfrom claude_agent_sdk import ClaudeSDKClient\n\nasync def interruptible_task():\n    async with ClaudeSDKClient() as client:\n        await client.query(\"Run a long analysis on /large/codebase\")\n\n        # Start processing in background\n        async with anyio.create_task_group() as tg:\n            tg.start_soon(process_messages, client)\n\n            # Simulate user interrupt after 5 seconds\n            await anyio.sleep(5)\n            await client.interrupt()\n\nasync def process_messages(client):\n    async for message in client.receive_response():\n        print(message)\n\nanyio.run(interruptible_task)  # or: asyncio.run(interruptible_task())\n```\n\n### Quick Decision Guide\n\n**Use `query()` if:**\n\n- Task is self-contained\n- No follow-up questions needed\n- Each execution is independent\n- Simpler code is preferred\n\n**Use `ClaudeSDKClient` if:**\n\n- Need conversation memory\n- Building interactive workflows\n- Require interrupt capability\n- Managing complex multi-step processes\n- Working with orchestrators and subagents\n\n## Core Patterns\n\n### 1. Orchestrator with Subagents\n\nDefine a main orchestrator that delegates work to specialized subagents.\n\n**Critical requirements:**\n\n- Orchestrator must use `system_prompt={\"type\": \"preset\", \"preset\": \"claude_code\"}` (provides Task tool knowledge)\n- Register agents programmatically via `agents={}` parameter (SDK best practice)\n- Orchestrator must include `\"Task\"` in `allowed_tools`\n- Match agent names exactly between definition and usage\n\n**Example:**\n\n```python\nfrom claude_agent_sdk import AgentDefinition, ClaudeAgentOptions\n\noptions = ClaudeAgentOptions(\n    system_prompt={\"type\": \"preset\", \"preset\": \"claude_code\"},  # REQUIRED for orchestrators\n    allowed_tools=[\"Bash\", \"Task\", \"Read\", \"Write\"],\n    agents={\n        \"analyzer\": AgentDefinition(\n            description=\"Analyzes code structure and patterns\",\n            prompt=\"You are a code analyzer...\",\n            tools=[\"Read\", \"Grep\", \"Glob\"],\n            model=\"sonnet\"\n        ),\n        \"fixer\": AgentDefinition(\n            description=\"Fixes identified issues\",\n            prompt=\"You are a code fixer...\",\n            tools=[\"Read\", \"Edit\", \"Bash\"],\n            model=\"sonnet\"\n        )\n    },\n    permission_mode=\"acceptEdits\",\n    model=\"claude-sonnet-4-5\"\n)\n```\n\n**See:**\n\n- `references/agent-patterns.md` - Complete agent definition patterns\n- `examples/agents.py` - Official SDK agent examples with different agent types\n\n### 2. System Prompt Configuration\n\nChoose the appropriate system prompt pattern:\n\n```python\n# Orchestrator (use claude_code preset) - dict format (official examples prefer this)\nsystem_prompt={\"type\": \"preset\", \"preset\": \"claude_code\"}\n\n# Shorthand format (equivalent, but less explicit)\nsystem_prompt=\"claude_code\"\n\n# Custom behavior\nsystem_prompt=\"You are a Python expert...\"\n\n# Extend preset with additional instructions\nsystem_prompt={\n    \"type\": \"preset\",\n    \"preset\": \"claude_code\",\n    \"append\": \"Additional domain-specific instructions\"\n}\n```\n\n**Note:** The shorthand `system_prompt=\"claude_code\"` is equivalent to `{\"type\": \"preset\", \"preset\": \"claude_code\"}`. Both are valid. Official examples prefer the dict format for explicitness.\n\n**See:**\n\n- `references/system-prompts.md` - Complete system prompt documentation\n- `examples/system_prompt.py` - Official SDK system prompt examples\n\n### 3. Tool Restrictions\n\nLimit subagent tools to minimum needed:\n\n```python\n# Read-only analyzer\ntools=[\"Read\", \"Grep\", \"Glob\"]\n\n# Code modifier\ntools=[\"Read\", \"Edit\", \"Bash\"]\n\n# Test runner\ntools=[\"Bash\", \"Read\"]\n```\n\n**See:** `references/agent-patterns.md` for common tool combinations\n\n### 4. Hooks\n\nIntercept SDK events to control behavior:\n\n```python\nfrom claude_agent_sdk import HookMatcher\n\noptions = ClaudeAgentOptions(\n    hooks={\n        \"PreToolUse\": [\n            HookMatcher(matcher=\"Bash\", hooks=[check_bash_command])\n        ],\n        \"PostToolUse\": [\n            HookMatcher(matcher=\"Bash\", hooks=[review_output])\n        ]\n    }\n)\n```\n\n**See:**\n\n- `references/hooks-guide.md` - Complete hook patterns documentation\n- `examples/hooks.py` - Official SDK hook examples with all hook types\n\n### 5. Permission Callbacks\n\nFine-grained control over tool usage:\n\n```python\nasync def permission_callback(tool_name, input_data, context):\n    # Allow read operations\n    if tool_name in [\"Read\", \"Grep\", \"Glob\"]:\n        return PermissionResultAllow()\n\n    # Block dangerous commands\n    if tool_name == \"Bash\" and \"rm -rf\" in input_data.get(\"command\", \"\"):\n        return PermissionResultDeny(message=\"Dangerous command\")\n\n    return PermissionResultAllow()\n\noptions = ClaudeAgentOptions(\n    can_use_tool=permission_callback,\n    permission_mode=\"default\"\n)\n```\n\n**See:**\n\n- `references/tool-permissions.md` - Complete permission patterns and decision guide\n- `examples/tool_permission_callback.py` - Official SDK permission callback example\n\n## Workflow Templates\n\n### Building an Orchestrator\n\nFollow these steps to build an effective orchestrator:\n\n**1. Define agent purposes**\n\n- What specialized tasks need delegation?\n- What tools does each agent need?\n- What constraints should apply?\n\n**2. Create agent definitions**\n\n```python\nagents={\n    \"agent-name\": AgentDefinition(\n        description=\"When to use this agent\",\n        prompt=\"Agent's role and behavior\",\n        tools=[\"Tool1\", \"Tool2\"],\n        model=\"sonnet\"\n    )\n}\n```\n\n**3. Configure orchestrator**\n\n```python\noptions = ClaudeAgentOptions(\n    system_prompt={\"type\": \"preset\", \"preset\": \"claude_code\"},  # CRITICAL\n    allowed_tools=[\"Bash\", \"Task\", \"Read\", \"Write\"],\n    agents=agents,\n    permission_mode=\"acceptEdits\"\n)\n```\n\n**4. Implement workflow**\n\n```python\nasync with ClaudeSDKClient(options=options) as client:\n    await client.query(\"Use 'agent-name' to perform task\")\n\n    async for message in client.receive_response():\n        # Process responses\n        pass\n```\n\n**See:** `examples/basic-orchestrator.py` for complete working example\n\n### Loading Agents from Files\n\nWhile programmatic registration is recommended, agent content can be stored in markdown files:\n\n```python\nimport yaml\n\ndef load_agent_definition(path: str) -> AgentDefinition:\n    \"\"\"Load agent from markdown file with YAML frontmatter.\"\"\"\n    with open(path) as f:\n        content = f.read()\n\n    parts = content.split(\"---\")\n    frontmatter = yaml.safe_load(parts[1])\n    prompt = parts[2].strip()\n\n    # Parse tools (comma-separated string or array)\n    tools = frontmatter.get(\"tools\", [])\n    if isinstance(tools, str):\n        tools = [t.strip() for t in tools.split(\",\")]\n\n    return AgentDefinition(\n        description=frontmatter[\"description\"],\n        prompt=prompt,\n        tools=tools,\n        model=frontmatter.get(\"model\", \"inherit\")\n    )\n\n# Load and register programmatically\nagent = load_agent_definition(\".claude/agents/my-agent.md\")\noptions = ClaudeAgentOptions(agents={\"my-agent\": agent})\n```\n\n**See:** `references/agent-patterns.md` for complete loading pattern\n\n## Common Anti-Patterns\n\nAvoid these common mistakes:\n\n** Missing orchestrator system prompt**\n\n```python\n# Orchestrator won't know how to use Task tool\noptions = ClaudeAgentOptions(agents={...})\n```\n\n** Correct orchestrator configuration**\n\n```python\noptions = ClaudeAgentOptions(\n    system_prompt=\"claude_code\",\n    agents={...}\n)\n```\n\n** Mismatched agent names**\n\n```python\nagents={\"investigator\": AgentDefinition(...)}\nawait client.query(\"Use 'markdown-investigator'...\")  # Wrong name\n```\n\n** Exact name matching**\n\n```python\nagents={\"investigator\": AgentDefinition(...)}\nawait client.query(\"Use 'investigator'...\")  # Matches\n```\n\n** Tool/prompt mismatch**\n\n```python\nsystem_prompt=\"Fix bugs you find\"\nallowed_tools=[\"Read\", \"Grep\"]  # Can't fix, only read\n```\n\n** Aligned tools and behavior**\n\n```python\nsystem_prompt=\"Analyze code for bugs\"\nallowed_tools=[\"Read\", \"Grep\", \"Glob\"]\n```\n\n**See:** `references/best-practices.md` for complete anti-patterns list\n\n## Resources\n\n### references/\n\nIn-depth documentation loaded as needed:\n\n- `api-reference.md` - Complete Python SDK API reference (types, functions, examples)\n- `agent-patterns.md` - Agent definition patterns, tool restrictions, best practices\n- `subagents.md` - Comprehensive subagent patterns and SDK integration\n- `system-prompts.md` - System prompt configuration (preset, custom, append)\n- `hooks-guide.md` - Hook patterns for all hook types with examples\n- `tool-permissions.md` - Permission callback patterns and examples\n- `best-practices.md` - SDK best practices, anti-patterns, debugging tips\n- `custom-tools.md` - Creating custom tools with SDK MCP servers (Python-only)\n- `sessions.md` - Session management and resumption patterns (Python-only)\n- `skills.md` - Using Agent Skills with the SDK (Python-only)\n- `slash-commands.md` - Slash commands and custom command creation (Python-only)\n\n### examples/\n\nReady-to-run code examples from official SDK:\n\n**Getting Started:**\n\n- `quick_start.py` - Basic query() usage and message handling (start here!)\n- `basic-orchestrator.py` - Complete orchestrator with analyzer and fixer subagents\n\n**Core Patterns:**\n\n- `agents.py` - Programmatic agent definitions with different agent types\n- `hooks.py` - Comprehensive hook patterns (PreToolUse, PostToolUse, UserPromptSubmit, etc.)\n- `system_prompt.py` - System prompt patterns (preset, custom, append)\n- `streaming_mode.py` - Complete ClaudeSDKClient patterns with multi-turn conversations\n\n**Advanced Features:**\n\n- `mcp_calculator.py` - Custom tools with SDK MCP server (in-process tool server)\n- `tool_permission_callback.py` - Permission callbacks with logging and control\n- `setting_sources.py` - Settings isolation and loading (user/project/local)\n- `plugin_example.py` - Using plugins with the SDK (relevant for plugin marketplace!)\n\n### assets/\n\nTemplates and validation tools:\n\n- `sdk-template.py` - Project template with uv script headers and agent structure\n- `sdk-validation-checklist.md` - Comprehensive checklist for validating SDK applications against best practices\n\n## When to Use This Skill\n\nUse this skill when:\n\n- Creating new Claude Agent SDK applications\n- Building orchestrators with multiple subagents\n- Implementing programmatic agent definitions\n- Configuring hooks or permission callbacks\n- Validating/reviewing SDK code (use `assets/sdk-validation-checklist.md`)\n- Migrating from filesystem agent discovery to programmatic registration\n- Debugging SDK applications (agent not found, Task tool not working)\n- Following SDK best practices\n\nDo not use for:\n\n- Claude Code slash commands or skills (different system)\n- Direct API usage without SDK\n- Non-Python implementations (TypeScript SDK has different patterns)\n\n## Next Steps\n\n### For Beginners\n\n1. Start with `examples/quick_start.py` - Learn basic query() usage\n2. Try `assets/sdk-template.py` - Template for new projects\n3. Review `examples/basic-orchestrator.py` - See orchestrator pattern\n\n### For Intermediate Users\n\n1. Explore core patterns:\n   - `examples/agents.py` - Agent definitions\n   - `examples/system_prompt.py` - System prompt patterns\n   - `examples/streaming_mode.py` - Multi-turn conversations\n   - `examples/hooks.py` - Hook patterns\n\n### For Advanced Users\n\n1. Study advanced features:\n   - `examples/tool_permission_callback.py` - Permission control\n   - `examples/mcp_calculator.py` - Custom tools\n   - `examples/setting_sources.py` - Settings management\n   - `examples/plugin_example.py` - Plugin integration\n\n### Validation & Quality\n\n1. Validate your code with `assets/sdk-validation-checklist.md`\n2. Review against best practices in `references/best-practices.md`\n\n### Reference Documentation\n\n1. Consult `references/` as needed for detailed patterns"
              },
              {
                "name": "python-code-quality",
                "description": "Python code quality tooling with ruff and pyright. Use when setting up linting, formatting, type checking, configuring ruff or pyright, or establishing code quality standards.\n",
                "path": "plugins/devops/python-tools/skills/python-code-quality/SKILL.md",
                "frontmatter": {
                  "name": "python-code-quality",
                  "description": "Python code quality tooling with ruff and pyright. Use when setting up linting, formatting, type checking, configuring ruff or pyright, or establishing code quality standards.\n"
                },
                "content": "# Python Code Quality with Ruff and Pyright\n\nModern Python code quality tooling using ruff (linting + formatting) and pyright (type checking).\n\n## Quick Start\n\n### Install Tools\n\n```bash\n# Using uv (recommended)\nuv add --dev ruff pyright\n\n# Using pip\npip install ruff pyright\n```\n\n### Run Quality Checks\n\n```bash\n# Format and lint with ruff\nruff check --fix .\nruff format .\n\n# Type check with pyright\npyright\n```\n\n## When to Use This Skill\n\nUse this skill when:\n\n- Setting up linting and formatting for a Python project\n- Configuring type checking\n- Establishing code quality standards for a team\n- Integrating quality checks into pre-commit or CI/CD\n- Migrating from black/flake8/mypy to ruff/pyright\n\n## Ruff: All-in-One Linter and Formatter\n\nRuff combines the functionality of flake8, black, isort, and more:\n\n**Benefits:**\n\n- 10-100x faster than alternatives\n- Drop-in replacement for black, flake8, isort\n- Single tool configuration\n- Auto-fix for many violations\n\n**Configuration:** See `reference/ruff-configuration.md`\n\n## Pyright: Fast Type Checker\n\nPyright provides static type checking for Python:\n\n**Benefits:**\n\n- Faster than mypy\n- Better editor integration (VS Code, etc.)\n- Incremental type checking\n- Configurable strictness\n\n**Configuration:** See `reference/pyright-configuration.md`\n\n## Recommended Workflow\n\n1. **Pre-commit Hooks** - Run quality checks before each commit\n   - See: `patterns/pre-commit-integration.md`\n\n2. **CI/CD Quality Gates** - Block merges on quality failures\n   - See: `patterns/ci-cd-quality-gates.md`\n\n3. **Editor Integration** - Real-time feedback while coding\n   - See: `workflows/quality-workflow.md`\n\n## Configuration Templates\n\nGeneric starter configs in `examples/`:\n\n- `pyrightconfig-starter.json` - Minimal type checking\n- `pyrightconfig-strict.json` - Strict type checking\n- `ruff-minimal.toml` - Basic linting + formatting\n- `ruff-comprehensive.toml` - Full-featured config\n\n## Helper Tools\n\n- `tools/python_formatter.py` - Batch format Python files\n- `tools/python_ruff_checker.py` - Check code quality\n\n## Ruff vs Alternatives\n\n| Feature | Ruff | Black + Flake8 + isort |\n|---------|------|------------------------|\n| Speed |  |  |\n| Configuration | Single file | Multiple files |\n| Auto-fix |  | Partial |\n| Formatting |  | Black only |\n| Import sorting |  | isort only |\n\n## Pyright vs mypy\n\n| Feature | Pyright | mypy |\n|---------|---------|------|\n| Speed |  |  |\n| VS Code integration | Native | Extension |\n| Configuration | JSON | INI/TOML |\n| Incremental checking |  |  |\n\n## Common Patterns\n\n### Ignore Specific Lines\n\n```python\n# Ruff\nx = 1  # noqa: F841  # Unused variable\n\n# Pyright\nx = 1  # type: ignore\n```\n\n### Configure Per-Directory\n\n```toml\n# ruff.toml\n[tool.ruff]\nexclude = [\"migrations/\", \"scripts/\"]\n\n[tool.ruff.lint]\nselect = [\"E\", \"F\", \"W\"]\n```\n\n## Next Steps\n\n1. Choose config template from `examples/`\n2. Set up pre-commit hooks: `patterns/pre-commit-integration.md`\n3. Add CI/CD quality gates: `patterns/ci-cd-quality-gates.md`\n4. Configure editor integration: `workflows/quality-workflow.md`\n\n## Reference Documentation\n\n- `reference/ruff-configuration.md` - Complete ruff configuration guide\n- `reference/ruff-linting-settings.md` - Linting rule categories\n- `reference/ruff-formatting-settings.md` - Formatting options\n- `reference/pyright-configuration.md` - Pyright setup and configuration"
              },
              {
                "name": "python-json-parsing",
                "description": "Python JSON parsing best practices covering performance optimization (orjson/msgspec), handling large files (streaming/JSONL), security (injection prevention), and advanced querying (JSONPath/JMESPath). Use when working with JSON data, parsing APIs, handling large JSON files, or optimizing JSON performance.\n",
                "path": "plugins/devops/python-tools/skills/python-json-parsing/SKILL.md",
                "frontmatter": {
                  "name": "python-json-parsing",
                  "description": "Python JSON parsing best practices covering performance optimization (orjson/msgspec), handling large files (streaming/JSONL), security (injection prevention), and advanced querying (JSONPath/JMESPath). Use when working with JSON data, parsing APIs, handling large JSON files, or optimizing JSON performance.\n"
                },
                "content": "# Python JSON Parsing Best Practices\n\nComprehensive guide to JSON parsing in Python with focus on performance, security, and scalability.\n\n## Quick Start\n\n### Basic JSON Parsing\n\n```python\nimport json\n\n# Parse JSON string\ndata = json.loads('{\"name\": \"Alice\", \"age\": 30}')\n\n# Parse JSON file\nwith open(\"data.json\", \"r\", encoding=\"utf-8\") as f:\n    data = json.load(f)\n\n# Write JSON file\nwith open(\"output.json\", \"w\", encoding=\"utf-8\") as f:\n    json.dump(data, f, indent=2)\n```\n\n**Key Rule:** Always specify `encoding=\"utf-8\"` when reading/writing files.\n\n## When to Use This Skill\n\nUse this skill when:\n\n- Working with JSON APIs or data interchange\n- Optimizing JSON performance in high-throughput applications\n- Handling large JSON files (> 100MB)\n- Securing applications against JSON injection\n- Extracting data from complex nested JSON structures\n\n## Performance: Choose the Right Library\n\n### Library Comparison (10,000 records benchmark)\n\n| Library | Serialize (s) | Deserialize (s) | Best For |\n|---------|---------------|-----------------|----------|\n| **orjson** | 0.42 | 1.27 | FastAPI, web APIs (3.9x faster) |\n| **msgspec** | 0.49 | 0.93 | Maximum performance (1.7x faster deserialization) |\n| **json** (stdlib) | 1.62 | 1.62 | Universal compatibility |\n| **ujson** | 1.41 | 1.85 | Drop-in replacement (2x faster) |\n\n**Recommendation:**\n\n- Use **orjson** for FastAPI/web APIs (native support, fastest serialization)\n- Use **msgspec** for data pipelines (fastest overall, typed validation)\n- Use **json** when compatibility is critical\n\n### Installation\n\n```bash\n# High-performance libraries\npip install orjson msgspec ujson\n\n# Advanced querying\npip install jsonpath-ng jmespath\n\n# Streaming large files\npip install ijson\n\n# Schema validation\npip install jsonschema\n```\n\n## Large Files: Streaming Strategies\n\nFor files > 100MB, avoid loading into memory.\n\n### Strategy 1: JSONL (JSON Lines)\n\nConvert large JSON arrays to line-delimited format:\n\n```python\n# Stream process JSONL\nwith open(\"large.jsonl\", \"r\") as infile, open(\"output.jsonl\", \"w\") as outfile:\n    for line in infile:\n        obj = json.loads(line)\n        obj[\"processed\"] = True\n        outfile.write(json.dumps(obj) + \"\\n\")\n```\n\n### Strategy 2: Streaming with ijson\n\n```python\nimport ijson\n\n# Process large JSON without loading into memory\nwith open(\"huge.json\", \"rb\") as f:\n    for item in ijson.items(f, \"products.item\"):\n        process(item)  # Handle one item at a time\n```\n\nSee: `patterns/streaming-large-json.md`\n\n## Security: Prevent JSON Injection\n\n**Critical Rules:**\n\n1. Always use `json.loads()`, never `eval()`\n2. Validate input with `jsonschema`\n3. Sanitize user input before serialization\n4. Escape special characters (`\"` and `\\`)\n\n**Vulnerable Code:**\n\n```python\n# NEVER DO THIS\nusername = request.GET['username']  # User input: admin\", \"role\": \"admin\njson_string = f'{{\"user\":\"{username}\",\"role\":\"user\"}}'\n# Result: privilege escalation\n```\n\n**Secure Code:**\n\n```python\n# Use json.dumps for serialization\ndata = {\"user\": username, \"role\": \"user\"}\njson_string = json.dumps(data)  # Properly escaped\n```\n\nSee: `anti-patterns/security-json-injection.md`, `anti-patterns/eval-usage.md`\n\n## Advanced: JSONPath for Complex Queries\n\nExtract data from nested JSON without complex loops:\n\n```python\nimport jsonpath_ng as jp\n\ndata = {\n    \"products\": [\n        {\"name\": \"Apple\", \"price\": 12.88},\n        {\"name\": \"Peach\", \"price\": 27.25}\n    ]\n}\n\n# Filter by price\nquery = jp.parse(\"products[?price>20].name\")\nresults = [match.value for match in query.find(data)]\n# Output: [\"Peach\"]\n```\n\n**Key Operators:**\n\n- `$` - Root selector\n- `..` - Recursive descendant\n- `*` - Wildcard\n- `[?<predicate>]` - Filter (e.g., `[?price > 20]`)\n- `[start:end:step]` - Array slicing\n\nSee: `patterns/jsonpath-querying.md`\n\n## Custom Objects: Serialization\n\nHandle datetime, UUID, Decimal, and custom classes:\n\n```python\nfrom datetime import datetime\nimport json\n\nclass CustomEncoder(json.JSONEncoder):\n    def default(self, obj):\n        if isinstance(obj, datetime):\n            return obj.isoformat()\n        if isinstance(obj, set):\n            return list(obj)\n        return super().default(obj)\n\n# Usage\ndata = {\"timestamp\": datetime.now(), \"tags\": {\"python\", \"json\"}}\njson_str = json.dumps(data, cls=CustomEncoder)\n```\n\nSee: `patterns/custom-object-serialization.md`\n\n## Performance Checklist\n\n- [ ] Use orjson/msgspec for high-throughput applications\n- [ ] Specify UTF-8 encoding when reading/writing files\n- [ ] Use streaming (ijson/JSONL) for files > 100MB\n- [ ] Minify JSON for production (`separators=(',', ':')`)\n- [ ] Pretty-print for development (`indent=2`)\n\n## Security Checklist\n\n- [ ] Never use `eval()` for JSON parsing\n- [ ] Validate input with `jsonschema`\n- [ ] Sanitize user input before serialization\n- [ ] Use `json.dumps()` to prevent injection\n- [ ] Escape special characters in user data\n\n## Reference Documentation\n\n**Performance:**\n\n- `reference/python-json-parsing-best-practices-2025.md` - Comprehensive research with benchmarks\n\n**Patterns:**\n\n- `patterns/streaming-large-json.md` - ijson and JSONL strategies\n- `patterns/custom-object-serialization.md` - Handle datetime, UUID, custom classes\n- `patterns/jsonpath-querying.md` - Advanced nested data extraction\n\n**Security:**\n\n- `anti-patterns/security-json-injection.md` - Prevent injection attacks\n- `anti-patterns/eval-usage.md` - Why never to use eval()\n\n**Examples:**\n\n- `examples/high-performance-parsing.py` - orjson and msgspec code\n- `examples/large-file-streaming.py` - Streaming with ijson\n- `examples/secure-validation.py` - jsonschema validation\n\n**Tools:**\n\n- `tools/json-performance-benchmark.py` - Benchmark different libraries"
              },
              {
                "name": "python-uv-scripts",
                "description": "Python single-file script development using uv and PEP 723 inline metadata. Prevents invalid patterns like [tool.uv.metadata]. Use when creating standalone Python utilities, converting scripts to uv format, managing script dependencies, implementing script testing, or establishing team standards for script development.\n",
                "path": "plugins/devops/python-tools/skills/python-uv-scripts/SKILL.md",
                "frontmatter": {
                  "name": "python-uv-scripts",
                  "description": "Python single-file script development using uv and PEP 723 inline metadata. Prevents invalid patterns like [tool.uv.metadata]. Use when creating standalone Python utilities, converting scripts to uv format, managing script dependencies, implementing script testing, or establishing team standards for script development.\n"
                },
                "content": "# Python Single-File Scripts with uv\n\nExpert guidance for creating production-ready, self-contained Python scripts using uv's inline dependency management\n(PEP 723).\n\n## Quick Start\n\n### Create Your First uv Script\n\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\n#   \"httpx>=0.27.0\",\n#   \"rich>=13.0.0\",\n# ]\n# ///\n\nimport httpx\nfrom rich import print\n\nresponse = httpx.get(\"https://api.github.com\")\nprint(f\"[green]Status: {response.status_code}[/green]\")\n```\n\nMake it executable:\n\n```bash\nchmod +x script.py\n./script.py  # uv automatically installs dependencies\n```\n\n### Convert Existing Script\n\n```bash\n# Add inline metadata to existing script\n./tools/convert_to_uv.py existing_script.py\n\n# Validate PEP 723 metadata\n./tools/validate_script.py script.py\n```\n\n## Core Concepts\n\n### What is PEP 723?\n\n**PEP 723** defines inline script metadata for Python files:\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\n#   \"package>=1.0.0\",\n# ]\n# ///\n```\n\n**Benefits:**\n\n-  Dependencies live with the code\n-  No separate `requirements.txt`\n-  Reproducible execution\n-  Version constraints included\n-  Self-documenting\n\n### uv Script Execution Modes\n\n**Mode 1: Inline Dependencies** (Recommended for utilities)\n\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# dependencies = [\"httpx\"]\n# ///\n```\n\n**Mode 2: Project Mode** (For larger scripts)\n\n```bash\nuv run script.py  # Uses pyproject.toml\n```\n\n### Mode 3: No Dependencies\n\n```python\n#!/usr/bin/env -S uv run\n# Standard library only\n```\n\n## Critical Anti-Patterns: What NOT to Do\n\n###  NEVER Use [tool.uv.metadata]\n\n**WRONG** - This will cause errors:\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# [tool.uv.metadata]        #  THIS DOES NOT WORK\n# purpose = \"testing\"\n# ///\n```\n\n**Error**:\n\n```text\nerror: TOML parse error at line 3, column 7\nunknown field `metadata`\n```\n\n**Why**: `[tool.uv.metadata]` is not part of PEP 723 and is not supported by uv.\n\n**CORRECT** - Use Python docstrings for metadata:\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = []\n# ///\n\"\"\"\nPurpose: Testing automation\nTeam: DevOps\nAuthor: team@example.com\n\"\"\"\n```\n\n**Valid `tool.uv` fields** (if needed):\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = []\n# [tool.uv]\n# exclude-newer = \"2025-01-01T00:00:00Z\"  # For reproducibility\n# ///\n```\n\n## Real-World Examples from This Repository\n\n### Example 1: Cluster Health Checker\n\nSee [examples/03-production-ready/check_cluster_health_enhanced.py](examples/03-production-ready/check_cluster_health_enhanced.py)\n\n**Current version** (basic):\n\n```python\n#!/usr/bin/env python3\nimport subprocess\n# Manual dependency installation required\n```\n\n**Enhanced with uv** (production-ready):\n\n```python\n#!/usr/bin/env -S uv run --script --quiet\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\n#   \"rich>=13.0.0\",\n#   \"typer>=0.9.0\",\n# ]\n# ///\n\"\"\"\nPurpose: Cluster health monitoring\nTeam: Infrastructure\n\"\"\"\n\nimport typer\nfrom rich.console import Console\nfrom rich.table import Table\n```\n\n### Example 2: CEPH Health Monitor\n\nSee [examples/03-production-ready/ceph_health.py](examples/03-production-ready/ceph_health.py)\n\nPattern: JSON API interaction with structured output\n\n## Best Practices from This Repository\n\n### 1. Security Patterns\n\nSee [reference/security-patterns.md](reference/security-patterns.md) for complete security guide including:\n\n- Secrets management (environment variables, keyring, Infisical)\n- Input validation\n- Dependency security\n- File operations security\n- Command execution security\n\n### 2. Version Pinning Strategy\n\nFollowing this repository's approach (from `pyproject.toml`):\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\n#   \"httpx>=0.27.0\",      # Minimum version for compatibility\n#   \"rich>=13.0.0\",       # Known good version\n#   \"ansible>=11.1.0\",    # Match project requirements\n# ]\n# ///\n```\n\n**Pinning levels:**\n\n- `>=X.Y.Z` - Minimum version (most flexible)\n- `~=X.Y.Z` - Compatible release (patch updates only)\n- `==X.Y.Z` - Exact version (most strict)\n\nSee [reference/dependency-management.md](reference/dependency-management.md).\n\n### 3. Team Standards\n\n**File naming:**\n\n```bash\ncheck_cluster_health.py    #  Descriptive, snake_case\nvalidate_template.py       #  Action-oriented\ncluster.py                 #  Too generic\n```\n\n**Shebang pattern:**\n\n```python\n#!/usr/bin/env -S uv run --script --quiet\n# --quiet suppresses uv's own output\n```\n\n**Documentation template:**\n\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = []\n# ///\n\"\"\"\nCheck Proxmox cluster health\n\nPurpose: cluster-monitoring\nTeam: infrastructure\nAuthor: devops@spaceships.work\n\nUsage:\n    python check_cluster_health.py [--node NODE] [--json]\n\nExamples:\n    python check_cluster_health.py --node foxtrot\n    python check_cluster_health.py --json\n\"\"\"\n```\n\n### 4. Error Handling Patterns\n\nFollowing Ansible best practices from this repository:\n\n```python\nimport sys\nimport subprocess\n\ndef run_command(cmd: str) -> str:\n    \"\"\"Execute command with proper error handling\"\"\"\n    try:\n        result = subprocess.run(\n            cmd.split(),\n            capture_output=True,\n            text=True,\n            check=True\n        )\n        return result.stdout\n    except subprocess.CalledProcessError as e:\n        print(f\"Error: Command failed: {cmd}\", file=sys.stderr)\n        print(f\"  {e.stderr}\", file=sys.stderr)\n        sys.exit(1)\n    except FileNotFoundError:\n        print(f\"Error: Command not found: {cmd.split()[0]}\", file=sys.stderr)\n        sys.exit(1)\n```\n\nSee [patterns/error-handling.md](patterns/error-handling.md).\n\n### 5. Testing Patterns\n\n**Inline testing** (for simple scripts):\n\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = []\n# ///\n\ndef validate_ip(ip: str) -> bool:\n    \"\"\"Validate IP address format\"\"\"\n    import re\n    pattern = r'^(\\d{1,3}\\.){3}\\d{1,3}$'\n    return bool(re.match(pattern, ip))\n\n# Inline tests\nif __name__ == \"__main__\":\n    import sys\n\n    # Run tests if --test flag provided\n    if len(sys.argv) > 1 and sys.argv[1] == \"--test\":\n        assert validate_ip(\"192.168.1.1\") == True\n        assert validate_ip(\"256.1.1.1\") == False\n        print(\"All tests passed!\")\n        sys.exit(0)\n\n    # Normal execution\n    print(validate_ip(\"192.168.3.5\"))\n```\n\nSee [workflows/testing-strategies.md](workflows/testing-strategies.md).\n\n## When NOT to Use Single-File Scripts\n\nSee [anti-patterns/when-not-to-use.md](anti-patterns/when-not-to-use.md) for details.\n\n**Use a proper project instead when:**\n\n-  Script exceeds 500 lines\n-  Multiple modules/files needed\n-  Complex configuration management\n-  Requires packaging/distribution\n-  Shared library code across multiple scripts\n-  Web applications or long-running services\n\n**Example - Too Complex for Single File:**\n\n```python\n# This should be a uv project, not a script:\n# - 15+ dependencies\n# - Database models\n# - API routes\n# - Background workers\n# - Configuration management\n# - Multiple environments\n```\n\n## Common Patterns\n\nSee pattern guides for complete examples:\n\n- [CLI Applications](patterns/cli-applications.md) - Typer, Click, argparse patterns\n- [API Clients](patterns/api-clients.md) - httpx, requests, authentication\n- [Data Processing](patterns/data-processing.md) - Polars, pandas, analysis\n- [System Automation](patterns/system-automation.md) - psutil, subprocess, system admin\n\n## CI/CD Integration\n\n### GitHub Actions\n\n```yaml\nname: Run Health Checks\n\non:\n  schedule:\n    - cron: '0 */6 * * *'  # Every 6 hours\n\njobs:\n  health-check:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install uv\n        uses: astral-sh/setup-uv@v3\n\n      - name: Check cluster health\n        run: |\n          uv run --script tools/check_cluster_health.py --json\n        env:\n          PROXMOX_TOKEN: ${{ secrets.PROXMOX_TOKEN }}\n```\n\n### GitLab CI\n\n```yaml\ncluster-health:\n  image: ghcr.io/astral-sh/uv:python3.11-bookworm-slim\n  script:\n    - uv run --script tools/check_cluster_health.py\n  only:\n    - schedules\n```\n\nSee [workflows/ci-cd-integration.md](workflows/ci-cd-integration.md).\n\n## Tools Available\n\n### Script Validation\n\n```bash\n# Validate PEP 723 metadata\n./tools/validate_script.py script.py\n\n# Output:\n#  Valid PEP 723 metadata\n#  Python version specified\n#  Dependencies properly formatted\n```\n\n### Script Conversion\n\n```bash\n# Convert requirements.txt-based script to uv\n./tools/convert_to_uv.py old_script.py\n\n# Creates:\n# - old_script_uv.py with inline dependencies\n# - Preserves original script\n```\n\n## Progressive Disclosure\n\nFor deeper knowledge:\n\n### Reference Documentation\n\n- [PEP 723 Specification](reference/pep-723-spec.md) - Complete inline metadata spec\n- [Dependency Management](reference/dependency-management.md) - Version pinning strategies\n- [Security Patterns](reference/security-patterns.md) - Secrets, validation, input sanitization\n\n### Pattern Guides\n\n- [CLI Applications](patterns/cli-applications.md) - Typer, Click, argparse patterns\n- [API Clients](patterns/api-clients.md) - httpx, requests, authentication\n- [Data Processing](patterns/data-processing.md) - Polars, pandas, analysis\n- [System Automation](patterns/system-automation.md) - psutil, subprocess, system admin\n- [Error Handling](patterns/error-handling.md) - Exception handling, logging\n\n> **Note:** See [Common Patterns](#common-patterns) section above for quick access to these guides.\n\n### Working Examples\n\n- [NetBox API Client](examples/04-api-clients/netbox_client.py) - Production-ready API client with Infisical, validation, error handling, and Rich output\n- [Cluster Health Checker](examples/03-production-ready/check_cluster_health_enhanced.py) - Production-ready monitoring script with Typer, Rich, and JSON output\n\n### Anti-Patterns\n\n- [When NOT to Use](anti-patterns/when-not-to-use.md) - Signs you need a proper project\n- [Common Mistakes](anti-patterns/common-mistakes.md) - Pitfalls and how to avoid them\n\n### Workflows\n\n- [Team Adoption](workflows/team-adoption.md) - Rolling out uv scripts across teams\n- [CI/CD Integration](workflows/ci-cd-integration.md) - GitHub Actions, GitLab CI\n- [Testing Strategies](workflows/testing-strategies.md) - Inline tests, pytest integration\n\n## Related Skills\n\n- **Ansible Best Practices** - Many Ansible modules could be standalone uv scripts\n- **Proxmox Infrastructure** - Validation tools use this pattern\n- **NetBox + PowerDNS Integration** - API interaction scripts\n\n## Quick Reference\n\n### Shebang Options\n\n```python\n# Standard script execution\n#!/usr/bin/env -S uv run --script\n\n# Quiet mode (suppress uv output)\n#!/usr/bin/env -S uv run --script --quiet\n\n# With Python version\n#!/usr/bin/env -S uv run --script --python 3.11\n```\n\n### Common Dependencies\n\n```python\n# CLI applications\n\"typer>=0.9.0\"        # Modern CLI framework\n\"click>=8.0.0\"        # Alternative CLI framework\n\"rich>=13.0.0\"        # Rich text and formatting\n\n# API clients\n\"httpx>=0.27.0\"       # Modern async HTTP client\n\"requests>=2.31.0\"    # Traditional HTTP client\n\n# Data processing\n\"polars>=0.20.0\"      # Fast dataframe library\n\"pandas>=2.0.0\"       # Traditional dataframe library\n\n# Infrastructure\n\"ansible>=11.1.0\"     # Automation (from this repo)\n\"infisical-python>=2.3.3\"  # Secrets (from this repo)\n\n# System automation\n\"psutil>=5.9.0\"       # System monitoring\n```\n\n### Metadata Template\n\n```python\n#!/usr/bin/env -S uv run --script --quiet\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\n#   # Add dependencies here\n# ]\n# ///\n\"\"\"\nOne-line description\n\nPurpose: describe-purpose\nTeam: team-name\nAuthor: email@example.com\n\nUsage:\n    python script.py [OPTIONS]\n\nExamples:\n    python script.py --help\n\"\"\"\n```\n\n## Best Practices Summary\n\n1. **Always specify Python version** - `requires-python = \">=3.11\"`\n2. **Pin dependencies appropriately** - Use `>=X.Y.Z` for utilities\n3. **Add metadata in docstrings** - Put team info, purpose, and author in module docstring\n4. **Include comprehensive docstrings** - Document purpose, usage, and examples\n5. **Handle errors gracefully** - Use try/except with clear messages\n6. **Validate inputs** - Check arguments before processing\n7. **Use quiet mode** - `--quiet` flag for production scripts\n8. **Keep it focused** - Single file, single purpose\n9. **Test inline** - Add `--test` flag for simple validation\n10. **Secure secrets** - Never hardcode, use env vars or keyring"
              }
            ]
          },
          {
            "name": "git-workflow",
            "description": "Git workflow automation including atomic commits, branch cleanup, and conventional commit standards",
            "source": "./plugins/devops/git-workflow",
            "category": "devops",
            "version": "1.0.4",
            "author": {
              "name": "basher83"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install git-workflow@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [
              {
                "name": "/branch-cleanup",
                "description": "Comprehensive git branch cleanup and organization",
                "path": "plugins/devops/git-workflow/commands/branch-cleanup.md",
                "frontmatter": {
                  "description": "Comprehensive git branch cleanup and organization",
                  "allowed-tools": "Bash(git:*), Bash(gh:*), AskUserQuestion"
                },
                "content": "# Comprehensive Git Branch Cleanup\n\nPerform a complete cleanup of local and remote branches after working on multiple PRs.\n\n## Current State\n\n- Default branch: !`git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@' || echo \"main\"`\n- Current branch: !`git branch --show-current`\n- Fetch latest: !`git fetch --all --prune 2>&1`\n\n## Branch Inventory\n\n### All Branches\n\nLocal branches with tracking status:\n\n!`git branch --format='%(refname:short) %(upstream:track)' | sort`\n\nRecent branches by activity:\n\n!`git for-each-ref --count=15 --sort=-committerdate refs/heads/ --format='%(refname:short) - %(committerdate:relative)'`\n\nRemote branches:\n\n!`git branch -r --format='%(refname:short)' | grep -v HEAD | sort`\n\n### Cleanup Candidates\n\nDefault branch: !`git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@' || echo \"main\"`\n\nMerged into default branch: !`git branch --merged`\n\nBranches with gone remotes:\n\n!`git branch -vv | grep ': gone]' | awk '{print $1}' | sort`\n\nStale remote-tracking refs (would be pruned):\n\n!`git remote prune origin --dry-run 2>&1 | grep '\\[would prune\\]' | awk '{print $NF}' || echo \"None\"`\n\n## Protected Branches\n\nNever delete branches matching these patterns:\n\n- `main`, `master`, `develop`, `staging`, `production`\n- `release/*` branches (unless explicitly confirmed via AskUserQuestion)\n- `renovate/*` branches (managed by Renovate bot)\n- Current working branch\n- Branches with unpushed commits (use AskUserQuestion to confirm)\n\n## Cleanup Workflow\n\n### Phase 1: Analyze\n\n1. Review the branch inventory above\n2. Identify the default branch (protect from deletion)\n3. Categorize branches:\n   - **Safe to delete**: Merged branches and branches with gone remotes (excluding protected)\n   - **Needs confirmation**: `release/*` branches, branches with unpushed commits\n   - **Protected**: All protected branch patterns and current branch\n\n### Phase 2: Confirm Cleanup Plan\n\nBefore deleting anything, present the cleanup plan and use AskUserQuestion:\n\n**Question: Cleanup scope**\n- header: \"Cleanup\"\n- question: \"Which branches should be deleted?\"\n- multiSelect: false\n- options:\n  - All safe (Delete all merged and gone-remote branches)\n  - Merged only (Delete only branches merged into default)\n  - Gone only (Delete only branches with deleted remotes)\n  - Review each (Confirm each branch individually)\n\nIf user selects \"Review each\", iterate through each candidate branch with:\n\n**Question: Per-branch confirmation**\n- header: \"Delete?\"\n- question: \"Delete branch '[branch-name]'? ([merged/gone], last commit: [date])\"\n- options:\n  - Yes (Delete this branch)\n  - No (Keep this branch)\n  - Stop (Abort remaining cleanup)\n\n### Phase 3: Execute Cleanup\n\nAfter user confirmation, execute in order:\n\n1. **Prune stale remote-tracking refs**: `git remote prune origin`\n2. **Delete merged local branches**: `git branch -d [branch-name]`\n3. **Delete gone-remote branches**: `git branch -D [branch-name]`\n\nFor each deletion, record the branch name and SHA before deleting:\n`git rev-parse [branch-name]`\n\n**If deletion fails**, use AskUserQuestion:\n\n- header: \"Failed\"\n- question: \"Failed to delete '[branch-name]': [error]. What should we do?\"\n- options:\n  - Force (Use git branch -D to force delete)\n  - Skip (Leave this branch, continue with others)\n  - Abort (Stop cleanup, keep remaining branches)\n\n### Phase 4: Remote Cleanup (Optional)\n\nAfter local cleanup, use AskUserQuestion:\n\n- header: \"Remotes\"\n- question: \"Delete corresponding remote branches on origin?\"\n- options:\n  - Yes (Run git push origin --delete for each deleted local branch)\n  - No (Keep remote branches, only cleaned up locally)\n\n### Phase 5: Summary\n\nProvide cleanup summary:\n\n```text\nBranch Cleanup Summary:\n- Deleted N merged feature branches\n- Removed N branches with gone remotes\n- Pruned N stale remote references\n- Repository now has N active branches (was M)\n\nRecovery Commands:\n```\n\nFor each deleted branch, output:\n`git checkout -b [branch-name] [sha]`\n\nFinal branch state:\n\n!`git branch --format='%(refname:short)'`"
              },
              {
                "name": "/generate-changelog",
                "description": "Generate changelog using git-cliff, optionally bump version tag",
                "path": "plugins/devops/git-workflow/commands/generate-changelog.md",
                "frontmatter": {
                  "description": "Generate changelog using git-cliff, optionally bump version tag",
                  "allowed-tools": "Bash(git:*), Bash(git-cliff:*), AskUserQuestion, Read"
                },
                "content": "# Generate Changelog\n\nGenerate or update CHANGELOG.md using git-cliff based on conventional commits.\n\n**Typical workflow:** Run after `/git-commit` or commit-craft agent, before pushing to remote.\n\n## Current State\n\n- Branch and status: !`git status -sb`\n- Recent commits: !`git log --oneline -10`\n- Latest tag: !`git describe --tags --abbrev=0 2>/dev/null || echo \"No tags yet\"`\n- Unpushed commits: !`git log --oneline @{u}..HEAD 2>/dev/null || echo \"No upstream or no unpushed commits\"`\n- Working directory: !`git status --porcelain | head -5 || echo \"Clean\"`\n- Unreleased changes preview: !`git-cliff --unreleased 2>/dev/null | head -20 || echo \"No unreleased changes or git-cliff not configured\"`\n\n## Workflow\n\n### Phase 1: Pre-flight Check\n\n1. If working directory has uncommitted changes (other than CHANGELOG.md), use AskUserQuestion:\n   - header: \"Uncommitted\"\n   - question: \"You have uncommitted changes. Continue with changelog generation?\"\n   - options:\n     - Continue (Proceed anyway)\n     - Abort (Stop and commit changes first)\n\n2. If no conventional commits since last tag, inform user and stop\n\n### Phase 2: Choose Action\n\nUse AskUserQuestion to determine workflow:\n\n- header: \"Action\"\n- question: \"What would you like to do with the changelog?\"\n- options:\n  - Preview (Show what would be generated without writing)\n  - Generate (Create/update CHANGELOG.md)\n  - Release (Generate changelog and create version tag)\n\n### Phase 3: Execute Action\n\n#### If Preview\n\nShow unreleased changes: `git-cliff --unreleased`\n\nReport summary and stop.\n\n#### If Generate\n\n1. Generate changelog: `git-cliff -o CHANGELOG.md`\n\n2. Show diff: `git diff CHANGELOG.md`\n\n3. Commit: `git add CHANGELOG.md && git commit -m \"docs: update changelog\"`\n\n#### If Release\n\n1. Analyze unreleased commits to provide a recommendation:\n   - Review the commits shown in Current State\n   - Identify the types of changes (breaking, features, fixes, docs, etc.)\n   - Check git-cliff's detection: `git-cliff --bump --bumped-version`\n\n2. Provide a recommendation with reasoning:\n   - Summarize what's being released (e.g., \"3 features, 5 bug fixes, 2 docs updates\")\n   - Explain the recommended bump level based on semantic versioning:\n     - Major: if breaking changes or `BREAKING CHANGE:` commits present\n     - Minor: if new features (`feat:`) without breaking changes\n     - Patch: if only fixes, docs, refactors, etc.\n   - Show the proposed version: \"[CURRENT]  [RECOMMENDED]\"\n\n3. Use AskUserQuestion to confirm:\n   - header: \"Release\"\n   - question: \"Proceed with [RECOMMENDED_LEVEL] release to v[VERSION]?\"\n   - options:\n     - Yes (Create release with recommended version)\n     - Patch (Override: bump patch instead)\n     - Minor (Override: bump minor instead)\n     - Major (Override: bump major instead)\n\n4. Generate changelog with confirmed version: `git-cliff --bump [level] -o CHANGELOG.md`\n\n5. Show diff: `git diff CHANGELOG.md`\n\n6. Commit: `git add CHANGELOG.md && git commit -m \"docs: update changelog for v[VERSION]\"`\n\n7. Create annotated tag: `git tag -a v[VERSION] -m \"Release v[VERSION]\"`\n\n8. Report: Previous version  New version\n\n### Phase 4: Summary\n\nProvide completion summary:\n\n- Changelog diff summary (categories and entry count)\n- Version change (if releasing): `v0.1.0  v0.2.0`\n- Next step reminder:\n  - If committed: \"Ready to push with `git push`\"\n  - If released: \"Ready to push with `git push && git push --tags`\""
              },
              {
                "name": "/git-commit",
                "description": "Run pre-commit hooks and create clean, logical commits",
                "path": "plugins/devops/git-workflow/commands/git-commit.md",
                "frontmatter": {
                  "description": "Run pre-commit hooks and create clean, logical commits",
                  "allowed-tools": "Bash(git:*), Bash(pre-commit:*), Bash(test:*), Task, AskUserQuestion"
                },
                "content": "# Git Commit Workflow\n\nOrchestrate pre-commit hooks and invoke commit-craft agent for clean, logical commits.\n\n## Current State\n\n- Branch and status: !`git status -sb`\n- Working directory: !`git status --short`\n- Merge/rebase state: !`test -f .git/MERGE_HEAD && echo \"MERGE IN PROGRESS\" || test -d .git/rebase-merge && echo \"REBASE IN PROGRESS\" || echo \"Clean\"`\n- Staged files: !`git diff --cached --name-only`\n- Sensitive files check: !`git diff --cached --name-only | grep -iE '\\.(env|mcp\\.json)$|secret|token|key|password' || echo \"None detected\"`\n\n## Workflow\n\n### Step 1: Pre-flight Checks\n\nVerify repository state:\n\n1. If merge or rebase in progress, stop and inform user\n2. If sensitive files detected, use AskUserQuestion:\n   - header: \"Sensitive\"\n   - question: \"Sensitive files detected in staged changes. Proceed with commit?\"\n   - options:\n     - Continue (I understand the risk, proceed)\n     - Unstage (Remove sensitive files from staging)\n     - Abort (Cancel commit workflow)\n\n### Step 2: Run Pre-commit Hooks (if configured)\n\nCheck if pre-commit is configured: `test -f .pre-commit-config.yaml`\n\nIf configured, execute pre-commit hooks: `pre-commit run -a`\n\nAnalyze the output:\n\n- If hooks pass: Continue to Step 3\n- If hooks fail with errors: Report errors and stop\n- If hooks modify files (formatting, etc.):\n  1. Show which files were modified\n  2. Re-stage modified files: `git add -u`\n  3. Continue to Step 3\n\n### Step 3: Create Commits\n\nUse the Task tool to invoke the commit-craft agent:\n\n- subagent_type: \"commit-craft\"\n- prompt: \"Create clean, atomic commits for the current workspace changes\"\n\nThe commit-craft agent will:\n\n1. Analyze all workspace changes\n2. Group related changes into atomic commits\n3. Create conventional commit messages\n4. Execute commits handling any additional hook runs"
              },
              {
                "name": "/git-status",
                "description": "Summarize the current state of the git repository",
                "path": "plugins/devops/git-workflow/commands/git-status.md",
                "frontmatter": {
                  "description": "Summarize the current state of the git repository",
                  "allowed-tools": "Bash(git:*)",
                  "model": "haiku"
                },
                "content": "# Git Status\n\nSummarize the current state of the git repository.\n\n## Repository State\n\nBranch and sync status: !`git status -sb`\n\nWorking directory: !`git status --short`\n\nRecent commits: !`git log --oneline -5`\n\nStashes: !`git stash list`\n\n## Task\n\nProvide a concise summary including:\n\n1. **Branch status**: Current branch and ahead/behind remote\n2. **Working directory**: Count of staged, unstaged, and untracked changes\n3. **Recent activity**: Brief summary of recent commits\n4. **Action items**: Suggested next steps based on current state"
              }
            ],
            "skills": [
              {
                "name": "git-workflow",
                "description": "This skill should be used when the user asks to \"make commits\", \"commit all changes\", \"create a branch\", \"name a branch\", \"organize commits\", \"conventional commits\", \"generate changelog\", \"release version\", \"bump version\", or needs guidance on git workflow best practices including commit organization, branch naming, and conventional commit format.",
                "path": "plugins/devops/git-workflow/skills/git-workflow/SKILL.md",
                "frontmatter": {
                  "name": "git-workflow",
                  "description": "This skill should be used when the user asks to \"make commits\", \"commit all changes\", \"create a branch\", \"name a branch\", \"organize commits\", \"conventional commits\", \"generate changelog\", \"release version\", \"bump version\", or needs guidance on git workflow best practices including commit organization, branch naming, and conventional commit format."
                },
                "content": "# Git Workflow Best Practices\n\nGuidance for creating clean, atomic commits and organizing git workflows effectively.\n\n## Available Commands\n\nThis plugin provides commands to automate git workflows:\n\n| Command | Purpose |\n|---------|---------|\n| `/git-status` | Quick repository status summary |\n| `/git-commit` | Create commits with pre-commit hooks |\n| `/branch-cleanup` | Clean up merged/stale branches |\n| `/generate-changelog` | Generate CHANGELOG.md using git-cliff |\n\n### Changelog Generation\n\nUse `/generate-changelog` after creating commits to update CHANGELOG.md. The command uses a workflow-driven approach:\n\n1. Shows current state (branch, recent commits, latest tag, unreleased changes)\n2. Prompts to select action: Preview, Generate, or Release\n3. For releases, analyzes commits and recommends version bump level\n\n## Conventional Commit Format\n\nStructure commit messages following the conventional commit specification. Project-specific CLAUDE.md conventions take precedence over these defaults.\n\n```text\ntype(scope): subject\n\nbody (optional)\n\nfooter (optional)\n```\n\n### Commit Types\n\n| Type | Purpose |\n|------|---------|\n| `feat` | New feature |\n| `fix` | Bug fix |\n| `docs` | Documentation only |\n| `style` | Formatting, no code change |\n| `refactor` | Code restructuring |\n| `perf` | Performance improvement |\n| `test` | Adding/updating tests |\n| `build` | Build system changes |\n| `ci` | CI configuration |\n| `chore` | Maintenance tasks |\n| `revert` | Revert previous commit |\n\n### Subject Line Rules\n\n- Maximum 50 characters\n- Use imperative mood (\"Add feature\" not \"Added feature\")\n- No period at end\n- Capitalize first letter\n\n### Body Guidelines\n\n- Wrap at 72 characters\n- Explain what and why, not how\n- Separate from subject with blank line\n\n### Footer Conventions\n\n- Reference issues: `Fixes #123` or `Relates to #456`\n- Breaking changes: `BREAKING CHANGE: description`\n- Co-authors: `Co-Authored-By: Name <email>`\n\n## Branch Naming Conventions\n\nUse descriptive, prefixed branch names:\n\n### Branch Prefixes\n\n| Prefix | Purpose | Example |\n|--------|---------|---------|\n| `feature/` | New functionality | `feature/user-authentication` |\n| `fix/` | Bug fixes | `fix/login-redirect-loop` |\n| `hotfix/` | Urgent production fixes | `hotfix/security-patch` |\n| `release/` | Release preparation | `release/v2.1.0` |\n| `docs/` | Documentation updates | `docs/api-reference` |\n| `refactor/` | Code restructuring | `refactor/database-layer` |\n| `test/` | Test additions | `test/integration-suite` |\n| `chore/` | Maintenance | `chore/dependency-updates` |\n\n### Naming Rules\n\n- Use kebab-case (lowercase with hyphens)\n- Keep names descriptive but concise\n- Include ticket/issue number when applicable: `feature/123-user-auth`\n- Avoid generic names like `feature/update` or `fix/bug`\n\n## Atomic Commit Principles\n\nCreate commits that are:\n\n1. **Self-contained**: Each commit represents one logical change\n2. **Complete**: Code compiles and tests pass after each commit\n3. **Reviewable**: Small enough to understand in one review session\n\n### Grouping Guidelines\n\n- Keep implementation and tests together\n- Separate infrastructure from application changes\n- Isolate documentation unless integral to code changes\n- Group by feature/component/purpose\n- Keep related lock files with their manifests (package-lock.json with package.json)\n\n### What NOT to Mix\n\n- Unrelated bug fixes in the same commit\n- Formatting changes with logic changes\n- Multiple features in one commit\n- Refactoring with new functionality\n\n## Pre-Commit Workflow\n\nBefore committing:\n\n1. **Review changes**: `git diff` and `git status`\n2. **Check for sensitive files**: Never commit `.env`, credentials, API keys\n3. **Run pre-commit hooks**: Let formatters and linters process files\n4. **Re-stage if hooks modify files**: Add reformatted files and retry commit\n\n### Handling Pre-Commit Hook Failures\n\nWhen hooks modify files:\n\n1. Review the changes made by hooks\n2. Re-add the modified files: `git add <files>`\n3. Retry the commit\n4. Document any issues for manual review\n\n## Commit Message Template\n\nUse heredoc format for multi-line messages:\n\n```bash\ngit commit -m \"$(cat <<'EOF'\ntype(scope): subject line here\n\n- Detailed bullet point explaining change\n- Another relevant detail\n\nFixes #123\nEOF\n)\"\n```\n\n## Protected Branches\n\nNever force-push or directly commit to:\n\n- `main` / `master`\n- `develop`\n- `staging` / `production`\n- `release/*` branches\n\nAlways use pull requests for these branches.\n\n## Quick Reference\n\n### Creating a Feature Branch\n\n```bash\ngit checkout -b feature/descriptive-name\n```\n\n### Checking What to Commit\n\n```bash\ngit status                    # See all changes\ngit diff                      # Unstaged changes\ngit diff --cached             # Staged changes\ngit log --oneline -5          # Recent commit style\n```\n\n### Staging Selectively\n\n```bash\ngit add path/to/specific/file.ext\ngit add -p                    # Interactive staging\n```\n\n### Writing Good Commits\n\n```bash\n# Simple commit\ngit commit -m \"feat(auth): add OAuth2 login support\"\n\n# Multi-line commit\ngit commit -m \"$(cat <<'EOF'\nfix(api): resolve race condition in request handler\n\n- Add mutex lock around shared state\n- Implement request queuing for high load\n- Add timeout handling for stale requests\n\nFixes #456\nEOF\n)\"\n```"
              }
            ]
          },
          {
            "name": "netbox-powerdns-integration",
            "description": "NetBox IPAM and PowerDNS integration for automated DNS record management and infrastructure documentation",
            "source": "./plugins/homelab/netbox-powerdns-integration",
            "category": "homelab",
            "version": "1.0.0",
            "author": {
              "name": "basher83"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install netbox-powerdns-integration@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [],
            "skills": [
              {
                "name": "netbox-powerdns-integration",
                "description": "NetBox IPAM and PowerDNS integration for automated DNS record management.",
                "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/SKILL.md",
                "frontmatter": {
                  "name": "netbox-powerdns-integration",
                  "description": "NetBox IPAM and PowerDNS integration for automated DNS record management."
                },
                "content": "# NetBox PowerDNS Integration\n\nExpert guidance for implementing NetBox as your source of truth for infrastructure documentation and\nautomating DNS record management with PowerDNS.\n\n## Quick Start\n\n### Common Tasks\n\n**Query NetBox API:**\n\n```bash\n# List all sites\n./tools/netbox_api_client.py sites list\n\n# Get device details\n./tools/netbox_api_client.py devices get --name foxtrot\n\n# List VMs in cluster\n./tools/netbox_api_client.py vms list --cluster matrix\n\n# Query IPs\n./tools/netbox_api_client.py ips query --dns-name docker-01\n```\n\n**Create VM in NetBox:**\n\n```bash\n# Create VM with auto-assigned IP\n./tools/netbox_vm_create.py --name docker-02 --cluster matrix --vcpus 4 --memory 8192\n\n# Create VM with specific IP\n./tools/netbox_vm_create.py --name k8s-01-master --cluster matrix --ip 192.168.3.50/24\n```\n\n**IPAM Queries:**\n\n```bash\n# Get available IPs\n./tools/netbox_ipam_query.py available --prefix 192.168.3.0/24\n\n# Check prefix utilization\n./tools/netbox_ipam_query.py utilization --site matrix\n\n# View IP assignments\n./tools/netbox_ipam_query.py assignments --prefix 192.168.3.0/24\n```\n\n**Validate DNS Naming:**\n\n```bash\n./tools/validate_dns_naming.py --name \"docker-01-nexus.spaceships.work\"\n```\n\n**Deploy from NetBox Inventory:**\n\n```bash\ncd ansible && uv run ansible-playbook -i tools/netbox-dynamic-inventory.yml deploy-from-netbox.yml\n```\n\n## When to Use This Skill\n\nActivate this skill when:\n\n- **Querying NetBox API** - Sites, devices, VMs, IPs, prefixes, VLANs\n- **Setting up NetBox IPAM** - Prefixes, IP management, VRFs\n- **Implementing automated DNS** - PowerDNS sync plugin configuration\n- **Creating DNS naming conventions** - `service-NN-purpose.domain` pattern\n- **Managing VMs in NetBox** - Creating, updating, IP assignment\n- **Using Terraform with NetBox** - Provider configuration and resources\n- **Setting up Ansible dynamic inventory** - NetBox as inventory source\n- **Troubleshooting NetBox-PowerDNS sync** - Tag matching, zone configuration\n- **Migrating to NetBox** - From manual DNS or spreadsheet tracking\n- **Infrastructure documentation** - Using NetBox as source of truth\n\n## Core Workflows\n\n### 1. NetBox API Usage\n\n**Query infrastructure data:**\n\n```python\n#!/usr/bin/env -S uv run --script --quiet\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\"pynetbox>=7.0.0\", \"infisical-python>=2.3.3\"]\n# ///\n\nimport pynetbox\nfrom infisical import InfisicalClient\n\n# Get token from Infisical\nclient = InfisicalClient()\ntoken = client.get_secret(\n    secret_name=\"NETBOX_API_TOKEN\",\n    project_id=\"7b832220-24c0-45bc-a5f1-ce9794a31259\",\n    environment=\"prod\",\n    path=\"/matrix\"\n).secret_value\n\n# Connect to NetBox\nnb = pynetbox.api('https://netbox.spaceships.work', token=token)\n\n# Query devices in Matrix cluster\nsite = nb.dcim.sites.get(slug='matrix')\ndevices = nb.dcim.devices.filter(site='matrix')\n\nfor device in devices:\n    print(f\"{device.name}: {device.primary_ip4.address if device.primary_ip4 else 'No IP'}\")\n```\n\nSee [reference/netbox-api-guide.md](reference/netbox-api-guide.md) for complete API reference.\n\n### 2. DNS Naming Convention\n\nThis infrastructure uses the pattern: `<service>-<number>-<purpose>.<domain>`\n\n**Examples:**\n\n- `docker-01-nexus.spaceships.work` - Docker host #1 running Nexus\n- `proxmox-foxtrot-mgmt.spaceships.work` - Proxmox node Foxtrot management interface\n- `k8s-01-master.spaceships.work` - Kubernetes cluster master node #1\n\n**Implementation:**\n\n```python\n# tools/validate_dns_naming.py validates this pattern\npattern = r'^[a-z0-9-]+-\\d{2}-[a-z0-9-]+\\.[a-z0-9.-]+$'\n```\n\nSee [workflows/naming-conventions.md](workflows/naming-conventions.md) for complete rules.\n\n### 3. NetBox + PowerDNS Sync Setup\n\n#### Step 1: Install Plugin\n\n```bash\n# In NetBox virtualenv\npip install netbox-powerdns-sync\n```\n\n#### Step 2: Configure Plugin\n\n```python\n# /opt/netbox/netbox/netbox/configuration.py\nPLUGINS = ['netbox_powerdns_sync']\n\nPLUGINS_CONFIG = {\n    \"netbox_powerdns_sync\": {\n        \"powerdns_managed_record_comment\": \"netbox-managed\",\n        \"post_save_enabled\": True,  # Real-time sync\n    },\n}\n```\n\n#### Step 3: Create Zones in NetBox\n\nConfigure zones with:\n\n- Zone name (e.g., `spaceships.work`)\n- PowerDNS server connection\n- Tag matching rules (e.g., `production-dns`)\n- DNS name generation method\n\nSee [reference/sync-plugin-reference.md](reference/sync-plugin-reference.md) for details.\n\n### 4. Terraform Integration\n\n**Provider Setup:**\n\n```hcl\nterraform {\n  required_providers {\n    netbox = {\n      source  = \"e-breuninger/netbox\"\n      version = \"~> 5.0.0\"\n    }\n  }\n}\n\nprovider \"netbox\" {\n  server_url = \"https://netbox.spaceships.work\"\n  api_token  = var.netbox_api_token\n}\n```\n\n**Create IP with Auto-DNS:**\n\n```hcl\nresource \"netbox_ip_address\" \"docker_host\" {\n  ip_address  = \"192.168.1.100/24\"\n  dns_name    = \"docker-01-nexus.spaceships.work\"\n  description = \"Docker host for Nexus registry\"\n\n  tags = [\n    \"terraform\",\n    \"production-dns\"  # Triggers auto DNS sync\n  ]\n}\n```\n\nDNS records created automatically by plugin!\n\nSee [reference/terraform-provider-guide.md](reference/terraform-provider-guide.md) and [examples/netbox-terraform-provider.tf](examples/netbox-terraform-provider.tf).\n\n### 5. Ansible Dynamic Inventory\n\n**Use NetBox as Inventory Source:**\n\n```yaml\n# tools/netbox-dynamic-inventory.yml\nplugin: netbox.netbox.nb_inventory\napi_endpoint: https://netbox.spaceships.work\ntoken: !vault |\n  $ANSIBLE_VAULT;...\ngroup_by:\n  - device_roles\n  - tags\n```\n\n**Deploy Using NetBox Data:**\n\n```bash\nansible-playbook -i tools/netbox-dynamic-inventory.yml deploy-from-netbox.yml\n```\n\nSee [workflows/ansible-dynamic-inventory.md](workflows/ansible-dynamic-inventory.md).\n\n## Architecture Reference\n\n### DNS Automation Flow\n\n```text\n1. Create/Update resource in NetBox\n    IP Address with dns_name and tags\n\n2. NetBox PowerDNS Sync Plugin activates\n    Matches IP to zone based on tags\n    Generates DNS records\n\n3. PowerDNS API called\n    A record: docker-01-nexus.spaceships.work  192.168.1.100\n    PTR record: 100.1.168.192.in-addr.arpa  docker-01-nexus.spaceships.work\n\n4. DNS propagates automatically\n    No manual DNS configuration needed\n```\n\n### Integration with Proxmox\n\n```text\nTerraform/Ansible\n  \nCreates VM in Proxmox\n  \nRegisters in NetBox (via API)\n   Device object\n   IP Address with dns_name\n   Tags (production-dns)\n  \nNetBox PowerDNS Sync\n  \nDNS Records in PowerDNS\n  \nAnsible Dynamic Inventory\n  \nAutomated configuration management\n```\n\n## Tools Available\n\n### NetBox API Tools (Python + uv)\n\n**netbox_api_client.py** - Comprehensive NetBox API client\n\n```bash\n# List sites, devices, VMs, IPs\n./tools/netbox_api_client.py sites list\n./tools/netbox_api_client.py devices get --name foxtrot\n./tools/netbox_api_client.py vms list --cluster matrix\n./tools/netbox_api_client.py ips query --dns-name docker-01\n./tools/netbox_api_client.py prefixes available --prefix 192.168.3.0/24\n```\n\n**netbox_vm_create.py** - Create VMs in NetBox with IP assignment\n\n```bash\n# Create VM with auto IP\n./tools/netbox_vm_create.py --name docker-02 --cluster matrix --vcpus 4 --memory 8192\n\n# Create VM with specific IP\n./tools/netbox_vm_create.py --name k8s-01-master --cluster matrix --ip 192.168.3.50/24\n```\n\n**netbox_ipam_query.py** - Advanced IPAM queries\n\n```bash\n# Available IPs\n./tools/netbox_ipam_query.py available --prefix 192.168.3.0/24\n\n# Prefix utilization\n./tools/netbox_ipam_query.py utilization --site matrix\n\n# IP assignments\n./tools/netbox_ipam_query.py assignments --prefix 192.168.3.0/24\n\n# IPAM summary\n./tools/netbox_ipam_query.py summary --site matrix\n```\n\n**validate_dns_naming.py** - Validate DNS naming conventions\n\n```bash\n./tools/validate_dns_naming.py --name \"docker-01-nexus.spaceships.work\"\n```\n\n### Terraform Modules\n\n**netbox-data-sources.tf** - Examples using NetBox provider\n\n- Query existing NetBox resources\n- Use as data sources for other resources\n\n### Ansible Playbooks\n\n**deploy-from-netbox.yml** - Deploy using NetBox inventory\n\n- Dynamic inventory from NetBox\n- Tag-based host selection\n- Automatic IP and hostname discovery\n\nSee [examples/](examples/) directory.\n\n## Troubleshooting\n\n### DNS Records Not Syncing\n\n#### Check 1: Tag Matching\n\n```bash\n# Verify IP has correct tags\n./tools/netbox_query.py --ip 192.168.1.100 | jq '.tags'\n```\n\n#### Check 2: Zone Configuration\n\n- Ensure zone exists in NetBox\n- Verify tag rules match\n- Check PowerDNS server connectivity\n\n#### Check 3: Sync Results\n\n```bash\n./tools/powerdns_sync_check.py --zone spaceships.work --verbose\n```\n\n### Naming Convention Violations\n\n**Validate names before creating:**\n\n```bash\n./tools/validate_dns_naming.py --name \"my-proposed-name.domain\"\n```\n\n**Common mistakes:**\n\n- Uppercase letters (use lowercase only)\n- Missing service number (must be XX format)\n- Wrong domain\n- Special characters (use hyphens only)\n\n### Terraform Provider Issues\n\n**Version mismatch:**\n\n```text\nWarning: NetBox version 4.3.0 not supported by provider 3.9.0\n```\n\n**Solution:** Update provider version:\n\n```hcl\nversion = \"~> 5.0.0\"  # Match NetBox 4.3.x\n```\n\n### Dynamic Inventory Not Working\n\n**Check API connectivity:**\n\n```bash\ncurl -H \"Authorization: Token YOUR_TOKEN\" \\\n  https://netbox.spaceships.work/api/dcim/devices/\n```\n\n**Verify inventory plugin:**\n\n```bash\nansible-inventory -i tools/netbox-dynamic-inventory.yml --list\n```\n\nSee [troubleshooting/](reference/) for more details.\n\n## Best Practices\n\n1. **Consistent naming** - Always follow `service-NN-purpose.domain` pattern\n2. **Use tags** - Tag resources for auto-DNS (`production-dns`, `lab-dns`)\n3. **Document in NetBox** - Single source of truth for all infrastructure\n4. **Real-time sync** - Enable `post_save_enabled` for immediate DNS updates\n5. **Terraform everything** - Manage NetBox resources as IaC\n6. **Dynamic inventory** - Never maintain static Ansible inventory\n7. **Audit regularly** - Run `dns_record_audit.py` to verify sync\n\n## DNS Naming Patterns\n\n### Service Types\n\n- `docker-NN-<app>` - Docker hosts\n- `k8s-NN-<role>` - Kubernetes nodes\n- `proxmox-<node>-<iface>` - Proxmox infrastructure\n- `storage-NN-<purpose>` - Storage systems\n- `db-NN-<dbtype>` - Database servers\n\n### Examples from This Infrastructure\n\n```text\ndocker-01-nexus.spaceships.work       # Nexus container registry\nk8s-01-master.spaceships.work         # K8s control plane\nk8s-02-worker.spaceships.work         # K8s worker node\nproxmox-foxtrot-mgmt.spaceships.work  # Proxmox mgmt interface\nproxmox-foxtrot-ceph.spaceships.work  # Proxmox CEPH interface\nstorage-01-nas.spaceships.work        # NAS storage\ndb-01-postgres.spaceships.work        # PostgreSQL database\n```\n\n## Progressive Disclosure\n\nFor deeper knowledge:\n\n### NetBox API & Integration\n\n- [NetBox API Guide](reference/netbox-api-guide.md) - Complete REST API reference with pynetbox examples\n- [NetBox Data Models](reference/netbox-data-models.md) - Data model relationships and hierarchy\n- [NetBox Best Practices](reference/netbox-best-practices.md) - Security, performance, automation patterns\n\n### DNS & PowerDNS Integration\n\n- [Sync Plugin Reference](reference/sync-plugin-reference.md) - PowerDNS sync plugin installation and config\n- [Terraform Provider Guide](reference/terraform-provider-guide.md) - Complete provider documentation\n- [Naming Conventions](workflows/naming-conventions.md) - Detailed DNS naming rules\n- [DNS Automation](workflows/dns-automation.md) - End-to-end automation workflows\n\n### Ansible Integration\n\n- [Ansible Dynamic Inventory](workflows/ansible-dynamic-inventory.md) - Using NetBox as inventory source\n\n### Anti-Patterns & Common Mistakes\n\n- [Common Mistakes](anti-patterns/common-mistakes.md) - DNS naming violations, cluster domain errors, master node targeting,\n  and NetBox integration pitfalls for spaceships.work infrastructure\n\n## Related Skills\n\n- **Proxmox Infrastructure** - VMs auto-registered in NetBox with DNS\n- **Ansible Best Practices** - Dynamic inventory and secrets management"
              }
            ]
          },
          {
            "name": "omni-scale",
            "description": "Sidero Omni + Talos Kubernetes infrastructure management on Proxmox with GitOps deployment patterns",
            "source": "./plugins/homelab/omni-scale",
            "category": "homelab",
            "version": "0.1.7",
            "author": {
              "name": "basher83"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install omni-scale@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [
              {
                "name": "/analyze-spec",
                "description": null,
                "path": "plugins/homelab/omni-scale/commands/analyze-spec.md",
                "frontmatter": null,
                "content": "---\ndescription: Analyze a spec file and generate a deployment plan (flexible structure)\nallowed-tools: Bash(git:*), Bash(eza:*), Bash(test:*), Read, Write, Glob, Grep, AskUserQuestion\nargument-hint: [spec1.yaml] [spec2.yaml]\n---\n\n# Analyze Spec\n\nGenerate a deployment plan using soft guidelines with anchored outputs.\n\n## Variables\n\nPLAN_OUTPUT_DIRECTORY: `${CLAUDE_PROJECT_DIR}/.claude/`\n\n## Context\n\nUp to two specs may be given, only one spec is required to proceed.\n\nSpec files:\n@${CLAUDE_PLUGIN_ROOT}/specs/$1\n@${CLAUDE_PLUGIN_ROOT}/specs/$2\n\nPlan template: @${CLAUDE_PLUGIN_ROOT}/templates/plan-template.md\n\n## Instructions\n\n- Create an implementation plan that is:\n  - Concise enough to scan quickly\n  - Detailed enough to execute effectively\n  - Structured however best fits the content\n- Cover: problem, solution, constraints, phases, blockers, risks\n- **Required sections must appear exactly as specified:**\n\n```markdown\n## Next Action\n\n**Phase:** [N]\n**Task:** [Specific, concrete step]\n**Command:** [Actual command or file to create]\n\n## Critical Files\n\n| File | Why Critical |\n|------|--------------|\n| [path] | [reason] |\n```\n\n- Save the complete implementation plan to `PLAN_OUTPUT_DIRECTORY/plan.local.md`\n\n## Workflow\n\n0. **Readiness Check** (output before proceeding):\n   - What do I know from loaded context? (structure, patterns, constraints)\n   - What's unclear or missing for this spec?\n   - **Planned vs Actual:** Compare any planned counts/values against actual_distribution, exit_criteria, or live cluster state. Flag discrepancies as \"Spec needs reconciliation\"\n   - Key risks I can already identify\n   - **Confidence: X/5** - If < 4, use AskUserQuestion to clarify before proceeding\n\n1. **Understand**: Focus on the requirements provided and apply your assigned perspective throughout the design process\n\n2. **Explore Thoroughly**:\n   - Read any files provided to you in the initial prompt\n   - Find existing patterns and conventions using GLOB, GREP, and READ tools\n   - Understand the current architecture\n\n3. **Design**:\n   - Create implementation approach based on your perspective\n   - Determine phases, dependencies, execution order\n   - Consider trade-offs and architectural decisions\n\n4. **Detail the Plan**:\n   - Provide step-by-step implementation strategy\n   - Identify dependencies and sequencing\n   - Anticipate potential challenges\n   - Let structure adapt to contentdon't force sections that don't fit\n\n## Report\n\nAfter creating and saving the implementation plan, provide a concise report with the following format:\n\n```text\n Implementation Plan Created\n\nFile: PLAN_OUTPUT_DIRECTORY/plan.local.md\nTopic: <brief description of what the plan covers>\nKey Components:\n- <main component 1>\n- <main component 2>\n- <main component 3>\n```\n"
              },
              {
                "name": "/bootstrap-gitops",
                "description": "Bootstrap GitOps stack (ArgoCD, ESO, Longhorn) onto existing Talos cluster",
                "path": "plugins/homelab/omni-scale/commands/bootstrap-gitops.md",
                "frontmatter": {
                  "description": "Bootstrap GitOps stack (ArgoCD, ESO, Longhorn) onto existing Talos cluster",
                  "allowed-tools": "Bash(kubectl:create), mcp__plugin_omni-scale_kubernetes__*"
                },
                "content": "# GitOps Bootstrap\n\nDeploy the GitOps stack onto an existing talos-prod-01 cluster.\n\n**Note:** This is a WIP command that will be refined as bootstrap procedures evolve.\n\n## Prerequisites\n\nBefore starting:\n\n1. **Cluster operational** - Verify with `/omni-scale:status`\n2. **kubectl access** - Nodes showing Ready\n3. **Infisical credentials** - `$INFISICAL_CLIENT_ID` and `$INFISICAL_CLIENT_SECRET` set in environment\n\n## Instructions\n\n### Phase 1: Verify Cluster Ready\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"nodes\")\n```\n\nAll nodes should show `Ready`. If not, stop and troubleshoot.\n\n### Phase 2: Create Bootstrap Secret\n\nThe one manual secret for Infisical authentication:\n\n```bash\nkubectl create namespace external-secrets\n\nkubectl create secret generic universal-auth-credentials \\\n  --namespace external-secrets \\\n  --from-literal=clientId=\"$INFISICAL_CLIENT_ID\" \\\n  --from-literal=clientSecret=\"$INFISICAL_CLIENT_SECRET\"\n```\n\nIf command fails  Stop  Inform user env vars are not properly set.\n\n### Phase 3: Apply Bootstrap\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_apply(manifest: \"https://raw.githubusercontent.com/basher83/mothership-gitops/main/bootstrap/bootstrap.yaml\")\n```\n\nThis deploys the App of Apps which manages everything else.\n\n### Phase 4: Monitor Sync Waves\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"applications\", namespace: \"argocd\")\n```\n\nExpected wave order:\n\n- Wave 0-1: Networking (if managed)\n- Wave 2: Secrets (ESO + ClusterSecretStores)\n- Wave 3-4: Storage (Longhorn)\n- Wave 5: Platform services (Tailscale, Netdata)\n- Wave 99: ArgoCD HA (manual sync)\n\n### Phase 5: Verify Completion\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"applications\", namespace: \"argocd\")\n```\n\nAll apps should show `Synced` and `Healthy`.\n\n### Phase 6: ArgoCD HA Upgrade (Manual)\n\nAfter Longhorn is healthy:\n\n1. Access ArgoCD UI (via Tailscale)\n2. Find `argocd-ha` application\n3. Manually sync it\n\nThis is intentionally manual as a safety gate.\n\n## Troubleshooting\n\n**ESO not creating secrets:**\n\n- Check ClusterSecretStore status\n- Verify Infisical path matches store configuration\n\n**Longhorn volumes pending:**\n\n- Check node disk configuration\n- Patch nodes.longhorn.io with disk paths\n\n**Apps stuck OutOfSync:**\n\n- Check for ignoreDifferences on ESO-managed resources\n- ESO adds default fields that cause drift\n\n## Recovery\n\nIf bootstrap fails mid-way, delete and retry:\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_delete(manifest: \"https://raw.githubusercontent.com/basher83/mothership-gitops/main/bootstrap/bootstrap.yaml\")\n```\n\nFix the issue, then reapply Phase 3."
              },
              {
                "name": "/disaster-recovery",
                "description": "Execute disaster recovery drill - destroy and recreate cluster from specs",
                "path": "plugins/homelab/omni-scale/commands/disaster-recovery.md",
                "frontmatter": {
                  "description": "Execute disaster recovery drill - destroy and recreate cluster from specs",
                  "allowed-tools": "Bash(omnictl:*), Bash(ssh:*), Bash(kubectl:*), Bash(sleep:*), Read, AskUserQuestion, mcp__plugin_omni-scale_kubernetes__*"
                },
                "content": "# Disaster Recovery\n\nFull cluster destruction and recreation from declarative specs.\n\n**WARNING:** This destroys the entire cluster. Only run for DR drills or actual recovery.\n\n**NOTE:** Paths below reference user-specific locations. Consider setting `$OMNI_SCALE_ROOT` if needed.\n\n## Prerequisites\n\n- Access to Omni console (<https://omni.spaceships.work>)\n- omnictl authenticated\n- Infisical credentials available (`$INFISICAL_CLIENT_ID`, `$INFISICAL_CLIENT_SECRET`)\n- Backup of any stateful data (if applicable)\n- Provider connectivity verified:\n\n```bash\nomnictl get infraproviders\n```\n\n## Instructions\n\n### Phase 1: Confirm Intent\n\nUse AskUserQuestion to confirm:\n\n```text\nheader: \"DR Drill\"\nquestion: \"This will DESTROY talos-prod-01 and all workloads. Continue?\"\noptions:\n  - \"Yes, execute DR drill\"\n  - \"No, abort\"\n```\n\nIf user selects abort, stop immediately.\n\n### Phase 2: Capture Current State (Optional)\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"nodes\")\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"pv\")\n```\n\n```bash\nomnictl get machines --cluster talos-prod-01\n```\n\n### Phase 3: Destroy Cluster\n\n**WARNING:** No rollback after this phase. Cluster will be destroyed.\n\n```bash\nomnictl cluster template delete -f ~/dev/infra-as-code/Omni-Scale/clusters/talos-prod-01.yaml --destroy-disconnected-machines\n```\n\n**Poll loop:**\n\n```bash\n# Check status\nssh foxtrot \"pvesh get /cluster/resources --type vm --output-format json\" | jq -r '.[] | select(.name | startswith(\"talos\")) | .name'\n\n# REQUIRED - do not skip or reduce\nsleep 30\n```\n\nRepeat until no talos VMs remain. Max wait: 10 min.\n\nAfter 3 attempts at 30s intervals, INCREASE to 60s. Do not decrease below 30s.\n\nIf timeout exceeded, check failure scenarios below.\n\nUse AskUserQuestion to confirm destruction complete before proceeding.\n\n### Phase 4: Recreate Cluster\n\nApply cluster template:\n\n```bash\nomnictl cluster template sync -f ~/dev/infra-as-code/Omni-Scale/clusters/talos-prod-01.yaml\n```\n\n**Poll loop:**\n\n```bash\n# Check status\nomnictl get machines --cluster talos-prod-01\n\n# REQUIRED - do not skip or reduce\nsleep 30\n```\n\nRepeat until all nodes reach `running` state. Max wait: 20 min.\n\nAfter 3 attempts at 30s intervals, INCREASE to 60s. Do not decrease below 30s.\n\nIf timeout exceeded, check failure scenarios below.\n\n### Phase 4.5: Wait for API Availability\n\n**Poll loop:**\n\n```bash\n# Check status\nomnictl kubeconfig talos-prod-01 --merge\nkubectl get nodes\n\n# REQUIRED - do not skip or reduce\nsleep 30\n```\n\nRepeat until API responds. Max wait: 10 min.\n\nAfter 3 attempts at 30s intervals, INCREASE to 60s. Do not decrease below 30s.\n\nIf timeout exceeded, check failure scenarios below.\n\nUse AskUserQuestion to confirm cluster is ready before GitOps bootstrap.\n\n### Phase 5: Verify Cluster Health\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"nodes\")\n```\n\nAll nodes should show `Ready`.\n\n### Phase 6: Bootstrap GitOps\n\nFollow `/omni-scale:bootstrap-gitops` procedure:\n\n1. Create external-secrets namespace\n2. Create universal-auth-credentials secret\n3. Apply bootstrap.yaml\n\n**Poll loop:**\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"applications\", namespace: \"argocd\")\n```\n\n```bash\n# REQUIRED - do not skip or reduce\nsleep 30\n```\n\nRepeat until all apps show Synced/Healthy. Max wait: 20 min.\n\nAfter 3 attempts at 30s intervals, INCREASE to 60s. Do not decrease below 30s.\n\nIf timeout exceeded, check failure scenarios below.\n\nManually sync ArgoCD HA after Longhorn is healthy.\n\n### Phase 7: Verify Recovery\n\nRun `/omni-scale:status` to confirm full recovery.\n\nCompare against pre-DR state if captured.\n\n## Expected Timeline\n\n| Phase | Duration |\n|-------|----------|\n| Cluster destruction | 2-5 min |\n| VM provisioning | 10-15 min |\n| Kubernetes ready | 5-10 min |\n| GitOps bootstrap | 10-15 min |\n| **Total** | **30-45 min** |\n\n## Failure Scenarios\n\n**VMs not destroying:**\n\n- Check Omni console for errors\n- Manually delete via Proxmox if stuck\n\n**VMs not provisioning:**\n\n- Check provider logs: `scripts/provider-ctl.py --logs 50`\n- Verify service account key not expired\n- Check storage pool availability\n\n**Provider wrong image tag:**\n\n- Must use `:local-fix` tag, not `:latest`\n- Hostname conflict bug in upstream image\n- Check compose.yml in proxmox-provider/\n\n**Nodes not joining:**\n\n- DNS issue - verify split-horizon resolves correctly\n- SideroLink issue - check provider L2 adjacency\n\n**GitOps apps failing:**\n\n- Check ESO ClusterSecretStore health\n- Verify Infisical credentials correct\n- Check namespace PSA labels\n\n**Longhorn volumes not attaching:**\n\n- May need to patch nodes.longhorn.io with disk paths\n- Check node disk configuration matches expectations\n\n## Post-Recovery Checklist\n\n- [ ] All nodes Ready\n- [ ] All ArgoCD apps Synced/Healthy\n- [ ] Longhorn volumes healthy\n- [ ] Tailscale Ingresses accessible\n- [ ] Netdata reporting metrics\n- [ ] ArgoCD HA running (if applicable)"
              },
              {
                "name": "/omni-prime",
                "description": "Load context for a new agent session by analyzing codebase structure and README",
                "path": "plugins/homelab/omni-scale/commands/omni-prime.md",
                "frontmatter": {
                  "allowed-tools": "Bash, Read",
                  "description": "Load context for a new agent session by analyzing codebase structure and README"
                },
                "content": "# Prime\n\nThis command loads essential context for a new agent session.\n\n## Instructions\n\n- Run `git ls-files` to understand the codebase structure and file organization\n- Read the README.md to understand the project purpose, setup instructions, and key information\n- Provide a concise overview of the project based on the gathered context\n\n## Context\n\n- Codebase structure git accessible: !`git ls-files`\n- Codebase structure all: !`eza . --tree`\n- Project README: @${CLAUDE_PROJECT_DIR}/README.md\n- Kernel context: @${CLAUDE_PLUGIN_ROOT}/references/kernel.md\n\n## Tool Usage Patterns\n\n### MCP Kubernetes Tools\n\nUse `mcp__plugin_omni-scale_kubernetes__*` for cluster operations.\n\n**Validation checks  gather this data:**\n\n- **ArgoCD:** Sync status + health status (per app). Flag any NOT Synced+Healthy.\n- **External Secrets:** ClusterSecretStore health, ExternalSecret sync status. Flag failures.\n- **Longhorn:** Volume state (attached/detached) + robustness (healthy/degraded). Flag unhealthy.\n\nUse MCP first. Fall back to kubectl CLI only if MCP output lacks required fields.\n\n### Helm via MCP\n\nLimited to: install, upgrade, uninstall. ArgoCD handles Helm for this stack  MCP Helm rarely needed.\n\n### omnictl\n\n**Cluster status (includes machine health):**\n```bash\nomnictl cluster status <cluster-name>\n```\n\n**List machines (if needed separately):**\n```bash\nomnictl get machines -l omni.sidero.dev/cluster=<cluster-name>\n```\n\nNote: `--cluster` flag does not exist. Use label selector `-l` instead.\n\n## Operational Pattern\n\nWhen an infrastructure operation fails on first attempt:\n1. Check for skill coverage before retrying with variations\n2. Skills encode operational knowledge  \"how do I access X\" is exactly what they're for\n3. Don't guess hostnames, paths, or commands  if it's not documented, ask\n\n## Cross-Repo Gotchas\n\n| Issue | Cause | Resolution |\n|-------|-------|------------|\n| ArgoCD drift on ESO resources | ESO adds default fields | Add `ignoreDifferences` in Application |\n| Pods Pending (privileged workload) | Missing PSA label | `pod-security.kubernetes.io/enforce: privileged` |\n| `mcp__plugin_omni-scale_kubernetes__kubectl_get` lacks CRD status | Basic output, not CRD fields | Use `mcp__plugin_omni-scale_kubernetes__kubectl_generic` with jsonpath or CLI fallback |"
              },
              {
                "name": "/status",
                "description": "Check Omni cluster and GitOps health status",
                "path": "plugins/homelab/omni-scale/commands/status.md",
                "frontmatter": {
                  "description": "Check Omni cluster and GitOps health status",
                  "allowed-tools": "Bash(omnictl:*), mcp__plugin_omni-scale_kubernetes__*"
                },
                "content": "# Cluster Status\n\nQuick health check for Omni-managed Talos cluster and GitOps stack.\n\n## Required Data\n\n### Omni Cluster\n\n- Cluster phase (Running/Provisioning/etc)\n- Node count (control plane vs workers)\n- Overall health status\n\n### Kubernetes Nodes\n\n- Ready status for each node\n- Role (control-plane vs worker)\n- Kubernetes version\n- Talos version\n- Node IPs\n\n### ArgoCD Applications\n\n- Sync status (per app)\n- Health status (per app)\n- **List any apps NOT Synced+Healthy**\n\n### External Secrets\n\n- ClusterSecretStore count and health\n- ExternalSecret count, sync status\n- **List any secrets failing to sync**\n\n### Storage (Longhorn)\n\n- Volume state (attached vs detached)\n- Volume robustness (healthy vs degraded)\n- **List any volumes not attached+healthy**\n\n## Output Format\n\n```text\n## Omni-Scale Status Report\n\n### Omni Cluster: talos-prod-01\n- Phase: [status]\n- Nodes: [X] control plane, [Y] workers\n- Health: [status]\n\n### Kubernetes\n- Nodes Ready: [X/Y]\n- Version: [version]\n- Talos: [version]\n\n[Node table with roles and IPs]\n\n### ArgoCD Applications\n- Total: [N]\n- Synced: [N], OutOfSync: [N]\n- Healthy: [N], Degraded: [N]\n\n[Table showing any non-healthy/non-synced apps]\n\n### External Secrets\n- ClusterSecretStores: [N] healthy\n- ExternalSecrets: [N] synced, [N] failed\n\n[List any failing secrets]\n\n### Storage (Longhorn)\n- Volumes: [N]\n- Healthy: [N]\n- Degraded: [N]\n\n[List any unhealthy volumes]\n\n### Issues Found\n[List problems or \"None\"]\n```"
              }
            ],
            "skills": [
              {
                "name": "omni-talos",
                "description": "This skill provides operational tooling and guidance for Omni Proxmox infrastructure. Use PROACTIVELY when the user asks to \"check provider status\", \"restart provider\", \"view provider logs\", \"debug provider registration\", \"create a machine class\", \"configure Proxmox provider\", \"set up CEL storage selectors\", \"create a Talos cluster\", or needs guidance on Omni + Proxmox infrastructure integration for Talos Kubernetes clusters.",
                "path": "plugins/homelab/omni-scale/skills/omni-proxmox/SKILL.md",
                "frontmatter": {
                  "name": "omni-talos",
                  "description": "This skill provides operational tooling and guidance for Omni Proxmox infrastructure. Use PROACTIVELY when the user asks to \"check provider status\", \"restart provider\", \"view provider logs\", \"debug provider registration\", \"create a machine class\", \"configure Proxmox provider\", \"set up CEL storage selectors\", \"create a Talos cluster\", or needs guidance on Omni + Proxmox infrastructure integration for Talos Kubernetes clusters."
                },
                "content": "# Omni + Proxmox Infrastructure Provider\n\nOperational tooling for Talos Linux Kubernetes clusters via Sidero Omni with Proxmox infrastructure provider.\n\n## Provider Operations\n\nUse `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py` for provider management:\n\n| Task | Command |\n|------|---------|\n| View logs | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --logs 50` |\n| Raw JSON logs | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --logs 50 --raw` |\n| Restart provider | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --restart` |\n\nThe provider runs on Foxtrot LXC (CT 200)  script handles SSH automatically.\n\n## Current Deployment\n\n| Component | Location | IP | Endpoint |\n|-----------|----------|-----|----------|\n| Omni | Holly (VMID 101, Quantum) | 192.168.10.20 | omni.spaceships.work |\n| Proxmox Provider | Foxtrot LXC (CT 200, Matrix) | 192.168.3.10 | L2 adjacent to Talos VMs |\n| Target Cluster | Matrix (Foxtrot/Golf/Hotel) | 192.168.3.{5,6,7} | Proxmox API |\n| Storage | CEPH RBD |  | `vm_ssd` pool |\n\n## Quick Reference\n\n**omnictl commands:**\n\n```bash\nomnictl cluster status <cluster-name>\nomnictl get machines -l omni.sidero.dev/cluster=<cluster-name>\nomnictl get machineclasses\nomnictl apply -f machine-classes/<name>.yaml\nomnictl cluster template sync -f clusters/<name>.yaml\n```\n\nNote: `--cluster` flag does not exist. Use label selector `-l` instead.\n\n**MachineClass minimal example:**\n\n```yaml\nmetadata:\n  namespace: default\n  type: MachineClasses.omni.sidero.dev\n  id: matrix-worker\nspec:\n  autoprovision:\n    providerid: matrix-cluster\n    providerdata: |\n      cores: 4\n      memory: 16384\n      disk_size: 100\n      storage_selector: name == \"vm_ssd\"\n      node: foxtrot\n```\n\nSee `references/machine-classes.md` for full field reference.\n\n## Key Constraints\n\n| Constraint | Details |\n|------------|---------|\n| L2 adjacency | Provider MUST be on same L2 as Talos VMs (Foxtrot LXC) |\n| CEL `type` reserved | Use `name` only for storage selectors |\n| Hostname bug | Use `:local-fix` tag, not `:latest` |\n| No CP pinning | Omni allows only 1 ControlPlane section per template |\n| No VM migration | Destroys node state  destroy/recreate instead |\n| Split-horizon DNS | `omni.spaceships.work`  192.168.10.20 (LAN) |\n\n## Reference Files\n\n| File | Content |\n|------|---------|\n| `references/architecture.md` | Network topology, design decisions |\n| `references/machine-classes.md` | Full provider data fields (compute, storage, network, PCI) |\n| `references/provider-setup.md` | Provider config, compose setup, credentials |\n| `references/cluster-templates.md` | Cluster template structure, patches |\n| `references/cel-storage-selectors.md` | CEL syntax and patterns |\n| `references/debugging.md` | Common issues |\n| `references/recovery-procedures.md` | Recovery from stuck states |\n| `references/proxmox-permissions.md` | API token setup |\n| `references/omnictl-auth.md` | Authentication methods |\n\n## Examples\n\n| File | Description |\n|------|-------------|\n| `examples/machineclass-ceph.yaml` | CEPH storage |\n| `examples/machineclass-local.yaml` | Local LVM |\n| `examples/cluster-template.yaml` | Complete cluster |\n| `examples/proxmox-gpu-worker.yaml` | GPU passthrough |\n| `examples/proxmox-storage-node.yaml` | Storage node |\n| `examples/proxmox-worker-multi-net.yaml` | Multi-network |"
              },
              {
                "name": "omni-talos",
                "description": "This skill provides operational tooling and guidance for Omni Proxmox infrastructure. Use when the user asks to \"check provider status\", \"restart provider\", \"view provider logs\", \"debug provider registration\", \"create a machine class\", \"configure Proxmox provider\", \"set up CEL storage selectors\", \"create a Talos cluster\", or needs guidance on Omni + Proxmox infrastructure integration for Talos Kubernetes clusters.",
                "path": "plugins/homelab/omni-scale/skills/omni-talos/SKILL.md",
                "frontmatter": {
                  "name": "omni-talos",
                  "description": "This skill provides operational tooling and guidance for Omni Proxmox infrastructure. Use when the user asks to \"check provider status\", \"restart provider\", \"view provider logs\", \"debug provider registration\", \"create a machine class\", \"configure Proxmox provider\", \"set up CEL storage selectors\", \"create a Talos cluster\", or needs guidance on Omni + Proxmox infrastructure integration for Talos Kubernetes clusters."
                },
                "content": "# Omni + Proxmox Infrastructure Provider\n\nOperational tooling for Talos Linux Kubernetes clusters via Sidero Omni with Proxmox infrastructure provider.\n\n## Provider Operations\n\nUse `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py` for provider management:\n\n| Task | Command |\n|------|---------|\n| View logs | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --logs 50` |\n| Raw JSON logs | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --logs 50 --raw` |\n| Restart provider | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --restart` |\n\nThe provider runs on Foxtrot LXC (CT 200)  script handles SSH automatically.\n\n## Current Deployment\n\n| Component | Location | IP | Endpoint |\n|-----------|----------|-----|----------|\n| Omni | Holly (VMID 101, Quantum) | 192.168.10.20 | omni.spaceships.work |\n| Proxmox Provider | Foxtrot LXC (CT 200, Matrix) | 192.168.3.10 | L2 adjacent to Talos VMs |\n| Target Cluster | Matrix (Foxtrot/Golf/Hotel) | 192.168.3.{5,6,7} | Proxmox API |\n| Storage | CEPH RBD |  | `vm_ssd` pool |\n\n## Quick Reference\n\n**omnictl commands:**\n\n```bash\nomnictl cluster status <cluster-name>\nomnictl get machines -l omni.sidero.dev/cluster=<cluster-name>\nomnictl get machineclasses\nomnictl apply -f machine-classes/<name>.yaml\nomnictl cluster template sync -f clusters/<name>.yaml\n```\n\nNote: `--cluster` flag does not exist. Use label selector `-l` instead.\n\n**MachineClass minimal example:**\n\n```yaml\nmetadata:\n  namespace: default\n  type: MachineClasses.omni.sidero.dev\n  id: matrix-worker\nspec:\n  autoprovision:\n    providerid: matrix-cluster\n    providerdata: |\n      cores: 4\n      memory: 16384\n      disk_size: 100\n      storage_selector: name == \"vm_ssd\"\n      node: foxtrot\n```\n\nSee `references/machine-classes.md` for full field reference.\n\n## Key Constraints\n\n| Constraint | Details |\n|------------|---------|\n| L2 adjacency | Provider MUST be on same L2 as Talos VMs (Foxtrot LXC) |\n| CEL `type` reserved | Use `name` only for storage selectors |\n| Hostname bug | Use `:local-fix` tag, not `:latest` |\n| No CP pinning | Omni allows only 1 ControlPlane section per template |\n| No VM migration | Destroys node state  destroy/recreate instead |\n| Split-horizon DNS | `omni.spaceships.work`  192.168.10.20 (LAN) |\n\n## Reference Files\n\n| File | Content |\n|------|---------|\n| `references/architecture.md` | Network topology, design decisions |\n| `references/machine-classes.md` | Full provider data fields (compute, storage, network, PCI) |\n| `references/provider-setup.md` | Provider config, compose setup, credentials |\n| `references/cluster-templates.md` | Cluster template structure, patches |\n| `references/cel-storage-selectors.md` | CEL syntax and patterns |\n| `references/debugging.md` | Common issues |\n| `references/recovery-procedures.md` | Recovery from stuck states |\n| `references/proxmox-permissions.md` | API token setup |\n| `references/omnictl-auth.md` | Authentication methods |\n\n## Examples\n\n| File | Description |\n|------|-------------|\n| `examples/machineclass-ceph.yaml` | CEPH storage |\n| `examples/machineclass-local.yaml` | Local LVM |\n| `examples/cluster-template.yaml` | Complete cluster |\n| `examples/proxmox-gpu-worker.yaml` | GPU passthrough |\n| `examples/proxmox-storage-node.yaml` | Storage node |\n| `examples/proxmox-worker-multi-net.yaml` | Multi-network |"
              }
            ]
          },
          {
            "name": "hookify",
            "description": "Easily create hooks to prevent unwanted behaviors by analyzing conversation patterns",
            "source": "./plugins/meta/hookify",
            "category": "meta",
            "version": "0.1.2",
            "author": {
              "name": "Daisy Hollman",
              "email": "daisy@anthropic.com"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install hookify@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [
              {
                "name": "/configure",
                "description": "Enable or disable hookify rules interactively",
                "path": "plugins/meta/hookify/commands/configure.md",
                "frontmatter": {
                  "description": "Enable or disable hookify rules interactively",
                  "allowed-tools": [
                    "Glob",
                    "Read",
                    "Edit",
                    "AskUserQuestion",
                    "Skill"
                  ]
                },
                "content": "# Configure Hookify Rules\n\n**Load hookify:writing-rules skill first** to understand rule format.\n\nEnable or disable existing hookify rules using an interactive interface.\n\n## Steps\n\n### 1. Find Existing Rules\n\nUse Glob tool to find all hookify rule files:\n\n```text\npattern: \".claude/hookify.*.local.md\"\n```\n\nIf no rules found, inform user:\n\n```text\nNo hookify rules configured yet. Use `/hookify` to create your first rule.\n```\n\n### 2. Read Current State\n\nFor each rule file:\n\n- Read the file\n- Extract `name` and `enabled` fields from frontmatter\n- Build list of rules with current state\n\n### 3. Ask User Which Rules to Toggle\n\nUse AskUserQuestion to let user select rules:\n\n```json\n{\n  \"questions\": [\n    {\n      \"question\": \"Which rules would you like to enable or disable?\",\n      \"header\": \"Configure\",\n      \"multiSelect\": true,\n      \"options\": [\n        {\n          \"label\": \"warn-dangerous-rm (currently enabled)\",\n          \"description\": \"Warns about rm -rf commands\"\n        },\n        {\n          \"label\": \"warn-console-log (currently disabled)\",\n          \"description\": \"Warns about console.log in code\"\n        },\n        {\n          \"label\": \"require-tests (currently enabled)\",\n          \"description\": \"Requires tests before stopping\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Option format:**\n\n- Label: `{rule-name} (currently {enabled|disabled})`\n- Description: Brief description from rule's message or pattern\n\n### 4. Parse User Selection\n\nFor each selected rule:\n\n- Determine current state from label (enabled/disabled)\n- Toggle state: enabled  disabled, disabled  enabled\n\n### 5. Update Rule Files\n\nFor each rule to toggle:\n\n- Use Read tool to read current content\n- Use Edit tool to change `enabled: true` to `enabled: false` (or vice versa)\n- Handle both with and without quotes\n\n**Edit pattern for enabling:**\n\n```text\nold_string: \"enabled: false\"\nnew_string: \"enabled: true\"\n```\n\n**Edit pattern for disabling:**\n\n```text\nold_string: \"enabled: true\"\nnew_string: \"enabled: false\"\n```\n\n### 6. Confirm Changes\n\nShow user what was changed:\n\n```text\n## Hookify Rules Updated\n\n**Enabled:**\n- warn-console-log\n\n**Disabled:**\n- warn-dangerous-rm\n\n**Unchanged:**\n- require-tests\n\nChanges apply immediately - no restart needed\n```\n\n## Important Notes\n\n- Changes take effect immediately on next tool use\n- You can also manually edit .claude/hookify.*.local.md files\n- To permanently remove a rule, delete its .local.md file\n- Use `/hookify:list` to see all configured rules\n\n## Edge Cases\n\n**No rules to configure:**\n\n- Show message about using `/hookify` to create rules first\n\n**User selects no rules:**\n\n- Inform that no changes were made\n\n**File read/write errors:**\n\n- Inform user of specific error\n- Suggest manual editing as fallback"
              },
              {
                "name": "/help",
                "description": "Get help with the hookify plugin",
                "path": "plugins/meta/hookify/commands/help.md",
                "frontmatter": {
                  "description": "Get help with the hookify plugin",
                  "allowed-tools": [
                    "Read"
                  ]
                },
                "content": "# Hookify Plugin Help\n\nExplain how the hookify plugin works and how to use it.\n\n## Overview\n\nThe hookify plugin makes it easy to create custom hooks that prevent unwanted behaviors.\nInstead of editing `hooks.json` files, users create simple markdown configuration files\nthat define patterns to watch for.\n\n## How It Works\n\n### 1. Hook System\n\nHookify installs generic hooks that run on these events:\n\n- **PreToolUse**: Before any tool executes (Bash, Edit, Write, etc.)\n- **PostToolUse**: After a tool executes\n- **Stop**: When Claude wants to stop working\n- **UserPromptSubmit**: When user submits a prompt\n\nThese hooks read configuration files from `.claude/hookify.*.local.md` and check if any\nrules match the current operation.\n\n### 2. Configuration Files\n\nUsers create rules in `.claude/hookify.{rule-name}.local.md` files:\n\n```markdown\n---\nname: warn-dangerous-rm\nenabled: true\nevent: bash\npattern: rm\\s+-rf\n---\n\n **Dangerous rm command detected!**\n\nThis command could delete important files. Please verify the path.\n```\n\n**Key fields:**\n\n- `name`: Unique identifier for the rule\n- `enabled`: true/false to activate/deactivate\n- `event`: bash, file, stop, prompt, or all\n- `pattern`: Regex pattern to match\n\nThe message body is what Claude sees when the rule triggers.\n\n### 3. Creating Rules\n\n#### Option A: Use /hookify command\n\n```text\n/hookify Don't use console.log in production files\n```\n\nThis analyzes your request and creates the appropriate rule file.\n\n#### Option B: Create manually\n\nCreate `.claude/hookify.my-rule.local.md` with the format above.\n\n#### Option C: Analyze conversation\n\n```text\n/hookify\n```\n\nWithout arguments, hookify analyzes recent conversation to find behaviors you want to prevent.\n\n## Available Commands\n\n- **`/hookify`** - Create hooks from conversation analysis or explicit instructions\n- **`/hookify:help`** - Show this help (what you're reading now)\n- **`/hookify:list`** - List all configured hooks\n- **`/hookify:configure`** - Enable/disable existing hooks interactively\n\n## Example Use Cases\n\n**Prevent dangerous commands:**\n\n```markdown\n---\nname: block-chmod-777\nenabled: true\nevent: bash\npattern: chmod\\s+777\n---\n\nDon't use chmod 777 - it's a security risk. Use specific permissions instead.\n```\n\n**Warn about debugging code:**\n\n```markdown\n---\nname: warn-console-log\nenabled: true\nevent: file\npattern: console\\.log\\(\n---\n\nConsole.log detected. Remember to remove debug logging before committing.\n```\n\n**Require tests before stopping:**\n\n```markdown\n---\nname: require-tests\nenabled: true\nevent: stop\npattern: .*\n---\n\nDid you run tests before finishing? Make sure `npm test` or equivalent was executed.\n```\n\n## Pattern Syntax\n\nUse Python regex syntax:\n\n- `\\s` - whitespace\n- `\\.` - literal dot\n- `|` - OR\n- `+` - one or more\n- `*` - zero or more\n- `\\d` - digit\n- `[abc]` - character class\n\n**Examples:**\n\n- `rm\\s+-rf` - matches \"rm -rf\"\n- `console\\.log\\(` - matches \"console.log(\"\n- `(eval|exec)\\(` - matches \"eval(\" or \"exec(\"\n- `\\.env$` - matches files ending in .env\n\n## Important Notes\n\n**No Restart Needed**: Hookify rules (`.local.md` files) take effect immediately on\nthe next tool use. The hookify hooks are already loaded and read your rules dynamically.\n\n**Block or Warn**: Rules can either `block` operations (prevent execution) or `warn`\n(show message but allow). Set `action: block` or `action: warn` in the rule's frontmatter.\n\n**Rule Files**: Keep rules in `.claude/hookify.*.local.md` - they should be git-ignored (add to .gitignore if needed).\n\n**Disable Rules**: Set `enabled: false` in frontmatter or delete the file.\n\n## Troubleshooting\n\n**Hook not triggering:**\n\n- Check rule file is in `.claude/` directory\n- Verify `enabled: true` in frontmatter\n- Confirm pattern is valid regex\n- Test pattern: `python3 -c \"import re; print(re.search('your_pattern', 'test_text'))\"`\n- Rules take effect immediately - no restart needed\n\n**Import errors:**\n\n- Check Python 3 is available: `python3 --version`\n- Verify hookify plugin is installed correctly\n\n**Pattern not matching:**\n\n- Test regex separately\n- Check for escaping issues (use unquoted patterns in YAML)\n- Try simpler pattern first, then refine\n\n## Getting Started\n\n1. Create your first rule:\n\n   ```text\n   /hookify Warn me when I try to use rm -rf\n   ```\n\n2. Try to trigger it:\n   - Ask Claude to run `rm -rf /tmp/test`\n   - You should see the warning\n\n3. Refine the rule by editing `.claude/hookify.warn-rm.local.md`\n\n4. Create more rules as you encounter unwanted behaviors\n\nFor more examples, check the `${CLAUDE_PLUGIN_ROOT}/examples/` directory."
              },
              {
                "name": "/hookify",
                "description": "Create hooks to prevent unwanted behaviors from conversation analysis or explicit instructions",
                "path": "plugins/meta/hookify/commands/hookify.md",
                "frontmatter": {
                  "description": "Create hooks to prevent unwanted behaviors from conversation analysis or explicit instructions",
                  "argument-hint": "Optional specific behavior to address",
                  "allowed-tools": [
                    "Read",
                    "Write",
                    "AskUserQuestion",
                    "Task",
                    "Grep",
                    "TodoWrite",
                    "Skill"
                  ]
                },
                "content": "# Hookify - Create Hooks from Unwanted Behaviors\n\n**FIRST: Load the hookify:writing-rules skill** using the Skill tool to understand rule file format and syntax.\n\nCreate hook rules to prevent problematic behaviors by analyzing the conversation or from explicit user instructions.\n\n## Your Task\n\nYou will help the user create hookify rules to prevent unwanted behaviors. Follow these steps:\n\n### Step 1: Gather Behavior Information\n\n**If $ARGUMENTS is provided:**\n\n- User has given specific instructions: `$ARGUMENTS`\n- Still analyze recent conversation (last 10-15 user messages) for additional context\n- Look for examples of the behavior happening\n\n**If $ARGUMENTS is empty:**\n\n- Launch the conversation-analyzer agent to find problematic behaviors\n- Agent will scan user prompts for frustration signals\n- Agent will return structured findings\n\n**To analyze conversation:**\nUse the Task tool to launch conversation-analyzer agent:\n\n```text\n{\n  \"subagent_type\": \"general-purpose\",\n  \"description\": \"Analyze conversation for unwanted behaviors\",\n  \"prompt\": \"You are analyzing a Claude Code conversation to find behaviors the user wants to prevent.\n\nRead user messages in the current conversation and identify:\n1. Explicit requests to avoid something (\\\"don't do X\\\", \\\"stop doing Y\\\")\n2. Corrections or reversions (user fixing Claude's actions)\n3. Frustrated reactions (\\\"why did you do X?\\\", \\\"I didn't ask for that\\\")\n4. Repeated issues (same problem multiple times)\n\nFor each issue found, extract:\n- What tool was used (Bash, Edit, Write, etc.)\n- Specific pattern or command\n- Why it was problematic\n- User's stated reason\n\nReturn findings as a structured list with:\n- category: Type of issue\n- tool: Which tool was involved\n- pattern: Regex or literal pattern to match\n- context: What happened\n- severity: high/medium/low\n\nFocus on the most recent issues (last 20-30 messages). Don't go back further unless explicitly asked.\"\n}\n```\n\n### Step 2: Present Findings to User\n\nAfter gathering behaviors (from arguments or agent), present to user using AskUserQuestion:\n\n**Question 1: Which behaviors to hookify?**\n\n- Header: \"Create Rules\"\n- multiSelect: true\n- Options: List each detected behavior (max 4)\n  - Label: Short description (e.g., \"Block rm -rf\")\n  - Description: Why it's problematic\n\n**Question 2: For each selected behavior, ask about action:**\n\n- \"Should this block the operation or just warn?\"\n- Options:\n  - \"Just warn\" (action: warn - shows message but allows)\n  - \"Block operation\" (action: block - prevents execution)\n\n**Question 3: Ask for example patterns:**\n\n- \"What patterns should trigger this rule?\"\n- Show detected patterns\n- Allow user to refine or add more\n\n### Step 3: Generate Rule Files\n\nFor each confirmed behavior, create a `.claude/hookify.{rule-name}.local.md` file:\n\n**Rule naming convention:**\n\n- Use kebab-case\n- Be descriptive: `block-dangerous-rm`, `warn-console-log`, `require-tests-before-stop`\n- Start with action verb: block, warn, prevent, require\n\n**File format:**\n\n```markdown\n---\nname: {rule-name}\nenabled: true\nevent: {bash|file|stop|prompt|all}\npattern: {regex pattern}\naction: {warn|block}\n---\n\n{Message to show Claude when rule triggers}\n```\n\n**Action values:**\n\n- `warn`: Show message but allow operation (default)\n- `block`: Prevent operation or stop session\n\n**For more complex rules (multiple conditions):**\n\n```markdown\n---\nname: {rule-name}\nenabled: true\nevent: file\nconditions:\n  - field: file_path\n    operator: regex_match\n    pattern: \\.env$\n  - field: new_text\n    operator: contains\n    pattern: API_KEY\n---\n\n{Warning message}\n```\n\n### Step 4: Create Files and Confirm\n\n**IMPORTANT**: Rule files must be created in the current working directory's `.claude/`\nfolder, NOT the plugin directory.\n\nUse the current working directory (where Claude Code was started) as the base path.\n\n1. Check if `.claude/` directory exists in current working directory\n   - If not, create it first with: `mkdir -p .claude`\n\n2. Use Write tool to create each `.claude/hookify.{name}.local.md` file\n   - Use relative path from current working directory: `.claude/hookify.{name}.local.md`\n   - The path should resolve to the project's .claude directory, not the plugin's\n\n3. Show user what was created:\n\n   ```text\n   Created 3 hookify rules:\n   - .claude/hookify.dangerous-rm.local.md\n   - .claude/hookify.console-log.local.md\n   - .claude/hookify.sensitive-files.local.md\n\n   These rules will trigger on:\n   - dangerous-rm: Bash commands matching \"rm -rf\"\n   - console-log: Edits adding console.log statements\n   - sensitive-files: Edits to .env or credentials files\n   ```\n\n4. Verify files were created in the correct location by listing them\n\n5. Inform user: **\"Rules are active immediately - no restart needed!\"**\n\n   The hookify hooks are already loaded and will read your new rules on the next tool use.\n\n## Event Types Reference\n\n- **bash**: Matches Bash tool commands\n- **file**: Matches Edit, Write, MultiEdit tools\n- **stop**: Matches when agent wants to stop (use for completion checks)\n- **prompt**: Matches when user submits prompts\n- **all**: Matches all events\n\n## Pattern Writing Tips\n\n**Bash patterns:**\n\n- Match dangerous commands: `rm\\s+-rf|chmod\\s+777|dd\\s+if=`\n- Match specific tools: `npm\\s+install\\s+|pip\\s+install`\n\n**File patterns:**\n\n- Match code patterns: `console\\.log\\(|eval\\(|innerHTML\\s*=`\n- Match file paths: `\\.env$|\\.git/|node_modules/`\n\n**Stop patterns:**\n\n- Check for missing steps: (check transcript or completion criteria)\n\n## Example Workflow\n\n**User says**: \"/hookify Don't use rm -rf without asking me first\"\n\n**Your response**:\n\n1. Analyze: User wants to prevent rm -rf commands\n2. Ask: \"Should I block this command or just warn you?\"\n3. User selects: \"Just warn\"\n4. Create `.claude/hookify.dangerous-rm.local.md`:\n\n   ```markdown\n   ---\n   name: warn-dangerous-rm\n   enabled: true\n   event: bash\n   pattern: rm\\s+-rf\n   ---\n\n    **Dangerous rm command detected**\n\n   You requested to be warned before using rm -rf.\n   Please verify the path is correct.\n   ```\n\n5. Confirm: \"Created hookify rule. It's active immediately - try triggering it!\"\n\n## Important Notes\n\n- **No restart needed**: Rules take effect immediately on the next tool use\n- **File location**: Create files in project's `.claude/` directory (current working\n  directory), NOT the plugin's .claude/\n- **Regex syntax**: Use Python regex syntax (raw strings, no need to escape in YAML)\n- **Action types**: Rules can `warn` (default) or `block` operations\n- **Testing**: Test rules immediately after creating them\n\n## Troubleshooting\n\n**If rule file creation fails:**\n\n1. Check current working directory with pwd\n2. Ensure `.claude/` directory exists (create with mkdir if needed)\n3. Use absolute path if needed: `{cwd}/.claude/hookify.{name}.local.md`\n4. Verify file was created with Glob or ls\n\n**If rule doesn't trigger after creation:**\n\n1. Verify file is in project `.claude/` not plugin `.claude/`\n2. Check file with Read tool to ensure pattern is correct\n3. Test pattern with: `python3 -c \"import re; print(re.search(r'pattern', 'test text'))\"`\n4. Verify `enabled: true` in frontmatter\n5. Remember: Rules work immediately, no restart needed\n\n**If blocking seems too strict:**\n\n1. Change `action: block` to `action: warn` in the rule file\n2. Or adjust the pattern to be more specific\n3. Changes take effect on next tool use\n\nUse TodoWrite to track your progress through the steps."
              },
              {
                "name": "/list",
                "description": "List all configured hookify rules",
                "path": "plugins/meta/hookify/commands/list.md",
                "frontmatter": {
                  "description": "List all configured hookify rules",
                  "allowed-tools": [
                    "Glob",
                    "Read",
                    "Skill"
                  ]
                },
                "content": "# List Hookify Rules\n\n**Load hookify:writing-rules skill first** to understand rule format.\n\nShow all configured hookify rules in the project.\n\n## Steps\n\n1. Use Glob tool to find all hookify rule files:\n\n   ```text\n   pattern: \".claude/hookify.*.local.md\"\n   ```\n\n2. For each file found:\n   - Use Read tool to read the file\n   - Extract frontmatter fields: name, enabled, event, pattern\n   - Extract message preview (first 100 chars)\n\n3. Present results in a table:\n\n```text\n## Configured Hookify Rules\n\n| Name | Enabled | Event | Pattern | File |\n|------|---------|-------|---------|------|\n| warn-dangerous-rm |  Yes | bash | rm\\s+-rf | hookify.dangerous-rm.local.md |\n| warn-console-log |  Yes | file | console\\.log\\( | hookify.console-log.local.md |\n| check-tests |  No | stop | .* | hookify.require-tests.local.md |\n\n**Total**: 3 rules (2 enabled, 1 disabled)\n```\n\n1. For each rule, show a brief preview:\n\n```text\n### warn-dangerous-rm\n**Event**: bash\n**Pattern**: `rm\\s+-rf`\n**Message**: \" **Dangerous rm command detected!** This command could delete...\"\n\n**Status**:  Active\n**File**: .claude/hookify.dangerous-rm.local.md\n```\n\n1. Add helpful footer:\n\n```text\n---\n\nTo modify a rule: Edit the .local.md file directly\nTo disable a rule: Set `enabled: false` in frontmatter\nTo enable a rule: Set `enabled: true` in frontmatter\nTo delete a rule: Remove the .local.md file\nTo create a rule: Use `/hookify` command\n\n**Remember**: Changes take effect immediately - no restart needed\n```\n\n## If No Rules Found\n\nIf no hookify rules exist:\n\n```text\n## No Hookify Rules Configured\n\nYou haven't created any hookify rules yet.\n\nTo get started:\n1. Use `/hookify` to analyze conversation and create rules\n2. Or manually create `.claude/hookify.my-rule.local.md` files\n3. See `/hookify:help` for documentation\n\nExample:\n```\n\n/hookify Warn me when I use console.log\n\n```text\n\nCheck `${CLAUDE_PLUGIN_ROOT}/examples/` for example rule files.\n```"
              }
            ],
            "skills": [
              {
                "name": "Writing Hookify Rules",
                "description": "This skill should be used when the user asks to \"create a hookify rule\", \"write a hook rule\", \"configure hookify\", \"add a hookify rule\", or needs guidance on hookify rule syntax and patterns.\n",
                "path": "plugins/meta/hookify/skills/writing-rules/SKILL.md",
                "frontmatter": {
                  "name": "Writing Hookify Rules",
                  "description": "This skill should be used when the user asks to \"create a hookify rule\", \"write a hook rule\", \"configure hookify\", \"add a hookify rule\", or needs guidance on hookify rule syntax and patterns.\n"
                },
                "content": "# Writing Hookify Rules\n\n## Overview\n\nHookify rules are markdown files with YAML frontmatter that define patterns to watch for\nand messages to show when those patterns match. Rules are stored in\n`.claude/hookify.{rule-name}.local.md` files.\n\n## Rule File Format\n\n### Basic Structure\n\n```markdown\n---\nname: rule-identifier\nenabled: true\nevent: bash|file|stop|prompt|all\npattern: regex-pattern-here\n---\n\nMessage to show Claude when this rule triggers.\nCan include markdown formatting, warnings, suggestions, etc.\n```\n\n### Frontmatter Fields\n\n**name** (required): Unique identifier for the rule\n\n- Use kebab-case: `warn-dangerous-rm`, `block-console-log`\n- Be descriptive and action-oriented\n- Start with verb: warn, prevent, block, require, check\n\n**enabled** (required): Boolean to activate/deactivate\n\n- `true`: Rule is active\n- `false`: Rule is disabled (won't trigger)\n- Can toggle without deleting rule\n\n**event** (required): Which hook event to trigger on\n\n- `bash`: Bash tool commands\n- `file`: Edit, Write, MultiEdit tools\n- `stop`: When agent wants to stop\n- `prompt`: When user submits a prompt\n- `all`: All events\n\n**action** (optional): What to do when rule matches\n\n- `warn`: Show message but allow operation (default)\n- `block`: Prevent operation (PreToolUse) or stop session (Stop events)\n- If omitted, defaults to `warn`\n\n**pattern** (simple format): Regex pattern to match\n\n- Used for simple single-condition rules\n- Matches against command (bash) or new_text (file)\n- Python regex syntax\n\n**Example:**\n\n```yaml\nevent: bash\npattern: rm\\s+-rf\n```\n\n### Advanced Format (Multiple Conditions)\n\nFor complex rules with multiple conditions:\n\n```markdown\n---\nname: warn-env-file-edits\nenabled: true\nevent: file\nconditions:\n  - field: file_path\n    operator: regex_match\n    pattern: \\.env$\n  - field: new_text\n    operator: contains\n    pattern: API_KEY\n---\n\nYou're adding an API key to a .env file. Ensure this file is in .gitignore!\n```\n\n**Condition fields:**\n\n- `field`: Which field to check\n  - For bash: `command`\n  - For file: `file_path`, `new_text`, `old_text`, `content`\n- `operator`: How to match\n  - `regex_match`: Regex pattern matching\n  - `contains`: Substring check\n  - `equals`: Exact match\n  - `not_contains`: Substring must NOT be present\n  - `starts_with`: Prefix check\n  - `ends_with`: Suffix check\n- `pattern`: Pattern or string to match\n\n**All conditions must match for rule to trigger.**\n\n## Message Body\n\nThe markdown content after frontmatter is shown to Claude when the rule triggers.\n\n**Good messages:**\n\n- Explain what was detected\n- Explain why it's problematic\n- Suggest alternatives or best practices\n- Use formatting for clarity (bold, lists, etc.)\n\n**Example:**\n\n```markdown\n **Console.log detected!**\n\nYou're adding console.log to production code.\n\n**Why this matters:**\n- Debug logs shouldn't ship to production\n- Console.log can expose sensitive data\n- Impacts browser performance\n\n**Alternatives:**\n- Use a proper logging library\n- Remove before committing\n- Use conditional debug builds\n```\n\n## Event Type Guide\n\n### bash Events\n\nMatch Bash command patterns:\n\n```markdown\n---\nevent: bash\npattern: sudo\\s+|rm\\s+-rf|chmod\\s+777\n---\n\nDangerous command detected!\n```\n\n**Common patterns:**\n\n- Dangerous commands: `rm\\s+-rf`, `dd\\s+if=`, `mkfs`\n- Privilege escalation: `sudo\\s+`, `su\\s+`\n- Permission issues: `chmod\\s+777`, `chown\\s+root`\n\n### file Events\n\nMatch Edit/Write/MultiEdit operations:\n\n```markdown\n---\nevent: file\npattern: console\\.log\\(|eval\\(|innerHTML\\s*=\n---\n\nPotentially problematic code pattern detected!\n```\n\n**Match on different fields:**\n\n```markdown\n---\nevent: file\nconditions:\n  - field: file_path\n    operator: regex_match\n    pattern: \\.tsx?$\n  - field: new_text\n    operator: regex_match\n    pattern: console\\.log\\(\n---\n\nConsole.log in TypeScript file!\n```\n\n**Common patterns:**\n\n- Debug code: `console\\.log\\(`, `debugger`, `print\\(`\n- Security risks: `eval\\(`, `innerHTML\\s*=`, `dangerouslySetInnerHTML`\n- Sensitive files: `\\.env$`, `credentials`, `\\.pem$`\n- Generated files: `node_modules/`, `dist/`, `build/`\n\n### stop Events\n\nMatch when agent wants to stop (completion checks):\n\n```markdown\n---\nevent: stop\npattern: .*\n---\n\nBefore stopping, verify:\n- [ ] Tests were run\n- [ ] Build succeeded\n- [ ] Documentation updated\n```\n\n**Use for:**\n\n- Reminders about required steps\n- Completion checklists\n- Process enforcement\n\n### prompt Events\n\nMatch user prompt content (advanced):\n\n```markdown\n---\nevent: prompt\nconditions:\n  - field: user_prompt\n    operator: contains\n    pattern: deploy to production\n---\n\nProduction deployment checklist:\n- [ ] Tests passing?\n- [ ] Reviewed by team?\n- [ ] Monitoring ready?\n```\n\n## Pattern Writing Tips\n\n### Regex Basics\n\n**Literal characters:** Most characters match themselves\n\n- `rm` matches \"rm\"\n- `console.log` matches \"console.log\"\n\n**Special characters need escaping:**\n\n- `.` (any char)  `\\.` (literal dot)\n- `(` `)`  `\\(` `\\)` (literal parens)\n- `[` `]`  `\\[` `\\]` (literal brackets)\n\n**Common metacharacters:**\n\n- `\\s` - whitespace (space, tab, newline)\n- `\\d` - digit (0-9)\n- `\\w` - word character (a-z, A-Z, 0-9, _)\n- `.` - any character\n- `+` - one or more\n- `*` - zero or more\n- `?` - zero or one\n- `|` - OR\n\n**Examples:**\n\n```text\nrm\\s+-rf         Matches: rm -rf, rm  -rf\nconsole\\.log\\(   Matches: console.log(\n(eval|exec)\\(    Matches: eval( or exec(\nchmod\\s+777      Matches: chmod 777, chmod  777\nAPI_KEY\\s*=      Matches: API_KEY=, API_KEY =\n```\n\n### Testing Patterns\n\nTest regex patterns before using:\n\n```bash\npython3 -c \"import re; print(re.search(r'your_pattern', 'test text'))\"\n```\n\nOr use online regex testers (regex101.com with Python flavor).\n\n### Common Pitfalls\n\n**Too broad:**\n\n```yaml\npattern: log    # Matches \"log\", \"login\", \"dialog\", \"catalog\"\n```\n\nBetter: `console\\.log\\(|logger\\.`\n\n**Too specific:**\n\n```yaml\npattern: rm -rf /tmp  # Only matches exact path\n```\n\nBetter: `rm\\s+-rf`\n\n**Escaping issues:**\n\n- YAML quoted strings: `\"pattern\"` requires double backslashes `\\\\s`\n- YAML unquoted: `pattern: \\s` works as-is\n- **Recommendation**: Use unquoted patterns in YAML\n\n## File Organization\n\n**Location:** All rules in `.claude/` directory\n**Naming:** `.claude/hookify.{descriptive-name}.local.md`\n**Gitignore:** Add `.claude/*.local.md` to `.gitignore`\n\n**Good names:**\n\n- `hookify.dangerous-rm.local.md`\n- `hookify.console-log.local.md`\n- `hookify.require-tests.local.md`\n- `hookify.sensitive-files.local.md`\n\n**Bad names:**\n\n- `hookify.rule1.local.md` (not descriptive)\n- `hookify.md` (missing .local)\n- `danger.local.md` (missing hookify prefix)\n\n## Workflow\n\n### Creating a Rule\n\n1. Identify unwanted behavior\n2. Determine which tool is involved (Bash, Edit, etc.)\n3. Choose event type (bash, file, stop, etc.)\n4. Write regex pattern\n5. Create `.claude/hookify.{name}.local.md` file in project root\n6. Test immediately - rules are read dynamically on next tool use\n\n### Refining a Rule\n\n1. Edit the `.local.md` file\n2. Adjust pattern or message\n3. Test immediately - changes take effect on next tool use\n\n### Disabling a Rule\n\n**Temporary:** Set `enabled: false` in frontmatter\n**Permanent:** Delete the `.local.md` file\n\n## Examples\n\nSee `${CLAUDE_PLUGIN_ROOT}/examples/` for complete examples:\n\n- `dangerous-rm.local.md` - Block dangerous rm commands\n- `console-log-warning.local.md` - Warn about console.log\n- `sensitive-files-warning.local.md` - Warn about editing .env files\n\n## Quick Reference\n\n**Minimum viable rule:**\n\n```markdown\n---\nname: my-rule\nenabled: true\nevent: bash\npattern: dangerous_command\n---\n\nWarning message here\n```\n\n**Rule with conditions:**\n\n```markdown\n---\nname: my-rule\nenabled: true\nevent: file\nconditions:\n  - field: file_path\n    operator: regex_match\n    pattern: \\.ts$\n  - field: new_text\n    operator: contains\n    pattern: any\n---\n\nWarning message\n```\n\n**Event types:**\n\n- `bash` - Bash commands\n- `file` - File edits\n- `stop` - Completion checks\n- `prompt` - User input\n- `all` - All events\n\n**Field options:**\n\n- Bash: `command`\n- File: `file_path`, `new_text`, `old_text`, `content`\n- Prompt: `user_prompt`\n\n**Operators:**\n\n- `regex_match`, `contains`, `equals`, `not_contains`, `starts_with`, `ends_with`"
              }
            ]
          },
          {
            "name": "plugin-dev",
            "description": "Comprehensive plugin development toolkit for creating Claude Code plugins with AI-powered guidance for skills, agents, commands, and hooks",
            "source": "./plugins/meta/plugin-dev",
            "category": "meta",
            "version": "1.0.3",
            "author": {
              "name": "basher83"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install plugin-dev@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [
              {
                "name": "/consider",
                "description": "Add, update, or review plugin-dev design considerations",
                "path": "plugins/meta/plugin-dev/commands/consider.md",
                "frontmatter": {
                  "description": "Add, update, or review plugin-dev design considerations",
                  "allowed-tools": [
                    "Read",
                    "Edit",
                    "Write",
                    "AskUserQuestion"
                  ]
                },
                "content": "# Plugin-Dev Considerations Manager\n\nManage design considerations, decisions, and ideas in `.claude/plugin-dev-considerations.local.md`.\n\n---\n\n## Workflow\n\n1. Check if `.claude/plugin-dev-considerations.local.md` exists\n2. If not, create it with this structure:\n\n```markdown\n---\ntype: design-considerations\nplugin: plugin-dev\nlast_updated: [today]\n---\n\n# Plugin-Dev Design Considerations\n\nTracking decisions, future ideas, and observations that emerge during development.\n\n## Open Considerations\n\n(none yet)\n\n## Decisions Made\n\n(none yet)\n\n## Future Ideas\n\n(none yet)\n```\n\n3. Read and show current state:\n   - Count of open CON entries\n   - Count of DEC entries\n   - Count of IDEA entries\n\n4. Ask user what to do:\n   - Add consideration (CON)\n   - Add decision (DEC)\n   - Add idea (IDEA)\n   - Update existing entry\n   - Just reviewing (done)\n\n5. Based on selection, gather needed info and add/update entry\n\n6. Update `last_updated` in frontmatter\n\n---\n\n## Entry Formats\n\n**CON (Consideration):**\n```markdown\n### CON-XXX: [title]\n\n**Raised:** [date]\n**Context:** [where this came up]\n**Status:** Under consideration\n\n**Observation:**\n[what was noticed]\n\n**Next action:** [what to do next]\n```\n\n**DEC (Decision):**\n```markdown\n### DEC-XXX: [title]\n\n**Date:** [date]\n**Context:** [what prompted this]\n\n**Decision:** [what was decided]\n\n**Rationale:** [why]\n```\n\n**IDEA (Future Idea):**\n```markdown\n### IDEA-XXX: [title]\n\n[brief description]\n```\n\n---\n\n## Numbering\n\nFind highest existing number in each category and increment by 1."
              },
              {
                "name": "/create-plugin",
                "description": "Guided end-to-end plugin creation workflow with component design, implementation, and validation",
                "path": "plugins/meta/plugin-dev/commands/create-plugin.md",
                "frontmatter": {
                  "description": "Guided end-to-end plugin creation workflow with component design, implementation, and validation",
                  "argument-hint": "Optional plugin description"
                },
                "content": "# Plugin Creation Workflow\n\nGuide the user through creating a complete, high-quality Claude Code plugin from initial concept to tested implementation. Follow a systematic approach: understand requirements, design components, clarify details, implement following best practices, validate, and test.\n\n## Core Principles\n\n- **Ask clarifying questions**: Identify all ambiguities about plugin purpose, triggering, scope, and components. Ask specific, concrete questions rather than making assumptions. Wait for user answers before proceeding with implementation.\n- **Load relevant skills**: Use the Skill tool to load plugin-dev skills when needed (plugin-structure, hook-development, agent-development, etc.)\n- **Use specialized agents**: Leverage agent-creator, plugin-validator, and skill-reviewer agents for AI-assisted development\n- **Follow best practices**: Apply patterns from plugin-dev's own implementation\n- **Progressive disclosure**: Create lean skills with references/examples\n- **Use TodoWrite**: Track all progress throughout all phases\n\n**Initial request:** $ARGUMENTS\n\n---\n\n## Phase 1: Discovery\n\n**Goal**: Understand what plugin needs to be built and what problem it solves\n\n**Actions**:\n\n1. Create todo list with all 7 phases\n2. If plugin purpose is clear from arguments:\n   - Summarize understanding\n   - Identify plugin type (integration, workflow, analysis, toolkit, etc.)\n3. If plugin purpose is unclear, ask user:\n   - What problem does this plugin solve?\n   - Who will use it and when?\n   - What should it do?\n   - Any similar plugins to reference?\n4. Summarize understanding and confirm with user before proceeding\n\n**Output**: Clear statement of plugin purpose and target users\n\n---\n\n## Phase 2: Component Planning\n\n**Goal**: Determine what plugin components are needed\n\n**MUST load plugin-structure skill** using Skill tool before this phase.\n\n**Actions**:\n\n1. Load plugin-structure skill to understand component types\n2. Analyze plugin requirements and determine needed components:\n   - **Skills**: Does it need specialized knowledge? (hooks API, MCP patterns, etc.)\n   - **Commands**: User-initiated actions? (deploy, configure, analyze)\n   - **Agents**: Autonomous tasks? (validation, generation, analysis)\n   - **Hooks**: Event-driven automation? (validation, notifications)\n   - **MCP**: External service integration? (databases, APIs)\n   - **Settings**: User configuration? (.local.md files)\n3. For each component type needed, identify:\n   - How many of each type\n   - What each one does\n   - Rough triggering/usage patterns\n4. Present component plan to user as table:\n\n   ```text\n   | Component Type | Count | Purpose |\n   |----------------|-------|---------|\n   | Skills         | 2     | Hook patterns, MCP usage |\n   | Commands       | 3     | Deploy, configure, validate |\n   | Agents         | 1     | Autonomous validation |\n   | Hooks          | 0     | Not needed |\n   | MCP            | 1     | Database integration |\n   ```\n\n5. Get user confirmation or adjustments\n\n**Output**: Confirmed list of components to create\n\n---\n\n## Phase 3: Detailed Design & Clarifying Questions\n\n**Goal**: Specify each component in detail and resolve all ambiguities\n\n**CRITICAL**: This is one of the most important phases. DO NOT SKIP.\n\n**Actions**:\n\n1. For each component in the plan, identify underspecified aspects:\n   - **Skills**: What triggers them? What knowledge do they provide? How detailed?\n   - **Commands**: What arguments? What tools? Interactive or automated?\n   - **Agents**: When to trigger (proactive/reactive)? What tools? Output format?\n   - **Hooks**: Which events? Prompt or command based? Validation criteria?\n   - **MCP**: What server type? Authentication? Which tools?\n   - **Settings**: What fields? Required vs optional? Defaults?\n\n2. **Present all questions to user in organized sections** (one section per component type)\n\n3. **Wait for answers before proceeding to implementation**\n\n4. If user says \"whatever you think is best\", provide specific recommendations and get explicit confirmation\n\n**Example questions for a skill**:\n\n- What specific user queries should trigger this skill?\n- Should it include utility scripts? What functionality?\n- How detailed should the core SKILL.md be vs references/?\n- Any real-world examples to include?\n\n**Example questions for an agent**:\n\n- Should this agent trigger proactively after certain actions, or only when explicitly requested?\n- What tools does it need (Read, Write, Bash, etc.)?\n- What should the output format be?\n- Any specific quality standards to enforce?\n\n**Output**: Detailed specification for each component\n\n---\n\n## Phase 4: Plugin Structure Creation\n\n**Goal**: Create plugin directory structure and manifest\n\n**Actions**:\n\n1. Determine plugin name (kebab-case, descriptive)\n2. Choose plugin location:\n   - Ask user: \"Where should I create the plugin?\"\n   - Offer options: current directory, ../new-plugin-name, custom path\n3. Create directory structure using bash:\n\n   ```bash\n   mkdir -p plugin-name/.claude-plugin\n   mkdir -p plugin-name/skills     # if needed\n   mkdir -p plugin-name/commands   # if needed\n   mkdir -p plugin-name/agents     # if needed\n   mkdir -p plugin-name/hooks      # if needed\n   ```\n\n4. Create plugin.json manifest using Write tool:\n\n   ```json\n   {\n     \"name\": \"plugin-name\",\n     \"version\": \"0.1.0\",\n     \"description\": \"[brief description]\",\n     \"author\": {\n       \"name\": \"[author from user or default]\",\n       \"email\": \"[email or default]\"\n     }\n   }\n   ```\n\n5. Create README.md template\n6. Create .gitignore if needed (for .claude/*.local.md, etc.)\n7. Initialize git repo if creating new directory\n\n**Output**: Plugin directory structure created and ready for components\n\n---\n\n## Phase 5: Component Implementation\n\n**Goal**: Create each component following best practices\n\n**LOAD RELEVANT SKILLS** before implementing each component type:\n\n- Skills: Load skill-development skill\n- Commands: Load command-development skill\n- Agents: Load agent-development skill\n- Hooks: Load hook-development skill\n- MCP: Load mcp-integration skill\n- Settings: Load plugin-settings skill\n\n**Actions for each component**:\n\n### For Skills\n\n1. Load skill-development skill using Skill tool\n2. For each skill:\n   - Ask user for concrete usage examples (or use from Phase 3)\n   - Plan resources (scripts/, references/, examples/)\n   - Create skill directory structure\n   - Write SKILL.md with:\n     - Third-person description with specific trigger phrases\n     - Lean body (1,500-2,000 words) in imperative form\n     - References to supporting files\n   - Create reference files for detailed content\n   - Create example files for working code\n   - Create utility scripts if needed\n3. Use skill-reviewer agent to validate each skill\n\n### For Commands\n\n1. Load command-development skill using Skill tool\n2. For each command:\n   - Write command markdown with frontmatter\n   - Include clear description and argument-hint\n   - Specify allowed-tools (minimal necessary)\n   - Write instructions FOR Claude (not TO user)\n   - Provide usage examples and tips\n   - Reference relevant skills if applicable\n\n### For Agents\n\n1. Load agent-development skill using Skill tool\n2. For each agent, use agent-creator agent:\n   - Provide description of what agent should do\n   - Agent-creator generates: identifier, whenToUse with examples, systemPrompt\n   - Create agent markdown file with frontmatter and system prompt\n   - Add appropriate model, color, and tools\n   - Validate with validate-agent.sh script\n\n### For Hooks\n\n1. Load hook-development skill using Skill tool\n2. For each hook:\n   - Create hooks/hooks.json with hook configuration\n   - Prefer prompt-based hooks for complex logic\n   - Use ${CLAUDE_PLUGIN_ROOT} for portability\n   - Create hook scripts if needed (in examples/ not scripts/)\n   - Test with validate-hook-schema.sh and test-hook.sh utilities\n\n### For MCP\n\n1. Load mcp-integration skill using Skill tool\n2. Create .mcp.json configuration with:\n   - Server type (stdio for local, SSE for hosted)\n   - Command and args (with ${CLAUDE_PLUGIN_ROOT})\n   - extensionToLanguage mapping if LSP\n   - Environment variables as needed\n3. Document required env vars in README\n4. Provide setup instructions\n\n### For Settings\n\n1. Load plugin-settings skill using Skill tool\n2. Create settings template in README\n3. Create example .claude/plugin-name.local.md file (as documentation)\n4. Implement settings reading in hooks/commands as needed\n5. Add to .gitignore: `.claude/*.local.md`\n\n**Progress tracking**: Update todos as each component is completed\n\n**Output**: All plugin components implemented\n\n---\n\n## Phase 6: Validation & Quality Check\n\n**Goal**: Ensure plugin meets quality standards and works correctly\n\n**Actions**:\n\n1. **Run plugin-validator agent**:\n   - Use plugin-validator agent to comprehensively validate plugin\n   - Check: manifest, structure, naming, components, security\n   - Review validation report\n\n2. **Fix critical issues**:\n   - Address any critical errors from validation\n   - Fix any warnings that indicate real problems\n\n3. **Review with skill-reviewer** (if plugin has skills):\n   - For each skill, use skill-reviewer agent\n   - Check description quality, progressive disclosure, writing style\n   - Apply recommendations\n\n4. **Test agent triggering** (if plugin has agents):\n   - For each agent, verify <example> blocks are clear\n   - Check triggering conditions are specific\n   - Run validate-agent.sh on agent files\n\n5. **Test hook configuration** (if plugin has hooks):\n   - Run validate-hook-schema.sh on hooks/hooks.json\n   - Test hook scripts with test-hook.sh\n   - Verify ${CLAUDE_PLUGIN_ROOT} usage\n\n6. **Present findings**:\n   - Summary of validation results\n   - Any remaining issues\n   - Overall quality assessment\n\n7. **Ask user**: \"Validation complete. Issues found: [count critical], [count warnings]. Would you like me to fix them now, or proceed to testing?\"\n\n**Output**: Plugin validated and ready for testing\n\n---\n\n## Phase 7: Testing & Verification\n\n**Goal**: Test that plugin works correctly in Claude Code\n\n**Actions**:\n\n1. **Installation instructions**:\n   - Show user how to test locally:\n     ```bash\n     cc --plugin-dir /path/to/plugin-name\n     ```\n   - Or copy to `.claude-plugin/` for project testing\n\n2. **Verification checklist** for user to perform:\n   - [ ] Skills load when triggered (ask questions with trigger phrases)\n   - [ ] Commands appear in `/help` and execute correctly\n   - [ ] Agents trigger on appropriate scenarios\n   - [ ] Hooks activate on events (if applicable)\n   - [ ] MCP servers connect (if applicable)\n   - [ ] Settings files work (if applicable)\n\n3. **Testing recommendations**:\n   - For skills: Ask questions using trigger phrases from descriptions\n   - For commands: Run `/plugin-name:command-name` with various arguments\n   - For agents: Create scenarios matching agent examples\n   - For hooks: Use `claude --debug` to see hook execution\n   - For MCP: Use `/mcp` to verify servers and tools\n\n4. **Ask user**: \"I've prepared the plugin for testing. Would you like me to guide you through testing each component, or do you want to test it yourself?\"\n\n5. **If user wants guidance**, walk through testing each component with specific test cases\n\n**Output**: Plugin tested and verified working\n\n---\n\n## Phase 8: Documentation & Next Steps\n\n**Goal**: Ensure plugin is well-documented and ready for distribution\n\n**Actions**:\n\n1. **Verify README completeness**:\n   - Check README has: overview, features, installation, prerequisites, usage\n   - For MCP plugins: Document required environment variables\n   - For hook plugins: Explain hook activation\n   - For settings: Provide configuration templates\n\n2. **Add marketplace entry** (if publishing):\n   - Show user how to add to marketplace.json\n   - Help draft marketplace description\n   - Suggest category and tags\n\n3. **Create summary**:\n   - Mark all todos complete\n   - List what was created:\n     - Plugin name and purpose\n     - Components created (X skills, Y commands, Z agents, etc.)\n     - Key files and their purposes\n     - Total file count and structure\n   - Next steps:\n     - Testing recommendations\n     - Publishing to marketplace (if desired)\n     - Iteration based on usage\n\n4. **Suggest improvements** (optional):\n   - Additional components that could enhance plugin\n   - Integration opportunities\n   - Testing strategies\n\n**Output**: Complete, documented plugin ready for use or publication\n\n---\n\n## Important Notes\n\n### Throughout All Phases\n\n- **Use TodoWrite** to track progress at every phase\n- **Load skills with Skill tool** when working on specific component types\n- **Use specialized agents** (agent-creator, plugin-validator, skill-reviewer)\n- **Ask for user confirmation** at key decision points\n- **Follow plugin-dev's own patterns** as reference examples\n- **Apply best practices**:\n  - Third-person descriptions for skills\n  - Imperative form in skill bodies\n  - Commands written FOR Claude\n  - Strong trigger phrases\n  - ${CLAUDE_PLUGIN_ROOT} for portability\n  - Progressive disclosure\n  - Security-first (HTTPS, no hardcoded credentials)\n\n### Key Decision Points (Wait for User)\n\n1. After Phase 1: Confirm plugin purpose\n2. After Phase 2: Approve component plan\n3. After Phase 3: Proceed to implementation\n4. After Phase 6: Fix issues or proceed\n5. After Phase 7: Continue to documentation\n\n### Skills to Load by Phase\n\n- **Phase 2**: plugin-structure\n- **Phase 5**: skill-development, command-development, agent-development, hook-development, mcp-integration, plugin-settings (as needed)\n- **Phase 6**: (agents will use skills automatically)\n\n### Quality Standards\n\nEvery component must meet these standards:\n\n-  Follows plugin-dev's proven patterns\n-  Uses correct naming conventions\n-  Has strong trigger conditions (skills/agents)\n-  Includes working examples\n-  Properly documented\n-  Validated with utilities\n-  Tested in Claude Code\n\n---\n\n## Example Workflow\n\n### User Request\n\n\"Create a plugin for managing database migrations\"\n\n### Phase 1: Discovery\n\n- Understand: Migration management, database schema versioning\n- Confirm: User wants to create, run, rollback migrations\n\n### Phase 2: Component Planning\n\n- Skills: 1 (migration best practices)\n- Commands: 3 (create-migration, run-migrations, rollback)\n- Agents: 1 (migration-validator)\n- MCP: 1 (database connection)\n\n### Phase 3: Clarifying Questions\n\n- Which databases? (PostgreSQL, MySQL, etc.)\n- Migration file format? (SQL, code-based?)\n- Should agent validate before applying?\n- What MCP tools needed? (query, execute, schema)\n\n### Phase 4-8: Implementation, Validation, Testing, Documentation\n\n---\n\n**Begin with Phase 1: Discovery**"
              },
              {
                "name": "/plugin-review",
                "description": "Comprehensive plugin review workflow with state tracking, best practice validation, and improvement recommendations",
                "path": "plugins/meta/plugin-dev/commands/plugin-review.md",
                "frontmatter": {
                  "description": "Comprehensive plugin review workflow with state tracking, best practice validation, and improvement recommendations",
                  "argument-hint": "<plugin-path>",
                  "allowed-tools": [
                    "Read",
                    "Write",
                    "Edit",
                    "Glob",
                    "Grep",
                    "Bash",
                    "Skill",
                    "Task",
                    "TodoWrite",
                    "AskUserQuestion"
                  ]
                },
                "content": "# Plugin Review Workflow\n\nSystematically review a Claude Code plugin against best practices from plugin-dev skills. Creates a state file to track progress and enables resumable reviews.\n\n**Target plugin:** $ARGUMENTS\n\n---\n\n## Core Principles\n\n- **State file tracking**: Create `.claude/<plugin-name>-review.local.md` to track all progress\n- **Skill-based validation**: Load relevant plugin-dev skills and validate against documented patterns\n- **Proof-based decisions**: When recommending changes, cite specific guidance from skills\n- **Incremental commits**: Commit improvements as they're made, track commit SHAs in state file\n- **Resumable**: If session ends, next session can continue from state file\n\n---\n\n## Phase 0: Setup\n\n**Goal**: Validate plugin path and create state file\n\n**Actions**:\n\n1. Validate the plugin path exists and has `.claude-plugin/plugin.json`\n2. Read plugin.json to get plugin name and version\n3. Auto-discover plugin components:\n   ```bash\n   # Commands\n   ls <plugin-path>/commands/*.md 2>/dev/null | wc -l\n\n   # Agents\n   ls <plugin-path>/agents/*.md 2>/dev/null | wc -l\n\n   # Skills\n   find <plugin-path>/skills -name \"SKILL.md\" 2>/dev/null | wc -l\n\n   # Hooks\n   test -f <plugin-path>/hooks/hooks.json && echo \"yes\" || echo \"no\"\n   ```\n4. Create state file at `.claude/<plugin-name>-review.local.md`:\n\n```markdown\n---\nworkflow: plugin-review\nplugin: <plugin-name>\nplugin_path: <plugin-path>\nstatus: in_progress\nstarted: <date>\nlast_updated: <date>\nphase: discovery\nplugin_version: <version>\n---\n\n# <Plugin-Name> Plugin Review\n\nComprehensive review against plugin-dev best practices.\n\n## Component Inventory\n\n| Component | Path | Count | Status |\n|-----------|------|-------|--------|\n| plugin.json | `.claude-plugin/plugin.json` | 1 | pending |\n| README.md | `README.md` | 1 | pending |\n| Commands | `commands/` | <n> | pending |\n| Agents | `agents/` | <n> | pending |\n| Skills | `skills/` | <n> | pending |\n| Hooks | `hooks/` | <yes/no> | pending |\n\n## Review Progress\n\n### Phase 1: Commands\n(to be filled during review)\n\n### Phase 2: Agents\n(to be filled during review)\n\n### Phase 3: Skills\n(to be filled during review)\n\n### Phase 4: Metadata\n(to be filled during review)\n\n### Phase 5: Advanced Patterns\n(to be filled during review)\n\n## Commits\n(to be filled as changes are committed)\n\n## Next Steps\n1. [ ] Phase 1: Review commands\n2. [ ] Phase 2: Review agents\n3. [ ] Phase 3: Review skills\n4. [ ] Phase 4: Review metadata\n5. [ ] Phase 5: Advanced patterns analysis\n6. [ ] Commit changes\n7. [ ] Version bump\n8. [ ] Push to remote\n```\n\n5. Create todo list with all phases\n6. Present component inventory to user and proceed to Phase 1\n\n**Output**: State file created, components discovered\n\n---\n\n## Phase 1: Commands Review\n\n**Goal**: Review each command against command-development skill\n\n**Skip if**: Plugin has no commands\n\n**Actions**:\n\n1. Load command-development skill using Skill tool\n2. Update state file: `phase: commands-review`\n3. For each command file:\n   - Read the command file\n   - Check against skill criteria:\n     - [ ] Has description in frontmatter\n     - [ ] Has argument-hint if accepts arguments\n     - [ ] Has allowed-tools (principle of least privilege)\n     - [ ] Instructions written FOR Claude (not TO user)\n     - [ ] Clear workflow structure\n   - Document findings in state file\n   - If issues found, propose fixes and get user approval\n   - Apply approved fixes\n4. Update state file with results for each command\n5. If changes made, commit with descriptive message and record SHA in state file\n\n**Output**: All commands reviewed, issues fixed, state file updated\n\n---\n\n## Phase 2: Agents Review\n\n**Goal**: Review each agent against agent-development skill\n\n**Skip if**: Plugin has no agents\n\n**Actions**:\n\n1. Load agent-development skill using Skill tool\n2. Update state file: `phase: agents-review`\n3. For each agent file:\n   - Read the agent file\n   - Check against skill criteria:\n     - [ ] Valid identifier (3-50 chars, lowercase, hyphens)\n     - [ ] Description has triggering conditions\n     - [ ] Description has 2-4 `<example>` blocks\n     - [ ] Examples use two-step assistant response pattern\n     - [ ] Examples include proactive triggering (if applicable)\n     - [ ] Tools follow least privilege principle\n     - [ ] System prompt has: role, responsibilities, process, output format\n     - [ ] Edge cases documented\n     - [ ] Self-verification steps included\n   - Document findings in state file\n   - If issues found, propose fixes with proof from skill\n   - Get user approval before applying\n   - Apply approved fixes\n4. Update state file with results for each agent\n5. If changes made, commit and record SHA\n\n**Output**: All agents reviewed, issues fixed, state file updated\n\n---\n\n## Phase 3: Skills Review\n\n**Goal**: Review each skill against skill-development skill\n\n**Skip if**: Plugin has no skills\n\n**Actions**:\n\n1. Load skill-development skill using Skill tool\n2. Update state file: `phase: skills-review`\n3. For each skill:\n   - Read SKILL.md\n   - Check against skill criteria:\n     - [ ] Third-person description (\"This skill should be used when...\")\n     - [ ] Specific trigger phrases in description\n     - [ ] Body uses imperative/infinitive form (not \"you should\")\n     - [ ] Content length appropriate (1,500-2,000 words ideal)\n     - [ ] Progressive disclosure (detailed content in references/)\n     - [ ] References exist and are documented\n     - [ ] No dynamic bash patterns in code blocks (GitHub #12781)\n   - Document findings in state file\n   - Propose fixes with proof from skill\n   - Get user approval\n   - Apply approved fixes\n4. Update state file with results\n5. If changes made, commit and record SHA\n\n**Output**: All skills reviewed, issues fixed, state file updated\n\n---\n\n## Phase 4: Metadata Review\n\n**Goal**: Review plugin.json and README against standards\n\n**Actions**:\n\n1. Load plugin-structure skill using Skill tool\n2. Update state file: `phase: metadata-review`\n\n**plugin.json check:**\n- [ ] Has required field: name\n- [ ] Has recommended fields: version, description, author, keywords\n- [ ] Name follows kebab-case convention\n- [ ] Version follows semver\n\n**README.md check:**\n- [ ] Overview section with component list\n- [ ] Each command documented with workflow/purpose\n- [ ] Each agent documented with capabilities and triggers\n- [ ] Each skill documented with triggers and coverage\n- [ ] Installation instructions\n- [ ] Dependencies section (if applicable)\n- [ ] Use cases with practical examples\n- [ ] Version, author, license\n\n3. Compare README against plugin-dev/README.md template pattern\n4. Document findings in state file\n5. Propose fixes and get approval\n6. Apply approved fixes\n7. If changes made, commit and record SHA\n\n**Output**: Metadata reviewed, README improved, state file updated\n\n---\n\n## Phase 5: Advanced Patterns Analysis\n\n**Goal**: Determine if plugin would benefit from additional patterns\n\n**Actions**:\n\n1. Update state file: `phase: advanced-patterns`\n\n**plugin-settings analysis:**\n- Load plugin-settings skill\n- Analyze if plugin would benefit from `.local.md` configuration:\n  - Does plugin have hooks that need enable/disable toggle?\n  - Does agent need state persistence between invocations?\n  - Are there project-specific settings that vary?\n- Document decision with proof from skill\n- If beneficial, recommend implementation\n\n**plugin-structure analysis:**\n- Load plugin-structure skill\n- Verify structure compliance:\n  - [ ] Manifest in `.claude-plugin/plugin.json`\n  - [ ] Components at plugin root (not nested)\n  - [ ] Kebab-case naming throughout\n  - [ ] ${CLAUDE_PLUGIN_ROOT} used where needed\n  - [ ] No unnecessary directories\n- Document findings\n\n2. Update state file with analysis results\n3. If improvements identified, get user approval and implement\n\n**Output**: Advanced patterns analyzed, recommendations documented\n\n---\n\n## Phase 6: Finalization\n\n**Goal**: Commit remaining changes, version bump, push\n\n**Actions**:\n\n1. Update state file: `phase: finalization`\n2. Show summary of all changes made:\n   - List all commits with SHAs\n   - List all issues found and fixed\n   - List any skipped items with rationale\n3. Ask user: \"Ready to finalize? This will:\"\n   - Commit any uncommitted changes\n   - Bump version (patch for improvements, minor for new features)\n   - Push to remote\n4. If approved:\n   - Commit remaining changes\n   - Bump version in plugin.json and README\n   - Commit version bump\n   - Push to remote\n5. Update state file:\n   - Set `status: complete`\n   - Record final version\n   - Mark all next steps complete\n\n**Output**: Plugin review complete, changes committed and pushed\n\n---\n\n## State File Maintenance\n\n**Throughout all phases:**\n\n- Update `last_updated` date when making changes\n- Update `phase` field when moving between phases\n- Record commit SHAs immediately after committing\n- Document decisions with rationale\n- Track skipped items with explanation\n\n**If resuming a review:**\n\n1. Read existing state file\n2. Identify current phase from `phase` field\n3. Check `Next Steps` for uncompleted items\n4. Resume from last incomplete step\n5. Inform user: \"Resuming review from Phase X: [phase name]\"\n\n---\n\n## Quality Standards\n\nEvery recommendation must:\n\n1. **Cite the skill**: Reference specific guidance from plugin-dev skills\n2. **Show proof**: Quote relevant text from skill documentation\n3. **Explain rationale**: Why this change improves the plugin\n4. **Get approval**: Wait for user confirmation before making changes\n\n---\n\n## MANDATORY: Change Proposal Format\n\n**CRITICAL**: Before proposing ANY change, you MUST use this exact format. Do NOT make changes without following this structure.\n\n### For Issues Found\n\n```markdown\n**Issue:** [Brief description of the problem]\n\n**Criterion:** [Which checklist item failed]\n\n**Skill:** [skill-name] (e.g., agent-development, skill-development)\n\n**Proof from skill:**\n> \"[Exact quote from the skill that defines this requirement]\"\n\n**Current state:**\n[Show what the plugin currently has]\n\n**Proposed fix:**\n[Show what it should be changed to]\n\n**Rationale:** [Why this change improves the plugin based on the proof]\n```\n\n### For Skip Decisions\n\nWhen recommending to NOT make a change:\n\n```markdown\n**Considered:** [What was evaluated]\n\n**Skill:** [skill-name]\n\n**Proof from skill:**\n> \"[Exact quote that justifies skipping]\"\n\n**Decision:** Skip - [brief explanation]\n```\n\n### Enforcement\n\n- If you cannot find proof from a skill, do NOT propose the change\n- If the skill doesn't address a potential issue, note it as \"No guidance found - skipping\"\n- Always quote the skill directly, do not paraphrase\n- Present all proposals to user before applying ANY changes\n- Record all proposals (applied and skipped) in state file\n\n---\n\n## Examples of Proper Proof-Based Analysis\n\n### Example 1: Validation with Tabular Evidence\n\n**Question:** Are naming conventions followed?\n\n**From skill (plugin-structure):**\n> \"Commands: Use kebab-case .md files\"\n> \"Agents: Use kebab-case .md files describing role\"\n> \"Skills: Use kebab-case directory names\"\n\n| Component | Name | Convention | Status |\n|-----------|------|------------|--------|\n| Commands | git-status.md | kebab-case  | PASS |\n| Commands | git-commit.md | kebab-case  | PASS |\n| Commands | generate-changelog.md | kebab-case  | PASS |\n| Commands | branch-cleanup.md | kebab-case  | PASS |\n| Agents | commit-craft.md | kebab-case, describes role  | PASS |\n| Skills | git-workflow/ | kebab-case  | PASS |\n\n**Result:** PASS - All naming conventions followed.\n\n---\n\n### Example 2: Skip Decision with Justification\n\n**Question:** Could plugin benefit from a scripts/ directory?\n\n**From skill (plugin-structure):**\n> \"Scripts: Use descriptive kebab-case names with appropriate extensions\"\n> Example: `validate-input.sh`, `generate-report.py`\n\n**Analysis:**\n\n| Potential Script | Purpose | Justified? |\n|------------------|---------|------------|\n| validate-commit-msg.sh | Validate conventional commit format | No - git hooks handle this |\n| check-branch-name.sh | Validate branch naming | No - simple pattern matching |\n| parse-changelog.py | Parse git-cliff output | No - git-cliff handles this |\n\n**Assessment:** All functionality is either:\n1. Delegated to external tools (git, git-cliff, prek)\n2. Simple enough to inline in commands\n3. Handled by the commit-craft agent\n\n**From skill - Best Practice:**\n> \"Minimal manifest: Keep plugin.json lean\"\n> \"Only create directories for components the plugin actually uses\"\n\n**Result:** NO BENEFIT - Adding scripts/ would add complexity without value. Plugin appropriately delegates to external tools.\n\n---\n\n### Example 3: Issue Found with Fix Proposal\n\n**Issue:** Agent examples don't show proactive triggering\n\n**Criterion:** Description has proactive triggering example (if applicable)\n\n**Skill:** agent-development\n\n**Proof from skill:**\n> \"Include 2-4 concrete examples\"\n> \"Show proactive and reactive triggering\"\n> \"Cover different phrasings of same intent\"\n\n**Current state:**\n```markdown\n<example>\nContext: User explicitly requests commit creation.\nuser: \"create commits for these changes\"\nassistant: \"I'll use the commit-craft agent...\"\n</example>\n```\nAll 3 examples are reactive (explicit user requests).\n\n**Proposed fix:**\nAdd proactive example as first example:\n```markdown\n<example>\nContext: User just finished implementing a feature across multiple files.\nuser: \"I've finished adding the authentication module\"\nassistant: \"Great! You have changes across several files.\"\n<commentary>\nUser completed coding task with multiple modified files. Proactively trigger commit-craft.\n</commentary>\nassistant: \"I'll use the commit-craft agent to organize these changes into logical, atomic commits.\"\n</example>\n```\n\n**Rationale:** The skill explicitly requires showing \"proactive and reactive triggering.\" Current examples only show reactive patterns, missing the proactive case where agent triggers after user completes work.\n\n---\n\n### Example 4: Advanced Pattern Analysis\n\n**Question:** Does plugin benefit from plugin-settings pattern?\n\n**From skill (plugin-settings):**\n> \"Plugins can store user-configurable settings... for Per-project plugin configuration\"\n> \"Use case: Enable/disable hooks without editing hooks.json\"\n> \"Focus on keeping settings simple and providing good defaults when settings file doesn't exist\"\n\n**Analysis:**\n\n| Pattern | Applicable? | Reasoning |\n|---------|-------------|-----------|\n| Configuration-driven behavior | No | CLAUDE.md handles project conventions |\n| Temporarily active hooks | No | Plugin has no hooks |\n| Agent state management | No | commit-craft is stateless by design |\n\n**One potential use case:** Protected branch patterns for branch-cleanup.\n\n**However, from skill:**\n> \"Focus on keeping settings simple and providing good defaults when settings file doesn't exist\"\n\nPlugin already provides good defaults. Adding settings would add complexity for minor benefit.\n\n**Result:** NO - Limited benefit, skip implementation. CLAUDE.md handles configuration needs.\n\n---\n\n## Begin Review\n\n1. Validate plugin path: $ARGUMENTS\n2. If path is empty or invalid, ask user for plugin path\n3. Create state file and begin Phase 0: Setup"
              }
            ],
            "skills": [
              {
                "name": "agent-development",
                "description": "This skill should be used when the user asks to \"create an agent\", \"add an agent\", \"write a subagent\", \"agent frontmatter\", \"when to use description\", \"agent examples\", \"agent tools\", \"agent colors\", \"autonomous agent\", or needs guidance on agent structure, system prompts, triggering conditions, or agent development best practices for Claude Code plugins.",
                "path": "plugins/meta/plugin-dev/skills/agent-development/SKILL.md",
                "frontmatter": {
                  "name": "agent-development",
                  "description": "This skill should be used when the user asks to \"create an agent\", \"add an agent\", \"write a subagent\", \"agent frontmatter\", \"when to use description\", \"agent examples\", \"agent tools\", \"agent colors\", \"autonomous agent\", or needs guidance on agent structure, system prompts, triggering conditions, or agent development best practices for Claude Code plugins."
                },
                "content": "# Agent Development for Claude Code Plugins\n\n## Overview\n\nAgents are autonomous subprocesses that handle complex, multi-step tasks independently. Understanding agent structure, triggering conditions, and system prompt design enables creating powerful autonomous capabilities.\n\n**Key concepts:**\n\n- Agents are FOR autonomous work, commands are FOR user-initiated actions\n- Markdown file format with YAML frontmatter\n- Triggering via description field with examples\n- System prompt defines agent behavior\n- Model and color customization\n\n## Agent File Structure\n\n### Complete Format\n\n```markdown\n---\nname: agent-identifier\ndescription: Use this agent when [triggering conditions]. Examples:\n\n<example>\nContext: [Situation description]\nuser: \"[User request]\"\nassistant: \"[How assistant should respond and use this agent]\"\n<commentary>\n[Why this agent should be triggered]\n</commentary>\n</example>\n\n<example>\n[Additional example...]\n</example>\n\nmodel: inherit\ncolor: blue\ntools: [\"Read\", \"Write\", \"Grep\"]\n---\n\nYou are [agent role description]...\n\n**Your Core Responsibilities:**\n1. [Responsibility 1]\n2. [Responsibility 2]\n\n**Analysis Process:**\n[Step-by-step workflow]\n\n**Output Format:**\n[What to return]\n```\n\n## Frontmatter Fields\n\n### name (required)\n\nAgent identifier used for namespacing and invocation.\n\n**Format:** lowercase, numbers, hyphens only\n**Length:** 3-50 characters\n**Pattern:** Must start and end with alphanumeric\n\n**Good examples:**\n\n- `code-reviewer`\n- `test-generator`\n- `api-docs-writer`\n- `security-analyzer`\n\n**Bad examples:**\n\n- `helper` (too generic)\n- `-agent-` (starts/ends with hyphen)\n- `my_agent` (underscores not allowed)\n- `ag` (too short, < 3 chars)\n\n### description (required)\n\nDefines when Claude should trigger this agent. **This is the most critical field.**\n\n**Must include:**\n\n1. Triggering conditions (\"Use this agent when...\")\n2. Multiple `<example>` blocks showing usage\n3. Context, user request, and assistant response in each example\n4. `<commentary>` explaining why agent triggers\n\n**Format:**\n\n```text\nUse this agent when [conditions]. Examples:\n\n<example>\nContext: [Scenario description]\nuser: \"[What user says]\"\nassistant: \"[How Claude should respond]\"\n<commentary>\n[Why this agent is appropriate]\n</commentary>\n</example>\n\n[More examples...]\n```\n\n**Best practices:**\n\n- Include 2-4 concrete examples\n- Show proactive and reactive triggering\n- Cover different phrasings of same intent\n- Explain reasoning in commentary\n- Be specific about when NOT to use the agent\n\n### model (required)\n\nWhich model the agent should use.\n\n**Options:**\n\n- `inherit` - Use same model as parent (recommended)\n- `sonnet` - Claude Sonnet (balanced)\n- `opus` - Claude Opus (most capable, expensive)\n- `haiku` - Claude Haiku (fast, cheap)\n\n**Recommendation:** Use `inherit` unless agent needs specific model capabilities.\n\n### color (required)\n\nVisual identifier for agent in UI.\n\n**Options:** `blue`, `cyan`, `green`, `yellow`, `magenta`, `red`\n\n**Guidelines:**\n\n- Choose distinct colors for different agents in same plugin\n- Use consistent colors for similar agent types\n- Blue/cyan: Analysis, review\n- Green: Success-oriented tasks\n- Yellow: Caution, validation\n- Red: Critical, security\n- Magenta: Creative, generation\n\n### tools (optional)\n\nRestrict agent to specific tools.\n\n**Format:** Array of tool names\n\n```yaml\ntools: [\"Read\", \"Write\", \"Grep\", \"Bash\"]\n```\n\n**Default:** If omitted, agent has access to all tools\n\n**Best practice:** Limit tools to minimum needed (principle of least privilege)\n\n**Common tool sets:**\n\n- Read-only analysis: `[\"Read\", \"Grep\", \"Glob\"]`\n- Code generation: `[\"Read\", \"Write\", \"Grep\"]`\n- Testing: `[\"Read\", \"Bash\", \"Grep\"]`\n- Full access: Omit field or use `[\"*\"]`\n\n### permissionMode (optional)\n\nControls how permissions are handled for the agent.\n\n**Options:**\n\n- `default` - Normal permission prompts\n- `acceptEdits` - Auto-accept file edits\n- `bypassPermissions` - Skip all permission prompts\n- `plan` - Plan mode only\n- `ignore` - Ignore permission settings\n\n**Default:** `default`\n\n### skills (optional)\n\nSkills to auto-load when the agent starts.\n\n**Format:** Comma-separated list of skill names\n\n```yaml\nskills: debugging, code-review\n```\n\n**Use case:** When an agent needs specific domain knowledge from skills to do its job effectively.\n\n### capabilities (optional)\n\nArray of specific tasks or capabilities the agent excels at. **Plugin subagents only.**\n\n**Format:** Array of strings\n\n```yaml\ncapabilities: [\"code review\", \"security analysis\", \"refactoring\"]\n```\n\n**Use case:** Describes agent specializations for plugin agents. Helps users understand what the agent can do.\n\n## System Prompt Design\n\nThe markdown body becomes the agent's system prompt. Write in second person, addressing the agent directly.\n\n### Structure\n\n**Standard template:**\n\n```markdown\nYou are [role] specializing in [domain].\n\n**Your Core Responsibilities:**\n1. [Primary responsibility]\n2. [Secondary responsibility]\n3. [Additional responsibilities...]\n\n**Analysis Process:**\n1. [Step one]\n2. [Step two]\n3. [Step three]\n[...]\n\n**Quality Standards:**\n- [Standard 1]\n- [Standard 2]\n\n**Output Format:**\nProvide results in this format:\n- [What to include]\n- [How to structure]\n\n**Edge Cases:**\nHandle these situations:\n- [Edge case 1]: [How to handle]\n- [Edge case 2]: [How to handle]\n```\n\n### Best Practices\n\n **DO:**\n\n- Write in second person (\"You are...\", \"You will...\")\n- Be specific about responsibilities\n- Provide step-by-step process\n- Define output format\n- Include quality standards\n- Address edge cases\n- Keep under 10,000 characters\n\n **DON'T:**\n\n- Write in first person (\"I am...\", \"I will...\")\n- Be vague or generic\n- Omit process steps\n- Leave output format undefined\n- Skip quality guidance\n- Ignore error cases\n\n## Creating Agents\n\n### Method 1: AI-Assisted Generation\n\nUse this prompt pattern (extracted from Claude Code):\n\n```text\nCreate an agent configuration based on this request: \"[YOUR DESCRIPTION]\"\n\nRequirements:\n1. Extract core intent and responsibilities\n2. Design expert persona for the domain\n3. Create comprehensive system prompt with:\n   - Clear behavioral boundaries\n   - Specific methodologies\n   - Edge case handling\n   - Output format\n4. Create identifier (lowercase, hyphens, 3-50 chars)\n5. Write description with triggering conditions\n6. Include 2-3 <example> blocks showing when to use\n\nReturn JSON with:\n{\n  \"identifier\": \"agent-name\",\n  \"whenToUse\": \"Use this agent when... Examples: <example>...</example>\",\n  \"systemPrompt\": \"You are...\"\n}\n```\n\nThen convert to agent file format with frontmatter.\n\nSee `examples/agent-creation-prompt.md` for complete template.\n\n### Method 2: Manual Creation\n\n1. Choose agent identifier (3-50 chars, lowercase, hyphens)\n2. Write description with examples\n3. Select model (usually `inherit`)\n4. Choose color for visual identification\n5. Define tools (if restricting access)\n6. Write system prompt with structure above\n7. Save as `agents/agent-name.md`\n\n## Validation Rules\n\n### Identifier Validation\n\n```text\n Valid: code-reviewer, test-gen, api-analyzer-v2\n Invalid: ag (too short), -start (starts with hyphen), my_agent (underscore)\n```\n\n**Rules:**\n\n- 3-50 characters\n- Lowercase letters, numbers, hyphens only\n- Must start and end with alphanumeric\n- No underscores, spaces, or special characters\n\n### Description Validation\n\n**Length:** 10-5,000 characters\n**Must include:** Triggering conditions and examples\n**Best:** 200-1,000 characters with 2-4 examples\n\n### System Prompt Validation\n\n**Length:** 20-10,000 characters\n**Best:** 500-3,000 characters\n**Structure:** Clear responsibilities, process, output format\n\n## Agent Organization\n\n### Plugin Agents Directory\n\n```bash\nplugin-name/\n agents/\n     analyzer.md\n     reviewer.md\n     generator.md\n```\n\nAll `.md` files in `agents/` are auto-discovered.\n\n### Namespacing\n\nAgents are namespaced automatically:\n\n- Single plugin: `agent-name`\n- With subdirectories: `plugin:subdir:agent-name`\n\n## Testing Agents\n\n### Test Triggering\n\nCreate test scenarios to verify agent triggers correctly:\n\n1. Write agent with specific triggering examples\n2. Use similar phrasing to examples in test\n3. Check Claude loads the agent\n4. Verify agent provides expected functionality\n\n### Test System Prompt\n\nEnsure system prompt is complete:\n\n1. Give agent typical task\n2. Check it follows process steps\n3. Verify output format is correct\n4. Test edge cases mentioned in prompt\n5. Confirm quality standards are met\n\n## Quick Reference\n\n### Minimal Agent\n\n```markdown\n---\nname: simple-agent\ndescription: Use this agent when... Examples: <example>...</example>\nmodel: inherit\ncolor: blue\n---\n\nYou are an agent that [does X].\n\nProcess:\n1. [Step 1]\n2. [Step 2]\n\nOutput: [What to provide]\n```\n\n### Frontmatter Fields Summary\n\n| Field | Required | Format | Example |\n|-------|----------|--------|---------|\n| name | Yes | lowercase-hyphens | code-reviewer |\n| description | Yes | Text + examples | Use when... <example>... |\n| model | Yes | inherit/sonnet/opus/haiku | inherit |\n| color | Yes | Color name | blue |\n| tools | No | Array of tool names | [\"Read\", \"Grep\"] |\n| permissionMode | No | Mode string | default |\n| skills | No | Comma-separated names | debugging, code-review |\n| capabilities | No | Array of strings (plugin only) | [\"code review\"] |\n\n### Best Practices\n\n**DO:**\n\n-  Include 2-4 concrete examples in description\n-  Write specific triggering conditions\n-  Use `inherit` for model unless specific need\n-  Choose appropriate tools (least privilege)\n-  Write clear, structured system prompts\n-  Test agent triggering thoroughly\n\n**DON'T:**\n\n-  Use generic descriptions without examples\n-  Omit triggering conditions\n-  Give all agents same color\n-  Grant unnecessary tool access\n-  Write vague system prompts\n-  Skip testing\n\n## Additional Resources\n\n### Reference Files\n\nFor detailed guidance, consult:\n\n- **`references/agent-spec.md`** - The official specification\n- **`references/system-prompt-design.md`** - Complete system prompt patterns\n- **`references/triggering-examples.md`** - Example formats and best practices\n- **`references/agent-creation-system-prompt.md`** - The exact prompt from Claude Code\n\n### Example Files\n\nWorking examples in `examples/`:\n\n- **`agent-creation-prompt.md`** - AI-assisted agent generation template\n- **`complete-agent-examples.md`** - Full agent examples for different use cases\n\n### Utility Scripts\n\nDevelopment tools in `scripts/`:\n\n- **`validate-agent.sh`** - Validate agent file structure\n- **`test-agent-trigger.sh`** - Test if agent triggers correctly\n\n## Implementation Workflow\n\nTo create an agent for a plugin:\n\n1. Define agent purpose and triggering conditions\n2. Choose creation method (AI-assisted or manual)\n3. Create `agents/agent-name.md` file\n4. Write frontmatter with all required fields\n5. Write system prompt following best practices\n6. Include 2-4 triggering examples in description\n7. Validate with `scripts/validate-agent.sh`\n8. Test triggering with real scenarios\n9. Document agent in plugin README\n\nFocus on clear triggering conditions and comprehensive system prompts for autonomous operation."
              },
              {
                "name": "command-development",
                "description": "This skill should be used when the user asks to \"create a slash command\", \"add a command\", \"write a custom command\", \"define command arguments\", \"use command frontmatter\", \"organize commands\", \"create command with file references\", \"interactive command\", \"use AskUserQuestion in command\", or needs guidance on slash command structure, YAML frontmatter fields, dynamic arguments, bash execution in commands, user interaction patterns, or command development best practices for Claude Code.",
                "path": "plugins/meta/plugin-dev/skills/command-development/SKILL.md",
                "frontmatter": {
                  "name": "command-development",
                  "description": "This skill should be used when the user asks to \"create a slash command\", \"add a command\", \"write a custom command\", \"define command arguments\", \"use command frontmatter\", \"organize commands\", \"create command with file references\", \"interactive command\", \"use AskUserQuestion in command\", or needs guidance on slash command structure, YAML frontmatter fields, dynamic arguments, bash execution in commands, user interaction patterns, or command development best practices for Claude Code."
                },
                "content": "# Command Development for Claude Code\n\n> **Reference:** See [command-spec.md](references/command-spec.md) for the official specification.\n\n## Overview\n\nSlash commands are frequently-used prompts defined as Markdown files that Claude executes during interactive sessions. Understanding command structure, frontmatter options, and dynamic features enables creating powerful, reusable workflows.\n\n**Key concepts:**\n\n- Markdown file format for commands\n- YAML frontmatter for configuration\n- Dynamic arguments and file references\n- Bash execution for context\n- Command organization and namespacing\n\n## Command Basics\n\n### What is a Slash Command?\n\nA slash command is a Markdown file containing a prompt that Claude executes when invoked. Commands provide:\n\n- **Reusability**: Define once, use repeatedly\n- **Consistency**: Standardize common workflows\n- **Sharing**: Distribute across team or projects\n- **Efficiency**: Quick access to complex prompts\n\n### Critical: Commands are Instructions FOR Claude\n\n**Commands are written for agent consumption, not human consumption.**\n\nWhen a user invokes `/command-name`, the command content becomes Claude's instructions. Write commands as directives TO Claude about what to do, not as messages TO the user.\n\n**Correct approach (instructions for Claude):**\n\n```markdown\nReview this code for security vulnerabilities including:\n- SQL injection\n- XSS attacks\n- Authentication issues\n\nProvide specific line numbers and severity ratings.\n```\n\n**Incorrect approach (messages to user):**\n\n```markdown\nThis command will review your code for security issues.\nYou'll receive a report with vulnerability details.\n```\n\nThe first example tells Claude what to do. The second tells the user what will happen but doesn't instruct Claude. Always use the first approach.\n\n### Command Locations\n\n**Project commands** (shared with team):\n\n- Location: `.claude/commands/`\n- Scope: Available in specific project\n- Label: Shown as \"(project)\" in `/help`\n- Use for: Team workflows, project-specific tasks\n\n**Personal commands** (available everywhere):\n\n- Location: `~/.claude/commands/`\n- Scope: Available in all projects\n- Label: Shown as \"(user)\" in `/help`\n- Use for: Personal workflows, cross-project utilities\n\n**Plugin commands** (bundled with plugins):\n\n- Location: `plugin-name/commands/`\n- Scope: Available when plugin installed\n- Label: Shown as \"(plugin-name)\" in `/help`\n- Use for: Plugin-specific functionality\n\n## File Format\n\n### Basic Structure\n\nCommands are Markdown files with `.md` extension:\n\n```text\n.claude/commands/\n review.md           # /review command\n test.md             # /test command\n deploy.md           # /deploy command\n```\n\n**Simple command:**\n\n```markdown\nReview this code for security vulnerabilities including:\n- SQL injection\n- XSS attacks\n- Authentication bypass\n- Insecure data handling\n```\n\nNo frontmatter needed for basic commands.\n\n### With YAML Frontmatter\n\nAdd configuration using YAML frontmatter:\n\n```markdown\n---\ndescription: Review code for security issues\nallowed-tools: Read, Grep, Bash(git:*)\nmodel: sonnet\n---\n\nReview this code for security vulnerabilities...\n```\n\n## YAML Frontmatter Fields\n\n### description\n\n**Purpose:** Brief description shown in `/help`\n**Type:** String\n**Default:** First line of command prompt\n\n```yaml\n---\ndescription: Review pull request for code quality\n---\n```\n\n**Best practice:** Clear, actionable description (under 60 characters)\n\n### allowed-tools\n\n**Purpose:** Specify which tools command can use\n**Type:** Comma-separated string\n**Default:** Inherits from conversation\n\n```yaml\n---\nallowed-tools: Read, Write, Edit, Bash(git:*)\n---\n```\n\n**Note:** Always use comma-separated format on a single line. Do not use YAML array syntax.\n\n**Patterns:**\n\n- `Read, Write, Edit` - Specific tools\n- `Bash(git:*)` - Bash with git commands only\n- `*` - All tools (rarely needed)\n\n**Use when:** Command requires specific tool access\n\n### model\n\n**Purpose:** Specify model for command execution\n**Type:** String (sonnet, opus, haiku)\n**Default:** Inherits from conversation\n\n```yaml\n---\nmodel: haiku\n---\n```\n\n**Use cases:**\n\n- `haiku` - Fast, simple commands\n- `sonnet` - Standard workflows\n- `opus` - Complex analysis\n\n### argument-hint\n\n**Purpose:** Document expected arguments for autocomplete\n**Type:** String\n**Default:** None\n\n```yaml\n---\nargument-hint: [pr-number] [priority] [assignee]\n---\n```\n\n**Benefits:**\n\n- Helps users understand command arguments\n- Improves command discovery\n- Documents command interface\n\n### disable-model-invocation\n\n**Purpose:** Prevent SlashCommand tool from programmatically calling command\n**Type:** Boolean\n**Default:** false\n\n```yaml\n---\ndisable-model-invocation: true\n---\n```\n\n**Use when:** Command should only be manually invoked\n\n## Dynamic Arguments\n\n### Using $ARGUMENTS\n\nCapture all arguments as single string:\n\n```markdown\n---\ndescription: Fix issue by number\nargument-hint: [issue-number]\n---\n\nFix issue #$ARGUMENTS following our coding standards and best practices.\n```\n\n**Usage:**\n\n```text\n> /fix-issue 123\n> /fix-issue 456\n```\n\n**Expands to:**\n\n```text\nFix issue #123 following our coding standards...\nFix issue #456 following our coding standards...\n```\n\n### Using Positional Arguments\n\nCapture individual arguments with `$1`, `$2`, `$3`, etc.:\n\n```markdown\n---\ndescription: Review PR with priority and assignee\nargument-hint: [pr-number] [priority] [assignee]\n---\n\nReview pull request #$1 with priority level $2.\nAfter review, assign to $3 for follow-up.\n```\n\n**Usage:**\n\n```text\n> /review-pr 123 high alice\n```\n\n**Expands to:**\n\n```bash\nReview pull request #123 with priority level high.\nAfter review, assign to alice for follow-up.\n```\n\n### Combining Arguments\n\nMix positional and remaining arguments:\n\n```markdown\nDeploy $1 to $2 environment with options: $3\n```\n\n**Usage:**\n\n```text\n> /deploy api staging --force --skip-tests\n```\n\n**Expands to:**\n\n```text\nDeploy api to staging environment with options: --force --skip-tests\n```\n\n## File References\n\n### Using @ Syntax\n\nInclude file contents in command:\n\n```markdown\n---\ndescription: Review specific file\nargument-hint: [file-path]\n---\n\nReview @$1 for:\n- Code quality\n- Best practices\n- Potential bugs\n```\n\n**Usage:**\n\n```text\n> /review-file src/api/users.ts\n```\n\n**Effect:** Claude reads `src/api/users.ts` before processing command\n\n### Multiple File References\n\nReference multiple files:\n\n```markdown\nCompare @src/old-version.js with @src/new-version.js\n\nIdentify:\n- Breaking changes\n- New features\n- Bug fixes\n```\n\n### Static File References\n\nReference known files without arguments:\n\n```markdown\nReview @package.json and @tsconfig.json for consistency\n\nEnsure:\n- TypeScript version matches\n- Dependencies are aligned\n- Build configuration is correct\n```\n\n## Bash Execution in Commands\n\nCommands can execute bash commands inline to dynamically gather context before Claude processes the command. This is useful for including repository state, environment information, or project-specific context.\n\n**When to use:**\n\n- Include dynamic context (git status, environment vars, etc.)\n- Gather project/repository state\n- Build context-aware workflows\n\n**Implementation details:**\nFor complete syntax, examples, and best practices, see `references/plugin-features-reference.md` section on bash execution. The reference includes the exact syntax and multiple working examples to avoid execution issues\n\n## Command Organization\n\n### Flat Structure\n\nSimple organization for small command sets:\n\n```text\n.claude/commands/\n build.md\n test.md\n deploy.md\n review.md\n docs.md\n```\n\n**Use when:** 5-15 commands, no clear categories\n\n### Namespaced Structure\n\nOrganize commands in subdirectories:\n\n```text\n.claude/commands/\n ci/\n    build.md        # /build (project:ci)\n    test.md         # /test (project:ci)\n    lint.md         # /lint (project:ci)\n git/\n    commit.md       # /commit (project:git)\n    pr.md           # /pr (project:git)\n docs/\n     generate.md     # /generate (project:docs)\n     publish.md      # /publish (project:docs)\n```\n\n**Benefits:**\n\n- Logical grouping by category\n- Namespace shown in `/help`\n- Easier to find related commands\n\n**Use when:** 15+ commands, clear categories\n\n## Best Practices\n\n### Command Design\n\n1. **Single responsibility:** One command, one task\n2. **Clear descriptions:** Self-explanatory in `/help`\n3. **Explicit dependencies:** Use `allowed-tools` when needed\n4. **Document arguments:** Always provide `argument-hint`\n5. **Consistent naming:** Use verb-noun pattern (review-pr, fix-issue)\n\n### Argument Handling\n\n1. **Validate arguments:** Check for required arguments in prompt\n2. **Provide defaults:** Suggest defaults when arguments missing\n3. **Document format:** Explain expected argument format\n4. **Handle edge cases:** Consider missing or invalid arguments\n\n```markdown\n---\nargument-hint: [pr-number]\n---\n\n$IF($1,\n  Review PR #$1,\n  Please provide a PR number. Usage: /review-pr [number]\n)\n```\n\n### File References\n\n1. **Explicit paths:** Use clear file paths\n2. **Check existence:** Handle missing files gracefully\n3. **Relative paths:** Use project-relative paths\n4. **Glob support:** Consider using Glob tool for patterns\n\n### Bash Commands\n\n1. **Limit scope:** Use `Bash(git:*)` not `Bash(*)`\n2. **Safe commands:** Avoid destructive operations\n3. **Handle errors:** Consider command failures\n4. **Keep fast:** Long-running commands slow invocation\n\n### Documentation\n\n1. **Add comments:** Explain complex logic\n2. **Provide examples:** Show usage in comments\n3. **List requirements:** Document dependencies\n4. **Version commands:** Note breaking changes\n\n```markdown\n---\ndescription: Deploy application to environment\nargument-hint: [environment] [version]\n---\n\n<!--\nUsage: /deploy [staging|production] [version]\nRequires: AWS credentials configured\nExample: /deploy staging v1.2.3\n-->\n\nDeploy application to $1 environment using version $2...\n```\n\n## Common Patterns\n\n### Review Pattern\n\n```markdown\n---\ndescription: Review code changes\nallowed-tools: Read, Bash(git:*)\n---\n\nFiles changed: $ git diff --name-only\n\nReview each file for:\n1. Code quality and style\n2. Potential bugs or issues\n3. Test coverage\n4. Documentation needs\n\nProvide specific feedback for each file.\n```\n\n### Testing Pattern\n\n```markdown\n---\ndescription: Run tests for specific file\nargument-hint: [test-file]\nallowed-tools: Bash(npm:*)\n---\n\nRun tests: $ npm test $1\n\nAnalyze results and suggest fixes for failures.\n```\n\n### Documentation Pattern\n\n```markdown\n---\ndescription: Generate documentation for file\nargument-hint: [source-file]\n---\n\nGenerate comprehensive documentation for @$1 including:\n- Function/class descriptions\n- Parameter documentation\n- Return value descriptions\n- Usage examples\n- Edge cases and errors\n```\n\n### Workflow Pattern\n\n```markdown\n---\ndescription: Complete PR workflow\nargument-hint: [pr-number]\nallowed-tools: Bash(gh:*), Read\n---\n\nPR #$1 Workflow:\n\n1. Fetch PR: Run `gh pr view $1`\n2. Review changes\n3. Run checks\n4. Approve or request changes\n```\n\n## Troubleshooting\n\n**Command not appearing:**\n\n- Check file is in correct directory\n- Verify `.md` extension present\n- Ensure valid Markdown format\n- Restart Claude Code\n\n**Arguments not working:**\n\n- Verify `$1`, `$2` syntax correct\n- Check `argument-hint` matches usage\n- Ensure no extra spaces\n\n**Bash execution failing:**\n\n- Check `allowed-tools` includes Bash\n- Verify command syntax in backticks\n- Test command in terminal first\n- Check for required permissions\n\n**File references not working:**\n\n- Verify `@` syntax correct\n- Check file path is valid\n- Ensure Read tool allowed\n- Use absolute or project-relative paths\n\n## Plugin-Specific Features\n\n### CLAUDE_PLUGIN_ROOT Variable\n\nPlugin commands have access to `${CLAUDE_PLUGIN_ROOT}`, an environment variable that resolves to the plugin's absolute path.\n\n**Purpose:**\n\n- Reference plugin files portably\n- Execute plugin scripts\n- Load plugin configuration\n- Access plugin templates\n\n**Basic usage:**\n\n```markdown\n---\ndescription: Analyze using plugin script\nallowed-tools: Bash(node:*)\n---\n\nRun analysis: $ node ${CLAUDE_PLUGIN_ROOT}/scripts/analyze.js $1\n\nReview results and report findings.\n```\n\n**Common patterns:**\n\n```markdown\n# Execute plugin script\n$ bash ${CLAUDE_PLUGIN_ROOT}/scripts/script.sh\n\n# Load plugin configuration\n@${CLAUDE_PLUGIN_ROOT}/config/settings.json\n\n# Use plugin template\n@${CLAUDE_PLUGIN_ROOT}/templates/report.md\n\n# Access plugin resources\n@${CLAUDE_PLUGIN_ROOT}/docs/reference.md\n```\n\n**Why use it:**\n\n- Works across all installations\n- Portable between systems\n- No hardcoded paths needed\n- Essential for multi-file plugins\n\n### Plugin Command Organization\n\nPlugin commands discovered automatically from `commands/` directory:\n\n```text\nplugin-name/\n commands/\n    foo.md              # /foo (plugin:plugin-name)\n    bar.md              # /bar (plugin:plugin-name)\n    utils/\n        helper.md       # /helper (plugin:plugin-name:utils)\n plugin.json\n```\n\n**Namespace benefits:**\n\n- Logical command grouping\n- Shown in `/help` output\n- Avoid name conflicts\n- Organize related commands\n\n**Naming conventions:**\n\n- Use descriptive action names\n- Avoid generic names (test, run)\n- Consider plugin-specific prefix\n- Use hyphens for multi-word names\n\n### Plugin Command Patterns\n\n**Configuration-based pattern:**\n\n```markdown\n---\ndescription: Deploy using plugin configuration\nargument-hint: [environment]\nallowed-tools: Read, Bash(*)\n---\n\nLoad configuration: @${CLAUDE_PLUGIN_ROOT}/config/$1-deploy.json\n\nDeploy to $1 using configuration settings.\nMonitor deployment and report status.\n```\n\n**Template-based pattern:**\n\n```markdown\n---\ndescription: Generate docs from template\nargument-hint: [component]\n---\n\nTemplate: @${CLAUDE_PLUGIN_ROOT}/templates/docs.md\n\nGenerate documentation for $1 following template structure.\n```\n\n**Multi-script pattern:**\n\n```markdown\n---\ndescription: Complete build workflow\nallowed-tools: Bash(*)\n---\n\nBuild: $ bash ${CLAUDE_PLUGIN_ROOT}/scripts/build.sh\nTest: $ bash ${CLAUDE_PLUGIN_ROOT}/scripts/test.sh\nPackage: $ bash ${CLAUDE_PLUGIN_ROOT}/scripts/package.sh\n\nReview outputs and report workflow status.\n```\n\n**See `references/plugin-features-reference.md` for detailed patterns.**\n\n## Integration with Plugin Components\n\nCommands can integrate with other plugin components for powerful workflows.\n\n### Agent Integration\n\nLaunch plugin agents for complex tasks:\n\n```markdown\n---\ndescription: Deep code review\nargument-hint: [file-path]\n---\n\nInitiate comprehensive review of @$1 using the code-reviewer agent.\n\nThe agent will analyze:\n- Code structure\n- Security issues\n- Performance\n- Best practices\n\nAgent uses plugin resources:\n- ${CLAUDE_PLUGIN_ROOT}/config/rules.json\n- ${CLAUDE_PLUGIN_ROOT}/checklists/review.md\n```\n\n**Key points:**\n\n- Agent must exist in `plugin/agents/` directory\n- Claude uses Task tool to launch agent\n- Document agent capabilities\n- Reference plugin resources agent uses\n\n### Skill Integration\n\nLeverage plugin skills for specialized knowledge:\n\n```markdown\n---\ndescription: Document API with standards\nargument-hint: [api-file]\n---\n\nDocument API in @$1 following plugin standards.\n\nUse the api-docs-standards skill to ensure:\n- Complete endpoint documentation\n- Consistent formatting\n- Example quality\n- Error documentation\n\nGenerate production-ready API docs.\n```\n\n**Key points:**\n\n- Skill must exist in `plugin/skills/` directory\n- Mention skill name to trigger invocation\n- Document skill purpose\n- Explain what skill provides\n\n### Hook Coordination\n\nDesign commands that work with plugin hooks:\n\n- Commands can prepare state for hooks to process\n- Hooks execute automatically on tool events\n- Commands should document expected hook behavior\n- Guide Claude on interpreting hook output\n\nSee `references/plugin-features-reference.md` for examples of commands that coordinate with hooks\n\n### Multi-Component Workflows\n\nCombine agents, skills, and scripts:\n\n```markdown\n---\ndescription: Comprehensive review workflow\nargument-hint: [file]\nallowed-tools: Bash(node:*), Read\n---\n\nTarget: @$1\n\nPhase 1 - Static Analysis:\n$ node ${CLAUDE_PLUGIN_ROOT}/scripts/lint.js $1\n\nPhase 2 - Deep Review:\nLaunch code-reviewer agent for detailed analysis.\n\nPhase 3 - Standards Check:\nUse coding-standards skill for validation.\n\nPhase 4 - Report:\nTemplate: @${CLAUDE_PLUGIN_ROOT}/templates/review.md\n\nCompile findings into report following template.\n```\n\n**When to use:**\n\n- Complex multi-step workflows\n- Leverage multiple plugin capabilities\n- Require specialized analysis\n- Need structured outputs\n\n## Validation Patterns\n\nCommands should validate inputs and resources before processing.\n\n### Argument Validation\n\n```markdown\n---\ndescription: Deploy with validation\nargument-hint: [environment]\n---\n\nValidate environment: $ echo \"$1\" | grep -E \"^(dev|staging|prod)$\" || echo \"INVALID\"\n\nIf $1 is valid environment:\n  Deploy to $1\nOtherwise:\n  Explain valid environments: dev, staging, prod\n  Show usage: /deploy [environment]\n```\n\n### File Existence Checks\n\n```markdown\n---\ndescription: Process configuration\nargument-hint: [config-file]\n---\n\nCheck file exists: $ test -f $1 && echo \"EXISTS\" || echo \"MISSING\"\n\nIf file exists:\n  Process configuration: @$1\nOtherwise:\n  Explain where to place config file\n  Show expected format\n  Provide example configuration\n```\n\n### Plugin Resource Validation\n\n```markdown\n---\ndescription: Run plugin analyzer\nallowed-tools: Bash(test:*)\n---\n\nValidate plugin setup:\n- Script: $ test -x ${CLAUDE_PLUGIN_ROOT}/bin/analyze && echo \"\" || echo \"\"\n- Config: $ test -f ${CLAUDE_PLUGIN_ROOT}/config.json && echo \"\" || echo \"\"\n\nIf all checks pass, run analysis.\nOtherwise, report missing components.\n```\n\n### Error Handling\n\n```markdown\n---\ndescription: Build with error handling\nallowed-tools: Bash(*)\n---\n\nExecute build: $ bash ${CLAUDE_PLUGIN_ROOT}/scripts/build.sh 2>&1 || echo \"BUILD_FAILED\"\n\nIf build succeeded:\n  Report success and output location\nIf build failed:\n  Analyze error output\n  Suggest likely causes\n  Provide troubleshooting steps\n```\n\n**Best practices:**\n\n- Validate early in command\n- Provide helpful error messages\n- Suggest corrective actions\n- Handle edge cases gracefully\n\n---\n\nFor detailed frontmatter field specifications, see `references/frontmatter-reference.md`.\nFor plugin-specific features and patterns, see `references/plugin-features-reference.md`.\nFor command pattern examples, see `examples/` directory."
              },
              {
                "name": "hook-development",
                "description": "This skill should be used when the user asks to \"create a hook\", \"add a PreToolUse/PostToolUse/Stop hook\", \"validate tool use\", \"implement prompt-based hooks\", \"use ${CLAUDE_PLUGIN_ROOT}\", \"set up event-driven automation\", \"block dangerous commands\", or mentions hook events (PreToolUse, PostToolUse, Stop, SubagentStop, SessionStart, SessionEnd, UserPromptSubmit, PreCompact, Notification). Provides comprehensive guidance for creating and implementing Claude Code plugin hooks with focus on advanced prompt-based hooks API.",
                "path": "plugins/meta/plugin-dev/skills/hook-development/SKILL.md",
                "frontmatter": {
                  "name": "hook-development",
                  "description": "This skill should be used when the user asks to \"create a hook\", \"add a PreToolUse/PostToolUse/Stop hook\", \"validate tool use\", \"implement prompt-based hooks\", \"use ${CLAUDE_PLUGIN_ROOT}\", \"set up event-driven automation\", \"block dangerous commands\", or mentions hook events (PreToolUse, PostToolUse, Stop, SubagentStop, SessionStart, SessionEnd, UserPromptSubmit, PreCompact, Notification). Provides comprehensive guidance for creating and implementing Claude Code plugin hooks with focus on advanced prompt-based hooks API."
                },
                "content": "# Hook Development for Claude Code Plugins\n\n> **Reference:** See [hook-spec.md](references/hook-spec.md) for the official specification.\n\n## Overview\n\nHooks are event-driven automation scripts that execute in response to Claude Code events. Use hooks to validate operations, enforce policies, add context, and integrate external tools into workflows.\n\n**Key capabilities:**\n\n- Validate tool calls before execution (PreToolUse)\n- React to tool results (PostToolUse)\n- Enforce completion standards (Stop, SubagentStop)\n- Load project context (SessionStart)\n- Automate workflows across the development lifecycle\n\n## Hook Types\n\n### Prompt-Based Hooks (Recommended)\n\nUse LLM-driven decision making for context-aware validation:\n\n```json\n{\n  \"type\": \"prompt\",\n  \"prompt\": \"Evaluate if this tool use is appropriate: $TOOL_INPUT\",\n  \"timeout\": 30\n}\n```\n\n**Supported events:** Stop, SubagentStop, UserPromptSubmit, PreToolUse\n\n**Benefits:**\n\n- Context-aware decisions based on natural language reasoning\n- Flexible evaluation logic without bash scripting\n- Better edge case handling\n- Easier to maintain and extend\n\n### Command Hooks\n\nExecute bash commands for deterministic checks:\n\n```json\n{\n  \"type\": \"command\",\n  \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/validate.sh\",\n  \"timeout\": 60\n}\n```\n\n**Use for:**\n\n- Fast deterministic validations\n- File system operations\n- External tool integrations\n- Performance-critical checks\n\n## Hook Configuration Formats\n\n### Plugin hooks.json Format\n\n**For plugin hooks** in `hooks/hooks.json`, use wrapper format:\n\n```json\n{\n  \"description\": \"Brief explanation of hooks (optional)\",\n  \"hooks\": {\n    \"PreToolUse\": [...],\n    \"Stop\": [...],\n    \"SessionStart\": [...]\n  }\n}\n```\n\n**Key points:**\n\n- `description` field is optional\n- `hooks` field is required wrapper containing actual hook events\n- This is the **plugin-specific format**\n\n**Example:**\n\n```json\n{\n  \"description\": \"Validation hooks for code quality\",\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Write\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"${CLAUDE_PLUGIN_ROOT}/hooks/validate.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Settings Format (Direct)\n\n**For user settings** in `.claude/settings.json`, use direct format:\n\n```json\n{\n  \"PreToolUse\": [...],\n  \"Stop\": [...],\n  \"SessionStart\": [...]\n}\n```\n\n**Key points:**\n\n- No wrapper - events directly at top level\n- No description field\n- This is the **settings format**\n\n**Important:** The examples below show the hook event structure that goes inside either format. For plugin hooks.json, wrap these in `{\"hooks\": {...}}`.\n\n## Hook Events\n\n### PreToolUse\n\nExecute before any tool runs. Use to approve, deny, or modify tool calls.\n\n**Example (prompt-based):**\n\n```json\n{\n  \"PreToolUse\": [\n    {\n      \"matcher\": \"Write|Edit\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Validate file write safety. Check: system paths, credentials, path traversal, sensitive content. Return 'approve' or 'deny'.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Output for PreToolUse:**\n\n```json\n{\n  \"hookSpecificOutput\": {\n    \"permissionDecision\": \"allow|deny|ask\",\n    \"updatedInput\": {\"field\": \"modified_value\"}\n  },\n  \"systemMessage\": \"Explanation for Claude\"\n}\n```\n\n### PostToolUse\n\nExecute after tool completes. Use to react to results, provide feedback, or log.\n\n**Example:**\n\n```json\n{\n  \"PostToolUse\": [\n    {\n      \"matcher\": \"Edit\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Analyze edit result for potential issues: syntax errors, security vulnerabilities, breaking changes. Provide feedback.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Output behavior:**\n\n- Exit 0: stdout shown in transcript\n- Exit 2: stderr fed back to Claude\n- systemMessage included in context\n\n### Stop\n\nExecute when main agent considers stopping. Use to validate completeness.\n\n**Example:**\n\n```json\n{\n  \"Stop\": [\n    {\n      \"matcher\": \"*\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Verify task completion: tests run, build succeeded, questions answered. Return 'approve' to stop or 'block' with reason to continue.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Decision output:**\n\n```json\n{\n  \"decision\": \"approve|block\",\n  \"reason\": \"Explanation\",\n  \"systemMessage\": \"Additional context\"\n}\n```\n\n### SubagentStop\n\nExecute when subagent considers stopping. Use to ensure subagent completed its task.\n\nSimilar to Stop hook, but for subagents.\n\n### UserPromptSubmit\n\nExecute when user submits a prompt. Use to add context, validate, or block prompts.\n\n**Example:**\n\n```json\n{\n  \"UserPromptSubmit\": [\n    {\n      \"matcher\": \"*\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Check if prompt requires security guidance. If discussing auth, permissions, or API security, return relevant warnings.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n### SessionStart\n\nExecute when Claude Code session begins. Use to load context and set environment.\n\n**Example:**\n\n```json\n{\n  \"SessionStart\": [\n    {\n      \"matcher\": \"*\",\n      \"hooks\": [\n        {\n          \"type\": \"command\",\n          \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/load-context.sh\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Special capability:** Persist environment variables using `$CLAUDE_ENV_FILE`:\n\n```bash\necho \"export PROJECT_TYPE=nodejs\" >> \"$CLAUDE_ENV_FILE\"\n```\n\nSee `examples/load-context.sh` for complete example.\n\n### SessionEnd\n\nExecute when session ends. Use for cleanup, logging, and state preservation.\n\n### PreCompact\n\nExecute before context compaction. Use to add critical information to preserve.\n\n### Notification\n\nExecute when Claude sends notifications. Use to react to user notifications.\n\n## Hook Output Format\n\n### Standard Output (All Hooks)\n\n```json\n{\n  \"continue\": true,\n  \"suppressOutput\": false,\n  \"systemMessage\": \"Message for Claude\"\n}\n```\n\n- `continue`: If false, halt processing (default true)\n- `suppressOutput`: Hide output from transcript (default false)\n- `systemMessage`: Message shown to Claude\n\n### Exit Codes\n\n- `0` - Success (stdout shown in transcript)\n- `2` - Blocking error (stderr fed back to Claude)\n- Other - Non-blocking error\n\n## Hook Input Format\n\nAll hooks receive JSON via stdin with common fields:\n\n```json\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/path/to/transcript.txt\",\n  \"cwd\": \"/current/working/dir\",\n  \"permission_mode\": \"ask|allow\",\n  \"hook_event_name\": \"PreToolUse\"\n}\n```\n\n**Event-specific fields:**\n\n- **PreToolUse/PostToolUse:** `tool_name`, `tool_input`, `tool_result`\n- **UserPromptSubmit:** `user_prompt`\n- **Stop/SubagentStop:** `reason`\n\nAccess fields in prompts using `$TOOL_INPUT`, `$TOOL_RESULT`, `$USER_PROMPT`, etc.\n\n## Environment Variables\n\nAvailable in all command hooks:\n\n- `$CLAUDE_PROJECT_DIR` - Project root path\n- `$CLAUDE_PLUGIN_ROOT` - Plugin directory (use for portable paths)\n- `$CLAUDE_ENV_FILE` - SessionStart only: persist env vars here\n- `$CLAUDE_CODE_REMOTE` - Set if running in remote context\n\n**Always use ${CLAUDE_PLUGIN_ROOT} in hook commands for portability:**\n\n```json\n{\n  \"type\": \"command\",\n  \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/validate.sh\"\n}\n```\n\n## Plugin Hook Configuration\n\nIn plugins, define hooks in `hooks/hooks.json`:\n\n```json\n{\n  \"PreToolUse\": [\n    {\n      \"matcher\": \"Write|Edit\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Validate file write safety\"\n        }\n      ]\n    }\n  ],\n  \"Stop\": [\n    {\n      \"matcher\": \"*\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Verify task completion\"\n        }\n      ]\n    }\n  ],\n  \"SessionStart\": [\n    {\n      \"matcher\": \"*\",\n      \"hooks\": [\n        {\n          \"type\": \"command\",\n          \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/load-context.sh\",\n          \"timeout\": 10\n        }\n      ]\n    }\n  ]\n}\n```\n\nPlugin hooks merge with user's hooks and run in parallel.\n\n## Matchers\n\n### Tool Name Matching\n\n**Exact match:**\n\n```json\n\"matcher\": \"Write\"\n```\n\n**Multiple tools:**\n\n```json\n\"matcher\": \"Read|Write|Edit\"\n```\n\n**Wildcard (all tools):**\n\n```json\n\"matcher\": \"*\"\n```\n\n**Regex patterns:**\n\n```json\n\"matcher\": \"mcp__.*__delete.*\"  // All MCP delete tools\n```\n\n**Note:** Matchers are case-sensitive.\n\n### Common Patterns\n\n```json\n// All MCP tools\n\"matcher\": \"mcp__.*\"\n\n// Specific plugin's MCP tools\n\"matcher\": \"mcp__plugin_asana_.*\"\n\n// All file operations\n\"matcher\": \"Read|Write|Edit\"\n\n// Bash commands only\n\"matcher\": \"Bash\"\n```\n\n## Security Best Practices\n\n### Input Validation\n\nAlways validate inputs in command hooks:\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\ninput=$(cat)\ntool_name=$(echo \"$input\" | jq -r '.tool_name')\n\n# Validate tool name format\nif [[ ! \"$tool_name\" =~ ^[a-zA-Z0-9_]+$ ]]; then\n  echo '{\"decision\": \"deny\", \"reason\": \"Invalid tool name\"}' >&2\n  exit 2\nfi\n```\n\n### Path Safety\n\nCheck for path traversal and sensitive files:\n\n```bash\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path')\n\n# Deny path traversal\nif [[ \"$file_path\" == *\"..\"* ]]; then\n  echo '{\"decision\": \"deny\", \"reason\": \"Path traversal detected\"}' >&2\n  exit 2\nfi\n\n# Deny sensitive files\nif [[ \"$file_path\" == *\".env\"* ]]; then\n  echo '{\"decision\": \"deny\", \"reason\": \"Sensitive file\"}' >&2\n  exit 2\nfi\n```\n\nSee `examples/validate-write.sh` and `examples/validate-bash.sh` for complete examples.\n\n### Quote All Variables\n\n```bash\n# GOOD: Quoted\necho \"$file_path\"\ncd \"$CLAUDE_PROJECT_DIR\"\n\n# BAD: Unquoted (injection risk)\necho $file_path\ncd $CLAUDE_PROJECT_DIR\n```\n\n### Set Appropriate Timeouts\n\n```json\n{\n  \"type\": \"command\",\n  \"command\": \"bash script.sh\",\n  \"timeout\": 10\n}\n```\n\n**Defaults:** Command hooks (60s), Prompt hooks (30s)\n\n## Performance Considerations\n\n### Parallel Execution\n\nAll matching hooks run **in parallel**:\n\n```json\n{\n  \"PreToolUse\": [\n    {\n      \"matcher\": \"Write\",\n      \"hooks\": [\n        {\"type\": \"command\", \"command\": \"check1.sh\"},  // Parallel\n        {\"type\": \"command\", \"command\": \"check2.sh\"},  // Parallel\n        {\"type\": \"prompt\", \"prompt\": \"Validate...\"}   // Parallel\n      ]\n    }\n  ]\n}\n```\n\n**Design implications:**\n\n- Hooks don't see each other's output\n- Non-deterministic ordering\n- Design for independence\n\n### Optimization\n\n1. Use command hooks for quick deterministic checks\n2. Use prompt hooks for complex reasoning\n3. Cache validation results in temp files\n4. Minimize I/O in hot paths\n\n## Temporarily Active Hooks\n\nCreate hooks that activate conditionally by checking for a flag file or configuration:\n\n**Pattern: Flag file activation**\n\n```bash\n#!/bin/bash\n# Only active when flag file exists\nFLAG_FILE=\"$CLAUDE_PROJECT_DIR/.enable-strict-validation\"\n\nif [ ! -f \"$FLAG_FILE\" ]; then\n  # Flag not present, skip validation\n  exit 0\nfi\n\n# Flag present, run validation\ninput=$(cat)\n# ... validation logic ...\n```\n\n**Pattern: Configuration-based activation**\n\n```bash\n#!/bin/bash\n# Check configuration for activation\nCONFIG_FILE=\"$CLAUDE_PROJECT_DIR/.claude/plugin-config.json\"\n\nif [ -f \"$CONFIG_FILE\" ]; then\n  enabled=$(jq -r '.strictMode // false' \"$CONFIG_FILE\")\n  if [ \"$enabled\" != \"true\" ]; then\n    exit 0  # Not enabled, skip\n  fi\nfi\n\n# Enabled, run hook logic\ninput=$(cat)\n# ... hook logic ...\n```\n\n**Use cases:**\n\n- Enable strict validation only when needed\n- Temporary debugging hooks\n- Project-specific hook behavior\n- Feature flags for hooks\n\n**Best practice:** Document activation mechanism in plugin README so users know how to enable/disable temporary hooks.\n\n## Hook Lifecycle and Limitations\n\n### Hooks Load at Session Start\n\n**Important:** Hooks are loaded when Claude Code session starts. Changes to hook configuration require restarting Claude Code.\n\n**Cannot hot-swap hooks:**\n\n- Editing `hooks/hooks.json` won't affect current session\n- Adding new hook scripts won't be recognized\n- Changing hook commands/prompts won't update\n- Must restart Claude Code: exit and run `claude` again\n\n**To test hook changes:**\n\n1. Edit hook configuration or scripts\n2. Exit Claude Code session\n3. Restart: `claude` or `cc`\n4. New hook configuration loads\n5. Test hooks with `claude --debug`\n\n### Hook Validation at Startup\n\nHooks are validated when Claude Code starts:\n\n- Invalid JSON in hooks.json causes loading failure\n- Missing scripts cause warnings\n- Syntax errors reported in debug mode\n\nUse `/hooks` command to review loaded hooks in current session.\n\n## Debugging Hooks\n\n### Enable Debug Mode\n\n```bash\nclaude --debug\n```\n\nLook for hook registration, execution logs, input/output JSON, and timing information.\n\n### Test Hook Scripts\n\nTest command hooks directly:\n\n```bash\necho '{\"tool_name\": \"Write\", \"tool_input\": {\"file_path\": \"/test\"}}' | \\\n  bash ${CLAUDE_PLUGIN_ROOT}/scripts/validate.sh\n\necho \"Exit code: $?\"\n```\n\n### Validate JSON Output\n\nEnsure hooks output valid JSON:\n\n```bash\noutput=$(./your-hook.sh < test-input.json)\necho \"$output\" | jq .\n```\n\n## Quick Reference\n\n### Hook Events Summary\n\n| Event | When | Use For |\n|-------|------|---------|\n| PreToolUse | Before tool | Validation, modification |\n| PostToolUse | After tool | Feedback, logging |\n| UserPromptSubmit | User input | Context, validation |\n| Stop | Agent stopping | Completeness check |\n| SubagentStop | Subagent done | Task validation |\n| SessionStart | Session begins | Context loading |\n| SessionEnd | Session ends | Cleanup, logging |\n| PreCompact | Before compact | Preserve context |\n| Notification | User notified | Logging, reactions |\n\n### Best Practices\n\n**DO:**\n\n-  Use prompt-based hooks for complex logic\n-  Use ${CLAUDE_PLUGIN_ROOT} for portability\n-  Validate all inputs in command hooks\n-  Quote all bash variables\n-  Set appropriate timeouts\n-  Return structured JSON output\n-  Test hooks thoroughly\n\n**DON'T:**\n\n-  Use hardcoded paths\n-  Trust user input without validation\n-  Create long-running hooks\n-  Rely on hook execution order\n-  Modify global state unpredictably\n-  Log sensitive information\n\n## Additional Resources\n\n### Reference Files\n\nFor detailed patterns and advanced techniques, consult:\n\n- **`references/patterns.md`** - Common hook patterns (8+ proven patterns)\n- **`references/migration.md`** - Migrating from basic to advanced hooks\n- **`references/advanced.md`** - Advanced use cases and techniques\n\n### Example Hook Scripts\n\nWorking examples in `examples/`:\n\n- **`validate-write.sh`** - File write validation example\n- **`validate-bash.sh`** - Bash command validation example\n- **`load-context.sh`** - SessionStart context loading example\n\n### Utility Scripts\n\nDevelopment tools in `scripts/`:\n\n- **`validate-hook-schema.sh`** - Validate hooks.json structure and syntax\n- **`test-hook.sh`** - Test hooks with sample input before deployment\n- **`hook-linter.sh`** - Check hook scripts for common issues and best practices\n\n### External Resources\n\n- **Official Docs**: <https://docs.claude.com/en/docs/claude-code/hooks>\n- **Examples**: See security-guidance plugin in marketplace\n- **Testing**: Use `claude --debug` for detailed logs\n- **Validation**: Use `jq` to validate hook JSON output\n\n## Implementation Workflow\n\nTo implement hooks in a plugin:\n\n1. Identify events to hook into (PreToolUse, Stop, SessionStart, etc.)\n2. Decide between prompt-based (flexible) or command (deterministic) hooks\n3. Write hook configuration in `hooks/hooks.json`\n4. For command hooks, create hook scripts\n5. Use ${CLAUDE_PLUGIN_ROOT} for all file references\n6. Validate configuration with `scripts/validate-hook-schema.sh hooks/hooks.json`\n7. Test hooks with `scripts/test-hook.sh` before deployment\n8. Test in Claude Code with `claude --debug`\n9. Document hooks in plugin README\n\nFocus on prompt-based hooks for most use cases. Reserve command hooks for performance-critical or deterministic checks."
              },
              {
                "name": "mcp-integration",
                "description": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in plugin\", \"use .mcp.json\", \"set up Model Context Protocol\", \"connect external service\", mentions \"${CLAUDE_PLUGIN_ROOT} with MCP\", or discusses MCP server types (SSE, stdio, HTTP, WebSocket). Provides comprehensive guidance for integrating Model Context Protocol servers into Claude Code plugins for external tool and service integration.",
                "path": "plugins/meta/plugin-dev/skills/mcp-integration/SKILL.md",
                "frontmatter": {
                  "name": "mcp-integration",
                  "description": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in plugin\", \"use .mcp.json\", \"set up Model Context Protocol\", \"connect external service\", mentions \"${CLAUDE_PLUGIN_ROOT} with MCP\", or discusses MCP server types (SSE, stdio, HTTP, WebSocket). Provides comprehensive guidance for integrating Model Context Protocol servers into Claude Code plugins for external tool and service integration."
                },
                "content": "# MCP Integration for Claude Code Plugins\n\n## Overview\n\nModel Context Protocol (MCP) enables Claude Code plugins to integrate with external services and APIs by providing structured tool access. Use MCP integration to expose external service capabilities as tools within Claude Code.\n\n**Key capabilities:**\n\n- Connect to external services (databases, APIs, file systems)\n- Provide 10+ related tools from a single service\n- Handle OAuth and complex authentication flows\n- Bundle MCP servers with plugins for automatic setup\n\n## MCP Server Configuration Methods\n\nPlugins can bundle MCP servers in two ways:\n\n### Method 1: Dedicated .mcp.json (Recommended)\n\nCreate `.mcp.json` at plugin root:\n\n```json\n{\n  \"database-tools\": {\n    \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/db-server\",\n    \"args\": [\"--config\", \"${CLAUDE_PLUGIN_ROOT}/config.json\"],\n    \"env\": {\n      \"DB_URL\": \"${DB_URL}\"\n    }\n  }\n}\n```\n\n**Benefits:**\n\n- Clear separation of concerns\n- Easier to maintain\n- Better for multiple servers\n\n### Method 2: Inline in plugin.json\n\nAdd `mcpServers` field to plugin.json:\n\n```json\n{\n  \"name\": \"my-plugin\",\n  \"version\": \"1.0.0\",\n  \"mcpServers\": {\n    \"plugin-api\": {\n      \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/api-server\",\n      \"args\": [\"--port\", \"8080\"]\n    }\n  }\n}\n```\n\n**Benefits:**\n\n- Single configuration file\n- Good for simple single-server plugins\n\n## MCP Server Types\n\n### stdio (Local Process)\n\nExecute local MCP servers as child processes. Best for local tools and custom servers.\n\n**Configuration:**\n\n```json\n{\n  \"filesystem\": {\n    \"command\": \"npx\",\n    \"args\": [\"-y\", \"@modelcontextprotocol/server-filesystem\", \"/allowed/path\"],\n    \"env\": {\n      \"LOG_LEVEL\": \"debug\"\n    }\n  }\n}\n```\n\n**Use cases:**\n\n- File system access\n- Local database connections\n- Custom MCP servers\n- NPM-packaged MCP servers\n\n**Process management:**\n\n- Claude Code spawns and manages the process\n- Communicates via stdin/stdout\n- Terminates when Claude Code exits\n\n### SSE (Server-Sent Events)\n\nConnect to hosted MCP servers with OAuth support. Best for cloud services.\n\n**Configuration:**\n\n```json\n{\n  \"asana\": {\n    \"type\": \"sse\",\n    \"url\": \"https://mcp.asana.com/sse\"\n  }\n}\n```\n\n**Use cases:**\n\n- Official hosted MCP servers (Asana, GitHub, etc.)\n- Cloud services with MCP endpoints\n- OAuth-based authentication\n- No local installation needed\n\n**Authentication:**\n\n- OAuth flows handled automatically\n- User prompted on first use\n- Tokens managed by Claude Code\n\n### HTTP (REST API)\n\nConnect to RESTful MCP servers with token authentication.\n\n**Configuration:**\n\n```json\n{\n  \"api-service\": {\n    \"type\": \"http\",\n    \"url\": \"https://api.example.com/mcp\",\n    \"headers\": {\n      \"Authorization\": \"Bearer ${API_TOKEN}\",\n      \"X-Custom-Header\": \"value\"\n    }\n  }\n}\n```\n\n**Use cases:**\n\n- REST API-based MCP servers\n- Token-based authentication\n- Custom API backends\n- Stateless interactions\n\n### WebSocket (Real-time)\n\nConnect to WebSocket MCP servers for real-time bidirectional communication.\n\n**Configuration:**\n\n```json\n{\n  \"realtime-service\": {\n    \"type\": \"ws\",\n    \"url\": \"wss://mcp.example.com/ws\",\n    \"headers\": {\n      \"Authorization\": \"Bearer ${TOKEN}\"\n    }\n  }\n}\n```\n\n**Use cases:**\n\n- Real-time data streaming\n- Persistent connections\n- Push notifications from server\n- Low-latency requirements\n\n## Environment Variable Expansion\n\nAll MCP configurations support environment variable substitution:\n\n**${CLAUDE_PLUGIN_ROOT}** - Plugin directory (always use for portability):\n\n```json\n{\n  \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/my-server\"\n}\n```\n\n**User environment variables** - From user's shell:\n\n```json\n{\n  \"env\": {\n    \"API_KEY\": \"${MY_API_KEY}\",\n    \"DATABASE_URL\": \"${DB_URL}\"\n  }\n}\n```\n\n**Best practice:** Document all required environment variables in plugin README.\n\n## MCP Tool Naming\n\nWhen MCP servers provide tools, they're automatically prefixed:\n\n**Format:** `mcp__plugin_<plugin-name>_<server-name>__<tool-name>`\n\n**Example:**\n\n- Plugin: `asana`\n- Server: `asana`\n- Tool: `create_task`\n- **Full name:** `mcp__plugin_asana_asana__asana_create_task`\n\n### Using MCP Tools in Commands\n\nPre-allow specific MCP tools in command frontmatter:\n\n```markdown\n---\nallowed-tools: [\n  \"mcp__plugin_asana_asana__asana_create_task\",\n  \"mcp__plugin_asana_asana__asana_search_tasks\"\n]\n---\n```\n\n**Wildcard (use sparingly):**\n\n```markdown\n---\nallowed-tools: [\"mcp__plugin_asana_asana__*\"]\n---\n```\n\n**Best practice:** Pre-allow specific tools, not wildcards, for security.\n\n## Lifecycle Management\n\n**Automatic startup:**\n\n- MCP servers start when plugin enables\n- Connection established before first tool use\n- Restart required for configuration changes\n\n**Lifecycle:**\n\n1. Plugin loads\n2. MCP configuration parsed\n3. Server process started (stdio) or connection established (SSE/HTTP/WS)\n4. Tools discovered and registered\n5. Tools available as `mcp__plugin_...__...`\n\n**Viewing servers:**\nUse `/mcp` command to see all servers including plugin-provided ones.\n\n## Authentication Patterns\n\n### OAuth (SSE/HTTP)\n\nOAuth handled automatically by Claude Code:\n\n```json\n{\n  \"type\": \"sse\",\n  \"url\": \"https://mcp.example.com/sse\"\n}\n```\n\nUser authenticates in browser on first use. No additional configuration needed.\n\n### Token-Based (Headers)\n\nStatic or environment variable tokens:\n\n```json\n{\n  \"type\": \"http\",\n  \"url\": \"https://api.example.com\",\n  \"headers\": {\n    \"Authorization\": \"Bearer ${API_TOKEN}\"\n  }\n}\n```\n\nDocument required environment variables in README.\n\n### Environment Variables (stdio)\n\nPass configuration to MCP server:\n\n```json\n{\n  \"command\": \"python\",\n  \"args\": [\"-m\", \"my_mcp_server\"],\n  \"env\": {\n    \"DATABASE_URL\": \"${DB_URL}\",\n    \"API_KEY\": \"${API_KEY}\",\n    \"LOG_LEVEL\": \"info\"\n  }\n}\n```\n\n## Integration Patterns\n\n### Pattern 1: Simple Tool Wrapper\n\nCommands use MCP tools with user interaction:\n\n```markdown\n# Command: create-item.md\n---\nallowed-tools: [\"mcp__plugin_name_server__create_item\"]\n---\n\nSteps:\n1. Gather item details from user\n2. Use mcp__plugin_name_server__create_item\n3. Confirm creation\n```\n\n**Use for:** Adding validation or preprocessing before MCP calls.\n\n### Pattern 2: Autonomous Agent\n\nAgents use MCP tools autonomously:\n\n```markdown\n# Agent: data-analyzer.md\n\nAnalysis Process:\n1. Query data via mcp__plugin_db_server__query\n2. Process and analyze results\n3. Generate insights report\n```\n\n**Use for:** Multi-step MCP workflows without user interaction.\n\n### Pattern 3: Multi-Server Plugin\n\nIntegrate multiple MCP servers:\n\n```json\n{\n  \"github\": {\n    \"type\": \"sse\",\n    \"url\": \"https://mcp.github.com/sse\"\n  },\n  \"jira\": {\n    \"type\": \"sse\",\n    \"url\": \"https://mcp.jira.com/sse\"\n  }\n}\n```\n\n**Use for:** Workflows spanning multiple services.\n\n## Security Best Practices\n\n### Use HTTPS/WSS\n\nAlways use secure connections:\n\n```json\n \"url\": \"https://mcp.example.com/sse\"\n \"url\": \"http://mcp.example.com/sse\"\n```\n\n### Token Management\n\n**DO:**\n\n-  Use environment variables for tokens\n-  Document required env vars in README\n-  Let OAuth flow handle authentication\n\n**DON'T:**\n\n-  Hardcode tokens in configuration\n-  Commit tokens to git\n-  Share tokens in documentation\n\n### Permission Scoping\n\nPre-allow only necessary MCP tools:\n\n```markdown\n allowed-tools: [\n  \"mcp__plugin_api_server__read_data\",\n  \"mcp__plugin_api_server__create_item\"\n]\n\n allowed-tools: [\"mcp__plugin_api_server__*\"]\n```\n\n## Error Handling\n\n### Connection Failures\n\nHandle MCP server unavailability:\n\n- Provide fallback behavior in commands\n- Inform user of connection issues\n- Check server URL and configuration\n\n### Tool Call Errors\n\nHandle failed MCP operations:\n\n- Validate inputs before calling MCP tools\n- Provide clear error messages\n- Check rate limiting and quotas\n\n### Configuration Errors\n\nValidate MCP configuration:\n\n- Test server connectivity during development\n- Validate JSON syntax\n- Check required environment variables\n\n## Performance Considerations\n\n### Lazy Loading\n\nMCP servers connect on-demand:\n\n- Not all servers connect at startup\n- First tool use triggers connection\n- Connection pooling managed automatically\n\n### Batching\n\nBatch similar requests when possible:\n\n```text\n# Good: Single query with filters\ntasks = search_tasks(project=\"X\", assignee=\"me\", limit=50)\n\n# Avoid: Many individual queries\nfor id in task_ids:\n    task = get_task(id)\n```\n\n## Testing MCP Integration\n\n### Local Testing\n\n1. Configure MCP server in `.mcp.json`\n2. Install plugin locally (`.claude-plugin/`)\n3. Run `/mcp` to verify server appears\n4. Test tool calls in commands\n5. Check `claude --debug` logs for connection issues\n\n### Validation Checklist\n\n- [ ] MCP configuration is valid JSON\n- [ ] Server URL is correct and accessible\n- [ ] Required environment variables documented\n- [ ] Tools appear in `/mcp` output\n- [ ] Authentication works (OAuth or tokens)\n- [ ] Tool calls succeed from commands\n- [ ] Error cases handled gracefully\n\n## Debugging\n\n### Enable Debug Logging\n\n```bash\nclaude --debug\n```\n\nLook for:\n\n- MCP server connection attempts\n- Tool discovery logs\n- Authentication flows\n- Tool call errors\n\n### Common Issues\n\n**Server not connecting:**\n\n- Check URL is correct\n- Verify server is running (stdio)\n- Check network connectivity\n- Review authentication configuration\n\n**Tools not available:**\n\n- Verify server connected successfully\n- Check tool names match exactly\n- Run `/mcp` to see available tools\n- Restart Claude Code after config changes\n\n**Authentication failing:**\n\n- Clear cached auth tokens\n- Re-authenticate\n- Check token scopes and permissions\n- Verify environment variables set\n\n## Quick Reference\n\n### MCP Server Types\n\n| Type | Transport | Best For | Auth |\n|------|-----------|----------|------|\n| stdio | Process | Local tools, custom servers | Env vars |\n| SSE | HTTP | Hosted services, cloud APIs | OAuth |\n| HTTP | REST | API backends, token auth | Tokens |\n| ws | WebSocket | Real-time, streaming | Tokens |\n\n### Configuration Checklist\n\n- [ ] Server type specified (stdio/SSE/HTTP/ws)\n- [ ] Type-specific fields complete (command or url)\n- [ ] Authentication configured\n- [ ] Environment variables documented\n- [ ] HTTPS/WSS used (not HTTP/WS)\n- [ ] ${CLAUDE_PLUGIN_ROOT} used for paths\n\n### Best Practices\n\n**DO:**\n\n-  Use ${CLAUDE_PLUGIN_ROOT} for portable paths\n-  Document required environment variables\n-  Use secure connections (HTTPS/WSS)\n-  Pre-allow specific MCP tools in commands\n-  Test MCP integration before publishing\n-  Handle connection and tool errors gracefully\n\n**DON'T:**\n\n-  Hardcode absolute paths\n-  Commit credentials to git\n-  Use HTTP instead of HTTPS\n-  Pre-allow all tools with wildcards\n-  Skip error handling\n-  Forget to document setup\n\n## Additional Resources\n\n### Reference Files\n\nFor detailed information, consult:\n\n- **`references/server-types.md`** - Deep dive on each server type\n- **`references/authentication.md`** - Authentication patterns and OAuth\n- **`references/tool-usage.md`** - Using MCP tools in commands and agents\n\n### Example Configurations\n\nWorking examples in `examples/`:\n\n- **`stdio-server.json`** - Local stdio MCP server\n- **`sse-server.json`** - Hosted SSE server with OAuth\n- **`http-server.json`** - REST API with token auth\n\n### External Resources\n\n- **Official MCP Docs**: <https://modelcontextprotocol.io/>\n- **Claude Code MCP Docs**: <https://docs.claude.com/en/docs/claude-code/mcp>\n- **MCP SDK**: @modelcontextprotocol/sdk\n- **Testing**: Use `claude --debug` and `/mcp` command\n\n## Implementation Workflow\n\nTo add MCP integration to a plugin:\n\n1. Choose MCP server type (stdio, SSE, HTTP, ws)\n2. Create `.mcp.json` at plugin root with configuration\n3. Use ${CLAUDE_PLUGIN_ROOT} for all file references\n4. Document required environment variables in README\n5. Test locally with `/mcp` command\n6. Pre-allow MCP tools in relevant commands\n7. Handle authentication (OAuth or tokens)\n8. Test error cases (connection failures, auth errors)\n9. Document MCP integration in plugin README\n\nFocus on stdio for custom/local servers, SSE for hosted services with OAuth."
              },
              {
                "name": "plugin-settings",
                "description": "This skill should be used when the user asks about \"plugin settings\", \"store plugin configuration\", \"user-configurable plugin\", \".local.md files\", \"plugin state files\", \"read YAML frontmatter\", \"per-project plugin settings\", or wants to make plugin behavior configurable. Documents the .claude/plugin-name.local.md pattern for storing plugin-specific configuration with YAML frontmatter and markdown content.",
                "path": "plugins/meta/plugin-dev/skills/plugin-settings/SKILL.md",
                "frontmatter": {
                  "name": "plugin-settings",
                  "description": "This skill should be used when the user asks about \"plugin settings\", \"store plugin configuration\", \"user-configurable plugin\", \".local.md files\", \"plugin state files\", \"read YAML frontmatter\", \"per-project plugin settings\", or wants to make plugin behavior configurable. Documents the .claude/plugin-name.local.md pattern for storing plugin-specific configuration with YAML frontmatter and markdown content."
                },
                "content": "# Plugin Settings Pattern for Claude Code Plugins\n\n## Overview\n\nPlugins can store user-configurable settings and state in `.claude/plugin-name.local.md` files within the project directory. This pattern uses YAML frontmatter for structured configuration and markdown content for prompts or additional context.\n\n**Key characteristics:**\n\n- File location: `.claude/plugin-name.local.md` in project root\n- Structure: YAML frontmatter + markdown body\n- Purpose: Per-project plugin configuration and state\n- Usage: Read from hooks, commands, and agents\n- Lifecycle: User-managed (not in git, should be in `.gitignore`)\n\n## File Structure\n\n### Basic Template\n\n```markdown\n---\nenabled: true\nsetting1: value1\nsetting2: value2\nnumeric_setting: 42\nlist_setting: [\"item1\", \"item2\"]\n---\n\n# Additional Context\n\nThis markdown body can contain:\n- Task descriptions\n- Additional instructions\n- Prompts to feed back to Claude\n- Documentation or notes\n```\n\n### Example: Plugin State File\n\n**.claude/my-plugin.local.md:**\n\n```markdown\n---\nenabled: true\nstrict_mode: false\nmax_retries: 3\nnotification_level: info\ncoordinator_session: team-leader\n---\n\n# Plugin Configuration\n\nThis plugin is configured for standard validation mode.\nContact @team-lead with questions.\n```\n\n## Reading Settings Files\n\n### From Hooks (Bash Scripts)\n\n**Pattern: Check existence and parse frontmatter**\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\n# Define state file path\nSTATE_FILE=\".claude/my-plugin.local.md\"\n\n# Quick exit if file doesn't exist\nif [[ ! -f \"$STATE_FILE\" ]]; then\n  exit 0  # Plugin not configured, skip\nfi\n\n# Parse YAML frontmatter (between --- markers)\nFRONTMATTER=$(sed -n '/^---$/,/^---$/{ /^---$/d; p; }' \"$STATE_FILE\")\n\n# Extract individual fields\nENABLED=$(echo \"$FRONTMATTER\" | grep '^enabled:' | sed 's/enabled: *//' | sed 's/^\"\\(.*\\)\"$/\\1/')\nSTRICT_MODE=$(echo \"$FRONTMATTER\" | grep '^strict_mode:' | sed 's/strict_mode: *//' | sed 's/^\"\\(.*\\)\"$/\\1/')\n\n# Check if enabled\nif [[ \"$ENABLED\" != \"true\" ]]; then\n  exit 0  # Disabled\nfi\n\n# Use configuration in hook logic\nif [[ \"$STRICT_MODE\" == \"true\" ]]; then\n  # Apply strict validation\n  # ...\nfi\n```\n\nSee `examples/read-settings-hook.sh` for complete working example.\n\n### From Commands\n\nCommands can read settings files to customize behavior:\n\n```markdown\n---\ndescription: Process data with plugin\nallowed-tools: [\"Read\", \"Bash\"]\n---\n\n# Process Command\n\nSteps:\n1. Check if settings exist at `.claude/my-plugin.local.md`\n2. Read configuration using Read tool\n3. Parse YAML frontmatter to extract settings\n4. Apply settings to processing logic\n5. Execute with configured behavior\n```\n\n### From Agents\n\nAgents can reference settings in their instructions:\n\n```markdown\n---\nname: configured-agent\ndescription: Agent that adapts to project settings\n---\n\nCheck for plugin settings at `.claude/my-plugin.local.md`.\nIf present, parse YAML frontmatter and adapt behavior according to:\n- enabled: Whether plugin is active\n- mode: Processing mode (strict, standard, lenient)\n- Additional configuration fields\n```\n\n## Parsing Techniques\n\n### Extract Frontmatter\n\n```bash\n# Extract everything between --- markers\nFRONTMATTER=$(sed -n '/^---$/,/^---$/{ /^---$/d; p; }' \"$FILE\")\n```\n\n### Read Individual Fields\n\n**String fields:**\n\n```bash\nVALUE=$(echo \"$FRONTMATTER\" | grep '^field_name:' | sed 's/field_name: *//' | sed 's/^\"\\(.*\\)\"$/\\1/')\n```\n\n**Boolean fields:**\n\n```bash\nENABLED=$(echo \"$FRONTMATTER\" | grep '^enabled:' | sed 's/enabled: *//')\n# Compare: if [[ \"$ENABLED\" == \"true\" ]]; then\n```\n\n**Numeric fields:**\n\n```bash\nMAX=$(echo \"$FRONTMATTER\" | grep '^max_value:' | sed 's/max_value: *//')\n# Use: if [[ $MAX -gt 100 ]]; then\n```\n\n### Read Markdown Body\n\nExtract content after second `---`:\n\n```bash\n# Get everything after closing ---\nBODY=$(awk '/^---$/{i++; next} i>=2' \"$FILE\")\n```\n\n## Common Patterns\n\n### Pattern 1: Temporarily Active Hooks\n\nUse settings file to control hook activation:\n\n```bash\n#!/bin/bash\nSTATE_FILE=\".claude/security-scan.local.md\"\n\n# Quick exit if not configured\nif [[ ! -f \"$STATE_FILE\" ]]; then\n  exit 0\nfi\n\n# Read enabled flag\nFRONTMATTER=$(sed -n '/^---$/,/^---$/{ /^---$/d; p; }' \"$STATE_FILE\")\nENABLED=$(echo \"$FRONTMATTER\" | grep '^enabled:' | sed 's/enabled: *//')\n\nif [[ \"$ENABLED\" != \"true\" ]]; then\n  exit 0  # Disabled\nfi\n\n# Run hook logic\n# ...\n```\n\n**Use case:** Enable/disable hooks without editing hooks.json (requires restart).\n\n### Pattern 2: Agent State Management\n\nStore agent-specific state and configuration:\n\n**.claude/multi-agent-swarm.local.md:**\n\n```markdown\n---\nagent_name: auth-agent\ntask_number: 3.5\npr_number: 1234\ncoordinator_session: team-leader\nenabled: true\ndependencies: [\"Task 3.4\"]\n---\n\n# Task Assignment\n\nImplement JWT authentication for the API.\n\n**Success Criteria:**\n- Authentication endpoints created\n- Tests passing\n- PR created and CI green\n```\n\nRead from hooks to coordinate agents:\n\n```bash\nAGENT_NAME=$(echo \"$FRONTMATTER\" | grep '^agent_name:' | sed 's/agent_name: *//')\nCOORDINATOR=$(echo \"$FRONTMATTER\" | grep '^coordinator_session:' | sed 's/coordinator_session: *//')\n\n# Send notification to coordinator\ntmux send-keys -t \"$COORDINATOR\" \"Agent $AGENT_NAME completed task\" Enter\n```\n\n### Pattern 3: Configuration-Driven Behavior\n\n**.claude/my-plugin.local.md:**\n\n```markdown\n---\nvalidation_level: strict\nmax_file_size: 1000000\nallowed_extensions: [\".js\", \".ts\", \".tsx\"]\nenable_logging: true\n---\n\n# Validation Configuration\n\nStrict mode enabled for this project.\nAll writes validated against security policies.\n```\n\nUse in hooks or commands:\n\n```bash\nLEVEL=$(echo \"$FRONTMATTER\" | grep '^validation_level:' | sed 's/validation_level: *//')\n\ncase \"$LEVEL\" in\n  strict)\n    # Apply strict validation\n    ;;\n  standard)\n    # Apply standard validation\n    ;;\n  lenient)\n    # Apply lenient validation\n    ;;\nesac\n```\n\n## Creating Settings Files\n\n### From Commands\n\nCommands can create settings files:\n\n```markdown\n# Setup Command\n\nSteps:\n1. Ask user for configuration preferences\n2. Create `.claude/my-plugin.local.md` with YAML frontmatter\n3. Set appropriate values based on user input\n4. Inform user that settings are saved\n5. Remind user to restart Claude Code for hooks to recognize changes\n```\n\n### Template Generation\n\nProvide template in plugin README:\n\n```markdown\n## Configuration\n\nCreate `.claude/my-plugin.local.md` in your project:\n\n\\`\\`\\`markdown\n---\nenabled: true\nmode: standard\nmax_retries: 3\n---\n\n# Plugin Configuration\n\nYour settings are active.\n\\`\\`\\`\n\nAfter creating or editing, restart Claude Code for changes to take effect.\n```\n\n## Best Practices\n\n### File Naming\n\n **DO:**\n\n- Use `.claude/plugin-name.local.md` format\n- Match plugin name exactly\n- Use `.local.md` suffix for user-local files\n\n **DON'T:**\n\n- Use different directory (not `.claude/`)\n- Use inconsistent naming\n- Use `.md` without `.local` (might be committed)\n\n### Gitignore\n\nAlways add to `.gitignore`:\n\n```gitignore\n.claude/*.local.md\n.claude/*.local.json\n```\n\nDocument this in plugin README.\n\n### Defaults\n\nProvide sensible defaults when settings file doesn't exist:\n\n```bash\nif [[ ! -f \"$STATE_FILE\" ]]; then\n  # Use defaults\n  ENABLED=true\n  MODE=standard\nelse\n  # Read from file\n  # ...\nfi\n```\n\n### Validation\n\nValidate settings values:\n\n```bash\nMAX=$(echo \"$FRONTMATTER\" | grep '^max_value:' | sed 's/max_value: *//')\n\n# Validate numeric range\nif ! [[ \"$MAX\" =~ ^[0-9]+$ ]] || [[ $MAX -lt 1 ]] || [[ $MAX -gt 100 ]]; then\n  echo \"  Invalid max_value in settings (must be 1-100)\" >&2\n  MAX=10  # Use default\nfi\n```\n\n### Restart Requirement\n\n**Important:** Settings changes require Claude Code restart.\n\nDocument in your README:\n\n```markdown\n## Changing Settings\n\nAfter editing `.claude/my-plugin.local.md`:\n1. Save the file\n2. Exit Claude Code\n3. Restart: `claude` or `cc`\n4. New settings will be loaded\n```\n\nHooks cannot be hot-swapped within a session.\n\n## Security Considerations\n\n### Sanitize User Input\n\nWhen writing settings files from user input:\n\n```bash\n# Escape quotes in user input\nSAFE_VALUE=$(echo \"$USER_INPUT\" | sed 's/\"/\\\\\"/g')\n\n# Write to file\ncat > \"$STATE_FILE\" <<EOF\n---\nuser_setting: \"$SAFE_VALUE\"\n---\nEOF\n```\n\n### Validate File Paths\n\nIf settings contain file paths:\n\n```bash\nFILE_PATH=$(echo \"$FRONTMATTER\" | grep '^data_file:' | sed 's/data_file: *//')\n\n# Check for path traversal\nif [[ \"$FILE_PATH\" == *\"..\"* ]]; then\n  echo \"  Invalid path in settings (path traversal)\" >&2\n  exit 2\nfi\n```\n\n### Permissions\n\nSettings files should be:\n\n- Readable by user only (`chmod 600`)\n- Not committed to git\n- Not shared between users\n\n## Real-World Examples\n\n### multi-agent-swarm Plugin\n\n**.claude/multi-agent-swarm.local.md:**\n\n```markdown\n---\nagent_name: auth-implementation\ntask_number: 3.5\npr_number: 1234\ncoordinator_session: team-leader\nenabled: true\ndependencies: [\"Task 3.4\"]\nadditional_instructions: Use JWT tokens, not sessions\n---\n\n# Task: Implement Authentication\n\nBuild JWT-based authentication for the REST API.\nCoordinate with auth-agent on shared types.\n```\n\n**Hook usage (agent-stop-notification.sh):**\n\n- Checks if file exists (line 15-18: quick exit if not)\n- Parses frontmatter to get coordinator_session, agent_name, enabled\n- Sends notifications to coordinator if enabled\n- Allows quick activation/deactivation via `enabled: true/false`\n\n### ralph-wiggum Plugin\n\n**.claude/ralph-loop.local.md:**\n\n```markdown\n---\niteration: 1\nmax_iterations: 10\ncompletion_promise: \"All tests passing and build successful\"\n---\n\nFix all the linting errors in the project.\nMake sure tests pass after each fix.\n```\n\n**Hook usage (stop-hook.sh):**\n\n- Checks if file exists (line 15-18: quick exit if not active)\n- Reads iteration count and max_iterations\n- Extracts completion_promise for loop termination\n- Reads body as the prompt to feed back\n- Updates iteration count on each loop\n\n## Quick Reference\n\n### File Location\n\n```text\nproject-root/\n .claude/\n     plugin-name.local.md\n```\n\n### Frontmatter Parsing\n\n```bash\n# Extract frontmatter\nFRONTMATTER=$(sed -n '/^---$/,/^---$/{ /^---$/d; p; }' \"$FILE\")\n\n# Read field\nVALUE=$(echo \"$FRONTMATTER\" | grep '^field:' | sed 's/field: *//' | sed 's/^\"\\(.*\\)\"$/\\1/')\n```\n\n### Body Parsing\n\n```bash\n# Extract body (after second ---)\nBODY=$(awk '/^---$/{i++; next} i>=2' \"$FILE\")\n```\n\n### Quick Exit Pattern\n\n```bash\nif [[ ! -f \".claude/my-plugin.local.md\" ]]; then\n  exit 0  # Not configured\nfi\n```\n\n## Additional Resources\n\n### Reference Files\n\nFor detailed implementation patterns:\n\n- **`references/parsing-techniques.md`** - Complete guide to parsing YAML frontmatter and markdown bodies\n- **`references/real-world-examples.md`** - Deep dive into multi-agent-swarm and ralph-wiggum implementations\n\n### Example Files\n\nWorking examples in `examples/`:\n\n- **`read-settings-hook.sh`** - Hook that reads and uses settings\n- **`create-settings-command.md`** - Command that creates settings file\n- **`example-settings.md`** - Template settings file\n\n### Utility Scripts\n\nDevelopment tools in `scripts/`:\n\n- **`validate-settings.sh`** - Validate settings file structure\n- **`parse-frontmatter.sh`** - Extract frontmatter fields\n\n## Implementation Workflow\n\nTo add settings to a plugin:\n\n1. Design settings schema (which fields, types, defaults)\n2. Create template file in plugin documentation\n3. Add gitignore entry for `.claude/*.local.md`\n4. Implement settings parsing in hooks/commands\n5. Use quick-exit pattern (check file exists, check enabled field)\n6. Document settings in plugin README with template\n7. Remind users that changes require Claude Code restart\n\nFocus on keeping settings simple and providing good defaults when settings file doesn't exist."
              },
              {
                "name": "plugin-structure",
                "description": "This skill should be used when the user asks to \"create a plugin\", \"scaffold a plugin\", \"understand plugin structure\", \"organize plugin components\", \"set up plugin.json\", \"use ${CLAUDE_PLUGIN_ROOT}\", \"add commands/agents/skills/hooks\", \"configure auto-discovery\", or needs guidance on plugin directory layout, manifest configuration, component organization, file naming conventions, or Claude Code plugin architecture best practices.",
                "path": "plugins/meta/plugin-dev/skills/plugin-structure/SKILL.md",
                "frontmatter": {
                  "name": "plugin-structure",
                  "description": "This skill should be used when the user asks to \"create a plugin\", \"scaffold a plugin\", \"understand plugin structure\", \"organize plugin components\", \"set up plugin.json\", \"use ${CLAUDE_PLUGIN_ROOT}\", \"add commands/agents/skills/hooks\", \"configure auto-discovery\", or needs guidance on plugin directory layout, manifest configuration, component organization, file naming conventions, or Claude Code plugin architecture best practices."
                },
                "content": "# Plugin Structure for Claude Code\n\n> **Reference:** See [plugin-spec.md](references/plugin-spec.md) for the official specification.\n\n## Overview\n\nClaude Code plugins follow a standardized directory structure with automatic component discovery. Understanding this structure enables creating well-organized, maintainable plugins that integrate seamlessly with Claude Code.\n\n**Key concepts:**\n\n- Conventional directory layout for automatic discovery\n- Manifest-driven configuration in `.claude-plugin/plugin.json`\n- Component-based organization (commands, agents, skills, hooks)\n- Portable path references using `${CLAUDE_PLUGIN_ROOT}`\n- Explicit vs. auto-discovered component loading\n\n## Directory Structure\n\nEvery Claude Code plugin follows this organizational pattern:\n\n```text\nplugin-name/\n .claude-plugin/\n    plugin.json          # Required: Plugin manifest\n commands/                 # Slash commands (.md files)\n agents/                   # Subagent definitions (.md files)\n skills/                   # Agent skills (subdirectories)\n    skill-name/\n        SKILL.md         # Required for each skill\n hooks/\n    hooks.json           # Event handler configuration\n .mcp.json                # MCP server definitions\n scripts/                 # Helper scripts and utilities\n```\n\n**Critical rules:**\n\n1. **Manifest location**: The `plugin.json` manifest MUST be in `.claude-plugin/` directory\n2. **Component locations**: All component directories (commands, agents, skills, hooks) MUST be at plugin root level, NOT nested inside `.claude-plugin/`\n3. **Optional components**: Only create directories for components the plugin actually uses\n4. **Naming convention**: Use kebab-case for all directory and file names\n\n## Plugin Manifest (plugin.json)\n\nThe manifest defines plugin metadata and configuration. Located at `.claude-plugin/plugin.json`:\n\n### Required Fields\n\n```json\n{\n  \"name\": \"plugin-name\"\n}\n```\n\n**Name requirements:**\n\n- Use kebab-case format (lowercase with hyphens)\n- Must be unique across installed plugins\n- No spaces or special characters\n- Example: `code-review-assistant`, `test-runner`, `api-docs`\n\n### Recommended Metadata\n\n```json\n{\n  \"name\": \"plugin-name\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Brief explanation of plugin purpose\",\n  \"author\": {\n    \"name\": \"Author Name\",\n    \"email\": \"author@example.com\",\n    \"url\": \"https://example.com\"\n  },\n  \"homepage\": \"https://docs.example.com\",\n  \"repository\": \"https://github.com/user/plugin-name\",\n  \"license\": \"MIT\",\n  \"keywords\": [\"testing\", \"automation\", \"ci-cd\"]\n}\n```\n\n**Version format**: Follow semantic versioning (MAJOR.MINOR.PATCH)\n**Keywords**: Use for plugin discovery and categorization\n\n### Component Path Configuration\n\nSpecify custom paths for components (supplements default directories):\n\n```json\n{\n  \"name\": \"plugin-name\",\n  \"commands\": \"./custom-commands\",\n  \"agents\": [\"./agents\", \"./specialized-agents\"],\n  \"hooks\": \"./config/hooks.json\",\n  \"mcpServers\": \"./.mcp.json\"\n}\n```\n\n**Important**: Custom paths supplement defaultsthey don't replace them. Components in both default directories and custom paths will load.\n\n**Path rules:**\n\n- Must be relative to plugin root\n- Must start with `./`\n- Cannot use absolute paths\n- Support arrays for multiple locations\n\n## Component Organization\n\n### Commands\n\n**Location**: `commands/` directory\n**Format**: Markdown files with YAML frontmatter\n**Auto-discovery**: All `.md` files in `commands/` load automatically\n\n**Example structure**:\n\n```text\ncommands/\n review.md        # /review command\n test.md          # /test command\n deploy.md        # /deploy command\n```\n\n**File format**:\n\n```markdown\n---\nname: command-name\ndescription: Command description\n---\n\nCommand implementation instructions...\n```\n\n**Usage**: Commands integrate as native slash commands in Claude Code\n\n### Agents\n\n**Location**: `agents/` directory\n**Format**: Markdown files with YAML frontmatter\n**Auto-discovery**: All `.md` files in `agents/` load automatically\n\n**Example structure**:\n\n```text\nagents/\n code-reviewer.md\n test-generator.md\n refactorer.md\n```\n\n**File format**:\n\n```markdown\n---\ndescription: Agent role and expertise\ncapabilities:\n  - Specific task 1\n  - Specific task 2\n---\n\nDetailed agent instructions and knowledge...\n```\n\n**Usage**: Users can invoke agents manually, or Claude Code selects them automatically based on task context\n\n### Skills\n\n**Location**: `skills/` directory with subdirectories per skill\n**Format**: Each skill in its own directory with `SKILL.md` file\n**Auto-discovery**: All `SKILL.md` files in skill subdirectories load automatically\n\n**Example structure**:\n\n```text\nskills/\n api-testing/\n    SKILL.md\n    scripts/\n       test-runner.py\n    references/\n        api-spec.md\n database-migrations/\n     SKILL.md\n     examples/\n         migration-template.sql\n```\n\n**SKILL.md format**:\n\n```markdown\n---\nname: Skill Name\ndescription: When to use this skill\n---\n\nSkill instructions and guidance...\n```\n\n**Supporting files**: Skills can include scripts, references, examples, or assets in subdirectories\n\n**Usage**: Claude Code autonomously activates skills based on task context matching the description\n\n### Hooks\n\n**Location**: `hooks/hooks.json` or inline in `plugin.json`\n**Format**: JSON configuration defining event handlers\n**Registration**: Hooks register automatically when plugin enables\n\n**Example structure**:\n\n```text\nhooks/\n hooks.json           # Hook configuration\n scripts/\n     validate.sh      # Hook script\n     check-style.sh   # Hook script\n```\n\n**Configuration format**:\n\n```json\n{\n  \"PreToolUse\": [{\n    \"matcher\": \"Write|Edit\",\n    \"hooks\": [{\n      \"type\": \"command\",\n      \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/hooks/scripts/validate.sh\",\n      \"timeout\": 30\n    }]\n  }]\n}\n```\n\n**Available events**: PreToolUse, PostToolUse, Stop, SubagentStop, SessionStart, SessionEnd, UserPromptSubmit, PreCompact, Notification\n\n**Usage**: Hooks execute automatically in response to Claude Code events\n\n### MCP Servers\n\n**Location**: `.mcp.json` at plugin root or inline in `plugin.json`\n**Format**: JSON configuration for MCP server definitions\n**Auto-start**: Servers start automatically when plugin enables\n\n**Example format**:\n\n```json\n{\n  \"mcpServers\": {\n    \"server-name\": {\n      \"command\": \"node\",\n      \"args\": [\"${CLAUDE_PLUGIN_ROOT}/servers/server.js\"],\n      \"env\": {\n        \"API_KEY\": \"${API_KEY}\"\n      }\n    }\n  }\n}\n```\n\n**Usage**: MCP servers integrate seamlessly with Claude Code's tool system\n\n## Portable Path References\n\n### ${CLAUDE_PLUGIN_ROOT}\n\nUse `${CLAUDE_PLUGIN_ROOT}` environment variable for all intra-plugin path references:\n\n```json\n{\n  \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/run.sh\"\n}\n```\n\n**Why it matters**: Plugins install in different locations depending on:\n\n- User installation method (marketplace, local, npm)\n- Operating system conventions\n- User preferences\n\n**Where to use it**:\n\n- Hook command paths\n- MCP server command arguments\n- Script execution references\n- Resource file paths\n\n**Never use**:\n\n- Hardcoded absolute paths (`/Users/name/plugins/...`)\n- Relative paths from working directory (`./scripts/...` in commands)\n- Home directory shortcuts (`~/plugins/...`)\n\n### Path Resolution Rules\n\n**In manifest JSON fields** (hooks, MCP servers):\n\n```json\n\"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/tool.sh\"\n```\n\n**In component files** (commands, agents, skills):\n\n```markdown\nReference scripts at: ${CLAUDE_PLUGIN_ROOT}/scripts/helper.py\n```\n\n**In executed scripts**:\n\n```bash\n#!/bin/bash\n# ${CLAUDE_PLUGIN_ROOT} available as environment variable\nsource \"${CLAUDE_PLUGIN_ROOT}/lib/common.sh\"\n```\n\n## File Naming Conventions\n\n### Component Files\n\n**Commands**: Use kebab-case `.md` files\n\n- `code-review.md`  `/code-review`\n- `run-tests.md`  `/run-tests`\n- `api-docs.md`  `/api-docs`\n\n**Agents**: Use kebab-case `.md` files describing role\n\n- `test-generator.md`\n- `code-reviewer.md`\n- `performance-analyzer.md`\n\n**Skills**: Use kebab-case directory names\n\n- `api-testing/`\n- `database-migrations/`\n- `error-handling/`\n\n### Supporting Files\n\n**Scripts**: Use descriptive kebab-case names with appropriate extensions\n\n- `validate-input.sh`\n- `generate-report.py`\n- `process-data.js`\n\n**Documentation**: Use kebab-case markdown files\n\n- `api-reference.md`\n- `migration-guide.md`\n- `best-practices.md`\n\n**Configuration**: Use standard names\n\n- `hooks.json`\n- `.mcp.json`\n- `plugin.json`\n\n## Auto-Discovery Mechanism\n\nClaude Code automatically discovers and loads components:\n\n1. **Plugin manifest**: Reads `.claude-plugin/plugin.json` when plugin enables\n2. **Commands**: Scans `commands/` directory for `.md` files\n3. **Agents**: Scans `agents/` directory for `.md` files\n4. **Skills**: Scans `skills/` for subdirectories containing `SKILL.md`\n5. **Hooks**: Loads configuration from `hooks/hooks.json` or manifest\n6. **MCP servers**: Loads configuration from `.mcp.json` or manifest\n\n**Discovery timing**:\n\n- Plugin installation: Components register with Claude Code\n- Plugin enable: Components become available for use\n- No restart required: Changes take effect on next Claude Code session\n\n**Override behavior**: Custom paths in `plugin.json` supplement (not replace) default directories\n\n## Best Practices\n\n### Organization\n\n1. **Logical grouping**: Group related components together\n   - Put test-related commands, agents, and skills together\n   - Create subdirectories in `scripts/` for different purposes\n\n2. **Minimal manifest**: Keep `plugin.json` lean\n   - Only specify custom paths when necessary\n   - Rely on auto-discovery for standard layouts\n   - Use inline configuration only for simple cases\n\n3. **Documentation**: Include README files\n   - Plugin root: Overall purpose and usage\n   - Component directories: Specific guidance\n   - Script directories: Usage and requirements\n\n### Naming\n\n1. **Consistency**: Use consistent naming across components\n   - If command is `test-runner`, name related agent `test-runner-agent`\n   - Match skill directory names to their purpose\n\n2. **Clarity**: Use descriptive names that indicate purpose\n   - Good: `api-integration-testing/`, `code-quality-checker.md`\n   - Avoid: `utils/`, `misc.md`, `temp.sh`\n\n3. **Length**: Balance brevity with clarity\n   - Commands: 2-3 words (`review-pr`, `run-ci`)\n   - Agents: Describe role clearly (`code-reviewer`, `test-generator`)\n   - Skills: Topic-focused (`error-handling`, `api-design`)\n\n### Portability\n\n1. **Always use ${CLAUDE_PLUGIN_ROOT}**: Never hardcode paths\n2. **Test on multiple systems**: Verify on macOS, Linux, Windows\n3. **Document dependencies**: List required tools and versions\n4. **Avoid system-specific features**: Use portable bash/Python constructs\n\n### Maintenance\n\n1. **Version consistently**: Update version in plugin.json for releases\n2. **Deprecate gracefully**: Mark old components clearly before removal\n3. **Document breaking changes**: Note changes affecting existing users\n4. **Test thoroughly**: Verify all components work after changes\n\n## Common Patterns\n\n### Minimal Plugin\n\nSingle command with no dependencies:\n\n```text\nmy-plugin/\n .claude-plugin/\n    plugin.json    # Just name field\n commands/\n     hello.md       # Single command\n```\n\n### Full-Featured Plugin\n\nComplete plugin with all component types:\n\n```text\nmy-plugin/\n .claude-plugin/\n    plugin.json\n commands/          # User-facing commands\n agents/            # Specialized subagents\n skills/            # Auto-activating skills\n hooks/             # Event handlers\n    hooks.json\n    scripts/\n .mcp.json          # External integrations\n scripts/           # Shared utilities\n```\n\n### Skill-Focused Plugin\n\nPlugin providing only skills:\n\n```text\nmy-plugin/\n .claude-plugin/\n    plugin.json\n skills/\n     skill-one/\n        SKILL.md\n     skill-two/\n         SKILL.md\n```\n\n## Troubleshooting\n\n**Component not loading**:\n\n- Verify file is in correct directory with correct extension\n- Check YAML frontmatter syntax (commands, agents, skills)\n- Ensure skill has `SKILL.md` (not `README.md` or other name)\n- Confirm plugin is enabled in Claude Code settings\n\n**Path resolution errors**:\n\n- Replace all hardcoded paths with `${CLAUDE_PLUGIN_ROOT}`\n- Verify paths are relative and start with `./` in manifest\n- Check that referenced files exist at specified paths\n- Test with `echo $CLAUDE_PLUGIN_ROOT` in hook scripts\n\n**Auto-discovery not working**:\n\n- Confirm directories are at plugin root (not in `.claude-plugin/`)\n- Check file naming follows conventions (kebab-case, correct extensions)\n- Verify custom paths in manifest are correct\n- Restart Claude Code to reload plugin configuration\n\n**Conflicts between plugins**:\n\n- Use unique, descriptive component names\n- Namespace commands with plugin name if needed\n- Document potential conflicts in plugin README\n- Consider command prefixes for related functionality\n\n---\n\nFor detailed examples and advanced patterns, see files in `references/` and `examples/` directories."
              },
              {
                "name": "skill-development",
                "description": "This skill should be used when the user wants to \"create a skill\", \"add a skill to plugin\", \"write a new skill\", \"improve skill description\", \"organize skill content\", or needs guidance on skill structure, progressive disclosure, or skill development best practices for Claude Code plugins.",
                "path": "plugins/meta/plugin-dev/skills/skill-development/SKILL.md",
                "frontmatter": {
                  "name": "skill-development",
                  "description": "This skill should be used when the user wants to \"create a skill\", \"add a skill to plugin\", \"write a new skill\", \"improve skill description\", \"organize skill content\", or needs guidance on skill structure, progressive disclosure, or skill development best practices for Claude Code plugins."
                },
                "content": "# Skill Development for Claude Code Plugins\n\n> **Reference:** See [agent-skills-spec.md](references/agent-skills-spec.md) for the official specification.\n\nThis skill provides guidance for creating effective skills for Claude Code plugins.\n\n## About Skills\n\nSkills are modular, self-contained packages that extend Claude's capabilities by providing\nspecialized knowledge, workflows, and tools. Think of them as \"onboarding guides\" for specific\ndomains or tasksthey transform Claude from a general-purpose agent into a specialized agent\nequipped with procedural knowledge that no model can fully possess.\n\n### What Skills Provide\n\n1. Specialized workflows - Multi-step procedures for specific domains\n2. Tool integrations - Instructions for working with specific file formats or APIs\n3. Domain expertise - Company-specific knowledge, schemas, business logic\n4. Bundled resources - Scripts, references, and assets for complex and repetitive tasks\n\n### Core Principles\n\n#### Concise is Key\n\nThe context window is a public good. Skills share the context window with everything else Claude\nneeds: system prompt, conversation history, other skills' metadata, and the actual user request.\n\n**Default assumption: Claude is already very smart.** Only add context Claude doesn't already have.\nChallenge each piece of information: \"Does Claude really need this explanation?\" and \"Does this\nparagraph justify its token cost?\"\n\nPrefer concise examples over verbose explanations.\n\n#### Set Appropriate Degrees of Freedom\n\nMatch the level of specificity to the task's fragility and variability:\n\n- **High freedom (text-based instructions)**: Use when multiple approaches are valid, decisions\n  depend on context, or heuristics guide the approach.\n- **Medium freedom (pseudocode or scripts with parameters)**: Use when a preferred pattern exists,\n  some variation is acceptable, or configuration affects behavior.\n- **Low freedom (specific scripts, few parameters)**: Use when operations are fragile and\n  error-prone, consistency is critical, or a specific sequence must be followed.\n\nThink of Claude as exploring a path: a narrow bridge with cliffs needs specific guardrails (low\nfreedom), while an open field allows many routes (high freedom).\n\n### Anatomy of a Skill\n\nEvery skill consists of a required SKILL.md file and optional bundled resources:\n\n```text\nskill-name/\n SKILL.md (required)\n    YAML frontmatter metadata (required)\n       name: (required)\n       description: (required)\n    Markdown instructions (required)\n Bundled Resources (optional)\n     scripts/          - Executable code (Python/Bash/etc.)\n     references/       - Documentation intended to be loaded into context as needed\n     assets/           - Files used in output (templates, icons, fonts, etc.)\n```\n\n#### SKILL.md (required)\n\n**Metadata Quality:** The `name` and `description` in YAML frontmatter determine when Claude will use the skill. Be specific about what the skill does and when to use it. Use the third-person (e.g. \"This skill should be used when...\" instead of \"Use this skill when...\").\n\n#### Bundled Resources (optional)\n\n##### Scripts (`scripts/`)\n\nExecutable code (Python/Bash/etc.) for tasks that require deterministic reliability or are repeatedly rewritten.\n\n- **When to include**: When the same code is being rewritten repeatedly or deterministic reliability is needed\n- **Example**: `scripts/rotate_pdf.py` for PDF rotation tasks\n- **Benefits**: Token efficient, deterministic, may be executed without loading into context\n- **Note**: Scripts may still need to be read by Claude for patching or environment-specific adjustments\n\n##### References (`references/`)\n\nDocumentation and reference material intended to be loaded as needed into context to inform Claude's process and thinking.\n\n- **When to include**: For documentation that Claude should reference while working\n- **Examples**: `references/finance.md` for financial schemas, `references/mnda.md` for company NDA template, `references/policies.md` for company policies, `references/api_docs.md` for API specifications\n- **Use cases**: Database schemas, API documentation, domain knowledge, company policies, detailed workflow guides\n- **Benefits**: Keeps SKILL.md lean, loaded only when Claude determines it's needed\n- **Best practice**: If files are large (>10k words), include grep search patterns in SKILL.md\n- **Avoid duplication**: Information should live in either SKILL.md or references files, not both. Prefer references files for detailed information unless it's truly core to the skillthis keeps SKILL.md lean while making information discoverable without hogging the context window. Keep only essential procedural instructions and workflow guidance in SKILL.md; move detailed reference material, schemas, and examples to references files.\n\n##### Assets (`assets/`)\n\nFiles not intended to be loaded into context, but rather used within the output Claude produces.\n\n- **When to include**: When the skill needs files that will be used in the final output\n- **Examples**: `assets/logo.png` for brand assets, `assets/slides.pptx` for PowerPoint templates, `assets/frontend-template/` for HTML/React boilerplate, `assets/font.ttf` for typography\n- **Use cases**: Templates, images, icons, boilerplate code, fonts, sample documents that get copied or modified\n- **Benefits**: Separates output resources from documentation, enables Claude to use files without loading them into context\n\n#### What to Not Include\n\nA skill should only contain essential files that directly support its functionality. Do NOT create\nextraneous documentation or auxiliary files, including:\n\n- README.md\n- INSTALLATION_GUIDE.md\n- QUICK_REFERENCE.md\n- CHANGELOG.md\n\nThe skill should only contain the information needed for an AI agent to do the job at hand. It\nshould not contain auxiliary context about the process that went into creating it, setup and\ntesting procedures, user-facing documentation, etc. Creating additional documentation files just\nadds clutter and confusion.\n\n### Progressive Disclosure Design Principle\n\nSkills use a three-level loading system to manage context efficiently:\n\n1. **Metadata (name + description)** - Always in context (~100 words)\n2. **SKILL.md body** - When skill triggers (<5k words)\n3. **Bundled resources** - As needed by Claude (Unlimited*)\n\n*Unlimited because scripts can be executed without reading into context window.\n\n## Skill Creation Process\n\nTo create a skill, follow the \"Skill Creation Process\" in order, skipping steps only if there is a clear reason why they are not applicable.\n\n### Step 1: Understanding the Skill with Concrete Examples\n\nSkip this step only when the skill's usage patterns are already clearly understood. It remains valuable even when working with an existing skill.\n\nTo create an effective skill, clearly understand concrete examples of how the skill will be used. This understanding can come from either direct user examples or generated examples that are validated with user feedback.\n\nFor example, when building an image-editor skill, relevant questions include:\n\n- \"What functionality should the image-editor skill support? Editing, rotating, anything else?\"\n- \"Can you give some examples of how this skill would be used?\"\n- \"I can imagine users asking for things like 'Remove the red-eye from this image' or 'Rotate this image'. Are there other ways you imagine this skill being used?\"\n- \"What would a user say that should trigger this skill?\"\n\nTo avoid overwhelming users, avoid asking too many questions in a single message. Start with the most important questions and follow up as needed for better effectiveness.\n\nConclude this step when there is a clear sense of the functionality the skill should support.\n\n### Step 2: Planning the Reusable Skill Contents\n\nTo turn concrete examples into an effective skill, analyze each example by:\n\n1. Considering how to execute on the example from scratch\n2. Identifying what scripts, references, and assets would be helpful when executing these workflows repeatedly\n\nExample: When building a `pdf-editor` skill to handle queries like \"Help me rotate this PDF,\" the analysis shows:\n\n1. Rotating a PDF requires re-writing the same code each time\n2. A `scripts/rotate_pdf.py` script would be helpful to store in the skill\n\nExample: When designing a `frontend-webapp-builder` skill for queries like \"Build me a todo app\" or \"Build me a dashboard to track my steps,\" the analysis shows:\n\n1. Writing a frontend webapp requires the same boilerplate HTML/React each time\n2. An `assets/hello-world/` template containing the boilerplate HTML/React project files would be helpful to store in the skill\n\nExample: When building a `big-query` skill to handle queries like \"How many users have logged in today?\" the analysis shows:\n\n1. Querying BigQuery requires re-discovering the table schemas and relationships each time\n2. A `references/schema.md` file documenting the table schemas would be helpful to store in the skill\n\n**For Claude Code plugins:** When building a hooks skill, the analysis shows:\n\n1. Developers repeatedly need to validate hooks.json and test hook scripts\n2. `scripts/validate-hook-schema.sh` and `scripts/test-hook.sh` utilities would be helpful\n3. `references/patterns.md` for detailed hook patterns to avoid bloating SKILL.md\n\nTo establish the skill's contents, analyze each concrete example to create a list of the reusable resources to include: scripts, references, and assets.\n\n### Step 3: Create Skill Structure\n\nFor Claude Code plugins, create the skill directory structure:\n\n```bash\nmkdir -p plugin-name/skills/skill-name/{references,examples,scripts}\ntouch plugin-name/skills/skill-name/SKILL.md\n```\n\n**Note:** Unlike the generic skill-creator which uses `init_skill.py`, plugin skills are created directly in the plugin's `skills/` directory with a simpler manual structure.\n\n### Step 4: Edit the Skill\n\nWhen editing the (newly-created or existing) skill, remember that the skill is being created for another instance of Claude to use. Focus on including information that would be beneficial and non-obvious to Claude. Consider what procedural knowledge, domain-specific details, or reusable assets would help another Claude instance execute these tasks more effectively.\n\n#### Start with Reusable Skill Contents\n\nTo begin implementation, start with the reusable resources identified above: `scripts/`, `references/`, and `assets/` files. Note that this step may require user input. For example, when implementing a `brand-guidelines` skill, the user may need to provide brand assets or templates to store in `assets/`, or documentation to store in `references/`.\n\nAlso, delete any example files and directories not needed for the skill. Create only the directories you actually need (references/, examples/, scripts/).\n\n#### Update SKILL.md\n\n**Writing Style:** Write the entire skill using **imperative/infinitive form** (verb-first instructions), not second person. Use objective, instructional language (e.g., \"To accomplish X, do Y\" rather than \"You should do X\" or \"If you need to do X\"). This maintains consistency and clarity for AI consumption.\n\n**Description (Frontmatter):** Use third-person format with specific trigger phrases:\n\n```yaml\n---\nname: Skill Name\ndescription: This skill should be used when the user asks to \"specific phrase 1\", \"specific phrase 2\", \"specific phrase 3\". Include exact phrases users would say that should trigger this skill. Be concrete and specific.\n---\n```\n\n**Good description examples:**\n\n```yaml\ndescription: This skill should be used when the user asks to \"create a hook\", \"add a PreToolUse hook\", \"validate tool use\", \"implement prompt-based hooks\", or mentions hook events (PreToolUse, PostToolUse, Stop).\n```\n\n**Bad description examples:**\n\n```yaml\ndescription: Use this skill when working with hooks.  # Wrong person, vague\ndescription: Load when user needs hook help.  # Not third person\ndescription: Provides hook guidance.  # No trigger phrases\n```\n\nTo complete SKILL.md body, answer the following questions:\n\n1. What is the purpose of the skill, in a few sentences?\n2. When should the skill be used? (Include this in frontmatter description with specific triggers)\n3. In practice, how should Claude use the skill? All reusable skill contents developed above should be referenced so that Claude knows how to use them.\n\n**Keep SKILL.md lean:** Target 1,500-2,000 words for the body. Move detailed content to references/:\n\n- Detailed patterns  `references/patterns.md`\n- Advanced techniques  `references/advanced.md`\n- Migration guides  `references/migration.md`\n- API references  `references/api-reference.md`\n\n**Reference resources in SKILL.md:**\n\n```markdown\n## Additional Resources\n\n### Reference Files\n\nFor detailed patterns and techniques, consult:\n- **`references/patterns.md`** - Common patterns\n- **`references/advanced.md`** - Advanced use cases\n\n### Example Files\n\nWorking examples in `examples/`:\n- **`example-script.sh`** - Working example\n```\n\n### Step 5: Validate and Test\n\n**For plugin skills, validation is different from generic skills:**\n\n1. **Check structure**: Skill directory in `plugin-name/skills/skill-name/`\n2. **Validate SKILL.md**: Has frontmatter with name and description\n3. **Check trigger phrases**: Description includes specific user queries\n4. **Verify writing style**: Body uses imperative/infinitive form, not second person\n5. **Test progressive disclosure**: SKILL.md is lean (~1,500-2,000 words), detailed content in references/\n6. **Check references**: All referenced files exist\n7. **Validate examples**: Examples are complete and correct\n8. **Test scripts**: Scripts are executable and work correctly\n\n**Use the skill-reviewer agent:**\n\n```text\nAsk: \"Review my skill and check if it follows best practices\"\n```\n\nThe skill-reviewer agent will check description quality, content organization, and progressive disclosure.\n\n### Step 6: Iterate\n\nAfter testing the skill, users may request improvements. Often this happens right after using the skill, with fresh context of how the skill performed.\n\n**Iteration workflow:**\n\n1. Use the skill on real tasks\n2. Notice struggles or inefficiencies\n3. Identify how SKILL.md or bundled resources should be updated\n4. Implement changes and test again\n\n**Common improvements:**\n\n- Strengthen trigger phrases in description\n- Move long sections from SKILL.md to references/\n- Add missing examples or scripts\n- Clarify ambiguous instructions\n- Add edge case handling\n\n## Plugin-Specific Considerations\n\n### Skill Location in Plugins\n\nPlugin skills live in the plugin's `skills/` directory:\n\n```text\nmy-plugin/\n .claude-plugin/\n    plugin.json\n commands/\n agents/\n skills/\n     my-skill/\n         SKILL.md\n         references/\n         examples/\n         scripts/\n```\n\n### Auto-Discovery\n\nClaude Code automatically discovers skills:\n\n- Scans `skills/` directory\n- Finds subdirectories containing `SKILL.md`\n- Loads skill metadata (name + description) always\n- Loads SKILL.md body when skill triggers\n- Loads references/examples when needed\n\n### No Packaging Needed\n\nPlugin skills are distributed as part of the plugin, not as separate ZIP files. Users get skills when they install the plugin.\n\n### Testing in Plugins\n\nTest skills by installing plugin locally:\n\n```bash\n# Test with --plugin-dir\ncc --plugin-dir /path/to/plugin\n\n# Ask questions that should trigger the skill\n# Verify skill loads correctly\n```\n\n## Examples from Plugin-Dev\n\nStudy the skills in this plugin as examples of best practices:\n\n**hook-development skill:**\n\n- Excellent trigger phrases: \"create a hook\", \"add a PreToolUse hook\", etc.\n- Lean SKILL.md (1,651 words)\n- 3 references/ files for detailed content\n- 3 examples/ of working hooks\n- 3 scripts/ utilities\n\n**agent-development skill:**\n\n- Strong triggers: \"create an agent\", \"agent frontmatter\", etc.\n- Focused SKILL.md (1,438 words)\n- References include the AI generation prompt from Claude Code\n- Complete agent examples\n\n**plugin-settings skill:**\n\n- Specific triggers: \"plugin settings\", \".local.md files\", \"YAML frontmatter\"\n- References show real implementations (multi-agent-swarm, ralph-wiggum)\n- Working parsing scripts\n\nEach demonstrates progressive disclosure and strong triggering.\n\n## Progressive Disclosure in Practice\n\n### What Goes in SKILL.md\n\n**Include (always loaded when skill triggers):**\n\n- Core concepts and overview\n- Essential procedures and workflows\n- Quick reference tables\n- Pointers to references/examples/scripts\n- Most common use cases\n\n**Keep under 3,000 words, ideally 1,500-2,000 words**\n\n### What Goes in references/\n\n**Move to references/ (loaded as needed):**\n\n- Detailed patterns and advanced techniques\n- Comprehensive API documentation\n- Migration guides\n- Edge cases and troubleshooting\n- Extensive examples and walkthroughs\n\n**Each reference file can be large (2,000-5,000+ words)**\n\n### What Goes in examples/\n\n**Working code examples:**\n\n- Complete, runnable scripts\n- Configuration files\n- Template files\n- Real-world usage examples\n\n**Users can copy and adapt these directly**\n\n### What Goes in scripts/\n\n**Utility scripts:**\n\n- Validation tools\n- Testing helpers\n- Parsing utilities\n- Automation scripts\n\n**Should be executable and documented**\n\n## Writing Style Requirements\n\n### Imperative/Infinitive Form\n\nWrite using verb-first instructions, not second person:\n\n**Correct (imperative):**\n\n```text\nTo create a hook, define the event type.\nConfigure the MCP server with authentication.\nValidate settings before use.\n```\n\n**Incorrect (second person):**\n\n```text\nYou should create a hook by defining the event type.\nYou need to configure the MCP server.\nYou must validate settings before use.\n```\n\n### Third-Person in Description\n\nThe frontmatter description must use third person:\n\n**Correct:**\n\n```yaml\ndescription: This skill should be used when the user asks to \"create X\", \"configure Y\"...\n```\n\n**Incorrect:**\n\n```yaml\ndescription: Use this skill when you want to create X...\ndescription: Load this skill when user asks...\n```\n\n### Objective, Instructional Language\n\nFocus on what to do, not who should do it:\n\n**Correct:**\n\n```text\nParse the frontmatter using sed.\nExtract fields with grep.\nValidate values before use.\n```\n\n**Incorrect:**\n\n```text\nYou can parse the frontmatter...\nClaude should extract fields...\nThe user might validate values...\n```\n\n## Validation Checklist\n\nBefore finalizing a skill:\n\n**Structure:**\n\n- [ ] SKILL.md file exists with valid YAML frontmatter\n- [ ] Frontmatter has `name` and `description` fields\n- [ ] Markdown body is present and substantial\n- [ ] Referenced files actually exist\n\n**Description Quality:**\n\n- [ ] Uses third person (\"This skill should be used when...\")\n- [ ] Includes specific trigger phrases users would say\n- [ ] Lists concrete scenarios (\"create X\", \"configure Y\")\n- [ ] Not vague or generic\n\n**Content Quality:**\n\n- [ ] SKILL.md body uses imperative/infinitive form\n- [ ] Body is focused and lean (1,500-2,000 words ideal, <5k max)\n- [ ] Detailed content moved to references/\n- [ ] Examples are complete and working\n- [ ] Scripts are executable and documented\n\n**Progressive Disclosure:**\n\n- [ ] Core concepts in SKILL.md\n- [ ] Detailed docs in references/\n- [ ] Working code in examples/\n- [ ] Utilities in scripts/\n- [ ] SKILL.md references these resources\n\n**Testing:**\n\n- [ ] Skill triggers on expected user queries\n- [ ] Content is helpful for intended tasks\n- [ ] No duplicated information across files\n- [ ] References load when needed\n\n## Common Mistakes to Avoid\n\n### Mistake 1: Weak Trigger Description\n\n **Bad:**\n\n```yaml\ndescription: Provides guidance for working with hooks.\n```\n\n**Why bad:** Vague, no specific trigger phrases, not third person\n\n **Good:**\n\n```yaml\ndescription: This skill should be used when the user asks to \"create a hook\", \"add a PreToolUse hook\", \"validate tool use\", or mentions hook events. Provides comprehensive hooks API guidance.\n```\n\n**Why good:** Third person, specific phrases, concrete scenarios\n\n### Mistake 2: Too Much in SKILL.md\n\n **Bad:**\n\n```text\nskill-name/\n SKILL.md  (8,000 words - everything in one file)\n```\n\n**Why bad:** Bloats context when skill loads, detailed content always loaded\n\n **Good:**\n\n```text\nskill-name/\n SKILL.md  (1,800 words - core essentials)\n references/\n     patterns.md (2,500 words)\n     advanced.md (3,700 words)\n```\n\n**Why good:** Progressive disclosure, detailed content loaded only when needed\n\n### Mistake 3: Second Person Writing\n\n **Bad:**\n\n```markdown\nYou should start by reading the configuration file.\nYou need to validate the input.\nYou can use the grep tool to search.\n```\n\n**Why bad:** Second person, not imperative form\n\n **Good:**\n\n```markdown\nStart by reading the configuration file.\nValidate the input before processing.\nUse the grep tool to search for patterns.\n```\n\n**Why good:** Imperative form, direct instructions\n\n### Mistake 4: Missing Resource References\n\n **Bad:**\n\n```markdown\n# SKILL.md\n\n[Core content]\n\n[No mention of references/ or examples/]\n```\n\n**Why bad:** Claude doesn't know references exist\n\n **Good:**\n\n```markdown\n# SKILL.md\n\n[Core content]\n\n## Additional Resources\n\n### Reference Files\n- **`references/patterns.md`** - Detailed patterns\n- **`references/advanced.md`** - Advanced techniques\n\n### Examples\n- **`examples/script.sh`** - Working example\n```\n\n**Why good:** Claude knows where to find additional information\n\n### Mistake 5: Dynamic Bash Patterns in Code Blocks\n\nThe skill parser scans the entire SKILL.md for dynamic bash patterns without respecting fenced code block boundaries (GitHub #12781). This causes unintended execution during skill load.\n\n**Bad pattern:** Using exclamation-backtick syntax (e.g., exclamation mark followed by backtick-command-backtick) in code block examples. The parser executes these during skill load. Escaping with backslash does NOT work.\n\n**Good pattern:** Use `$` shell notation instead:\n\n```bash\n# Safe in code blocks\n$ git status\n$ bash script.sh\n```\n\n**Workarounds:**\n\n1. Use `$ command` notation in examples\n2. Describe syntax in prose rather than showing literal patterns\n3. Move examples to reference files (not parsed as skill content)\n\nThis also applies to `@` file reference patterns in code blocks.\n\n## Quick Reference\n\n### Minimal Skill\n\n```text\nskill-name/\n SKILL.md\n```\n\nGood for: Simple knowledge, no complex resources needed\n\n### Standard Skill (Recommended)\n\n```text\nskill-name/\n SKILL.md\n references/\n    detailed-guide.md\n examples/\n     working-example.sh\n```\n\nGood for: Most plugin skills with detailed documentation\n\n### Complete Skill\n\n```text\nskill-name/\n SKILL.md\n references/\n    patterns.md\n    advanced.md\n examples/\n    example1.sh\n    example2.json\n scripts/\n     validate.sh\n```\n\nGood for: Complex domains with validation utilities\n\n## Best Practices Summary\n\n **DO:**\n\n- Use third-person in description (\"This skill should be used when...\")\n- Include specific trigger phrases (\"create X\", \"configure Y\")\n- Keep SKILL.md lean (1,500-2,000 words)\n- Use progressive disclosure (move details to references/)\n- Write in imperative/infinitive form\n- Reference supporting files clearly\n- Provide working examples\n- Create utility scripts for common operations\n- Study plugin-dev's skills as templates\n\n **DON'T:**\n\n- Use second person anywhere\n- Have vague trigger conditions\n- Put everything in SKILL.md (>3,000 words without references/)\n- Write in second person (\"You should...\")\n- Leave resources unreferenced\n- Include broken or incomplete examples\n- Skip validation\n\n## Additional Resources\n\n### Study These Skills\n\nPlugin-dev's skills demonstrate best practices:\n\n- `../hook-development/` - Progressive disclosure, utilities\n- `../agent-development/` - AI-assisted creation, references\n- `../mcp-integration/` - Comprehensive references\n- `../plugin-settings/` - Real-world examples\n- `../command-development/` - Clear critical concepts\n- `../plugin-structure/` - Good organization\n\n### Reference Files\n\nFor complete skill-creator methodology:\n\n- **`references/skill-creator-original.md`** - Full original skill-creator content\n\nFor complete Offical Anthropic skill specification:\n\n- **`references/agent-skills-spec.md`** - Full Offical Anthropic skill specification\n\n## Implementation Workflow\n\nTo create a skill for your plugin:\n\n1. **Understand use cases**: Identify concrete examples of skill usage\n2. **Plan resources**: Determine what scripts/references/examples needed\n3. **Create structure**: `mkdir -p skills/skill-name/{references,examples,scripts}`\n4. **Write SKILL.md**:\n   - Frontmatter with third-person description and trigger phrases\n   - Lean body (1,500-2,000 words) in imperative form\n   - Reference supporting files\n5. **Add resources**: Create references/, examples/, scripts/ as needed\n6. **Validate**: Check description, writing style, organization\n7. **Test**: Verify skill loads on expected triggers\n8. **Iterate**: Improve based on usage\n\nFocus on strong trigger descriptions, progressive disclosure, and imperative writing style for effective skills that load when needed and provide targeted guidance."
              }
            ]
          },
          {
            "name": "lunar-research",
            "description": "Multi-agent research pipeline with parallel researchers and synthesis",
            "source": {
              "source": "github",
              "repo": "basher83/lunar-research"
            },
            "category": "research",
            "version": "1.1.2",
            "author": {
              "name": "basher83"
            },
            "install_commands": [
              "/plugin marketplace add basher83/lunar-claude",
              "/plugin install lunar-research@lunar-claude"
            ],
            "signals": {
              "stars": 10,
              "forks": 1,
              "pushed_at": "2026-01-12T18:08:17Z",
              "created_at": "2025-10-24T02:41:21Z",
              "license": "MIT"
            },
            "commands": [
              {
                "name": "/convert-to-agent",
                "description": "Convert a slash command to a sub-agent definition (project)",
                "path": ".claude/commands/convert-to-agent.md",
                "frontmatter": {
                  "argument-hint": [
                    "slash-command-file-path"
                  ],
                  "description": "Convert a slash command to a sub-agent definition (project)"
                },
                "content": "# Convert Slash Command to Sub-Agent\n\nYou are tasked with converting a slash command to a sub-agent definition. This conversion should ONLY happen when appropriate based on the decision criteria.\n\n## Input\n\nYou will receive a file path to a slash command file via `$ARGUMENTS`.\n\n## Decision Criteria - MUST VALIDATE FIRST\n\nBefore converting, you MUST validate that conversion is appropriate. A slash command should become a sub-agent ONLY when:\n\n**Convert when:**\n-  **Parallelization is needed** - \"Whenever you see parallel, you should always just think sub-agents\"\n-  **Context isolation is required** - You want to protect the main context window\n-  **Scale/batch operations** - Running the same task multiple times in parallel\n-  **You're okay losing context afterward** - Sub-agent context doesn't persist (unless resumable)\n\n**Do NOT convert when:**\n-  **One-off task** - Keep as slash command\n-  **Context matters later** - Use main conversation instead\n-  **Sequential operations** - Keep as slash command or consider skill\n-  **Simple repeatable actions** - Keep as slash command\n\n## Critical Anti-Pattern Warning\n\nFrom official guidance:\n> \"There are a lot of engineers right now that are going all in on skills. They're converting all their slash commands to skills. I think that's a huge mistake.\"\n\nThe same applies to sub-agents. Do not convert slash commands to sub-agents unless there's a clear need for parallelization or context isolation.\n\n## Conversion Process\n\n### Step 1: Read the slash command file\n\n```bash\nRead the file at $ARGUMENTS\n```\n\n### Step 2: Orchestrator Detection (Check FIRST)\n\nImmediately after reading the file, analyze the content to detect if this is an orchestrator:\n\n**Check frontmatter:**\n- Does `allowed-tools` field contain `Task`?\n\n**Check body content for these keywords:**\n- \"Task tool\"\n- \"subagent\" / \"sub-agent\"\n- \"spawn\"\n- \"parallel agent\"\n- \"multiple Task tool\"\n- \"launch all subagents\"\n- \"orchestrate\"\n\n**If ANY orchestrator indicator is found:**\n\n**STOP immediately** and inform the user:\n\n```text\n **Conversion REFUSED: Orchestrator Detected**\n\nThis slash command orchestrates other agents (uses Task tool or spawns subagents).\n\n**Problem:** Converting this to a sub-agent would violate the architectural constraint:\n\"Sub-agents cannot spawn other sub-agents.\"\n\n**What was detected:**\n- [List specific indicators found, e.g., \"allowed-tools contains Task\", \"content mentions 'spawn subagents'\"]\n\n**Recommendation:**\n- Keep as slash command (orchestrators work well as commands)\n- OR convert to a Skill (skills CAN orchestrate sub-agents)\n\n Conversion STOPPED - Do NOT convert orchestrators to sub-agents.\n```\n\nDo not proceed if orchestrator is detected. The conversion process ends here.\n\n### Step 3: Ask validation questions\n\n**REQUIRED:** Must use AskUserQuestion tool to ask these questions.\n\n**IMPORTANT:** Do NOT analyze or form an opinion about whether conversion is appropriate. Do NOT show the user your orchestrator detection analysis. Ask the user these questions WITHOUT stating whether you think it's a good candidate:\n\n1. **Need to run multiple instances in parallel?**\n2. **Need context isolation from main conversation?**\n3. **Can task context be discarded after completion?**\n4. **Is this a recurring/repeatable task?**\n\nUse the AskUserQuestion tool to present these questions cleanly to the user. Wait for user answers before proceeding.\n\n### Step 3a: Evaluate based on user answers\n\nAfter receiving user answers:\n\nIf the answer to questions 1 or 2 is NO, **STOP** and inform the user that conversion is not appropriate. Recommend keeping it as a slash command.\n\nIf answers indicate conversion is appropriate, proceed to Step 4.\n\n### Step 4: Transform the structure\n\nIf conversion is validated, perform the following transformation:\n\n**From Slash Command Format:**\n```markdown\n---\nallowed-tools: tool1, tool2\nargument-hint: [args]\ndescription: Brief description\nmodel: model-name\ndisable-model-invocation: false\n---\n\nPrompt content here\n```\n\n**To Sub-Agent Format:**\n```markdown\n---\nname: agent-name\ndescription: Description of when this subagent should be invoked\ntools: tool1, tool2\nmodel: model-name\n---\n\nSystem prompt adapted from original prompt content\n```\n\n**Field Mapping:**\n\n| Slash Command Field | Sub-Agent Field | Transformation |\n|---------------------|-----------------|----------------|\n| N/A (derive from filename) | `name` (REQUIRED) | Convert filename to lowercase with hyphens |\n| `description` | `description` (REQUIRED) | Enhance to include \"when to use\" trigger language. Add phrases like \"use PROACTIVELY\" if appropriate |\n| `allowed-tools` | `tools` (OPTIONAL) | Direct copy. Omit if it should inherit all tools |\n| `model` | `model` (OPTIONAL) | Direct copy or use 'inherit'. Omit to default to sonnet |\n| `argument-hint` | N/A | Remove - sub-agents don't use this field |\n| `disable-model-invocation` | N/A | Remove - sub-agents don't use this field |\n| Prompt body | System prompt body | Adapt prompt to be a system prompt. Change from task-oriented to role-oriented language |\n\n**Prompt Adaptation Guidelines:**\n\n1. **Task  Role**: Convert from \"Do this task\" to \"You are an expert who does this\"\n2. **Add structure**: Include sections like \"When invoked:\", \"Process:\", \"Provide:\", etc.\n3. **Be explicit**: Sub-agents need clear guidance on their role and approach\n4. **Remove arguments**: Sub-agents receive prompts, not CLI-style arguments\n\n### Step 5: Output location\n\nDetermine output location:\n\n- **Project sub-agent**: `.claude/agents/[agent-name].md` (available in current project)\n- **User sub-agent**: `~/.claude/agents/[agent-name].md` (available across all projects)\n\nAsk the user which scope they prefer.\n\n### Step 6: Create the sub-agent file\n\nWrite the converted content to the appropriate location using the Write tool.\n\n### Step 7: Inform user\n\nProvide summary:\n\n```bash\n Converted slash command to sub-agent\n\n  Location: [path]\n  Name: [agent-name]\n  Description: [description]\n\n  Usage:\n  - Automatic: Claude will invoke when appropriate based on description\n  - Explicit: \"Use the [agent-name] subagent to [task]\"\n\n  Note: This sub-agent operates with isolated context. Results won't persist in main conversation unless you use resumable sub-agents.\n```\n\n## Example Conversion\n\n**Input (slash command):**\n```markdown\n---\ndescription: Review code for security and quality\nallowed-tools: Read, Grep, Glob, Bash\nmodel: sonnet\n---\n\nReview this code for:\n- Security vulnerabilities\n- Performance issues\n- Code style violations\n```\n\n**Output (sub-agent):**\n```markdown\n---\nname: code-reviewer\ndescription: Expert code review specialist. Use proactively after writing or modifying code to review for security, quality, and maintainability.\ntools: Read, Grep, Glob, Bash\nmodel: sonnet\n---\n\nYou are a senior code reviewer ensuring high standards of code quality and security.\n\nWhen invoked:\n1. Run git diff to see recent changes\n2. Focus on modified files\n3. Begin review immediately\n\nReview checklist:\n- Security vulnerabilities\n- Performance issues\n- Code style violations\n- Proper error handling\n- No exposed secrets or API keys\n\nProvide feedback organized by priority:\n- Critical issues (must fix)\n- Warnings (should fix)\n- Suggestions (consider improving)\n\nInclude specific examples of how to fix issues.\n```\n\n## Remember\n\n**Golden Rule:** \"Always start with prompts. Master the primitive first.\"\n\nOnly convert when there's a clear need for parallelization or context isolation. When in doubt, keep it as a slash command."
              },
              {
                "name": "/convert-to-slash",
                "description": "Convert a sub-agent to a slash command (project)",
                "path": ".claude/commands/convert-to-slash.md",
                "frontmatter": {
                  "argument-hint": [
                    "agent-file-path"
                  ],
                  "description": "Convert a sub-agent to a slash command (project)",
                  "allowed-tools": "Read, Write, AskUserQuestion"
                },
                "content": "# Convert Sub-Agent to Slash Command\n\nYou are tasked with converting a sub-agent definition back to a slash command. This conversion should happen when parallelization or context isolation is no longer needed.\n\n## Input\n\nYou will receive a file path to a sub-agent file via `$ARGUMENTS`.\n\n## Decision Criteria - MUST VALIDATE FIRST\n\nBefore converting, you MUST validate that conversion is appropriate. A sub-agent should become a slash command when:\n\n**Convert when:**\n\n-  **No parallelization needed** - Task runs once, not in parallel batches\n-  **Context isolation not required** - Results can stay in main conversation\n-  **Simple repeatable action** - One-off or simple recurring task\n-  **Sequential operation** - Not part of batch/parallel workflow\n-  **Realized it was over-engineered** - Fell into the \"converting all commands to agents\" anti-pattern\n\n**Do NOT convert when:**\n\n-  **Parallelization is still needed** - Multiple instances running simultaneously\n-  **Context isolation is required** - Need to protect main context window\n-  **Batch operations at scale** - Processing multiple items in parallel\n-  **Complex multi-step workflows** - Might actually need a skill instead\n\n## Recovery Strategy\n\nThis command helps recover from the anti-pattern of converting all slash commands to sub-agents. From official guidance:\n\n> \"There are a lot of engineers right now that are going all in on skills. They're converting all their slash commands to skills. I think that's a huge mistake.\"\n\nThe same applies to sub-agents. Many tasks work better as simple slash commands.\n\n## Conversion Process\n\n### Step 1: Read the sub-agent file\n\n```bash\nRead the file at $ARGUMENTS\n```\n\n### Step 2: Analyze and validate\n\nAsk the user these questions to validate conversion is appropriate:\n\n1. **Do you no longer need parallelization** (running multiple instances)?\n2. **Do you no longer need context isolation** (results can stay in main conversation)?\n3. **Is this actually a simple repeatable task** (not complex orchestration)?\n4. **Would this work better as a slash command?**\n\nIf the answer to questions 1 and 2 is NO (meaning you still need parallelization/isolation), **STOP** and inform the user that conversion is not appropriate. Recommend keeping it as a sub-agent.\n\n### Step 3: Transform the structure\n\nIf conversion is validated, perform the following transformation:\n\n**From Sub-Agent Format:**\n```markdown\n---\nname: agent-name\ndescription: Description of when this subagent should be invoked\ntools: tool1, tool2\nmodel: model-name\n---\n\nSystem prompt with role-oriented language\n```\n\n**To Slash Command Format:**\n```markdown\n---\ndescription: Brief description of what the command does\nallowed-tools: tool1, tool2\nmodel: model-name\n---\n\nTask-oriented prompt content\n```\n\n**Field Mapping:**\n\n| Sub-Agent Field | Slash Command Field | Transformation |\n|-----------------|---------------------|----------------|\n| `name` | Filename | Use agent name as filename: `[name].md` |\n| `description` | `description` | Simplify and make task-oriented. Remove trigger language like \"use PROACTIVELY\", \"when to invoke\", etc. Focus on WHAT it does, not WHEN to use it |\n| `tools` | `allowed-tools` | Direct copy |\n| `model` | `model` | Direct copy |\n| System prompt body | Prompt body | Adapt from role-oriented to task-oriented (see below) |\n\n**Optional Slash Command Fields:**\n\nYou may add these fields if appropriate:\n\n- `argument-hint: [args]` - If the command should accept arguments\n- `disable-model-invocation: true` - If Claude shouldn't invoke via SlashCommand tool\n\n**Prompt Adaptation Guidelines:**\n\n1. **Role  Task**: Convert from \"You are an expert who does this\" to \"Do this task\"\n2. **Remove structure**: Remove sections like \"When invoked:\", \"Process:\", \"Provide:\", etc.\n3. **Be direct**: Make it action-oriented and concise\n4. **Add clarity**: Focus on what to do, not how to be\n\n**Examples:**\n\n| Sub-Agent Prompt | Slash Command Prompt |\n|------------------|----------------------|\n| \"You are a senior code reviewer...\" | \"Review this code for:\" |\n| \"When invoked: 1. Run git diff...\" | \"Run git diff and review changes for:\" |\n| \"You are an expert debugger specializing in...\" | \"Debug this error by:\" |\n\n### Step 4: Output location\n\nDetermine output location:\n\n- **Project command**: `.claude/commands/[command-name].md` (available in current project)\n- **User command**: `~/.claude/commands/[command-name].md` (available across all projects)\n\nAsk the user which scope they prefer. Default to the same scope as the original sub-agent (project  project, user  user).\n\n### Step 5: Create the slash command file\n\nWrite the converted content to the appropriate location using the Write tool.\n\n### Step 6: Ask about cleanup\n\nAsk the user: \"Do you want to delete the original sub-agent file at [path]?\"\n\nIf yes, delete the sub-agent file.\n\n### Step 7: Inform user\n\nProvide summary:\n\n```bash\n Converted sub-agent to slash command\n\n  Location: [path]\n  Command: /[command-name]\n  Description: [description]\n\n  Usage:\n  - Manual: /[command-name]\n  - Via SlashCommand tool: Claude can invoke automatically if description is populated\n\n  Note: This slash command executes in the main conversation context. Results will persist.\n```\n\n## Example Conversion\n\n**Input (sub-agent):**\n```markdown\n---\nname: code-reviewer\ndescription: Expert code review specialist. Use proactively after writing or modifying code to review for security, quality, and maintainability.\ntools: Read, Grep, Glob, Bash\nmodel: sonnet\n---\n\nYou are a senior code reviewer ensuring high standards of code quality and security.\n\nWhen invoked:\n1. Run git diff to see recent changes\n2. Focus on modified files\n3. Begin review immediately\n\nReview checklist:\n- Security vulnerabilities\n- Performance issues\n- Code style violations\n- Proper error handling\n- No exposed secrets or API keys\n\nProvide feedback organized by priority:\n- Critical issues (must fix)\n- Warnings (should fix)\n- Suggestions (consider improving)\n\nInclude specific examples of how to fix issues.\n```\n\n**Output (slash command):**\n```markdown\n---\ndescription: Review code for security, quality, and maintainability\nallowed-tools: Read, Grep, Glob, Bash\nmodel: sonnet\n---\n\nReview this code for:\n- Security vulnerabilities\n- Performance issues\n- Code style violations\n- Proper error handling\n- Exposed secrets or API keys\n\nProvide feedback organized by priority:\n- Critical issues (must fix)\n- Warnings (should fix)\n- Suggestions (consider improving)\n\nInclude specific examples of how to fix issues.\n```\n\n## Remember\n\n**Golden Rule:** \"Always start with prompts. Master the primitive first.\"\n\n**Anti-Pattern Recovery:** \"Have a strong bias towards slash commands.\"\n\nSlash commands are the primitive foundation of Claude Code. Many tasks work better as simple commands than as sub-agents."
              },
              {
                "name": "/verify-pr",
                "description": "Verify that PR claims match actual implementation",
                "path": ".claude/commands/verify-pr.md",
                "frontmatter": {
                  "description": "Verify that PR claims match actual implementation",
                  "allowed-tools": "Bash(git:*), Bash(gh:*)",
                  "argument-hint": [
                    "PR-number|branch-name"
                  ]
                },
                "content": "# Task: Verify Pull Request Claims\n\n**PR to verify:** $ARGUMENTS\n\n**Purpose:** Verify that a PR's description, commits, and plan match actual implementation.\n\n**Core 4 Foundation:**\n\n- **Context:** PR metadata + git changes + plan documents\n- **Model:** Semantic verification capabilities\n- **Prompt:** This systematic verification process\n- **Tools:** Git commands, gh CLI, file operations\n\n---\n\n## Instructions\n\nYou are verifying a pull request. Check that claims in PR description, commits, and plans match actual code changes.\n\n### Core Principles\n\n1. **Evidence before claims:** Never mark verified without git command output proving it\n2. **Verify behavior, not names:** Check what code DOES. Different filenames can provide same functionality.\n3. **Counter-evidence first:** Define what would disprove claim BEFORE checking\n4. **Cross-reference patterns:** If comparing implementations, check what feature IS first\n\n---\n\n## Step 1: Identify PR and Extract Claims\n\n### Determine PR Type\n\nThe argument could be:\n\n- Branch name: `cursor/implement-plan-from-cu-plan-md-11ba`\n- PR number: `#7` or `7`\n- Comparison: `main...feature-branch`\n\n**Commands to identify:**\n\n```bash\n# If branch name given, check if it exists\ngit show-ref --verify refs/heads/$ARGUMENTS 2>/dev/null || git show-ref --verify refs/remotes/origin/$ARGUMENTS\n\n# If looks like PR number, try gh\ngh pr view $ARGUMENTS 2>/dev/null\n\n# Get comparison syntax\ngit log --oneline main...$ARGUMENTS | head -10\n```\n\n### Extract Claims\n\n**From PR description (if available):**\n\n```bash\ngh pr view $ARGUMENTS --json body -q .body\n```\n\n**From commit messages:**\n\n```bash\ngit log --format=\"%s%n%b\" main...$ARGUMENTS\n```\n\n**From referenced plan documents:**\n\n```bash\n# Look for plan references in commits or PR description\ngit log main...$ARGUMENTS | grep -i \"plan\\|spec\\|requirement\"\n```\n\n**Common claim patterns to extract:**\n\n- \"Adds feature X\"\n- \"Fixes bug Y\"\n- \"Implements Z from plan\"\n- \"Includes tests\"\n- \"Updates documentation\"\n- \"Breaking change\"\n- \"Closes #123\"\n\n---\n\n## Step 2: Verify Claims Against Implementation\n\n### Feature Implementation Claims\n\n**Claim pattern:** \"Adds/Implements feature X\"\n\n**Verify:**\n\n```bash\n# What files changed?\ngit diff --name-only main...$ARGUMENTS\n\n# Does feature exist in code?\ngit diff main...$ARGUMENTS -- path/to/feature\n\n# Search for feature implementation\ngit show $ARGUMENTS:path/to/file | grep -A 10 \"feature_name\"\n```\n\n**Counter-evidence:** \"This would be FALSE if no implementation exists for claimed feature\"\n\n### Test Coverage Claims\n\n**Claim pattern:** \"Includes tests\" or \"Adds test coverage\"\n\n**Verify:**\n\n```bash\n# Test files added?\ngit diff --name-only main...$ARGUMENTS | grep -i test\n\n# Test functions added?\ngit diff main...$ARGUMENTS -- tests/ | grep \"^+.*def test_\"\n\n# Count tests added\ngit show $ARGUMENTS:path/to/test.py | grep -c \"def test_\"\n```\n\n**Counter-evidence:** \"This would be FALSE if no test files or test functions were added\"\n\n### Bug Fix Claims\n\n**Claim pattern:** \"Fixes bug #123\" or \"Resolves issue\"\n\n**Verify:**\n\n```bash\n# Related code changes?\ngit diff main...$ARGUMENTS | grep -A 5 -B 5 \"bug_context\"\n\n# Issue referenced?\ngit log main...$ARGUMENTS | grep -i \"#123\\|issue\"\n\n# If gh available, check issue status\ngh issue view 123 --json state,closedAt\n```\n\n### Plan/Requirement Verification\n\n**Claim pattern:** \"Implements plan from X\" or \"Follows requirements in Y\"\n\n**Verify:**\n\n```bash\n# Read plan document\ncat path/to/plan.md\n\n# Check each requirement against implementation\ngit diff main...$ARGUMENTS -- path/matching/requirement\n```\n\n**Counter-evidence:** \"This would be FALSE if plan requirement X is not implemented\"\n\n### Breaking Change Claims\n\n**Claim pattern:** \"Breaking change\" or \"API change\"\n\n**Verify:**\n\n```bash\n# Check for removed/renamed functions\ngit diff main...$ARGUMENTS | grep \"^-.*def \\|^-.*class \"\n\n# Check for signature changes\ngit diff main...$ARGUMENTS -- path/to/api | grep -A 3 \"^-.*def \\|^+.*def \"\n```\n\n### Documentation Claims\n\n**Claim pattern:** \"Updates documentation\" or \"Adds README\"\n\n**Verify:**\n\n```bash\n# Documentation files changed?\ngit diff --name-only main...$ARGUMENTS | grep -E \"\\.md$|docs/\"\n\n# Check actual changes\ngit diff main...$ARGUMENTS -- \"*.md\" docs/\n```\n\n---\n\n## Step 3: Verify Line Counts and Stats\n\nIf PR claims specific statistics:\n\n```bash\n# Total lines changed\ngit diff --stat main...$ARGUMENTS\n\n# Lines per file\ngit diff --numstat main...$ARGUMENTS\n\n# Files changed count\ngit diff --name-only main...$ARGUMENTS | wc -l\n```\n\n---\n\n## Step 4: Cross-Reference with Other PRs\n\nIf claims involve comparisons (e.g., \"Different from PR #8\"):\n\n**Process:**\n\n1. Verify what the claimed difference IS in the reference PR\n2. Check if difference actually exists\n3. Compare functionality, not just filenames\n\n```bash\n# Compare file structures\ngit diff --name-only main...pr-8-branch | sort > /tmp/pr8-files\ngit diff --name-only main...pr-9-branch | sort > /tmp/pr9-files\ndiff /tmp/pr8-files /tmp/pr9-files\n\n# Compare implementations\ngit show pr-8-branch:path/to/file > /tmp/pr8-impl\ngit show pr-9-branch:path/to/file > /tmp/pr9-impl\ndiff /tmp/pr8-impl /tmp/pr9-impl\n```\n\n---\n\n## Anti-Patterns (What NOT to Do)\n\n Trusting PR description without verifying code\n Verifying filename existence without checking implementation\n Assuming different filenames = missing functionality\n Claiming \"tests added\" without counting actual test functions\n Marking \"implements plan\" without checking each requirement\n Meta-analysis about the PR's philosophical meaning\n Comparing commits without comparing actual functionality\n\n---\n\n## Deliverable Format\n\n## PR Overview\n\n- **PR identifier:** $ARGUMENTS\n- **Base branch:** [detected]\n- **Files changed:** [count]\n- **Commits:** [count]\n\n## Claims Extracted\n\n1. [Claim from PR description]\n2. [Claim from commit message]\n3. [Claim from plan reference]\n\n## Verification Results\n\n| Claim | Source | Verified? | Evidence |\n|-------|--------|-----------|----------|\n| [exact quote] | PR desc/commit/plan | // | git command + key output |\n\n## Summary\n\n- Total claims checked: N\n- Verified correct: N\n- Found incorrect: N\n- Critical mismatches: [list]\n\n## Recommendation\n\n[Based on verification: ready to merge / needs fixes / claims don't match implementation]\n\n---\n\n## Example: Verifying PR Implementation\n\n**Given:** `/verify-pr cursor/implement-plan-from-cu-plan-md-11ba`\n\n**Extract claims:**\n\n```bash\n# Check commits\ngit log --oneline main...cursor/implement-plan-from-cu-plan-md-11ba\n\n# Find referenced plan\ngit log main...cursor/implement-plan-from-cu-plan-md-11ba | grep -i \"plan\"\n#  References cu-plan.md\n```\n\n**Verify against cu-plan.md requirements:**\n\n**Claim 1:** \"Creates Jina MCP server\"\n\n```bash\ngit diff --name-only main...cursor/... | grep \"jina.*mcp\"\n#  plugins/meta/claude-docs/mcp/jina_docs_mcp.py\n```\n\n Verified\n\n**Claim 2:** \"Creates Jina direct API script\"\n\n```bash\ngit diff --name-only main...cursor/... | grep -i jina | grep scripts\n#  plugins/meta/claude-docs/scripts/claude_docs_jina.py\n\n# Verify it's direct API (not MCP)\ngit show cursor/...:plugins/meta/claude-docs/scripts/claude_docs_jina.py | grep \"dependencies\"\n#  httpx>=0.27.0 (direct HTTP, not MCP)\n```\n\n Verified\n\n---\n\n**Remember:** Your value is verifying that code matches claims. Boring verification is success. Trust the code, not the description.\n\n**Foundation:** Context (PR + plans), Model (verification), Prompt (this process), Tools (git + gh)."
              },
              {
                "name": "/README",
                "description": null,
                "path": "docs/reviews/audits/meta-claude/commands/README.md",
                "frontmatter": null,
                "content": "# Slash Command Audit Workflow\n\nThis directory contains compliance audit reports for slash commands in the meta-claude plugin.\n\n## Purpose\n\nSystematically audit all `/meta-claude:skill:*` commands against official Claude Code specifications to achieve 100% compliance before moving to Phase 2 (Orchestration).\n\n## Workflow\n\n### 1. Invoke Agent\n\nUse Task tool with command-audit agent:\n\n```text\nsubagent_type: \"command-audit\"\nprompt: \"plugins/meta/meta-claude/commands/skill/{command-name}.md\"\n```\n\n**Critical:** Pass ONLY the file path. No additional context. Do not taint the audit.\n\n### 2. Agent Executes\n\nAgent autonomously:\n- Reads command file, checklist, template, standards\n- Executes 9-category validation (32 checks)\n- Generates detailed report with violations\n- Writes report to `docs/reviews/audits/meta-claude/commands/{command-name}.md`\n- Returns confirmation: \"Audit complete. Report saved to: [path]\"\n\n### 3. Review Report\n\nReview generated report together:\n- Check violations found\n- Verify severity classifications\n- Understand proposed fixes\n- Identify patterns across commands\n\n### 4. Update Audit Log\n\nUpdate `audit-log.md` with concise summary:\n- Change status if 100% compliant\n- Add link to full report\n- Note key findings (brief)\n- Update \"Last Audit\" date\n\n**Keep it concise** - full details are in the individual reports.\n\n## Priority Order\n\nCommands audited in this order:\n\n1. `/meta-claude:skill:research` - Most complex\n2. `/meta-claude:skill:create` - Critical for workflow\n3. `/meta-claude:skill:format` - Early pipeline\n4. `/meta-claude:skill:review-content` - Quality gate\n5. `/meta-claude:skill:review-compliance` - Quality gate\n6. `/meta-claude:skill:validate-runtime` - Validation\n7. `/meta-claude:skill:validate-integration` - Validation\n8. `/meta-claude:skill:validate-audit` - Final validation\n\n## Files\n\n- `audit-log.md` - Central tracking for all 8 commands\n- `{command-name}.md` - Individual detailed reports (generated by agent)\n- `README.md` - This file (workflow documentation)\n\n## Tools\n\n**Agent:** `plugins/meta/meta-claude/agents/command/audit.md`\n**Checklist:** `docs/checklists/slash-command-validation-checklist.md`\n**Template:** `docs/templates/slash-command-validation-report-template.md`\n**Standards:** `plugins/meta/claude-docs/skills/official-docs/reference/slash-commands.md`\n\n## Success Criteria\n\nCommand marked  Compliant when:\n- All Critical violations fixed\n- All Major violations fixed\n- Minor violations addressed or documented as acceptable\n- Re-audit confirms 100% compliance\n\n## Notes\n\n- Agent writes reports directly to disk (no manual save needed)\n- Reports are timestamped and version-controlled\n- Keep audit process objective - agent has all instructions\n- Do not guide or influence agent during execution\n"
              },
              {
                "name": "/audit-log",
                "description": null,
                "path": "docs/reviews/audits/meta-claude/commands/audit-log.md",
                "frontmatter": null,
                "content": "# Slash Command Audit Log - meta-claude Plugin\n\nAudit tracking for slash commands in the meta-claude plugin's skill workflow.\n\n**Last Updated:** 2025-11-17\n**Commands:** 8 total, 8 compliant, 0 need fixes, 0 warnings\n\n---\n\n## Status\n\n| Status | Count | Commands |\n|--------|-------|----------|\n|  Compliant | 8 | All commands passing (0 critical, 0 major violations) |\n|  Need Fixes | 0 | - |\n|  Warnings | 0 | - |\n\n---\n\n## Overview\n\nWe audit commands in `plugins/meta/meta-claude/commands/skill/` against official Claude Code specifications using the command-audit agent.\n\n### Categories\n\nCommands pass through 9 checks:\n\n1. **File Location & Structure** - Correct directory, naming, markdown validity\n2. **Frontmatter Compliance** - Valid YAML, required fields (description), optional fields format\n3. **Argument Handling** - Placeholder syntax, argument-hint format, $ARGUMENTS usage\n4. **Tool Permissions** - allowed-tools syntax, scope matching, bash permissions\n5. **File References** - @ syntax for static references, path validity\n6. **Bash Execution** - ! prefix syntax, permission alignment\n7. **Content Quality** - Claude-directed perspective, clear instructions, conciseness\n8. **Code Blocks** - Language specification, blank lines, formatting\n9. **Line Length** - < 120 characters per official standards\n\n### Severity\n\n- **Critical** - Blocks functionality (invalid syntax, missing fields)\n- **Major** - Violates standards (wrong format, incorrect perspective)\n- **Minor** - Style issues (clarity, optimization)\n\n---\n\n## Commands\n\n### 1. `/meta-claude:skill:research` -  Compliant\n\n**File:** `commands/skill/research.md`\n**Last Audit:** 2025-11-17\n**Report:** [skill-research.md](skill-research.md)\n\n**Result:** PASS - 0 violations (Critical: 0, Major: 0, Minor: 0)\n\n**Highlights:**\n\n- Bash permissions properly scoped\n- Claude-directed perspective throughout\n- Lowercase bracket argument-hint format\n- All code blocks have language tags\n- No blank line violations (rumdl verified)\n\n---\n\n### 2. `/meta-claude:skill:format` -  Compliant\n\n**File:** `commands/skill/format.md`\n**Last Audit:** 2025-11-17\n**Report:** [skill-format.md](skill-format.md)\n\n**Result:** PASS - 1 minor violation (Critical: 0, Major: 0, Minor: 1)\n\n**Highlights:**\n\n- Correct argument-hint format\n- Clear $ARGUMENTS usage\n- Command is fully functional\n- Minor improvement: bash permissions could be scoped more specifically (`Bash(test:*), Bash(python*:*)` instead of `Bash(command:*)`)\n\n---\n\n### 3. `/meta-claude:skill:create` -  Compliant\n\n**File:** `commands/skill/create.md`\n**Last Audit:** 2025-11-17\n**Report:** [skill-create.md](skill-create.md)\n\n**Result:** PASS - 0 violations (Critical: 0, Major: 0, Minor: 0)\n\n**Highlights:**\n\n- Bash permissions properly scoped (`Bash(command:*)` for Skill tool)\n- Claude-directed perspective throughout\n- Lowercase bracket argument-hint format\n- All code blocks have language tags\n- Well-structured markdown with examples\n\n---\n\n### 4. `/meta-claude:skill:review-content` -  Compliant\n\n**File:** `commands/skill/review-content.md`\n**Last Audit:** 2025-11-17\n**Report:** [skill-review-content.md](skill-review-content.md)\n\n**Result:** PASS - 0 violations (Critical: 0, Major: 0, Minor: 0)\n\n**Highlights:**\n\n- Correct argument-hint format with lowercase brackets\n- Proper `@` prefix on all file references\n- All critical violations fixed and verified\n\n---\n\n### 5. `/meta-claude:skill:review-compliance` -  Compliant\n\n**File:** `commands/skill/review-compliance.md`\n**Last Audit:** 2025-11-17\n**Report:** [skill-review-compliance.md](skill-review-compliance.md)\n\n**Result:** PASS - 0 violations (Critical: 0, Major: 0, Minor: 0)\n\n**Highlights:**\n\n- Proper file location and naming\n- Valid frontmatter with description and argument-hint\n- Clear argument handling with `$ARGUMENTS`\n- Well-documented with usage examples\n- Claude-directed perspective throughout\n- Single clear purpose with complete examples\n\n---\n\n### 6. `/meta-claude:skill:validate-runtime` -  Compliant\n\n**File:** `commands/skill/validate-runtime.md`\n**Last Audit:** 2025-11-17\n**Report:** [skill-validate-runtime.md](skill-validate-runtime.md)\n\n**Result:** PASS - 1 minor violation (Critical: 0, Major: 0, Minor: 1)\n\n**Highlights:**\n\n- Inline bash execution using `` !`command` `` syntax\n- Proper frontmatter with `allowed-tools: Bash(test:*), Read`\n- Claude-directed perspective throughout\n- Complete argument documentation\n- Minor improvement: bash permissions could be more specific (`Bash(test -f:*)` vs `Bash(test:*)`)\n\n---\n\n### 7. `/meta-claude:skill:validate-integration` -  Compliant\n\n**File:** `commands/skill/validate-integration.md`\n**Last Audit:** 2025-11-17\n**Report:** [skill-validate-integration.md](skill-validate-integration.md)\n\n**Result:** PASS - 1 minor violation (Critical: 0, Major: 0, Minor: 1)\n\n**Highlights:**\n\n- Inline bash execution for all validation checks (`` !`test -f` ``, `` !`find` ``, `` !`rg` ``)\n- Proper frontmatter with scoped bash permissions\n- Claude-directed perspective throughout\n- Clear positional argument documentation (`$1`)\n- Minor improvement: bash permissions could be more specific (e.g., `Bash(test -f:*)` vs `Bash(test:*)`)\n\n---\n\n### 8. `/meta-claude:skill:validate-audit` -  Compliant\n\n**File:** `commands/skill/validate-audit.md`\n**Last Audit:** 2025-11-17\n**Report:** [skill-validate-audit.md](skill-validate-audit.md)\n\n**Result:** PASS - 0 violations (Critical: 0, Major: 0, Minor: 0)\n\n**Highlights:**\n\n- Proper `$ARGUMENTS` placeholder usage\n- Clear tool references (Agent tool vs Task tool)\n- Claude-directed perspective throughout\n- Complete frontmatter with description and argument-hint\n- All major violations fixed and verified\n\n---\n\n## Common Issues - RESOLVED \n\nAll major and critical issues have been resolved across all 8 commands:\n\n### Previously Fixed\n\n- **Perspective** - All commands now use Claude-directed framing (\"Your task is...\")\n- **Bash permissions** - All commands use scoped `Bash(command:*)` syntax\n- **argument-hint** - All commands use lowercase bracket format `[skill-path]`\n- **Bash execution** - All commands using bash now use inline `` !`command` `` syntax\n- **File references** - All commands use `@` prefix for static file references\n\n### Remaining (Acceptable)\n\n- **Bash permission specificity** - 2 commands have minor improvements available (overly broad wildcards like `Bash(test:*)` vs `Bash(test -f:*)`), but these are security best practices, not functionality issues\n\n---\n\n## Process\n\n**Goal:** All 8 commands 100% compliant (Phase 1) before Phase 2 (Orchestration)\n\n**Steps:**\n\n1. Run command-audit agent\n2. Generate report in `audits/meta-claude/commands/`\n3. Apply fixes\n4. Re-audit to verify\n5. Mark  Compliant at 100%\n\n**Priority:**\n\n1. `/meta-claude:skill:research` - Most complex\n2. `/meta-claude:skill:create` - Critical for workflow\n3. `/meta-claude:skill:format` - Early pipeline\n4. `/meta-claude:skill:review-content` - Quality gate\n5. `/meta-claude:skill:review-compliance` - Quality gate\n6. `/meta-claude:skill:validate-runtime` - Validation\n7. `/meta-claude:skill:validate-integration` - Validation\n8. `/meta-claude:skill:validate-audit` - Final validation\n\n---\n\n## Tools\n\n**Agent:** `plugins/meta/meta-claude/agents/command/audit.md`\n**Checklist:** `docs/checklists/slash-command-validation-checklist.md`\n**Template:** `docs/templates/slash-command-validation-report-template.md`\n**Standards:** `plugins/meta/claude-docs/skills/official-docs/reference/slash-commands.md`\n\n---\n\n## References\n\n- Design: `docs/plans/2025-11-16-skill-factory-design.md`\n- Implementation: `docs/plans/2025-11-09-command-audit-implementation.md`\n- Skills: `docs/reviews/skill-audit-log.md`\n"
              },
              {
                "name": "/skill-create",
                "description": null,
                "path": "docs/reviews/audits/meta-claude/commands/skill-create.md",
                "frontmatter": null,
                "content": "<!-- markdownlint-disable MD052 MD041 -->\n\n# Slash Command Standards Compliance Review\n\n**File:** plugins/meta/meta-claude/commands/skill/create.md\n**Date:** 2025-11-17\n**Reviewer:** command-audit\n**Command Type:** Plugin\n\n---\n\n## Standards Reference\n\n**Source:**\n`plugins/meta/claude-docs/skills/official-docs/reference/slash-commands.md`\n\n**Key Requirements:**\n\n**File Location (Lines 57-58, 71-72, 223):**\n\n- Project commands: `.claude/commands/` directory\n- User commands: `~/.claude/commands/` directory\n- Plugin commands: `commands/` directory in plugin root\n\n**Frontmatter Fields (Lines 176-182):**\n\n- `description`: Brief description (optional, defaults to first line)\n- `allowed-tools`: Tool permissions (optional, inherits from conversation)\n- `argument-hint`: Expected arguments (optional)\n- `model`: Specific model (optional, inherits from conversation)\n- `disable-model-invocation`: Prevent SlashCommand tool (optional, default\n  false)\n\n**Arguments (Lines 96-126):**\n\n- `$ARGUMENTS`: All arguments as single string\n- `$1`, `$2`, etc.: Individual positional arguments\n\n**Bash Execution (Lines 129-150):**\n\n- Inline execution uses `!` prefix: `` !`command` ``\n- Requires `allowed-tools: Bash(pattern:*)`\n\n**File References (Lines 152-166):**\n\n- Use `@` prefix: `@path/to/file`\n\n**Best Practices:**\n\n- Clear, specific instructions (not vague language)\n- Written from Claude's perspective (\"Your task is...\")\n- Examples for complex commands\n- Single, clear purpose (Unix philosophy)\n- KISS principle (Keep It Simple)\n- YAGNI principle (You Aren't Gonna Need It)\n\n---\n\n## Violations Found\n\nNo violations found. The command file passes all validation checks.\n\n---\n\n## Summary\n\n**Total violations found:** 0\n\n**Breakdown by Severity:**\n\n- Critical: 0 (blocks functionality)\n- Major: 0 (significantly impacts usability)\n- Minor: 0 (improvement opportunities)\n\n**Breakdown by Category:**\n\n- File Structure & Location: 0\n- YAML Frontmatter: 0\n- Markdown Content: 0\n- Argument Handling: 0\n- Bash Execution: 0\n- File References: 0\n- Command Content Quality: 0\n- Design Principles: 0\n- SlashCommand Tool Compatibility: 0\n\n**Overall Assessment:** PASS\n\n- No critical or major violations present\n- Command follows all official slash command standards\n- All frontmatter fields are properly formatted\n- Argument placeholders use valid syntax ($1, $2, $3)\n- Markdown content is well-structured with proper code block languages\n- Instructions are clear and written from Claude's perspective\n- Examples provided for complex usage patterns\n- Bash permissions appropriately scoped (Bash(command:*) for Skill tool invocation)\n\n---\n\n## Recommendations\n\n### Critical Actions (Must Fix)\n\nNone\n\n### Major Actions (Should Fix)\n\nNone\n\n### Minor Actions (Nice to Have)\n\nNone\n\n---\n\n## Severity Classification Guide\n\nUse this guide when categorizing violations:\n\n**Critical (Blocks Functionality):**\n\n- Invalid YAML frontmatter syntax\n- Invalid argument placeholders\n- Missing bash permissions when bash used\n- Invalid bash execution syntax\n- Invalid file reference syntax\n\n**Major (Significantly Impacts Usability):**\n\n- Missing positional argument documentation\n- Vague or ambiguous instructions\n- Missing examples for complex commands\n- Wrong command perspective\n- Argument hint mismatch\n\n**Minor (Improvement Opportunity):**\n\n- Missing frontmatter description\n- Overly broad bash permissions\n- Missing blank lines\n- Missing code block languages\n- Non-existent static file references\n"
              },
              {
                "name": "/skill-format",
                "description": null,
                "path": "docs/reviews/audits/meta-claude/commands/skill-format.md",
                "frontmatter": null,
                "content": "<!-- markdownlint-disable MD052 MD041 -->\n\n# Slash Command Standards Compliance Review\n\n**File:** plugins/meta/meta-claude/commands/skill/format.md\n**Date:** 2025-11-17\n**Reviewer:** command-audit Agent\n**Command Type:** Plugin\n\n---\n\n## Standards Reference\n\n**Source:**\n`plugins/meta/claude-docs/skills/official-docs/reference/slash-commands.md`\n\n**Key Requirements:**\n\n**File Location (Lines 57-58, 71-72, 223):**\n\n- Project commands: `.claude/commands/` directory\n- User commands: `~/.claude/commands/` directory\n- Plugin commands: `commands/` directory in plugin root\n\n**Frontmatter Fields (Lines 176-182):**\n\n- `description`: Brief description (optional, defaults to first line)\n- `allowed-tools`: Tool permissions (optional, inherits from conversation)\n- `argument-hint`: Expected arguments (optional)\n- `model`: Specific model (optional, inherits from conversation)\n- `disable-model-invocation`: Prevent SlashCommand tool (optional, default\n  false)\n\n**Arguments (Lines 96-126):**\n\n- `$ARGUMENTS`: All arguments as single string\n- `$1`, `$2`, etc.: Individual positional arguments\n\n**Bash Execution (Lines 129-150):**\n\n- Inline execution uses `!` prefix: `` !`command` ``\n- Requires `allowed-tools: Bash(pattern:*)`\n\n**File References (Lines 152-166):**\n\n- Use `@` prefix: `@path/to/file`\n\n**Best Practices:**\n\n- Clear, specific instructions (not vague language)\n- Written from Claude's perspective (\"Your task is...\")\n- Examples for complex commands\n- Single, clear purpose (Unix philosophy)\n- KISS principle (Keep It Simple)\n- YAGNI principle (You Aren't Gonna Need It)\n\n---\n\n## Violations Found\n\n### VIOLATION #1: Argument Handling - argument-hint format doesn't match official style\n\n**Current:**\n\n```markdown\nargument-hint: [research-dir]\n```\n\n**Standard violated:** argument-hint should use lowercase-with-hyphens format for all arguments (slash-commands.md line 179 with examples at lines 189, 201)\n\n**Severity:** Minor\n\n**Why this matters:** The current format uses a hyphenated argument name in the hint, which is consistent with official examples. However, examining the official examples more closely:\n\n- Line 189: `argument-hint: [message]` (single word, lowercase)\n- Line 201: `argument-hint: [pr-number] [priority] [assignee]` (multi-word uses hyphens)\n\nThe current usage `[research-dir]` actually matches the pattern correctly. Upon re-examination, this is NOT a violation.\n\n**Proposed fix:**\n\nNo fix needed - current format is correct.\n\n---\n\n### VIOLATION #2: Bash Execution - Overly permissive bash permissions\n\n**Current:**\n\n```yaml\nallowed-tools: Bash(command:*)\n```\n\n**Standard violated:** Bash permissions should be appropriately scoped to specific commands needed, not overly permissive (slash-commands.md line 136, least privilege principle)\n\n**Severity:** Minor\n\n**Why this matters:** The command uses `Bash(command:*)` which grants permission to execute any bash command. However, examining the actual bash usage in the command (line 40), it only calls the Python script `format_skill_research.py`. The broad permission is functional but less secure than scoping to specific commands needed. That said, the command does need flexibility to run the Python script and the test command for directory verification.\n\n**Proposed fix:**\n\nConsider scoping to specific commands if possible:\n\n```yaml\nallowed-tools: Bash(test:*), Bash(python*:*)\n```\n\nOr keep as-is if the command needs flexibility for directory operations and script execution.\n\n---\n\n### VIOLATION #3: Argument Handling - Using $ARGUMENTS in bash context without clear documentation\n\n**Current:**\n\nLine 34: `Extract the research directory path from $ARGUMENTS (provided by user as research directory)`\n\nLine 40:\n```bash\n${CLAUDE_PLUGIN_ROOT}/../../scripts/format_skill_research.py \"$ARGUMENTS\"\n```\n\n**Standard violated:** When using `$ARGUMENTS`, usage should be clear and consistent (slash-commands.md lines 96-107)\n\n**Severity:** Minor\n\n**Why this matters:** The command uses `$ARGUMENTS` in two contexts - once in instructions asking Claude to extract it, and once directly in a bash command. The instructions suggest Claude should \"extract\" the path from $ARGUMENTS, but then the bash command uses $ARGUMENTS directly. This could be confusing - if Claude is meant to extract it, why pass $ARGUMENTS directly to the script?\n\nHowever, upon closer examination, the bash command block (lines 39-41) is showing Claude what command to run, and Claude will substitute $ARGUMENTS when executing. The instruction on line 34 is telling Claude to understand what $ARGUMENTS contains. This is actually clear enough.\n\n**Proposed fix:**\n\nNo fix needed - the usage is clear in context.\n\n---\n\n## Summary\n\n**Total violations found:** 1\n\n**Breakdown by Severity:**\n\n- Critical: 0 (blocks functionality)\n- Major: 0 (significantly impacts usability)\n- Minor: 1 (improvement opportunities)\n\n**Breakdown by Category:**\n\n- File Structure & Location: 0\n- YAML Frontmatter: 0\n- Markdown Content: 0\n- Argument Handling: 0\n- Bash Execution: 1\n- File References: 0\n- Command Content Quality: 0\n- Design Principles: 0\n- SlashCommand Tool Compatibility: 0\n\n**Overall Assessment:** PASS\n\n- No critical or major violations present\n- One minor improvement opportunity identified\n- Command is functional and follows standards\n\n---\n\n## Recommendations\n\n### Critical Actions (Must Fix)\n\nNone.\n\n### Major Actions (Should Fix)\n\nNone.\n\n### Minor Actions (Nice to Have)\n\n1. **Violation #2 - Scope bash permissions**: Consider scoping `allowed-tools` from `Bash(command:*)` to specific commands needed (`Bash(test:*), Bash(python*:*)`). Current permission is functional but broader than necessary. This improves security posture by following least privilege principle.\n\n---\n\n## Severity Classification Guide\n\nUse this guide when categorizing violations:\n\n**Critical (Blocks Functionality):**\n\n- Invalid YAML frontmatter syntax\n- Invalid argument placeholders\n- Missing bash permissions when bash used\n- Invalid bash execution syntax\n- Invalid file reference syntax\n\n**Major (Significantly Impacts Usability):**\n\n- Missing positional argument documentation\n- Vague or ambiguous instructions\n- Missing examples for complex commands\n- Wrong command perspective\n- Argument hint mismatch\n\n**Minor (Improvement Opportunity):**\n\n- Missing frontmatter description\n- Overly broad bash permissions\n- Missing blank lines\n- Missing code block languages\n- Non-existent static file references\n"
              },
              {
                "name": "/skill-research",
                "description": null,
                "path": "docs/reviews/audits/meta-claude/commands/skill-research.md",
                "frontmatter": null,
                "content": "<!-- markdownlint-disable MD052 MD041 -->\n\n# Slash Command Standards Compliance Review\n\n**File:** plugins/meta/meta-claude/commands/skill/research.md\n**Date:** 2025-11-17\n**Reviewer:** command-audit Agent\n**Command Type:** Plugin\n\n---\n\n## Standards Reference\n\n**Source:**\n`plugins/meta/claude-docs/skills/official-docs/reference/slash-commands.md`\n\n**Key Requirements:**\n\n**File Location (Lines 57-58, 71-72, 223):**\n\n- Project commands: `.claude/commands/` directory\n- User commands: `~/.claude/commands/` directory\n- Plugin commands: `commands/` directory in plugin root\n\n**Frontmatter Fields (Lines 176-182):**\n\n- `description`: Brief description (optional, defaults to first line)\n- `allowed-tools`: Tool permissions (optional, inherits from conversation)\n- `argument-hint`: Expected arguments (optional)\n- `model`: Specific model (optional, inherits from conversation)\n- `disable-model-invocation`: Prevent SlashCommand tool (optional, default\n  false)\n\n**Arguments (Lines 96-126):**\n\n- `$ARGUMENTS`: All arguments as single string\n- `$1`, `$2`, etc.: Individual positional arguments\n\n**Bash Execution (Lines 129-150):**\n\n- Inline execution uses `!` prefix: `` !`command` ``\n- Requires `allowed-tools: Bash(pattern:*)`\n\n**File References (Lines 152-166):**\n\n- Use `@` prefix: `@path/to/file`\n\n**Best Practices:**\n\n- Clear, specific instructions (not vague language)\n- Written from Claude's perspective (\"Your task is...\")\n- Examples for complex commands\n- Single, clear purpose (Unix philosophy)\n- KISS principle (Keep It Simple)\n- YAGNI principle (You Aren't Gonna Need It)\n\n---\n\n## Violations Found\n\n**No violations found.**\n\nThis command file fully complies with all slash command standards.\n\n---\n\n## Summary\n\n**Total violations found:** 0\n\n**Breakdown by Severity:**\n\n- Critical: 0 (blocks functionality)\n- Major: 0 (significantly impacts usability)\n- Minor: 0 (improvement opportunities)\n\n**Breakdown by Category:**\n\n- File Structure & Location: 0\n- YAML Frontmatter: 0\n- Markdown Content: 0\n- Argument Handling: 0\n- Bash Execution: 0\n- File References: 0\n- Command Content Quality: 0\n- Design Principles: 0\n- SlashCommand Tool Compatibility: 0\n\n**Overall Assessment:** PASS\n\n- **PASS**: No critical or major violations\n\n---\n\n## Recommendations\n\n### Critical Actions (Must Fix)\n\nNone.\n\n### Major Actions (Should Fix)\n\nNone.\n\n### Minor Actions (Nice to Have)\n\nNone.\n\n---\n\n## Compliance Highlights\n\nThis command demonstrates excellent adherence to standards:\n\n**File Structure:**\n\n- Correctly located in plugin commands directory\n- Proper naming convention (lowercase with hyphens)\n- Valid markdown extension\n\n**Frontmatter:**\n\n- Well-structured YAML frontmatter\n- Includes helpful `description` field for discoverability\n- Correctly formatted `argument-hint` field using `[lowercase-with-hyphens]` pattern\n- Appropriately scoped `allowed-tools` permissions (python, mkdir, ls, echo)\n\n**Argument Handling:**\n\n- Properly uses `$ARGUMENTS` placeholder\n- Documents both required and optional arguments\n- `argument-hint` matches actual usage pattern\n\n**Bash Permissions:**\n\n- Grants bash permissions for specific commands Claude needs during execution\n- Does not use inline bash execution (`` !`command` ``), which is correct for this use case\n- Permissions are scoped to specific commands (python, mkdir, ls, echo) following least privilege\n\n**Content Quality:**\n\n- Clear, specific instructions throughout\n- Written from Claude's perspective (\"Your task is...\")\n- Comprehensive examples section (4 detailed examples)\n- Well-organized with logical sections\n- Expected output format clearly specified\n- Error handling section with specific guidance\n\n**Design:**\n\n- Single clear purpose: Automated research gathering for skill creation\n- Follows KISS principle with straightforward workflow\n- Follows YAGNI principle - no unnecessary features\n\n---\n\n## Severity Classification Guide\n\nUse this guide when categorizing violations:\n\n**Critical (Blocks Functionality):**\n\n- Invalid YAML frontmatter syntax\n- Invalid argument placeholders\n- Missing bash permissions when bash used\n- Invalid bash execution syntax\n- Invalid file reference syntax\n\n**Major (Significantly Impacts Usability):**\n\n- Missing positional argument documentation\n- Vague or ambiguous instructions\n- Missing examples for complex commands\n- Wrong command perspective\n- Argument hint mismatch\n\n**Minor (Improvement Opportunity):**\n\n- Missing frontmatter description\n- Overly broad bash permissions\n- Missing blank lines\n- Missing code block languages\n- Non-existent static file references\n"
              },
              {
                "name": "/skill-review-compliance",
                "description": null,
                "path": "docs/reviews/audits/meta-claude/commands/skill-review-compliance.md",
                "frontmatter": null,
                "content": "<!-- markdownlint-disable MD052 MD041 -->\n\n# Slash Command Standards Compliance Review\n\n**File:** plugins/meta/meta-claude/commands/skill/review-compliance.md\n**Date:** 2025-11-17\n**Reviewer:** command-audit Agent\n**Command Type:** Plugin\n\n---\n\n## Standards Reference\n\n**Source:**\n`plugins/meta/claude-docs/skills/official-docs/reference/slash-commands.md`\n\n**Key Requirements:**\n\n**File Location (Lines 57-58, 71-72, 223):**\n\n- Project commands: `.claude/commands/` directory\n- User commands: `~/.claude/commands/` directory\n- Plugin commands: `commands/` directory in plugin root\n\n**Frontmatter Fields (Lines 176-182):**\n\n- `description`: Brief description (optional, defaults to first line)\n- `allowed-tools`: Tool permissions (optional, inherits from conversation)\n- `argument-hint`: Expected arguments (optional)\n- `model`: Specific model (optional, inherits from conversation)\n- `disable-model-invocation`: Prevent SlashCommand tool (optional, default\n  false)\n\n**Arguments (Lines 96-126):**\n\n- `$ARGUMENTS`: All arguments as single string\n- `$1`, `$2`, etc.: Individual positional arguments\n\n**Bash Execution (Lines 129-150):**\n\n- Inline execution uses `!` prefix: `` !`command` ``\n- Requires `allowed-tools: Bash(pattern:*)`\n\n**File References (Lines 152-166):**\n\n- Use `@` prefix: `@path/to/file`\n\n**Best Practices:**\n\n- Clear, specific instructions (not vague language)\n- Written from Claude's perspective (\"Your task is...\")\n- Examples for complex commands\n- Single, clear purpose (Unix philosophy)\n- KISS principle (Keep It Simple)\n- YAGNI principle (You Aren't Gonna Need It)\n\n---\n\n## Violations Found\n\n**NO VIOLATIONS FOUND**\n\nThis command file passes all compliance checks.\n\n---\n\n## Summary\n\n**Total violations found:** 0\n\n**Breakdown by Severity:**\n\n- Critical: 0 (blocks functionality)\n- Major: 0 (significantly impacts usability)\n- Minor: 0 (improvement opportunities)\n\n**Breakdown by Category:**\n\n- File Structure & Location: 0\n- YAML Frontmatter: 0\n- Markdown Content: 0\n- Argument Handling: 0\n- Bash Execution: 0\n- File References: 0\n- Command Content Quality: 0\n- Design Principles: 0\n- SlashCommand Tool Compatibility: 0\n\n**Overall Assessment:** PASS\n\n- **PASS**: No critical or major violations\n- **FAIL**: One or more critical violations present\n- **WARNINGS**: Major violations but no critical issues\n\n---\n\n## Recommendations\n\n### Critical Actions (Must Fix)\n\nNone.\n\n### Major Actions (Should Fix)\n\nNone.\n\n### Minor Actions (Nice to Have)\n\nNone.\n\n---\n\n## Severity Classification Guide\n\nUse this guide when categorizing violations:\n\n**Critical (Blocks Functionality):**\n\n- Invalid YAML frontmatter syntax\n- Invalid argument placeholders\n- Missing bash permissions when bash used\n- Invalid bash execution syntax\n- Invalid file reference syntax\n\n**Major (Significantly Impacts Usability):**\n\n- Missing positional argument documentation\n- Vague or ambiguous instructions\n- Missing examples for complex commands\n- Wrong command perspective\n- Argument hint mismatch\n\n**Minor (Improvement Opportunity):**\n\n- Missing frontmatter description\n- Overly broad bash permissions\n- Missing blank lines\n- Missing code block languages\n- Non-existent static file references\n\n---\n\n## Analysis Notes\n\n**Command Structure:**\n\nThis command demonstrates excellent compliance with all slash command standards:\n\n1. **Proper file location and naming**: Follows plugin command conventions\n2. **Valid frontmatter**: Includes both `description` and `argument-hint` fields with correct formatting\n3. **Clear argument handling**: Uses `$ARGUMENTS` appropriately for single path argument\n4. **Well-documented**: Includes usage examples, expected output, and error handling guidance\n5. **Claude-directed perspective**: Instructions use \"Your task is...\" framing\n6. **Single purpose**: Focused solely on running compliance validation\n7. **Complete examples**: Provides both valid and invalid skill examples\n\n**Key Strengths:**\n\n- Argument hint uses correct format: `[skill-path]` (lowercase with brackets)\n- Code blocks all have language specified (bash)\n- Blank lines properly surround code blocks and lists\n- Clear documentation of what validation checks are performed\n- Explicit error handling guidance with tier categorization\n- Examples show both success and failure cases\n\n**No Bash Execution:**\n\nThe command shows a bash command in a code block (line 32) but this is NOT inline bash execution. It's instructing Claude to run the command using the Bash tool, which inherits permissions from the conversation. No `allowed-tools` frontmatter is needed.\n\nInline bash execution would use: `` !`command` `` syntax (with backticks and `!` prefix).\n"
              },
              {
                "name": "/skill-review-content",
                "description": null,
                "path": "docs/reviews/audits/meta-claude/commands/skill-review-content.md",
                "frontmatter": null,
                "content": "<!-- markdownlint-disable MD052 MD041 -->\n\n# Slash Command Standards Compliance Review\n\n**File:** plugins/meta/meta-claude/commands/skill/review-content.md\n**Date:** 2025-11-17\n**Reviewer:** command-audit Agent\n**Command Type:** Plugin\n\n---\n\n## Standards Reference\n\n**Source:**\n`plugins/meta/claude-docs/skills/official-docs/reference/slash-commands.md`\n\n**Key Requirements:**\n\n**File Location (Lines 57-58, 71-72, 223):**\n\n- Project commands: `.claude/commands/` directory\n- User commands: `~/.claude/commands/` directory\n- Plugin commands: `commands/` directory in plugin root\n\n**Frontmatter Fields (Lines 176-182):**\n\n- `description`: Brief description (optional, defaults to first line)\n- `allowed-tools`: Tool permissions (optional, inherits from conversation)\n- `argument-hint`: Expected arguments (optional)\n- `model`: Specific model (optional, inherits from conversation)\n- `disable-model-invocation`: Prevent SlashCommand tool (optional, default\n  false)\n\n**Arguments (Lines 96-126):**\n\n- `$ARGUMENTS`: All arguments as single string\n- `$1`, `$2`, etc.: Individual positional arguments\n\n**Bash Execution (Lines 129-150):**\n\n- Inline execution uses `!` prefix: `` !`command` ``\n- Requires `allowed-tools: Bash(pattern:*)`\n\n**File References (Lines 152-166):**\n\n- Use `@` prefix: `@path/to/file`\n\n**Best Practices:**\n\n- Clear, specific instructions (not vague language)\n- Written from Claude's perspective (\"Your task is...\")\n- Examples for complex commands\n- Single, clear purpose (Unix philosophy)\n- KISS principle (Keep It Simple)\n- YAGNI principle (You Aren't Gonna Need It)\n\n---\n\n## Violations Found\n\n### VIOLATION #1: Argument Handling - Invalid argument placeholder\n\n**Current:**\n\n```markdown\n/meta-claude:skill:review-content <skill-path>\n```\n\n**Standard violated:** Only `$ARGUMENTS` and `$1`, `$2`, etc. are recognized argument placeholders (slash-commands.md lines 96-126)\n\n**Severity:** Critical\n\n**Why this matters:** The placeholder `<skill-path>` is not a valid argument placeholder in Claude Code slash commands. Commands must use `$ARGUMENTS` for all arguments or `$1`, `$2`, etc. for positional arguments. Without valid placeholders, the command cannot receive user-provided values at runtime.\n\n**Proposed fix:**\n\n```markdown\n/meta-claude:skill:review-content $ARGUMENTS\n```\n\n---\n\n### VIOLATION #2: File References - File reference syntax incorrect\n\n**Current:**\n\nLine 226:\n```markdown\n/meta-claude:skill:review-content plugins/meta/meta-claude/skills/skill-creator\n```\n\n**Standard violated:** File references must use `@` prefix: `@path/to/file` (slash-commands.md lines 152-166)\n\n**Severity:** Critical\n\n**Why this matters:** Without the `@` prefix, Claude Code will not recognize this as a file reference and will not read the file contents. The command will receive the literal string instead of the file being loaded into context.\n\n**Proposed fix:**\n\n```markdown\n/meta-claude:skill:review-content @plugins/meta/meta-claude/skills/skill-creator\n```\n\n---\n\n### VIOLATION #3: File References - File reference syntax incorrect\n\n**Current:**\n\nLine 235:\n```markdown\n/meta-claude:skill:review-content /path/to/draft-skill\n```\n\n**Standard violated:** File references must use `@` prefix: `@path/to/file` (slash-commands.md lines 152-166)\n\n**Severity:** Critical\n\n**Why this matters:** Without the `@` prefix, Claude Code will not recognize this as a file reference and will not read the file contents. The command will receive the literal string instead of the file being loaded into context.\n\n**Proposed fix:**\n\n```markdown\n/meta-claude:skill:review-content @/path/to/draft-skill\n```\n\n---\n\n## Summary\n\n**Total violations found:** 3\n\n**Breakdown by Severity:**\n\n- Critical: 3 (blocks functionality)\n- Major: 0 (significantly impacts usability)\n- Minor: 0 (improvement opportunities)\n\n**Breakdown by Category:**\n\n- File Structure & Location: 0\n- YAML Frontmatter: 0\n- Markdown Content: 0\n- Argument Handling: 1\n- Bash Execution: 0\n- File References: 2\n- Command Content Quality: 0\n- Design Principles: 0\n- SlashCommand Tool Compatibility: 0\n\n**Overall Assessment:** FAIL\n\n- **FAIL**: One or more critical violations present\n\n---\n\n## Recommendations\n\n### Critical Actions (Must Fix)\n\n1. **Fix Violation #1 - Invalid argument placeholder**:\n   Replace `<skill-path>` with valid placeholder syntax. Change to `$ARGUMENTS` on line 8.\n\n2. **Fix Violation #2 - Missing @ prefix for file reference**:\n   Add `@` prefix to file path in example on line 226. Change `plugins/meta/meta-claude/skills/skill-creator` to `@plugins/meta/meta-claude/skills/skill-creator`.\n\n3. **Fix Violation #3 - Missing @ prefix for file reference**:\n   Add `@` prefix to file path in example on line 235. Change `/path/to/draft-skill` to `@/path/to/draft-skill`.\n\n### Major Actions (Should Fix)\n\nNone.\n\n### Minor Actions (Nice to Have)\n\nNone.\n\n---\n"
              },
              {
                "name": "/skill-validate-audit",
                "description": null,
                "path": "docs/reviews/audits/meta-claude/commands/skill-validate-audit.md",
                "frontmatter": null,
                "content": "<!-- markdownlint-disable MD052 MD041 -->\n\n# Slash Command Standards Compliance Review\n\n**File:** plugins/meta/meta-claude/commands/skill/validate-audit.md\n**Date:** 2025-11-17\n**Reviewer:** Command Audit Agent\n**Command Type:** Plugin\n\n---\n\n## Standards Reference\n\n**Source:**\n`plugins/meta/claude-docs/skills/official-docs/reference/slash-commands.md`\n\n**Key Requirements:**\n\n**File Location (Lines 57-58, 71-72, 223):**\n\n- Project commands: `.claude/commands/` directory\n- User commands: `~/.claude/commands/` directory\n- Plugin commands: `commands/` directory in plugin root\n\n**Frontmatter Fields (Lines 176-182):**\n\n- `description`: Brief description (optional, defaults to first line)\n- `allowed-tools`: Tool permissions (optional, inherits from conversation)\n- `argument-hint`: Expected arguments (optional)\n- `model`: Specific model (optional, inherits from conversation)\n- `disable-model-invocation`: Prevent SlashCommand tool (optional, default\n  false)\n\n**Arguments (Lines 96-126):**\n\n- `$ARGUMENTS`: All arguments as single string\n- `$1`, `$2`, etc.: Individual positional arguments\n\n**Bash Execution (Lines 129-150):**\n\n- Inline execution uses `!` prefix: `` !`command` ``\n- Requires `allowed-tools: Bash(pattern:*)`\n\n**File References (Lines 152-166):**\n\n- Use `@` prefix: `@path/to/file`\n\n**Best Practices:**\n\n- Clear, specific instructions (not vague language)\n- Written from Claude's perspective (\"Your task is...\")\n- Examples for complex commands\n- Single, clear purpose (Unix philosophy)\n- KISS principle (Keep It Simple)\n- YAGNI principle (You Aren't Gonna Need It)\n\n---\n\n## Violations Found\n\n### VIOLATION #1: Argument Handling - Missing positional argument documentation\n\n**Current:**\n\nThe command shows usage with `<skill-path>` argument:\n\n    ## Usage\n\n    ```bash\n    /meta-claude:skill:validate-audit <skill-path>\n    ```\n\nBut the Instructions section never uses `$ARGUMENTS` or `$1` to capture this value.\n\n**Standard violated:** When using positional arguments (`$1`, `$2`, etc.), each positional parameter must be explained so users know argument order and meaning (slash-commands.md lines 109-126)\n\n**Severity:** Major\n\n**Why this matters:** The command expects a `<skill-path>` argument but never uses `$ARGUMENTS` or `$1` placeholder to capture it in the instructions. Users won't know how to pass the skill path, and Claude won't have access to the value.\n\n**Proposed fix:**\n\nUpdate the Instructions section to use the positional argument:\n\n    ## Instructions\n\n    Use the Task tool to invoke the skill-auditor agent:\n\n    ```text\n    I need to audit the skill at $ARGUMENTS for compliance with official Claude Code specifications.\n\n    Please review:\n    - SKILL.md structure and organization\n    - Frontmatter quality and completeness\n    - Progressive disclosure patterns\n    - Content clarity and usefulness\n    - Adherence to best practices\n\n    Provide a detailed audit report with recommendations.\n    ```\n\n---\n\n### VIOLATION #2: Command Content Quality - Vague instructions using forbidden tool\n\n**Current:**\n\n    Use the Task tool to invoke the skill-auditor agent:\n\n**Standard violated:** Instructions must be clear and specific, using specific action verbs and avoiding vague language like \"handle\", \"process\", or \"deal with\" (checklist section 7)\n\n**Severity:** Major\n\n**Why this matters:** The command references \"Task tool\" which is not a standard Claude Code tool. This creates confusion about what action Claude should take. The instructions should directly tell Claude what to do, not reference non-existent tools.\n\n**Proposed fix:**\n\nReplace vague tool reference with direct, actionable instructions:\n\n    ## Instructions\n\n    Invoke the skill-auditor agent (located at plugins/meta/meta-claude/agents/skill-auditor.md) to perform comprehensive analysis:\n\n    1. Read the skill at $ARGUMENTS\n    2. Evaluate against official Claude Code specifications:\n       - SKILL.md structure and organization\n       - Frontmatter quality and completeness\n       - Progressive disclosure patterns\n       - Content clarity and usefulness\n       - Adherence to best practices\n    3. Generate a detailed audit report with specific recommendations\n\n---\n\n### VIOLATION #3: Command Content Quality - Third-person perspective instead of Claude-directed\n\n**Current:**\n\n    Run comprehensive skill audit using skill-auditor agent (non-blocking).\n\n**Standard violated:** Instructions must be written from Claude's perspective, addressing Claude directly (\"You should...\", \"Your task is...\"), not third-person description (slash-commands.md lines 148-149, 205-206)\n\n**Severity:** Major\n\n**Why this matters:** Commands should directly instruct Claude on what to do, not describe what the command does. Third-person descriptions reduce clarity and effectiveness.\n\n**Proposed fix:**\n\nRewrite first line to address Claude directly:\n\n    # Skill Validate Audit\n\n    Your task is to run a comprehensive skill audit using the skill-auditor agent (non-blocking validation).\n\n---\n\n### VIOLATION #4: Argument Handling - Missing argument-hint frontmatter\n\n**Current:**\n\nNo frontmatter present in the command file.\n\n**Standard violated:** When a command expects arguments, the `argument-hint` frontmatter field should be present to show users what arguments are expected (slash-commands.md line 179, examples at lines 189, 201)\n\n**Severity:** Minor\n\n**Why this matters:** Without `argument-hint`, users won't see autocomplete hints when typing the command. This makes the command less discoverable and harder to use correctly.\n\n**Proposed fix:**\n\nAdd frontmatter with argument hint:\n\n    ---\n    argument-hint: [skill-path]\n    description: Run comprehensive skill audit using skill-auditor agent (non-blocking)\n    ---\n\n---\n\n### VIOLATION #5: SlashCommand Tool Compatibility - Missing description frontmatter for tool discoverability\n\n**Current:**\n\nNo frontmatter present in the command file.\n\n**Standard violated:** Commands should have a `description` frontmatter field for SlashCommand tool discoverability (slash-commands.md line 346)\n\n**Severity:** Minor\n\n**Why this matters:** Without a `description` field, the command won't be available via the SlashCommand tool, limiting Claude's ability to invoke it programmatically when appropriate.\n\n**Proposed fix:**\n\nAdd frontmatter with description:\n\n    ---\n    argument-hint: [skill-path]\n    description: Run comprehensive skill audit using skill-auditor agent (non-blocking)\n    ---\n\n---\n\n## Summary\n\n**Total violations found:** 5\n\n**Breakdown by Severity:**\n\n- Critical: 0 (blocks functionality)\n- Major: 3 (significantly impacts usability)\n- Minor: 2 (improvement opportunities)\n\n**Breakdown by Category:**\n\n- File Structure & Location: 0\n- YAML Frontmatter: 0\n- Markdown Content: 0\n- Argument Handling: 2\n- Bash Execution: 0\n- File References: 0\n- Command Content Quality: 2\n- Design Principles: 0\n- SlashCommand Tool Compatibility: 1\n\n**Overall Assessment:** WARNINGS\n\n- **PASS**: No critical or major violations\n- **FAIL**: One or more critical violations present\n- **WARNINGS**: Major violations but no critical issues \n\n---\n\n## Recommendations\n\n### Critical Actions (Must Fix)\n\nNone.\n\n### Major Actions (Should Fix)\n\n1. **Fix argument handling (Violation #1)**: Add `$ARGUMENTS` placeholder in the Instructions section to capture the skill path argument. Without this, the command cannot access the user-provided skill path.\n\n2. **Clarify instructions and remove Task tool reference (Violation #2)**: Replace the vague \"Use the Task tool\" instruction with direct, actionable steps telling Claude exactly what to do. The Task tool is not a standard Claude Code tool.\n\n3. **Rewrite in Claude-directed perspective (Violation #3)**: Change the first line from third-person description to second-person instructions addressing Claude directly.\n\n### Minor Actions (Nice to Have)\n\n1. **Add frontmatter with argument-hint (Violation #4)**: Include `argument-hint: [skill-path]` in frontmatter to provide autocomplete hints for users.\n\n2. **Add frontmatter with description (Violation #5)**: Include `description` field in frontmatter to enable SlashCommand tool discoverability.\n\n---\n\n## Severity Classification Guide\n\nUse this guide when categorizing violations:\n\n**Critical (Blocks Functionality):**\n\n- Invalid YAML frontmatter syntax\n- Invalid argument placeholders\n- Missing bash permissions when bash used\n- Invalid bash execution syntax\n- Invalid file reference syntax\n\n**Major (Significantly Impacts Usability):**\n\n- Missing positional argument documentation\n- Vague or ambiguous instructions\n- Missing examples for complex commands\n- Wrong command perspective\n- Argument hint mismatch\n\n**Minor (Improvement Opportunity):**\n\n- Missing frontmatter description\n- Overly broad bash permissions\n- Missing blank lines\n- Missing code block languages\n- Non-existent static file references\n"
              },
              {
                "name": "/skill-validate-integration",
                "description": null,
                "path": "docs/reviews/audits/meta-claude/commands/skill-validate-integration.md",
                "frontmatter": null,
                "content": "<!-- markdownlint-disable MD052 MD041 -->\n\n# Slash Command Standards Compliance Review\n\n**File:** plugins/meta/meta-claude/commands/skill/validate-integration.md\n**Date:** 2025-11-17\n**Reviewer:** command-audit Agent\n**Command Type:** Plugin\n\n---\n\n## Standards Reference\n\n**Source:**\n`plugins/meta/claude-docs/skills/official-docs/reference/slash-commands.md`\n\n**Key Requirements:**\n\n**File Location (Lines 57-58, 71-72, 223):**\n\n- Project commands: `.claude/commands/` directory\n- User commands: `~/.claude/commands/` directory\n- Plugin commands: `commands/` directory in plugin root\n\n**Frontmatter Fields (Lines 176-182):**\n\n- `description`: Brief description (optional, defaults to first line)\n- `allowed-tools`: Tool permissions (optional, inherits from conversation)\n- `argument-hint`: Expected arguments (optional)\n- `model`: Specific model (optional, inherits from conversation)\n- `disable-model-invocation`: Prevent SlashCommand tool (optional, default\n  false)\n\n**Arguments (Lines 96-126):**\n\n- `$ARGUMENTS`: All arguments as single string\n- `$1`, `$2`, etc.: Individual positional arguments\n\n**Bash Execution (Lines 129-150):**\n\n- Inline execution uses `!` prefix: `` !`command` ``\n- Requires `allowed-tools: Bash(pattern:*)`\n\n**File References (Lines 152-166):**\n\n- Use `@` prefix: `@path/to/file`\n\n**Best Practices:**\n\n- Clear, specific instructions (not vague language)\n- Written from Claude's perspective (\"Your task is...\")\n- Examples for complex commands\n- Single, clear purpose (Unix philosophy)\n- KISS principle (Keep It Simple)\n- YAGNI principle (You Aren't Gonna Need It)\n\n---\n\n## Violations Found\n\n### VIOLATION #1: Bash Execution - Missing allowed-tools frontmatter\n\n**Current:**\n\n```markdown\n# Skill Validate Integration\n\nTest skill integration with Claude Code ecosystem (conflict detection and compatibility).\n```\n\n(No frontmatter present)\n\n**Standard violated:** Bash command execution requires `allowed-tools: Bash(pattern:*)` in frontmatter (slash-commands.md lines 130, 136)\n\n**Severity:** Critical\n\n**Why this matters:** The command contains bash execution examples (lines 31-34, 64-66, 133-135) but lacks the required `allowed-tools` frontmatter field. Without this permission, Claude cannot execute the bash commands shown in the instructions, preventing the command from functioning as designed.\n\n**Proposed fix:**\n\nAdd frontmatter with bash permissions:\n\n```markdown\n---\nallowed-tools: Bash(test:*), Bash(find:*), Bash(git:*)\ndescription: Test skill integration with Claude Code ecosystem (conflict detection and compatibility)\n---\n```\n\n---\n\n### VIOLATION #2: Argument Handling - Invalid argument placeholder syntax\n\n**Current:**\n\n```markdown\n/meta-claude:skill:validate-integration <skill-path>\n```\n\n(Line 8)\n\n**Standard violated:** Only `$ARGUMENTS` and `$1`, `$2`, etc. are recognized argument placeholders (slash-commands.md lines 96-126)\n\n**Severity:** Critical\n\n**Why this matters:** The command uses `<skill-path>` placeholder syntax which is not recognized by Claude Code's argument substitution system. This will cause the argument to not be passed correctly to the command, breaking functionality.\n\n**Proposed fix:**\n\nUse valid placeholder:\n\n```markdown\n/meta-claude:skill:validate-integration $1\n```\n\nThen add to frontmatter:\n\n```yaml\nargument-hint: [skill-path]\n```\n\n---\n\n### VIOLATION #3: Argument Handling - Invalid placeholder in instructions\n\n**Current:**\n\n```bash\ntest -f <skill-path>/SKILL.md && echo \"SKILL.md exists\" || \\\n  echo \"Error: SKILL.md not found\"\n```\n\n(Lines 31-33)\n\n**Standard violated:** Only `$ARGUMENTS` and `$1`, `$2`, etc. are recognized argument placeholders (slash-commands.md lines 96-126)\n\n**Severity:** Critical\n\n**Why this matters:** The instructions use `<skill-path>` throughout (lines 32, 98, 134, 245-248) instead of valid placeholders like `$1`. Claude will not substitute these with actual argument values, causing all commands to fail.\n\n**Proposed fix:**\n\nReplace all instances of `<skill-path>` with `$1`:\n\n```bash\ntest -f $1/SKILL.md && echo \"SKILL.md exists\" || \\\n  echo \"Error: SKILL.md not found\"\n```\n\n---\n\n### VIOLATION #4: Markdown Content - Missing language on code blocks\n\n**Current:**\n\n```text\nCheck that the skill directory contains a valid SKILL.md file:\n\n```\n\ntest -f <skill-path>/SKILL.md && echo \"SKILL.md exists\" || \\\n  echo \"Error: SKILL.md not found\"\n```bash\n```\n\n(Lines 29-34)\n\n**Standard violated:** CLAUDE.md requirement \"Fenced code blocks MUST have a language specified\"\n\n**Severity:** Minor\n\n**Why this matters:** Code blocks without language specifications lack syntax highlighting and may not render properly in some markdown parsers. This affects readability and user experience.\n\n**Proposed fix:**\n\nAdd language to all code blocks. Found violations at lines:\n- Line 31: Add `bash` language\n- Line 63: Add `bash` language\n- Line 133: Add `bash` language\n- Line 245: Add `text` language\n- Line 296: Add `bash` language\n- Line 307: Add `bash` language\n- Line 320: Add `bash` language\n- Line 334: Add `bash` language\n\nExample fix for line 31:\n\n```markdown\nCheck that the skill directory contains a valid SKILL.md file:\n\n```bash\ntest -f $1/SKILL.md && echo \"SKILL.md exists\" || \\\n  echo \"Error: SKILL.md not found\"\n```\n\n```text\n\n---\n\n### VIOLATION #5: Bash Execution - Missing inline execution syntax\n\n**Current:**\n\n```bash\ntest -f <skill-path>/SKILL.md && echo \"SKILL.md exists\" || \\\n  echo \"Error: SKILL.md not found\"\n```\n\n(Lines 31-33)\n\n**Standard violated:** Bash command execution requires `!` prefix for inline execution: `` !`command` `` (slash-commands.md lines 129-150)\n\n**Severity:** Major\n\n**Why this matters:** The command shows bash examples as code blocks (lines 31-34, 64-66, 133-135) but they appear to be intended as examples for Claude to execute, not just documentation. If these are meant to execute during command invocation, they need the `!` prefix. If they're just examples, this is a documentation clarity issue.\n\n**Proposed fix:**\n\nIf bash commands should execute during command invocation, use inline execution:\n\n```markdown\nCheck that the skill directory contains a valid SKILL.md file:\n\n!`test -f $1/SKILL.md && echo \"SKILL.md exists\" || echo \"Error: SKILL.md not found\"`\n```\n\nIf they're just examples for documentation, clarify this is example syntax:\n\n```markdown\n**Example validation:**\n\n```bash\ntest -f $1/SKILL.md && echo \"SKILL.md exists\" || \\\n  echo \"Error: SKILL.md not found\"\n```\n```text\n\n---\n\n### VIOLATION #6: Command Content Quality - Third-person perspective\n\n**Current:**\n\n```markdown\n## Instructions\n\nPerform integration validation checks on the skill at the provided path.\n\n### Step 1: Verify Skill Exists\n\nCheck that the skill directory contains a valid SKILL.md file:\n```\n\n(Lines 23-29)\n\n**Standard violated:** Instructions should be written from Claude's perspective using direct address (slash-commands.md lines 148-149, 205-206)\n\n**Severity:** Major\n\n**Why this matters:** The command uses third-person imperative (\"Perform validation checks\", \"Check that the skill...\") rather than direct address to Claude. This is less clear than Claude-directed instructions and doesn't follow the official pattern for slash commands.\n\n**Proposed fix:**\n\nRewrite in Claude-directed perspective:\n\n```markdown\n## Instructions\n\nYour task is to perform integration validation checks on the skill at the provided path.\n\n### Step 1: Verify Skill Exists\n\nVerify that the skill directory contains a valid SKILL.md file:\n```\n\nApply this pattern throughout:\n- \"Perform\"  \"Your task is to perform\"\n- \"Check that\"  \"Verify that\"\n- \"Create a structured report\"  \"Your task is to create a structured report\"\n- \"Extract\"  \"Extract\" (already imperative, acceptable)\n\n---\n\n### VIOLATION #7: SlashCommand Tool Compatibility - Missing description field\n\n**Current:**\n\n```markdown\n# Skill Validate Integration\n\nTest skill integration with Claude Code ecosystem (conflict detection and compatibility).\n```\n\n(No frontmatter)\n\n**Standard violated:** SlashCommand tool requires `description` frontmatter field for command discoverability (slash-commands.md line 346)\n\n**Severity:** Minor\n\n**Why this matters:** Without a frontmatter `description` field, the command won't be available for Claude to invoke programmatically via the SlashCommand tool. The command will still work when invoked manually, but lacks programmatic discoverability. The description defaults to the first line, but explicit frontmatter is best practice for tool compatibility.\n\n**Proposed fix:**\n\nAdd frontmatter with description:\n\n```markdown\n---\nallowed-tools: Bash(test:*), Bash(find:*), Bash(git:*)\ndescription: Test skill integration with Claude Code ecosystem (conflict detection and compatibility)\nargument-hint: [skill-path]\n---\n```\n\n---\n\n### VIOLATION #8: Argument Handling - Missing positional argument documentation\n\n**Current:**\n\n```markdown\n## Usage\n\n```bash\n/meta-claude:skill:validate-integration <skill-path>\n```\n```text\n\n(Lines 5-9)\n\n**Standard violated:** Positional arguments should be documented so users know argument order and meaning (slash-commands.md lines 109-126)\n\n**Severity:** Major\n\n**Why this matters:** The command uses a positional argument but doesn't explain what `skill-path` should be (absolute path? relative? directory or file?). Users need clear guidance on what to pass.\n\n**Proposed fix:**\n\nAdd argument documentation:\n\n```markdown\n## Usage\n\n```bash\n/meta-claude:skill:validate-integration [skill-path]\n```\n\n**Arguments:**\n\n- `skill-path`: Path to the skill directory to validate (can be absolute or relative)\n\n**Example:**\n\n```bash\n/meta-claude:skill:validate-integration plugins/meta/meta-claude/skills/docker-security\n```\n```\n\n---\n\n## Summary\n\n**Total violations found:** 8\n\n**Breakdown by Severity:**\n\n- Critical: 3 (blocks functionality)\n- Major: 3 (significantly impacts usability)\n- Minor: 2 (improvement opportunities)\n\n**Breakdown by Category:**\n\n- File Structure & Location: 0\n- YAML Frontmatter: 1\n- Markdown Content: 1\n- Argument Handling: 3\n- Bash Execution: 2\n- File References: 0\n- Command Content Quality: 1\n- Design Principles: 0\n- SlashCommand Tool Compatibility: 1\n\n**Overall Assessment:** FAIL\n\n- **FAIL**: Three critical violations present\n  1. Missing required `allowed-tools` frontmatter for bash execution\n  2. Invalid argument placeholder syntax in usage example\n  3. Invalid argument placeholders throughout instructions\n\n---\n\n## Recommendations\n\n### Critical Actions (Must Fix)\n\n1. **Fix Violation #1**: Add frontmatter with required bash permissions\n   ```yaml\n   ---\n   allowed-tools: Bash(test:*), Bash(find:*), Bash(git:*)\n   description: Test skill integration with Claude Code ecosystem (conflict detection and compatibility)\n   argument-hint: [skill-path]\n   ---\n   ```\n\n2. **Fix Violation #2**: Replace `<skill-path>` with `$1` in usage example (line 8)\n\n3. **Fix Violation #3**: Replace all `<skill-path>` instances with `$1` throughout instructions (lines 32, 98, 134, 245-248)\n\n### Major Actions (Should Fix)\n\n4. **Fix Violation #5**: Clarify bash execution intent - use `!` prefix for inline execution or clearly mark as example syntax\n\n5. **Fix Violation #6**: Rewrite instructions in Claude-directed perspective (\"Your task is to...\", \"Verify that...\")\n\n6. **Fix Violation #8**: Add argument documentation explaining what `skill-path` parameter expects\n\n### Minor Actions (Nice to Have)\n\n7. **Fix Violation #4**: Add language specifications to all code blocks (8 instances found)\n\n8. **Fix Violation #7**: Add explicit frontmatter `description` field for SlashCommand tool compatibility (already addressed in Critical Action #1)\n\n---\n\n## Severity Classification Guide\n\nUse this guide when categorizing violations:\n\n**Critical (Blocks Functionality):**\n\n- Invalid YAML frontmatter syntax\n- Invalid argument placeholders\n- Missing bash permissions when bash used\n- Invalid bash execution syntax\n- Invalid file reference syntax\n\n**Major (Significantly Impacts Usability):**\n\n- Missing positional argument documentation\n- Vague or ambiguous instructions\n- Missing examples for complex commands\n- Wrong command perspective\n- Argument hint mismatch\n\n**Minor (Improvement Opportunity):**\n\n- Missing frontmatter description\n- Overly broad bash permissions\n- Missing blank lines\n- Missing code block languages\n- Non-existent static file references\n\n---\n"
              },
              {
                "name": "/skill-validate-runtime",
                "description": null,
                "path": "docs/reviews/audits/meta-claude/commands/skill-validate-runtime.md",
                "frontmatter": null,
                "content": "<!-- markdownlint-disable MD052 MD041 -->\n\n# Slash Command Standards Compliance Review\n\n**File:** plugins/meta/meta-claude/commands/skill/validate-runtime.md\n**Date:** 2025-11-17\n**Reviewer:** command-audit Agent\n**Command Type:** Plugin\n\n---\n\n## Standards Reference\n\n**Source:**\n`plugins/meta/claude-docs/skills/official-docs/reference/slash-commands.md`\n\n**Key Requirements:**\n\n**File Location (Lines 57-58, 71-72, 223):**\n\n- Project commands: `.claude/commands/` directory\n- User commands: `~/.claude/commands/` directory\n- Plugin commands: `commands/` directory in plugin root\n\n**Frontmatter Fields (Lines 176-182):**\n\n- `description`: Brief description (optional, defaults to first line)\n- `allowed-tools`: Tool permissions (optional, inherits from conversation)\n- `argument-hint`: Expected arguments (optional)\n- `model`: Specific model (optional, inherits from conversation)\n- `disable-model-invocation`: Prevent SlashCommand tool (optional, default\n  false)\n\n**Arguments (Lines 96-126):**\n\n- `$ARGUMENTS`: All arguments as single string\n- `$1`, `$2`, etc.: Individual positional arguments\n\n**Bash Execution (Lines 129-150):**\n\n- Inline execution uses `!` prefix: `` !`command` ``\n- Requires `allowed-tools: Bash(pattern:*)`\n\n**File References (Lines 152-166):**\n\n- Use `@` prefix: `@path/to/file`\n\n**Best Practices:**\n\n- Clear, specific instructions (not vague language)\n- Written from Claude's perspective (\"Your task is...\")\n- Examples for complex commands\n- Single, clear purpose (Unix philosophy)\n- KISS principle (Keep It Simple)\n- YAGNI principle (You Aren't Gonna Need It)\n\n---\n\n## Violations Found\n\n### VIOLATION #1: File Structure - Missing frontmatter entirely\n\n**Current:**\n\n```markdown\n# Skill Validate Runtime\n\nTest skill by attempting to load it in Claude Code context (runtime validation).\n```\n\n**Standard violated:** While frontmatter is optional (slash-commands.md line 173), best practice recommends including `description` field for SlashCommand tool discoverability (slash-commands.md line 346 \"Have description frontmatter field populated\")\n\n**Severity:** Minor\n\n**Why this matters:** Without a `description` frontmatter field, this command will not be available via the SlashCommand tool. Claude cannot invoke this command programmatically. The command will only work with manual `/` invocation.\n\n**Proposed fix:**\n\n```markdown\n---\ndescription: Test skill by attempting to load it in Claude Code context (runtime validation)\n---\n\n# Skill Validate Runtime\n\nTest skill by attempting to load it in Claude Code context (runtime validation).\n```\n\n---\n\n### VIOLATION #2: Argument Handling - Missing argument-hint frontmatter\n\n**Current:**\n\nThe command shows usage `<skill-path>` parameter but has no `argument-hint` frontmatter field.\n\n**Standard violated:** Best practice recommends `argument-hint` frontmatter for commands that accept arguments (slash-commands.md line 179)\n\n**Severity:** Minor\n\n**Why this matters:** Without `argument-hint`, users won't see the expected argument format when auto-completing the slash command. The hint provides inline documentation about what arguments the command expects.\n\n**Proposed fix:**\n\nAdd to frontmatter:\n\n    ---\n    description: Test skill by attempting to load it in Claude Code context (runtime validation)\n    argument-hint: [skill-path]\n    ---\n\n---\n\n### VIOLATION #3: Argument Handling - No documentation of positional argument\n\n**Current:**\n\nThe command usage shows `<skill-path>` but there is no explanation in the command content that this argument should be referenced as `$ARGUMENTS` or `$1` in the instructions.\n\n**Standard violated:** When using arguments, the command must document how to access them (slash-commands.md lines 96-126, specifically 109-126 for positional arguments)\n\n**Severity:** Major\n\n**Why this matters:** The command shows it expects an argument in the Usage section, but never tells Claude how to use that argument. The instructions say \"at the provided path\" but don't use `$ARGUMENTS` or `$1` placeholder to actually access the path value. This makes the argument handling ambiguous.\n\n**Proposed fix:**\n\nUpdate line 27 to use proper argument placeholder:\n\n    ## Instructions\n\n    Perform runtime validation checks on the skill at $ARGUMENTS.\n\nOr use `$1` consistently throughout the command:\n\n    ### Step 1: Verify Skill Structure\n\n    Check that the skill directory contains a valid SKILL.md file:\n\n    ```bash\n    test -f $1/SKILL.md && echo \"SKILL.md exists\" || \\\n      echo \"Error: SKILL.md not found\"\n    ```\n\n---\n\n### VIOLATION #4: Argument Handling - Invalid placeholder syntax in bash examples\n\n**Current:**\n\nLines 34-36 use `<skill-path>`:\n\n    ```bash\n    test -f <skill-path>/SKILL.md && echo \"SKILL.md exists\" || \\\n      echo \"Error: SKILL.md not found\"\n    ```\n\nLines 183-184 use `<skill-path>`:\n\n    ```text\n    Error: SKILL.md not found at <skill-path>\n    ```\n\n**Standard violated:** Must use valid argument placeholders (`$ARGUMENTS`, `$1`, `$2`, etc.), not custom syntax like `<skill-path>` (slash-commands.md lines 96-126)\n\n**Severity:** Critical\n\n**Why this matters:** `<skill-path>` is not a recognized argument placeholder. Claude will not substitute this with the actual argument value. The command will fail when executed because the literal string `<skill-path>` will be used instead of the user's provided path.\n\n**Proposed fix:**\n\nReplace all instances of `<skill-path>` with proper placeholder:\n\n    test -f $ARGUMENTS/SKILL.md && echo \"SKILL.md exists\" || \\\n      echo \"Error: SKILL.md not found\"\n\n    Error: SKILL.md not found at $ARGUMENTS\n\n---\n\n### VIOLATION #5: Command Content Quality - Instructions not written from Claude's perspective\n\n**Current:**\n\nLine 27:\n\n    Perform runtime validation checks on the skill at the provided path.\n\nThroughout the command (lines 29, 40, 57, 76, 100, 119, 131) uses imperative mood:\n\n    ### Step 1: Verify Skill Structure\n    ### Step 2: Validate Markdown Syntax\n    ### Step 3: Parse Frontmatter\n    ### Step 4: Test Description Triggering\n    ### Step 5: Verify Progressive Disclosure\n    ### Step 6: Test Context Loading\n    ### Generate Runtime Test Report\n\n**Standard violated:** Instructions should be written from Claude's perspective, addressing Claude directly (slash-commands.md lines 148-149, 205-206 showing \"Your task is...\")\n\n**Severity:** Major\n\n**Why this matters:** The command uses imperative mood as if giving orders to a tool, rather than collaborative instructions for Claude. This is less clear and doesn't follow the standard pattern of framing commands as Claude's task.\n\n**Proposed fix:**\n\n    ## Instructions\n\n    Your task is to perform runtime validation checks on the skill at $ARGUMENTS.\n\n    ### Step 1: Verify Skill Structure\n\n    Check that the skill directory contains a valid SKILL.md file:\n\nAlternative more Claude-directed framing:\n\n    ## Your Task\n\n    You will perform runtime validation checks on the skill at $ARGUMENTS. Follow these steps:\n\n    ### 1. Verify Skill Structure\n\n    First, check that the skill directory contains a valid SKILL.md file:\n\n---\n\n### VIOLATION #6: Markdown Content - Code blocks without language specified\n\n**Current:**\n\nLine 135 uses `text`:\n\n    ```text\n    ## Runtime Validation Report: <skill-name>\n    ```\n\nLines 183, 229, 241, 256 all use `text` for output examples.\n\n**Standard violated:** CLAUDE.md requirement \"Fenced code blocks MUST have a language specified\"\n\n**Severity:** Minor\n\n**Why this matters:** While `text` is technically a language specifier, the standard examples in slash-commands.md use proper language identifiers like `bash`, `markdown`, `yaml`. Using `text` is functional but doesn't follow the pattern shown in official examples which use specific languages.\n\n**Proposed fix:**\n\nFor command examples showing bash output, use `bash`. For examples showing error messages or generic output, use `plaintext`. Or keep as `text` (this is actually valid and acceptable, so this violation could be downgraded to informational or removed).\n\n---\n\n## Summary\n\n**Total violations found:** 6\n\n**Breakdown by Severity:**\n\n- Critical: 1 (blocks functionality)\n- Major: 2 (significantly impacts usability)\n- Minor: 3 (improvement opportunities)\n\n**Breakdown by Category:**\n\n- File Structure & Location: 1\n- YAML Frontmatter: 0\n- Markdown Content: 1\n- Argument Handling: 3\n- Bash Execution: 0\n- File References: 0\n- Command Content Quality: 1\n- Design Principles: 0\n- SlashCommand Tool Compatibility: 0\n\n**Overall Assessment:** FAIL\n\n- **FAIL**: One or more Critical violations present (invalid argument placeholder syntax)\n\n---\n\n## Recommendations\n\n### Critical Actions (Must Fix)\n\n1. **Fix argument placeholder syntax (Violation #4)**: Replace all instances of `<skill-path>` with valid placeholder `$ARGUMENTS` or `$1`. This is blocking functionality - the command will not work correctly until this is fixed.\n\n### Major Actions (Should Fix)\n\n1. **Document argument handling (Violation #3)**: Add clear documentation showing how to access the skill-path argument using `$ARGUMENTS` or `$1`. Update all references in the Instructions section to use the proper placeholder.\n\n2. **Rewrite from Claude's perspective (Violation #5)**: Change imperative instructions (\"Perform runtime validation...\") to Claude-directed framing (\"Your task is to...\", \"You will...\"). This significantly improves clarity and follows official standards.\n\n### Minor Actions (Nice to Have)\n\n1. **Add frontmatter description (Violation #1)**: Include frontmatter with `description` field to enable SlashCommand tool discoverability. This allows Claude to invoke the command programmatically.\n\n2. **Add argument-hint frontmatter (Violation #2)**: Include `argument-hint: [skill-path]` in frontmatter to provide inline documentation during auto-completion.\n\n3. **Review code block language usage (Violation #6)**: Consider whether `text` is the most appropriate language identifier for output examples, or if `plaintext`, `bash`, or other identifiers would be more accurate. This is very minor and may not require action.\n\n---\n"
              },
              {
                "name": "/branch-cleanup",
                "description": "Comprehensive git branch cleanup and organization",
                "path": "plugins/devops/git-workflow/commands/branch-cleanup.md",
                "frontmatter": {
                  "description": "Comprehensive git branch cleanup and organization",
                  "allowed-tools": "Bash(git:*), Bash(gh:*), AskUserQuestion"
                },
                "content": "# Comprehensive Git Branch Cleanup\n\nPerform a complete cleanup of local and remote branches after working on multiple PRs.\n\n## Current State\n\n- Default branch: !`git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@' || echo \"main\"`\n- Current branch: !`git branch --show-current`\n- Fetch latest: !`git fetch --all --prune 2>&1`\n\n## Branch Inventory\n\n### All Branches\n\nLocal branches with tracking status:\n\n!`git branch --format='%(refname:short) %(upstream:track)' | sort`\n\nRecent branches by activity:\n\n!`git for-each-ref --count=15 --sort=-committerdate refs/heads/ --format='%(refname:short) - %(committerdate:relative)'`\n\nRemote branches:\n\n!`git branch -r --format='%(refname:short)' | grep -v HEAD | sort`\n\n### Cleanup Candidates\n\nDefault branch: !`git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@' || echo \"main\"`\n\nMerged into default branch: !`git branch --merged`\n\nBranches with gone remotes:\n\n!`git branch -vv | grep ': gone]' | awk '{print $1}' | sort`\n\nStale remote-tracking refs (would be pruned):\n\n!`git remote prune origin --dry-run 2>&1 | grep '\\[would prune\\]' | awk '{print $NF}' || echo \"None\"`\n\n## Protected Branches\n\nNever delete branches matching these patterns:\n\n- `main`, `master`, `develop`, `staging`, `production`\n- `release/*` branches (unless explicitly confirmed via AskUserQuestion)\n- `renovate/*` branches (managed by Renovate bot)\n- Current working branch\n- Branches with unpushed commits (use AskUserQuestion to confirm)\n\n## Cleanup Workflow\n\n### Phase 1: Analyze\n\n1. Review the branch inventory above\n2. Identify the default branch (protect from deletion)\n3. Categorize branches:\n   - **Safe to delete**: Merged branches and branches with gone remotes (excluding protected)\n   - **Needs confirmation**: `release/*` branches, branches with unpushed commits\n   - **Protected**: All protected branch patterns and current branch\n\n### Phase 2: Confirm Cleanup Plan\n\nBefore deleting anything, present the cleanup plan and use AskUserQuestion:\n\n**Question: Cleanup scope**\n- header: \"Cleanup\"\n- question: \"Which branches should be deleted?\"\n- multiSelect: false\n- options:\n  - All safe (Delete all merged and gone-remote branches)\n  - Merged only (Delete only branches merged into default)\n  - Gone only (Delete only branches with deleted remotes)\n  - Review each (Confirm each branch individually)\n\nIf user selects \"Review each\", iterate through each candidate branch with:\n\n**Question: Per-branch confirmation**\n- header: \"Delete?\"\n- question: \"Delete branch '[branch-name]'? ([merged/gone], last commit: [date])\"\n- options:\n  - Yes (Delete this branch)\n  - No (Keep this branch)\n  - Stop (Abort remaining cleanup)\n\n### Phase 3: Execute Cleanup\n\nAfter user confirmation, execute in order:\n\n1. **Prune stale remote-tracking refs**: `git remote prune origin`\n2. **Delete merged local branches**: `git branch -d [branch-name]`\n3. **Delete gone-remote branches**: `git branch -D [branch-name]`\n\nFor each deletion, record the branch name and SHA before deleting:\n`git rev-parse [branch-name]`\n\n**If deletion fails**, use AskUserQuestion:\n\n- header: \"Failed\"\n- question: \"Failed to delete '[branch-name]': [error]. What should we do?\"\n- options:\n  - Force (Use git branch -D to force delete)\n  - Skip (Leave this branch, continue with others)\n  - Abort (Stop cleanup, keep remaining branches)\n\n### Phase 4: Remote Cleanup (Optional)\n\nAfter local cleanup, use AskUserQuestion:\n\n- header: \"Remotes\"\n- question: \"Delete corresponding remote branches on origin?\"\n- options:\n  - Yes (Run git push origin --delete for each deleted local branch)\n  - No (Keep remote branches, only cleaned up locally)\n\n### Phase 5: Summary\n\nProvide cleanup summary:\n\n```text\nBranch Cleanup Summary:\n- Deleted N merged feature branches\n- Removed N branches with gone remotes\n- Pruned N stale remote references\n- Repository now has N active branches (was M)\n\nRecovery Commands:\n```\n\nFor each deleted branch, output:\n`git checkout -b [branch-name] [sha]`\n\nFinal branch state:\n\n!`git branch --format='%(refname:short)'`"
              },
              {
                "name": "/generate-changelog",
                "description": "Generate changelog using git-cliff, optionally bump version tag",
                "path": "plugins/devops/git-workflow/commands/generate-changelog.md",
                "frontmatter": {
                  "description": "Generate changelog using git-cliff, optionally bump version tag",
                  "allowed-tools": "Bash(git:*), Bash(git-cliff:*), AskUserQuestion, Read"
                },
                "content": "# Generate Changelog\n\nGenerate or update CHANGELOG.md using git-cliff based on conventional commits.\n\n**Typical workflow:** Run after `/git-commit` or commit-craft agent, before pushing to remote.\n\n## Current State\n\n- Branch and status: !`git status -sb`\n- Recent commits: !`git log --oneline -10`\n- Latest tag: !`git describe --tags --abbrev=0 2>/dev/null || echo \"No tags yet\"`\n- Unpushed commits: !`git log --oneline @{u}..HEAD 2>/dev/null || echo \"No upstream or no unpushed commits\"`\n- Working directory: !`git status --porcelain | head -5 || echo \"Clean\"`\n- Unreleased changes preview: !`git-cliff --unreleased 2>/dev/null | head -20 || echo \"No unreleased changes or git-cliff not configured\"`\n\n## Workflow\n\n### Phase 1: Pre-flight Check\n\n1. If working directory has uncommitted changes (other than CHANGELOG.md), use AskUserQuestion:\n   - header: \"Uncommitted\"\n   - question: \"You have uncommitted changes. Continue with changelog generation?\"\n   - options:\n     - Continue (Proceed anyway)\n     - Abort (Stop and commit changes first)\n\n2. If no conventional commits since last tag, inform user and stop\n\n### Phase 2: Choose Action\n\nUse AskUserQuestion to determine workflow:\n\n- header: \"Action\"\n- question: \"What would you like to do with the changelog?\"\n- options:\n  - Preview (Show what would be generated without writing)\n  - Generate (Create/update CHANGELOG.md)\n  - Release (Generate changelog and create version tag)\n\n### Phase 3: Execute Action\n\n#### If Preview\n\nShow unreleased changes: `git-cliff --unreleased`\n\nReport summary and stop.\n\n#### If Generate\n\n1. Generate changelog: `git-cliff -o CHANGELOG.md`\n\n2. Show diff: `git diff CHANGELOG.md`\n\n3. Commit: `git add CHANGELOG.md && git commit -m \"docs: update changelog\"`\n\n#### If Release\n\n1. Analyze unreleased commits to provide a recommendation:\n   - Review the commits shown in Current State\n   - Identify the types of changes (breaking, features, fixes, docs, etc.)\n   - Check git-cliff's detection: `git-cliff --bump --bumped-version`\n\n2. Provide a recommendation with reasoning:\n   - Summarize what's being released (e.g., \"3 features, 5 bug fixes, 2 docs updates\")\n   - Explain the recommended bump level based on semantic versioning:\n     - Major: if breaking changes or `BREAKING CHANGE:` commits present\n     - Minor: if new features (`feat:`) without breaking changes\n     - Patch: if only fixes, docs, refactors, etc.\n   - Show the proposed version: \"[CURRENT]  [RECOMMENDED]\"\n\n3. Use AskUserQuestion to confirm:\n   - header: \"Release\"\n   - question: \"Proceed with [RECOMMENDED_LEVEL] release to v[VERSION]?\"\n   - options:\n     - Yes (Create release with recommended version)\n     - Patch (Override: bump patch instead)\n     - Minor (Override: bump minor instead)\n     - Major (Override: bump major instead)\n\n4. Generate changelog with confirmed version: `git-cliff --bump [level] -o CHANGELOG.md`\n\n5. Show diff: `git diff CHANGELOG.md`\n\n6. Commit: `git add CHANGELOG.md && git commit -m \"docs: update changelog for v[VERSION]\"`\n\n7. Create annotated tag: `git tag -a v[VERSION] -m \"Release v[VERSION]\"`\n\n8. Report: Previous version  New version\n\n### Phase 4: Summary\n\nProvide completion summary:\n\n- Changelog diff summary (categories and entry count)\n- Version change (if releasing): `v0.1.0  v0.2.0`\n- Next step reminder:\n  - If committed: \"Ready to push with `git push`\"\n  - If released: \"Ready to push with `git push && git push --tags`\""
              },
              {
                "name": "/git-commit",
                "description": "Run pre-commit hooks and create clean, logical commits",
                "path": "plugins/devops/git-workflow/commands/git-commit.md",
                "frontmatter": {
                  "description": "Run pre-commit hooks and create clean, logical commits",
                  "allowed-tools": "Bash(git:*), Bash(pre-commit:*), Bash(test:*), Task, AskUserQuestion"
                },
                "content": "# Git Commit Workflow\n\nOrchestrate pre-commit hooks and invoke commit-craft agent for clean, logical commits.\n\n## Current State\n\n- Branch and status: !`git status -sb`\n- Working directory: !`git status --short`\n- Merge/rebase state: !`test -f .git/MERGE_HEAD && echo \"MERGE IN PROGRESS\" || test -d .git/rebase-merge && echo \"REBASE IN PROGRESS\" || echo \"Clean\"`\n- Staged files: !`git diff --cached --name-only`\n- Sensitive files check: !`git diff --cached --name-only | grep -iE '\\.(env|mcp\\.json)$|secret|token|key|password' || echo \"None detected\"`\n\n## Workflow\n\n### Step 1: Pre-flight Checks\n\nVerify repository state:\n\n1. If merge or rebase in progress, stop and inform user\n2. If sensitive files detected, use AskUserQuestion:\n   - header: \"Sensitive\"\n   - question: \"Sensitive files detected in staged changes. Proceed with commit?\"\n   - options:\n     - Continue (I understand the risk, proceed)\n     - Unstage (Remove sensitive files from staging)\n     - Abort (Cancel commit workflow)\n\n### Step 2: Run Pre-commit Hooks (if configured)\n\nCheck if pre-commit is configured: `test -f .pre-commit-config.yaml`\n\nIf configured, execute pre-commit hooks: `pre-commit run -a`\n\nAnalyze the output:\n\n- If hooks pass: Continue to Step 3\n- If hooks fail with errors: Report errors and stop\n- If hooks modify files (formatting, etc.):\n  1. Show which files were modified\n  2. Re-stage modified files: `git add -u`\n  3. Continue to Step 3\n\n### Step 3: Create Commits\n\nUse the Task tool to invoke the commit-craft agent:\n\n- subagent_type: \"commit-craft\"\n- prompt: \"Create clean, atomic commits for the current workspace changes\"\n\nThe commit-craft agent will:\n\n1. Analyze all workspace changes\n2. Group related changes into atomic commits\n3. Create conventional commit messages\n4. Execute commits handling any additional hook runs"
              },
              {
                "name": "/git-status",
                "description": "Summarize the current state of the git repository",
                "path": "plugins/devops/git-workflow/commands/git-status.md",
                "frontmatter": {
                  "description": "Summarize the current state of the git repository",
                  "allowed-tools": "Bash(git:*)",
                  "model": "haiku"
                },
                "content": "# Git Status\n\nSummarize the current state of the git repository.\n\n## Repository State\n\nBranch and sync status: !`git status -sb`\n\nWorking directory: !`git status --short`\n\nRecent commits: !`git log --oneline -5`\n\nStashes: !`git stash list`\n\n## Task\n\nProvide a concise summary including:\n\n1. **Branch status**: Current branch and ahead/behind remote\n2. **Working directory**: Count of staged, unstaged, and untracked changes\n3. **Recent activity**: Brief summary of recent commits\n4. **Action items**: Suggested next steps based on current state"
              },
              {
                "name": "/new-sdk-app",
                "description": "Create and setup a new Claude Agent SDK application (Python)",
                "path": "plugins/devops/python-tools/commands/new-sdk-app.md",
                "frontmatter": {
                  "description": "Create and setup a new Claude Agent SDK application (Python)",
                  "argument-hint": [
                    "project-name"
                  ]
                },
                "content": "You are tasked with helping the user create a new Claude Agent SDK application using Python. Follow these steps carefully:\n\n## Reference Documentation\n\nBefore starting, use the **claude-agent-sdk skill** to ensure you follow SDK best practices:\n\n```bash\n# Load the skill to access patterns and examples\n/skill claude-agent-sdk\n```\n\nThe skill provides:\n\n- SDK templates (assets/sdk-template.py)\n- Official examples (examples/)\n- Best practices and patterns (references/)\n- Validation checklist (assets/sdk-validation-checklist.md)\n\nAlso reference the official documentation:\n\n- Python SDK reference: <https://docs.claude.com/en/api/agent-sdk/python>\n\n**IMPORTANT**: Always check for and use the latest SDK version (targeting >= 0.1.6).\n\n## Gather Requirements\n\nIMPORTANT: Ask these questions one at a time. Wait for the user's response before asking the next question. This makes it easier for the user to respond.\n\nAsk the questions in this order (skip any that the user has already provided via arguments):\n\n1. **Project name** (ask first): \"What would you like to name your project?\"\n\n   - If $ARGUMENTS is provided, use that as the project name and skip this question\n   - Wait for response before continuing\n\n2. **Agent type** (ask second, but skip if #1 was sufficiently detailed): \"What kind of agent are you building? Some examples:\n\n   - Coding agent (SRE, security review, code review)\n   - Orchestrator with subagents (multi-agent workflows)\n   - Business agent (customer support, content creation)\n   - Custom agent (describe your use case)\"\n   - Wait for response before continuing\n\n3. **Starting point** (ask third): \"Would you like:\n\n   - A minimal query() example for simple tasks\n   - A ClaudeSDKClient example for multi-turn conversations\n   - An orchestrator with subagents\n   - Start from the SDK template (assets/sdk-template.py)\"\n   - Wait for response before continuing\n\n4. **Project structure** (ask fourth): \"What project structure would you prefer:\n\n   - Single-file uv script (self-contained with `# /// script` header)\n   - Standard Python project with pyproject.toml\"\n   - Wait for response before continuing\n\nAfter all questions are answered, proceed to create the setup plan.\n\n## Setup Plan\n\nBased on the user's answers, create a plan that includes:\n\n1. **Project initialization**:\n\n   - Create project directory (if it doesn't exist)\n   - **For uv scripts**: Create single Python file with `# /// script` header including `claude-agent-sdk` dependency\n   - **For standard projects**:\n     - Initialize with `pyproject.toml`\n     - Add `claude-agent-sdk` to dependencies\n     - Configure Python version requirements (>= 3.8)\n\n2. **Check for Latest Versions**:\n\n   - BEFORE installing, check PyPI for the latest version: <https://pypi.org/project/claude-agent-sdk/>\n   - Inform the user which version you're using (targeting >= 0.1.6)\n\n3. **SDK Installation**:\n\n   - **For uv scripts**: Dependencies specified in script header, no separate installation needed\n   - **For standard projects**:\n     - Install with `pip install claude-agent-sdk` or add to pyproject.toml\n     - After installation, verify with `pip show claude-agent-sdk`\n\n4. **Create starter files**:\n\n   Based on user's choice:\n\n   - **query() example**: Simple one-shot task (no conversation memory)\n   - **ClaudeSDKClient example**: Multi-turn conversation with context\n   - **Orchestrator**: Main orchestrator with programmatically registered subagents\n   - **SDK template**: Copy from `assets/sdk-template.py` and customize\n\n   All files should include:\n   - Proper imports (`claude_agent_sdk`, `anyio`)\n   - SDK best practices (system_prompt, allowed_tools, permission_mode)\n   - Error handling\n   - Clear comments explaining each part\n\n5. **Authentication setup**:\n\n   - Explain that the SDK uses local Claude Code authentication\n   - No `.env` files needed when running with Claude Code\n   - If running standalone, API key can be set via environment variable\n\n6. **Optional: Create .claude directory structure**:\n   - Offer to create `.claude/agents/` directory for subagent definitions\n   - Provide example agent markdown files if building an orchestrator\n\n## Implementation\n\nAfter gathering requirements and getting user confirmation on the plan:\n\n1. Check for latest SDK version on PyPI\n2. Execute the setup steps\n3. Create all necessary files based on project structure choice:\n   - **Uv script**: Single file with proper script header\n   - **Standard project**: pyproject.toml + source files\n4. Install dependencies if standard project (uv scripts handle deps automatically)\n5. Verify installed versions and inform the user\n6. Create a working example based on their starting point:\n   - Use patterns from the claude-agent-sdk skill\n   - Reference examples from `examples/` directory\n   - Follow SDK best practices\n7. Add helpful comments explaining SDK concepts:\n   - What `ClaudeAgentOptions` does\n   - Why `system_prompt=\"claude_code\"` for orchestrators\n   - Tool restrictions and permission modes\n   - Async runtime choice (anyio vs asyncio)\n8. **VERIFY THE CODE WORKS BEFORE FINISHING**:\n   - Verify imports are correct\n   - Check for syntax errors\n   - Validate SDK patterns match documentation\n   - Ensure agent names match if using orchestrator\n   - **DO NOT consider the setup complete until the code verifies successfully**\n\n## Verification\n\nAfter all files are created and dependencies are installed, launch the **agent-sdk-verifier-py** agent to validate that the Agent SDK application is properly configured and ready for use:\n\n1. Use the Task tool to launch the `agent-sdk-verifier-py` subagent\n2. The agent will check:\n   - SDK installation and configuration\n   - Proper imports and SDK patterns\n   - query() vs ClaudeSDKClient usage\n   - Orchestrator requirements (system_prompt, Task tool, agent registration)\n   - Permission and security settings\n   - Best practices adherence\n3. Review the verification report and address any issues before completing setup\n\n## Getting Started Guide\n\nOnce setup is complete and verified, provide the user with:\n\n1. **Next steps**:\n\n   - **For uv scripts**: Run with `uv run <script-name>.py` (automatically handles dependencies)\n   - **For standard projects**:\n     - Activate virtual environment if needed\n     - Run with `python main.py` or `python src/main.py`\n   - Authentication uses local Claude Code session (no API key setup needed)\n\n2. **Useful resources**:\n\n   - Python SDK reference: <https://docs.claude.com/en/api/agent-sdk/python>\n   - claude-agent-sdk skill: `/skill claude-agent-sdk` for patterns and examples\n   - Key concepts to explore:\n     - System prompts (preset vs custom)\n     - Permissions (permission_mode and callbacks)\n     - Tools (allowed_tools restrictions)\n     - MCP servers (custom tools)\n     - Subagents (programmatic registration)\n\n3. **Common next steps**:\n   - Customize the system prompt for your use case\n   - Add custom tools via SDK MCP servers (see `examples/mcp_calculator.py`)\n   - Configure permission callbacks for fine-grained control\n   - Create and register subagents programmatically\n   - Review examples in the skill: `examples/hooks.py`, `examples/streaming_mode.py`\n   - Validate changes with `assets/sdk-validation-checklist.md`\n\n## Important Notes\n\n- **ALWAYS USE LATEST SDK VERSION**: Check PyPI for the latest version (targeting >= 0.1.6)\n- **VERIFY CODE WORKS BEFORE FINISHING**:\n  - Verify imports are correct\n  - Check syntax\n  - Validate SDK patterns (query() vs ClaudeSDKClient, system_prompt, tools)\n  - Ensure agent names match if using orchestrator\n  - Launch agent-sdk-verifier-py for comprehensive validation\n  - Do NOT consider the task complete until verification passes\n- **USE THE CLAUDE-AGENT-SDK SKILL**: Reference patterns and examples from the skill\n- **FOLLOW SDK BEST PRACTICES**:\n  - Use `system_prompt=\"claude_code\"` for orchestrators\n  - Register agents programmatically via `agents={}`\n  - Include `\"Task\"` in orchestrator's allowed_tools\n  - Choose appropriate runtime (anyio.run or asyncio.run)\n  - Restrict tools to minimum needed per agent\n- Always check if directories/files already exist before creating them\n- Ensure all code examples are functional and include proper error handling\n- Use patterns compatible with the latest SDK version\n- Make the experience interactive and educational\n- **ASK QUESTIONS ONE AT A TIME** - Do not ask multiple questions in a single response\n\nBegin by asking the FIRST requirement question only. Wait for the user's answer before proceeding to the next question."
              },
              {
                "name": "/review-sdk-app",
                "description": "Review and validate a Claude Agent SDK application against best practices",
                "path": "plugins/devops/python-tools/commands/review-sdk-app.md",
                "frontmatter": {
                  "description": "Review and validate a Claude Agent SDK application against best practices",
                  "argument-hint": [
                    "path-to-app"
                  ]
                },
                "content": "# Review Claude Agent SDK Application\n\nYou are tasked with reviewing a Claude Agent SDK (Python) application to ensure\nit follows SDK best practices and official documentation patterns. Follow these\nsteps carefully:\n\n## Reference Documentation\n\nBefore starting, load the **claude-agent-sdk skill** to access patterns, examples, and the validation checklist:\n\n```bash\n# Load the skill for comprehensive SDK knowledge\n/skill claude-agent-sdk\n```\n\nThe skill provides:\n\n- **Validation checklist**: `assets/sdk-validation-checklist.md` (comprehensive review guide)\n- **SDK patterns**: `SKILL.md` and `references/` (official best practices)\n- **Working examples**: `examples/` (reference implementations)\n- **Template**: `assets/sdk-template.py` (ideal structure)\n\n## Review Approach\n\nYou have TWO options for reviewing SDK applications:\n\n### Option 1: Automated Validation (Recommended)\n\nLaunch the **agent-sdk-verifier-py** subagent for comprehensive automated review:\n\n```bash\n# The subagent will:\n# - Read all application files\n# - Check SDK patterns and configuration\n# - Validate against official documentation\n# - Provide detailed report with specific issues and recommendations\n```\n\n**Best for:**\n\n- Quick validation\n- New applications\n- Pre-deployment checks\n- Comprehensive coverage\n\n### Option 2: Manual Guided Review\n\nFollow the validation checklist step-by-step with guided assistance.\n\n**Best for:**\n\n- Learning SDK patterns\n- Understanding specific issues\n- Deep dive into SDK concepts\n- Educational reviews\n\n## Gather Information\n\nAsk the user (if not provided via $ARGUMENTS):\n\n1. **Application path**: \"What is the path to your SDK application?\"\n   - If $ARGUMENTS is provided, use that as the application path\n   - Wait for response before continuing\n\n2. **Review type**: \"Would you like:\n   - Automated validation (launch agent-sdk-verifier)\n   - Manual guided review (step-by-step checklist)\n   - Both (automated first, then deep dive on issues)\"\n   - Wait for response before continuing\n\n## Automated Validation Flow\n\nIf user chooses automated validation:\n\n1. **Launch verifier agent**:\n   - Use Task tool to launch `agent-sdk-verifier` subagent\n   - Provide the application path to the agent\n   - Wait for verification report\n\n2. **Review the report**:\n   - **Overall Status**: PASS | PASS WITH WARNINGS | FAIL\n   - **Critical Issues**: Must be fixed before deployment\n   - **Warnings**: Suboptimal patterns or improvements\n   - **Passed Checks**: Correctly configured elements\n   - **Recommendations**: Specific improvements with references\n\n3. **Address issues**:\n   - For each critical issue: explain the problem and provide fix\n   - For warnings: explain why the recommendation matters\n   - Reference specific skill documentation for context\n\n4. **Re-validate if changes made**:\n   - After fixes, offer to re-run validation\n   - Ensure all critical issues are resolved\n\n## Manual Guided Review Flow\n\nIf user chooses manual review, systematically work through the validation\nchecklist (`assets/sdk-validation-checklist.md`):\n\n### Section 1: Imports & Dependencies\n\nRead the application files and check:\n\n- [ ] Async runtime import (anyio or asyncio)\n- [ ] Claude SDK imports are accurate\n- [ ] UV script headers (if single-file script)\n\n**Ask user**: \"Found any issues with imports? (Y/N)\"\n\nIf yes, explain the issue and show correct pattern from skill examples.\n\n### Section 2: Async Runtime\n\nCheck:\n\n- [ ] Runtime execution (`anyio.run()` or `asyncio.run()`)\n- [ ] Async/await patterns are correct\n- [ ] Context managers for ClaudeSDKClient\n\n**Ask user**: \"Found any issues with async patterns? (Y/N)\"\n\n### Section 3: query() vs ClaudeSDKClient Choice\n\nCheck:\n\n- [ ] Correct approach for use case\n- [ ] Not using hooks/custom tools with query()\n\n**Ask user**: \"Is the query()/ClaudeSDKClient choice appropriate? (Y/N)\"\n\nIf no, explain when to use each approach (reference SKILL.md lines 29-44).\n\n### Section 4: Orchestrator Configuration (if applicable)\n\nCheck:\n\n- [ ] System prompt is `\"claude_code\"` for orchestrators\n- [ ] Task tool is included in allowed_tools\n- [ ] Agents are registered programmatically\n\n**Ask user**: \"Found any orchestrator configuration issues? (Y/N)\"\n\n### Section 5: Agent Definitions (if applicable)\n\nCheck:\n\n- [ ] Agent structure is correct (description, prompt, tools, model)\n- [ ] Agent names match between definition and usage\n- [ ] Tools are restricted to minimum needed\n\n**Ask user**: \"Found any agent definition issues? (Y/N)\"\n\n### Section 6: Permission Control\n\nCheck:\n\n- [ ] Permission strategy is appropriate\n- [ ] Permission mode is valid\n- [ ] Permission callback (if used) is correct\n\n**Ask user**: \"Found any permission issues? (Y/N)\"\n\n### Section 7: Hooks (if used)\n\nCheck:\n\n- [ ] Hooks ONLY used with ClaudeSDKClient\n- [ ] Hook types are supported (not using SessionStart, etc.)\n- [ ] Hook signature is correct\n- [ ] Hook output structure is valid\n\n**Ask user**: \"Found any hook issues? (Y/N)\"\n\n### Section 8: ClaudeSDKClient Usage (if applicable)\n\nCheck:\n\n- [ ] Context manager pattern is used\n- [ ] Query  receive_response flow\n- [ ] Interrupts (if used) are correct\n\n**Ask user**: \"Found any ClaudeSDKClient usage issues? (Y/N)\"\n\n### Section 9: Message Handling\n\nCheck:\n\n- [ ] Message types are checked correctly\n- [ ] TextBlock extraction is correct\n- [ ] ResultMessage handling\n\n**Ask user**: \"Found any message handling issues? (Y/N)\"\n\n### Section 10: Error Handling\n\nCheck:\n\n- [ ] API key validation (if running standalone)\n- [ ] Safe dictionary access\n- [ ] Async exception handling\n\n**Ask user**: \"Found any error handling issues? (Y/N)\"\n\n### Section 11: Settings & Configuration\n\nCheck:\n\n- [ ] setting_sources is configured appropriately\n- [ ] Model selection is appropriate\n- [ ] Budget limits (if needed)\n\n**Ask user**: \"Found any configuration issues? (Y/N)\"\n\n### Section 12: Best Practices\n\nCheck:\n\n- [ ] Follows DRY principle\n- [ ] Clear comments and documentation\n- [ ] Type hints are used\n- [ ] No anti-patterns\n\n**Ask user**: \"Found any best practice violations? (Y/N)\"\n\n### Manual Review Summary\n\nAfter completing all sections, provide:\n\n```markdown\n## Validation Summary\n\n###  Passed Checks:\n- [List of passed checks]\n\n###  Issues Found:\n- [List of issues with severity: CRITICAL | WARNING | INFO]\n\n###  Fixes Required:\n1. [Specific fix with file:line reference and code example]\n2. [Specific fix with file:line reference and code example]\n\n###  Overall Assessment:\n- **SDK Pattern Adherence**: [High/Medium/Low]\n- **Production Ready**: [Yes/No/With Fixes]\n- **Recommended Next Steps**: [Specific actions]\n```\n\n## Providing Fixes\n\nFor each issue identified:\n\n1. **Explain the problem**:\n   - Why it's an issue\n   - What SDK pattern is being violated\n   - Reference to skill documentation\n\n2. **Show the correct pattern**:\n   - Code example from skill examples or template\n   - Explain why this pattern is preferred\n   - Link to relevant skill reference\n\n3. **Provide specific fix**:\n   - Exact code change needed\n   - File and line reference\n   - Before/after comparison if helpful\n\n## Follow-up Actions\n\nAfter review:\n\n1. **Offer to implement fixes**:\n   - \"Would you like me to implement these fixes?\"\n   - If yes, make changes and re-validate\n\n2. **Suggest re-validation**:\n   - \"Would you like to run automated validation to confirm fixes?\"\n   - Launch agent-sdk-verifier-py if requested\n\n3. **Recommend next steps**:\n   - Additional features to consider\n   - Testing recommendations\n   - Deployment considerations\n\n## Important Notes\n\n- **USE THE VALIDATION CHECKLIST**: `assets/sdk-validation-checklist.md` is your comprehensive guide\n- **REFERENCE SKILL DOCUMENTATION**: Always link to specific skill files for context\n- **SHOW WORKING EXAMPLES**: Use examples from `examples/` directory\n- **BE SPECIFIC**: Provide file:line references and exact code changes\n- **EXPLAIN WHY**: Don't just identify issues, explain the SDK reasoning\n- **PRIORITIZE ISSUES**: CRITICAL (breaks functionality) > WARNING (suboptimal) > INFO (nice to have)\n- **VERIFY FIXES**: Re-validate after making changes\n- **USE AGENT-SDK-VERIFIER-PY**: Leverage automated validation for comprehensive coverage\n\n## Key SDK Patterns to Verify\n\nAlways check these common issues:\n\n1. **Orchestrator missing system_prompt**: Must use `\"claude_code\"`\n2. **Orchestrator missing Task tool**: Cannot delegate without it\n3. **Agent name mismatches**: Definition name must match usage\n4. **Hooks with query()**: Not supported, use ClaudeSDKClient\n5. **Custom tools with query()**: Not supported, use ClaudeSDKClient\n6. **Excessive tool permissions**: Restrict to minimum needed\n7. **Missing agent registration**: Use `agents={}` parameter\n8. **Wrong async runtime call**: Use `anyio.run()` or `asyncio.run()`\n9. **Missing context manager**: ClaudeSDKClient requires `async with`\n10. **Unsafe dictionary access**: Use `.get()` for optional fields\n\nBegin by asking about the application path (if not provided) and review type preference."
              },
              {
                "name": "/review-uv-script",
                "description": "Review uv Python script for PEP 723 compliance and best practices",
                "path": "plugins/devops/python-tools/commands/review-uv-script.md",
                "frontmatter": {
                  "description": "Review uv Python script for PEP 723 compliance and best practices",
                  "argument-hint": [
                    "script-path"
                  ],
                  "allowed-tools": "Read, Grep, Glob"
                },
                "content": "# UV Python Script Review\n\nReview the uv Python script at `$ARGUMENTS` against best practices.\n\n## Script to Review\n\n@$ARGUMENTS\n\n## Confidence Scoring\n\nRate each potential issue from 0-100:\n\n| Score | Meaning |\n|-------|---------|\n| 0-25 | Likely false positive or stylistic preference |\n| 26-50 | Minor nitpick, not explicitly in best practices |\n| 51-75 | Valid but low-impact issue |\n| 76-90 | Important issue requiring attention |\n| 91-100 | Critical bug or explicit best practice violation |\n\n**Only report issues with confidence  80.** Quality over quantity.\n\n## Review Categories\n\n### 1. PEP 723 Metadata Block (Critical)\n\n**Required elements:**\n\n- Has `# /// script` opening marker (exactly `/// script`, not `/// scripts` or `//`)\n- Has `# ///` closing marker\n- `requires-python` is specified (e.g., `>=3.11`)\n- `dependencies` array is present (even if empty)\n- Each TOML line starts with `#`\n\n**Forbidden patterns:**\n\n- `[tool.uv.metadata]` - Invalid field, causes runtime error\n- Custom top-level fields (`author`, `version`, `description`) - Only `requires-python` and `dependencies` allowed\n- Missing `#` prefix on TOML lines\n\n**Valid [tool.uv] usage** (without `.metadata`):\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = []\n# [tool.uv]\n# exclude-newer = \"2025-01-01T00:00:00Z\"  # Valid\n# ///\n```\n\n### 2. Shebang Line (Important)\n\n- Has proper shebang: `#!/usr/bin/env -S uv run --script`\n- Consider `--quiet` flag for production scripts\n- Shebang must be first line (before metadata block)\n\n### 3. Dependency Management (Important)\n\n**Version pinning:**\n\n- Use `>=X.Y.Z` for utilities (allows updates)\n- Use `==X.Y.Z` only for deployment scripts requiring reproducibility\n- No bare package names (`\"httpx\"`  `\"httpx>=0.27.0\"`)\n\n**Heavy dependencies flag:**\n\n- Flag `tensorflow`, `torch`, `transformers` - Too heavy for single-file scripts\n- Suggest using proper uv project instead\n\n### 4. Documentation (Medium)\n\n- Module docstring present after metadata block\n- Docstring includes: purpose, usage, examples\n- Metadata (team, author, version) in docstring, NOT in TOML\n\n### 5. Silent Failure Detection (Critical)\n\nHunt for error handling that hides failures:\n\n**Absolutely Forbidden:**\n\n- Empty `except:` blocks\n- `except Exception: pass` or `except: pass`\n- Catching exceptions without logging or re-raising\n- Returning `None`/default on error without indication\n\n**Scrutinize Each Handler:**\n\n- Does the except block catch only expected error types?\n- Could this catch block accidentally suppress unrelated errors?\n- Is the error logged with sufficient context?\n- Does the user receive clear, actionable feedback?\n\n**Common Python Silent Failure Patterns:**\n\n```python\n# BAD: Silent swallowing\ntry:\n    result = api_call()\nexcept:\n    result = None  # User has no idea it failed\n\n# BAD: Overly broad catch\ntry:\n    data = json.loads(response)\nexcept Exception:\n    pass  # Hides syntax errors, type errors, etc.\n\n# GOOD: Specific handling with feedback\ntry:\n    data = json.loads(response)\nexcept json.JSONDecodeError as e:\n    print(f\"Error: Invalid JSON response: {e}\", file=sys.stderr)\n    sys.exit(1)\n```\n\n### 6. Security Patterns (Critical)\n\n**Secrets Management:**\n\n- No hardcoded secrets (API keys, passwords, tokens, database URLs)\n- Use `os.getenv()` with validation for missing values\n- Consider keyring or Infisical for production\n\n**Command Injection:**\n\n- Flag `subprocess.run(..., shell=True)` with user input\n- Prefer list form: `subprocess.run([\"cmd\", arg1, arg2])`\n- Validate all user-provided arguments\n\n**Path Traversal:**\n\n- Flag paths containing `..`\n- Use `Path.resolve()` and `.relative_to()` for validation\n- Validate paths are within expected directories\n\n**JSON Security:**\n\n- **NEVER** use `eval()` for JSON parsing - use `json.loads()`\n- Use `json.dumps()` for serialization (prevents injection)\n- Always specify `encoding=\"utf-8\"` for file operations\n\n**Network Security:**\n\n- HTTPS-only for external requests\n- Certificate verification enabled (`verify=True`)\n- Timeouts on all external calls\n\n### 7. Type Design Analysis (Medium)\n\n**Type Hints Quality (1-10):**\n\n- Are parameters typed?\n- Are return types specified?\n- Are complex types properly annotated (Optional, Union, TypedDict)?\n\n**Common Issues:**\n\n- `def foo(data):`  `def foo(data: dict[str, Any]) -> bool:`\n- Missing `Optional[]` for nullable parameters\n- Using `Any` when specific type is known\n\n**Suppression patterns:**\n\n- Check `# type: ignore` comments - are they justified?\n- Check `# noqa` comments - are they necessary?\n\n### 8. Code Quality (Medium)\n\n**Clarity over brevity:**\n\n- Avoid nested ternary operators\n- Avoid overly dense one-liners\n- Functions do one thing\n- Variable names are descriptive\n\n**Script complexity:**\n\n- Script exceeds 500 lines  Should be a uv project\n- 15+ dependencies  Should be a uv project\n- Multiple modules needed  Should be a uv project\n\n**Platform compatibility:**\n\n- Platform-specific imports without guards (e.g., `import pwd` on Windows)\n- Use `sys.platform` checks for platform-specific code\n\n### 9. External Operations (Important)\n\n**File operations:**\n\n- Always use `encoding=\"utf-8\"` for `open()`\n- Check file size before reading large files\n- Use context managers (`with` statements)\n\n**Subprocess calls:**\n\n- Include `timeout` parameter\n- Use `capture_output=True` for error handling\n- Check `returncode` or use `check=True`\n\n**HTTP requests:**\n\n- Include timeout: `httpx.get(url, timeout=10.0)`\n- Call `response.raise_for_status()`\n- Handle specific exceptions (HTTPStatusError, RequestError)\n\n## Output Format\n\n```markdown\n## Review: [filename]\n\n**Overall: [PASS/NEEDS WORK]** - [Brief assessment]\n\n### Critical Issues (confidence 90)\n\n| Issue | Location | Confidence | Fix |\n|-------|----------|------------|-----|\n| [Description] | `file.py:42` | 95 | [Specific fix] |\n\n### Important Issues (confidence 80-89)\n\n| Issue | Location | Confidence | Fix |\n|-------|----------|------------|-----|\n| [Description] | `file.py:15` | 85 | [Specific fix] |\n\n### Suggestions (confidence 70-79, optional)\n\n- [Suggestion with rationale]\n\n### Strengths\n\n- [What the script does well]\n\n## Recommended Action\n\n1. [First priority fix]\n2. [Second priority fix]\n```\n\n## Anti-Pattern Quick Reference\n\n| Anti-Pattern | Detection | Severity |\n|--------------|-----------|----------|\n| `[tool.uv.metadata]` | In script block | Critical |\n| Custom TOML fields | `author`, `version` at top level | Critical |\n| Wrong marker | `/// scripts`, `//`, missing closer | Critical |\n| Missing `#` prefix | TOML lines without `#` | Critical |\n| `eval()` for JSON | `eval(json_string)` | Critical |\n| Hardcoded secrets | API keys, passwords in code | Critical |\n| Bare `except:` | Empty or pass-only catch | Critical |\n| `shell=True` + user input | Command injection risk | Critical |\n| Path with `..` | Path traversal risk | Critical |\n| Missing shebang | No `#!/usr/bin/env` line | Important |\n| Unpinned deps | `\"httpx\"` vs `\"httpx>=0.27.0\"` | Important |\n| Heavy deps | tensorflow, torch in script | Important |\n| Broad `except Exception` | Without specific handling | Important |\n| Missing `requires-python` | Not in metadata block | Important |\n| No timeout | External calls without timeout | Important |\n| Missing `encoding` | `open()` without encoding | Important |\n| No type hints | Functions without annotations | Medium |\n| Over 500 lines | Script too large | Medium |\n| Platform-specific | `import pwd` without guard | Medium |\n\n## Review Principles\n\n1. **Be thorough but filter aggressively** - Report only high-confidence issues\n2. **Provide actionable feedback** - Every issue needs a specific fix\n3. **Include line numbers** - `file.py:42` format for all issues\n4. **Acknowledge good patterns** - Note what's done well\n5. **Consider maintenance burden** - Suggest pragmatic improvements\n\n## Tooling Recommendations\n\nAfter manual review, suggest running:\n\n```bash\n# Lint and format\nruff check --fix $ARGUMENTS\nruff format $ARGUMENTS\n\n# Type check\npyright $ARGUMENTS\n\n# Validate PEP 723 metadata\nuv run --script $ARGUMENTS --help  # Quick syntax check\n```"
              },
              {
                "name": "/analyze-spec",
                "description": null,
                "path": "plugins/homelab/omni-scale/commands/analyze-spec.md",
                "frontmatter": null,
                "content": "---\ndescription: Analyze a spec file and generate a deployment plan (flexible structure)\nallowed-tools: Bash(git:*), Bash(eza:*), Bash(test:*), Read, Write, Glob, Grep, AskUserQuestion\nargument-hint: [spec1.yaml] [spec2.yaml]\n---\n\n# Analyze Spec\n\nGenerate a deployment plan using soft guidelines with anchored outputs.\n\n## Variables\n\nPLAN_OUTPUT_DIRECTORY: `${CLAUDE_PROJECT_DIR}/.claude/`\n\n## Context\n\nUp to two specs may be given, only one spec is required to proceed.\n\nSpec files:\n@${CLAUDE_PLUGIN_ROOT}/specs/$1\n@${CLAUDE_PLUGIN_ROOT}/specs/$2\n\nPlan template: @${CLAUDE_PLUGIN_ROOT}/templates/plan-template.md\n\n## Instructions\n\n- Create an implementation plan that is:\n  - Concise enough to scan quickly\n  - Detailed enough to execute effectively\n  - Structured however best fits the content\n- Cover: problem, solution, constraints, phases, blockers, risks\n- **Required sections must appear exactly as specified:**\n\n```markdown\n## Next Action\n\n**Phase:** [N]\n**Task:** [Specific, concrete step]\n**Command:** [Actual command or file to create]\n\n## Critical Files\n\n| File | Why Critical |\n|------|--------------|\n| [path] | [reason] |\n```\n\n- Save the complete implementation plan to `PLAN_OUTPUT_DIRECTORY/plan.local.md`\n\n## Workflow\n\n0. **Readiness Check** (output before proceeding):\n   - What do I know from loaded context? (structure, patterns, constraints)\n   - What's unclear or missing for this spec?\n   - **Planned vs Actual:** Compare any planned counts/values against actual_distribution, exit_criteria, or live cluster state. Flag discrepancies as \"Spec needs reconciliation\"\n   - Key risks I can already identify\n   - **Confidence: X/5** - If < 4, use AskUserQuestion to clarify before proceeding\n\n1. **Understand**: Focus on the requirements provided and apply your assigned perspective throughout the design process\n\n2. **Explore Thoroughly**:\n   - Read any files provided to you in the initial prompt\n   - Find existing patterns and conventions using GLOB, GREP, and READ tools\n   - Understand the current architecture\n\n3. **Design**:\n   - Create implementation approach based on your perspective\n   - Determine phases, dependencies, execution order\n   - Consider trade-offs and architectural decisions\n\n4. **Detail the Plan**:\n   - Provide step-by-step implementation strategy\n   - Identify dependencies and sequencing\n   - Anticipate potential challenges\n   - Let structure adapt to contentdon't force sections that don't fit\n\n## Report\n\nAfter creating and saving the implementation plan, provide a concise report with the following format:\n\n```text\n Implementation Plan Created\n\nFile: PLAN_OUTPUT_DIRECTORY/plan.local.md\nTopic: <brief description of what the plan covers>\nKey Components:\n- <main component 1>\n- <main component 2>\n- <main component 3>\n```\n"
              },
              {
                "name": "/bootstrap-gitops",
                "description": "Bootstrap GitOps stack (ArgoCD, ESO, Longhorn) onto existing Talos cluster",
                "path": "plugins/homelab/omni-scale/commands/bootstrap-gitops.md",
                "frontmatter": {
                  "description": "Bootstrap GitOps stack (ArgoCD, ESO, Longhorn) onto existing Talos cluster",
                  "allowed-tools": "Bash(kubectl:create), mcp__plugin_omni-scale_kubernetes__*"
                },
                "content": "# GitOps Bootstrap\n\nDeploy the GitOps stack onto an existing talos-prod-01 cluster.\n\n**Note:** This is a WIP command that will be refined as bootstrap procedures evolve.\n\n## Prerequisites\n\nBefore starting:\n\n1. **Cluster operational** - Verify with `/omni-scale:status`\n2. **kubectl access** - Nodes showing Ready\n3. **Infisical credentials** - `$INFISICAL_CLIENT_ID` and `$INFISICAL_CLIENT_SECRET` set in environment\n\n## Instructions\n\n### Phase 1: Verify Cluster Ready\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"nodes\")\n```\n\nAll nodes should show `Ready`. If not, stop and troubleshoot.\n\n### Phase 2: Create Bootstrap Secret\n\nThe one manual secret for Infisical authentication:\n\n```bash\nkubectl create namespace external-secrets\n\nkubectl create secret generic universal-auth-credentials \\\n  --namespace external-secrets \\\n  --from-literal=clientId=\"$INFISICAL_CLIENT_ID\" \\\n  --from-literal=clientSecret=\"$INFISICAL_CLIENT_SECRET\"\n```\n\nIf command fails  Stop  Inform user env vars are not properly set.\n\n### Phase 3: Apply Bootstrap\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_apply(manifest: \"https://raw.githubusercontent.com/basher83/mothership-gitops/main/bootstrap/bootstrap.yaml\")\n```\n\nThis deploys the App of Apps which manages everything else.\n\n### Phase 4: Monitor Sync Waves\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"applications\", namespace: \"argocd\")\n```\n\nExpected wave order:\n\n- Wave 0-1: Networking (if managed)\n- Wave 2: Secrets (ESO + ClusterSecretStores)\n- Wave 3-4: Storage (Longhorn)\n- Wave 5: Platform services (Tailscale, Netdata)\n- Wave 99: ArgoCD HA (manual sync)\n\n### Phase 5: Verify Completion\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"applications\", namespace: \"argocd\")\n```\n\nAll apps should show `Synced` and `Healthy`.\n\n### Phase 6: ArgoCD HA Upgrade (Manual)\n\nAfter Longhorn is healthy:\n\n1. Access ArgoCD UI (via Tailscale)\n2. Find `argocd-ha` application\n3. Manually sync it\n\nThis is intentionally manual as a safety gate.\n\n## Troubleshooting\n\n**ESO not creating secrets:**\n\n- Check ClusterSecretStore status\n- Verify Infisical path matches store configuration\n\n**Longhorn volumes pending:**\n\n- Check node disk configuration\n- Patch nodes.longhorn.io with disk paths\n\n**Apps stuck OutOfSync:**\n\n- Check for ignoreDifferences on ESO-managed resources\n- ESO adds default fields that cause drift\n\n## Recovery\n\nIf bootstrap fails mid-way, delete and retry:\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_delete(manifest: \"https://raw.githubusercontent.com/basher83/mothership-gitops/main/bootstrap/bootstrap.yaml\")\n```\n\nFix the issue, then reapply Phase 3."
              },
              {
                "name": "/disaster-recovery",
                "description": "Execute disaster recovery drill - destroy and recreate cluster from specs",
                "path": "plugins/homelab/omni-scale/commands/disaster-recovery.md",
                "frontmatter": {
                  "description": "Execute disaster recovery drill - destroy and recreate cluster from specs",
                  "allowed-tools": "Bash(omnictl:*), Bash(ssh:*), Bash(kubectl:*), Bash(sleep:*), Read, AskUserQuestion, mcp__plugin_omni-scale_kubernetes__*"
                },
                "content": "# Disaster Recovery\n\nFull cluster destruction and recreation from declarative specs.\n\n**WARNING:** This destroys the entire cluster. Only run for DR drills or actual recovery.\n\n**NOTE:** Paths below reference user-specific locations. Consider setting `$OMNI_SCALE_ROOT` if needed.\n\n## Prerequisites\n\n- Access to Omni console (<https://omni.spaceships.work>)\n- omnictl authenticated\n- Infisical credentials available (`$INFISICAL_CLIENT_ID`, `$INFISICAL_CLIENT_SECRET`)\n- Backup of any stateful data (if applicable)\n- Provider connectivity verified:\n\n```bash\nomnictl get infraproviders\n```\n\n## Instructions\n\n### Phase 1: Confirm Intent\n\nUse AskUserQuestion to confirm:\n\n```text\nheader: \"DR Drill\"\nquestion: \"This will DESTROY talos-prod-01 and all workloads. Continue?\"\noptions:\n  - \"Yes, execute DR drill\"\n  - \"No, abort\"\n```\n\nIf user selects abort, stop immediately.\n\n### Phase 2: Capture Current State (Optional)\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"nodes\")\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"pv\")\n```\n\n```bash\nomnictl get machines --cluster talos-prod-01\n```\n\n### Phase 3: Destroy Cluster\n\n**WARNING:** No rollback after this phase. Cluster will be destroyed.\n\n```bash\nomnictl cluster template delete -f ~/dev/infra-as-code/Omni-Scale/clusters/talos-prod-01.yaml --destroy-disconnected-machines\n```\n\n**Poll loop:**\n\n```bash\n# Check status\nssh foxtrot \"pvesh get /cluster/resources --type vm --output-format json\" | jq -r '.[] | select(.name | startswith(\"talos\")) | .name'\n\n# REQUIRED - do not skip or reduce\nsleep 30\n```\n\nRepeat until no talos VMs remain. Max wait: 10 min.\n\nAfter 3 attempts at 30s intervals, INCREASE to 60s. Do not decrease below 30s.\n\nIf timeout exceeded, check failure scenarios below.\n\nUse AskUserQuestion to confirm destruction complete before proceeding.\n\n### Phase 4: Recreate Cluster\n\nApply cluster template:\n\n```bash\nomnictl cluster template sync -f ~/dev/infra-as-code/Omni-Scale/clusters/talos-prod-01.yaml\n```\n\n**Poll loop:**\n\n```bash\n# Check status\nomnictl get machines --cluster talos-prod-01\n\n# REQUIRED - do not skip or reduce\nsleep 30\n```\n\nRepeat until all nodes reach `running` state. Max wait: 20 min.\n\nAfter 3 attempts at 30s intervals, INCREASE to 60s. Do not decrease below 30s.\n\nIf timeout exceeded, check failure scenarios below.\n\n### Phase 4.5: Wait for API Availability\n\n**Poll loop:**\n\n```bash\n# Check status\nomnictl kubeconfig talos-prod-01 --merge\nkubectl get nodes\n\n# REQUIRED - do not skip or reduce\nsleep 30\n```\n\nRepeat until API responds. Max wait: 10 min.\n\nAfter 3 attempts at 30s intervals, INCREASE to 60s. Do not decrease below 30s.\n\nIf timeout exceeded, check failure scenarios below.\n\nUse AskUserQuestion to confirm cluster is ready before GitOps bootstrap.\n\n### Phase 5: Verify Cluster Health\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"nodes\")\n```\n\nAll nodes should show `Ready`.\n\n### Phase 6: Bootstrap GitOps\n\nFollow `/omni-scale:bootstrap-gitops` procedure:\n\n1. Create external-secrets namespace\n2. Create universal-auth-credentials secret\n3. Apply bootstrap.yaml\n\n**Poll loop:**\n\n```text\nmcp__plugin_omni-scale_kubernetes__kubectl_get(resourceType: \"applications\", namespace: \"argocd\")\n```\n\n```bash\n# REQUIRED - do not skip or reduce\nsleep 30\n```\n\nRepeat until all apps show Synced/Healthy. Max wait: 20 min.\n\nAfter 3 attempts at 30s intervals, INCREASE to 60s. Do not decrease below 30s.\n\nIf timeout exceeded, check failure scenarios below.\n\nManually sync ArgoCD HA after Longhorn is healthy.\n\n### Phase 7: Verify Recovery\n\nRun `/omni-scale:status` to confirm full recovery.\n\nCompare against pre-DR state if captured.\n\n## Expected Timeline\n\n| Phase | Duration |\n|-------|----------|\n| Cluster destruction | 2-5 min |\n| VM provisioning | 10-15 min |\n| Kubernetes ready | 5-10 min |\n| GitOps bootstrap | 10-15 min |\n| **Total** | **30-45 min** |\n\n## Failure Scenarios\n\n**VMs not destroying:**\n\n- Check Omni console for errors\n- Manually delete via Proxmox if stuck\n\n**VMs not provisioning:**\n\n- Check provider logs: `scripts/provider-ctl.py --logs 50`\n- Verify service account key not expired\n- Check storage pool availability\n\n**Provider wrong image tag:**\n\n- Must use `:local-fix` tag, not `:latest`\n- Hostname conflict bug in upstream image\n- Check compose.yml in proxmox-provider/\n\n**Nodes not joining:**\n\n- DNS issue - verify split-horizon resolves correctly\n- SideroLink issue - check provider L2 adjacency\n\n**GitOps apps failing:**\n\n- Check ESO ClusterSecretStore health\n- Verify Infisical credentials correct\n- Check namespace PSA labels\n\n**Longhorn volumes not attaching:**\n\n- May need to patch nodes.longhorn.io with disk paths\n- Check node disk configuration matches expectations\n\n## Post-Recovery Checklist\n\n- [ ] All nodes Ready\n- [ ] All ArgoCD apps Synced/Healthy\n- [ ] Longhorn volumes healthy\n- [ ] Tailscale Ingresses accessible\n- [ ] Netdata reporting metrics\n- [ ] ArgoCD HA running (if applicable)"
              },
              {
                "name": "/omni-prime",
                "description": "Load context for a new agent session by analyzing codebase structure and README",
                "path": "plugins/homelab/omni-scale/commands/omni-prime.md",
                "frontmatter": {
                  "allowed-tools": "Bash, Read",
                  "description": "Load context for a new agent session by analyzing codebase structure and README"
                },
                "content": "# Prime\n\nThis command loads essential context for a new agent session.\n\n## Instructions\n\n- Run `git ls-files` to understand the codebase structure and file organization\n- Read the README.md to understand the project purpose, setup instructions, and key information\n- Provide a concise overview of the project based on the gathered context\n\n## Context\n\n- Codebase structure git accessible: !`git ls-files`\n- Codebase structure all: !`eza . --tree`\n- Project README: @${CLAUDE_PROJECT_DIR}/README.md\n- Kernel context: @${CLAUDE_PLUGIN_ROOT}/references/kernel.md\n\n## Tool Usage Patterns\n\n### MCP Kubernetes Tools\n\nUse `mcp__plugin_omni-scale_kubernetes__*` for cluster operations.\n\n**Validation checks  gather this data:**\n\n- **ArgoCD:** Sync status + health status (per app). Flag any NOT Synced+Healthy.\n- **External Secrets:** ClusterSecretStore health, ExternalSecret sync status. Flag failures.\n- **Longhorn:** Volume state (attached/detached) + robustness (healthy/degraded). Flag unhealthy.\n\nUse MCP first. Fall back to kubectl CLI only if MCP output lacks required fields.\n\n### Helm via MCP\n\nLimited to: install, upgrade, uninstall. ArgoCD handles Helm for this stack  MCP Helm rarely needed.\n\n### omnictl\n\n**Cluster status (includes machine health):**\n```bash\nomnictl cluster status <cluster-name>\n```\n\n**List machines (if needed separately):**\n```bash\nomnictl get machines -l omni.sidero.dev/cluster=<cluster-name>\n```\n\nNote: `--cluster` flag does not exist. Use label selector `-l` instead.\n\n## Operational Pattern\n\nWhen an infrastructure operation fails on first attempt:\n1. Check for skill coverage before retrying with variations\n2. Skills encode operational knowledge  \"how do I access X\" is exactly what they're for\n3. Don't guess hostnames, paths, or commands  if it's not documented, ask\n\n## Cross-Repo Gotchas\n\n| Issue | Cause | Resolution |\n|-------|-------|------------|\n| ArgoCD drift on ESO resources | ESO adds default fields | Add `ignoreDifferences` in Application |\n| Pods Pending (privileged workload) | Missing PSA label | `pod-security.kubernetes.io/enforce: privileged` |\n| `mcp__plugin_omni-scale_kubernetes__kubectl_get` lacks CRD status | Basic output, not CRD fields | Use `mcp__plugin_omni-scale_kubernetes__kubectl_generic` with jsonpath or CLI fallback |"
              },
              {
                "name": "/status",
                "description": "Check Omni cluster and GitOps health status",
                "path": "plugins/homelab/omni-scale/commands/status.md",
                "frontmatter": {
                  "description": "Check Omni cluster and GitOps health status",
                  "allowed-tools": "Bash(omnictl:*), mcp__plugin_omni-scale_kubernetes__*"
                },
                "content": "# Cluster Status\n\nQuick health check for Omni-managed Talos cluster and GitOps stack.\n\n## Required Data\n\n### Omni Cluster\n\n- Cluster phase (Running/Provisioning/etc)\n- Node count (control plane vs workers)\n- Overall health status\n\n### Kubernetes Nodes\n\n- Ready status for each node\n- Role (control-plane vs worker)\n- Kubernetes version\n- Talos version\n- Node IPs\n\n### ArgoCD Applications\n\n- Sync status (per app)\n- Health status (per app)\n- **List any apps NOT Synced+Healthy**\n\n### External Secrets\n\n- ClusterSecretStore count and health\n- ExternalSecret count, sync status\n- **List any secrets failing to sync**\n\n### Storage (Longhorn)\n\n- Volume state (attached vs detached)\n- Volume robustness (healthy vs degraded)\n- **List any volumes not attached+healthy**\n\n## Output Format\n\n```text\n## Omni-Scale Status Report\n\n### Omni Cluster: talos-prod-01\n- Phase: [status]\n- Nodes: [X] control plane, [Y] workers\n- Health: [status]\n\n### Kubernetes\n- Nodes Ready: [X/Y]\n- Version: [version]\n- Talos: [version]\n\n[Node table with roles and IPs]\n\n### ArgoCD Applications\n- Total: [N]\n- Synced: [N], OutOfSync: [N]\n- Healthy: [N], Degraded: [N]\n\n[Table showing any non-healthy/non-synced apps]\n\n### External Secrets\n- ClusterSecretStores: [N] healthy\n- ExternalSecrets: [N] synced, [N] failed\n\n[List any failing secrets]\n\n### Storage (Longhorn)\n- Volumes: [N]\n- Healthy: [N]\n- Degraded: [N]\n\n[List any unhealthy volumes]\n\n### Issues Found\n[List problems or \"None\"]\n```"
              },
              {
                "name": "/analyze",
                "description": "Analyze Ansible code for improvements or suggest enhancements",
                "path": "plugins/infrastructure/ansible-workflows/commands/analyze.md",
                "frontmatter": {
                  "description": "Analyze Ansible code for improvements or suggest enhancements",
                  "argument-hint": "<path> [--mode review|enhance]",
                  "allowed-tools": [
                    "Read",
                    "Grep",
                    "Glob",
                    "Bash",
                    "WebSearch"
                  ],
                  "model": "sonnet"
                },
                "content": "Analyze Ansible code at `$1` in mode `$2` (default: review).\n\nLoad ALL ansible-* skills before analyzing.\n\n**Mode: review** (analyze existing code)\n\nCheck for:\n- **Idempotency:** changed_when on commands, check-before-create patterns\n- **Security:** no_log on secrets, no hardcoded credentials\n- **Structure:** FQCN, descriptive task names, role-prefixed variables\n- **Error handling:** Validation, graceful failures, clear messages\n- **Proxmox:** Native modules over CLI where possible\n\nOutput findings as structured report with file:line references and fixes.\n\n**Mode: enhance** (suggest forward-looking improvements)\n\nIdentify:\n- Automation gaps (manual processes to automate)\n- Best practice upgrades (newer patterns not adopted)\n- Integration opportunities (additional Proxmox automation)\n- Scalability improvements (role refactoring, variable organization)\n\nOutput prioritized enhancement roadmap.\n\nAfter analysis:\n- **review mode:** Hand findings to `ansible-reviewer` for formal report\n- **enhance mode:** Present roadmap for user prioritization\n\nReport: scope analyzed, mode used, key findings, recommendations."
              },
              {
                "name": "/create-playbook",
                "description": "Scaffold a state-based Ansible playbook with present/absent pattern",
                "path": "plugins/infrastructure/ansible-workflows/commands/create-playbook.md",
                "frontmatter": {
                  "description": "Scaffold a state-based Ansible playbook with present/absent pattern",
                  "argument-hint": "<playbook-name> [--hosts <target>]",
                  "allowed-tools": [
                    "Write",
                    "Read",
                    "Bash"
                  ],
                  "model": "sonnet"
                },
                "content": "Create a state-based Ansible playbook named `$1`.\n\nLoad the `ansible-playbook-design` and `ansible-fundamentals` skills first.\n\nIf no playbook name provided, ask for one.\n\n**Playbook location:** `ansible/playbooks/$1.yml` (add .yml if missing)\n\n**Target hosts:** Use `$2` if provided with --hosts, otherwise default to `all`\n\n**Create state-based playbook supporting present/absent:**\n\n```yaml\n---\n# Usage:\n#   Create: uv run ansible-playbook playbooks/$1.yml\n#   Remove: uv run ansible-playbook playbooks/$1.yml -e \"resource_state=absent\"\n\n- name: [Descriptive play name]\n  hosts: [target]\n  become: true\n  gather_facts: true\n\n  vars:\n    resource_state: present\n\n  tasks:\n    - name: Validate state variable\n      ansible.builtin.assert:\n        that:\n          - resource_state in ['present', 'absent']\n        fail_msg: \"resource_state must be 'present' or 'absent'\"\n\n    # Main tasks here\n```\n\n**After scaffolding, initialize the pipeline:**\n\n1. Create the `.claude/` directory if it doesn't exist:\n   ```bash\n   mkdir -p \"$CLAUDE_PROJECT_DIR/.claude\"\n   ```\n\n2. Ensure `.gitignore` contains ansible-workflows patterns (append if missing):\n```text\n# Ansible Workflows plugin state (auto-added)\n.claude/ansible-workflows.local.md\n.claude/ansible-workflows.*.bundle.md\n```\n\n3. Write state file `$CLAUDE_PROJECT_DIR/.claude/ansible-workflows.local.md`:\n```yaml\n---\nactive: true\npipeline_phase: generating\ntarget_path: ansible/playbooks/$1.yml\ncurrent_agent: ansible-generator\nstarted_at: \"[ISO timestamp]\"\nvalidation_attempts: 0\nlast_validation_passed: true\n---\n\n# Ansible Workflows Pipeline\n\nTarget: ansible/playbooks/$1.yml\nType: playbook\n```\n\n4. Write scaffolding bundle `$CLAUDE_PROJECT_DIR/.claude/ansible-workflows.scaffolding.bundle.md`:\n```yaml\n---\nsource_agent: create-playbook\ntarget_agent: ansible-generator\ntimestamp: \"[ISO timestamp]\"\ntarget_path: ansible/playbooks/$1.yml\ntarget_type: playbook\n---\n\n# Scaffolding Bundle\n\n## Target Path\nansible/playbooks/$1.yml\n\n## User Requirements\n[Capture any user-specified requirements, hosts, or context]\n\n## Files Created\n- ansible/playbooks/$1.yml (scaffolded)\n\n## Next Steps\nImplement the playbook tasks based on user requirements.\n```\n\n5. Hand off to `ansible-generator` agent with the playbook path\n\nReport: playbook path, state pattern implemented, pipeline initialized."
              },
              {
                "name": "/create-role",
                "description": "Scaffold a new Ansible role with standard directory structure",
                "path": "plugins/infrastructure/ansible-workflows/commands/create-role.md",
                "frontmatter": {
                  "description": "Scaffold a new Ansible role with standard directory structure",
                  "argument-hint": "<role-name>",
                  "allowed-tools": [
                    "Write",
                    "Bash",
                    "Read"
                  ],
                  "model": "sonnet"
                },
                "content": "Create an Ansible role named `$ARGUMENTS` following production patterns.\n\nLoad the `ansible-role-design` and `ansible-fundamentals` skills first.\n\nIf no role name provided, ask for one.\n\n**Role location:** `ansible/roles/$ARGUMENTS/`\n\n**Create this structure:**\n\n```text\nansible/roles/$ARGUMENTS/\n defaults/main.yml\n tasks/main.yml\n handlers/main.yml\n meta/main.yml\n README.md\n```\n\n**Variable prefix:** Convert role name to snake_case (e.g., `docker-host`  `docker_host_*`)\n\n**defaults/main.yml:** Role-prefixed variables with defaults\n**tasks/main.yml:** Main task router with validation\n**handlers/main.yml:** Service restart handlers (if applicable)\n**meta/main.yml:** Galaxy metadata with platform support\n**README.md:** Usage documentation\n\n**After scaffolding, initialize the pipeline:**\n\n1. Create the `.claude/` directory if it doesn't exist:\n   ```bash\n   mkdir -p \"$CLAUDE_PROJECT_DIR/.claude\"\n   ```\n\n2. Ensure `.gitignore` contains ansible-workflows patterns (append if missing):\n```text\n# Ansible Workflows plugin state (auto-added)\n.claude/ansible-workflows.local.md\n.claude/ansible-workflows.*.bundle.md\n```\n\n3. Write state file `$CLAUDE_PROJECT_DIR/.claude/ansible-workflows.local.md`:\n```yaml\n---\nactive: true\npipeline_phase: generating\ntarget_path: ansible/roles/$ARGUMENTS/\ncurrent_agent: ansible-generator\nstarted_at: \"[ISO timestamp]\"\nvalidation_attempts: 0\nlast_validation_passed: true\n---\n\n# Ansible Workflows Pipeline\n\nTarget: ansible/roles/$ARGUMENTS/\nType: role\n```\n\n4. Write scaffolding bundle `$CLAUDE_PROJECT_DIR/.claude/ansible-workflows.scaffolding.bundle.md`:\n```yaml\n---\nsource_agent: create-role\ntarget_agent: ansible-generator\ntimestamp: \"[ISO timestamp]\"\ntarget_path: ansible/roles/$ARGUMENTS/\ntarget_type: role\n---\n\n# Scaffolding Bundle\n\n## Target Path\nansible/roles/$ARGUMENTS/\n\n## User Requirements\n[Capture any user-specified requirements or context]\n\n## Files Created\n- ansible/roles/$ARGUMENTS/defaults/main.yml\n- ansible/roles/$ARGUMENTS/tasks/main.yml\n- ansible/roles/$ARGUMENTS/handlers/main.yml\n- ansible/roles/$ARGUMENTS/meta/main.yml\n- ansible/roles/$ARGUMENTS/README.md\n\n## Variable Prefix\n[snake_case version of role name]\n\n## Next Steps\nImplement the role tasks based on user requirements.\n```\n\n5. Hand off to `ansible-generator` agent with the role path\n\nReport: role path, files created, variable prefix, pipeline initialized."
              },
              {
                "name": "/lint",
                "description": "Run ansible-lint with guidance on fixing issues",
                "path": "plugins/infrastructure/ansible-workflows/commands/lint.md",
                "frontmatter": {
                  "description": "Run ansible-lint with guidance on fixing issues",
                  "argument-hint": [
                    "path"
                  ],
                  "allowed-tools": [
                    "Bash",
                    "Read"
                  ],
                  "model": "haiku"
                },
                "content": "Run ansible-lint on `$ARGUMENTS` (or `ansible/` if no path provided).\n\nExecute: `uv run ansible-lint $ARGUMENTS 2>&1 || true`\n\nParse results and categorize:\n- **Errors:** Must fix\n- **Warnings:** Should fix\n- **Info:** Optional\n\nFor each issue, explain:\n1. What the rule checks\n2. How to fix it\n\n**Common fixes:**\n\n| Rule | Fix |\n|------|-----|\n| fqcn[action-core] | Use `ansible.builtin.module` not `module` |\n| no-changed-when | Add `changed_when: false` to command tasks |\n| name[missing] | Add `name:` to all tasks |\n\nReport: total issues, by severity, top issues, fix suggestions."
              },
              {
                "name": "/hello",
                "description": "A hello world command",
                "path": "plugins/meta/claude-dev-sandbox/commands/hello.md",
                "frontmatter": {
                  "description": "A hello world command"
                },
                "content": "# Hello Command"
              },
              {
                "name": "/configure",
                "description": "Enable or disable hookify rules interactively",
                "path": "plugins/meta/hookify/commands/configure.md",
                "frontmatter": {
                  "description": "Enable or disable hookify rules interactively",
                  "allowed-tools": [
                    "Glob",
                    "Read",
                    "Edit",
                    "AskUserQuestion",
                    "Skill"
                  ]
                },
                "content": "# Configure Hookify Rules\n\n**Load hookify:writing-rules skill first** to understand rule format.\n\nEnable or disable existing hookify rules using an interactive interface.\n\n## Steps\n\n### 1. Find Existing Rules\n\nUse Glob tool to find all hookify rule files:\n\n```text\npattern: \".claude/hookify.*.local.md\"\n```\n\nIf no rules found, inform user:\n\n```text\nNo hookify rules configured yet. Use `/hookify` to create your first rule.\n```\n\n### 2. Read Current State\n\nFor each rule file:\n\n- Read the file\n- Extract `name` and `enabled` fields from frontmatter\n- Build list of rules with current state\n\n### 3. Ask User Which Rules to Toggle\n\nUse AskUserQuestion to let user select rules:\n\n```json\n{\n  \"questions\": [\n    {\n      \"question\": \"Which rules would you like to enable or disable?\",\n      \"header\": \"Configure\",\n      \"multiSelect\": true,\n      \"options\": [\n        {\n          \"label\": \"warn-dangerous-rm (currently enabled)\",\n          \"description\": \"Warns about rm -rf commands\"\n        },\n        {\n          \"label\": \"warn-console-log (currently disabled)\",\n          \"description\": \"Warns about console.log in code\"\n        },\n        {\n          \"label\": \"require-tests (currently enabled)\",\n          \"description\": \"Requires tests before stopping\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Option format:**\n\n- Label: `{rule-name} (currently {enabled|disabled})`\n- Description: Brief description from rule's message or pattern\n\n### 4. Parse User Selection\n\nFor each selected rule:\n\n- Determine current state from label (enabled/disabled)\n- Toggle state: enabled  disabled, disabled  enabled\n\n### 5. Update Rule Files\n\nFor each rule to toggle:\n\n- Use Read tool to read current content\n- Use Edit tool to change `enabled: true` to `enabled: false` (or vice versa)\n- Handle both with and without quotes\n\n**Edit pattern for enabling:**\n\n```text\nold_string: \"enabled: false\"\nnew_string: \"enabled: true\"\n```\n\n**Edit pattern for disabling:**\n\n```text\nold_string: \"enabled: true\"\nnew_string: \"enabled: false\"\n```\n\n### 6. Confirm Changes\n\nShow user what was changed:\n\n```text\n## Hookify Rules Updated\n\n**Enabled:**\n- warn-console-log\n\n**Disabled:**\n- warn-dangerous-rm\n\n**Unchanged:**\n- require-tests\n\nChanges apply immediately - no restart needed\n```\n\n## Important Notes\n\n- Changes take effect immediately on next tool use\n- You can also manually edit .claude/hookify.*.local.md files\n- To permanently remove a rule, delete its .local.md file\n- Use `/hookify:list` to see all configured rules\n\n## Edge Cases\n\n**No rules to configure:**\n\n- Show message about using `/hookify` to create rules first\n\n**User selects no rules:**\n\n- Inform that no changes were made\n\n**File read/write errors:**\n\n- Inform user of specific error\n- Suggest manual editing as fallback"
              },
              {
                "name": "/help",
                "description": "Get help with the hookify plugin",
                "path": "plugins/meta/hookify/commands/help.md",
                "frontmatter": {
                  "description": "Get help with the hookify plugin",
                  "allowed-tools": [
                    "Read"
                  ]
                },
                "content": "# Hookify Plugin Help\n\nExplain how the hookify plugin works and how to use it.\n\n## Overview\n\nThe hookify plugin makes it easy to create custom hooks that prevent unwanted behaviors.\nInstead of editing `hooks.json` files, users create simple markdown configuration files\nthat define patterns to watch for.\n\n## How It Works\n\n### 1. Hook System\n\nHookify installs generic hooks that run on these events:\n\n- **PreToolUse**: Before any tool executes (Bash, Edit, Write, etc.)\n- **PostToolUse**: After a tool executes\n- **Stop**: When Claude wants to stop working\n- **UserPromptSubmit**: When user submits a prompt\n\nThese hooks read configuration files from `.claude/hookify.*.local.md` and check if any\nrules match the current operation.\n\n### 2. Configuration Files\n\nUsers create rules in `.claude/hookify.{rule-name}.local.md` files:\n\n```markdown\n---\nname: warn-dangerous-rm\nenabled: true\nevent: bash\npattern: rm\\s+-rf\n---\n\n **Dangerous rm command detected!**\n\nThis command could delete important files. Please verify the path.\n```\n\n**Key fields:**\n\n- `name`: Unique identifier for the rule\n- `enabled`: true/false to activate/deactivate\n- `event`: bash, file, stop, prompt, or all\n- `pattern`: Regex pattern to match\n\nThe message body is what Claude sees when the rule triggers.\n\n### 3. Creating Rules\n\n#### Option A: Use /hookify command\n\n```text\n/hookify Don't use console.log in production files\n```\n\nThis analyzes your request and creates the appropriate rule file.\n\n#### Option B: Create manually\n\nCreate `.claude/hookify.my-rule.local.md` with the format above.\n\n#### Option C: Analyze conversation\n\n```text\n/hookify\n```\n\nWithout arguments, hookify analyzes recent conversation to find behaviors you want to prevent.\n\n## Available Commands\n\n- **`/hookify`** - Create hooks from conversation analysis or explicit instructions\n- **`/hookify:help`** - Show this help (what you're reading now)\n- **`/hookify:list`** - List all configured hooks\n- **`/hookify:configure`** - Enable/disable existing hooks interactively\n\n## Example Use Cases\n\n**Prevent dangerous commands:**\n\n```markdown\n---\nname: block-chmod-777\nenabled: true\nevent: bash\npattern: chmod\\s+777\n---\n\nDon't use chmod 777 - it's a security risk. Use specific permissions instead.\n```\n\n**Warn about debugging code:**\n\n```markdown\n---\nname: warn-console-log\nenabled: true\nevent: file\npattern: console\\.log\\(\n---\n\nConsole.log detected. Remember to remove debug logging before committing.\n```\n\n**Require tests before stopping:**\n\n```markdown\n---\nname: require-tests\nenabled: true\nevent: stop\npattern: .*\n---\n\nDid you run tests before finishing? Make sure `npm test` or equivalent was executed.\n```\n\n## Pattern Syntax\n\nUse Python regex syntax:\n\n- `\\s` - whitespace\n- `\\.` - literal dot\n- `|` - OR\n- `+` - one or more\n- `*` - zero or more\n- `\\d` - digit\n- `[abc]` - character class\n\n**Examples:**\n\n- `rm\\s+-rf` - matches \"rm -rf\"\n- `console\\.log\\(` - matches \"console.log(\"\n- `(eval|exec)\\(` - matches \"eval(\" or \"exec(\"\n- `\\.env$` - matches files ending in .env\n\n## Important Notes\n\n**No Restart Needed**: Hookify rules (`.local.md` files) take effect immediately on\nthe next tool use. The hookify hooks are already loaded and read your rules dynamically.\n\n**Block or Warn**: Rules can either `block` operations (prevent execution) or `warn`\n(show message but allow). Set `action: block` or `action: warn` in the rule's frontmatter.\n\n**Rule Files**: Keep rules in `.claude/hookify.*.local.md` - they should be git-ignored (add to .gitignore if needed).\n\n**Disable Rules**: Set `enabled: false` in frontmatter or delete the file.\n\n## Troubleshooting\n\n**Hook not triggering:**\n\n- Check rule file is in `.claude/` directory\n- Verify `enabled: true` in frontmatter\n- Confirm pattern is valid regex\n- Test pattern: `python3 -c \"import re; print(re.search('your_pattern', 'test_text'))\"`\n- Rules take effect immediately - no restart needed\n\n**Import errors:**\n\n- Check Python 3 is available: `python3 --version`\n- Verify hookify plugin is installed correctly\n\n**Pattern not matching:**\n\n- Test regex separately\n- Check for escaping issues (use unquoted patterns in YAML)\n- Try simpler pattern first, then refine\n\n## Getting Started\n\n1. Create your first rule:\n\n   ```text\n   /hookify Warn me when I try to use rm -rf\n   ```\n\n2. Try to trigger it:\n   - Ask Claude to run `rm -rf /tmp/test`\n   - You should see the warning\n\n3. Refine the rule by editing `.claude/hookify.warn-rm.local.md`\n\n4. Create more rules as you encounter unwanted behaviors\n\nFor more examples, check the `${CLAUDE_PLUGIN_ROOT}/examples/` directory."
              },
              {
                "name": "/hookify",
                "description": "Create hooks to prevent unwanted behaviors from conversation analysis or explicit instructions",
                "path": "plugins/meta/hookify/commands/hookify.md",
                "frontmatter": {
                  "description": "Create hooks to prevent unwanted behaviors from conversation analysis or explicit instructions",
                  "argument-hint": "Optional specific behavior to address",
                  "allowed-tools": [
                    "Read",
                    "Write",
                    "AskUserQuestion",
                    "Task",
                    "Grep",
                    "TodoWrite",
                    "Skill"
                  ]
                },
                "content": "# Hookify - Create Hooks from Unwanted Behaviors\n\n**FIRST: Load the hookify:writing-rules skill** using the Skill tool to understand rule file format and syntax.\n\nCreate hook rules to prevent problematic behaviors by analyzing the conversation or from explicit user instructions.\n\n## Your Task\n\nYou will help the user create hookify rules to prevent unwanted behaviors. Follow these steps:\n\n### Step 1: Gather Behavior Information\n\n**If $ARGUMENTS is provided:**\n\n- User has given specific instructions: `$ARGUMENTS`\n- Still analyze recent conversation (last 10-15 user messages) for additional context\n- Look for examples of the behavior happening\n\n**If $ARGUMENTS is empty:**\n\n- Launch the conversation-analyzer agent to find problematic behaviors\n- Agent will scan user prompts for frustration signals\n- Agent will return structured findings\n\n**To analyze conversation:**\nUse the Task tool to launch conversation-analyzer agent:\n\n```text\n{\n  \"subagent_type\": \"general-purpose\",\n  \"description\": \"Analyze conversation for unwanted behaviors\",\n  \"prompt\": \"You are analyzing a Claude Code conversation to find behaviors the user wants to prevent.\n\nRead user messages in the current conversation and identify:\n1. Explicit requests to avoid something (\\\"don't do X\\\", \\\"stop doing Y\\\")\n2. Corrections or reversions (user fixing Claude's actions)\n3. Frustrated reactions (\\\"why did you do X?\\\", \\\"I didn't ask for that\\\")\n4. Repeated issues (same problem multiple times)\n\nFor each issue found, extract:\n- What tool was used (Bash, Edit, Write, etc.)\n- Specific pattern or command\n- Why it was problematic\n- User's stated reason\n\nReturn findings as a structured list with:\n- category: Type of issue\n- tool: Which tool was involved\n- pattern: Regex or literal pattern to match\n- context: What happened\n- severity: high/medium/low\n\nFocus on the most recent issues (last 20-30 messages). Don't go back further unless explicitly asked.\"\n}\n```\n\n### Step 2: Present Findings to User\n\nAfter gathering behaviors (from arguments or agent), present to user using AskUserQuestion:\n\n**Question 1: Which behaviors to hookify?**\n\n- Header: \"Create Rules\"\n- multiSelect: true\n- Options: List each detected behavior (max 4)\n  - Label: Short description (e.g., \"Block rm -rf\")\n  - Description: Why it's problematic\n\n**Question 2: For each selected behavior, ask about action:**\n\n- \"Should this block the operation or just warn?\"\n- Options:\n  - \"Just warn\" (action: warn - shows message but allows)\n  - \"Block operation\" (action: block - prevents execution)\n\n**Question 3: Ask for example patterns:**\n\n- \"What patterns should trigger this rule?\"\n- Show detected patterns\n- Allow user to refine or add more\n\n### Step 3: Generate Rule Files\n\nFor each confirmed behavior, create a `.claude/hookify.{rule-name}.local.md` file:\n\n**Rule naming convention:**\n\n- Use kebab-case\n- Be descriptive: `block-dangerous-rm`, `warn-console-log`, `require-tests-before-stop`\n- Start with action verb: block, warn, prevent, require\n\n**File format:**\n\n```markdown\n---\nname: {rule-name}\nenabled: true\nevent: {bash|file|stop|prompt|all}\npattern: {regex pattern}\naction: {warn|block}\n---\n\n{Message to show Claude when rule triggers}\n```\n\n**Action values:**\n\n- `warn`: Show message but allow operation (default)\n- `block`: Prevent operation or stop session\n\n**For more complex rules (multiple conditions):**\n\n```markdown\n---\nname: {rule-name}\nenabled: true\nevent: file\nconditions:\n  - field: file_path\n    operator: regex_match\n    pattern: \\.env$\n  - field: new_text\n    operator: contains\n    pattern: API_KEY\n---\n\n{Warning message}\n```\n\n### Step 4: Create Files and Confirm\n\n**IMPORTANT**: Rule files must be created in the current working directory's `.claude/`\nfolder, NOT the plugin directory.\n\nUse the current working directory (where Claude Code was started) as the base path.\n\n1. Check if `.claude/` directory exists in current working directory\n   - If not, create it first with: `mkdir -p .claude`\n\n2. Use Write tool to create each `.claude/hookify.{name}.local.md` file\n   - Use relative path from current working directory: `.claude/hookify.{name}.local.md`\n   - The path should resolve to the project's .claude directory, not the plugin's\n\n3. Show user what was created:\n\n   ```text\n   Created 3 hookify rules:\n   - .claude/hookify.dangerous-rm.local.md\n   - .claude/hookify.console-log.local.md\n   - .claude/hookify.sensitive-files.local.md\n\n   These rules will trigger on:\n   - dangerous-rm: Bash commands matching \"rm -rf\"\n   - console-log: Edits adding console.log statements\n   - sensitive-files: Edits to .env or credentials files\n   ```\n\n4. Verify files were created in the correct location by listing them\n\n5. Inform user: **\"Rules are active immediately - no restart needed!\"**\n\n   The hookify hooks are already loaded and will read your new rules on the next tool use.\n\n## Event Types Reference\n\n- **bash**: Matches Bash tool commands\n- **file**: Matches Edit, Write, MultiEdit tools\n- **stop**: Matches when agent wants to stop (use for completion checks)\n- **prompt**: Matches when user submits prompts\n- **all**: Matches all events\n\n## Pattern Writing Tips\n\n**Bash patterns:**\n\n- Match dangerous commands: `rm\\s+-rf|chmod\\s+777|dd\\s+if=`\n- Match specific tools: `npm\\s+install\\s+|pip\\s+install`\n\n**File patterns:**\n\n- Match code patterns: `console\\.log\\(|eval\\(|innerHTML\\s*=`\n- Match file paths: `\\.env$|\\.git/|node_modules/`\n\n**Stop patterns:**\n\n- Check for missing steps: (check transcript or completion criteria)\n\n## Example Workflow\n\n**User says**: \"/hookify Don't use rm -rf without asking me first\"\n\n**Your response**:\n\n1. Analyze: User wants to prevent rm -rf commands\n2. Ask: \"Should I block this command or just warn you?\"\n3. User selects: \"Just warn\"\n4. Create `.claude/hookify.dangerous-rm.local.md`:\n\n   ```markdown\n   ---\n   name: warn-dangerous-rm\n   enabled: true\n   event: bash\n   pattern: rm\\s+-rf\n   ---\n\n    **Dangerous rm command detected**\n\n   You requested to be warned before using rm -rf.\n   Please verify the path is correct.\n   ```\n\n5. Confirm: \"Created hookify rule. It's active immediately - try triggering it!\"\n\n## Important Notes\n\n- **No restart needed**: Rules take effect immediately on the next tool use\n- **File location**: Create files in project's `.claude/` directory (current working\n  directory), NOT the plugin's .claude/\n- **Regex syntax**: Use Python regex syntax (raw strings, no need to escape in YAML)\n- **Action types**: Rules can `warn` (default) or `block` operations\n- **Testing**: Test rules immediately after creating them\n\n## Troubleshooting\n\n**If rule file creation fails:**\n\n1. Check current working directory with pwd\n2. Ensure `.claude/` directory exists (create with mkdir if needed)\n3. Use absolute path if needed: `{cwd}/.claude/hookify.{name}.local.md`\n4. Verify file was created with Glob or ls\n\n**If rule doesn't trigger after creation:**\n\n1. Verify file is in project `.claude/` not plugin `.claude/`\n2. Check file with Read tool to ensure pattern is correct\n3. Test pattern with: `python3 -c \"import re; print(re.search(r'pattern', 'test text'))\"`\n4. Verify `enabled: true` in frontmatter\n5. Remember: Rules work immediately, no restart needed\n\n**If blocking seems too strict:**\n\n1. Change `action: block` to `action: warn` in the rule file\n2. Or adjust the pattern to be more specific\n3. Changes take effect on next tool use\n\nUse TodoWrite to track your progress through the steps."
              },
              {
                "name": "/list",
                "description": "List all configured hookify rules",
                "path": "plugins/meta/hookify/commands/list.md",
                "frontmatter": {
                  "description": "List all configured hookify rules",
                  "allowed-tools": [
                    "Glob",
                    "Read",
                    "Skill"
                  ]
                },
                "content": "# List Hookify Rules\n\n**Load hookify:writing-rules skill first** to understand rule format.\n\nShow all configured hookify rules in the project.\n\n## Steps\n\n1. Use Glob tool to find all hookify rule files:\n\n   ```text\n   pattern: \".claude/hookify.*.local.md\"\n   ```\n\n2. For each file found:\n   - Use Read tool to read the file\n   - Extract frontmatter fields: name, enabled, event, pattern\n   - Extract message preview (first 100 chars)\n\n3. Present results in a table:\n\n```text\n## Configured Hookify Rules\n\n| Name | Enabled | Event | Pattern | File |\n|------|---------|-------|---------|------|\n| warn-dangerous-rm |  Yes | bash | rm\\s+-rf | hookify.dangerous-rm.local.md |\n| warn-console-log |  Yes | file | console\\.log\\( | hookify.console-log.local.md |\n| check-tests |  No | stop | .* | hookify.require-tests.local.md |\n\n**Total**: 3 rules (2 enabled, 1 disabled)\n```\n\n1. For each rule, show a brief preview:\n\n```text\n### warn-dangerous-rm\n**Event**: bash\n**Pattern**: `rm\\s+-rf`\n**Message**: \" **Dangerous rm command detected!** This command could delete...\"\n\n**Status**:  Active\n**File**: .claude/hookify.dangerous-rm.local.md\n```\n\n1. Add helpful footer:\n\n```text\n---\n\nTo modify a rule: Edit the .local.md file directly\nTo disable a rule: Set `enabled: false` in frontmatter\nTo enable a rule: Set `enabled: true` in frontmatter\nTo delete a rule: Remove the .local.md file\nTo create a rule: Use `/hookify` command\n\n**Remember**: Changes take effect immediately - no restart needed\n```\n\n## If No Rules Found\n\nIf no hookify rules exist:\n\n```text\n## No Hookify Rules Configured\n\nYou haven't created any hookify rules yet.\n\nTo get started:\n1. Use `/hookify` to analyze conversation and create rules\n2. Or manually create `.claude/hookify.my-rule.local.md` files\n3. See `/hookify:help` for documentation\n\nExample:\n```\n\n/hookify Warn me when I use console.log\n\n```text\n\nCheck `${CLAUDE_PLUGIN_ROOT}/examples/` for example rule files.\n```"
              },
              {
                "name": "/prime",
                "description": "Load context for a new agent session by analyzing codebase structure and README",
                "path": "plugins/meta/meta-claude/commands/prime.md",
                "frontmatter": {
                  "description": "Load context for a new agent session by analyzing codebase structure and README",
                  "argument-hint": "[path|--deep|--minimal]",
                  "allowed-tools": "Bash, Read"
                },
                "content": "# Prime\n\nLoad essential context for a new agent session: $ARGUMENTS\n\n## Arguments\n\n- `<path>` - Focus on a specific directory or file pattern\n- `--deep` - Include detailed file contents from key areas\n- `--minimal` - Only show structure, skip README/CHANGELOG\n- (none) - Default full context load\n\n## Context\n\n### Codebase Structure\n\nGit-tracked files: !`git ls-files $ARGUMENTS 2>/dev/null | head -100 || git ls-files | head -100`\n\nDirectory tree: !`eza . --tree --level=3 --git-ignore 2>/dev/null || find . -type f -name \"*.md\" -o -name \"*.py\" -o -name \"*.ts\" -o -name \"*.json\" | head -50`\n\n### Project Documentation\n\n@README.md\n@CHANGELOG.md\n\n## Instructions\n\n1. Analyze the codebase structure to understand file organization\n2. Read README.md to understand project purpose and setup\n3. Note key directories and their purposes\n4. Provide a concise overview including:\n   - Project purpose\n   - Key directories/components\n   - Important patterns or conventions\n   - Next steps if applicable\n\nIf `$ARGUMENTS` contains a path, focus analysis on that area.\nIf `--minimal`, skip documentation reading.\nIf `--deep`, also examine key configuration files."
              },
              {
                "name": "/consider",
                "description": "Add, update, or review plugin-dev design considerations",
                "path": "plugins/meta/plugin-dev/commands/consider.md",
                "frontmatter": {
                  "description": "Add, update, or review plugin-dev design considerations",
                  "allowed-tools": [
                    "Read",
                    "Edit",
                    "Write",
                    "AskUserQuestion"
                  ]
                },
                "content": "# Plugin-Dev Considerations Manager\n\nManage design considerations, decisions, and ideas in `.claude/plugin-dev-considerations.local.md`.\n\n---\n\n## Workflow\n\n1. Check if `.claude/plugin-dev-considerations.local.md` exists\n2. If not, create it with this structure:\n\n```markdown\n---\ntype: design-considerations\nplugin: plugin-dev\nlast_updated: [today]\n---\n\n# Plugin-Dev Design Considerations\n\nTracking decisions, future ideas, and observations that emerge during development.\n\n## Open Considerations\n\n(none yet)\n\n## Decisions Made\n\n(none yet)\n\n## Future Ideas\n\n(none yet)\n```\n\n3. Read and show current state:\n   - Count of open CON entries\n   - Count of DEC entries\n   - Count of IDEA entries\n\n4. Ask user what to do:\n   - Add consideration (CON)\n   - Add decision (DEC)\n   - Add idea (IDEA)\n   - Update existing entry\n   - Just reviewing (done)\n\n5. Based on selection, gather needed info and add/update entry\n\n6. Update `last_updated` in frontmatter\n\n---\n\n## Entry Formats\n\n**CON (Consideration):**\n```markdown\n### CON-XXX: [title]\n\n**Raised:** [date]\n**Context:** [where this came up]\n**Status:** Under consideration\n\n**Observation:**\n[what was noticed]\n\n**Next action:** [what to do next]\n```\n\n**DEC (Decision):**\n```markdown\n### DEC-XXX: [title]\n\n**Date:** [date]\n**Context:** [what prompted this]\n\n**Decision:** [what was decided]\n\n**Rationale:** [why]\n```\n\n**IDEA (Future Idea):**\n```markdown\n### IDEA-XXX: [title]\n\n[brief description]\n```\n\n---\n\n## Numbering\n\nFind highest existing number in each category and increment by 1."
              },
              {
                "name": "/create-plugin",
                "description": "Guided end-to-end plugin creation workflow with component design, implementation, and validation",
                "path": "plugins/meta/plugin-dev/commands/create-plugin.md",
                "frontmatter": {
                  "description": "Guided end-to-end plugin creation workflow with component design, implementation, and validation",
                  "argument-hint": "Optional plugin description"
                },
                "content": "# Plugin Creation Workflow\n\nGuide the user through creating a complete, high-quality Claude Code plugin from initial concept to tested implementation. Follow a systematic approach: understand requirements, design components, clarify details, implement following best practices, validate, and test.\n\n## Core Principles\n\n- **Ask clarifying questions**: Identify all ambiguities about plugin purpose, triggering, scope, and components. Ask specific, concrete questions rather than making assumptions. Wait for user answers before proceeding with implementation.\n- **Load relevant skills**: Use the Skill tool to load plugin-dev skills when needed (plugin-structure, hook-development, agent-development, etc.)\n- **Use specialized agents**: Leverage agent-creator, plugin-validator, and skill-reviewer agents for AI-assisted development\n- **Follow best practices**: Apply patterns from plugin-dev's own implementation\n- **Progressive disclosure**: Create lean skills with references/examples\n- **Use TodoWrite**: Track all progress throughout all phases\n\n**Initial request:** $ARGUMENTS\n\n---\n\n## Phase 1: Discovery\n\n**Goal**: Understand what plugin needs to be built and what problem it solves\n\n**Actions**:\n\n1. Create todo list with all 7 phases\n2. If plugin purpose is clear from arguments:\n   - Summarize understanding\n   - Identify plugin type (integration, workflow, analysis, toolkit, etc.)\n3. If plugin purpose is unclear, ask user:\n   - What problem does this plugin solve?\n   - Who will use it and when?\n   - What should it do?\n   - Any similar plugins to reference?\n4. Summarize understanding and confirm with user before proceeding\n\n**Output**: Clear statement of plugin purpose and target users\n\n---\n\n## Phase 2: Component Planning\n\n**Goal**: Determine what plugin components are needed\n\n**MUST load plugin-structure skill** using Skill tool before this phase.\n\n**Actions**:\n\n1. Load plugin-structure skill to understand component types\n2. Analyze plugin requirements and determine needed components:\n   - **Skills**: Does it need specialized knowledge? (hooks API, MCP patterns, etc.)\n   - **Commands**: User-initiated actions? (deploy, configure, analyze)\n   - **Agents**: Autonomous tasks? (validation, generation, analysis)\n   - **Hooks**: Event-driven automation? (validation, notifications)\n   - **MCP**: External service integration? (databases, APIs)\n   - **Settings**: User configuration? (.local.md files)\n3. For each component type needed, identify:\n   - How many of each type\n   - What each one does\n   - Rough triggering/usage patterns\n4. Present component plan to user as table:\n\n   ```text\n   | Component Type | Count | Purpose |\n   |----------------|-------|---------|\n   | Skills         | 2     | Hook patterns, MCP usage |\n   | Commands       | 3     | Deploy, configure, validate |\n   | Agents         | 1     | Autonomous validation |\n   | Hooks          | 0     | Not needed |\n   | MCP            | 1     | Database integration |\n   ```\n\n5. Get user confirmation or adjustments\n\n**Output**: Confirmed list of components to create\n\n---\n\n## Phase 3: Detailed Design & Clarifying Questions\n\n**Goal**: Specify each component in detail and resolve all ambiguities\n\n**CRITICAL**: This is one of the most important phases. DO NOT SKIP.\n\n**Actions**:\n\n1. For each component in the plan, identify underspecified aspects:\n   - **Skills**: What triggers them? What knowledge do they provide? How detailed?\n   - **Commands**: What arguments? What tools? Interactive or automated?\n   - **Agents**: When to trigger (proactive/reactive)? What tools? Output format?\n   - **Hooks**: Which events? Prompt or command based? Validation criteria?\n   - **MCP**: What server type? Authentication? Which tools?\n   - **Settings**: What fields? Required vs optional? Defaults?\n\n2. **Present all questions to user in organized sections** (one section per component type)\n\n3. **Wait for answers before proceeding to implementation**\n\n4. If user says \"whatever you think is best\", provide specific recommendations and get explicit confirmation\n\n**Example questions for a skill**:\n\n- What specific user queries should trigger this skill?\n- Should it include utility scripts? What functionality?\n- How detailed should the core SKILL.md be vs references/?\n- Any real-world examples to include?\n\n**Example questions for an agent**:\n\n- Should this agent trigger proactively after certain actions, or only when explicitly requested?\n- What tools does it need (Read, Write, Bash, etc.)?\n- What should the output format be?\n- Any specific quality standards to enforce?\n\n**Output**: Detailed specification for each component\n\n---\n\n## Phase 4: Plugin Structure Creation\n\n**Goal**: Create plugin directory structure and manifest\n\n**Actions**:\n\n1. Determine plugin name (kebab-case, descriptive)\n2. Choose plugin location:\n   - Ask user: \"Where should I create the plugin?\"\n   - Offer options: current directory, ../new-plugin-name, custom path\n3. Create directory structure using bash:\n\n   ```bash\n   mkdir -p plugin-name/.claude-plugin\n   mkdir -p plugin-name/skills     # if needed\n   mkdir -p plugin-name/commands   # if needed\n   mkdir -p plugin-name/agents     # if needed\n   mkdir -p plugin-name/hooks      # if needed\n   ```\n\n4. Create plugin.json manifest using Write tool:\n\n   ```json\n   {\n     \"name\": \"plugin-name\",\n     \"version\": \"0.1.0\",\n     \"description\": \"[brief description]\",\n     \"author\": {\n       \"name\": \"[author from user or default]\",\n       \"email\": \"[email or default]\"\n     }\n   }\n   ```\n\n5. Create README.md template\n6. Create .gitignore if needed (for .claude/*.local.md, etc.)\n7. Initialize git repo if creating new directory\n\n**Output**: Plugin directory structure created and ready for components\n\n---\n\n## Phase 5: Component Implementation\n\n**Goal**: Create each component following best practices\n\n**LOAD RELEVANT SKILLS** before implementing each component type:\n\n- Skills: Load skill-development skill\n- Commands: Load command-development skill\n- Agents: Load agent-development skill\n- Hooks: Load hook-development skill\n- MCP: Load mcp-integration skill\n- Settings: Load plugin-settings skill\n\n**Actions for each component**:\n\n### For Skills\n\n1. Load skill-development skill using Skill tool\n2. For each skill:\n   - Ask user for concrete usage examples (or use from Phase 3)\n   - Plan resources (scripts/, references/, examples/)\n   - Create skill directory structure\n   - Write SKILL.md with:\n     - Third-person description with specific trigger phrases\n     - Lean body (1,500-2,000 words) in imperative form\n     - References to supporting files\n   - Create reference files for detailed content\n   - Create example files for working code\n   - Create utility scripts if needed\n3. Use skill-reviewer agent to validate each skill\n\n### For Commands\n\n1. Load command-development skill using Skill tool\n2. For each command:\n   - Write command markdown with frontmatter\n   - Include clear description and argument-hint\n   - Specify allowed-tools (minimal necessary)\n   - Write instructions FOR Claude (not TO user)\n   - Provide usage examples and tips\n   - Reference relevant skills if applicable\n\n### For Agents\n\n1. Load agent-development skill using Skill tool\n2. For each agent, use agent-creator agent:\n   - Provide description of what agent should do\n   - Agent-creator generates: identifier, whenToUse with examples, systemPrompt\n   - Create agent markdown file with frontmatter and system prompt\n   - Add appropriate model, color, and tools\n   - Validate with validate-agent.sh script\n\n### For Hooks\n\n1. Load hook-development skill using Skill tool\n2. For each hook:\n   - Create hooks/hooks.json with hook configuration\n   - Prefer prompt-based hooks for complex logic\n   - Use ${CLAUDE_PLUGIN_ROOT} for portability\n   - Create hook scripts if needed (in examples/ not scripts/)\n   - Test with validate-hook-schema.sh and test-hook.sh utilities\n\n### For MCP\n\n1. Load mcp-integration skill using Skill tool\n2. Create .mcp.json configuration with:\n   - Server type (stdio for local, SSE for hosted)\n   - Command and args (with ${CLAUDE_PLUGIN_ROOT})\n   - extensionToLanguage mapping if LSP\n   - Environment variables as needed\n3. Document required env vars in README\n4. Provide setup instructions\n\n### For Settings\n\n1. Load plugin-settings skill using Skill tool\n2. Create settings template in README\n3. Create example .claude/plugin-name.local.md file (as documentation)\n4. Implement settings reading in hooks/commands as needed\n5. Add to .gitignore: `.claude/*.local.md`\n\n**Progress tracking**: Update todos as each component is completed\n\n**Output**: All plugin components implemented\n\n---\n\n## Phase 6: Validation & Quality Check\n\n**Goal**: Ensure plugin meets quality standards and works correctly\n\n**Actions**:\n\n1. **Run plugin-validator agent**:\n   - Use plugin-validator agent to comprehensively validate plugin\n   - Check: manifest, structure, naming, components, security\n   - Review validation report\n\n2. **Fix critical issues**:\n   - Address any critical errors from validation\n   - Fix any warnings that indicate real problems\n\n3. **Review with skill-reviewer** (if plugin has skills):\n   - For each skill, use skill-reviewer agent\n   - Check description quality, progressive disclosure, writing style\n   - Apply recommendations\n\n4. **Test agent triggering** (if plugin has agents):\n   - For each agent, verify <example> blocks are clear\n   - Check triggering conditions are specific\n   - Run validate-agent.sh on agent files\n\n5. **Test hook configuration** (if plugin has hooks):\n   - Run validate-hook-schema.sh on hooks/hooks.json\n   - Test hook scripts with test-hook.sh\n   - Verify ${CLAUDE_PLUGIN_ROOT} usage\n\n6. **Present findings**:\n   - Summary of validation results\n   - Any remaining issues\n   - Overall quality assessment\n\n7. **Ask user**: \"Validation complete. Issues found: [count critical], [count warnings]. Would you like me to fix them now, or proceed to testing?\"\n\n**Output**: Plugin validated and ready for testing\n\n---\n\n## Phase 7: Testing & Verification\n\n**Goal**: Test that plugin works correctly in Claude Code\n\n**Actions**:\n\n1. **Installation instructions**:\n   - Show user how to test locally:\n     ```bash\n     cc --plugin-dir /path/to/plugin-name\n     ```\n   - Or copy to `.claude-plugin/` for project testing\n\n2. **Verification checklist** for user to perform:\n   - [ ] Skills load when triggered (ask questions with trigger phrases)\n   - [ ] Commands appear in `/help` and execute correctly\n   - [ ] Agents trigger on appropriate scenarios\n   - [ ] Hooks activate on events (if applicable)\n   - [ ] MCP servers connect (if applicable)\n   - [ ] Settings files work (if applicable)\n\n3. **Testing recommendations**:\n   - For skills: Ask questions using trigger phrases from descriptions\n   - For commands: Run `/plugin-name:command-name` with various arguments\n   - For agents: Create scenarios matching agent examples\n   - For hooks: Use `claude --debug` to see hook execution\n   - For MCP: Use `/mcp` to verify servers and tools\n\n4. **Ask user**: \"I've prepared the plugin for testing. Would you like me to guide you through testing each component, or do you want to test it yourself?\"\n\n5. **If user wants guidance**, walk through testing each component with specific test cases\n\n**Output**: Plugin tested and verified working\n\n---\n\n## Phase 8: Documentation & Next Steps\n\n**Goal**: Ensure plugin is well-documented and ready for distribution\n\n**Actions**:\n\n1. **Verify README completeness**:\n   - Check README has: overview, features, installation, prerequisites, usage\n   - For MCP plugins: Document required environment variables\n   - For hook plugins: Explain hook activation\n   - For settings: Provide configuration templates\n\n2. **Add marketplace entry** (if publishing):\n   - Show user how to add to marketplace.json\n   - Help draft marketplace description\n   - Suggest category and tags\n\n3. **Create summary**:\n   - Mark all todos complete\n   - List what was created:\n     - Plugin name and purpose\n     - Components created (X skills, Y commands, Z agents, etc.)\n     - Key files and their purposes\n     - Total file count and structure\n   - Next steps:\n     - Testing recommendations\n     - Publishing to marketplace (if desired)\n     - Iteration based on usage\n\n4. **Suggest improvements** (optional):\n   - Additional components that could enhance plugin\n   - Integration opportunities\n   - Testing strategies\n\n**Output**: Complete, documented plugin ready for use or publication\n\n---\n\n## Important Notes\n\n### Throughout All Phases\n\n- **Use TodoWrite** to track progress at every phase\n- **Load skills with Skill tool** when working on specific component types\n- **Use specialized agents** (agent-creator, plugin-validator, skill-reviewer)\n- **Ask for user confirmation** at key decision points\n- **Follow plugin-dev's own patterns** as reference examples\n- **Apply best practices**:\n  - Third-person descriptions for skills\n  - Imperative form in skill bodies\n  - Commands written FOR Claude\n  - Strong trigger phrases\n  - ${CLAUDE_PLUGIN_ROOT} for portability\n  - Progressive disclosure\n  - Security-first (HTTPS, no hardcoded credentials)\n\n### Key Decision Points (Wait for User)\n\n1. After Phase 1: Confirm plugin purpose\n2. After Phase 2: Approve component plan\n3. After Phase 3: Proceed to implementation\n4. After Phase 6: Fix issues or proceed\n5. After Phase 7: Continue to documentation\n\n### Skills to Load by Phase\n\n- **Phase 2**: plugin-structure\n- **Phase 5**: skill-development, command-development, agent-development, hook-development, mcp-integration, plugin-settings (as needed)\n- **Phase 6**: (agents will use skills automatically)\n\n### Quality Standards\n\nEvery component must meet these standards:\n\n-  Follows plugin-dev's proven patterns\n-  Uses correct naming conventions\n-  Has strong trigger conditions (skills/agents)\n-  Includes working examples\n-  Properly documented\n-  Validated with utilities\n-  Tested in Claude Code\n\n---\n\n## Example Workflow\n\n### User Request\n\n\"Create a plugin for managing database migrations\"\n\n### Phase 1: Discovery\n\n- Understand: Migration management, database schema versioning\n- Confirm: User wants to create, run, rollback migrations\n\n### Phase 2: Component Planning\n\n- Skills: 1 (migration best practices)\n- Commands: 3 (create-migration, run-migrations, rollback)\n- Agents: 1 (migration-validator)\n- MCP: 1 (database connection)\n\n### Phase 3: Clarifying Questions\n\n- Which databases? (PostgreSQL, MySQL, etc.)\n- Migration file format? (SQL, code-based?)\n- Should agent validate before applying?\n- What MCP tools needed? (query, execute, schema)\n\n### Phase 4-8: Implementation, Validation, Testing, Documentation\n\n---\n\n**Begin with Phase 1: Discovery**"
              },
              {
                "name": "/plugin-review",
                "description": "Comprehensive plugin review workflow with state tracking, best practice validation, and improvement recommendations",
                "path": "plugins/meta/plugin-dev/commands/plugin-review.md",
                "frontmatter": {
                  "description": "Comprehensive plugin review workflow with state tracking, best practice validation, and improvement recommendations",
                  "argument-hint": "<plugin-path>",
                  "allowed-tools": [
                    "Read",
                    "Write",
                    "Edit",
                    "Glob",
                    "Grep",
                    "Bash",
                    "Skill",
                    "Task",
                    "TodoWrite",
                    "AskUserQuestion"
                  ]
                },
                "content": "# Plugin Review Workflow\n\nSystematically review a Claude Code plugin against best practices from plugin-dev skills. Creates a state file to track progress and enables resumable reviews.\n\n**Target plugin:** $ARGUMENTS\n\n---\n\n## Core Principles\n\n- **State file tracking**: Create `.claude/<plugin-name>-review.local.md` to track all progress\n- **Skill-based validation**: Load relevant plugin-dev skills and validate against documented patterns\n- **Proof-based decisions**: When recommending changes, cite specific guidance from skills\n- **Incremental commits**: Commit improvements as they're made, track commit SHAs in state file\n- **Resumable**: If session ends, next session can continue from state file\n\n---\n\n## Phase 0: Setup\n\n**Goal**: Validate plugin path and create state file\n\n**Actions**:\n\n1. Validate the plugin path exists and has `.claude-plugin/plugin.json`\n2. Read plugin.json to get plugin name and version\n3. Auto-discover plugin components:\n   ```bash\n   # Commands\n   ls <plugin-path>/commands/*.md 2>/dev/null | wc -l\n\n   # Agents\n   ls <plugin-path>/agents/*.md 2>/dev/null | wc -l\n\n   # Skills\n   find <plugin-path>/skills -name \"SKILL.md\" 2>/dev/null | wc -l\n\n   # Hooks\n   test -f <plugin-path>/hooks/hooks.json && echo \"yes\" || echo \"no\"\n   ```\n4. Create state file at `.claude/<plugin-name>-review.local.md`:\n\n```markdown\n---\nworkflow: plugin-review\nplugin: <plugin-name>\nplugin_path: <plugin-path>\nstatus: in_progress\nstarted: <date>\nlast_updated: <date>\nphase: discovery\nplugin_version: <version>\n---\n\n# <Plugin-Name> Plugin Review\n\nComprehensive review against plugin-dev best practices.\n\n## Component Inventory\n\n| Component | Path | Count | Status |\n|-----------|------|-------|--------|\n| plugin.json | `.claude-plugin/plugin.json` | 1 | pending |\n| README.md | `README.md` | 1 | pending |\n| Commands | `commands/` | <n> | pending |\n| Agents | `agents/` | <n> | pending |\n| Skills | `skills/` | <n> | pending |\n| Hooks | `hooks/` | <yes/no> | pending |\n\n## Review Progress\n\n### Phase 1: Commands\n(to be filled during review)\n\n### Phase 2: Agents\n(to be filled during review)\n\n### Phase 3: Skills\n(to be filled during review)\n\n### Phase 4: Metadata\n(to be filled during review)\n\n### Phase 5: Advanced Patterns\n(to be filled during review)\n\n## Commits\n(to be filled as changes are committed)\n\n## Next Steps\n1. [ ] Phase 1: Review commands\n2. [ ] Phase 2: Review agents\n3. [ ] Phase 3: Review skills\n4. [ ] Phase 4: Review metadata\n5. [ ] Phase 5: Advanced patterns analysis\n6. [ ] Commit changes\n7. [ ] Version bump\n8. [ ] Push to remote\n```\n\n5. Create todo list with all phases\n6. Present component inventory to user and proceed to Phase 1\n\n**Output**: State file created, components discovered\n\n---\n\n## Phase 1: Commands Review\n\n**Goal**: Review each command against command-development skill\n\n**Skip if**: Plugin has no commands\n\n**Actions**:\n\n1. Load command-development skill using Skill tool\n2. Update state file: `phase: commands-review`\n3. For each command file:\n   - Read the command file\n   - Check against skill criteria:\n     - [ ] Has description in frontmatter\n     - [ ] Has argument-hint if accepts arguments\n     - [ ] Has allowed-tools (principle of least privilege)\n     - [ ] Instructions written FOR Claude (not TO user)\n     - [ ] Clear workflow structure\n   - Document findings in state file\n   - If issues found, propose fixes and get user approval\n   - Apply approved fixes\n4. Update state file with results for each command\n5. If changes made, commit with descriptive message and record SHA in state file\n\n**Output**: All commands reviewed, issues fixed, state file updated\n\n---\n\n## Phase 2: Agents Review\n\n**Goal**: Review each agent against agent-development skill\n\n**Skip if**: Plugin has no agents\n\n**Actions**:\n\n1. Load agent-development skill using Skill tool\n2. Update state file: `phase: agents-review`\n3. For each agent file:\n   - Read the agent file\n   - Check against skill criteria:\n     - [ ] Valid identifier (3-50 chars, lowercase, hyphens)\n     - [ ] Description has triggering conditions\n     - [ ] Description has 2-4 `<example>` blocks\n     - [ ] Examples use two-step assistant response pattern\n     - [ ] Examples include proactive triggering (if applicable)\n     - [ ] Tools follow least privilege principle\n     - [ ] System prompt has: role, responsibilities, process, output format\n     - [ ] Edge cases documented\n     - [ ] Self-verification steps included\n   - Document findings in state file\n   - If issues found, propose fixes with proof from skill\n   - Get user approval before applying\n   - Apply approved fixes\n4. Update state file with results for each agent\n5. If changes made, commit and record SHA\n\n**Output**: All agents reviewed, issues fixed, state file updated\n\n---\n\n## Phase 3: Skills Review\n\n**Goal**: Review each skill against skill-development skill\n\n**Skip if**: Plugin has no skills\n\n**Actions**:\n\n1. Load skill-development skill using Skill tool\n2. Update state file: `phase: skills-review`\n3. For each skill:\n   - Read SKILL.md\n   - Check against skill criteria:\n     - [ ] Third-person description (\"This skill should be used when...\")\n     - [ ] Specific trigger phrases in description\n     - [ ] Body uses imperative/infinitive form (not \"you should\")\n     - [ ] Content length appropriate (1,500-2,000 words ideal)\n     - [ ] Progressive disclosure (detailed content in references/)\n     - [ ] References exist and are documented\n     - [ ] No dynamic bash patterns in code blocks (GitHub #12781)\n   - Document findings in state file\n   - Propose fixes with proof from skill\n   - Get user approval\n   - Apply approved fixes\n4. Update state file with results\n5. If changes made, commit and record SHA\n\n**Output**: All skills reviewed, issues fixed, state file updated\n\n---\n\n## Phase 4: Metadata Review\n\n**Goal**: Review plugin.json and README against standards\n\n**Actions**:\n\n1. Load plugin-structure skill using Skill tool\n2. Update state file: `phase: metadata-review`\n\n**plugin.json check:**\n- [ ] Has required field: name\n- [ ] Has recommended fields: version, description, author, keywords\n- [ ] Name follows kebab-case convention\n- [ ] Version follows semver\n\n**README.md check:**\n- [ ] Overview section with component list\n- [ ] Each command documented with workflow/purpose\n- [ ] Each agent documented with capabilities and triggers\n- [ ] Each skill documented with triggers and coverage\n- [ ] Installation instructions\n- [ ] Dependencies section (if applicable)\n- [ ] Use cases with practical examples\n- [ ] Version, author, license\n\n3. Compare README against plugin-dev/README.md template pattern\n4. Document findings in state file\n5. Propose fixes and get approval\n6. Apply approved fixes\n7. If changes made, commit and record SHA\n\n**Output**: Metadata reviewed, README improved, state file updated\n\n---\n\n## Phase 5: Advanced Patterns Analysis\n\n**Goal**: Determine if plugin would benefit from additional patterns\n\n**Actions**:\n\n1. Update state file: `phase: advanced-patterns`\n\n**plugin-settings analysis:**\n- Load plugin-settings skill\n- Analyze if plugin would benefit from `.local.md` configuration:\n  - Does plugin have hooks that need enable/disable toggle?\n  - Does agent need state persistence between invocations?\n  - Are there project-specific settings that vary?\n- Document decision with proof from skill\n- If beneficial, recommend implementation\n\n**plugin-structure analysis:**\n- Load plugin-structure skill\n- Verify structure compliance:\n  - [ ] Manifest in `.claude-plugin/plugin.json`\n  - [ ] Components at plugin root (not nested)\n  - [ ] Kebab-case naming throughout\n  - [ ] ${CLAUDE_PLUGIN_ROOT} used where needed\n  - [ ] No unnecessary directories\n- Document findings\n\n2. Update state file with analysis results\n3. If improvements identified, get user approval and implement\n\n**Output**: Advanced patterns analyzed, recommendations documented\n\n---\n\n## Phase 6: Finalization\n\n**Goal**: Commit remaining changes, version bump, push\n\n**Actions**:\n\n1. Update state file: `phase: finalization`\n2. Show summary of all changes made:\n   - List all commits with SHAs\n   - List all issues found and fixed\n   - List any skipped items with rationale\n3. Ask user: \"Ready to finalize? This will:\"\n   - Commit any uncommitted changes\n   - Bump version (patch for improvements, minor for new features)\n   - Push to remote\n4. If approved:\n   - Commit remaining changes\n   - Bump version in plugin.json and README\n   - Commit version bump\n   - Push to remote\n5. Update state file:\n   - Set `status: complete`\n   - Record final version\n   - Mark all next steps complete\n\n**Output**: Plugin review complete, changes committed and pushed\n\n---\n\n## State File Maintenance\n\n**Throughout all phases:**\n\n- Update `last_updated` date when making changes\n- Update `phase` field when moving between phases\n- Record commit SHAs immediately after committing\n- Document decisions with rationale\n- Track skipped items with explanation\n\n**If resuming a review:**\n\n1. Read existing state file\n2. Identify current phase from `phase` field\n3. Check `Next Steps` for uncompleted items\n4. Resume from last incomplete step\n5. Inform user: \"Resuming review from Phase X: [phase name]\"\n\n---\n\n## Quality Standards\n\nEvery recommendation must:\n\n1. **Cite the skill**: Reference specific guidance from plugin-dev skills\n2. **Show proof**: Quote relevant text from skill documentation\n3. **Explain rationale**: Why this change improves the plugin\n4. **Get approval**: Wait for user confirmation before making changes\n\n---\n\n## MANDATORY: Change Proposal Format\n\n**CRITICAL**: Before proposing ANY change, you MUST use this exact format. Do NOT make changes without following this structure.\n\n### For Issues Found\n\n```markdown\n**Issue:** [Brief description of the problem]\n\n**Criterion:** [Which checklist item failed]\n\n**Skill:** [skill-name] (e.g., agent-development, skill-development)\n\n**Proof from skill:**\n> \"[Exact quote from the skill that defines this requirement]\"\n\n**Current state:**\n[Show what the plugin currently has]\n\n**Proposed fix:**\n[Show what it should be changed to]\n\n**Rationale:** [Why this change improves the plugin based on the proof]\n```\n\n### For Skip Decisions\n\nWhen recommending to NOT make a change:\n\n```markdown\n**Considered:** [What was evaluated]\n\n**Skill:** [skill-name]\n\n**Proof from skill:**\n> \"[Exact quote that justifies skipping]\"\n\n**Decision:** Skip - [brief explanation]\n```\n\n### Enforcement\n\n- If you cannot find proof from a skill, do NOT propose the change\n- If the skill doesn't address a potential issue, note it as \"No guidance found - skipping\"\n- Always quote the skill directly, do not paraphrase\n- Present all proposals to user before applying ANY changes\n- Record all proposals (applied and skipped) in state file\n\n---\n\n## Examples of Proper Proof-Based Analysis\n\n### Example 1: Validation with Tabular Evidence\n\n**Question:** Are naming conventions followed?\n\n**From skill (plugin-structure):**\n> \"Commands: Use kebab-case .md files\"\n> \"Agents: Use kebab-case .md files describing role\"\n> \"Skills: Use kebab-case directory names\"\n\n| Component | Name | Convention | Status |\n|-----------|------|------------|--------|\n| Commands | git-status.md | kebab-case  | PASS |\n| Commands | git-commit.md | kebab-case  | PASS |\n| Commands | generate-changelog.md | kebab-case  | PASS |\n| Commands | branch-cleanup.md | kebab-case  | PASS |\n| Agents | commit-craft.md | kebab-case, describes role  | PASS |\n| Skills | git-workflow/ | kebab-case  | PASS |\n\n**Result:** PASS - All naming conventions followed.\n\n---\n\n### Example 2: Skip Decision with Justification\n\n**Question:** Could plugin benefit from a scripts/ directory?\n\n**From skill (plugin-structure):**\n> \"Scripts: Use descriptive kebab-case names with appropriate extensions\"\n> Example: `validate-input.sh`, `generate-report.py`\n\n**Analysis:**\n\n| Potential Script | Purpose | Justified? |\n|------------------|---------|------------|\n| validate-commit-msg.sh | Validate conventional commit format | No - git hooks handle this |\n| check-branch-name.sh | Validate branch naming | No - simple pattern matching |\n| parse-changelog.py | Parse git-cliff output | No - git-cliff handles this |\n\n**Assessment:** All functionality is either:\n1. Delegated to external tools (git, git-cliff, prek)\n2. Simple enough to inline in commands\n3. Handled by the commit-craft agent\n\n**From skill - Best Practice:**\n> \"Minimal manifest: Keep plugin.json lean\"\n> \"Only create directories for components the plugin actually uses\"\n\n**Result:** NO BENEFIT - Adding scripts/ would add complexity without value. Plugin appropriately delegates to external tools.\n\n---\n\n### Example 3: Issue Found with Fix Proposal\n\n**Issue:** Agent examples don't show proactive triggering\n\n**Criterion:** Description has proactive triggering example (if applicable)\n\n**Skill:** agent-development\n\n**Proof from skill:**\n> \"Include 2-4 concrete examples\"\n> \"Show proactive and reactive triggering\"\n> \"Cover different phrasings of same intent\"\n\n**Current state:**\n```markdown\n<example>\nContext: User explicitly requests commit creation.\nuser: \"create commits for these changes\"\nassistant: \"I'll use the commit-craft agent...\"\n</example>\n```\nAll 3 examples are reactive (explicit user requests).\n\n**Proposed fix:**\nAdd proactive example as first example:\n```markdown\n<example>\nContext: User just finished implementing a feature across multiple files.\nuser: \"I've finished adding the authentication module\"\nassistant: \"Great! You have changes across several files.\"\n<commentary>\nUser completed coding task with multiple modified files. Proactively trigger commit-craft.\n</commentary>\nassistant: \"I'll use the commit-craft agent to organize these changes into logical, atomic commits.\"\n</example>\n```\n\n**Rationale:** The skill explicitly requires showing \"proactive and reactive triggering.\" Current examples only show reactive patterns, missing the proactive case where agent triggers after user completes work.\n\n---\n\n### Example 4: Advanced Pattern Analysis\n\n**Question:** Does plugin benefit from plugin-settings pattern?\n\n**From skill (plugin-settings):**\n> \"Plugins can store user-configurable settings... for Per-project plugin configuration\"\n> \"Use case: Enable/disable hooks without editing hooks.json\"\n> \"Focus on keeping settings simple and providing good defaults when settings file doesn't exist\"\n\n**Analysis:**\n\n| Pattern | Applicable? | Reasoning |\n|---------|-------------|-----------|\n| Configuration-driven behavior | No | CLAUDE.md handles project conventions |\n| Temporarily active hooks | No | Plugin has no hooks |\n| Agent state management | No | commit-craft is stateless by design |\n\n**One potential use case:** Protected branch patterns for branch-cleanup.\n\n**However, from skill:**\n> \"Focus on keeping settings simple and providing good defaults when settings file doesn't exist\"\n\nPlugin already provides good defaults. Adding settings would add complexity for minor benefit.\n\n**Result:** NO - Limited benefit, skip implementation. CLAUDE.md handles configuration needs.\n\n---\n\n## Begin Review\n\n1. Validate plugin path: $ARGUMENTS\n2. If path is empty or invalid, ask user for plugin path\n3. Create state file and begin Phase 0: Setup"
              }
            ],
            "skills": [
              {
                "name": "crawl4ai",
                "description": "This skill should be used when users need to scrape websites, extract structured data, handle JavaScript-heavy pages, crawl multiple URLs, or build automated web data pipelines. Includes optimized extraction patterns with schema generation for efficient, LLM-free extraction.",
                "path": ".claude/skills/crawl4ai/SKILL.md",
                "frontmatter": {
                  "name": "crawl4ai",
                  "description": "This skill should be used when users need to scrape websites, extract structured data, handle JavaScript-heavy pages, crawl multiple URLs, or build automated web data pipelines. Includes optimized extraction patterns with schema generation for efficient, LLM-free extraction."
                },
                "content": "# Crawl4AI\n\n## Overview\n\nThis skill provides comprehensive support for web crawling and data extraction using the Crawl4AI library, including the complete SDK reference, ready-to-use scripts for common patterns, and optimized workflows for efficient data extraction.\n\n## Quick Start\n\n### Installation Check\n\n```bash\n# Verify installation\ncrawl4ai-doctor\n\n# If issues, run setup\ncrawl4ai-setup\n```\n\n### Basic First Crawl\n\n```python\nimport asyncio\nfrom crawl4ai import AsyncWebCrawler\n\nasync def main():\n    async with AsyncWebCrawler() as crawler:\n        result = await crawler.arun(\"https://example.com\")\n        print(result.markdown[:500])  # First 500 chars\n\nasyncio.run(main())\n```\n\n### Using Provided Scripts\n\n```bash\n# Simple markdown extraction\npython scripts/basic_crawler.py https://example.com\n\n# Batch processing\npython scripts/batch_crawler.py urls.txt\n\n# Data extraction\npython scripts/extraction_pipeline.py --generate-schema https://shop.com \"extract products\"\n```\n\n## Core Crawling Fundamentals\n\n### 1. Basic Crawling\n\nUnderstanding the core components for any crawl:\n\n```python\nfrom crawl4ai import AsyncWebCrawler, BrowserConfig, CrawlerRunConfig\n\n# Browser configuration (controls browser behavior)\nbrowser_config = BrowserConfig(\n    headless=True,  # Run without GUI\n    viewport_width=1920,\n    viewport_height=1080,\n    user_agent=\"custom-agent\"  # Optional custom user agent\n)\n\n# Crawler configuration (controls crawl behavior)\ncrawler_config = CrawlerRunConfig(\n    page_timeout=30000,  # 30 seconds timeout\n    screenshot=True,  # Take screenshot\n    remove_overlay_elements=True  # Remove popups/overlays\n)\n\n# Execute crawl with arun()\nasync with AsyncWebCrawler(config=browser_config) as crawler:\n    result = await crawler.arun(\n        url=\"https://example.com\",\n        config=crawler_config\n    )\n\n    # CrawlResult contains everything\n    print(f\"Success: {result.success}\")\n    print(f\"HTML length: {len(result.html)}\")\n    print(f\"Markdown length: {len(result.markdown)}\")\n    print(f\"Links found: {len(result.links)}\")\n```\n\n### 2. Configuration Deep Dive\n\n**BrowserConfig** - Controls the browser instance:\n\n- `headless`: Run with/without GUI\n- `viewport_width/height`: Browser dimensions\n- `user_agent`: Custom user agent string\n- `cookies`: Pre-set cookies\n- `headers`: Custom HTTP headers\n\n**CrawlerRunConfig** - Controls each crawl:\n\n- `page_timeout`: Maximum page load/JS execution time (ms)\n- `wait_for`: CSS selector or JS condition to wait for (optional)\n- `cache_mode`: Control caching behavior\n- `js_code`: Execute custom JavaScript\n- `screenshot`: Capture page screenshot\n- `session_id`: Persist session across crawls\n\n### 3. Content Processing\n\nBasic content operations available in every crawl:\n\n```python\nresult = await crawler.arun(url)\n\n# Access extracted content\nmarkdown = result.markdown  # Clean markdown\nhtml = result.html  # Raw HTML\ntext = result.cleaned_html  # Cleaned HTML\n\n# Media and links\nimages = result.media[\"images\"]\nvideos = result.media[\"videos\"]\ninternal_links = result.links[\"internal\"]\nexternal_links = result.links[\"external\"]\n\n# Metadata\ntitle = result.metadata[\"title\"]\ndescription = result.metadata[\"description\"]\n```\n\n## Markdown Generation (Primary Use Case)\n\n### 1. Basic Markdown Extraction\n\nCrawl4AI excels at generating clean, well-formatted markdown:\n\n```python\n# Simple markdown extraction\nasync with AsyncWebCrawler() as crawler:\n    result = await crawler.arun(\"https://docs.example.com\")\n\n    # High-quality markdown ready for LLMs\n    with open(\"documentation.md\", \"w\") as f:\n        f.write(result.markdown)\n```\n\n### 2. Fit Markdown (Content Filtering)\n\nUse content filters to get only relevant content:\n\n```python\nfrom crawl4ai.content_filter_strategy import PruningContentFilter, BM25ContentFilter\nfrom crawl4ai.markdown_generation_strategy import DefaultMarkdownGenerator\n\n# Option 1: Pruning filter (removes low-quality content)\npruning_filter = PruningContentFilter(threshold=0.4, threshold_type=\"fixed\")\n\n# Option 2: BM25 filter (relevance-based filtering)\nbm25_filter = BM25ContentFilter(user_query=\"machine learning tutorials\", bm25_threshold=1.0)\n\nmd_generator = DefaultMarkdownGenerator(content_filter=bm25_filter)\n\nconfig = CrawlerRunConfig(markdown_generator=md_generator)\n\nresult = await crawler.arun(url, config=config)\n# Access filtered content\nprint(result.markdown.fit_markdown)  # Filtered markdown\nprint(result.markdown.raw_markdown)  # Original markdown\n```\n\n### 3. Markdown Customization\n\nControl markdown generation with options:\n\n```python\nconfig = CrawlerRunConfig(\n    # Exclude elements from markdown\n    excluded_tags=[\"nav\", \"footer\", \"aside\"],\n\n    # Focus on specific CSS selector\n    css_selector=\".main-content\",\n\n    # Clean up formatting\n    remove_forms=True,\n    remove_overlay_elements=True,\n\n    # Control link handling\n    exclude_external_links=True,\n    exclude_internal_links=False\n)\n\n# Custom markdown generation\nfrom crawl4ai.markdown_generation_strategy import DefaultMarkdownGenerator\n\ngenerator = DefaultMarkdownGenerator(\n    options={\n        \"ignore_links\": False,\n        \"ignore_images\": False,\n        \"image_alt_text\": True\n    }\n)\n```\n\n## Data Extraction\n\n### 1. Schema-Based Extraction (Most Efficient)\n\nFor repetitive patterns, generate schema once and reuse:\n\n```bash\n# Step 1: Generate schema with LLM (one-time)\npython scripts/extraction_pipeline.py --generate-schema https://shop.com \"extract products\"\n\n# Step 2: Use schema for fast extraction (no LLM)\npython scripts/extraction_pipeline.py --use-schema https://shop.com generated_schema.json\n```\n\n### 2. Manual CSS/JSON Extraction\n\nWhen you know the structure:\n\n```python\nschema = {\n    \"name\": \"articles\",\n    \"baseSelector\": \"article.post\",\n    \"fields\": [\n        {\"name\": \"title\", \"selector\": \"h2\", \"type\": \"text\"},\n        {\"name\": \"date\", \"selector\": \".date\", \"type\": \"text\"},\n        {\"name\": \"content\", \"selector\": \".content\", \"type\": \"text\"}\n    ]\n}\n\nextraction_strategy = JsonCssExtractionStrategy(schema=schema)\nconfig = CrawlerRunConfig(extraction_strategy=extraction_strategy)\n```\n\n### 3. LLM-Based Extraction\n\nFor complex or irregular content:\n\n```python\nextraction_strategy = LLMExtractionStrategy(\n    provider=\"openai/gpt-4o-mini\",\n    instruction=\"Extract key financial metrics and quarterly trends\"\n)\n```\n\n## Advanced Patterns\n\n### 1. Deep Crawling\n\nDiscover and crawl links from a page:\n\n```python\n# Basic link discovery\nasync with AsyncWebCrawler() as crawler:\n    result = await crawler.arun(url)\n\n    # Extract and process discovered links\n    internal_links = result.links.get(\"internal\", [])\n    external_links = result.links.get(\"external\", [])\n\n    # Crawl discovered internal links\n    for link in internal_links:\n        if \"/blog/\" in link and \"/tag/\" not in link:  # Filter links\n            sub_result = await crawler.arun(link)\n            # Process sub-page\n\n    # For advanced deep crawling, consider using URL seeding patterns\n    # or custom crawl strategies (see complete-sdk-reference.md)\n```\n\n### 2. Batch & Multi-URL Processing\n\nEfficiently crawl multiple URLs:\n\n```python\nurls = [\"https://site1.com\", \"https://site2.com\", \"https://site3.com\"]\n\nasync with AsyncWebCrawler() as crawler:\n    # Concurrent crawling with arun_many()\n    results = await crawler.arun_many(\n        urls=urls,\n        config=crawler_config,\n        max_concurrent=5  # Control concurrency\n    )\n\n    for result in results:\n        if result.success:\n            print(f\" {result.url}: {len(result.markdown)} chars\")\n```\n\n### 3. Session & Authentication\n\nHandle login-required content:\n\n```python\n# First crawl - establish session and login\nlogin_config = CrawlerRunConfig(\n    session_id=\"user_session\",\n    js_code=\"\"\"\n    document.querySelector('#username').value = 'myuser';\n    document.querySelector('#password').value = 'mypass';\n    document.querySelector('#submit').click();\n    \"\"\",\n    wait_for=\"css:.dashboard\"  # Wait for post-login element\n)\n\nawait crawler.arun(\"https://site.com/login\", config=login_config)\n\n# Subsequent crawls - reuse session\nconfig = CrawlerRunConfig(session_id=\"user_session\")\nawait crawler.arun(\"https://site.com/protected-content\", config=config)\n```\n\n### 4. Dynamic Content Handling\n\nFor JavaScript-heavy sites:\n\n```python\nconfig = CrawlerRunConfig(\n    # Wait for dynamic content\n    wait_for=\"css:.ajax-content\",\n\n    # Execute JavaScript\n    js_code=\"\"\"\n    // Scroll to load content\n    window.scrollTo(0, document.body.scrollHeight);\n\n    // Click load more button\n    document.querySelector('.load-more')?.click();\n    \"\"\",\n\n    # Note: For virtual scrolling (Twitter/Instagram-style),\n    # use virtual_scroll_config parameter (see docs)\n\n    # Extended timeout for slow loading\n    page_timeout=60000\n)\n```\n\n### 5. Anti-Detection & Proxies\n\nAvoid bot detection:\n\n```python\n# Proxy configuration\nbrowser_config = BrowserConfig(\n    headless=True,\n    proxy_config={\n        \"server\": \"http://proxy.server:8080\",\n        \"username\": \"user\",\n        \"password\": \"pass\"\n    }\n)\n\n# For stealth/undetected browsing, consider:\n# - Rotating user agents via user_agent parameter\n# - Using different viewport sizes\n# - Adding delays between requests\n\n# Rate limiting\nimport asyncio\nfor url in urls:\n    result = await crawler.arun(url)\n    await asyncio.sleep(2)  # Delay between requests\n```\n\n## Common Use Cases\n\n### Documentation to Markdown\n\n```python\n# Convert entire documentation site to clean markdown\nasync with AsyncWebCrawler() as crawler:\n    result = await crawler.arun(\"https://docs.example.com\")\n\n    # Save as markdown for LLM consumption\n    with open(\"docs.md\", \"w\") as f:\n        f.write(result.markdown)\n```\n\n### E-commerce Product Monitoring\n\n```python\n# Generate schema once for product pages\n# Then monitor prices/availability without LLM costs\nschema = load_json(\"product_schema.json\")\nproducts = await crawler.arun_many(product_urls,\n    config=CrawlerRunConfig(extraction_strategy=JsonCssExtractionStrategy(schema)))\n```\n\n### News Aggregation\n\n```python\n# Crawl multiple news sources concurrently\nnews_urls = [\"https://news1.com\", \"https://news2.com\", \"https://news3.com\"]\nresults = await crawler.arun_many(news_urls, max_concurrent=5)\n\n# Extract articles with Fit Markdown\nfor result in results:\n    if result.success:\n        # Get only relevant content\n        article = result.fit_markdown\n```\n\n### Research & Data Collection\n\n```python\n# Academic paper collection with focused extraction\nconfig = CrawlerRunConfig(\n    fit_markdown=True,\n    fit_markdown_options={\n        \"query\": \"machine learning transformers\",\n        \"max_tokens\": 10000\n    }\n)\n```\n\n## Resources\n\n### scripts/\n\n- **extraction_pipeline.py** - Three extraction approaches with schema generation\n- **basic_crawler.py** - Simple markdown extraction with screenshots\n- **batch_crawler.py** - Multi-URL concurrent processing\n\n### references/\n\n- **complete-sdk-reference.md** - Complete SDK documentation (23K words) with all parameters, methods, and advanced features\n\n### Example Code Repository\n\nThe Crawl4AI repository includes extensive examples in `docs/examples/`:\n\n#### Core Examples\n\n- **quickstart.py** - Comprehensive starter with all basic patterns:\n  - Simple crawling, JavaScript execution, CSS selectors\n  - Content filtering, link analysis, media handling\n  - LLM extraction, CSS extraction, dynamic content\n  - Browser comparison, SSL certificates\n\n#### Specialized Examples\n\n- **amazon_product_extraction_*.py** - Three approaches for e-commerce scraping\n- **extraction_strategies_examples.py** - All extraction strategies demonstrated\n- **deepcrawl_example.py** - Advanced deep crawling patterns\n- **crypto_analysis_example.py** - Complex data extraction with analysis\n- **parallel_execution_example.py** - High-performance concurrent crawling\n- **session_management_example.py** - Authentication and session handling\n- **markdown_generation_example.py** - Advanced markdown customization\n- **hooks_example.py** - Custom hooks for crawl lifecycle events\n- **proxy_rotation_example.py** - Proxy management and rotation\n- **router_example.py** - Request routing and URL patterns\n\n#### Advanced Patterns\n\n- **adaptive_crawling/** - Intelligent crawling strategies\n- **c4a_script/** - C4A script examples\n- **docker_*.py** - Docker deployment patterns\n\nTo explore examples:\n\n```python\n# The examples are located in your Crawl4AI installation:\n# Look in: docs/examples/ directory\n\n# Start with quickstart.py for comprehensive patterns\n# It includes: simple crawl, JS execution, CSS selectors,\n# content filtering, LLM extraction, dynamic pages, and more\n\n# For specific use cases:\n# - E-commerce: amazon_product_extraction_*.py\n# - High performance: parallel_execution_example.py\n# - Authentication: session_management_example.py\n# - Deep crawling: deepcrawl_example.py\n\n# Run any example directly:\n# python docs/examples/quickstart.py\n```\n\n## Best Practices\n\n1. **Start with basic crawling** - Understand BrowserConfig, CrawlerRunConfig, and arun() before moving to advanced features\n2. **Use markdown generation** for documentation and content - Crawl4AI excels at clean markdown extraction\n3. **Try schema generation first** for structured data - 10-100x more efficient than LLM extraction\n4. **Enable caching during development** - `cache_mode=CacheMode.ENABLED` to avoid repeated requests\n5. **Set appropriate timeouts** - 30s for normal sites, 60s+ for JavaScript-heavy sites\n6. **Respect rate limits** - Use delays and `max_concurrent` parameter\n7. **Reuse sessions** for authenticated content instead of re-logging\n\n## Troubleshooting\n\n**JavaScript not loading:**\n\n```python\nconfig = CrawlerRunConfig(\n    wait_for=\"css:.dynamic-content\",  # Wait for specific element\n    page_timeout=60000  # Increase timeout\n)\n```\n\n**Bot detection issues:**\n\n```python\nbrowser_config = BrowserConfig(\n    headless=False,  # Sometimes visible browsing helps\n    viewport_width=1920,\n    viewport_height=1080,\n    user_agent=\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\"\n)\n# Add delays between requests\nawait asyncio.sleep(random.uniform(2, 5))\n```\n\n**Content extraction problems:**\n\n```python\n# Debug what's being extracted\nresult = await crawler.arun(url)\nprint(f\"HTML length: {len(result.html)}\")\nprint(f\"Markdown length: {len(result.markdown)}\")\nprint(f\"Links found: {len(result.links)}\")\n\n# Try different wait strategies\nconfig = CrawlerRunConfig(\n    wait_for=\"js:document.querySelector('.content') !== null\"\n)\n```\n\n**Session/auth issues:**\n\n```python\n# Verify session is maintained\nconfig = CrawlerRunConfig(session_id=\"test_session\")\nresult = await crawler.arun(url, config=config)\nprint(f\"Session ID: {result.session_id}\")\nprint(f\"Cookies: {result.cookies}\")\n```\n\nFor more details on any topic, refer to `references/complete-sdk-reference.md` which contains comprehensive documentation of all features, parameters, and advanced usage patterns."
              },
              {
                "name": "doc-generator",
                "description": "Generate markdown documentation from Python codebases by analyzing source files, extracting docstrings, type hints, and code structure. Use when the user asks to document Python code, create API docs, or generate README files from source code.",
                "path": ".claude/skills/doc-generator/SKILL.md",
                "frontmatter": {
                  "name": "doc-generator",
                  "description": "Generate markdown documentation from Python codebases by analyzing source files, extracting docstrings, type hints, and code structure. Use when the user asks to document Python code, create API docs, or generate README files from source code."
                },
                "content": "# Python Documentation Generator\n\nGenerate comprehensive markdown documentation from Python source code.\n\n## When to Use This Skill\n\n- User asks to \"document this code\" or \"generate docs\"\n- Creating API documentation from Python modules\n- Generating README files with usage examples\n- Extracting docstrings and type signatures into readable format\n- User mentions \"documentation\", \"docstrings\", or \"API reference\"\n\n## Input\n\nAccept either:\n- Single Python file path\n- Directory path (recursively process .py files)\n- List of specific files\n\n## Output Format\n\nGenerate standard markdown with:\n\n```markdown\n# Module Name\n\nBrief description from module docstring.\n\n## Classes\n\n### ClassName\n\nDescription from class docstring.\n\n**Methods:**\n- `method_name(param: type) -> return_type`: Brief description\n\n## Functions\n\n### function_name(param: type) -> return_type\n\nDescription from docstring.\n\n**Parameters:**\n- `param` (type): Description\n\n**Returns:**\n- type: Description\n\n## Usage Examples\n\n```python\n# Extract from docstring examples or generate basic usage\n```\n```\n\n## Analysis Approach\n\n1. **Parse Python files** using AST or inspection\n2. **Extract key elements:**\n   - Module-level docstrings\n   - Class definitions and docstrings\n   - Function/method signatures with type hints\n   - Docstring content (support Google, NumPy, Sphinx formats)\n3. **Organize hierarchically** (modules -> classes -> methods -> functions)\n4. **Generate clean markdown** with consistent formatting\n\n## Quality Guidelines\n\n- Preserve original docstring formatting when meaningful\n- Include type hints prominently in signatures\n- Group related items (all classes together, all functions together)\n- Add table of contents for large modules\n- Skip private members (leading underscore) unless explicitly requested\n- Handle missing docstrings gracefully (note \"No description provided\")\n\n## Python Tools\n\nPrefer standard library:\n- `ast` module for parsing\n- `inspect` module for runtime introspection\n- `pathlib` for file handling\n\nNo external dependencies required for basic documentation generation.\n\n## Error Handling\n\n- Skip files with syntax errors (log warning)\n- Handle missing type hints gracefully\n- Warn if no docstrings found but continue processing\n- Validate file paths exist before processing"
              },
              {
                "name": "mcp-builder",
                "description": "Guide for creating high-quality MCP (Model Context Protocol) servers that enable LLMs to interact with external services through well-designed tools. Use when building MCP servers to integrate external APIs or services, whether in Python (FastMCP) or Node/TypeScript (MCP SDK).",
                "path": "examples/skills/mcp-builder/SKILL.md",
                "frontmatter": {
                  "name": "mcp-builder",
                  "description": "Guide for creating high-quality MCP (Model Context Protocol) servers that enable LLMs to interact with external services through well-designed tools. Use when building MCP servers to integrate external APIs or services, whether in Python (FastMCP) or Node/TypeScript (MCP SDK).",
                  "license": "Complete terms in LICENSE.txt"
                },
                "content": "# MCP Server Development Guide\n\n## Overview\n\nCreate MCP (Model Context Protocol) servers that enable LLMs to interact with external\nservices through well-designed tools. The quality of an MCP server is measured by how\nwell it enables LLMs to accomplish real-world tasks.\n\n---\n\n## Process\n\n##  High-Level Workflow\n\nCreating a high-quality MCP server involves four main phases:\n\n### Phase 1: Deep Research and Planning\n\n#### 1.1 Understand Modern MCP Design\n\n**API Coverage vs. Workflow Tools:**\nBalance comprehensive API endpoint coverage with specialized workflow tools. Workflow\ntools can be more convenient for specific tasks, while comprehensive coverage gives\nagents flexibility to compose operations. Performance varies by client - some clients\nbenefit from code execution that combines basic tools, while others work better with\nhigher-level workflows. When uncertain, prioritize comprehensive API coverage.\n\n**Tool Naming and Discoverability:**\nClear, descriptive tool names help agents find the right tools quickly. Use consistent\nprefixes (e.g., `github_create_issue`, `github_list_repos`) and action-oriented naming.\n\n**Context Management:**\nAgents benefit from concise tool descriptions and the ability to filter/paginate\nresults. Design tools that return focused, relevant data. Some clients support code\nexecution which can help agents filter and process data efficiently.\n\n**Optimize for Limited Context:**\nAgents have constrained context windows - make every token count. Return high-signal\ninformation, not exhaustive data dumps. Provide \"concise\" vs \"detailed\" response format\noptions. Default to human-readable identifiers over technical codes (names over IDs).\nConsider the agent's context budget as a scarce resource.\n\n**Actionable Error Messages:**\nError messages should guide agents toward solutions with specific suggestions and next\nsteps. Suggest specific next steps: \"Try using filter='active_only' to reduce results\".\nMake errors educational, not just diagnostic. Help agents learn proper tool usage\nthrough clear feedback.\n\n**Use Evaluation-Driven Development:**\nCreate realistic evaluation scenarios early. Let agent feedback drive tool improvements.\nPrototype quickly and iterate based on actual agent performance.\n\n#### 1.2 Study MCP Protocol Documentation\n\n**Navigate the MCP specification:**\n\nStart with the sitemap to find relevant pages: `https://modelcontextprotocol.io/sitemap.xml`\n\nThen fetch specific pages with `.md` suffix for markdown format (e.g., `https://modelcontextprotocol.io/specification/draft.md`).\n\nKey pages to review:\n\n- Specification overview and architecture\n- Transport mechanisms (streamable HTTP, stdio)\n- Tool, resource, and prompt definitions\n\n#### 1.3 Study Framework Documentation\n\n**Recommended stack:**\n\n- **Language**: TypeScript (high-quality SDK support and good compatibility in many\n  execution environments e.g. MCPB. Plus AI models are good at generating TypeScript\n  code, benefiting from its broad usage, static typing and good linting tools)\n- **Transport**: Streamable HTTP for remote servers, using stateless JSON (simpler to\n  scale and maintain, as opposed to stateful sessions and streaming responses). stdio\n  for local servers.\n\n**Load framework documentation:**\n\n- **MCP Best Practices**: [ View Best Practices](./reference/mcp_best_practices.md) - Core guidelines\n\n**For TypeScript (recommended):**\n\n- **TypeScript SDK**: Use WebFetch to load `https://raw.githubusercontent.com/modelcontextprotocol/typescript-sdk/main/README.md`\n- [ TypeScript Guide](./reference/node_mcp_server.md) - TypeScript patterns and examples\n\n**For Python:**\n\n- **Python SDK**: Use WebFetch to load `https://raw.githubusercontent.com/modelcontextprotocol/python-sdk/main/README.md`\n- [ Python Guide](./reference/python_mcp_server.md) - Python patterns and examples\n\n#### 1.4 Plan Your Implementation\n\n**Understand the API:**\nReview the service's API documentation to identify key endpoints, authentication\nrequirements, and data models. Use web search and WebFetch as needed. Read through\n**ALL** available API documentation:\n\n- Official API reference documentation\n- Authentication and authorization requirements\n- Rate limiting and pagination patterns\n- Error responses and status codes\n- Available endpoints and their parameters\n- Data models and schemas\n\n**Tool Selection:**\n\nPrioritize comprehensive API coverage. List endpoints to implement, starting with the\nmost common operations. List the most valuable endpoints/operations to implement.\nPrioritize tools that enable the most common and important use cases. Consider which\ntools work together to enable complex workflows.\n\n**Shared Utilities and Helpers:**\n\nIdentify common API request patterns. Plan pagination helpers. Design filtering and\nformatting utilities. Plan error handling strategies.\n\n**Input/Output Design:**\n\nDefine input validation models (Pydantic for Python, Zod for TypeScript). Design\nconsistent response formats (e.g., JSON or Markdown), and configurable levels of detail\n(e.g., Detailed or Concise). Plan for large-scale usage (thousands of users/resources).\nImplement character limits and truncation strategies (e.g., 25,000 tokens).\n\n**Error Handling Strategy:**\n\nPlan graceful failure modes. Design clear, actionable, LLM-friendly, natural language\nerror messages which prompt further action. Consider rate limiting and timeout\nscenarios. Handle authentication and authorization errors.\n\n---\n\n### Phase 2: Implementation\n\n#### 2.1 Set Up Project Structure\n\nSee language-specific guides for project setup:\n\n- [ TypeScript Guide](./reference/node_mcp_server.md) - Project structure, package.json, tsconfig.json\n- [ Python Guide](./reference/python_mcp_server.md) - Module organization, dependencies\n\n#### 2.2 Implement Core Infrastructure\n\nCreate shared utilities:\n\n- API client with authentication\n- Error handling helpers\n- Response formatting (JSON/Markdown)\n- Pagination support\n\n#### 2.3 Implement Tools\n\nFor each tool:\n\n**Input Schema:**\n\n- Use Zod (TypeScript) or Pydantic (Python)\n- Include constraints and clear descriptions\n- Add examples in field descriptions\n- Include proper constraints (min/max length, regex patterns, min/max values, ranges)\n- Provide clear, descriptive field descriptions\n- Include diverse examples in field descriptions\n\n**Output Schema:**\n\n- Define `outputSchema` where possible for structured data\n- Use `structuredContent` in tool responses (TypeScript SDK feature)\n- Helps clients understand and process tool outputs\n\n**Tool Description:**\n\n- Concise summary of functionality\n- Parameter descriptions\n- Return type schema\n- One-line summary of what the tool does\n- Detailed explanation of purpose and functionality\n- Explicit parameter types with examples\n- Complete return type schema\n- Usage examples (when to use, when not to use)\n- Error handling documentation, which outlines how to proceed given specific errors\n\n**Implementation:**\n\n- Async/await for I/O operations\n- Proper error handling with actionable messages\n- Support pagination where applicable\n- Return both text content and structured data when using modern SDKs\n- Use shared utilities to avoid code duplication\n- Follow async/await patterns for all I/O\n- Implement proper error handling\n- Support multiple response formats (JSON and Markdown)\n- Respect pagination parameters\n- Check character limits and truncate appropriately\n\n**Annotations:**\n\n- `readOnlyHint`: true/false\n- `destructiveHint`: true/false\n- `idempotentHint`: true/false\n- `openWorldHint`: true/false\n\n---\n\n### Phase 3: Review and Test\n\n#### 3.1 Code Quality Review\n\nReview for:\n\n- No duplicated code (DRY principle)\n- Consistent error handling\n- Full type coverage\n- Clear tool descriptions\n\n**To ensure quality, review the code for:**\n\n- **DRY Principle**: No duplicated code between tools\n- **Composability**: Shared logic extracted into functions\n- **Consistency**: Similar operations return similar formats\n- **Error Handling**: All external calls have error handling\n- **Type Safety**: Full type coverage (Python type hints, TypeScript types)\n- **Documentation**: Every tool has comprehensive docstrings/descriptions\n\n#### 3.2 Build and Test\n\n**TypeScript:**\n\n- Run `npm run build` to verify compilation\n- Test with MCP Inspector: `npx @modelcontextprotocol/inspector`\n\n**Python:**\n\n- Verify syntax: `python -m py_compile your_server.py`\n- Test with MCP Inspector\n\n**Important:** MCP servers are long-running processes that wait for requests over\nstdio/stdin or sse/http. Running them directly in your main process (e.g.,\n`python server.py` or `node dist/index.js`) will cause your process to hang\nindefinitely.\n\n**Safe ways to test the server:**\n\n- Use the evaluation harness (see Phase 4) - recommended approach\n- Run the server in tmux to keep it outside your main process\n- Use a timeout when testing: `timeout 5s python server.py`\n- Test with MCP Inspector: `npx @modelcontextprotocol/inspector`\n\n**For Python:**\n\n- Verify Python syntax: `python -m py_compile your_server.py`\n- Check imports work correctly by reviewing the file\n- To manually test: Run server in tmux, then test with evaluation harness in main process\n- Or use the evaluation harness directly (it manages the server for stdio transport)\n\n**For Node/TypeScript:**\n\n- Run `npm run build` and ensure it completes without errors\n- Verify dist/index.js is created\n- To manually test: Run server in tmux, then test with evaluation harness in main process\n- Or use the evaluation harness directly (it manages the server for stdio transport)\n\nSee language-specific guides for detailed testing approaches and quality checklists.\n\n#### 3.3 Use Quality Checklist\n\nTo verify implementation quality, load the appropriate checklist from the language-specific guide:\n\n- Python: see \"Quality Checklist\" in [ Python Guide](./reference/python_mcp_server.md)\n- Node/TypeScript: see \"Quality Checklist\" in [ TypeScript Guide](./reference/node_mcp_server.md)\n\n---\n\n### Phase 4: Create Evaluations\n\nAfter implementing your MCP server, create comprehensive evaluations to test its effectiveness.\n\n**Load [ Evaluation Guide](./reference/evaluation.md) for complete evaluation guidelines.**\n\n#### 4.1 Understand Evaluation Purpose\n\nUse evaluations to test whether LLMs can effectively use your MCP server to answer realistic, complex questions.\n\n#### 4.2 Create 10 Evaluation Questions\n\nTo create effective evaluations, follow the process outlined in the evaluation guide:\n\n1. **Tool Inspection**: List available tools and understand their capabilities\n2. **Content Exploration**: Use READ-ONLY operations to explore available data\n3. **Question Generation**: Create 10 complex, realistic questions\n4. **Answer Verification**: Solve each question yourself to verify answers\n\n#### 4.3 Evaluation Requirements\n\nEnsure each question is:\n\n- **Independent**: Not dependent on other questions\n- **Read-only**: Only non-destructive operations required\n- **Complex**: Requiring multiple tool calls and deep exploration\n- **Realistic**: Based on real use cases humans would care about\n- **Verifiable**: Single, clear answer that can be verified by string comparison\n- **Stable**: Answer won't change over time\n\n#### 4.4 Output Format\n\nCreate an XML file with this structure:\n\n```xml\n<evaluation>\n  <qa_pair>\n    <question>Find discussions about AI model launches with animal codenames. One model needed a specific safety designation that uses the format ASL-X. What number X was being determined for the model named after a spotted wild cat?</question>\n    <answer>3</answer>\n  </qa_pair>\n<!-- More qa_pairs... -->\n</evaluation>\n```\n\n---\n\n## Reference Files\n\n##  Documentation Library\n\nLoad these resources as needed during development:\n\n### Core MCP Documentation (Load First)\n\n- **MCP Protocol**: Start with sitemap at `https://modelcontextprotocol.io/sitemap.xml`, then fetch specific pages with `.md` suffix\n- [ MCP Best Practices](./reference/mcp_best_practices.md) - Universal MCP guidelines including:\n  - Server and tool naming conventions\n  - Response format guidelines (JSON vs Markdown)\n  - Pagination best practices\n  - Transport selection (streamable HTTP vs stdio)\n  - Security and error handling standards\n  - Character limits and truncation strategies\n  - Tool development guidelines\n\n### SDK Documentation (Load During Phase 1/2)\n\n- **Python SDK**: Fetch from `https://raw.githubusercontent.com/modelcontextprotocol/python-sdk/main/README.md`\n- **TypeScript SDK**: Fetch from `https://raw.githubusercontent.com/modelcontextprotocol/typescript-sdk/main/README.md`\n\n### Language-Specific Implementation Guides (Load During Phase 2)\n\n- [ Python Implementation Guide](./reference/python_mcp_server.md) - Complete Python/FastMCP guide with:\n  - Server initialization patterns\n  - Pydantic model examples\n  - Tool registration with `@mcp.tool`\n  - Complete working examples\n  - Quality checklist\n\n- [ TypeScript Implementation Guide](./reference/node_mcp_server.md) - Complete TypeScript guide with:\n  - Project structure\n  - Zod schema patterns\n  - Tool registration with `server.registerTool`\n  - Complete working examples\n  - Quality checklist\n\n### Evaluation Guide (Load During Phase 4)\n\n- [ Evaluation Guide](./reference/evaluation.md) - Complete evaluation creation guide with:\n  - Question creation guidelines\n  - Answer verification strategies\n  - XML format specifications\n  - Example questions and answers\n  - Running an evaluation with the provided scripts"
              },
              {
                "name": "skill-creator",
                "description": "Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Claude's capabilities with specialized knowledge, workflows, or tool integrations.",
                "path": "examples/skills/skill-creator/SKILL.md",
                "frontmatter": {
                  "name": "skill-creator",
                  "description": "Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Claude's capabilities with specialized knowledge, workflows, or tool integrations.",
                  "license": "Complete terms in LICENSE.txt"
                },
                "content": "# Skill Creator\n\nThis skill provides guidance for creating effective skills.\n\n## About Skills\n\nSkills are modular, self-contained packages that extend Claude's capabilities by providing\nspecialized knowledge, workflows, and tools. Think of them as \"onboarding guides\" for specific\ndomains or tasksthey transform Claude from a general-purpose agent into a specialized agent\nequipped with procedural knowledge that no model can fully possess.\n\n### What Skills Provide\n\n1. Specialized workflows - Multi-step procedures for specific domains\n2. Tool integrations - Instructions for working with specific file formats or APIs\n3. Domain expertise - Company-specific knowledge, schemas, business logic\n4. Bundled resources - Scripts, references, and assets for complex and repetitive tasks\n\n### Anatomy of a Skill\n\nEvery skill consists of a required SKILL.md file and optional bundled resources:\n\n```text\nskill-name/\n SKILL.md (required)\n    YAML frontmatter metadata (required)\n       name: (required)\n       description: (required)\n    Markdown instructions (required)\n Bundled Resources (optional)\n     scripts/          - Executable code (Python/Bash/etc.)\n     references/       - Documentation intended to be loaded into context as needed\n     assets/           - Files used in output (templates, icons, fonts, etc.)\n```\n\n#### SKILL.md (required)\n\n**Metadata Quality:** The `name` and `description` in YAML frontmatter determine when Claude will use the skill. Be\nspecific about what the skill does and when to use it. Use the third-person (e.g. \"This skill should be used when...\"\ninstead of \"Use this skill when...\").\n\n#### Bundled Resources (optional)\n\n##### Scripts (`scripts/`)\n\nExecutable code (Python/Bash/etc.) for tasks that require deterministic reliability or are repeatedly rewritten.\n\n- **When to include**: When the same code is being rewritten repeatedly or deterministic reliability is needed\n- **Example**: `scripts/rotate_pdf.py` for PDF rotation tasks\n- **Benefits**: Token efficient, deterministic, may be executed without loading into context\n- **Note**: Scripts may still need to be read by Claude for patching or environment-specific adjustments\n\n##### References (`references/`)\n\nDocumentation and reference material intended to be loaded as needed into context to inform Claude's process and\nthinking.\n\n- **When to include**: For documentation that Claude should reference while working\n- **Examples**: `references/finance.md` for financial schemas, `references/mnda.md` for company NDA template,\n  `references/policies.md` for company policies, `references/api_docs.md` for API specifications\n- **Use cases**: Database schemas, API documentation, domain knowledge, company policies, detailed workflow guides\n- **Benefits**: Keeps SKILL.md lean, loaded only when Claude determines it's needed\n- **Best practice**: If files are large (>10k words), include grep search patterns in SKILL.md\n- **Avoid duplication**: Information should live in either SKILL.md or references files, not both. Prefer references\n  files for detailed information unless it's truly core to the skillthis keeps SKILL.md lean while making information\n  discoverable without hogging the context window. Keep only essential procedural instructions and workflow guidance in\n  SKILL.md; move detailed reference material, schemas, and examples to references files.\n\n##### Assets (`assets/`)\n\nFiles not intended to be loaded into context, but rather used within the output Claude produces.\n\n- **When to include**: When the skill needs files that will be used in the final output\n- **Examples**: `assets/logo.png` for brand assets, `assets/slides.pptx` for PowerPoint templates,\n  `assets/frontend-template/` for HTML/React boilerplate, `assets/font.ttf` for typography\n- **Use cases**: Templates, images, icons, boilerplate code, fonts, sample documents that get copied or modified\n- **Benefits**: Separates output resources from documentation, enables Claude to use files without loading them into\n  context\n\n### Progressive Disclosure Design Principle\n\nSkills use a three-level loading system to manage context efficiently:\n\n1. **Metadata (name + description)** - Always in context (~100 words)\n2. **SKILL.md body** - When skill triggers (<5k words)\n3. **Bundled resources** - As needed by Claude (Unlimited*)\n\n*Unlimited because scripts can be executed without reading into context window.\n\n## Skill Creation Process\n\nTo create a skill, follow the \"Skill Creation Process\" in order, skipping steps only if there is a clear reason why\nthey are not applicable.\n\n### Step 1: Understanding the Skill with Concrete Examples\n\nSkip this step only when the skill's usage patterns are already clearly understood. It remains valuable even when\nworking with an existing skill.\n\nTo create an effective skill, clearly understand concrete examples of how the skill will be used. This understanding\ncan come from either direct user examples or generated examples that are validated with user feedback.\n\nFor example, when building an image-editor skill, relevant questions include:\n\n- \"What functionality should the image-editor skill support? Editing, rotating, anything else?\"\n- \"Can you give some examples of how this skill would be used?\"\n- \"I can imagine users asking for things like 'Remove the red-eye from this image' or 'Rotate this image'. Are there\n  other ways you imagine this skill being used?\"\n- \"What would a user say that should trigger this skill?\"\n\nTo avoid overwhelming users, avoid asking too many questions in a single message. Start with the most important\nquestions and follow up as needed for better effectiveness.\n\nConclude this step when there is a clear sense of the functionality the skill should support.\n\n### Step 2: Planning the Reusable Skill Contents\n\nTo turn concrete examples into an effective skill, analyze each example by:\n\n1. Considering how to execute on the example from scratch\n2. Identifying what scripts, references, and assets would be helpful when executing these workflows repeatedly\n\nExample: When building a `pdf-editor` skill to handle queries like \"Help me rotate this PDF,\" the analysis shows:\n\n1. Rotating a PDF requires re-writing the same code each time\n2. A `scripts/rotate_pdf.py` script would be helpful to store in the skill\n\nExample: When designing a `frontend-webapp-builder` skill for queries like \"Build me a todo app\" or \"Build me a\ndashboard to track my steps,\" the analysis shows:\n\n1. Writing a frontend webapp requires the same boilerplate HTML/React each time\n2. An `assets/hello-world/` template containing the boilerplate HTML/React project files would be helpful to store in\n   the skill\n\nExample: When building a `big-query` skill to handle queries like \"How many users have logged in today?\" the analysis\nshows:\n\n1. Querying BigQuery requires re-discovering the table schemas and relationships each time\n2. A `references/schema.md` file documenting the table schemas would be helpful to store in the skill\n\nTo establish the skill's contents, analyze each concrete example to create a list of the reusable resources to include:\nscripts, references, and assets.\n\n### Step 3: Initializing the Skill\n\nAt this point, it is time to actually create the skill.\n\nSkip this step only if the skill being developed already exists, and iteration or packaging is needed. In this case,\ncontinue to the next step.\n\nWhen creating a new skill from scratch, always run the `init_skill.py` script. The script conveniently generates a new\ntemplate skill directory that automatically includes everything a skill requires, making the skill creation process much\nmore efficient and reliable.\n\nUsage:\n\n```bash\nscripts/init_skill.py <skill-name> --path <output-directory>\n```\n\nThe script:\n\n- Creates the skill directory at the specified path\n- Generates a SKILL.md template with proper frontmatter and TODO placeholders\n- Creates example resource directories: `scripts/`, `references/`, and `assets/`\n- Adds example files in each directory that can be customized or deleted\n\nAfter initialization, customize or remove the generated SKILL.md and example files as needed.\n\n### Step 4: Edit the Skill\n\nWhen editing the (newly-generated or existing) skill, remember that the skill is being created for another instance of\nClaude to use. Focus on including information that would be beneficial and non-obvious to Claude. Consider what\nprocedural knowledge, domain-specific details, or reusable assets would help another Claude instance execute these tasks\nmore effectively.\n\n#### Start with Reusable Skill Contents\n\nTo begin implementation, start with the reusable resources identified above: `scripts/`, `references/`, and `assets/`\nfiles. Note that this step may require user input. For example, when implementing a `brand-guidelines` skill, the user\nmay need to provide brand assets or templates to store in `assets/`, or documentation to store in `references/`.\n\nAlso, delete any example files and directories not needed for the skill. The initialization script creates example files\nin `scripts/`, `references/`, and `assets/` to demonstrate structure, but most skills won't need all of them.\n\n#### Update SKILL.md\n\n**Writing Style:** Write the entire skill using **imperative/infinitive form** (verb-first instructions), not second\nperson. Use objective, instructional language (e.g., \"To accomplish X, do Y\" rather than \"You should do X\" or \"If you\nneed to do X\"). This maintains consistency and clarity for AI consumption.\n\nTo complete SKILL.md, answer the following questions:\n\n1. What is the purpose of the skill, in a few sentences?\n2. When should the skill be used?\n3. In practice, how should Claude use the skill? All reusable skill contents developed above should be referenced so\n   that Claude knows how to use them.\n\n### Step 5: Packaging a Skill\n\nOnce the skill is ready, it should be packaged into a distributable zip file that gets shared with the user. The\npackaging process automatically validates the skill first to ensure it meets all requirements:\n\n```bash\nscripts/package_skill.py <path/to/skill-folder>\n```\n\nOptional output directory specification:\n\n```bash\nscripts/package_skill.py <path/to/skill-folder> ./dist\n```\n\nThe packaging script will:\n\n1. **Validate** the skill automatically, checking:\n   - YAML frontmatter format and required fields\n   - Skill naming conventions and directory structure\n   - Description completeness and quality\n   - File organization and resource references\n\n2. **Package** the skill if validation passes, creating a zip file named after the skill (e.g., `my-skill.zip`) that\n   includes all files and maintains the proper directory structure for distribution.\n\nIf validation fails, the script will report the errors and exit without creating a package. Fix any validation errors\nand run the packaging command again.\n\n### Step 6: Iterate\n\nAfter testing the skill, users may request improvements. Often this happens right after using the skill, with fresh\ncontext of how the skill performed.\n\n**Iteration workflow:**\n\n1. Use the skill on real tasks\n2. Notice struggles or inefficiencies\n3. Identify how SKILL.md or bundled resources should be updated\n4. Implement changes and test again"
              },
              {
                "name": "Video Processor",
                "description": "Process video files with audio extraction, format conversion (mp4, webm), and Whisper transcription. Use when user mentions video conversion, audio extraction, transcription, mp4, webm, ffmpeg, or whisper transcription.",
                "path": "examples/skills/video-processor/SKILL.md",
                "frontmatter": {
                  "name": "Video Processor",
                  "description": "Process video files with audio extraction, format conversion (mp4, webm), and Whisper transcription. Use when user mentions video conversion, audio extraction, transcription, mp4, webm, ffmpeg, or whisper transcription."
                },
                "content": "# Video Processor\n\n## Instructions\n\nThis skill provides video processing utilities including audio extraction, format conversion, and\naudio transcription using FFmpeg and OpenAI's Whisper model.\n\n### Prerequisites\n\n**Required tools** (must be installed in your environment):\n\n- **FFmpeg**: Multimedia framework for video/audio processing\n\n  ```bash\n  # macOS\n  brew install ffmpeg\n\n  # Ubuntu/Debian\n  apt-get install ffmpeg\n\n  # Verify installation\n  ffmpeg -version\n  ```\n\n- **OpenAI Whisper**: Speech-to-text transcription model\n\n  ```bash\n  # Install via pip\n  pip install -U openai-whisper\n\n  # Verify installation\n  whisper --help\n  ```\n\n**Python packages** (included in script via PEP 723):\n\n- click (CLI framework)\n- ffmpeg-python (Python wrapper for FFmpeg)\n\n### Workflow\n\nUse the `scripts/video_processor.py` script for all video processing tasks. The script provides a\nsimple CLI with the following commands:\n\n#### 1. **Extract Audio from Video**\n\nExtract the audio track from a video file:\n\n```bash\nuv run .claude/skills/video-processor/scripts/video_processor.py extract-audio input.mp4 output.wav\n```\n\nOptions:\n\n- `--format`: Output audio format (default: wav). Supports: wav, mp3, aac, flac\n- Output is suitable for transcription or standalone audio use\n\n#### 2. **Convert Video to MP4**\n\nConvert any video file to MP4 format:\n\n```bash\nuv run .claude/skills/video-processor/scripts/video_processor.py to-mp4 input.avi output.mp4\n```\n\nOptions:\n\n- `--codec`: Video codec (default: libx264). Common options: libx264, libx265, h264\n- `--preset`: Encoding speed/quality preset (default: medium). Options: ultrafast, fast, medium, slow, veryslow\n\n#### 3. **Convert Video to WebM**\n\nConvert any video file to WebM format (web-optimized):\n\n```bash\nuv run .claude/skills/video-processor/scripts/video_processor.py to-webm input.mp4 output.webm\n```\n\nOptions:\n\n- `--codec`: Video codec (default: libvpx-vp9). Options: libvpx, libvpx-vp9\n- WebM is optimized for web playback and streaming\n\n#### 4. **Transcribe Audio with Whisper**\n\nTranscribe audio or video files to text using OpenAI's Whisper model:\n\n```bash\n# Transcribe video file (audio will be extracted automatically)\nuv run .claude/skills/video-processor/scripts/video_processor.py transcribe input.mp4 transcript.txt\n\n# Transcribe audio file directly\nuv run .claude/skills/video-processor/scripts/video_processor.py transcribe audio.wav transcript.txt\n```\n\nOptions:\n\n- `--model`: Whisper model size (default: base). Options:\n  - `tiny`: Fastest, lowest accuracy (~1GB RAM)\n  - `base`: Fast, good accuracy (~1GB RAM) **[DEFAULT]**\n  - `small`: Balanced (~2GB RAM)\n  - `medium`: High accuracy (~5GB RAM)\n  - `large`: Best accuracy, slowest (~10GB RAM)\n- `--language`: Language code (default: auto-detect). Examples: en, es, fr, de, zh\n- `--format`: Output format (default: txt). Options: txt, srt, vtt, json\n\n**Transcription workflow:**\n\n1. If input is video, FFmpeg extracts audio to temporary WAV file\n2. Whisper processes the audio file\n3. Transcription is saved in requested format\n4. Temporary files are cleaned up automatically\n\n#### 5. **Combined Workflow Example**\n\nProcess a video end-to-end:\n\n```bash\n# 1. Extract audio for analysis\nuv run .claude/skills/video-processor/scripts/video_processor.py extract-audio lecture.mp4 lecture.wav\n\n# 2. Transcribe to SRT subtitles\nuv run .claude/skills/video-processor/scripts/video_processor.py transcribe lecture.mp4 lecture.srt --format srt --model small\n\n# 3. Convert to web format\nuv run .claude/skills/video-processor/scripts/video_processor.py to-webm lecture.mp4 lecture.webm\n```\n\n### Key Technical Details\n\n**FFmpeg and Whisper Integration:**\n\n- FFmpeg doesn't transcribe audio itself - it prepares audio for external transcription\n- The workflow is: Extract audio (FFmpeg)  Transcribe (Whisper)  Optional: Re-integrate with video\n- FFmpeg can pipe audio directly to Whisper for real-time processing (advanced use case)\n\n**Audio Format for Transcription:**\n\n- Whisper works best with WAV or MP3 formats\n- Sample rate: 16kHz is optimal (script handles conversion automatically)\n- The script extracts audio with optimal settings for Whisper\n\n**Output Formats:**\n\n- **txt**: Plain text transcript\n- **srt**: SubRip subtitle format (includes timestamps)\n- **vtt**: WebVTT subtitle format (web standard)\n- **json**: Detailed JSON with word-level timestamps\n\n### Error Handling\n\nThe script includes comprehensive error handling:\n\n- Validates input files exist\n- Checks FFmpeg and Whisper are installed\n- Provides clear error messages for missing dependencies\n- Handles temporary file cleanup on errors\n\n### Performance Tips\n\n- Use `tiny` or `base` models for quick drafts\n- Use `small` or `medium` for production transcriptions\n- Use `large` only when maximum accuracy is required\n- For long videos, consider extracting audio first, then transcribe in segments\n- WebM conversion with VP9 takes longer but produces smaller files\n\n## Examples\n\n### Example 1: Quick Video to MP4 Conversion\n\nUser request:\n\n```text\nI have an AVI file from my old camera. Can you convert it to MP4?\n```\n\nYou would:\n\n1. Use the to-mp4 command with default settings:\n\n   ```bash\n   uv run .claude/skills/video-processor/scripts/video_processor.py to-mp4 old_video.avi output.mp4\n   ```\n\n2. Confirm the conversion completed successfully\n3. Inform the user about the output file location\n\n### Example 2: Extract Audio and Transcribe\n\nUser request:\n\n```text\nI recorded a lecture video and need a transcript. Can you extract the audio and transcribe it?\n```\n\nYou would:\n\n1. First extract the audio:\n\n   ```bash\n   uv run .claude/skills/video-processor/scripts/video_processor.py extract-audio lecture.mp4 lecture.wav\n   ```\n\n2. Then transcribe using the base model (good balance of speed/accuracy):\n\n   ```bash\n   uv run .claude/skills/video-processor/scripts/video_processor.py transcribe lecture.mp4 transcript.txt --model base\n   ```\n\n3. Share the transcript.txt file with the user\n\n### Example 3: Create Web-Optimized Video with Subtitles\n\nUser request:\n\n```text\nI need to put this video on my website with subtitles. Can you help?\n```\n\nYou would:\n\n1. Convert to WebM for web optimization:\n\n   ```bash\n   uv run .claude/skills/video-processor/scripts/video_processor.py to-webm presentation.mp4 presentation.webm\n   ```\n\n2. Generate SRT subtitle file:\n\n   ```bash\n   uv run .claude/skills/video-processor/scripts/video_processor.py transcribe presentation.mp4 subtitles.srt --format srt --model small\n   ```\n\n3. Inform user they now have:\n   - presentation.webm (web-optimized video)\n   - subtitles.srt (subtitle file for embedding)\n\n### Example 4: High-Quality Transcription with Language Specification\n\nUser request:\n\n```text\nI have a Spanish interview video that needs an accurate transcript for publication.\n```\n\nYou would:\n\n1. Use a larger model with language specified for best accuracy:\n\n   ```bash\n   uv run .claude/skills/video-processor/scripts/video_processor.py transcribe interview.mp4 transcript.txt --model medium --language es\n   ```\n\n2. Optionally create SRT for review:\n\n   ```bash\n   uv run .claude/skills/video-processor/scripts/video_processor.py transcribe interview.mp4 transcript.srt --format srt --model medium --language es\n   ```\n\n3. Review the transcript with the user and make any necessary corrections\n\n### Example 5: Batch Processing Multiple Videos\n\nUser request:\n\n```text\nI have a folder of training videos that all need to be converted to WebM and transcribed.\n```\n\nYou would:\n\n1. List all video files in the directory:\n\n   ```bash\n   ls training_videos/*.mp4\n   ```\n\n2. For each video file, run the conversion and transcription:\n\n   ```bash\n   # For each video: video1.mp4, video2.mp4, etc.\n   uv run .claude/skills/video-processor/scripts/video_processor.py to-webm training_videos/video1.mp4 output/video1.webm\n   uv run .claude/skills/video-processor/scripts/video_processor.py transcribe training_videos/video1.mp4 output/video1.txt --model base\n\n   # Repeat for each file\n   ```\n\n3. Confirm all conversions and transcriptions completed\n4. Provide summary of output files\n\n## Summary\n\nThe video-processor skill provides a unified interface for common video processing tasks:\n\n- **Audio extraction**: Extract audio tracks in various formats\n- **Format conversion**: Convert to MP4 (universal) or WebM (web-optimized)\n- **Transcription**: Speech-to-text with multiple output formats\n- **Flexible**: CLI arguments for model selection, language, and output formats\n\nAll operations are handled through a single, well-documented script with sensible defaults and\ncomprehensive error handling."
              },
              {
                "name": "git-workflow",
                "description": "This skill should be used when the user asks to \"make commits\", \"commit all changes\", \"create a branch\", \"name a branch\", \"organize commits\", \"conventional commits\", \"generate changelog\", \"release version\", \"bump version\", or needs guidance on git workflow best practices including commit organization, branch naming, and conventional commit format.",
                "path": "plugins/devops/git-workflow/skills/git-workflow/SKILL.md",
                "frontmatter": {
                  "name": "git-workflow",
                  "description": "This skill should be used when the user asks to \"make commits\", \"commit all changes\", \"create a branch\", \"name a branch\", \"organize commits\", \"conventional commits\", \"generate changelog\", \"release version\", \"bump version\", or needs guidance on git workflow best practices including commit organization, branch naming, and conventional commit format."
                },
                "content": "# Git Workflow Best Practices\n\nGuidance for creating clean, atomic commits and organizing git workflows effectively.\n\n## Available Commands\n\nThis plugin provides commands to automate git workflows:\n\n| Command | Purpose |\n|---------|---------|\n| `/git-status` | Quick repository status summary |\n| `/git-commit` | Create commits with pre-commit hooks |\n| `/branch-cleanup` | Clean up merged/stale branches |\n| `/generate-changelog` | Generate CHANGELOG.md using git-cliff |\n\n### Changelog Generation\n\nUse `/generate-changelog` after creating commits to update CHANGELOG.md. The command uses a workflow-driven approach:\n\n1. Shows current state (branch, recent commits, latest tag, unreleased changes)\n2. Prompts to select action: Preview, Generate, or Release\n3. For releases, analyzes commits and recommends version bump level\n\n## Conventional Commit Format\n\nStructure commit messages following the conventional commit specification. Project-specific CLAUDE.md conventions take precedence over these defaults.\n\n```text\ntype(scope): subject\n\nbody (optional)\n\nfooter (optional)\n```\n\n### Commit Types\n\n| Type | Purpose |\n|------|---------|\n| `feat` | New feature |\n| `fix` | Bug fix |\n| `docs` | Documentation only |\n| `style` | Formatting, no code change |\n| `refactor` | Code restructuring |\n| `perf` | Performance improvement |\n| `test` | Adding/updating tests |\n| `build` | Build system changes |\n| `ci` | CI configuration |\n| `chore` | Maintenance tasks |\n| `revert` | Revert previous commit |\n\n### Subject Line Rules\n\n- Maximum 50 characters\n- Use imperative mood (\"Add feature\" not \"Added feature\")\n- No period at end\n- Capitalize first letter\n\n### Body Guidelines\n\n- Wrap at 72 characters\n- Explain what and why, not how\n- Separate from subject with blank line\n\n### Footer Conventions\n\n- Reference issues: `Fixes #123` or `Relates to #456`\n- Breaking changes: `BREAKING CHANGE: description`\n- Co-authors: `Co-Authored-By: Name <email>`\n\n## Branch Naming Conventions\n\nUse descriptive, prefixed branch names:\n\n### Branch Prefixes\n\n| Prefix | Purpose | Example |\n|--------|---------|---------|\n| `feature/` | New functionality | `feature/user-authentication` |\n| `fix/` | Bug fixes | `fix/login-redirect-loop` |\n| `hotfix/` | Urgent production fixes | `hotfix/security-patch` |\n| `release/` | Release preparation | `release/v2.1.0` |\n| `docs/` | Documentation updates | `docs/api-reference` |\n| `refactor/` | Code restructuring | `refactor/database-layer` |\n| `test/` | Test additions | `test/integration-suite` |\n| `chore/` | Maintenance | `chore/dependency-updates` |\n\n### Naming Rules\n\n- Use kebab-case (lowercase with hyphens)\n- Keep names descriptive but concise\n- Include ticket/issue number when applicable: `feature/123-user-auth`\n- Avoid generic names like `feature/update` or `fix/bug`\n\n## Atomic Commit Principles\n\nCreate commits that are:\n\n1. **Self-contained**: Each commit represents one logical change\n2. **Complete**: Code compiles and tests pass after each commit\n3. **Reviewable**: Small enough to understand in one review session\n\n### Grouping Guidelines\n\n- Keep implementation and tests together\n- Separate infrastructure from application changes\n- Isolate documentation unless integral to code changes\n- Group by feature/component/purpose\n- Keep related lock files with their manifests (package-lock.json with package.json)\n\n### What NOT to Mix\n\n- Unrelated bug fixes in the same commit\n- Formatting changes with logic changes\n- Multiple features in one commit\n- Refactoring with new functionality\n\n## Pre-Commit Workflow\n\nBefore committing:\n\n1. **Review changes**: `git diff` and `git status`\n2. **Check for sensitive files**: Never commit `.env`, credentials, API keys\n3. **Run pre-commit hooks**: Let formatters and linters process files\n4. **Re-stage if hooks modify files**: Add reformatted files and retry commit\n\n### Handling Pre-Commit Hook Failures\n\nWhen hooks modify files:\n\n1. Review the changes made by hooks\n2. Re-add the modified files: `git add <files>`\n3. Retry the commit\n4. Document any issues for manual review\n\n## Commit Message Template\n\nUse heredoc format for multi-line messages:\n\n```bash\ngit commit -m \"$(cat <<'EOF'\ntype(scope): subject line here\n\n- Detailed bullet point explaining change\n- Another relevant detail\n\nFixes #123\nEOF\n)\"\n```\n\n## Protected Branches\n\nNever force-push or directly commit to:\n\n- `main` / `master`\n- `develop`\n- `staging` / `production`\n- `release/*` branches\n\nAlways use pull requests for these branches.\n\n## Quick Reference\n\n### Creating a Feature Branch\n\n```bash\ngit checkout -b feature/descriptive-name\n```\n\n### Checking What to Commit\n\n```bash\ngit status                    # See all changes\ngit diff                      # Unstaged changes\ngit diff --cached             # Staged changes\ngit log --oneline -5          # Recent commit style\n```\n\n### Staging Selectively\n\n```bash\ngit add path/to/specific/file.ext\ngit add -p                    # Interactive staging\n```\n\n### Writing Good Commits\n\n```bash\n# Simple commit\ngit commit -m \"feat(auth): add OAuth2 login support\"\n\n# Multi-line commit\ngit commit -m \"$(cat <<'EOF'\nfix(api): resolve race condition in request handler\n\n- Add mutex lock around shared state\n- Implement request queuing for high load\n- Add timeout handling for stale requests\n\nFixes #456\nEOF\n)\"\n```"
              },
              {
                "name": "claude-agent-sdk",
                "description": "This skill should be used when building applications with the Claude Agent SDK (Python). Use for creating orchestrators with subagents, configuring agents programmatically, setting up hooks and permissions, and following SDK best practices. Trigger when implementing agentic workflows, multi-agent systems, or SDK-based automation.",
                "path": "plugins/devops/python-tools/skills/claude-agent-sdk/SKILL.md",
                "frontmatter": {
                  "name": "claude-agent-sdk",
                  "description": "This skill should be used when building applications with the Claude Agent SDK (Python). Use for creating orchestrators with subagents, configuring agents programmatically, setting up hooks and permissions, and following SDK best practices. Trigger when implementing agentic workflows, multi-agent systems, or SDK-based automation."
                },
                "content": "# Claude Agent SDK\n\nBuild production-ready applications using the Claude Agent SDK for Python.\n\n**SDK Version:** This skill targets `claude-agent-sdk>=0.1.6` (Python)\n\n## Overview\n\nThis skill provides patterns, examples, and best practices for building SDK applications that orchestrate Claude agents.\n\n## Quick Start\n\nCopy the template and customize:\n\n```bash\ncp assets/sdk-template.py my-app.py\n# Edit my-app.py - customize agents and workflow\nchmod +x my-app.py\n./my-app.py\n```\n\nThe template includes proper uv script headers, agent definitions, and async patterns.\n\n## Choosing Between query() and ClaudeSDKClient\n\nThe SDK provides two ways to interact with Claude: the `query()` function for simple one-shot tasks, and `ClaudeSDKClient` for continuous conversations.\n\n### Quick Comparison\n\n| Feature | `query()` | `ClaudeSDKClient` |\n|---------|-----------|-------------------|\n| **Conversation memory** | No - each call is independent | Yes - maintains context across queries |\n| **Use case** | One-off tasks, single questions | Multi-turn conversations, complex workflows |\n| **Complexity** | Simple - one function call | More setup - context manager pattern |\n| **Hooks support** | No | Yes |\n| **Custom tools** | No | Yes |\n| **Interrupts** | No | Yes - can interrupt ongoing operations |\n| **Session control** | New session each time | Single persistent session |\n\n> **Important:** Hooks and custom tools (SDK MCP servers) are **only supported with `ClaudeSDKClient`**, not with `query()`. If you need hooks or custom tools, you must use `ClaudeSDKClient`.\n>\n> **Note on Async Runtimes:** The SDK works with both `asyncio` and `anyio`. The official SDK examples prefer `anyio.run()` for better async library compatibility, but `asyncio.run()` works equally well. Use whichever fits your project's async runtime.\n\n### When to Use query()\n\nUse `query()` for simple, independent tasks where you don't need conversation history:\n\n```python\nimport anyio  # or: import asyncio\nfrom claude_agent_sdk import query, ClaudeAgentOptions\n\nasync def analyze_file():\n    \"\"\"One-shot file analysis - no conversation needed.\"\"\"\n    options = ClaudeAgentOptions(\n        system_prompt=\"You are a code analyzer\",\n        allowed_tools=[\"Read\", \"Grep\", \"Glob\"],\n        permission_mode=\"acceptEdits\"\n    )\n\n    async for message in query(\n        prompt=\"Analyze /path/to/file.py for bugs\",\n        options=options\n    ):\n        print(message)\n\nanyio.run(analyze_file)  # or: asyncio.run(analyze_file())\n```\n\n**Best for:**\n\n- Single analysis tasks\n- Independent file operations\n- Quick questions without follow-up\n- Scripts that run once and exit\n\n**Key limitation:** Each `query()` call creates a new session with no memory of previous calls.\n\n### When to Use ClaudeSDKClient\n\nUse `ClaudeSDKClient` when you need conversation context across multiple interactions:\n\n```python\nimport anyio  # or: import asyncio\nfrom claude_agent_sdk import ClaudeSDKClient, ClaudeAgentOptions, AssistantMessage, TextBlock\n\nasync def interactive_debugging():\n    \"\"\"Multi-turn debugging conversation with context.\"\"\"\n    options = ClaudeAgentOptions(\n        system_prompt=\"You are a debugging assistant\",\n        allowed_tools=[\"Read\", \"Grep\", \"Bash\"],\n        permission_mode=\"acceptEdits\"\n    )\n\n    async with ClaudeSDKClient(options=options) as client:\n        # First query\n        await client.query(\"Find all TODO comments in /path/to/project\")\n        async for message in client.receive_response():\n            if isinstance(message, AssistantMessage):\n                for block in message.content:\n                    if isinstance(block, TextBlock):\n                        print(f\"Claude: {block.text}\")\n\n        # Follow-up - Claude remembers the TODOs found above\n        await client.query(\"Now prioritize them by complexity\")\n        async for message in client.receive_response():\n            if isinstance(message, AssistantMessage):\n                for block in message.content:\n                    if isinstance(block, TextBlock):\n                        print(f\"Claude: {block.text}\")\n\n        # Another follow-up - still in same conversation\n        await client.query(\"Create a plan to address the top 3\")\n        async for message in client.receive_response():\n            if isinstance(message, AssistantMessage):\n                for block in message.content:\n                    if isinstance(block, TextBlock):\n                        print(f\"Claude: {block.text}\")\n\nanyio.run(interactive_debugging)  # or: asyncio.run(interactive_debugging())\n```\n\n**Best for:**\n\n- Multi-turn conversations\n- Interactive workflows\n- Tasks requiring context from previous responses\n- Applications with interrupt capability\n- Orchestrators managing complex workflows\n\n**Key advantage:** Claude remembers all previous queries and responses in the session.\n\n**See:** `examples/streaming_mode.py` - Comprehensive ClaudeSDKClient examples with all patterns\n\n### Advanced: Interrupts with ClaudeSDKClient\n\nOnly `ClaudeSDKClient` supports interrupting ongoing operations:\n\n```python\nimport anyio  # or: import asyncio\nfrom claude_agent_sdk import ClaudeSDKClient\n\nasync def interruptible_task():\n    async with ClaudeSDKClient() as client:\n        await client.query(\"Run a long analysis on /large/codebase\")\n\n        # Start processing in background\n        async with anyio.create_task_group() as tg:\n            tg.start_soon(process_messages, client)\n\n            # Simulate user interrupt after 5 seconds\n            await anyio.sleep(5)\n            await client.interrupt()\n\nasync def process_messages(client):\n    async for message in client.receive_response():\n        print(message)\n\nanyio.run(interruptible_task)  # or: asyncio.run(interruptible_task())\n```\n\n### Quick Decision Guide\n\n**Use `query()` if:**\n\n- Task is self-contained\n- No follow-up questions needed\n- Each execution is independent\n- Simpler code is preferred\n\n**Use `ClaudeSDKClient` if:**\n\n- Need conversation memory\n- Building interactive workflows\n- Require interrupt capability\n- Managing complex multi-step processes\n- Working with orchestrators and subagents\n\n## Core Patterns\n\n### 1. Orchestrator with Subagents\n\nDefine a main orchestrator that delegates work to specialized subagents.\n\n**Critical requirements:**\n\n- Orchestrator must use `system_prompt={\"type\": \"preset\", \"preset\": \"claude_code\"}` (provides Task tool knowledge)\n- Register agents programmatically via `agents={}` parameter (SDK best practice)\n- Orchestrator must include `\"Task\"` in `allowed_tools`\n- Match agent names exactly between definition and usage\n\n**Example:**\n\n```python\nfrom claude_agent_sdk import AgentDefinition, ClaudeAgentOptions\n\noptions = ClaudeAgentOptions(\n    system_prompt={\"type\": \"preset\", \"preset\": \"claude_code\"},  # REQUIRED for orchestrators\n    allowed_tools=[\"Bash\", \"Task\", \"Read\", \"Write\"],\n    agents={\n        \"analyzer\": AgentDefinition(\n            description=\"Analyzes code structure and patterns\",\n            prompt=\"You are a code analyzer...\",\n            tools=[\"Read\", \"Grep\", \"Glob\"],\n            model=\"sonnet\"\n        ),\n        \"fixer\": AgentDefinition(\n            description=\"Fixes identified issues\",\n            prompt=\"You are a code fixer...\",\n            tools=[\"Read\", \"Edit\", \"Bash\"],\n            model=\"sonnet\"\n        )\n    },\n    permission_mode=\"acceptEdits\",\n    model=\"claude-sonnet-4-5\"\n)\n```\n\n**See:**\n\n- `references/agent-patterns.md` - Complete agent definition patterns\n- `examples/agents.py` - Official SDK agent examples with different agent types\n\n### 2. System Prompt Configuration\n\nChoose the appropriate system prompt pattern:\n\n```python\n# Orchestrator (use claude_code preset) - dict format (official examples prefer this)\nsystem_prompt={\"type\": \"preset\", \"preset\": \"claude_code\"}\n\n# Shorthand format (equivalent, but less explicit)\nsystem_prompt=\"claude_code\"\n\n# Custom behavior\nsystem_prompt=\"You are a Python expert...\"\n\n# Extend preset with additional instructions\nsystem_prompt={\n    \"type\": \"preset\",\n    \"preset\": \"claude_code\",\n    \"append\": \"Additional domain-specific instructions\"\n}\n```\n\n**Note:** The shorthand `system_prompt=\"claude_code\"` is equivalent to `{\"type\": \"preset\", \"preset\": \"claude_code\"}`. Both are valid. Official examples prefer the dict format for explicitness.\n\n**See:**\n\n- `references/system-prompts.md` - Complete system prompt documentation\n- `examples/system_prompt.py` - Official SDK system prompt examples\n\n### 3. Tool Restrictions\n\nLimit subagent tools to minimum needed:\n\n```python\n# Read-only analyzer\ntools=[\"Read\", \"Grep\", \"Glob\"]\n\n# Code modifier\ntools=[\"Read\", \"Edit\", \"Bash\"]\n\n# Test runner\ntools=[\"Bash\", \"Read\"]\n```\n\n**See:** `references/agent-patterns.md` for common tool combinations\n\n### 4. Hooks\n\nIntercept SDK events to control behavior:\n\n```python\nfrom claude_agent_sdk import HookMatcher\n\noptions = ClaudeAgentOptions(\n    hooks={\n        \"PreToolUse\": [\n            HookMatcher(matcher=\"Bash\", hooks=[check_bash_command])\n        ],\n        \"PostToolUse\": [\n            HookMatcher(matcher=\"Bash\", hooks=[review_output])\n        ]\n    }\n)\n```\n\n**See:**\n\n- `references/hooks-guide.md` - Complete hook patterns documentation\n- `examples/hooks.py` - Official SDK hook examples with all hook types\n\n### 5. Permission Callbacks\n\nFine-grained control over tool usage:\n\n```python\nasync def permission_callback(tool_name, input_data, context):\n    # Allow read operations\n    if tool_name in [\"Read\", \"Grep\", \"Glob\"]:\n        return PermissionResultAllow()\n\n    # Block dangerous commands\n    if tool_name == \"Bash\" and \"rm -rf\" in input_data.get(\"command\", \"\"):\n        return PermissionResultDeny(message=\"Dangerous command\")\n\n    return PermissionResultAllow()\n\noptions = ClaudeAgentOptions(\n    can_use_tool=permission_callback,\n    permission_mode=\"default\"\n)\n```\n\n**See:**\n\n- `references/tool-permissions.md` - Complete permission patterns and decision guide\n- `examples/tool_permission_callback.py` - Official SDK permission callback example\n\n## Workflow Templates\n\n### Building an Orchestrator\n\nFollow these steps to build an effective orchestrator:\n\n**1. Define agent purposes**\n\n- What specialized tasks need delegation?\n- What tools does each agent need?\n- What constraints should apply?\n\n**2. Create agent definitions**\n\n```python\nagents={\n    \"agent-name\": AgentDefinition(\n        description=\"When to use this agent\",\n        prompt=\"Agent's role and behavior\",\n        tools=[\"Tool1\", \"Tool2\"],\n        model=\"sonnet\"\n    )\n}\n```\n\n**3. Configure orchestrator**\n\n```python\noptions = ClaudeAgentOptions(\n    system_prompt={\"type\": \"preset\", \"preset\": \"claude_code\"},  # CRITICAL\n    allowed_tools=[\"Bash\", \"Task\", \"Read\", \"Write\"],\n    agents=agents,\n    permission_mode=\"acceptEdits\"\n)\n```\n\n**4. Implement workflow**\n\n```python\nasync with ClaudeSDKClient(options=options) as client:\n    await client.query(\"Use 'agent-name' to perform task\")\n\n    async for message in client.receive_response():\n        # Process responses\n        pass\n```\n\n**See:** `examples/basic-orchestrator.py` for complete working example\n\n### Loading Agents from Files\n\nWhile programmatic registration is recommended, agent content can be stored in markdown files:\n\n```python\nimport yaml\n\ndef load_agent_definition(path: str) -> AgentDefinition:\n    \"\"\"Load agent from markdown file with YAML frontmatter.\"\"\"\n    with open(path) as f:\n        content = f.read()\n\n    parts = content.split(\"---\")\n    frontmatter = yaml.safe_load(parts[1])\n    prompt = parts[2].strip()\n\n    # Parse tools (comma-separated string or array)\n    tools = frontmatter.get(\"tools\", [])\n    if isinstance(tools, str):\n        tools = [t.strip() for t in tools.split(\",\")]\n\n    return AgentDefinition(\n        description=frontmatter[\"description\"],\n        prompt=prompt,\n        tools=tools,\n        model=frontmatter.get(\"model\", \"inherit\")\n    )\n\n# Load and register programmatically\nagent = load_agent_definition(\".claude/agents/my-agent.md\")\noptions = ClaudeAgentOptions(agents={\"my-agent\": agent})\n```\n\n**See:** `references/agent-patterns.md` for complete loading pattern\n\n## Common Anti-Patterns\n\nAvoid these common mistakes:\n\n** Missing orchestrator system prompt**\n\n```python\n# Orchestrator won't know how to use Task tool\noptions = ClaudeAgentOptions(agents={...})\n```\n\n** Correct orchestrator configuration**\n\n```python\noptions = ClaudeAgentOptions(\n    system_prompt=\"claude_code\",\n    agents={...}\n)\n```\n\n** Mismatched agent names**\n\n```python\nagents={\"investigator\": AgentDefinition(...)}\nawait client.query(\"Use 'markdown-investigator'...\")  # Wrong name\n```\n\n** Exact name matching**\n\n```python\nagents={\"investigator\": AgentDefinition(...)}\nawait client.query(\"Use 'investigator'...\")  # Matches\n```\n\n** Tool/prompt mismatch**\n\n```python\nsystem_prompt=\"Fix bugs you find\"\nallowed_tools=[\"Read\", \"Grep\"]  # Can't fix, only read\n```\n\n** Aligned tools and behavior**\n\n```python\nsystem_prompt=\"Analyze code for bugs\"\nallowed_tools=[\"Read\", \"Grep\", \"Glob\"]\n```\n\n**See:** `references/best-practices.md` for complete anti-patterns list\n\n## Resources\n\n### references/\n\nIn-depth documentation loaded as needed:\n\n- `api-reference.md` - Complete Python SDK API reference (types, functions, examples)\n- `agent-patterns.md` - Agent definition patterns, tool restrictions, best practices\n- `subagents.md` - Comprehensive subagent patterns and SDK integration\n- `system-prompts.md` - System prompt configuration (preset, custom, append)\n- `hooks-guide.md` - Hook patterns for all hook types with examples\n- `tool-permissions.md` - Permission callback patterns and examples\n- `best-practices.md` - SDK best practices, anti-patterns, debugging tips\n- `custom-tools.md` - Creating custom tools with SDK MCP servers (Python-only)\n- `sessions.md` - Session management and resumption patterns (Python-only)\n- `skills.md` - Using Agent Skills with the SDK (Python-only)\n- `slash-commands.md` - Slash commands and custom command creation (Python-only)\n\n### examples/\n\nReady-to-run code examples from official SDK:\n\n**Getting Started:**\n\n- `quick_start.py` - Basic query() usage and message handling (start here!)\n- `basic-orchestrator.py` - Complete orchestrator with analyzer and fixer subagents\n\n**Core Patterns:**\n\n- `agents.py` - Programmatic agent definitions with different agent types\n- `hooks.py` - Comprehensive hook patterns (PreToolUse, PostToolUse, UserPromptSubmit, etc.)\n- `system_prompt.py` - System prompt patterns (preset, custom, append)\n- `streaming_mode.py` - Complete ClaudeSDKClient patterns with multi-turn conversations\n\n**Advanced Features:**\n\n- `mcp_calculator.py` - Custom tools with SDK MCP server (in-process tool server)\n- `tool_permission_callback.py` - Permission callbacks with logging and control\n- `setting_sources.py` - Settings isolation and loading (user/project/local)\n- `plugin_example.py` - Using plugins with the SDK (relevant for plugin marketplace!)\n\n### assets/\n\nTemplates and validation tools:\n\n- `sdk-template.py` - Project template with uv script headers and agent structure\n- `sdk-validation-checklist.md` - Comprehensive checklist for validating SDK applications against best practices\n\n## When to Use This Skill\n\nUse this skill when:\n\n- Creating new Claude Agent SDK applications\n- Building orchestrators with multiple subagents\n- Implementing programmatic agent definitions\n- Configuring hooks or permission callbacks\n- Validating/reviewing SDK code (use `assets/sdk-validation-checklist.md`)\n- Migrating from filesystem agent discovery to programmatic registration\n- Debugging SDK applications (agent not found, Task tool not working)\n- Following SDK best practices\n\nDo not use for:\n\n- Claude Code slash commands or skills (different system)\n- Direct API usage without SDK\n- Non-Python implementations (TypeScript SDK has different patterns)\n\n## Next Steps\n\n### For Beginners\n\n1. Start with `examples/quick_start.py` - Learn basic query() usage\n2. Try `assets/sdk-template.py` - Template for new projects\n3. Review `examples/basic-orchestrator.py` - See orchestrator pattern\n\n### For Intermediate Users\n\n1. Explore core patterns:\n   - `examples/agents.py` - Agent definitions\n   - `examples/system_prompt.py` - System prompt patterns\n   - `examples/streaming_mode.py` - Multi-turn conversations\n   - `examples/hooks.py` - Hook patterns\n\n### For Advanced Users\n\n1. Study advanced features:\n   - `examples/tool_permission_callback.py` - Permission control\n   - `examples/mcp_calculator.py` - Custom tools\n   - `examples/setting_sources.py` - Settings management\n   - `examples/plugin_example.py` - Plugin integration\n\n### Validation & Quality\n\n1. Validate your code with `assets/sdk-validation-checklist.md`\n2. Review against best practices in `references/best-practices.md`\n\n### Reference Documentation\n\n1. Consult `references/` as needed for detailed patterns"
              },
              {
                "name": "python-code-quality",
                "description": "Python code quality tooling with ruff and pyright. Use when setting up linting, formatting, type checking, configuring ruff or pyright, or establishing code quality standards.\n",
                "path": "plugins/devops/python-tools/skills/python-code-quality/SKILL.md",
                "frontmatter": {
                  "name": "python-code-quality",
                  "description": "Python code quality tooling with ruff and pyright. Use when setting up linting, formatting, type checking, configuring ruff or pyright, or establishing code quality standards.\n"
                },
                "content": "# Python Code Quality with Ruff and Pyright\n\nModern Python code quality tooling using ruff (linting + formatting) and pyright (type checking).\n\n## Quick Start\n\n### Install Tools\n\n```bash\n# Using uv (recommended)\nuv add --dev ruff pyright\n\n# Using pip\npip install ruff pyright\n```\n\n### Run Quality Checks\n\n```bash\n# Format and lint with ruff\nruff check --fix .\nruff format .\n\n# Type check with pyright\npyright\n```\n\n## When to Use This Skill\n\nUse this skill when:\n\n- Setting up linting and formatting for a Python project\n- Configuring type checking\n- Establishing code quality standards for a team\n- Integrating quality checks into pre-commit or CI/CD\n- Migrating from black/flake8/mypy to ruff/pyright\n\n## Ruff: All-in-One Linter and Formatter\n\nRuff combines the functionality of flake8, black, isort, and more:\n\n**Benefits:**\n\n- 10-100x faster than alternatives\n- Drop-in replacement for black, flake8, isort\n- Single tool configuration\n- Auto-fix for many violations\n\n**Configuration:** See `reference/ruff-configuration.md`\n\n## Pyright: Fast Type Checker\n\nPyright provides static type checking for Python:\n\n**Benefits:**\n\n- Faster than mypy\n- Better editor integration (VS Code, etc.)\n- Incremental type checking\n- Configurable strictness\n\n**Configuration:** See `reference/pyright-configuration.md`\n\n## Recommended Workflow\n\n1. **Pre-commit Hooks** - Run quality checks before each commit\n   - See: `patterns/pre-commit-integration.md`\n\n2. **CI/CD Quality Gates** - Block merges on quality failures\n   - See: `patterns/ci-cd-quality-gates.md`\n\n3. **Editor Integration** - Real-time feedback while coding\n   - See: `workflows/quality-workflow.md`\n\n## Configuration Templates\n\nGeneric starter configs in `examples/`:\n\n- `pyrightconfig-starter.json` - Minimal type checking\n- `pyrightconfig-strict.json` - Strict type checking\n- `ruff-minimal.toml` - Basic linting + formatting\n- `ruff-comprehensive.toml` - Full-featured config\n\n## Helper Tools\n\n- `tools/python_formatter.py` - Batch format Python files\n- `tools/python_ruff_checker.py` - Check code quality\n\n## Ruff vs Alternatives\n\n| Feature | Ruff | Black + Flake8 + isort |\n|---------|------|------------------------|\n| Speed |  |  |\n| Configuration | Single file | Multiple files |\n| Auto-fix |  | Partial |\n| Formatting |  | Black only |\n| Import sorting |  | isort only |\n\n## Pyright vs mypy\n\n| Feature | Pyright | mypy |\n|---------|---------|------|\n| Speed |  |  |\n| VS Code integration | Native | Extension |\n| Configuration | JSON | INI/TOML |\n| Incremental checking |  |  |\n\n## Common Patterns\n\n### Ignore Specific Lines\n\n```python\n# Ruff\nx = 1  # noqa: F841  # Unused variable\n\n# Pyright\nx = 1  # type: ignore\n```\n\n### Configure Per-Directory\n\n```toml\n# ruff.toml\n[tool.ruff]\nexclude = [\"migrations/\", \"scripts/\"]\n\n[tool.ruff.lint]\nselect = [\"E\", \"F\", \"W\"]\n```\n\n## Next Steps\n\n1. Choose config template from `examples/`\n2. Set up pre-commit hooks: `patterns/pre-commit-integration.md`\n3. Add CI/CD quality gates: `patterns/ci-cd-quality-gates.md`\n4. Configure editor integration: `workflows/quality-workflow.md`\n\n## Reference Documentation\n\n- `reference/ruff-configuration.md` - Complete ruff configuration guide\n- `reference/ruff-linting-settings.md` - Linting rule categories\n- `reference/ruff-formatting-settings.md` - Formatting options\n- `reference/pyright-configuration.md` - Pyright setup and configuration"
              },
              {
                "name": "python-json-parsing",
                "description": "Python JSON parsing best practices covering performance optimization (orjson/msgspec), handling large files (streaming/JSONL), security (injection prevention), and advanced querying (JSONPath/JMESPath). Use when working with JSON data, parsing APIs, handling large JSON files, or optimizing JSON performance.\n",
                "path": "plugins/devops/python-tools/skills/python-json-parsing/SKILL.md",
                "frontmatter": {
                  "name": "python-json-parsing",
                  "description": "Python JSON parsing best practices covering performance optimization (orjson/msgspec), handling large files (streaming/JSONL), security (injection prevention), and advanced querying (JSONPath/JMESPath). Use when working with JSON data, parsing APIs, handling large JSON files, or optimizing JSON performance.\n"
                },
                "content": "# Python JSON Parsing Best Practices\n\nComprehensive guide to JSON parsing in Python with focus on performance, security, and scalability.\n\n## Quick Start\n\n### Basic JSON Parsing\n\n```python\nimport json\n\n# Parse JSON string\ndata = json.loads('{\"name\": \"Alice\", \"age\": 30}')\n\n# Parse JSON file\nwith open(\"data.json\", \"r\", encoding=\"utf-8\") as f:\n    data = json.load(f)\n\n# Write JSON file\nwith open(\"output.json\", \"w\", encoding=\"utf-8\") as f:\n    json.dump(data, f, indent=2)\n```\n\n**Key Rule:** Always specify `encoding=\"utf-8\"` when reading/writing files.\n\n## When to Use This Skill\n\nUse this skill when:\n\n- Working with JSON APIs or data interchange\n- Optimizing JSON performance in high-throughput applications\n- Handling large JSON files (> 100MB)\n- Securing applications against JSON injection\n- Extracting data from complex nested JSON structures\n\n## Performance: Choose the Right Library\n\n### Library Comparison (10,000 records benchmark)\n\n| Library | Serialize (s) | Deserialize (s) | Best For |\n|---------|---------------|-----------------|----------|\n| **orjson** | 0.42 | 1.27 | FastAPI, web APIs (3.9x faster) |\n| **msgspec** | 0.49 | 0.93 | Maximum performance (1.7x faster deserialization) |\n| **json** (stdlib) | 1.62 | 1.62 | Universal compatibility |\n| **ujson** | 1.41 | 1.85 | Drop-in replacement (2x faster) |\n\n**Recommendation:**\n\n- Use **orjson** for FastAPI/web APIs (native support, fastest serialization)\n- Use **msgspec** for data pipelines (fastest overall, typed validation)\n- Use **json** when compatibility is critical\n\n### Installation\n\n```bash\n# High-performance libraries\npip install orjson msgspec ujson\n\n# Advanced querying\npip install jsonpath-ng jmespath\n\n# Streaming large files\npip install ijson\n\n# Schema validation\npip install jsonschema\n```\n\n## Large Files: Streaming Strategies\n\nFor files > 100MB, avoid loading into memory.\n\n### Strategy 1: JSONL (JSON Lines)\n\nConvert large JSON arrays to line-delimited format:\n\n```python\n# Stream process JSONL\nwith open(\"large.jsonl\", \"r\") as infile, open(\"output.jsonl\", \"w\") as outfile:\n    for line in infile:\n        obj = json.loads(line)\n        obj[\"processed\"] = True\n        outfile.write(json.dumps(obj) + \"\\n\")\n```\n\n### Strategy 2: Streaming with ijson\n\n```python\nimport ijson\n\n# Process large JSON without loading into memory\nwith open(\"huge.json\", \"rb\") as f:\n    for item in ijson.items(f, \"products.item\"):\n        process(item)  # Handle one item at a time\n```\n\nSee: `patterns/streaming-large-json.md`\n\n## Security: Prevent JSON Injection\n\n**Critical Rules:**\n\n1. Always use `json.loads()`, never `eval()`\n2. Validate input with `jsonschema`\n3. Sanitize user input before serialization\n4. Escape special characters (`\"` and `\\`)\n\n**Vulnerable Code:**\n\n```python\n# NEVER DO THIS\nusername = request.GET['username']  # User input: admin\", \"role\": \"admin\njson_string = f'{{\"user\":\"{username}\",\"role\":\"user\"}}'\n# Result: privilege escalation\n```\n\n**Secure Code:**\n\n```python\n# Use json.dumps for serialization\ndata = {\"user\": username, \"role\": \"user\"}\njson_string = json.dumps(data)  # Properly escaped\n```\n\nSee: `anti-patterns/security-json-injection.md`, `anti-patterns/eval-usage.md`\n\n## Advanced: JSONPath for Complex Queries\n\nExtract data from nested JSON without complex loops:\n\n```python\nimport jsonpath_ng as jp\n\ndata = {\n    \"products\": [\n        {\"name\": \"Apple\", \"price\": 12.88},\n        {\"name\": \"Peach\", \"price\": 27.25}\n    ]\n}\n\n# Filter by price\nquery = jp.parse(\"products[?price>20].name\")\nresults = [match.value for match in query.find(data)]\n# Output: [\"Peach\"]\n```\n\n**Key Operators:**\n\n- `$` - Root selector\n- `..` - Recursive descendant\n- `*` - Wildcard\n- `[?<predicate>]` - Filter (e.g., `[?price > 20]`)\n- `[start:end:step]` - Array slicing\n\nSee: `patterns/jsonpath-querying.md`\n\n## Custom Objects: Serialization\n\nHandle datetime, UUID, Decimal, and custom classes:\n\n```python\nfrom datetime import datetime\nimport json\n\nclass CustomEncoder(json.JSONEncoder):\n    def default(self, obj):\n        if isinstance(obj, datetime):\n            return obj.isoformat()\n        if isinstance(obj, set):\n            return list(obj)\n        return super().default(obj)\n\n# Usage\ndata = {\"timestamp\": datetime.now(), \"tags\": {\"python\", \"json\"}}\njson_str = json.dumps(data, cls=CustomEncoder)\n```\n\nSee: `patterns/custom-object-serialization.md`\n\n## Performance Checklist\n\n- [ ] Use orjson/msgspec for high-throughput applications\n- [ ] Specify UTF-8 encoding when reading/writing files\n- [ ] Use streaming (ijson/JSONL) for files > 100MB\n- [ ] Minify JSON for production (`separators=(',', ':')`)\n- [ ] Pretty-print for development (`indent=2`)\n\n## Security Checklist\n\n- [ ] Never use `eval()` for JSON parsing\n- [ ] Validate input with `jsonschema`\n- [ ] Sanitize user input before serialization\n- [ ] Use `json.dumps()` to prevent injection\n- [ ] Escape special characters in user data\n\n## Reference Documentation\n\n**Performance:**\n\n- `reference/python-json-parsing-best-practices-2025.md` - Comprehensive research with benchmarks\n\n**Patterns:**\n\n- `patterns/streaming-large-json.md` - ijson and JSONL strategies\n- `patterns/custom-object-serialization.md` - Handle datetime, UUID, custom classes\n- `patterns/jsonpath-querying.md` - Advanced nested data extraction\n\n**Security:**\n\n- `anti-patterns/security-json-injection.md` - Prevent injection attacks\n- `anti-patterns/eval-usage.md` - Why never to use eval()\n\n**Examples:**\n\n- `examples/high-performance-parsing.py` - orjson and msgspec code\n- `examples/large-file-streaming.py` - Streaming with ijson\n- `examples/secure-validation.py` - jsonschema validation\n\n**Tools:**\n\n- `tools/json-performance-benchmark.py` - Benchmark different libraries"
              },
              {
                "name": "python-uv-scripts",
                "description": "Python single-file script development using uv and PEP 723 inline metadata. Prevents invalid patterns like [tool.uv.metadata]. Use when creating standalone Python utilities, converting scripts to uv format, managing script dependencies, implementing script testing, or establishing team standards for script development.\n",
                "path": "plugins/devops/python-tools/skills/python-uv-scripts/SKILL.md",
                "frontmatter": {
                  "name": "python-uv-scripts",
                  "description": "Python single-file script development using uv and PEP 723 inline metadata. Prevents invalid patterns like [tool.uv.metadata]. Use when creating standalone Python utilities, converting scripts to uv format, managing script dependencies, implementing script testing, or establishing team standards for script development.\n"
                },
                "content": "# Python Single-File Scripts with uv\n\nExpert guidance for creating production-ready, self-contained Python scripts using uv's inline dependency management\n(PEP 723).\n\n## Quick Start\n\n### Create Your First uv Script\n\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\n#   \"httpx>=0.27.0\",\n#   \"rich>=13.0.0\",\n# ]\n# ///\n\nimport httpx\nfrom rich import print\n\nresponse = httpx.get(\"https://api.github.com\")\nprint(f\"[green]Status: {response.status_code}[/green]\")\n```\n\nMake it executable:\n\n```bash\nchmod +x script.py\n./script.py  # uv automatically installs dependencies\n```\n\n### Convert Existing Script\n\n```bash\n# Add inline metadata to existing script\n./tools/convert_to_uv.py existing_script.py\n\n# Validate PEP 723 metadata\n./tools/validate_script.py script.py\n```\n\n## Core Concepts\n\n### What is PEP 723?\n\n**PEP 723** defines inline script metadata for Python files:\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\n#   \"package>=1.0.0\",\n# ]\n# ///\n```\n\n**Benefits:**\n\n-  Dependencies live with the code\n-  No separate `requirements.txt`\n-  Reproducible execution\n-  Version constraints included\n-  Self-documenting\n\n### uv Script Execution Modes\n\n**Mode 1: Inline Dependencies** (Recommended for utilities)\n\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# dependencies = [\"httpx\"]\n# ///\n```\n\n**Mode 2: Project Mode** (For larger scripts)\n\n```bash\nuv run script.py  # Uses pyproject.toml\n```\n\n### Mode 3: No Dependencies\n\n```python\n#!/usr/bin/env -S uv run\n# Standard library only\n```\n\n## Critical Anti-Patterns: What NOT to Do\n\n###  NEVER Use [tool.uv.metadata]\n\n**WRONG** - This will cause errors:\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# [tool.uv.metadata]        #  THIS DOES NOT WORK\n# purpose = \"testing\"\n# ///\n```\n\n**Error**:\n\n```text\nerror: TOML parse error at line 3, column 7\nunknown field `metadata`\n```\n\n**Why**: `[tool.uv.metadata]` is not part of PEP 723 and is not supported by uv.\n\n**CORRECT** - Use Python docstrings for metadata:\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = []\n# ///\n\"\"\"\nPurpose: Testing automation\nTeam: DevOps\nAuthor: team@example.com\n\"\"\"\n```\n\n**Valid `tool.uv` fields** (if needed):\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = []\n# [tool.uv]\n# exclude-newer = \"2025-01-01T00:00:00Z\"  # For reproducibility\n# ///\n```\n\n## Real-World Examples from This Repository\n\n### Example 1: Cluster Health Checker\n\nSee [examples/03-production-ready/check_cluster_health_enhanced.py](examples/03-production-ready/check_cluster_health_enhanced.py)\n\n**Current version** (basic):\n\n```python\n#!/usr/bin/env python3\nimport subprocess\n# Manual dependency installation required\n```\n\n**Enhanced with uv** (production-ready):\n\n```python\n#!/usr/bin/env -S uv run --script --quiet\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\n#   \"rich>=13.0.0\",\n#   \"typer>=0.9.0\",\n# ]\n# ///\n\"\"\"\nPurpose: Cluster health monitoring\nTeam: Infrastructure\n\"\"\"\n\nimport typer\nfrom rich.console import Console\nfrom rich.table import Table\n```\n\n### Example 2: CEPH Health Monitor\n\nSee [examples/03-production-ready/ceph_health.py](examples/03-production-ready/ceph_health.py)\n\nPattern: JSON API interaction with structured output\n\n## Best Practices from This Repository\n\n### 1. Security Patterns\n\nSee [reference/security-patterns.md](reference/security-patterns.md) for complete security guide including:\n\n- Secrets management (environment variables, keyring, Infisical)\n- Input validation\n- Dependency security\n- File operations security\n- Command execution security\n\n### 2. Version Pinning Strategy\n\nFollowing this repository's approach (from `pyproject.toml`):\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\n#   \"httpx>=0.27.0\",      # Minimum version for compatibility\n#   \"rich>=13.0.0\",       # Known good version\n#   \"ansible>=11.1.0\",    # Match project requirements\n# ]\n# ///\n```\n\n**Pinning levels:**\n\n- `>=X.Y.Z` - Minimum version (most flexible)\n- `~=X.Y.Z` - Compatible release (patch updates only)\n- `==X.Y.Z` - Exact version (most strict)\n\nSee [reference/dependency-management.md](reference/dependency-management.md).\n\n### 3. Team Standards\n\n**File naming:**\n\n```bash\ncheck_cluster_health.py    #  Descriptive, snake_case\nvalidate_template.py       #  Action-oriented\ncluster.py                 #  Too generic\n```\n\n**Shebang pattern:**\n\n```python\n#!/usr/bin/env -S uv run --script --quiet\n# --quiet suppresses uv's own output\n```\n\n**Documentation template:**\n\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = []\n# ///\n\"\"\"\nCheck Proxmox cluster health\n\nPurpose: cluster-monitoring\nTeam: infrastructure\nAuthor: devops@spaceships.work\n\nUsage:\n    python check_cluster_health.py [--node NODE] [--json]\n\nExamples:\n    python check_cluster_health.py --node foxtrot\n    python check_cluster_health.py --json\n\"\"\"\n```\n\n### 4. Error Handling Patterns\n\nFollowing Ansible best practices from this repository:\n\n```python\nimport sys\nimport subprocess\n\ndef run_command(cmd: str) -> str:\n    \"\"\"Execute command with proper error handling\"\"\"\n    try:\n        result = subprocess.run(\n            cmd.split(),\n            capture_output=True,\n            text=True,\n            check=True\n        )\n        return result.stdout\n    except subprocess.CalledProcessError as e:\n        print(f\"Error: Command failed: {cmd}\", file=sys.stderr)\n        print(f\"  {e.stderr}\", file=sys.stderr)\n        sys.exit(1)\n    except FileNotFoundError:\n        print(f\"Error: Command not found: {cmd.split()[0]}\", file=sys.stderr)\n        sys.exit(1)\n```\n\nSee [patterns/error-handling.md](patterns/error-handling.md).\n\n### 5. Testing Patterns\n\n**Inline testing** (for simple scripts):\n\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = []\n# ///\n\ndef validate_ip(ip: str) -> bool:\n    \"\"\"Validate IP address format\"\"\"\n    import re\n    pattern = r'^(\\d{1,3}\\.){3}\\d{1,3}$'\n    return bool(re.match(pattern, ip))\n\n# Inline tests\nif __name__ == \"__main__\":\n    import sys\n\n    # Run tests if --test flag provided\n    if len(sys.argv) > 1 and sys.argv[1] == \"--test\":\n        assert validate_ip(\"192.168.1.1\") == True\n        assert validate_ip(\"256.1.1.1\") == False\n        print(\"All tests passed!\")\n        sys.exit(0)\n\n    # Normal execution\n    print(validate_ip(\"192.168.3.5\"))\n```\n\nSee [workflows/testing-strategies.md](workflows/testing-strategies.md).\n\n## When NOT to Use Single-File Scripts\n\nSee [anti-patterns/when-not-to-use.md](anti-patterns/when-not-to-use.md) for details.\n\n**Use a proper project instead when:**\n\n-  Script exceeds 500 lines\n-  Multiple modules/files needed\n-  Complex configuration management\n-  Requires packaging/distribution\n-  Shared library code across multiple scripts\n-  Web applications or long-running services\n\n**Example - Too Complex for Single File:**\n\n```python\n# This should be a uv project, not a script:\n# - 15+ dependencies\n# - Database models\n# - API routes\n# - Background workers\n# - Configuration management\n# - Multiple environments\n```\n\n## Common Patterns\n\nSee pattern guides for complete examples:\n\n- [CLI Applications](patterns/cli-applications.md) - Typer, Click, argparse patterns\n- [API Clients](patterns/api-clients.md) - httpx, requests, authentication\n- [Data Processing](patterns/data-processing.md) - Polars, pandas, analysis\n- [System Automation](patterns/system-automation.md) - psutil, subprocess, system admin\n\n## CI/CD Integration\n\n### GitHub Actions\n\n```yaml\nname: Run Health Checks\n\non:\n  schedule:\n    - cron: '0 */6 * * *'  # Every 6 hours\n\njobs:\n  health-check:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install uv\n        uses: astral-sh/setup-uv@v3\n\n      - name: Check cluster health\n        run: |\n          uv run --script tools/check_cluster_health.py --json\n        env:\n          PROXMOX_TOKEN: ${{ secrets.PROXMOX_TOKEN }}\n```\n\n### GitLab CI\n\n```yaml\ncluster-health:\n  image: ghcr.io/astral-sh/uv:python3.11-bookworm-slim\n  script:\n    - uv run --script tools/check_cluster_health.py\n  only:\n    - schedules\n```\n\nSee [workflows/ci-cd-integration.md](workflows/ci-cd-integration.md).\n\n## Tools Available\n\n### Script Validation\n\n```bash\n# Validate PEP 723 metadata\n./tools/validate_script.py script.py\n\n# Output:\n#  Valid PEP 723 metadata\n#  Python version specified\n#  Dependencies properly formatted\n```\n\n### Script Conversion\n\n```bash\n# Convert requirements.txt-based script to uv\n./tools/convert_to_uv.py old_script.py\n\n# Creates:\n# - old_script_uv.py with inline dependencies\n# - Preserves original script\n```\n\n## Progressive Disclosure\n\nFor deeper knowledge:\n\n### Reference Documentation\n\n- [PEP 723 Specification](reference/pep-723-spec.md) - Complete inline metadata spec\n- [Dependency Management](reference/dependency-management.md) - Version pinning strategies\n- [Security Patterns](reference/security-patterns.md) - Secrets, validation, input sanitization\n\n### Pattern Guides\n\n- [CLI Applications](patterns/cli-applications.md) - Typer, Click, argparse patterns\n- [API Clients](patterns/api-clients.md) - httpx, requests, authentication\n- [Data Processing](patterns/data-processing.md) - Polars, pandas, analysis\n- [System Automation](patterns/system-automation.md) - psutil, subprocess, system admin\n- [Error Handling](patterns/error-handling.md) - Exception handling, logging\n\n> **Note:** See [Common Patterns](#common-patterns) section above for quick access to these guides.\n\n### Working Examples\n\n- [NetBox API Client](examples/04-api-clients/netbox_client.py) - Production-ready API client with Infisical, validation, error handling, and Rich output\n- [Cluster Health Checker](examples/03-production-ready/check_cluster_health_enhanced.py) - Production-ready monitoring script with Typer, Rich, and JSON output\n\n### Anti-Patterns\n\n- [When NOT to Use](anti-patterns/when-not-to-use.md) - Signs you need a proper project\n- [Common Mistakes](anti-patterns/common-mistakes.md) - Pitfalls and how to avoid them\n\n### Workflows\n\n- [Team Adoption](workflows/team-adoption.md) - Rolling out uv scripts across teams\n- [CI/CD Integration](workflows/ci-cd-integration.md) - GitHub Actions, GitLab CI\n- [Testing Strategies](workflows/testing-strategies.md) - Inline tests, pytest integration\n\n## Related Skills\n\n- **Ansible Best Practices** - Many Ansible modules could be standalone uv scripts\n- **Proxmox Infrastructure** - Validation tools use this pattern\n- **NetBox + PowerDNS Integration** - API interaction scripts\n\n## Quick Reference\n\n### Shebang Options\n\n```python\n# Standard script execution\n#!/usr/bin/env -S uv run --script\n\n# Quiet mode (suppress uv output)\n#!/usr/bin/env -S uv run --script --quiet\n\n# With Python version\n#!/usr/bin/env -S uv run --script --python 3.11\n```\n\n### Common Dependencies\n\n```python\n# CLI applications\n\"typer>=0.9.0\"        # Modern CLI framework\n\"click>=8.0.0\"        # Alternative CLI framework\n\"rich>=13.0.0\"        # Rich text and formatting\n\n# API clients\n\"httpx>=0.27.0\"       # Modern async HTTP client\n\"requests>=2.31.0\"    # Traditional HTTP client\n\n# Data processing\n\"polars>=0.20.0\"      # Fast dataframe library\n\"pandas>=2.0.0\"       # Traditional dataframe library\n\n# Infrastructure\n\"ansible>=11.1.0\"     # Automation (from this repo)\n\"infisical-python>=2.3.3\"  # Secrets (from this repo)\n\n# System automation\n\"psutil>=5.9.0\"       # System monitoring\n```\n\n### Metadata Template\n\n```python\n#!/usr/bin/env -S uv run --script --quiet\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\n#   # Add dependencies here\n# ]\n# ///\n\"\"\"\nOne-line description\n\nPurpose: describe-purpose\nTeam: team-name\nAuthor: email@example.com\n\nUsage:\n    python script.py [OPTIONS]\n\nExamples:\n    python script.py --help\n\"\"\"\n```\n\n## Best Practices Summary\n\n1. **Always specify Python version** - `requires-python = \">=3.11\"`\n2. **Pin dependencies appropriately** - Use `>=X.Y.Z` for utilities\n3. **Add metadata in docstrings** - Put team info, purpose, and author in module docstring\n4. **Include comprehensive docstrings** - Document purpose, usage, and examples\n5. **Handle errors gracefully** - Use try/except with clear messages\n6. **Validate inputs** - Check arguments before processing\n7. **Use quiet mode** - `--quiet` flag for production scripts\n8. **Keep it focused** - Single file, single purpose\n9. **Test inline** - Add `--test` flag for simple validation\n10. **Secure secrets** - Never hardcode, use env vars or keyring"
              },
              {
                "name": "netbox-powerdns-integration",
                "description": "NetBox IPAM and PowerDNS integration for automated DNS record management.",
                "path": "plugins/homelab/netbox-powerdns-integration/skills/netbox-powerdns-integration/SKILL.md",
                "frontmatter": {
                  "name": "netbox-powerdns-integration",
                  "description": "NetBox IPAM and PowerDNS integration for automated DNS record management."
                },
                "content": "# NetBox PowerDNS Integration\n\nExpert guidance for implementing NetBox as your source of truth for infrastructure documentation and\nautomating DNS record management with PowerDNS.\n\n## Quick Start\n\n### Common Tasks\n\n**Query NetBox API:**\n\n```bash\n# List all sites\n./tools/netbox_api_client.py sites list\n\n# Get device details\n./tools/netbox_api_client.py devices get --name foxtrot\n\n# List VMs in cluster\n./tools/netbox_api_client.py vms list --cluster matrix\n\n# Query IPs\n./tools/netbox_api_client.py ips query --dns-name docker-01\n```\n\n**Create VM in NetBox:**\n\n```bash\n# Create VM with auto-assigned IP\n./tools/netbox_vm_create.py --name docker-02 --cluster matrix --vcpus 4 --memory 8192\n\n# Create VM with specific IP\n./tools/netbox_vm_create.py --name k8s-01-master --cluster matrix --ip 192.168.3.50/24\n```\n\n**IPAM Queries:**\n\n```bash\n# Get available IPs\n./tools/netbox_ipam_query.py available --prefix 192.168.3.0/24\n\n# Check prefix utilization\n./tools/netbox_ipam_query.py utilization --site matrix\n\n# View IP assignments\n./tools/netbox_ipam_query.py assignments --prefix 192.168.3.0/24\n```\n\n**Validate DNS Naming:**\n\n```bash\n./tools/validate_dns_naming.py --name \"docker-01-nexus.spaceships.work\"\n```\n\n**Deploy from NetBox Inventory:**\n\n```bash\ncd ansible && uv run ansible-playbook -i tools/netbox-dynamic-inventory.yml deploy-from-netbox.yml\n```\n\n## When to Use This Skill\n\nActivate this skill when:\n\n- **Querying NetBox API** - Sites, devices, VMs, IPs, prefixes, VLANs\n- **Setting up NetBox IPAM** - Prefixes, IP management, VRFs\n- **Implementing automated DNS** - PowerDNS sync plugin configuration\n- **Creating DNS naming conventions** - `service-NN-purpose.domain` pattern\n- **Managing VMs in NetBox** - Creating, updating, IP assignment\n- **Using Terraform with NetBox** - Provider configuration and resources\n- **Setting up Ansible dynamic inventory** - NetBox as inventory source\n- **Troubleshooting NetBox-PowerDNS sync** - Tag matching, zone configuration\n- **Migrating to NetBox** - From manual DNS or spreadsheet tracking\n- **Infrastructure documentation** - Using NetBox as source of truth\n\n## Core Workflows\n\n### 1. NetBox API Usage\n\n**Query infrastructure data:**\n\n```python\n#!/usr/bin/env -S uv run --script --quiet\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\"pynetbox>=7.0.0\", \"infisical-python>=2.3.3\"]\n# ///\n\nimport pynetbox\nfrom infisical import InfisicalClient\n\n# Get token from Infisical\nclient = InfisicalClient()\ntoken = client.get_secret(\n    secret_name=\"NETBOX_API_TOKEN\",\n    project_id=\"7b832220-24c0-45bc-a5f1-ce9794a31259\",\n    environment=\"prod\",\n    path=\"/matrix\"\n).secret_value\n\n# Connect to NetBox\nnb = pynetbox.api('https://netbox.spaceships.work', token=token)\n\n# Query devices in Matrix cluster\nsite = nb.dcim.sites.get(slug='matrix')\ndevices = nb.dcim.devices.filter(site='matrix')\n\nfor device in devices:\n    print(f\"{device.name}: {device.primary_ip4.address if device.primary_ip4 else 'No IP'}\")\n```\n\nSee [reference/netbox-api-guide.md](reference/netbox-api-guide.md) for complete API reference.\n\n### 2. DNS Naming Convention\n\nThis infrastructure uses the pattern: `<service>-<number>-<purpose>.<domain>`\n\n**Examples:**\n\n- `docker-01-nexus.spaceships.work` - Docker host #1 running Nexus\n- `proxmox-foxtrot-mgmt.spaceships.work` - Proxmox node Foxtrot management interface\n- `k8s-01-master.spaceships.work` - Kubernetes cluster master node #1\n\n**Implementation:**\n\n```python\n# tools/validate_dns_naming.py validates this pattern\npattern = r'^[a-z0-9-]+-\\d{2}-[a-z0-9-]+\\.[a-z0-9.-]+$'\n```\n\nSee [workflows/naming-conventions.md](workflows/naming-conventions.md) for complete rules.\n\n### 3. NetBox + PowerDNS Sync Setup\n\n#### Step 1: Install Plugin\n\n```bash\n# In NetBox virtualenv\npip install netbox-powerdns-sync\n```\n\n#### Step 2: Configure Plugin\n\n```python\n# /opt/netbox/netbox/netbox/configuration.py\nPLUGINS = ['netbox_powerdns_sync']\n\nPLUGINS_CONFIG = {\n    \"netbox_powerdns_sync\": {\n        \"powerdns_managed_record_comment\": \"netbox-managed\",\n        \"post_save_enabled\": True,  # Real-time sync\n    },\n}\n```\n\n#### Step 3: Create Zones in NetBox\n\nConfigure zones with:\n\n- Zone name (e.g., `spaceships.work`)\n- PowerDNS server connection\n- Tag matching rules (e.g., `production-dns`)\n- DNS name generation method\n\nSee [reference/sync-plugin-reference.md](reference/sync-plugin-reference.md) for details.\n\n### 4. Terraform Integration\n\n**Provider Setup:**\n\n```hcl\nterraform {\n  required_providers {\n    netbox = {\n      source  = \"e-breuninger/netbox\"\n      version = \"~> 5.0.0\"\n    }\n  }\n}\n\nprovider \"netbox\" {\n  server_url = \"https://netbox.spaceships.work\"\n  api_token  = var.netbox_api_token\n}\n```\n\n**Create IP with Auto-DNS:**\n\n```hcl\nresource \"netbox_ip_address\" \"docker_host\" {\n  ip_address  = \"192.168.1.100/24\"\n  dns_name    = \"docker-01-nexus.spaceships.work\"\n  description = \"Docker host for Nexus registry\"\n\n  tags = [\n    \"terraform\",\n    \"production-dns\"  # Triggers auto DNS sync\n  ]\n}\n```\n\nDNS records created automatically by plugin!\n\nSee [reference/terraform-provider-guide.md](reference/terraform-provider-guide.md) and [examples/netbox-terraform-provider.tf](examples/netbox-terraform-provider.tf).\n\n### 5. Ansible Dynamic Inventory\n\n**Use NetBox as Inventory Source:**\n\n```yaml\n# tools/netbox-dynamic-inventory.yml\nplugin: netbox.netbox.nb_inventory\napi_endpoint: https://netbox.spaceships.work\ntoken: !vault |\n  $ANSIBLE_VAULT;...\ngroup_by:\n  - device_roles\n  - tags\n```\n\n**Deploy Using NetBox Data:**\n\n```bash\nansible-playbook -i tools/netbox-dynamic-inventory.yml deploy-from-netbox.yml\n```\n\nSee [workflows/ansible-dynamic-inventory.md](workflows/ansible-dynamic-inventory.md).\n\n## Architecture Reference\n\n### DNS Automation Flow\n\n```text\n1. Create/Update resource in NetBox\n    IP Address with dns_name and tags\n\n2. NetBox PowerDNS Sync Plugin activates\n    Matches IP to zone based on tags\n    Generates DNS records\n\n3. PowerDNS API called\n    A record: docker-01-nexus.spaceships.work  192.168.1.100\n    PTR record: 100.1.168.192.in-addr.arpa  docker-01-nexus.spaceships.work\n\n4. DNS propagates automatically\n    No manual DNS configuration needed\n```\n\n### Integration with Proxmox\n\n```text\nTerraform/Ansible\n  \nCreates VM in Proxmox\n  \nRegisters in NetBox (via API)\n   Device object\n   IP Address with dns_name\n   Tags (production-dns)\n  \nNetBox PowerDNS Sync\n  \nDNS Records in PowerDNS\n  \nAnsible Dynamic Inventory\n  \nAutomated configuration management\n```\n\n## Tools Available\n\n### NetBox API Tools (Python + uv)\n\n**netbox_api_client.py** - Comprehensive NetBox API client\n\n```bash\n# List sites, devices, VMs, IPs\n./tools/netbox_api_client.py sites list\n./tools/netbox_api_client.py devices get --name foxtrot\n./tools/netbox_api_client.py vms list --cluster matrix\n./tools/netbox_api_client.py ips query --dns-name docker-01\n./tools/netbox_api_client.py prefixes available --prefix 192.168.3.0/24\n```\n\n**netbox_vm_create.py** - Create VMs in NetBox with IP assignment\n\n```bash\n# Create VM with auto IP\n./tools/netbox_vm_create.py --name docker-02 --cluster matrix --vcpus 4 --memory 8192\n\n# Create VM with specific IP\n./tools/netbox_vm_create.py --name k8s-01-master --cluster matrix --ip 192.168.3.50/24\n```\n\n**netbox_ipam_query.py** - Advanced IPAM queries\n\n```bash\n# Available IPs\n./tools/netbox_ipam_query.py available --prefix 192.168.3.0/24\n\n# Prefix utilization\n./tools/netbox_ipam_query.py utilization --site matrix\n\n# IP assignments\n./tools/netbox_ipam_query.py assignments --prefix 192.168.3.0/24\n\n# IPAM summary\n./tools/netbox_ipam_query.py summary --site matrix\n```\n\n**validate_dns_naming.py** - Validate DNS naming conventions\n\n```bash\n./tools/validate_dns_naming.py --name \"docker-01-nexus.spaceships.work\"\n```\n\n### Terraform Modules\n\n**netbox-data-sources.tf** - Examples using NetBox provider\n\n- Query existing NetBox resources\n- Use as data sources for other resources\n\n### Ansible Playbooks\n\n**deploy-from-netbox.yml** - Deploy using NetBox inventory\n\n- Dynamic inventory from NetBox\n- Tag-based host selection\n- Automatic IP and hostname discovery\n\nSee [examples/](examples/) directory.\n\n## Troubleshooting\n\n### DNS Records Not Syncing\n\n#### Check 1: Tag Matching\n\n```bash\n# Verify IP has correct tags\n./tools/netbox_query.py --ip 192.168.1.100 | jq '.tags'\n```\n\n#### Check 2: Zone Configuration\n\n- Ensure zone exists in NetBox\n- Verify tag rules match\n- Check PowerDNS server connectivity\n\n#### Check 3: Sync Results\n\n```bash\n./tools/powerdns_sync_check.py --zone spaceships.work --verbose\n```\n\n### Naming Convention Violations\n\n**Validate names before creating:**\n\n```bash\n./tools/validate_dns_naming.py --name \"my-proposed-name.domain\"\n```\n\n**Common mistakes:**\n\n- Uppercase letters (use lowercase only)\n- Missing service number (must be XX format)\n- Wrong domain\n- Special characters (use hyphens only)\n\n### Terraform Provider Issues\n\n**Version mismatch:**\n\n```text\nWarning: NetBox version 4.3.0 not supported by provider 3.9.0\n```\n\n**Solution:** Update provider version:\n\n```hcl\nversion = \"~> 5.0.0\"  # Match NetBox 4.3.x\n```\n\n### Dynamic Inventory Not Working\n\n**Check API connectivity:**\n\n```bash\ncurl -H \"Authorization: Token YOUR_TOKEN\" \\\n  https://netbox.spaceships.work/api/dcim/devices/\n```\n\n**Verify inventory plugin:**\n\n```bash\nansible-inventory -i tools/netbox-dynamic-inventory.yml --list\n```\n\nSee [troubleshooting/](reference/) for more details.\n\n## Best Practices\n\n1. **Consistent naming** - Always follow `service-NN-purpose.domain` pattern\n2. **Use tags** - Tag resources for auto-DNS (`production-dns`, `lab-dns`)\n3. **Document in NetBox** - Single source of truth for all infrastructure\n4. **Real-time sync** - Enable `post_save_enabled` for immediate DNS updates\n5. **Terraform everything** - Manage NetBox resources as IaC\n6. **Dynamic inventory** - Never maintain static Ansible inventory\n7. **Audit regularly** - Run `dns_record_audit.py` to verify sync\n\n## DNS Naming Patterns\n\n### Service Types\n\n- `docker-NN-<app>` - Docker hosts\n- `k8s-NN-<role>` - Kubernetes nodes\n- `proxmox-<node>-<iface>` - Proxmox infrastructure\n- `storage-NN-<purpose>` - Storage systems\n- `db-NN-<dbtype>` - Database servers\n\n### Examples from This Infrastructure\n\n```text\ndocker-01-nexus.spaceships.work       # Nexus container registry\nk8s-01-master.spaceships.work         # K8s control plane\nk8s-02-worker.spaceships.work         # K8s worker node\nproxmox-foxtrot-mgmt.spaceships.work  # Proxmox mgmt interface\nproxmox-foxtrot-ceph.spaceships.work  # Proxmox CEPH interface\nstorage-01-nas.spaceships.work        # NAS storage\ndb-01-postgres.spaceships.work        # PostgreSQL database\n```\n\n## Progressive Disclosure\n\nFor deeper knowledge:\n\n### NetBox API & Integration\n\n- [NetBox API Guide](reference/netbox-api-guide.md) - Complete REST API reference with pynetbox examples\n- [NetBox Data Models](reference/netbox-data-models.md) - Data model relationships and hierarchy\n- [NetBox Best Practices](reference/netbox-best-practices.md) - Security, performance, automation patterns\n\n### DNS & PowerDNS Integration\n\n- [Sync Plugin Reference](reference/sync-plugin-reference.md) - PowerDNS sync plugin installation and config\n- [Terraform Provider Guide](reference/terraform-provider-guide.md) - Complete provider documentation\n- [Naming Conventions](workflows/naming-conventions.md) - Detailed DNS naming rules\n- [DNS Automation](workflows/dns-automation.md) - End-to-end automation workflows\n\n### Ansible Integration\n\n- [Ansible Dynamic Inventory](workflows/ansible-dynamic-inventory.md) - Using NetBox as inventory source\n\n### Anti-Patterns & Common Mistakes\n\n- [Common Mistakes](anti-patterns/common-mistakes.md) - DNS naming violations, cluster domain errors, master node targeting,\n  and NetBox integration pitfalls for spaceships.work infrastructure\n\n## Related Skills\n\n- **Proxmox Infrastructure** - VMs auto-registered in NetBox with DNS\n- **Ansible Best Practices** - Dynamic inventory and secrets management"
              },
              {
                "name": "omni-talos",
                "description": "This skill provides operational tooling and guidance for Omni Proxmox infrastructure. Use PROACTIVELY when the user asks to \"check provider status\", \"restart provider\", \"view provider logs\", \"debug provider registration\", \"create a machine class\", \"configure Proxmox provider\", \"set up CEL storage selectors\", \"create a Talos cluster\", or needs guidance on Omni + Proxmox infrastructure integration for Talos Kubernetes clusters.",
                "path": "plugins/homelab/omni-scale/skills/omni-proxmox/SKILL.md",
                "frontmatter": {
                  "name": "omni-talos",
                  "description": "This skill provides operational tooling and guidance for Omni Proxmox infrastructure. Use PROACTIVELY when the user asks to \"check provider status\", \"restart provider\", \"view provider logs\", \"debug provider registration\", \"create a machine class\", \"configure Proxmox provider\", \"set up CEL storage selectors\", \"create a Talos cluster\", or needs guidance on Omni + Proxmox infrastructure integration for Talos Kubernetes clusters."
                },
                "content": "# Omni + Proxmox Infrastructure Provider\n\nOperational tooling for Talos Linux Kubernetes clusters via Sidero Omni with Proxmox infrastructure provider.\n\n## Provider Operations\n\nUse `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py` for provider management:\n\n| Task | Command |\n|------|---------|\n| View logs | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --logs 50` |\n| Raw JSON logs | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --logs 50 --raw` |\n| Restart provider | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --restart` |\n\nThe provider runs on Foxtrot LXC (CT 200)  script handles SSH automatically.\n\n## Current Deployment\n\n| Component | Location | IP | Endpoint |\n|-----------|----------|-----|----------|\n| Omni | Holly (VMID 101, Quantum) | 192.168.10.20 | omni.spaceships.work |\n| Proxmox Provider | Foxtrot LXC (CT 200, Matrix) | 192.168.3.10 | L2 adjacent to Talos VMs |\n| Target Cluster | Matrix (Foxtrot/Golf/Hotel) | 192.168.3.{5,6,7} | Proxmox API |\n| Storage | CEPH RBD |  | `vm_ssd` pool |\n\n## Quick Reference\n\n**omnictl commands:**\n\n```bash\nomnictl cluster status <cluster-name>\nomnictl get machines -l omni.sidero.dev/cluster=<cluster-name>\nomnictl get machineclasses\nomnictl apply -f machine-classes/<name>.yaml\nomnictl cluster template sync -f clusters/<name>.yaml\n```\n\nNote: `--cluster` flag does not exist. Use label selector `-l` instead.\n\n**MachineClass minimal example:**\n\n```yaml\nmetadata:\n  namespace: default\n  type: MachineClasses.omni.sidero.dev\n  id: matrix-worker\nspec:\n  autoprovision:\n    providerid: matrix-cluster\n    providerdata: |\n      cores: 4\n      memory: 16384\n      disk_size: 100\n      storage_selector: name == \"vm_ssd\"\n      node: foxtrot\n```\n\nSee `references/machine-classes.md` for full field reference.\n\n## Key Constraints\n\n| Constraint | Details |\n|------------|---------|\n| L2 adjacency | Provider MUST be on same L2 as Talos VMs (Foxtrot LXC) |\n| CEL `type` reserved | Use `name` only for storage selectors |\n| Hostname bug | Use `:local-fix` tag, not `:latest` |\n| No CP pinning | Omni allows only 1 ControlPlane section per template |\n| No VM migration | Destroys node state  destroy/recreate instead |\n| Split-horizon DNS | `omni.spaceships.work`  192.168.10.20 (LAN) |\n\n## Reference Files\n\n| File | Content |\n|------|---------|\n| `references/architecture.md` | Network topology, design decisions |\n| `references/machine-classes.md` | Full provider data fields (compute, storage, network, PCI) |\n| `references/provider-setup.md` | Provider config, compose setup, credentials |\n| `references/cluster-templates.md` | Cluster template structure, patches |\n| `references/cel-storage-selectors.md` | CEL syntax and patterns |\n| `references/debugging.md` | Common issues |\n| `references/recovery-procedures.md` | Recovery from stuck states |\n| `references/proxmox-permissions.md` | API token setup |\n| `references/omnictl-auth.md` | Authentication methods |\n\n## Examples\n\n| File | Description |\n|------|-------------|\n| `examples/machineclass-ceph.yaml` | CEPH storage |\n| `examples/machineclass-local.yaml` | Local LVM |\n| `examples/cluster-template.yaml` | Complete cluster |\n| `examples/proxmox-gpu-worker.yaml` | GPU passthrough |\n| `examples/proxmox-storage-node.yaml` | Storage node |\n| `examples/proxmox-worker-multi-net.yaml` | Multi-network |"
              },
              {
                "name": "omni-talos",
                "description": "This skill provides operational tooling and guidance for Omni Proxmox infrastructure. Use when the user asks to \"check provider status\", \"restart provider\", \"view provider logs\", \"debug provider registration\", \"create a machine class\", \"configure Proxmox provider\", \"set up CEL storage selectors\", \"create a Talos cluster\", or needs guidance on Omni + Proxmox infrastructure integration for Talos Kubernetes clusters.",
                "path": "plugins/homelab/omni-scale/skills/omni-talos/SKILL.md",
                "frontmatter": {
                  "name": "omni-talos",
                  "description": "This skill provides operational tooling and guidance for Omni Proxmox infrastructure. Use when the user asks to \"check provider status\", \"restart provider\", \"view provider logs\", \"debug provider registration\", \"create a machine class\", \"configure Proxmox provider\", \"set up CEL storage selectors\", \"create a Talos cluster\", or needs guidance on Omni + Proxmox infrastructure integration for Talos Kubernetes clusters."
                },
                "content": "# Omni + Proxmox Infrastructure Provider\n\nOperational tooling for Talos Linux Kubernetes clusters via Sidero Omni with Proxmox infrastructure provider.\n\n## Provider Operations\n\nUse `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py` for provider management:\n\n| Task | Command |\n|------|---------|\n| View logs | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --logs 50` |\n| Raw JSON logs | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --logs 50 --raw` |\n| Restart provider | `${CLAUDE_PLUGIN_ROOT}/skills/omni-talos/scripts/provider-ctl.py --restart` |\n\nThe provider runs on Foxtrot LXC (CT 200)  script handles SSH automatically.\n\n## Current Deployment\n\n| Component | Location | IP | Endpoint |\n|-----------|----------|-----|----------|\n| Omni | Holly (VMID 101, Quantum) | 192.168.10.20 | omni.spaceships.work |\n| Proxmox Provider | Foxtrot LXC (CT 200, Matrix) | 192.168.3.10 | L2 adjacent to Talos VMs |\n| Target Cluster | Matrix (Foxtrot/Golf/Hotel) | 192.168.3.{5,6,7} | Proxmox API |\n| Storage | CEPH RBD |  | `vm_ssd` pool |\n\n## Quick Reference\n\n**omnictl commands:**\n\n```bash\nomnictl cluster status <cluster-name>\nomnictl get machines -l omni.sidero.dev/cluster=<cluster-name>\nomnictl get machineclasses\nomnictl apply -f machine-classes/<name>.yaml\nomnictl cluster template sync -f clusters/<name>.yaml\n```\n\nNote: `--cluster` flag does not exist. Use label selector `-l` instead.\n\n**MachineClass minimal example:**\n\n```yaml\nmetadata:\n  namespace: default\n  type: MachineClasses.omni.sidero.dev\n  id: matrix-worker\nspec:\n  autoprovision:\n    providerid: matrix-cluster\n    providerdata: |\n      cores: 4\n      memory: 16384\n      disk_size: 100\n      storage_selector: name == \"vm_ssd\"\n      node: foxtrot\n```\n\nSee `references/machine-classes.md` for full field reference.\n\n## Key Constraints\n\n| Constraint | Details |\n|------------|---------|\n| L2 adjacency | Provider MUST be on same L2 as Talos VMs (Foxtrot LXC) |\n| CEL `type` reserved | Use `name` only for storage selectors |\n| Hostname bug | Use `:local-fix` tag, not `:latest` |\n| No CP pinning | Omni allows only 1 ControlPlane section per template |\n| No VM migration | Destroys node state  destroy/recreate instead |\n| Split-horizon DNS | `omni.spaceships.work`  192.168.10.20 (LAN) |\n\n## Reference Files\n\n| File | Content |\n|------|---------|\n| `references/architecture.md` | Network topology, design decisions |\n| `references/machine-classes.md` | Full provider data fields (compute, storage, network, PCI) |\n| `references/provider-setup.md` | Provider config, compose setup, credentials |\n| `references/cluster-templates.md` | Cluster template structure, patches |\n| `references/cel-storage-selectors.md` | CEL syntax and patterns |\n| `references/debugging.md` | Common issues |\n| `references/recovery-procedures.md` | Recovery from stuck states |\n| `references/proxmox-permissions.md` | API token setup |\n| `references/omnictl-auth.md` | Authentication methods |\n\n## Examples\n\n| File | Description |\n|------|-------------|\n| `examples/machineclass-ceph.yaml` | CEPH storage |\n| `examples/machineclass-local.yaml` | Local LVM |\n| `examples/cluster-template.yaml` | Complete cluster |\n| `examples/proxmox-gpu-worker.yaml` | GPU passthrough |\n| `examples/proxmox-storage-node.yaml` | Storage node |\n| `examples/proxmox-worker-multi-net.yaml` | Multi-network |"
              },
              {
                "name": "ansible-error-handling",
                "description": "This skill should be used when implementing error handling in Ansible, using block/rescue/always patterns, creating retry logic with until/retries, handling expected failures gracefully, or providing clear error messages with assert and fail.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-error-handling/SKILL.md",
                "frontmatter": {
                  "name": "ansible-error-handling",
                  "description": "This skill should be used when implementing error handling in Ansible, using block/rescue/always patterns, creating retry logic with until/retries, handling expected failures gracefully, or providing clear error messages with assert and fail.\n"
                },
                "content": "# Ansible Error Handling\n\nPatterns for robust error handling in Ansible playbooks and roles.\n\n## Block/Rescue/Always Pattern\n\nHandle errors and perform cleanup:\n\n```yaml\n- name: Deploy application\n  block:\n    - name: Stop application\n      ansible.builtin.systemd:\n        name: myapp\n        state: stopped\n\n    - name: Deploy new version\n      ansible.builtin.copy:\n        src: myapp-v2.0\n        dest: /usr/bin/myapp\n\n    - name: Start application\n      ansible.builtin.systemd:\n        name: myapp\n        state: started\n\n  rescue:\n    - name: Rollback to previous version\n      ansible.builtin.copy:\n        src: myapp-backup\n        dest: /usr/bin/myapp\n\n    - name: Start application (rollback)\n      ansible.builtin.systemd:\n        name: myapp\n        state: started\n\n    - name: Report failure\n      ansible.builtin.fail:\n        msg: \"Deployment failed, rolled back to previous version\"\n\n  always:\n    - name: Cleanup temp files\n      ansible.builtin.file:\n        path: /tmp/deploy-*\n        state: absent\n```\n\n### Execution Flow\n\n- **block**: Main tasks execute sequentially\n- **rescue**: Runs if ANY task in block fails\n- **always**: Runs regardless of success/failure\n\n## Retry with Until\n\nHandle transient failures with retries:\n\n```yaml\n- name: Wait for service to be ready\n  ansible.builtin.uri:\n    url: http://localhost:8080/health\n    status_code: 200\n  register: health_check\n  until: health_check.status == 200\n  retries: 30\n  delay: 10\n  # Total wait: up to 5 minutes (30 * 10s)\n```\n\n### With Command Module\n\n```yaml\n- name: Wait for cluster to stabilize\n  ansible.builtin.command: pvecm status\n  register: cluster_status\n  until: \"'Quorate: Yes' in cluster_status.stdout\"\n  retries: 12\n  delay: 5\n  changed_when: false\n```\n\n### Retry Parameters\n\n| Parameter | Description |\n|-----------|-------------|\n| `until` | Condition that must be true to stop retrying |\n| `retries` | Maximum number of attempts |\n| `delay` | Seconds between attempts |\n\n## Assert for Validation\n\nValidate inputs with clear error messages:\n\n```yaml\n- name: Validate required variables\n  ansible.builtin.assert:\n    that:\n      - vm_name is defined\n      - vm_name | length > 0\n      - vm_memory >= 1024\n      - vm_cores >= 1\n    fail_msg: |\n      Invalid VM configuration:\n      - vm_name: {{ vm_name | default('NOT SET') }}\n      - vm_memory: {{ vm_memory | default('NOT SET') }} (min: 1024)\n      - vm_cores: {{ vm_cores | default('NOT SET') }} (min: 1)\n    success_msg: \"VM configuration validated\"\n    quiet: true\n```\n\n### Common Assertions\n\n```yaml\n# Variable defined and non-empty\n- vm_name is defined and vm_name | trim | length > 0\n\n# Numeric range\n- vm_memory >= 1024 and vm_memory <= 65536\n\n# Regex match\n- vm_name is match('^[a-z0-9-]+$')\n\n# List has items\n- vm_networks | length > 0\n\n# Value in allowed list\n- vm_ostype in ['l26', 'win10', 'win11']\n```\n\n## Fail with Context\n\nProvide actionable error messages:\n\n```yaml\n- name: Check prerequisites\n  ansible.builtin.command: which docker\n  register: docker_check\n  changed_when: false\n  failed_when: false\n\n- name: Fail if Docker not installed\n  ansible.builtin.fail:\n    msg: |\n      Docker is not installed on {{ inventory_hostname }}.\n\n      To install Docker:\n        sudo apt update\n        sudo apt install docker.io\n\n      Or use the docker role:\n        ansible-playbook playbooks/install-docker.yml\n  when: docker_check.rc != 0\n```\n\n## Graceful Failure Handling\n\nAllow expected \"failures\":\n\n```yaml\n- name: Try to stop service\n  ansible.builtin.systemd:\n    name: myservice\n    state: stopped\n  register: stop_result\n  failed_when:\n    - stop_result.failed\n    - \"'not found' not in stop_result.msg\"\n  # Only fail if error is NOT \"service not found\"\n```\n\n### Multiple Acceptable Conditions\n\n```yaml\n- name: Join cluster\n  ansible.builtin.command: pvecm add {{ primary_node }}\n  register: cluster_join\n  failed_when:\n    - cluster_join.rc != 0\n    - \"'already in a cluster' not in cluster_join.stderr\"\n    - \"'cannot join' not in cluster_join.stderr\"\n  changed_when: cluster_join.rc == 0\n```\n\n## Check Before Fail\n\nSeparate checking from failing for better control:\n\n```yaml\n- name: Check if resource exists\n  ansible.builtin.command: check-resource {{ resource_id }}\n  register: resource_check\n  changed_when: false\n  failed_when: false  # Don't fail here\n\n- name: Fail with context if missing\n  ansible.builtin.fail:\n    msg: |\n      Resource {{ resource_id }} not found.\n      Command output: {{ resource_check.stderr }}\n      Hint: Ensure resource was created first.\n  when: resource_check.rc != 0\n```\n\n## Error Recovery Pattern\n\nAttempt operation, handle specific errors:\n\n```yaml\n- name: Attempt primary approach\n  block:\n    - name: Connect via primary endpoint\n      ansible.builtin.uri:\n        url: \"https://{{ primary_host }}:8006/api2/json\"\n        validate_certs: true\n      register: primary_result\n\n  rescue:\n    - name: Log primary failure\n      ansible.builtin.debug:\n        msg: \"Primary endpoint failed: {{ primary_result.msg | default('unknown error') }}\"\n\n    - name: Try fallback endpoint\n      ansible.builtin.uri:\n        url: \"https://{{ fallback_host }}:8006/api2/json\"\n        validate_certs: false\n      register: fallback_result\n```\n\n## Delegate Error Handling\n\nRun checks from controller for better error context:\n\n```yaml\n- name: Verify API endpoint from controller\n  ansible.builtin.uri:\n    url: \"https://{{ inventory_hostname }}:8006/api2/json/version\"\n    validate_certs: false\n  delegate_to: localhost\n  register: api_check\n  failed_when: false\n\n- name: Report API status\n  ansible.builtin.fail:\n    msg: |\n      Cannot reach Proxmox API on {{ inventory_hostname }}\n      Status: {{ api_check.status | default('connection failed') }}\n      Check: Network connectivity, firewall rules, pveproxy service\n  when: api_check.status | default(0) != 200\n```\n\n## Ignore Errors (Use Sparingly)\n\n```yaml\n- name: Remove optional backup\n  ansible.builtin.file:\n    path: /backup/old-backup.tar.gz\n    state: absent\n  ignore_errors: true\n  register: cleanup_result\n\n- name: Report cleanup status\n  ansible.builtin.debug:\n    msg: \"Cleanup {{ 'successful' if not cleanup_result.failed else 'skipped' }}\"\n```\n\n### When ignore_errors is Acceptable\n\n- Non-critical cleanup tasks\n- Optional operations that shouldn't block playbook\n- When the result is immediately checked anyway\n\n### Prefer failed_when\n\n```yaml\n# BETTER than ignore_errors\n- name: Remove backup\n  ansible.builtin.file:\n    path: /backup/old-backup.tar.gz\n    state: absent\n  register: cleanup_result\n  failed_when:\n    - cleanup_result.failed\n    - \"'does not exist' not in cleanup_result.msg | default('')\"\n```\n\n## Complete Example\n\n```yaml\n---\n- name: Deploy with comprehensive error handling\n  hosts: app_servers\n  become: true\n\n  tasks:\n    - name: Validate configuration\n      ansible.builtin.assert:\n        that:\n          - app_version is defined\n          - app_version is match('^\\d+\\.\\d+\\.\\d+$')\n        fail_msg: \"Invalid app_version: {{ app_version | default('NOT SET') }}\"\n\n    - name: Deploy application\n      block:\n        - name: Download release\n          ansible.builtin.get_url:\n            url: \"https://releases.example.com/{{ app_version }}.tar.gz\"\n            dest: /tmp/app.tar.gz\n          register: download\n          until: download is succeeded\n          retries: 3\n          delay: 5\n\n        - name: Stop current version\n          ansible.builtin.systemd:\n            name: myapp\n            state: stopped\n\n        - name: Extract release\n          ansible.builtin.unarchive:\n            src: /tmp/app.tar.gz\n            dest: /opt/myapp\n            remote_src: true\n\n        - name: Start new version\n          ansible.builtin.systemd:\n            name: myapp\n            state: started\n\n        - name: Verify health\n          ansible.builtin.uri:\n            url: http://localhost:8080/health\n          register: health\n          until: health.status == 200\n          retries: 6\n          delay: 10\n\n      rescue:\n        - name: Restore previous version\n          ansible.builtin.copy:\n            src: /opt/myapp-backup/\n            dest: /opt/myapp/\n            remote_src: true\n\n        - name: Start previous version\n          ansible.builtin.systemd:\n            name: myapp\n            state: started\n\n        - name: Report deployment failure\n          ansible.builtin.fail:\n            msg: |\n              Deployment of {{ app_version }} failed.\n              Previous version restored.\n              Check logs: journalctl -u myapp\n\n      always:\n        - name: Cleanup download\n          ansible.builtin.file:\n            path: /tmp/app.tar.gz\n            state: absent\n```\n\n## Additional Resources\n\nFor detailed error handling patterns and techniques, consult:\n\n- **`references/error-handling.md`** - Comprehensive error handling patterns, block/rescue/always examples, retry strategies\n\n## Related Skills\n\n- **ansible-idempotency** - changed_when/failed_when patterns\n- **ansible-fundamentals** - Core Ansible concepts"
              },
              {
                "name": "ansible-fundamentals",
                "description": "This skill should be used when writing Ansible playbooks, creating Ansible tasks, running ansible-playbook commands, selecting Ansible modules, or working with Ansible collections. Provides golden rules, FQCN requirements, module selection guidance, and execution patterns using uv run.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-fundamentals/SKILL.md",
                "frontmatter": {
                  "name": "ansible-fundamentals",
                  "description": "This skill should be used when writing Ansible playbooks, creating Ansible tasks, running ansible-playbook commands, selecting Ansible modules, or working with Ansible collections. Provides golden rules, FQCN requirements, module selection guidance, and execution patterns using uv run.\n"
                },
                "content": "# Ansible Fundamentals\n\nCore principles and golden rules for writing production-quality Ansible automation.\n\n## Golden Rules\n\nThese rules apply to ALL Ansible code in this repository:\n\n1. **Use `uv run` prefix** - Execute all Ansible commands through uv:\n\n   ```bash\n   uv run ansible-playbook playbooks/my-playbook.yml\n   uv run ansible-lint\n   uv run ansible-galaxy collection install -r requirements.yml\n   ```\n\n2. **Fully Qualified Collection Names (FQCN)** - Avoid short module names:\n\n   ```yaml\n   # CORRECT\n   - name: Install package\n     ansible.builtin.apt:\n       name: nginx\n       state: present\n\n   # WRONG - deprecated short names\n   - name: Install package\n     apt:\n       name: nginx\n   ```\n\n3. **Control command/shell modules** - Add `changed_when` and `failed_when`:\n\n   ```yaml\n   - name: Check if service exists\n     ansible.builtin.command: systemctl status myservice\n     register: service_check\n     changed_when: false\n     failed_when: false\n   ```\n\n4. **Use `set -euo pipefail`** - In all shell scripts and shell module calls:\n\n   ```yaml\n   - name: Run pipeline command\n     ansible.builtin.shell: |\n       set -euo pipefail\n       cat file.txt | grep pattern | wc -l\n     args:\n       executable: /bin/bash\n   ```\n\n5. **Tag sensitive tasks** - Use `no_log: true` for secrets:\n\n   ```yaml\n   - name: Set database password\n     ansible.builtin.command: set-password {{ db_password }}\n     no_log: true\n   ```\n\n6. **Idempotency first** - Check before create, verify after.\n\n7. **Descriptive task names** - Start with action verbs (Ensure, Configure, Install, Create).\n\n## Module Selection Guide\n\n### Decision Matrix\n\n| Need | Use | Why |\n|------|-----|-----|\n| Install packages | `ansible.builtin.apt/yum/dnf` | Native modules handle state |\n| Manage files | `ansible.builtin.copy/template/file` | Idempotent by default |\n| Edit config lines | `ansible.builtin.lineinfile` | Surgical edits, not full replace |\n| Run commands | `ansible.builtin.command` | When no native module exists |\n| Need shell features | `ansible.builtin.shell` | Pipes, redirects, globs |\n| Manage services | `ansible.builtin.systemd/service` | State management built-in |\n| Manage users | `ansible.builtin.user` | Cross-platform, idempotent |\n\n### Prefer Native Modules\n\nNative modules provide:\n\n- Built-in idempotency (no need for `changed_when`)\n- Better error handling\n- Cross-platform compatibility\n- Clear documentation\n\n```yaml\n# PREFER native module\n- name: Create user\n  ansible.builtin.user:\n    name: deploy\n    groups: docker\n    state: present\n\n# AVOID command when module exists\n- name: Create user\n  ansible.builtin.command: useradd -G docker deploy\n  # Requires: changed_when, failed_when, idempotency logic\n```\n\n### When Command/Shell is Acceptable\n\nUse `command` or `shell` modules when:\n\n1. No native module exists for the operation\n2. Interacting with vendor CLI tools (pvecm, pveceph, kubectl)\n3. Running one-off scripts\n\nAdd proper controls:\n\n```yaml\n- name: Create Proxmox API token\n  ansible.builtin.command: >\n    pveum user token add {{ username }}@pam {{ token_name }}\n  register: token_result\n  changed_when: \"'already exists' not in token_result.stderr\"\n  failed_when:\n    - token_result.rc != 0\n    - \"'already exists' not in token_result.stderr\"\n  no_log: true\n```\n\n## Collections in Use\n\nThis repository uses these Ansible collections:\n\n| Collection | Purpose | Example Modules |\n|------------|---------|-----------------|\n| `ansible.builtin` | Core functionality | copy, template, command, user |\n| `ansible.posix` | POSIX systems | authorized_key, synchronize |\n| `community.general` | General utilities | interfaces_file, ini_file |\n| `community.proxmox` | Proxmox VE | proxmox_vm, proxmox_kvm |\n| `infisical.vault` | Secrets management | read_secrets |\n| `community.docker` | Docker management | docker_container, docker_image |\n\n### Installing Collections\n\n```bash\n# Install from requirements\ncd ansible && uv run ansible-galaxy collection install -r requirements.yml\n\n# Install specific collection\nuv run ansible-galaxy collection install community.proxmox\n```\n\n## Common Execution Patterns\n\n### Running Playbooks\n\n```bash\n# Basic execution\nuv run ansible-playbook playbooks/my-playbook.yml\n\n# With extra variables\nuv run ansible-playbook playbooks/create-vm.yml \\\n  -e \"vm_name=docker-01\" \\\n  -e \"vm_memory=4096\"\n\n# Limit to specific hosts\nuv run ansible-playbook playbooks/update.yml --limit proxmox\n\n# Check mode (dry run)\nuv run ansible-playbook playbooks/deploy.yml --check --diff\n\n# With tags\nuv run ansible-playbook playbooks/setup.yml --tags \"network,storage\"\n```\n\n### Linting\n\n```bash\n# Run ansible-lint\nmise run ansible-lint\n\n# Or directly\nuv run ansible-lint ansible/playbooks/\n```\n\n## Task Naming Conventions\n\nUse descriptive names with action verbs:\n\n| Verb | Use When |\n|------|----------|\n| Ensure | Verifying state exists |\n| Configure | Modifying settings |\n| Install | Adding packages |\n| Create | Making new resources |\n| Remove | Deleting resources |\n| Deploy | Releasing applications |\n| Update | Modifying existing resources |\n\nExamples:\n\n```yaml\n- name: Ensure Docker is installed\n- name: Configure SSH security settings\n- name: Create admin user account\n- name: Deploy application configuration\n```\n\n## Variable Naming\n\nUse snake_case with descriptive names:\n\n```yaml\n# GOOD - clear, descriptive\nproxmox_api_user: terraform@pam\ndocker_compose_version: \"2.24.0\"\nvm_memory_mb: 4096\n\n# BAD - vague, abbreviated\npve_usr: terraform@pam\ndc_ver: \"2.24.0\"\nmem: 4096\n```\n\n## Quick Reference Commands\n\n```bash\n# Lint all Ansible files\nmise run ansible-lint\n\n# Run playbook with secrets from Infisical\ncd ansible && uv run ansible-playbook playbooks/my-playbook.yml\n\n# Check syntax\nuv run ansible-playbook --syntax-check playbooks/my-playbook.yml\n\n# List hosts in inventory\nuv run ansible-inventory --list\n\n# Test connection\nuv run ansible all -m ping\n```\n\n## Common Anti-Patterns\n\n### Missing FQCN\n\n```yaml\n# BAD\n- name: Copy file\n  copy:\n    src: file.txt\n    dest: /tmp/\n\n# GOOD\n- name: Copy file\n  ansible.builtin.copy:\n    src: file.txt\n    dest: /tmp/\n```\n\n### Uncontrolled Commands\n\n```yaml\n# BAD - always shows changed, no error handling\n- name: Check status\n  ansible.builtin.command: systemctl status app\n\n# GOOD\n- name: Check status\n  ansible.builtin.command: systemctl status app\n  register: status_check\n  changed_when: false\n  failed_when: false\n```\n\n### Using shell When command Suffices\n\n```yaml\n# BAD - shell not needed\n- name: List files\n  ansible.builtin.shell: ls -la /tmp\n\n# GOOD - command is sufficient\n- name: List files\n  ansible.builtin.command: ls -la /tmp\n  changed_when: false\n```\n\n### Missing no_log on Secrets\n\n```yaml\n# BAD - password in logs\n- name: Set password\n  ansible.builtin.command: set-password {{ password }}\n\n# GOOD\n- name: Set password\n  ansible.builtin.command: set-password {{ password }}\n  no_log: true\n```\n\n## Related Skills\n\n- **ansible-idempotency** - Detailed changed_when/failed_when patterns\n- **ansible-secrets** - Infisical integration and security\n- **ansible-proxmox** - Proxmox-specific module selection\n- **ansible-error-handling** - Block/rescue, retry patterns"
              },
              {
                "name": "ansible-idempotency",
                "description": "This skill should be used when writing idempotent Ansible tasks, using command or shell modules, implementing changed_when and failed_when directives, creating check-before-create patterns, or troubleshooting tasks that always show \"changed\".\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-idempotency/SKILL.md",
                "frontmatter": {
                  "name": "ansible-idempotency",
                  "description": "This skill should be used when writing idempotent Ansible tasks, using command or shell modules, implementing changed_when and failed_when directives, creating check-before-create patterns, or troubleshooting tasks that always show \"changed\".\n"
                },
                "content": "# Ansible Idempotency Patterns\n\nTechniques for ensuring Ansible tasks are truly idempotent - producing the same result\nwhether run once or multiple times.\n\n## Core Directives\n\n### changed_when\n\nControls when Ansible reports a task as \"changed\". Critical for `command` and `shell` modules\nwhich always report changed by default.\n\n```yaml\n- name: Check if service exists\n  ansible.builtin.command: systemctl status myservice\n  register: service_check\n  changed_when: false  # Read-only operation, never changes anything\n```\n\n### failed_when\n\nControls when Ansible considers a task failed. Allows graceful handling of expected errors.\n\n```yaml\n- name: Check resource existence\n  ansible.builtin.command: check-resource {{ resource_id }}\n  register: check_result\n  failed_when: false  # Don't fail, we'll check the result ourselves\n```\n\n### register\n\nCaptures task output for use in `changed_when` and `failed_when` expressions.\n\n```yaml\n- name: Run command\n  ansible.builtin.command: some-command\n  register: cmd_result\n  # Now cmd_result.rc, cmd_result.stdout, cmd_result.stderr are available\n```\n\n## Pattern 1: Detect Actual Changes\n\nMake commands report \"changed\" only when something actually changed:\n\n```yaml\n- name: Create Proxmox API token\n  ansible.builtin.command: >\n    pveum user token add {{ username }}@pam {{ token_name }}\n  register: token_result\n  changed_when: \"'already exists' not in token_result.stderr\"\n  failed_when:\n    - token_result.rc != 0\n    - \"'already exists' not in token_result.stderr\"\n  no_log: true\n```\n\n**Key pattern**: Detect specific output that indicates no change occurred.\n\n## Pattern 2: Check Before Create\n\nCheck if a resource exists before creating it:\n\n```yaml\n- name: Check if VM template exists\n  ansible.builtin.shell: |\n    set -o pipefail\n    qm list | awk '{print $1}' | grep -q \"^{{ template_id }}$\"\n  args:\n    executable: /bin/bash\n  register: template_exists\n  changed_when: false  # Checking doesn't change anything\n  failed_when: false   # Not finding it isn't a failure\n\n- name: Create VM template\n  ansible.builtin.command: >\n    qm create {{ template_id }}\n    --name {{ template_name }}\n    --memory 2048\n  when: template_exists.rc != 0  # Only create if doesn't exist\n  register: create_result\n  changed_when: create_result.rc == 0\n```\n\n## Pattern 3: Verify After Create\n\nConfirm resource creation succeeded:\n\n```yaml\n- name: Create VM\n  ansible.builtin.command: >\n    qm create {{ vmid }} --name {{ vm_name }}\n  register: create_result\n  changed_when: true\n\n- name: Verify VM was created\n  ansible.builtin.shell: |\n    set -o pipefail\n    qm list | grep \"{{ vmid }}\"\n  args:\n    executable: /bin/bash\n  register: verify_result\n  changed_when: false\n  failed_when: verify_result.rc != 0\n```\n\n## Pattern 4: Conditional Change Detection\n\nUse output content to determine if change occurred:\n\n```yaml\n- name: Update cluster configuration\n  ansible.builtin.command: update-config --apply\n  register: update_result\n  changed_when: \"'Configuration updated' in update_result.stdout\"\n  failed_when: \"'Error' in update_result.stderr\"\n```\n\n### Common Patterns\n\n| Output Indicator | changed_when Expression |\n|-----------------|------------------------|\n| \"already exists\" | `\"'already exists' not in result.stderr\"` |\n| \"no changes\" | `\"'no changes' not in result.stdout\"` |\n| \"created\" | `\"'created' in result.stdout\"` |\n| \"updated\" | `\"'updated' in result.stdout\"` |\n| Exit code 0 = created | `result.rc == 0` |\n\n## Pattern 5: Multiple Failure Conditions\n\nAllow specific \"failures\" that are actually expected:\n\n```yaml\n- name: Run database migration\n  ansible.builtin.command: /usr/bin/migrate-database\n  register: migrate_result\n  failed_when:\n    - migrate_result.rc != 0\n    - \"'already applied' not in migrate_result.stdout\"\n    - \"'no pending migrations' not in migrate_result.stdout\"\n  changed_when: \"'applied' in migrate_result.stdout and 'already' not in migrate_result.stdout\"\n```\n\n## Pattern 6: Read-Only Operations\n\nMark read-only operations as never changed:\n\n```yaml\n# Checking status\n- name: Get cluster status\n  ansible.builtin.command: pvecm status\n  register: cluster_status\n  changed_when: false\n  failed_when: false\n\n# Gathering information\n- name: List available images\n  ansible.builtin.command: qm list\n  register: vm_list\n  changed_when: false\n\n# Verification checks\n- name: Verify service is running\n  ansible.builtin.command: systemctl is-active nginx\n  register: nginx_status\n  changed_when: false\n  failed_when: false\n```\n\n## Pattern 7: Retry Until Success\n\nUse `until` for operations that may need retries:\n\n```yaml\n- name: Wait for service to be ready\n  ansible.builtin.uri:\n    url: http://localhost:8080/health\n    status_code: 200\n  register: health_check\n  until: health_check.status == 200\n  retries: 30\n  delay: 10\n  # Total wait: up to 5 minutes\n```\n\nWith command:\n\n```yaml\n- name: Wait for VM to get IP address\n  ansible.builtin.command: qm agent {{ vmid }} network-get-interfaces\n  register: vm_network\n  until: vm_network.rc == 0\n  retries: 12\n  delay: 5\n  changed_when: false\n```\n\n## Pattern 8: Set Facts for State\n\nUse facts to track state across tasks:\n\n```yaml\n- name: Check existing cluster status\n  ansible.builtin.command: pvecm status\n  register: cluster_status\n  failed_when: false\n  changed_when: false\n\n- name: Set cluster facts\n  ansible.builtin.set_fact:\n    is_cluster_member: \"{{ cluster_status.rc == 0 }}\"\n    in_target_cluster: \"{{ cluster_name in cluster_status.stdout }}\"\n\n- name: Create cluster\n  ansible.builtin.command: pvecm create {{ cluster_name }}\n  when: not in_target_cluster\n  register: cluster_create\n  changed_when: cluster_create.rc == 0\n```\n\n## Anti-Patterns to Avoid\n\n### Always Changed\n\n```yaml\n# BAD - Always shows changed\n- name: Check status\n  ansible.builtin.command: systemctl status app\n\n# GOOD\n- name: Check status\n  ansible.builtin.command: systemctl status app\n  register: status_check\n  changed_when: false\n  failed_when: false\n```\n\n### Silent Failure Suppression\n\n```yaml\n# BAD - Hides all errors\n- name: Critical operation\n  ansible.builtin.command: important-command\n  failed_when: false\n\n# GOOD - Only allow expected \"errors\"\n- name: Critical operation\n  ansible.builtin.command: important-command\n  register: result\n  failed_when:\n    - result.rc != 0\n    - \"'expected condition' not in result.stderr\"\n```\n\n### No Output Capture\n\n```yaml\n# BAD - Can't check results\n- name: Run command\n  ansible.builtin.command: create-resource\n\n# GOOD\n- name: Run command\n  ansible.builtin.command: create-resource\n  register: result\n  changed_when: \"'created' in result.stdout\"\n```\n\n## Shell Script Requirements\n\nUse strict error handling in shell scripts:\n\n```yaml\n- name: Run pipeline\n  ansible.builtin.shell: |\n    set -euo pipefail\n    cat data.txt | grep pattern | sort | uniq\n  args:\n    executable: /bin/bash\n  register: pipeline_result\n  changed_when: false\n```\n\n### Why set -euo pipefail?\n\n| Flag | Purpose |\n|------|---------|\n| `-e` | Exit on any command failure |\n| `-u` | Error on undefined variables |\n| `-o pipefail` | Catch errors in pipelines |\n\n## Testing Idempotency\n\nVerify playbooks are idempotent by running twice:\n\n```bash\n# First run - may show changes\nuv run ansible-playbook playbooks/setup.yml\n\n# Second run - should show 0 changes\nuv run ansible-playbook playbooks/setup.yml\n\n# If second run shows changes, playbook is NOT idempotent\n```\n\n## Common changed_when Expressions\n\n```yaml\n# Never changed (read-only)\nchanged_when: false\n\n# Always changed (one-time operations)\nchanged_when: true\n\n# Based on output content\nchanged_when: \"'created' in result.stdout\"\nchanged_when: \"'already exists' not in result.stderr\"\nchanged_when: \"'updated' in result.stdout\"\n\n# Based on return code\nchanged_when: result.rc == 0\nchanged_when: result.rc != 1\n\n# Complex conditions\nchanged_when:\n  - result.rc == 0\n  - \"'no changes' not in result.stdout\"\n```\n\n## Utility Script\n\nUse the idempotency checker to analyze playbooks for common issues:\n\n```bash\n# Check a single playbook\n${CLAUDE_PLUGIN_ROOT}/skills/ansible-idempotency/scripts/check_idempotency.py ansible/playbooks/my-playbook.yml\n\n# Check multiple playbooks\n${CLAUDE_PLUGIN_ROOT}/skills/ansible-idempotency/scripts/check_idempotency.py ansible/playbooks/*.yml\n\n# Strict mode (info issues become warnings)\n${CLAUDE_PLUGIN_ROOT}/skills/ansible-idempotency/scripts/check_idempotency.py --strict ansible/playbooks/my-playbook.yml\n\n# Summary only\n${CLAUDE_PLUGIN_ROOT}/skills/ansible-idempotency/scripts/check_idempotency.py --summary ansible/playbooks/*.yml\n```\n\nThe script detects:\n\n- Command/shell tasks without `changed_when`\n- Shell tasks without `set -euo pipefail`\n- Tasks missing `no_log` that may contain secrets\n- Tasks missing name attribute\n- Use of deprecated short module names (non-FQCN)\n\nScript location: `${CLAUDE_PLUGIN_ROOT}/skills/ansible-idempotency/scripts/check_idempotency.py`\n\n## Related Skills\n\n- **ansible-error-handling** - Block/rescue patterns\n- **ansible-fundamentals** - Module selection (prefer native modules)\n- **ansible-proxmox** - Proxmox-specific idempotency patterns"
              },
              {
                "name": "ansible-playbook-design",
                "description": "This skill should be used when creating new Ansible playbooks, designing playbook structure, implementing state-based playbooks with present/absent patterns, organizing plays and tasks, or structuring playbook variables. Covers play organization, variable scoping, and state-based design patterns.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-playbook-design/SKILL.md",
                "frontmatter": {
                  "name": "ansible-playbook-design",
                  "description": "This skill should be used when creating new Ansible playbooks, designing playbook structure, implementing state-based playbooks with present/absent patterns, organizing plays and tasks, or structuring playbook variables. Covers play organization, variable scoping, and state-based design patterns.\n"
                },
                "content": "# Ansible Playbook Design\n\nPatterns for designing well-structured, maintainable Ansible playbooks.\n\n## State-Based Playbook Pattern\n\nDesign playbooks to handle both creation and removal via a `state` variable.\n\n### Core Pattern\n\n```yaml\n---\n- name: Manage admin user account\n  hosts: all\n  become: true\n\n  vars:\n    admin_state: present  # or absent\n\n  tasks:\n    - name: Create admin user\n      ansible.builtin.user:\n        name: \"{{ admin_name }}\"\n        groups: \"{{ admin_groups }}\"\n        state: \"{{ admin_state }}\"\n\n    - name: Configure SSH key\n      ansible.posix.authorized_key:\n        user: \"{{ admin_name }}\"\n        key: \"{{ admin_ssh_key }}\"\n        state: \"{{ admin_state }}\"\n      when: admin_state == 'present'\n```\n\n### Usage\n\n```bash\n# Create user (default)\nuv run ansible-playbook playbooks/manage-admin.yml \\\n  -e \"admin_name=alice\" \\\n  -e \"admin_ssh_key='ssh-ed25519 AAAA...'\"\n\n# Remove user\nuv run ansible-playbook playbooks/manage-admin.yml \\\n  -e \"admin_name=alice\" \\\n  -e \"admin_state=absent\"\n```\n\n### Benefits\n\n- Single source of truth\n- Consistent interface\n- Less code duplication\n- Follows community role conventions\n\n## Play Structure\n\n### Recommended Play Sections\n\nOrder sections consistently across all playbooks:\n\n```yaml\n---\n- name: Descriptive play name\n  hosts: target_group\n  become: true\n  gather_facts: true\n\n  vars:\n    # Play-level variables\n    app_version: \"2.0.0\"\n\n  vars_files:\n    # External variable files\n    - vars/secrets.yml\n\n  pre_tasks:\n    # Tasks that must run before roles\n    - name: Update apt cache\n      ansible.builtin.apt:\n        update_cache: true\n        cache_valid_time: 3600\n\n  roles:\n    # Role includes\n    - role: common\n    - role: app_deploy\n      vars:\n        deploy_version: \"{{ app_version }}\"\n\n  tasks:\n    # Play-specific tasks\n    - name: Verify deployment\n      ansible.builtin.uri:\n        url: http://localhost:8080/health\n\n  post_tasks:\n    # Cleanup or finalization\n    - name: Send deployment notification\n      ansible.builtin.debug:\n        msg: \"Deployment complete\"\n\n  handlers:\n    # Event-triggered tasks\n    - name: restart app\n      ansible.builtin.systemd:\n        name: myapp\n        state: restarted\n```\n\n## Variable Organization\n\n### Variable Precedence (Key Levels)\n\nFrom lowest to highest precedence:\n\n1. Role defaults (`roles/x/defaults/main.yml`)\n2. Inventory group_vars (`group_vars/all.yml`)\n3. Inventory host_vars (`host_vars/hostname.yml`)\n4. Play vars (`vars:` in playbook)\n5. Task vars (`vars:` on task)\n6. Extra vars (`-e` on command line) - **highest**\n\n### Organizing Variables\n\n```text\nansible/\n group_vars/\n    all.yml           # Variables for ALL hosts\n    proxmox.yml       # Proxmox cluster hosts\n    docker_hosts.yml  # Docker host group\n host_vars/\n    node01.yml        # Host-specific overrides\n    node02.yml\n playbooks/\n     deploy.yml        # Uses vars: for playbook-specific\n```\n\n### Variable Naming by Scope\n\n```yaml\n# group_vars/all.yml - Global defaults\ndefault_timezone: \"UTC\"\nntp_servers:\n  - 0.pool.ntp.org\n  - 1.pool.ntp.org\n\n# group_vars/proxmox.yml - Group-specific\nproxmox_api_host: \"192.168.1.10\"\nproxmox_cluster_name: \"production\"\n\n# host_vars/node01.yml - Host-specific overrides\nproxmox_node_id: 1\nceph_osd_devices:\n  - /dev/sdb\n  - /dev/sdc\n```\n\n## Task Organization with Includes\n\n### When to Split Tasks\n\nSplit playbook tasks into separate files when:\n\n- Tasks exceed 50 lines\n- Logical groupings emerge (networking, storage, users)\n- Conditional sections can be skipped entirely\n\n### Include Patterns\n\n```yaml\n# playbooks/setup-cluster.yml\n---\n- name: Setup Proxmox cluster\n  hosts: proxmox\n  become: true\n\n  tasks:\n    - name: Configure networking\n      ansible.builtin.include_tasks: tasks/networking.yml\n\n    - name: Setup storage\n      ansible.builtin.include_tasks: tasks/storage.yml\n      when: setup_storage | default(true)\n\n    - name: Initialize cluster\n      ansible.builtin.include_tasks: tasks/cluster-init.yml\n      when: inventory_hostname == groups['proxmox'][0]\n```\n\n### import_tasks vs include_tasks\n\n| Feature | import_tasks | include_tasks |\n|---------|--------------|---------------|\n| When evaluated | Parse time (static) | Runtime (dynamic) |\n| Supports loops | No | Yes |\n| Supports conditionals on import | Limited | Full |\n| Use case | Ordered execution | Conditional/looped |\n\n```yaml\n# Static import - always loaded, order matters\n- ansible.builtin.import_tasks: users.yml\n- ansible.builtin.import_tasks: permissions.yml\n\n# Dynamic include - conditional, looped\n- ansible.builtin.include_tasks: \"setup-{{ ansible_os_family }}.yml\"\n- ansible.builtin.include_tasks: deploy-app.yml\n  loop: \"{{ applications }}\"\n```\n\n## Multi-Play Playbooks\n\nUse multiple plays for different host groups or privilege levels:\n\n```yaml\n---\n# Play 1: Gather facts from all nodes\n- name: Gather cluster information\n  hosts: proxmox\n  gather_facts: true\n  tasks:\n    - name: Set cluster facts\n      ansible.builtin.set_fact:\n        cluster_node_count: \"{{ groups['proxmox'] | length }}\"\n\n# Play 2: Initialize primary node\n- name: Initialize cluster on primary\n  hosts: proxmox[0]\n  become: true\n  tasks:\n    - name: Create cluster\n      ansible.builtin.command: pvecm create {{ cluster_name }}\n      when: not cluster_exists\n\n# Play 3: Join secondary nodes\n- name: Join cluster on secondary nodes\n  hosts: proxmox[1:]\n  become: true\n  serial: 1  # One node at a time\n  tasks:\n    - name: Join cluster\n      ansible.builtin.command: pvecm add {{ primary_node }}\n      when: not node_in_cluster\n```\n\n## Handler Best Practices\n\n### Define Handlers at Play Level\n\n```yaml\n---\n- name: Configure web server\n  hosts: webservers\n  become: true\n\n  tasks:\n    - name: Update nginx config\n      ansible.builtin.template:\n        src: nginx.conf.j2\n        dest: /etc/nginx/nginx.conf\n      notify: reload nginx\n\n    - name: Update SSL certificates\n      ansible.builtin.copy:\n        src: \"{{ item }}\"\n        dest: /etc/nginx/ssl/\n      loop:\n        - cert.pem\n        - key.pem\n      notify: reload nginx\n\n  handlers:\n    - name: reload nginx\n      ansible.builtin.systemd:\n        name: nginx\n        state: reloaded\n```\n\n### Handler Execution Order\n\nHandlers run:\n\n1. At the end of each play\n2. In the order they are defined (not notified)\n3. Only once, even if notified multiple times\n\nForce immediate handler execution:\n\n```yaml\n- name: Update critical config\n  ansible.builtin.template:\n    src: config.j2\n    dest: /etc/app/config.yml\n  notify: restart app\n\n- name: Flush handlers now\n  ansible.builtin.meta: flush_handlers\n\n- name: Verify app is running\n  ansible.builtin.uri:\n    url: http://localhost:8080/health\n```\n\n## Playbook Validation\n\n### Pre-flight Checks\n\nAdd validation at the start of playbooks:\n\n```yaml\n---\n- name: Deploy application\n  hosts: app_servers\n  become: true\n\n  tasks:\n    - name: Validate required variables\n      ansible.builtin.assert:\n        that:\n          - app_version is defined\n          - app_version | regex_search('^\\d+\\.\\d+\\.\\d+$')\n          - deploy_env in ['staging', 'production']\n        fail_msg: \"Invalid configuration. Check app_version and deploy_env.\"\n\n    - name: Check disk space\n      ansible.builtin.assert:\n        that: ansible_mounts | selectattr('mount', 'equalto', '/') | map(attribute='size_available') | first > 1073741824\n        fail_msg: \"Insufficient disk space. Need at least 1GB free.\"\n```\n\n## Template Patterns\n\n### Playbook Template Structure\n\n```yaml\n---\n# playbooks/template-playbook.yml\n# Description: [What this playbook does]\n# Usage: uv run ansible-playbook playbooks/template-playbook.yml -e \"var=value\"\n# Requirements: [Any prerequisites]\n\n- name: [Descriptive play name]\n  hosts: [target_group]\n  become: [true/false]\n  gather_facts: [true/false]\n\n  vars:\n    # Configurable variables with defaults\n    resource_state: present\n\n  tasks:\n    - name: Validate inputs\n      ansible.builtin.assert:\n        that:\n          - required_var is defined\n        fail_msg: \"required_var must be defined\"\n\n    # Main tasks...\n\n    - name: Verify completion\n      ansible.builtin.debug:\n        msg: \"Playbook completed successfully\"\n```\n\n## Additional Resources\n\nFor detailed playbook patterns and techniques, consult:\n\n- **`references/playbook-role-patterns.md`** - Comprehensive playbook organization patterns, play structure, import strategies\n\n## Related Skills\n\n- **ansible-role-design** - When to use roles vs playbooks\n- **ansible-fundamentals** - Core module selection and naming\n- **ansible-error-handling** - Block/rescue patterns in playbooks"
              },
              {
                "name": "ansible-proxmox",
                "description": "This skill should be used when automating Proxmox VE with Ansible, creating VMs or templates, managing Proxmox clusters, using community.proxmox collection, or deciding between native modules and CLI commands (pvecm, pveceph, qm).\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-proxmox/SKILL.md",
                "frontmatter": {
                  "name": "ansible-proxmox",
                  "description": "This skill should be used when automating Proxmox VE with Ansible, creating VMs or templates, managing Proxmox clusters, using community.proxmox collection, or deciding between native modules and CLI commands (pvecm, pveceph, qm).\n"
                },
                "content": "# Ansible Proxmox Integration\n\nExpert Proxmox automation using community.proxmox collection with minimal CLI usage.\n\n## Module Selection\n\n### Prefer Native Modules\n\nUse `community.proxmox` modules when available:\n\n| Operation | Use Module | NOT CLI |\n|-----------|------------|---------|\n| Create VM | `community.proxmox.proxmox_kvm` | `qm create` |\n| Clone VM | `community.proxmox.proxmox_kvm` | `qm clone` |\n| Manage users | `community.proxmox.proxmox_user` | `pveum user` |\n| Manage groups | `community.proxmox.proxmox_group` | `pveum group` |\n| Manage pools | `community.proxmox.proxmox_pool` | `pveum pool` |\n| Manage ACLs | `community.proxmox.proxmox_acl` | `pveum acl` |\n| Storage | `community.proxmox.proxmox_storage` | `pvesm` |\n\n### When CLI is Required\n\nSome operations lack native modules:\n\n| Operation | Requires CLI | Reason |\n|-----------|--------------|--------|\n| Cluster create | `pvecm create` | No module exists |\n| Cluster join | `pvecm add` | No module exists |\n| CEPH init | `pveceph init` | Complex workflow |\n| CEPH OSD | `pveceph osd create` | Complex workflow |\n\n## Native Module Examples\n\n### Create VM from Template\n\n```yaml\n- name: Create VM from template\n  community.proxmox.proxmox_kvm:\n    api_host: \"{{ proxmox_api_host }}\"\n    api_user: \"{{ proxmox_api_user }}\"\n    api_token_id: \"{{ proxmox_token_id }}\"\n    api_token_secret: \"{{ proxmox_token_secret }}\"\n    node: \"{{ proxmox_node }}\"\n    vmid: \"{{ vm_id }}\"\n    name: \"{{ vm_name }}\"\n    clone: \"{{ template_name }}\"\n    full: true\n    storage: local-lvm\n    memory: \"{{ vm_memory | default(4096) }}\"\n    cores: \"{{ vm_cores | default(2) }}\"\n    state: present\n  delegate_to: localhost\n```\n\n### Manage Proxmox User\n\n```yaml\n- name: Create Terraform user\n  community.proxmox.proxmox_user:\n    api_host: \"{{ proxmox_api_host }}\"\n    api_user: \"root@pam\"\n    api_password: \"{{ proxmox_root_password }}\"\n    userid: \"terraform@pve\"\n    comment: \"Terraform automation user\"\n    groups:\n      - automation\n    state: present\n  no_log: true\n  delegate_to: localhost\n```\n\n### Configure ACLs\n\n```yaml\n- name: Grant terraform permissions\n  community.proxmox.proxmox_acl:\n    api_host: \"{{ proxmox_api_host }}\"\n    api_user: \"{{ proxmox_api_user }}\"\n    api_token_id: \"{{ proxmox_token_id }}\"\n    api_token_secret: \"{{ proxmox_token_secret }}\"\n    path: \"/\"\n    users:\n      - terraform@pve\n    roles:\n      - Administrator\n    state: present\n  delegate_to: localhost\n```\n\n## CLI with Idempotency\n\nWhen CLI is required, add proper idempotency controls:\n\n### Cluster Formation\n\n```yaml\n- name: Check existing cluster status\n  ansible.builtin.command: pvecm status\n  register: cluster_status\n  failed_when: false\n  changed_when: false\n\n- name: Set cluster facts\n  ansible.builtin.set_fact:\n    is_cluster_member: \"{{ cluster_status.rc == 0 }}\"\n    in_target_cluster: \"{{ cluster_name in cluster_status.stdout }}\"\n\n- name: Create cluster on primary node\n  ansible.builtin.command: pvecm create {{ cluster_name }}\n  when:\n    - inventory_hostname == groups['proxmox'][0]\n    - not in_target_cluster\n  register: cluster_create\n  changed_when: cluster_create.rc == 0\n\n- name: Join cluster on secondary nodes\n  ansible.builtin.command: pvecm add {{ hostvars[groups['proxmox'][0]].ansible_host }}\n  when:\n    - inventory_hostname != groups['proxmox'][0]\n    - not is_cluster_member\n  register: cluster_join\n  changed_when: cluster_join.rc == 0\n```\n\n### API Token Creation\n\n```yaml\n- name: Create API token\n  ansible.builtin.command: >\n    pveum user token add {{ username }}@pam {{ token_name }}\n    --privsep 0\n  register: token_result\n  changed_when: \"'already exists' not in token_result.stderr\"\n  failed_when:\n    - token_result.rc != 0\n    - \"'already exists' not in token_result.stderr\"\n  no_log: true\n```\n\n## Authentication Patterns\n\n### API Token (Recommended)\n\n```yaml\n# Store token in variables or Infisical\nproxmox_api_host: \"192.168.1.10\"\nproxmox_api_user: \"terraform@pve\"\nproxmox_token_id: \"automation\"\nproxmox_token_secret: \"{{ lookup('infisical', 'PROXMOX_TOKEN_SECRET') }}\"\n\n- name: Create VM\n  community.proxmox.proxmox_kvm:\n    api_host: \"{{ proxmox_api_host }}\"\n    api_user: \"{{ proxmox_api_user }}\"\n    api_token_id: \"{{ proxmox_token_id }}\"\n    api_token_secret: \"{{ proxmox_token_secret }}\"\n    # ... rest of config\n```\n\n### Root Password (Local Operations)\n\nFor operations on Proxmox nodes themselves:\n\n```yaml\n- name: Retrieve root password\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'PROXMOX_ROOT_PASSWORD'\n    secret_var_name: 'proxmox_root_password'\n\n- name: Configure via API\n  community.proxmox.proxmox_user:\n    api_host: \"{{ inventory_hostname }}\"\n    api_user: \"root@pam\"\n    api_password: \"{{ proxmox_root_password }}\"\n    # ... config\n  no_log: true\n```\n\n## Cluster Operations\n\n### Idempotent Cluster Status Check\n\n```yaml\n- name: Get cluster status\n  ansible.builtin.command: pvecm status\n  register: cluster_status\n  changed_when: false\n  failed_when: false\n\n- name: Get cluster nodes\n  ansible.builtin.command: pvecm nodes\n  register: cluster_nodes\n  changed_when: false\n  failed_when: false\n  when: cluster_status.rc == 0\n\n- name: Set cluster facts\n  ansible.builtin.set_fact:\n    cluster_exists: \"{{ cluster_status.rc == 0 }}\"\n    cluster_node_count: \"{{ cluster_nodes.stdout_lines | length | default(0) }}\"\n    is_quorate: \"{{ 'Quorate: Yes' in cluster_status.stdout | default('') }}\"\n```\n\n### Verify Cluster Health\n\n```yaml\n- name: Verify cluster quorum\n  ansible.builtin.command: pvecm status\n  register: cluster_health\n  changed_when: false\n  failed_when: \"'Quorate: Yes' not in cluster_health.stdout\"\n\n- name: Verify expected node count\n  ansible.builtin.command: pvecm nodes\n  register: nodes_check\n  changed_when: false\n  failed_when: nodes_check.stdout_lines | length != groups['proxmox'] | length\n```\n\n## CEPH Integration\n\n### Initialize CEPH\n\n```yaml\n- name: Check if CEPH is initialized\n  ansible.builtin.command: pveceph status\n  register: ceph_status\n  changed_when: false\n  failed_when: false\n\n- name: Initialize CEPH\n  ansible.builtin.command: >\n    pveceph init --network {{ ceph_network }}\n  when:\n    - inventory_hostname == groups['proxmox'][0]\n    - ceph_status.rc != 0\n  register: ceph_init\n  changed_when: ceph_init.rc == 0\n```\n\n### Create OSD\n\n```yaml\n- name: Check if OSD exists on device\n  ansible.builtin.command: >\n    pveceph osd list\n  register: osd_list\n  changed_when: false\n\n- name: Create OSD\n  ansible.builtin.command: >\n    pveceph osd create {{ item }}\n  loop: \"{{ ceph_osd_devices }}\"\n  when: item not in osd_list.stdout\n  register: osd_create\n  changed_when: osd_create.rc == 0\n```\n\n## Network Configuration\n\nUse `community.general.interfaces_file` for network config:\n\n```yaml\n- name: Configure VLAN-aware bridge\n  community.general.interfaces_file:\n    iface: vmbr1\n    option: bridge-vlan-aware\n    value: \"yes\"\n    backup: true\n    state: present\n  notify: reload network\n\n- name: Set bridge ports\n  community.general.interfaces_file:\n    iface: vmbr1\n    option: bridge-ports\n    value: \"bond0\"\n    backup: true\n    state: present\n  notify: reload network\n```\n\n## Anti-Patterns\n\n### Using CLI When Module Exists\n\n```yaml\n# BAD - Module exists for this\n- name: Create user\n  ansible.builtin.command: pveum user add terraform@pve\n\n# GOOD\n- name: Create user\n  community.proxmox.proxmox_user:\n    api_host: \"{{ proxmox_api_host }}\"\n    api_user: \"root@pam\"\n    api_password: \"{{ password }}\"\n    userid: \"terraform@pve\"\n    state: present\n```\n\n### Missing Idempotency on CLI\n\n```yaml\n# BAD - Will fail on second run\n- name: Create cluster\n  ansible.builtin.command: pvecm create MyCluster\n\n# GOOD\n- name: Check cluster status\n  ansible.builtin.command: pvecm status\n  register: cluster_check\n  changed_when: false\n  failed_when: false\n\n- name: Create cluster\n  ansible.builtin.command: pvecm create MyCluster\n  when: cluster_check.rc != 0\n```\n\n### Running on Wrong Host\n\n```yaml\n# BAD - API calls from managed node\n- name: Create VM\n  community.proxmox.proxmox_kvm:\n    api_host: \"{{ inventory_hostname }}\"  # Calling itself\n    # ...\n\n# GOOD - Delegate API calls to localhost\n- name: Create VM\n  community.proxmox.proxmox_kvm:\n    api_host: \"{{ proxmox_api_host }}\"\n    # ...\n  delegate_to: localhost\n```\n\n## Installing the Collection\n\n```bash\n# Install community.proxmox\nuv run ansible-galaxy collection install community.proxmox\n\n# Or via requirements.yml\ncd ansible\nuv run ansible-galaxy collection install -r requirements.yml\n```\n\n## Additional Resources\n\nFor detailed Proxmox automation patterns, consult:\n\n- **`references/ceph-automation.md`** - CEPH storage deployment and OSD management\n- **`references/cluster-automation.md`** - Proxmox cluster creation and node joining\n- **`references/network-automation.md`** - VLAN-aware bridges and network configuration\n- **`references/community-proxmox-plugin-index.md`** - Complete community.proxmox module reference\n\n## Related Skills\n\n- **ansible-fundamentals** - Core module selection patterns\n- **ansible-idempotency** - Making CLI commands idempotent\n- **ansible-error-handling** - Error recovery for cluster operations"
              },
              {
                "name": "ansible-role-design",
                "description": "This skill should be used when creating Ansible roles, designing role directory structure, organizing role variables in defaults vs vars, writing role handlers, or structuring role tasks. Based on analysis of 7 production geerlingguy roles.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-role-design/SKILL.md",
                "frontmatter": {
                  "name": "ansible-role-design",
                  "description": "This skill should be used when creating Ansible roles, designing role directory structure, organizing role variables in defaults vs vars, writing role handlers, or structuring role tasks. Based on analysis of 7 production geerlingguy roles.\n"
                },
                "content": "# Ansible Role Design\n\nProduction-grade role structure patterns derived from analysis of 7 geerlingguy roles.\n\n## Standard Directory Structure\n\nEvery Ansible role follows this organizational pattern:\n\n```text\nrole-name/\n defaults/\n    main.yml          # User-configurable defaults (lowest precedence)\n vars/\n    Debian.yml        # OS-specific internal values\n    RedHat.yml\n tasks/\n    main.yml          # Task router\n    install.yml       # Feature-specific tasks\n    configure.yml\n handlers/\n    main.yml          # Event-triggered tasks\n templates/\n    config.conf.j2    # Jinja2 templates\n files/\n    static-file.txt   # Static files\n meta/\n    main.yml          # Role metadata, dependencies\n README.md             # Documentation\n```\n\n### Directory Purposes\n\n| Directory | Purpose | Precedence |\n|-----------|---------|------------|\n| `defaults/` | User-overridable values | Lowest |\n| `vars/` | Internal/OS-specific values | High |\n| `tasks/` | Ansible tasks | N/A |\n| `handlers/` | Service restarts, reloads | N/A |\n| `templates/` | Jinja2 config files | N/A |\n| `files/` | Static files to copy | N/A |\n| `meta/` | Galaxy info, dependencies | N/A |\n\n### When to Omit Directories\n\nOnly create directories that are actually needed:\n\n- **Omit `templates/`** if using only `lineinfile` or `copy`\n- **Omit `handlers/`** if role doesn't manage services\n- **Omit `vars/`** if no OS-specific differences\n- **Omit `files/`** if no static files to copy\n\n## Task Organization\n\n### Main Task File as Router\n\nUse `tasks/main.yml` as a routing file that includes feature-specific files:\n\n```yaml\n# tasks/main.yml\n---\n- name: Include OS-specific variables\n  ansible.builtin.include_vars: \"{{ ansible_os_family }}.yml\"\n\n- name: Install packages\n  ansible.builtin.include_tasks: install.yml\n\n- name: Configure service\n  ansible.builtin.include_tasks: configure.yml\n\n- name: Setup users\n  ansible.builtin.include_tasks: users.yml\n  when: role_users | length > 0\n```\n\n### When to Split Tasks\n\n| Scenario | Approach |\n|----------|----------|\n| < 30 lines | Keep in main.yml |\n| 30-100 lines | Consider splitting |\n| > 100 lines | Definitely split |\n| Optional features | Separate file with `when:` |\n| OS-specific logic | Separate files per OS |\n\n### Task File Naming\n\nUse descriptive, feature-based names:\n\n```text\ntasks/\n main.yml              # Router only\n install.yml           # Package installation\n configure.yml         # Configuration tasks\n users.yml             # User management\n install-Debian.yml    # Debian-specific install\n install-RedHat.yml    # RedHat-specific install\n```\n\n## Variable Organization\n\n### defaults/ vs vars/\n\n| Location | Purpose | User Override? |\n|----------|---------|----------------|\n| `defaults/main.yml` | User configuration | Yes (easily) |\n| `vars/main.yml` | Internal constants | Possible but discouraged |\n| `vars/Debian.yml` | OS-specific values | No (internal) |\n\n### defaults/main.yml Example\n\n```yaml\n# defaults/main.yml\n---\n# User-configurable options\ndocker_edition: \"ce\"\ndocker_service_state: started\ndocker_service_enabled: true\ndocker_users: []\n\n# Feature toggles\ndocker_install_compose: true\ndocker_compose_version: \"2.24.0\"\n```\n\n### vars/Debian.yml Example\n\n```yaml\n# vars/Debian.yml\n---\n# OS-specific internal values (not for user override)\ndocker_package_name: docker-ce\ndocker_service_name: docker\ndocker_config_path: /etc/docker/daemon.json\n```\n\n### Loading OS-Specific Variables\n\nSimple pattern:\n\n```yaml\n- name: Include OS-specific variables\n  ansible.builtin.include_vars: \"{{ ansible_os_family }}.yml\"\n```\n\nAdvanced pattern with fallback:\n\n```yaml\n- name: Load OS-specific vars\n  ansible.builtin.include_vars: \"{{ lookup('first_found', params) }}\"\n  vars:\n    params:\n      files:\n        - \"{{ ansible_distribution }}.yml\"\n        - \"{{ ansible_os_family }}.yml\"\n        - main.yml\n      paths:\n        - vars\n```\n\n## Variable Naming Convention\n\nPrefix variables with role name:\n\n```yaml\n# Pattern: {role_name}_{feature}_{attribute}\n\n# Examples\ndocker_edition: \"ce\"\ndocker_service_state: started\ndocker_compose_version: \"2.24.0\"\ndocker_users: []\n\n# Grouped by feature\nsecurity_ssh_port: 22\nsecurity_ssh_password_auth: \"no\"\nsecurity_fail2ban_enabled: true\n```\n\n### Benefits\n\n- Prevents conflicts with other roles\n- Clear ownership of variables\n- Easy to grep across codebase\n- Self-documenting\n\n## Handler Patterns\n\n### Simple Handler Definitions\n\n```yaml\n# handlers/main.yml\n---\n- name: restart docker\n  ansible.builtin.systemd:\n    name: docker\n    state: restarted\n\n- name: reload nginx\n  ansible.builtin.systemd:\n    name: nginx\n    state: reloaded\n```\n\n### Handler Naming\n\nUse lowercase with action + service pattern:\n\n```yaml\n- name: restart ssh      # Not \"Restart SSH Service\"\n- name: reload nginx     # Not \"Reload Nginx Config\"\n- name: reload systemd   # For daemon-reload\n```\n\n### Throttled Handlers\n\nFor cluster operations, restart one node at a time:\n\n```yaml\n- name: restart pve-cluster\n  ansible.builtin.systemd:\n    name: pve-cluster\n    state: restarted\n  throttle: 1\n```\n\n## Template Organization\n\n### When to Use Templates\n\nUse `templates/` when:\n\n- Configuration has conditional content\n- Need variable substitution\n- Complex multi-line configuration\n- Users may need to extend/override\n\nUse `lineinfile` when:\n\n- Simple single-line changes\n- Modifying existing system files\n\n### Template Variables\n\nExpose template paths as variables for user override:\n\n```yaml\n# defaults/main.yml\nnginx_conf_template: nginx.conf.j2\nnginx_vhost_template: vhost.j2\n```\n\n```yaml\n# tasks/configure.yml\n- name: Deploy nginx config\n  ansible.builtin.template:\n    src: \"{{ nginx_conf_template }}\"\n    dest: /etc/nginx/nginx.conf\n  notify: reload nginx\n```\n\n## Meta Configuration\n\n### meta/main.yml Structure\n\n```yaml\n# meta/main.yml\n---\ngalaxy_info:\n  author: your_name\n  description: Role description\n  license: MIT\n  min_ansible_version: \"2.12\"\n  platforms:\n    - name: Debian\n      versions:\n        - bullseye\n        - bookworm\n    - name: Ubuntu\n      versions:\n        - focal\n        - jammy\n\ndependencies:\n  - role: common\n  - role: geerlingguy.docker\n    when: install_docker | default(false)\n```\n\n## Role Complexity Scaling\n\nBased on geerlingguy role analysis:\n\n| Role Complexity | Directories | Task Files | Examples |\n|-----------------|-------------|------------|----------|\n| Minimal | 3-4 | 1 (main.yml) | pip, git |\n| Standard | 5-6 | 2-4 | security, docker |\n| Complex | 7+ | 5-8 | postgresql, nginx |\n\n### Minimal Role\n\n```text\npip/\n defaults/main.yml\n tasks/main.yml\n meta/main.yml\n README.md\n```\n\n### Standard Role\n\n```text\ndocker/\n defaults/main.yml\n vars/{Debian,RedHat}.yml\n tasks/{main,install,configure}.yml\n handlers/main.yml\n meta/main.yml\n README.md\n```\n\n### Complex Role\n\n```text\npostgresql/\n defaults/main.yml\n vars/{Debian,RedHat,Archlinux}.yml\n tasks/{main,install,configure,users,databases}.yml\n handlers/main.yml\n templates/{postgresql.conf,pg_hba.conf}.j2\n meta/main.yml\n README.md\n```\n\n## Task Naming Convention\n\nStart task names with action verbs:\n\n```yaml\n# GOOD\n- name: Ensure Docker is installed\n- name: Configure SSH security settings\n- name: Add user to docker group\n\n# BAD\n- name: Docker installation\n- name: SSH settings\n- name: User docker group\n```\n\n## File Validation\n\nValidate critical configuration files:\n\n```yaml\n- name: Update SSH configuration\n  ansible.builtin.lineinfile:\n    path: /etc/ssh/sshd_config\n    regexp: \"^PermitRootLogin\"\n    line: \"PermitRootLogin no\"\n    validate: 'sshd -T -f %s'\n  notify: restart ssh\n\n- name: Update sudoers\n  ansible.builtin.lineinfile:\n    path: /etc/sudoers\n    line: \"{{ user }} ALL=(ALL) NOPASSWD: ALL\"\n    validate: 'visudo -cf %s'\n```\n\n## Documentation\n\nEvery role needs a README.md with:\n\n1. **Description** - What the role does\n2. **Requirements** - Prerequisites\n3. **Role Variables** - All variables with defaults\n4. **Dependencies** - Other roles needed\n5. **Example Playbook** - How to use it\n\n## Additional Resources\n\nFor detailed role design patterns and techniques, consult:\n\n- **`references/role-structure-standards.md`** - Production role structure patterns from geerlingguy analysis\n- **`references/handler-best-practices.md`** - Handler design, notification patterns, flush strategies\n- **`references/meta-dependencies.md`** - Role dependencies, Galaxy metadata, platform support\n- **`references/variable-management-patterns.md`** - Variable naming, scoping, precedence patterns\n- **`references/documentation-templates.md`** - README templates and documentation standards\n\n## Related Skills\n\n- **ansible-playbook-design** - When to use roles vs playbooks\n- **ansible-fundamentals** - Module selection and naming\n- **ansible-testing** - Role testing with molecule"
              },
              {
                "name": "ansible-secrets",
                "description": "This skill should be used when working with secrets in Ansible playbooks, integrating Infisical vault, using no_log directive, retrieving credentials securely, or implementing fallback patterns for secrets. Covers the reusable Infisical lookup task.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-secrets/SKILL.md",
                "frontmatter": {
                  "name": "ansible-secrets",
                  "description": "This skill should be used when working with secrets in Ansible playbooks, integrating Infisical vault, using no_log directive, retrieving credentials securely, or implementing fallback patterns for secrets. Covers the reusable Infisical lookup task.\n"
                },
                "content": "# Ansible Secrets Management\n\nSecure secrets handling with Infisical integration and proper security practices.\n\n## Architecture Overview\n\n```text\n\n   Ansible    \n   Playbook   \n\n       \n        include_tasks: infisical-secret-lookup.yml\n       \n       \n\n Infisical Lookup \n      Task        \n\n       \n       > Try Universal Auth (preferred)\n          - INFISICAL_UNIVERSAL_AUTH_CLIENT_ID\n          - INFISICAL_UNIVERSAL_AUTH_CLIENT_SECRET\n       \n       > Fallback to Environment Variable (optional)\n          - Uses specified fallback_env_var\n       \n       \n\n  Infisical    (Vault)\n     API      \n\n```\n\n## Reusable Task Pattern\n\nThe repository provides a reusable task for secret retrieval at `ansible/tasks/infisical-secret-lookup.yml`.\n\n### Basic Usage\n\n```yaml\n- name: Retrieve Proxmox password\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'PROXMOX_PASSWORD'\n    secret_var_name: 'proxmox_password'\n    infisical_project_id: '7b832220-24c0-45bc-a5f1-ce9794a31259'\n    infisical_env: 'prod'\n    infisical_path: '/proxmox-cluster'\n\n# Now use the secret\n- name: Create Proxmox user\n  community.proxmox.proxmox_user:\n    api_password: \"{{ proxmox_password }}\"\n    # ... other config ...\n  no_log: true\n```\n\n### With Fallback\n\n```yaml\n- name: Retrieve database password\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'DB_PASSWORD'\n    secret_var_name: 'db_password'\n    fallback_env_var: 'DB_PASSWORD'  # Falls back to $DB_PASSWORD\n    infisical_project_id: '7b832220-24c0-45bc-a5f1-ce9794a31259'\n    infisical_env: 'prod'\n    infisical_path: '/database'\n```\n\n### Task Parameters\n\n| Variable | Required | Default | Description |\n|----------|----------|---------|-------------|\n| `secret_name` | Yes | - | Name of secret in Infisical |\n| `secret_var_name` | Yes | - | Variable name to store secret |\n| `infisical_project_id` | No | (repo default) | Infisical project ID |\n| `infisical_env` | No | `prod` | Environment (prod, dev, staging) |\n| `infisical_path` | No | `/apollo-13/vault` | Path within project |\n| `fallback_env_var` | No | - | Env var to use as fallback |\n| `allow_empty` | No | `false` | Allow empty secret values |\n\n## Authentication\n\n### Universal Auth (Recommended)\n\nSet environment variables before running playbooks:\n\n```bash\nexport INFISICAL_UNIVERSAL_AUTH_CLIENT_ID=\"ua-abc123\"\nexport INFISICAL_UNIVERSAL_AUTH_CLIENT_SECRET=\"secret-xyz789\"\n\ncd ansible\nuv run ansible-playbook playbooks/my-playbook.yml\n```\n\n### Environment Fallback\n\nFor local development or CI without Infisical:\n\n```bash\nexport PROXMOX_PASSWORD=\"local-dev-password\"\n\ncd ansible\nuv run ansible-playbook playbooks/my-playbook.yml\n```\n\n## Security Best Practices\n\n### 1. Use no_log\n\nOn tasks that handle secrets:\n\n```yaml\n- name: Set database password\n  ansible.builtin.command: set-password {{ password }}\n  no_log: true\n\n- name: Deploy config with secrets\n  ansible.builtin.template:\n    src: config.j2\n    dest: /etc/app/config.yml\n  no_log: true\n```\n\n### 2. Avoid Hard-Coded Secrets\n\n```yaml\n# BAD - Exposes secrets\n- name: Create user\n  community.proxmox.proxmox_user:\n    api_password: \"my-password-123\"  # EXPOSED!\n\n# GOOD\n- name: Retrieve password\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'PROXMOX_PASSWORD'\n    secret_var_name: 'proxmox_password'\n\n- name: Create user\n  community.proxmox.proxmox_user:\n    api_password: \"{{ proxmox_password }}\"\n  no_log: true\n```\n\n### 3. Validate Secret Retrieval\n\nAdd validation for critical secrets:\n\n```yaml\n- name: Get database password\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'DB_PASSWORD'\n    secret_var_name: 'db_password'\n\n- name: Validate password complexity\n  ansible.builtin.assert:\n    that:\n      - db_password | length >= 16\n    fail_msg: \"Password doesn't meet complexity requirements\"\n  no_log: true\n```\n\n### 4. Limit Secret Scope\n\nRetrieve secrets only when needed:\n\n```yaml\n# GOOD - Retrieve only when needed\n- name: System tasks (no secrets)\n  ansible.builtin.apt:\n    name: nginx\n    state: present\n\n- name: Get credentials (only when needed)\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'DB_PASSWORD'\n    secret_var_name: 'db_password'\n\n- name: Configure database connection\n  ansible.builtin.template:\n    src: db-config.j2\n    dest: /etc/app/db.yml\n  no_log: true\n```\n\n### 5. Use Environment Isolation\n\nSeparate secrets by environment:\n\n```yaml\n# Production\n- name: Get prod secret\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'DB_PASSWORD'\n    secret_var_name: 'db_password'\n    infisical_env: 'prod'\n    infisical_path: '/production/database'\n\n# Development\n- name: Get dev secret\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'DB_PASSWORD'\n    secret_var_name: 'db_password'\n    infisical_env: 'dev'\n    infisical_path: '/development/database'\n```\n\n## Multiple Secrets Pattern\n\n```yaml\n---\n- name: Deploy application with secrets\n  hosts: app_servers\n  become: true\n\n  vars:\n    infisical_project_id: '7b832220-24c0-45bc-a5f1-ce9794a31259'\n    infisical_env: 'prod'\n    infisical_path: '/app-config'\n\n  tasks:\n    - name: Retrieve database password\n      ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n      vars:\n        secret_name: 'DB_PASSWORD'\n        secret_var_name: 'db_password'\n\n    - name: Retrieve API key\n      ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n      vars:\n        secret_name: 'API_KEY'\n        secret_var_name: 'api_key'\n\n    - name: Retrieve Redis password\n      ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n      vars:\n        secret_name: 'REDIS_PASSWORD'\n        secret_var_name: 'redis_password'\n\n    - name: Deploy application config\n      ansible.builtin.template:\n        src: app-config.j2\n        dest: /etc/app/config.yml\n        owner: app\n        group: app\n        mode: '0600'\n      no_log: true\n```\n\n## CI/CD Integration\n\n### GitHub Actions\n\n```yaml\nname: Deploy\non: push\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Set up Infisical\n        env:\n          INFISICAL_CLIENT_ID: ${{ secrets.INFISICAL_CLIENT_ID }}\n          INFISICAL_CLIENT_SECRET: ${{ secrets.INFISICAL_CLIENT_SECRET }}\n        run: |\n          echo \"INFISICAL_UNIVERSAL_AUTH_CLIENT_ID=$INFISICAL_CLIENT_ID\" >> $GITHUB_ENV\n          echo \"INFISICAL_UNIVERSAL_AUTH_CLIENT_SECRET=$INFISICAL_CLIENT_SECRET\" >> $GITHUB_ENV\n\n      - name: Run Ansible\n        run: |\n          cd ansible\n          uv run ansible-playbook playbooks/deploy.yml\n```\n\n## Troubleshooting\n\n### Missing Authentication\n\n**Error**: Missing Infisical authentication credentials\n\n**Solution**:\n\n```bash\nexport INFISICAL_UNIVERSAL_AUTH_CLIENT_ID=\"ua-abc123\"\nexport INFISICAL_UNIVERSAL_AUTH_CLIENT_SECRET=\"secret-xyz789\"\n```\n\n### Secret Not Found\n\n**Error**: Failed to retrieve secret from Infisical\n\n**Check**:\n\n1. Secret exists at specified path in Infisical\n2. Correct project_id/env/path\n3. Service account has read permission\n\n### Empty Secret Value\n\n**Error**: Secret validation failed (empty value)\n\n**Solutions**:\n\n```yaml\n# Option 1: Allow empty (not recommended for required secrets)\n- name: Get optional secret\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'OPTIONAL_KEY'\n    secret_var_name: 'optional_key'\n    allow_empty: true\n\n# Option 2: Use fallback\n- name: Get secret with fallback\n  ansible.builtin.include_tasks: tasks/infisical-secret-lookup.yml\n  vars:\n    secret_name: 'API_KEY'\n    secret_var_name: 'api_key'\n    fallback_env_var: 'DEFAULT_API_KEY'\n```\n\n## Additional Resources\n\nFor detailed secrets management patterns, consult:\n\n- **`references/secrets-management.md`** - Infisical integration patterns, no_log best practices, credential security\n\n## Related Skills\n\n- **ansible-fundamentals** - Core Ansible patterns\n- **ansible-error-handling** - Error handling for secret retrieval failures"
              },
              {
                "name": "ansible-testing",
                "description": "This skill should be used when running ansible-lint, configuring linting rules, testing Ansible playbooks, validating playbook syntax, or setting up integration tests. Covers ansible-lint configuration and testing strategies.\n",
                "path": "plugins/infrastructure/ansible-workflows/skills/ansible-testing/SKILL.md",
                "frontmatter": {
                  "name": "ansible-testing",
                  "description": "This skill should be used when running ansible-lint, configuring linting rules, testing Ansible playbooks, validating playbook syntax, or setting up integration tests. Covers ansible-lint configuration and testing strategies.\n"
                },
                "content": "# Ansible Testing\n\nTesting strategies and ansible-lint configuration for Ansible automation.\n\n## ansible-lint\n\n### Running Lint\n\n```bash\n# Via mise (recommended)\nmise run ansible-lint\n\n# Directly with uv\nuv run ansible-lint ansible/playbooks/\n\n# Specific file\nuv run ansible-lint ansible/playbooks/my-playbook.yml\n\n# With verbose output\nuv run ansible-lint -v ansible/\n```\n\n### Configuration File\n\nLocated at `ansible/.ansible-lint`:\n\n```yaml\n---\n# Profile: null, min, basic, moderate, safety, shared, production\nprofile: moderate\n\n# Offline mode - don't download Galaxy requirements\noffline: true\n\n# Exclude paths\nexclude_paths:\n  - .cache/\n  - .venv/\n  - .git/\n  - \"*/templates/\"\n  - \"*.j2\"\n  - .deprecated/\n\n# Rules to skip completely\nskip_list:\n  - var-naming[no-role-prefix]  # We use descriptive names\n  - run-once[task]              # Safe with our strategy\n  - command-instead-of-module   # CLI tools require command\n  - yaml[line-length]           # Long lines in infra configs\n\n# Rules to warn but not fail\nwarn_list:\n  - fqcn[action-core]\n  - fqcn[action]\n  - no-handler\n  - name[play]\n```\n\n### Common Rule Categories\n\n| Category | Description |\n|----------|-------------|\n| `fqcn` | Fully qualified collection names |\n| `yaml` | YAML formatting (indentation, line length) |\n| `name` | Task/play naming conventions |\n| `command-instead-of-module` | Using command when module exists |\n| `no-changed-when` | Missing changed_when on command |\n| `risky-file-permissions` | Missing explicit file permissions |\n\n### Fixing Common Issues\n\n**Missing name on task:**\n\n```yaml\n# BAD\n- ansible.builtin.apt:\n    name: nginx\n\n# GOOD\n- name: Install nginx\n  ansible.builtin.apt:\n    name: nginx\n```\n\n**Short module name:**\n\n```yaml\n# BAD (triggers fqcn warning)\n- name: Install package\n  apt:\n    name: nginx\n\n# GOOD\n- name: Install package\n  ansible.builtin.apt:\n    name: nginx\n```\n\n**Using shell instead of command:**\n\n```yaml\n# BAD (when no shell features needed)\n- name: List files\n  ansible.builtin.shell: ls -la /tmp\n\n# GOOD\n- name: List files\n  ansible.builtin.command: ls -la /tmp\n  changed_when: false\n```\n\n**Missing changed_when:**\n\n```yaml\n# BAD (always shows changed)\n- name: Check status\n  ansible.builtin.command: systemctl status app\n\n# GOOD\n- name: Check status\n  ansible.builtin.command: systemctl status app\n  register: status_check\n  changed_when: false\n  failed_when: false\n```\n\n## Syntax Checking\n\nValidate playbook syntax before running:\n\n```bash\n# Check syntax only\nuv run ansible-playbook --syntax-check playbooks/my-playbook.yml\n\n# Check mode (dry run)\nuv run ansible-playbook playbooks/my-playbook.yml --check\n\n# Diff mode (show changes)\nuv run ansible-playbook playbooks/my-playbook.yml --check --diff\n```\n\n## Idempotency Testing\n\nVerify playbooks are idempotent by running twice:\n\n```bash\n# First run - may show changes\nuv run ansible-playbook playbooks/setup.yml\n\n# Second run - should show 0 changes\nuv run ansible-playbook playbooks/setup.yml\n\n# If second run shows changes, playbook is NOT idempotent\n```\n\n### Automated Idempotency Check\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\nPLAYBOOK=\"$1\"\n\necho \"First run...\"\nuv run ansible-playbook \"$PLAYBOOK\"\n\necho \"Second run (checking idempotency)...\"\nOUTPUT=$(uv run ansible-playbook \"$PLAYBOOK\" 2>&1)\n\nif echo \"$OUTPUT\" | grep -q \"changed=0\"; then\n    echo \" Playbook is idempotent\"\n    exit 0\nelse\n    echo \" Playbook is NOT idempotent\"\n    echo \"$OUTPUT\" | grep -E \"(changed|failed)=\"\n    exit 1\nfi\n```\n\n## Integration Testing\n\n### Test Against Real Infrastructure\n\n```bash\n# Limit to test hosts\nuv run ansible-playbook playbooks/deploy.yml --limit test_hosts\n\n# With verbose output\nuv run ansible-playbook playbooks/deploy.yml --limit test_hosts -vv\n```\n\n### Pre-flight Validation\n\nAdd validation tasks at playbook start:\n\n```yaml\n---\n- name: Deploy with validation\n  hosts: all\n  become: true\n\n  pre_tasks:\n    - name: Validate target environment\n      ansible.builtin.assert:\n        that:\n          - ansible_distribution == \"Debian\"\n          - ansible_distribution_major_version | int >= 11\n        fail_msg: \"Requires Debian 11+\"\n\n    - name: Check connectivity\n      ansible.builtin.ping:\n\n    - name: Verify disk space\n      ansible.builtin.assert:\n        that:\n          - ansible_mounts | selectattr('mount', 'equalto', '/') | map(attribute='size_available') | first > 1073741824\n        fail_msg: \"Insufficient disk space\"\n```\n\n## Test Playbook Pattern\n\nCreate test playbooks for validation:\n\n```yaml\n# playbooks/test-role.yml\n---\n- name: Test role functionality\n  hosts: test_hosts\n  become: true\n\n  vars:\n    test_mode: true\n\n  roles:\n    - role: my_role\n\n  tasks:\n    - name: Verify service is running\n      ansible.builtin.systemd:\n        name: myservice\n      register: service_status\n      failed_when: service_status.status.ActiveState != \"active\"\n\n    - name: Verify config file exists\n      ansible.builtin.stat:\n        path: /etc/myservice/config.yml\n      register: config_stat\n      failed_when: not config_stat.stat.exists\n\n    - name: Verify port is listening\n      ansible.builtin.wait_for:\n        port: 8080\n        timeout: 10\n```\n\n## CI/CD Integration\n\n### GitHub Actions\n\n```yaml\nname: Ansible Lint\n\non: [push, pull_request]\n\njobs:\n  lint:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Set up Python\n        uses: actions/setup-python@v5\n        with:\n          python-version: '3.13'\n\n      - name: Install uv\n        run: pip install uv\n\n      - name: Install dependencies\n        run: uv sync\n\n      - name: Run ansible-lint\n        run: uv run ansible-lint ansible/\n```\n\n## Debugging Playbooks\n\n### Verbose Output\n\n```bash\n# Increase verbosity\nuv run ansible-playbook playbook.yml -v    # Basic\nuv run ansible-playbook playbook.yml -vv   # More detail\nuv run ansible-playbook playbook.yml -vvv  # Connection debugging\nuv run ansible-playbook playbook.yml -vvvv # Maximum detail\n```\n\n### Debug Tasks\n\n```yaml\n- name: Debug variable value\n  ansible.builtin.debug:\n    var: my_variable\n\n- name: Debug with message\n  ansible.builtin.debug:\n    msg: \"The value is {{ my_variable }}\"\n\n- name: Debug registered result\n  ansible.builtin.debug:\n    var: command_result\n  when: ansible_verbosity > 0\n```\n\n### Step Mode\n\n```bash\n# Pause after each task\nuv run ansible-playbook playbook.yml --step\n```\n\n## Lint Profiles\n\nChoose appropriate profile based on needs:\n\n| Profile | Strictness | Use Case |\n|---------|------------|----------|\n| `min` | Lowest | Legacy code, quick fixes |\n| `basic` | Low | Development |\n| `moderate` | Medium | General infrastructure |\n| `safety` | High | Security-sensitive |\n| `production` | Highest | Production deployments |\n\n## Additional Resources\n\nFor detailed testing patterns and techniques, consult:\n\n- **`references/testing-comprehensive.md`** - ansible-lint configuration, integration testing strategies, CI/CD patterns\n\n## Related Skills\n\n- **ansible-fundamentals** - Core Ansible patterns\n- **ansible-idempotency** - Ensuring tasks are idempotent"
              },
              {
                "name": "proxmox-infrastructure",
                "description": "Proxmox VE cluster management including VM provisioning, template creation with cloud-init, QEMU guest agent integration, storage pool management, VLAN-aware bridge configuration, and Proxmox API interactions. Use when working with Proxmox VE, creating VM templates, configuring Proxmox networking, managing CEPH storage, troubleshooting VM deployment issues, or interacting with Proxmox API.",
                "path": "plugins/infrastructure/proxmox-infrastructure/skills/proxmox-infrastructure/SKILL.md",
                "frontmatter": {
                  "name": "proxmox-infrastructure",
                  "description": "Proxmox VE cluster management including VM provisioning, template creation with cloud-init, QEMU guest agent integration, storage pool management, VLAN-aware bridge configuration, and Proxmox API interactions. Use when working with Proxmox VE, creating VM templates, configuring Proxmox networking, managing CEPH storage, troubleshooting VM deployment issues, or interacting with Proxmox API."
                },
                "content": "# Proxmox Infrastructure Management\n\nExpert guidance for managing Proxmox VE clusters, creating templates, provisioning VMs, and configuring network\ninfrastructure.\n\n## Quick Start\n\n### Common Tasks\n\n**Create VM Template:**\n\n```bash\n# See tools/build-template.yml for automated playbook\ncd ansible && uv run ansible-playbook playbooks/proxmox-build-template.yml\n```\n\n**Clone Template to VM:**\n\n```bash\nqm clone <template-id> <new-vmid> --name <vm-name>\nqm set <new-vmid> --sshkey ~/.ssh/id_rsa.pub\nqm set <new-vmid> --ipconfig0 ip=192.168.1.100/24,gw=192.168.1.1\nqm start <new-vmid>\n```\n\n**Check Cluster Status:**\n\n```bash\n# Use tools/cluster_status.py\n./tools/cluster_status.py\n```\n\n## When to Use This Skill\n\nActivate this skill when:\n\n- Creating or managing Proxmox VM templates\n- Provisioning VMs via cloning or Terraform\n- Configuring Proxmox networking (bridges, VLANs, bonds)\n- Troubleshooting VM deployment or network issues\n- Managing CEPH storage pools\n- Working with QEMU guest agent\n- Interacting with Proxmox API via Python or Ansible\n\n## Core Workflows\n\n### 1. Template Creation\n\n#### Method 1: Using Ansible (Recommended)\n\nSee [tools/build-template.yml](tools/build-template.yml) for complete automation.\n\n#### Method 2: Manual CLI\n\nSee [reference/cloud-init-patterns.md](reference/cloud-init-patterns.md) for detailed steps.\n\nKey points:\n\n- Use `virtio-scsi-pci` controller for Ubuntu images\n- Add cloud-init CD-ROM drive (`ide2`)\n- Configure serial console for cloud images\n- Convert to template with `qm template <vmid>`\n\n### 2. VM Provisioning\n\n**From Ansible:**\nAnalyze existing playbook: [../../ansible/playbooks/proxmox-build-template.yml](../../ansible/playbooks/proxmox-build-template.yml)\n\n**From Terraform:**\nSee examples in [../../terraform/netbox-vm/](../../terraform/netbox-vm/)\n\n**Key Configuration:**\n\n```yaml\n# Ansible example\nproxmox_kvm:\n  node: foxtrot\n  api_host: 192.168.3.5\n  vmid: 101\n  name: docker-01\n  clone: ubuntu-template\n  storage: local-lvm\n  # Network with VLAN\n  net:\n    net0: 'virtio,bridge=vmbr0,tag=30'\n  ipconfig:\n    ipconfig0: 'ip=192.168.3.100/24,gw=192.168.3.1'\n```\n\n### 3. Network Configuration\n\nThis Virgo-Core cluster uses:\n\n- **vmbr0**: Management (192.168.3.0/24, VLAN 9 for Corosync)\n- **vmbr1**: CEPH Public (192.168.5.0/24, MTU 9000)\n- **vmbr2**: CEPH Private (192.168.7.0/24, MTU 9000)\n\nSee [reference/networking.md](reference/networking.md) for:\n\n- VLAN-aware bridge configuration\n- Bond setup (802.3ad LACP)\n- Routed vs bridged vs NAT setups\n\n## Architecture Reference\n\n### This Cluster (\"Matrix\")\n\n**Nodes:** Foxtrot, Golf, Hotel (3 MINISFORUM MS-A2)\n\n**Hardware per Node:**\n\n- AMD Ryzen 9 9955HX (16C/32T)\n- 64GB DDR5 @ 5600 MT/s\n- 3 NVMe: 1 1TB (boot), 2 4TB (CEPH)\n- 4 NICs: 2 10GbE SFP+, 2 2.5GbE\n\n**Network Architecture:**\n\n```text\nenp4s0  vmbr0 (mgmt + vlan9 for corosync)\nenp5s0f0np0  vmbr1 (ceph public, MTU 9000)\nenp5s0f1np1  vmbr2 (ceph private, MTU 9000)\n```\n\nSee [../../docs/goals.md](../../docs/goals.md) for complete specs.\n\n## Tools Available\n\n### Python Scripts (uv)\n\n**validate_template.py** - Validate template health via API\n\n```bash\n./tools/validate_template.py --template-id 9000\n```\n\n**vm_diagnostics.py** - VM health checks\n\n```bash\n./tools/vm_diagnostics.py --vmid 101\n```\n\n**cluster_status.py** - Cluster health metrics\n\n```bash\n./tools/cluster_status.py\n```\n\n### Ansible Playbooks\n\n**build-template.yml** - Automated template creation\n\n- Downloads cloud image\n- Creates VM with proper configuration\n- Converts to template\n\n**configure-networking.yml** - VLAN bridge setup\n\n- Creates VLAN-aware bridges\n- Configures bonds\n- Sets MTU for storage networks\n\n### OpenTofu Modules\n\n**vm-module-example/** - Reusable VM provisioning\n\n- Clone-based deployment\n- Cloud-init integration\n- Network configuration\n\nSee [examples/](examples/) directory.\n\n**Real Examples from Repository**:\n\n- **Multi-VM Cluster**: [../../terraform/examples/microk8s-cluster](../../terraform/examples/microk8s-cluster) - Comprehensive\n  3-node MicroK8s deployment using `for_each` pattern, cross-node cloning, **dual NIC with VLAN** (VLAN 30 primary,\n  VLAN 2 secondary), Ansible integration\n- **Template with Cloud-Init**:\n  [../../terraform/examples/template-with-custom-cloudinit](../../terraform/examples/template-with-custom-cloudinit) -\n  Custom cloud-init snippet configuration\n- **VLAN Bridge Configuration**:\n  [../../ansible/playbooks/proxmox-enable-vlan-bridging.yml](../../ansible/playbooks/proxmox-enable-vlan-bridging.yml) -\n  Enable VLAN-aware bridging on Proxmox nodes (supports VLANs 2-4094)\n\n## Troubleshooting\n\nCommon issues and solutions:\n\n### Template Creation Issues\n\n**Serial console required:**\nMany cloud images need serial console configured.\n\n```bash\nqm set <vmid> --serial0 socket --vga serial0\n```\n\n**Boot order:**\n\n```bash\nqm set <vmid> --boot order=scsi0\n```\n\n### Network Issues\n\n**VLAN not working:**\n\n1. Check bridge is VLAN-aware:\n\n   ```bash\n   grep \"bridge-vlan-aware\" /etc/network/interfaces\n   ```\n\n2. Verify VLAN in bridge-vids:\n\n   ```bash\n   bridge vlan show\n   ```\n\n**MTU problems (CEPH):**\nEnsure MTU 9000 on storage networks:\n\n```bash\nip link show vmbr1 | grep mtu\n```\n\n### VM Won't Start\n\n1. Check QEMU guest agent:\n\n   ```bash\n   qm agent <vmid> ping\n   ```\n\n2. Review cloud-init logs (in VM):\n\n   ```bash\n   cloud-init status --wait\n   cat /var/log/cloud-init.log\n   ```\n\n3. Validate template exists:\n\n   ```bash\n   qm list | grep template\n   ```\n\nFor more issues, see [troubleshooting/](troubleshooting/) directory.\n\n## Best Practices\n\n1. **Always use templates** - Clone for consistency\n2. **SSH keys only** - Never use password auth\n3. **VLAN-aware bridges** - Enable for flexibility\n4. **MTU 9000 for storage** - Essential for CEPH performance\n5. **Serial console** - Required for most cloud images\n6. **Guest agent** - Enable for IP detection and graceful shutdown\n7. **Tag VMs** - Use meaningful tags for organization\n\n## Progressive Disclosure\n\nFor deeper knowledge:\n\n### Advanced Automation Workflows (from ProxSpray Analysis)\n\n- [Cluster Formation](workflows/cluster-formation.md) - Complete cluster automation with idempotency\n- [CEPH Deployment](workflows/ceph-deployment.md) - Automated CEPH storage deployment\n\n### Core Reference\n\n- [Cloud-Init patterns](reference/cloud-init-patterns.md) - Complete template creation guide\n- [Network configuration](reference/networking.md) - VLANs, bonds, routing, NAT\n- [API reference](reference/api-reference.md) - Proxmox API interactions\n- [Storage management](reference/storage-management.md) - CEPH, LVM, datastores\n- [QEMU guest agent](reference/qemu-guest-agent.md) - Integration and troubleshooting\n\n### Anti-Patterns & Common Mistakes\n\n- [Common Mistakes](anti-patterns/common-mistakes.md) - Real-world pitfalls from OpenTofu/Ansible deployments, template\n  creation, and remote backend configuration\n\n## Related Skills\n\n- **NetBox + PowerDNS Integration** - Automatic DNS for Proxmox VMs\n- **Ansible Best Practices** - Playbook patterns used in this cluster"
              },
              {
                "name": "coderabbit",
                "description": "AI-powered code review using CodeRabbit CLI and GitHub integration. Use when running local code reviews before commits (\"run coderabbit\", \"review my changes\"), configuring .coderabbit.yaml files, integrating CodeRabbit with Claude Code for autonomous review workflows, using @coderabbitai commands in pull requests, or setting up automated code review pipelines.\n",
                "path": "plugins/meta/claude-dev-sandbox/skills/coderabbit/SKILL.md",
                "frontmatter": {
                  "name": "coderabbit",
                  "description": "AI-powered code review using CodeRabbit CLI and GitHub integration. Use when running local code reviews before commits (\"run coderabbit\", \"review my changes\"), configuring .coderabbit.yaml files, integrating CodeRabbit with Claude Code for autonomous review workflows, using @coderabbitai commands in pull requests, or setting up automated code review pipelines.\n"
                },
                "content": "# CodeRabbit\n\nAI code review tool that catches race conditions, memory leaks, and security vulnerabilities.\nIntegrates with Claude Code for autonomous review-and-fix workflows.\n\n## Quick Start: Claude Code Integration\n\nRun CodeRabbit as part of your development workflow:\n\n```text\nImplement the feature from the spec, then run coderabbit --prompt-only\nin the background and fix any issues found.\n```\n\nKey flags for Claude Code:\n\n- `--prompt-only` - Minimal output optimized for AI agents\n- `--plain` - Plain text mode (no interactive UI)\n- `--type uncommitted` - Review only uncommitted changes\n\n## CLI Commands\n\n```bash\n# Install\ncurl -fsSL https://cli.coderabbit.ai/install.sh | sh\n\n# Authenticate (run once per Claude Code session)\ncoderabbit auth login\n\n# Review code\ncoderabbit                          # Interactive mode\ncoderabbit --plain                  # Plain text output\ncoderabbit --prompt-only            # AI-optimized output\ncoderabbit --type uncommitted       # Only uncommitted changes\ncoderabbit --base develop           # Compare against develop branch\n```\n\n## Claude Code Workflow\n\nRecommended prompt pattern:\n\n```text\nPlease implement [feature] and then run coderabbit --prompt-only,\nlet it run as long as it needs (run it in the background) and fix any issues.\n```\n\nCodeRabbit reviews take 7-30+ minutes. Run in background and check periodically.\n\n**Fix prioritization:** Fix critical issues first, ignore nits. Run CodeRabbit\nagain after fixes to verify no new issues introduced. Limit to 2 iterations.\n\n## GitHub Commands\n\nUse `@coderabbitai` in PR comments:\n\n| Command | Description |\n|---------|-------------|\n| `@coderabbitai review` | Incremental review of new changes |\n| `@coderabbitai full review` | Complete review from scratch |\n| `@coderabbitai pause` | Stop automatic reviews |\n| `@coderabbitai resume` | Restart reviews |\n| `@coderabbitai summary` | Regenerate PR summary |\n| `@coderabbitai generate docstrings` | Generate function docs (Pro) |\n| `@coderabbitai generate unit tests` | Generate tests (Pro) |\n| `@coderabbitai resolve` | Resolve all CR comments |\n| `@coderabbitai configuration` | Show current settings |\n\nAdd `@coderabbitai ignore` to PR **description** to disable reviews for that PR.\n\n## Configuration (.coderabbit.yaml)\n\n```yaml\n# yaml-language-server: $schema=https://coderabbit.ai/integrations/schema.v2.json\nlanguage: en-US\ntone_instructions: \"Be concise and focus on critical issues only\"\n\nreviews:\n  profile: chill  # or \"assertive\" for comprehensive feedback\n  high_level_summary: true\n  auto_review:\n    enabled: true\n    drafts: false\n    ignore_title_keywords:\n      - \"wip\"\n      - \"draft\"\n\nknowledge_base:\n  code_guidelines:\n    enabled: true\n    filePatterns:\n      - \"**/.cursorrules\"\n      - \"**/claude.md\"\n```\n\nCodeRabbit auto-reads `claude.md` and `.cursorrules` for coding standards.\n\n## Supported Tools\n\nCodeRabbit integrates 40+ linters and security analyzers:\n\n- **JavaScript/TypeScript:** ESLint, Biome, Oxlint\n- **Python:** Ruff, Pylint, Flake8\n- **Go:** golangci-lint\n- **Security:** Gitleaks, Semgrep, OSV Scanner\n- **Infrastructure:** Checkov, Hadolint\n- **CI/CD:** actionlint, CircleCI\n\n**Full tools reference:** See [references/tools-reference.md](references/tools-reference.md)\n\n## Troubleshooting\n\n**CodeRabbit not finding issues:**\n\n1. Check auth: `coderabbit auth status`\n2. Verify git status: `git status`\n3. Specify review type: `--type uncommitted`\n4. Specify base branch: `--base develop`\n\n**Claude Code not applying fixes:**\n\n1. Use `--prompt-only` mode\n2. Include \"run in background\" in prompt\n3. Explicitly ask to \"fix issues found by CodeRabbit\"\n\n## References\n\n- **Overview:** [references/overview.md](references/overview.md)\n- **Claude Code Integration:** [references/claude-code-integration.md](references/claude-code-integration.md)\n- **YAML Configuration:** [references/yaml-configuration-guide.md](references/yaml-configuration-guide.md)\n- **GitHub Commands:** [references/github-commands.md](references/github-commands.md)\n- **Tools Reference:** [references/tools-reference.md](references/tools-reference.md)\n- **Full Configuration:** [references/configuration.md](references/configuration.md)"
              },
              {
                "name": "official_docs",
                "description": "Skills for accessing official documentation",
                "path": "plugins/meta/claude-dev-sandbox/skills/official_docs/SKILL.md",
                "frontmatter": {
                  "name": "official_docs",
                  "description": "Skills for accessing official documentation"
                },
                "content": "# Official Docs Skill"
              },
              {
                "name": "Writing Hookify Rules",
                "description": "This skill should be used when the user asks to \"create a hookify rule\", \"write a hook rule\", \"configure hookify\", \"add a hookify rule\", or needs guidance on hookify rule syntax and patterns.\n",
                "path": "plugins/meta/hookify/skills/writing-rules/SKILL.md",
                "frontmatter": {
                  "name": "Writing Hookify Rules",
                  "description": "This skill should be used when the user asks to \"create a hookify rule\", \"write a hook rule\", \"configure hookify\", \"add a hookify rule\", or needs guidance on hookify rule syntax and patterns.\n"
                },
                "content": "# Writing Hookify Rules\n\n## Overview\n\nHookify rules are markdown files with YAML frontmatter that define patterns to watch for\nand messages to show when those patterns match. Rules are stored in\n`.claude/hookify.{rule-name}.local.md` files.\n\n## Rule File Format\n\n### Basic Structure\n\n```markdown\n---\nname: rule-identifier\nenabled: true\nevent: bash|file|stop|prompt|all\npattern: regex-pattern-here\n---\n\nMessage to show Claude when this rule triggers.\nCan include markdown formatting, warnings, suggestions, etc.\n```\n\n### Frontmatter Fields\n\n**name** (required): Unique identifier for the rule\n\n- Use kebab-case: `warn-dangerous-rm`, `block-console-log`\n- Be descriptive and action-oriented\n- Start with verb: warn, prevent, block, require, check\n\n**enabled** (required): Boolean to activate/deactivate\n\n- `true`: Rule is active\n- `false`: Rule is disabled (won't trigger)\n- Can toggle without deleting rule\n\n**event** (required): Which hook event to trigger on\n\n- `bash`: Bash tool commands\n- `file`: Edit, Write, MultiEdit tools\n- `stop`: When agent wants to stop\n- `prompt`: When user submits a prompt\n- `all`: All events\n\n**action** (optional): What to do when rule matches\n\n- `warn`: Show message but allow operation (default)\n- `block`: Prevent operation (PreToolUse) or stop session (Stop events)\n- If omitted, defaults to `warn`\n\n**pattern** (simple format): Regex pattern to match\n\n- Used for simple single-condition rules\n- Matches against command (bash) or new_text (file)\n- Python regex syntax\n\n**Example:**\n\n```yaml\nevent: bash\npattern: rm\\s+-rf\n```\n\n### Advanced Format (Multiple Conditions)\n\nFor complex rules with multiple conditions:\n\n```markdown\n---\nname: warn-env-file-edits\nenabled: true\nevent: file\nconditions:\n  - field: file_path\n    operator: regex_match\n    pattern: \\.env$\n  - field: new_text\n    operator: contains\n    pattern: API_KEY\n---\n\nYou're adding an API key to a .env file. Ensure this file is in .gitignore!\n```\n\n**Condition fields:**\n\n- `field`: Which field to check\n  - For bash: `command`\n  - For file: `file_path`, `new_text`, `old_text`, `content`\n- `operator`: How to match\n  - `regex_match`: Regex pattern matching\n  - `contains`: Substring check\n  - `equals`: Exact match\n  - `not_contains`: Substring must NOT be present\n  - `starts_with`: Prefix check\n  - `ends_with`: Suffix check\n- `pattern`: Pattern or string to match\n\n**All conditions must match for rule to trigger.**\n\n## Message Body\n\nThe markdown content after frontmatter is shown to Claude when the rule triggers.\n\n**Good messages:**\n\n- Explain what was detected\n- Explain why it's problematic\n- Suggest alternatives or best practices\n- Use formatting for clarity (bold, lists, etc.)\n\n**Example:**\n\n```markdown\n **Console.log detected!**\n\nYou're adding console.log to production code.\n\n**Why this matters:**\n- Debug logs shouldn't ship to production\n- Console.log can expose sensitive data\n- Impacts browser performance\n\n**Alternatives:**\n- Use a proper logging library\n- Remove before committing\n- Use conditional debug builds\n```\n\n## Event Type Guide\n\n### bash Events\n\nMatch Bash command patterns:\n\n```markdown\n---\nevent: bash\npattern: sudo\\s+|rm\\s+-rf|chmod\\s+777\n---\n\nDangerous command detected!\n```\n\n**Common patterns:**\n\n- Dangerous commands: `rm\\s+-rf`, `dd\\s+if=`, `mkfs`\n- Privilege escalation: `sudo\\s+`, `su\\s+`\n- Permission issues: `chmod\\s+777`, `chown\\s+root`\n\n### file Events\n\nMatch Edit/Write/MultiEdit operations:\n\n```markdown\n---\nevent: file\npattern: console\\.log\\(|eval\\(|innerHTML\\s*=\n---\n\nPotentially problematic code pattern detected!\n```\n\n**Match on different fields:**\n\n```markdown\n---\nevent: file\nconditions:\n  - field: file_path\n    operator: regex_match\n    pattern: \\.tsx?$\n  - field: new_text\n    operator: regex_match\n    pattern: console\\.log\\(\n---\n\nConsole.log in TypeScript file!\n```\n\n**Common patterns:**\n\n- Debug code: `console\\.log\\(`, `debugger`, `print\\(`\n- Security risks: `eval\\(`, `innerHTML\\s*=`, `dangerouslySetInnerHTML`\n- Sensitive files: `\\.env$`, `credentials`, `\\.pem$`\n- Generated files: `node_modules/`, `dist/`, `build/`\n\n### stop Events\n\nMatch when agent wants to stop (completion checks):\n\n```markdown\n---\nevent: stop\npattern: .*\n---\n\nBefore stopping, verify:\n- [ ] Tests were run\n- [ ] Build succeeded\n- [ ] Documentation updated\n```\n\n**Use for:**\n\n- Reminders about required steps\n- Completion checklists\n- Process enforcement\n\n### prompt Events\n\nMatch user prompt content (advanced):\n\n```markdown\n---\nevent: prompt\nconditions:\n  - field: user_prompt\n    operator: contains\n    pattern: deploy to production\n---\n\nProduction deployment checklist:\n- [ ] Tests passing?\n- [ ] Reviewed by team?\n- [ ] Monitoring ready?\n```\n\n## Pattern Writing Tips\n\n### Regex Basics\n\n**Literal characters:** Most characters match themselves\n\n- `rm` matches \"rm\"\n- `console.log` matches \"console.log\"\n\n**Special characters need escaping:**\n\n- `.` (any char)  `\\.` (literal dot)\n- `(` `)`  `\\(` `\\)` (literal parens)\n- `[` `]`  `\\[` `\\]` (literal brackets)\n\n**Common metacharacters:**\n\n- `\\s` - whitespace (space, tab, newline)\n- `\\d` - digit (0-9)\n- `\\w` - word character (a-z, A-Z, 0-9, _)\n- `.` - any character\n- `+` - one or more\n- `*` - zero or more\n- `?` - zero or one\n- `|` - OR\n\n**Examples:**\n\n```text\nrm\\s+-rf         Matches: rm -rf, rm  -rf\nconsole\\.log\\(   Matches: console.log(\n(eval|exec)\\(    Matches: eval( or exec(\nchmod\\s+777      Matches: chmod 777, chmod  777\nAPI_KEY\\s*=      Matches: API_KEY=, API_KEY =\n```\n\n### Testing Patterns\n\nTest regex patterns before using:\n\n```bash\npython3 -c \"import re; print(re.search(r'your_pattern', 'test text'))\"\n```\n\nOr use online regex testers (regex101.com with Python flavor).\n\n### Common Pitfalls\n\n**Too broad:**\n\n```yaml\npattern: log    # Matches \"log\", \"login\", \"dialog\", \"catalog\"\n```\n\nBetter: `console\\.log\\(|logger\\.`\n\n**Too specific:**\n\n```yaml\npattern: rm -rf /tmp  # Only matches exact path\n```\n\nBetter: `rm\\s+-rf`\n\n**Escaping issues:**\n\n- YAML quoted strings: `\"pattern\"` requires double backslashes `\\\\s`\n- YAML unquoted: `pattern: \\s` works as-is\n- **Recommendation**: Use unquoted patterns in YAML\n\n## File Organization\n\n**Location:** All rules in `.claude/` directory\n**Naming:** `.claude/hookify.{descriptive-name}.local.md`\n**Gitignore:** Add `.claude/*.local.md` to `.gitignore`\n\n**Good names:**\n\n- `hookify.dangerous-rm.local.md`\n- `hookify.console-log.local.md`\n- `hookify.require-tests.local.md`\n- `hookify.sensitive-files.local.md`\n\n**Bad names:**\n\n- `hookify.rule1.local.md` (not descriptive)\n- `hookify.md` (missing .local)\n- `danger.local.md` (missing hookify prefix)\n\n## Workflow\n\n### Creating a Rule\n\n1. Identify unwanted behavior\n2. Determine which tool is involved (Bash, Edit, etc.)\n3. Choose event type (bash, file, stop, etc.)\n4. Write regex pattern\n5. Create `.claude/hookify.{name}.local.md` file in project root\n6. Test immediately - rules are read dynamically on next tool use\n\n### Refining a Rule\n\n1. Edit the `.local.md` file\n2. Adjust pattern or message\n3. Test immediately - changes take effect on next tool use\n\n### Disabling a Rule\n\n**Temporary:** Set `enabled: false` in frontmatter\n**Permanent:** Delete the `.local.md` file\n\n## Examples\n\nSee `${CLAUDE_PLUGIN_ROOT}/examples/` for complete examples:\n\n- `dangerous-rm.local.md` - Block dangerous rm commands\n- `console-log-warning.local.md` - Warn about console.log\n- `sensitive-files-warning.local.md` - Warn about editing .env files\n\n## Quick Reference\n\n**Minimum viable rule:**\n\n```markdown\n---\nname: my-rule\nenabled: true\nevent: bash\npattern: dangerous_command\n---\n\nWarning message here\n```\n\n**Rule with conditions:**\n\n```markdown\n---\nname: my-rule\nenabled: true\nevent: file\nconditions:\n  - field: file_path\n    operator: regex_match\n    pattern: \\.ts$\n  - field: new_text\n    operator: contains\n    pattern: any\n---\n\nWarning message\n```\n\n**Event types:**\n\n- `bash` - Bash commands\n- `file` - File edits\n- `stop` - Completion checks\n- `prompt` - User input\n- `all` - All events\n\n**Field options:**\n\n- Bash: `command`\n- File: `file_path`, `new_text`, `old_text`, `content`\n- Prompt: `user_prompt`\n\n**Operators:**\n\n- `regex_match`, `contains`, `equals`, `not_contains`, `starts_with`, `ends_with`"
              },
              {
                "name": "multi-agent-composition",
                "description": "This skill should be used when the user asks to \"choose between skill and agent\", \"compose multi-agent system\", \"orchestrate agents\", \"manage agent context\", \"design component architecture\", \"should I use a skill or agent\", \"when to use hooks vs MCP\", \"build orchestrator workflow\", needs decision frameworks for Claude Code components (skills, sub-agents, hooks, MCP servers, slash commands), context management patterns, or wants to build effective multi-component agentic systems with proper orchestration and anti-patterns guidance.\n",
                "path": "plugins/meta/meta-claude/skills/multi-agent-composition/SKILL.md",
                "frontmatter": {
                  "name": "multi-agent-composition",
                  "description": "This skill should be used when the user asks to \"choose between skill and agent\", \"compose multi-agent system\", \"orchestrate agents\", \"manage agent context\", \"design component architecture\", \"should I use a skill or agent\", \"when to use hooks vs MCP\", \"build orchestrator workflow\", needs decision frameworks for Claude Code components (skills, sub-agents, hooks, MCP servers, slash commands), context management patterns, or wants to build effective multi-component agentic systems with proper orchestration and anti-patterns guidance.\n"
                },
                "content": "# Multi-Agent Composition\n\n**Master Claude Code's components, patterns, and principles** to build effective agentic systems.\n\n## When to Use This Knowledge\n\nUse this knowledge when:\n\n- **Learning Claude Code** - Understanding what each component does\n- **Making architectural decisions** - Choosing Skills vs Sub-Agents vs MCP vs Slash Commands\n- **Building custom solutions** - Creating specialized agents or orchestration systems\n- **Scaling agentic workflows** - Moving from single agents to multi-agent orchestration\n- **Debugging issues** - Understanding why components behave certain ways\n- **Adding observability** - Implementing hooks for monitoring and control\n\n## Quick Reference\n\n### The Core 4 Framework\n\nEvery agent is built on these four elements:\n\n1. **Context** - What information does the agent have?\n2. **Model** - What capabilities does the model provide?\n3. **Prompt** - What instruction are you giving?\n4. **Tools** - What actions can the agent take?\n\n> \"Everything comes down to just four pieces. If you understand these, you will win.\"\n\n### Component Overview\n\n| Component | Trigger | Use When | Best For |\n|-----------|---------|----------|----------|\n| **Skills** | Agent-invoked | Repeat problems needing management | Domain-specific workflows |\n| **Sub-Agents** | Tool-invoked | Parallelization & context isolation | Scale & batch operations |\n| **MCP Servers** | As needed | External data/services | Integration with external systems |\n| **Slash Commands** | Manual/tool | One-off tasks | Simple repeatable prompts |\n| **Hooks** | Lifecycle events | Observability & control | Monitoring & blocking |\n\n### Composition Hierarchy\n\n```text\nSkills (Top Layer)\n   Can use: Sub-Agents, Slash Commands, MCP Servers, Other Skills\n   Purpose: Orchestrate primitives for repeatable workflows\n\nSub-Agents (Execution Layer)\n   Can use: Slash Commands, Skills\n   Cannot nest other Sub-Agents\n\nSlash Commands (Primitive Layer)\n   The fundamental building block\n\nMCP Servers (Integration Layer)\n   Connect external systems\n```\n\n### Golden Rules\n\n1. **Always start with prompts** - Master the primitive first\n2. **\"Parallel\" = Sub-Agents** - Nothing else supports parallel execution\n3. **External = MCP, Internal = Skills** - Clear separation of concerns\n4. **One-off = Slash Command** - Don't over-engineer\n5. **Repeat + Management = Skill** - Only scale when needed\n6. **Don't convert all slash commands to skills** - Huge mistake\n7. **Context, Model, Prompt, Tools** - Never forget the foundation\n\n## Documentation Structure\n\nThis skill uses progressive disclosure. Start here, then navigate to specific topics as needed.\n\n### Reference Documentation\n\n**Architecture fundamentals** - What each component is and how they work\n\n- **[architecture.md](reference/architecture.md)** - Component definitions, capabilities, restrictions\n- **[core-4-framework.md](reference/core-4-framework.md)** - Deep dive into Context, Model, Prompt, Tools\n\n### Implementation Patterns\n\n**How to use components effectively** - Decision-making and implementation\n\n- **[decision-framework.md](patterns/decision-framework.md)** - When to use Skills vs Sub-Agents vs MCP vs Slash Commands\n- **[hooks-in-composition.md](patterns/hooks-in-composition.md)** - Implementing hooks for observability and control\n- **[orchestrator-pattern.md](patterns/orchestrator-pattern.md)** - Multi-agent orchestration at scale\n- **[context-management.md](patterns/context-management.md)** - Managing context across agents\n- **[context-in-composition.md](patterns/context-in-composition.md)** - Context handling in multi-agent systems\n\n### Anti-Patterns\n\n#### Common mistakes to avoid\n\n- **[common-mistakes.md](anti-patterns/common-mistakes.md)** - Converting all slash commands to\n  skills, using skills for one-offs, context explosion, and more\n\n### Examples\n\n#### Real-world case studies and progression paths\n\n- **[progression-example.md](examples/progression-example.md)** - Evolution from prompt  sub-agent  skill (work tree manager example)\n- **[case-studies.md](examples/case-studies.md)** - Scout-builder patterns, orchestration workflows, multi-agent systems\n\n### Workflows\n\n#### Visual guides and decision trees\n\n- **[decision-tree.md](workflows/decision-tree.md)** - Decision trees, mindmaps, and visual guides for choosing components\n\n## Getting Started\n\n### If you're new to Claude Code\n\n1. Start with **[reference/architecture.md](reference/architecture.md)** to understand components\n2. Read **[reference/core-4-framework.md](reference/core-4-framework.md)** to grasp the foundation\n3. Use **[patterns/decision-framework.md](patterns/decision-framework.md)** to make your first architectural choice\n4. Check **[anti-patterns/common-mistakes.md](anti-patterns/common-mistakes.md)** to avoid pitfalls\n\n### If you're making an architectural decision\n\n1. Open **[patterns/decision-framework.md](patterns/decision-framework.md)**\n2. Follow the decision tree to identify the right component\n3. Review the specific component in **[reference/architecture.md](reference/architecture.md)**\n4. Check **[examples/](examples/)** for similar use cases\n\n### If you're adding observability\n\n1. Read **[patterns/hooks-in-composition.md](patterns/hooks-in-composition.md)** to understand available hooks and implementation\n2. Use isolated scripts pattern (UV, bun, or shell)\n\n### If you're scaling to multi-agent orchestration\n\n1. Ensure you've mastered custom agents first\n2. Read **[patterns/orchestrator-pattern.md](patterns/orchestrator-pattern.md)**\n3. Study **[examples/case-studies.md](examples/case-studies.md)**\n4. Review **[patterns/context-management.md](patterns/context-management.md)**\n\n## Key Principles from the Field\n\n### Prompts Are the Primitive\n\n> \"Do not give away the prompt. The prompt is the fundamental unit of knowledge work and of programming. If you don't know how to build and manage prompts, you will lose.\"\n\n**Everything is prompts in the end.** Master slash commands before skills. Have a strong bias toward slash commands.\n\n### Skills Are Compositional, Not Replacements\n\n> \"It is very clear this does not replace any existing feature or capability. It is a higher compositional level.\"\n\nSkills orchestrate other components; they don't replace them. Don't convert all your\nslash commands to skillsthat's a huge mistake.\n\n### Observability is Everything\n\n> \"When it comes to agentic coding, observability is everything. How well you can observe, iterate, and improve your agentic system is going to be a massive differentiating factor.\"\n\nIf you can't measure it, you can't improve it. If you can't measure it, you can't scale it.\n\n### Context Window Protection\n\n> \"200k context window is plenty. You're just stuffing a single agent with too much work. Don't force your agent to context switch.\"\n\nCreate focused agents with single purposes. Delete them when done. Treat agents as temporary, deletable resources.\n\n### The Agentic Engineering Progression\n\n```text\nLevel 1: Base agents        Use agents out of the box\nLevel 2: Better agents      Customize prompts and workflows\nLevel 3: More agents        Run multiple agents\nLevel 4: Custom agents      Build specialized solutions\nLevel 5: Orchestration      Manage fleets of agents\n```\n\n## Source Attribution\n\nThis knowledge synthesizes:\n\n- Video presentations by Claude Code engineering team\n- Official Claude Code documentation (docs.claude.com)\n- Hands-on experimentation and validation\n- Multi-agent orchestration patterns from the field\n\n## Quick Navigation\n\n**Need to understand what a component is?**  [reference/architecture.md](reference/architecture.md)\n\n**Need to choose the right component?**  [patterns/decision-framework.md](patterns/decision-framework.md)\n\n**Need to implement hooks?**  [patterns/hooks-in-composition.md](patterns/hooks-in-composition.md)\n\n**Need to scale to multiple agents?**  [patterns/orchestrator-pattern.md](patterns/orchestrator-pattern.md)\n\n**Need to see real examples?**  [examples/](examples/)\n\n**Need visual guides?**  [workflows/decision-tree.md](workflows/decision-tree.md)\n\n**Want to avoid mistakes?**  [anti-patterns/common-mistakes.md](anti-patterns/common-mistakes.md)\n\n---\n\n**Remember:** Context, Model, Prompt, Tools. Master these four, and you master Claude Code."
              },
              {
                "name": "skill-factory",
                "description": "Research-backed skill creation workflow with automated firecrawl research gathering, multi-tier validation, and comprehensive auditing. Use when \"create skills with research automation\", \"build research-backed skills\", \"validate skills end-to-end\", \"automate skill research and creation\", needs 9-phase workflow from research through final audit, wants firecrawl-powered research combined with validation, or requires quality-assured skill creation following Anthropic specifications for Claude Code.\n",
                "path": "plugins/meta/meta-claude/skills/skill-factory/SKILL.md",
                "frontmatter": {
                  "name": "skill-factory",
                  "description": "Research-backed skill creation workflow with automated firecrawl research gathering, multi-tier validation, and comprehensive auditing. Use when \"create skills with research automation\", \"build research-backed skills\", \"validate skills end-to-end\", \"automate skill research and creation\", needs 9-phase workflow from research through final audit, wants firecrawl-powered research combined with validation, or requires quality-assured skill creation following Anthropic specifications for Claude Code.\n"
                },
                "content": "# Skill Factory\n\nComprehensive workflow orchestrator for creating high-quality Claude Code skills with automated research, content\nreview, and multi-tier validation.\n\n## When to Use This Skill\n\nUse skill-factory when:\n\n- **Creating any new skill** - From initial idea to validated, production-ready skill\n- **Research needed** - Automate gathering of documentation, examples, and best practices\n- **Quality assurance required** - Ensure skills meet official specifications and best practices\n- **Guided workflow preferred** - Step-by-step progression with clear checkpoints\n- **Validation needed** - Runtime testing, integration checks, and comprehensive auditing\n\n**Scope:** Creates skills for ANY purpose (not limited to meta-claude plugin):\n\n- Infrastructure skills (terraform-best-practices, ansible-vault-security)\n- Development skills (docker-compose-helper, git-workflow-automation)\n- Domain-specific skills (brand-guidelines, conventional-git-commits)\n- Any skill that extends Claude's capabilities\n\n## Available Operations\n\nThe skill-factory provides 9 specialized commands for the create-review-validate lifecycle:\n\n| Command | Purpose | Use When |\n|---------|---------|----------|\n| `/meta-claude:skill:research` | Gather domain knowledge using firecrawl API | Need automated web scraping for skill research |\n| `/meta-claude:skill:format` | Clean and structure research materials | Have raw research needing markdown formatting |\n| `/meta-claude:skill:create` | Initialize skill structure with references | Ready to scaffold skill directory from research |\n| `/meta-claude:skill:write` | Synthesize references into SKILL.md content | Skill initialized but needs content written |\n| `/meta-claude:skill:review-content` | Validate content quality and clarity | Need content review before compliance check |\n| `/meta-claude:skill:review-compliance` | Run quick_validate.py on SKILL.md | Validate YAML frontmatter and naming conventions |\n| `/meta-claude:skill:validate-runtime` | Test skill loading in Claude context | Verify skill loads without syntax errors |\n| `/meta-claude:skill:validate-integration` | Check for conflicts with existing skills | Ensure no duplicate names or overlaps |\n| `/meta-claude:skill:validate-audit` | Invoke claude-skill-auditor agent | Get comprehensive audit against Anthropic specs |\n\n**Power user tip:** Commands work standalone or orchestrated. Use individual commands for targeted fixes,\nor invoke the skill for full workflow automation.\n\n**Visual learners:** See [workflows/visual-guide.md](workflows/visual-guide.md) for decision trees, state diagrams,\nand workflow visualizations.\n\n## Quick Decision Guide\n\n### Full Workflow vs Individual Commands\n\n**Creating new skill (full workflow):**\n\n- With research  `skill-factory <skill-name> <research-path>`\n- Without research  `skill-factory <skill-name>` (includes firecrawl research)\n- From knowledge only  `skill-factory <skill-name>`  Select \"Skip research\"\n\n**Using individual commands (power users):**\n\n| Scenario | Command | Why |\n|----------|---------|-----|\n| Need web research for skill topic | `/meta-claude:skill:research <name> [sources]` | Automated firecrawl scraping |\n| Have messy research files | `/meta-claude:skill:format <research-dir>` | Clean markdown formatting |\n| Ready to scaffold skill directory | `/meta-claude:skill:create <name> <research-dir>` | Creates structure with references |\n| Skill initialized, needs content | `/meta-claude:skill:write <skill-path>` | Synthesizes references into SKILL.md |\n| Content unclear or incomplete | `/meta-claude:skill:review-content <skill-path>` | Quality gate before compliance |\n| Check frontmatter syntax | `/meta-claude:skill:review-compliance <skill-path>` | Runs quick_validate.py |\n| Skill won't load in Claude | `/meta-claude:skill:validate-runtime <skill-path>` | Tests actual loading |\n| Worried about name conflicts | `/meta-claude:skill:validate-integration <skill-path>` | Checks existing skills |\n| Want Anthropic spec audit | `/meta-claude:skill:validate-audit <skill-path>` | Runs claude-skill-auditor |\n\n**When to use full workflow:** Creating new skills from scratch\n**When to use individual commands:** Fixing specific issues, power user iteration\n\nFor full workflow details, see Quick Start section below.\n\n## Quick Start\n\n### Path 1: Research Already Gathered\n\nIf you have research materials ready:\n\n```bash\n# Research exists at docs/research/skills/<skill-name>/\nskill-factory <skill-name> docs/research/skills/<skill-name>/\n```\n\nThe skill will:\n\n1. Format research materials\n2. Create skill structure (scaffold)\n3. Write skill content (synthesize references)\n4. Review content quality\n5. Review technical compliance\n6. Validate runtime loading\n7. Validate integration\n8. Run comprehensive audit\n9. Present completion options\n\n### Path 2: Research Needed\n\nIf starting from scratch:\n\n```bash\n# Let skill-factory handle research\nskill-factory <skill-name>\n```\n\nThe skill will ask about research sources and proceed through full workflow.\n\n### Example Usage\n\n```text\nUser: \"Create a skill for CodeRabbit code review best practices\"\n\nskill-factory detects no research path provided, asks:\n\n\"Have you already gathered research for this skill?\n[Yes - I have research at <path>]\n[No - Help me gather research]\n[Skip - I'll create from knowledge only]\"\n\nUser: \"No - Help me gather research\"\n\nskill-factory proceeds through Path 2:\n1. Research skill domain\n2. Format research materials\n3. Create skill structure\n... (continues through all phases)\n```\n\n## When This Skill Is Invoked\n\n**Your role:** You are the skill-factory orchestrator. Your task is to guide the user through creating\na high-quality, validated skill using 9 primitive slash commands.\n\n### Step 1: Entry Point Detection\n\nAnalyze the user's prompt to determine which workflow path to use:\n\n**If research path is explicitly provided:**\n\n```text\nUser: \"skill-factory coderabbit docs/research/skills/coderabbit/\"\n Use Path 1 (skip research phase)\n```\n\n**If no research path is provided:**\n\nAsk the user using AskUserQuestion:\n\n```text\n\"Have you already gathered research for this skill?\"\n\nOptions:\n[Yes - I have research at a specific location]\n[No - Help me gather research]\n[Skip - I'll create from knowledge only]\n```\n\n**Based on user response:**\n\n- **Yes**  Ask for research path, use Path 1\n- **No**  Use Path 2 (include research phase)\n- **Skip**  Use Path 1 without research (create from existing knowledge)\n\n### Step 2: Initialize TodoWrite\n\nCreate a TodoWrite list based on the selected path:\n\n**Path 2 (Full Workflow with Research):**\n\n```javascript\nTodoWrite([\n  {\"content\": \"Research skill domain\", \"status\": \"pending\", \"activeForm\": \"Researching skill domain\"},\n  {\"content\": \"Format research materials\", \"status\": \"pending\", \"activeForm\": \"Formatting research materials\"},\n  {\"content\": \"Create skill structure\", \"status\": \"pending\", \"activeForm\": \"Creating skill structure\"},\n  {\"content\": \"Write skill content\", \"status\": \"pending\", \"activeForm\": \"Writing skill content\"},\n  {\"content\": \"Review content quality\", \"status\": \"pending\", \"activeForm\": \"Reviewing content quality\"},\n  {\"content\": \"Review technical compliance\", \"status\": \"pending\", \"activeForm\": \"Reviewing technical compliance\"},\n  {\"content\": \"Validate runtime loading\", \"status\": \"pending\", \"activeForm\": \"Validating runtime loading\"},\n  {\"content\": \"Validate integration\", \"status\": \"pending\", \"activeForm\": \"Validating integration\"},\n  {\"content\": \"Run comprehensive audit\", \"status\": \"pending\", \"activeForm\": \"Running comprehensive audit\"},\n  {\"content\": \"Complete workflow\", \"status\": \"pending\", \"activeForm\": \"Completing workflow\"}\n])\n```\n\n**Path 1 (Research Exists or Skipped):**\n\nOmit the first \"Research skill domain\" task. Start with \"Format research materials\" or\n\"Create skill structure\" depending on whether research exists.\n\n### Step 3: Execute Workflow Sequentially\n\nFor each phase in the workflow, follow this pattern:\n\n#### 1. Mark phase as in_progress\n\nUpdate the corresponding TodoWrite item to `in_progress` status.\n\n#### 2. Check dependencies\n\nBefore running a command, verify prior phases completed:\n\n- Write requires create to complete (needs skill structure with references)\n- Review-content requires write to complete (needs actual content to review)\n- Review-compliance requires review-content to pass\n- Validate-runtime requires review-compliance to pass\n- Validate-integration requires validate-runtime to pass\n- Validate-audit runs regardless (non-blocking feedback)\n\n#### 3. Invoke command using SlashCommand tool\n\n```text\n/meta-claude:skill:research <skill-name> [sources]\n/meta-claude:skill:format <research-dir>\n/meta-claude:skill:create <skill-name> <research-dir>\n/meta-claude:skill:write <skill-path>\n/meta-claude:skill:review-content <skill-path>\n/meta-claude:skill:review-compliance <skill-path>\n/meta-claude:skill:validate-runtime <skill-path>\n/meta-claude:skill:validate-integration <skill-path>\n/meta-claude:skill:validate-audit <skill-path>\n```\n\n**IMPORTANT:** Wait for each command to complete before proceeding to the next phase.\nDo not invoke multiple commands in parallel.\n\n#### 4. Check command result\n\nEach command returns success or failure with specific error details.\n\n#### 5. Apply fix strategy if needed\n\nThe workflow uses a three-tier fix strategy:\n\n- **Tier 1 (Simple):** Auto-fix formatting, frontmatter, markdown syntax\n- **Tier 2 (Medium):** Guided fixes with user approval\n- **Tier 3 (Complex):** Stop and report - requires manual fixes\n\n**One-shot policy:** Each fix applied once, re-run once, then fail fast if still broken.\n\n**For complete tier definitions, issue categorization, examples, and fix workflows:**\nSee [references/error-handling.md](references/error-handling.md)\n\n#### 6. Mark phase completed\n\nUpdate TodoWrite item to `completed` status.\n\n#### 7. Continue to next phase\n\nProceed to the next workflow phase, or exit if fail-fast triggered.\n\n### Step 4: Completion\n\nWhen all phases pass successfully:\n\n**Present completion summary:**\n\n```text\n Skill created and validated successfully!\n\nLocation: <skill-output-path>/\n\nResearch materials: docs/research/skills/<skill-name>/\n```\n\n**Ask about artifact cleanup:**\n\n```text\nKeep research materials? [Keep/Remove] (default: Keep)\n```\n\n**Present next steps using AskUserQuestion:**\n\n```text\nNext steps - choose an option:\n[Test in new session - Skills require session reload to be discoverable]\n[Create PR - Submit skill to repository]\n[Done - Exit workflow]\n```\n\n**Execute user's choice:**\n\n- **Test in new session**  Skills load at session start. User must restart Claude Code to test.\n- **Create PR**  Create git branch, commit, push, open PR\n- **Done**  Clean exit\n\n**Note:** Skills auto-discover based on directory structure - no plugin.json registration needed.\n\n### Key Execution Principles\n\n**Sequential Execution:** Do not run commands in parallel. Wait for each phase to complete before proceeding.\n\n**Context Window Protection:** You are orchestrating commands, not sub-agents. Your context window is safe\nbecause you're invoking slash commands sequentially, not spawning multiple agents.\n\n**State Management:** TodoWrite provides real-time progress visibility. Update it at every phase\ntransition.\n\n**Fail Fast:** When Tier 3 issues occur or user declines fixes, exit immediately with clear guidance.\nDon't attempt complex recovery.\n\n**Dependency Enforcement:** Never skip dependency checks. Review phases are sequential, validation\nphases are tiered.\n\n**One-shot Fixes:** Apply each fix once, re-run once, then fail if still broken. This prevents infinite loops.\n\n**User Communication:** Report progress clearly. Show which phase is running, what the result was,\nand what's happening next.\n\n## Workflow Architecture\n\nTwo paths based on research availability: Path 1 (research exists) and Path 2 (research needed).\nTodoWrite tracks progress through 8-10 phases. Entry point detection uses prompt analysis and AskUserQuestion.\n\n**Details:** See [references/workflow-architecture.md](references/workflow-architecture.md)\n\n## Workflow Execution\n\nSequential phase invocation pattern: mark in_progress  check dependencies  invoke command \ncheck result  apply fixes  mark completed  continue. Dependencies enforced (review sequential,\nvalidation tiered). Commands invoked via SlashCommand tool with wait-for-completion pattern.\n\n**Details:** See [references/workflow-execution.md](references/workflow-execution.md)\n\n## Success Completion\n\nWhen all phases pass successfully:\n\n```text\n Skill created and validated successfully!\n\nLocation: <skill-output-path>/\n\nResearch materials: docs/research/skills/<skill-name>/\nKeep research materials? [Keep/Remove] (default: Keep)\n```\n\n**Artifact Cleanup:**\n\nAsk user about research materials:\n\n- **Keep** (default): Preserves research for future iterations, builds knowledge base\n- **Remove**: Cleans up workspace, research can be re-gathered if needed\n\n**Next Steps:**\n\nPresent options to user:\n\n```text\nNext steps - choose an option:\n  [1] Test in new session - Skills require session reload to be discoverable\n  [2] Create PR - Submit skill to repository\n  [3] Done - Exit workflow\n\nWhat would you like to do?\n```\n\n**User Actions:**\n\n1. **Test in new session**  Skills load at session start. User must restart Claude Code to test.\n2. **Create PR**  Create git branch, commit, push, open PR\n3. **Done**  Clean exit\n\n**Note:** Skills auto-discover based on directory structure - no plugin.json registration needed.\n\nExecute the user's choice, then exit cleanly.\n\n## Examples\n\nThe skill-factory workflow supports various scenarios:\n\n1. **Path 2 (Full Workflow):** Creating skills from scratch with automated research gathering\n2. **Path 1 (Existing Research):** Creating skills when research materials already exist\n3. **Guided Fix Workflow:** Applying Tier 2 fixes with user approval\n4. **Fail-Fast Pattern:** Handling Tier 3 complex issues with immediate exit\n\n**Detailed Examples:** See [references/workflow-examples.md](references/workflow-examples.md) for complete walkthrough\nscenarios showing TodoWrite state transitions, command invocations, error handling, and success paths.\n\n## Design Principles\n\nSix core principles: (1) Primitives First (slash commands foundation), (2) KISS State Management (TodoWrite only),\n(3) Fail Fast (no complex recovery), (4) Context-Aware Entry (prompt analysis), (5) Composable & Testable\n(standalone or orchestrated), (6) Quality Gates (sequential dependencies).\n\n**Details:** See [references/design-principles.md](references/design-principles.md)\n\n## Implementation Notes\n\n### Command-Based Architecture\n\nskill-factory orchestrates 9 primitive slash commands through a sequential workflow:\n\n**Creation Phase:**\n\n- `/meta-claude:skill:research`  Gather domain knowledge via firecrawl\n- `/meta-claude:skill:format`  Clean and structure research materials\n- `/meta-claude:skill:create`  Scaffold skill directory with references (runs init_skill.py)\n- `/meta-claude:skill:write`  Synthesize references into SKILL.md content\n\n**Validation Phase:**\n\n- `/meta-claude:skill:review-content`  Quality gate for clarity and completeness\n- `/meta-claude:skill:review-compliance`  Technical validation via quick_validate.py\n- `/meta-claude:skill:validate-runtime`  Test actual skill loading\n- `/meta-claude:skill:validate-integration`  Check for naming conflicts\n- `/meta-claude:skill:validate-audit`  Comprehensive audit via claude-skill-auditor agent\n\nEach command is standalone and testable. skill-factory provides orchestration, not abstraction.\n\n### Progressive Disclosure\n\nThis skill provides:\n\n1. **Quick Start** - Fast path for common use cases\n2. **Workflow Architecture** - Understanding the orchestration model\n3. **Detailed Phase Documentation** - Deep dive into each phase\n4. **Error Handling** - Comprehensive fix strategies\n5. **Examples** - Real-world scenarios\n\nLoad sections as needed for your use case.\n\n## Troubleshooting\n\nCommon issues: research phase failures (check FIRECRAWL_API_KEY), content review loops (Tier 3 issues need\nredesign), compliance validation (run quick_validate.py manually), integration conflicts (check duplicate names).\n\n**Details:** See [references/troubleshooting.md](references/troubleshooting.md)\n\n## Success Metrics\n\nYou know skill-factory succeeds when:\n\n1. **Time to create skill:** Reduced from hours to minutes\n2. **Skill quality:** 100% compliance with official specs on first validation\n3. **User satisfaction:** Beginners create high-quality skills without deep knowledge\n4. **Maintainability:** Primitives are independently testable and reusable\n5. **Workflow clarity:** Users understand current phase and next steps at all times\n\n## Related Resources\n\n- **multi-agent-composition skill** - Architectural patterns and composition rules\n- **Primitive commands** - Individual slash commands under `/meta-claude:skill:*` namespace\n- **quick_validate.py** - Compliance validation script\n- **skill-audit-agent** - Comprehensive skill audit agent"
              },
              {
                "name": "agent-development",
                "description": "This skill should be used when the user asks to \"create an agent\", \"add an agent\", \"write a subagent\", \"agent frontmatter\", \"when to use description\", \"agent examples\", \"agent tools\", \"agent colors\", \"autonomous agent\", or needs guidance on agent structure, system prompts, triggering conditions, or agent development best practices for Claude Code plugins.",
                "path": "plugins/meta/plugin-dev/skills/agent-development/SKILL.md",
                "frontmatter": {
                  "name": "agent-development",
                  "description": "This skill should be used when the user asks to \"create an agent\", \"add an agent\", \"write a subagent\", \"agent frontmatter\", \"when to use description\", \"agent examples\", \"agent tools\", \"agent colors\", \"autonomous agent\", or needs guidance on agent structure, system prompts, triggering conditions, or agent development best practices for Claude Code plugins."
                },
                "content": "# Agent Development for Claude Code Plugins\n\n## Overview\n\nAgents are autonomous subprocesses that handle complex, multi-step tasks independently. Understanding agent structure, triggering conditions, and system prompt design enables creating powerful autonomous capabilities.\n\n**Key concepts:**\n\n- Agents are FOR autonomous work, commands are FOR user-initiated actions\n- Markdown file format with YAML frontmatter\n- Triggering via description field with examples\n- System prompt defines agent behavior\n- Model and color customization\n\n## Agent File Structure\n\n### Complete Format\n\n```markdown\n---\nname: agent-identifier\ndescription: Use this agent when [triggering conditions]. Examples:\n\n<example>\nContext: [Situation description]\nuser: \"[User request]\"\nassistant: \"[How assistant should respond and use this agent]\"\n<commentary>\n[Why this agent should be triggered]\n</commentary>\n</example>\n\n<example>\n[Additional example...]\n</example>\n\nmodel: inherit\ncolor: blue\ntools: [\"Read\", \"Write\", \"Grep\"]\n---\n\nYou are [agent role description]...\n\n**Your Core Responsibilities:**\n1. [Responsibility 1]\n2. [Responsibility 2]\n\n**Analysis Process:**\n[Step-by-step workflow]\n\n**Output Format:**\n[What to return]\n```\n\n## Frontmatter Fields\n\n### name (required)\n\nAgent identifier used for namespacing and invocation.\n\n**Format:** lowercase, numbers, hyphens only\n**Length:** 3-50 characters\n**Pattern:** Must start and end with alphanumeric\n\n**Good examples:**\n\n- `code-reviewer`\n- `test-generator`\n- `api-docs-writer`\n- `security-analyzer`\n\n**Bad examples:**\n\n- `helper` (too generic)\n- `-agent-` (starts/ends with hyphen)\n- `my_agent` (underscores not allowed)\n- `ag` (too short, < 3 chars)\n\n### description (required)\n\nDefines when Claude should trigger this agent. **This is the most critical field.**\n\n**Must include:**\n\n1. Triggering conditions (\"Use this agent when...\")\n2. Multiple `<example>` blocks showing usage\n3. Context, user request, and assistant response in each example\n4. `<commentary>` explaining why agent triggers\n\n**Format:**\n\n```text\nUse this agent when [conditions]. Examples:\n\n<example>\nContext: [Scenario description]\nuser: \"[What user says]\"\nassistant: \"[How Claude should respond]\"\n<commentary>\n[Why this agent is appropriate]\n</commentary>\n</example>\n\n[More examples...]\n```\n\n**Best practices:**\n\n- Include 2-4 concrete examples\n- Show proactive and reactive triggering\n- Cover different phrasings of same intent\n- Explain reasoning in commentary\n- Be specific about when NOT to use the agent\n\n### model (required)\n\nWhich model the agent should use.\n\n**Options:**\n\n- `inherit` - Use same model as parent (recommended)\n- `sonnet` - Claude Sonnet (balanced)\n- `opus` - Claude Opus (most capable, expensive)\n- `haiku` - Claude Haiku (fast, cheap)\n\n**Recommendation:** Use `inherit` unless agent needs specific model capabilities.\n\n### color (required)\n\nVisual identifier for agent in UI.\n\n**Options:** `blue`, `cyan`, `green`, `yellow`, `magenta`, `red`\n\n**Guidelines:**\n\n- Choose distinct colors for different agents in same plugin\n- Use consistent colors for similar agent types\n- Blue/cyan: Analysis, review\n- Green: Success-oriented tasks\n- Yellow: Caution, validation\n- Red: Critical, security\n- Magenta: Creative, generation\n\n### tools (optional)\n\nRestrict agent to specific tools.\n\n**Format:** Array of tool names\n\n```yaml\ntools: [\"Read\", \"Write\", \"Grep\", \"Bash\"]\n```\n\n**Default:** If omitted, agent has access to all tools\n\n**Best practice:** Limit tools to minimum needed (principle of least privilege)\n\n**Common tool sets:**\n\n- Read-only analysis: `[\"Read\", \"Grep\", \"Glob\"]`\n- Code generation: `[\"Read\", \"Write\", \"Grep\"]`\n- Testing: `[\"Read\", \"Bash\", \"Grep\"]`\n- Full access: Omit field or use `[\"*\"]`\n\n### permissionMode (optional)\n\nControls how permissions are handled for the agent.\n\n**Options:**\n\n- `default` - Normal permission prompts\n- `acceptEdits` - Auto-accept file edits\n- `bypassPermissions` - Skip all permission prompts\n- `plan` - Plan mode only\n- `ignore` - Ignore permission settings\n\n**Default:** `default`\n\n### skills (optional)\n\nSkills to auto-load when the agent starts.\n\n**Format:** Comma-separated list of skill names\n\n```yaml\nskills: debugging, code-review\n```\n\n**Use case:** When an agent needs specific domain knowledge from skills to do its job effectively.\n\n### capabilities (optional)\n\nArray of specific tasks or capabilities the agent excels at. **Plugin subagents only.**\n\n**Format:** Array of strings\n\n```yaml\ncapabilities: [\"code review\", \"security analysis\", \"refactoring\"]\n```\n\n**Use case:** Describes agent specializations for plugin agents. Helps users understand what the agent can do.\n\n## System Prompt Design\n\nThe markdown body becomes the agent's system prompt. Write in second person, addressing the agent directly.\n\n### Structure\n\n**Standard template:**\n\n```markdown\nYou are [role] specializing in [domain].\n\n**Your Core Responsibilities:**\n1. [Primary responsibility]\n2. [Secondary responsibility]\n3. [Additional responsibilities...]\n\n**Analysis Process:**\n1. [Step one]\n2. [Step two]\n3. [Step three]\n[...]\n\n**Quality Standards:**\n- [Standard 1]\n- [Standard 2]\n\n**Output Format:**\nProvide results in this format:\n- [What to include]\n- [How to structure]\n\n**Edge Cases:**\nHandle these situations:\n- [Edge case 1]: [How to handle]\n- [Edge case 2]: [How to handle]\n```\n\n### Best Practices\n\n **DO:**\n\n- Write in second person (\"You are...\", \"You will...\")\n- Be specific about responsibilities\n- Provide step-by-step process\n- Define output format\n- Include quality standards\n- Address edge cases\n- Keep under 10,000 characters\n\n **DON'T:**\n\n- Write in first person (\"I am...\", \"I will...\")\n- Be vague or generic\n- Omit process steps\n- Leave output format undefined\n- Skip quality guidance\n- Ignore error cases\n\n## Creating Agents\n\n### Method 1: AI-Assisted Generation\n\nUse this prompt pattern (extracted from Claude Code):\n\n```text\nCreate an agent configuration based on this request: \"[YOUR DESCRIPTION]\"\n\nRequirements:\n1. Extract core intent and responsibilities\n2. Design expert persona for the domain\n3. Create comprehensive system prompt with:\n   - Clear behavioral boundaries\n   - Specific methodologies\n   - Edge case handling\n   - Output format\n4. Create identifier (lowercase, hyphens, 3-50 chars)\n5. Write description with triggering conditions\n6. Include 2-3 <example> blocks showing when to use\n\nReturn JSON with:\n{\n  \"identifier\": \"agent-name\",\n  \"whenToUse\": \"Use this agent when... Examples: <example>...</example>\",\n  \"systemPrompt\": \"You are...\"\n}\n```\n\nThen convert to agent file format with frontmatter.\n\nSee `examples/agent-creation-prompt.md` for complete template.\n\n### Method 2: Manual Creation\n\n1. Choose agent identifier (3-50 chars, lowercase, hyphens)\n2. Write description with examples\n3. Select model (usually `inherit`)\n4. Choose color for visual identification\n5. Define tools (if restricting access)\n6. Write system prompt with structure above\n7. Save as `agents/agent-name.md`\n\n## Validation Rules\n\n### Identifier Validation\n\n```text\n Valid: code-reviewer, test-gen, api-analyzer-v2\n Invalid: ag (too short), -start (starts with hyphen), my_agent (underscore)\n```\n\n**Rules:**\n\n- 3-50 characters\n- Lowercase letters, numbers, hyphens only\n- Must start and end with alphanumeric\n- No underscores, spaces, or special characters\n\n### Description Validation\n\n**Length:** 10-5,000 characters\n**Must include:** Triggering conditions and examples\n**Best:** 200-1,000 characters with 2-4 examples\n\n### System Prompt Validation\n\n**Length:** 20-10,000 characters\n**Best:** 500-3,000 characters\n**Structure:** Clear responsibilities, process, output format\n\n## Agent Organization\n\n### Plugin Agents Directory\n\n```bash\nplugin-name/\n agents/\n     analyzer.md\n     reviewer.md\n     generator.md\n```\n\nAll `.md` files in `agents/` are auto-discovered.\n\n### Namespacing\n\nAgents are namespaced automatically:\n\n- Single plugin: `agent-name`\n- With subdirectories: `plugin:subdir:agent-name`\n\n## Testing Agents\n\n### Test Triggering\n\nCreate test scenarios to verify agent triggers correctly:\n\n1. Write agent with specific triggering examples\n2. Use similar phrasing to examples in test\n3. Check Claude loads the agent\n4. Verify agent provides expected functionality\n\n### Test System Prompt\n\nEnsure system prompt is complete:\n\n1. Give agent typical task\n2. Check it follows process steps\n3. Verify output format is correct\n4. Test edge cases mentioned in prompt\n5. Confirm quality standards are met\n\n## Quick Reference\n\n### Minimal Agent\n\n```markdown\n---\nname: simple-agent\ndescription: Use this agent when... Examples: <example>...</example>\nmodel: inherit\ncolor: blue\n---\n\nYou are an agent that [does X].\n\nProcess:\n1. [Step 1]\n2. [Step 2]\n\nOutput: [What to provide]\n```\n\n### Frontmatter Fields Summary\n\n| Field | Required | Format | Example |\n|-------|----------|--------|---------|\n| name | Yes | lowercase-hyphens | code-reviewer |\n| description | Yes | Text + examples | Use when... <example>... |\n| model | Yes | inherit/sonnet/opus/haiku | inherit |\n| color | Yes | Color name | blue |\n| tools | No | Array of tool names | [\"Read\", \"Grep\"] |\n| permissionMode | No | Mode string | default |\n| skills | No | Comma-separated names | debugging, code-review |\n| capabilities | No | Array of strings (plugin only) | [\"code review\"] |\n\n### Best Practices\n\n**DO:**\n\n-  Include 2-4 concrete examples in description\n-  Write specific triggering conditions\n-  Use `inherit` for model unless specific need\n-  Choose appropriate tools (least privilege)\n-  Write clear, structured system prompts\n-  Test agent triggering thoroughly\n\n**DON'T:**\n\n-  Use generic descriptions without examples\n-  Omit triggering conditions\n-  Give all agents same color\n-  Grant unnecessary tool access\n-  Write vague system prompts\n-  Skip testing\n\n## Additional Resources\n\n### Reference Files\n\nFor detailed guidance, consult:\n\n- **`references/agent-spec.md`** - The official specification\n- **`references/system-prompt-design.md`** - Complete system prompt patterns\n- **`references/triggering-examples.md`** - Example formats and best practices\n- **`references/agent-creation-system-prompt.md`** - The exact prompt from Claude Code\n\n### Example Files\n\nWorking examples in `examples/`:\n\n- **`agent-creation-prompt.md`** - AI-assisted agent generation template\n- **`complete-agent-examples.md`** - Full agent examples for different use cases\n\n### Utility Scripts\n\nDevelopment tools in `scripts/`:\n\n- **`validate-agent.sh`** - Validate agent file structure\n- **`test-agent-trigger.sh`** - Test if agent triggers correctly\n\n## Implementation Workflow\n\nTo create an agent for a plugin:\n\n1. Define agent purpose and triggering conditions\n2. Choose creation method (AI-assisted or manual)\n3. Create `agents/agent-name.md` file\n4. Write frontmatter with all required fields\n5. Write system prompt following best practices\n6. Include 2-4 triggering examples in description\n7. Validate with `scripts/validate-agent.sh`\n8. Test triggering with real scenarios\n9. Document agent in plugin README\n\nFocus on clear triggering conditions and comprehensive system prompts for autonomous operation."
              },
              {
                "name": "command-development",
                "description": "This skill should be used when the user asks to \"create a slash command\", \"add a command\", \"write a custom command\", \"define command arguments\", \"use command frontmatter\", \"organize commands\", \"create command with file references\", \"interactive command\", \"use AskUserQuestion in command\", or needs guidance on slash command structure, YAML frontmatter fields, dynamic arguments, bash execution in commands, user interaction patterns, or command development best practices for Claude Code.",
                "path": "plugins/meta/plugin-dev/skills/command-development/SKILL.md",
                "frontmatter": {
                  "name": "command-development",
                  "description": "This skill should be used when the user asks to \"create a slash command\", \"add a command\", \"write a custom command\", \"define command arguments\", \"use command frontmatter\", \"organize commands\", \"create command with file references\", \"interactive command\", \"use AskUserQuestion in command\", or needs guidance on slash command structure, YAML frontmatter fields, dynamic arguments, bash execution in commands, user interaction patterns, or command development best practices for Claude Code."
                },
                "content": "# Command Development for Claude Code\n\n> **Reference:** See [command-spec.md](references/command-spec.md) for the official specification.\n\n## Overview\n\nSlash commands are frequently-used prompts defined as Markdown files that Claude executes during interactive sessions. Understanding command structure, frontmatter options, and dynamic features enables creating powerful, reusable workflows.\n\n**Key concepts:**\n\n- Markdown file format for commands\n- YAML frontmatter for configuration\n- Dynamic arguments and file references\n- Bash execution for context\n- Command organization and namespacing\n\n## Command Basics\n\n### What is a Slash Command?\n\nA slash command is a Markdown file containing a prompt that Claude executes when invoked. Commands provide:\n\n- **Reusability**: Define once, use repeatedly\n- **Consistency**: Standardize common workflows\n- **Sharing**: Distribute across team or projects\n- **Efficiency**: Quick access to complex prompts\n\n### Critical: Commands are Instructions FOR Claude\n\n**Commands are written for agent consumption, not human consumption.**\n\nWhen a user invokes `/command-name`, the command content becomes Claude's instructions. Write commands as directives TO Claude about what to do, not as messages TO the user.\n\n**Correct approach (instructions for Claude):**\n\n```markdown\nReview this code for security vulnerabilities including:\n- SQL injection\n- XSS attacks\n- Authentication issues\n\nProvide specific line numbers and severity ratings.\n```\n\n**Incorrect approach (messages to user):**\n\n```markdown\nThis command will review your code for security issues.\nYou'll receive a report with vulnerability details.\n```\n\nThe first example tells Claude what to do. The second tells the user what will happen but doesn't instruct Claude. Always use the first approach.\n\n### Command Locations\n\n**Project commands** (shared with team):\n\n- Location: `.claude/commands/`\n- Scope: Available in specific project\n- Label: Shown as \"(project)\" in `/help`\n- Use for: Team workflows, project-specific tasks\n\n**Personal commands** (available everywhere):\n\n- Location: `~/.claude/commands/`\n- Scope: Available in all projects\n- Label: Shown as \"(user)\" in `/help`\n- Use for: Personal workflows, cross-project utilities\n\n**Plugin commands** (bundled with plugins):\n\n- Location: `plugin-name/commands/`\n- Scope: Available when plugin installed\n- Label: Shown as \"(plugin-name)\" in `/help`\n- Use for: Plugin-specific functionality\n\n## File Format\n\n### Basic Structure\n\nCommands are Markdown files with `.md` extension:\n\n```text\n.claude/commands/\n review.md           # /review command\n test.md             # /test command\n deploy.md           # /deploy command\n```\n\n**Simple command:**\n\n```markdown\nReview this code for security vulnerabilities including:\n- SQL injection\n- XSS attacks\n- Authentication bypass\n- Insecure data handling\n```\n\nNo frontmatter needed for basic commands.\n\n### With YAML Frontmatter\n\nAdd configuration using YAML frontmatter:\n\n```markdown\n---\ndescription: Review code for security issues\nallowed-tools: Read, Grep, Bash(git:*)\nmodel: sonnet\n---\n\nReview this code for security vulnerabilities...\n```\n\n## YAML Frontmatter Fields\n\n### description\n\n**Purpose:** Brief description shown in `/help`\n**Type:** String\n**Default:** First line of command prompt\n\n```yaml\n---\ndescription: Review pull request for code quality\n---\n```\n\n**Best practice:** Clear, actionable description (under 60 characters)\n\n### allowed-tools\n\n**Purpose:** Specify which tools command can use\n**Type:** Comma-separated string\n**Default:** Inherits from conversation\n\n```yaml\n---\nallowed-tools: Read, Write, Edit, Bash(git:*)\n---\n```\n\n**Note:** Always use comma-separated format on a single line. Do not use YAML array syntax.\n\n**Patterns:**\n\n- `Read, Write, Edit` - Specific tools\n- `Bash(git:*)` - Bash with git commands only\n- `*` - All tools (rarely needed)\n\n**Use when:** Command requires specific tool access\n\n### model\n\n**Purpose:** Specify model for command execution\n**Type:** String (sonnet, opus, haiku)\n**Default:** Inherits from conversation\n\n```yaml\n---\nmodel: haiku\n---\n```\n\n**Use cases:**\n\n- `haiku` - Fast, simple commands\n- `sonnet` - Standard workflows\n- `opus` - Complex analysis\n\n### argument-hint\n\n**Purpose:** Document expected arguments for autocomplete\n**Type:** String\n**Default:** None\n\n```yaml\n---\nargument-hint: [pr-number] [priority] [assignee]\n---\n```\n\n**Benefits:**\n\n- Helps users understand command arguments\n- Improves command discovery\n- Documents command interface\n\n### disable-model-invocation\n\n**Purpose:** Prevent SlashCommand tool from programmatically calling command\n**Type:** Boolean\n**Default:** false\n\n```yaml\n---\ndisable-model-invocation: true\n---\n```\n\n**Use when:** Command should only be manually invoked\n\n## Dynamic Arguments\n\n### Using $ARGUMENTS\n\nCapture all arguments as single string:\n\n```markdown\n---\ndescription: Fix issue by number\nargument-hint: [issue-number]\n---\n\nFix issue #$ARGUMENTS following our coding standards and best practices.\n```\n\n**Usage:**\n\n```text\n> /fix-issue 123\n> /fix-issue 456\n```\n\n**Expands to:**\n\n```text\nFix issue #123 following our coding standards...\nFix issue #456 following our coding standards...\n```\n\n### Using Positional Arguments\n\nCapture individual arguments with `$1`, `$2`, `$3`, etc.:\n\n```markdown\n---\ndescription: Review PR with priority and assignee\nargument-hint: [pr-number] [priority] [assignee]\n---\n\nReview pull request #$1 with priority level $2.\nAfter review, assign to $3 for follow-up.\n```\n\n**Usage:**\n\n```text\n> /review-pr 123 high alice\n```\n\n**Expands to:**\n\n```bash\nReview pull request #123 with priority level high.\nAfter review, assign to alice for follow-up.\n```\n\n### Combining Arguments\n\nMix positional and remaining arguments:\n\n```markdown\nDeploy $1 to $2 environment with options: $3\n```\n\n**Usage:**\n\n```text\n> /deploy api staging --force --skip-tests\n```\n\n**Expands to:**\n\n```text\nDeploy api to staging environment with options: --force --skip-tests\n```\n\n## File References\n\n### Using @ Syntax\n\nInclude file contents in command:\n\n```markdown\n---\ndescription: Review specific file\nargument-hint: [file-path]\n---\n\nReview @$1 for:\n- Code quality\n- Best practices\n- Potential bugs\n```\n\n**Usage:**\n\n```text\n> /review-file src/api/users.ts\n```\n\n**Effect:** Claude reads `src/api/users.ts` before processing command\n\n### Multiple File References\n\nReference multiple files:\n\n```markdown\nCompare @src/old-version.js with @src/new-version.js\n\nIdentify:\n- Breaking changes\n- New features\n- Bug fixes\n```\n\n### Static File References\n\nReference known files without arguments:\n\n```markdown\nReview @package.json and @tsconfig.json for consistency\n\nEnsure:\n- TypeScript version matches\n- Dependencies are aligned\n- Build configuration is correct\n```\n\n## Bash Execution in Commands\n\nCommands can execute bash commands inline to dynamically gather context before Claude processes the command. This is useful for including repository state, environment information, or project-specific context.\n\n**When to use:**\n\n- Include dynamic context (git status, environment vars, etc.)\n- Gather project/repository state\n- Build context-aware workflows\n\n**Implementation details:**\nFor complete syntax, examples, and best practices, see `references/plugin-features-reference.md` section on bash execution. The reference includes the exact syntax and multiple working examples to avoid execution issues\n\n## Command Organization\n\n### Flat Structure\n\nSimple organization for small command sets:\n\n```text\n.claude/commands/\n build.md\n test.md\n deploy.md\n review.md\n docs.md\n```\n\n**Use when:** 5-15 commands, no clear categories\n\n### Namespaced Structure\n\nOrganize commands in subdirectories:\n\n```text\n.claude/commands/\n ci/\n    build.md        # /build (project:ci)\n    test.md         # /test (project:ci)\n    lint.md         # /lint (project:ci)\n git/\n    commit.md       # /commit (project:git)\n    pr.md           # /pr (project:git)\n docs/\n     generate.md     # /generate (project:docs)\n     publish.md      # /publish (project:docs)\n```\n\n**Benefits:**\n\n- Logical grouping by category\n- Namespace shown in `/help`\n- Easier to find related commands\n\n**Use when:** 15+ commands, clear categories\n\n## Best Practices\n\n### Command Design\n\n1. **Single responsibility:** One command, one task\n2. **Clear descriptions:** Self-explanatory in `/help`\n3. **Explicit dependencies:** Use `allowed-tools` when needed\n4. **Document arguments:** Always provide `argument-hint`\n5. **Consistent naming:** Use verb-noun pattern (review-pr, fix-issue)\n\n### Argument Handling\n\n1. **Validate arguments:** Check for required arguments in prompt\n2. **Provide defaults:** Suggest defaults when arguments missing\n3. **Document format:** Explain expected argument format\n4. **Handle edge cases:** Consider missing or invalid arguments\n\n```markdown\n---\nargument-hint: [pr-number]\n---\n\n$IF($1,\n  Review PR #$1,\n  Please provide a PR number. Usage: /review-pr [number]\n)\n```\n\n### File References\n\n1. **Explicit paths:** Use clear file paths\n2. **Check existence:** Handle missing files gracefully\n3. **Relative paths:** Use project-relative paths\n4. **Glob support:** Consider using Glob tool for patterns\n\n### Bash Commands\n\n1. **Limit scope:** Use `Bash(git:*)` not `Bash(*)`\n2. **Safe commands:** Avoid destructive operations\n3. **Handle errors:** Consider command failures\n4. **Keep fast:** Long-running commands slow invocation\n\n### Documentation\n\n1. **Add comments:** Explain complex logic\n2. **Provide examples:** Show usage in comments\n3. **List requirements:** Document dependencies\n4. **Version commands:** Note breaking changes\n\n```markdown\n---\ndescription: Deploy application to environment\nargument-hint: [environment] [version]\n---\n\n<!--\nUsage: /deploy [staging|production] [version]\nRequires: AWS credentials configured\nExample: /deploy staging v1.2.3\n-->\n\nDeploy application to $1 environment using version $2...\n```\n\n## Common Patterns\n\n### Review Pattern\n\n```markdown\n---\ndescription: Review code changes\nallowed-tools: Read, Bash(git:*)\n---\n\nFiles changed: $ git diff --name-only\n\nReview each file for:\n1. Code quality and style\n2. Potential bugs or issues\n3. Test coverage\n4. Documentation needs\n\nProvide specific feedback for each file.\n```\n\n### Testing Pattern\n\n```markdown\n---\ndescription: Run tests for specific file\nargument-hint: [test-file]\nallowed-tools: Bash(npm:*)\n---\n\nRun tests: $ npm test $1\n\nAnalyze results and suggest fixes for failures.\n```\n\n### Documentation Pattern\n\n```markdown\n---\ndescription: Generate documentation for file\nargument-hint: [source-file]\n---\n\nGenerate comprehensive documentation for @$1 including:\n- Function/class descriptions\n- Parameter documentation\n- Return value descriptions\n- Usage examples\n- Edge cases and errors\n```\n\n### Workflow Pattern\n\n```markdown\n---\ndescription: Complete PR workflow\nargument-hint: [pr-number]\nallowed-tools: Bash(gh:*), Read\n---\n\nPR #$1 Workflow:\n\n1. Fetch PR: Run `gh pr view $1`\n2. Review changes\n3. Run checks\n4. Approve or request changes\n```\n\n## Troubleshooting\n\n**Command not appearing:**\n\n- Check file is in correct directory\n- Verify `.md` extension present\n- Ensure valid Markdown format\n- Restart Claude Code\n\n**Arguments not working:**\n\n- Verify `$1`, `$2` syntax correct\n- Check `argument-hint` matches usage\n- Ensure no extra spaces\n\n**Bash execution failing:**\n\n- Check `allowed-tools` includes Bash\n- Verify command syntax in backticks\n- Test command in terminal first\n- Check for required permissions\n\n**File references not working:**\n\n- Verify `@` syntax correct\n- Check file path is valid\n- Ensure Read tool allowed\n- Use absolute or project-relative paths\n\n## Plugin-Specific Features\n\n### CLAUDE_PLUGIN_ROOT Variable\n\nPlugin commands have access to `${CLAUDE_PLUGIN_ROOT}`, an environment variable that resolves to the plugin's absolute path.\n\n**Purpose:**\n\n- Reference plugin files portably\n- Execute plugin scripts\n- Load plugin configuration\n- Access plugin templates\n\n**Basic usage:**\n\n```markdown\n---\ndescription: Analyze using plugin script\nallowed-tools: Bash(node:*)\n---\n\nRun analysis: $ node ${CLAUDE_PLUGIN_ROOT}/scripts/analyze.js $1\n\nReview results and report findings.\n```\n\n**Common patterns:**\n\n```markdown\n# Execute plugin script\n$ bash ${CLAUDE_PLUGIN_ROOT}/scripts/script.sh\n\n# Load plugin configuration\n@${CLAUDE_PLUGIN_ROOT}/config/settings.json\n\n# Use plugin template\n@${CLAUDE_PLUGIN_ROOT}/templates/report.md\n\n# Access plugin resources\n@${CLAUDE_PLUGIN_ROOT}/docs/reference.md\n```\n\n**Why use it:**\n\n- Works across all installations\n- Portable between systems\n- No hardcoded paths needed\n- Essential for multi-file plugins\n\n### Plugin Command Organization\n\nPlugin commands discovered automatically from `commands/` directory:\n\n```text\nplugin-name/\n commands/\n    foo.md              # /foo (plugin:plugin-name)\n    bar.md              # /bar (plugin:plugin-name)\n    utils/\n        helper.md       # /helper (plugin:plugin-name:utils)\n plugin.json\n```\n\n**Namespace benefits:**\n\n- Logical command grouping\n- Shown in `/help` output\n- Avoid name conflicts\n- Organize related commands\n\n**Naming conventions:**\n\n- Use descriptive action names\n- Avoid generic names (test, run)\n- Consider plugin-specific prefix\n- Use hyphens for multi-word names\n\n### Plugin Command Patterns\n\n**Configuration-based pattern:**\n\n```markdown\n---\ndescription: Deploy using plugin configuration\nargument-hint: [environment]\nallowed-tools: Read, Bash(*)\n---\n\nLoad configuration: @${CLAUDE_PLUGIN_ROOT}/config/$1-deploy.json\n\nDeploy to $1 using configuration settings.\nMonitor deployment and report status.\n```\n\n**Template-based pattern:**\n\n```markdown\n---\ndescription: Generate docs from template\nargument-hint: [component]\n---\n\nTemplate: @${CLAUDE_PLUGIN_ROOT}/templates/docs.md\n\nGenerate documentation for $1 following template structure.\n```\n\n**Multi-script pattern:**\n\n```markdown\n---\ndescription: Complete build workflow\nallowed-tools: Bash(*)\n---\n\nBuild: $ bash ${CLAUDE_PLUGIN_ROOT}/scripts/build.sh\nTest: $ bash ${CLAUDE_PLUGIN_ROOT}/scripts/test.sh\nPackage: $ bash ${CLAUDE_PLUGIN_ROOT}/scripts/package.sh\n\nReview outputs and report workflow status.\n```\n\n**See `references/plugin-features-reference.md` for detailed patterns.**\n\n## Integration with Plugin Components\n\nCommands can integrate with other plugin components for powerful workflows.\n\n### Agent Integration\n\nLaunch plugin agents for complex tasks:\n\n```markdown\n---\ndescription: Deep code review\nargument-hint: [file-path]\n---\n\nInitiate comprehensive review of @$1 using the code-reviewer agent.\n\nThe agent will analyze:\n- Code structure\n- Security issues\n- Performance\n- Best practices\n\nAgent uses plugin resources:\n- ${CLAUDE_PLUGIN_ROOT}/config/rules.json\n- ${CLAUDE_PLUGIN_ROOT}/checklists/review.md\n```\n\n**Key points:**\n\n- Agent must exist in `plugin/agents/` directory\n- Claude uses Task tool to launch agent\n- Document agent capabilities\n- Reference plugin resources agent uses\n\n### Skill Integration\n\nLeverage plugin skills for specialized knowledge:\n\n```markdown\n---\ndescription: Document API with standards\nargument-hint: [api-file]\n---\n\nDocument API in @$1 following plugin standards.\n\nUse the api-docs-standards skill to ensure:\n- Complete endpoint documentation\n- Consistent formatting\n- Example quality\n- Error documentation\n\nGenerate production-ready API docs.\n```\n\n**Key points:**\n\n- Skill must exist in `plugin/skills/` directory\n- Mention skill name to trigger invocation\n- Document skill purpose\n- Explain what skill provides\n\n### Hook Coordination\n\nDesign commands that work with plugin hooks:\n\n- Commands can prepare state for hooks to process\n- Hooks execute automatically on tool events\n- Commands should document expected hook behavior\n- Guide Claude on interpreting hook output\n\nSee `references/plugin-features-reference.md` for examples of commands that coordinate with hooks\n\n### Multi-Component Workflows\n\nCombine agents, skills, and scripts:\n\n```markdown\n---\ndescription: Comprehensive review workflow\nargument-hint: [file]\nallowed-tools: Bash(node:*), Read\n---\n\nTarget: @$1\n\nPhase 1 - Static Analysis:\n$ node ${CLAUDE_PLUGIN_ROOT}/scripts/lint.js $1\n\nPhase 2 - Deep Review:\nLaunch code-reviewer agent for detailed analysis.\n\nPhase 3 - Standards Check:\nUse coding-standards skill for validation.\n\nPhase 4 - Report:\nTemplate: @${CLAUDE_PLUGIN_ROOT}/templates/review.md\n\nCompile findings into report following template.\n```\n\n**When to use:**\n\n- Complex multi-step workflows\n- Leverage multiple plugin capabilities\n- Require specialized analysis\n- Need structured outputs\n\n## Validation Patterns\n\nCommands should validate inputs and resources before processing.\n\n### Argument Validation\n\n```markdown\n---\ndescription: Deploy with validation\nargument-hint: [environment]\n---\n\nValidate environment: $ echo \"$1\" | grep -E \"^(dev|staging|prod)$\" || echo \"INVALID\"\n\nIf $1 is valid environment:\n  Deploy to $1\nOtherwise:\n  Explain valid environments: dev, staging, prod\n  Show usage: /deploy [environment]\n```\n\n### File Existence Checks\n\n```markdown\n---\ndescription: Process configuration\nargument-hint: [config-file]\n---\n\nCheck file exists: $ test -f $1 && echo \"EXISTS\" || echo \"MISSING\"\n\nIf file exists:\n  Process configuration: @$1\nOtherwise:\n  Explain where to place config file\n  Show expected format\n  Provide example configuration\n```\n\n### Plugin Resource Validation\n\n```markdown\n---\ndescription: Run plugin analyzer\nallowed-tools: Bash(test:*)\n---\n\nValidate plugin setup:\n- Script: $ test -x ${CLAUDE_PLUGIN_ROOT}/bin/analyze && echo \"\" || echo \"\"\n- Config: $ test -f ${CLAUDE_PLUGIN_ROOT}/config.json && echo \"\" || echo \"\"\n\nIf all checks pass, run analysis.\nOtherwise, report missing components.\n```\n\n### Error Handling\n\n```markdown\n---\ndescription: Build with error handling\nallowed-tools: Bash(*)\n---\n\nExecute build: $ bash ${CLAUDE_PLUGIN_ROOT}/scripts/build.sh 2>&1 || echo \"BUILD_FAILED\"\n\nIf build succeeded:\n  Report success and output location\nIf build failed:\n  Analyze error output\n  Suggest likely causes\n  Provide troubleshooting steps\n```\n\n**Best practices:**\n\n- Validate early in command\n- Provide helpful error messages\n- Suggest corrective actions\n- Handle edge cases gracefully\n\n---\n\nFor detailed frontmatter field specifications, see `references/frontmatter-reference.md`.\nFor plugin-specific features and patterns, see `references/plugin-features-reference.md`.\nFor command pattern examples, see `examples/` directory."
              },
              {
                "name": "hook-development",
                "description": "This skill should be used when the user asks to \"create a hook\", \"add a PreToolUse/PostToolUse/Stop hook\", \"validate tool use\", \"implement prompt-based hooks\", \"use ${CLAUDE_PLUGIN_ROOT}\", \"set up event-driven automation\", \"block dangerous commands\", or mentions hook events (PreToolUse, PostToolUse, Stop, SubagentStop, SessionStart, SessionEnd, UserPromptSubmit, PreCompact, Notification). Provides comprehensive guidance for creating and implementing Claude Code plugin hooks with focus on advanced prompt-based hooks API.",
                "path": "plugins/meta/plugin-dev/skills/hook-development/SKILL.md",
                "frontmatter": {
                  "name": "hook-development",
                  "description": "This skill should be used when the user asks to \"create a hook\", \"add a PreToolUse/PostToolUse/Stop hook\", \"validate tool use\", \"implement prompt-based hooks\", \"use ${CLAUDE_PLUGIN_ROOT}\", \"set up event-driven automation\", \"block dangerous commands\", or mentions hook events (PreToolUse, PostToolUse, Stop, SubagentStop, SessionStart, SessionEnd, UserPromptSubmit, PreCompact, Notification). Provides comprehensive guidance for creating and implementing Claude Code plugin hooks with focus on advanced prompt-based hooks API."
                },
                "content": "# Hook Development for Claude Code Plugins\n\n> **Reference:** See [hook-spec.md](references/hook-spec.md) for the official specification.\n\n## Overview\n\nHooks are event-driven automation scripts that execute in response to Claude Code events. Use hooks to validate operations, enforce policies, add context, and integrate external tools into workflows.\n\n**Key capabilities:**\n\n- Validate tool calls before execution (PreToolUse)\n- React to tool results (PostToolUse)\n- Enforce completion standards (Stop, SubagentStop)\n- Load project context (SessionStart)\n- Automate workflows across the development lifecycle\n\n## Hook Types\n\n### Prompt-Based Hooks (Recommended)\n\nUse LLM-driven decision making for context-aware validation:\n\n```json\n{\n  \"type\": \"prompt\",\n  \"prompt\": \"Evaluate if this tool use is appropriate: $TOOL_INPUT\",\n  \"timeout\": 30\n}\n```\n\n**Supported events:** Stop, SubagentStop, UserPromptSubmit, PreToolUse\n\n**Benefits:**\n\n- Context-aware decisions based on natural language reasoning\n- Flexible evaluation logic without bash scripting\n- Better edge case handling\n- Easier to maintain and extend\n\n### Command Hooks\n\nExecute bash commands for deterministic checks:\n\n```json\n{\n  \"type\": \"command\",\n  \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/validate.sh\",\n  \"timeout\": 60\n}\n```\n\n**Use for:**\n\n- Fast deterministic validations\n- File system operations\n- External tool integrations\n- Performance-critical checks\n\n## Hook Configuration Formats\n\n### Plugin hooks.json Format\n\n**For plugin hooks** in `hooks/hooks.json`, use wrapper format:\n\n```json\n{\n  \"description\": \"Brief explanation of hooks (optional)\",\n  \"hooks\": {\n    \"PreToolUse\": [...],\n    \"Stop\": [...],\n    \"SessionStart\": [...]\n  }\n}\n```\n\n**Key points:**\n\n- `description` field is optional\n- `hooks` field is required wrapper containing actual hook events\n- This is the **plugin-specific format**\n\n**Example:**\n\n```json\n{\n  \"description\": \"Validation hooks for code quality\",\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Write\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"${CLAUDE_PLUGIN_ROOT}/hooks/validate.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Settings Format (Direct)\n\n**For user settings** in `.claude/settings.json`, use direct format:\n\n```json\n{\n  \"PreToolUse\": [...],\n  \"Stop\": [...],\n  \"SessionStart\": [...]\n}\n```\n\n**Key points:**\n\n- No wrapper - events directly at top level\n- No description field\n- This is the **settings format**\n\n**Important:** The examples below show the hook event structure that goes inside either format. For plugin hooks.json, wrap these in `{\"hooks\": {...}}`.\n\n## Hook Events\n\n### PreToolUse\n\nExecute before any tool runs. Use to approve, deny, or modify tool calls.\n\n**Example (prompt-based):**\n\n```json\n{\n  \"PreToolUse\": [\n    {\n      \"matcher\": \"Write|Edit\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Validate file write safety. Check: system paths, credentials, path traversal, sensitive content. Return 'approve' or 'deny'.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Output for PreToolUse:**\n\n```json\n{\n  \"hookSpecificOutput\": {\n    \"permissionDecision\": \"allow|deny|ask\",\n    \"updatedInput\": {\"field\": \"modified_value\"}\n  },\n  \"systemMessage\": \"Explanation for Claude\"\n}\n```\n\n### PostToolUse\n\nExecute after tool completes. Use to react to results, provide feedback, or log.\n\n**Example:**\n\n```json\n{\n  \"PostToolUse\": [\n    {\n      \"matcher\": \"Edit\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Analyze edit result for potential issues: syntax errors, security vulnerabilities, breaking changes. Provide feedback.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Output behavior:**\n\n- Exit 0: stdout shown in transcript\n- Exit 2: stderr fed back to Claude\n- systemMessage included in context\n\n### Stop\n\nExecute when main agent considers stopping. Use to validate completeness.\n\n**Example:**\n\n```json\n{\n  \"Stop\": [\n    {\n      \"matcher\": \"*\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Verify task completion: tests run, build succeeded, questions answered. Return 'approve' to stop or 'block' with reason to continue.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Decision output:**\n\n```json\n{\n  \"decision\": \"approve|block\",\n  \"reason\": \"Explanation\",\n  \"systemMessage\": \"Additional context\"\n}\n```\n\n### SubagentStop\n\nExecute when subagent considers stopping. Use to ensure subagent completed its task.\n\nSimilar to Stop hook, but for subagents.\n\n### UserPromptSubmit\n\nExecute when user submits a prompt. Use to add context, validate, or block prompts.\n\n**Example:**\n\n```json\n{\n  \"UserPromptSubmit\": [\n    {\n      \"matcher\": \"*\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Check if prompt requires security guidance. If discussing auth, permissions, or API security, return relevant warnings.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n### SessionStart\n\nExecute when Claude Code session begins. Use to load context and set environment.\n\n**Example:**\n\n```json\n{\n  \"SessionStart\": [\n    {\n      \"matcher\": \"*\",\n      \"hooks\": [\n        {\n          \"type\": \"command\",\n          \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/load-context.sh\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Special capability:** Persist environment variables using `$CLAUDE_ENV_FILE`:\n\n```bash\necho \"export PROJECT_TYPE=nodejs\" >> \"$CLAUDE_ENV_FILE\"\n```\n\nSee `examples/load-context.sh` for complete example.\n\n### SessionEnd\n\nExecute when session ends. Use for cleanup, logging, and state preservation.\n\n### PreCompact\n\nExecute before context compaction. Use to add critical information to preserve.\n\n### Notification\n\nExecute when Claude sends notifications. Use to react to user notifications.\n\n## Hook Output Format\n\n### Standard Output (All Hooks)\n\n```json\n{\n  \"continue\": true,\n  \"suppressOutput\": false,\n  \"systemMessage\": \"Message for Claude\"\n}\n```\n\n- `continue`: If false, halt processing (default true)\n- `suppressOutput`: Hide output from transcript (default false)\n- `systemMessage`: Message shown to Claude\n\n### Exit Codes\n\n- `0` - Success (stdout shown in transcript)\n- `2` - Blocking error (stderr fed back to Claude)\n- Other - Non-blocking error\n\n## Hook Input Format\n\nAll hooks receive JSON via stdin with common fields:\n\n```json\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/path/to/transcript.txt\",\n  \"cwd\": \"/current/working/dir\",\n  \"permission_mode\": \"ask|allow\",\n  \"hook_event_name\": \"PreToolUse\"\n}\n```\n\n**Event-specific fields:**\n\n- **PreToolUse/PostToolUse:** `tool_name`, `tool_input`, `tool_result`\n- **UserPromptSubmit:** `user_prompt`\n- **Stop/SubagentStop:** `reason`\n\nAccess fields in prompts using `$TOOL_INPUT`, `$TOOL_RESULT`, `$USER_PROMPT`, etc.\n\n## Environment Variables\n\nAvailable in all command hooks:\n\n- `$CLAUDE_PROJECT_DIR` - Project root path\n- `$CLAUDE_PLUGIN_ROOT` - Plugin directory (use for portable paths)\n- `$CLAUDE_ENV_FILE` - SessionStart only: persist env vars here\n- `$CLAUDE_CODE_REMOTE` - Set if running in remote context\n\n**Always use ${CLAUDE_PLUGIN_ROOT} in hook commands for portability:**\n\n```json\n{\n  \"type\": \"command\",\n  \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/validate.sh\"\n}\n```\n\n## Plugin Hook Configuration\n\nIn plugins, define hooks in `hooks/hooks.json`:\n\n```json\n{\n  \"PreToolUse\": [\n    {\n      \"matcher\": \"Write|Edit\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Validate file write safety\"\n        }\n      ]\n    }\n  ],\n  \"Stop\": [\n    {\n      \"matcher\": \"*\",\n      \"hooks\": [\n        {\n          \"type\": \"prompt\",\n          \"prompt\": \"Verify task completion\"\n        }\n      ]\n    }\n  ],\n  \"SessionStart\": [\n    {\n      \"matcher\": \"*\",\n      \"hooks\": [\n        {\n          \"type\": \"command\",\n          \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/load-context.sh\",\n          \"timeout\": 10\n        }\n      ]\n    }\n  ]\n}\n```\n\nPlugin hooks merge with user's hooks and run in parallel.\n\n## Matchers\n\n### Tool Name Matching\n\n**Exact match:**\n\n```json\n\"matcher\": \"Write\"\n```\n\n**Multiple tools:**\n\n```json\n\"matcher\": \"Read|Write|Edit\"\n```\n\n**Wildcard (all tools):**\n\n```json\n\"matcher\": \"*\"\n```\n\n**Regex patterns:**\n\n```json\n\"matcher\": \"mcp__.*__delete.*\"  // All MCP delete tools\n```\n\n**Note:** Matchers are case-sensitive.\n\n### Common Patterns\n\n```json\n// All MCP tools\n\"matcher\": \"mcp__.*\"\n\n// Specific plugin's MCP tools\n\"matcher\": \"mcp__plugin_asana_.*\"\n\n// All file operations\n\"matcher\": \"Read|Write|Edit\"\n\n// Bash commands only\n\"matcher\": \"Bash\"\n```\n\n## Security Best Practices\n\n### Input Validation\n\nAlways validate inputs in command hooks:\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\ninput=$(cat)\ntool_name=$(echo \"$input\" | jq -r '.tool_name')\n\n# Validate tool name format\nif [[ ! \"$tool_name\" =~ ^[a-zA-Z0-9_]+$ ]]; then\n  echo '{\"decision\": \"deny\", \"reason\": \"Invalid tool name\"}' >&2\n  exit 2\nfi\n```\n\n### Path Safety\n\nCheck for path traversal and sensitive files:\n\n```bash\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path')\n\n# Deny path traversal\nif [[ \"$file_path\" == *\"..\"* ]]; then\n  echo '{\"decision\": \"deny\", \"reason\": \"Path traversal detected\"}' >&2\n  exit 2\nfi\n\n# Deny sensitive files\nif [[ \"$file_path\" == *\".env\"* ]]; then\n  echo '{\"decision\": \"deny\", \"reason\": \"Sensitive file\"}' >&2\n  exit 2\nfi\n```\n\nSee `examples/validate-write.sh` and `examples/validate-bash.sh` for complete examples.\n\n### Quote All Variables\n\n```bash\n# GOOD: Quoted\necho \"$file_path\"\ncd \"$CLAUDE_PROJECT_DIR\"\n\n# BAD: Unquoted (injection risk)\necho $file_path\ncd $CLAUDE_PROJECT_DIR\n```\n\n### Set Appropriate Timeouts\n\n```json\n{\n  \"type\": \"command\",\n  \"command\": \"bash script.sh\",\n  \"timeout\": 10\n}\n```\n\n**Defaults:** Command hooks (60s), Prompt hooks (30s)\n\n## Performance Considerations\n\n### Parallel Execution\n\nAll matching hooks run **in parallel**:\n\n```json\n{\n  \"PreToolUse\": [\n    {\n      \"matcher\": \"Write\",\n      \"hooks\": [\n        {\"type\": \"command\", \"command\": \"check1.sh\"},  // Parallel\n        {\"type\": \"command\", \"command\": \"check2.sh\"},  // Parallel\n        {\"type\": \"prompt\", \"prompt\": \"Validate...\"}   // Parallel\n      ]\n    }\n  ]\n}\n```\n\n**Design implications:**\n\n- Hooks don't see each other's output\n- Non-deterministic ordering\n- Design for independence\n\n### Optimization\n\n1. Use command hooks for quick deterministic checks\n2. Use prompt hooks for complex reasoning\n3. Cache validation results in temp files\n4. Minimize I/O in hot paths\n\n## Temporarily Active Hooks\n\nCreate hooks that activate conditionally by checking for a flag file or configuration:\n\n**Pattern: Flag file activation**\n\n```bash\n#!/bin/bash\n# Only active when flag file exists\nFLAG_FILE=\"$CLAUDE_PROJECT_DIR/.enable-strict-validation\"\n\nif [ ! -f \"$FLAG_FILE\" ]; then\n  # Flag not present, skip validation\n  exit 0\nfi\n\n# Flag present, run validation\ninput=$(cat)\n# ... validation logic ...\n```\n\n**Pattern: Configuration-based activation**\n\n```bash\n#!/bin/bash\n# Check configuration for activation\nCONFIG_FILE=\"$CLAUDE_PROJECT_DIR/.claude/plugin-config.json\"\n\nif [ -f \"$CONFIG_FILE\" ]; then\n  enabled=$(jq -r '.strictMode // false' \"$CONFIG_FILE\")\n  if [ \"$enabled\" != \"true\" ]; then\n    exit 0  # Not enabled, skip\n  fi\nfi\n\n# Enabled, run hook logic\ninput=$(cat)\n# ... hook logic ...\n```\n\n**Use cases:**\n\n- Enable strict validation only when needed\n- Temporary debugging hooks\n- Project-specific hook behavior\n- Feature flags for hooks\n\n**Best practice:** Document activation mechanism in plugin README so users know how to enable/disable temporary hooks.\n\n## Hook Lifecycle and Limitations\n\n### Hooks Load at Session Start\n\n**Important:** Hooks are loaded when Claude Code session starts. Changes to hook configuration require restarting Claude Code.\n\n**Cannot hot-swap hooks:**\n\n- Editing `hooks/hooks.json` won't affect current session\n- Adding new hook scripts won't be recognized\n- Changing hook commands/prompts won't update\n- Must restart Claude Code: exit and run `claude` again\n\n**To test hook changes:**\n\n1. Edit hook configuration or scripts\n2. Exit Claude Code session\n3. Restart: `claude` or `cc`\n4. New hook configuration loads\n5. Test hooks with `claude --debug`\n\n### Hook Validation at Startup\n\nHooks are validated when Claude Code starts:\n\n- Invalid JSON in hooks.json causes loading failure\n- Missing scripts cause warnings\n- Syntax errors reported in debug mode\n\nUse `/hooks` command to review loaded hooks in current session.\n\n## Debugging Hooks\n\n### Enable Debug Mode\n\n```bash\nclaude --debug\n```\n\nLook for hook registration, execution logs, input/output JSON, and timing information.\n\n### Test Hook Scripts\n\nTest command hooks directly:\n\n```bash\necho '{\"tool_name\": \"Write\", \"tool_input\": {\"file_path\": \"/test\"}}' | \\\n  bash ${CLAUDE_PLUGIN_ROOT}/scripts/validate.sh\n\necho \"Exit code: $?\"\n```\n\n### Validate JSON Output\n\nEnsure hooks output valid JSON:\n\n```bash\noutput=$(./your-hook.sh < test-input.json)\necho \"$output\" | jq .\n```\n\n## Quick Reference\n\n### Hook Events Summary\n\n| Event | When | Use For |\n|-------|------|---------|\n| PreToolUse | Before tool | Validation, modification |\n| PostToolUse | After tool | Feedback, logging |\n| UserPromptSubmit | User input | Context, validation |\n| Stop | Agent stopping | Completeness check |\n| SubagentStop | Subagent done | Task validation |\n| SessionStart | Session begins | Context loading |\n| SessionEnd | Session ends | Cleanup, logging |\n| PreCompact | Before compact | Preserve context |\n| Notification | User notified | Logging, reactions |\n\n### Best Practices\n\n**DO:**\n\n-  Use prompt-based hooks for complex logic\n-  Use ${CLAUDE_PLUGIN_ROOT} for portability\n-  Validate all inputs in command hooks\n-  Quote all bash variables\n-  Set appropriate timeouts\n-  Return structured JSON output\n-  Test hooks thoroughly\n\n**DON'T:**\n\n-  Use hardcoded paths\n-  Trust user input without validation\n-  Create long-running hooks\n-  Rely on hook execution order\n-  Modify global state unpredictably\n-  Log sensitive information\n\n## Additional Resources\n\n### Reference Files\n\nFor detailed patterns and advanced techniques, consult:\n\n- **`references/patterns.md`** - Common hook patterns (8+ proven patterns)\n- **`references/migration.md`** - Migrating from basic to advanced hooks\n- **`references/advanced.md`** - Advanced use cases and techniques\n\n### Example Hook Scripts\n\nWorking examples in `examples/`:\n\n- **`validate-write.sh`** - File write validation example\n- **`validate-bash.sh`** - Bash command validation example\n- **`load-context.sh`** - SessionStart context loading example\n\n### Utility Scripts\n\nDevelopment tools in `scripts/`:\n\n- **`validate-hook-schema.sh`** - Validate hooks.json structure and syntax\n- **`test-hook.sh`** - Test hooks with sample input before deployment\n- **`hook-linter.sh`** - Check hook scripts for common issues and best practices\n\n### External Resources\n\n- **Official Docs**: <https://docs.claude.com/en/docs/claude-code/hooks>\n- **Examples**: See security-guidance plugin in marketplace\n- **Testing**: Use `claude --debug` for detailed logs\n- **Validation**: Use `jq` to validate hook JSON output\n\n## Implementation Workflow\n\nTo implement hooks in a plugin:\n\n1. Identify events to hook into (PreToolUse, Stop, SessionStart, etc.)\n2. Decide between prompt-based (flexible) or command (deterministic) hooks\n3. Write hook configuration in `hooks/hooks.json`\n4. For command hooks, create hook scripts\n5. Use ${CLAUDE_PLUGIN_ROOT} for all file references\n6. Validate configuration with `scripts/validate-hook-schema.sh hooks/hooks.json`\n7. Test hooks with `scripts/test-hook.sh` before deployment\n8. Test in Claude Code with `claude --debug`\n9. Document hooks in plugin README\n\nFocus on prompt-based hooks for most use cases. Reserve command hooks for performance-critical or deterministic checks."
              },
              {
                "name": "mcp-integration",
                "description": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in plugin\", \"use .mcp.json\", \"set up Model Context Protocol\", \"connect external service\", mentions \"${CLAUDE_PLUGIN_ROOT} with MCP\", or discusses MCP server types (SSE, stdio, HTTP, WebSocket). Provides comprehensive guidance for integrating Model Context Protocol servers into Claude Code plugins for external tool and service integration.",
                "path": "plugins/meta/plugin-dev/skills/mcp-integration/SKILL.md",
                "frontmatter": {
                  "name": "mcp-integration",
                  "description": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in plugin\", \"use .mcp.json\", \"set up Model Context Protocol\", \"connect external service\", mentions \"${CLAUDE_PLUGIN_ROOT} with MCP\", or discusses MCP server types (SSE, stdio, HTTP, WebSocket). Provides comprehensive guidance for integrating Model Context Protocol servers into Claude Code plugins for external tool and service integration."
                },
                "content": "# MCP Integration for Claude Code Plugins\n\n## Overview\n\nModel Context Protocol (MCP) enables Claude Code plugins to integrate with external services and APIs by providing structured tool access. Use MCP integration to expose external service capabilities as tools within Claude Code.\n\n**Key capabilities:**\n\n- Connect to external services (databases, APIs, file systems)\n- Provide 10+ related tools from a single service\n- Handle OAuth and complex authentication flows\n- Bundle MCP servers with plugins for automatic setup\n\n## MCP Server Configuration Methods\n\nPlugins can bundle MCP servers in two ways:\n\n### Method 1: Dedicated .mcp.json (Recommended)\n\nCreate `.mcp.json` at plugin root:\n\n```json\n{\n  \"database-tools\": {\n    \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/db-server\",\n    \"args\": [\"--config\", \"${CLAUDE_PLUGIN_ROOT}/config.json\"],\n    \"env\": {\n      \"DB_URL\": \"${DB_URL}\"\n    }\n  }\n}\n```\n\n**Benefits:**\n\n- Clear separation of concerns\n- Easier to maintain\n- Better for multiple servers\n\n### Method 2: Inline in plugin.json\n\nAdd `mcpServers` field to plugin.json:\n\n```json\n{\n  \"name\": \"my-plugin\",\n  \"version\": \"1.0.0\",\n  \"mcpServers\": {\n    \"plugin-api\": {\n      \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/api-server\",\n      \"args\": [\"--port\", \"8080\"]\n    }\n  }\n}\n```\n\n**Benefits:**\n\n- Single configuration file\n- Good for simple single-server plugins\n\n## MCP Server Types\n\n### stdio (Local Process)\n\nExecute local MCP servers as child processes. Best for local tools and custom servers.\n\n**Configuration:**\n\n```json\n{\n  \"filesystem\": {\n    \"command\": \"npx\",\n    \"args\": [\"-y\", \"@modelcontextprotocol/server-filesystem\", \"/allowed/path\"],\n    \"env\": {\n      \"LOG_LEVEL\": \"debug\"\n    }\n  }\n}\n```\n\n**Use cases:**\n\n- File system access\n- Local database connections\n- Custom MCP servers\n- NPM-packaged MCP servers\n\n**Process management:**\n\n- Claude Code spawns and manages the process\n- Communicates via stdin/stdout\n- Terminates when Claude Code exits\n\n### SSE (Server-Sent Events)\n\nConnect to hosted MCP servers with OAuth support. Best for cloud services.\n\n**Configuration:**\n\n```json\n{\n  \"asana\": {\n    \"type\": \"sse\",\n    \"url\": \"https://mcp.asana.com/sse\"\n  }\n}\n```\n\n**Use cases:**\n\n- Official hosted MCP servers (Asana, GitHub, etc.)\n- Cloud services with MCP endpoints\n- OAuth-based authentication\n- No local installation needed\n\n**Authentication:**\n\n- OAuth flows handled automatically\n- User prompted on first use\n- Tokens managed by Claude Code\n\n### HTTP (REST API)\n\nConnect to RESTful MCP servers with token authentication.\n\n**Configuration:**\n\n```json\n{\n  \"api-service\": {\n    \"type\": \"http\",\n    \"url\": \"https://api.example.com/mcp\",\n    \"headers\": {\n      \"Authorization\": \"Bearer ${API_TOKEN}\",\n      \"X-Custom-Header\": \"value\"\n    }\n  }\n}\n```\n\n**Use cases:**\n\n- REST API-based MCP servers\n- Token-based authentication\n- Custom API backends\n- Stateless interactions\n\n### WebSocket (Real-time)\n\nConnect to WebSocket MCP servers for real-time bidirectional communication.\n\n**Configuration:**\n\n```json\n{\n  \"realtime-service\": {\n    \"type\": \"ws\",\n    \"url\": \"wss://mcp.example.com/ws\",\n    \"headers\": {\n      \"Authorization\": \"Bearer ${TOKEN}\"\n    }\n  }\n}\n```\n\n**Use cases:**\n\n- Real-time data streaming\n- Persistent connections\n- Push notifications from server\n- Low-latency requirements\n\n## Environment Variable Expansion\n\nAll MCP configurations support environment variable substitution:\n\n**${CLAUDE_PLUGIN_ROOT}** - Plugin directory (always use for portability):\n\n```json\n{\n  \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/my-server\"\n}\n```\n\n**User environment variables** - From user's shell:\n\n```json\n{\n  \"env\": {\n    \"API_KEY\": \"${MY_API_KEY}\",\n    \"DATABASE_URL\": \"${DB_URL}\"\n  }\n}\n```\n\n**Best practice:** Document all required environment variables in plugin README.\n\n## MCP Tool Naming\n\nWhen MCP servers provide tools, they're automatically prefixed:\n\n**Format:** `mcp__plugin_<plugin-name>_<server-name>__<tool-name>`\n\n**Example:**\n\n- Plugin: `asana`\n- Server: `asana`\n- Tool: `create_task`\n- **Full name:** `mcp__plugin_asana_asana__asana_create_task`\n\n### Using MCP Tools in Commands\n\nPre-allow specific MCP tools in command frontmatter:\n\n```markdown\n---\nallowed-tools: [\n  \"mcp__plugin_asana_asana__asana_create_task\",\n  \"mcp__plugin_asana_asana__asana_search_tasks\"\n]\n---\n```\n\n**Wildcard (use sparingly):**\n\n```markdown\n---\nallowed-tools: [\"mcp__plugin_asana_asana__*\"]\n---\n```\n\n**Best practice:** Pre-allow specific tools, not wildcards, for security.\n\n## Lifecycle Management\n\n**Automatic startup:**\n\n- MCP servers start when plugin enables\n- Connection established before first tool use\n- Restart required for configuration changes\n\n**Lifecycle:**\n\n1. Plugin loads\n2. MCP configuration parsed\n3. Server process started (stdio) or connection established (SSE/HTTP/WS)\n4. Tools discovered and registered\n5. Tools available as `mcp__plugin_...__...`\n\n**Viewing servers:**\nUse `/mcp` command to see all servers including plugin-provided ones.\n\n## Authentication Patterns\n\n### OAuth (SSE/HTTP)\n\nOAuth handled automatically by Claude Code:\n\n```json\n{\n  \"type\": \"sse\",\n  \"url\": \"https://mcp.example.com/sse\"\n}\n```\n\nUser authenticates in browser on first use. No additional configuration needed.\n\n### Token-Based (Headers)\n\nStatic or environment variable tokens:\n\n```json\n{\n  \"type\": \"http\",\n  \"url\": \"https://api.example.com\",\n  \"headers\": {\n    \"Authorization\": \"Bearer ${API_TOKEN}\"\n  }\n}\n```\n\nDocument required environment variables in README.\n\n### Environment Variables (stdio)\n\nPass configuration to MCP server:\n\n```json\n{\n  \"command\": \"python\",\n  \"args\": [\"-m\", \"my_mcp_server\"],\n  \"env\": {\n    \"DATABASE_URL\": \"${DB_URL}\",\n    \"API_KEY\": \"${API_KEY}\",\n    \"LOG_LEVEL\": \"info\"\n  }\n}\n```\n\n## Integration Patterns\n\n### Pattern 1: Simple Tool Wrapper\n\nCommands use MCP tools with user interaction:\n\n```markdown\n# Command: create-item.md\n---\nallowed-tools: [\"mcp__plugin_name_server__create_item\"]\n---\n\nSteps:\n1. Gather item details from user\n2. Use mcp__plugin_name_server__create_item\n3. Confirm creation\n```\n\n**Use for:** Adding validation or preprocessing before MCP calls.\n\n### Pattern 2: Autonomous Agent\n\nAgents use MCP tools autonomously:\n\n```markdown\n# Agent: data-analyzer.md\n\nAnalysis Process:\n1. Query data via mcp__plugin_db_server__query\n2. Process and analyze results\n3. Generate insights report\n```\n\n**Use for:** Multi-step MCP workflows without user interaction.\n\n### Pattern 3: Multi-Server Plugin\n\nIntegrate multiple MCP servers:\n\n```json\n{\n  \"github\": {\n    \"type\": \"sse\",\n    \"url\": \"https://mcp.github.com/sse\"\n  },\n  \"jira\": {\n    \"type\": \"sse\",\n    \"url\": \"https://mcp.jira.com/sse\"\n  }\n}\n```\n\n**Use for:** Workflows spanning multiple services.\n\n## Security Best Practices\n\n### Use HTTPS/WSS\n\nAlways use secure connections:\n\n```json\n \"url\": \"https://mcp.example.com/sse\"\n \"url\": \"http://mcp.example.com/sse\"\n```\n\n### Token Management\n\n**DO:**\n\n-  Use environment variables for tokens\n-  Document required env vars in README\n-  Let OAuth flow handle authentication\n\n**DON'T:**\n\n-  Hardcode tokens in configuration\n-  Commit tokens to git\n-  Share tokens in documentation\n\n### Permission Scoping\n\nPre-allow only necessary MCP tools:\n\n```markdown\n allowed-tools: [\n  \"mcp__plugin_api_server__read_data\",\n  \"mcp__plugin_api_server__create_item\"\n]\n\n allowed-tools: [\"mcp__plugin_api_server__*\"]\n```\n\n## Error Handling\n\n### Connection Failures\n\nHandle MCP server unavailability:\n\n- Provide fallback behavior in commands\n- Inform user of connection issues\n- Check server URL and configuration\n\n### Tool Call Errors\n\nHandle failed MCP operations:\n\n- Validate inputs before calling MCP tools\n- Provide clear error messages\n- Check rate limiting and quotas\n\n### Configuration Errors\n\nValidate MCP configuration:\n\n- Test server connectivity during development\n- Validate JSON syntax\n- Check required environment variables\n\n## Performance Considerations\n\n### Lazy Loading\n\nMCP servers connect on-demand:\n\n- Not all servers connect at startup\n- First tool use triggers connection\n- Connection pooling managed automatically\n\n### Batching\n\nBatch similar requests when possible:\n\n```text\n# Good: Single query with filters\ntasks = search_tasks(project=\"X\", assignee=\"me\", limit=50)\n\n# Avoid: Many individual queries\nfor id in task_ids:\n    task = get_task(id)\n```\n\n## Testing MCP Integration\n\n### Local Testing\n\n1. Configure MCP server in `.mcp.json`\n2. Install plugin locally (`.claude-plugin/`)\n3. Run `/mcp` to verify server appears\n4. Test tool calls in commands\n5. Check `claude --debug` logs for connection issues\n\n### Validation Checklist\n\n- [ ] MCP configuration is valid JSON\n- [ ] Server URL is correct and accessible\n- [ ] Required environment variables documented\n- [ ] Tools appear in `/mcp` output\n- [ ] Authentication works (OAuth or tokens)\n- [ ] Tool calls succeed from commands\n- [ ] Error cases handled gracefully\n\n## Debugging\n\n### Enable Debug Logging\n\n```bash\nclaude --debug\n```\n\nLook for:\n\n- MCP server connection attempts\n- Tool discovery logs\n- Authentication flows\n- Tool call errors\n\n### Common Issues\n\n**Server not connecting:**\n\n- Check URL is correct\n- Verify server is running (stdio)\n- Check network connectivity\n- Review authentication configuration\n\n**Tools not available:**\n\n- Verify server connected successfully\n- Check tool names match exactly\n- Run `/mcp` to see available tools\n- Restart Claude Code after config changes\n\n**Authentication failing:**\n\n- Clear cached auth tokens\n- Re-authenticate\n- Check token scopes and permissions\n- Verify environment variables set\n\n## Quick Reference\n\n### MCP Server Types\n\n| Type | Transport | Best For | Auth |\n|------|-----------|----------|------|\n| stdio | Process | Local tools, custom servers | Env vars |\n| SSE | HTTP | Hosted services, cloud APIs | OAuth |\n| HTTP | REST | API backends, token auth | Tokens |\n| ws | WebSocket | Real-time, streaming | Tokens |\n\n### Configuration Checklist\n\n- [ ] Server type specified (stdio/SSE/HTTP/ws)\n- [ ] Type-specific fields complete (command or url)\n- [ ] Authentication configured\n- [ ] Environment variables documented\n- [ ] HTTPS/WSS used (not HTTP/WS)\n- [ ] ${CLAUDE_PLUGIN_ROOT} used for paths\n\n### Best Practices\n\n**DO:**\n\n-  Use ${CLAUDE_PLUGIN_ROOT} for portable paths\n-  Document required environment variables\n-  Use secure connections (HTTPS/WSS)\n-  Pre-allow specific MCP tools in commands\n-  Test MCP integration before publishing\n-  Handle connection and tool errors gracefully\n\n**DON'T:**\n\n-  Hardcode absolute paths\n-  Commit credentials to git\n-  Use HTTP instead of HTTPS\n-  Pre-allow all tools with wildcards\n-  Skip error handling\n-  Forget to document setup\n\n## Additional Resources\n\n### Reference Files\n\nFor detailed information, consult:\n\n- **`references/server-types.md`** - Deep dive on each server type\n- **`references/authentication.md`** - Authentication patterns and OAuth\n- **`references/tool-usage.md`** - Using MCP tools in commands and agents\n\n### Example Configurations\n\nWorking examples in `examples/`:\n\n- **`stdio-server.json`** - Local stdio MCP server\n- **`sse-server.json`** - Hosted SSE server with OAuth\n- **`http-server.json`** - REST API with token auth\n\n### External Resources\n\n- **Official MCP Docs**: <https://modelcontextprotocol.io/>\n- **Claude Code MCP Docs**: <https://docs.claude.com/en/docs/claude-code/mcp>\n- **MCP SDK**: @modelcontextprotocol/sdk\n- **Testing**: Use `claude --debug` and `/mcp` command\n\n## Implementation Workflow\n\nTo add MCP integration to a plugin:\n\n1. Choose MCP server type (stdio, SSE, HTTP, ws)\n2. Create `.mcp.json` at plugin root with configuration\n3. Use ${CLAUDE_PLUGIN_ROOT} for all file references\n4. Document required environment variables in README\n5. Test locally with `/mcp` command\n6. Pre-allow MCP tools in relevant commands\n7. Handle authentication (OAuth or tokens)\n8. Test error cases (connection failures, auth errors)\n9. Document MCP integration in plugin README\n\nFocus on stdio for custom/local servers, SSE for hosted services with OAuth."
              },
              {
                "name": "plugin-settings",
                "description": "This skill should be used when the user asks about \"plugin settings\", \"store plugin configuration\", \"user-configurable plugin\", \".local.md files\", \"plugin state files\", \"read YAML frontmatter\", \"per-project plugin settings\", or wants to make plugin behavior configurable. Documents the .claude/plugin-name.local.md pattern for storing plugin-specific configuration with YAML frontmatter and markdown content.",
                "path": "plugins/meta/plugin-dev/skills/plugin-settings/SKILL.md",
                "frontmatter": {
                  "name": "plugin-settings",
                  "description": "This skill should be used when the user asks about \"plugin settings\", \"store plugin configuration\", \"user-configurable plugin\", \".local.md files\", \"plugin state files\", \"read YAML frontmatter\", \"per-project plugin settings\", or wants to make plugin behavior configurable. Documents the .claude/plugin-name.local.md pattern for storing plugin-specific configuration with YAML frontmatter and markdown content."
                },
                "content": "# Plugin Settings Pattern for Claude Code Plugins\n\n## Overview\n\nPlugins can store user-configurable settings and state in `.claude/plugin-name.local.md` files within the project directory. This pattern uses YAML frontmatter for structured configuration and markdown content for prompts or additional context.\n\n**Key characteristics:**\n\n- File location: `.claude/plugin-name.local.md` in project root\n- Structure: YAML frontmatter + markdown body\n- Purpose: Per-project plugin configuration and state\n- Usage: Read from hooks, commands, and agents\n- Lifecycle: User-managed (not in git, should be in `.gitignore`)\n\n## File Structure\n\n### Basic Template\n\n```markdown\n---\nenabled: true\nsetting1: value1\nsetting2: value2\nnumeric_setting: 42\nlist_setting: [\"item1\", \"item2\"]\n---\n\n# Additional Context\n\nThis markdown body can contain:\n- Task descriptions\n- Additional instructions\n- Prompts to feed back to Claude\n- Documentation or notes\n```\n\n### Example: Plugin State File\n\n**.claude/my-plugin.local.md:**\n\n```markdown\n---\nenabled: true\nstrict_mode: false\nmax_retries: 3\nnotification_level: info\ncoordinator_session: team-leader\n---\n\n# Plugin Configuration\n\nThis plugin is configured for standard validation mode.\nContact @team-lead with questions.\n```\n\n## Reading Settings Files\n\n### From Hooks (Bash Scripts)\n\n**Pattern: Check existence and parse frontmatter**\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\n# Define state file path\nSTATE_FILE=\".claude/my-plugin.local.md\"\n\n# Quick exit if file doesn't exist\nif [[ ! -f \"$STATE_FILE\" ]]; then\n  exit 0  # Plugin not configured, skip\nfi\n\n# Parse YAML frontmatter (between --- markers)\nFRONTMATTER=$(sed -n '/^---$/,/^---$/{ /^---$/d; p; }' \"$STATE_FILE\")\n\n# Extract individual fields\nENABLED=$(echo \"$FRONTMATTER\" | grep '^enabled:' | sed 's/enabled: *//' | sed 's/^\"\\(.*\\)\"$/\\1/')\nSTRICT_MODE=$(echo \"$FRONTMATTER\" | grep '^strict_mode:' | sed 's/strict_mode: *//' | sed 's/^\"\\(.*\\)\"$/\\1/')\n\n# Check if enabled\nif [[ \"$ENABLED\" != \"true\" ]]; then\n  exit 0  # Disabled\nfi\n\n# Use configuration in hook logic\nif [[ \"$STRICT_MODE\" == \"true\" ]]; then\n  # Apply strict validation\n  # ...\nfi\n```\n\nSee `examples/read-settings-hook.sh` for complete working example.\n\n### From Commands\n\nCommands can read settings files to customize behavior:\n\n```markdown\n---\ndescription: Process data with plugin\nallowed-tools: [\"Read\", \"Bash\"]\n---\n\n# Process Command\n\nSteps:\n1. Check if settings exist at `.claude/my-plugin.local.md`\n2. Read configuration using Read tool\n3. Parse YAML frontmatter to extract settings\n4. Apply settings to processing logic\n5. Execute with configured behavior\n```\n\n### From Agents\n\nAgents can reference settings in their instructions:\n\n```markdown\n---\nname: configured-agent\ndescription: Agent that adapts to project settings\n---\n\nCheck for plugin settings at `.claude/my-plugin.local.md`.\nIf present, parse YAML frontmatter and adapt behavior according to:\n- enabled: Whether plugin is active\n- mode: Processing mode (strict, standard, lenient)\n- Additional configuration fields\n```\n\n## Parsing Techniques\n\n### Extract Frontmatter\n\n```bash\n# Extract everything between --- markers\nFRONTMATTER=$(sed -n '/^---$/,/^---$/{ /^---$/d; p; }' \"$FILE\")\n```\n\n### Read Individual Fields\n\n**String fields:**\n\n```bash\nVALUE=$(echo \"$FRONTMATTER\" | grep '^field_name:' | sed 's/field_name: *//' | sed 's/^\"\\(.*\\)\"$/\\1/')\n```\n\n**Boolean fields:**\n\n```bash\nENABLED=$(echo \"$FRONTMATTER\" | grep '^enabled:' | sed 's/enabled: *//')\n# Compare: if [[ \"$ENABLED\" == \"true\" ]]; then\n```\n\n**Numeric fields:**\n\n```bash\nMAX=$(echo \"$FRONTMATTER\" | grep '^max_value:' | sed 's/max_value: *//')\n# Use: if [[ $MAX -gt 100 ]]; then\n```\n\n### Read Markdown Body\n\nExtract content after second `---`:\n\n```bash\n# Get everything after closing ---\nBODY=$(awk '/^---$/{i++; next} i>=2' \"$FILE\")\n```\n\n## Common Patterns\n\n### Pattern 1: Temporarily Active Hooks\n\nUse settings file to control hook activation:\n\n```bash\n#!/bin/bash\nSTATE_FILE=\".claude/security-scan.local.md\"\n\n# Quick exit if not configured\nif [[ ! -f \"$STATE_FILE\" ]]; then\n  exit 0\nfi\n\n# Read enabled flag\nFRONTMATTER=$(sed -n '/^---$/,/^---$/{ /^---$/d; p; }' \"$STATE_FILE\")\nENABLED=$(echo \"$FRONTMATTER\" | grep '^enabled:' | sed 's/enabled: *//')\n\nif [[ \"$ENABLED\" != \"true\" ]]; then\n  exit 0  # Disabled\nfi\n\n# Run hook logic\n# ...\n```\n\n**Use case:** Enable/disable hooks without editing hooks.json (requires restart).\n\n### Pattern 2: Agent State Management\n\nStore agent-specific state and configuration:\n\n**.claude/multi-agent-swarm.local.md:**\n\n```markdown\n---\nagent_name: auth-agent\ntask_number: 3.5\npr_number: 1234\ncoordinator_session: team-leader\nenabled: true\ndependencies: [\"Task 3.4\"]\n---\n\n# Task Assignment\n\nImplement JWT authentication for the API.\n\n**Success Criteria:**\n- Authentication endpoints created\n- Tests passing\n- PR created and CI green\n```\n\nRead from hooks to coordinate agents:\n\n```bash\nAGENT_NAME=$(echo \"$FRONTMATTER\" | grep '^agent_name:' | sed 's/agent_name: *//')\nCOORDINATOR=$(echo \"$FRONTMATTER\" | grep '^coordinator_session:' | sed 's/coordinator_session: *//')\n\n# Send notification to coordinator\ntmux send-keys -t \"$COORDINATOR\" \"Agent $AGENT_NAME completed task\" Enter\n```\n\n### Pattern 3: Configuration-Driven Behavior\n\n**.claude/my-plugin.local.md:**\n\n```markdown\n---\nvalidation_level: strict\nmax_file_size: 1000000\nallowed_extensions: [\".js\", \".ts\", \".tsx\"]\nenable_logging: true\n---\n\n# Validation Configuration\n\nStrict mode enabled for this project.\nAll writes validated against security policies.\n```\n\nUse in hooks or commands:\n\n```bash\nLEVEL=$(echo \"$FRONTMATTER\" | grep '^validation_level:' | sed 's/validation_level: *//')\n\ncase \"$LEVEL\" in\n  strict)\n    # Apply strict validation\n    ;;\n  standard)\n    # Apply standard validation\n    ;;\n  lenient)\n    # Apply lenient validation\n    ;;\nesac\n```\n\n## Creating Settings Files\n\n### From Commands\n\nCommands can create settings files:\n\n```markdown\n# Setup Command\n\nSteps:\n1. Ask user for configuration preferences\n2. Create `.claude/my-plugin.local.md` with YAML frontmatter\n3. Set appropriate values based on user input\n4. Inform user that settings are saved\n5. Remind user to restart Claude Code for hooks to recognize changes\n```\n\n### Template Generation\n\nProvide template in plugin README:\n\n```markdown\n## Configuration\n\nCreate `.claude/my-plugin.local.md` in your project:\n\n\\`\\`\\`markdown\n---\nenabled: true\nmode: standard\nmax_retries: 3\n---\n\n# Plugin Configuration\n\nYour settings are active.\n\\`\\`\\`\n\nAfter creating or editing, restart Claude Code for changes to take effect.\n```\n\n## Best Practices\n\n### File Naming\n\n **DO:**\n\n- Use `.claude/plugin-name.local.md` format\n- Match plugin name exactly\n- Use `.local.md` suffix for user-local files\n\n **DON'T:**\n\n- Use different directory (not `.claude/`)\n- Use inconsistent naming\n- Use `.md` without `.local` (might be committed)\n\n### Gitignore\n\nAlways add to `.gitignore`:\n\n```gitignore\n.claude/*.local.md\n.claude/*.local.json\n```\n\nDocument this in plugin README.\n\n### Defaults\n\nProvide sensible defaults when settings file doesn't exist:\n\n```bash\nif [[ ! -f \"$STATE_FILE\" ]]; then\n  # Use defaults\n  ENABLED=true\n  MODE=standard\nelse\n  # Read from file\n  # ...\nfi\n```\n\n### Validation\n\nValidate settings values:\n\n```bash\nMAX=$(echo \"$FRONTMATTER\" | grep '^max_value:' | sed 's/max_value: *//')\n\n# Validate numeric range\nif ! [[ \"$MAX\" =~ ^[0-9]+$ ]] || [[ $MAX -lt 1 ]] || [[ $MAX -gt 100 ]]; then\n  echo \"  Invalid max_value in settings (must be 1-100)\" >&2\n  MAX=10  # Use default\nfi\n```\n\n### Restart Requirement\n\n**Important:** Settings changes require Claude Code restart.\n\nDocument in your README:\n\n```markdown\n## Changing Settings\n\nAfter editing `.claude/my-plugin.local.md`:\n1. Save the file\n2. Exit Claude Code\n3. Restart: `claude` or `cc`\n4. New settings will be loaded\n```\n\nHooks cannot be hot-swapped within a session.\n\n## Security Considerations\n\n### Sanitize User Input\n\nWhen writing settings files from user input:\n\n```bash\n# Escape quotes in user input\nSAFE_VALUE=$(echo \"$USER_INPUT\" | sed 's/\"/\\\\\"/g')\n\n# Write to file\ncat > \"$STATE_FILE\" <<EOF\n---\nuser_setting: \"$SAFE_VALUE\"\n---\nEOF\n```\n\n### Validate File Paths\n\nIf settings contain file paths:\n\n```bash\nFILE_PATH=$(echo \"$FRONTMATTER\" | grep '^data_file:' | sed 's/data_file: *//')\n\n# Check for path traversal\nif [[ \"$FILE_PATH\" == *\"..\"* ]]; then\n  echo \"  Invalid path in settings (path traversal)\" >&2\n  exit 2\nfi\n```\n\n### Permissions\n\nSettings files should be:\n\n- Readable by user only (`chmod 600`)\n- Not committed to git\n- Not shared between users\n\n## Real-World Examples\n\n### multi-agent-swarm Plugin\n\n**.claude/multi-agent-swarm.local.md:**\n\n```markdown\n---\nagent_name: auth-implementation\ntask_number: 3.5\npr_number: 1234\ncoordinator_session: team-leader\nenabled: true\ndependencies: [\"Task 3.4\"]\nadditional_instructions: Use JWT tokens, not sessions\n---\n\n# Task: Implement Authentication\n\nBuild JWT-based authentication for the REST API.\nCoordinate with auth-agent on shared types.\n```\n\n**Hook usage (agent-stop-notification.sh):**\n\n- Checks if file exists (line 15-18: quick exit if not)\n- Parses frontmatter to get coordinator_session, agent_name, enabled\n- Sends notifications to coordinator if enabled\n- Allows quick activation/deactivation via `enabled: true/false`\n\n### ralph-wiggum Plugin\n\n**.claude/ralph-loop.local.md:**\n\n```markdown\n---\niteration: 1\nmax_iterations: 10\ncompletion_promise: \"All tests passing and build successful\"\n---\n\nFix all the linting errors in the project.\nMake sure tests pass after each fix.\n```\n\n**Hook usage (stop-hook.sh):**\n\n- Checks if file exists (line 15-18: quick exit if not active)\n- Reads iteration count and max_iterations\n- Extracts completion_promise for loop termination\n- Reads body as the prompt to feed back\n- Updates iteration count on each loop\n\n## Quick Reference\n\n### File Location\n\n```text\nproject-root/\n .claude/\n     plugin-name.local.md\n```\n\n### Frontmatter Parsing\n\n```bash\n# Extract frontmatter\nFRONTMATTER=$(sed -n '/^---$/,/^---$/{ /^---$/d; p; }' \"$FILE\")\n\n# Read field\nVALUE=$(echo \"$FRONTMATTER\" | grep '^field:' | sed 's/field: *//' | sed 's/^\"\\(.*\\)\"$/\\1/')\n```\n\n### Body Parsing\n\n```bash\n# Extract body (after second ---)\nBODY=$(awk '/^---$/{i++; next} i>=2' \"$FILE\")\n```\n\n### Quick Exit Pattern\n\n```bash\nif [[ ! -f \".claude/my-plugin.local.md\" ]]; then\n  exit 0  # Not configured\nfi\n```\n\n## Additional Resources\n\n### Reference Files\n\nFor detailed implementation patterns:\n\n- **`references/parsing-techniques.md`** - Complete guide to parsing YAML frontmatter and markdown bodies\n- **`references/real-world-examples.md`** - Deep dive into multi-agent-swarm and ralph-wiggum implementations\n\n### Example Files\n\nWorking examples in `examples/`:\n\n- **`read-settings-hook.sh`** - Hook that reads and uses settings\n- **`create-settings-command.md`** - Command that creates settings file\n- **`example-settings.md`** - Template settings file\n\n### Utility Scripts\n\nDevelopment tools in `scripts/`:\n\n- **`validate-settings.sh`** - Validate settings file structure\n- **`parse-frontmatter.sh`** - Extract frontmatter fields\n\n## Implementation Workflow\n\nTo add settings to a plugin:\n\n1. Design settings schema (which fields, types, defaults)\n2. Create template file in plugin documentation\n3. Add gitignore entry for `.claude/*.local.md`\n4. Implement settings parsing in hooks/commands\n5. Use quick-exit pattern (check file exists, check enabled field)\n6. Document settings in plugin README with template\n7. Remind users that changes require Claude Code restart\n\nFocus on keeping settings simple and providing good defaults when settings file doesn't exist."
              },
              {
                "name": "plugin-structure",
                "description": "This skill should be used when the user asks to \"create a plugin\", \"scaffold a plugin\", \"understand plugin structure\", \"organize plugin components\", \"set up plugin.json\", \"use ${CLAUDE_PLUGIN_ROOT}\", \"add commands/agents/skills/hooks\", \"configure auto-discovery\", or needs guidance on plugin directory layout, manifest configuration, component organization, file naming conventions, or Claude Code plugin architecture best practices.",
                "path": "plugins/meta/plugin-dev/skills/plugin-structure/SKILL.md",
                "frontmatter": {
                  "name": "plugin-structure",
                  "description": "This skill should be used when the user asks to \"create a plugin\", \"scaffold a plugin\", \"understand plugin structure\", \"organize plugin components\", \"set up plugin.json\", \"use ${CLAUDE_PLUGIN_ROOT}\", \"add commands/agents/skills/hooks\", \"configure auto-discovery\", or needs guidance on plugin directory layout, manifest configuration, component organization, file naming conventions, or Claude Code plugin architecture best practices."
                },
                "content": "# Plugin Structure for Claude Code\n\n> **Reference:** See [plugin-spec.md](references/plugin-spec.md) for the official specification.\n\n## Overview\n\nClaude Code plugins follow a standardized directory structure with automatic component discovery. Understanding this structure enables creating well-organized, maintainable plugins that integrate seamlessly with Claude Code.\n\n**Key concepts:**\n\n- Conventional directory layout for automatic discovery\n- Manifest-driven configuration in `.claude-plugin/plugin.json`\n- Component-based organization (commands, agents, skills, hooks)\n- Portable path references using `${CLAUDE_PLUGIN_ROOT}`\n- Explicit vs. auto-discovered component loading\n\n## Directory Structure\n\nEvery Claude Code plugin follows this organizational pattern:\n\n```text\nplugin-name/\n .claude-plugin/\n    plugin.json          # Required: Plugin manifest\n commands/                 # Slash commands (.md files)\n agents/                   # Subagent definitions (.md files)\n skills/                   # Agent skills (subdirectories)\n    skill-name/\n        SKILL.md         # Required for each skill\n hooks/\n    hooks.json           # Event handler configuration\n .mcp.json                # MCP server definitions\n scripts/                 # Helper scripts and utilities\n```\n\n**Critical rules:**\n\n1. **Manifest location**: The `plugin.json` manifest MUST be in `.claude-plugin/` directory\n2. **Component locations**: All component directories (commands, agents, skills, hooks) MUST be at plugin root level, NOT nested inside `.claude-plugin/`\n3. **Optional components**: Only create directories for components the plugin actually uses\n4. **Naming convention**: Use kebab-case for all directory and file names\n\n## Plugin Manifest (plugin.json)\n\nThe manifest defines plugin metadata and configuration. Located at `.claude-plugin/plugin.json`:\n\n### Required Fields\n\n```json\n{\n  \"name\": \"plugin-name\"\n}\n```\n\n**Name requirements:**\n\n- Use kebab-case format (lowercase with hyphens)\n- Must be unique across installed plugins\n- No spaces or special characters\n- Example: `code-review-assistant`, `test-runner`, `api-docs`\n\n### Recommended Metadata\n\n```json\n{\n  \"name\": \"plugin-name\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Brief explanation of plugin purpose\",\n  \"author\": {\n    \"name\": \"Author Name\",\n    \"email\": \"author@example.com\",\n    \"url\": \"https://example.com\"\n  },\n  \"homepage\": \"https://docs.example.com\",\n  \"repository\": \"https://github.com/user/plugin-name\",\n  \"license\": \"MIT\",\n  \"keywords\": [\"testing\", \"automation\", \"ci-cd\"]\n}\n```\n\n**Version format**: Follow semantic versioning (MAJOR.MINOR.PATCH)\n**Keywords**: Use for plugin discovery and categorization\n\n### Component Path Configuration\n\nSpecify custom paths for components (supplements default directories):\n\n```json\n{\n  \"name\": \"plugin-name\",\n  \"commands\": \"./custom-commands\",\n  \"agents\": [\"./agents\", \"./specialized-agents\"],\n  \"hooks\": \"./config/hooks.json\",\n  \"mcpServers\": \"./.mcp.json\"\n}\n```\n\n**Important**: Custom paths supplement defaultsthey don't replace them. Components in both default directories and custom paths will load.\n\n**Path rules:**\n\n- Must be relative to plugin root\n- Must start with `./`\n- Cannot use absolute paths\n- Support arrays for multiple locations\n\n## Component Organization\n\n### Commands\n\n**Location**: `commands/` directory\n**Format**: Markdown files with YAML frontmatter\n**Auto-discovery**: All `.md` files in `commands/` load automatically\n\n**Example structure**:\n\n```text\ncommands/\n review.md        # /review command\n test.md          # /test command\n deploy.md        # /deploy command\n```\n\n**File format**:\n\n```markdown\n---\nname: command-name\ndescription: Command description\n---\n\nCommand implementation instructions...\n```\n\n**Usage**: Commands integrate as native slash commands in Claude Code\n\n### Agents\n\n**Location**: `agents/` directory\n**Format**: Markdown files with YAML frontmatter\n**Auto-discovery**: All `.md` files in `agents/` load automatically\n\n**Example structure**:\n\n```text\nagents/\n code-reviewer.md\n test-generator.md\n refactorer.md\n```\n\n**File format**:\n\n```markdown\n---\ndescription: Agent role and expertise\ncapabilities:\n  - Specific task 1\n  - Specific task 2\n---\n\nDetailed agent instructions and knowledge...\n```\n\n**Usage**: Users can invoke agents manually, or Claude Code selects them automatically based on task context\n\n### Skills\n\n**Location**: `skills/` directory with subdirectories per skill\n**Format**: Each skill in its own directory with `SKILL.md` file\n**Auto-discovery**: All `SKILL.md` files in skill subdirectories load automatically\n\n**Example structure**:\n\n```text\nskills/\n api-testing/\n    SKILL.md\n    scripts/\n       test-runner.py\n    references/\n        api-spec.md\n database-migrations/\n     SKILL.md\n     examples/\n         migration-template.sql\n```\n\n**SKILL.md format**:\n\n```markdown\n---\nname: Skill Name\ndescription: When to use this skill\n---\n\nSkill instructions and guidance...\n```\n\n**Supporting files**: Skills can include scripts, references, examples, or assets in subdirectories\n\n**Usage**: Claude Code autonomously activates skills based on task context matching the description\n\n### Hooks\n\n**Location**: `hooks/hooks.json` or inline in `plugin.json`\n**Format**: JSON configuration defining event handlers\n**Registration**: Hooks register automatically when plugin enables\n\n**Example structure**:\n\n```text\nhooks/\n hooks.json           # Hook configuration\n scripts/\n     validate.sh      # Hook script\n     check-style.sh   # Hook script\n```\n\n**Configuration format**:\n\n```json\n{\n  \"PreToolUse\": [{\n    \"matcher\": \"Write|Edit\",\n    \"hooks\": [{\n      \"type\": \"command\",\n      \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/hooks/scripts/validate.sh\",\n      \"timeout\": 30\n    }]\n  }]\n}\n```\n\n**Available events**: PreToolUse, PostToolUse, Stop, SubagentStop, SessionStart, SessionEnd, UserPromptSubmit, PreCompact, Notification\n\n**Usage**: Hooks execute automatically in response to Claude Code events\n\n### MCP Servers\n\n**Location**: `.mcp.json` at plugin root or inline in `plugin.json`\n**Format**: JSON configuration for MCP server definitions\n**Auto-start**: Servers start automatically when plugin enables\n\n**Example format**:\n\n```json\n{\n  \"mcpServers\": {\n    \"server-name\": {\n      \"command\": \"node\",\n      \"args\": [\"${CLAUDE_PLUGIN_ROOT}/servers/server.js\"],\n      \"env\": {\n        \"API_KEY\": \"${API_KEY}\"\n      }\n    }\n  }\n}\n```\n\n**Usage**: MCP servers integrate seamlessly with Claude Code's tool system\n\n## Portable Path References\n\n### ${CLAUDE_PLUGIN_ROOT}\n\nUse `${CLAUDE_PLUGIN_ROOT}` environment variable for all intra-plugin path references:\n\n```json\n{\n  \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/run.sh\"\n}\n```\n\n**Why it matters**: Plugins install in different locations depending on:\n\n- User installation method (marketplace, local, npm)\n- Operating system conventions\n- User preferences\n\n**Where to use it**:\n\n- Hook command paths\n- MCP server command arguments\n- Script execution references\n- Resource file paths\n\n**Never use**:\n\n- Hardcoded absolute paths (`/Users/name/plugins/...`)\n- Relative paths from working directory (`./scripts/...` in commands)\n- Home directory shortcuts (`~/plugins/...`)\n\n### Path Resolution Rules\n\n**In manifest JSON fields** (hooks, MCP servers):\n\n```json\n\"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/tool.sh\"\n```\n\n**In component files** (commands, agents, skills):\n\n```markdown\nReference scripts at: ${CLAUDE_PLUGIN_ROOT}/scripts/helper.py\n```\n\n**In executed scripts**:\n\n```bash\n#!/bin/bash\n# ${CLAUDE_PLUGIN_ROOT} available as environment variable\nsource \"${CLAUDE_PLUGIN_ROOT}/lib/common.sh\"\n```\n\n## File Naming Conventions\n\n### Component Files\n\n**Commands**: Use kebab-case `.md` files\n\n- `code-review.md`  `/code-review`\n- `run-tests.md`  `/run-tests`\n- `api-docs.md`  `/api-docs`\n\n**Agents**: Use kebab-case `.md` files describing role\n\n- `test-generator.md`\n- `code-reviewer.md`\n- `performance-analyzer.md`\n\n**Skills**: Use kebab-case directory names\n\n- `api-testing/`\n- `database-migrations/`\n- `error-handling/`\n\n### Supporting Files\n\n**Scripts**: Use descriptive kebab-case names with appropriate extensions\n\n- `validate-input.sh`\n- `generate-report.py`\n- `process-data.js`\n\n**Documentation**: Use kebab-case markdown files\n\n- `api-reference.md`\n- `migration-guide.md`\n- `best-practices.md`\n\n**Configuration**: Use standard names\n\n- `hooks.json`\n- `.mcp.json`\n- `plugin.json`\n\n## Auto-Discovery Mechanism\n\nClaude Code automatically discovers and loads components:\n\n1. **Plugin manifest**: Reads `.claude-plugin/plugin.json` when plugin enables\n2. **Commands**: Scans `commands/` directory for `.md` files\n3. **Agents**: Scans `agents/` directory for `.md` files\n4. **Skills**: Scans `skills/` for subdirectories containing `SKILL.md`\n5. **Hooks**: Loads configuration from `hooks/hooks.json` or manifest\n6. **MCP servers**: Loads configuration from `.mcp.json` or manifest\n\n**Discovery timing**:\n\n- Plugin installation: Components register with Claude Code\n- Plugin enable: Components become available for use\n- No restart required: Changes take effect on next Claude Code session\n\n**Override behavior**: Custom paths in `plugin.json` supplement (not replace) default directories\n\n## Best Practices\n\n### Organization\n\n1. **Logical grouping**: Group related components together\n   - Put test-related commands, agents, and skills together\n   - Create subdirectories in `scripts/` for different purposes\n\n2. **Minimal manifest**: Keep `plugin.json` lean\n   - Only specify custom paths when necessary\n   - Rely on auto-discovery for standard layouts\n   - Use inline configuration only for simple cases\n\n3. **Documentation**: Include README files\n   - Plugin root: Overall purpose and usage\n   - Component directories: Specific guidance\n   - Script directories: Usage and requirements\n\n### Naming\n\n1. **Consistency**: Use consistent naming across components\n   - If command is `test-runner`, name related agent `test-runner-agent`\n   - Match skill directory names to their purpose\n\n2. **Clarity**: Use descriptive names that indicate purpose\n   - Good: `api-integration-testing/`, `code-quality-checker.md`\n   - Avoid: `utils/`, `misc.md`, `temp.sh`\n\n3. **Length**: Balance brevity with clarity\n   - Commands: 2-3 words (`review-pr`, `run-ci`)\n   - Agents: Describe role clearly (`code-reviewer`, `test-generator`)\n   - Skills: Topic-focused (`error-handling`, `api-design`)\n\n### Portability\n\n1. **Always use ${CLAUDE_PLUGIN_ROOT}**: Never hardcode paths\n2. **Test on multiple systems**: Verify on macOS, Linux, Windows\n3. **Document dependencies**: List required tools and versions\n4. **Avoid system-specific features**: Use portable bash/Python constructs\n\n### Maintenance\n\n1. **Version consistently**: Update version in plugin.json for releases\n2. **Deprecate gracefully**: Mark old components clearly before removal\n3. **Document breaking changes**: Note changes affecting existing users\n4. **Test thoroughly**: Verify all components work after changes\n\n## Common Patterns\n\n### Minimal Plugin\n\nSingle command with no dependencies:\n\n```text\nmy-plugin/\n .claude-plugin/\n    plugin.json    # Just name field\n commands/\n     hello.md       # Single command\n```\n\n### Full-Featured Plugin\n\nComplete plugin with all component types:\n\n```text\nmy-plugin/\n .claude-plugin/\n    plugin.json\n commands/          # User-facing commands\n agents/            # Specialized subagents\n skills/            # Auto-activating skills\n hooks/             # Event handlers\n    hooks.json\n    scripts/\n .mcp.json          # External integrations\n scripts/           # Shared utilities\n```\n\n### Skill-Focused Plugin\n\nPlugin providing only skills:\n\n```text\nmy-plugin/\n .claude-plugin/\n    plugin.json\n skills/\n     skill-one/\n        SKILL.md\n     skill-two/\n         SKILL.md\n```\n\n## Troubleshooting\n\n**Component not loading**:\n\n- Verify file is in correct directory with correct extension\n- Check YAML frontmatter syntax (commands, agents, skills)\n- Ensure skill has `SKILL.md` (not `README.md` or other name)\n- Confirm plugin is enabled in Claude Code settings\n\n**Path resolution errors**:\n\n- Replace all hardcoded paths with `${CLAUDE_PLUGIN_ROOT}`\n- Verify paths are relative and start with `./` in manifest\n- Check that referenced files exist at specified paths\n- Test with `echo $CLAUDE_PLUGIN_ROOT` in hook scripts\n\n**Auto-discovery not working**:\n\n- Confirm directories are at plugin root (not in `.claude-plugin/`)\n- Check file naming follows conventions (kebab-case, correct extensions)\n- Verify custom paths in manifest are correct\n- Restart Claude Code to reload plugin configuration\n\n**Conflicts between plugins**:\n\n- Use unique, descriptive component names\n- Namespace commands with plugin name if needed\n- Document potential conflicts in plugin README\n- Consider command prefixes for related functionality\n\n---\n\nFor detailed examples and advanced patterns, see files in `references/` and `examples/` directories."
              },
              {
                "name": "skill-development",
                "description": "This skill should be used when the user wants to \"create a skill\", \"add a skill to plugin\", \"write a new skill\", \"improve skill description\", \"organize skill content\", or needs guidance on skill structure, progressive disclosure, or skill development best practices for Claude Code plugins.",
                "path": "plugins/meta/plugin-dev/skills/skill-development/SKILL.md",
                "frontmatter": {
                  "name": "skill-development",
                  "description": "This skill should be used when the user wants to \"create a skill\", \"add a skill to plugin\", \"write a new skill\", \"improve skill description\", \"organize skill content\", or needs guidance on skill structure, progressive disclosure, or skill development best practices for Claude Code plugins."
                },
                "content": "# Skill Development for Claude Code Plugins\n\n> **Reference:** See [agent-skills-spec.md](references/agent-skills-spec.md) for the official specification.\n\nThis skill provides guidance for creating effective skills for Claude Code plugins.\n\n## About Skills\n\nSkills are modular, self-contained packages that extend Claude's capabilities by providing\nspecialized knowledge, workflows, and tools. Think of them as \"onboarding guides\" for specific\ndomains or tasksthey transform Claude from a general-purpose agent into a specialized agent\nequipped with procedural knowledge that no model can fully possess.\n\n### What Skills Provide\n\n1. Specialized workflows - Multi-step procedures for specific domains\n2. Tool integrations - Instructions for working with specific file formats or APIs\n3. Domain expertise - Company-specific knowledge, schemas, business logic\n4. Bundled resources - Scripts, references, and assets for complex and repetitive tasks\n\n### Core Principles\n\n#### Concise is Key\n\nThe context window is a public good. Skills share the context window with everything else Claude\nneeds: system prompt, conversation history, other skills' metadata, and the actual user request.\n\n**Default assumption: Claude is already very smart.** Only add context Claude doesn't already have.\nChallenge each piece of information: \"Does Claude really need this explanation?\" and \"Does this\nparagraph justify its token cost?\"\n\nPrefer concise examples over verbose explanations.\n\n#### Set Appropriate Degrees of Freedom\n\nMatch the level of specificity to the task's fragility and variability:\n\n- **High freedom (text-based instructions)**: Use when multiple approaches are valid, decisions\n  depend on context, or heuristics guide the approach.\n- **Medium freedom (pseudocode or scripts with parameters)**: Use when a preferred pattern exists,\n  some variation is acceptable, or configuration affects behavior.\n- **Low freedom (specific scripts, few parameters)**: Use when operations are fragile and\n  error-prone, consistency is critical, or a specific sequence must be followed.\n\nThink of Claude as exploring a path: a narrow bridge with cliffs needs specific guardrails (low\nfreedom), while an open field allows many routes (high freedom).\n\n### Anatomy of a Skill\n\nEvery skill consists of a required SKILL.md file and optional bundled resources:\n\n```text\nskill-name/\n SKILL.md (required)\n    YAML frontmatter metadata (required)\n       name: (required)\n       description: (required)\n    Markdown instructions (required)\n Bundled Resources (optional)\n     scripts/          - Executable code (Python/Bash/etc.)\n     references/       - Documentation intended to be loaded into context as needed\n     assets/           - Files used in output (templates, icons, fonts, etc.)\n```\n\n#### SKILL.md (required)\n\n**Metadata Quality:** The `name` and `description` in YAML frontmatter determine when Claude will use the skill. Be specific about what the skill does and when to use it. Use the third-person (e.g. \"This skill should be used when...\" instead of \"Use this skill when...\").\n\n#### Bundled Resources (optional)\n\n##### Scripts (`scripts/`)\n\nExecutable code (Python/Bash/etc.) for tasks that require deterministic reliability or are repeatedly rewritten.\n\n- **When to include**: When the same code is being rewritten repeatedly or deterministic reliability is needed\n- **Example**: `scripts/rotate_pdf.py` for PDF rotation tasks\n- **Benefits**: Token efficient, deterministic, may be executed without loading into context\n- **Note**: Scripts may still need to be read by Claude for patching or environment-specific adjustments\n\n##### References (`references/`)\n\nDocumentation and reference material intended to be loaded as needed into context to inform Claude's process and thinking.\n\n- **When to include**: For documentation that Claude should reference while working\n- **Examples**: `references/finance.md` for financial schemas, `references/mnda.md` for company NDA template, `references/policies.md` for company policies, `references/api_docs.md` for API specifications\n- **Use cases**: Database schemas, API documentation, domain knowledge, company policies, detailed workflow guides\n- **Benefits**: Keeps SKILL.md lean, loaded only when Claude determines it's needed\n- **Best practice**: If files are large (>10k words), include grep search patterns in SKILL.md\n- **Avoid duplication**: Information should live in either SKILL.md or references files, not both. Prefer references files for detailed information unless it's truly core to the skillthis keeps SKILL.md lean while making information discoverable without hogging the context window. Keep only essential procedural instructions and workflow guidance in SKILL.md; move detailed reference material, schemas, and examples to references files.\n\n##### Assets (`assets/`)\n\nFiles not intended to be loaded into context, but rather used within the output Claude produces.\n\n- **When to include**: When the skill needs files that will be used in the final output\n- **Examples**: `assets/logo.png` for brand assets, `assets/slides.pptx` for PowerPoint templates, `assets/frontend-template/` for HTML/React boilerplate, `assets/font.ttf` for typography\n- **Use cases**: Templates, images, icons, boilerplate code, fonts, sample documents that get copied or modified\n- **Benefits**: Separates output resources from documentation, enables Claude to use files without loading them into context\n\n#### What to Not Include\n\nA skill should only contain essential files that directly support its functionality. Do NOT create\nextraneous documentation or auxiliary files, including:\n\n- README.md\n- INSTALLATION_GUIDE.md\n- QUICK_REFERENCE.md\n- CHANGELOG.md\n\nThe skill should only contain the information needed for an AI agent to do the job at hand. It\nshould not contain auxiliary context about the process that went into creating it, setup and\ntesting procedures, user-facing documentation, etc. Creating additional documentation files just\nadds clutter and confusion.\n\n### Progressive Disclosure Design Principle\n\nSkills use a three-level loading system to manage context efficiently:\n\n1. **Metadata (name + description)** - Always in context (~100 words)\n2. **SKILL.md body** - When skill triggers (<5k words)\n3. **Bundled resources** - As needed by Claude (Unlimited*)\n\n*Unlimited because scripts can be executed without reading into context window.\n\n## Skill Creation Process\n\nTo create a skill, follow the \"Skill Creation Process\" in order, skipping steps only if there is a clear reason why they are not applicable.\n\n### Step 1: Understanding the Skill with Concrete Examples\n\nSkip this step only when the skill's usage patterns are already clearly understood. It remains valuable even when working with an existing skill.\n\nTo create an effective skill, clearly understand concrete examples of how the skill will be used. This understanding can come from either direct user examples or generated examples that are validated with user feedback.\n\nFor example, when building an image-editor skill, relevant questions include:\n\n- \"What functionality should the image-editor skill support? Editing, rotating, anything else?\"\n- \"Can you give some examples of how this skill would be used?\"\n- \"I can imagine users asking for things like 'Remove the red-eye from this image' or 'Rotate this image'. Are there other ways you imagine this skill being used?\"\n- \"What would a user say that should trigger this skill?\"\n\nTo avoid overwhelming users, avoid asking too many questions in a single message. Start with the most important questions and follow up as needed for better effectiveness.\n\nConclude this step when there is a clear sense of the functionality the skill should support.\n\n### Step 2: Planning the Reusable Skill Contents\n\nTo turn concrete examples into an effective skill, analyze each example by:\n\n1. Considering how to execute on the example from scratch\n2. Identifying what scripts, references, and assets would be helpful when executing these workflows repeatedly\n\nExample: When building a `pdf-editor` skill to handle queries like \"Help me rotate this PDF,\" the analysis shows:\n\n1. Rotating a PDF requires re-writing the same code each time\n2. A `scripts/rotate_pdf.py` script would be helpful to store in the skill\n\nExample: When designing a `frontend-webapp-builder` skill for queries like \"Build me a todo app\" or \"Build me a dashboard to track my steps,\" the analysis shows:\n\n1. Writing a frontend webapp requires the same boilerplate HTML/React each time\n2. An `assets/hello-world/` template containing the boilerplate HTML/React project files would be helpful to store in the skill\n\nExample: When building a `big-query` skill to handle queries like \"How many users have logged in today?\" the analysis shows:\n\n1. Querying BigQuery requires re-discovering the table schemas and relationships each time\n2. A `references/schema.md` file documenting the table schemas would be helpful to store in the skill\n\n**For Claude Code plugins:** When building a hooks skill, the analysis shows:\n\n1. Developers repeatedly need to validate hooks.json and test hook scripts\n2. `scripts/validate-hook-schema.sh` and `scripts/test-hook.sh` utilities would be helpful\n3. `references/patterns.md` for detailed hook patterns to avoid bloating SKILL.md\n\nTo establish the skill's contents, analyze each concrete example to create a list of the reusable resources to include: scripts, references, and assets.\n\n### Step 3: Create Skill Structure\n\nFor Claude Code plugins, create the skill directory structure:\n\n```bash\nmkdir -p plugin-name/skills/skill-name/{references,examples,scripts}\ntouch plugin-name/skills/skill-name/SKILL.md\n```\n\n**Note:** Unlike the generic skill-creator which uses `init_skill.py`, plugin skills are created directly in the plugin's `skills/` directory with a simpler manual structure.\n\n### Step 4: Edit the Skill\n\nWhen editing the (newly-created or existing) skill, remember that the skill is being created for another instance of Claude to use. Focus on including information that would be beneficial and non-obvious to Claude. Consider what procedural knowledge, domain-specific details, or reusable assets would help another Claude instance execute these tasks more effectively.\n\n#### Start with Reusable Skill Contents\n\nTo begin implementation, start with the reusable resources identified above: `scripts/`, `references/`, and `assets/` files. Note that this step may require user input. For example, when implementing a `brand-guidelines` skill, the user may need to provide brand assets or templates to store in `assets/`, or documentation to store in `references/`.\n\nAlso, delete any example files and directories not needed for the skill. Create only the directories you actually need (references/, examples/, scripts/).\n\n#### Update SKILL.md\n\n**Writing Style:** Write the entire skill using **imperative/infinitive form** (verb-first instructions), not second person. Use objective, instructional language (e.g., \"To accomplish X, do Y\" rather than \"You should do X\" or \"If you need to do X\"). This maintains consistency and clarity for AI consumption.\n\n**Description (Frontmatter):** Use third-person format with specific trigger phrases:\n\n```yaml\n---\nname: Skill Name\ndescription: This skill should be used when the user asks to \"specific phrase 1\", \"specific phrase 2\", \"specific phrase 3\". Include exact phrases users would say that should trigger this skill. Be concrete and specific.\n---\n```\n\n**Good description examples:**\n\n```yaml\ndescription: This skill should be used when the user asks to \"create a hook\", \"add a PreToolUse hook\", \"validate tool use\", \"implement prompt-based hooks\", or mentions hook events (PreToolUse, PostToolUse, Stop).\n```\n\n**Bad description examples:**\n\n```yaml\ndescription: Use this skill when working with hooks.  # Wrong person, vague\ndescription: Load when user needs hook help.  # Not third person\ndescription: Provides hook guidance.  # No trigger phrases\n```\n\nTo complete SKILL.md body, answer the following questions:\n\n1. What is the purpose of the skill, in a few sentences?\n2. When should the skill be used? (Include this in frontmatter description with specific triggers)\n3. In practice, how should Claude use the skill? All reusable skill contents developed above should be referenced so that Claude knows how to use them.\n\n**Keep SKILL.md lean:** Target 1,500-2,000 words for the body. Move detailed content to references/:\n\n- Detailed patterns  `references/patterns.md`\n- Advanced techniques  `references/advanced.md`\n- Migration guides  `references/migration.md`\n- API references  `references/api-reference.md`\n\n**Reference resources in SKILL.md:**\n\n```markdown\n## Additional Resources\n\n### Reference Files\n\nFor detailed patterns and techniques, consult:\n- **`references/patterns.md`** - Common patterns\n- **`references/advanced.md`** - Advanced use cases\n\n### Example Files\n\nWorking examples in `examples/`:\n- **`example-script.sh`** - Working example\n```\n\n### Step 5: Validate and Test\n\n**For plugin skills, validation is different from generic skills:**\n\n1. **Check structure**: Skill directory in `plugin-name/skills/skill-name/`\n2. **Validate SKILL.md**: Has frontmatter with name and description\n3. **Check trigger phrases**: Description includes specific user queries\n4. **Verify writing style**: Body uses imperative/infinitive form, not second person\n5. **Test progressive disclosure**: SKILL.md is lean (~1,500-2,000 words), detailed content in references/\n6. **Check references**: All referenced files exist\n7. **Validate examples**: Examples are complete and correct\n8. **Test scripts**: Scripts are executable and work correctly\n\n**Use the skill-reviewer agent:**\n\n```text\nAsk: \"Review my skill and check if it follows best practices\"\n```\n\nThe skill-reviewer agent will check description quality, content organization, and progressive disclosure.\n\n### Step 6: Iterate\n\nAfter testing the skill, users may request improvements. Often this happens right after using the skill, with fresh context of how the skill performed.\n\n**Iteration workflow:**\n\n1. Use the skill on real tasks\n2. Notice struggles or inefficiencies\n3. Identify how SKILL.md or bundled resources should be updated\n4. Implement changes and test again\n\n**Common improvements:**\n\n- Strengthen trigger phrases in description\n- Move long sections from SKILL.md to references/\n- Add missing examples or scripts\n- Clarify ambiguous instructions\n- Add edge case handling\n\n## Plugin-Specific Considerations\n\n### Skill Location in Plugins\n\nPlugin skills live in the plugin's `skills/` directory:\n\n```text\nmy-plugin/\n .claude-plugin/\n    plugin.json\n commands/\n agents/\n skills/\n     my-skill/\n         SKILL.md\n         references/\n         examples/\n         scripts/\n```\n\n### Auto-Discovery\n\nClaude Code automatically discovers skills:\n\n- Scans `skills/` directory\n- Finds subdirectories containing `SKILL.md`\n- Loads skill metadata (name + description) always\n- Loads SKILL.md body when skill triggers\n- Loads references/examples when needed\n\n### No Packaging Needed\n\nPlugin skills are distributed as part of the plugin, not as separate ZIP files. Users get skills when they install the plugin.\n\n### Testing in Plugins\n\nTest skills by installing plugin locally:\n\n```bash\n# Test with --plugin-dir\ncc --plugin-dir /path/to/plugin\n\n# Ask questions that should trigger the skill\n# Verify skill loads correctly\n```\n\n## Examples from Plugin-Dev\n\nStudy the skills in this plugin as examples of best practices:\n\n**hook-development skill:**\n\n- Excellent trigger phrases: \"create a hook\", \"add a PreToolUse hook\", etc.\n- Lean SKILL.md (1,651 words)\n- 3 references/ files for detailed content\n- 3 examples/ of working hooks\n- 3 scripts/ utilities\n\n**agent-development skill:**\n\n- Strong triggers: \"create an agent\", \"agent frontmatter\", etc.\n- Focused SKILL.md (1,438 words)\n- References include the AI generation prompt from Claude Code\n- Complete agent examples\n\n**plugin-settings skill:**\n\n- Specific triggers: \"plugin settings\", \".local.md files\", \"YAML frontmatter\"\n- References show real implementations (multi-agent-swarm, ralph-wiggum)\n- Working parsing scripts\n\nEach demonstrates progressive disclosure and strong triggering.\n\n## Progressive Disclosure in Practice\n\n### What Goes in SKILL.md\n\n**Include (always loaded when skill triggers):**\n\n- Core concepts and overview\n- Essential procedures and workflows\n- Quick reference tables\n- Pointers to references/examples/scripts\n- Most common use cases\n\n**Keep under 3,000 words, ideally 1,500-2,000 words**\n\n### What Goes in references/\n\n**Move to references/ (loaded as needed):**\n\n- Detailed patterns and advanced techniques\n- Comprehensive API documentation\n- Migration guides\n- Edge cases and troubleshooting\n- Extensive examples and walkthroughs\n\n**Each reference file can be large (2,000-5,000+ words)**\n\n### What Goes in examples/\n\n**Working code examples:**\n\n- Complete, runnable scripts\n- Configuration files\n- Template files\n- Real-world usage examples\n\n**Users can copy and adapt these directly**\n\n### What Goes in scripts/\n\n**Utility scripts:**\n\n- Validation tools\n- Testing helpers\n- Parsing utilities\n- Automation scripts\n\n**Should be executable and documented**\n\n## Writing Style Requirements\n\n### Imperative/Infinitive Form\n\nWrite using verb-first instructions, not second person:\n\n**Correct (imperative):**\n\n```text\nTo create a hook, define the event type.\nConfigure the MCP server with authentication.\nValidate settings before use.\n```\n\n**Incorrect (second person):**\n\n```text\nYou should create a hook by defining the event type.\nYou need to configure the MCP server.\nYou must validate settings before use.\n```\n\n### Third-Person in Description\n\nThe frontmatter description must use third person:\n\n**Correct:**\n\n```yaml\ndescription: This skill should be used when the user asks to \"create X\", \"configure Y\"...\n```\n\n**Incorrect:**\n\n```yaml\ndescription: Use this skill when you want to create X...\ndescription: Load this skill when user asks...\n```\n\n### Objective, Instructional Language\n\nFocus on what to do, not who should do it:\n\n**Correct:**\n\n```text\nParse the frontmatter using sed.\nExtract fields with grep.\nValidate values before use.\n```\n\n**Incorrect:**\n\n```text\nYou can parse the frontmatter...\nClaude should extract fields...\nThe user might validate values...\n```\n\n## Validation Checklist\n\nBefore finalizing a skill:\n\n**Structure:**\n\n- [ ] SKILL.md file exists with valid YAML frontmatter\n- [ ] Frontmatter has `name` and `description` fields\n- [ ] Markdown body is present and substantial\n- [ ] Referenced files actually exist\n\n**Description Quality:**\n\n- [ ] Uses third person (\"This skill should be used when...\")\n- [ ] Includes specific trigger phrases users would say\n- [ ] Lists concrete scenarios (\"create X\", \"configure Y\")\n- [ ] Not vague or generic\n\n**Content Quality:**\n\n- [ ] SKILL.md body uses imperative/infinitive form\n- [ ] Body is focused and lean (1,500-2,000 words ideal, <5k max)\n- [ ] Detailed content moved to references/\n- [ ] Examples are complete and working\n- [ ] Scripts are executable and documented\n\n**Progressive Disclosure:**\n\n- [ ] Core concepts in SKILL.md\n- [ ] Detailed docs in references/\n- [ ] Working code in examples/\n- [ ] Utilities in scripts/\n- [ ] SKILL.md references these resources\n\n**Testing:**\n\n- [ ] Skill triggers on expected user queries\n- [ ] Content is helpful for intended tasks\n- [ ] No duplicated information across files\n- [ ] References load when needed\n\n## Common Mistakes to Avoid\n\n### Mistake 1: Weak Trigger Description\n\n **Bad:**\n\n```yaml\ndescription: Provides guidance for working with hooks.\n```\n\n**Why bad:** Vague, no specific trigger phrases, not third person\n\n **Good:**\n\n```yaml\ndescription: This skill should be used when the user asks to \"create a hook\", \"add a PreToolUse hook\", \"validate tool use\", or mentions hook events. Provides comprehensive hooks API guidance.\n```\n\n**Why good:** Third person, specific phrases, concrete scenarios\n\n### Mistake 2: Too Much in SKILL.md\n\n **Bad:**\n\n```text\nskill-name/\n SKILL.md  (8,000 words - everything in one file)\n```\n\n**Why bad:** Bloats context when skill loads, detailed content always loaded\n\n **Good:**\n\n```text\nskill-name/\n SKILL.md  (1,800 words - core essentials)\n references/\n     patterns.md (2,500 words)\n     advanced.md (3,700 words)\n```\n\n**Why good:** Progressive disclosure, detailed content loaded only when needed\n\n### Mistake 3: Second Person Writing\n\n **Bad:**\n\n```markdown\nYou should start by reading the configuration file.\nYou need to validate the input.\nYou can use the grep tool to search.\n```\n\n**Why bad:** Second person, not imperative form\n\n **Good:**\n\n```markdown\nStart by reading the configuration file.\nValidate the input before processing.\nUse the grep tool to search for patterns.\n```\n\n**Why good:** Imperative form, direct instructions\n\n### Mistake 4: Missing Resource References\n\n **Bad:**\n\n```markdown\n# SKILL.md\n\n[Core content]\n\n[No mention of references/ or examples/]\n```\n\n**Why bad:** Claude doesn't know references exist\n\n **Good:**\n\n```markdown\n# SKILL.md\n\n[Core content]\n\n## Additional Resources\n\n### Reference Files\n- **`references/patterns.md`** - Detailed patterns\n- **`references/advanced.md`** - Advanced techniques\n\n### Examples\n- **`examples/script.sh`** - Working example\n```\n\n**Why good:** Claude knows where to find additional information\n\n### Mistake 5: Dynamic Bash Patterns in Code Blocks\n\nThe skill parser scans the entire SKILL.md for dynamic bash patterns without respecting fenced code block boundaries (GitHub #12781). This causes unintended execution during skill load.\n\n**Bad pattern:** Using exclamation-backtick syntax (e.g., exclamation mark followed by backtick-command-backtick) in code block examples. The parser executes these during skill load. Escaping with backslash does NOT work.\n\n**Good pattern:** Use `$` shell notation instead:\n\n```bash\n# Safe in code blocks\n$ git status\n$ bash script.sh\n```\n\n**Workarounds:**\n\n1. Use `$ command` notation in examples\n2. Describe syntax in prose rather than showing literal patterns\n3. Move examples to reference files (not parsed as skill content)\n\nThis also applies to `@` file reference patterns in code blocks.\n\n## Quick Reference\n\n### Minimal Skill\n\n```text\nskill-name/\n SKILL.md\n```\n\nGood for: Simple knowledge, no complex resources needed\n\n### Standard Skill (Recommended)\n\n```text\nskill-name/\n SKILL.md\n references/\n    detailed-guide.md\n examples/\n     working-example.sh\n```\n\nGood for: Most plugin skills with detailed documentation\n\n### Complete Skill\n\n```text\nskill-name/\n SKILL.md\n references/\n    patterns.md\n    advanced.md\n examples/\n    example1.sh\n    example2.json\n scripts/\n     validate.sh\n```\n\nGood for: Complex domains with validation utilities\n\n## Best Practices Summary\n\n **DO:**\n\n- Use third-person in description (\"This skill should be used when...\")\n- Include specific trigger phrases (\"create X\", \"configure Y\")\n- Keep SKILL.md lean (1,500-2,000 words)\n- Use progressive disclosure (move details to references/)\n- Write in imperative/infinitive form\n- Reference supporting files clearly\n- Provide working examples\n- Create utility scripts for common operations\n- Study plugin-dev's skills as templates\n\n **DON'T:**\n\n- Use second person anywhere\n- Have vague trigger conditions\n- Put everything in SKILL.md (>3,000 words without references/)\n- Write in second person (\"You should...\")\n- Leave resources unreferenced\n- Include broken or incomplete examples\n- Skip validation\n\n## Additional Resources\n\n### Study These Skills\n\nPlugin-dev's skills demonstrate best practices:\n\n- `../hook-development/` - Progressive disclosure, utilities\n- `../agent-development/` - AI-assisted creation, references\n- `../mcp-integration/` - Comprehensive references\n- `../plugin-settings/` - Real-world examples\n- `../command-development/` - Clear critical concepts\n- `../plugin-structure/` - Good organization\n\n### Reference Files\n\nFor complete skill-creator methodology:\n\n- **`references/skill-creator-original.md`** - Full original skill-creator content\n\nFor complete Offical Anthropic skill specification:\n\n- **`references/agent-skills-spec.md`** - Full Offical Anthropic skill specification\n\n## Implementation Workflow\n\nTo create a skill for your plugin:\n\n1. **Understand use cases**: Identify concrete examples of skill usage\n2. **Plan resources**: Determine what scripts/references/examples needed\n3. **Create structure**: `mkdir -p skills/skill-name/{references,examples,scripts}`\n4. **Write SKILL.md**:\n   - Frontmatter with third-person description and trigger phrases\n   - Lean body (1,500-2,000 words) in imperative form\n   - Reference supporting files\n5. **Add resources**: Create references/, examples/, scripts/ as needed\n6. **Validate**: Check description, writing style, organization\n7. **Test**: Verify skill loads on expected triggers\n8. **Iterate**: Improve based on usage\n\nFocus on strong trigger descriptions, progressive disclosure, and imperative writing style for effective skills that load when needed and provide targeted guidance."
              }
            ]
          }
        ]
      }
    }
  ]
}