{
  "owner": {
    "id": "Yvictor",
    "display_name": "Yvictor",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/8242025?u=fc6b0164da6cd3fd5a2280be2b99c3a731c15463&v=4",
    "url": "https://github.com/Yvictor",
    "bio": null,
    "stats": {
      "total_repos": 1,
      "total_plugins": 1,
      "total_commands": 0,
      "total_skills": 1,
      "total_stars": 1,
      "total_forks": 0
    }
  },
  "repos": [
    {
      "full_name": "Yvictor/polars_backtest_extension",
      "url": "https://github.com/Yvictor/polars_backtest_extension",
      "description": "Blazingly fast portfolio backtesting for Polars",
      "homepage": "",
      "signals": {
        "stars": 1,
        "forks": 0,
        "pushed_at": "2026-01-05T10:20:34Z",
        "created_at": "2025-12-13T07:24:31Z",
        "license": "NOASSERTION"
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 318
        },
        {
          "path": ".claude-plugin/plugin.json",
          "type": "blob",
          "size": 457
        },
        {
          "path": ".github",
          "type": "tree",
          "size": null
        },
        {
          "path": ".github/workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": ".github/workflows/ci.yml",
          "type": "blob",
          "size": 1437
        },
        {
          "path": ".github/workflows/release.yml",
          "type": "blob",
          "size": 3802
        },
        {
          "path": ".gitignore",
          "type": "blob",
          "size": 311
        },
        {
          "path": "Cargo.lock",
          "type": "blob",
          "size": 101292
        },
        {
          "path": "Cargo.toml",
          "type": "blob",
          "size": 543
        },
        {
          "path": "FINLAB_PARAMS_COMPARISON.md",
          "type": "blob",
          "size": 2349
        },
        {
          "path": "IMPLEMENTATION_PLAN.md",
          "type": "blob",
          "size": 1273
        },
        {
          "path": "LICENSE",
          "type": "blob",
          "size": 4652
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 9975
        },
        {
          "path": "backtest_flow.md",
          "type": "blob",
          "size": 4912
        },
        {
          "path": "btcore",
          "type": "tree",
          "size": null
        },
        {
          "path": "btcore/Cargo.toml",
          "type": "blob",
          "size": 603
        },
        {
          "path": "btcore/src",
          "type": "tree",
          "size": null
        },
        {
          "path": "btcore/src/config.rs",
          "type": "blob",
          "size": 3418
        },
        {
          "path": "btcore/src/lib.rs",
          "type": "blob",
          "size": 1898
        },
        {
          "path": "btcore/src/mae_mfe.rs",
          "type": "blob",
          "size": 14046
        },
        {
          "path": "btcore/src/portfolio.rs",
          "type": "blob",
          "size": 12220
        },
        {
          "path": "btcore/src/position.rs",
          "type": "blob",
          "size": 8674
        },
        {
          "path": "btcore/src/returns.rs",
          "type": "blob",
          "size": 4640
        },
        {
          "path": "btcore/src/simulation",
          "type": "tree",
          "size": null
        },
        {
          "path": "btcore/src/simulation/long.rs",
          "type": "blob",
          "size": 73794
        },
        {
          "path": "btcore/src/simulation/mod.rs",
          "type": "blob",
          "size": 1199
        },
        {
          "path": "btcore/src/simulation/wide.rs",
          "type": "blob",
          "size": 63411
        },
        {
          "path": "btcore/src/stats.rs",
          "type": "blob",
          "size": 7665
        },
        {
          "path": "btcore/src/stops.rs",
          "type": "blob",
          "size": 20912
        },
        {
          "path": "btcore/src/tracker.rs",
          "type": "blob",
          "size": 30966
        },
        {
          "path": "btcore/src/trades.rs",
          "type": "blob",
          "size": 7974
        },
        {
          "path": "btcore/src/weights.rs",
          "type": "blob",
          "size": 12090
        },
        {
          "path": "btcore/tests",
          "type": "tree",
          "size": null
        },
        {
          "path": "btcore/tests/integration_test.rs",
          "type": "blob",
          "size": 25395
        },
        {
          "path": "justfile",
          "type": "blob",
          "size": 2238
        },
        {
          "path": "polars_backtest",
          "type": "tree",
          "size": null
        },
        {
          "path": "polars_backtest/Cargo.toml",
          "type": "blob",
          "size": 1266
        },
        {
          "path": "polars_backtest/README.md",
          "type": "blob",
          "size": 5580
        },
        {
          "path": "polars_backtest/benchmarks",
          "type": "tree",
          "size": null
        },
        {
          "path": "polars_backtest/benchmarks/bench_backtest.py",
          "type": "blob",
          "size": 3078
        },
        {
          "path": "polars_backtest/pyproject.toml",
          "type": "blob",
          "size": 1868
        },
        {
          "path": "polars_backtest/python",
          "type": "tree",
          "size": null
        },
        {
          "path": "polars_backtest/python/polars_backtest",
          "type": "tree",
          "size": null
        },
        {
          "path": "polars_backtest/python/polars_backtest/__init__.py",
          "type": "blob",
          "size": 5901
        },
        {
          "path": "polars_backtest/python/polars_backtest/namespace.py",
          "type": "blob",
          "size": 23462
        },
        {
          "path": "polars_backtest/python/polars_backtest/namespace.pyi",
          "type": "blob",
          "size": 4221
        },
        {
          "path": "polars_backtest/python/polars_backtest/polars_backtest.pyi",
          "type": "blob",
          "size": 6395
        },
        {
          "path": "polars_backtest/python/polars_backtest/py.typed",
          "type": "blob",
          "size": null
        },
        {
          "path": "polars_backtest/python/polars_backtest/utils.py",
          "type": "blob",
          "size": 8211
        },
        {
          "path": "polars_backtest/python/polars_backtest/wide.py",
          "type": "blob",
          "size": 52921
        },
        {
          "path": "polars_backtest/restore",
          "type": "tree",
          "size": null
        },
        {
          "path": "polars_backtest/restore/restored_backtest_core.pyx",
          "type": "blob",
          "size": 19835
        },
        {
          "path": "polars_backtest/restore/restored_mae_mfe.pyx",
          "type": "blob",
          "size": 7706
        },
        {
          "path": "polars_backtest/restore/restored_report.pyx",
          "type": "blob",
          "size": 38239
        },
        {
          "path": "polars_backtest/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "polars_backtest/scripts/load_data.py",
          "type": "blob",
          "size": 7098
        },
        {
          "path": "polars_backtest/src",
          "type": "tree",
          "size": null
        },
        {
          "path": "polars_backtest/src/expressions.rs",
          "type": "blob",
          "size": 4780
        },
        {
          "path": "polars_backtest/src/ffi_convert.rs",
          "type": "blob",
          "size": 5838
        },
        {
          "path": "polars_backtest/src/lib.rs",
          "type": "blob",
          "size": 54641
        },
        {
          "path": "polars_backtest/src/report.rs",
          "type": "blob",
          "size": 52221
        },
        {
          "path": "polars_backtest/tests",
          "type": "tree",
          "size": null
        },
        {
          "path": "polars_backtest/tests/test_long_vs_wide.py",
          "type": "blob",
          "size": 57151
        },
        {
          "path": "polars_backtest/tests/test_namespace.py",
          "type": "blob",
          "size": 8665
        },
        {
          "path": "polars_backtest/tests/test_position_info.py",
          "type": "blob",
          "size": 9900
        },
        {
          "path": "polars_backtest/tests/test_resample_polars.py",
          "type": "blob",
          "size": 10608
        },
        {
          "path": "polars_backtest/tests/test_utils.py",
          "type": "blob",
          "size": 704
        },
        {
          "path": "polars_backtest/tests/test_wide.py",
          "type": "blob",
          "size": 12765
        },
        {
          "path": "polars_backtest/tests/test_wide_vs_finlab.py",
          "type": "blob",
          "size": 37588
        },
        {
          "path": "polars_backtest/uv.lock",
          "type": "blob",
          "size": 429106
        },
        {
          "path": "skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/polars-backtest",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/polars-backtest/SKILL.md",
          "type": "blob",
          "size": 12196
        },
        {
          "path": "specs",
          "type": "tree",
          "size": null
        },
        {
          "path": "specs/01_FINLAB_BACKTEST_SPEC.md",
          "type": "blob",
          "size": 8544
        },
        {
          "path": "specs/02_POLARS_RUST_EXTENSION_SPEC.md",
          "type": "blob",
          "size": 15730
        },
        {
          "path": "specs/03_DATA_LOADING_AND_TESTING.md",
          "type": "blob",
          "size": 14254
        },
        {
          "path": "specs/FINLAB_CALCULATION_ANALYSIS.md",
          "type": "blob",
          "size": 8546
        },
        {
          "path": "specs/LIQUIDITY_METRICS_PLAN.md",
          "type": "blob",
          "size": 8713
        },
        {
          "path": "specs/README.md",
          "type": "blob",
          "size": 2425
        },
        {
          "path": "specs/REPORT_IMPLEMENTATION_PLAN.md",
          "type": "blob",
          "size": 14429
        }
      ],
      "marketplace": {
        "name": "polars-backtest-marketplace",
        "version": null,
        "description": null,
        "owner_info": {
          "name": "Yvictor",
          "url": "https://github.com/Yvictor"
        },
        "keywords": [],
        "plugins": [
          {
            "name": "polars-backtest",
            "description": "Polars backtest extension development helper - backtesting with polars expressions",
            "source": "./",
            "category": null,
            "version": null,
            "author": null,
            "install_commands": [
              "/plugin marketplace add Yvictor/polars_backtest_extension",
              "/plugin install polars-backtest@polars-backtest-marketplace"
            ],
            "signals": {
              "stars": 1,
              "forks": 0,
              "pushed_at": "2026-01-05T10:20:34Z",
              "created_at": "2025-12-13T07:24:31Z",
              "license": "NOASSERTION"
            },
            "commands": [],
            "skills": [
              {
                "name": "polars-backtest",
                "description": "Help users backtest trading strategies with polars-backtest library. Use when user asks about backtesting, portfolio simulation, trading strategy analysis, or working with polars-backtest.",
                "path": "skills/polars-backtest/SKILL.md",
                "frontmatter": {
                  "name": "polars-backtest",
                  "description": "Help users backtest trading strategies with polars-backtest library. Use when user asks about backtesting, portfolio simulation, trading strategy analysis, or working with polars-backtest."
                },
                "content": "# Polars Backtest Usage Skill\n\nHelp users use polars-backtest to backtest their trading strategies efficiently.\n\n## Installation\n\n```bash\npip install polars-backtest\n# or\nuv add polars-backtest\n```\n\n## Data Format\n\n**Long format**: one row per (date, symbol) pair.\n\n```python\nimport polars as pl\nimport polars_backtest as pl_bt\n\ndf = pl.DataFrame({\n    \"date\": [\"2024-01-01\", \"2024-01-01\", \"2024-01-02\", \"2024-01-02\"],\n    \"symbol\": [\"2330\", \"2317\", \"2330\", \"2317\"],\n    \"close\": [100.0, 50.0, 102.0, 51.0],\n    \"weight\": [0.6, 0.4, 0.6, 0.4],\n})\n```\n\n## Basic Usage\n\n```python\n# DataFrame namespace\nresult = df.bt.backtest(trade_at_price=\"close\", position=\"weight\")\n\n# Function API\nresult = pl_bt.backtest(df, trade_at_price=\"close\", position=\"weight\")\n\n# With report (includes trades, stats)\nreport = df.bt.backtest_with_report(position=\"weight\", resample=\"M\")\n```\n\n## Complete Parameter Reference\n\n### Column Mapping Parameters\n\n| Parameter | Default | Type | Description |\n|-----------|---------|------|-------------|\n| `trade_at_price` | `\"close\"` | str \\| Expr | Price column for trade execution. Use adjusted close for accurate returns. |\n| `position` | `\"weight\"` | str \\| Expr | Position weight column. Can be float weights or boolean signals (True=buy). Null values are filled with 0. |\n| `date` | `\"date\"` | str \\| Expr | Date column. Must be sortable. |\n| `symbol` | `\"symbol\"` | str \\| Expr | Stock symbol/ticker column. |\n| `open` | `\"open\"` | str \\| Expr | Open price column. Required when `touched_exit=True`. |\n| `high` | `\"high\"` | str \\| Expr | High price column. Required when `touched_exit=True`. |\n| `low` | `\"low\"` | str \\| Expr | Low price column. Required when `touched_exit=True`. |\n| `factor` | `\"factor\"` | str | Adjustment factor column. Used to calculate raw price: `raw_price = adj_price / factor`. If column doesn't exist, defaults to 1.0. Useful for dividend/split adjusted prices. |\n\n### Rebalancing Parameters\n\n| Parameter | Default | Type | Description |\n|-----------|---------|------|-------------|\n| `resample` | `\"D\"` | str \\| None | Rebalance frequency. Options: `\"D\"` (daily), `\"W\"` (weekly), `\"W-FRI\"` (weekly on Friday), `\"M\"` (monthly), `\"Q\"` (quarterly), `\"Y\"` (yearly), `None` (only when position changes). |\n| `resample_offset` | `None` | str \\| None | Delay rebalance execution. Examples: `\"1d\"` (1 day delay), `\"2d\"`, `\"1W\"`. Useful for simulating delayed signal execution. |\n\n### Cost Parameters\n\n| Parameter | Default | Type | Description |\n|-----------|---------|------|-------------|\n| `fee_ratio` | `0.001425` | float | Transaction fee rate (both buy and sell). Taiwan stock default is 0.1425%. |\n| `tax_ratio` | `0.003` | float | Transaction tax rate (sell only). Taiwan stock default is 0.3%. |\n\n### Risk Management Parameters\n\n| Parameter | Default | Type | Description |\n|-----------|---------|------|-------------|\n| `stop_loss` | `1.0` | float | Stop loss threshold. Exit when loss reaches this ratio. `1.0` = disabled (100% loss). Example: `-0.1` exits at 10% loss. |\n| `take_profit` | `inf` | float | Take profit threshold. Exit when profit reaches this ratio. `inf` = disabled. Example: `0.2` exits at 20% profit. |\n| `trail_stop` | `inf` | float | Trailing stop threshold. Exit when price drops this much from peak. `inf` = disabled. Example: `0.05` exits when 5% below peak. |\n| `position_limit` | `1.0` | float | Maximum weight per single stock. `1.0` = no limit. Example: `0.1` caps each stock at 10% of portfolio. |\n| `touched_exit` | `False` | bool | Use intraday OHLC for stop detection. When True, checks if stop/take profit was touched during the day using high/low prices, not just close. Requires open/high/low columns. |\n| `stop_trading_next_period` | `True` | bool | When stop is triggered, skip trading in the next period. Prevents immediate re-entry after stop. |\n\n### Calculation Mode Parameters\n\n| Parameter | Default | Description |\n|-----------|---------|-------------|\n| `finlab_mode` | `False` (backtest) / `True` (backtest_with_report) | Use Finlab-compatible calculation. When True, boolean signals are converted to equal weights. Affects weight normalization behavior. |\n| `retain_cost_when_rebalance` | `False` | When rebalancing, retain the cost basis instead of resetting. Affects return calculation for partially sold positions. |\n\n### Benchmark Parameters (backtest_with_report only)\n\n| Parameter | Default | Type | Description |\n|-----------|---------|------|-------------|\n| `benchmark` | `None` | str \\| DataFrame \\| None | Benchmark for alpha/beta calculation. **str**: symbol value in your data (e.g., `\"0050\"`), uses that symbol's price. **DataFrame**: must have `date` and `creturn` columns (cumulative return starting at 1.0). |\n\n### Liquidity Metrics Parameters (backtest_with_report only)\n\n| Parameter | Default | Type | Description |\n|-----------|---------|------|-------------|\n| `limit_up` | `\"limit_up\"` | str | Column name for limit-up price. Used to calculate `buyHigh` metric (ratio of entries at limit-up). |\n| `limit_down` | `\"limit_down\"` | str | Column name for limit-down price. Used to calculate `sellLow` metric (ratio of exits at limit-down). |\n| `trading_value` | `\"trading_value\"` | str | Column for trading value (e.g., `close * volume`). Used to calculate `capacity` metric. |\n\n## BacktestReport Object\n\n```python\nreport = df.bt.backtest_with_report(position=\"weight\")\n\n# Properties\nreport.creturn      # DataFrame with date, creturn columns\nreport.trades       # DataFrame with trade records (entry/exit dates, prices, returns, MAE/MFE)\nreport.stats        # Statistics DataFrame (shortcut for get_stats())\nreport.fee_ratio    # Fee ratio used\nreport.tax_ratio    # Tax ratio used\nreport.stop_loss    # Stop loss threshold (None if disabled)\nreport.take_profit  # Take profit threshold (None if disabled)\nreport.trail_stop   # Trail stop threshold (None if disabled)\nreport.trade_at     # Trade timing (e.g., 'close')\nreport.resample     # Resample frequency\nreport.benchmark    # Benchmark DataFrame (can be set after creation)\n\n# Set benchmark after creation\nreport.benchmark = benchmark_df\n```\n\n## BacktestReport Methods\n\n### get_stats(riskfree_rate=0.02)\nGet basic statistics as single-row DataFrame.\n\n```python\nreport.get_stats()  # or report.stats\n```\n\nColumns: `start`, `end`, `rf`, `total_return`, `cagr`, `max_drawdown`, `avg_drawdown`, `daily_mean`, `daily_vol`, `daily_sharpe`, `daily_sortino`, `best_day`, `worst_day`, `calmar`, `win_ratio`\n\n### get_monthly_stats(riskfree_rate=0.02)\nGet monthly statistics.\n\n```python\nreport.get_monthly_stats()\n```\n\nColumns: `monthly_mean`, `monthly_vol`, `monthly_sharpe`, `monthly_sortino`, `best_month`, `worst_month`\n\n### get_return_table()\nGet monthly return table pivoted by year x month.\n\n```python\nreport.get_return_table()\n```\n\nReturns DataFrame with year as rows and months (1-12) as columns.\n\n### get_metrics(sections=None, riskfree_rate=0.02)\nGet structured metrics as single-row DataFrame.\n\n```python\nmetrics = report.get_metrics()  # All sections\nmetrics = report.get_metrics(sections=[\"profitability\", \"risk\"])\n```\n\n### current_trades()\nGet active trades (positions without exit or exiting on last date).\n\n```python\nreport.current_trades()\n```\n\n### actions()\nGet trade actions for current positions.\n\n```python\nreport.actions()\n# Returns: stock_id, action ('enter', 'exit', 'hold')\n```\n\n### is_stop_triggered()\nCheck if any trade was triggered by stop loss or take profit.\n\n```python\nif report.is_stop_triggered():\n    print(\"Stop was triggered\")\n```\n\n### daily_creturn()\nGet daily resampled cumulative return DataFrame.\n\n```python\nreport.daily_creturn()\n```\n\n## get_metrics Sections\n\n| Section | Metrics | Description |\n|---------|---------|-------------|\n| **backtest** | `startDate`, `endDate`, `feeRatio`, `taxRatio`, `freq`, `tradeAt`, `stopLoss`, `takeProfit`, `trailStop` | Backtest configuration |\n| **profitability** | `annualReturn`, `avgNStock`, `maxNStock`, `alpha`, `beta` | Returns and benchmark comparison |\n| **risk** | `maxDrawdown`, `avgDrawdown`, `avgDrawdownDays`, `valueAtRisk`, `cvalueAtRisk` | Risk metrics |\n| **ratio** | `sharpeRatio`, `sortinoRatio`, `calmarRatio`, `volatility`, `profitFactor`, `tailRatio` | Risk-adjusted ratios |\n| **winrate** | `winRate`, `expectancy`, `mae`, `mfe`, `m12WinRate` | Win rate and trade analysis |\n| **liquidity** | `buyHigh`, `sellLow`, `capacity` | Liquidity metrics (requires columns) |\n\nNote: `alpha`, `beta`, `m12WinRate` require benchmark to be set.\n\n## Statistics Expressions\n\nUse these expressions for custom calculations:\n\n```python\nfrom polars_backtest import daily_returns, cumulative_returns, sharpe_ratio, max_drawdown\n\ndf.with_columns(\n    ret=daily_returns(\"close\"),\n    creturn=cumulative_returns(\"ret\"),\n)\n\ndf.select(\n    sharpe=sharpe_ratio(\"ret\"),\n    mdd=max_drawdown(\"creturn\"),\n)\n```\n\n## Usage Examples\n\n### Momentum Strategy with Monthly Rebalancing\n```python\ndf = df.with_columns(\n    pl.when(pl.col(\"close\") >= pl.col(\"close\").rolling_max(60).over(\"symbol\"))\n    .then(1.0)\n    .otherwise(0.0)\n    .alias(\"weight\")\n)\nreport = df.bt.backtest_with_report(position=\"weight\", resample=\"M\")\n```\n\n### With Risk Management\n```python\nreport = df.bt.backtest_with_report(\n    position=\"weight\",\n    stop_loss=-0.1,        # -10% stop loss\n    take_profit=0.2,       # +20% take profit\n    trail_stop=0.05,       # 5% trailing stop\n    touched_exit=True,     # Use intraday OHLC for detection\n)\n```\n\n### With Benchmark Comparison\n```python\n# Using a symbol in your data as benchmark\nreport = df.bt.backtest_with_report(\n    position=\"weight\",\n    benchmark=\"0050\",      # ETF ticker\n)\n\n# Or set after creation\nreport.benchmark = benchmark_df\n\n# Get metrics with alpha, beta, m12WinRate\nmetrics = report.get_metrics(sections=[\"profitability\", \"winrate\"])\n```\n\n### With Factor Column (Adjusted Prices)\n```python\n# When using adjusted prices, factor converts back to raw price\n# raw_price = adj_close / factor\ndf = df.with_columns(\n    (pl.col(\"close_raw\") / pl.col(\"close_adj\")).alias(\"factor\")\n)\nreport = df.bt.backtest_with_report(\n    trade_at_price=\"close_adj\",\n    factor=\"factor\",\n)\n```\n\n### With Liquidity Metrics\n```python\ndf = df.with_columns([\n    pl.col(\"limit_up_price\").alias(\"limit_up\"),\n    pl.col(\"limit_down_price\").alias(\"limit_down\"),\n    (pl.col(\"close\") * pl.col(\"volume\")).alias(\"trading_value\"),\n])\nreport = df.bt.backtest_with_report(position=\"weight\")\nmetrics = report.get_metrics(sections=[\"liquidity\"])\n# Returns: buyHigh, sellLow, capacity\n```\n\n### Using Polars Expressions\n```python\n# Pass expressions directly instead of column names\nresult = df.bt.backtest(\n    trade_at_price=pl.col(\"adj_close\"),\n    position=pl.col(\"signal\").cast(pl.Float64),\n    resample=\"M\",\n)\n```\n\n### Delayed Rebalancing\n```python\n# Rebalance monthly, but execute 2 days after signal\nreport = df.bt.backtest_with_report(\n    position=\"weight\",\n    resample=\"M\",\n    resample_offset=\"2d\",\n)\n```\n\n### Analyzing Current Positions\n```python\nreport = df.bt.backtest_with_report(position=\"weight\")\n\n# Get current active trades\ncurrent = report.current_trades()\n\n# Get recommended actions\nactions = report.actions()  # enter/exit/hold per stock\n```\n\n## Resample Options\n\n| Value | Description |\n|-------|-------------|\n| `None` | Only rebalance when position changes |\n| `'D'` | Daily |\n| `'W'` | Weekly (Sunday) |\n| `'W-FRI'` | Weekly (Friday) |\n| `'M'` | Monthly |\n| `'Q'` | Quarterly |\n| `'Y'` | Yearly |\n\n## Tips\n\n1. **Weight normalization**: Weights are automatically normalized to sum to 1.0 per date\n2. **T+1 execution**: Trades execute at next day's price (realistic simulation)\n3. **Boolean signals**: Pass boolean column as position, library converts True to equal weights\n4. **Null handling**: Null values in position column are filled with 0.0\n5. **resample=None**: Only rebalance when position changes (reduces turnover)\n6. **Position limit**: Use `position_limit=0.1` to cap each stock at 10%"
              }
            ]
          }
        ]
      }
    }
  ]
}