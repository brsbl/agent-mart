{
  "owner": {
    "id": "thlandgraf",
    "display_name": "Thomas Landgraf",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/45935153?u=292fa6d98afb533d3f5654cb665e7d7ddf7ea15b&v=4",
    "url": "https://github.com/thlandgraf",
    "bio": "Hello, I'm Thomas Landgraf, an entrepreneur, IT manager, and passionate programming enthusiast. With a programming journey that began back in 1983 on a VIC20.",
    "stats": {
      "total_repos": 1,
      "total_plugins": 1,
      "total_commands": 5,
      "total_skills": 3,
      "total_stars": 0,
      "total_forks": 0
    }
  },
  "repos": [
    {
      "full_name": "thlandgraf/cc-marketplace",
      "url": "https://github.com/thlandgraf/cc-marketplace",
      "description": "Claude Code Plugins",
      "homepage": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2026-01-11T17:02:04Z",
        "created_at": "2026-01-11T17:00:49Z",
        "license": null
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 774
        },
        {
          "path": ".claude",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/settings.json",
          "type": "blob",
          "size": 77
        },
        {
          "path": ".gitignore",
          "type": "blob",
          "size": 147
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 2394
        },
        {
          "path": "plugins",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 671
        },
        {
          "path": "plugins/speclan/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/agents/feature-verifier.md",
          "type": "blob",
          "size": 10180
        },
        {
          "path": "plugins/speclan/agents/implementation-order.md",
          "type": "blob",
          "size": 8214
        },
        {
          "path": "plugins/speclan/agents/requirement-verifier.md",
          "type": "blob",
          "size": 4248
        },
        {
          "path": "plugins/speclan/agents/spec-converter.md",
          "type": "blob",
          "size": 2583
        },
        {
          "path": "plugins/speclan/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/commands/from-speckit.md",
          "type": "blob",
          "size": 4159
        },
        {
          "path": "plugins/speclan/commands/implement.md",
          "type": "blob",
          "size": 11797
        },
        {
          "path": "plugins/speclan/commands/status.md",
          "type": "blob",
          "size": 2823
        },
        {
          "path": "plugins/speclan/commands/sync-from-session.md",
          "type": "blob",
          "size": 8133
        },
        {
          "path": "plugins/speclan/commands/to-speckit.md",
          "type": "blob",
          "size": 3826
        },
        {
          "path": "plugins/speclan/doc",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/doc/infer-mapping-pass2.md",
          "type": "blob",
          "size": 4262
        },
        {
          "path": "plugins/speclan/hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/hooks/hooks.json",
          "type": "blob",
          "size": 345
        },
        {
          "path": "plugins/speclan/hooks/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/hooks/scripts/detect-context.sh",
          "type": "blob",
          "size": 5400
        },
        {
          "path": "plugins/speclan/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/skills/speclan-format",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/skills/speclan-format/SKILL.md",
          "type": "blob",
          "size": 18999
        },
        {
          "path": "plugins/speclan/skills/speclan-format/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/skills/speclan-format/references/entity-fields.md",
          "type": "blob",
          "size": 9338
        },
        {
          "path": "plugins/speclan/skills/speclan-format/references/writing-guide.md",
          "type": "blob",
          "size": 8864
        },
        {
          "path": "plugins/speclan/skills/speclan-format/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/skills/speclan-format/scripts/detect-speclan.sh",
          "type": "blob",
          "size": 1412
        },
        {
          "path": "plugins/speclan/skills/speclan-id-generator",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/skills/speclan-id-generator/SKILL.md",
          "type": "blob",
          "size": 6945
        },
        {
          "path": "plugins/speclan/skills/speclan-id-generator/scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/skills/speclan-id-generator/scripts/generate-id.sh",
          "type": "blob",
          "size": 6180
        },
        {
          "path": "plugins/speclan/skills/sync-from-session",
          "type": "tree",
          "size": null
        },
        {
          "path": "plugins/speclan/skills/sync-from-session/SKILL.md",
          "type": "blob",
          "size": 10147
        }
      ],
      "marketplace": {
        "name": "digital-dividend-marketplace",
        "version": null,
        "description": null,
        "owner_info": {
          "name": "Thomas Landgraf",
          "email": "tl@digital-dividend.de",
          "url": "https://github.com/digital-dividend"
        },
        "keywords": [],
        "plugins": [
          {
            "name": "speclan",
            "description": "Claude Code helper for SPECLAN - manage project specifications as interlinked markdown files",
            "source": "./plugins/speclan",
            "category": null,
            "version": "0.3.0",
            "author": {
              "name": "Thomas Landgraf",
              "email": "tl@digital-dividend.de"
            },
            "install_commands": [
              "/plugin marketplace add thlandgraf/cc-marketplace",
              "/plugin install speclan@digital-dividend-marketplace"
            ],
            "signals": {
              "stars": 0,
              "forks": 0,
              "pushed_at": "2026-01-11T17:02:04Z",
              "created_at": "2026-01-11T17:00:49Z",
              "license": null
            },
            "commands": [
              {
                "name": "/from-speckit",
                "description": "Convert speckit specifications to SPECLAN format",
                "path": "plugins/speclan/commands/from-speckit.md",
                "frontmatter": {
                  "name": "from-speckit",
                  "description": "Convert speckit specifications to SPECLAN format",
                  "allowed-tools": [
                    "Read",
                    "Write",
                    "Bash",
                    "Glob",
                    "Grep",
                    "Task"
                  ],
                  "argument-hint": "[speckit-directory]"
                },
                "content": "# SPECLAN From-Speckit Command\n\nConvert speckit phase-based specifications to SPECLAN hierarchical format.\n\n## Prerequisites\n\nThis command requires understanding of both formats:\n\n**Speckit Format** (source):\n- Located in `specs/` directory\n- Numbered directories: `###-phase-name/`\n- `spec.md` with bold markdown metadata\n- User stories with priorities (P1-P4)\n- Functional requirements (FR-###)\n- Success criteria (SC-###)\n\n**SPECLAN Format** (target):\n- Located in `speclan/` directory\n- Entity hierarchy: Goal → Feature → Requirement → Scenario → AC → Test\n- YAML frontmatter with proper IDs (G-###, F-####, R-####, etc.)\n\n## Instructions\n\n### 1. Check Plugin Dependency\n\nVerify speckit plugin is installed. If not:\n```\nError: speckit plugin is not installed.\n\nThe /speclan:from-speckit command requires speckit for full functionality.\nInstall speckit plugin to enable this command.\n\nProceeding with manual conversion...\n```\n\n### 2. Locate Speckit Specs\n\nFind speckit specifications:\n- Default: `specs/` in project root\n- Or use provided directory argument\n- Look for numbered directories with `spec.md` files\n\n### 3. Parse Speckit Format\n\nFor each `spec.md` file, extract:\n\n**Metadata:**\n- Feature Branch name\n- Created date\n- Status\n- Input source\n\n**Content:**\n- User stories (with priorities)\n- Functional requirements (FR-###)\n- Success criteria (SC-###)\n- Acceptance scenarios (Given/When/Then)\n- Assumptions and constraints\n\n### 4. Map to SPECLAN Entities\n\nConvert speckit elements to SPECLAN:\n\n| Speckit Element | SPECLAN Entity |\n|-----------------|----------------|\n| Feature Branch | Feature (F-####) |\n| User Story | Feature description / User Story section |\n| Functional Requirement (FR-###) | Requirement (R-####) |\n| Acceptance Scenario | Scenario (S-####) |\n| Success Criterion (SC-###) | AcceptanceCriterion (AC-####) |\n| Priority (P1-P4) | Tags or status |\n\n### 5. Generate SPECLAN Files\n\nFor each speckit spec:\n\n1. Create Feature file:\n   ```yaml\n   ---\n   id: F-XXX\n   type: feature\n   title: [from Feature Branch name]\n   status: draft\n   owner: [from metadata or default]\n   created: [from speckit created date]\n   updated: [current date]\n   goals: []  # To be linked later\n   ---\n   ```\n\n2. Create Requirement files for each FR:\n   ```yaml\n   ---\n   id: R-XXXX\n   type: requirement\n   title: [from FR description]\n   status: draft\n   owner: [inherited]\n   created: [current]\n   updated: [current]\n   feature: F-XXX\n   scenarios: []\n   ---\n   ```\n\n3. Create Scenario files for acceptance scenarios\n\n### 6. Handle Phase Dependencies\n\nSpeckit phases build on each other (001 → 002 → 003...).\n\n- Later phases may update earlier specs\n- Create ChangeRequest entities for modifications\n- Or update existing specs with new requirements\n\n### 7. Preserve Traceability\n\nMaintain links to source speckit files:\n```markdown\n## Source\n\nConverted from speckit specification:\n- **Source:** specs/001-phase1-core-extension/spec.md\n- **Converted:** [date]\n```\n\n### 8. Output Summary\n\n```\n## Conversion Complete\n\nConverted [X] speckit specifications to SPECLAN format.\n\n### Created Entities\n| Type | Count |\n|------|-------|\n| Features | X |\n| Requirements | X |\n| Scenarios | X |\n\n### Files Created\n- speclan/features/F-001-phase1-core-extension/F-001-phase1-core-extension.md\n- speclan/features/F-001-.../requirements/R-0001-slug/R-0001-slug.md\n- ...\n\n### Next Steps\n1. Review converted specifications\n2. Link features to goals\n3. Add missing acceptance criteria\n4. Complete scenario coverage\n```\n\n## Incremental Conversion\n\nIf some specs already converted:\n- Detect existing SPECLAN entities\n- Skip already-converted speckit specs\n- Only convert new or modified specs\n- Update existing specs if speckit changed\n\n## Error Handling\n\nIf speckit directory not found:\n```\nError: No speckit specifications found.\n\nExpected location: specs/\nExpected format: ###-phase-name/spec.md\n\nVerify speckit specs exist before running this command.\n```"
              },
              {
                "name": "/implement",
                "description": "Implement approved SPECLAN Features using feature-dev plugin",
                "path": "plugins/speclan/commands/implement.md",
                "frontmatter": {
                  "name": "speclan:implement",
                  "description": "Implement approved SPECLAN Features using feature-dev plugin",
                  "allowed-tools": [
                    "Read",
                    "Write",
                    "Edit",
                    "Bash",
                    "Glob",
                    "Grep",
                    "Task",
                    "Skill",
                    "TodoWrite",
                    "/feature-dev:feature-dev"
                  ],
                  "argument-hint": "[feature-ids...]"
                },
                "content": "# SPECLAN Implement Command\n\nImplement approved SPECLAN Features using the feature-dev command, then verify all requirements.\n\n## CRITICAL BEHAVIOR RULES\n\n1. **MUST USE /feature-dev:feature-dev** - For EACH feature, invoke the Command /feature-dev:feature-dev IMPORTANT: Do NOT implement features directly without invoking this command.\n\n2. **MUST VERIFY REQUIREMENTS** - After feature-dev completes, verify ALL linked requirements in PARALLEL using Task tool with requirement-verifier agents.\n\n3. **MUST VERIFY FEATURE** - After requirements pass, verify overall feature implementation using feature-verifier agent (5-layer deep verification).\n\n4. **FIX UNTIL ALL PASS** - If any verification fails (requirement OR feature), invoke feature-dev again with fix instructions. Repeat verify-fix cycle until ALL pass. NO LIMIT on retries.\n\n5. **DO NOT STOP between features** - Implement ALL approved features in sequence without pausing. Only stop when ALL features are complete or user intervenes.\n\n6. **Status updates are DEFERRED** - Features go to \"under-test\" only after ALL features complete. Requirements go to \"in-development\" during verification.\n\n## Prerequisites\n\nThis command requires:\n- **feature-dev command** - Must be installed\n\nCheck if feature-dev is available. If not installed, show error and stop.\n\n## Instructions\n\n### 1. Find Approved Features\n\nQuery SPECLAN directory for features with `status: approved`:\n\n```bash\ngrep -r \"^status: approved\" speclan/features/ -l\n```\n\nIf no approved features found, report and exit.\n\n### 2. Determine Implementation Order (USE AGENT)\n\n**MUST use the implementation-order agent** to analyze dependencies and determine optimal order.\n\n**Pass the exact list of approved features found in Step 1:**\n\n```\nTask tool:\n  subagent_type: \"general-purpose\"\n  prompt: \"You are the implementation-order agent.\n\n  Features to order:\n  - F-049-{slug}\n  - F-200-{slug}\n  - F-301-{slug}\n  [list ALL approved feature IDs from Step 1]\n\n  SPECLAN directory: speclan/\n\n  IMPORTANT: Only analyze the features listed above. Do not discover other features.\n\n  For each feature in the list:\n  1. Read its spec file and extract depends-on, parent, goals from YAML\n  2. Check requirement dependencies between features\n  3. Analyze codebase for implicit dependencies\n  4. Build Feature Dependency Graph (DAG)\n  5. Detect circular dependencies\n  6. Perform topological sort (Kahn's algorithm)\n\n  Return ordered list with:\n  - Implementation sequence (first to implement at top)\n  - Dependency graph visualization\n  - Reasoning for each position\n  - Parallel implementation opportunities\"\n```\n\nWait for agent to return the sorted feature list.\n\nDisplay the plan:\n```\n## Implementation Plan\n\n### Dependency Graph\n[from agent output]\n\n| Order | Feature | Title | Dependencies | Requirements |\n|-------|---------|-------|--------------|--------------|\n| 1 | F-XXX | Feature Title | None (root) | R-0001, R-0002 |\n| 2 | F-YYY | Another Feature | F-XXX | R-0003 |\n\nWill invoke /feature-dev:feature-dev for EACH feature in this order, then verify requirements.\n```\n\n### 3. Execute Implementation Loop\n\nInitialize tracking:\n- `completed_features = []`\n- `failed_features = []`\n\n**FOR EACH feature in order:**\n\n#### Step A: Update feature status to in-development\n```yaml\nstatus: in-development\n```\n\n#### Step B: Gather feature context\nRead and collect:\n- The feature specification file\n- All linked requirements\n- Acceptance scenarios\n- Business rules\n\n#### Step C: INVOKE FEATURE-DEV (MANDATORY)\n\n**YOU MUST use the command /feature-dev:feature-dev**\n\n```\nUse Command:\n  command: /feature-dev:feature-dev\n  args: \"Implement feature [F-XXX] [Title]\n\n## Feature Specification\n[paste full feature content]\n\n## Requirements\n[paste all linked requirements]\n\n## Acceptance Criteria\n[paste scenarios and acceptance criteria]\n\"\n```\n\nWait for feature-dev to complete.\n\n#### Step D: VERIFY REQUIREMENTS (PARALLEL)\n\n**After feature-dev completes, verify ALL linked requirements:**\n\n1. **Find all requirements for this feature:**\n   - Check feature's `requirements:` YAML field\n   - OR grep: `grep -r \"^feature: F-XXX\" speclan/`\n\n2. **Set ALL requirements to in-development:**\n   Edit each requirement's YAML:\n   ```yaml\n   status: in-development\n   ```\n\n3. **Launch verification agents IN PARALLEL:**\n   For EACH requirement, use Task tool:\n   ```\n   Task tool:\n     subagent_type: \"general-purpose\"\n     prompt: \"Verify requirement [R-XXXX] is implemented.\n\n     ## Requirement Specification\n     [paste requirement content]\n\n     ## What to verify:\n     1. Check enforcement rules are implemented in code\n     2. Check scenarios have test coverage\n     3. Check business rules are enforced\n\n     Return: VERIFIED or NOT_VERIFIED with gaps list\"\n   ```\n\n4. **Collect results:**\n   - VERIFIED: Keep requirement at `in-development`\n   - NOT_VERIFIED: Note gaps, revert status to previous\n\n#### Step E: FIX LOOP (if any requirement verification failed)\n\n**If ANY requirement NOT_VERIFIED:**\n\n1. Collect all gaps from failed verifications\n2. Invoke /feature-dev:feature-dev AGAIN with fix instructions:\n   ```\n   Command:\n     command: /feature-dev:feature-dev\n     args: \"Fix implementation gaps for [F-XXX]\n\n     ## Verification Failures\n     [list all gaps from failed requirements]\n\n     ## Requirements to fix\n     [paste failed requirement specs]\n\n     Fix these specific issues.\"\n   ```\n\n3. Re-verify ONLY the failed requirements (parallel)\n4. **REPEAT until ALL requirements pass**\n5. No limit on iterations - continue until all pass or user stops. FOR EACH LOOP: Always restart the /feature-dev:feature-dev command from scratch!\n\n#### Step F: VERIFY FEATURE (USE AGENT)\n\n**After ALL requirements pass, verify the overall feature implementation:**\n\nLaunch the feature-verifier agent:\n```\nTask tool:\n  subagent_type: \"general-purpose\"\n  prompt: \"You are the feature-verifier agent.\n\n  Verify feature:\n  - F-XXX-{slug}\n\n  SPECLAN directory: speclan/\n\n  Perform deep verification:\n  1. Build context tree (read parents up to root, feature, sub-artifacts)\n  2. Extract all verification targets from spec\n  3. Verify implementation using 5-layer strategy:\n     - Entity/Model layer\n     - Service/Business Logic layer\n     - API/Controller layer\n     - UI/Frontend layer (if applicable)\n     - Test coverage layer\n  4. Generate verification report with:\n     - Status: VERIFIED / PARTIAL / NOT_VERIFIED\n     - Coverage percentage\n     - Gaps (Critical/Major/Minor)\n     - Evidence with file:line references\n\n  Return: Verification report\"\n```\n\n#### Step F.2: FIX LOOP (if feature verification found issues)\n\n**If feature NOT_VERIFIED or PARTIAL with Critical/Major gaps:**\n\n1. Collect ALL gaps from verification report (Critical and Major)\n2. Invoke /feature-dev:feature-dev AGAIN with fix instructions:\n   ```\n   Command:\n     command: /feature-dev:feature-dev\n     args: \"Fix feature verification gaps for [F-XXX]\n\n     ## Verification Report Summary\n     Status: [PARTIAL/NOT_VERIFIED]\n     Coverage: [X]%\n\n     ## Gaps to Fix\n\n     ### Critical\n     [list critical gaps with file:line evidence]\n\n     ### Major\n     [list major gaps with file:line evidence]\n\n     ## Feature Specification\n     [paste feature spec for context]\n\n     Fix these specific issues to pass verification.\"\n   ```\n\n3. Re-run feature verification (launch feature-verifier agent again)\n4. **REPEAT until feature is VERIFIED or PARTIAL with only Minor gaps**\n5. No limit on iterations - continue until verified or user stops\n\n#### Step G: Record completion\n- Feature verified: Add feature to `completed_features`\n- Cannot complete: Add to `failed_features`\n\n#### Step H: Continue to next feature\n**IMMEDIATELY proceed to next feature without stopping.**\n\n### 4. Batch Status Update (AFTER ALL COMPLETE)\n\n**Only after ALL features processed:**\n\nFor each feature in `completed_features`:\n- Edit YAML: `status: under-test`\n- Update timestamp\n\nNote: Requirements already at `in-development` from verification step.\n\n### 5. Final Summary\n\n```\n## Implementation Complete\n\n### Features (status → under-test)\n| Feature | Requirements Verified |\n|---------|----------------------|\n| F-XXX | 3/3 ✓ |\n| F-YYY | 2/2 ✓ |\n\n### Requirements (status → in-development)\n| Requirement | Feature | Status |\n|-------------|---------|--------|\n| R-0001 | F-XXX | ✓ verified |\n| R-0002 | F-XXX | ✓ verified |\n\n### Failed (if any)\n| Feature | Issue |\n|---------|-------|\n| F-ZZZ | Could not verify R-0005 |\n\n### Next Steps\n1. Run tests\n2. Review changes\n3. Update to 'released' when verified\n```\n\n## Example Execution\n\n```\n> /implement\n\n## Finding Approved Features\nFound 2 approved features with 4 total requirements.\n\n## Analyzing Dependencies\n[Launching implementation-order agent...]\n\n### Dependency Graph\n```mermaid\ngraph TD\n    F-049[F-049: Pet Management] --> F-200[F-200: Pet Health]\n```\n\nF-200 depends on F-049 (explicit: depends-on in YAML)\n\n## Implementation Plan\n| Order | Feature | Dependencies | Requirements |\n|-------|---------|--------------|--------------|\n| 1 | F-049 | None (root) | R-0001, R-0002 |\n| 2 | F-200 | F-049 | R-0003, R-0004 |\n\n---\n\n### Implementing F-049: Pet Management\n\nSetting status: approved → in-development\n\n**Invoking Command /feature-dev:feature-dev **\n[feature-dev implements feature]\n\n**Verifying requirements (parallel)...**\n- R-0001: Setting to in-development...\n- R-0002: Setting to in-development...\n\n[Launching 2 verification agents in parallel]\n\nVerification results:\n- R-0001: ✓ VERIFIED\n- R-0002: ✗ NOT_VERIFIED - missing POS validation\n\n**Fixing gaps...**\n[Invoking feature-dev with fix instructions]\n\n**Re-verifying R-0002...**\n- R-0002: ✓ VERIFIED\n\n**Verifying feature (deep)...**\n[Launching feature-verifier agent]\n\nFeature verification report:\n- Status: ⚠️ PARTIAL\n- Coverage: 75%\n- Gaps: 0 Critical, 1 Major (missing status transition validation)\n\n**Fixing feature gaps...**\n[Invoking feature-dev with gap details]\n\n**Re-verifying feature...**\n[Launching feature-verifier agent]\n\nFeature verification report:\n- Status: ✅ VERIFIED\n- Coverage: 95%\n- Gaps: 0 Critical, 0 Major, 1 Minor (missing API docs)\n\n✓ F-049 complete (requirements + feature verified)\n\n---\n\n### Implementing F-200: Pet Health Management\n\nSetting status: approved → in-development\n\n**Invoking /feature-dev:feature-dev...**\n[feature-dev implements feature]\n\n**Verifying requirements (parallel)...**\n[Launching 2 verification agents]\n\nVerification results:\n- R-0003: ✓ VERIFIED\n- R-0004: ✓ VERIFIED\n\n**Verifying feature (deep)...**\n[Launching feature-verifier agent]\n\nFeature verification report:\n- Status: ✅ VERIFIED\n- Coverage: 100%\n- Gaps: None\n\n✓ F-200 complete (requirements + feature verified)\n\n---\n\n## All Features Processed\n\nUpdating feature statuses to under-test...\n- F-049: ✓ under-test\n- F-200: ✓ under-test\n\n## Summary\n2/2 features implemented.\n4/4 requirements verified and at in-development.\n```\n\n## Key Reminders\n\n1. **Implementation-order agent first** - Use agent to analyze dependencies and determine optimal order (DAG + topological sort)\n2. **Feature-dev for implementation** - Always use Command /feature-dev:feature-dev\n3. **Requirement verification (parallel)** - Launch ALL requirement verifications simultaneously\n4. **Feature verification (deep)** - After requirements pass, verify overall feature with feature-verifier agent\n5. **Fix loop** - Keep fixing and re-verifying until all pass (requirements AND feature)\n6. **No stopping** - Process all features without pause"
              },
              {
                "name": "/status",
                "description": "Check SPECLAN project setup, installed plugins, and specification statistics",
                "path": "plugins/speclan/commands/status.md",
                "frontmatter": {
                  "name": "speclan:status",
                  "description": "Check SPECLAN project setup, installed plugins, and specification statistics",
                  "allowed-tools": [
                    "Read",
                    "Bash",
                    "Glob",
                    "Grep"
                  ],
                  "argument-hint": "[path]"
                },
                "content": "# SPECLAN Status Command\n\nDisplay comprehensive status information about the SPECLAN project.\n\n## Instructions\n\nWhen invoked, perform these checks and display results in table format:\n\n### 1. Detect SPECLAN Directory\n\nSearch for speclan directory starting from provided path or current working directory:\n- Check common locations: `speclan/`, `specs/speclan/`, `.speclan/`\n- Verify characteristic subdirectories: `goals/`, `features/`, `requirements/`\n\nIf not found, display error with setup instructions.\n\n### 2. Check Plugin Dependencies\n\nCheck if optional plugins are installed:\n- **speckit** - Required for `/speclan:from-speckit` and `/speclan:to-speckit`\n- **feature-dev** - Required for `/speclan:implement`\n\nDisplay installation status for each.\n\n### 3. Count Specifications by Type\n\nCount spec files in each category:\n\n| Entity | Directory | Pattern |\n|--------|-----------|---------|\n| Goals | `goals/` | `G-*.md` |\n| Features | `features/` | `F-*.md` (recursive) |\n| Requirements | `requirements/` or within features | `R-*.md` |\n| Scenarios | within requirements | `S-*.md` |\n| Acceptance Criteria | within scenarios | `AC-*.md` |\n| Tests | within criteria | `T-*.md` |\n| Templates | `templates/` | `*.md` |\n\n### 4. Analyze Status Distribution\n\nParse YAML frontmatter to count specs by status:\n- draft\n- review\n- approved\n- in-development\n- under-test\n- released\n- deprecated\n\n### 5. Check Coverage\n\nCalculate coverage metrics:\n- Features with at least one requirement\n- Requirements with at least one scenario\n- Approved features ready for implementation\n\n### 6. Display Results\n\nPresent as formatted tables:\n\n```\n## SPECLAN Project Status\n\n**Directory:** /path/to/speclan\n\n### Specification Counts\n| Entity | Count |\n|--------|-------|\n| Goals | X |\n| Features | X |\n| ... | ... |\n\n### Status Distribution\n| Status | Count |\n|--------|-------|\n| approved | X |\n| draft | X |\n| ... | ... |\n\n### Plugin Dependencies\n| Plugin | Status | Required For |\n|--------|--------|--------------|\n| speckit | Installed/Missing | from-speckit, to-speckit |\n| feature-dev | Installed/Missing | implement |\n\n### Coverage\n| Metric | Value |\n|--------|-------|\n| Features with requirements | X% |\n| Requirements with scenarios | X% |\n| Approved features | X |\n```\n\n## Error Handling\n\nIf SPECLAN directory not found:\n```\nError: No SPECLAN directory found in this project.\n\nTo set up SPECLAN, create:\n  speclan/\n  ├── goals/\n  ├── features/\n  └── requirements/\n```\n\nIf plugin missing and user tries dependent command, show:\n```\nError: [plugin] plugin is not installed.\n\nInstall with: [installation instructions]\n```"
              },
              {
                "name": "/sync-from-session",
                "description": "Sync SPECLAN specs from session work - identifies implemented features and updates specs",
                "path": "plugins/speclan/commands/sync-from-session.md",
                "frontmatter": {
                  "name": "speclan:sync",
                  "description": "Sync SPECLAN specs from session work - identifies implemented features and updates specs",
                  "allowed-tools": [
                    "Read",
                    "Write",
                    "Edit",
                    "Bash",
                    "Glob",
                    "Grep",
                    "AskUserQuestion",
                    "TodoWrite"
                  ],
                  "argument-hint": "[--dry-run] [hints...]"
                },
                "content": "# SPECLAN Sync from Session\n\nAnalyze the current session to identify implemented features and sync them to SPECLAN specifications.\n\n## Instructions\n\n### 1. Parse Arguments\n\n**Flags:**\n- `--dry-run` - Show what would be created/updated without making changes\n\n**User Hints (optional free-form text):**\nAfter flags, the user may provide guidance to help focus the analysis:\n\n```\n/speclan:sync focus on the auth changes, don't miss the token refresh logic\n/speclan:sync --dry-run look at src/api/ folder, we added new endpoints\n/speclan:sync important: the rate limiting feature, also check the middleware\n```\n\n**Hint Categories:**\n| Hint Type | Keywords | Purpose |\n|-----------|----------|---------|\n| Focus areas | \"focus on\", \"look at\", \"check\" | Direct attention to specific code/features |\n| Must-include | \"don't miss\", \"important\", \"make sure\" | Ensure specific items are captured |\n| Exclusions | \"ignore\", \"skip\", \"not relevant\" | Avoid false positives |\n| Context | \"we added\", \"new feature\", \"bugfix for\" | Clarify intent of changes |\n\n### 2. Process User Hints\n\nIf hints provided, extract and categorize:\n\n```yaml\nuser_guidance:\n  focus_areas:\n    - \"auth changes\"\n    - \"src/api/ folder\"\n  must_include:\n    - \"token refresh logic\"\n    - \"rate limiting feature\"\n  exclusions: []\n  context:\n    - \"new endpoints added\"\n    - \"middleware changes\"\n```\n\nUse this guidance to:\n1. **Prioritize** - Analyze focus areas first and more thoroughly\n2. **Validate** - Cross-check must-include items are captured in results\n3. **Filter** - Skip excluded areas during analysis\n4. **Interpret** - Use context to better understand change intent\n\n### 3. Load Skill Knowledge\n\nApply the `Sync Specs from Session` skill for detailed workflow guidance.\n\n### 3. Analyze Session Context\n\nReview the conversation history to identify implementation work:\n\n#### 3.1 Scan for Code Changes\n\nLook for evidence of implementation:\n- **File writes/edits**: Write and Edit tool usage\n- **New functions/classes**: Code patterns added\n- **API endpoints**: Routes, handlers, controllers\n- **Data models**: Schema changes, type definitions\n- **Tests added**: Test files created or modified\n\n#### 3.2 Extract Feature Candidates\n\nFor each identified change, determine:\n- **Title**: Descriptive name for the feature\n- **Description**: What it does and why\n- **Code paths**: Files involved\n- **Type**: new feature, enhancement, or bugfix\n\n#### 3.3 Group Related Changes\n\nConsolidate related changes:\n- Multiple files for one feature = single feature entry\n- Independent changes = separate feature entries\n\n### 4. Detect Speclan Directory\n\n```bash\n# Find speclan directory\nif [ -d \"speclan/features\" ]; then\n  echo \"Found: speclan/\"\nelif [ -d \"specs/speclan/features\" ]; then\n  echo \"Found: specs/speclan/\"\nelse\n  echo \"No speclan directory found\"\nfi\n```\n\nIf no speclan directory exists, ask user if they want to initialize one.\n\n### 5. Index Existing Specs\n\nIf speclan exists, build an index of current specs:\n\n```bash\n# List features with status\nfor f in $(find speclan/features -name \"F-*.md\" -type f 2>/dev/null); do\n  id=$(grep \"^id:\" \"$f\" | head -1 | sed 's/id: *//')\n  title=$(grep \"^title:\" \"$f\" | head -1 | sed 's/title: *//')\n  status=$(grep \"^status:\" \"$f\" | head -1 | sed 's/status: *//')\n  echo \"$id|$title|$status|$f\"\ndone\n```\n\n### 6. Compare and Classify Changes\n\nFor each feature candidate from session analysis:\n\n| Match Result | Classification | Action |\n|--------------|----------------|--------|\n| No match in speclan | CREATE | New feature spec |\n| Matches existing, status editable | UPDATE | Modify existing spec |\n| Matches existing, status locked | CHANGE_REQUEST | Create CR |\n| Small enhancement to existing | ADD_REQUIREMENT | New requirement |\n\n**Editable statuses:** draft, review, approved\n**Locked statuses:** in-development, under-test, released, deprecated\n\n### 7. Present Changes to User\n\nShow identified changes and ask for confirmation:\n\n```markdown\n## Session Analysis Results\n\nBased on this session, I identified:\n\n### New Features (CREATE)\n1. **[Title]** - [Description]\n\n### Updates to Existing Features (UPDATE)\n1. **[F-####] [Title]** - [What changed]\n   - Status: [status] (editable)\n\n### Change Requests Needed (LOCKED)\n1. **[F-####] [Title]** - Cannot edit directly\n   - Status: [status] (locked)\n   - Proposed change: [description]\n\n### New Requirements\n1. For **[F-####]**: [Requirement title]\n```\n\nUse AskUserQuestion:\n\n```yaml\nquestions:\n  - question: \"Which changes should I apply to SPECLAN specs?\"\n    header: \"Apply\"\n    multiSelect: true\n    options:\n      - label: \"Create: [Feature Title]\"\n        description: \"New feature spec\"\n      - label: \"Update: F-#### [Title]\"\n        description: \"Add [change] to existing feature\"\n      # ... additional options\n```\n\n### 8. Handle Dry Run\n\nIf `--dry-run` flag provided:\n- Show all changes that would be made\n- Do NOT write any files\n- Report: \"Dry run complete. No changes made.\"\n\n### 9. Apply Selected Changes\n\nFor each user-selected change:\n\n#### 9.1 Create New Features\n\n1. Generate feature ID:\n   ```bash\n   # Use ID generator skill\n   FEATURE_ID=$(\"${PLUGIN_ROOT}/skills/speclan-id-generator/scripts/generate-id.sh\" feature speclan)\n   ```\n\n2. Create directory and file:\n   ```bash\n   SLUG=$(echo \"[title]\" | tr '[:upper:]' '[:lower:]' | tr ' ' '-' | tr -cd 'a-z0-9-')\n   mkdir -p \"speclan/features/${FEATURE_ID}-${SLUG}/requirements\"\n   ```\n\n3. Write feature spec with frontmatter:\n   ```yaml\n   ---\n   id: [FEATURE_ID]\n   type: feature\n   title: [Title]\n   status: under-test\n   owner: Developer\n   created: \"[ISO-8601]\"\n   updated: \"[ISO-8601]\"\n   goals: []\n   ---\n\n   # [Title]\n\n   ## Overview\n   [Description - focus on WHAT and WHY, not HOW]\n\n   ## Scope\n   - [User-facing functionality points]\n   ```\n\n**IMPORTANT:** Specs must be implementation-agnostic. Do NOT include:\n- Code paths, file names, or technical locations\n- Implementation details or internal architecture\n- Code fragments or snippets\n\nFocus on WHAT the feature does for users, not HOW it's built.\n\n#### 9.2 Update Existing Features\n\n1. Read current feature file\n2. Update relevant sections (scope, implementation notes)\n3. Update `updated` timestamp\n4. Write file back\n\n#### 9.3 Create Change Requests\n\nFor locked features or requirements:\n\n1. Generate CR ID:\n   ```bash\n   CR_ID=$(\"${PLUGIN_ROOT}/skills/speclan-id-generator/scripts/generate-id.sh\" change-request speclan)\n   ```\n\n2. Create CR in entity's change-requests directory:\n   ```bash\n   # For features:\n   mkdir -p \"speclan/features/[feature-dir]/change-requests\"\n\n   # For requirements:\n   mkdir -p \"speclan/features/.../requirements/[requirement-dir]/change-requests\"\n   ```\n\n3. Write CR file with proper frontmatter (parentType: feature or requirement)\n\n#### 9.4 Create New Requirements\n\n1. Generate requirement ID\n2. Create requirement directory:\n   ```bash\n   mkdir -p \"speclan/features/[feature-dir]/requirements/R-####-slug\"\n   ```\n3. Write requirement file to directory:\n   ```\n   speclan/features/[feature-dir]/requirements/R-####-slug/R-####-slug.md\n   ```\n4. Update parent feature's `updated` timestamp\n\n### 10. Report Results\n\n```markdown\n## Sync Complete\n\n### Created\n- F-#### [Title] → speclan/features/F-####-slug/\n- R-#### [Title] → speclan/features/F-####/requirements/R-####-slug/\n\n### Updated\n- F-#### [Title] - added [changes]\n\n### Change Requests\n- CR-#### for F-#### → speclan/features/F-####/change-requests/\n- CR-#### for R-#### → speclan/.../requirements/R-####/change-requests/\n\n### Skipped\n- [Any items user didn't select]\n\n### Next Steps\n- Review created specs for accuracy\n- Assign goals to new features\n- Process pending change requests\n- Run /speclan:status to verify structure\n```\n\n## Examples\n\n```bash\n# Sync session work to specs\n/speclan:sync\n\n# Preview without making changes\n/speclan:sync --dry-run\n```"
              },
              {
                "name": "/to-speckit",
                "description": "Inject approved SPECLAN Features into speckit for specification processing",
                "path": "plugins/speclan/commands/to-speckit.md",
                "frontmatter": {
                  "name": "speclan:to-speckit",
                  "description": "Inject approved SPECLAN Features into speckit for specification processing",
                  "allowed-tools": [
                    "Read",
                    "Write",
                    "Bash",
                    "Glob",
                    "Grep",
                    "Skill"
                  ],
                  "argument-hint": "[feature-ids...]"
                },
                "content": "# SPECLAN To-Speckit Command\n\nInject approved SPECLAN Features into speckit commands for specification processing.\n\n## Prerequisites\n\nThis command requires:\n- **speckit plugin** - Must be installed for `/speckit.specify` command\n\n## Instructions\n\n### 1. Check Plugin Dependency\n\nVerify speckit plugin is installed:\n\n```bash\n# Check if speckit commands are available\n```\n\nIf not installed:\n```\nError: speckit plugin is not installed.\n\nThe /speclan:to-speckit command requires speckit to be installed.\n\nInstall speckit plugin:\n  [installation instructions]\n\nThis command injects SPECLAN specifications into speckit's /speckit.specify command.\n```\n\n### 2. Find Approved Features\n\nQuery SPECLAN directory for features with `status: approved`:\n\n```bash\n# Search for approved features in YAML frontmatter\ngrep -r \"^status: approved\" speclan/features/ -l\n```\n\nIf no approved features found:\n```\nNo approved features found.\n\nTo approve a feature for specification:\n1. Edit the feature file\n2. Change status from 'draft' to 'approved'\n3. Run /speclan:to-speckit again\n\nCurrent feature statuses:\n| Feature | Status |\n|---------|--------|\n| F-001 | draft |\n| F-002 | review |\n| ... | ... |\n```\n\n### 3. Collect Feature Content\n\nFor each approved feature, gather:\n- Feature description and user stories\n- All linked requirements\n- Scenarios and acceptance criteria\n- Business rules\n\n### 4. Generate Concatenated Specification\n\nCreate a combined specification document:\n\n```markdown\n# Specification Package for Speckit\n\nGenerated: [timestamp]\nSource: SPECLAN specifications\n\n---\n\n## Feature: [F-XXX] [Title]\n\n[Full feature content]\n\n### Requirements\n\n#### [R-XXXX] [Title]\n\n[Requirement content with scenarios]\n\n---\n\n## Feature: [F-YYY] [Title]\n\n[Next feature...]\n```\n\n### 5. Invoke Speckit\n\n**Note:** This integration is TBD pending speckit API clarification.\n\nCurrent approach:\n1. Write concatenated spec to temporary file\n2. Invoke `/speckit.specify` with the file\n3. Or display spec for manual processing\n\n```\nPrepared specification package with [X] approved features.\n\n## Included Features\n- F-001: [Title]\n- F-002: [Title]\n\n## Specification Package\n[Path to generated file]\n\nTo process with speckit:\n  /speckit.specify [path-to-spec-package]\n```\n\n### 6. Handle Partial Selection\n\nIf user provides specific feature IDs:\n- Only include specified features\n- Verify each is approved (warn if not)\n- Allow override with confirmation\n\n```\n/speclan:to-speckit F-001 F-003\n\nIncluding specified features:\n- F-001: approved ✓\n- F-003: draft ⚠ (not approved)\n\nProceed with F-003 despite draft status? [y/N]\n```\n\n## Output Format\n\n### Success\n```\n## Speckit Injection Ready\n\n### Approved Features Included\n| ID | Title | Requirements |\n|----|-------|--------------|\n| F-001 | Core Extension | 5 |\n| F-002 | Live Updates | 3 |\n\n### Generated Package\nLocation: /tmp/speclan-to-speckit-[timestamp].md\nSize: [X] KB\nTotal Requirements: [Y]\nTotal Scenarios: [Z]\n\n### Next Step\nRun: /speckit.specify /tmp/speclan-to-speckit-[timestamp].md\n```\n\n### No Features Ready\n```\nNo features ready for speckit processing.\n\nFeature Status Summary:\n| Status | Count |\n|--------|-------|\n| draft | 5 |\n| review | 2 |\n| approved | 0 |\n\nApprove features by updating their status to 'approved' in YAML frontmatter.\n```\n\n## Integration Notes\n\n**TBD:** The exact integration with speckit is pending clarification:\n- How `/speckit.specify` accepts input\n- Required format for specification injection\n- Expected output from speckit processing\n\nFor now, this command prepares specifications in a format suitable for manual speckit processing."
              }
            ],
            "skills": [
              {
                "name": "SPECLAN Format",
                "description": "This skill should be used when the user works with SPECLAN specification files or performs CRUD operations on specs.\n**Read operations:** \"read feature\", \"list requirements\", \"show goals\", \"view change-request\", \"get subfeature\", \"find spec\", \"search requirements\", \"display scenarios\"\n**Create operations:** \"create feature\", \"new requirement\", \"add goal\", \"write change-request\", \"add scenario\", \"new spec\", \"create specification\"\n**Update operations:** \"update feature\", \"modify requirement\", \"edit goal\", \"change specification\", \"update spec status\", \"revise requirement\"\n**Delete operations:** \"delete change-request\", \"remove requirement\", \"deprecate feature\"\nAlso triggers on: \"speclan directory\", \"YAML frontmatter for specs\", \"spec hierarchy\", \"entity validation\", \"spec structure\", \"ID format\", \"parent-child relationship\", \"status lifecycle\", or needs guidance on SPECLAN file format, entity types (Goal, Feature, Requirement, Scenario, ChangeRequest, AcceptanceCriterion, Test), ID conventions (G-###, F-####, R-####, CR-####, S-####), validation rules, or specification writing best practices.",
                "path": "plugins/speclan/skills/speclan-format/SKILL.md",
                "frontmatter": {
                  "name": "SPECLAN Format",
                  "description": "This skill should be used when the user works with SPECLAN specification files or performs CRUD operations on specs.\n**Read operations:** \"read feature\", \"list requirements\", \"show goals\", \"view change-request\", \"get subfeature\", \"find spec\", \"search requirements\", \"display scenarios\"\n**Create operations:** \"create feature\", \"new requirement\", \"add goal\", \"write change-request\", \"add scenario\", \"new spec\", \"create specification\"\n**Update operations:** \"update feature\", \"modify requirement\", \"edit goal\", \"change specification\", \"update spec status\", \"revise requirement\"\n**Delete operations:** \"delete change-request\", \"remove requirement\", \"deprecate feature\"\nAlso triggers on: \"speclan directory\", \"YAML frontmatter for specs\", \"spec hierarchy\", \"entity validation\", \"spec structure\", \"ID format\", \"parent-child relationship\", \"status lifecycle\", or needs guidance on SPECLAN file format, entity types (Goal, Feature, Requirement, Scenario, ChangeRequest, AcceptanceCriterion, Test), ID conventions (G-###, F-####, R-####, CR-####, S-####), validation rules, or specification writing best practices.",
                  "version": "0.1.0"
                },
                "content": "# SPECLAN Format Knowledge\n\nSPECLAN (Specification as a Living Language) manages project specifications as interlinked markdown files with YAML frontmatter in a hierarchical directory structure.\n\n## Directory Structure\n\nSPECLAN specifications live in `${PROJECT}/speclan/`:\n\n```\nspeclan/\n├── goals/                    # G-### Business goals (flat)\n├── features/                 # F-#### Feature hierarchy\n│   └── F-1049-pet-management/\n│       ├── F-1049-pet-management.md      # Feature file matches directory\n│       ├── requirements/                  # Requirements as directories\n│       │   ├── R-2046-health-check/\n│       │   │   ├── R-2046-health-check.md\n│       │   │   ├── change-requests/       # CRs for this requirement\n│       │   │   └── scenarios/             # Scenarios for this requirement\n│       │   └── R-3272-status-tracking/\n│       │       └── R-3272-status-tracking.md\n│       ├── change-requests/               # CRs for this feature\n│       │   └── CR-0731-add-feature.md\n│       └── F-1200-pet-health/             # Child feature (nested)\n│           └── F-1200-pet-health.md\n├── templates/                # Templates (UUID in frontmatter, slug filename)\n│   ├── features/\n│   ├── requirements/\n│   ├── scenarios/\n│   ├── acceptance-criteria/\n│   └── tests/\n└── change-requests/          # Root-level change requests\n```\n\n**Key structural rules:**\n- **Features and Requirements use directory-based storage** - directory name must match contained markdown filename\n- Requirements are nested inside their parent feature's `requirements/` directory as subdirectories\n- Child features are subdirectories of parent features\n- Change requests live in `change-requests/` adjacent to the entity they modify (features OR requirements)\n\n## Entity Hierarchy\n\n```\nGoal (G-###)\n  └── Feature (F-####)  [forms hierarchical tree via directories]\n        └── Requirement (R-####)\n              └── Scenario (S-####)\n                    └── AcceptanceCriterion (AC-####)\n                          └── Test (T-####)\n```\n\nAdditional entities:\n- **Template** (UUID v4) - Reusable spec templates\n- **ChangeRequest** (CR-####) - Modifications to released entities\n\n## ID Format Conventions\n\n| Entity | Format | Example | Storage Location |\n|--------|--------|---------|------------------|\n| Goal | `G-###` | G-292 | `goals/` (flat files) |\n| Feature | `F-####` | F-1049 | `features/` (hierarchical directories) |\n| Requirement | `R-####` | R-2046 | `features/{feature}/requirements/` (directories) |\n| Scenario | `S-####` | S-0001 | `requirements/{requirement}/scenarios/` (directories) |\n| AcceptanceCriterion | `AC-####` | AC-0001 | *Not yet implemented* |\n| Test | `T-####` | T-0001 | *Not yet implemented* |\n| ChangeRequest | `CR-####` | CR-0731 | `{entity}/change-requests/` (flat files) |\n| Template | UUID v4 | bf5cb38b-... | `templates/{type}/` (flat files) |\n\n**ID Generation:** All numeric IDs are **randomly generated** with collision detection (not sequential). Always check existing IDs before creating new ones.\n\n**ID-Based Ordering:** IDs determine artifact priority/order numerically:\n- **Lower IDs = Higher priority** (processed/displayed first)\n- **Higher IDs = Lower priority** (processed/displayed later)\n- Example: F-1049 has higher priority than F-2847\n- This ordering applies within the same entity type (features sorted among features, requirements among requirements, etc.)\n\n## File Naming Convention\n\nFiles follow pattern: `<ID>-kebab-case-title.md`\n\nExamples:\n- `G-292-comprehensive-pet-retail-operations.md` (flat file in goals/)\n- `F-1049-pet-management/F-1049-pet-management.md` (directory-based)\n- `R-2046-health-check/R-2046-health-check.md` (directory-based)\n\n**Directory-based entities** (Features, Requirements, Scenarios):\n- Directory name **must match** the contained markdown filename\n- Example: `F-1049-pet-management/F-1049-pet-management.md`\n- Example: `R-2046-health-check/R-2046-health-check.md`\n\nTemplate filenames use **kebab-case slugs** (UUID stored in frontmatter only):\n- `basic-feature.md`\n- `functional-requirement.md`\n\n## Markdown File Format\n\nEvery spec file has YAML frontmatter followed by markdown content:\n\n```markdown\n---\nid: F-1049\ntype: feature\ntitle: Pet Management\nstatus: draft\nowner: Store Manager\ncreated: \"2025-12-29T09:53:49.355Z\"\nupdated: \"2025-12-29T10:31:04.445Z\"\ngoals:\n  - G-292\n  - G-087\n---\n\n# Pet Management\n\n## Overview\nBrief description of what this feature does and why it exists.\n\n## User Story\nAs a **Store Manager**, I want **comprehensive tools** so that **I can track pets**.\n\n## Scope\n- Pet Tracking\n- Status Management\n- Health Records\n```\n\n## Common YAML Frontmatter Fields\n\n**All entities share:**\n```yaml\nid: <entity-id>           # Required\ntype: <entity-type>       # Required: goal|feature|requirement|scenario|acceptanceCriterion|test|template|changeRequest\ntitle: <string>           # Required\nstatus: <status>          # Required: draft|review|approved|in-development|under-test|released|deprecated\nowner: <string>           # Required\ncreated: <ISO-8601>       # Required\nupdated: <ISO-8601>       # Required\ntags: [<string>, ...]     # Optional\n```\n\n**Entity-specific fields** - See `references/entity-fields.md` for complete reference.\n\n## Status Lifecycle\n\nEntities follow a 7-stage lifecycle:\n\n```\ndraft → review → approved → in-development → under-test → released → deprecated\n```\n\n| Status | Editable | Description |\n|--------|----------|-------------|\n| `draft` | Yes | Initial creation, work in progress |\n| `review` | Yes | Ready for review |\n| `approved` | Yes | Approved, ready for development |\n| `in-development` | **No** | Currently being implemented |\n| `under-test` | **No** | Implementation complete, testing |\n| `released` | **No** | Deployed to production |\n| `deprecated` | **No** | No longer active (terminal state) |\n\n**Read-only statuses:** Entities in `in-development`, `under-test`, `released`, or `deprecated` are locked. Direct edits are not allowed - changes require a **Change Request** (`CR-####`).\n\n## Validation Rules\n\nWhen creating or updating SPECLAN entities, enforce these validation rules to ensure structure compliance.\n\n### Required YAML Frontmatter Fields\n\nAll entities MUST have these fields present and non-empty:\n\n| Field | Validation |\n|-------|------------|\n| `id` | Must match entity-specific ID format (see below) |\n| `type` | Must be one of: `goal`, `feature`, `requirement`, `scenario`, `acceptanceCriterion`, `test`, `template`, `changeRequest` |\n| `title` | Non-empty string |\n| `status` | Must be valid status value for entity type |\n| `owner` | Non-empty string (role, person, or team) |\n| `created` | Valid ISO-8601 timestamp |\n| `updated` | Valid ISO-8601 timestamp, must be >= `created` |\n\n### ID Format Validation\n\nEach entity type has a strict ID format:\n\n| Entity | Regex Pattern | Valid Examples | Invalid Examples |\n|--------|---------------|----------------|------------------|\n| Goal | `^G-\\d{3}$` | G-142, G-999 | G-42, G-1234, G-ABC |\n| Feature | `^F-\\d{4}$` | F-1049, F-9999 | F-049, F-12345, f-1234 |\n| Requirement | `^R-\\d{4}$` | R-2046, R-1000 | R-046, R-99999 |\n| Scenario | `^S-\\d{4}$` | S-0001, S-5432 | S-1, S-12345 |\n| AcceptanceCriterion | `^AC-\\d{4}$` | AC-0001, AC-9999 | AC-1, ac-0001 |\n| Test | `^T-\\d{4}$` | T-0001, T-1234 | T-1, T-12345 |\n| ChangeRequest | `^CR-\\d{4}$` | CR-0731, CR-9999 | CR-01, CR-12345 |\n| Template | UUID v4 | `bf5cb38b-7417-...` | Any non-UUID |\n\n**Validation regex (JavaScript):**\n```javascript\nconst ID_PATTERNS = {\n  goal: /^G-\\d{3}$/,\n  feature: /^F-\\d{4}$/,\n  requirement: /^R-\\d{4}$/,\n  scenario: /^S-\\d{4}$/,\n  acceptanceCriterion: /^AC-\\d{4}$/,\n  test: /^T-\\d{4}$/,\n  changeRequest: /^CR-\\d{4}$/,\n  template: /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i\n};\n```\n\n### Directory and File Naming Enforcement\n\n**Directory-based entities** (Feature, Requirement, Scenario):\n\n1. Directory name MUST match the markdown filename inside\n2. Format: `<ID>-<kebab-case-title>/`\n3. Contained file: `<ID>-<kebab-case-title>.md`\n\n**Validation rules:**\n```\n# Valid\nF-1049-pet-management/F-1049-pet-management.md    ✓\nR-2046-health-check/R-2046-health-check.md        ✓\n\n# Invalid\nF-1049-pet-management/F-1049.md                   ✗ (filename mismatch)\nF-1049/F-1049-pet-management.md                   ✗ (directory name incomplete)\nf-1049-pet-management/F-1049-pet-management.md    ✗ (case mismatch)\n```\n\n**Flat-file entities** (Goal, ChangeRequest):\n\n1. File format: `<ID>-<kebab-case-title>.md`\n2. Placed directly in parent directory (no subdirectory)\n\n### Parent-Child Relationship Validation\n\nEntities must correctly reference their parents:\n\n| Entity | Required Parent Field | Parent Type | Validation |\n|--------|----------------------|-------------|------------|\n| Feature | `goals` (array) | Goal | Each ID must exist as `G-###` in `speclan/goals/` |\n| Requirement | `feature` (string) | Feature | Must be valid `F-####` that exists |\n| Scenario | `requirement` (string) | Requirement | Must be valid `R-####` that exists |\n| AcceptanceCriterion | `scenario` (string) | Scenario | Must be valid `S-####` that exists |\n| Test | `criterion` (string) | AcceptanceCriterion | Must be valid `AC-####` that exists |\n| ChangeRequest | `parentId` + `parentType` | Feature/Requirement | Parent must exist and parentType must match |\n\n**Directory placement validation:**\n- Requirements MUST be in `features/<parent-feature>/requirements/`\n- Scenarios MUST be in `requirements/<parent-requirement>/scenarios/`\n- Child features MUST be in `features/<parent-feature>/`\n- ChangeRequests MUST be in `<parent-entity>/change-requests/`\n\n### Status Lifecycle Rules\n\n#### Valid Status Values\n\n**Standard entities** (Goal, Feature, Requirement, Scenario, AC, Test):\n```\ndraft | review | approved | in-development | under-test | released | deprecated\n```\n\n**ChangeRequest entities:**\n```\npending | draft | review | approved | in-development | under-test | merged | closed\n```\n\n#### Editability Rules\n\n| Status | Direct Edit Allowed | Change Request Required |\n|--------|--------------------|-----------------------|\n| `draft` | Yes | No |\n| `review` | Yes | No |\n| `approved` | Yes | No |\n| `in-development` | **No** | **Yes** |\n| `under-test` | **No** | **Yes** |\n| `released` | **No** | **Yes** |\n| `deprecated` | **No** | **Yes** |\n\n**CRITICAL:** Before modifying any entity, check its status:\n\n```bash\n# Extract status from frontmatter\nstatus=$(grep \"^status:\" \"$file\" | head -1 | cut -d: -f2 | tr -d ' ')\n\n# Check if read-only\ncase \"$status\" in\n  in-development|under-test|released|deprecated)\n    echo \"Entity is read-only. Change Request required.\"\n    ;;\n  *)\n    echo \"Entity is editable.\"\n    ;;\nesac\n```\n\n#### When Change Requests Are Required\n\nA ChangeRequest (`CR-####`) MUST be created when:\n\n1. **Entity is in read-only status** (`in-development`, `under-test`, `released`, `deprecated`)\n2. **Proposing breaking changes** to any entity regardless of status\n3. **Deprecating an entity** (status change to `deprecated`)\n4. **Requesting feature removal** or significant scope reduction\n\n**ChangeRequest workflow:**\n```\n1. Create CR in <entity>/change-requests/\n2. CR status: pending → draft → review → approved → in-development → merged\n3. When merged, apply changes to parent entity\n4. Update parent entity's `updated` timestamp\n```\n\n### Status Transition Rules\n\nValid status transitions (forward progression):\n\n```\ndraft → review → approved → in-development → under-test → released → deprecated\n```\n\n**Special transitions:**\n- `review → draft` (rejection/revision)\n- `approved → draft` (re-planning)\n- Any status → `deprecated` (via Change Request if read-only)\n\n**Invalid transitions:**\n- `released → in-development` (regression - use Change Request instead)\n- `deprecated → any` (terminal state)\n\n### Entity-Specific Field Validation\n\n#### Goal (`G-###`)\n\n| Field | Required | Validation |\n|-------|----------|------------|\n| `contributors` | No | Array of valid `F-####` IDs |\n| `metrics` | No | Array of `{name, target, unit}` objects |\n\n#### Feature (`F-####`)\n\n| Field | Required | Validation |\n|-------|----------|------------|\n| `goals` | Yes | Non-empty array of valid `G-###` IDs |\n| `requirements` | No | Array of valid `R-####` IDs |\n| `bundlePath` | No | Valid relative path string |\n\n#### Requirement (`R-####`)\n\n| Field | Required | Validation |\n|-------|----------|------------|\n| `feature` | Yes | Valid `F-####` ID that exists |\n| `scenarios` | Yes | Non-empty array of valid `S-####` IDs |\n\n#### ChangeRequest (`CR-####`)\n\n| Field | Required | Validation |\n|-------|----------|------------|\n| `parentId` | Yes | Valid entity ID (F-####, R-####, etc.) |\n| `parentType` | Yes | `feature`, `requirement`, `scenario`, etc. |\n| `changeType` | Yes | `enhancement`, `bugfix`, `breaking`, `deprecation`, `documentation` |\n| `description` | Yes | Non-empty string |\n| `changes` | Yes | Non-empty string (detailed narrative) |\n\n### Validation Checklist\n\nBefore creating/updating any SPECLAN entity, verify:\n\n- [ ] ID format matches entity type regex\n- [ ] All required fields present and non-empty\n- [ ] `type` field matches expected entity type\n- [ ] `status` is valid for entity type\n- [ ] Parent references (if any) point to existing entities\n- [ ] File/directory naming matches convention\n- [ ] File placed in correct directory location\n- [ ] If entity is read-only, Change Request exists\n- [ ] `updated` timestamp is current ISO-8601\n- [ ] Bidirectional links maintained (e.g., feature lists requirement, requirement references feature)\n\n## Linking Between Specs\n\n### YAML Frontmatter References\n\n```yaml\n# Goal references features\ncontributors:\n  - F-1049\n  - F-2247\n\n# Feature references goals\ngoals:\n  - G-292\n  - G-087\n\n# Requirement references parent feature\nfeature: F-1009\n\n# Requirement references scenarios\nscenarios:\n  - S-0001\n  - S-0002\n```\n\n### Markdown Cross-References\n\nUse relative paths in markdown content:\n\n```markdown\n## Related\n### Goals\n- [Animal Welfare Compliance](../goals/G-087-animal-welfare-compliance.md)\n\n### Features\n- [Pet Status Lifecycle](../F-1807-pet-status-lifecycle/F-1807-pet-status-lifecycle.md)\n```\n\n## Working with SPECLAN Files\n\n### Detecting SPECLAN Directory\n\nTo find the speclan directory in a project:\n\n1. Check common locations: `speclan/`, `specs/speclan/`\n2. Look for characteristic subdirectories: `goals/`, `features/`, `requirements/`\n3. Verify markdown files with SPECLAN YAML frontmatter\n\n### Reading Specifications\n\nWhen reading a spec file:\n1. Parse YAML frontmatter for metadata\n2. Extract entity relationships from frontmatter fields\n3. Parse markdown content for documentation\n\n### Creating New Specifications\n\nTo create a new spec:\n\n1. **Check for user templates FIRST:**\n   ```\n   speclan/templates/<entity-type>/\n   ```\n   - `speclan/templates/features/` for feature templates\n   - `speclan/templates/requirements/` for requirement templates\n   - `speclan/templates/scenarios/` for scenario templates\n\n   Read available templates and choose the best fit. Templates contain the user's preferred structure.\n\n2. **Generate a unique ID:**\n   - IDs are **randomly generated** (not sequential)\n   - Goals: 3-digit (e.g., G-249)\n   - Features/Requirements/Scenarios/etc.: 4-digit (e.g., F-1049, R-2046)\n   - **Always check for collisions** before using:\n     ```bash\n     # Check existing Feature IDs\n     find speclan/features -type d -name 'F-*' | grep -oE 'F-[0-9]+' | sort -u\n     # Check existing Requirement IDs\n     find speclan/features -type d -name 'R-*' | grep -oE 'R-[0-9]+' | sort -u\n     ```\n\n3. **Create file in correct location:**\n\n   **For Goals:** `speclan/goals/G-###-slug.md` (flat file)\n\n   **For Features:** Create directory AND file with matching name:\n   ```\n   speclan/features/F-####-slug/F-####-slug.md\n   ```\n\n   **For Requirements:** Create directory inside parent feature's `requirements/`:\n   ```\n   speclan/features/F-####-parent/requirements/R-####-slug/R-####-slug.md\n   ```\n\n   **For Child Features:** Nest inside parent feature directory:\n   ```\n   speclan/features/F-####-parent/F-####-child/F-####-child.md\n   ```\n\n   **For Scenarios:** Nest inside parent requirement directory:\n   ```\n   speclan/features/.../requirements/R-####-parent/scenarios/S-####-slug/S-####-slug.md\n   ```\n\n4. **Write frontmatter and content:**\n   - Use template if found, otherwise use default structure\n   - Set all required fields (id, type, title, status, owner, created, updated)\n   - For requirements, set `feature: F-####` to link to parent\n\n5. **Update related entities** to establish bidirectional links\n\n### Updating Specifications\n\nWhen modifying a spec:\n1. Update the `updated` timestamp\n2. Maintain bidirectional links (if adding feature to goal, add goal to feature)\n3. Follow status transition rules\n\n## Writing Guidelines\n\nFor guidance on writing effective specifications, consult `references/writing-guide.md`.\n\nKey principles:\n- Write user-focused, implementation-agnostic specifications\n- Include clear acceptance criteria\n- Maintain traceability between entities\n- Use consistent terminology\n\n## Additional Resources\n\n### Reference Files\n\n- **`references/entity-fields.md`** - Complete YAML field reference for all entity types\n- **`references/writing-guide.md`** - Best practices for writing specifications\n\n### Related Skills\n\n- **`speclan-id-generator`** - Generate collision-free unique IDs for SPECLAN entities\n\n### Utility Scripts\n\n- **`scripts/detect-speclan.sh`** - Detect speclan directory in a project"
              },
              {
                "name": "SPECLAN ID Generator",
                "description": "This skill should be used when generating IDs for SPECLAN entities, creating new specs, or needing collision-free unique identifiers. Use when user asks to \"create a spec\", \"generate ID\", \"new feature ID\", \"unique requirement ID\", or when commands need to assign IDs to new entities.",
                "path": "plugins/speclan/skills/speclan-id-generator/SKILL.md",
                "frontmatter": {
                  "name": "SPECLAN ID Generator",
                  "description": "This skill should be used when generating IDs for SPECLAN entities, creating new specs, or needing collision-free unique identifiers. Use when user asks to \"create a spec\", \"generate ID\", \"new feature ID\", \"unique requirement ID\", or when commands need to assign IDs to new entities.",
                  "version": "0.1.0",
                  "context": "fork"
                },
                "content": "# SPECLAN ID Generator\n\nGenerate unique, collision-free random IDs for SPECLAN entities with automatic retry and comprehensive collision detection.\n\n## Why Use This Skill\n\n- **Collision-free:** Automatically checks existing IDs and retries if collision detected\n- **Entity-aware:** Correct format for each entity type (goals: 3-digit, others: 4-digit)\n- **Comprehensive detection:** Checks both filenames AND frontmatter\n- **Reusable:** Single script usable by all commands and agents\n\n## Entity ID Formats\n\n| Entity Type | Prefix | Digits | Range | Example |\n|-------------|--------|--------|-------|---------|\n| goal | G- | 3 | 100-999 | G-142 |\n| feature | F- | 4 | 1000-9999 | F-1847 |\n| requirement | R- | 4 | 1000-9999 | R-3928 |\n| change-request | CR- | 4 | 1000-9999 | CR-7291 |\n| scenario | S- | 4 | 1000-9999 | S-4521 |\n| acceptance-criterion | AC- | 4 | 1000-9999 | AC-2847 |\n| test | T- | 4 | 1000-9999 | T-1029 |\n\n**ID-Based Ordering:** IDs determine artifact priority numerically. Lower IDs = higher priority. When generating IDs for artifacts that should have specific priority relative to existing ones, consider the ID range carefully.\n\n## Usage\n\n### Script Location\n\n```\n${PLUGIN_ROOT}/skills/speclan-id-generator/scripts/generate-id.sh\n```\n\n### Command Line\n\n```bash\n./generate-id.sh <entity-type> [count] [speclan-dir]\n```\n\n**Arguments:**\n- `entity-type` - Required. One of: `goal`, `feature`, `requirement`, `change-request`, `scenario`, `acceptance-criterion`, `test`\n- `count` - Optional. Number of IDs to generate (default: 1)\n- `speclan-dir` - Optional. Path to speclan directory (defaults to `./speclan`)\n\n**Output:**\n- Success: Prints unique ID(s) to stdout, one per line\n- Failure: Prints error to stderr, exits with code 1\n\n### Examples\n\n```bash\n# Generate a single feature ID\n./generate-id.sh feature\n# Output: F-1847\n\n# Generate 5 requirement IDs at once\n./generate-id.sh requirement 5\n# Output:\n# R-3928\n# R-4521\n# R-7832\n# R-1293\n# R-5647\n\n# Generate 3 feature IDs with custom speclan path\n./generate-id.sh feature 3 /path/to/project/speclan\n# Output:\n# F-1142\n# F-2893\n# F-5467\n\n# Generate a change request ID\n./generate-id.sh change-request\n# Output: CR-7291\n```\n\n### In Commands/Agents\n\n```bash\n# Capture single ID\nFEATURE_ID=$(./skills/speclan-id-generator/scripts/generate-id.sh feature speclan)\necho \"Created feature: $FEATURE_ID\"\n\n# Generate multiple IDs at once (more efficient than multiple calls)\nREQ_IDS=$(./generate-id.sh requirement 5 speclan)\necho \"Created requirements:\"\necho \"$REQ_IDS\"\n\n# Parse multiple IDs into array\nmapfile -t REQ_ARRAY <<< \"$(./generate-id.sh requirement 3 speclan)\"\necho \"First: ${REQ_ARRAY[0]}, Second: ${REQ_ARRAY[1]}, Third: ${REQ_ARRAY[2]}\"\n\n# Or use read for bash 3.x compatibility\nIFS=$'\\n' read -d '' -r -a REQ_ARRAY <<< \"$(./generate-id.sh requirement 3 speclan)\" || true\n```\n\n### Session-Aware Collision Detection\n\nWhen generating multiple IDs in a single call, the script tracks generated IDs within the session to ensure no duplicates, even before they're written to disk. This is more efficient than making multiple separate calls.\n\n## Algorithm\n\nThe script implements a robust ID generation algorithm:\n\n```\n1. Parse entity type to get prefix, digit count, and range\n2. For up to 100 attempts:\n   a. Generate random number in range\n   b. Format as ID (e.g., F-2934)\n   c. Check for collisions:\n      - Search filenames: find speclan -name \"F-2934-*\"\n      - Search frontmatter: grep \"^id: F-2934$\"\n   d. If no collision, return ID\n3. If all attempts fail, exit with error\n```\n\n## Collision Detection\n\nThe script checks two locations for collisions:\n\n### 1. Filename/Directory Collision\n\nSearches for files or directories matching the ID pattern:\n```bash\nfind \"$speclan_dir\" -name \"${id}-*\" -o -name \"${id}.md\"\n```\n\nThis catches both directory-based and flat file entities:\n- `F-2934-my-feature/` (feature directory)\n- `R-4521-requirement/` (requirement directory)\n- `G-142-goal.md` (flat goal file)\n- `CR-1234-change.md` (flat change request file)\n\n### 2. Frontmatter Collision\n\nSearches for ID in YAML frontmatter:\n```bash\ngrep -r \"^id: ${id}$\" \"$speclan_dir\"\n```\n\nThis catches:\n- Files that were renamed but kept the original ID\n- IDs referenced but not yet written to files\n\n## Inline Algorithm (For Commands)\n\nIf the script is not available, commands can use this inline algorithm:\n\n```bash\n# Generate unique Feature ID (4-digit)\ngenerate_feature_id() {\n  local speclan_dir=\"${1:-speclan}\"\n  local max_attempts=100\n\n  for attempt in $(seq 1 $max_attempts); do\n    # Generate random 4-digit number (1000-9999)\n    local num=$((RANDOM % 9000 + 1000))\n    local id=\"F-${num}\"\n\n    # Check for collisions\n    if [ ! -d \"$speclan_dir\" ]; then\n      echo \"$id\"\n      return 0\n    fi\n\n    # Check filenames and frontmatter\n    if ! find \"$speclan_dir\" -name \"${id}-*\" 2>/dev/null | grep -q . && \\\n       ! grep -r \"^id: ${id}$\" \"$speclan_dir\" 2>/dev/null | grep -q .; then\n      echo \"$id\"\n      return 0\n    fi\n  done\n\n  echo \"ERROR: Could not generate unique ID\" >&2\n  return 1\n}\n\n# Generate unique Requirement ID (4-digit)\ngenerate_requirement_id() {\n  local speclan_dir=\"${1:-speclan}\"\n  local max_attempts=100\n\n  for attempt in $(seq 1 $max_attempts); do\n    # Generate random 4-digit number (1000-9999)\n    local num=$((RANDOM % 9000 + 1000))\n    local id=\"R-${num}\"\n\n    if [ ! -d \"$speclan_dir\" ]; then\n      echo \"$id\"\n      return 0\n    fi\n\n    if ! find \"$speclan_dir\" -name \"${id}-*\" 2>/dev/null | grep -q . && \\\n       ! grep -r \"^id: ${id}$\" \"$speclan_dir\" 2>/dev/null | grep -q .; then\n      echo \"$id\"\n      return 0\n    fi\n  done\n\n  echo \"ERROR: Could not generate unique ID\" >&2\n  return 1\n}\n\n# Usage\nFEATURE_ID=$(generate_feature_id speclan)\nREQ_ID=$(generate_requirement_id speclan)\n```\n\n## Error Handling\n\n| Exit Code | Meaning |\n|-----------|---------|\n| 0 | Success - ID printed to stdout |\n| 1 | Error - message printed to stderr |\n\n**Common errors:**\n- Invalid entity type\n- Could not generate unique ID after 100 attempts (ID space exhausted)\n- Missing required arguments\n\n## Integration\n\n### With `infer-from-codebase` Command\n\nThe command should use this skill for all ID generation:\n\n```markdown\n##### 3.4.4 Generate IDs\n\nUse the `speclan-id-generator` skill:\n\n\\`\\`\\`bash\nFEATURE_ID=$(./skills/speclan-id-generator/scripts/generate-id.sh feature speclan)\nREQ_ID=$(./skills/speclan-id-generator/scripts/generate-id.sh requirement speclan)\n\\`\\`\\`\n```\n\n### With Agents\n\nAgents should reference the inline algorithm from this skill when they need to suggest ID generation code."
              },
              {
                "name": "Sync Specs from Session",
                "description": "This skill should be used when the user asks to \"sync specs\", \"update specs from work\", \"record what we did\", \"add to speclan\", \"document implemented features\", or wants to capture session work as SPECLAN specifications. Analyzes conversation context to identify implemented features and syncs with speclan directory.",
                "path": "plugins/speclan/skills/sync-from-session/SKILL.md",
                "frontmatter": {
                  "name": "Sync Specs from Session",
                  "description": "This skill should be used when the user asks to \"sync specs\", \"update specs from work\", \"record what we did\", \"add to speclan\", \"document implemented features\", or wants to capture session work as SPECLAN specifications. Analyzes conversation context to identify implemented features and syncs with speclan directory.",
                  "version": "0.1.0"
                },
                "content": "# Sync Specs from Session\n\nAnalyze the current session context to identify implemented features, compare with existing SPECLAN specifications, and create or update specs based on user confirmation.\n\n## When to Use\n\n- After completing implementation work and wanting to document it\n- When user asks to sync or update specs based on recent work\n- To capture newly implemented functionality in SPECLAN format\n\n## Workflow Overview\n\n```\n1. Analyze Session → 2. Scan Speclan → 3. Compare & Diff → 4. Ask User → 5. Apply Changes\n```\n\n## Step 1: Analyze Session Context\n\nReview the conversation history to identify:\n\n### 1.1 Code Changes Made\n\nLook for patterns indicating implementation:\n- Files created or modified (Write/Edit tool usage)\n- Functions, classes, or components added\n- API endpoints implemented\n- Database schema changes\n- Configuration updates\n\n### 1.2 Extract Feature Information\n\nFor each identified change, extract:\n\n```yaml\nfeature_candidate:\n  title: \"<descriptive name>\"\n  description: \"<what it does and why>\"\n  code_paths: [\"<files involved>\"]\n  type: \"new\" | \"enhancement\" | \"bugfix\"\n  scope: \"feature\" | \"requirement\" | \"both\"\n```\n\n### 1.3 Categorize Changes\n\nGroup related changes into logical features:\n- Multiple file changes for one feature = single feature\n- Independent changes = separate features\n- Small fixes to existing features = requirement updates\n\n## Step 2: Scan Speclan Directory\n\n### 2.1 Detect Speclan Location\n\n```bash\n# Check common locations\nif [ -d \"speclan\" ]; then\n  SPECLAN_DIR=\"speclan\"\nelif [ -d \"specs/speclan\" ]; then\n  SPECLAN_DIR=\"specs/speclan\"\nelse\n  # No speclan directory - all features are new\n  SPECLAN_DIR=\"\"\nfi\n```\n\n### 2.2 Index Existing Specs\n\nIf speclan directory exists, build an index:\n\n```bash\n# List all features\nfind \"$SPECLAN_DIR/features\" -name \"F-*.md\" -type f 2>/dev/null\n\n# Extract titles and paths\nfor f in $(find \"$SPECLAN_DIR/features\" -name \"F-*.md\" -type f); do\n  id=$(grep \"^id:\" \"$f\" | head -1 | cut -d: -f2 | tr -d ' ')\n  title=$(grep \"^title:\" \"$f\" | head -1 | cut -d: -f2-)\n  echo \"$id|$title|$f\"\ndone\n```\n\n### 2.3 Build Existing Spec Map\n\nCreate a mapping of:\n- Feature ID → Title → File path\n- Feature ID → Code paths mentioned (from `## Scope` or similar sections)\n- Feature ID → Status (for edit rules)\n\n## Step 3: Compare and Generate Diff\n\n### 3.1 Match Session Work to Existing Specs\n\nFor each feature candidate from session:\n\n1. **Title similarity check**: Compare with existing feature titles\n2. **Code path overlap**: Check if code_paths match existing features\n3. **Description similarity**: Semantic comparison of purpose\n\n### 3.2 Classify Each Change\n\n| Session Feature | Existing Spec | Classification |\n|-----------------|---------------|----------------|\n| New code paths | No match | **CREATE** new feature |\n| Same code paths | Match found, status editable | **UPDATE** existing feature |\n| Same code paths | Match found, status locked | **CHANGE_REQUEST** needed |\n| Enhancement | Partial match | **ADD_REQUIREMENT** to feature |\n\n### 3.3 Prepare Change Summary\n\nBuild a structured summary:\n\n```yaml\nchanges:\n  create:\n    - title: \"User Authentication\"\n      description: \"JWT-based auth with refresh tokens\"\n      code_paths: [\"src/auth/\", \"src/middleware/auth.ts\"]\n\n  update:\n    - id: \"F-1142\"\n      title: \"Pet Management\"\n      changes: \"Added bulk import functionality\"\n      code_paths: [\"src/pets/import.ts\"]\n\n  change_requests:\n    - parent_id: \"F-1089\"\n      title: \"Add Export Feature\"\n      reason: \"Feature is in-development status\"\n\n  requirements:\n    - feature_id: \"F-1142\"\n      title: \"Validate CSV format on import\"\n      code_paths: [\"src/pets/validators/csv.ts\"]\n```\n\n## Step 4: Ask User for Confirmation\n\nPresent the identified changes to the user using AskUserQuestion or direct prompting.\n\n### 4.1 Summary Format\n\n```markdown\n## Identified Changes from Session\n\nBased on our session, I identified the following potential spec updates:\n\n### New Features to Create\n1. **User Authentication** - JWT-based auth with refresh tokens\n\n### Existing Features to Update\n1. **F-1142 Pet Management** - Add bulk import functionality\n   - Current status: draft (editable)\n\n### Change Requests Needed\n1. **F-1089 Data Export** - Feature is locked (in-development)\n   - Proposed: Add CSV export option\n\n### New Requirements\n1. For **F-1142**: Validate CSV format on import\n```\n\nNote: Code paths are used internally to match session work to existing specs, but are NOT included in the specs themselves.\n\n### 4.2 Ask for User Selection\n\nUse AskUserQuestion to let user choose:\n\n```yaml\nquestions:\n  - question: \"Which changes would you like to apply to specs?\"\n    header: \"Apply\"\n    multiSelect: true\n    options:\n      - label: \"Create: User Authentication\"\n        description: \"New feature for JWT auth implementation\"\n      - label: \"Update: F-1142 Pet Management\"\n        description: \"Add bulk import to existing feature\"\n      - label: \"CR for F-1089: Data Export\"\n        description: \"Create change request for locked feature\"\n      - label: \"Requirement for F-1142\"\n        description: \"Add CSV validation requirement\"\n```\n\n### 4.3 Handle User Response\n\n- **Selected items**: Proceed to create/update\n- **\"Other\" response**: User may provide custom instructions\n- **No selection**: Skip spec updates\n\n## Step 5: Apply Changes\n\n### 5.1 Generate IDs\n\nFor new entities, generate collision-free IDs:\n\n```bash\n# Use the ID generator skill/script\nFEATURE_ID=$(./skills/speclan-id-generator/scripts/generate-id.sh feature \"$SPECLAN_DIR\")\nREQ_ID=$(./skills/speclan-id-generator/scripts/generate-id.sh requirement \"$SPECLAN_DIR\")\n```\n\n### 5.2 Create New Features\n\nFor each new feature:\n\n1. **Create directory structure:**\n   ```bash\n   mkdir -p \"$SPECLAN_DIR/features/F-####-slug\"\n   mkdir -p \"$SPECLAN_DIR/features/F-####-slug/requirements\"\n   ```\n\n2. **Write feature file** with YAML frontmatter:\n   ```yaml\n   ---\n   id: F-####\n   type: feature\n   title: <Title>\n   status: under-test\n   owner: <from session or \"Developer\">\n   created: \"<ISO-8601>\"\n   updated: \"<ISO-8601>\"\n   goals: []\n   ---\n\n   # <Title>\n\n   ## Overview\n   <Description from session analysis - focus on WHAT and WHY, not HOW>\n\n   ## Scope\n   <Bullet points of functionality - user-facing capabilities, not code details>\n   ```\n\n**IMPORTANT:** Specs must be implementation-agnostic. Do NOT include:\n- Code paths or file names\n- Implementation details or technical approach\n- Code fragments or snippets\n- Internal architecture details\n\nFocus on WHAT the feature does for users, not HOW it's implemented.\n\n### 5.3 Update Existing Features\n\nFor features with editable status (draft, review, approved):\n\n1. **Read current file**\n2. **Update relevant sections:**\n   - Add new scope items\n   - Update description if needed\n   - Add implementation notes\n3. **Update `updated` timestamp**\n4. **Write file back**\n\n### 5.4 Create Change Requests\n\nFor locked entities (features or requirements in-development, under-test, released):\n\n1. **Generate CR ID:**\n   ```bash\n   CR_ID=$(./skills/speclan-id-generator/scripts/generate-id.sh change-request \"$SPECLAN_DIR\")\n   ```\n\n2. **Create CR file:**\n   ```yaml\n   ---\n   id: CR-####\n   type: changeRequest\n   title: <Change title>\n   status: pending\n   owner: Developer\n   created: \"<ISO-8601>\"\n   updated: \"<ISO-8601>\"\n   parentId: <F-#### or R-####>\n   parentType: <feature or requirement>\n   changeType: enhancement\n   description: <Brief description>\n   changes: |\n     <Detailed change narrative from session>\n   ---\n   ```\n\n3. **Place in correct location (adjacent to target entity):**\n   ```\n   # For features:\n   speclan/features/F-####-slug/change-requests/CR-####-slug.md\n\n   # For requirements:\n   speclan/features/.../requirements/R-####-slug/change-requests/CR-####-slug.md\n   ```\n\n### 5.5 Create New Requirements\n\nFor requirements under existing features:\n\n1. **Generate requirement ID**\n2. **Create requirement directory structure:**\n   ```bash\n   mkdir -p \"speclan/features/F-####-parent/requirements/R-####-slug\"\n   ```\n3. **Write requirement file:**\n   ```\n   speclan/features/F-####-parent/requirements/R-####-slug/R-####-slug.md\n   ```\n4. **Update parent feature's `updated` timestamp**\n\n## Step 6: Report Results\n\nAfter applying changes, report:\n\n```markdown\n## Spec Sync Complete\n\n### Created\n- F-#### User Authentication (speclan/features/F-####-user-authentication/)\n- R-#### CSV Validation (speclan/features/F-1142-pet-management/requirements/R-####-csv-validation/)\n\n### Updated\n- F-1142 Pet Management - added bulk import scope\n\n### Change Requests Created\n- CR-#### for F-1089 Data Export (speclan/features/F-1089-.../change-requests/)\n- CR-#### for R-#### (speclan/.../requirements/R-####-.../change-requests/)\n\n### Next Steps\n- Review created specs for accuracy\n- Assign goals to new features\n- Process pending change requests\n```\n\n## Edge Cases\n\n### No Speclan Directory\n\nIf speclan/ doesn't exist:\n1. Ask user if they want to initialize it\n2. If yes, create basic structure:\n   ```bash\n   mkdir -p speclan/goals speclan/features speclan/templates\n   ```\n3. Proceed with creating new features\n\n### No Identifiable Features\n\nIf session has no clear feature work:\n- Report: \"No significant feature implementations detected in this session\"\n- Offer to manually describe what to document\n\n### Ambiguous Matches\n\nWhen a session feature could match multiple existing specs:\n- Present options to user\n- Let them choose the correct match or create new\n\n## Integration with Other Skills\n\n### SPECLAN Format\nReference for proper file structure and frontmatter fields.\n\n### SPECLAN ID Generator\nUse for collision-free ID generation.\n\n### Spec Converter\nIf user also has speckit, consider syncing there too."
              }
            ]
          }
        ]
      }
    }
  ]
}