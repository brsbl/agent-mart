---
date: 2026-01-20
branch: feat/web-frontend
repo: brsbl/agent-mart
commits: 34
files_changed: 1003
lines: +24422/-2308533
---

## High-Level Summary

This branch transforms Agent Mart from a static data repository into a full-stack application with a Next.js frontend and significantly improved ETL pipeline. The massive line deletion (-2.3M) reflects migrating from embedded JSON data files to a dynamic data architecture, while the additions establish a modern React-based marketplace browser with category filtering, search, and detailed plugin views.

## Summary for Different Audiences

- **For developers:** The codebase now has a clear separation between ETL pipeline (`src/pipeline/`), shared libraries (`src/lib/`), and Next.js frontend (`web/`). The pipeline outputs JSON to `web/public/data/` which the frontend consumes via client-side fetching. A rules-based categorizer replaces the previous LLM-based approach, and a new visualizer provides real-time ETL progress monitoring.

- **For reviewers:** Focus on the ETL pipeline data flow (stages 01-07 plus categorizer), the new type definitions in `web/src/lib/types.ts`, and the security-related changes in cache path validation and URL parameter sanitization. The shift from embedded owner JSON files to a consolidated author-based data model is a significant architectural change.

- **For product/non-technical stakeholders:** Agent Mart now has a browsable web interface where users can discover Claude Code plugins by category, search by keywords, view detailed plugin information with install commands, and track starred repositories. The marketplace data updates automatically via GitHub Actions.

## Changes by Component

### ETL Pipeline (`src/pipeline/`)

- **Purpose of changes:** Complete rewrite of the data processing pipeline to support the new frontend data requirements and improve reliability with better error handling.

- **Behavioral changes:** Pipeline now produces author-centric JSON files instead of owner-centric files. New stages include file content fetching (04), parsing with validation (05), enrichment with category extraction (06), and optimized output generation (07). Added ETL visualizer for monitoring.

- **Data flow impact:** Data flows through 7 sequential stages producing intermediate JSON files in `data/` and final outputs in `web/public/data/`. The enriched data model now includes file trees, command counts, skill counts, and categorization metadata.

- **Dependencies affected:** Frontend depends on the output JSON structure. Changes to field names or data shapes require coordinated updates to `web/src/lib/types.ts`.

### Rules-Based Categorizer (`src/lib/categorizer.js`)

- **Purpose of changes:** Replaces LLM-based categorization with deterministic rules-based extraction, making categorization fast, reproducible, and free.

- **Behavioral changes:** 12 categories defined with regex patterns and keyword lists. Categories extracted from marketplace descriptions, plugin names, command descriptions, and skill descriptions.

- **Data flow impact:** Categorization happens in the enrich stage (06) for plugins and separately in stage 08 for marketplaces. Results stored in `categories` arrays throughout the data model.

- **Dependencies affected:** Frontend category filters depend on the category ID strings. Adding/removing categories requires updating both categorizer and frontend display mappings.

### Next.js Frontend (`web/`)

- **Purpose of changes:** Provides a user-facing interface for browsing, searching, and discovering Claude Code plugins and marketplaces.

- **Behavioral changes:** Users can filter by category, sort by stars/date, paginate with infinite scroll, view detailed marketplace pages with file trees, and copy install commands. Starred repos persist in localStorage.

- **Data flow impact:** Frontend fetches JSON from `/data/` endpoints on the client side. No server-side data fetching or API routes - purely static data consumption.

- **Dependencies affected:** Requires `web/public/data/` files to be generated by the ETL pipeline before build/deployment.

### Components (`web/src/components/`)

- **Purpose of changes:** 11 reusable React components implementing the marketplace UI with consistent styling and accessibility.

- **Behavioral changes:** Components include `MarketplaceCard`, `PluginSection`, `CategoryPill`, `FileTree`, `CopyableCommand`, loading/error states. All support dark mode via CSS variables.

- **Data flow impact:** Components receive typed props from parent pages. Shared hooks (`useFetch`, `useStarredRepos`, `useCopyToClipboard`) handle common data fetching and state patterns.

- **Dependencies affected:** Changes to component APIs require updates to consuming pages.

### Security & Validation Fixes

- **Purpose of changes:** Address security issues identified in code review including path traversal, XSS, and input validation.

- **Behavioral changes:** Cache path validation uses proper path separator checking. URL parameters sanitized with `validateUrlParam()`. GraphQL strings properly escaped.

- **Data flow impact:** Invalid inputs now fail safely rather than causing undefined behavior.

- **Dependencies affected:** All pipeline stages benefit from improved input validation in shared utilities.

### CI/CD & Developer Experience

- **Purpose of changes:** Add pre-commit hooks, improve GitHub Actions, and establish consistent code quality enforcement.

- **Behavioral changes:** Husky runs lint and tests on pre-commit/pre-push. New workflow for auto-updating marketplace categories. PR creation workflow instead of direct pushes.

- **Data flow impact:** Data updates now create PRs for review rather than auto-merging.

- **Dependencies affected:** All contributors must pass lint/test checks before committing.

## Recent Bug Fixes (Current Session)

The following issues from code review were fixed in this session:

1. **Command/skill counting patterns** (`06-enrich.js:22-36`) - Fixed to match root-level `commands/` and `SKILL.md` paths
2. **Sort mutation** (`07-output.js:90`) - Now uses spread operator to avoid mutating source array
3. **Size check** (`04-fetch-files.js:28`) - Changed from `!== null` to `typeof === 'number'` to handle undefined
4. **Date validation in sort** (`07-output.js:165-170`) - Added NaN check for invalid date strings
