{
  "author": {
    "id": "cameronfreer",
    "display_name": "Cameron Freer",
    "avatar_url": "https://avatars.githubusercontent.com/u/2009342?u=93bc1a12128cf48ba1222ebe6ebc1b74620ad6ad&v=4"
  },
  "marketplaces": [
    {
      "name": "lean4-skills",
      "version": null,
      "description": "Lean 4 theorem proving with guided + autonomous proving, LSP-first workflows, and guardrails",
      "repo_full_name": "cameronfreer/lean4-skills",
      "repo_url": "https://github.com/cameronfreer/lean4-skills",
      "repo_description": "Claude skills for Lean 4 theorem proving",
      "signals": {
        "stars": 114,
        "forks": 11,
        "pushed_at": "2026-02-12T21:39:45Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"lean4-skills\",\n  \"owner\": {\n    \"name\": \"Cameron Freer\",\n    \"email\": \"cameronfreer@gmail.com\"\n  },\n  \"metadata\": {\n    \"description\": \"Lean 4 theorem proving with guided + autonomous proving, LSP-first workflows, and guardrails\",\n    \"version\": \"4.0.8\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"lean4\",\n      \"description\": \"Unified Lean 4 plugin (prove, autoprove, review, golf, checkpoint) — LSP-first, scripts fallback\",\n      \"source\": \"./plugins/lean4\"\n    }\n  ]\n}\n",
        "README.md": "# Lean 4 Skills for Claude\n\n[![Run in Smithery](https://smithery.ai/badge/skills/cameronfreer)](https://smithery.ai/skills?ns=cameronfreer&utm_source=github&utm_medium=badge)\n\nClaude Code plugin for automated Lean 4 theorem proving with guided and autonomous proving commands.\n\n## Installation\n\n```bash\n# Add marketplace\n/plugin marketplace add cameronfreer/lean4-skills\n\n# Install plugin\n/plugin install lean4\n```\n\n## Commands\n\n| Command | Description |\n|---------|-------------|\n| `/lean4:prove` | Guided cycle-by-cycle theorem proving |\n| `/lean4:autoprove` | Autonomous multi-cycle proving with stop rules |\n| `/lean4:checkpoint` | Verified save point (build + axiom check + commit) |\n| `/lean4:review` | Read-only quality review with optional external hooks |\n| `/lean4:golf` | Optimize proofs for brevity |\n| `/lean4:doctor` | Diagnostics and migration help |\n\n## Quick Start\n\n```\n/lean4:prove               # Guided sorry filling (interactive)\n/lean4:autoprove           # Or autonomous (unattended)\n/lean4:review              # Check quality (read-only)\n/lean4:golf                # Optimize proofs\n/lean4:checkpoint          # Verified commit\ngit push                   # Manual, after review\n```\n\n## How It Works\n\n**`/lean4:prove`** — Guided, interactive. Asks preferences at startup, prompts before each commit, pauses between cycles. Start here.\n\n**`/lean4:autoprove`** — Autonomous, unattended. No questionnaire, auto-commits, loops until done or a stop condition fires (max cycles/time/stuck).\n\nBoth run the same cycle engine: **Plan → Work → Checkpoint → Review → Replan → Continue/Stop**. Each sorry gets a mathlib search, tactic attempts, and validation. By default, each successful fill is committed individually (`--commit` controls this). When stuck, both force a review + replan.\n\n**Without a command:** Editing `.lean` files activates the skill for one bounded pass — fix the immediate issue, then suggest `/lean4:prove` or `/lean4:autoprove` for more.\n\nThe other commands: **`/lean4:review`** (read-only quality check), **`/lean4:checkpoint`** (build + axiom check + commit), **`/lean4:golf`** (proof optimization), **`/lean4:doctor`** (diagnostics).\n\nSee [plugin README](plugins/lean4/README.md) for the full command guide.\n\n## Recommended: Lean LSP MCP Server\n\n[lean-lsp-mcp](https://github.com/oOo0oOo/lean-lsp-mcp) provides sub-second feedback and search (LeanSearch, Loogle, LeanFinder). **Setup:** See [INSTALLATION.md](INSTALLATION.md#lean-lsp-server)\n\n## Migrating from V3\n\nIf upgrading from the 3-plugin system:\n\n```bash\n# Uninstall old plugins\n/plugin uninstall lean4-theorem-proving\n/plugin uninstall lean4-memories\n/plugin uninstall lean4-subagents\n\n# Install unified plugin\n/plugin install lean4\n\n# Verify\n/lean4:doctor\n```\n\n**Legacy access:** Pin to `@v3.4.2-legacy` or use `#legacy-marketplace` branch.\n\nSee `/lean4:doctor migrate` for detailed migration help.\n\n## Documentation\n\n- [SKILL.md](plugins/lean4/skills/lean4/SKILL.md) - Core skill reference\n- [INSTALLATION.md](INSTALLATION.md) - Setup guide\n- [Commands](plugins/lean4/commands/) - Command documentation\n\n## Changelog\n\n**v4.0.8** (February 2026)\n- Three-tier build verification policy (diagnostics → `lake env lean` → `lake build`)\n- Fixed incorrect `lake build FILE.lean` patterns across references\n- Lint check prevents `lake build` with file arguments from regressing\n\n**v4.0.7** (February 2026)\n- Custom syntax reference: notations, macros, elaborators, DSLs (from PR #5, Alok Singh)\n- DSL scaffold template with precedence-correct examples\n- Version-compat note for MetaM/TacticM API drift across toolchains\n\n**v4.0.5** (February 2026)\n- Split `/lean4:autoprover` into `/lean4:prove` (guided) and `/lean4:autoprove` (autonomous)\n- prove: asks before each cycle, startup questionnaire, interactive deep approval\n- autoprove: autonomous loop with hard stop rules, structured summary on stop\n- Shared cycle engine: plan → work → checkpoint → review → replan → continue/stop\n- Stuck definition uses exact signature hashing for precision\n- Checkpoint skips commit on empty diff\n\n**v4.0.0** (February 2026)\n- Unified into single `lean4` plugin\n- New `/lean4:autoprover` - planning-first workflow\n- New `/lean4:golf` - standalone proof optimization\n- LSP-first approach throughout\n- Safety guardrails in Lean projects (blocks push/amend/pr; one-shot bypass for collaboration ops). See [plugin README safety section](plugins/lean4/README.md#safety-guardrails).\n- Removed memory integration (didn't work reliably)\n\n**v3.4.2** (January 2026) - [Legacy branch](../../tree/legacy-marketplace)\n- Last version of 3-plugin system\n- Available via `@v3.4.2-legacy` tag\n\n## Contributing\n\nIssues and PRs welcome at https://github.com/cameronfreer/lean4-skills\n\n## License\n\nMIT License - see [LICENSE](LICENSE)\n",
        "plugins/lean4/README.md": "# Lean 4 Plugin\n\nUnified Lean 4 theorem proving with guided and autonomous proving commands.\n\n## Commands\n\n| Command | Description |\n|---------|-------------|\n| `/lean4:prove` | Guided cycle-by-cycle theorem proving |\n| `/lean4:autoprove` | Autonomous multi-cycle proving with stop rules |\n| `/lean4:checkpoint` | Verified save point (build + axiom check + commit) |\n| `/lean4:review` | Read-only quality review with optional external hooks |\n| `/lean4:golf` | Optimize proofs for brevity |\n| `/lean4:doctor` | Diagnostics and migration help |\n\n## Quick Start\n\n```bash\n/lean4:prove               # Guided sorry filling (interactive)\n/lean4:autoprove           # Autonomous sorry filling (unattended)\n/lean4:review              # Check quality (read-only)\n/lean4:golf                # Optimize proofs\n/lean4:checkpoint          # Verified commit\ngit push                   # Manual, after review\n```\n\n## How It Works\n\n### Without a Command\n\nWhen you edit `.lean` files in a normal conversation, the plugin activates automatically — it helps with the immediate issue (a build error, a single sorry) but does one bounded pass only. No looping, no deep escalation. At the end it suggests:\n\n> Use `/lean4:prove` for guided cycle-by-cycle help.\n> Use `/lean4:autoprove` for autonomous cycles with stop safeguards.\n\n### `/lean4:prove` — Guided Proving\n\nStart here if you're new or want to stay in control.\n\nAt startup, `prove` asks your preferences: planning on/off and review source. Before each commit it shows the diff and asks — pick `yes-all` to stop prompting, or `never` to skip all commits for the session. Between every cycle it pauses:\n\n```\nCycle complete. Filled 2/8 sorries this cycle.\n- [continue] — run next cycle\n- [stop] — save progress and exit\n- [adjust] — change flags for next cycle\n```\n\nIt never auto-starts the next cycle. You decide when to continue.\n\n### `/lean4:autoprove` — Autonomous Proving\n\nUse when you want to kick it off and walk away.\n\nNo questionnaire — discovers state and starts immediately. Commits without prompting by default (`--commit=auto`). Loops automatically with checkpoint + review + replan at each cycle boundary. Stops on the first condition met:\n\n- All sorries filled\n- 3 consecutive stuck cycles (`--max-stuck-cycles`)\n- 20 total cycles (`--max-cycles`)\n- 120 minutes elapsed (`--max-total-runtime`)\n\nOn stop, emits a structured summary (sorries before/after, cycles, time, handoff recommendations).\n\n### The Cycle Engine (Shared)\n\nBoth commands run the same 6-phase cycle:\n\n```\nPlan → Work → Checkpoint → Review → Replan → Continue/Stop\n```\n\n- **Plan** — Discover sorries via LSP, set order\n- **Work** — Per sorry: search mathlib, try tactics, validate, stage only touched files, commit\n- **Checkpoint** — Commit cycle progress (skipped if nothing changed)\n- **Review** — Scoped quality check at configured intervals (`--review-every`)\n- **Replan** — Planner mode updates the action plan based on review findings\n- **Continue/Stop** — `prove` asks you; `autoprove` auto-continues\n\nWhen stuck (same blocker seen twice), both force a review + replan regardless of settings.\n\n### `/lean4:review` — Quality Check\n\nRead-only. Does not modify files or create commits.\n\nRuns build verification, sorry audit, axiom check, style review, and golfing opportunity scan. Scopes automatically to what you're working on (`--scope=sorry`, `file`, `changed`, or `project`). Two modes:\n\n- **batch** (default) — full report with all sections\n- **stuck** — lightweight triage: top 3 blockers with next steps\n\n`prove` and `autoprove` trigger reviews automatically at configured intervals. You can also run `/lean4:review` manually at any time.\n\n### `/lean4:checkpoint` — Verified Save Point\n\nRuns `lake build`, checks for non-standard axioms, reports sorry count, then stages and commits. One command for \"I want a known-good save point.\"\n\nDoes **not** push — that's always manual (`git push`).\n\n### `/lean4:golf` — Proof Optimization\n\nFinds and applies safe optimizations: `rw+exact → rwa`, inline single-use `let`, `ext+rfl → rfl`, etc. Verifies with `lean_diagnostic_messages` after each change (`lake build` at final gate only) and reverts failures. Stops when the success rate drops below 20% (saturation).\n\nUsually run after proving, either prompted at the end of a `prove` session or explicitly.\n\n### `/lean4:doctor` — Diagnostics\n\nChecks your environment (lean, lake, python, git), plugin structure, project health, and detects legacy v3 artifacts. Run this first if something isn't working.\n\n### Commit Behavior\n\n- `prove` defaults to `--commit=ask` — prompts before each commit (`yes-all` / `never` to stop prompting)\n- `autoprove` defaults to `--commit=auto` — commits without prompting\n- Both stage only files actually touched during the work, never `git add -A`\n\n### Safety Guardrails\n\nGuardrails activate only in Lean project context (a directory tree containing `lakefile.lean`, `lean-toolchain`, or `lakefile.toml`). Outside Lean projects, they are silently skipped.\n\nBlocked during Lean project sessions:\n- `git push` → Use `/lean4:checkpoint`, then push manually\n- `git commit --amend` → Each change is a new commit for safe rollback\n- `gh pr create` → Review first with `/lean4:review`\n- Destructive git operations (`checkout --`, `restore`, `reset --hard`, `clean -f`) → Use `git stash push -u`\n- Deep sorry-filling has snapshot, rollback, scope budgets, and regression gates — see [Cycle Engine](skills/lean4/references/cycle-engine.md#deep-mode)\n\n**Override environment variables:**\n\n| Variable | Effect |\n|----------|--------|\n| `LEAN4_GUARDRAILS_DISABLE=1` | Skip all guardrails regardless of context |\n| `LEAN4_GUARDRAILS_FORCE=1` | Enforce guardrails even outside Lean projects |\n| `LEAN4_GUARDRAILS_COLLAB_POLICY` | Collaboration op policy: `ask` (default), `allow`, `block` |\n\n`LEAN4_GUARDRAILS_DISABLE` overrides everything. `LEAN4_GUARDRAILS_FORCE` controls whether guardrails activate outside Lean projects.\n\n**Collaboration policy (`LEAN4_GUARDRAILS_COLLAB_POLICY`):**\n\nControls how collaboration ops (`git push`, `git commit --amend`, `gh pr create`) are handled:\n\n- **`ask`** (default) — block unless a one-shot bypass token is present. The hook is non-interactive; in `ask` mode the assistant asks you yes/no, then reruns the command with the bypass token once.\n- **`allow`** — permit collaboration ops without a bypass token.\n- **`block`** — block collaboration ops unconditionally, even with a bypass token.\n\nInvalid values fall back to `ask`. Destructive operations (`checkout --`, `restore`, `reset --hard`, `clean -f`) are always blocked regardless of policy.\n\n**One-shot bypass (collaboration ops only):**\n\nTo override a single blocked collaboration command (`git push`, `git commit --amend`, `gh pr create`), prefix it with the bypass token:\n\n```bash\nLEAN4_GUARDRAILS_BYPASS=1 git push origin main\n```\n\nThe token must appear in the leading env-assignment prefix of the command (command prefix only, not an environment variable). Bypass is effective only in `ask` mode (default); it is unnecessary in `allow` mode and ignored in `block` mode. Destructive operations (`checkout --`, `restore`, `reset --hard`, `clean -f`) are always blocked — bypass does not apply to them.\n\n### LSP-First Approach\n\nLSP tools are **normative** (required first-pass), not merely preferred. Both prove and autoprove follow the [LSP-first protocol](skills/lean4/references/cycle-engine.md#lsp-first-protocol):\n\n```\nlean_goal(file, line)                           # See exact goal\nlean_local_search(\"keyword\")                    # Fast local + mathlib (unlimited)\nlean_leanfinder(\"goal or query\")                # Semantic, goal-aware (rate-limited)\nlean_leansearch(\"natural language\")             # Semantic search (rate-limited)\nlean_loogle(\"?a → ?b → _\")                      # Type-pattern (rate-limited)\nlean_multi_attempt(file, line, snippets=[...])  # Test multiple tactics\n```\n\nScripts provide sorry analysis, axiom checking, and search fallback when LSP is unavailable or LSP budget is exhausted. Compiler-guided repair is escalation-only — it triggers when compiler errors resist LSP-first tactics, not on first failure.\n\n## Environment Variables\n\nSet by `bootstrap.sh` at session start:\n\n| Variable | Purpose |\n|----------|---------|\n| `LEAN4_PLUGIN_ROOT` | Plugin installation path |\n| `LEAN4_SCRIPTS` | Scripts directory |\n| `LEAN4_REFS` | References directory |\n| `LEAN4_PYTHON_BIN` | Python interpreter |\n\nOptional user overrides (not set by bootstrap):\n\n| Variable | Purpose |\n|----------|---------|\n| `LEAN4_GUARDRAILS_DISABLE` | Skip all guardrails (set to `1`) |\n| `LEAN4_GUARDRAILS_FORCE` | Force guardrails outside Lean projects (set to `1`) |\n| `LEAN4_GUARDRAILS_COLLAB_POLICY` | Collaboration op policy: `ask`, `allow`, `block` |\n\n**Script troubleshooting:**\n```bash\necho \"$LEAN4_SCRIPTS\"\nls -l \"$LEAN4_SCRIPTS/sorry_analyzer.py\"\n${LEAN4_PYTHON_BIN:-python3} \"$LEAN4_SCRIPTS/sorry_analyzer.py\" . --format=summary --report-only\n```\n\nIf `$LEAN4_SCRIPTS` is unset, run `/lean4:doctor` to reinitialize.\n\n## File Structure\n\n```\nplugins/lean4/\n├── .claude-plugin/plugin.json\n├── commands/           # User-invocable commands\n├── skills/lean4/\n│   ├── SKILL.md        # Core skill reference\n│   └── references/     # Reference docs\n├── agents/             # 4 specialized agents\n├── hooks/              # Bootstrap and guardrails\n├── scripts/           # Compat alias → lib/scripts\n└── lib/scripts/        # 12 hard-primitive scripts\n```\n\n## Upgrading from V3\n\nSee [MIGRATION.md](MIGRATION.md) for upgrade guide.\n\n## See Also\n\n- [SKILL.md](skills/lean4/SKILL.md) - Core skill reference\n- [Commands](commands/) - Command documentation\n- [Scripts](lib/scripts/README.md) - Script reference\n- [Custom Syntax](skills/lean4/references/lean4-custom-syntax.md) - Notations, macros, elaborators, DSLs\n- [DSL Scaffold](skills/lean4/references/scaffold-dsl.md) - Copy-paste DSL template\n"
      },
      "plugins": [
        {
          "name": "lean4",
          "description": "Unified Lean 4 plugin (prove, autoprove, review, golf, checkpoint) — LSP-first, scripts fallback",
          "source": "./plugins/lean4",
          "categories": [],
          "install_commands": [
            "/plugin marketplace add cameronfreer/lean4-skills",
            "/plugin install lean4@lean4-skills"
          ]
        }
      ]
    }
  ]
}