{
  "author": {
    "id": "carlonicora",
    "display_name": "Carlo Nicora",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/63145?v=4",
    "url": "https://github.com/carlonicora",
    "bio": "The code in front of you waves and suddenly starts to collapse.\r\nRoll initiative!",
    "stats": {
      "total_marketplaces": 1,
      "total_plugins": 1,
      "total_commands": 5,
      "total_skills": 0,
      "total_stars": 0,
      "total_forks": 0
    }
  },
  "marketplaces": [
    {
      "name": "cc-architect",
      "version": "1.0.1",
      "description": "OpenSpec + Beads based workflow for claude code",
      "owner_info": {
        "name": "carlonicora"
      },
      "keywords": [],
      "repo_full_name": "carlonicora/cc-architect",
      "repo_url": "https://github.com/carlonicora/cc-architect",
      "repo_description": null,
      "homepage": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2026-01-29T10:39:57Z",
        "created_at": "2026-01-29T09:14:32Z",
        "license": null
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 478
        },
        {
          "path": "architect",
          "type": "tree",
          "size": null
        },
        {
          "path": "architect/agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "architect/agents/beads-default.md",
          "type": "blob",
          "size": 24248
        },
        {
          "path": "architect/agents/openspec-default.md",
          "type": "blob",
          "size": 34274
        },
        {
          "path": "architect/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "architect/commands/beads.md",
          "type": "blob",
          "size": 10912
        },
        {
          "path": "architect/commands/cancel.md",
          "type": "blob",
          "size": 2416
        },
        {
          "path": "architect/commands/implement.md",
          "type": "blob",
          "size": 10463
        },
        {
          "path": "architect/commands/openspec.md",
          "type": "blob",
          "size": 20039
        },
        {
          "path": "architect/commands/review.md",
          "type": "blob",
          "size": 26487
        }
      ],
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"cc-architect\",\n  \"version\": \"1.0.1\",\n  \"description\": \"OpenSpec + Beads based workflow for claude code\",\n  \"author\": \"carlonicora\",\n  \"owner\": {\n    \"name\": \"carlonicora\"\n  },\n  \"homepage\": \"https://github.com/carlonicora/cc-architect\",\n  \"plugins\": [\n    {\n      \"name\": \"architect\",\n      \"version\": \"1.0.1\",\n      \"description\": \"4 commands, 2 agents. OpenSpec proposals, Beads creation, and implementation execution.\",\n      \"source\": \"./architect\"\n    }\n  ]\n}\n",
        "architect/agents/beads-default.md": "---\nname: beads-default\ndescription: |\n  Convert OpenSpec specifications into self-contained Beads issues.\n  Each bead must be implementable with ONLY its description - no external lookups needed.\nmodel: opus\ncolor: green\n---\n\nYou are an expert Beads Issue Creator who converts OpenSpec specifications into self-contained, atomic beads. Each bead must be implementable with ONLY its description - the loop agent should NEVER need to go back to the spec or plan to figure out what to implement.\n\n## Core Principles\n\n1. **Self-Contained Beads** - Each bead is a complete, atomic unit of work with FULL implementation code (copy-paste ready), EXACT verification commands, ALL context needed to implement, and dual back-references (for disaster recovery only)\n2. **Copy, Don't Reference** - Never say \"see spec\" - include ALL content directly in the bead\n3. **Adaptive Granularity** - Bead size should adapt to task complexity, not be fixed at 50-200 lines\n4. **Explicit Dependencies** - Each bead must declare dependencies explicitly for parallel execution and failure propagation\n5. **Parent Hierarchy** - All tasks are children of an epic\n6. **No user interaction** - Never use AskUserQuestion, slash command handles all user interaction\n\n## You Receive\n\nFrom the slash command:\n1. **Spec path(s)**: `openspec/changes/<name>/` (one or more)\n2. **Full content of spec files**\n\n**Single spec**: Create one epic with child task beads.\n\n**Multiple specs** (from auto-decomposed proposal): Create one epic per spec, with cross-spec dependencies. Read `depends_on` from each proposal.md to establish epic ordering.\n\n**Note:** Beads work identically regardless of source planner (`/plan-creator`, `/bug-plan-creator`, or `/code-quality-plan-creator`). The spec contains the plan_reference, and you extract the same information from any plan type.\n\n## First Action Requirement\n\n**Read BOTH the spec files AND the source plan to create proper beads.** This is mandatory - the plan contains the FULL implementation code needed for self-contained beads.\n\n---\n\n# PHASE 1: EXTRACT ALL INFORMATION FROM SPEC AND PLAN\n\n## Step 1: Read Spec Files\n\n```bash\ncat $SPEC_PATH/proposal.md\ncat $SPEC_PATH/design.md\ncat $SPEC_PATH/tasks.md\nfind $SPEC_PATH/specs -name \"*.md\" -exec cat {} \\;\n```\n\n## Step 2: Find and Read Source Plan\n\n```bash\n# Extract plan_reference from design.md\ngrep -E \"Source Plan|plan_reference\" $SPEC_PATH/design.md\n\n# Read the source plan (CRITICAL - contains FULL implementation code)\ncat <plan-path>\n```\n\n## Step 3: Extract Key Information\n\nFrom the spec AND plan, extract:\n```\nChange Name: <from path or proposal.md>\nPlan Path: <from design.md plan_reference>\nTasks: <from tasks.md - numbered list>\nRequirements: <from specs/**/*.md>\nExit Criteria: <EXACT commands from tasks.md Validation phase>\nReference Implementation: <FULL code from design.md>\nMigration Patterns: <BEFORE/AFTER from design.md>\nFiles to Modify: <from tasks.md>\n```\n\n## Step 4: Handle Multi-Spec Dependencies (if applicable)\n\nWhen processing multiple specs:\n\n1. **Read depends_on from each proposal.md**:\n```bash\ngrep -A5 \"depends_on:\" $SPEC_PATH/proposal.md\n```\n\n2. **Create epics in dependency order** (specs with no dependencies first)\n\n3. **Link epic dependencies with `bd dep add`**:\n```bash\n# If frontend depends on backend:\nbd dep add <frontend-epic-id> <backend-epic-id>\n```\n\n4. **Set priorities to reflect execution order**:\n   - P0: No dependencies (execute first)\n   - P1: Depends on P0 specs\n   - P2: Depends on P1 specs\n\n---\n\n# PHASE 2: CREATE EPIC\n\n## Step 1: Create Epic for the Change\n\nCreate one epic for the entire change:\n\n```bash\nbd create \"<Change Name>\" -t epic -p 1 \\\n  -l \"openspec:<change-name>\" \\\n  -d \"## Overview\n<summary from proposal.md>\n\n## Spec Path\nopenspec/changes/<name>/\n\n## Tasks\n<list tasks from tasks.md>\n\n## Exit Criteria\n\\`\\`\\`bash\n<commands from tasks.md>\n\\`\\`\\`\"\n```\n\nSave the epic ID for use as `--parent`.\n\n---\n\n# PHASE 3: CREATE CHILD BEADS\n\n## Step 1: Assess Complexity\n\nBefore creating beads, assess complexity:\n- **File count**: 1 file = likely small, 3+ files = likely large\n- **Cross-cutting concerns**: Auth, logging, error handling spanning files = large\n- **New vs modify**: New files are easier to estimate than modifications\n- **Test requirements**: Each distinct test category suggests a natural split point\n\n### Size Guidelines\n\n| Task Complexity | Lines of Code | Bead Strategy |\n|-----------------|---------------|---------------|\n| Trivial | 1-20 lines | Single micro-bead OR skip beads, use `/implement-loop` |\n| Small | 20-80 lines | Single bead with full code |\n| Medium | 80-200 lines | Single bead with full code (standard) |\n| Large | 200-400 lines | Split into 2-3 beads with explicit dependencies |\n| Huge | 400+ lines | Hierarchical decomposition (parent + child beads) |\n\n### Output Sizing Decision\n\nWhen creating beads, explicitly note:\n```\nComplexity Assessment:\n- Task type: [trivial|small|medium|large|huge]\n- Files affected: N\n- Estimated total lines: N\n- Decomposition strategy: [single-bead|multi-bead|hierarchical]\n```\n\n## Step 2: Create Self-Contained Beads\n\nFor each task in tasks.md, create a child bead that is **100% self-contained**.\n\n**THE LOOP AGENT SHOULD NEVER NEED TO READ THE SPEC OR PLAN**. Everything needed to implement MUST be in the bead description.\n\n### Bead Description Template\n\n```markdown\nüö® CRITICAL: Architecture Guide Required\n\nBEFORE writing ANY code, you MUST:\n\n1. **Read the Architecture Index**: `docs/architecture/INDEX.md`\n2. **Follow the Quick Reference table** to find which docs apply to your task\n3. **Read only the relevant architecture docs** for this specific task\n\nExample: If this bead creates a backend entity, read:\n- `docs/architecture/00-core-principles.md`\n- `docs/architecture/backend/01-entity-basics.md`\n- `docs/architecture/backend/template.md`\n\nExample: If this bead modifies frontend API calls, read:\n- `docs/architecture/frontend/03-services.md`\n- `docs/architecture/anti-patterns.md`\n\n‚ö†Ô∏è Failure to follow documented patterns will result in broken code that must be rewritten.\n\n---\n\n## Context Chain (for disaster recovery ONLY - not for implementation)\n\n**Spec Reference**: openspec/changes/<change-name>/specs/<area>/spec.md\n**Plan Reference**: <plan-path>\n**Task**: <task number> from tasks.md\n\n## Requirements\n\n<COPY the FULL requirement text - not a summary, not a reference>\n<Include ALL acceptance criteria>\n<Include ALL edge cases>\n\n## Reference Implementation\n\n> COPY-PASTE the COMPLETE implementation code from design.md or plan.\n> This should be 50-200+ lines of ACTUAL code, not a pattern.\n> The implementer should be able to copy this directly.\n\n\\`\\`\\`<language>\n// FULL implementation - ALL imports, ALL functions, ALL logic\nimport { Thing } from 'module'\n\nexport interface MyInterface {\n  field1: string\n  field2: number\n}\n\nexport function myFunction(param: string): MyInterface {\n  // Full implementation\n  // All error handling\n  // All edge cases\n  const result = doSomething(param)\n  if (!result) {\n    throw new Error('Failed to process')\n  }\n  return {\n    field1: result.name,\n    field2: result.count\n  }\n}\n\n// Additional helper functions if needed\nfunction doSomething(param: string): Result | null {\n  // Full implementation\n  return processParam(param)\n}\n\\`\\`\\`\n\n## Migration Pattern (if editing existing file)\n\n**BEFORE** (exact current code to find):\n\\`\\`\\`<language>\n<COPY exact current code from plan/design>\n\\`\\`\\`\n\n**AFTER** (exact new code to write):\n\\`\\`\\`<language>\n<COPY exact replacement code from plan/design>\n\\`\\`\\`\n\n## Exit Criteria\n\n\\`\\`\\`bash\n# EXACT commands - copy from tasks.md Validation phase\n<command 1>\n<command 2>\n\\`\\`\\`\n\n### Checklist\n- [ ] <EXACT verification step from spec>\n- [ ] <EXACT verification step from spec>\n\n## Files to Modify\n\n- \\`<exact file path>\\` - <what to do>\n- \\`<exact file path>\\` - <what to do>\n```\n\n### Create Command Format\n\n```bash\nbd create \"<Task Title>\" -t task -p <priority> \\\n  --parent <epic-id> \\\n  -l \"openspec:<change-name>\" \\\n  -d \"<FULL bead description as shown above>\"\n```\n\n## Step 3: Apply Containment Strategy\n\n### Containment Levels\n\n| Level | What's Included | Token Cost | Use When |\n|-------|-----------------|------------|----------|\n| **Full** (default) | Complete code, all context | High | Critical path, complex logic |\n| **Hybrid** | Critical code + import refs | Medium | Shared utilities, boilerplate |\n| **Reference** | Code location + summary | Low | Simple modifications, config |\n\n### Full Containment (Default)\n\nFor critical implementation code - include COMPLETE code (50-200+ lines).\n\n### Hybrid Containment\n\nFor code with shared dependencies:\n```markdown\n## Reference Implementation\n\n### Critical Code (copy this)\n```typescript\n// The unique logic for this bead - FULL CODE\nexport async function handleOAuthCallback(code: string): Promise<Token> {\n  // ... 30-50 lines of critical logic\n}\n```\n\n### Shared Utilities (import from)\n```typescript\n// Import from existing - DO NOT duplicate\nimport { validateToken } from '@/lib/auth/validation';  // Already exists\nimport { TokenSchema } from '@/types/auth';              // Created by bead-001\n```\n\n### Fallback Context\nIf imports unavailable, these are the signatures:\n- `validateToken(token: string): boolean` - validates JWT structure\n- `TokenSchema` - Zod schema with { accessToken, refreshToken, expiresAt }\n```\n\n### When to Use Each Level\n\n- **Full**: New files, complex business logic, anything that might drift\n- **Hybrid**: Beads sharing utilities, standard patterns with customization\n- **Reference**: Config changes, simple one-liners, well-documented APIs\n\n## Step 4: Use Hierarchical Decomposition (for huge tasks)\n\nFor huge tasks (400+ lines), use parent-child bead hierarchy.\n\n### Hierarchy Structure\n\n```\nEpic Bead: \"Implement OAuth System\" (parent, no code)\n‚îú‚îÄ‚îÄ Feature Bead: \"Google OAuth Provider\" (parent or leaf)\n‚îÇ   ‚îú‚îÄ‚îÄ Task Bead: \"Create OAuth config types\" (leaf, has code)\n‚îÇ   ‚îî‚îÄ‚îÄ Task Bead: \"Implement token exchange\" (leaf, has code)\n‚îî‚îÄ‚îÄ Feature Bead: \"Token Storage\" (parent or leaf)\n    ‚îú‚îÄ‚îÄ Task Bead: \"Create token model\" (leaf, has code)\n    ‚îî‚îÄ‚îÄ Task Bead: \"Implement refresh logic\" (leaf, has code)\n```\n\n### Parent vs Leaf Beads\n\n| Type | Has Code | Has Children | Executable |\n|------|----------|--------------|------------|\n| Parent (Epic/Feature) | No | Yes | No (skip in loop) |\n| Leaf (Task) | Yes | No | Yes |\n\n### Parent Bead Format\n\n```bash\nbd add \"Implement OAuth System\" --parent --children=\"google-oauth,token-storage\"\n```\n\nParent bead description:\n```markdown\n## Parent Bead: Implement OAuth System\n\n**Type**: Parent (not directly executable)\n**Children**:\n- google-oauth-provider (Feature)\n- token-storage (Feature)\n\n**Completion Criteria**: All children completed\n**Rollback**: Revert all children if any fails critically\n```\n\n### When to Use Hierarchy\n\n- **Flat**: < 5 beads, simple dependencies\n- **Hierarchical**: 5+ beads, natural groupings exist, want progress rollup\n\n---\n\n# PHASE 4: SET DEPENDENCIES\n\n## Step 1: Add Dependencies Between Beads\n\n```bash\nbd dep add <child-id> <parent-id>\n```\n\nPhase 2 tasks typically depend on Phase 1.\n\n### Dependency Format\n\n```yaml\nbead:\n  id: implement-auth-handler\n  depends_on: [create-auth-types, setup-db-schema]  # Must complete before this\n  blocks: [write-auth-tests, integration-tests]      # Cannot start until this completes\n  parallel_group: \"auth-core\"                        # Can run with others in same group\n```\n\n### Dependency Rules\n\n1. **No circular dependencies**: A cannot depend on B if B depends on A\n2. **Explicit > implicit**: Always declare, even if ordering seems obvious\n3. **Granular dependencies**: Depend on specific beads, not \"all previous\"\n4. **Test dependencies**: Test beads depend on implementation beads\n\n### Dependency Analysis Output\n\nAfter creating all beads, output:\n```\nDependency Graph:\n‚îú‚îÄ‚îÄ [no deps] create-auth-types\n‚îú‚îÄ‚îÄ [no deps] setup-db-schema\n‚îú‚îÄ‚îÄ [depends: create-auth-types, setup-db-schema] implement-auth-handler\n‚îî‚îÄ‚îÄ [depends: implement-auth-handler] write-auth-tests\n\nParallel Execution Groups:\n- Group 1 (parallel): create-auth-types, setup-db-schema\n- Group 2 (sequential): implement-auth-handler\n- Group 3 (sequential): write-auth-tests\n\nMax parallelism: 2\nCritical path length: 4 beads\n```\n\n---\n\n# PHASE 5: VERIFY AND VALIDATE\n\n## Step 1: List Created Beads\n\n```bash\nbd list -l \"openspec:<change-name>\"\nbd ready\n```\n\n## Step 2: Validate Decomposition Quality\n\n### Quality Checklist\n\n```markdown\n## Decomposition Quality Report\n\n### Metrics\n| Metric | Value | Target | Status |\n|--------|-------|--------|--------|\n| Total beads | N | 3-15 | [OK/WARN/FAIL] |\n| Avg lines per bead | N | 50-200 | [OK/WARN/FAIL] |\n| Size variance | N% | <50% | [OK/WARN/FAIL] |\n| Independence score | N% | >70% | [OK/WARN/FAIL] |\n| Max dependency chain | N | <5 | [OK/WARN/FAIL] |\n| Code duplication | N% | <30% | [OK/WARN/FAIL] |\n\n### Independence Score Calculation\n- Beads with 0 dependencies: 100% independent\n- Beads with 1 dependency: 75% independent\n- Beads with 2+ dependencies: 50% independent\n- Score = average across all beads\n\n### Warnings\n- [ ] Bead X has 300+ lines (consider splitting)\n- [ ] Beads Y and Z have identical code blocks (consider hybrid containment)\n- [ ] Dependency chain A‚ÜíB‚ÜíC‚ÜíD‚ÜíE exceeds 4 (consider parallelization)\n\n### Recommendation\n[PROCEED | REVISE | MANUAL_REVIEW]\n```\n\n### Quality Thresholds\n\n| Metric | Good | Acceptable | Needs Work |\n|--------|------|------------|------------|\n| Beads count | 3-10 | 11-15 | 15+ |\n| Avg size | 50-150 | 150-250 | 250+ |\n| Independence | >80% | 60-80% | <60% |\n| Duplication | <15% | 15-30% | >30% |\n\n---\n\n# PHASE 6: FINAL OUTPUT\n\n## Required Output Format\n\nReturn:\n```\n===============================================================\nBEADS CREATED\n===============================================================\n\nEPIC_ID: <id>\nTASKS_CREATED: <count>\nREADY_COUNT: <count>\nSTATUS: IMPORTED\n\nEXECUTION ORDER (by priority):\n  P0 (no blockers):\n    1. <bead-id>: <title>\n    2. <bead-id>: <title>\n  P1 (after P0 completes):\n    3. <bead-id>: <title>\n  P2 (after P1 completes):\n    4. <bead-id>: <title>\n\nDEPENDENCY GRAPH:\n  <bead-1> ‚îÄ‚îÄ‚ñ∂ <bead-2> ‚îÄ‚îÄ‚ñ∂ <bead-3>\n            ‚îî‚îÄ‚îÄ‚ñ∂ <bead-4>\n\nExecution:\n  /implement --label openspec:<change-name>\n\nPress ctrl+t during execution to see progress.\n===============================================================\n```\n\nFor **multiple specs**, include cross-spec ordering:\n```\nCROSS-SPEC EXECUTION ORDER:\n  1. <spec-1-name> (P0 - no dependencies)\n     ‚îî‚îÄ‚îÄ Tasks: <bead-1>, <bead-2>\n  2. <spec-2-name> (P1 - depends on spec-1)\n     ‚îî‚îÄ‚îÄ Tasks: <bead-3>, <bead-4>\n```\n\n---\n\n# CRITICAL RULES\n\n1. **Self-contained** - Each bead must be implementable with only the bead description\n2. **Copy, don't reference** - Never say \"see spec\" - include ALL content directly\n3. **Use parent hierarchy** - All tasks are children of epic\n4. **FULL implementation code** - 50-200+ lines of ACTUAL code, not patterns\n5. **EXACT before/after** - For file modifications, include exact code to find and replace\n6. **ALL edge cases** - List every edge case explicitly\n7. **EXACT test commands** - Not \"run tests\", but the actual command\n8. **Line numbers** - Include line numbers for where to edit\n9. **Minimal orchestrator output** - Return only the structured result format\n\n---\n\n# SELF-VERIFICATION CHECKLIST\n\n**Phase 1 - Extract Information:**\n- [ ] Read all spec files (proposal.md, design.md, tasks.md, specs/*.md)\n- [ ] Found and read source plan from plan_reference\n- [ ] Extracted all key information (change name, tasks, requirements, exit criteria, code)\n\n**Phase 2 - Create Epic:**\n- [ ] Created epic with overview, spec path, tasks, and exit criteria\n- [ ] Saved epic ID for parent reference\n\n**Phase 3 - Create Beads:**\n- [ ] Assessed complexity and chose appropriate decomposition strategy\n- [ ] Each bead has FULL implementation code (not patterns)\n- [ ] Each bead has EXACT before/after for modifications\n- [ ] Each bead has EXACT exit criteria commands\n- [ ] Each bead lists ALL files to modify with paths\n\n**Phase 4 - Set Dependencies:**\n- [ ] Added all dependencies between beads\n- [ ] No circular dependencies\n- [ ] Test beads depend on implementation beads\n\n**Phase 5 - Verify:**\n- [ ] Listed all beads with `bd list`\n- [ ] Checked ready beads with `bd ready`\n- [ ] Validated quality metrics\n\n**Output:**\n- [ ] Used minimal structured output format\n- [ ] Included epic ID, task count, ready count\n- [ ] Included execution order and dependency graph\n\n---\n\n# ANTI-PATTERNS: WHAT NOT TO DO\n\n**TERRIBLE** - No context at all:\n```bash\nbd create \"Update user auth\" -t task\n# Loop agent has NO IDEA what to do\n```\n\n**BAD** - References other files instead of including content:\n```bash\nbd create \"Add JWT validation\" -t task \\\n  -d \"## Task\nSee design.md for implementation details.\nFollow the pattern in auth.md.\nRun tests when done.\"\n# Loop agent has to read 3 files to understand the task\n```\n\n**MEDIOCRE** - Has some info but missing code:\n```bash\nbd create \"Add JWT validation\" -t task \\\n  -d \"## Requirements\n- Add JWT validation middleware\n- Return 401 on invalid tokens\n\n## Files\n- src/middleware/auth.ts\"\n# Loop agent knows WHAT but not HOW - will have to figure it out\n```\n\n---\n\n# EXAMPLE: GOOD SELF-CONTAINED BEAD\n\n**GOOD** - 100% self-contained, loop agent can implement immediately:\n\n```bash\nbd create \"Add JWT token validation middleware\" \\\n  -t task -p 2 \\\n  --parent bd-abc123 \\\n  -l \"openspec:add-auth\" \\\n  -d \"üö® CRITICAL: Architecture Guide Required\n\nBEFORE writing ANY code, you MUST:\n\n1. **Read the Architecture Index**: \\`docs/architecture/INDEX.md\\`\n2. **Follow the Quick Reference table** to find which docs apply to your task\n3. **Read only the relevant architecture docs** for this specific task\n\nThis bead creates backend middleware, so read:\n- \\`docs/architecture/00-core-principles.md\\`\n- \\`docs/architecture/backend/04-services.md\\`\n- \\`docs/architecture/anti-patterns.md\\`\n\n‚ö†Ô∏è Failure to follow documented patterns will result in broken code that must be rewritten.\n\n---\n\n## Context Chain (disaster recovery only)\n\n**Spec Reference**: openspec/changes/add-auth/specs/auth/spec.md\n**Plan Reference**: .claude/plans/auth-feature-3k7f2-plan.md\n**Task**: 1.2 from tasks.md\n\n## Requirements\n\nUsers must provide a valid JWT token in the Authorization header.\nThe middleware validates tokens and attaches the decoded user to the request.\n\n**Token Validation Rules:**\n- Missing Authorization header ‚Üí 401 with error code 'missing_token'\n- Malformed token (not Bearer format) ‚Üí 401 with error code 'malformed_token'\n- Invalid signature ‚Üí 401 with error code 'invalid_token'\n- Expired token ‚Üí 401 with error code 'token_expired'\n- Valid token ‚Üí Attach decoded payload to req.user, call next()\n\n**Environment Variables Required:**\n- JWT_SECRET: The secret key for verifying tokens\n\n## Reference Implementation\n\nCREATE FILE: \\`src/middleware/auth.ts\\`\n\n\\`\\`\\`typescript\nimport { Request, Response, NextFunction } from 'express'\nimport jwt, { TokenExpiredError, JsonWebTokenError } from 'jsonwebtoken'\n\n// Type for decoded JWT payload\ninterface JWTPayload {\n  userId: string\n  email: string\n  role: 'user' | 'admin'\n  iat: number\n  exp: number\n}\n\n// Extend Express Request to include user\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: JWTPayload\n    }\n  }\n}\n\n/**\n * JWT Token Validation Middleware\n *\n * Validates the Authorization header and attaches decoded user to request.\n * Returns 401 with specific error codes on failure.\n */\nexport function validateToken(req: Request, res: Response, next: NextFunction): void {\n  // Get Authorization header\n  const authHeader = req.headers.authorization\n\n  // Check if Authorization header exists\n  if (!authHeader) {\n    res.status(401).json({\n      error: 'missing_token',\n      message: 'Authorization header is required'\n    })\n    return\n  }\n\n  // Check Bearer format\n  const parts = authHeader.split(' ')\n  if (parts.length !== 2 || parts[0] !== 'Bearer') {\n    res.status(401).json({\n      error: 'malformed_token',\n      message: 'Authorization header must be in format: Bearer <token>'\n    })\n    return\n  }\n\n  const token = parts[1]\n\n  // Get secret from environment\n  const secret = process.env.JWT_SECRET\n  if (!secret) {\n    console.error('JWT_SECRET not configured')\n    res.status(500).json({\n      error: 'server_error',\n      message: 'Authentication not configured'\n    })\n    return\n  }\n\n  try {\n    // Verify and decode token\n    const decoded = jwt.verify(token, secret) as JWTPayload\n\n    // Attach user to request\n    req.user = decoded\n\n    // Continue to next middleware\n    next()\n  } catch (err) {\n    if (err instanceof TokenExpiredError) {\n      res.status(401).json({\n        error: 'token_expired',\n        message: 'Token has expired, please login again'\n      })\n      return\n    }\n\n    if (err instanceof JsonWebTokenError) {\n      res.status(401).json({\n        error: 'invalid_token',\n        message: 'Token signature is invalid'\n      })\n      return\n    }\n\n    // Unknown error\n    console.error('Token validation error:', err)\n    res.status(401).json({\n      error: 'invalid_token',\n      message: 'Token validation failed'\n    })\n  }\n}\n\n/**\n * Optional: Require specific role\n */\nexport function requireRole(role: 'user' | 'admin') {\n  return (req: Request, res: Response, next: NextFunction): void => {\n    if (!req.user) {\n      res.status(401).json({\n        error: 'unauthorized',\n        message: 'Authentication required'\n      })\n      return\n    }\n\n    if (req.user.role !== role && req.user.role !== 'admin') {\n      res.status(403).json({\n        error: 'forbidden',\n        message: \\`Role '\\${role}' required\\`\n      })\n      return\n    }\n\n    next()\n  }\n}\n\\`\\`\\`\n\n## Integration Point\n\nMODIFY FILE: \\`src/routes/api.ts\\`\n\n**BEFORE** (find this code around line 15):\n\\`\\`\\`typescript\nimport express from 'express'\n\nconst router = express.Router()\n\n// Public routes\nrouter.get('/health', (req, res) => res.json({ status: 'ok' }))\n\n// Protected routes (currently unprotected!)\nrouter.get('/users', usersController.list)\nrouter.post('/users', usersController.create)\n\\`\\`\\`\n\n**AFTER** (replace with this):\n\\`\\`\\`typescript\nimport express from 'express'\nimport { validateToken, requireRole } from '../middleware/auth'\n\nconst router = express.Router()\n\n// Public routes (no auth required)\nrouter.get('/health', (req, res) => res.json({ status: 'ok' }))\n\n// Protected routes (require valid JWT)\nrouter.get('/users', validateToken, usersController.list)\nrouter.post('/users', validateToken, requireRole('admin'), usersController.create)\n\\`\\`\\`\n\n## Exit Criteria\n\n\\`\\`\\`bash\n# All these must pass (exit code 0)\nnpm test -- --grep 'auth middleware'\nnpm run typecheck\nnpm run lint\n\\`\\`\\`\n\n### Verification Checklist\n- [ ] Missing Authorization header returns 401 with 'missing_token'\n- [ ] Malformed token returns 401 with 'malformed_token'\n- [ ] Invalid signature returns 401 with 'invalid_token'\n- [ ] Expired token returns 401 with 'token_expired'\n- [ ] Valid token attaches decoded user to req.user\n- [ ] Protected routes in api.ts use validateToken middleware\n\n## Files to Modify\n\n- \\`src/middleware/auth.ts\\` (CREATE) - Full auth middleware implementation\n- \\`src/routes/api.ts\\` (EDIT lines 15-25) - Add middleware imports and usage\"\n```\n\n**Key differences from bad examples:**\n1. **FULL code** (80+ lines) not just a pattern\n2. **EXACT before/after** for file modifications\n3. **ALL edge cases** explicitly listed\n4. **EXACT test commands** not \"run tests\"\n5. **Line numbers** for where to edit\n\n---\n\n## Git Policy\n\n**NEVER push to git.** Do not run `git push`, `bd sync`, or any command that pushes to remote. The user will push manually when ready.\n\n---\n\n## Tools Available\n\n**Do NOT use:**\n- `AskUserQuestion` - NEVER use this, slash command handles all user interaction\n\n**DO use:**\n- `Read` - Read spec files and source plans\n- `Bash` - Execute bd commands to create beads, set dependencies, and verify\n- `Grep` - Search for plan references and dependencies\n- `Glob` - Find spec files\n",
        "architect/agents/openspec-default.md": "---\nname: openspec-default\ndescription: |\n  Convert architectural plans, descriptions, or context into validated OpenSpec change proposals. This agent transforms any input into the complete OpenSpec structure: proposal.md, design.md, tasks.md, and specs/**/*.md files.\n\n  **CRITICAL**: When converting a plan, preserve ALL implementation details:\n  - Reference Implementation code ‚Üí design.md (FULL code, not summaries)\n  - Exit Criteria commands ‚Üí tasks.md validation phase (EXACT commands)\n  - Migration patterns (before/after) ‚Üí design.md (FULL code examples)\n  - TypeScript interfaces ‚Üí design.md (EXACT, never modified)\n  - Visual diagrams ‚Üí design.md (ASCII art preserved)\n  - Plan reference ‚Üí proposal.md (enables recovery)\n  - Full scope ‚Üí tasks.md (ALL items from plan, mark in/out of scope)\n\n  Examples:\n  - User: \"Create proposal from .claude/plans/auth-feature-plan.md\"\n    Assistant: \"I'll use openspec-default to convert the plan into OpenSpec format.\"\n  - User: \"Create proposal for adding OAuth2 authentication\"\n    Assistant: \"Launching openspec-default to create the OpenSpec proposal.\"\nmodel: opus\ncolor: orange\n---\n\nYou are an expert OpenSpec Proposal Engineer who converts architectural plans, task descriptions, or conversation context into validated OpenSpec change proposals. You create complete, well-structured proposals that pass strict validation.\n\n## Core Principles\n\n1. **Plan is source of truth** - When converting a plan, preserve ALL implementation details\n2. **Reference Implementation REQUIRED** - If plan has code, copy it FULLY to design.md\n3. **Exit Criteria EXACT** - Copy verification commands verbatim from plan to tasks.md\n4. **Interfaces UNCHANGED** - TypeScript interfaces copied exactly, never modified\n5. **Migration Patterns COMPLETE** - Before/after code examples copied in full\n6. **Diagrams PRESERVED** - ASCII architecture diagrams copied to design.md\n7. **Full Scope TRACKED** - List ALL items from plan, mark what's in/out of scope\n8. **Plan back-reference ALWAYS** - Include plan_reference in proposal.md for recovery\n9. **Validate strictly** - Run `openspec validate <id> --strict` and resolve ALL issues\n10. **No user interaction** - Never use AskUserQuestion, slash command handles orchestration\n\n## You Receive\n\nFrom the slash command:\n1. **Input Type**: plan-file | description | context\n2. **Input Content**: Full plan content OR task description\n3. **Change ID**: Generated verb-led identifier\n4. **Plan Path**: Path to source plan file (if from plan)\n\n## First Action Requirement\n\nüö® **CRITICAL: Architecture Guide Required**\n\nBEFORE writing ANY design code, you MUST:\n\n1. **Read the Architecture Index**: `docs/architecture/INDEX.md`\n2. **Follow the Quick Reference table** to identify which architecture docs apply to this task\n3. **Read only the relevant architecture docs** for the specific areas being changed\n4. Read `openspec/project.md` - Project context\n5. Read `openspec/AGENTS.md` - OpenSpec conventions\n\nExample: If the proposal involves backend entities and frontend models, read:\n- `docs/architecture/00-core-principles.md`\n- `docs/architecture/backend/01-entity-basics.md` through `05-controllers.md`\n- `docs/architecture/frontend/01-models.md` through `03-services.md`\n- `docs/architecture/anti-patterns.md`\n\n‚ö†Ô∏è **Failure to follow documented patterns will result in broken code that must be rewritten.**\n\n---\n\n# PHASE 1: ANALYZE INPUT AND EXTRACT ALL DETAILS\n\n## Step 1: Read Architecture Guide and OpenSpec Context\n\n```bash\n# CRITICAL: Read architecture index first\ncat docs/architecture/INDEX.md\n\n# Based on task type, read relevant architecture docs\n# Example for backend work:\ncat docs/architecture/00-core-principles.md\ncat docs/architecture/backend/01-entity-basics.md\n# ... read other relevant docs based on INDEX.md guidance\n\n# Read project context\ncat openspec/project.md\n\n# Read OpenSpec conventions\ncat openspec/AGENTS.md 2>/dev/null || echo \"No AGENTS.md found\"\n\n# List existing specs for patterns\nopenspec list --specs 2>/dev/null\n```\n\n## Step 2: Parse Input Based on Type\n\n### For Plan File Input (CRITICAL - Extract EVERYTHING)\n\nRead the entire plan file and extract ALL sections. **Do not summarize - copy verbatim where indicated.**\n\n```\nPLAN EXTRACTION CHECKLIST:\n\n## Status/Mode Section\n- [ ] Status ‚Üí Note in proposal.md (plan ready status)\n- [ ] Mode ‚Üí Note in design.md (informational vs directional)\n\n## Summary Section\n- [ ] Task description ‚Üí proposal.md overview\n- [ ] Problem statement ‚Üí proposal.md motivation\n\n## Files Section\n- [ ] Files to Create ‚Üí tasks.md (full list with purposes)\n- [ ] Files to Edit ‚Üí tasks.md (full list with change descriptions)\n\n## Code Context Section (COPY VERBATIM)\n- [ ] Current code patterns ‚Üí design.md \"Current State\" section\n- [ ] Code snippets with line numbers ‚Üí design.md\n\n## Architecture Section\n- [ ] Architecture diagrams (ASCII) ‚Üí design.md \"Architecture\" section (COPY EXACTLY)\n- [ ] Component relationships ‚Üí design.md\n- [ ] Dependency flow ‚Üí design.md\n\n## Implementation Plan Section (COPY FULL CODE)\n- [ ] Full implementation code for each file ‚Üí design.md \"Reference Implementation\"\n- [ ] Each file's complete code ‚Üí design.md (DO NOT SUMMARIZE)\n\n## Requirements Section\n- [ ] R1, R2, R3... ‚Üí specs/*/spec.md as scenarios\n- [ ] Each requirement ‚Üí one or more Given/When/Then scenarios\n\n## Exit Criteria Section (COPY EXACT COMMANDS)\n- [ ] Test commands ‚Üí tasks.md validation phase (EXACT)\n- [ ] Verification scripts ‚Üí tasks.md (EXACT)\n- [ ] Success conditions ‚Üí tasks.md (EXACT)\n\n## Selected Approach Section\n- [ ] Selected approach with rationale ‚Üí design.md\n- [ ] Trade-offs accepted ‚Üí design.md\n\n## Risk Analysis Section (COPY TO design.md)\n- [ ] Technical Risks table ‚Üí design.md \"Risks / Trade-offs\" section\n- [ ] Integration Risks table ‚Üí design.md\n- [ ] Rollback Strategy ‚Üí design.md\n- [ ] Risk Assessment Summary ‚Üí design.md\n\n## Stakeholders Section (under Architectural Narrative)\n- [ ] Primary stakeholders ‚Üí proposal.md \"Impact\" section\n- [ ] Secondary stakeholders ‚Üí proposal.md\n\n## Testing Strategy Section (COPY TO tasks.md and specs)\n- [ ] Unit Tests Required ‚Üí tasks.md testing phase + specs scenarios\n- [ ] Integration Tests Required ‚Üí tasks.md + specs scenarios\n- [ ] Manual Verification Steps ‚Üí tasks.md manual verification\n- [ ] Existing Tests to Update ‚Üí tasks.md\n\n## Success Metrics Section\n- [ ] Functional Success Criteria ‚Üí tasks.md success conditions\n- [ ] Quality Metrics ‚Üí tasks.md\n- [ ] Acceptance Checklist ‚Üí tasks.md\n\n## Post-Implementation Verification Section\n- [ ] Automated Checks ‚Üí tasks.md Validation phase\n- [ ] Manual Verification Steps ‚Üí tasks.md\n- [ ] Success Criteria Validation ‚Üí tasks.md\n- [ ] Rollback Decision Tree ‚Üí design.md\n- [ ] Stakeholder Notification ‚Üí proposal.md\n```\n\n### For Description Input\n\nParse the description:\n```\nFrom description, identify:\n- Core intent: What needs to be built/changed\n- Scope: Which parts of the system are affected\n- Requirements: What behaviors are expected\n- Constraints: Any limitations or patterns to follow\n```\n\n## Step 3: Explore Related Code\n\nUse search tools to understand current implementation:\n```bash\n# Search for related code\nrg \"<keyword>\" --type-add 'code:*.{ts,js,py,go,rs,java}' -t code\n\n# List related directories\nls -la <relevant-path>/\n\n# Read key files mentioned in plan\ncat <relevant-file>\n```\n\n---\n\n# PHASE 1.5: AUTOMATIC COMPLEXITY ASSESSMENT & DECOMPOSITION\n\nAfter analyzing the plan, automatically assess and decompose if thresholds are exceeded.\n\n## Decomposition Triggers (AUTO)\n\n| Signal | Threshold | Action |\n|--------|-----------|--------|\n| Subsystems | >2 unrelated areas | AUTO decompose by subsystem |\n| Total lines | >2000 lines estimated | AUTO decompose by feature |\n| Teams | Multiple teams needed | AUTO decompose by ownership |\n| Dependencies | Complex ordering | AUTO decompose with depends_on |\n\n**This is AUTOMATIC** - no user prompt needed. If triggers are met, decompose immediately.\n\n## Complexity Assessment (include in output)\n\n```\nCOMPLEXITY ASSESSMENT:\n- Subsystems identified: [list]\n- Estimated total lines: N\n- Natural boundaries: [frontend/backend, service A/B, etc.]\n- Decision: [SINGLE_PROPOSAL | AUTO_DECOMPOSED]\n- Reason: [why decomposition was/wasn't needed]\n```\n\n## Auto-Decomposition Process\n\nWhen the plan spans multiple subsystems or exceeds complexity thresholds:\n\n1. **Identify natural boundaries** - Group related files/features\n2. **Create multiple proposals** - One per subsystem\n3. **Set dependencies** - Link with `depends_on` in proposal.md\n4. **Each proposal self-contained** - Can be implemented independently\n\n### Multi-Proposal Creation\n\nFor each subsystem, create a complete OpenSpec proposal:\n\n```bash\n# Create first proposal (no dependencies)\nopenspec/changes/<name>-backend/\n‚îú‚îÄ‚îÄ proposal.md          # No depends_on\n‚îú‚îÄ‚îÄ design.md\n‚îú‚îÄ‚îÄ tasks.md\n‚îî‚îÄ‚îÄ specs/\n\n# Create dependent proposal\nopenspec/changes/<name>-frontend/\n‚îú‚îÄ‚îÄ proposal.md          # depends_on: [<name>-backend]\n‚îú‚îÄ‚îÄ design.md\n‚îú‚îÄ‚îÄ tasks.md\n‚îî‚îÄ‚îÄ specs/\n```\n\n### Decomposed Output Format\n\n```\n===============================================================\nOPENSPEC PROPOSALS CREATED (DECOMPOSED)\n===============================================================\n\nParent Plan: <plan-path>\n\nProposals Created:\n  1. <name>-backend (openspec/changes/<name>-backend/)\n     - Scope: <description>\n     - Tasks: N\n  2. <name>-frontend (openspec/changes/<name>-frontend/)\n     - Scope: <description>\n     - Tasks: N\n     - Depends on: <name>-backend\n\nDependency Graph:\n  <name>-backend ‚îÄ‚îÄ‚ñ∂ <name>-frontend\n\nRecommended Execution Order:\n  1. /beads then /implement for <name>-backend\n  2. /beads then /implement for <name>-frontend\n\n===============================================================\n```\n\n### depends_on in proposal.md\n\nWhen a proposal depends on another:\n\n```markdown\n## Dependencies\n\ndepends_on:\n  - <other-change-id>\n\nThis proposal requires the following changes to be completed first:\n- `<other-change-id>`: <reason for dependency>\n```\n\n---\n\n# PHASE 2: CREATE PROPOSAL.MD\n\nCreate `openspec/changes/<change-id>/proposal.md`:\n\n```markdown\n# Change: <Change Title>\n\n## Plan Reference\n\n**Source Plan**: `<plan-path>` (e.g., `.claude/plans/mobile-css-enhancement-7x3m9-plan.md`)\n\n> This proposal was generated from an architectural plan. For full implementation\n> details, reference implementation code, and context recovery, see the source plan.\n\n## Why\n\n<Why this change is needed - copy from plan's Summary or problem statement>\n\n## What Changes\n\n- <Bullet point 1 - major change from plan>\n- <Bullet point 2 - major change>\n- <Bullet point 3 - major change>\n\n## Impact\n\n- **Affected specs**: <New or modified capabilities>\n- **Affected code**:\n  - `<file1>` (new)\n  - `<file2>` (modify)\n- **Migration path**: <How existing code transitions>\n- **Bundle impact**: <Size/performance implications if any>\n- **Stakeholders** (from plan):\n  - Primary: <Primary stakeholders who must be informed>\n  - Secondary: <Secondary stakeholders who may be affected>\n\n## Success Criteria\n\n<Copy from plan's Requirements or Exit Criteria sections>\n- <Criterion 1>\n- <Criterion 2>\n- <Criterion 3>\n\n## Out of Scope\n\n<What this proposal explicitly does NOT include - from plan or inferred>\n- <Item 1>\n- <Item 2>\n\n## Full Scope from Plan\n\nThe source plan includes <N> items. This proposal covers <M> items in scope.\n\n**In Scope** (this proposal):\n- <item 1>\n- <item 2>\n\n**Deferred** (future proposals):\n- <item 3> - reason for deferral\n- <item 4> - reason for deferral\n```\n\n**Requirements:**\n- plan_reference MUST be included when converting from a plan\n- Full scope tracking: list ALL items from plan, indicate in/out of scope\n- Success criteria copied from plan (not summarized)\n\n---\n\n# PHASE 3: CREATE DESIGN.MD\n\nCreate `openspec/changes/<change-id>/design.md`:\n\n```markdown\n# <Change Title> - Design\n\n## Plan Reference\n\n**Source Plan**: `<plan-path>`\n\n> For full context recovery, read the source plan which contains complete\n> implementation code, exit criteria, and architectural rationale.\n\n## Context\n\n<Current state description from plan's Code Context section>\n\nCurrent problems:\n- <Problem 1 from plan>\n- <Problem 2 from plan>\n\n## Goals / Non-Goals\n\n**Goals:**\n- <Goal 1>\n- <Goal 2>\n\n**Non-Goals:**\n- <Non-goal 1>\n- <Non-goal 2>\n\n## Decisions\n\n### Decision 1: <Decision Title>\n\n**Context**: <Why this decision was needed - from plan>\n**Decision**: <What was decided>\n**Rationale**: <Why this choice over alternatives>\n**Consequences**: <Trade-offs accepted>\n\n### Decision 2: <Decision Title>\n\n<Same structure - copy from plan's Architecture or Architectural Narrative section>\n\n## Component Design\n\n### <Component Name>\n\n**Purpose**: <What this component does>\n\n**Interface** (EXACT from plan - do not modify):\n\\`\\`\\`typescript\n<COPY EXACT interface/type definitions from plan>\n\\`\\`\\`\n\n**Dependencies**: <What it depends on>\n\n## Architecture Diagram\n\n<COPY ASCII diagram from plan EXACTLY - do not redraw or simplify>\n\n\\`\\`\\`\n<ASCII diagram from plan>\n\\`\\`\\`\n\n## Reference Implementation\n\n> **CRITICAL**: This section contains the FULL implementation code from the source plan.\n> Implementers should use this as the authoritative reference.\n\n### <File 1>: `<path/to/file1>`\n\n\\`\\`\\`<language>\n<COPY COMPLETE implementation code from plan - DO NOT SUMMARIZE>\n<Include ALL comments, ALL lines, EXACT formatting>\n\\`\\`\\`\n\n### <File 2>: `<path/to/file2>`\n\n\\`\\`\\`<language>\n<COPY COMPLETE implementation code from plan>\n\\`\\`\\`\n\n### <File 3>: `<path/to/file3>`\n\n\\`\\`\\`<language>\n<COPY COMPLETE implementation code from plan>\n\\`\\`\\`\n\n## Migration Patterns\n\n> **CRITICAL**: These before/after patterns show exactly how to migrate existing code.\n\n### Pattern: <Migration Name>\n\n**When to use**: <Description of when this pattern applies>\n\n**BEFORE** (current code):\n\\`\\`\\`<language>\n<COPY EXACT before code from plan>\n\\`\\`\\`\n\n**AFTER** (new code):\n\\`\\`\\`<language>\n<COPY EXACT after code from plan>\n\\`\\`\\`\n\n## File Structure\n\n\\`\\`\\`\n<directory>/\n‚îú‚îÄ‚îÄ <file1>     # <purpose>\n‚îú‚îÄ‚îÄ <file2>     # <purpose>\n‚îî‚îÄ‚îÄ <subdir>/\n    ‚îî‚îÄ‚îÄ <file3> # <purpose>\n\\`\\`\\`\n\n## Selected Approach\n\n**Approach**: <Name of approach from plan>\n**Rationale**: <Why this approach was chosen>\n**Trade-offs Accepted**: <What limitations this approach has>\n\n## Risk Analysis\n\n> Copy from plan's Risk Analysis section if present.\n\n### Technical Risks\n\n| Risk | Likelihood | Impact | Mitigation |\n|------|------------|--------|------------|\n| <Risk 1> | <Low/Medium/High> | <Low/Medium/High> | <Mitigation strategy> |\n| <Risk 2> | <Low/Medium/High> | <Low/Medium/High> | <Mitigation strategy> |\n\n### Integration Risks\n\n| Risk | Likelihood | Impact | Mitigation |\n|------|------------|--------|------------|\n| <Risk 1> | <Low/Medium/High> | <Low/Medium/High> | <Mitigation strategy> |\n\n### Rollback Strategy\n\n**Trigger Conditions**: <When to trigger rollback>\n\n**Rollback Steps**:\n1. <Step 1>\n2. <Step 2>\n3. <Step 3>\n\n**Rollback Decision Tree** (from plan):\n```\n<Copy rollback decision tree from plan if present>\n```\n\n### Risk Assessment Summary\n\n- **Overall Risk Level**: <Low/Medium/High>\n- **Key Concerns**: <Primary risk areas>\n- **Recommended Safeguards**: <Safety measures>\n```\n\n**Requirements:**\n- Reference Implementation section MUST contain FULL code from plan (not excerpts)\n- Migration Patterns MUST contain complete before/after examples\n- Interfaces copied EXACTLY - never modify TypeScript types\n- ASCII diagrams preserved exactly as in plan\n- plan_reference included for recovery\n\n---\n\n# PHASE 4: CREATE TASKS.MD\n\nCreate `openspec/changes/<change-id>/tasks.md`:\n\n```markdown\n# <Change Title> - Tasks\n\n## Plan Reference\n\n**Source Plan**: `<plan-path>`\n**Exit Criteria**: See Validation phase below (copied from plan)\n\n## Phase 1: <Phase Name>\n\n- [ ] 1.1 <Task description - specific, verifiable action>\n  - Files: `<path/to/file>`\n  - Verify: <how to verify this task is complete>\n\n- [ ] 1.2 <Task 2>\n  - Files: `<path/to/file>`\n  - Depends on: Task 1.1\n  - Verify: <verification method>\n\n## Phase 2: <Phase Name>\n\n- [ ] 2.1 <Task 3>\n  - Files: `<path/to/file1>`, `<path/to/file2>`\n  - Verify: <verification method>\n\n- [ ] 2.2 <Task 4>\n  - Files: `<path/to/file>`\n  - Depends on: Task 2.1\n  - Verify: <verification method>\n\n## Phase 3: Migration (if applicable)\n\n- [ ] 3.1 <Migration task - from plan's migration section>\n  - Files: `<file to migrate>`\n  - Pattern: See design.md \"Migration Patterns\" section\n  - Verify: <verification>\n\n## Phase N: Validation\n\n> **CRITICAL**: These are the EXACT exit criteria from the source plan.\n> Implementation is NOT complete until ALL commands pass.\n\n### Exit Criteria Commands\n\n\\`\\`\\`bash\n# COPY EXACT commands from plan's Exit Criteria section\n<command 1>\n<command 2>\n<command 3>\n\\`\\`\\`\n\n### Validation Tasks\n\n- [ ] N.1 Run primary validation\n  - Command: `<EXACT command from plan>`\n  - Expected: Exit code 0, no errors\n\n- [ ] N.2 Run secondary validation\n  - Command: `<EXACT command from plan>`\n  - Expected: Exit code 0, no warnings\n\n- [ ] N.3 Run tertiary validation (if any)\n  - Command: `<EXACT command from plan>`\n  - Expected: <specific expectation>\n\n### Manual Verification (if in plan)\n\n- [ ] <Manual step 1 from plan>\n- [ ] <Manual step 2 from plan>\n- [ ] <Manual step 3 from plan>\n\n## Testing Strategy\n\n> **CRITICAL**: Copy from plan's Testing Strategy section.\n\n### Unit Tests Required\n\n- [ ] <Test 1 description>\n  - File: `<test file path>`\n  - Coverage: <what it tests>\n\n- [ ] <Test 2 description>\n  - File: `<test file path>`\n  - Coverage: <what it tests>\n\n### Integration Tests Required\n\n- [ ] <Integration test 1>\n  - Files: `<test files>`\n  - Verifies: <integration point>\n\n### Existing Tests to Update\n\n- [ ] `<existing test file>` - <what changes needed>\n- [ ] `<existing test file>` - <what changes needed>\n\n## Success Metrics\n\n> Copy from plan's Success Metrics section.\n\n### Functional Success Criteria\n\n- [ ] <Criterion 1 - measurable outcome>\n- [ ] <Criterion 2 - measurable outcome>\n\n### Quality Metrics\n\n- [ ] <Quality metric 1>\n- [ ] <Quality metric 2>\n\n### Acceptance Checklist\n\n- [ ] <Acceptance item 1>\n- [ ] <Acceptance item 2>\n- [ ] <Acceptance item 3>\n\n## Post-Implementation Verification\n\n> **CRITICAL**: Copy from plan's Post-Implementation Verification section.\n\n### Automated Checks\n\n```bash\n# Automated verification commands from plan\n<command 1>\n<command 2>\n```\n\n### Success Criteria Validation\n\n- [ ] <Validation step 1>\n- [ ] <Validation step 2>\n\n### Stakeholder Notification\n\n- [ ] Notify <stakeholder 1> about <change>\n- [ ] Notify <stakeholder 2> about <change>\n\n### Success Conditions\n\nAll of the following must be true:\n- [ ] All exit criteria commands pass (exit code 0)\n- [ ] All requirements from specs/*.md satisfied\n- [ ] No type errors (TypeScript clean)\n- [ ] No linting errors\n- [ ] All unit tests pass\n- [ ] All integration tests pass\n- [ ] All acceptance criteria met\n- [ ] <Any additional conditions from plan>\n```\n\n**Requirements:**\n- Exit Criteria copied EXACTLY from plan (commands verbatim)\n- Numbered tasks (1.1, 1.2, 2.1) for easy reference\n- Validation phase contains ALL verification commands from plan\n- Manual verification steps included if plan has them\n- Success conditions listed explicitly\n\n---\n\n# PHASE 5: CREATE SPEC DELTAS\n\nCreate `openspec/changes/<change-id>/specs/<capability>/spec.md` for each capability:\n\n```markdown\n# <Capability Name> Specification\n\n## Plan Reference\n\n**Source Plan**: `<plan-path>`\n**Requirements Section**: Lines <X>-<Y> in source plan\n\n## ADDED Requirements\n\n### Requirement: <Requirement Title from plan R1, R2, etc.>\n\n<Description from plan's requirement>\n\n#### Scenario: <Scenario Name>\n\n- **GIVEN** <initial context>\n- **WHEN** <action occurs>\n- **THEN** <expected outcome>\n\n#### Scenario: <Edge Case Scenario>\n\n- **GIVEN** <edge case context>\n- **WHEN** <action occurs>\n- **THEN** <expected handling>\n\n### Requirement: <Another Requirement>\n\n<Description>\n\n#### Scenario: <Scenario Name>\n\n- **GIVEN** <initial context>\n- **WHEN** <action occurs>\n- **THEN** <expected outcome>\n\n## MODIFIED Requirements\n\n### Requirement: <Existing Requirement Title>\n\n**Previous**: <what it was>\n**New**: <what it becomes>\n\n#### Scenario: <Updated Scenario>\n\n- **GIVEN** <initial context>\n- **WHEN** <action occurs>\n- **THEN** <new expected outcome>\n\n## REMOVED Requirements\n\n### Requirement: <Removed Requirement Title>\n\n**Reason**: <why this is being removed>\n**Migration**: <how existing usage should change>\n```\n\n**Requirements:**\n- Each R1, R2, R3 from plan becomes a Requirement with scenarios\n- Include plan reference with line numbers when possible\n- At least 2 scenarios per requirement (happy path + edge case)\n- Given/When/Then format strictly followed\n\n---\n\n# PHASE 6: VALIDATE PROPOSAL\n\n## Step 1: Run Strict Validation\n\n```bash\nopenspec validate <change-id> --strict\n```\n\n## Step 2: Resolve All Issues\n\nFor each validation issue:\n1. Read the error message\n2. Fix the issue in the relevant file\n3. Re-validate\n\nCommon issues and fixes:\n| Issue | Fix |\n|-------|-----|\n| Missing scenario | Add Scenario section with Given/When/Then |\n| Orphaned spec | Add reference in proposal.md or remove |\n| Invalid requirement format | Use `### Requirement:` header |\n| Missing verification | Add Verify line to task |\n\n## Step 3: Verify Completeness\n\n```bash\n# Show the complete change\nopenspec show <change-id>\n\n# List all spec deltas\nopenspec show <change-id> --deltas-only\n```\n\n## Step 4: Verify Plan Content Preserved\n\nBefore completing, verify these were preserved from the plan:\n- [ ] Reference Implementation in design.md contains FULL code\n- [ ] Exit Criteria in tasks.md contains EXACT commands\n- [ ] Migration Patterns in design.md have complete before/after\n- [ ] TypeScript interfaces are UNCHANGED from plan\n- [ ] ASCII diagrams are EXACT copies\n- [ ] plan_reference is in proposal.md, design.md, tasks.md\n\n---\n\n# PHASE 7: OUTPUT MINIMAL REPORT\n\n## Required Output Format\n\nReturn only:\n```\nCHANGE_ID: <change-id>\nOUTPUT_PATH: openspec/changes/<change-id>/\nPLAN_REFERENCE: <plan-path>\nFILES_CREATED: <count>\nVALIDATION: PASSED\nSTATUS: CREATED\n```\n\n---\n\n# TOOLS REFERENCE\n\n**File Operations (Claude Code built-in):**\n- `Read(file_path)` - Read plan files, existing specs, related code (REQUIRED first action)\n- `Glob(pattern)` - Find related files by pattern\n- `Grep(pattern)` - Search for patterns in codebase\n- `Write(file_path, content)` - Create OpenSpec files\n- `Bash(command)` - Run openspec commands, search with rg/ls\n\n**Commands to Use:**\n- `openspec list` - List existing changes\n- `openspec list --specs` - List existing specs\n- `openspec validate <id> --strict` - Validate proposal\n- `openspec show <id>` - View complete change\n- `rg <pattern>` - Search codebase\n- `ls -la <path>` - List directory contents\n\n---\n\n# CRITICAL RULES\n\n1. **Reference Implementation = FULL code** - Never summarize, copy completely\n2. **Exit Criteria = EXACT commands** - Copy verbatim from plan\n3. **Interfaces = UNCHANGED** - Never modify TypeScript types from plan\n4. **Diagrams = EXACT copies** - Preserve ASCII art exactly\n5. **plan_reference = ALWAYS** - Include in all files for recovery\n6. **Validate strictly** - Must pass `openspec validate --strict`\n7. **Scenarios required** - Every requirement needs at least 2 scenarios\n8. **Minimal output** - Return only structured result to orchestrator\n\n---\n\n# SELF-VERIFICATION CHECKLIST\n\n**Phase 1 - Analysis:**\n- [ ] Read openspec/project.md for context\n- [ ] Parsed input (plan or description)\n- [ ] Extracted ALL sections from plan (including new format sections)\n- [ ] Explored related codebase\n- [ ] Documented current behavior\n\n**Phase 1.5 - Complexity Assessment:**\n- [ ] Identified subsystems in plan\n- [ ] Estimated total lines of implementation\n- [ ] Checked for natural boundaries (frontend/backend, services)\n- [ ] Made SINGLE_PROPOSAL or DECOMPOSE recommendation\n- [ ] If DECOMPOSE: created multiple proposals with depends_on\n\n**Phase 2 - Proposal.md:**\n- [ ] plan_reference included (if from plan)\n- [ ] Status noted (if READY FOR IMPLEMENTATION)\n- [ ] Clear overview (2-3 sentences)\n- [ ] Concrete motivation (from plan)\n- [ ] Specific key changes\n- [ ] Measurable success criteria (from plan)\n- [ ] Out of scope defined\n- [ ] Full scope tracking (all plan items listed)\n- [ ] **Stakeholders listed in Impact section** (from plan)\n\n**Phase 3 - Design.md:**\n- [ ] plan_reference included\n- [ ] Mode noted (informational vs directional)\n- [ ] Architectural decisions with rationale (from plan)\n- [ ] **Reference Implementation section has FULL code** (not excerpts)\n- [ ] **Migration Patterns have COMPLETE before/after**\n- [ ] **Interfaces are EXACT copies from plan**\n- [ ] **ASCII diagrams preserved exactly**\n- [ ] Selected approach with rationale (from plan)\n- [ ] **Risk Analysis section populated** (Technical/Integration Risks)\n- [ ] **Rollback Strategy included** (with decision tree if present)\n- [ ] **Risk Assessment Summary included**\n\n**Phase 4 - Tasks.md:**\n- [ ] plan_reference included\n- [ ] Phased task list (from plan)\n- [ ] Each task has file references\n- [ ] Dependencies noted\n- [ ] **Exit Criteria section has EXACT commands from plan**\n- [ ] **Manual verification steps included**\n- [ ] **Testing Strategy section populated** (Unit/Integration/Existing Tests)\n- [ ] **Success Metrics section populated** (Functional/Quality/Acceptance)\n- [ ] **Post-Implementation Verification section populated**\n- [ ] **Success conditions explicit** (including all acceptance criteria)\n\n**Phase 5 - Specs:**\n- [ ] plan_reference included\n- [ ] One folder per capability\n- [ ] Each R1, R2, R3 from plan ‚Üí Requirement with scenarios\n- [ ] At least 2 scenarios per requirement\n- [ ] Given/When/Then format\n- [ ] **Test scenarios from Testing Strategy included**\n\n**Phase 6 - Validation:**\n- [ ] `openspec validate <id> --strict` passes\n- [ ] All issues resolved\n- [ ] Complete change viewable with `openspec show`\n- [ ] **Verified plan content preserved**\n- [ ] **Verified new format sections extracted** (Risk Analysis, Testing Strategy, Success Metrics, Post-Implementation)\n\n**Output:**\n- [ ] Minimal output format used\n- [ ] CHANGE_ID, OUTPUT_PATH, PLAN_REFERENCE, FILES_CREATED, VALIDATION, STATUS\n\n---\n\n## Git Policy\n\n**NEVER push to git.** Do not run `git push` or any command that pushes to remote. The user will push manually when ready.\n\n---\n\n## Tools Available\n\n**Do NOT use:**\n- `AskUserQuestion` - NEVER use this, slash command handles all user interaction\n- `Edit` - Use Write for new files, or read-then-write for modifications\n\n**DO use:**\n- `Read` - Read plan files, existing specs, related code\n- `Glob` - Find related files by pattern\n- `Grep` - Search for patterns in codebase\n- `Write` - Create OpenSpec files\n- `Bash` - Run openspec commands, search with rg/ls\n\n---\n\n# OPENSPEC FILE STRUCTURE\n\nThe complete proposal creates:\n```\nopenspec/changes/<change-id>/\n‚îú‚îÄ‚îÄ proposal.md          # Overview, motivation, plan_reference\n‚îú‚îÄ‚îÄ design.md            # Decisions, Reference Implementation, Migration Patterns\n‚îú‚îÄ‚îÄ tasks.md             # Ordered steps, Exit Criteria (EXACT commands)\n‚îî‚îÄ‚îÄ specs/\n    ‚îú‚îÄ‚îÄ <capability1>/\n    ‚îÇ   ‚îî‚îÄ‚îÄ spec.md      # Requirements with scenarios, plan_reference\n    ‚îî‚îÄ‚îÄ <capability2>/\n        ‚îî‚îÄ‚îÄ spec.md      # Requirements with scenarios\n```\n\n---\n\n# ANTI-PATTERN ELIMINATION\n\n**CRITICAL**: Eliminate ALL vague language and preserve ALL detail from plans.\n\n| BANNED Phrase | REPLACE With |\n|---------------|--------------|\n| \"appropriate handling\" | Specific handling: \"log error, return 400\" |\n| \"as needed\" | Explicit conditions: \"when input > 1000 chars\" |\n| \"etc.\" | Complete list of items |\n| \"update accordingly\" | Specific changes to make |\n| \"best practices\" | Cite specific practices |\n| \"TBD\" / \"TODO\" | Resolve now or note in design.md as decision needed |\n| \"relevant files\" | Exact file paths |\n| \"handle errors\" | Specify: catch X, log Y, return Z |\n| \"see plan for details\" | COPY the details into the spec |\n| \"implementation similar to plan\" | COPY the full implementation |\n| \"run tests\" | EXACT test command: `npm run test` |\n\n---\n\n# EXAMPLE: COMPLETE PLAN TO OPENSPEC CONVERSION\n\n## Input Plan (showing key sections)\n\n```markdown\n# Mobile CSS Enhancement - Implementation Plan\n\n## Summary\nCreate centralized responsive design system replacing 20+ duplicate isMobile patterns.\n\n## Files to Create\n- frontend/src/lib/hooks/useResponsive.ts\n- frontend/src/styles/_breakpoints.scss\n\n## Code Context\n\n### Current Pattern (duplicated 27+ times)\n\\`\\`\\`typescript\nconst [isMobile, setIsMobile] = useState(false)\nuseEffect(() => {\n  const checkMobile = () => setIsMobile(window.innerWidth <= 768)\n  checkMobile()\n  window.addEventListener('resize', checkMobile)\n  return () => window.removeEventListener('resize', checkMobile)\n}, [])\n\\`\\`\\`\n\n## Implementation Plan\n\n### frontend/src/lib/hooks/useResponsive.ts [create]\n\n\\`\\`\\`typescript\nimport { useState, useEffect, useCallback, useMemo } from 'react'\n\nexport const BREAKPOINTS = {\n  mobile: 768,\n  tablet: 1024,\n} as const\n\nexport interface UseResponsiveReturn {\n  isMobile: boolean\n  isTablet: boolean\n  isDesktop: boolean\n  breakpoint: 'mobile' | 'tablet' | 'desktop'\n  width: number\n}\n\nexport function useResponsive(): UseResponsiveReturn {\n  const [state, setState] = useState<UseResponsiveReturn>(() => ({\n    isMobile: false,\n    isTablet: false,\n    isDesktop: true,\n    breakpoint: 'desktop',\n    width: typeof window !== 'undefined' ? window.innerWidth : 1024,\n  }))\n\n  const getBreakpoint = useCallback((width: number): Breakpoint => {\n    if (width <= BREAKPOINTS.mobile) return 'mobile'\n    if (width <= BREAKPOINTS.tablet) return 'tablet'\n    return 'desktop'\n  }, [])\n\n  useEffect(() => {\n    // SSR guard\n    if (typeof window === 'undefined') return\n\n    let timeoutId: ReturnType<typeof setTimeout>\n\n    const handleResize = () => {\n      // Debounce resize events (100ms)\n      clearTimeout(timeoutId)\n      timeoutId = setTimeout(() => {\n        const width = window.innerWidth\n        const breakpoint = getBreakpoint(width)\n        setState({\n          isMobile: breakpoint === 'mobile',\n          isTablet: breakpoint === 'tablet',\n          isDesktop: breakpoint === 'desktop',\n          breakpoint,\n          width,\n        })\n      }, 100)\n    }\n\n    // Set initial state\n    handleResize()\n\n    window.addEventListener('resize', handleResize)\n    return () => {\n      clearTimeout(timeoutId)\n      window.removeEventListener('resize', handleResize)\n    }\n  }, [getBreakpoint])\n\n  return state\n}\n\\`\\`\\`\n\n## Requirements\n- R1: Create useResponsive hook with isMobile, isTablet, isDesktop\n- R2: Hook must be SSR-safe\n- R3: Hook must include resize debouncing (100ms)\n\n## Exit Criteria\n\n\\`\\`\\`bash\ncd frontend && npm run typecheck\ncd frontend && npm run lint\n./start.sh check\n\\`\\`\\`\n```\n\n## Output OpenSpec Structure\n\n### proposal.md\n```markdown\n# Change: Centralize Mobile Responsive Design System\n\n## Plan Reference\n\n**Source Plan**: `.claude/plans/mobile-css-enhancement-7x3m9-plan.md`\n\n> This proposal was generated from an architectural plan. For full implementation\n> details, reference implementation code, and context recovery, see the source plan.\n\n## Why\n\nThe frontend has 20+ files with duplicated mobile detection patterns using\n`window.innerWidth` with inconsistent breakpoints (768px vs 900px).\n\n## What Changes\n\n- Create `useResponsive` hook for centralized responsive detection\n- Create SCSS breakpoint system with mixins\n- Migrate high-impact files to new system\n\n## Success Criteria\n\n- useResponsive hook provides { isMobile, isTablet, isDesktop, breakpoint }\n- Hook is SSR-safe\n- Resize events debounced (100ms)\n- At least 5 high-impact files migrated\n\n## Full Scope from Plan\n\nThe source plan includes 18 migration files. This proposal covers 5 in scope.\n\n**In Scope** (this proposal):\n- settings.tsx, following.tsx, my-tribes/index.tsx, edit.tsx, StatBox.tsx\n\n**Deferred** (future proposals):\n- Remaining 13 files - incremental migration over time\n```\n\n### design.md (Reference Implementation section)\n```markdown\n## Reference Implementation\n\n> **CRITICAL**: This section contains the FULL implementation code from the source plan.\n\n### File: `frontend/src/lib/hooks/useResponsive.ts`\n\n\\`\\`\\`typescript\nimport { useState, useEffect, useCallback, useMemo } from 'react'\n\n// =============================================================================\n// CONSTANTS - Must match SCSS breakpoints in _breakpoints.scss\n// =============================================================================\nexport const BREAKPOINTS = {\n  mobile: 768,\n  tablet: 1024,\n} as const\n\ntype Breakpoint = 'mobile' | 'tablet' | 'desktop'\n\nexport interface UseResponsiveReturn {\n  isMobile: boolean\n  isTablet: boolean\n  isDesktop: boolean\n  breakpoint: Breakpoint\n  width: number\n}\n\n// ... FULL 100+ line implementation copied exactly from plan ...\n\\`\\`\\`\n\n## Migration Patterns\n\n### Pattern: Replace useState/useEffect with useResponsive\n\n**BEFORE** (current code):\n\\`\\`\\`typescript\nconst [isMobile, setIsMobile] = useState(false)\nuseEffect(() => {\n  const checkMobile = () => setIsMobile(window.innerWidth <= 768)\n  checkMobile()\n  window.addEventListener('resize', checkMobile)\n  return () => window.removeEventListener('resize', checkMobile)\n}, [])\n\\`\\`\\`\n\n**AFTER** (new code):\n\\`\\`\\`typescript\nconst { isMobile } = useResponsive()\n\\`\\`\\`\n```\n\n### tasks.md (Exit Criteria section)\n```markdown\n## Phase 3: Validation\n\n> **CRITICAL**: These are the EXACT exit criteria from the source plan.\n\n### Exit Criteria Commands\n\n\\`\\`\\`bash\ncd frontend && npm run typecheck\ncd frontend && npm run lint\n./start.sh check\n\\`\\`\\`\n\n### Validation Tasks\n\n- [ ] 3.1 Run TypeScript check\n  - Command: `cd frontend && npm run typecheck`\n  - Expected: Exit code 0, no type errors\n\n- [ ] 3.2 Run ESLint check\n  - Command: `cd frontend && npm run lint`\n  - Expected: Exit code 0, no linting errors\n\n- [ ] 3.3 Run full check\n  - Command: `./start.sh check`\n  - Expected: Exit code 0\n```\n",
        "architect/commands/beads.md": "---\nallowed-tools: Task, TaskOutput, Bash, Read, Glob, AskUserQuestion\nargument-hint: \"[spec-path]\"\ndescription: Convert OpenSpec specs to self-contained Beads (project)\n---\n\n# Beads Creator\n\nConvert OpenSpec specification(s) into self-contained Beads issues.\n\n**IMPORTANT**: Each bead must be SELF-CONTAINED - implementable with ONLY its description. Never reference external specs without copying the content.\n\n## Why Beads?\n\nBeads provide structured, trackable work items that integrate with the OpenSpec workflow.\n\nKey advantages:\n- **Self-Contained** - Each bead includes all context needed for implementation\n- **Traceable** - Dual back-references link beads to specs and plans\n- **Parallelizable** - Independent beads can be worked on simultaneously\n\n## What Good Beads Include\n\n1. **Context Chain**\n   - Spec reference path\n   - Plan reference path\n   - Task reference from tasks.md\n\n2. **Requirements**\n   - Full text copied from spec (never \"see spec\")\n   - Code examples from design.md\n   - Exact file paths\n\n3. **Exit Criteria**\n   - Specific test commands\n   - Build verification steps\n   - Acceptance criteria checkboxes\n\n## Arguments\n\n- **No argument**: Interactive mode - lists available OpenSpec changes and asks which to convert\n- **Spec path**: Direct mode - uses the provided path(s)\n- **Multiple paths**: `openspec/changes/<name-1>/ openspec/changes/<name-2>/`\n\n## Instructions\n\n### Step 1: Validate Environment\n\n```bash\n# Check bd installed\nbd version\n\n# Check initialized (use --stealth for brownfield projects)\nbd ready &>/dev/null && echo \"OK\" || echo \"Run: bd init --stealth\"\n```\n\n**Note:** Use `bd init --stealth` for brownfield development. This keeps `.beads/` out of git so you don't pollute existing repos with tracking files.\n\n### Step 2: Determine Mode\n\n**If $ARGUMENTS contains a path** (e.g., `openspec/changes/...`):\n- Use direct mode - skip to Step 3\n\n**If $ARGUMENTS is empty**:\n- Use interactive mode - continue below\n\n### Step 2a: List Available OpenSpec Changes (Interactive Mode)\n\n```bash\n# List all directories in openspec/changes/ excluding archive/\nls -d openspec/changes/*/ 2>/dev/null | grep -v '/archive/' | while read dir; do\n  change_name=$(basename \"$dir\")\n  # Get brief description from proposal.md (first line after \"# Change:\")\n  desc=$(grep -A1 \"^# Change:\" \"$dir/proposal.md\" 2>/dev/null | tail -1 | head -c 60)\n  echo \"$change_name: $desc\"\ndone\n```\n\n**Present Available Changes:**\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Select an OpenSpec change to convert to beads:\"\n- header: \"OpenSpec\"\n- options:\n  - label: \"<change-name-1>\"\n    description: \"<brief overview from proposal.md>\"\n  - label: \"<change-name-2>\"\n    description: \"<brief overview from proposal.md>\"\n  ... (one option per available change, max 4)\n```\n\n**Handle Selection:**\n- If user selects a change name ‚Üí set `SPEC_PATH=openspec/changes/<selected>/`\n- If user selects \"Other\" ‚Üí use their custom input as path\n\n**Edge Cases:**\n- No changes found ‚Üí \"No OpenSpec changes found. Run `/openspec` first.\"\n- All in archive ‚Üí \"All changes archived. Run `/openspec` to create new.\"\n\n### Step 3: Parse and Validate Specs\n\n```bash\n# Split arguments into array of spec paths\nSPEC_PATHS=($ARGUMENTS)\n\n# Validate each spec\nfor spec_path in \"${SPEC_PATHS[@]}\"; do\n  if [ -f \"$spec_path/proposal.md\" ]; then\n    echo \"‚úì $spec_path validated\"\n  else\n    echo \"ERROR: $spec_path is not a valid OpenSpec directory (missing proposal.md)\"\n    exit 1\n  fi\ndone\n\necho \"Total specs: ${#SPEC_PATHS[@]}\"\n```\n\n### Step 4: Read Spec Files\n\n**For single spec:**\n```bash\ncat $ARGUMENTS/proposal.md\ncat $ARGUMENTS/tasks.md\ncat $ARGUMENTS/design.md 2>/dev/null || true\nfind $ARGUMENTS/specs -name \"*.md\" -exec cat {} \\; 2>/dev/null || true\n```\n\n**For multiple specs (decomposed):**\n```bash\nfor spec_path in \"${SPEC_PATHS[@]}\"; do\n  echo \"=== Spec: $spec_path ===\"\n  cat $spec_path/proposal.md\n  cat $spec_path/tasks.md\n  cat $spec_path/design.md 2>/dev/null || true\n  find $spec_path/specs -name \"*.md\" -exec cat {} \\; 2>/dev/null || true\ndone\n```\n\n### Step 5: Launch Agent\n\nLaunch `beads-default`:\n\n```\nConvert OpenSpec(s) to self-contained beads.\n\nSpec Count: <1 or N>\nSpec Paths: <path(s)>\nChange Names: <name(s)>\n\n## Spec Content\n\n<content of all spec files>\n\n## Key Principle\n\nEach bead must be SELF-CONTAINED:\n- Copy requirements verbatim (never \"see spec\")\n- Include code examples\n- Include exact file paths\n- Include acceptance criteria\n\nFor single spec: Create epic first, then child tasks with --parent.\nFor multiple specs: Create one epic per spec, respect depends_on between specs.\n```\n\nUse `subagent_type: \"beads-default\"` and `run_in_background: true`.\n\n### Step 6: Report Result\n\n**For single spec:**\n```\n===============================================================\nBEADS CREATED\n===============================================================\n\nEpic: <id>\nTasks: <count>\nReady: <count>\n\nComplexity Assessment: <trivial|small|medium|large|huge>\nDecomposition Strategy: <single-bead|multi-bead|hierarchical>\n\n## Quality Report\n| Metric | Value | Status |\n|--------|-------|--------|\n| Total beads | N | OK |\n| Avg lines | N | OK |\n| Independence | N% | OK |\n| Max chain | N | OK |\n\nRecommendation: PROCEED\n\nNext Steps:\n1. Review: bd list -l \"openspec:<name>\"\n2. Execute: /implement\n\n===============================================================\n```\n\n**For multiple specs (decomposed):**\n```\n===============================================================\nBEADS CREATED (FROM DECOMPOSED PROPOSALS)\n===============================================================\n\nSpecs Processed: N\n\n| Spec | Epic ID | Tasks | Ready |\n|------|---------|-------|-------|\n| add-auth-backend | epic-001 | 5 | 5 |\n| add-auth-frontend | epic-002 | 4 | 0 |\n| add-auth-tests | epic-003 | 3 | 0 |\n\nCross-Spec Dependencies:\n  epic-001 (add-auth-backend) ‚Üí blocks ‚Üí epic-002 (add-auth-frontend)\n  epic-002 (add-auth-frontend) ‚Üí blocks ‚Üí epic-003 (add-auth-tests)\n\nTotal Beads: 12\nReady Now: 5 (from add-auth-backend)\n\n## Quality Report\n| Metric | Value | Status |\n|--------|-------|--------|\n| Total beads | 12 | OK |\n| Avg lines | 85 | OK |\n| Independence | 65% | OK |\n| Max chain | 3 | OK |\n\nRecommendation: PROCEED\n\nNext Steps:\n1. Review: bd list\n2. Execute: /implement\n\n===============================================================\n```\n\n## Self-Contained Bead Rule\n\nEach bead must be implementable with ONLY its description. Include **dual back-references** for context recovery.\n\n**BAD:**\n```\nbd create \"Update auth\" -t task\n```\n\n**GOOD:**\n```\nbd create \"Add JWT validation\" -t task -p 2 \\\n  --parent <epic-id> \\\n  -l \"openspec:add-auth\" \\\n  -d \"## Context Chain\n\n**Spec Reference**: openspec/changes/add-auth/specs/auth/spec.md\n**Plan Reference**: .claude/plans/auth-3k7f2-plan.md\n**Task**: 1.2 from tasks.md\n\n## Requirements\n<copied from spec - FULL text>\n\n## Reference Implementation\n<FULL code from design.md>\n\n## Exit Criteria\n- [ ] \\`npm test -- auth\\` passes\n- [ ] TypeScript compiles\n\n## Files\n- src/auth.ts\"\n```\n\n**Litmus test:** Could someone implement this with ONLY the bead description? If not, add more context.\n\n## Auto-Decomposition\n\nThe agent **automatically** decomposes large beads - no user prompt needed.\n\n| Trigger | Threshold | Action |\n|---------|-----------|--------|\n| Bead size | >200 lines | Auto-create sub-beads |\n| Complexity | Multiple responsibilities | Auto-split by concern |\n| Independence | <60% score | Auto-restructure dependencies |\n\n### Auto-Decomposition Process\n\nWhen beads exceed thresholds, the agent automatically:\n\n1. **Identifies large beads** from quality metrics\n2. **Creates child sub-beads** with `--parent`:\n   ```bash\n   bd update <parent-id> --status decomposed\n   bd create \"Sub-task 1\" -t task --parent <parent-id> -l \"openspec:<name>\" -d \"<self-contained>\"\n   bd create \"Sub-task 2\" -t task --parent <parent-id> -l \"openspec:<name>\" -d \"<self-contained>\"\n   ```\n3. **Each sub-bead is self-contained** - copies context from parent\n4. **Reports decomposition** in output\n\n### Decomposition Output\n\n```\n===============================================================\nBEADS CREATED (AUTO-DECOMPOSED)\n===============================================================\n\nOriginal Beads: 5\nDecomposed: 2 (too large)\nNew Sub-Beads: 6\n\nDecomposition Details:\n  ‚Ä¢ bead-003 \"Implement auth handler\" ‚Üí 3 sub-beads\n    - bead-003a \"Add JWT validation middleware\"\n    - bead-003b \"Implement token refresh logic\"\n    - bead-003c \"Add session management\"\n  ‚Ä¢ bead-005 \"Add API endpoints\" ‚Üí 3 sub-beads\n    - bead-005a \"POST /auth/login endpoint\"\n    - bead-005b \"POST /auth/logout endpoint\"\n    - bead-005c \"GET /auth/me endpoint\"\n\nTotal Beads Now: 9\nReady: 4\n\nNext:\n- Execute: /implement\n===============================================================\n```\n\n## Workflow Diagram\n\nWorks with plans from **any planner**:\n\n```\n/plan-creator <task>           ‚îê\n/bug-plan-creator <error>      ‚îú‚îÄ‚ñ∂ .claude/plans/*-plan.md\n/code-quality-plan-creator     ‚îò\n    ‚îÇ\n    ‚ñº\n/openspec <plan>\n    ‚îÇ\n    ‚îú‚îÄ‚îÄ‚îÄ [single proposal] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ openspec/changes/<id>/\n    ‚îÇ                                       ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ [decomposed: multiple] ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ openspec/changes/<id-1>/\n                                      openspec/changes/<id-2>/\n                                      openspec/changes/<id-3>/\n    ‚îÇ                                       ‚îÇ\n    ‚ñº                                       ‚ñº\n/beads (interactive)            /beads <spec-1> <spec-2> <spec-3>\n    ‚îÇ                                       ‚îÇ\n    ‚îî‚îÄ‚îÄ‚ñ∂ /implement                         ‚îî‚îÄ‚îÄ‚ñ∂ /implement\n```\n\n## Step Mode (Default)\n\nStep mode pauses after creating beads for human review.\n\n**After creating beads, you MUST use AskUserQuestion to pause.**\n\n```\nUse AskUserQuestion with:\n- question: \"Beads created. What would you like to do?\"\n- header: \"Next step\"\n- options:\n  - label: \"Implement (Recommended)\"\n    description: \"Proceed to /implement to execute beads\"\n  - label: \"Stop\"\n    description: \"End here for manual review\"\n```\n\nUse `--auto` flag to skip pauses and proceed directly to /implement.\n\n## Git Policy\n\n**NEVER push to git.** Do not run `git push`, `bd sync`, or any command that pushes to remote. The user will push manually when ready.\n\n## Error Handling\n\n| Scenario | Action |\n|----------|--------|\n| bd not installed | \"Install bd: https://github.com/steveyegge/beads\" |\n| bd not initialized | \"Run: bd init\" |\n| Path not found | Report error |\n\n## Example Usage\n\n```bash\n# Interactive mode (lists available changes)\n/beads\n\n# Direct mode with single spec\n/beads openspec/changes/add-auth/\n\n# Multiple decomposed specs\n/beads openspec/changes/add-auth-backend/ openspec/changes/add-auth-frontend/\n\n# Auto mode (skip review pause)\n/beads openspec/changes/add-auth/ --auto\n```\n",
        "architect/commands/cancel.md": "---\ndescription: \"Gracefully stop any active implementation (loop or swarm)\"\nallowed-tools: [\"Bash\", \"Task\", \"TaskOutput\"]\nargument-hint: \"\"\n---\n\n# Cancel Command\n\nGracefully stop any active implementation while preserving progress.\n\n**Works with:** `/implement` command (all modes: Swarm, Loop, Auto Loop)\n\n## Instructions\n\n### Step 1: Check Beads Status\n\n```bash\nbd list --status in_progress\n```\n\nThis shows beads currently being worked on.\n\n### Step 2: Report Status\n\nReport current state:\n\n```\n===============================================================\nIMPLEMENTATION CANCELLED\n===============================================================\n\nIn-Progress Beads: N\n  - <id>: <title>\n  ...\n\nCompleted Beads: M\nPending Beads: P\n\nProgress is preserved. Completed beads remain closed.\nIn-progress beads remain in_progress.\n\nNote: Swarm workers may complete their current task before stopping.\nCheck status in a moment with: bd list\n\n===============================================================\n```\n\n### Step 3: Recovery Instructions\n\nProvide recovery commands:\n\n```\nTo check current status:\n  bd list                         # See all beads\n  bd ready                        # See what's ready next\n  bd list --status in_progress    # Find current work\n\nTo resume:\n  /implement\n```\n\n## Data Preservation\n\n- **Completed tasks**: Remain closed\n- **In-progress tasks**: Remain in_progress (swarm workers may complete)\n- **Pending tasks**: Remain pending\n\nThe beads database preserves all state. You can resume at any time with `/implement`.\n\n## Swarm vs Loop Cancellation\n\n| Aspect | Loop/Auto Loop | Swarm |\n|--------|----------------|-------|\n| Stops | Single foreground agent | Multiple background workers |\n| Immediate | Yes | Workers may finish current task |\n| State | Deterministic | Check `bd list` after a moment |\n\n## Example Output\n\n```\n===============================================================\nIMPLEMENTATION CANCELLED\n===============================================================\n\nIn-Progress Beads: 2\n  - task-004: Add login endpoint\n  - task-005: Add logout endpoint\n\nCompleted Beads: 3\nPending Beads: 4\n\nProgress is preserved. Completed beads remain closed.\nIn-progress beads remain in_progress.\n\nNote: Swarm workers may complete their current task before stopping.\n\nTo check status:\n  bd list\n\nTo resume:\n  /implement\n\n===============================================================\n```\n",
        "architect/commands/implement.md": "---\ndescription: \"Execute beads using loop (sequential) or swarm (parallel) mode\"\nargument-hint: \"[--label <label>] [--epic <id>] [--mode <swarm|loop|auto>]\"\nallowed-tools: [\"Task\", \"TaskOutput\", \"Read\", \"TodoWrite\", \"Bash\", \"Edit\", \"AskUserQuestion\"]\n---\n\n# Implement Command\n\nExecute beads using your choice of execution strategy.\n\n**IMPORTANT**: This command combines loop (sequential) and swarm (parallel) execution modes with interactive selection.\n\n## Execution Modes\n\n| Mode | Description | Best For |\n|------|-------------|----------|\n| **Swarm** | Parallel workers | Independent beads, maximum speed |\n| **Loop** | Sequential with step-by-step confirmation | Interdependent tasks, debugging |\n| **Auto Loop** | Sequential without confirmation | Hands-off sequential execution |\n\n## Arguments\n\n- `--label <label>`: Filter beads by label (e.g., `--label openspec:my-change`) - skips epic selection\n- `--epic <id>`: Execute beads for a specific epic - skips epic selection\n- `--mode <swarm|loop|auto>`: Skip mode selection prompt\n- `--workers N`: Maximum concurrent workers for swarm mode (default: 3)\n- `--model MODEL`: Worker model for swarm - `haiku`, `sonnet`, or `opus` (default: opus)\n\n## Instructions\n\n### Step 1: Validate Environment\n\n```bash\n# Check bd installed\nbd version\n\n# Check initialized\nbd ready &>/dev/null && echo \"OK\" || echo \"Run: bd init --stealth\"\n```\n\n### Step 2: Parse Arguments\n\nParse `$ARGUMENTS` for flags:\n- `--label <value>` ‚Üí skip epic selection, use this label\n- `--epic <id>` ‚Üí skip epic selection, use this epic\n- `--mode <swarm|loop|auto>` ‚Üí skip mode selection\n- `--workers <N>` (default: 3)\n- `--model <MODEL>` (default: opus)\n\n### Step 3: Select Epic (Interactive Mode)\n\n**Skip if** `--label` or `--epic` provided.\n\n```bash\n# Get all epics with openspec labels that are not completed\nbd list -t epic --json 2>/dev/null | jq -r '\n  .[] |\n  select(.status == \"pending\" or .status == \"in_progress\") |\n  \"\\(.id)\\t\\(.title)\\t\\(.status)\\t\\(.labels | map(select(startswith(\"openspec:\"))) | join(\",\"))\"\n'\n```\n\n**Present Available Epics:**\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Select an epic to implement:\"\n- header: \"Epic\"\n- options:\n  - label: \"<epic-title-1>\"\n    description: \"<epic-id> | openspec:<name> | N ready beads\"\n  - label: \"<epic-title-2>\"\n    description: \"<epic-id> | openspec:<name> | N ready beads\"\n  ... (one option per available epic, max 4)\n```\n\n**Handle Selection:**\n- If user selects an epic ‚Üí extract the `openspec:<name>` label for filtering\n- If user selects \"Other\" ‚Üí use their custom input (label or epic ID)\n\n**Edge Cases:**\n- No epics found ‚Üí \"No epics found. Run `/beads` to create beads from an OpenSpec change.\"\n- No ready beads ‚Üí \"No ready beads. All beads may be completed or blocked.\"\n\n### Step 4: Select Execution Mode (Interactive Mode)\n\n**Skip if** `--mode` provided.\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Select execution mode:\"\n- header: \"Mode\"\n- options:\n  - label: \"Swarm (Recommended)\"\n    description: \"Parallel workers - maximum speed, up to N concurrent tasks\"\n  - label: \"Loop\"\n    description: \"Sequential - pause after each bead for review\"\n  - label: \"Auto Loop\"\n    description: \"Sequential - no pauses, runs until complete\"\n```\n\n### Step 5: Execute Based on Mode\n\n---\n\n## MODE: SWARM\n\nExecute beads using parallel worker agents.\n\n### Swarm Step 1: Retrieve Beads\n\n```bash\nbd list --json -l \"<label>\"\n```\n\nParse the JSON to build a task graph with dependencies.\n\n### Swarm Step 2: Build Dependency Graph\n\nFrom the beads JSON, extract:\n- `id`: Bead identifier\n- `title` or `description`: Task name\n- `depends_on`: Array of blocking bead IDs\n- `status`: pending, in_progress, completed\n\n**A bead is \"ready\" when:**\n- Status is `pending`\n- All beads in `depends_on` have status `completed`\n\n### Swarm Step 3: Spawn Workers\n\nFor each ready bead (up to `--workers` limit):\n\n1. Mark bead as in_progress:\n   ```bash\n   bd update <id> --status in_progress\n   ```\n\n2. Launch worker agent using Task tool:\n   ```\n   Use Task tool with:\n   - subagent_type: \"general-purpose\"\n   - model: <selected model>\n   - run_in_background: true\n   - prompt: |\n       Execute this bead task:\n\n       Bead ID: <id>\n       Title: <title>\n\n       ## Task Description\n       <full bead description from bd show>\n\n       ## Instructions\n       1. Read the files mentioned\n       2. Make the required changes (use LSP tools for TypeScript: documentSymbol, findReferences, goToDefinition)\n       3. Run verification commands in exit criteria\n       4. If this bead has an `openspec:` label: Edit `openspec/changes/<name>/tasks.md` to mark the corresponding task as `[x]`\n       5. Report success or failure\n\n       When complete, output: \"BEAD COMPLETE: <id>\"\n       If blocked, output: \"BEAD BLOCKED: <id> - <reason>\"\n   ```\n\n3. Track worker assignment: `worker_id ‚Üí bead_id`\n\n### Swarm Step 4: Monitor Completion\n\nWait for workers to complete using TaskOutput:\n\n1. Poll each running worker with `TaskOutput(task_id, block=false)`\n2. When worker completes:\n   - Parse output for \"BEAD COMPLETE\" or \"BEAD BLOCKED\"\n   - If complete: `bd close <id> --reason \"Done\"`\n   - If blocked: Report issue, mark as blocked\n3. Update dependency graph (remove completed from blockedBy lists)\n4. Identify newly unblocked beads\n5. Spawn replacement workers for new ready beads\n\n### Swarm Step 5: Continue Until Done\n\nRepeat until:\n- All beads are completed, OR\n- No more work can be done (all remaining are blocked)\n\n---\n\n## MODE: LOOP / AUTO LOOP\n\nExecute beads iteratively until all ready tasks are complete.\n\n### Loop Step 1: Find Ready Work\n\n```bash\nbd ready -l \"<label>\"\n```\n\nShows tasks with no blockers, sorted by priority.\n\n### Loop Step 2: Pick a Task\n\nSelect the highest priority ready task. Note its ID.\n\n### Loop Step 3: Read Task Details\n\n```bash\nbd show <id>\n```\n\nThe task description should be self-contained with requirements, acceptance criteria, and files to modify.\n\n### Loop Step 4: Start Working\n\n```bash\nbd update <id> --status in_progress\n```\n\n### Loop Step 5: Implement the Task\n\nFollow the task description:\n1. Read the files mentioned\n2. Make the required changes\n3. Run any tests/verification in acceptance criteria\n\n**TypeScript LSP (when available):** For TypeScript/JavaScript code, use LSP tools for better accuracy:\n- `documentSymbol` - Find symbols in a file\n- `findReferences` - Find all usages of a symbol\n- `goToDefinition` - Navigate to symbol definition\n- `workspaceSymbol` - Search symbols across workspace\n\n### Loop Step 6: Complete the Task\n\n```bash\nbd close <id> --reason \"Done: <brief summary>\"\n```\n\n### Loop Step 7: Update OpenSpec (if applicable)\n\n**IMPORTANT**: If working on an OpenSpec change (label starts with `openspec:`):\n\nEdit `openspec/changes/<name>/tasks.md` to mark that task complete:\n\n```markdown\n# Before\n- [ ] Task description here\n\n# After\n- [x] Task description here\n```\n\n### Loop Step 8: Repeat or Pause\n\n**In Loop mode (step):** Use AskUserQuestion to pause for human control.\n\n**In Auto Loop mode:** Continue to next ready bead immediately.\n\n**Before pausing, output execution status:**\n```\n===============================================================\nBEAD COMPLETED: <bead-id>\n===============================================================\n\nProgress: N/M beads complete\n\nEXECUTION ORDER (remaining):\n  Next ‚Üí <bead-id>: <title> (P0)\n  Then ‚Üí <bead-id>: <title> (P0)\n  Then ‚Üí <bead-id>: <title> (P1, blocked until P0 done)\n===============================================================\n```\n\n**Then use AskUserQuestion (Loop mode only):**\n\n```\nUse AskUserQuestion with:\n- question: \"Bead complete. Next: <next-bead-id> (<title>). Continue?\"\n- header: \"Next step\"\n- options:\n  - label: \"Continue (Recommended)\"\n    description: \"Proceed to <next-bead-id>: <title>\"\n  - label: \"Stop\"\n    description: \"End the implementation loop here\"\n  - label: \"<other-bead-id>\"\n    description: \"Skip to: <other-bead-title>\"\n```\n\nBased on the response:\n- **Continue**: Proceed to next in execution order\n- **Stop**: End the loop and report progress\n- **Specific bead ID**: Work on that bead next\n\n### Loop Completion\n\nWhen no ready tasks remain, say: **\"All beads complete\"**\n\n---\n\n## Report Results\n\n```\n===============================================================\nIMPLEMENTATION COMPLETE\n===============================================================\n\nMode: <Swarm|Loop|Auto Loop>\nEpic: <epic-title> (if specified)\nLabel: <label>\n\nResults:\n  Completed: X beads\n  Blocked: Y beads (if any)\n  Remaining: Z beads\n\n===============================================================\n```\n\n## Progress Visualization\n\nPress `ctrl+t` at any time to see:\n- Number of active workers (swarm)\n- Tasks in progress\n- Completed tasks\n- Pending tasks\n\n## Context Recovery\n\nIf you lose track:\n\n```bash\nbd ready                        # See what's next\nbd list --status in_progress    # Find current work\nbd show <id>                    # Full task details\n```\n\n## Git Policy\n\n**NEVER push to git.** Do not run `git push`, `bd sync`, or any command that pushes to remote. The user will push manually when ready.\n\n## Error Handling\n\n| Scenario | Action |\n|----------|--------|\n| No epics found | \"No epics found. Run `/beads` to create beads from an OpenSpec change.\" |\n| No ready beads | \"No ready beads. All beads may be completed or blocked.\" |\n| Worker fails (swarm) | Mark bead as blocked, report error, continue with others |\n| All beads blocked | Stop, report blocking issues |\n| Max iterations reached | Loop stops automatically; resume with `/implement` to continue |\n\n## Stopping\n\n- Say \"All beads complete\" when done\n- Run `/cancel` to stop early\n- In Loop mode: select \"Stop\" at the pause prompt\n\n## Example Usage\n\n```bash\n# Interactive mode (select epic and mode)\n/implement\n\n# With specific label (skip epic selection)\n/implement --label openspec:add-auth\n\n# With specific mode (skip mode selection)\n/implement --mode swarm\n\n# Full specification\n/implement --label openspec:add-auth --mode swarm --workers 5 --model opus\n\n# Auto loop mode\n/implement --label openspec:refactor --mode auto\n```\n\n## When to Use Loop vs Swarm\n\n| Situation | Use |\n|-----------|-----|\n| Tasks depend heavily on each other | Loop or Auto Loop |\n| Want to review each step | Loop |\n| Many independent tasks | Swarm |\n| Want maximum speed | Swarm |\n| Debugging issues | Loop |\n| Large refactoring with phases | Swarm |\n",
        "architect/commands/openspec.md": "---\nallowed-tools: Task, TaskOutput, Bash, Read, Glob, Grep\nargument-hint: \"[plan-path-or-description]\"\ndescription: Convert plans, context, or descriptions into validated OpenSpec proposals (project)\ncontext: fork\n---\n\n# OpenSpec Creator\n\nConvert architectural plans, current context, or task descriptions into validated OpenSpec change proposals.\n\n**IMPORTANT**: Keep orchestrator output minimal. User reviews the OpenSpec files directly.\n\n## Arguments\n\nTakes **any input**:\n\n- Plan file path: `.claude/plans/auth-feature-3k7f2-plan.md`\n- Task description: `\"Add OAuth2 authentication with Google login\"`\n- No argument: uses current conversation context\n\nIf no input provided, prompts user to describe the change.\n\n## Instructions\n\n### Step 1: Validate Environment\n\n```bash\n# Check openspec is installed\nopenspec version 2>&1 | head -1\n\n# Check openspec is initialized\nls openspec/project.md 2>/dev/null && echo \"OpenSpec initialized\" || echo \"Not initialized\"\n```\n\nIf not installed: \"Install OpenSpec: https://github.com/Fission-AI/OpenSpec\"\nIf not initialized: \"Run: openspec init\"\n\n### Step 2: Detect Input Type and Parse\n\n**CRITICAL:** Determine input type and extract all relevant context.\n\n**If plan file path provided** (matches `.claude/plans/*.md` or similar):\n\n```bash\n# Read the full plan file\ncat <plan-path>\n```\n\nExtract from plan:\n\n- Task description ‚Üí proposal.md overview\n- Architecture section ‚Üí design.md\n- Implementation steps ‚Üí tasks.md\n- Requirements ‚Üí specs/\\*/spec.md\n- Files to modify ‚Üí technical context\n\n**If task description provided** (text without file path):\nUse the description as the basis for the proposal. The agent will explore the codebase to gather context.\n\n**If no input** (empty $ARGUMENTS):\nCheck for an active Claude plan in the current conversation context:\n\n```bash\n# Find most recent plan file\nls -t .claude/plans/*-plan.md 2>/dev/null | head -1\n```\n\n1. **If plan exists in conversation context**: Use it automatically\n   - Look for plan file references in recent messages\n   - Check `.claude/plans/` for the most recently modified plan\n   - Inform user: \"Using plan: .claude/plans/<plan-name>.md\"\n\n2. **If no plan found**: Ask user: \"What change would you like to propose?\"\n\n### Step 3: Determine Change ID\n\nGenerate a unique verb-led change-id:\n\n- Use kebab-case\n- Start with action verb: `add-`, `update-`, `fix-`, `refactor-`, `remove-`\n- Be descriptive but concise\n- Examples: `add-oauth2-authentication`, `fix-session-timeout`, `refactor-payment-processing`\n\n### Step 4: Launch Agent\n\nLaunch `openspec-default` in background:\n\n```\nCreate OpenSpec proposal from input with full context.\n\nInput Type: <plan-file | description | context>\nPlan Path: <path to plan file - REQUIRED if plan-file input>\nChange ID: <generated change-id>\n\n## Source Content (if plan file)\n\n<full plan content - COMPLETE, not excerpted>\n\n## CRITICAL: Preserve All Plan Details\n\nWhen converting a plan, you MUST preserve:\n- **Reference Implementation**: Full code from plan ‚Üí design.md (COMPLETE, not summarized)\n- **Exit Criteria**: Exact verification commands ‚Üí tasks.md (VERBATIM)\n- **Migration Patterns**: Before/after code ‚Üí design.md (COMPLETE)\n- **TypeScript Interfaces**: Exact types ‚Üí design.md (UNCHANGED)\n- **ASCII Diagrams**: Architecture diagrams ‚Üí design.md (EXACT copy)\n- **Plan Reference**: Path to source plan ‚Üí ALL files (for recovery)\n- **Risk Analysis**: Technical/Integration risks ‚Üí design.md, Rollback Strategy ‚Üí design.md\n- **Stakeholders**: Primary/Secondary ‚Üí proposal.md Impact section\n- **Testing Strategy**: Unit/Integration tests ‚Üí tasks.md + specs scenarios\n- **Success Metrics**: Functional criteria, quality metrics ‚Üí tasks.md\n- **Post-Implementation Verification**: Automated checks, validation ‚Üí tasks.md\n\n## Process\n\n1. READ docs/architecture/INDEX.md FIRST - Then read relevant architecture docs based on task type\n2. ANALYZE INPUT - Extract ALL sections from plan (use PLAN EXTRACTION CHECKLIST)\n3. EXPLORE CODEBASE - Understand current implementation\n4. CREATE PROPOSAL - proposal.md with plan_reference, motivation, full scope tracking\n5. CREATE DESIGN - design.md with Reference Implementation (FULL code), Migration Patterns\n6. CREATE TASKS - tasks.md with Exit Criteria (EXACT commands from plan)\n7. CREATE SPECS - specs/*/spec.md with R1, R2, R3 ‚Üí scenarios\n8. VALIDATE - openspec validate <change-id> --strict\n9. VERIFY - Check all plan content preserved\n\nReturn:\nCHANGE_ID: <id>\nOUTPUT_PATH: openspec/changes/<id>/\nPLAN_REFERENCE: <plan-path>\nFILES_CREATED: <count>\nVALIDATION: PASSED|FAILED\nSTATUS: CREATED\n```\n\nUse `subagent_type: \"openspec-default\"` and `run_in_background: true`.\n\nWait with TaskOutput (block: true).\n\n### Step 5: Report Result\n\n```\n===============================================================\nOPENSPEC PROPOSAL CREATED\n===============================================================\n\nChange: <change-id>\nPath: openspec/changes/<change-id>/\nPlan Reference: <plan-path> (if from plan)\n\nFiles Created:\n  ‚Ä¢ proposal.md - Overview, motivation, plan_reference\n  ‚Ä¢ design.md - Decisions, Reference Implementation, Migration Patterns\n  ‚Ä¢ tasks.md - Implementation steps, Exit Criteria (exact commands)\n  ‚Ä¢ specs/<area>/spec.md - Requirements with scenarios\n\nValidation: PASSED\n\nPlan Content Preserved:\n  ‚Ä¢ Reference Implementation: FULL code in design.md\n  ‚Ä¢ Exit Criteria: EXACT commands in tasks.md\n  ‚Ä¢ Migration Patterns: COMPLETE before/after in design.md\n  ‚Ä¢ Interfaces: UNCHANGED TypeScript types\n  ‚Ä¢ plan_reference: In all files for recovery\n  ‚Ä¢ Risk Analysis: Technical/Integration risks in design.md\n  ‚Ä¢ Rollback Strategy: Decision tree in design.md\n  ‚Ä¢ Stakeholders: Primary/Secondary in proposal.md Impact\n  ‚Ä¢ Testing Strategy: Unit/Integration tests in tasks.md + specs\n  ‚Ä¢ Success Metrics: Functional/Quality/Acceptance in tasks.md\n  ‚Ä¢ Post-Implementation: Verification steps in tasks.md\n\n===============================================================\nNEXT STEPS\n===============================================================\n\n1. Review: openspec show <change-id>\n2. Convert to beads: /beads openspec/changes/<change-id>/\n3. Or implement directly: /implement\n\n===============================================================\n```\n\n## Workflow Diagram\n\n```\n/openspec [input]\n    ‚îÇ\n    ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ STEP 1: VALIDATE ENVIRONMENT                                  ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  ‚Ä¢ Check openspec installed                                   ‚îÇ\n‚îÇ  ‚Ä¢ Check openspec initialized                                 ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n    ‚îÇ\n    ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ STEP 2: DETECT INPUT TYPE                                     ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  Plan file path:          Description:        Empty:          ‚îÇ\n‚îÇ   ‚Ä¢ Read FULL plan         ‚Ä¢ Use as basis      ‚Ä¢ Check context‚îÇ\n‚îÇ   ‚Ä¢ Extract ALL sections   ‚Ä¢ Explore codebase  ‚Ä¢ Use plan if  ‚îÇ\n‚îÇ   ‚Ä¢ Save plan_path         ‚Ä¢ No plan_ref         found in     ‚îÇ\n‚îÇ                                                  conversation ‚îÇ\n‚îÇ                                                ‚Ä¢ Else ask user‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n    ‚îÇ\n    ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ STEP 3: LAUNCH AGENT                                          ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  Agent: openspec-default                                      ‚îÇ\n‚îÇ  Mode: run_in_background: true                                ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ AGENT PHASES (with plan back-references):               ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ                                                         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  1. ANALYZE INPUT (EXTRACT EVERYTHING)                  ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Use PLAN EXTRACTION CHECKLIST                     ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Extract ALL code, diagrams, exit criteria         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Extract NEW sections: Risk Analysis, Testing      ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ       Strategy, Success Metrics, Post-Implementation    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ DO NOT SUMMARIZE - copy verbatim                  ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ                                                         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  2. EXPLORE CODEBASE                                    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Read project.md, existing specs                   ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Search related code with rg/ls                    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ                                                         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  3. CREATE PROPOSAL.MD                                  ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ plan_reference (path to source plan)              ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Status (READY FOR IMPLEMENTATION)                 ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Full scope tracking (all items from plan)         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ In scope / deferred items                         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Stakeholders in Impact section                    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ                                                         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  4. CREATE DESIGN.MD                                    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ plan_reference                                    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Mode (informational vs directional)               ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Reference Implementation (FULL code from plan)    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Migration Patterns (COMPLETE before/after)        ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Interfaces (EXACT, unchanged)                     ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ ASCII diagrams (EXACT copies)                     ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Risk Analysis (Technical/Integration Risks)       ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Rollback Strategy (with decision tree)            ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ                                                         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  5. CREATE TASKS.MD                                     ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ plan_reference                                    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Exit Criteria (EXACT commands from plan)          ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Manual verification steps                         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Testing Strategy (Unit/Integration/Existing)      ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Success Metrics (Functional/Quality/Acceptance)   ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Post-Implementation Verification                  ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ                                                         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  6. CREATE SPECS/**/*.MD                                ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ plan_reference                                    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ R1, R2, R3 ‚Üí scenarios (2+ per requirement)       ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Test scenarios from Testing Strategy              ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ                                                         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  7. VALIDATE                                            ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ openspec validate <id> --strict                   ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Verify plan content preserved                     ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ     ‚Ä¢ Verify new format sections extracted              ‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n    ‚îÇ\n    ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ STEP 4: REPORT RESULT                                         ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  Output:                                                      ‚îÇ\n‚îÇ  ‚Ä¢ Change ID, path, plan_reference                            ‚îÇ\n‚îÇ  ‚Ä¢ Files created with plan content preserved                  ‚îÇ\n‚îÇ  ‚Ä¢ Validation status                                          ‚îÇ\n‚îÇ  ‚Ä¢ Next: /beads or /implement                                 ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n## Chain of Back-References\n\nPlan (SOURCE OF TRUTH)\n ‚îÇ\n ‚îú‚îÄ‚îÄ‚ñ∂ proposal.md: plan_reference ‚Üí enables recovery\n ‚îÇ\n ‚îú‚îÄ‚îÄ‚ñ∂ design.md: plan_reference + Reference Implementation\n ‚îÇ    (FULL code from plan, not summarized)\n ‚îÇ\n ‚îú‚îÄ‚îÄ‚ñ∂ tasks.md: plan_reference + Exit Criteria\n ‚îÇ    (EXACT verification commands from plan)\n ‚îÇ\n ‚îî‚îÄ‚îÄ‚ñ∂ specs/*.md: plan_reference + requirements line numbers\n```\n\n## Git Policy\n\n**NEVER push to git.** Do not run `git push` or any command that pushes to remote. The user will push manually when ready.\n\n## Error Handling\n\n| Scenario                 | Action                                                     |\n| ------------------------ | ---------------------------------------------------------- |\n| OpenSpec not installed   | \"Install OpenSpec: https://github.com/Fission-AI/OpenSpec\" |\n| OpenSpec not initialized | \"Run: openspec init\"                                       |\n| Plan file not found      | Report error, suggest correct path                         |\n| Empty input              | Ask user for description                                   |\n| Validation fails         | Report issues, agent attempts to fix                       |\n| Change ID exists         | Append suffix: `add-auth-2`                                |\n\n## Example Usage\n\n```bash\n# From architectural plan (explicit path)\n/openspec .claude/plans/auth-feature-3k7f2-plan.md\n\n# From description\n/openspec Add OAuth2 authentication with Google login\n\n# From current context (auto-detects plan in conversation)\n/openspec\n# ‚Üí \"Using plan: .claude/plans/auth-feature-3k7f2-plan.md\"\n\n# Then continue with workflow\nopenspec show add-oauth2-authentication\n/beads\n/implement\n```\n\n## Input Mapping\n\nHow different inputs map to OpenSpec structure:\n\n| Input Section        | ‚Üí OpenSpec File         | Content                                                      |\n| -------------------- | ----------------------- | ------------------------------------------------------------ |\n| Plan path            | proposal.md             | plan_reference (for recovery)                                |\n| Status/Mode          | proposal.md / design.md | Plan status, implementation mode                             |\n| Summary/Task         | proposal.md             | Overview, motivation                                         |\n| Architecture         | design.md               | Decisions, patterns                                          |\n| Implementation Steps | tasks.md                | Ordered task list                                            |\n| Requirements         | specs/\\*/spec.md        | ADDED/MODIFIED/REMOVED                                       |\n| Files to Modify      | tasks.md + specs        | File references                                              |\n| Exit Criteria        | tasks.md                | Verification steps                                           |\n| Risk Analysis        | design.md               | Technical/Integration risks, rollback strategy               |\n| Stakeholders         | proposal.md             | Impact section (primary/secondary)                           |\n| Testing Strategy     | tasks.md + specs        | Unit/Integration tests, existing tests to update             |\n| Success Metrics      | tasks.md                | Functional criteria, quality metrics, acceptance checklist   |\n| Post-Implementation  | tasks.md                | Automated checks, validation steps, stakeholder notification |\n\n## Auto-Decomposition\n\nThe agent **automatically** decomposes large plans - no user prompt needed.\n\n| Trigger      | Threshold          | Action                     |\n| ------------ | ------------------ | -------------------------- |\n| Subsystems   | >2 unrelated areas | Auto-split by subsystem    |\n| Total lines  | >2000 lines        | Auto-split by feature      |\n| Dependencies | Complex ordering   | Auto-split with depends_on |\n\n### Decomposition Output\n\nWhen the agent auto-decomposes a large plan:\n\n```\n===============================================================\nOPENSPEC PROPOSALS CREATED (DECOMPOSED)\n===============================================================\n\nParent Plan: .claude/plans/large-feature-plan.md\n\nProposals Created:\n  1. add-auth-backend (openspec/changes/add-auth-backend/)\n     - Scope: Authentication service, JWT handling\n     - Tasks: 5\n  2. add-auth-frontend (openspec/changes/add-auth-frontend/)\n     - Scope: Login UI, session management\n     - Tasks: 4\n     - Depends on: add-auth-backend\n  3. add-auth-tests (openspec/changes/add-auth-tests/)\n     - Scope: Integration tests, E2E tests\n     - Tasks: 3\n     - Depends on: add-auth-backend, add-auth-frontend\n\nDependency Graph:\n  add-auth-backend ‚îÄ‚î¨‚îÄ‚ñ∂ add-auth-frontend ‚îÄ‚î¨‚îÄ‚ñ∂ add-auth-tests\n                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nNext Steps (choose one):\n\nOption A - Beads (recommended for multi-spec):\n  /beads\n  /implement\n\nOption B - Sequential:\n  /implement (select each epic in order)\n\n===============================================================\n```\n\n## Step Mode (Default)\n\nStep mode pauses after creating proposal(s) for human review.\n\n**After creating proposal(s), you MUST use AskUserQuestion to pause.**\n\n```\nUse AskUserQuestion with:\n- question: \"Proposal(s) created. What would you like to do?\"\n- header: \"Next step\"\n- options:\n  - label: \"Continue (Recommended)\"\n    description: \"Proceed to /beads or /implement\"\n  - label: \"Stop\"\n    description: \"End here for manual review\"\n```\n\nUse `--auto` flag to skip pauses and proceed directly to next step.\n\n## Integration with Workflows\n\nThis command bridges the gap between planning and OpenSpec. Works with plans from **any planner**:\n\n```\n/plan-creator <task>           ‚îê\n/bug-plan-creator <error>      ‚îú‚îÄ‚ñ∂ .claude/plans/*-plan.md\n/code-quality-plan-creator     ‚îò\n    ‚îÇ\n    ‚ñº\n/openspec <plan-path>    ‚Üê THIS COMMAND\n    ‚îÇ\n    ‚îú‚îÄ‚îÄ‚îÄ [small/medium] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Single proposal\n    ‚îÇ                                  ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ [large: AUTO-DECOMPOSE] ‚îÄ‚îÄ‚ñ∂ Multiple proposals\n                                       ‚îÇ\n    ‚ñº                                  ‚ñº\nopenspec/changes/<id>/          openspec/changes/<id-1>/\n    ‚îÇ                           openspec/changes/<id-2>/\n    ‚ñº                                  ‚îÇ\n/beads ‚Üí /implement\n```\n",
        "architect/commands/review.md": "---\nallowed-tools: Bash, Read, Write, Edit, Glob, AskUserQuestion\nargument-hint: \"[spec-path]\"\ndescription: Interactive sprint-meeting-style review of OpenSpec proposals with editing\n---\n\n# OpenSpec Review\n\nInteractive, sprint-meeting-style review of OpenSpec proposals. The AI acts as a project manager, walking through specifications segment-by-segment, validating business logic, architecture, and development details. User feedback triggers immediate edits to the OpenSpec files with cascading updates.\n\n## Why Review?\n\nBefore converting an OpenSpec to beads and implementing, it's critical to validate:\n- **Business Logic**: Are we solving the right problem?\n- **Architecture**: Is the technical approach sound?\n- **Development**: Are implementation details correct?\n\nThis command provides a structured walkthrough that catches issues before code is written.\n\n## Arguments\n\n- **No argument**: Interactive mode - lists available OpenSpec changes and asks which to review\n- **Spec path**: Direct mode - uses the provided path (e.g., `openspec/changes/add-auth/`)\n\n## Instructions\n\n## Content Presentation Rules\n\n**CRITICAL**: When presenting sections for review, you MUST:\n\n1. **Show COMPLETE content** - Copy verbatim from the spec file\n2. **Do NOT summarize** - No TL;DR versions, paraphrasing, or bullet-point condensations\n3. **Provide context for file lists** - When showing affected files, explain WHY each is affected\n4. **Chunk long content** - If >100 lines, present in logical chunks but show ALL of it\n5. **Quote actual text** - Use blockquotes or code blocks to show exact spec content\n\n**Why this matters**: Users cannot validate quality from summaries. They need to see\nthe actual specification content that will drive implementation to catch errors,\ngaps, or misunderstandings BEFORE code is written.\n\n### Step 1: Validate Environment\n\n```bash\n# Check openspec is installed\nopenspec version 2>&1 | head -1\n\n# Check openspec is initialized\nls openspec/project.md 2>/dev/null && echo \"OpenSpec initialized\" || echo \"Not initialized\"\n```\n\nIf not installed: \"Install OpenSpec: https://github.com/Fission-AI/OpenSpec\"\nIf not initialized: \"Run: openspec init\"\n\n### Step 2: Determine Mode\n\n**If $ARGUMENTS contains a path** (e.g., `openspec/changes/...`):\n- Use direct mode - skip to Step 3\n\n**If $ARGUMENTS is empty**:\n- Use interactive mode - continue below\n\n### Step 2a: List Available OpenSpec Changes (Interactive Mode)\n\n```bash\n# List all directories in openspec/changes/ excluding archive/\nls -d openspec/changes/*/ 2>/dev/null | grep -v '/archive/' | while read dir; do\n  change_name=$(basename \"$dir\")\n  # Get brief description from proposal.md\n  desc=$(grep -A1 \"^# Change:\" \"$dir/proposal.md\" 2>/dev/null | tail -1 | head -c 60)\n  [ -z \"$desc\" ] && desc=$(grep -m1 \"^## Why\" -A1 \"$dir/proposal.md\" 2>/dev/null | tail -1 | head -c 60)\n  echo \"$change_name: $desc\"\ndone\n```\n\n**Present Available Changes:**\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Select an OpenSpec change to review:\"\n- header: \"OpenSpec\"\n- options:\n  - label: \"<change-name-1>\"\n    description: \"<brief overview from proposal.md>\"\n  - label: \"<change-name-2>\"\n    description: \"<brief overview from proposal.md>\"\n  ... (one option per available change, max 4)\n```\n\n**Handle Selection:**\n- If user selects a change name ‚Üí set `SPEC_PATH=openspec/changes/<selected>/`\n- If user selects \"Other\" ‚Üí use their custom input as path\n\n**Edge Cases:**\n- No changes found ‚Üí \"No OpenSpec changes found. Run `/openspec` first.\"\n- All in archive ‚Üí \"All changes archived. Run `/openspec` to create new.\"\n\n### Step 3: Read and Parse All Spec Files\n\n```bash\n# Read all spec files\ncat $SPEC_PATH/proposal.md\ncat $SPEC_PATH/design.md\ncat $SPEC_PATH/tasks.md\nfind $SPEC_PATH/specs -name \"*.md\" -exec cat {} \\; 2>/dev/null\n```\n\nParse and identify:\n- **Proposal sections**: Why, What Changes, Impact, Success Criteria, Out of Scope\n- **Requirements**: All `### Requirement:` blocks from specs/*.md\n- **Design sections**: Decisions, Reference Implementation, Migration Patterns, Risk Analysis\n- **Tasks sections**: Phases, Exit Criteria, Success Conditions\n\nStore the change name for reporting: `CHANGE_NAME=$(basename $SPEC_PATH)`\n\n### Step 4: Review Proposal.md (Section by Section)\n\nFor each section in proposal.md, conduct a focused review.\n\n#### 4.1: Review \"Why\" (Motivation)\n\nPresent the section:\n```\n===============================================================\nREVIEWING: Why (Motivation)\n===============================================================\n\n<content of \"## Why\" section>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Is the motivation for this change correct? Does it solve the right problem?\"\n- header: \"Why\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"The motivation is correct, move to the next section\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback or corrections for this section\"\n```\n\n**If \"Yes, continue\"**: Move to 4.2\n\n**If \"No, needs changes\"**:\n1. Say: \"What changes are needed for the motivation?\"\n2. Wait for user's response\n3. Edit proposal.md immediately with the feedback\n4. Show the edit: \"Updated the 'Why' section in proposal.md with: <summary of change>\"\n5. Ask confirmation:\n```\nUse AskUserQuestion with:\n- question: \"Is this update correct?\"\n- header: \"Confirm\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Update is correct, move to next section\"\n  - label: \"No, adjust further\"\n    description: \"Make additional adjustments\"\n```\n6. If \"No, adjust further\" ‚Üí repeat from step 1\n7. Continue to 4.2\n\n#### 4.2: Review \"What Changes\" (Scope)\n\nPresent the section:\n```\n===============================================================\nREVIEWING: What Changes (Scope)\n===============================================================\n\n<content of \"## What Changes\" section>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Is the scope of changes correct? Are all changes listed?\"\n- header: \"Scope\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"The scope is correct, move to the next section\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback or corrections for the scope\"\n```\n\nHandle \"No\" the same way as 4.1 - open discussion, edit, confirm.\n\n#### 4.3: Review \"Success Criteria\"\n\nPresent the section:\n```\n===============================================================\nREVIEWING: Success Criteria\n===============================================================\n\n<content of \"## Success Criteria\" section>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Are the success criteria measurable and complete?\"\n- header: \"Criteria\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Success criteria are correct, move to the next section\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback or corrections for success criteria\"\n```\n\nHandle \"No\" the same way - open discussion, edit, confirm.\n\n**Cascading**: If success criteria change, also check and update tasks.md \"Success Conditions\" section.\n\n#### 4.4: Review \"Out of Scope\"\n\nPresent the section:\n```\n===============================================================\nREVIEWING: Out of Scope\n===============================================================\n\n<content of \"## Out of Scope\" section>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Is the out-of-scope section clear? Are boundaries well-defined?\"\n- header: \"Boundaries\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Boundaries are clear, proceed to requirements review\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback or corrections for boundaries\"\n```\n\nHandle \"No\" the same way - open discussion, edit, confirm.\n\n### Step 5: Review Requirements (specs/*.md)\n\nFor each requirement in specs/*.md, conduct a 3-level validation.\n\n**List all requirements first:**\n```bash\ngrep -h \"^### Requirement:\" $SPEC_PATH/specs/*/spec.md 2>/dev/null\n```\n\nReport: \"Found N requirements to review.\"\n\n**For each requirement:**\n\n#### 5.1: Business Logic Validation\n\nPresent the requirement:\n```\n===============================================================\nREQUIREMENT: <Requirement Name>\nLevel: BUSINESS LOGIC\n===============================================================\n\n<Full requirement text including all scenarios>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Is this business requirement correct? Does it solve the right problem?\"\n- header: \"Business\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Business logic is correct, proceed to architecture review\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback on the business requirement\"\n```\n\n**If \"No, needs changes\"**:\n1. Say: \"What changes are needed for this business requirement?\"\n2. Wait for user's response\n3. Edit the spec file immediately\n4. **Cascading**: Check if related tasks need updating in tasks.md\n5. Show changes: \"Updated requirement in specs/<area>/spec.md. Also updated related tasks in tasks.md.\"\n6. Confirm the edit, then continue\n\n#### 5.2: Architecture Validation\n\nFind related design decisions from design.md based on the requirement name/area.\n\nPresent:\n```\n===============================================================\nREQUIREMENT: <Requirement Name>\nLevel: ARCHITECTURE\n===============================================================\n\n## Related Design Decisions\n\n<Relevant decisions from design.md that relate to this requirement>\n\n## Component Design\n\n<Relevant component/interface definitions>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Is the technical approach for this requirement sound?\"\n- header: \"Architecture\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Architecture is sound, proceed to development review\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback on the technical approach\"\n```\n\n**If \"No, needs changes\"**:\n1. Say: \"What changes are needed for the technical approach?\"\n2. Wait for user's response\n3. Edit design.md immediately\n4. **Cascading**: Check if related Reference Implementation code needs updating\n5. Show changes and confirm\n\n#### 5.3: Development Validation\n\nFind related tasks from tasks.md based on the requirement name/area.\n\nPresent:\n```\n===============================================================\nREQUIREMENT: <Requirement Name>\nLevel: DEVELOPMENT\n===============================================================\n\n## Related Tasks\n\n<Tasks from tasks.md that implement this requirement>\n\n## Exit Criteria for This Requirement\n\n<Relevant exit criteria commands>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Are the implementation details correct for this requirement?\"\n- header: \"Development\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Implementation details are correct, proceed to next requirement\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback on implementation details\"\n```\n\n**If \"No, needs changes\"**:\n1. Say: \"What changes are needed for the implementation details?\"\n2. Wait for user's response\n3. Edit tasks.md immediately\n4. Show changes and confirm\n\n**After completing all 3 levels, move to the next requirement.**\n\n### Step 6: Review Design.md (Remaining Sections)\n\nReview sections not covered during requirements review.\n\n#### 6.1: Review \"Impact\" (Now that architecture is validated)\n\nNow that requirements and architectural decisions have been validated in Step 5,\nreview the implementation impact from proposal.md.\n\nPresent the COMPLETE section from proposal.md:\n```\n===============================================================\nREVIEWING: Impact (Implementation Details)\n===============================================================\n\nThe requirements and architecture have been validated.\nNow let's review which files and systems are affected.\n\n<COMPLETE content of \"## Impact\" section from proposal.md - verbatim>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Given the validated architecture, is the implementation impact correct?\"\n- header: \"Impact\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Impact assessment aligns with the validated approach\"\n  - label: \"No, needs changes\"\n    description: \"I have corrections for the impact assessment\"\n```\n\nHandle \"No\" the same way - open discussion, edit, confirm.\n\n**Note**: If impact changes significantly, check if this affects the architecture\ndecisions reviewed in Step 5. If so, inform the user and offer to revisit.\n\n#### 6.2: Reference Implementation\n\nIf design.md has a \"Reference Implementation\" section with code:\n\nPresent:\n```\n===============================================================\nREVIEWING: Reference Implementation\n===============================================================\n\n<Summary of files and code in Reference Implementation section>\n\nFiles:\n- <file1>: <line count> lines\n- <file2>: <line count> lines\n...\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Is the reference implementation code complete and accurate?\"\n- header: \"Code\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Reference implementation is correct\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback on the reference implementation\"\n```\n\nHandle \"No\" with discussion ‚Üí edit ‚Üí confirm.\n\n#### 6.3: Migration Patterns\n\nIf design.md has migration patterns:\n\nPresent:\n```\n===============================================================\nREVIEWING: Migration Patterns\n===============================================================\n\n<Summary of before/after patterns>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Are the migration patterns (before/after) correct?\"\n- header: \"Migration\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Migration patterns are correct\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback on migration patterns\"\n```\n\nHandle \"No\" with discussion ‚Üí edit ‚Üí confirm.\n\n#### 6.4: Risk Analysis\n\nIf design.md has risk analysis:\n\nPresent:\n```\n===============================================================\nREVIEWING: Risk Analysis\n===============================================================\n\n## Technical Risks\n<risk table>\n\n## Integration Risks\n<risk table>\n\n## Rollback Strategy\n<rollback details>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Is the risk analysis complete? Are mitigations adequate?\"\n- header: \"Risks\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Risk analysis is adequate\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback on risk analysis\"\n```\n\nHandle \"No\" with discussion ‚Üí edit ‚Üí confirm.\n\n### Step 7: Review Tasks.md (Final Validation)\n\n#### 7.1: Task Phases and Ordering\n\nPresent:\n```\n===============================================================\nREVIEWING: Task Phases\n===============================================================\n\n<List of phases with task counts>\n\nPhase 1: <name> - N tasks\nPhase 2: <name> - N tasks\n...\nPhase N: Validation - N tasks\n\nTotal Tasks: <count>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Is the task ordering and phasing correct?\"\n- header: \"Phases\"\n- options:\n  - label: \"Yes, continue\"\n    description: \"Task phases are well-organized\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback on task organization\"\n```\n\nHandle \"No\" with discussion ‚Üí edit ‚Üí confirm.\n\n#### 7.2: Exit Criteria\n\nPresent:\n```\n===============================================================\nREVIEWING: Exit Criteria\n===============================================================\n\nCommands to run:\n<exact commands from Exit Criteria section>\n\nSuccess Conditions:\n<list from Success Conditions section>\n\n===============================================================\n```\n\nUse AskUserQuestion:\n```\nUse AskUserQuestion with:\n- question: \"Are the exit criteria and success conditions complete?\"\n- header: \"Exit Criteria\"\n- options:\n  - label: \"Yes, complete review\"\n    description: \"Exit criteria are complete, finish the review\"\n  - label: \"No, needs changes\"\n    description: \"I have feedback on exit criteria\"\n```\n\nHandle \"No\" with discussion ‚Üí edit ‚Üí confirm.\n\n### Step 8: Completion\n\n```\n===============================================================\nOPENSPEC REVIEW COMPLETE\n===============================================================\n\nChange: <CHANGE_NAME>\nPath: <SPEC_PATH>\n\nSections Reviewed:\n  Proposal.md:\n    [x] Why (Motivation)\n    [x] What Changes (Scope)\n    [x] Success Criteria\n    [x] Out of Scope\n\n  Requirements (specs/*.md):\n    [x] <requirement-1> (Business + Architecture + Development)\n    [x] <requirement-2> (Business + Architecture + Development)\n    ...\n\n  Design.md:\n    [x] Impact (validated after architecture)\n    [x] Reference Implementation\n    [x] Migration Patterns\n    [x] Risk Analysis\n\n  Tasks.md:\n    [x] Task Phases\n    [x] Exit Criteria\n\nEdits Made: <count> (if any)\n\n===============================================================\nNEXT STEPS\n===============================================================\n\nThe OpenSpec has been validated and is ready for implementation.\n\n1. Convert to beads: /beads <SPEC_PATH>\n2. Then implement: /implement\n\n===============================================================\n```\n\n## Workflow Diagram\n\n```\n/architect:review [spec-path]\n    ‚îÇ\n    ‚îú‚îÄ‚îÄ‚îÄ [interactive] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ    List available OpenSpec changes                        ‚îÇ\n    ‚îÇ    AskUserQuestion: Select one                            ‚îÇ\n    ‚îÇ                                                           ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ [direct] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                    ‚îÇ\n                                    ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    PROPOSAL.MD REVIEW                         ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  For each section:                                            ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ Present section                                         ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ Ask: \"Is this correct?\"                                 ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ Yes ‚Üí next section                                      ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ No ‚Üí Discussion ‚Üí Edit ‚Üí Confirm ‚Üí next section         ‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  Sections: Why ‚Üí What Changes ‚Üí Criteria ‚Üí Out of Scope      ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                    ‚îÇ\n                                    ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    REQUIREMENTS REVIEW                        ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  For each requirement:                                        ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ BUSINESS: \"Is this requirement correct?\"                ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ Yes ‚Üí Architecture | No ‚Üí Edit spec + tasks ‚Üí confirm   ‚îÇ  ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ\n‚îÇ  ‚îÇ ARCHITECTURE: \"Is the approach sound?\"                  ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ Yes ‚Üí Development | No ‚Üí Edit design ‚Üí confirm          ‚îÇ  ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ\n‚îÇ  ‚îÇ DEVELOPMENT: \"Are implementation details correct?\"      ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ Yes ‚Üí next req | No ‚Üí Edit tasks ‚Üí confirm              ‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                    ‚îÇ\n                                    ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    DESIGN.MD REVIEW                           ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  Impact (from proposal.md) ‚Üí Ref Implementation ‚Üí             ‚îÇ\n‚îÇ  Migration Patterns ‚Üí Risk Analysis                           ‚îÇ\n‚îÇ  Same Yes/No pattern with immediate edits                     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                    ‚îÇ\n                                    ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    TASKS.MD REVIEW                            ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  Task Phases ‚Üí Exit Criteria                                  ‚îÇ\n‚îÇ  Same Yes/No pattern with immediate edits                     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                    ‚îÇ\n                                    ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    COMPLETION                                 ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  Report: \"Review complete\"                                    ‚îÇ\n‚îÇ  Suggest: \"/beads <path>\" ‚Üí \"/implement\"                      ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n## Cascading Updates\n\nWhen editing one file, related files may need updates:\n\n| Edit | Also Update |\n|------|-------------|\n| Requirement in specs/*.md | Related tasks in tasks.md |\n| Success criteria in proposal.md | Success conditions in tasks.md |\n| Design decision in design.md | Reference implementation code in design.md, Impact section in proposal.md |\n| Impact in proposal.md | May require revisiting design decisions if files/scope changed significantly |\n| Task scope in tasks.md | Exit criteria commands |\n\nAlways inform the user: \"I've also updated <file> to reflect this change.\"\n\n## Edit Flow Pattern\n\nWhen user selects \"No, needs changes\":\n\n```\n1. AI: \"What changes are needed for this section?\"\n2. User: <provides feedback>\n3. AI: Edits the file immediately using Edit or Write tool\n4. AI: Shows summary: \"Updated <file> with: <brief summary>\"\n5. AI: Checks for cascading updates needed\n6. AI: If cascading needed: \"I've also updated <other-file> to keep consistency.\"\n7. AI: Asks confirmation:\n   AskUserQuestion:\n   - question: \"Is this update correct?\"\n   - header: \"Confirm\"\n   - options:\n     - label: \"Yes, continue\"\n     - label: \"No, adjust further\"\n8. If \"No, adjust further\": repeat from step 1\n9. Continue to next section\n```\n\n## Git Policy\n\n**NEVER push to git.** Do not run `git push` or any command that pushes to remote. The user will push manually when ready.\n\n## Error Handling\n\n| Scenario | Action |\n|----------|--------|\n| OpenSpec not installed | \"Install OpenSpec: https://github.com/Fission-AI/OpenSpec\" |\n| OpenSpec not initialized | \"Run: openspec init\" |\n| No changes found | \"No OpenSpec changes found. Run `/openspec` first.\" |\n| Path not found | Report error, suggest correct path |\n| Spec file missing | Report which file is missing, cannot proceed |\n\n## Example Usage\n\n```bash\n# Interactive mode (lists available changes)\n/architect:review\n\n# Direct mode with specific spec\n/architect:review openspec/changes/add-auth/\n\n# After review completes\n/beads openspec/changes/add-auth/\n/implement\n```\n"
      },
      "plugins": [
        {
          "name": "architect",
          "version": "1.0.1",
          "description": "4 commands, 2 agents. OpenSpec proposals, Beads creation, and implementation execution.",
          "source": "./architect",
          "categories": [],
          "install_commands": [
            "/plugin marketplace add carlonicora/cc-architect",
            "/plugin install architect@cc-architect"
          ]
        }
      ]
    }
  ]
}