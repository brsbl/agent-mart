{
  "author": {
    "id": "Yvictor",
    "display_name": "Yvictor",
    "avatar_url": "https://avatars.githubusercontent.com/u/8242025?u=fc6b0164da6cd3fd5a2280be2b99c3a731c15463&v=4"
  },
  "marketplaces": [
    {
      "name": "polars-backtest-marketplace",
      "version": null,
      "description": "Polars backtest extension development helper - backtesting with polars expressions",
      "repo_full_name": "Yvictor/polars_backtest_extension",
      "repo_url": "https://github.com/Yvictor/polars_backtest_extension",
      "repo_description": "Blazingly fast portfolio backtesting for Polars",
      "signals": {
        "stars": 2,
        "forks": 2,
        "pushed_at": "2026-01-24T06:40:23Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"polars-backtest-marketplace\",\n  \"owner\": {\n    \"name\": \"Yvictor\",\n    \"url\": \"https://github.com/Yvictor\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"polars-backtest\",\n      \"source\": \"./\",\n      \"description\": \"Polars backtest extension development helper - backtesting with polars expressions\"\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"polars-backtest\",\n  \"version\": \"0.1.6\",\n  \"description\": \"Polars backtest extension development helper - backtesting with polars expressions\",\n  \"author\": {\n    \"name\": \"Yvictor\",\n    \"url\": \"https://github.com/Yvictor\"\n  },\n  \"repository\": \"https://github.com/Yvictor/polars_backtest_extension\",\n  \"license\": \"PolyForm Noncommercial 1.0.0\",\n  \"keywords\": [\"polars\", \"backtest\", \"trading\", \"quantitative\", \"finance\"],\n  \"skills\": \"./skills/\"\n}\n",
        "README.md": "# polars-backtest\n\nBlazingly fast portfolio backtesting for Polars\n\n- Blazingly fast, written in Rust with Arrow\n- Native Polars integration with `df.bt.backtest()` namespace\n- T+1 execution, stop loss, take profit, trailing stop\n- Touched exit with intraday OHLC detection\n\n## Installation\n\n```bash\npip install polars-backtest\n# or\nuv add polars-backtest\n```\n\n## Quick Start\n\n```python\nimport polars as pl\nimport polars_backtest as pl_bt\n\n# Long format data: one row per (date, symbol)\ndf = pl.DataFrame({\n    \"date\": [\"2024-01-01\", \"2024-01-01\", \"2024-01-02\", \"2024-01-02\"],\n    \"symbol\": [\"AAPL\", \"GOOGL\", \"AAPL\", \"GOOGL\"],\n    \"close\": [100.0, 50.0, 102.0, 51.0],\n    \"weight\": [0.6, 0.4, 0.6, 0.4],\n})\n\n# Run backtest\nresult = df.bt.backtest(trade_at_price=\"close\", position=\"weight\")\n```\n\n## Performance\n\n**300-day breakout strategy** (~2000 stocks, 17 years daily data, 12M rows):\n\n```python\n# Finlab\nposition = close >= close.rolling(300).max()\nreport = backtest.sim(position, resample=\"M\")\n\n# polars_backtest\ndf = df.with_columns(\n    (pl.col(\"close\") >= pl.col(\"close\").rolling_max(300).over(\"symbol\"))\n    .alias(\"weight\")\n)\nreport = df.bt.backtest_with_report(position=\"weight\", resample=\"M\")\n```\n\n| | Finlab | polars_backtest |\n|---|--------|-----------------|\n| Time | 3.7s | 244ms |\n| Speedup | 1x | **15x faster** |\n\n```bash\njust bench  # Run benchmarks\n```\n\n## Features\n\n- **Rust Core** - Pure Rust implementation with Arrow\n- **Native Polars** - Works with long format DataFrames, supports Polars expressions\n- **T+1 Execution** - Realistic trading simulation\n- **Risk Management** - Stop loss, take profit, trailing stop, touched exit (OHLC)\n- **Flexible Rebalancing** - Daily, weekly, monthly, or on position change\n- **Claude Code Skill** - AI-powered assistance for backtesting\n\n## Claude Code Integration\n\nGet AI-powered assistance for writing and analyzing backtests.\n\n### Install the Skill\n\n```bash\n# 1. Add the marketplace\n/plugin marketplace add Yvictor/polars_backtest_extension\n\n# 2. Install the plugin\n/plugin install polars-backtest@polars-backtest-marketplace\n```\n\nAfter installation, Claude Code can help you:\n- Write backtest strategies using Polars expressions\n- Understand all parameters and their effects\n- Analyze results with `get_metrics()`, `get_stats()`, etc.\n- Debug and optimize your trading strategies\n\n---\n\n## Usage\n\n### Basic Backtest\n\n```python\nimport polars_backtest as pl_bt\n\n# Function API\nresult = pl_bt.backtest(df, trade_at_price=\"close\", position=\"weight\")\n\n# DataFrame namespace\nresult = df.bt.backtest(trade_at_price=\"close\", position=\"weight\")\n```\n\n### With Expressions\n\n```python\nresult = df.bt.backtest(\n    trade_at_price=\"close\",\n    position=pl.col(\"signal\").cast(pl.Float64),\n    resample=\"M\",\n)\n```\n\n### Full Report with Trades\n\n```python\nreport = pl_bt.backtest_with_report(df, trade_at_price=\"adj_close\", resample=\"M\")\nreport\n```\n\n```\nBacktestReport(\n  creturn_len=4219,\n  trades_count=6381,\n  total_return=8761.03%,\n  cagr=29.85%,\n  max_drawdown=-35.21%,\n  sharpe=1.13,\n  win_ratio=46.33%\n)\n```\n\n```python\nreport.get_stats()  # or report.stats\n```\n\n```\nshape: (1, 15)\n┌────────────┬────────────┬──────┬──────────────┬──────────┬──────────────┬──────────────┐\n│ start      ┆ end        ┆ rf   ┆ total_return ┆ cagr     ┆ max_drawdown ┆ avg_drawdown │\n│ ---        ┆ ---        ┆ ---  ┆ ---          ┆ ---      ┆ ---          ┆ ---          │\n│ date       ┆ date       ┆ f64  ┆ f64          ┆ f64      ┆ f64          ┆ f64          │\n╞════════════╪════════════╪══════╪══════════════╪══════════╪══════════════╪══════════════╡\n│ 2008-10-31 ┆ 2025-12-31 ┆ 0.02 ┆ 87.610293    ┆ 0.298538 ┆ -0.352092    ┆ -0.042957    │\n└────────────┴────────────┴──────┴──────────────┴──────────┴──────────────┴──────────────┘\n┌────────────┬───────────┬──────────────┬───────────────┬──────────┬───────────┬─────────┬───────────┐\n│ daily_mean ┆ daily_vol ┆ daily_sharpe ┆ daily_sortino ┆ best_day ┆ worst_day ┆ calmar  ┆ win_ratio │\n│ ---        ┆ ---       ┆ ---          ┆ ---           ┆ ---      ┆ ---       ┆ ---     ┆ ---       │\n│ f64        ┆ f64       ┆ f64          ┆ f64           ┆ f64      ┆ f64       ┆ f64     ┆ f64       │\n╞════════════╪═══════════╪══════════════╪═══════════════╪══════════╪═══════════╪═════════╪═══════════╡\n│ 0.300815   ┆ 0.249645  ┆ 1.131947     ┆ 1.834553      ┆ 0.195416 ┆ -0.160707 ┆ 0.84784 ┆ 0.463303  │\n└────────────┴───────────┴──────────────┴───────────────┴──────────┴───────────┴─────────┴───────────┘\n```\n\n```python\nreport.creturn   # Cumulative returns DataFrame\nreport.trades    # Trade records with MAE/MFE metrics\nreport.stats     # Statistics (same as get_stats())\n```\n\n### Benchmark Comparison\n\nCompare strategy performance against a benchmark to get alpha, beta, and rolling win rate:\n\n```python\n# Method 1: Use a symbol from your data as benchmark\nreport = df.bt.backtest_with_report(\n    position=\"weight\",\n    benchmark=\"0050\",  # Symbol value (e.g., ETF ticker)\n)\n\n# Method 2: Provide a benchmark DataFrame\nbenchmark_df = pl.DataFrame({\n    \"date\": [...],\n    \"creturn\": [...],  # Cumulative return starting at 1.0\n})\nreport = df.bt.backtest_with_report(position=\"weight\", benchmark=benchmark_df)\n\n# Method 3: Set benchmark after creation\nreport = df.bt.backtest_with_report(position=\"weight\")\nreport.benchmark = benchmark_df\n\n# get_metrics includes benchmark metrics when benchmark is set\nmetrics = report.get_metrics()\n# Includes: alpha, beta, m12WinRate (12-month rolling win rate vs benchmark)\n```\n\n### Liquidity Metrics\n\nGet liquidity metrics by providing optional columns in your DataFrame:\n\n```python\ndf = pl.DataFrame({\n    \"date\": dates,\n    \"symbol\": symbols,\n    \"close\": prices,\n    \"weight\": weights,\n    \"limit_up\": limit_up_prices,      # For buyHigh metric\n    \"limit_down\": limit_down_prices,  # For sellLow metric\n    \"trading_value\": trading_values,  # For capacity metric (e.g., close_raw * volume)\n})\n\nreport = df.bt.backtest_with_report(position=\"weight\")\nmetrics = report.get_metrics(sections=[\"liquidity\"])\n# Includes: buyHigh, sellLow, capacity\n```\n\n| Metric | Required Column | Description |\n|--------|-----------------|-------------|\n| `buyHigh` | `limit_up` | Ratio of entries at limit-up price |\n| `sellLow` | `limit_down` | Ratio of exits at limit-down price |\n| `capacity` | `trading_value` | Strategy capacity (10th percentile of accepted money flow) |\n\nMetrics return `null` if the required column is not present.\n\n### Parameters\n\n| Parameter | Default | Description |\n|-----------|---------|-------------|\n| `trade_at_price` | `\"close\"` | Price column for execution |\n| `position` | `\"weight\"` | Position/weight column |\n| `benchmark` | `None` | Benchmark: symbol str or DataFrame with (date, creturn) |\n| `resample` | `\"D\"` | Rebalance frequency |\n| `resample_offset` | `None` | Delay rebalance by N days (e.g., `\"1d\"`, `\"2d\"`, `\"1W\"`) |\n| `fee_ratio` | `0.001425` | Transaction fee |\n| `tax_ratio` | `0.003` | Transaction tax |\n| `stop_loss` | `1.0` | Stop loss threshold (1.0 = disabled) |\n| `take_profit` | `inf` | Take profit threshold |\n| `trail_stop` | `inf` | Trailing stop: exit when `maxcr - cr >= trail_stop` |\n| `touched_exit` | `False` | Use OHLC for intraday stop detection |\n\n---\n\n### Resample Options\n\n| Value | Description |\n|-------|-------------|\n| `None` | Only rebalance when position changes |\n| `'D'` | Daily |\n| `'W'` | Weekly (last trading day) |\n| `'W-FRI'` | Weekly on Friday |\n| `'M'` | Monthly (last trading day) |\n| `'Q'` | Quarterly |\n| `'Y'` | Yearly |\n\n## Development\n\n### Setup\n\n```bash\njust sync   # Install dependencies\njust build  # Build extension\n```\n\n### Test\n\n```bash\njust test       # Fast tests (81)\njust test-slow  # Slow tests (86)\njust test-all   # All tests\njust bench      # Benchmarks\n```\n\n### Workflow\n\n```bash\njust check      # Rust check\njust test-rust  # Rust tests\njust build      # Build extension\njust test       # Python tests\njust ci         # Full CI\n```\n\n---\n\n## Project Structure\n\n```\npolars_backtest_extension/\n├── btcore/                 # Pure Rust core\n│   └── src/simulation/\n│       ├── wide.rs         # Wide format backtest\n│       └── long.rs         # Long format (Arrow FFI)\n└── polars_backtest/\n    ├── python/             # Python API\n    │   └── polars_backtest/\n    │       ├── namespace.py  # df.bt namespace\n    │       └── wide.py       # Wide format API\n    ├── src/                # PyO3 bindings\n    │   └── lib.rs\n    ├── tests/\n    └── benchmarks/\n```\n\n## License\n\nPolyForm Noncommercial 1.0.0\n\nFor commercial use, please contact the author to obtain a commercial license.\n"
      },
      "plugins": [
        {
          "name": "polars-backtest",
          "source": "./",
          "description": "Polars backtest extension development helper - backtesting with polars expressions",
          "categories": [],
          "install_commands": [
            "/plugin marketplace add Yvictor/polars_backtest_extension",
            "/plugin install polars-backtest@polars-backtest-marketplace"
          ]
        }
      ]
    }
  ]
}