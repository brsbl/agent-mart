{
  "author": {
    "id": "masuP9",
    "display_name": "Soichi Masuda",
    "avatar_url": "https://avatars.githubusercontent.com/u/6724665?v=4"
  },
  "marketplaces": [
    {
      "name": "codex-collab",
      "version": null,
      "description": "Claude Code と OpenAI Codex CLI の協調タスク実行プラグイン",
      "repo_full_name": "masuP9/codex-collab",
      "repo_url": "https://github.com/masuP9/codex-collab",
      "repo_description": "Claude Code と OpenAI Codex CLI を協調させてタスクを実行するプラグイン",
      "signals": {
        "stars": 2,
        "forks": 0,
        "pushed_at": "2026-01-28T13:02:50Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"codex-collab\",\n  \"owner\": {\n    \"name\": \"masuP9\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"codex-collab\",\n      \"source\": \"./\",\n      \"description\": \"Claude Code と OpenAI Codex CLI の協調タスク実行プラグイン\",\n      \"version\": \"0.12.0\",\n      \"author\": {\n        \"name\": \"masuP9\"\n      }\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"codex-collab\",\n  \"version\": \"0.12.0\",\n  \"description\": \"Claude Code と OpenAI Codex CLI の協調タスク実行プラグイン\",\n  \"author\": {\n    \"name\": \"masuP9\"\n  }\n}\n",
        "README.md": "# codex-collab\n\nClaude Code と OpenAI Codex CLI を協調させてタスクを実行するプラグイン。\n\n## 概要\n\nこのプラグインは、Claude Code と Codex の強みを組み合わせた協調ワークフローを提供します。\n\n**基本パターン（レビュー型）:**\n- **Codex**: 計画作成・コードレビュー\n- **Claude Code**: 実装\n\n## インストール\n\n```bash\n# マーケットプレイスを追加\n/plugin marketplace add https://github.com/masuP9/codex-collab\n\n# プラグインをインストール\n/plugin install codex-collab@codex-collab\n```\n\n## 前提条件\n\n- OpenAI Codex CLI (`codex`) がインストールされていること\n- 環境変数 `OPENAI_API_KEY` が設定されていること\n- WSL環境: Windows Terminal (`wt.exe`) が利用可能であること（リアルタイム出力確認用）\n- オプション: tmuxセッション内で作業している場合、フォーカスを奪わずにCodexを実行可能\n- オプション: `jq` (セッション状態管理に使用。未インストールの場合は毎回新規セッションとして扱う)\n\n## プロジェクト構造\n\n```\ncodex-collab/\n├── .claude-plugin/\n│   └── plugin.json        # プラグインメタデータ\n├── commands/\n│   ├── collab.md          # /collab コマンド\n│   └── collab-attach.md   # /collab-attach コマンド\n├── scripts/\n│   └── codex-helpers.sh   # 共通ヘルパー関数\n└── skills/\n    └── codex-collaboration/\n        └── references/     # プロトコル定義\n```\n\n### ヘルパースクリプト\n\n`scripts/codex-helpers.sh` には、コマンド間で共有される関数が定義されています:\n\n**基本関数:**\n- `codex_hash_content()` - クロスプラットフォームハッシュ計算\n- `codex_find_pane()` - Codexペイン検出（保存ID + 自動検出）\n- `codex_verify_pane()` - ペインの有効性検証\n- `codex_send_prompt()` - tmux paste-bufferでのプロンプト送信\n- `codex_send_prompt_file()` - ファイル参照によるプロンプト送信（長いプロンプト向け）\n- `codex_clear_input()` - ペイン入力欄のクリア\n- `codex_wait_completion()` - マーカー + アイドル検出による完了待機\n- `codex_capture_output()` - ペイン出力のキャプチャ\n- `codex_check_tmux()` - tmuxセッション確認\n- `codex_acquire_lock()` - 排他ロック取得（同時送信の競合防止）\n- `codex_release_lock()` - ロック解放\n\n**軽量メタデータ抽出:**\n- `codex_extract_metadata()` - 応答末尾のYAMLブロックを抽出\n- `codex_get_status()` - status フィールド取得（continue/stop）\n- `codex_get_verdict()` - verdict フィールド取得（pass/conditional/fail）\n- `codex_get_list()` - リストフィールド取得\n- `codex_parse_response()` - 応答を本文とメタデータに分離\n\n**自動承認（セキュア）:**\n- `codex_get_pending_command()` - アクティブな承認ダイアログを検出\n- `codex_approve_if_matches()` - パターンマッチで承認\n- `codex_approve_response_commands()` - set-buffer + wait-for を自動承認\n\n**セッション管理:**\n- `codex_collab_session_start()` - collabセッションを作成/アタッチ\n- `codex_collab_session_exists()` - セッション存在確認\n- `codex_collab_session_info()` - セッション情報表示\n- `codex_collab_session_kill()` - セッション終了\n\n各コマンドは自動的にヘルパーをsourceし、利用できない場合はインラインのフォールバック実装を使用します。\n\n## 使い方\n\n### `/collab` コマンド\n\n協調ワークフローを開始します。\n\n```\n/collab 新しい認証機能を実装して\n```\n\n**自動検出機能 (tmuxモード):**\n- tmuxセッション内で実行時、`tmp/codex-pane-id`がなくても既存のCodexペインを自動検出\n- 検出されたペインは`tmp/codex-pane-id`に保存され、attached modeで使用\n- 複数のCodexペインがある場合は最初のペインを使用（警告を表示）\n- Codexペインが見つからない場合は従来通り新規`codex exec`を起動\n\n### `/collab-attach` コマンド\n\n既存のCodexペインに接続して、永続的なコラボレーションを行います。\n\n```\n# まず別ペインでCodexを起動（インタラクティブモード）\ntmux split-window -h 'codex'\n\n# 既存のCodexペインにプロンプトを送信\n/collab-attach この機能の設計を考えて\n\n# ステータス確認\n/collab-attach status\n\n# 出力をキャプチャ\n/collab-attach capture\n\n# ペインIDをクリア（別のCodexペインに接続したい場合）\n/collab-attach detach\n```\n\n**特徴:**\n- tmuxセッション内で動作（`$TMUX`が必要）\n- 既存のCodexセッションを維持（コンテキストが保持される）\n- ペインIDは`tmp/codex-pane-id`に保存され、次回自動検出\n- **セッション状態管理**: 初回は完全コンテキスト、継続時は軽量な`## Update`形式で送信（トークン節約）\n- セッションは30分でタイムアウト（`tmp/codex-session-state`で管理）\n\n### プロジェクト内ソケットでの双方向通信（高度な使い方）\n\n`workspace-write` sandboxでCodexからClaude Codeへの通信を可能にするため、プロジェクト内にtmuxソケットを作成できます。\n\n```bash\n# ヘルパーをsource\nsource scripts/codex-helpers.sh\n\n# collabセッションを作成（Codex自動起動）\ncodex_collab_session_start --start-codex --attach\n\n# または手動でセッション作成\ntmux -S ./collab.sock new-session -s collab\n```\n\n**メリット:**\n- `workspace-write` sandboxでも双方向通信が可能\n- ポーリング不要のイベントドリブン完了検知（`wait-for`）\n- Codexの承認ダイアログを自動承認可能\n\n**構成:**\n```\n./collab.sock (プロジェクト内tmuxソケット)\n├── collab:1.0 - Claude Code (左ペイン)\n└── collab:1.1 - Codex (右ペイン)\n```\n\n詳細は `docs/bidirectional-communication-design.md` を参照してください。\n\n### スキルの自動起動\n\n以下のようなリクエストで自動的にスキルが有効になります:\n- 「Codexと協調してタスクを実行したい」\n- 「Codexにレビューを依頼して」\n- 「Codexに計画を作成させたい」\n\n## 設定\n\nプロジェクト固有の設定は `.claude/codex-collab.local.md` に記述できます。\n\n```markdown\n---\nmodel: o4-mini\nsandbox: read-only\n---\n\n# プロジェクト固有の指示\n\nこのプロジェクトでは TypeScript を使用しています。\n```\n\n### 設定オプション\n\n| オプション | デフォルト | 説明 |\n|-----------|-----------|------|\n| `model` | (Codexデフォルト) | 使用するモデル (o3, o4-mini等) |\n| `sandbox` | `read-only` | サンドボックスモード (read-only, workspace-write, danger-full-access) |\n| `launch.mode` | `auto` | 起動モード (auto, tmux, wt, inline)。autoはtmuxセッション内ならtmux、そうでなければwt→inline |\n| `exchange.enabled` | `true` | Planning exchangeのグローバルキルスイッチ |\n| `exchange.max_iterations` | `3` | Planning exchangeの最大ラウンド数 |\n| `exchange.user_confirm` | `on_important` | ユーザー確認タイミング (never, always, on_important) |\n| `exchange.history_mode` | `summarize` | 履歴管理方式: full=全履歴保持, summarize=最新2ラウンドのみ全文 |\n| `review.enabled` | `true` | Review iterationの有効化 |\n| `review.max_iterations` | `5` | Review iterationの最大ラウンド数（ゴールが明確なので多め） |\n| `review.user_confirm` | `never` | レビュー時は自動でイテレーション |\n\n### Launch Mode について\n\nCodexの起動方法を選択できます:\n\n| モード | 説明 | フォーカス奪取 | 完了検知 |\n|--------|------|---------------|---------|\n| `tmux` | 現在のペインを分割してCodexを実行（右側に表示） | なし | `tmux wait-for`（即時） |\n| `wt` | Windows Terminalの新しいペインで実行 | あり | ファイルポーリング |\n| `inline` | 現在のターミナルで実行（ブロッキング） | - | ファイルポーリング |\n| `auto` | tmuxセッション内ならtmux、そうでなければwt→inline | 状況による | モードに依存 |\n\n> **Note:** tmuxモードは現在のペインを水平分割し、右側でCodexを実行します。`tmux wait-for`によりCodex完了を即座に検知できます（ポーリング不要）。\n\n### 設定の優先順位\n\n```\nコマンド引数 > プロジェクト設定 > グローバル設定 > 安全デフォルト\n```\n\n## ワークフロー\n\n```\n1. ユーザー: /collab \"機能Xを実装して\"\n2. Claude Code: タスク分析・Codex向けプロンプト作成\n3. Codex: 計画作成\n4. Claude Code: 計画確認・実装\n5. Codex: レビュー（Pass/Fail/Conditional）\n6. Claude Code: 修正（必要に応じて）・完了報告\n```\n\n## 軽量メタデータプロトコル\n\nClaude Code と Codex CLI 間の議論をサポートする軽量なメタデータ形式を採用しています。\n\n### 設計思想\n\n- **本文は自然言語のまま**: LLM の表現力を制限しない\n- **メタデータは末尾に付加**: 応答の最後に YAML ブロックとして追加\n- **フォールバック可能**: メタデータがなくても本文は読める\n\n### メタデータ形式\n\n応答の末尾に `---` で囲まれた YAML ブロックを付加：\n\n```markdown\n（自然言語の応答本文）\n\n...議論や説明...\n\n---\nstatus: stop\nverdict: conditional\nopen_questions:\n  - 認証方式の選択\nfindings:\n  - severity: medium\n    message: 入力バリデーションが不足\n---\n```\n\n### フィールド一覧\n\n| フィールド | 型 | 説明 |\n|-----------|-----|------|\n| `status` | enum | `continue` / `stop` - 議論を続けるか終了するか |\n| `verdict` | enum | `pass` / `conditional` / `fail` - レビュー判定 |\n| `open_questions` | list | 未解決の質問 |\n| `decisions` | list | 合意した決定事項 |\n| `findings` | list | 発見事項（severity, message） |\n\n### 使用例\n\n**レビュー応答:**\n\n```markdown\nコードを確認しました。全体的に良い実装ですが、改善点があります。\n\n1. `validate_input()` で空文字列のチェックが抜けています\n2. エラーメッセージがハードコードされています\n\n---\nstatus: stop\nverdict: conditional\nfindings:\n  - severity: medium\n    message: validate_input() で空文字列チェックが不足\n  - severity: low\n    message: エラーメッセージのハードコード\n---\n```\n\n**議論応答（継続）:**\n\n```markdown\n認証方式について検討しました。JWT と Session の両方に利点がありますが...\n\nいくつか確認したい点があります：\n- ユーザー数の想定規模は？\n- モバイルアプリからのアクセスは想定していますか？\n\n---\nstatus: continue\nopen_questions:\n  - ユーザー規模の想定\n  - モバイルアプリ対応の有無\ndecisions:\n  - REST API で実装する\n---\n```\n\n### 関連ファイル\n\n詳細な仕様は `skills/codex-collaboration/references/` にあります：\n\n- `lightweight-metadata.md` - 軽量メタデータプロトコル仕様\n- `planning-prompt.md` - 計画依頼テンプレート\n- `review-prompt.md` - レビュー依頼テンプレート\n- `deprecated/` - 旧構造化プロトコル（参考用）\n\n## ライセンス\n\nMIT\n"
      },
      "plugins": [
        {
          "name": "codex-collab",
          "source": "./",
          "description": "Claude Code と OpenAI Codex CLI の協調タスク実行プラグイン",
          "version": "0.12.0",
          "author": {
            "name": "masuP9"
          },
          "categories": [],
          "install_commands": [
            "/plugin marketplace add masuP9/codex-collab",
            "/plugin install codex-collab@codex-collab"
          ]
        }
      ]
    }
  ]
}