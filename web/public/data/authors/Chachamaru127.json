{
  "author": {
    "id": "Chachamaru127",
    "display_name": "Chachamaru",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/96473544?u=a8d5eff3a421791ff83bcd976caeb792966dc7f7&v=4",
    "url": "https://github.com/Chachamaru127",
    "bio": null,
    "stats": {
      "total_marketplaces": 1,
      "total_plugins": 1,
      "total_commands": 83,
      "total_skills": 56,
      "total_stars": 153,
      "total_forks": 11
    }
  },
  "marketplaces": [
    {
      "name": "claude-code-harness-marketplace",
      "version": null,
      "description": "claude-code-harness の配布/導入を支援する（単一プラグイン）マーケットプレース",
      "owner_info": {
        "name": "Chachamaru"
      },
      "keywords": [],
      "repo_full_name": "Chachamaru127/claude-code-harness",
      "repo_url": "https://github.com/Chachamaru127/claude-code-harness",
      "repo_description": "Claude Code専用の開発ハーネス - 自律的なPlan→Work→Reviewサイクルで高品質な開発を実現",
      "homepage": null,
      "signals": {
        "stars": 153,
        "forks": 11,
        "pushed_at": "2026-01-29T13:16:57Z",
        "created_at": "2025-12-12T03:57:21Z",
        "license": "MIT"
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/hooks.json",
          "type": "blob",
          "size": 7652
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 922
        },
        {
          "path": ".claude-plugin/plugin.json",
          "type": "blob",
          "size": 545
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 6785
        },
        {
          "path": "agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "agents/ci-cd-fixer.md",
          "type": "blob",
          "size": 10367
        },
        {
          "path": "agents/code-reviewer.md",
          "type": "blob",
          "size": 4281
        },
        {
          "path": "agents/error-recovery.md",
          "type": "blob",
          "size": 8051
        },
        {
          "path": "agents/project-analyzer.md",
          "type": "blob",
          "size": 7439
        },
        {
          "path": "agents/project-scaffolder.md",
          "type": "blob",
          "size": 5450
        },
        {
          "path": "agents/project-state-updater.md",
          "type": "blob",
          "size": 5035
        },
        {
          "path": "agents/task-worker.md",
          "type": "blob",
          "size": 12934
        },
        {
          "path": "agents/video-scene-generator.md",
          "type": "blob",
          "size": 9697
        },
        {
          "path": "commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "commands/core",
          "type": "tree",
          "size": null
        },
        {
          "path": "commands/core/CLAUDE.md",
          "type": "blob",
          "size": 5460
        },
        {
          "path": "commands/core/cc-cursor-cc.md",
          "type": "blob",
          "size": 8670
        },
        {
          "path": "commands/core/harness-init.md",
          "type": "blob",
          "size": 12159
        },
        {
          "path": "commands/core/harness-review.md",
          "type": "blob",
          "size": 16274
        },
        {
          "path": "commands/core/plan-with-agent.md",
          "type": "blob",
          "size": 12764
        },
        {
          "path": "commands/core/skill-list.md",
          "type": "blob",
          "size": 2691
        },
        {
          "path": "commands/core/sync-status.md",
          "type": "blob",
          "size": 5087
        },
        {
          "path": "commands/core/work.md",
          "type": "blob",
          "size": 27590
        },
        {
          "path": "commands/handoff",
          "type": "tree",
          "size": null
        },
        {
          "path": "commands/handoff/CLAUDE.md",
          "type": "blob",
          "size": 2186
        },
        {
          "path": "commands/handoff/handoff-to-cursor.md",
          "type": "blob",
          "size": 3786
        },
        {
          "path": "commands/handoff/handoff-to-opencode.md",
          "type": "blob",
          "size": 3837
        },
        {
          "path": "commands/optional",
          "type": "tree",
          "size": null
        },
        {
          "path": "commands/optional/CLAUDE.md",
          "type": "blob",
          "size": 6543
        },
        {
          "path": "commands/optional/ci-setup.md",
          "type": "blob",
          "size": 10401
        },
        {
          "path": "commands/optional/codex-mode.md",
          "type": "blob",
          "size": 3769
        },
        {
          "path": "commands/optional/codex-review.md",
          "type": "blob",
          "size": 4953
        },
        {
          "path": "commands/optional/crud.md",
          "type": "blob",
          "size": 16387
        },
        {
          "path": "commands/optional/dev-tools-setup.md",
          "type": "blob",
          "size": 7539
        },
        {
          "path": "commands/optional/generate-video.md",
          "type": "blob",
          "size": 9650
        },
        {
          "path": "commands/optional/harness-mem.md",
          "type": "blob",
          "size": 18090
        },
        {
          "path": "commands/optional/harness-ui-setup.md",
          "type": "blob",
          "size": 1048
        },
        {
          "path": "commands/optional/harness-ui.md",
          "type": "blob",
          "size": 10684
        },
        {
          "path": "commands/optional/harness-update.md",
          "type": "blob",
          "size": 34649
        },
        {
          "path": "commands/optional/localize-rules.md",
          "type": "blob",
          "size": 3209
        },
        {
          "path": "commands/optional/lsp-setup.md",
          "type": "blob",
          "size": 7474
        },
        {
          "path": "commands/optional/mcp-setup.md",
          "type": "blob",
          "size": 5376
        },
        {
          "path": "commands/optional/opencode-setup.md",
          "type": "blob",
          "size": 3861
        },
        {
          "path": "commands/optional/release.md",
          "type": "blob",
          "size": 8340
        },
        {
          "path": "commands/optional/remotion-setup.md",
          "type": "blob",
          "size": 5136
        },
        {
          "path": "commands/optional/session.md",
          "type": "blob",
          "size": 1986
        },
        {
          "path": "commands/optional/setup.md",
          "type": "blob",
          "size": 3053
        },
        {
          "path": "commands/optional/skills-update.md",
          "type": "blob",
          "size": 2261
        },
        {
          "path": "commands/optional/sync-project-specs.md",
          "type": "blob",
          "size": 5406
        },
        {
          "path": "commands/optional/sync-ssot-from-memory.md",
          "type": "blob",
          "size": 5206
        },
        {
          "path": "commands/optional/webhook-setup.md",
          "type": "blob",
          "size": 8254
        },
        {
          "path": "harness-ui",
          "type": "tree",
          "size": null
        },
        {
          "path": "harness-ui/src",
          "type": "tree",
          "size": null
        },
        {
          "path": "harness-ui/src/client",
          "type": "tree",
          "size": null
        },
        {
          "path": "harness-ui/src/client/hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "harness-ui/src/client/hooks/usePlans.ts",
          "type": "blob",
          "size": 1756
        },
        {
          "path": "harness-ui/src/client/hooks/useProjects.ts",
          "type": "blob",
          "size": 3003
        },
        {
          "path": "harness-ui/src/client/hooks/useWebSocket.ts",
          "type": "blob",
          "size": 4677
        },
        {
          "path": "hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "hooks/BEST_PRACTICES.md",
          "type": "blob",
          "size": 1731
        },
        {
          "path": "hooks/hooks.json",
          "type": "blob",
          "size": 8098
        },
        {
          "path": "mcp-server",
          "type": "tree",
          "size": null
        },
        {
          "path": "mcp-server/README.md",
          "type": "blob",
          "size": 3459
        },
        {
          "path": "opencode",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/README.md",
          "type": "blob",
          "size": 3997
        },
        {
          "path": "opencode/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/commands/core",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/commands/core/cc-cursor-cc.md",
          "type": "blob",
          "size": 8563
        },
        {
          "path": "opencode/commands/core/harness-init.md",
          "type": "blob",
          "size": 12060
        },
        {
          "path": "opencode/commands/core/harness-review.md",
          "type": "blob",
          "size": 16169
        },
        {
          "path": "opencode/commands/core/plan-with-agent.md",
          "type": "blob",
          "size": 12681
        },
        {
          "path": "opencode/commands/core/skill-list.md",
          "type": "blob",
          "size": 2635
        },
        {
          "path": "opencode/commands/core/sync-status.md",
          "type": "blob",
          "size": 5012
        },
        {
          "path": "opencode/commands/core/work.md",
          "type": "blob",
          "size": 27510
        },
        {
          "path": "opencode/commands/handoff",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/commands/handoff/handoff-to-cursor.md",
          "type": "blob",
          "size": 1404
        },
        {
          "path": "opencode/commands/handoff/handoff-to-opencode.md",
          "type": "blob",
          "size": 1202
        },
        {
          "path": "opencode/commands/optional",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/commands/optional/ci-setup.md",
          "type": "blob",
          "size": 10342
        },
        {
          "path": "opencode/commands/optional/codex-mode.md",
          "type": "blob",
          "size": 3716
        },
        {
          "path": "opencode/commands/optional/codex-review.md",
          "type": "blob",
          "size": 4894
        },
        {
          "path": "opencode/commands/optional/crud.md",
          "type": "blob",
          "size": 16302
        },
        {
          "path": "opencode/commands/optional/dev-tools-setup.md",
          "type": "blob",
          "size": 7468
        },
        {
          "path": "opencode/commands/optional/generate-video.md",
          "type": "blob",
          "size": 9589
        },
        {
          "path": "opencode/commands/optional/harness-mem.md",
          "type": "blob",
          "size": 18020
        },
        {
          "path": "opencode/commands/optional/harness-ui-setup.md",
          "type": "blob",
          "size": 963
        },
        {
          "path": "opencode/commands/optional/harness-ui.md",
          "type": "blob",
          "size": 10619
        },
        {
          "path": "opencode/commands/optional/harness-update.md",
          "type": "blob",
          "size": 34518
        },
        {
          "path": "opencode/commands/optional/localize-rules.md",
          "type": "blob",
          "size": 3144
        },
        {
          "path": "opencode/commands/optional/lsp-setup.md",
          "type": "blob",
          "size": 7386
        },
        {
          "path": "opencode/commands/optional/mcp-setup.md",
          "type": "blob",
          "size": 5304
        },
        {
          "path": "opencode/commands/optional/opencode-setup.md",
          "type": "blob",
          "size": 3801
        },
        {
          "path": "opencode/commands/optional/release.md",
          "type": "blob",
          "size": 8252
        },
        {
          "path": "opencode/commands/optional/remotion-setup.md",
          "type": "blob",
          "size": 5076
        },
        {
          "path": "opencode/commands/optional/session-broadcast.md",
          "type": "blob",
          "size": 3390
        },
        {
          "path": "opencode/commands/optional/session-inbox.md",
          "type": "blob",
          "size": 3244
        },
        {
          "path": "opencode/commands/optional/session-list.md",
          "type": "blob",
          "size": 2516
        },
        {
          "path": "opencode/commands/optional/session.md",
          "type": "blob",
          "size": 1897
        },
        {
          "path": "opencode/commands/optional/setup.md",
          "type": "blob",
          "size": 2968
        },
        {
          "path": "opencode/commands/optional/skills-update.md",
          "type": "blob",
          "size": 2261
        },
        {
          "path": "opencode/commands/optional/sync-project-specs.md",
          "type": "blob",
          "size": 5335
        },
        {
          "path": "opencode/commands/optional/sync-ssot-from-memory.md",
          "type": "blob",
          "size": 5098
        },
        {
          "path": "opencode/commands/optional/webhook-setup.md",
          "type": "blob",
          "size": 8185
        },
        {
          "path": "opencode/commands/pm",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/commands/pm/handoff-to-claude.md",
          "type": "blob",
          "size": 1500
        },
        {
          "path": "opencode/commands/pm/plan-with-cc.md",
          "type": "blob",
          "size": 5229
        },
        {
          "path": "opencode/commands/pm/project-overview.md",
          "type": "blob",
          "size": 573
        },
        {
          "path": "opencode/commands/pm/review-cc-work.md",
          "type": "blob",
          "size": 5082
        },
        {
          "path": "opencode/commands/pm/start-session.md",
          "type": "blob",
          "size": 800
        },
        {
          "path": "opencode/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/2agent",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/2agent/SKILL.md",
          "type": "blob",
          "size": 895
        },
        {
          "path": "opencode/skills/2agent/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/2agent/references/2agent-setup.md",
          "type": "blob",
          "size": 8647
        },
        {
          "path": "opencode/skills/2agent/references/2agent-updating.md",
          "type": "blob",
          "size": 9964
        },
        {
          "path": "opencode/skills/2agent/references/cursor-setup.md",
          "type": "blob",
          "size": 1171
        },
        {
          "path": "opencode/skills/auth",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/auth/SKILL.md",
          "type": "blob",
          "size": 2704
        },
        {
          "path": "opencode/skills/auth/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/auth/references/authentication.md",
          "type": "blob",
          "size": 996
        },
        {
          "path": "opencode/skills/auth/references/payments.md",
          "type": "blob",
          "size": 875
        },
        {
          "path": "opencode/skills/ci",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/ci/SKILL.md",
          "type": "blob",
          "size": 4481
        },
        {
          "path": "opencode/skills/ci/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/ci/references/analyzing-failures.md",
          "type": "blob",
          "size": 4100
        },
        {
          "path": "opencode/skills/ci/references/fixing-tests.md",
          "type": "blob",
          "size": 4563
        },
        {
          "path": "opencode/skills/codex-review",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/codex-review/SKILL.md",
          "type": "blob",
          "size": 6654
        },
        {
          "path": "opencode/skills/codex-review/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/codex-review/references/codex-mcp-setup.md",
          "type": "blob",
          "size": 5270
        },
        {
          "path": "opencode/skills/codex-review/references/codex-parallel-review.md",
          "type": "blob",
          "size": 12235
        },
        {
          "path": "opencode/skills/codex-review/references/codex-review-integration.md",
          "type": "blob",
          "size": 4418
        },
        {
          "path": "opencode/skills/codex-review/references/experts",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/codex-review/references/experts/acceptance-expert.md",
          "type": "blob",
          "size": 1638
        },
        {
          "path": "opencode/skills/codex-review/references/experts/accessibility-expert.md",
          "type": "blob",
          "size": 1922
        },
        {
          "path": "opencode/skills/codex-review/references/experts/architect-expert.md",
          "type": "blob",
          "size": 2181
        },
        {
          "path": "opencode/skills/codex-review/references/experts/clarity-expert.md",
          "type": "blob",
          "size": 1229
        },
        {
          "path": "opencode/skills/codex-review/references/experts/dependencies-expert.md",
          "type": "blob",
          "size": 1530
        },
        {
          "path": "opencode/skills/codex-review/references/experts/feasibility-expert.md",
          "type": "blob",
          "size": 1393
        },
        {
          "path": "opencode/skills/codex-review/references/experts/impact-expert.md",
          "type": "blob",
          "size": 1814
        },
        {
          "path": "opencode/skills/codex-review/references/experts/performance-expert.md",
          "type": "blob",
          "size": 2063
        },
        {
          "path": "opencode/skills/codex-review/references/experts/plan-reviewer-expert.md",
          "type": "blob",
          "size": 2438
        },
        {
          "path": "opencode/skills/codex-review/references/experts/priority-expert.md",
          "type": "blob",
          "size": 1582
        },
        {
          "path": "opencode/skills/codex-review/references/experts/quality-expert.md",
          "type": "blob",
          "size": 2079
        },
        {
          "path": "opencode/skills/codex-review/references/experts/scope-analyst-expert.md",
          "type": "blob",
          "size": 2761
        },
        {
          "path": "opencode/skills/codex-review/references/experts/scope-creep-expert.md",
          "type": "blob",
          "size": 1674
        },
        {
          "path": "opencode/skills/codex-review/references/experts/scope-feasibility-expert.md",
          "type": "blob",
          "size": 1598
        },
        {
          "path": "opencode/skills/codex-review/references/experts/security-expert.md",
          "type": "blob",
          "size": 2059
        },
        {
          "path": "opencode/skills/codex-review/references/experts/seo-expert.md",
          "type": "blob",
          "size": 2070
        },
        {
          "path": "opencode/skills/cursor-mem",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/cursor-mem/SKILL.md",
          "type": "blob",
          "size": 5890
        },
        {
          "path": "opencode/skills/cursor-mem/examples.md",
          "type": "blob",
          "size": 7970
        },
        {
          "path": "opencode/skills/deploy",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/deploy/SKILL.md",
          "type": "blob",
          "size": 903
        },
        {
          "path": "opencode/skills/deploy/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/deploy/references/analytics.md",
          "type": "blob",
          "size": 876
        },
        {
          "path": "opencode/skills/deploy/references/deployment-setup.md",
          "type": "blob",
          "size": 899
        },
        {
          "path": "opencode/skills/deploy/references/health-checking.md",
          "type": "blob",
          "size": 1282
        },
        {
          "path": "opencode/skills/dev-browser",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/dev-browser/SKILL.md",
          "type": "blob",
          "size": 5286
        },
        {
          "path": "opencode/skills/dev-browser/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/dev-browser/references/ai-snapshot-workflow.md",
          "type": "blob",
          "size": 6732
        },
        {
          "path": "opencode/skills/dev-browser/references/browser-automation.md",
          "type": "blob",
          "size": 6648
        },
        {
          "path": "opencode/skills/docs",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/docs/SKILL.md",
          "type": "blob",
          "size": 798
        },
        {
          "path": "opencode/skills/docs/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/docs/references/notebooklm-slides.md",
          "type": "blob",
          "size": 7575
        },
        {
          "path": "opencode/skills/docs/references/notebooklm-yaml.md",
          "type": "blob",
          "size": 1104
        },
        {
          "path": "opencode/skills/harness-review",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/harness-review/SKILL.md",
          "type": "blob",
          "size": 15745
        },
        {
          "path": "opencode/skills/harness-review/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/harness-review/references/accessibility-review.md",
          "type": "blob",
          "size": 3896
        },
        {
          "path": "opencode/skills/harness-review/references/changes-review.md",
          "type": "blob",
          "size": 4297
        },
        {
          "path": "opencode/skills/harness-review/references/codex-integration.md",
          "type": "blob",
          "size": 4592
        },
        {
          "path": "opencode/skills/harness-review/references/commit-judgment-logic.md",
          "type": "blob",
          "size": 5176
        },
        {
          "path": "opencode/skills/harness-review/references/determine-review-mode.md",
          "type": "blob",
          "size": 2636
        },
        {
          "path": "opencode/skills/harness-review/references/performance-review.md",
          "type": "blob",
          "size": 3473
        },
        {
          "path": "opencode/skills/harness-review/references/quality-review.md",
          "type": "blob",
          "size": 6092
        },
        {
          "path": "opencode/skills/harness-review/references/security-review.md",
          "type": "blob",
          "size": 8802
        },
        {
          "path": "opencode/skills/harness-review/references/seo-review.md",
          "type": "blob",
          "size": 7136
        },
        {
          "path": "opencode/skills/impl",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/impl/SKILL.md",
          "type": "blob",
          "size": 7658
        },
        {
          "path": "opencode/skills/impl/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/impl/references/implementing-features.md",
          "type": "blob",
          "size": 3606
        },
        {
          "path": "opencode/skills/impl/references/writing-tests.md",
          "type": "blob",
          "size": 5035
        },
        {
          "path": "opencode/skills/maintenance",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/maintenance/SKILL.md",
          "type": "blob",
          "size": 744
        },
        {
          "path": "opencode/skills/maintenance/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/maintenance/references/auto-cleanup.md",
          "type": "blob",
          "size": 7797
        },
        {
          "path": "opencode/skills/memory",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/memory/SKILL.md",
          "type": "blob",
          "size": 894
        },
        {
          "path": "opencode/skills/memory/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/memory/references/plans-merging.md",
          "type": "blob",
          "size": 6017
        },
        {
          "path": "opencode/skills/memory/references/ssot-initialization.md",
          "type": "blob",
          "size": 1266
        },
        {
          "path": "opencode/skills/memory/references/workflow-migration.md",
          "type": "blob",
          "size": 4680
        },
        {
          "path": "opencode/skills/parallel-workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/parallel-workflows/SKILL.md",
          "type": "blob",
          "size": 6687
        },
        {
          "path": "opencode/skills/parallel-workflows/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/parallel-workflows/references/build-dependency-graph.md",
          "type": "blob",
          "size": 7019
        },
        {
          "path": "opencode/skills/parallel-workflows/references/merge-worktrees.md",
          "type": "blob",
          "size": 6764
        },
        {
          "path": "opencode/skills/parallel-workflows/references/run-task-workers.md",
          "type": "blob",
          "size": 7637
        },
        {
          "path": "opencode/skills/parallel-workflows/references/setup-worktrees.md",
          "type": "blob",
          "size": 6226
        },
        {
          "path": "opencode/skills/plans-management",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/plans-management/SKILL.md",
          "type": "blob",
          "size": 5416
        },
        {
          "path": "opencode/skills/plans-management/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/plans-management/examples/task-lifecycle.md",
          "type": "blob",
          "size": 2255
        },
        {
          "path": "opencode/skills/plans-management/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/plans-management/references/init-requirements.md",
          "type": "blob",
          "size": 933
        },
        {
          "path": "opencode/skills/plans-management/references/markers.md",
          "type": "blob",
          "size": 2522
        },
        {
          "path": "opencode/skills/plans-management/references/parse-work-flags.md",
          "type": "blob",
          "size": 7399
        },
        {
          "path": "opencode/skills/plans-management/references/plan-feature.md",
          "type": "blob",
          "size": 893
        },
        {
          "path": "opencode/skills/plans-management/references/plan-review.md",
          "type": "blob",
          "size": 621
        },
        {
          "path": "opencode/skills/principles",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/principles/SKILL.md",
          "type": "blob",
          "size": 1011
        },
        {
          "path": "opencode/skills/principles/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/principles/references/diff-aware-editing.md",
          "type": "blob",
          "size": 3208
        },
        {
          "path": "opencode/skills/principles/references/general-principles.md",
          "type": "blob",
          "size": 2517
        },
        {
          "path": "opencode/skills/principles/references/repo-context-reading.md",
          "type": "blob",
          "size": 3012
        },
        {
          "path": "opencode/skills/principles/references/vibecoder-guide.md",
          "type": "blob",
          "size": 4045
        },
        {
          "path": "opencode/skills/session-control",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/session-control/SKILL.md",
          "type": "blob",
          "size": 643
        },
        {
          "path": "opencode/skills/session-control/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/session-control/references/session-control.md",
          "type": "blob",
          "size": 1018
        },
        {
          "path": "opencode/skills/session-init",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/session-init/SKILL.md",
          "type": "blob",
          "size": 4944
        },
        {
          "path": "opencode/skills/session-memory",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/session-memory/SKILL.md",
          "type": "blob",
          "size": 5639
        },
        {
          "path": "opencode/skills/session-state",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/session-state/SKILL.md",
          "type": "blob",
          "size": 944
        },
        {
          "path": "opencode/skills/session-state/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/session-state/references/state-transition.md",
          "type": "blob",
          "size": 2191
        },
        {
          "path": "opencode/skills/session",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/session/SKILL.md",
          "type": "blob",
          "size": 2551
        },
        {
          "path": "opencode/skills/session/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/session/references/session-control.md",
          "type": "blob",
          "size": 1018
        },
        {
          "path": "opencode/skills/session/references/state-transition.md",
          "type": "blob",
          "size": 2191
        },
        {
          "path": "opencode/skills/setup",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/setup/SKILL.md",
          "type": "blob",
          "size": 1290
        },
        {
          "path": "opencode/skills/setup/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/setup/references/adaptive-setup.md",
          "type": "blob",
          "size": 1941
        },
        {
          "path": "opencode/skills/setup/references/claude-settings.md",
          "type": "blob",
          "size": 10026
        },
        {
          "path": "opencode/skills/setup/references/project-scaffolding.md",
          "type": "blob",
          "size": 2233
        },
        {
          "path": "opencode/skills/setup/references/project-type-detection.md",
          "type": "blob",
          "size": 3271
        },
        {
          "path": "opencode/skills/setup/references/workflow-files.md",
          "type": "blob",
          "size": 2594
        },
        {
          "path": "opencode/skills/troubleshoot",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/troubleshoot/SKILL.md",
          "type": "blob",
          "size": 7515
        },
        {
          "path": "opencode/skills/ui",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/ui/SKILL.md",
          "type": "blob",
          "size": 3075
        },
        {
          "path": "opencode/skills/ui/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/ui/references/component-generation.md",
          "type": "blob",
          "size": 1006
        },
        {
          "path": "opencode/skills/ui/references/feedback-forms.md",
          "type": "blob",
          "size": 962
        },
        {
          "path": "opencode/skills/ui/references/frontend-design.md",
          "type": "blob",
          "size": 1262
        },
        {
          "path": "opencode/skills/ui/references/ui-skills.md",
          "type": "blob",
          "size": 2952
        },
        {
          "path": "opencode/skills/verify",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/verify/SKILL.md",
          "type": "blob",
          "size": 9486
        },
        {
          "path": "opencode/skills/verify/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/verify/references/applying-fixes.md",
          "type": "blob",
          "size": 4209
        },
        {
          "path": "opencode/skills/verify/references/build-verification.md",
          "type": "blob",
          "size": 2651
        },
        {
          "path": "opencode/skills/verify/references/error-recovery.md",
          "type": "blob",
          "size": 4357
        },
        {
          "path": "opencode/skills/verify/references/review-aggregation.md",
          "type": "blob",
          "size": 3562
        },
        {
          "path": "opencode/skills/verify/references/verify-related-files.md",
          "type": "blob",
          "size": 9339
        },
        {
          "path": "opencode/skills/vibecoder-guide",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/vibecoder-guide/SKILL.md",
          "type": "blob",
          "size": 4161
        },
        {
          "path": "opencode/skills/video",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/video/SKILL.md",
          "type": "blob",
          "size": 4194
        },
        {
          "path": "opencode/skills/video/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/video/references/analyzer.md",
          "type": "blob",
          "size": 5172
        },
        {
          "path": "opencode/skills/video/references/best-practices.md",
          "type": "blob",
          "size": 7442
        },
        {
          "path": "opencode/skills/video/references/generator.md",
          "type": "blob",
          "size": 8072
        },
        {
          "path": "opencode/skills/video/references/planner.md",
          "type": "blob",
          "size": 8294
        },
        {
          "path": "opencode/skills/workflow-guide",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/workflow-guide/SKILL.md",
          "type": "blob",
          "size": 6005
        },
        {
          "path": "opencode/skills/workflow-guide/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/workflow-guide/examples/typical-workflow.md",
          "type": "blob",
          "size": 3838
        },
        {
          "path": "opencode/skills/workflow-guide/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/workflow-guide/references/commands.md",
          "type": "blob",
          "size": 2246
        },
        {
          "path": "opencode/skills/workflow",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/workflow/SKILL.md",
          "type": "blob",
          "size": 1030
        },
        {
          "path": "opencode/skills/workflow/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "opencode/skills/workflow/references/auto-fixing.md",
          "type": "blob",
          "size": 928
        },
        {
          "path": "opencode/skills/workflow/references/execute-commit.md",
          "type": "blob",
          "size": 6540
        },
        {
          "path": "opencode/skills/workflow/references/handoff-to-impl.md",
          "type": "blob",
          "size": 1258
        },
        {
          "path": "opencode/skills/workflow/references/handoff-to-pm.md",
          "type": "blob",
          "size": 1265
        },
        {
          "path": "scripts",
          "type": "tree",
          "size": null
        },
        {
          "path": "scripts/hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "scripts/hooks/evaluate_subagent_output.sh",
          "type": "blob",
          "size": 1044
        },
        {
          "path": "scripts/sandbox-test",
          "type": "tree",
          "size": null
        },
        {
          "path": "scripts/sandbox-test/README.md",
          "type": "blob",
          "size": 1318
        },
        {
          "path": "skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/2agent",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/2agent/SKILL.md",
          "type": "blob",
          "size": 895
        },
        {
          "path": "skills/2agent/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/2agent/references/2agent-setup.md",
          "type": "blob",
          "size": 8647
        },
        {
          "path": "skills/2agent/references/2agent-updating.md",
          "type": "blob",
          "size": 9964
        },
        {
          "path": "skills/2agent/references/cursor-setup.md",
          "type": "blob",
          "size": 1171
        },
        {
          "path": "skills/auth",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/auth/SKILL.md",
          "type": "blob",
          "size": 2704
        },
        {
          "path": "skills/auth/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/auth/references/authentication.md",
          "type": "blob",
          "size": 996
        },
        {
          "path": "skills/auth/references/payments.md",
          "type": "blob",
          "size": 875
        },
        {
          "path": "skills/ci",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/ci/SKILL.md",
          "type": "blob",
          "size": 4481
        },
        {
          "path": "skills/ci/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/ci/references/analyzing-failures.md",
          "type": "blob",
          "size": 4100
        },
        {
          "path": "skills/ci/references/fixing-tests.md",
          "type": "blob",
          "size": 4563
        },
        {
          "path": "skills/codex-review",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/codex-review/SKILL.md",
          "type": "blob",
          "size": 6654
        },
        {
          "path": "skills/codex-review/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/codex-review/references/codex-mcp-setup.md",
          "type": "blob",
          "size": 5270
        },
        {
          "path": "skills/codex-review/references/codex-parallel-review.md",
          "type": "blob",
          "size": 12235
        },
        {
          "path": "skills/codex-review/references/codex-review-integration.md",
          "type": "blob",
          "size": 4418
        },
        {
          "path": "skills/codex-review/references/experts",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/codex-review/references/experts/acceptance-expert.md",
          "type": "blob",
          "size": 1638
        },
        {
          "path": "skills/codex-review/references/experts/accessibility-expert.md",
          "type": "blob",
          "size": 1922
        },
        {
          "path": "skills/codex-review/references/experts/architect-expert.md",
          "type": "blob",
          "size": 2181
        },
        {
          "path": "skills/codex-review/references/experts/clarity-expert.md",
          "type": "blob",
          "size": 1229
        },
        {
          "path": "skills/codex-review/references/experts/dependencies-expert.md",
          "type": "blob",
          "size": 1530
        },
        {
          "path": "skills/codex-review/references/experts/feasibility-expert.md",
          "type": "blob",
          "size": 1393
        },
        {
          "path": "skills/codex-review/references/experts/impact-expert.md",
          "type": "blob",
          "size": 1814
        },
        {
          "path": "skills/codex-review/references/experts/performance-expert.md",
          "type": "blob",
          "size": 2063
        },
        {
          "path": "skills/codex-review/references/experts/plan-reviewer-expert.md",
          "type": "blob",
          "size": 2438
        },
        {
          "path": "skills/codex-review/references/experts/priority-expert.md",
          "type": "blob",
          "size": 1582
        },
        {
          "path": "skills/codex-review/references/experts/quality-expert.md",
          "type": "blob",
          "size": 2079
        },
        {
          "path": "skills/codex-review/references/experts/scope-analyst-expert.md",
          "type": "blob",
          "size": 2761
        },
        {
          "path": "skills/codex-review/references/experts/scope-creep-expert.md",
          "type": "blob",
          "size": 1674
        },
        {
          "path": "skills/codex-review/references/experts/scope-feasibility-expert.md",
          "type": "blob",
          "size": 1598
        },
        {
          "path": "skills/codex-review/references/experts/security-expert.md",
          "type": "blob",
          "size": 2059
        },
        {
          "path": "skills/codex-review/references/experts/seo-expert.md",
          "type": "blob",
          "size": 2070
        },
        {
          "path": "skills/cursor-mem",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/cursor-mem/SKILL.md",
          "type": "blob",
          "size": 5890
        },
        {
          "path": "skills/cursor-mem/examples.md",
          "type": "blob",
          "size": 7970
        },
        {
          "path": "skills/deploy",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/deploy/SKILL.md",
          "type": "blob",
          "size": 903
        },
        {
          "path": "skills/deploy/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/deploy/references/analytics.md",
          "type": "blob",
          "size": 876
        },
        {
          "path": "skills/deploy/references/deployment-setup.md",
          "type": "blob",
          "size": 899
        },
        {
          "path": "skills/deploy/references/health-checking.md",
          "type": "blob",
          "size": 1282
        },
        {
          "path": "skills/dev-browser",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/dev-browser/SKILL.md",
          "type": "blob",
          "size": 5286
        },
        {
          "path": "skills/dev-browser/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/dev-browser/references/ai-snapshot-workflow.md",
          "type": "blob",
          "size": 6732
        },
        {
          "path": "skills/dev-browser/references/browser-automation.md",
          "type": "blob",
          "size": 6648
        },
        {
          "path": "skills/docs",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/docs/SKILL.md",
          "type": "blob",
          "size": 798
        },
        {
          "path": "skills/docs/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/docs/references/notebooklm-slides.md",
          "type": "blob",
          "size": 7575
        },
        {
          "path": "skills/docs/references/notebooklm-yaml.md",
          "type": "blob",
          "size": 1104
        },
        {
          "path": "skills/harness-review",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/harness-review/SKILL.md",
          "type": "blob",
          "size": 15745
        },
        {
          "path": "skills/harness-review/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/harness-review/references/accessibility-review.md",
          "type": "blob",
          "size": 3896
        },
        {
          "path": "skills/harness-review/references/changes-review.md",
          "type": "blob",
          "size": 4297
        },
        {
          "path": "skills/harness-review/references/codex-integration.md",
          "type": "blob",
          "size": 4592
        },
        {
          "path": "skills/harness-review/references/commit-judgment-logic.md",
          "type": "blob",
          "size": 5176
        },
        {
          "path": "skills/harness-review/references/determine-review-mode.md",
          "type": "blob",
          "size": 2636
        },
        {
          "path": "skills/harness-review/references/performance-review.md",
          "type": "blob",
          "size": 3473
        },
        {
          "path": "skills/harness-review/references/quality-review.md",
          "type": "blob",
          "size": 6092
        },
        {
          "path": "skills/harness-review/references/security-review.md",
          "type": "blob",
          "size": 8802
        },
        {
          "path": "skills/harness-review/references/seo-review.md",
          "type": "blob",
          "size": 7136
        },
        {
          "path": "skills/impl",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/impl/SKILL.md",
          "type": "blob",
          "size": 7658
        },
        {
          "path": "skills/impl/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/impl/references/implementing-features.md",
          "type": "blob",
          "size": 3606
        },
        {
          "path": "skills/impl/references/writing-tests.md",
          "type": "blob",
          "size": 5035
        },
        {
          "path": "skills/maintenance",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/maintenance/SKILL.md",
          "type": "blob",
          "size": 744
        },
        {
          "path": "skills/maintenance/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/maintenance/references/auto-cleanup.md",
          "type": "blob",
          "size": 7797
        },
        {
          "path": "skills/memory",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/memory/SKILL.md",
          "type": "blob",
          "size": 894
        },
        {
          "path": "skills/memory/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/memory/references/plans-merging.md",
          "type": "blob",
          "size": 6017
        },
        {
          "path": "skills/memory/references/ssot-initialization.md",
          "type": "blob",
          "size": 1266
        },
        {
          "path": "skills/memory/references/workflow-migration.md",
          "type": "blob",
          "size": 4680
        },
        {
          "path": "skills/parallel-workflows",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/parallel-workflows/SKILL.md",
          "type": "blob",
          "size": 6687
        },
        {
          "path": "skills/parallel-workflows/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/parallel-workflows/references/build-dependency-graph.md",
          "type": "blob",
          "size": 7019
        },
        {
          "path": "skills/parallel-workflows/references/merge-worktrees.md",
          "type": "blob",
          "size": 6764
        },
        {
          "path": "skills/parallel-workflows/references/run-task-workers.md",
          "type": "blob",
          "size": 7637
        },
        {
          "path": "skills/parallel-workflows/references/setup-worktrees.md",
          "type": "blob",
          "size": 6226
        },
        {
          "path": "skills/plans-management",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/plans-management/SKILL.md",
          "type": "blob",
          "size": 5416
        },
        {
          "path": "skills/plans-management/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/plans-management/examples/task-lifecycle.md",
          "type": "blob",
          "size": 2255
        },
        {
          "path": "skills/plans-management/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/plans-management/references/init-requirements.md",
          "type": "blob",
          "size": 933
        },
        {
          "path": "skills/plans-management/references/markers.md",
          "type": "blob",
          "size": 2522
        },
        {
          "path": "skills/plans-management/references/parse-work-flags.md",
          "type": "blob",
          "size": 7399
        },
        {
          "path": "skills/plans-management/references/plan-feature.md",
          "type": "blob",
          "size": 893
        },
        {
          "path": "skills/plans-management/references/plan-review.md",
          "type": "blob",
          "size": 621
        },
        {
          "path": "skills/principles",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/principles/SKILL.md",
          "type": "blob",
          "size": 1011
        },
        {
          "path": "skills/principles/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/principles/references/diff-aware-editing.md",
          "type": "blob",
          "size": 3208
        },
        {
          "path": "skills/principles/references/general-principles.md",
          "type": "blob",
          "size": 2517
        },
        {
          "path": "skills/principles/references/repo-context-reading.md",
          "type": "blob",
          "size": 3012
        },
        {
          "path": "skills/principles/references/vibecoder-guide.md",
          "type": "blob",
          "size": 4045
        },
        {
          "path": "skills/session-control",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/session-control/SKILL.md",
          "type": "blob",
          "size": 643
        },
        {
          "path": "skills/session-control/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/session-control/references/session-control.md",
          "type": "blob",
          "size": 1018
        },
        {
          "path": "skills/session-init",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/session-init/SKILL.md",
          "type": "blob",
          "size": 4944
        },
        {
          "path": "skills/session-memory",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/session-memory/SKILL.md",
          "type": "blob",
          "size": 5639
        },
        {
          "path": "skills/session-state",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/session-state/SKILL.md",
          "type": "blob",
          "size": 944
        },
        {
          "path": "skills/session-state/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/session-state/references/state-transition.md",
          "type": "blob",
          "size": 2191
        },
        {
          "path": "skills/session",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/session/SKILL.md",
          "type": "blob",
          "size": 2551
        },
        {
          "path": "skills/session/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/session/references/session-control.md",
          "type": "blob",
          "size": 1018
        },
        {
          "path": "skills/session/references/state-transition.md",
          "type": "blob",
          "size": 2191
        },
        {
          "path": "skills/setup",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/setup/SKILL.md",
          "type": "blob",
          "size": 1290
        },
        {
          "path": "skills/setup/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/setup/references/adaptive-setup.md",
          "type": "blob",
          "size": 1941
        },
        {
          "path": "skills/setup/references/claude-settings.md",
          "type": "blob",
          "size": 10026
        },
        {
          "path": "skills/setup/references/project-scaffolding.md",
          "type": "blob",
          "size": 2233
        },
        {
          "path": "skills/setup/references/project-type-detection.md",
          "type": "blob",
          "size": 3271
        },
        {
          "path": "skills/setup/references/workflow-files.md",
          "type": "blob",
          "size": 2594
        },
        {
          "path": "skills/troubleshoot",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/troubleshoot/SKILL.md",
          "type": "blob",
          "size": 7515
        },
        {
          "path": "skills/ui",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/ui/SKILL.md",
          "type": "blob",
          "size": 3075
        },
        {
          "path": "skills/ui/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/ui/references/component-generation.md",
          "type": "blob",
          "size": 1006
        },
        {
          "path": "skills/ui/references/feedback-forms.md",
          "type": "blob",
          "size": 962
        },
        {
          "path": "skills/ui/references/frontend-design.md",
          "type": "blob",
          "size": 1262
        },
        {
          "path": "skills/ui/references/ui-skills.md",
          "type": "blob",
          "size": 2952
        },
        {
          "path": "skills/verify",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/verify/SKILL.md",
          "type": "blob",
          "size": 9486
        },
        {
          "path": "skills/verify/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/verify/references/applying-fixes.md",
          "type": "blob",
          "size": 4209
        },
        {
          "path": "skills/verify/references/build-verification.md",
          "type": "blob",
          "size": 2651
        },
        {
          "path": "skills/verify/references/error-recovery.md",
          "type": "blob",
          "size": 4357
        },
        {
          "path": "skills/verify/references/review-aggregation.md",
          "type": "blob",
          "size": 3562
        },
        {
          "path": "skills/verify/references/verify-related-files.md",
          "type": "blob",
          "size": 9339
        },
        {
          "path": "skills/vibecoder-guide",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/vibecoder-guide/SKILL.md",
          "type": "blob",
          "size": 4161
        },
        {
          "path": "skills/video",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/video/SKILL.md",
          "type": "blob",
          "size": 4194
        },
        {
          "path": "skills/video/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/video/references/analyzer.md",
          "type": "blob",
          "size": 5172
        },
        {
          "path": "skills/video/references/best-practices.md",
          "type": "blob",
          "size": 7442
        },
        {
          "path": "skills/video/references/generator.md",
          "type": "blob",
          "size": 8072
        },
        {
          "path": "skills/video/references/planner.md",
          "type": "blob",
          "size": 8294
        },
        {
          "path": "skills/workflow-guide",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/workflow-guide/SKILL.md",
          "type": "blob",
          "size": 6005
        },
        {
          "path": "skills/workflow-guide/examples",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/workflow-guide/examples/typical-workflow.md",
          "type": "blob",
          "size": 4493
        },
        {
          "path": "skills/workflow-guide/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/workflow-guide/references/commands.md",
          "type": "blob",
          "size": 2246
        },
        {
          "path": "skills/workflow",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/workflow/SKILL.md",
          "type": "blob",
          "size": 1030
        },
        {
          "path": "skills/workflow/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/workflow/references/auto-fixing.md",
          "type": "blob",
          "size": 928
        },
        {
          "path": "skills/workflow/references/execute-commit.md",
          "type": "blob",
          "size": 6540
        },
        {
          "path": "skills/workflow/references/handoff-to-impl.md",
          "type": "blob",
          "size": 1258
        },
        {
          "path": "skills/workflow/references/handoff-to-pm.md",
          "type": "blob",
          "size": 1265
        },
        {
          "path": "templates",
          "type": "tree",
          "size": null
        },
        {
          "path": "templates/cursor",
          "type": "tree",
          "size": null
        },
        {
          "path": "templates/cursor/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "templates/cursor/commands/handoff-to-claude.md",
          "type": "blob",
          "size": 1498
        },
        {
          "path": "templates/cursor/commands/plan-with-cc.md",
          "type": "blob",
          "size": 5253
        },
        {
          "path": "templates/cursor/commands/project-overview.md",
          "type": "blob",
          "size": 588
        },
        {
          "path": "templates/cursor/commands/review-cc-work.md",
          "type": "blob",
          "size": 5227
        },
        {
          "path": "templates/cursor/commands/start-session.md",
          "type": "blob",
          "size": 813
        },
        {
          "path": "templates/hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "templates/hooks/auto-cleanup-hook.sh",
          "type": "blob",
          "size": 2750
        },
        {
          "path": "templates/opencode",
          "type": "tree",
          "size": null
        },
        {
          "path": "templates/opencode/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "templates/opencode/commands/handoff-to-claude.md",
          "type": "blob",
          "size": 1500
        },
        {
          "path": "templates/opencode/commands/plan-with-cc.md",
          "type": "blob",
          "size": 5229
        },
        {
          "path": "templates/opencode/commands/project-overview.md",
          "type": "blob",
          "size": 573
        },
        {
          "path": "templates/opencode/commands/review-cc-work.md",
          "type": "blob",
          "size": 5237
        },
        {
          "path": "templates/opencode/commands/start-session.md",
          "type": "blob",
          "size": 800
        },
        {
          "path": "tests",
          "type": "tree",
          "size": null
        },
        {
          "path": "tests/README.md",
          "type": "blob",
          "size": 2942
        }
      ],
      "files": {
        ".claude-plugin/hooks.json": "{\n  \"description\": \"claude-code-harness: 自動化フック\",\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Write|Edit|Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" pretooluse-guard\",\n            \"timeout\": 30\n          }\n        ]\n      },\n      {\n        \"matcher\": \"mcp__chrome-devtools__.*|mcp__playwright__.*|mcp__plugin_playwright_playwright__.*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" pretooluse-browser-guide\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"PermissionRequest\": [\n      {\n        \"matcher\": \"Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" permission-request\",\n            \"timeout\": 30\n          }\n        ]\n      }\n    ],\n    \"Setup\": [\n      {\n        \"matcher\": \"init\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" setup-hook init\",\n            \"timeout\": 60,\n            \"once\": true\n          }\n        ]\n      },\n      {\n        \"matcher\": \"init-only\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" setup-hook init\",\n            \"timeout\": 60,\n            \"once\": true\n          }\n        ]\n      },\n      {\n        \"matcher\": \"maintenance\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" setup-hook maintenance\",\n            \"timeout\": 60,\n            \"once\": true\n          }\n        ]\n      }\n    ],\n    \"SessionStart\": [\n      {\n        \"matcher\": \"startup\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-init\",\n            \"timeout\": 30,\n            \"once\": true\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-monitor\",\n            \"timeout\": 30,\n            \"once\": true\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" harness-ui-register\",\n            \"timeout\": 10,\n            \"once\": true\n          }\n        ]\n      },\n      {\n        \"matcher\": \"resume\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-resume\",\n            \"timeout\": 30,\n            \"once\": true\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-monitor\",\n            \"timeout\": 30,\n            \"once\": true\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" harness-ui-register\",\n            \"timeout\": 10,\n            \"once\": true\n          }\n        ]\n      }\n    ],\n    \"SubagentStart\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" subagent-tracker start\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"SubagentStop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" subagent-tracker stop\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"UserPromptSubmit\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" userprompt-inject-policy\",\n            \"timeout\": 30\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" userprompt-track-command\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" posttooluse-log-toolname\",\n            \"timeout\": 30\n          }\n        ]\n      },\n      {\n        \"matcher\": \"Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" posttooluse-commit-cleanup\",\n            \"timeout\": 10\n          }\n        ]\n      },\n      {\n        \"matcher\": \"Skill|Task|SlashCommand\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" usage-tracker\",\n            \"timeout\": 30\n          }\n        ]\n      },\n      {\n        \"matcher\": \"Skill\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" posttooluse-clear-pending\",\n            \"timeout\": 5\n          }\n        ]\n      },\n      {\n        \"matcher\": \"TodoWrite\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" todo-sync\",\n            \"timeout\": 30\n          }\n        ]\n      },\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" auto-cleanup-hook\",\n            \"timeout\": 60\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" track-changes\",\n            \"timeout\": 30\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" auto-test-runner\",\n            \"timeout\": 120\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" posttooluse-quality-pack\",\n            \"timeout\": 60\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" plans-watcher\",\n            \"timeout\": 30\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" tdd-order-check\",\n            \"timeout\": 30\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" posttooluse-tampering-detector\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-summary\",\n            \"timeout\": 60\n          },\n          {\n            \"type\": \"prompt\",\n            \"prompt\": \"セッション終了の評価を行ってください。\\n\\n確認事項:\\n1. ユーザーの依頼は完了しましたか？\\n2. 未解決のエラーや問題がありますか？\\n3. フォローアップや追加作業が必要ですか？\\n\\n【重要】必ず以下のJSON形式のみで回答:\\n- 終了OK: {\\\"ok\\\": true}\\n- 継続必要: {\\\"ok\\\": false, \\\"reason\\\": \\\"理由を日本語で記載\\\"}\",\n            \"timeout\": 30\n          }\n        ]\n      }\n    ]\n  }\n}\n",
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"claude-code-harness-marketplace\",\n  \"metadata\": {\n    \"description\": \"claude-code-harness の配布/導入を支援する（単一プラグイン）マーケットプレース\"\n  },\n  \"owner\": {\n    \"name\": \"Chachamaru\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"claude-code-harness\",\n      \"source\": \"./\",\n      \"description\": \"A harness for solo developers (Vibecoders) to handle full-cycle contract development.\",\n      \"author\": {\n        \"name\": \"Chachamaru\",\n        \"url\": \"https://github.com/Chachamaru127\"\n      },\n      \"homepage\": \"https://github.com/Chachamaru127/claude-code-harness\",\n      \"repository\": \"https://github.com/Chachamaru127/claude-code-harness\",\n      \"license\": \"Proprietary\",\n      \"keywords\": [\n        \"claude-code\",\n        \"plugin\",\n        \"vibecoder\",\n        \"workflow\",\n        \"plan-work-review\"\n      ],\n      \"category\": \"productivity\",\n      \"strict\": true\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"claude-code-harness\",\n  \"version\": \"2.14.9\",\n  \"description\": \"Claude harness - A harness for solo developers (Vibecoders) to handle full-cycle contract development.\",\n  \"author\": {\n    \"name\": \"Chachamaru\",\n    \"url\": \"https://github.com/Chachamaru127\"\n  },\n  \"homepage\": \"https://github.com/Chachamaru127/claude-code-harness\",\n  \"repository\": \"https://github.com/Chachamaru127/claude-code-harness\",\n  \"license\": \"MIT\",\n  \"keywords\": [\n    \"claude-code\",\n    \"plugin\",\n    \"vibecoder\",\n    \"workflow\",\n    \"plan-work-review\"\n  ]\n}\n",
        "README.md": "<p align=\"center\">\n  <img src=\"docs/images/claude-harness-logo-with-text.png\" alt=\"Claude Harness\" width=\"400\">\n</p>\n\n<p align=\"center\">\n  <strong>Turn Claude Code into a self-correcting development team.</strong>\n</p>\n\n<p align=\"center\">\n  <a href=\"VERSION\"><img src=\"https://img.shields.io/badge/version-2.14.8-blue.svg\" alt=\"Version\"></a>\n  <a href=\"LICENSE.md\"><img src=\"https://img.shields.io/badge/License-MIT-green.svg\" alt=\"License\"></a>\n  <a href=\"docs/CLAUDE_CODE_COMPATIBILITY.md\"><img src=\"https://img.shields.io/badge/Claude_Code-v2.1.21+-purple.svg\" alt=\"Claude Code\"></a>\n</p>\n\n<p align=\"center\">\n  English | <a href=\"README_ja.md\">日本語</a>\n</p>\n\n---\n\n## The Problem\n\n**Claude is brilliant. But it forgets. It wanders. It breaks things.**\n\n| Issue | What Happens |\n|-------|--------------|\n| **Forgets** | Past decisions vanish between sessions |\n| **Wanders** | Starts coding without a plan, loses direction |\n| **Breaks** | Skips tests, bypasses lint, ships bugs |\n| **Rushes** | Takes shortcuts when stuck—test tampering, empty catch blocks |\n\nSound familiar?\n\n---\n\n## The Solution\n\n**Claude Harness wraps Claude Code in guardrails that enforce discipline.**\n\n```\nPlan  →  Work  →  Review  →  Commit\n```\n\nThree commands. That's it.\n\n```bash\n/plan-with-agent   # Brainstorm → Structured plan\n/work              # Execute with parallel workers + self-review\n/harness-review    # 8-expert code review\n```\n\n**Result:** Production-ready code, not prototypes.\n\n---\n\n## Quick Start\n\n### 10-Second Install\n\n```bash\n# In any project directory\nclaude\n\n# Then run:\n/plugin marketplace add Chachamaru127/claude-code-harness\n/plugin install claude-code-harness@claude-code-harness-marketplace\n/harness-init\n```\n\n**Done.** Start with `/plan-with-agent`.\n\n<details>\n<summary>Alternative: One-liner script</summary>\n\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Chachamaru127/claude-code-harness/main/scripts/quick-install.sh | bash\n```\n\nWith dev tools (AST-Grep + LSP):\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Chachamaru127/claude-code-harness/main/scripts/quick-install.sh | bash -s -- --with-dev-tools\n```\n\n</details>\n\n<details>\n<summary>Alternative: Local clone</summary>\n\n```bash\ngit clone https://github.com/Chachamaru127/claude-code-harness.git ~/claude-plugins/claude-code-harness\ncd /path/to/your-project\nclaude --plugin-dir ~/claude-plugins/claude-code-harness\n```\n\n</details>\n\n---\n\n## Before → After\n\n| Before (Raw Claude Code) | After (With Harness) |\n|--------------------------|----------------------|\n| Starts coding immediately | Plans first, then executes |\n| Reviews only if you ask | Auto-reviews every change |\n| Forgets past decisions | SSOT files preserve context |\n| `rm -rf` runs without warning | Dangerous commands blocked |\n| Manual `git commit` after work | Auto-commits when review passes |\n| One task at a time | Parallel workers for speed |\n\n---\n\n## Key Features\n\n### 🎯 Plan → Work → Review Cycle\n\nEvery idea goes through the same loop:\n\n1. **Plan** — `/plan-with-agent` turns vague ideas into `Plans.md`\n2. **Work** — `/work` executes tasks with parallel workers\n3. **Review** — `/harness-review` runs 8 expert reviewers\n\n### 🛡️ Safety Hooks\n\n| Protected | Action |\n|-----------|--------|\n| `.git/`, `.env`, secrets | Write blocked |\n| `rm -rf`, `sudo`, `git push --force` | Confirmation required |\n| `git status`, `npm test` | Auto-allowed |\n\n### 🧠 Persistent Memory\n\n- **SSOT files**: `decisions.md` (why) + `patterns.md` (how)\n- **Claude-mem integration**: Past learnings survive across sessions\n- **Session resume**: Pick up exactly where you left off\n\n### ⚡ Parallel Execution\n\n```bash\n/work --parallel 5   # 5 workers in parallel\n```\n\nEach worker implements, reviews its own code, and commits independently.\n\n### 🔍 8-Expert Code Review\n\n```bash\n/harness-review\n```\n\nSecurity, performance, accessibility, maintainability—8 specialists review simultaneously. Add [Codex](https://github.com/openai/codex) for a second opinion.\n\n### 🔧 Code Intelligence\n\n```bash\n/dev-tools-setup   # One-time setup\n```\n\nAST-Grep + LSP for structural search and semantic analysis.\n\n---\n\n## Who Is This For?\n\n| You | Benefit |\n|-----|---------|\n| **Solo developers** | Ship faster without sacrificing quality |\n| **Freelancers** | Deliver review reports as proof of quality |\n| **VibeCoder** | Build apps with natural language |\n| **Cursor users** | 2-Agent workflow: Cursor plans, Claude Code implements |\n\n---\n\n## Commands\n\n### Core Workflow\n\n| Command | Purpose |\n|---------|---------|\n| `/plan-with-agent` | Turn ideas into actionable plans |\n| `/work` | Execute tasks from Plans.md |\n| `/harness-review` | Multi-expert code review |\n| `/sync-status` | Check progress, suggest next action |\n\n### Setup & Ops\n\n| Command | Purpose |\n|---------|---------|\n| `/harness-init` | Initialize project |\n| `/harness-update` | Update plugin |\n| `/dev-tools-setup` | Setup AST-Grep + LSP |\n| `/skill-list` | Show all 67 skills |\n\n### 2-Agent (Cursor)\n\n| Command | Purpose |\n|---------|---------|\n| `/handoff-to-cursor` | Report completion to PM |\n\n---\n\n## Skills\n\nSkills auto-trigger based on your request:\n\n| Skill | Triggers |\n|-------|----------|\n| `impl` | \"implement\", \"add feature\", \"build\" |\n| `review` | \"review\", \"check security\", \"audit\" |\n| `verify` | \"build\", \"fix errors\", \"recover\" |\n| `auth` | \"login\", \"Stripe\", \"payment\" |\n| `deploy` | \"deploy\", \"Vercel\", \"production\" |\n| `ui` | \"hero section\", \"component\", \"form\" |\n\n**67 skills across 22 categories.** Run `/skill-list` to see all.\n\n---\n\n## Architecture\n\n```\nclaude-code-harness/\n├── commands/     # 31 slash commands\n├── skills/       # 67 skills (22 categories)\n├── agents/       # 8 sub-agents (parallel workers)\n├── hooks/        # Safety & automation\n├── scripts/      # Guard scripts\n└── templates/    # Generation templates\n```\n\n---\n\n## Documentation\n\n| Guide | Description |\n|-------|-------------|\n| [Changelog](CHANGELOG.md) | What's new in each version |\n| [Claude Code Compatibility](docs/CLAUDE_CODE_COMPATIBILITY.md) | Version requirements |\n| [Cursor Integration](docs/CURSOR_INTEGRATION.md) | 2-Agent workflow setup |\n| [OpenCode Compatibility](docs/OPENCODE_COMPATIBILITY.md) | Use with other LLMs |\n\n---\n\n## Requirements\n\n- **Claude Code v2.1.21+** (recommended)\n- See [compatibility guide](docs/CLAUDE_CODE_COMPATIBILITY.md) for details\n\n---\n\n## Acknowledgments\n\n- **Hierarchical Skill Structure**: [AI Masao](https://note.com/masa_wunder)\n- **Test Tampering Prevention**: [Beagle](https://github.com/beagleworks) (Claude Code Meetup Tokyo 2025.12.22)\n\n---\n\n## License\n\n**MIT License** — Free to use, modify, and commercialize.\n\n[English](LICENSE.md) | [日本語](LICENSE.ja.md)\n",
        "agents/ci-cd-fixer.md": "---\nname: ci-cd-fixer\ndescription: CI失敗時の診断・修正を安全第一で支援\ntools: [Read, Write, Bash, Grep, Glob]\ndisallowedTools: [Task]\nmodel: sonnet\ncolor: orange\nskills:\n  - verify\n  - ci\nhooks:\n  PreToolUse:\n    - matcher: \"Bash\"\n      command: \"echo '[CI-Fixer] Checking command safety...'\"\n---\n\n# CI/CD Fixer Agent\n\nCI失敗時の診断・修正を行うエージェント。**安全性を最優先**とし、設定に基づいて動作します。\n\n---\n\n## 重要: セーフティファースト\n\nこのエージェントは破壊的な操作を含むため、以下のルールに従います：\n\n1. **デフォルトは dry-run モード**: 何をするかを表示するだけで実行しない\n2. **環境チェック必須**: 必要なツールがなければ即時停止\n3. **git push はデフォルト禁止**: 明示的に許可されていない限り実行しない\n4. **3回ルール**: 3回失敗したら必ずエスカレーション\n\n---\n\n## 設定の読み込み\n\n実行前に `claude-code-harness.config.json` を確認：\n\n```json\n{\n  \"safety\": {\n    \"mode\": \"dry-run | apply-local | apply-and-push\"\n  },\n  \"ci\": {\n    \"enable_auto_fix\": false,\n    \"require_gh_cli\": true\n  },\n  \"git\": {\n    \"allow_auto_commit\": false,\n    \"allow_auto_push\": false,\n    \"protected_branches\": [\"main\", \"master\"]\n  }\n}\n```\n\n**設定がない場合は最も安全なデフォルトを使用**:\n- mode: \"dry-run\"\n- enable_auto_fix: false\n- allow_auto_push: false\n\n---\n\n## 処理フロー\n\n### Phase 0: 環境チェック（必須・最初に実行）\n\n```bash\n# 必須ツールの存在確認\ncommand -v git >/dev/null 2>&1 || { echo \"❌ git が見つかりません\"; exit 1; }\ncommand -v npm >/dev/null 2>&1 || { echo \"❌ npm が見つかりません\"; exit 1; }\n```\n\n**gh CLI チェック（GitHub Actions使用時）**:\n```bash\nif ! command -v gh >/dev/null 2>&1; then\n  echo \"⚠️ gh CLI が見つかりません\"\n  echo \"GitHub Actions の操作には gh CLI が必要です\"\n  echo \"インストール: https://cli.github.com/\"\n  echo \"\"\n  echo \"🛑 CI自動修正を中止します。手動で対応してください。\"\n  exit 1\nfi\n```\n\n**CI プロバイダー検出**:\n```bash\n# 自動検出\nif [ -f .github/workflows/*.yml ]; then\n  CI_PROVIDER=\"github_actions\"\nelif [ -f .gitlab-ci.yml ]; then\n  CI_PROVIDER=\"gitlab_ci\"\nelif [ -f .circleci/config.yml ]; then\n  CI_PROVIDER=\"circleci\"\nelse\n  echo \"⚠️ CI設定ファイルが見つかりません\"\n  echo \"🛑 CI自動修正はスキップします\"\n  exit 0\nfi\n```\n\n**環境が合わない場合は即時停止（何もしない）**\n\n---\n\n### Phase 1: 設定確認と動作モード決定\n\n```\n設定ファイルを読み込み:\n  - claude-code-harness.config.json が存在する → 設定を適用\n  - 存在しない → 最も安全なデフォルトを使用\n\n動作モード:\n  - dry-run: 診断結果と修正案を表示するのみ（デフォルト）\n  - apply-local: ローカルで修正を適用するが push しない\n  - apply-and-push: 修正を適用して push（要: 明示的許可）\n```\n\n---\n\n### Phase 2: CI状態の確認\n\n**GitHub Actions の場合のみ（gh CLI 必須）**:\n```bash\n# 最新のCI実行を取得\ngh run list --limit 5\n\n# 失敗している場合は詳細を取得\ngh run view {{run_id}} --log-failed\n```\n\n**その他のCIプロバイダー**:\n```\n⚠️ GitHub Actions 以外の CI には未対応です\n手動で CI ログを確認し、エラー内容を教えてください\n```\n\n---\n\n### Phase 3: エラー分類と修正案の生成\n\nエラーログを分析し、以下のカテゴリに分類：\n\n| カテゴリ | パターン | 自動修正 | リスク |\n|---------|---------|---------|-------|\n| **TypeScript エラー** | `TS\\d{4}:`, `error TS` | ✅ 可能 | 低 |\n| **ESLint エラー** | `eslint`, `Parsing error` | ✅ 可能 | 低 |\n| **テスト失敗** | `FAIL`, `AssertionError` | ⚠️ 要確認 | 中 |\n| **ビルドエラー** | `Build failed`, `Module not found` | ✅ 可能 | 低 |\n| **依存関係エラー** | `npm ERR!`, `Could not resolve` | ⚠️ 要確認 | 中 |\n| **環境エラー** | `env`, `secret`, `permission` | ❌ 不可 | 高 |\n\n---\n\n### Phase 4: 事前サマリの表示（必須）\n\n**修正を実行する前に、必ず以下を表示**:\n\n```markdown\n## 📋 CI修正プラン\n\n**動作モード**: {{mode}}\n**CI プロバイダー**: {{provider}}\n**検出されたエラー**: {{error_count}}件\n\n### 実行予定のアクション\n\n| # | アクション | 対象 | リスク |\n|---|-----------|------|-------|\n| 1 | ESLint 自動修正 | src/**/*.ts | 低 |\n| 2 | TypeScript エラー修正 | src/components/Button.tsx:45 | 低 |\n| 3 | 依存関係の再インストール | node_modules/ | 中 |\n\n### 変更予定のファイル\n\n- `src/components/Button.tsx` (型エラー修正)\n- `src/utils/helper.ts` (ESLint修正)\n\n### ⚠️ 注意が必要な操作\n\n- `rm -rf node_modules` を実行します（設定: allow_rm_rf = {{value}}）\n- `git commit` を実行します（設定: allow_auto_commit = {{value}}）\n- `git push` を実行します（設定: allow_auto_push = {{value}}）\n\n---\n\n**このプランを実行しますか？** (dry-run モードでは実行されません)\n```\n\n---\n\n### Phase 5: 修正の実行（設定に基づく）\n\n#### dry-run モード（デフォルト）\n```\n📝 dry-run モードのため、実際の変更は行いません\n上記のプランを実行するには、claude-code-harness.config.json で mode を変更してください\n```\n\n#### apply-local モード\n```bash\n# ESLint 自動修正（比較的安全）\nnpx eslint --fix src/\n\n# TypeScript エラーは Edit ツールで修正\n# （コードを直接変更）\n\n# 依存関係エラーの場合（要確認）\nif [ \"$ALLOW_RM_RF\" = \"true\" ]; then\n  echo \"⚠️ node_modules を削除して再インストールします\"\n  rm -rf node_modules package-lock.json\n  npm install\nelse\n  echo \"⚠️ allow_rm_rf が false のため、手動で対応してください:\"\n  echo \"  rm -rf node_modules package-lock.json && npm install\"\nfi\n```\n\n#### apply-and-push モード（要: 明示的許可）\n```bash\n# 以下の条件をすべて満たす場合のみ実行:\n# 1. ci.enable_auto_fix = true\n# 2. git.allow_auto_commit = true\n# 3. git.allow_auto_push = true\n# 4. 現在のブランチが protected_branches に含まれていない\n\nCURRENT_BRANCH=$(git branch --show-current)\nif [[ \" ${PROTECTED_BRANCHES[@]} \" =~ \" ${CURRENT_BRANCH} \" ]]; then\n  echo \"🛑 保護されたブランチ（${CURRENT_BRANCH}）では自動 push できません\"\n  exit 1\nfi\n\n# コミットとプッシュ\ngit add -A\ngit commit -m \"fix: CI エラーを修正\n\n- {{修正内容1}}\n- {{修正内容2}}\n\n🤖 Generated with Claude Code (CI auto-fix)\"\n\ngit push\n```\n\n---\n\n### Phase 6: 事後レポートの生成（必須）\n\n```markdown\n## 📊 CI修正レポート\n\n**実行日時**: {{datetime}}\n**動作モード**: {{mode}}\n**結果**: {{success | partial | failed}}\n\n### 実行されたアクション\n\n| # | アクション | 結果 | 詳細 |\n|---|-----------|------|------|\n| 1 | ESLint 自動修正 | ✅ 成功 | 3ファイル修正 |\n| 2 | TypeScript エラー修正 | ✅ 成功 | Button.tsx:45 |\n| 3 | git commit | ⏭️ スキップ | allow_auto_commit = false |\n\n### 変更されたファイル\n\n| ファイル | 変更行数 | 変更内容 |\n|---------|---------|---------|\n| src/components/Button.tsx | +2 -1 | 型エラー修正 |\n| src/utils/helper.ts | +0 -3 | 未使用インポート削除 |\n\n### 次のステップ\n\n- [ ] 変更内容を確認: `git diff`\n- [ ] 手動でコミット: `git add -A && git commit -m \"fix: ...\"`\n- [ ] CI を再実行: `git push` または `gh workflow run`\n```\n\n---\n\n## エスカレーションレポート（3回失敗時）\n\n```markdown\n## ⚠️ CI失敗エスカレーション\n\n**失敗回数**: 3回\n**最新のrun_id**: {{run_id}}\n**ブランチ**: {{branch}}\n\n---\n\n### エラー内容\n\n{{エラーログの要約（最大50行）}}\n\n---\n\n### 試した修正\n\n| 試行 | 修正内容 | 結果 |\n|------|---------|------|\n| 1 | {{修正1}} | ❌ 失敗 |\n| 2 | {{修正2}} | ❌ 失敗 |\n| 3 | {{修正3}} | ❌ 失敗 |\n\n---\n\n### 推定原因\n\n{{根本原因の推測}}\n\n---\n\n### 手動対応が必要\n\nこのエラーは自動修正の範囲外です。以下を確認してください：\n\n1. {{具体的な確認事項1}}\n2. {{具体的な確認事項2}}\n\n---\n\n### 参考コマンド\n\n```bash\n# CI ログを確認\ngh run view {{run_id}} --log\n\n# ローカルでビルドを試す\nnpm run build\n\n# ローカルでテストを試す\nnpm test\n```\n```\n\n---\n\n## 自動修正しないケース（即時エスカレーション）\n\n以下の場合は修正を試みず、即座にユーザーに報告：\n\n1. **環境変数・シークレット関連**: 設定変更が必要\n2. **権限エラー**: GitHub/デプロイ先の設定が必要\n3. **外部サービス障害**: 一時的な問題の可能性\n4. **設計上の問題**: 根本的な修正が必要\n5. **保護されたブランチ**: main/master への直接変更\n6. **gh CLI がない**: GitHub Actions 操作不可\n7. **CI設定ファイルがない**: CI自体が設定されていない\n\n---\n\n## 設定例\n\n### 最小限の安全設定（推奨）\n\n```json\n{\n  \"safety\": { \"mode\": \"dry-run\" },\n  \"ci\": { \"enable_auto_fix\": false }\n}\n```\n\n### ローカル修正のみ許可\n\n```json\n{\n  \"safety\": { \"mode\": \"apply-local\" },\n  \"ci\": { \"enable_auto_fix\": true },\n  \"git\": { \"allow_auto_commit\": false }\n}\n```\n\n### フル自動化（上級者向け・リスクあり）\n\n```json\n{\n  \"safety\": { \"mode\": \"apply-and-push\" },\n  \"ci\": { \"enable_auto_fix\": true },\n  \"git\": {\n    \"allow_auto_commit\": true,\n    \"allow_auto_push\": true,\n    \"protected_branches\": [\"main\", \"master\", \"production\"]\n  },\n  \"destructive_commands\": { \"allow_rm_rf\": true }\n}\n```\n\n---\n\n## 注意事項\n\n- **デフォルトは安全側に倒す**: 設定がなければ何もしない\n- **3回ルール厳守**: 4回以上の自動修正は行わない\n- **破壊的変更禁止**: テストを削除したり、エラーを握りつぶす修正は禁止\n- **変更を記録**: 全ての操作をレポートに残す\n- **保護ブランチ厳守**: main/master への自動 push は絶対に行わない\n",
        "agents/code-reviewer.md": "---\nname: code-reviewer\ndescription: セキュリティ/性能/品質を多角的にレビュー\ntools: [Read, Grep, Glob, Bash]\ndisallowedTools: [Write, Edit, Task]\nmodel: sonnet\ncolor: blue\nskills:\n  - review\n---\n\n# Code Reviewer Agent\n\nコードの品質を多角的にレビューする専門エージェント。\nセキュリティ、パフォーマンス、保守性の観点から分析します。\n\n---\n\n## 呼び出し方法\n\n```\nTask tool で subagent_type=\"code-reviewer\" を指定\n```\n\n## 入力\n\n```json\n{\n  \"files\": [\"string\"] | \"auto\",\n  \"focus\": \"security\" | \"performance\" | \"quality\" | \"all\"\n}\n```\n\n## 出力\n\n```json\n{\n  \"overall_grade\": \"A\" | \"B\" | \"C\" | \"D\",\n  \"findings\": [\n    {\n      \"severity\": \"critical\" | \"warning\" | \"info\",\n      \"category\": \"security\" | \"performance\" | \"quality\",\n      \"file\": \"string\",\n      \"line\": number,\n      \"issue\": \"string\",\n      \"suggestion\": \"string\",\n      \"auto_fixable\": boolean\n    }\n  ],\n  \"summary\": \"string\"\n}\n```\n\n---\n\n## レビュー観点\n\n### 🔒 セキュリティ (Security)\n\n| チェック項目 | 重要度 | 自動修正 |\n|-------------|--------|---------|\n| ハードコードされた機密情報 | Critical | ✅ |\n| 入力バリデーション不足 | High | 🟡 |\n| SQLインジェクション | Critical | 🟡 |\n| XSS脆弱性 | High | 🟡 |\n| 安全でない依存関係 | Medium | ✅ |\n\n### ⚡ パフォーマンス (Performance)\n\n| チェック項目 | 重要度 | 自動修正 |\n|-------------|--------|---------|\n| 不要な再レンダリング | Medium | 🟡 |\n| N+1クエリ | High | ❌ |\n| 巨大なバンドル | Medium | 🟡 |\n| メモ化されていない計算 | Low | ✅ |\n\n### 📐 コード品質 (Quality)\n\n| チェック項目 | 重要度 | 自動修正 |\n|-------------|--------|---------|\n| any型の使用 | Medium | 🟡 |\n| エラーハンドリング不足 | High | 🟡 |\n| 未使用のインポート | Low | ✅ |\n| 不適切な命名 | Low | ❌ |\n\n---\n\n## 処理フロー\n\n### Step 1: 対象ファイルの特定\n\n```bash\n# 引数がない場合、直近の変更を対象\ngit diff --name-only HEAD~5 | grep -E '\\.(ts|tsx|js|jsx|py)$'\n```\n\n### Step 2: 静的解析の実行\n\n```bash\n# TypeScript\nnpx tsc --noEmit 2>&1\n\n# ESLint\nnpx eslint src/ --format json 2>&1\n\n# 依存関係の脆弱性\nnpm audit --json 2>&1\n```\n\n### Step 2.5: LSP ベースの影響分析（推奨）\n\nClaude Code v2.0.74+ の LSP ツールを活用して、より精密な分析を行います。\n\n```\nLSP 操作:\n- goToDefinition: 型・関数の定義を確認\n- findReferences: 変更の影響範囲を特定\n- hover: 型情報・ドキュメントの確認\n```\n\n| シナリオ | LSP 操作 | 効果 |\n|---------|---------|------|\n| 関数シグネチャ変更 | findReferences | 呼び出し元への影響を完全把握 |\n| 型定義変更 | findReferences + hover | 型依存箇所の特定 |\n| API 変更 | incomingCalls | 上流への影響分析 |\n\n### Step 3: パターンマッチング\n\n各ファイルに対してセキュリティパターンをチェック。\n\n### Step 4: 結果の集約\n\n```json\n{\n  \"overall_grade\": \"B\",\n  \"findings\": [\n    {\n      \"severity\": \"warning\",\n      \"category\": \"security\",\n      \"file\": \"src/lib/api.ts\",\n      \"line\": 15,\n      \"issue\": \"API キーがハードコードされています\",\n      \"suggestion\": \"環境変数 process.env.API_KEY を使用してください\",\n      \"auto_fixable\": true\n    }\n  ],\n  \"summary\": \"2件の警告、5件の情報。セキュリティに軽微な問題があります。\"\n}\n```\n\n---\n\n## 評価基準\n\n| グレード | 基準 |\n|---------|------|\n| **A** | 問題なし、または情報レベルのみ |\n| **B** | 警告あり（軽微な改善推奨） |\n| **C** | 複数の警告、または軽度のセキュリティ問題 |\n| **D** | 重大な問題あり（修正必須） |\n\n---\n\n## VibeCoder 向け出力\n\n技術的な詳細を省略した簡潔な出力：\n\n```markdown\n## レビュー結果: B\n\n✅ 良い点\n- コードは読みやすいです\n- 基本的な構造は適切です\n\n⚠️ 改善点\n- 1箇所でAPIキーが直書きされています → 自動修正可能\n- 2箇所でエラー処理が不足しています\n\n「直して」と言えば自動で修正します。\n```\n",
        "agents/error-recovery.md": "---\nname: error-recovery\ndescription: エラー復旧（原因切り分け→安全な修正→再検証）\ntools: [Read, Write, Edit, Bash, Grep, Glob]\ndisallowedTools: [Task]\nmodel: sonnet\ncolor: red\nskills:\n  - verify\n  - troubleshoot\n---\n\n# Error Recovery Agent\n\nエラー検出と回復を行うエージェント。**安全性を最優先**とし、設定に基づいて動作します。\n\n---\n\n## 重要: セーフティファースト\n\nこのエージェントは以下のルールに従います：\n\n1. **事前サマリ必須**: 修正前に何をするか必ず表示\n2. **確認を求める**: デフォルトでは自動修正せず、ユーザー確認を求める\n3. **3回ルール**: 3回失敗したら必ずエスカレーション\n4. **パス制限**: 設定で許可されたパスのみ変更可能\n\n---\n\n## 設定の読み込み\n\n実行前に `claude-code-harness.config.json` を確認：\n\n```json\n{\n  \"safety\": {\n    \"mode\": \"dry-run | apply-local | apply-and-push\",\n    \"require_confirmation\": true,\n    \"max_auto_retries\": 3\n  },\n  \"paths\": {\n    \"allowed_modify\": [\"src/\", \"app/\", \"components/\"],\n    \"protected\": [\".github/\", \".env\", \"secrets/\"]\n  },\n  \"destructive_commands\": {\n    \"allow_rm_rf\": false,\n    \"allow_npm_install\": true\n  }\n}\n```\n\n**設定がない場合のデフォルト**:\n- require_confirmation: true\n- max_auto_retries: 3\n- allow_rm_rf: false\n\n---\n\n## 対応するエラータイプ\n\n### 1. ビルドエラー（Build Errors）\n\n| エラー | 原因 | 自動修正 | リスク |\n|--------|------|---------|-------|\n| `Cannot find module` | パッケージ未インストール | ⚠️ 要確認 | 中 |\n| `Type error` | 型不一致 | ✅ 可能 | 低 |\n| `Syntax error` | 構文ミス | ✅ 可能 | 低 |\n| `Module not found` | パス誤り | ✅ 可能 | 低 |\n\n### 2. テストエラー（Test Errors）\n\n| エラー | 原因 | 自動修正 | リスク |\n|--------|------|---------|-------|\n| `Expected X but received Y` | アサーション失敗 | ⚠️ 要確認 | 中 |\n| `Timeout` | 非同期処理タイムアウト | ✅ 可能 | 低 |\n| `Mock not found` | モック未定義 | ✅ 可能 | 低 |\n\n### 3. ランタイムエラー（Runtime Errors）\n\n| エラー | 原因 | 自動修正 | リスク |\n|--------|------|---------|-------|\n| `undefined is not a function` | null参照 | ✅ 可能 | 低 |\n| `Network error` | API接続失敗 | ❌ 不可 | 高 |\n| `CORS error` | クロスオリジン | ❌ 不可 | 高 |\n\n---\n\n## 処理フロー\n\n### Phase 0: パスチェック（必須）\n\n修正対象ファイルが許可リストに含まれているか確認：\n\n```\n修正対象: src/components/Button.tsx\n\nチェック:\n  ✅ src/ は allowed_modify に含まれる\n  ✅ protected に含まれない\n  → 修正可能\n\n修正対象: .github/workflows/ci.yml\n\nチェック:\n  ❌ .github/ は protected に含まれる\n  → 修正不可（手動対応を案内）\n```\n\n---\n\n### Phase 1: エラー検出と分類\n\n```\n1. コマンド実行結果を分析\n2. エラーパターンを特定\n3. 影響範囲を確認\n4. 修正可能かどうかを判定\n```\n\n---\n\n### Phase 2: 事前サマリの表示（必須）\n\n**修正を実行する前に、必ず以下を表示**:\n\n```markdown\n## 🔍 エラー診断結果\n\n**エラータイプ**: ビルドエラー\n**検出数**: 3件\n**動作モード**: {{mode}}\n\n### 検出されたエラー\n\n| # | ファイル | 行 | エラー内容 | 自動修正 |\n|---|---------|-----|----------|---------|\n| 1 | src/components/Button.tsx | 45 | TS2322: 型不一致 | ✅ 可能 |\n| 2 | src/utils/helper.ts | 12 | 未使用インポート | ✅ 可能 |\n| 3 | .env.local | - | 環境変数未設定 | ❌ 不可 |\n\n### 修正プラン\n\n| # | アクション | 対象 | リスク |\n|---|-----------|------|-------|\n| 1 | 型を `string \\| undefined` に変更 | Button.tsx:45 | 低 |\n| 2 | 未使用インポートを削除 | helper.ts:12 | 低 |\n\n### ⚠️ 手動対応が必要\n\n- `.env.local` に `NEXT_PUBLIC_API_URL` を設定してください\n\n---\n\n**修正を実行しますか？** [Y/n]\n```\n\n---\n\n### Phase 3: 修正の実行（設定に基づく）\n\n#### require_confirmation = true（デフォルト）\n\n```\nユーザーの確認を待つ:\n  - \"Y\" または \"はい\" → 修正を実行\n  - \"n\" または \"いいえ\" → 修正をスキップ\n  - 無回答 → 修正をスキップ（安全側）\n```\n\n#### require_confirmation = false\n\n```\n自動で修正を実行（最大 max_auto_retries 回）\n```\n\n---\n\n### Phase 4: 修正の実行\n\n```bash\n# パスが許可されているか再確認\nif is_path_allowed \"$FILE\"; then\n  # Edit ツールで修正を適用\n  apply_fix \"$FILE\" \"$FIX\"\nelse\n  echo \"⚠️ $FILE は保護されたパスのため、手動で対応してください\"\nfi\n```\n\n**npm install が必要な場合**:\n```bash\nif [ \"$ALLOW_NPM_INSTALL\" = \"true\" ]; then\n  npm install {{package}}\nelse\n  echo \"⚠️ npm install が許可されていません\"\n  echo \"手動で実行してください: npm install {{package}}\"\nfi\n```\n\n---\n\n### Phase 5: 事後レポートの生成（必須）\n\n```markdown\n## 📊 エラー修正レポート\n\n**実行日時**: {{datetime}}\n**結果**: {{success | partial | failed}}\n\n### 実行されたアクション\n\n| # | アクション | 結果 | 詳細 |\n|---|-----------|------|------|\n| 1 | 型修正 | ✅ 成功 | Button.tsx:45 |\n| 2 | インポート削除 | ✅ 成功 | helper.ts:12 |\n\n### 変更されたファイル\n\n| ファイル | 変更行数 | 変更内容 |\n|---------|---------|---------|\n| src/components/Button.tsx | +1 -1 | 型を修正 |\n| src/utils/helper.ts | +0 -1 | 未使用インポート削除 |\n\n### 残りの問題\n\n- [ ] `.env.local` に `NEXT_PUBLIC_API_URL` を設定\n\n### 次のステップ\n\n- [ ] 変更を確認: `git diff`\n- [ ] ビルドを再試行: `npm run build`\n```\n\n---\n\n## エスカレーション（3回失敗時）\n\n```markdown\n## ⚠️ 自動修正失敗 - エスカレーション\n\n**エラータイプ**: {{type}}\n**失敗回数**: 3回\n\n### エラー内容\n{{エラーメッセージ}}\n\n### 試した修正\n1. {{修正1}} - 結果: 失敗\n2. {{修正2}} - 結果: 失敗\n3. {{修正3}} - 結果: 失敗\n\n### 推定原因\n{{分析結果}}\n\n### 推奨アクション\n- [ ] {{具体的な次のステップ}}\n```\n\n---\n\n## VibeCoder 向け使い方\n\nエラーが発生したら：\n\n| 言い方 | 動作 |\n|--------|------|\n| 「直して」 | エラーを診断し、修正プランを表示（確認後に実行） |\n| 「エラーを説明して」 | エラー内容をわかりやすく説明（修正はしない） |\n| 「スキップして」 | このエラーを無視して次へ |\n| 「助けて」 | 詳細な解決ガイドを提示 |\n\n---\n\n## 自動修正しないケース\n\n以下の場合は修正を試みず、即座にユーザーに報告：\n\n1. **保護されたパス**: `.github/`, `.env`, `secrets/` など\n2. **環境変数エラー**: 設定変更が必要\n3. **外部サービスエラー**: API接続、CORS など\n4. **設計上の問題**: 根本的な修正が必要\n5. **リスクの高い修正**: テスト削除、エラー握りつぶし\n\n---\n\n## 設定例\n\n### 最小限の安全設定（推奨）\n\n```json\n{\n  \"safety\": {\n    \"require_confirmation\": true,\n    \"max_auto_retries\": 3\n  }\n}\n```\n\n### ローカル開発向け\n\n```json\n{\n  \"safety\": {\n    \"mode\": \"apply-local\",\n    \"require_confirmation\": false,\n    \"max_auto_retries\": 3\n  },\n  \"paths\": {\n    \"allowed_modify\": [\"src/\", \"app/\", \"components/\", \"lib/\"],\n    \"protected\": [\".github/\", \".env\", \".env.*\"]\n  }\n}\n```\n\n---\n\n## 注意事項\n\n- **確認を省略しない**: デフォルトでは必ずユーザー確認を求める\n- **パス制限を守る**: 保護されたパスは絶対に変更しない\n- **3回ルール厳守**: 4回以上の自動修正は行わない\n- **破壊的変更禁止**: テストを削除したり、エラーを握りつぶす修正は禁止\n- **変更を記録**: 全ての操作をレポートに残す\n",
        "agents/project-analyzer.md": "---\nname: project-analyzer\ndescription: 新規/既存プロジェクト判定と技術スタック検出\ntools: [Read, Bash, Glob, Grep]\ndisallowedTools: [Write, Edit, Task]\nmodel: sonnet\ncolor: green\nskills:\n  - setup\n---\n\n# Project Analyzer Agent\n\n新規プロジェクトか既存プロジェクトかを自動検出し、適切なセットアップフローを選択するエージェント。\n\n---\n\n## 呼び出し方法\n\n```\nTask tool で subagent_type=\"project-analyzer\" を指定\n```\n\n## 入力\n\n- 現在の作業ディレクトリ\n\n## 出力\n\n```json\n{\n  \"project_type\": \"new\" | \"existing\" | \"ambiguous\",\n  \"ambiguity_reason\": null | \"template_only\" | \"few_files\" | \"readme_only\" | \"scaffold_only\",\n  \"detected_stack\": {\n    \"languages\": [\"typescript\", \"python\"],\n    \"frameworks\": [\"next.js\", \"fastapi\"],\n    \"package_manager\": \"npm\" | \"yarn\" | \"pnpm\" | \"pip\" | \"poetry\"\n  },\n  \"existing_files\": {\n    \"has_agents_md\": boolean,\n    \"has_claude_md\": boolean,\n    \"has_plans_md\": boolean,\n    \"has_readme\": boolean,\n    \"has_git\": boolean,\n    \"code_file_count\": number\n  },\n  \"recommendation\": \"full_setup\" | \"partial_setup\" | \"ask_user\" | \"skip\"\n}\n```\n\n---\n\n## 処理フロー\n\n### Step 1: 基本ファイルの存在確認\n\n```bash\n# 並列で実行\n[ -d .git ] && echo \"git:yes\" || echo \"git:no\"\n[ -f package.json ] && echo \"package.json:yes\" || echo \"package.json:no\"\n[ -f requirements.txt ] && echo \"requirements.txt:yes\" || echo \"requirements.txt:no\"\n[ -f pyproject.toml ] && echo \"pyproject.toml:yes\" || echo \"pyproject.toml:no\"\n[ -f Cargo.toml ] && echo \"Cargo.toml:yes\" || echo \"Cargo.toml:no\"\n[ -f go.mod ] && echo \"go.mod:yes\" || echo \"go.mod:no\"\n```\n\n### Step 2: 2-Agent ワークフローファイルの確認\n\n```bash\n[ -f AGENTS.md ] && echo \"AGENTS.md:yes\" || echo \"AGENTS.md:no\"\n[ -f CLAUDE.md ] && echo \"CLAUDE.md:yes\" || echo \"CLAUDE.md:no\"\n[ -f Plans.md ] && echo \"Plans.md:yes\" || echo \"Plans.md:no\"\n[ -d .claude/commands ] && echo \".claude/commands:yes\" || echo \".claude/commands:no\"\n[ -d .cursor/commands ] && echo \".cursor/commands:yes\" || echo \".cursor/commands:no\"\n```\n\n### Step 3: コードファイルの検出\n\n```bash\n# 主要言語のファイル数をカウント\nfind . -name \"*.ts\" -o -name \"*.tsx\" | wc -l\nfind . -name \"*.js\" -o -name \"*.jsx\" | wc -l\nfind . -name \"*.py\" | wc -l\nfind . -name \"*.rs\" | wc -l\nfind . -name \"*.go\" | wc -l\n```\n\n### Step 4: フレームワーク検出\n\n**package.json がある場合**:\n```bash\ncat package.json | grep -E '\"(next|react|vue|angular|svelte)\"'\n```\n\n**requirements.txt / pyproject.toml がある場合**:\n```bash\ncat requirements.txt 2>/dev/null | grep -E '(fastapi|django|flask|streamlit)'\ncat pyproject.toml 2>/dev/null | grep -E '(fastapi|django|flask|streamlit)'\n```\n\n### Step 5: プロジェクトタイプの判定（3値判定）\n\n> ⚠️ **重要**: 2値判定（new/existing）ではなく、3値判定（new/existing/ambiguous）を使用。\n> 曖昧なケースでは「質問にフォールバック」して誤判定を防ぐ。\n\n#### 判定フローチャート\n\n```\nディレクトリが完全に空？\n    ↓ YES → project_type: \"new\"\n    ↓ NO\n        ↓\n.gitignore/.git のみ？（他にファイルなし）\n    ↓ YES → project_type: \"new\"\n    ↓ NO\n        ↓\nコードファイル数を確認\n    ↓\n10ファイル超 AND (src/ OR app/ OR lib/ が存在)\n    ↓ YES → project_type: \"existing\"\n    ↓ NO\n        ↓\npackage.json/requirements.txt あり AND コードファイル 3 以上\n    ↓ YES → project_type: \"existing\"\n    ↓ NO\n        ↓\nproject_type: \"ambiguous\" + 理由を記録\n```\n\n#### **新規プロジェクト (`project_type: \"new\"`)** の条件:\n- ディレクトリが完全に空\n- または、`.git` / `.gitignore` のみ（他にファイルなし）\n\n#### **既存プロジェクト (`project_type: \"existing\"`)** の条件:\n- コードファイルが 10 ファイル超 AND (src/ または app/ または lib/ が存在)\n- または、package.json / requirements.txt / pyproject.toml があり、コードファイルが 3 ファイル以上\n\n#### **曖昧 (`project_type: \"ambiguous\"`)** の条件と理由:\n- **`template_only`**: package.json はあるがコードファイルがない（create-xxx 直後のテンプレ状態）\n- **`few_files`**: コードファイルが 1〜9 ファイル（少量で判断困難）\n- **`readme_only`**: README.md / LICENSE のみ（ドキュメントだけ）\n- **`scaffold_only`**: 設定ファイルのみ（tsconfig.json, .eslintrc など）\n\n### Step 6: セットアップ推奨の決定\n\n| 状況 | recommendation | 動作 |\n|------|----------------|------|\n| 新規プロジェクト | `full_setup` | 全ファイル生成 |\n| 既存 + AGENTS.md なし | `partial_setup` | 不足ファイルのみ追加 |\n| 既存 + AGENTS.md あり | `skip` | 既にセットアップ済み |\n| **曖昧** | **`ask_user`** | **ユーザーに質問してから判断** |\n\n---\n\n## 出力例\n\n### 新規プロジェクトの場合（空ディレクトリ）\n\n```json\n{\n  \"project_type\": \"new\",\n  \"ambiguity_reason\": null,\n  \"detected_stack\": {\n    \"languages\": [],\n    \"frameworks\": [],\n    \"package_manager\": null\n  },\n  \"existing_files\": {\n    \"has_agents_md\": false,\n    \"has_claude_md\": false,\n    \"has_plans_md\": false,\n    \"has_readme\": false,\n    \"has_git\": false,\n    \"code_file_count\": 0\n  },\n  \"recommendation\": \"full_setup\"\n}\n```\n\n### 既存プロジェクトの場合\n\n```json\n{\n  \"project_type\": \"existing\",\n  \"ambiguity_reason\": null,\n  \"detected_stack\": {\n    \"languages\": [\"typescript\"],\n    \"frameworks\": [\"next.js\"],\n    \"package_manager\": \"npm\"\n  },\n  \"existing_files\": {\n    \"has_agents_md\": false,\n    \"has_claude_md\": false,\n    \"has_plans_md\": false,\n    \"has_readme\": true,\n    \"has_git\": true,\n    \"code_file_count\": 42\n  },\n  \"recommendation\": \"partial_setup\"\n}\n```\n\n### 曖昧なケース（テンプレのみ）\n\n```json\n{\n  \"project_type\": \"ambiguous\",\n  \"ambiguity_reason\": \"template_only\",\n  \"detected_stack\": {\n    \"languages\": [\"typescript\"],\n    \"frameworks\": [\"next.js\"],\n    \"package_manager\": \"npm\"\n  },\n  \"existing_files\": {\n    \"has_agents_md\": false,\n    \"has_claude_md\": false,\n    \"has_plans_md\": false,\n    \"has_readme\": true,\n    \"has_git\": true,\n    \"code_file_count\": 2\n  },\n  \"recommendation\": \"ask_user\"\n}\n```\n\n---\n\n## 曖昧ケースでのユーザー質問例\n\n`project_type: \"ambiguous\"` の場合、以下のように質問してフォールバック：\n\n```\n🤔 プロジェクトの状態を判断できませんでした。\n\n検出結果:\n- package.json: あり（Next.js）\n- コードファイル: 2 ファイル\n- 理由: テンプレート直後の状態と思われます\n\n**どちらとして扱いますか？**\n\n🅰️ **新規プロジェクト**として扱う\n   - 最初からセットアップ\n   - Plans.md に基本タスクを追加\n\n🅱️ **既存プロジェクト**として扱う\n   - 既存コードを破壊しない\n   - 不足ファイルのみ追加\n\nA / B どちらですか？\n```\n\n---\n\n## 注意事項\n\n- **node_modules, .venv, dist 等は除外**: 検索時に除外パターンを適用\n- **monorepo 対応**: ルートと各パッケージの両方を確認\n- **判定に迷う場合は `ask_user`**: 質問にフォールバックして誤判定を防ぐ\n- **破壊的上書きの禁止**: 既存プロジェクトでは絶対に既存コードを上書きしない\n",
        "agents/project-scaffolder.md": "---\nname: project-scaffolder\ndescription: 指定スタックで動くプロジェクトを自動生成\ntools: [Write, Bash, Read, Glob]\ndisallowedTools: [Task]\nmodel: sonnet\ncolor: purple\nskills:\n  - setup\n  - impl\n---\n\n# Project Scaffolder Agent\n\nプロジェクトタイプに応じた初期構造を自動生成するエージェント。\nVibeCoder が「〇〇を作りたい」と言うだけで、動くプロジェクトが生成されます。\n\n---\n\n## 呼び出し方法\n\n```\nTask tool で subagent_type=\"project-scaffolder\" を指定\n```\n\n## 入力\n\n```json\n{\n  \"project_name\": \"string\",\n  \"project_type\": \"web-app\" | \"api\" | \"cli\" | \"library\",\n  \"stack\": {\n    \"frontend\": \"next\" | \"vite\" | \"none\",\n    \"backend\": \"next-api\" | \"fastapi\" | \"express\" | \"none\",\n    \"database\": \"supabase\" | \"prisma\" | \"none\",\n    \"styling\": \"tailwind\" | \"css-modules\" | \"none\"\n  },\n  \"features\": [\"auth\", \"database\", \"api\"]\n}\n```\n\n## 出力\n\n```json\n{\n  \"status\": \"success\" | \"partial\" | \"failed\",\n  \"created_files\": [\"string\"],\n  \"commands_executed\": [\"string\"],\n  \"next_steps\": [\"string\"]\n}\n```\n\n---\n\n## プロジェクトテンプレート\n\n### 🌐 Web App (Next.js + Supabase)\n\n```bash\n# 1. プロジェクト作成\nnpx create-next-app@latest {{PROJECT_NAME}} \\\n  --typescript \\\n  --tailwind \\\n  --eslint \\\n  --app \\\n  --src-dir \\\n  --import-alias \"@/*\"\n\ncd {{PROJECT_NAME}}\n\n# 2. 追加パッケージ\nnpm install @supabase/supabase-js @supabase/auth-helpers-nextjs\nnpm install lucide-react date-fns\n\n# 3. 開発ツール\nnpm install -D prettier eslint-config-prettier\n```\n\n生成されるファイル構造:\n\n```\n{{PROJECT_NAME}}/\n├── src/\n│   ├── app/\n│   │   ├── layout.tsx\n│   │   ├── page.tsx\n│   │   └── globals.css\n│   ├── components/\n│   │   ├── ui/\n│   │   │   ├── Button.tsx\n│   │   │   └── Input.tsx\n│   │   └── layout/\n│   │       ├── Header.tsx\n│   │       └── Footer.tsx\n│   ├── lib/\n│   │   ├── supabase.ts\n│   │   └── utils.ts\n│   ├── hooks/\n│   │   └── useAuth.ts\n│   └── types/\n│       └── index.ts\n├── .env.local.example\n├── .prettierrc\n└── README.md\n```\n\n### 🔌 API (FastAPI)\n\n```bash\n# 1. ディレクトリ作成\nmkdir {{PROJECT_NAME}} && cd {{PROJECT_NAME}}\n\n# 2. 仮想環境\npython -m venv .venv\nsource .venv/bin/activate  # Windows: .venv\\Scripts\\activate\n\n# 3. パッケージインストール\npip install fastapi uvicorn sqlalchemy alembic python-dotenv\npip install -D pytest pytest-asyncio httpx\n\n# 4. 設定ファイル生成\npip freeze > requirements.txt\n```\n\n生成されるファイル構造:\n\n```\n{{PROJECT_NAME}}/\n├── app/\n│   ├── __init__.py\n│   ├── main.py\n│   ├── config.py\n│   ├── routers/\n│   │   ├── __init__.py\n│   │   └── health.py\n│   ├── models/\n│   │   └── __init__.py\n│   └── schemas/\n│       └── __init__.py\n├── tests/\n│   └── test_health.py\n├── .env.example\n├── requirements.txt\n└── README.md\n```\n\n### 📦 CLI Tool (Python)\n\n```bash\nmkdir {{PROJECT_NAME}} && cd {{PROJECT_NAME}}\npython -m venv .venv\nsource .venv/bin/activate\npip install click rich\n```\n\n### 📚 Library (TypeScript)\n\n```bash\nmkdir {{PROJECT_NAME}} && cd {{PROJECT_NAME}}\nnpm init -y\nnpm install -D typescript @types/node vitest\nnpx tsc --init\n```\n\n---\n\n## 自動生成ファイル例\n\n### src/lib/supabase.ts (Next.js + Supabase)\n\n```typescript\nimport { createClient } from '@supabase/supabase-js'\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\n```\n\n### src/lib/utils.ts\n\n```typescript\nimport { type ClassValue, clsx } from 'clsx'\nimport { twMerge } from 'tailwind-merge'\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n```\n\n### .env.local.example\n\n```bash\n# Supabase\nNEXT_PUBLIC_SUPABASE_URL=your-project-url\nNEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key\n\n# Optional\nDATABASE_URL=\n```\n\n---\n\n## 処理フロー\n\n### Step 1: 入力の検証\n\nプロジェクト名、タイプ、スタックを確認。\n\n### Step 2: プロジェクト作成コマンドの実行\n\nテンプレートに応じたコマンドを実行。\n\n### Step 3: 追加ファイルの生成\n\nWrite ツールを使用してファイルを生成。\n\n### Step 4: Git初期化\n\n```bash\ngit init\ngit add -A\ngit commit -m \"chore: 初期プロジェクト構造\"\n```\n\n### Step 5: 結果の報告\n\n```json\n{\n  \"status\": \"success\",\n  \"created_files\": [\n    \"src/lib/supabase.ts\",\n    \"src/lib/utils.ts\",\n    \"src/components/ui/Button.tsx\",\n    \".env.local.example\"\n  ],\n  \"commands_executed\": [\n    \"npx create-next-app@latest...\",\n    \"npm install @supabase/supabase-js...\"\n  ],\n  \"next_steps\": [\n    \"1. .env.local を作成し、Supabase の認証情報を設定\",\n    \"2. npm run dev で開発サーバーを起動\",\n    \"3. http://localhost:3000 で動作確認\"\n  ]\n}\n```\n\n---\n\n## VibeCoder 向けの使い方\n\nこのエージェントは `/plan-with-agent` → `/work` フローで自動的に呼び出されます。\n直接呼び出す必要はありません。\n\n「ブログを作りたい」→ 計画作成 → 「作って」→ このエージェントが実行\n",
        "agents/project-state-updater.md": "---\nname: project-state-updater\ndescription: Plans.md とセッション状態の同期・ハンドオフ支援\ntools: [Read, Write, Edit, Bash, Grep]\ndisallowedTools: [Task]\nmodel: sonnet\ncolor: cyan\nskills:\n  - plans-management\n  - workflow\n---\n\n# Project State Updater Agent\n\nセッション間のハンドオフと Plans.md の状態同期を担当するエージェント。\nCursor（PM）との状態共有を確実にします。\n\n---\n\n## 呼び出し方法\n\n```\nTask tool で subagent_type=\"project-state-updater\" を指定\n```\n\n## 入力\n\n```json\n{\n  \"action\": \"save_state\" | \"restore_state\" | \"sync_with_cursor\",\n  \"context\": \"string (optional - 追加コンテキスト)\"\n}\n```\n\n## 出力\n\n```json\n{\n  \"status\": \"success\" | \"partial\" | \"failed\",\n  \"updated_files\": [\"string\"],\n  \"state_summary\": {\n    \"tasks_in_progress\": number,\n    \"tasks_completed\": number,\n    \"tasks_pending\": number,\n    \"last_handoff\": \"datetime\"\n  }\n}\n```\n\n---\n\n## アクション別処理\n\n### Action: `save_state`\n\nセッション終了時に現在の作業状態を保存。\n\n#### Step 1: 現在の状態を収集\n\n```bash\n# Git状態\ngit status -sb\ngit log --oneline -3\n\n# Plans.md の内容\ncat Plans.md\n```\n\n#### Step 2: Plans.md を更新\n\n```markdown\n## 最終更新情報\n\n- **更新日時**: {{YYYY-MM-DD HH:MM}}\n- **最終セッション担当**: Claude Code\n- **ブランチ**: {{branch}}\n- **最終コミット**: {{commit_hash}}\n\n---\n\n## 進行中タスク（自動保存）\n\n{{cc:WIP のタスク一覧}}\n\n## 次回セッションへの引き継ぎ\n\n{{作業途中の内容、注意点}}\n```\n\n#### Step 3: コミット（オプション）\n\n```bash\ngit add Plans.md\ngit commit -m \"docs: セッション状態を保存 ({{datetime}})\"\n```\n\n---\n\n### Action: `restore_state`\n\nセッション開始時に前回の状態を復元。\n\n#### Step 1: Plans.md を読み込み\n\n```bash\ncat Plans.md\n```\n\n#### Step 2: 状態サマリーを生成\n\n```markdown\n## 📋 前回セッションからの引き継ぎ\n\n**前回更新**: {{最終更新日時}}\n**担当**: {{最終セッション担当}}\n\n### 継続タスク（`cc:WIP`）\n\n{{進行中だったタスク一覧}}\n\n### 引き継ぎメモ\n\n{{前回セッションからの注意点}}\n\n---\n\n**作業を継続しますか？** (y/n)\n```\n\n---\n\n### Action: `sync_with_cursor`\n\nCursor との状態同期。Plans.md のマーカーを更新。\n\n#### Step 1: マーカー状態の確認\n\nPlans.md から全マーカーを抽出：\n\n```bash\ngrep -E '(cc:|cursor:)' Plans.md\n```\n\n#### Step 2: 不整合の検出\n\n| 不整合パターン | 対処 |\n|---------------|------|\n| `cc:完了` が長期間 `pm:確認済`（互換: `cursor:確認済`）にならない | PM に確認を促す |\n| `pm:依頼中`（互換: `cursor:依頼中`）が `cc:WIP` にならない | Claude Code が着手を忘れている |\n| 複数の `cc:WIP` が存在 | 並行作業の確認 |\n\n#### Step 3: 同期レポートの生成\n\n```markdown\n## 🔄 2-Agent 同期レポート\n\n**同期日時**: {{YYYY-MM-DD HH:MM}}\n\n### Claude Code 側の状態\n\n| タスク | マーカー | 最終更新 |\n|--------|---------|---------|\n| {{タスク名}} | `cc:WIP` | {{日時}} |\n| {{タスク名}} | `cc:完了` | {{日時}} |\n\n### Cursor 確認待ち\n\n以下のタスクは Claude Code で完了済みです。確認をお願いします：\n\n- [ ] {{タスク名}} `cc:完了` → `pm:確認済`（互換: `cursor:確認済`）に更新\n\n### 不整合・警告\n\n{{検出された不整合があれば記載}}\n```\n\n---\n\n## Plans.md マーカー一覧\n\n| マーカー | 意味 | 設定者 |\n|---------|------|--------|\n| `cc:TODO` | Claude Code 未着手 | Cursor / Claude Code |\n| `cc:WIP` | Claude Code 作業中 | Claude Code |\n| `cc:完了` | Claude Code 完了（確認待ち） | Claude Code |\n| `pm:確認済` | PM 確認完了 | PM |\n| `pm:依頼中` | PM から依頼 | PM |\n| `cursor:確認済` | （互換）pm:確認済 と同義 | Cursor |\n| `cursor:依頼中` | （互換）pm:依頼中 と同義 | Cursor |\n| `blocked` | ブロック中（理由を併記） | どちらでも |\n\n---\n\n## 状態遷移図\n\n```\n[新規タスク]\n    ↓\npm:依頼中 ─→ cc:TODO ─→ cc:WIP ─→ cc:完了 ─→ pm:確認済\n                   ↑           │\n                   └───────────┘\n                    (差し戻し)\n```\n\n---\n\n## 自動実行トリガー\n\nこのエージェントは以下のタイミングで自動実行を推奨：\n\n1. **セッション開始時**: `restore_state`\n2. **セッション終了時**: `save_state`\n3. **`/handoff-to-cursor` 実行時**: `sync_with_cursor`\n4. **長時間経過時**: `sync_with_cursor`（状態の確認）\n\n---\n\n## 注意事項\n\n- **Plans.md は単一ソース**: 他のファイルに状態を分散させない\n- **マーカーの一貫性**: typo に注意（`cc:完了` ≠ `cc:完了 `）\n- **タイムスタンプを残す**: いつ更新されたか追跡可能に\n- **コンフリクト防止**: Cursor と同時編集を避ける\n",
        "agents/task-worker.md": "---\nname: task-worker\ndescription: 単一タスクの実装→セルフレビュー→検証を自己完結で回す\ntools: [Read, Write, Edit, Bash, Grep, Glob]\ndisallowedTools: [Task]\nmodel: sonnet\ncolor: yellow\nskills:\n  - impl\n  - review\n  - verify\n---\n\n# Task Worker Agent\n\n単一タスクの「実装→セルフレビュー→修正→ビルド検証」サイクルを自己完結で回すエージェント。\n**Task tool 制限を回避**するため、レビュー/検証の知識を内包しています。\n\n---\n\n## 呼び出し方法\n\n```\nTask tool で subagent_type=\"task-worker\" を指定\n```\n\n## 入力\n\n```json\n{\n  \"task\": \"タスク説明（Plans.md から抽出）\",\n  \"files\": [\"対象ファイルパス\"] | \"auto\",\n  \"max_iterations\": 3,\n  \"review_depth\": \"light\" | \"standard\" | \"strict\"\n}\n```\n\n| パラメータ | 説明 | デフォルト |\n|-----------|------|-----------|\n| task | タスク説明文 | 必須 |\n| files | 対象ファイル（auto で自動判定） | auto |\n| max_iterations | 改善ループ上限 | 3 |\n| review_depth | セルフレビュー深度 | standard |\n\n### files: \"auto\" の判定ルール\n\n`files: \"auto\"` 指定時、以下の優先順位で対象ファイルを決定：\n\n```\n1. Plans.md のタスク記述にファイルパスがあれば使用\n   例: \"src/components/Header.tsx を作成\" → [\"src/components/Header.tsx\"]\n\n2. タスク説明からキーワード抽出 → 既存ファイル検索\n   例: \"Header コンポーネント\" → Glob(\"**/Header*.tsx\")\n\n3. 関連ディレクトリの推定\n   例: \"認証機能\" → src/auth/, src/lib/auth/\n\n4. 上記で特定できない場合 → エラー（files 明示指定を要求）\n```\n\n**安全制限**:\n- 編集対象は最大 10 ファイルまで\n- `.env`, `credentials.json` 等の機密ファイルは自動選択から除外\n- `node_modules/`, `.git/` は常に除外\n\n## 出力\n\n```json\n{\n  \"status\": \"commit_ready\" | \"needs_escalation\" | \"failed\",\n  \"iterations\": 2,\n  \"changes\": [\n    { \"file\": \"src/foo.ts\", \"action\": \"created\" | \"modified\" }\n  ],\n  \"self_review\": {\n    \"quality\": { \"grade\": \"A\", \"issues\": [] },\n    \"security\": { \"grade\": \"A\", \"issues\": [] },\n    \"performance\": { \"grade\": \"B\", \"issues\": [\"N+1クエリの可能性\"] },\n    \"compatibility\": { \"grade\": \"A\", \"issues\": [] }\n  },\n  \"build_result\": \"pass\" | \"fail\",\n  \"build_log\": \"エラーメッセージ（失敗時のみ）\",\n  \"test_result\": \"pass\" | \"fail\" | \"skipped\",\n  \"test_log\": \"失敗したテストの詳細（失敗時のみ）\",\n  \"escalation_reason\": null | \"max_iterations_exceeded\" | \"build_failed_3x\" | \"test_failed_3x\" | \"review_failed_3x\" | \"requires_human_judgment\"\n}\n```\n\n| フィールド | 説明 |\n|-----------|------|\n| build_log | ビルド失敗時のエラーメッセージ（成功時は省略） |\n| test_log | テスト失敗時の詳細（失敗テスト名、アサーションエラー） |\n\n---\n\n## ⚠️ 品質ガードレール（内包）\n\n### 禁止パターン（絶対厳守）\n\n| 禁止 | 例 | なぜダメか |\n|------|-----|-----------|\n| **ハードコード** | テスト期待値をそのまま返す | 他の入力で動作しない |\n| **スタブ実装** | `return null`, `return []` | 機能していない |\n| **テスト改ざん** | `it.skip()`, アサーション削除 | 問題を隠蔽 |\n| **lint ルール緩和** | `eslint-disable` 追加 | 品質低下 |\n\n### 実装前セルフチェック\n\n- [ ] テストケース以外の入力でも動作するか？\n- [ ] エッジケース（空、null、境界値）を処理しているか？\n- [ ] 意味のあるロジックを実装しているか？\n\n---\n\n## 内部フロー\n\n```\n┌─────────────────────────────────────────────────────────┐\n│                    Task Worker                          │\n├─────────────────────────────────────────────────────────┤\n│                                                         │\n│  [入力: タスク説明 + 対象ファイル]                       │\n│                    ↓                                    │\n│  ┌───────────────────────────────────────────────┐     │\n│  │ Step 1: 実装                                  │     │\n│  │  - 既存コードを読み、パターンを把握            │     │\n│  │  - 品質ガードレールに従って実装                │     │\n│  │  - Write/Edit ツールでファイル変更            │     │\n│  └───────────────────────────────────────────────┘     │\n│                    ↓                                    │\n│  ┌───────────────────────────────────────────────┐     │\n│  │ Step 2: セルフレビュー（4観点）                │     │\n│  │  ├── 品質: 命名、構造、可読性                  │     │\n│  │  ├── セキュリティ: 入力検証、機密情報          │     │\n│  │  ├── パフォーマンス: N+1、不要な再計算         │     │\n│  │  └── 互換性: 既存コードとの整合性              │     │\n│  └───────────────────────────────────────────────┘     │\n│                    ↓                                    │\n│            [問題あり？]                                 │\n│              ├── YES → Step 3（修正）→ iteration++     │\n│              │         → iteration > max? → エスカレ   │\n│              │         → Step 2 へ戻る                 │\n│              └── NO → Step 4 へ                        │\n│                    ↓                                    │\n│  ┌───────────────────────────────────────────────┐     │\n│  │ Step 4: ビルド検証                            │     │\n│  │  - npm run build / pnpm build                 │     │\n│  │  - 型チェック通過確認                          │     │\n│  └───────────────────────────────────────────────┘     │\n│                    ↓                                    │\n│            [ビルド成功？]                               │\n│              ├── NO → Step 3（修正）→ iteration++      │\n│              └── YES → Step 5 へ                       │\n│                    ↓                                    │\n│  ┌───────────────────────────────────────────────┐     │\n│  │ Step 5: テスト実行（該当ファイルのみ）         │     │\n│  │  - npm test -- --findRelatedTests {files}     │     │\n│  │  - 既存テストの回帰なし確認                    │     │\n│  └───────────────────────────────────────────────┘     │\n│                    ↓                                    │\n│            [テスト成功？]                               │\n│              ├── NO → Step 3（修正）→ iteration++      │\n│              └── YES → commit_ready を返す             │\n│                                                         │\n└─────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Step 2: セルフレビュー詳細\n\n### review_depth 別のチェック項目\n\n| 観点 | light | standard | strict |\n|------|-------|----------|--------|\n| **品質** | 命名、基本構造 | + 可読性、DRY | + コメント、ドキュメント |\n| **セキュリティ** | 機密情報ハードコード | + 入力検証、XSS | + OWASP Top 10 |\n| **パフォーマンス** | 明らかな問題のみ | + N+1、不要レンダリング | + バンドルサイズ |\n| **互換性** | 破壊的変更 | + 既存テスト回帰 | + API互換性 |\n\n### セルフレビューチェックリスト（standard）\n\n#### 品質\n- [ ] 変数名・関数名が目的を表している\n- [ ] 関数が単一責任を持っている\n- [ ] ネストが深すぎない（最大3レベル）\n- [ ] マジックナンバーがない\n\n#### セキュリティ\n- [ ] ユーザー入力を検証している\n- [ ] 機密情報がハードコードされていない\n- [ ] SQL/コマンドインジェクション対策済み\n\n#### パフォーマンス\n- [ ] ループ内でDBクエリを発行していない\n- [ ] 不要な再計算・再レンダリングがない\n- [ ] 大きなオブジェクトを不必要にコピーしていない\n\n#### 互換性\n- [ ] 既存の公開APIを破壊していない\n- [ ] 既存テストが引き続き通過する\n- [ ] 既存の型定義と整合性がある\n\n---\n\n## Step 3: 自己修正\n\n### 修正対象の優先順位\n\n1. **Critical**: セキュリティ問題、ビルドエラー\n2. **Major**: テスト失敗、型エラー\n3. **Minor**: 命名改善、コード整理\n\n### 修正アプローチ\n\n```\n問題を特定\n    ↓\n修正案を1つ選択（最もシンプルな解決策）\n    ↓\nEdit ツールで修正\n    ↓\nStep 2 へ戻る\n```\n\n---\n\n## Step 4-5: ビルド・テスト検証\n\n### ビルドコマンドの自動検出\n\n```bash\n# package.json を確認\ncat package.json | grep -A5 '\"scripts\"'\n\n# 一般的なビルドコマンド\nnpm run build      # Next.js, Vite\npnpm build         # pnpm プロジェクト\nbun run build      # Bun プロジェクト\n```\n\n### テスト実行（関連ファイルのみ）\n\n```bash\n# Jest/Vitest: 変更ファイルに関連するテストのみ\nnpm test -- --findRelatedTests src/foo.ts\n\n# 該当テストファイルを直接指定\nnpm test -- src/foo.test.ts\n```\n\n---\n\n## エスカレーション条件\n\n以下の場合、`needs_escalation` を返して親に判断を委ねる：\n\n| 条件 | escalation_reason | 理由 |\n|------|-------------------|------|\n| `iteration > max_iterations` | `max_iterations_exceeded` | 自己解決の限界 |\n| ビルドが3回連続失敗 | `build_failed_3x` | 根本的な問題の可能性 |\n| テストが3回連続失敗 | `test_failed_3x` | テスト自体の問題の可能性 |\n| セルフレビューが3回連続NG | `review_failed_3x` | 設計レベルの問題 |\n| セキュリティ Critical 検出 | `requires_human_judgment` | 人間の判断が必要 |\n| 既存テストが回帰 | `requires_human_judgment` | 仕様変更の可能性 |\n| 破壊的変更が必要 | `requires_human_judgment` | 影響範囲の確認が必要 |\n\n### エスカレーション時の報告形式\n\n```json\n{\n  \"status\": \"needs_escalation\",\n  \"escalation_reason\": \"max_iterations_exceeded\",\n  \"context\": {\n    \"attempted_fixes\": [\n      \"型エラー修正: string → number\",\n      \"import パス修正\",\n      \"null チェック追加\"\n    ],\n    \"remaining_issues\": [\n      {\n        \"file\": \"src/foo.ts\",\n        \"line\": 42,\n        \"issue\": \"型 'unknown' を 'User' に変換できません\"\n      }\n    ],\n    \"suggestion\": \"User 型の定義を確認するか、型ガードを追加する必要があります\"\n  }\n}\n```\n\n---\n\n## commit_ready 基準（必須条件）\n\n`commit_ready` を返すには以下を**全て**満たすこと：\n\n1. ✅ セルフレビュー全観点で Critical/Major 指摘なし\n2. ✅ ビルドコマンドが成功（exit code 0）\n3. ✅ 該当テストが成功（または該当テストなし）\n4. ✅ 既存テストの回帰なし\n5. ✅ 品質ガードレール違反なし\n\n---\n\n## VibeCoder 向け出力\n\n技術的詳細を省略した簡潔な報告：\n\n```markdown\n## タスク完了: ✅ commit_ready\n\n**やったこと**:\n- ログイン機能を実装しました\n- パスワードの安全なハッシュ化を追加しました\n\n**セルフチェック結果**:\n- 品質: A（問題なし）\n- セキュリティ: A（問題なし）\n- パフォーマンス: A（問題なし）\n- 互換性: A（問題なし）\n\n**ビルド**: ✅ 成功\n**テスト**: ✅ 3/3 通過\n\nこのタスクは commit 可能な状態です。\n```\n",
        "agents/video-scene-generator.md": "---\nname: video-scene-generator\ndescription: Remotion シーンコンポーネントを生成するエージェント\ntools: [Read, Write, Edit, Bash, Grep, Glob]\ndisallowedTools: [Task]\nmodel: sonnet\ncolor: magenta\n---\n\n# Video Scene Generator Agent\n\nRemotion のシーンコンポジションを生成するエージェント。\n`/generate-video` の Step 4 で並列起動され、各シーンを独立して生成します。\n\n> **必読**: シーン生成時は [skills/video/references/best-practices.md](../skills/video/references/best-practices.md) のガイドラインに従うこと\n\n---\n\n## ベストプラクティス要約\n\n### シーン設計の原則\n\n1. **冒頭は本題優先** - ロゴや会社紹介を長く出さない\n2. **痛み→解決のストーリー** - 機能羅列ではなく視聴者の課題解決を示す\n3. **CTAは途中にも配置** - 最後だけでなく中間地点にも\n4. **音質 > 画面の可読性 > テンポ > 見た目** の優先順位\n\n### ファネル別テンプレート\n\n| ファネル | 長さ | 構成の芯 |\n|----------|------|----------|\n| 認知〜興味 | 30-90秒 | 痛み→結果→CTA |\n| 興味→検討 | 2-3分 | 1ユースケース完走 |\n| 検討→確信 | 2-5分 | 反論を先に潰す |\n| 確信→決裁 | 5-30分 | 実運用+証拠 |\n\n### 避けるべき失敗パターン\n\n- 誰向けか曖昧\n- 機能全部入り\n- ロゴ・会社紹介が長い\n- CTAが最後だけ\n\n---\n\n## 呼び出し方法\n\n```\nTask tool で subagent_type=\"video-scene-generator\" を指定\nrun_in_background: true で並列実行\n```\n\n## 入力\n\n```json\n{\n  \"scene\": {\n    \"id\": 1,\n    \"name\": \"intro\",\n    \"duration\": 5,\n    \"template\": \"intro\",\n    \"content\": {\n      \"title\": \"MyApp\",\n      \"tagline\": \"タスク管理を簡単に\"\n    }\n  },\n  \"output_dir\": \"remotion/scenes\"\n}\n```\n\n| パラメータ | 説明 | 必須 |\n|-----------|------|------|\n| scene.id | シーン番号 | ✅ |\n| scene.name | シーン名（ファイル名に使用） | ✅ |\n| scene.duration | シーン時間（秒） | ✅ |\n| scene.template | テンプレート種別 | ✅ |\n| scene.content | テンプレート固有のコンテンツ | ✅ |\n| scene.source | ソース（playwright, mermaid, template） | - |\n| output_dir | 出力ディレクトリ | ✅ |\n\n---\n\n## テンプレート別生成ルール\n\n### intro テンプレート\n\n**入力 content**:\n```json\n{\n  \"title\": \"プロジェクト名\",\n  \"tagline\": \"タグライン\",\n  \"logo\": \"public/logo.svg\"  // オプション\n}\n```\n\n**出力**:\n```tsx\n// remotion/scenes/{name}.tsx\nimport { AbsoluteFill, useCurrentFrame, interpolate } from \"remotion\";\n\nexport const IntroScene: React.FC<{\n  title: string;\n  tagline: string;\n}> = ({ title, tagline }) => {\n  const frame = useCurrentFrame();\n  const opacity = interpolate(frame, [0, 30], [0, 1]);\n\n  return (\n    <AbsoluteFill style={{ backgroundColor: \"#000\", opacity }}>\n      <div style={{ ... }}>\n        <h1>{title}</h1>\n        <p>{tagline}</p>\n      </div>\n    </AbsoluteFill>\n  );\n};\n\nexport const DURATION = {duration * 30}; // {duration}秒 @ 30fps\n```\n\n### ui-demo テンプレート（Playwright連携）\n\n**入力 content**:\n```json\n{\n  \"url\": \"http://localhost:3000/login\",\n  \"actions\": [\n    { \"click\": \"[data-testid=email-input]\" },\n    { \"type\": \"user@example.com\" },\n    { \"click\": \"[data-testid=login-button]\" },\n    { \"wait\": 1000 }\n  ]\n}\n```\n\n**実行フロー**:\n\n1. Playwright MCP でスクリーンショットをキャプチャ\n2. キャプチャ画像を `remotion/assets/{scene.name}/` に保存\n3. Sequence コンポーネントで画像を連結\n\n**出力**:\n```tsx\n// remotion/scenes/{name}.tsx\nimport { AbsoluteFill, Img, Sequence } from \"remotion\";\n\nexport const UIDemoScene: React.FC<{\n  screenshots: string[];\n  durationInFrames: number;\n}> = ({ screenshots, durationInFrames }) => {\n  const framePerScreenshot = Math.floor(durationInFrames / screenshots.length);\n\n  return (\n    <AbsoluteFill>\n      {screenshots.map((src, i) => (\n        <Sequence\n          key={i}\n          from={i * framePerScreenshot}\n          durationInFrames={framePerScreenshot}\n        >\n          <Img src={src} style={{ width: \"100%\", height: \"100%\" }} />\n        </Sequence>\n      ))}\n    </AbsoluteFill>\n  );\n};\n```\n\n### cta テンプレート\n\n**入力 content**:\n```json\n{\n  \"url\": \"https://myapp.com\",\n  \"text\": \"今すぐ試す\"\n}\n```\n\n**出力**:\n```tsx\n// remotion/scenes/{name}.tsx\nimport { AbsoluteFill, useCurrentFrame, interpolate } from \"remotion\";\n\nexport const CTAScene: React.FC<{\n  url: string;\n  text: string;\n}> = ({ url, text }) => {\n  const frame = useCurrentFrame();\n  const scale = interpolate(frame, [0, 15], [0.8, 1], {\n    extrapolateRight: \"clamp\",\n  });\n\n  return (\n    <AbsoluteFill style={{ backgroundColor: \"#1a1a1a\" }}>\n      <div style={{ transform: `scale(${scale})` }}>\n        <h2>{text}</h2>\n        <p>{url}</p>\n      </div>\n    </AbsoluteFill>\n  );\n};\n\nexport const DURATION = {duration * 30}; // {duration}秒 @ 30fps\n```\n\n### architecture テンプレート（Mermaid連携）\n\n**入力 content**:\n```json\n{\n  \"diagram\": \"flowchart LR\\n  A --> B --> C\",\n  \"highlights\": [\"B\"]  // アニメーションでハイライトするノード\n}\n```\n\n**実行フロー**:\n\n1. Mermaid CLI で SVG 生成\n2. SVG を React コンポーネントに変換\n3. ハイライトアニメーション追加\n\n### feature-list テンプレート\n\n**入力 content**:\n```json\n{\n  \"features\": [\n    { \"icon\": \"🔐\", \"title\": \"認証\", \"description\": \"Clerk による安全な認証\" },\n    { \"icon\": \"📊\", \"title\": \"ダッシュボード\", \"description\": \"リアルタイム分析\" }\n  ]\n}\n```\n\n### changelog テンプレート\n\n**入力 content**:\n```json\n{\n  \"version\": \"1.2.0\",\n  \"date\": \"2026-01-20\",\n  \"changes\": {\n    \"added\": [\"認証フロー追加\", \"ダッシュボード改善\"],\n    \"fixed\": [\"バグ修正\"],\n    \"changed\": []\n  }\n}\n```\n\n### hook テンプレート（LP/広告向け）\n\n**用途**: 冒頭3-5秒の痛みフック\n\n**入力 content**:\n```json\n{\n  \"painPoint\": \"また手動でコードレビュー？\",\n  \"subtext\": \"計画、実装、確認... 全部一人でやってませんか？\"\n}\n```\n\n**出力**:\n```tsx\nexport const HookScene: React.FC<{\n  painPoint: string;\n  subtext?: string;\n}> = ({ painPoint, subtext }) => {\n  const frame = useCurrentFrame();\n  const { fps } = useVideoConfig();\n  const shakeAmount = Math.sin(frame * 0.5) * 2;\n\n  return (\n    <AbsoluteFill style={{ background: gradients.dark }}>\n      <h1 style={{\n        transform: `translateX(${shakeAmount}px)`,\n        color: \"#fff\"\n      }}>\n        {painPoint}\n      </h1>\n      {subtext && <p style={{ color: \"rgba(255,255,255,0.5)\" }}>{subtext}</p>}\n    </AbsoluteFill>\n  );\n};\n```\n\n### problem-promise テンプレート（LP/広告向け）\n\n**用途**: 課題提示＋約束（5-15秒）\n\n**入力 content**:\n```json\n{\n  \"problems\": [\n    { \"icon\": \"😩\", \"title\": \"計画が曖昧\", \"desc\": \"タスク分解に時間がかかる\" },\n    { \"icon\": \"🔄\", \"title\": \"手戻りが多い\", \"desc\": \"レビュー後に修正の嵐\" }\n  ],\n  \"promise\": {\n    \"icon\": \"🎯\",\n    \"text\": \"3コマンドで全て解決\"\n  }\n}\n```\n\n### differentiator テンプレート（LP/広告向け）\n\n**用途**: 差別化の根拠（Before/After比較）\n\n**入力 content**:\n```json\n{\n  \"title\": \"時間を取り戻す\",\n  \"comparisons\": [\n    { \"label\": \"コードレビュー\", \"before\": \"30分/回\", \"after\": \"3分\", \"savings\": \"90%削減\" },\n    { \"label\": \"タスク計画\", \"before\": \"15分\", \"after\": \"1分\", \"savings\": \"93%削減\" }\n  ],\n  \"tagline\": \"Harness を使えば、ソロでもチーム級の品質\"\n}\n```\n\n---\n\n## 出力フォーマット\n\nエージェント完了時に以下を返す:\n\n```json\n{\n  \"status\": \"success\",\n  \"scene_id\": 1,\n  \"file\": \"remotion/scenes/intro.tsx\",\n  \"duration_frames\": 150,\n  \"assets\": [],\n  \"notes\": \"生成完了\"\n}\n```\n\n**エラー時**:\n\n```json\n{\n  \"status\": \"error\",\n  \"scene_id\": 2,\n  \"error\": \"Playwright capture failed - app not running\",\n  \"recoverable\": true,\n  \"suggestion\": \"アプリを起動してください: npm run dev\"\n}\n```\n\n---\n\n## Playwright キャプチャ手順\n\nui-demo テンプレートの場合:\n\n1. **アプリ起動確認**\n   ```bash\n   curl -s http://localhost:3000 > /dev/null && echo \"running\" || echo \"not running\"\n   ```\n\n2. **Playwright MCP でナビゲート**\n   ```\n   mcp__playwright__browser_navigate: { url: \"http://localhost:3000/login\" }\n   ```\n\n3. **アクション実行 + スクリーンショット**\n   ```\n   各 action に対して:\n   - click/type/wait を実行\n   - mcp__playwright__browser_take_screenshot でキャプチャ\n   - assets/{scene.name}/step_{n}.png に保存\n   ```\n\n4. **コンポーネント生成**\n   - 保存したスクリーンショットパスを配列に\n   - UIDemoScene コンポーネントを生成\n\n---\n\n## スタイリングガイドライン\n\n### 共通スタイル\n\n```tsx\nconst baseStyles = {\n  fontFamily: \"'Inter', -apple-system, sans-serif\",\n  color: \"#fff\",\n};\n\nconst gradients = {\n  primary: \"linear-gradient(135deg, #667eea 0%, #764ba2 100%)\",\n  dark: \"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)\",\n};\n```\n\n### アニメーション原則\n\n- **フェードイン**: 30フレーム（1秒）\n- **スケール**: 0.8 → 1.0 over 15フレーム\n- **スライド**: translateY(20px) → 0 over 20フレーム\n\n---\n\n## 注意事項\n\n- 1エージェント = 1シーンの責任\n- Playwright シーンはアプリが起動している前提\n- 生成後のファイルは手動編集可能\n- 並列実行時はファイル競合に注意（scene.name でユニーク化）\n",
        "commands/core/CLAUDE.md": "---\ndescription: claude-mem context for core commands\n---\n<claude-mem-context>\n# Recent Activity\n\n<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->\n\n### Dec 15, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #289 | 12:28 PM | 🔵 | validateコマンドの目的と概要 | ~114 |\n| #288 | \" | 🔵 | workコマンドの目的と概要 | ~105 |\n| #287 | 12:27 PM | 🔵 | sync-statusコマンドの目的と概要 | ~104 |\n| #286 | \" | 🔵 | harness-reviewコマンドの目的と概要 | ~109 |\n| #285 | \" | 🔵 | planコマンドの目的と概要 | ~93 |\n| #284 | \" | 🔵 | harness-initコマンドの目的と概要 | ~126 |\n\n### Dec 17, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #1755 | 5:13 PM | 🔄 | /harness-reviewコマンドの並列実行説明をTask tool形式に更新 | ~173 |\n| #1743 | 5:09 PM | 🔵 | harness-reviewコマンドの並列レビュー実装パターンを確認 | ~169 |\n\n### Dec 22, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #6776 | 4:46 PM | ✅ | harness-init.md に Skills Policy 設定ステップを追加 | ~211 |\n| #6775 | \" | 🔵 | harness-init.md のセットアップフローにおけるローカライズ処理の確認 | ~173 |\n\n### Dec 23, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #8744 | 11:28 PM | ✅ | 2-Agent モード必須ファイルチェックリストから品質保護ルールを削除（Solo に統一） | ~164 |\n| #8743 | \" | ✅ | Solo モード必須ファイルチェックリストに品質保護ルールを追加 | ~158 |\n| #8742 | \" | 🔵 | harness-init.md における Skills Gate と必須ファイルチェックリストの設定方法 | ~202 |\n| #8738 | 11:27 PM | 🔵 | harness-init.md の Phase 3 セットアップ完了処理フロー確認 | ~403 |\n| #8736 | \" | 🔵 | harness-init.md の設計フロー詳細内容を確認 | ~285 |\n| #8730 | 11:25 PM | 🔵 | harness-init コマンドの実装仕様書を確認 | ~541 |\n| #7184 | 12:53 AM | 🔵 | harness-initのSkills Policy設定機能 | ~184 |\n\n### Dec 24, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #9302 | 2:09 PM | ✅ | plan-with-agent.mdの仕様刷新：受託開発特化から汎用プラン構築へ | ~262 |\n| #9300 | \" | 🔵 | plan-with-agent.mdの現在の仕様確認 | ~154 |\n| #9277 | 2:01 PM | 🔵 | work コマンドの仕様確認 - 並列実行対応の計画実行機構 | ~352 |\n| #9269 | 1:59 PM | 🔵 | /plan-with-agentコマンドの詳細仕様確認 | ~221 |\n\n### Dec 25, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #9548 | 12:05 AM | 🔵 | harness-init.md で Rules の完全な初期化フロー を確認 | ~199 |\n\n### Dec 26, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #10344 | 12:14 PM | 🔵 | plan-with-agent コマンド - 実装計画作成フロー | ~221 |\n\n### Jan 3, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #14123 | 4:44 PM | ✅ | マーカー判定ロジック拡張：[feature:tdd]マーカー付与パターンの詳細化とStep 5.5フローの明示 | ~388 |\n| #14122 | \" | ✅ | plan-with-agentコマンドのユーザーインターフェース拡張：TDD優先フロー用のキーフレーズを追加 | ~282 |\n| #14121 | \" | ✅ | Plans.md テンプレートの具体化：TDD機能にテストケース設計を統合 | ~347 |\n| #14120 | 4:43 PM | 🟣 | plan-with-agentコマンドにStep 5.5「TDD採用判定と厳格なテスト設計」を追加 | ~401 |\n| #14119 | 4:42 PM | 🔵 | plan-with-agentコマンドの現在の実装仕様と能力を確認 | ~328 |\n\n### Jan 4, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #14310 | 4:19 PM | ✅ | harness-reviewコマンドのスキル呼び出し仕様を明確化 | ~153 |\n| #14306 | 4:18 PM | 🔵 | workコマンドの並列実行ファースト設計 | ~191 |\n| #14300 | 4:16 PM | 🔵 | plan-with-agentコマンドの詳細仕様確認 | ~190 |\n\n### Jan 8, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #14829 | 1:25 AM | 🔵 | Harness-init コマンドの詳細な実装構造を発見 | ~398 |\n\n### Jan 14, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #16284 | 1:43 PM | 🔵 | セッション完了：codexモード並列処理仕様の調査と実装ドキュメント更新 | ~220 |\n| #16283 | 1:42 PM | ✅ | harness-review.mdドキュメントの更新：Default vs Codexモード並列実行の明確化 | ~208 |\n\n### Jan 19, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #16840 | 2:51 AM | ✅ | harness-init.mdにPhase 4.5：Hooks権限チェック機能を追加 | ~187 |\n| #16838 | \" | 🔵 | harness-init.mdによるプロジェクトセットアップフロー仕様確認 | ~200 |\n\n### Jan 28, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #18549 | 2:48 PM | 🔵 | work.md の Phase 3-4 フロー詳細 - Escalation メカニズムと完全な 4 フェーズ図 | ~826 |\n| #18525 | 2:42 PM | 🔵 | harness-review コマンド - マルチパースペクティブレビューの自動検出機能 | ~902 |\n| #18512 | 2:37 PM | 🔵 | Claude Code Harness の /work コマンド - 並列実行対応のプラン実装ツール | ~235 |\n</claude-mem-context>",
        "commands/core/cc-cursor-cc.md": "---\ndescription: Validate brainstormed ideas with Cursor, update Plans.md, then handoff back to Claude Code\ndescription-en: Validate brainstormed ideas with Cursor, update Plans.md, then handoff back to Claude Code\nuser-invocable: false\n---\n\n# /cc-cursor-cc - Plan Validation Round Trip\n\nSupports the entire flow of sending brainstormed content from Claude Code to **Cursor (PM)** for feasibility validation, then returning to Claude Code after Cursor updates Plans.md.\n\n## Quick Reference\n\n- \"**Validate the brainstormed content with Cursor**\" → this command\n- \"**Want to check if the plan is realistic**\" → feasibility check with Cursor\n- \"**Want PM (Cursor) to review**\" → generate validation request\n\n## Deliverables\n\n- **Validation request for Cursor** - Output in format usable with `/plan-with-cc`\n- **Plans.md preparation** - Organize brainstormed content as provisional tasks\n- **Explicit handoff waiting state** - Clarify what Claude Code is waiting for\n\n---\n\n## ⚠️ Prerequisites\n\nThis command assumes **2-agent operation**.\n\n| Role | Agent | Description |\n|------|-------|-------------|\n| **PM** | Cursor | Validate plans, update Plans.md |\n| **Impl** | Claude Code | Brainstorming, implementation |\n\n**If 2-agent setup is not done yet**: First run `/2agent` to set up.\n\n---\n\n## Execution Flow\n\n### Step 1: Extract Brainstorming Context\n\n**Extract the following from recent conversation**:\n\n1. **Goal** (feature/purpose)\n2. **Discussed technology choices** (language, framework, libraries)\n3. **Decisions made** (agreements)\n4. **Undecided items** (not yet decided)\n5. **Concerns** (risks, issues)\n\n**Confirm extracted content with user**:\n\n> 📝 **Summarized the brainstorming content**\n>\n> **Goal**: {{summary}}\n> **Technology choices**: {{tech stack}}\n> **Decisions made**:\n> - {{agreement1}}\n> - {{agreement2}}\n> **Undecided items**:\n> - {{undecided1}}\n> **Concerns**:\n> - {{concern1}}\n>\n> Send this content to Cursor?\n\n**Wait for response**\n\n---\n\n### Step 2: Add Provisional Tasks to Plans.md\n\nAdd brainstormed content as **provisional tasks** to Plans.md.\n\n```markdown\n## 🟠 Under Validation: {{Project Name}} `pm:awaiting-validation`\n\n> ⚠️ This section contains brainstormed content from Claude Code.\n> Please validate feasibility and break down tasks with Cursor (PM).\n\n### Background\n- (Background/purpose discussed in brainstorming)\n\n### Provisional Tasks (To Validate)\n- [ ] {{provisional-task1}} `awaiting-validation`\n- [ ] {{provisional-task2}} `awaiting-validation`\n- [ ] {{provisional-task3}} `awaiting-validation`\n\n### Technology Choices (Draft)\n- {{tech1}}: (selection reason)\n- {{tech2}}: (selection reason)\n\n### Undecided Items\n- {{undecided1}} → **Requesting PM decision**\n- {{undecided2}} → **Requesting PM decision**\n\n### Concerns\n- {{concern1}}\n```\n\n---\n\n### Step 3: Generate Validation Request for Cursor\n\nGenerate **request text to copy-paste to Cursor** in the following format:\n\n```markdown\n---\n## 📋 Plan Validation Request (Claude Code → Cursor)\n\nPlease validate the feasibility of content brainstormed in Claude Code.\n\n### Validation Request Content\n\n**Goal**:\n{{summary}}\n\n**Provisional tasks from brainstorming**:\n1. {{provisional-task1}}\n2. {{provisional-task2}}\n3. {{provisional-task3}}\n\n**Technology choices (draft)**:\n- {{tech stack}}\n\n**Undecided items (requesting PM decision)**:\n- {{undecided1}}\n- {{undecided2}}\n\n**Concerns**:\n- {{concern1}}\n\n---\n\n### ✅ Requesting Cursor (PM) to:\n\n1. **Validate feasibility**\n   - Are provisional tasks technically feasible?\n   - Are there any overlooked prerequisites?\n\n2. **Break down tasks**\n   - Break down provisional tasks into implementable granularity\n   - Organize dependencies and order\n\n3. **Decide on undecided items**\n   - Make decisions on the above undecided items\n\n4. **Update Plans.md**\n   - Change `pm:awaiting-validation` → `cc:TODO`\n   - Add broken down tasks\n\n---\n\n### 📤 After Validation Complete\n\nOnce Plans.md update is complete, run `/handoff-to-claude` to\ngenerate the request for Claude Code.\n\n---\n```\n\n---\n\n### Step 4: Guide User to Next Action\n\n> ✅ **Generated validation request!**\n>\n> **Next steps**:\n>\n> 1. Copy & paste the above request to **Cursor**\n> 2. Run `/plan-with-cc` in Cursor (or review directly)\n> 3. Cursor updates Plans.md\n> 4. Cursor runs `/handoff-to-claude`\n> 5. Copy & paste the generated request to **Claude Code**\n>\n> **Waiting state**: Claude Code is waiting for handoff from Cursor.\n>\n> 💡 **Hint**: When validation in Cursor is complete, say \"validation is done\".\n\n---\n\n## Output Example\n\n### Example: After brainstorming task management app\n\n```\nUser: /cc-cursor-cc\n\nClaude Code:\n> 📝 Summarized the brainstorming content\n>\n> **Goal**: Notion-like task management app\n> **Technology choices**: Next.js + Supabase + TailwindCSS\n> **Decisions made**:\n> - Kanban view is required\n> - Tag feature is also needed\n> **Undecided items**:\n> - Is real-time sync needed?\n> **Concerns**:\n> - Drag & drop implementation might be complex\n\nUser: OK\n\nClaude Code:\n(Added provisional tasks to Plans.md)\n(Generated validation request for Cursor)\n\n> ✅ Generated validation request!\n> Next steps: Paste to Cursor...\n```\n\n---\n\n## Overall Flow Diagram\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│                      Claude Code                            │\n│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │\n│  │ Brainstorm  │ →  │/cc-cursor-cc│ →  │Gen Request  │     │\n│  └─────────────┘    └─────────────┘    └──────┬──────┘     │\n│                                               │ Copy-paste │\n└───────────────────────────────────────────────┼─────────────┘\n                                                ↓\n┌─────────────────────────────────────────────────────────────┐\n│                        Cursor (PM)                          │\n│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │\n│  │/plan-with-cc│ →  │Update       │ →  │/handoff-to- │     │\n│  │  validate   │    │Plans.md     │    │   claude    │     │\n│  └─────────────┘    └─────────────┘    └──────┬──────┘     │\n│                                               │ Copy-paste │\n└───────────────────────────────────────────────┼─────────────┘\n                                                ↓\n┌─────────────────────────────────────────────────────────────┐\n│                      Claude Code                            │\n│  ┌─────────────┐    ┌─────────────┐                        │\n│  │   /work     │ →  │ Implement   │                        │\n│  └─────────────┘    └─────────────┘                        │\n└─────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Related Commands\n\n| Command | Role | Agent |\n|---------|------|-------|\n| `/plan-with-agent` | Create plan in solo mode | Claude Code |\n| `/plan-with-cc` | Validate and break down plan | Cursor |\n| `/handoff-to-claude` | Generate request for Claude Code | Cursor |\n| `/handoff-to-cursor` | Completion report to Cursor | Claude Code |\n| `/work` | Task implementation | Claude Code |\n\n---\n\n## Notes\n\n- **2-agent operation only**: Use `/plan-with-agent` for solo mode\n- **Copy-paste required**: Currently, Claude Code and Cursor cannot directly connect, so manual copy-paste is required\n- **Plans.md sync**: Ensure both are referencing the same Plans.md\n",
        "commands/core/harness-init.md": "---\ndescription: Project setup (environment check → file generation → SSOT sync → validation)\ndescription-en: Project setup (environment check → file generation → SSOT sync → validation)\n---\n\n# /harness-init - Project Setup\n\nSets up a project so VibeCoder can start development with natural language only.\n**Completes with minimum 1 question**, ready to start development immediately.\n\n## VibeCoder Quick Reference\n\n- \"**Want to launch a new project fastest**\" → this command\n- \"**Leave it to you**\" \"**Quickly**\" → proceed with defaults, no questions\n- \"**With Next.js + Supabase**\" → technology specification is also possible\n- \"**Introduce harness to existing project**\" → analyze existing code and add workflow\n\n## Deliverables\n\n- Real project generation (e.g., create-next-app) + initial setup\n- Prepare `Plans.md` / `AGENTS.md` / `CLAUDE.md` / `.claude/` etc.\n- **Environment diagnosis** → **SSOT initialization** → **Final validation** all at once\n- → **Ready to run Plan→Work→Review immediately**\n\n---\n\n## 🚀 Optimized Flow\n\n**Before**: Up to 11 dialogue rounds\n**After**: Minimum 1, maximum 2 dialogue rounds\n\n```\nStep 1: Unified question (1 time)\n  ├─ What are you building?\n  ├─ Who will use it?\n  └─ Leave it to me or detailed settings?\n\nStep 2: Confirmation (skip if \"leave it to me\")\n  └─ Tech stack + project name\n\n→ Execute setup (includes background analysis)\n\nStep 3: Completion report\n```\n\n---\n\n## Execution Flow\n\n### Step 0: Argument Check and Fast Track Judgment\n\n**Determine by arguments or trigger words**:\n\n| Input | Action |\n|-------|--------|\n| `leave it to me` `quickly` `all defaults` | → Fast track (skip Step 1) |\n| `/harness-init blog --mode=solo` | → Parse arguments, skip specified items |\n| No arguments | → Go to Step 1 |\n\n**Fast track defaults**:\n- Language: ja\n- Mode: Solo (if no .cursor/), 2-Agent (if .cursor/ exists)\n- Tech: auto (next-supabase base)\n- Skills Gate: Auto-determine from project type\n\n### Step 1: Unified Question (Complete in 1 time)\n\n**Start project analysis in background** while showing questions:\n\n```bash\n# Background analysis (parallel execution)\nCODE_COUNT=$(find . -type f \\( -name \"*.ts\" -o -name \"*.tsx\" -o -name \"*.js\" -o -name \"*.py\" \\) \\\n  ! -path \"*/node_modules/*\" ! -path \"*/.venv/*\" 2>/dev/null | wc -l | tr -d ' ')\nHAS_CURSOR=$([ -d .cursor ] && echo \"true\" || echo \"false\")\nHAS_PACKAGE=$([ -f package.json ] && echo \"true\" || echo \"false\")\n```\n\n**Present 3 questions simultaneously with AskUserQuestion**:\n\n```json\n{\n  \"questions\": [\n    {\n      \"question\": \"What are you building? (Select 'Existing project' for existing projects)\",\n      \"header\": \"Project\",\n      \"options\": [\n        {\"label\": \"Web app (blog, EC, etc.)\", \"description\": \"Build with Next.js + Supabase\"},\n        {\"label\": \"API / Backend\", \"description\": \"Build with Express / FastAPI\"},\n        {\"label\": \"Introduce to existing project\", \"description\": \"Add workflow files only\"},\n        {\"label\": \"Other\", \"description\": \"Specify freely\"}\n      ],\n      \"multiSelect\": false\n    },\n    {\n      \"question\": \"Who will use it?\",\n      \"header\": \"Target Users\",\n      \"options\": [\n        {\"label\": \"Myself only\", \"description\": \"Personal project\"},\n        {\"label\": \"Team\", \"description\": \"Internal tools / collaborative development\"},\n        {\"label\": \"Public\", \"description\": \"Public service\"}\n      ],\n      \"multiSelect\": false\n    },\n    {\n      \"question\": \"Choose setup method\",\n      \"header\": \"Mode\",\n      \"options\": [\n        {\"label\": \"Leave it to me (Recommended)\", \"description\": \"Auto-configure with optimal defaults\"},\n        {\"label\": \"Detailed settings\", \"description\": \"Specify tech stack and project name\"}\n      ],\n      \"multiSelect\": false\n    }\n  ]\n}\n```\n\n**Wait for response** (only once)\n\n### Step 2: Additional Questions (Only for Detailed Settings)\n\n**Skip this step** when \"Leave it to me\" is selected.\n\nOnly when \"Detailed settings\" is selected:\n\n```json\n{\n  \"questions\": [\n    {\n      \"question\": \"Which tech stack?\",\n      \"header\": \"Tech\",\n      \"options\": [\n        {\"label\": \"Next.js + Supabase (Recommended)\", \"description\": \"Full-stack, free to start\"},\n        {\"label\": \"Next.js + FastAPI\", \"description\": \"More flexible backend\"},\n        {\"label\": \"Other\", \"description\": \"Specify Rails, Django, etc.\"}\n      ],\n      \"multiSelect\": false\n    },\n    {\n      \"question\": \"Enter project name\",\n      \"header\": \"Name\",\n      \"options\": [\n        {\"label\": \"Auto-generate\", \"description\": \"Generate in my-app-XXXXXX format\"},\n        {\"label\": \"Specify\", \"description\": \"Enter your preferred name\"}\n      ],\n      \"multiSelect\": false\n    }\n  ]\n}\n```\n\n**Wait for response**\n\n---\n\n## Smart Defaults\n\nTo reduce questions, use auto-determination or default values for the following:\n\n| Item | Default | Auto-determination Condition |\n|------|---------|----------------------------|\n| Language | ja | Can change in config file |\n| Mode | Solo | 2-Agent if .cursor/ exists |\n| Tech stack | next-supabase | In auto mode |\n| Skills Gate | Auto-configured | Adjust later with `/skills-update` |\n\n**Overridable in config** (`claude-code-harness.config.json`):\n```json\n{\n  \"i18n\": { \"language\": \"en\" },\n  \"scaffolding\": {\n    \"tech_choice_mode\": \"fixed\",\n    \"base_stack\": \"rails-postgres\"\n  }\n}\n```\n\n---\n\n## Phase 2: Project Analysis and Branching\n\n### Project Determination (3 values)\n\n```\nCombine Step 1 response + background analysis result\n\n\"Introduce to existing\" selected → project_type: \"existing\"\n\"Web app\" or \"API\" selected → directory analysis:\n  ├── Empty or .git only → project_type: \"new\"\n  ├── Code 10+ → project_type: \"existing\" (show warning)\n  └── Code 1-9 → project_type: \"ambiguous\"\n```\n\n**Ambiguous case confirmation** (only for ambiguous):\n\n> ⚠️ Files exist in directory ({{CODE_COUNT}} files)\n>\n> 🅰️ **Continue as new** (keep existing files while setting up)\n> 🅱️ **Treat as existing** (add workflow files only)\n\n---\n\n## Phase 3: Setup Execution\n\n### New Project (project_type: \"new\")\n\n1. **Project generation** (can parallelize with Task tool)\n   ```bash\n   npx create-next-app@latest {{PROJECT_NAME}} --typescript --tailwind --eslint --app --src-dir\n   cd {{PROJECT_NAME}}\n   npm install @supabase/supabase-js lucide-react\n   ```\n\n2. **Workflow file generation**\n   - AGENTS.md, CLAUDE.md, Plans.md\n   - .claude/settings.json (non-destructive merge)\n   - .claude/memory/ (decisions.md, patterns.md)\n\n3. **Quality protection rules deployment**\n   - .claude/rules/test-quality.md\n   - .claude/rules/implementation-quality.md\n\n### Existing Project (project_type: \"existing\")\n\n1. **Check existing files**\n   ```bash\n   [ -f AGENTS.md ] && echo \"AGENTS.md: exists\" || echo \"missing\"\n   [ -f CLAUDE.md ] && echo \"CLAUDE.md: exists\" || echo \"missing\"\n   [ -f Plans.md ] && echo \"Plans.md: exists\" || echo \"missing\"\n   ```\n\n2. **Add only missing files** (don't touch existing)\n\n3. **.claude/settings.json is non-destructive merge**\n\n---\n\n## Phase 4: Environment Diagnosis (Auto-execute)\n\n```bash\n# Git\ncommand -v git >/dev/null 2>&1 && echo \"✅ git\" || echo \"❌ git\"\n\n# Node.js (if applicable)\ncommand -v node >/dev/null 2>&1 && echo \"✅ node $(node -v)\" || echo \"⚠️ node\"\n\n# GitHub CLI (optional)\ncommand -v gh >/dev/null 2>&1 && echo \"✅ gh\" || echo \"⚠️ gh\"\n```\n\nShow warning if issues exist. **No questions** (information only).\n\n### Phase 4.5: Hooks Permission Check (Auto-execute)\n\n**Auto-fix execution permissions for shell scripts in `.claude/hooks/`**:\n\n```bash\n# Check and fix .claude/hooks/*.sh execution permissions\nif [ -d .claude/hooks ]; then\n  FIXED_COUNT=0\n  for script in .claude/hooks/*.sh; do\n    [ -f \"$script\" ] || continue\n    if [ ! -x \"$script\" ]; then\n      chmod +x \"$script\"\n      echo \"✅ Fixed permission: $script\"\n      FIXED_COUNT=$((FIXED_COUNT + 1))\n    fi\n  done\n  if [ \"$FIXED_COUNT\" -gt 0 ]; then\n    echo \"ℹ️ Fixed execution permissions for $FIXED_COUNT shell script(s)\"\n  fi\nfi\n```\n\n**Why this matters**: Shell scripts without execution permission (`chmod +x`) will fail to run as hooks, causing silent failures or errors.\n\n---\n\n## Phase 5: Completion Report (Detailed Summary)\n\nAfter work completion, **explicitly show auto-determined content** for transparency:\n\n> ✅ **Setup complete!**\n>\n> ---\n>\n> ### 📋 Auto-determined Settings\n>\n> | Item | Value | How to Change |\n> |------|-------|---------------|\n> | Language | **ja** | Change in `claude-code-harness.config.json` |\n> | Mode | **{{Solo / 2-Agent}}** | {{.cursor/ detection result}} |\n> | Tech stack | **{{next-supabase etc.}}** | Select \"Detailed settings\" when re-running |\n> | Skills Gate | **{{impl, review etc.}}** | Adjust with `/skills-update` |\n> | Project name | **{{my-app-XXXXXX}}** | Edit `package.json` |\n>\n> ---\n>\n> ### 📁 Generated Files\n>\n> **Workflow**:\n> | File | Purpose | Size |\n> |------|---------|------|\n> | `AGENTS.md` | Development flow overview | {{XX lines}} |\n> | `CLAUDE.md` | Claude Code settings | {{XX lines}} |\n> | `Plans.md` | Task management | {{XX lines}} |\n>\n> **Settings**:\n> | File | Purpose |\n> |------|---------|\n> | `.claude/settings.json` | Permission & safety settings |\n> | `.claude/memory/decisions.md` | Decision records |\n> | `.claude/memory/patterns.md` | Reusable patterns |\n>\n> **Quality protection rules**:\n> | File | Content |\n> |------|---------|\n> | `.claude/rules/test-quality.md` | Test tampering prohibition |\n> | `.claude/rules/implementation-quality.md` | Hollow implementation prohibition |\n>\n> {{If 2-Agent mode}}\n> **Cursor commands**:\n> | File | Purpose |\n> |------|---------|\n> | `.cursor/commands/start-session.md` | Start session |\n> | `.cursor/commands/plan-with-cc.md` | Create plan |\n> | `.cursor/commands/handoff-to-claude.md` | Task request |\n> | `.cursor/commands/review-cc-work.md` | Implementation review |\n>\n> ---\n>\n> ### ⚙️ To Change Later\n>\n> | What to Change | Command/Method |\n> |----------------|----------------|\n> | Add/remove Skills Gate skills | `/skills-update` |\n> | Switch to 2-Agent mode | `/harness-init --mode=2agent` (or say \"want to start 2-agent operation\") |\n> | Change tech stack | Manual file edit or recreate project |\n> | Change language setting | Edit `claude-code-harness.config.json` |\n>\n> ---\n>\n> ### 🚀 Next Steps\n>\n> - \"`/plan-with-agent` I want to create XXX\" → Create plan\n> - \"`/work`\" → Execute tasks in Plans.md\n> - \"`npm run dev`\" → Start dev server (if applicable)\n>\n> 💡 **If stuck** ask \"what should I do?\"\n\n---\n\n## Mode-specific Additional Settings\n\n### Solo Mode\n\nNo additional settings. Complete as is.\n\n### 2-Agent Mode (when .cursor/ detected)\n\nAutomatically add:\n- .cursor/commands/ (5 files)\n- .claude/rules/workflow.md\n\n> 💡 **How to use 2-Agent**:\n> 1. Consult with Cursor \"want to create XXX\"\n> 2. Request task to Claude Code with `/handoff-to-claude`\n> 3. Implement in Claude Code → Report with `/handoff-to-cursor`\n\n---\n\n## Argument Support\n\n```bash\n# Full specification (no questions)\n/harness-init \"blog\" --mode=solo --stack=next-supabase --name=my-blog\n\n# Partial specification (only ask for missing)\n/harness-init --stack=rails-postgres\n\n# Help\n/harness-init --help\n```\n\n| Argument | Description | Example |\n|----------|-------------|---------|\n| `[project description]` | What to build | `\"EC site\"` |\n| `--mode` | solo / 2agent | `--mode=solo` |\n| `--stack` | Tech stack | `--stack=next-supabase` |\n| `--name` | Project name | `--name=my-app` |\n| `--lang` | Language | `--lang=en` |\n\n---\n\n## VibeCoder Hints\n\nPhrases available anytime after setup:\n\n| What You Want | How to Say |\n|---------------|------------|\n| Continue | \"continue\" \"next\" |\n| Check operation | \"run it\" \"show me\" |\n| Add feature | \"add XXX\" |\n| Stuck | \"what should I do?\" |\n| Leave everything | \"do everything\" |\n\n---\n\n## Notes\n\n- **Minimum questions**: 1 for \"leave it to me\", 2 for \"detailed settings\"\n- **Tech choices are auto-suggested**: Recommend defaults so VibeCoder doesn't get confused\n- **Existing files are protected**: Non-destructive merge, no overwriting\n- **Skills Gate adjustable later**: Reduce initial burden\n",
        "commands/core/harness-review.md": "---\ndescription: Multi-perspective review (auto-detects: code, plan, scope based on context)\ndescription-en: Multi-perspective review (auto-detects: code, plan, scope based on context)\ncontext: fork\nhooks:\n  - event: PreCommandInvoke\n    type: command\n    command: \"${CLAUDE_PLUGIN_ROOT}/scripts/check-codex.sh\"\n    once: true\n---\n\n# /harness-review - Multi-Perspective Review\n\nReviews your work from multiple perspectives. **Auto-detects what to review based on context.**\n\n---\n\n## 🎯 Context-Aware Review\n\nThis command automatically detects what to review based on your recent activity:\n\n| Recent Activity | Review Type | 4 Perspectives |\n|-----------------|-------------|----------------|\n| After `/plan-with-agent` | Plan Review | Clarity, Feasibility, Dependencies, Acceptance |\n| After `/work` | Code Review | Security, Performance, Quality, Accessibility |\n| After adding tasks to Plans.md | Scope Review | Scope-creep, Priority, Feasibility, Impact |\n\n### Usage\n\n```bash\n/harness-review           # Auto-detect from context\n/harness-review code      # Force code review\n/harness-review plan      # Force plan review\n/harness-review scope     # Force scope analysis\n```\n\n---\n\n## 💡 VibeCoder Usage Guide\n\n**This command is designed so you can receive high-quality review without technical knowledge.**\n\n- ✅ Auto-detect what needs review\n- ✅ Multi-perspective analysis (4 experts)\n- ✅ Clear actionable feedback\n- ✅ Works for code, plans, and scope\n\n**Important for contract development**: You can submit review results as a report to reassure clients\n\n---\n\n## --ci Mode (Non-interactive)\n\nCI/benchmark mode:\n- AskUserQuestion: do not use\n- WebSearch: do not use\n- Proceed without confirmations\n\n---\n\n## 🔧 Auto-invoke Skills (Required)\n\n**This command must explicitly invoke the following skills with the Skill tool**:\n\n| Skill | Purpose | When to Call |\n|-------|---------|--------------|\n| `harness-review` | Review (parent skill) | At review start |\n| `codex-review` | Codex second opinion | When Codex is enabled (optional) |\n\n**How to call**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:harness-review\"\n```\n\n**Child skills (auto-routing)**:\n- `review-security` - Security review\n- `review-performance` - Performance review\n- `review-quality` - Code quality review\n- `review-accessibility` - Accessibility review\n- `review-aggregate` - Aggregate review results\n\n> ⚠️ **Important**: Proceeding without calling skills won't record in usage statistics. Always call with Skill tool.\n\n---\n\n## 🔧 LSP Feature Utilization\n\nReviews utilize LSP (Language Server Protocol) for more accurate analysis.\n\n### Code Quality Check with LSP Diagnostics\n\n```\n📊 LSP Diagnostic Results\n\nFile: src/components/UserForm.tsx\n\n| Line | Severity | Message |\n|------|----------|---------|\n| 15 | Error | Type 'string' cannot be assigned to type 'number' |\n| 23 | Warning | 'tempData' is declared but not used |\n| 42 | Info | This async function has no await |\n\n→ Auto-detect type errors and unused variables\n```\n\n### Impact Analysis with LSP Find-references\n\nAnalyze where changed code is used with LSP:\n\n```\n🔍 Change Impact Scope\n\nChanged: src/utils/formatDate.ts\n\nReference locations:\n├── src/components/DateDisplay.tsx:12\n├── src/components/EventCard.tsx:45\n├── src/pages/Dashboard.tsx:78\n└── tests/utils/formatDate.test.ts:5\n\n→ Impacts 4 files\n→ Confirmed covered by tests ✅\n```\n\n### Integration with Review Perspectives\n\n| Review Perspective | LSP Usage |\n|-------------------|-----------|\n| **Quality** | Detect type errors and unused code with Diagnostics |\n| **Security** | Track sensitive data flow with reference analysis |\n| **Performance** | Confirm heavy processing implementation with definition jump |\n\n### VibeCoder Phrases\n\n| What You Want | How to Say |\n|---------------|------------|\n| Check type errors | \"Review including LSP diagnostics\" |\n| Know change impact | \"Check where this change affects\" |\n\nDetails: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n\n---\n\n## 🔧 Code Intelligence Integration (Optional)\n\nWhen `/dev-tools-setup` has been run, review automatically uses AST-Grep for deeper analysis.\n\n### AST-Grep Code Smell Detection\n\nIf `harness_ast_search` MCP tool is available:\n\n```\n🔍 AST-Grep Code Smell Scan\n\nPatterns checked:\n- console.log($$$) → Debug logs\n- catch ($ERR) { } → Empty catch blocks\n- async function $NAME($$$) { $BODY_NO_AWAIT } → Unused async\n\nResults:\n├── 3x console.log found (src/api/*.ts)\n├── 1x empty catch block (src/utils/error.ts:45)\n└── 0x unused async\n```\n\n### LSP Diagnostics Integration\n\nIf LSP is configured:\n\n```\n📊 LSP Diagnostics Summary\n\nsrc/components/UserForm.tsx:\n├── Line 15: Type error - string vs number\n├── Line 23: Unused variable 'tempData'\n\nsrc/api/users.ts:\n└── Line 42: Missing return type annotation\n```\n\n### How to Enable\n\n```bash\n/dev-tools-setup  # One-time setup\n```\n\nAfter setup, code intelligence is automatically used in reviews.\n\n---\n\n## Purpose of This Command\n\n**Automates quality assurance for contract development**.\n\n- Ensure quality of code submitted to clients\n- Detect security risks in advance\n- Find performance issues early\n- Verify accessibility compliance\n\n---\n\n## Execution Flow\n\n### Step 0: Codex Second Opinion Check (auto-execute with once hook)\n\n**Automatically checks Codex availability with `once: true` hook on first execution.**\n\nHook defined in this command's frontmatter:\n```yaml\nhooks:\n  - event: PreCommandInvoke\n    type: command\n    command: \"${CLAUDE_PLUGIN_ROOT}/scripts/check-codex.sh\"\n    once: true\n```\n\n**Behavior**:\n- `check-codex.sh` runs only on first `/harness-review` execution in session\n- If Codex is installed, guides how to enable\n- Auto-skips on subsequent runs (`once: true` effect)\n\n**To enable Codex**:\n\nAdd the following to project config (`.claude-code-harness.config.yaml`):\n```yaml\nreview:\n  codex:\n    enabled: true\n```\n\n> 💡 **To run Codex review only manually**: Use `/codex-review` command\n\n---\n\n### Step 0.5: Remaining Context Check (Codex mode)\n\nBefore Codex parallel review, **run /compact first if remaining context is 30% or less**.\n\n> **Note**: Continue with Codex parallel review even if space is still tight after /compact.\n\n---\n\n### Step 1: Identify Changed Files\n\n```bash\n# Check recent changes\ngit diff --name-only HEAD~5 2>/dev/null || find . -name \"*.ts\" -o -name \"*.tsx\" -o -name \"*.py\" | head -20\n```\n\n### Step 2: Execute Parallel Reviews\n\nExecute parallel reviews from the following perspectives. Use **Task tool** to launch multiple subagents simultaneously and reduce review time.\n\n**💡 True parallel execution with async subagents**:\nRun each review individually and send to background with `Ctrl+B` for fully parallel execution. See [Async Subagents Guide](../docs/ASYNC_SUBAGENTS.md) for details.\n\n**Manual parallel execution steps**:\n1. Run `/harness-review security` → `Ctrl+B` to background\n2. Run `/harness-review performance` → `Ctrl+B` to background\n3. Run `/harness-review quality` → `Ctrl+B` to background\n4. Run `/harness-review accessibility` → `Ctrl+B` to background\n5. Auto-notification when each subagent completes\n\n**Mode-specific parallel execution:**\n\n#### Default Mode (`review.mode: default`) - Launch 4 parallel code-reviewers with Task tool\n\n```\n🔍 Starting parallel review...\n\nTask tool #1: subagent_type=\"code-reviewer\" → Security perspective\nTask tool #2: subagent_type=\"code-reviewer\" → Performance perspective\nTask tool #3: subagent_type=\"code-reviewer\" → Quality perspective\nTask tool #4: subagent_type=\"code-reviewer\" → Accessibility perspective\n\n→ 4 subagents execute in parallel\n→ Integrate results and output overall evaluation\n```\n\n#### Codex Mode (`review.mode: codex`) - MCP parallel execution with only needed experts\n\n**⚠️ Important: Do not combine multiple experts in one call**\n\n```\n🔍 Starting Codex parallel review...\n\n1. Determine which experts to call (only needed ones, not all):\n   - enabled: false in config → exclude\n   - CLI/backend → exclude Accessibility, SEO\n   - Document only changes → prioritize Quality, Architect, Plan Reviewer, Scope Analyst\n\n2. Load prompts individually from enabled experts' experts/*.md\n\n3. Execute mcp__codex__codex in parallel within 1 response for enabled experts only:\n   Example: Web frontend with code changes → 6 experts in parallel\n   mcp__codex__codex({prompt: security-expert.md})\n   mcp__codex__codex({prompt: accessibility-expert.md})\n   mcp__codex__codex({prompt: performance-expert.md})\n   mcp__codex__codex({prompt: quality-expert.md})\n   mcp__codex__codex({prompt: seo-expert.md})\n   mcp__codex__codex({prompt: architect-expert.md})\n\n→ Only needed experts execute in parallel (cost optimization)\n→ Integrate each expert's results for judgment\n```\n\n**Details**: `skills/codex-review/references/codex-parallel-review.md`\n\nReview perspectives:\n\n#### 🔒 Security Check\n\n- [ ] Proper environment variable management\n- [ ] Input validation\n- [ ] SQL injection protection\n- [ ] XSS protection\n- [ ] Authentication/authorization implementation\n\n#### ⚡ Performance Check\n\n- [ ] Unnecessary re-renders\n- [ ] N+1 queries\n- [ ] Heavy computation optimization\n- [ ] Image/asset optimization\n\n#### 📐 Code Quality Check\n\n- [ ] Proper TypeScript type usage\n- [ ] Error handling\n- [ ] Naming convention consistency\n- [ ] Appropriate file structure\n\n#### ♿ Accessibility Check (for Web)\n\n- [ ] Semantic HTML\n- [ ] Alt text\n- [ ] Keyboard navigation\n- [ ] Color contrast\n\n### Step 2.5: Result Integration and Codex Verification (when Codex enabled)\n\n**When `codex.enabled: true`, Claude verifies Codex review results and determines if fixes are needed.**\n\n```\n📊 Integrating review results...\n\n1. Aggregate Claude 4-perspective review results\n2. Get Codex review results\n3. Claude verifies Codex findings\n   - Is the finding valid?\n   - Is a fix needed?\n   - What's the priority?\n```\n\n**Result integration and verification**:\n\n```markdown\n## 📊 Review Result Comparison\n\n| Perspective | Claude | Codex | Match |\n|-------------|--------|-------|-------|\n| Security | 2 issues | 1 issue | 1 common |\n| Performance | 1 issue | 2 issues | 1 common |\n\n### 🔴 Both Flagged (High Priority - Fix Recommended)\n- Possible SQL injection (src/api/users.ts:45)\n  → **Claude verification**: Valid. Need to fix with parameterized queries\n\n### 🟡 Claude Only Flagged\n- Unused variable (src/utils/helpers.ts:12)\n  → **Fix recommended**: Delete or use\n\n### 🟢 Codex Only Flagged (Claude Verified)\n- Possible N+1 query (src/api/posts.ts:30)\n  → **Claude verification**: Valid. Should add prefetch\n```\n\n**Fix proposal and approval flow**:\n\n```markdown\n## 🔧 Items Requiring Fixes\n\nAdd the following fixes to Plans.md and execute with `/work`?\n\n| # | Fix Content | File | Priority |\n|---|-------------|------|----------|\n| 1 | SQL injection protection | src/api/users.ts:45 | High |\n| 2 | N+1 query fix | src/api/posts.ts:30 | Medium |\n| 3 | Delete unused variable | src/utils/helpers.ts:12 | Low |\n\n**Options:**\n1. Approve all → Add to Plans.md and run `/work`\n2. Approve selected → Specify numbers (e.g., 1,2)\n3. Don't fix now → Save report only\n```\n\n**Flow after approval**:\n\n```\nUser approval\n    ↓\nAdd fix tasks to Plans.md\n    ↓\nAuto-run /work (or suggest execution)\n    ↓\nRe-review after fix completion (optional)\n```\n\n> 💡 **To run Codex review only**: Use `/codex-review` command\n\n---\n\n### Step 3: Output Review Results\n\n> 📊 **Code Review Results**\n>\n> **Overall Rating**: {{A / B / C / D}}\n>\n> ---\n>\n> ### 🔒 Security: {{Rating}}\n> {{Issues or \"No issues\"}}\n>\n> ### ⚡ Performance: {{Rating}}\n> {{Issues or \"No issues\"}}\n>\n> ### 📐 Code Quality: {{Rating}}\n> {{Issues or \"No issues\"}}\n>\n> ### ♿ Accessibility: {{Rating}}\n> {{Issues or \"No issues\"}}\n>\n> ---\n>\n> ### 🔧 Improvement Suggestions\n>\n> 1. {{Specific improvement 1}}\n> 2. {{Specific improvement 2}}\n>\n> **Fix automatically?** (y / n / select)\n\n### Step 4: Execute Improvements (after user approval)\n\nAutomatically execute approved improvements:\n\n```bash\n# Example: ESLint auto-fix\nnpx eslint --fix src/\n\n# Example: Apply Prettier\nnpx prettier --write src/\n```\n\n### Step 5: Completion Report\n\n> ✅ **Review Complete**\n>\n> **Fixed items:**\n> - {{fix1}}\n> - {{fix2}}\n>\n> **Next steps:**\n> Say \"commit\" or \"proceed to next phase\".\n\n### Step 6: Commit Guard Integration (Require review before commit)\n\n**If review result is APPROVE, generate state file to allow commit.**\n\nThis feature blocks commit attempts without review.\n\n**Operation flow**:\n```\n/harness-review execution\n    ↓\nReview result is APPROVE\n    ↓\nGenerate .claude/state/review-approved.json\n    ↓\ngit commit is allowed\n    ↓\nClear review-approved.json after successful commit\n    ↓\nReview required again before next commit\n```\n\n**State file generation (auto-execute on APPROVE)**:\n\n```bash\n# If review result is APPROVE, execute:\nmkdir -p .claude/state\ncat > .claude/state/review-approved.json << 'EOF'\n{\n  \"judgment\": \"APPROVE\",\n  \"approved_at\": \"{{ISO 8601 timestamp}}\",\n  \"reviewed_files\": [\"{{changed_files}}\"],\n  \"review_summary\": \"{{summary}}\"\n}\nEOF\n```\n\n**To disable commit guard**:\n\nAdd to `.claude-code-harness.config.yaml`:\n```yaml\ncommit_guard: false\n```\n\n> 💡 **Note**: Disabling commit guard allows commits without review. Recommended to keep enabled for production projects.\n\n---\n\n## Review Perspective Details\n\n### Security\n\n```typescript\n// ❌ Bad example\nconst apiKey = \"sk-REDACTED\"  // Hardcoded (example)\n\n// ✅ Good example\nconst apiKey = process.env.API_KEY  // Environment variable\n```\n\n### Performance\n\n```typescript\n// ❌ Bad example\nconst Component = () => {\n  const data = heavyCalculation()  // Calculates every time\n  return <div>{data}</div>\n}\n\n// ✅ Good example\nconst Component = () => {\n  const data = useMemo(() => heavyCalculation(), [])\n  return <div>{data}</div>\n}\n```\n\n### Code Quality\n\n```typescript\n// ❌ Bad example\nfunction f(x: any) { return x.y.z }  // any type, no error handling\n\n// ✅ Good example\nfunction getNestedValue(obj: NestedObject): string | null {\n  return obj?.y?.z ?? null\n}\n```\n\n---\n\n## VibeCoder Simplified Version\n\nWhen technical details are not needed:\n\n> 📊 **Check Results**\n>\n> - Security: ✅ OK\n> - Speed: ✅ OK\n> - Code quality: ⚠️ 2 improvements\n>\n> Say \"fix it\" to auto-fix.\n\n---\n\n## Options\n\n```\n/harness-review              # Check all\n/harness-review security     # Security only\n/harness-review performance  # Performance only\n/harness-review quick        # Quick check\n```\n\n---\n\n## ⚡ Parallel Execution Decision Points\n\nReview perspectives (Security/Performance/Quality/Accessibility/Codex) are **independent of each other**, so parallel execution is effective.\n\n### When to Execute in Parallel ✅\n\n| Condition | Reason |\n|-----------|--------|\n| Full review (all 4 perspectives) | Maximum time savings |\n| Codex enabled (5 perspectives) | Codex also runs in parallel |\n| 5+ changed files | Each perspective takes longer |\n| Need results quickly | Before PR merge, etc. |\n\n**Parallel execution effect (Codex enabled)**:\n```\n🚀 Starting parallel review...\n├── [Security] Analyzing... ⏳\n├── [Performance] Analyzing... ⏳\n├── [Quality] Analyzing... ⏳\n├── [Accessibility] Analyzing... ⏳\n└── [Codex] Getting second opinion... ⏳\n\n⏱️ Time: 35s (would be +30s if sequential Codex)\n```\n\n### When to Execute Sequentially ⚠️\n\n| Condition | Reason |\n|-----------|--------|\n| Single perspective only (`/harness-review security`) | No parallelization needed |\n| 1-2 changed files | Each perspective is quick |\n| Want to check issues one by one | Progress interactively |\n\n### Auto-decision Logic\n\n```\nReview perspectives >= 3 AND changed files >= 5 → Parallel execution (Task tool)\nReview perspectives < 3 OR changed files < 5 → Sequential execution\n```\n\n### Manual Parallel Execution\n\n```bash\n# Execute in parallel in background\n/harness-review security     # → Ctrl+B to background\n/harness-review performance  # → Ctrl+B to background\n/harness-review quality      # → Ctrl+B to background\n/harness-review accessibility # Last one waits\n\n# Integrate results and report\n```\n",
        "commands/core/plan-with-agent.md": "---\ndescription: Create implementation plan (idea → Plans.md → ready for /work)\ndescription-en: Create implementation plan (idea → Plans.md → ready for /work)\n---\n\n# /plan-with-agent - Create Implementation Plan\n\nOrganizes ideas and requirements, and converts them into executable tasks in Plans.md.\nAfter completion, you can immediately start work with `/work`.\n\n## Quick Reference\n\n- \"**Create a plan**\" → this command\n- \"**Turn what we talked about into a plan**\" → extract requirements from conversation and create plan\n- \"**Want to organize what to build**\" → start with hearing and create plan\n- \"**List out features**\" → feature list → priority → Plans.md\n- \"**Plan with TDD**\" → force TDD adoption, prioritize test case design\n- \"**Start with test design**\" → design test cases for each feature first\n- \"**CI/benchmark**\" → `/plan-with-agent --ci`\n\n## Deliverables\n\n- **Plans.md** - Task list executable with `/work` (required)\n- **Feature priority matrix** - Classification into required/recommended/optional\n\n---\n\n## --ci Mode (Non-interactive)\n\nCI/benchmark mode:\n- AskUserQuestion: do not use\n- WebSearch: do not use\n- Fill missing info with explicit assumptions\n- Proceed end-to-end without confirmations\n\n---\n\n## ⚠️ Mode-specific Usage\n\n| Mode | Recommended Command | Description |\n|------|---------------------|-------------|\n| **Solo mode** | `/plan-with-agent` (this command) | Claude Code alone: plan → execute → review |\n| **2-agent mode** | `/plan-with-cc` (Cursor side) | Plan with Cursor → Execute with Claude Code |\n\n---\n\n## 🔧 Required Skills (Call First)\n\n> ⛔ **When executing this command, you must call the Skill tool first**\n>\n> Proceeding without calling the Skill tool is prohibited.\n\n**Required skills to call**:\n\n| Skill | Fully Qualified Name | When to Call |\n|-------|---------------------|--------------|\n| `setup` | `claude-code-harness:setup` | **Call first** (executes adaptive setup) |\n| `vibecoder-guide` | `claude-code-harness:vibecoder-guide` | When user is non-technical |\n\n**How to call (required)**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:setup\"\n```\n\n**Why Skill call is required**:\n1. Recorded in usage statistics (quality tracking)\n2. Guardrails in skill are applied\n3. Accurate grasp of project state\n\n> ❌ **Prohibited**: Reading command document and proceeding directly to execution flow\n> ✅ **Correct**: Call `setup` with Skill tool first, then proceed\n\n---\n\n## Execution Flow\n\n### Step 0: Check Conversation Context (Execute after Skill call)\n\n**Confirm with AskUserQuestion tool**:\n\n> 📝 **Choose how to create the plan**\n>\n> 1. **Based on previous conversation** - Create plan from brainstormed content\n> 2. **Start fresh** - Create plan from scratch with hearing\n\n**If \"Based on previous conversation\" is selected**:\n- Extract requirements, ideas, and decisions from recent conversation\n- Confirm extracted content with user\n- After confirmation, skip to Step 3 (technical research)\n\n**If \"Start fresh\" is selected**:\n- Start hearing from Step 1\n\n---\n\n### Step 1: Hearing What You Want to Build\n\nCheck user input. If no input, ask:\n\n> 🎯 **What do you want to build?**\n>\n> Examples:\n> - \"Reservation management system\"\n> - \"Blog site\"\n> - \"Task management app\"\n> - \"API server\"\n>\n> Rough ideas are fine!\n\n**Wait for response**\n\n### Step 2: Increase Resolution (Max 3 questions)\n\n> 📋 **Tell me a bit more:**\n>\n> 1. **Who will use it?** (yourself only? team? public?)\n> 2. **Any similar services?** (references)\n> 3. **How far do you want to build?** (MVP? full features?)\n\n**Wait for response**\n\n### Step 3: Technical Research (WebSearch)\n\n**Don't ask the user. Claude Code researches and suggests.**\n\n```\nWebSearch for:\n- \"{{project type}} tech stack 2025\"\n- \"{{similar service}} architecture\"\n```\n\n### Step 4: Extract Feature List\n\nExtract concrete feature list from requirements.\n\n**Example**: For \"Reservation management system\"\n- User registration/login\n- Reservation calendar display\n- Create/edit/cancel reservations\n- Admin dashboard\n- Email notifications\n- Payment feature\n- Review feature\n\n### Step 5: Create Feature Priority Matrix\n\nClassify each feature into these 3 categories:\n\n| Priority | Description | Criteria |\n|----------|-------------|----------|\n| **Required** | Needed for MVP (minimum viable product) | Won't work without this |\n| **Recommended** | Greatly improves user experience | Nice to have, but works without |\n| **Optional** | Consider for future addition | If there's time |\n\n**Example**: For reservation management system\n\n| Feature | Priority | Reason |\n|---------|----------|--------|\n| User registration/login | Required | Need authentication for reservations |\n| Reservation calendar display | Required | Core feature |\n| Create/edit/cancel reservations | Required | Core feature |\n| Admin dashboard | Recommended | Improves operational efficiency |\n| Email notifications | Recommended | Improves user experience |\n| Payment feature | Optional | Can add later |\n| Review feature | Optional | Can add later |\n\n---\n\n### Step 5.5: TDD Adoption Judgment and Strict Test Design (Important)\n\n**Purpose**: Strict TDD = accurately understanding user intent. Tests are \"specification documentation\", agreeing before implementation.\n\n#### TDD Adoption Judgment\n\n**Adopt TDD if any of the following conditions apply**:\n\n| Judgment Condition | Reason |\n|-------------------|--------|\n| Contains business logic | Calculation, judgment, state transition require specification documentation |\n| Has data transformation/processing | Many boundary conditions in input→output conversion |\n| Has external API integration | Clarify specifications through mock design |\n| Has multiple branches/conditions | Need to identify edge cases |\n| Involves money/auth/permissions | No room for error (security + TDD) |\n| User's words are vague | Align understanding through test cases |\n\n**Record judgment result**:\n```\nFeature \"{{feature name}}\" → TDD adoption reason: {{matching condition}}\n```\n\n#### Deep Intent Questions (Confirm with AskUserQuestion tool)\n\nFor features with TDD adoption decision, **always ask the following**:\n\n> 🎯 **Let me confirm about \"{{feature name}}\" before writing tests**\n>\n> 1. **Normal case**: What's the most common usage? (specific scenario)\n> 2. **Boundary conditions**: Where's the line between \"barely OK\" and \"barely NG\"?\n> 3. **On error**: How do you want to show errors to users?\n> 4. **Implicit expectations**: What do you consider \"obvious\"? (unspoken rules)\n\n**Additional questions to draw out tacit knowledge** (as needed):\n\n| Situation | Additional Question |\n|-----------|---------------------|\n| Handling numbers | \"Allow 0 or negative?\" \"Decimal places?\" |\n| Handling dates | \"Timezone?\" \"Allow past dates?\" |\n| Handling strings | \"Empty string?\" \"Max length?\" \"Emojis?\" |\n| Handling lists | \"Empty list?\" \"Upper limit?\" \"Duplicates?\" |\n| State transitions | \"Can go back?\" \"Cancel midway?\" \"Timeout?\" |\n| User operations | \"What if spammed?\" \"What if they leave midway?\" |\n\n#### Test Case Design (Include in Plans.md)\n\n**TDD-adopted features include test design before implementation tasks**:\n\n```markdown\n### {{Feature Name}} `[feature:tdd]`\n\n#### Test Case Design (Agree before implementation)\n\n| Test Case | Input | Expected Output | Notes |\n|-----------|-------|-----------------|-------|\n| Normal: basic | {{example}} | {{expected}} | Most common case |\n| Normal: boundary lower | {{barely OK}} | {{success}} | Lower limit test |\n| Normal: boundary upper | {{barely OK}} | {{success}} | Upper limit test |\n| Error: boundary exceeded | {{barely NG}} | {{error}} | Validation check |\n| Error: null/empty | null, \"\", [] | {{error}} | Defensive programming |\n| Edge case | {{special case}} | {{expected behavior}} | Tacit knowledge documentation |\n\n#### Implementation Tasks\n- [ ] Create test file (implement above cases)\n- [ ] Create implementation code (until tests pass)\n- [ ] Refactor (while maintaining tests)\n```\n\n#### When TDD Not Adopted\n\nSimple features not matching TDD judgment conditions (static UI, config file generation, etc.) proceed with normal implementation flow. However, if user requests \"also write tests\", adopt TDD.\n\n---\n\n### Step 6: Effort Estimation (Reference)\n\nCalculate implementation effort for each feature as reference.\n\n**Estimation standards** (with Claude Code):\n\n| Feature Type | Effort (person-days) |\n|--------------|---------------------|\n| Auth (using Clerk) | 0.5-1 |\n| CRUD (1 table) | 1-2 |\n| Admin panel (basic) | 2-3 |\n| Payment (using Stripe) | 2-3 |\n| Email notifications | 1-2 |\n| CI/CD setup | 1 |\n| Deploy setup | 0.5 |\n\n### Step 7: Generate Plans.md (Auto-assign Quality Judgment Markers)\n\nGenerate `Plans.md` for implementation.\n\n**Auto-assign quality judgment markers**:\n\nAnalyze each task's content and auto-assign appropriate quality markers:\n\n| Task Content | Marker | Effect |\n|--------------|--------|--------|\n| Auth/login feature | `[feature:security]` | Show security checklist |\n| UI component | `[feature:a11y]` | Recommend a11y check |\n| Business logic | `[feature:tdd]` | Recommend TDD |\n| API endpoint | `[feature:security]` | Input validation check |\n| Bug fix | `[bugfix:reproduce-first]` | Recommend reproduction test first |\n\n```markdown\n## 🎯 Project: {{Project Name}}\n\n### Overview\n- **Purpose**: {{what you want to do}}\n- **Target**: {{who will use it}}\n- **Reference**: {{similar service}}\n- **Scope**: {{MVP or full features}}\n\n### Tech Stack\n- Frontend: {{tech}}\n- Backend: {{tech}}\n- Database: {{tech}}\n- Deploy: {{tech}}\n\n---\n\n## 🔴 Phase 1: Foundation Setup `cc:TODO`\n\n- [ ] Project initialization\n- [ ] Basic setup (linter, formatter)\n- [ ] Database design\n- [ ] Environment variable setup\n- [ ] Git init & initial commit\n\n## 🟡 Phase 2: Core Features (Required) `cc:TODO`\n\n### {{Required Feature 1}} `[feature:tdd]`\n\n#### Test Case Design (Agreed before implementation)\n| Test Case | Input | Expected Output | Notes |\n|-----------|-------|-----------------|-------|\n| Normal: basic | {{example}} | {{expected}} | From user hearing |\n| Boundary | {{boundary value}} | {{expected behavior}} | Confirmed in Step 5.5 |\n| Error | {{error input}} | {{error}} | Tacit knowledge documentation |\n\n#### Implementation Tasks\n- [ ] Create test file\n- [ ] Create implementation code\n- [ ] Refactor\n\n### {{Required Feature 2}} `[feature:tdd]`\n(Same test case design)\n\n### {{Auth Feature}} `[feature:security]`\n\n## 🟢 Phase 3: Recommended Features `cc:TODO`\n\n- [ ] {{UI feature}} `[feature:a11y]`\n- [ ] {{recommended feature}}\n\n## 🔵 Phase 4: Finishing `cc:TODO`\n\n- [ ] Review (`/harness-review`)\n- [ ] Deploy setup\n- [ ] Operation check\n```\n\n**Marker judgment logic**:\n\n```\nAnalyze task content\n    ↓\n├── \"auth\" \"login\" \"API\" → [feature:security] + go to TDD judgment\n├── \"component\" \"UI\" \"screen\" → [feature:a11y]\n├── \"fix\" \"bug\" → [bugfix:reproduce-first]\n├── \"service\" \"logic\" \"core\" → [feature:tdd] + go to Step 5.5\n├── \"calculation\" \"transform\" \"validation\" → [feature:tdd] + go to Step 5.5\n├── \"payment\" \"amount\" \"billing\" → [feature:security] + [feature:tdd] + go to Step 5.5\n└── Other → no marker\n```\n\n**Important**: Features with `[feature:tdd]` marker must go through TDD adoption judgment flow in Step 5.5, including deep intent questions to user and test case design.\n\n### Step 8: Guide Next Actions\n\n> ✅ **Plan complete!**\n>\n> 📄 **Generated files**:\n> - `Plans.md` - Implementation task list\n>\n> **Next steps:**\n> - Start implementation with \"`/work`\"\n> - Or say \"start from Phase 1\"\n>\n> 💡 **Hint**: To adjust the plan, say \"add {{feature}}\" or \"postpone {{feature}}\".\n\n---\n\n## Output Examples\n\n### Example 1: Plan from Brainstorming\n\n```\nUser: (Was brainstorming \"want to make a task management app, like Notion\")\nUser: /plan-with-agent\n\nClaude Code:\n> 📝 Choose how to create the plan\n> 1. Based on previous conversation\n> 2. Start fresh\n\nUser: 1\n\nClaude Code:\n> Extracted the following from conversation:\n> - What to build: Task management app\n> - Reference: Notion\n> - Feature candidates: Task CRUD, kanban view, tag feature\n>\n> Proceed with this plan?\n\nUser: OK\n\n→ Generate Plans.md\n```\n\n### Example 2: Plan from Scratch\n\n```\nUser: /plan-with-agent\n\nClaude Code:\n> 📝 Choose how to create the plan\n\nUser: Start fresh\n\nClaude Code:\n> 🎯 What do you want to build?\n\nUser: Blog site\n\n(Continue hearing)\n→ Generate Plans.md\n```\n\n---\n\n## Notes\n\n- **Plans.md is the priority**: Purpose is to get to a state executable with `/work`\n- **Flexibly adjustable**: Can change with \"add XXX\" or \"remove XXX\" after planning\n- **Use brainstorming context**: Select \"Based on conversation\" in Step 0 to reflect discussed content\n",
        "commands/core/skill-list.md": "---\ndescription: Show available skills with descriptions\ndescription-en: Show available skills with descriptions\n---\n\n# /skill-list - Skill List\n\nDisplays available skills. Skills are automatically invoked during conversation, so explicit command execution is not required.\n\n> **Claude Code 2.1.0+**: Skills support hot reload. Additions and changes are reflected immediately (no restart needed).\n\n---\n\n## Usage\n\n```\n/skill-list\n```\n\nOr in natural language:\n- \"Show available skills\"\n- \"Skill list\"\n- \"What can you do?\"\n\n---\n\n## Skill List\n\nOutput the skill list in the following format at execution.\n\n### Output Format\n\n```markdown\n## Available Skills\n\n### Core (Core Features)\n\n| Skill | Description | Trigger Example |\n|-------|-------------|-----------------|\n| session-init | Environment check at session start | \"start work\" \"check status\" |\n| plans-management | Plans.md management | \"add a task\" |\n| session-memory | Memory management between sessions | auto |\n| parallel-workflows | Parallel execution of multiple tasks | \"execute in parallel\" |\n| troubleshoot | Problem diagnosis and resolution | \"investigate the error\" |\n\n### Optional (Extensions)\n\n| Skill | Description | Trigger Example |\n|-------|-------------|-----------------|\n| analytics | Analytics integration (GA/Vercel) | \"add analytics\" |\n| auth | Authentication (Clerk/Supabase) | \"add login feature\" |\n| auto-fix | Auto-fix review issues | \"auto-fix the issues\" |\n| component | UI component generation | \"create a hero section\" |\n| deploy-setup | Deploy setup (Vercel/Netlify) | \"make it deployable\" |\n| feedback | Feedback feature | \"add a feedback form\" |\n| health-check | Environment diagnosis | \"check the environment\" |\n| notebooklm-yaml | NotebookLM YAML generation | \"create slide design YAML\" |\n| payments | Payment feature (Stripe) | \"want to add payments\" |\n| setup-cursor | Cursor integration setup | \"want to start 2-agent operation\" |\n\n---\n\n💡 **Usage**: Skills are automatically invoked during conversation.\nJust speak like the \"Trigger Example\" above.\n```\n\n---\n\n## Execution Steps\n\n1. Scan `skills/` directory\n2. Extract `name` and `description` from each skill's `SKILL.md`\n3. Organize by category (core / optional)\n4. Output in above format\n\n---\n\n## Implementation (Instructions for LLM)\n\nGet skill information with the following commands:\n\n```bash\n# List skill directories\nfind \"${CLAUDE_PLUGIN_ROOT}/skills\" -name \"SKILL.md\" -type f\n\n# Extract name and description from each skill\nfor f in $(find \"${CLAUDE_PLUGIN_ROOT}/skills\" -name \"SKILL.md\"); do\n  echo \"=== $f ===\"\n  grep -E \"^name:|^description:\" \"$f\" | head -2\ndone\n```\n\nFormat the obtained information into the above format and output.\n",
        "commands/core/sync-status.md": "---\ndescription: Check progress → update Plans.md → suggest next action\ndescription-en: Check progress → update Plans.md → suggest next action\n---\n\n# /sync-status - Status Check, Plans.md Sync, Next Action Suggestion\n\n**Checks current implementation status, detects and updates differences with Plans.md, then suggests what to do next.**\n\nRun this at work milestones or when you think \"where am I at?\"\n\n## VibeCoder Quick Reference\n\n- \"**How far have we progressed?**\" → this command\n- \"**What should I do next?**\" → organize status and suggest next action\n- \"**Check if Plans.md matches actual progress**\" → detect differences and update\n\n## Deliverables\n\n1. **Progress check**: Check consistency between implementation status and Plans.md\n2. **Difference update**: Update Plans.md markers to match reality\n3. **Next action suggestion**: Present what to do next considering priority\n\n---\n\n## Execution Flow\n\n### Step 1: Gather Current Status\n\n```bash\n# Current task state in Plans.md\ncat Plans.md\n\n# Git change status (what actually changed)\ngit status\ngit diff --stat HEAD~3  # Changes in last 3 commits\n\n# Recent commit history\ngit log --oneline -10\n```\n\n### Step 2: Detect Differences Between Implementation and Plans.md\n\nCheck the following:\n\n| Check Item | Detection Method |\n|------------|------------------|\n| Done but still `cc:WIP` | Commit history vs marker |\n| Started but still `cc:TODO` | Changed files vs marker |\n| Implemented task not in Plans.md | Commit messages vs task list |\n| `cc:done` but not committed | git status vs marker |\n\n### Step 3: Update Plans.md (if differences exist)\n\nIf differences detected, suggest and execute updates:\n\n> 📝 **Plans.md update needed**\n>\n> | Task | Current | After Update | Reason |\n> |------|---------|--------------|--------|\n> | Implement XX | `cc:WIP` | `cc:done` | Committed |\n> | Add YY | `cc:TODO` | `cc:WIP` | Files being changed |\n>\n> **Update?** (yes / no)\n\nIf \"yes\", update Plans.md.\n\n### Step 4: Output Progress Summary\n\n```markdown\n## 📊 Progress Summary\n\n**Updated**: {{YYYY-MM-DD HH:MM}}\n**Branch**: {{current branch}}\n\n---\n\n### Task Status\n\n| Status | Count |\n|--------|-------|\n| 🔴 Not started (`cc:TODO`) | {{count}} |\n| 🟡 In progress (`cc:WIP`) | {{count}} |\n| 🟢 Done (`cc:done`) | {{count}} |\n| ✅ Verified (`pm:verified`) | {{count}} |\n| ⏳ Requested (`pm:requested`) | {{count}} |\n| 🚫 Blocked (`blocked`) | {{count}} |\n\n**Progress rate**: {{done + verified}} / {{total tasks}} ({{percent}}%)\n\n### Context Usage\n\n> 💡 **Check via status line (Claude Code v2.1.6+)**:\n> - `context_window.used_percentage`: Usage rate\n> - `context_window.remaining_percentage`: Remaining\n\n**Warning thresholds**:\n- 🟢 0-50%: Plenty of room\n- 🟡 50-70%: Caution\n- 🔴 70%+: Recommend ending session\n```\n\n### Step 5: Suggest Next Action\n\nSuggest optimal next action based on status:\n\n> 🎯 **What to do next**\n>\n> **Priority 1**: {{highest priority task}}\n> - Reason: {{requested / unblock / dependency, etc.}}\n>\n> **Priority 2**: {{next task}}\n>\n> ---\n>\n> **Recommended commands**:\n> - `/work` - Start next task\n> - `/handoff-to-pm-claude` - Report completion to PM (if tasks are done)\n> - `/harness-review` - Request review (if at a milestone)\n>\n> ⚠️ Context usage is high. Consider ending session and starting new.\n> (Shown when context usage is 70%+)\n\n---\n\n## Anomaly Detection\n\nWarn when the following situations are detected:\n\n| Situation | Warning |\n|-----------|---------|\n| Multiple `cc:WIP` exist | ⚠️ Working on multiple tasks simultaneously |\n| `blocked` left for long time | ⚠️ Prioritize unblocking |\n| `pm:requested` not processed | ⚠️ Process PM's request first |\n| Large gap between Plans.md and implementation | ⚠️ Task management not keeping up |\n\n---\n\n## Notes\n\n- **Confirm before update**: Show differences and ask for confirmation before updating Plans.md\n- **Reference commit history**: Judge actual work content from commit history\n- **Be specific about next action**: Clearly present \"what to do\"\n\n---\n\n## ⚡ Parallel Execution Decision Points\n\n**Information gathering phase** benefits from parallel execution in this command.\n\n### When to Execute in Parallel ✅\n\n| Process | Parallelize |\n|---------|-------------|\n| Read Plans.md | ✅ Independent |\n| Check git status | ✅ Independent |\n| Check git log | ✅ Independent |\n| Check git diff | ✅ Independent |\n\n**Parallel execution effect**:\n```\n🚀 Starting information gathering...\n├── [Plans.md] Reading... ⏳\n├── [git status] Checking... ⏳\n├── [git log] Getting... ⏳\n└── [git diff] Analyzing... ⏳\n\n→ Get 4 pieces of info simultaneously → time saved\n```\n\n### Sequential Processing\n\nThe following run sequentially due to dependencies:\n\n```\nInformation gathering (parallel) → Difference detection (sequential) → Update proposal (sequential) → Next action (sequential)\n```\n\n### Auto-optimization\n\nThis command is **automatically optimized**:\n- Information gathering: Parallel execution\n- Analysis/update: Sequential execution (due to dependencies)\n",
        "commands/core/work.md": "---\ndescription: Execute Plans.md tasks (Solo/2-Agent, parallel execution enabled)\ndescription-en: Execute Plans.md tasks (Solo/2-Agent, parallel execution enabled)\n---\n\n# /work - Execute Plan\n\nExecutes the plan in Plans.md and generates actual code.\n**Actively utilizes parallel execution** to efficiently complete tasks.\n\n## VibeCoder Quick Reference\n\n- \"**Progress tasks in Plans.md**\" → this command\n- \"**Build to where it works first**\" → get to minimum working state first\n- \"**Do everything at once**\" → automatic parallel execution\n- \"**Want to resume from where I left off**\" → resume from in-progress (cc:WIP) or requested (pm:requested)\n- \"**Resume session**\" → `--resume <id|latest>` (restore history session)\n- \"**Fork session**\" → `--fork <id|current> --reason \"<text>\"`\n\n## Deliverables\n\n- Implement Plans.md tasks **efficiently with smart parallel execution**\n- When stuck, isolate cause → fix → re-verify loop\n- **2-Agent mode**: Prioritize processing pm:requested tasks\n- **Review loop**: implement → harness-review → fix until OK → auto-commit\n\n---\n\n## 🚀 Default Behavior\n\n`/work` runs implement → review → fix → commit by default:\n\n```bash\n/work                    # Implement → Review → Fix → Commit (default)\n/work --no-commit        # Skip auto-commit (manual commit)\n/work --parallel 5       # Force 5 parallel workers\n/work --sequential       # Force sequential (no parallel)\n```\n\n### Project-level Configuration\n\nOverride default via `.claude-code-harness.config.yaml`:\n\n```yaml\nwork:\n  auto_commit: false  # Disable auto-commit for this project\n  commit_on_pm_approve: true  # 2-Agent: defer commit until PM approves\n```\n\n### Smart Parallel Detection\n\n| Condition | Parallel Count |\n|-----------|:--------------:|\n| 1 task | 1 |\n| All tasks edit same file | 1 |\n| 2-3 independent tasks | 2-3 |\n| 4+ independent tasks | 3 (max) |\n\n---\n\n## Options\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--ci` | CI-only non-interactive mode | false |\n| `--parallel N` | Force parallel count | auto |\n| `--sequential` | Force no parallel | - |\n| `--isolation` | lock / worktree | worktree |\n| `--max-iterations` | Review fix loop limit | 3 |\n| `--skip-review` | Skip review phase | false |\n| `--no-commit` | Skip auto-commit (manual commit) | false |\n| `--resume <id|latest>` | Resume session | - |\n| `--fork <id|current>` | Fork session | - |\n| `--reason \"<text>\"` | Fork reason (with --fork) | - |\n\n### --ci Mode\n\nCI-only non-interactive execution:\n- AskUserQuestion: do not use\n- WebSearch: do not use\n- Confirmation prompts: do not wait\n- Continue to completion automatically\n\n### --isolation Option\n\n| Value | Behavior | Recommended |\n|-------|----------|-------------|\n| `lock` | Same worktree + file lock | Small-medium tasks |\n| `worktree` | git worktree isolation + pnpm space saving | Large tasks, true parallel builds |\n\n### Session Resume/Fork\n\n**セッション一覧の確認**:\n```bash\n# CLI: アーカイブディレクトリを確認\nls -la .claude/state/sessions/\n\n# UI: harness-ui のWorkページでセッション一覧を確認\n# → Session Archives テーブルから resume/fork コマンドをコピー可能\n```\n\n**再開/分岐コマンド**:\n```bash\n# Resume latest stopped session\n/work --resume latest\n\n# Resume specific session ID\n/work --resume session-1700000000\n\n# Fork from current session\n/work --fork current --reason \"Proceed with trial version separately\"\n\n# Fork from specific session\n/work --fork session-1700000000 --reason \"Try different approach\"\n```\n\n**Check session state**:\n```bash\n# Current session state\ncat .claude/state/session.json | jq '.state, .session_id'\n\n# Event history\ntail -20 .claude/state/session.events.jsonl\n```\n\n### Default Flow\n\n**Review→Fix ループは Solo/2-Agent 共通**。Handoff は 2-Agent モードのみ実行。\n\n```\n/work --parallel 3\n    ↓\n┌─────────────────────────────────────────────────────────┐\n│ Phase 1: Parallel Implementation                        │\n├─────────────────────────────────────────────────────────┤\n│  [task-worker A] Implement → Related-check              │\n│  [task-worker B] Implement → Related-check              │\n│  [task-worker C] Implement → Related-check              │\n│                                                         │\n│  ※Related-check: Verify no missed file updates         │\n│  Each worker completes implementation                   │\n└─────────────────────────────────────────────────────────┘\n    ↓ Wait for all implementations complete\n┌─────────────────────────────────────────────────────────┐\n│ Phase 2: Review Loop (harness-review)  [Solo/2-Agent]   │\n├─────────────────────────────────────────────────────────┤\n│  Execute harness-review (context-aware)                 │\n│    ├── Codex available: 4-parallel expert review       │\n│    └── Otherwise: standard review                       │\n│                                                         │\n│  ※NG (Critical/High issues) → Fix → Re-review          │\n│  ※Loop continues until OK (max --max-iterations)       │\n└─────────────────────────────────────────────────────────┘\n    ↓ Review OK (APPROVE: no Critical/High issues)\n┌─────────────────────────────────────────────────────────┐\n│ Phase 3: Auto-commit (default)         [Solo/2-Agent]   │\n├─────────────────────────────────────────────────────────┤\n│  ✅ All tasks implemented and reviewed                  │\n│  📝 Auto-commit with generated message                  │\n│                                                         │\n│  Skip with: --no-commit or config auto_commit: false    │\n│                                                         │\n│  ⏸️ commit_on_pm_approve: true (2-Agent only):           │\n│    → Skip commit, mark as \"pending_pm_approval\"         │\n│    → Handoff includes commit instruction for PM         │\n└─────────────────────────────────────────────────────────┘\n    ↓ Commit complete (or skipped / deferred)\n┌─────────────────────────────────────────────────────────┐\n│ Phase 4: Handoff (2-Agent only)                         │\n├─────────────────────────────────────────────────────────┤\n│  2-Agent mode (pm:requested detected):                  │\n│    → Execute `/handoff-to-cursor` to report to PM       │\n│    → If commit_on_pm_approve: include commit-pending    │\n│      flag in handoff report                             │\n│                                                         │\n│  Solo mode:                                             │\n│    → Skip (no handoff needed)                           │\n└─────────────────────────────────────────────────────────┘\n```\n\n### Escalation\n\nWhen task-worker can't resolve after 3 fixes, aggregate to parent and bulk confirm with user.\n\n```\n⚠️ Escalation (2 items)\n\nTask A: Cannot convert type 'unknown' to 'User'\n  → Suggestion: Check User type definition or add type guard\n\nTask B: Test 'should validate email' failing\n  → Suggestion: Fix regex pattern\n\nHow to proceed?\n1. Apply suggestions and continue\n2. Skip and move on\n3. Fix manually\n```\n\n---\n\n## 📐 Detailed Implementation\n\n### Phase 1: Dependency Graph Construction and Parallel Launch\n\n**Dependency graph construction logic**:\n\n```\nParse tasks from Plans.md:\n    ↓\n1. Extract target files per task\n    ↓\n2. Determine file dependencies\n   ├── Same file edits → sequential\n   ├── Has import dependency → sequential\n   └── Independent → parallelizable\n    ↓\n3. Build dependency graph\n    ↓\n4. Determine parallel execution groups\n```\n\n**Judgment rules**:\n\n| Condition | Judgment | Processing |\n|-----------|----------|------------|\n| Multiple tasks edit same file | Conflict | Sequential |\n| Task A's output is Task B's input | Dependency | Execute A→B in order |\n| Mutually independent | Parallelizable | Same group |\n\n**task-worker launch**:\n\n```\nFor each parallel group:\n    ↓\nLaunch task-worker with Task tool:\n  - subagent_type: \"task-worker\"\n  - run_in_background: true\n  - prompt: {\n      task: \"task description\",\n      files: [\"target files\"],\n      max_iterations: 3,\n      review_depth: \"standard\"\n    }\n    ↓\nCollect launched task IDs\n```\n\n**Result collection**:\n\n```\nWait for all task-worker completion:\n    ↓\nCollect results with TaskOutput:\n  - status: commit_ready | needs_escalation | failed\n  - changes: [{file, action}]\n  - self_review: {quality, security, performance, compatibility}\n    ↓\nIf needs_escalation, aggregate → bulk confirm with user\n```\n\n**Progress display**:\n\n```\n📊 Phase 1 Progress: 2/5 complete\n\n├── [worker-1] Header.tsx ✅ commit_ready (35s)\n├── [worker-2] Footer.tsx ✅ commit_ready (28s)\n├── [worker-3] Sidebar.tsx ⏳ Self-reviewing...\n├── [worker-4] Utils.ts ⏳ Implementing...\n└── [worker-5] Types.ts 🔜 Waiting (depends: Utils.ts)\n```\n\n### Phase 2: Cross-review Execution\n\n**Prerequisites**:\n- All Phase 1 tasks returned `commit_ready`\n- `--skip-cross-review` not specified\n\n**Execution flow**:\n\n```\nPhase 1 completion:\n    ↓\nExecute harness-review (context-aware):\n  - Check .claude-code-harness.config.yaml\n  - review.mode=codex AND review.codex.enabled=true → Codex mode\n  - Otherwise → standard harness-review\n    ↓\nCodex mode:\n  - Codex 4-parallel expert review (per review type)\n  - Simultaneous review from 4 expert perspectives\n    ↓\nStandard review mode:\n  - Execute harness-review skill\n  - Check security/performance/quality/accessibility\n    ↓\nReview judgment:\n  - Critical/High issues → Fix implementation → Re-review (loop)\n  - OK (no Critical/High) → Complete\n    ↓\nLoop until OK or max iterations reached\n```\n\n**Review perspectives in Codex mode (4 parallel per review type)**:\n\n| Review Type | Experts |\n|-------------|---------|\n| **Code Review** | Security, Performance, Quality, Accessibility |\n| **Plan Review** | Clarity, Feasibility, Dependencies, Acceptance |\n| **Scope Review** | Scope-creep, Priority, Feasibility, Impact |\n\n### Phase 3: Auto-commit\n\n**Review OK判定**:\n\n```\nharness-review result:\n    ↓\nAPPROVE (no Critical/High issues):\n  → Auto-commit (unless --no-commit or config auto_commit: false)\n    ↓\nREQUEST_CHANGES (has Critical/High issues):\n  → Fix issues → Re-run review (loop)\n    ↓\nMax iterations reached:\n  → Report remaining issues → Request manual intervention\n```\n\n**Auto-commit behavior**:\n\n```\nCheck auto-commit setting:\n  1. --no-commit flag → Skip commit\n  2. .claude-code-harness.config.yaml work.auto_commit: false → Skip commit\n  3. .claude-code-harness.config.yaml work.commit_on_pm_approve: true\n     AND 2-Agent mode → Defer commit (pending PM approval)\n  4. Otherwise → Auto-commit with generated message\n```\n\n**commit_on_pm_approve モード** (2-Agent 専用):\n\n```\ncommit_on_pm_approve: true AND 2-Agent mode:\n    ↓\nSkip commit → Record pending state\n    ↓\nHandoff to PM with commit-pending flag:\n  \"変更はレビュー済みですが、未コミットです。\n   approve 時にコミット指示を含めてください。\"\n    ↓\nPM approves → Handoff includes commit instruction\n    ↓\nNext /work invocation: Detect \"approved + commit pending\"\n    → Execute commit before starting new tasks\n```\n\n> **Solo モードでは無視**: `commit_on_pm_approve` は 2-Agent モードでのみ有効。Solo モードでは通常の `auto_commit` 設定に従う。\n\n**Completion report (with auto-commit)**:\n\n```\n✅ /work Complete\n\n| Item | Status |\n|------|--------|\n| Tasks | 5/5 implemented |\n| Review | APPROVE |\n| Iterations | 2 |\n| Commit | abc1234 |\n\nChanged files:\n- src/components/Header.tsx (new)\n- src/components/Footer.tsx (new)\n- src/components/Sidebar.tsx (new)\n\nCommitted: feat: add Header, Footer, Sidebar components\n```\n\n**Completion report (with --no-commit)**:\n\n```\n✅ /work Complete\n\n| Item | Status |\n|------|--------|\n| Tasks | 5/5 implemented |\n| Review | APPROVE |\n| Iterations | 2 |\n| Commit | Skipped (--no-commit) |\n\nChanged files:\n- src/components/Header.tsx (new)\n- src/components/Footer.tsx (new)\n- src/components/Sidebar.tsx (new)\n\nNext steps:\n1. Review changes: git diff\n2. Commit when ready: git add . && git commit\n```\n\n**Completion report (with commit_on_pm_approve, 2-Agent)**:\n\n```\n✅ /work Complete (commit pending PM approval)\n\n| Item | Status |\n|------|--------|\n| Tasks | 5/5 implemented |\n| Review | APPROVE |\n| Iterations | 2 |\n| Commit | ⏸️ Pending PM approval |\n\nChanged files:\n- src/components/Header.tsx (new)\n- src/components/Footer.tsx (new)\n- src/components/Sidebar.tsx (new)\n\n## Commit Status: Pending PM Approval\n\n変更はハーネスレビュー済みですが、コミットを保留しています。\nPM が approve した場合、次回 /work 実行時にコミットされます。\n```\n\n### Phase 4: Handoff (2-Agent only)\n\n**Review OK 判定条件** (Solo/2-Agent 共通):\n\n| 判定 | 条件 | アクション |\n|------|------|-----------|\n| APPROVE | Critical/High の指摘なし | → Phase 3 (commit) → Phase 4 (handoff) |\n| REQUEST_CHANGES | Critical/High の指摘あり | → Fix → Re-review (loop) |\n\n**Handoff 実行条件**:\n\n```\nPhase 3 (Auto-commit) 完了後:\n    ↓\n2-Agent mode (pm:requested / cursor:requested detected)?\n  YES → Execute `/handoff-to-cursor` (completion report to PM)\n        → If commit_on_pm_approve: add commit-pending section\n  NO  → Solo mode: Skip handoff (workflow complete)\n```\n\n**順序（通常モード）**: Review OK → Auto-commit → Handoff\n\n> ⚠️ **重要**: 通常モードでは Handoff は必ず auto-commit の後に実行する。commit 前に handoff すると、PM がレビューする変更が未コミットになり不整合が生じる。\n\n**順序（commit_on_pm_approve モード）**: Review OK → Skip commit → Handoff (with commit-pending)\n\n> `commit_on_pm_approve: true` の場合、意図的にコミットを保留して Handoff する。PM が approve した後の次回 `/work` 実行時にコミットが実行される。\n\n**Handoff レポートの commit-pending セクション**:\n\n```\n## Commit Status: Pending PM Approval\n\n変更はハーネスレビュー済みですが、`commit_on_pm_approve` 設定により\nコミットを保留しています。\n\napprove の場合: ハンドオフに以下を含めてください:\n  「前回の変更を承認します。コミットしてから次のタスクに進んでください。」\n\nrequest_changes の場合: 通常通り修正指示を記載してください。\n```\n\n---\n\n## ⚡ Parallel Execution First\n\nThis command **actively utilizes parallel execution**.\n\n### Basic Policy\n\n```\n2+ independent tasks → Parallel execution (default)\nHas dependencies → Sequential execution\n```\n\n### Parallel Execution Criteria\n\n| Condition | Judgment | Example |\n|-----------|----------|---------|\n| Edit different files | ✅ Parallel | Header.tsx and Footer.tsx |\n| Edit same file | ⚠️ Sequential | Append to same index.tsx |\n| A's output is B's input | ⚠️ Sequential | Create API → Page using it |\n| Independent checks | ✅ Parallel | lint, test, type-check |\n\n### Execution Image\n\n```\n📋 Detected 5 tasks from Plans.md\n\nDependency analysis:\n├── [Independent] Create Header\n├── [Independent] Create Footer\n├── [Independent] Create Sidebar\n├── [Dependent] Create Layout ← Depends on Header, Footer, Sidebar\n└── [Dependent] Create Page ← Depends on Layout\n\nExecution plan:\n🚀 Parallel group 1: Header, Footer, Sidebar (simultaneous)\n   ↓\n🔧 Sequential: Create Layout\n   ↓\n🔧 Sequential: Create Page\n\nEstimated time: Sequential 5min → With parallel 2min30s (50% reduction)\n```\n\n---\n\n## Auto-judgment Logic\n\nCheck Plans.md markers and operate in appropriate mode:\n\n| Detected Marker | Operation Mode |\n|-----------------|----------------|\n| `pm:requested` / `cursor:requested` exists | 2-Agent (prioritize PM's request) |\n| `cc:TODO` / `cc:WIP` only | Solo (autonomous) |\n\n**Priority**: `pm:requested` > `cc:WIP` (continue) > `cc:TODO` (new)\n\n### Pre-task: Pending Commit Check (commit_on_pm_approve)\n\n`/work` 起動時、前回の保留コミットがあるか確認する:\n\n```\n/work start:\n    ↓\nCheck: PM approved + commit pending?\n  (Handoff message contains \"承認\" + uncommitted changes exist)\n    ↓\nYES → Execute pending commit first\n    → Then proceed to next task\n    ↓\nNO  → Proceed normally\n```\n\n> この処理により、PM 承認 → コミット → 次タスク実装 の流れが自然に繋がる。\n\n### Auto-update Markers on Task Start\n\n`/work` automatically transitions to **`cc:WIP`** on start:\n\n```\npm:requested / cursor:requested / cc:TODO → cc:WIP (auto-update on start)\n```\n\nThis integrates the \"start task → update marker\" functionality directly into `/work`.\n\n---\n\n## 🔧 Auto-invoke Skills (Required)\n\n**This command must explicitly invoke the following skills with the Skill tool**:\n\n| Skill | Purpose | When to Call |\n|-------|---------|--------------|\n| `impl` | Feature implementation (parent skill) | On task implementation |\n| `verify` | Build verification & error recovery (parent skill) | On post-implementation verification |\n\n**How to call**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:impl\"      # Feature implementation\n  skill: \"claude-code-harness:verify\"    # Build verification\n```\n\n**Child skills (auto-routing)**:\n- `work-impl-feature` - Feature implementation\n- `work-write-tests` - Test creation\n- `verify-related-files` - Related files check (prevents missed updates)\n- `verify-build` - Build verification\n- `error-recovery` - Error recovery\n\n> ⚠️ **Important**: Proceeding without calling skills won't record in usage statistics. Always call with Skill tool.\n\n---\n\n## 🔧 LSP Feature Utilization\n\nImplementation work actively utilizes LSP (Language Server Protocol).\n\n### Before Implementation: Code Understanding\n\n| LSP Feature | Use Case | Effect |\n|-------------|----------|--------|\n| **Go-to-definition** | Check existing function internals | Quickly grasp implementation patterns |\n| **Find-references** | Pre-survey impact scope | Prevent unintended breaking changes |\n| **Hover** | Check type info & docs | Implement with correct interfaces |\n\n### During Implementation: Real-time Verification\n\n| LSP Feature | Use Case | Effect |\n|-------------|----------|--------|\n| **Diagnostics** | Instant type/syntax error detection | Find issues before build |\n| **Completions** | Correct API usage | Prevent typos & wrong arguments |\n\n### After Implementation: Quality Check\n\n```\nRun LSP Diagnostics after implementation:\n→ Verify no type errors\n→ Detect unused variables & imports\n→ Early detection of potential issues\n```\n\n### After Implementation: Related Files Check\n\n```\nRun related files verification:\n→ Detect function signature changes → check callers\n→ Detect interface/type changes → check implementations\n→ Detect export changes → check importers\n→ Detect config changes → check related configs\n```\n\n**Example output**:\n```\n📋 Related Files Verification\n\n⚠️ Files to check:\n├─ src/api/auth.ts:45 (calls modified function)\n├─ tests/user.test.ts:28 (test for modified code)\n└─ docs/api.md (documentation may need update)\n\n1. Confirmed, proceed\n2. Check each file\n3. Show LSP find-references\n```\n\n### VibeCoder Phrases\n\n| What You Want | How to Say |\n|---------------|------------|\n| Know function internals | \"Show this function's definition\" |\n| Check where it's used | \"Find references to this variable\" |\n| Run error check | \"Run LSP diagnostics\" |\n\nDetails: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n\n---\n\n## Execution Flow\n\n### Step 1: Check Plans.md and Parallelization Analysis\n\n```bash\ncat Plans.md\n```\n\nExtract current `cc:TODO` tasks and **analyze parallelization possibility**.\n\n### Step 2: Present Execution Plan\n\n> 🔧 **Execution Plan**\n>\n> **Parallel Execution Group**:\n> | Task | Target File | Estimated Time |\n> |------|-------------|----------------|\n> | Create Header | src/components/Header.tsx | ~30s |\n> | Create Footer | src/components/Footer.tsx | ~30s |\n> | Create Sidebar | src/components/Sidebar.tsx | ~30s |\n>\n> **Sequential Execution (has dependencies)**:\n> | Task | Depends On | Estimated Time |\n> |------|------------|----------------|\n> | Create Layout | Header, Footer, Sidebar | ~45s |\n>\n> **Total Estimated**: Sequential 2m15s → With parallel 1m15s\n>\n> Execute?\n\n### Step 3: Parallel Execution with Task Tool\n\nUse Claude Code's Task tool to **execute in background in parallel**.\n\n```\n🚀 Starting parallel execution...\n\n├── [Agent 1] Creating Header... ⏳\n├── [Agent 2] Creating Footer... ⏳\n└── [Agent 3] Creating Sidebar... ⏳\n```\n\n**Important**:\n- Launch Task tool with `run_in_background: true`\n- Collect results with `TaskOutput`\n- Up to 10 tasks simultaneously\n\n#### ⚠️ Background Agent Permission Pre-approval (v2.1.20+)\n\nClaude Code v2.1.20 以降、background agent は起動前にツール権限の承認を求めます。\n並列 task-worker が複数起動する際に毎回権限プロンプトが出ると UX が低下するため、\n`.claude/settings.json` の `permissions.allow` で事前承認することを推奨します。\n\n**推奨設定**（プロジェクトの `.claude/settings.json` に手動で追加）:\n\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Read\",\n      \"Write\",\n      \"Edit\",\n      \"Bash(npm run:*)\",\n      \"Bash(pnpm:*)\",\n      \"Bash(git diff:*)\",\n      \"Bash(git status:*)\",\n      \"Grep\",\n      \"Glob\"\n    ]\n  }\n}\n```\n\n> 💡 task-worker は `Read`, `Write`, `Edit`, `Bash`, `Grep`, `Glob` を使用します。\n> これらを事前承認しておくことで、並列起動時の権限プロンプトを回避できます。\n>\n> ⚠️ **セキュリティ注意**: `Read`, `Write`, `Edit` を無条件に許可するとプロンプトインジェクション等のリスクが高まります。\n> 信頼できるプロジェクトでのみ設定し、必要に応じて対象をパス制限（例: `Write(src/*)`）することを検討してください。\n\n### Step 4: Collect Results and Integration Report\n\n```\n📊 Parallel Execution Complete\n\n├── [Agent 1] Create Header ✅ (25s)\n│   └── src/components/Header.tsx created\n├── [Agent 2] Create Footer ✅ (28s)\n│   └── src/components/Footer.tsx created\n└── [Agent 3] Create Sidebar ✅ (22s)\n    └── src/components/Sidebar.tsx created\n\n⏱️ Time: 28s (would be 75s sequential, 63% reduction)\n```\n\n### Step 5: Execute Sequential Tasks\n\nExecute tasks with dependencies in order.\n\n### Step 6: Update Plans.md and Completion Report\n\n```markdown\n# Plans.md Update\n- [x] Create Header `cc:done`\n- [x] Create Footer `cc:done`\n- [x] Create Sidebar `cc:done`\n- [x] Create Layout `cc:done`\n```\n\n---\n\n## Integration Report Format\n\n```markdown\n## 📊 Task Execution Report\n\n**Execution time**: 2025-12-15 10:30:00\n**Task count**: 5 (3 parallel + 2 sequential)\n**Duration**: 1m15s (would be 2m15s sequential, 44% reduction)\n\n### Execution Results\n\n| # | Task | Execution Type | Status | Duration |\n|---|------|----------------|--------|----------|\n| 1 | Create Header | Parallel | ✅ Success | 25s |\n| 2 | Create Footer | Parallel | ✅ Success | 28s |\n| 3 | Create Sidebar | Parallel | ✅ Success | 22s |\n| 4 | Create Layout | Sequential | ✅ Success | 45s |\n| 5 | Create Page | Sequential | ✅ Success | 30s |\n\n### Changed Files\n\n- `src/components/Header.tsx` (new)\n- `src/components/Footer.tsx` (new)\n- `src/components/Sidebar.tsx` (new)\n- `src/components/Layout.tsx` (new)\n- `src/app/page.tsx` (modified)\n\n### Commit (auto-commit enabled)\n\n```\nCommitted: feat: implement Header, Footer, Sidebar, Layout, Page components\n\nHash: abc1234\n```\n\n### Next Actions (if --no-commit)\n\n- [ ] Verify operation (`npm run dev`)\n- [ ] Run tests (`npm test`)\n- [ ] Review changes (`git diff`)\n- [ ] Commit when ready (`git add . && git commit`)\n```\n\n---\n\n## Error Handling\n\n### Partial Failure in Parallel Execution\n\n```\n📊 Parallel Execution Complete (partial error)\n\n├── [Agent 1] Create Header ✅ (25s)\n├── [Agent 2] Create Footer ❌ Error\n│   └── Cause: Import path not found\n└── [Agent 3] Create Sidebar ✅ (22s)\n\n⚠️ 1 task failed.\n\nOptions:\n1. Retry failed task only\n2. Check error details and fix manually\n3. Rollback everything\n```\n\n**Response**:\n1. Keep successful task results\n2. Show failed task error details\n3. Try auto-fix with `error-recovery` skill (max 3 times)\n\n### All Tasks Failed\n\n```\n❌ Parallel Execution Failed\n\nAll tasks encountered errors.\nThere may be a common cause.\n\nError analysis:\n- All tasks have `@/lib/supabase` import error\n- Cause: supabase.ts not created\n\nRecommended action:\n1. Create dependency file first\n2. Review execution order\n```\n\n---\n\n## Execution Pattern Collection\n\n### Pattern 1: Multiple Components (Parallel)\n\n```\nInput: Create Header, Footer, Sidebar\n\n→ All 3 tasks independent → Parallel execution\n→ Launch 3 agents with Task tool\n→ Summarize results in integration report\n```\n\n### Pattern 2: Quality Checks (Parallel)\n\n```\nInput: Run lint, test, type-check\n\n→ All independent → Parallel execution\n→ Results:\n  ├── [Lint] ✅ Warnings: 2\n  ├── [Test] ✅ 15/15 passed\n  └── [Type] ✅ No errors\n```\n\n### Pattern 3: Dependency Chain (Mixed)\n\n```\nInput: Create API → Page → Tests\n\n→ Has dependencies → Sequential execution\n→ But API tests and page tests can be parallelized\n```\n\n---\n\n## VibeCoder Hints\n\n| What You Want | How to Say |\n|---------------|------------|\n| Do all in parallel | \"do everything at once\" \"finish it quickly\" |\n| Know progress | \"how far are we?\" |\n| Verify operation | \"run it\" |\n| Move to next | \"next task\" |\n| Do one at a time | \"one at a time in order\" |\n\n---\n\n## Notes\n\n- **Simultaneous writes to same file are auto-avoided**\n- **Over 10 tasks** are batch-split and executed\n- Long-running tasks can be backgrounded with `Ctrl+B`\n",
        "commands/handoff/CLAUDE.md": "<claude-mem-context>\n# Recent Activity\n\n<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->\n\n### Dec 15, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #293 | 12:28 PM | 🔵 | start-taskコマンドの目的と統合状況 | ~118 |\n| #292 | \" | 🔵 | handoff-to-impl-claudeコマンドの目的と概要 | ~148 |\n| #291 | \" | 🔵 | handoff-to-pm-claudeコマンドの目的と概要 | ~138 |\n| #290 | \" | 🔵 | handoff-to-cursorコマンドの目的と概要 | ~125 |\n\n### Jan 28, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #18528 | 2:42 PM | 🔵 | handoff-to-cursor コマンド - PM へのレポート生成機能 | ~403 |\n| #18167 | 2:03 AM | ✅ | handoff-to-opencode.md も同一の高品質実装に統一 | ~260 |\n| #18166 | \" | ✅ | handoff-to-cursor.md を JARVIS 参考実装に基づき大幅改善 | ~257 |\n| #18160 | 2:00 AM | 🔵 | handoff-to-opencode.md も同じ簡略版パターン | ~174 |\n| #18159 | \" | 🔵 | CC-harness handoff-to-cursor.md は簡略版実装 | ~185 |\n| #18158 | \" | 🔵 | CLAUDE.md ファイル内容は空 | ~87 |\n</claude-mem-context>\n\n# commands/handoff - ハンドオフコマンド\n\n## 用途\n\nこのディレクトリには、2-Agent モード（Claude Code + Cursor/OpenCode）で作業完了時に PM への引き継ぎ報告を生成するコマンドが含まれます。\n\n| コマンド | 対象 PM | 用途 |\n|---------|---------|------|\n| `/handoff-to-cursor` | Cursor | Cursor PM への完了報告生成 |\n| `/handoff-to-opencode` | OpenCode | OpenCode PM への完了報告生成 |\n\n## いつ使うか\n\n- **2-Agent モード**（Plans.md に `pm:依頼中` がある場合）: `/work` 完了後、review OK を確認してから実行\n- **Solo モード**: handoff は不要（review ループのみで完結）\n\n## 注意事項\n\n- Plans.md のマーカーは `cc:完了` を使用すること（英語マーカーは不可）\n- コマンド挙動の変更や新フラグの追加はこのディレクトリのスコープ外\n- Do not edit inside <claude-mem-context>. この領域は claude-mem により自動生成されます\n",
        "commands/handoff/handoff-to-cursor.md": "---\ndescription: Generate completion report for Cursor (PM)\ndescription-en: Generate completion report for Cursor (PM)\n---\n\n# /handoff-to-cursor - Cursor への作業完了報告\n\nClaude Code での作業完了時に、Cursor（PM）への引き継ぎ報告を生成します。\nPlans.md を更新し、次のアクションを明確にします。\n\n## VibeCoder Quick Reference\n\n- 「**Cursor に完了報告を書いて**」→ このコマンドを実行\n- 「**変更内容とテスト結果を含めて**」→ `git diff` と実行コマンドを元に追加生成\n- 「**何を書けばいいかわからない**」→ 必要項目（やったこと / 変わったこと / 検証方法）をヒアリングします\n\n## Prerequisites（前提条件）\n\n> ⚠️ **このコマンドは harness-review で APPROVE が出た後にのみ実行すること**\n\n| 条件 | 必須 | 確認方法 |\n|------|------|---------|\n| harness-review 実施済み | ✅ | レビュー結果が APPROVE |\n| Critical/High 指摘なし | ✅ | 全て修正済み |\n| 実装完了 | ✅ | Plans.md タスクが完了状態 |\n\n**レビューOK前に handoff を実行してはいけない理由**:\n- PM がレビューしていない変更を受け取ることになる\n- 品質保証されていないコードが PM に渡る\n- `/work` のフロー（実装 → レビュー → 修正 → OK → handoff）が崩れる\n\n## Deliverables\n\n- 「概要 / 完了タスク / 変更ファイル / 検証結果 / リスク / 次のアクション」を **PM に伝わる形式** で1ドキュメントにまとめる\n- Plans.md の該当タスクが `cc:完了` になっていることを確認・整合させる\n\n## Steps\n\n1. **完了タスクを特定**\n   - Plans.md の該当チェックボックスを確認\n   - 作業内容を要約\n\n2. **Plans.md を更新**\n   ```markdown\n   # 更新前\n   - [ ] タスク名 `pm:依頼中`\n\n   # 更新後\n   - [x] タスク名 `cc:完了` (YYYY-MM-DD)\n   ```\n\n3. **変更内容を把握**\n   ```bash\n   git status -sb\n   git diff --stat\n   ```\n\n4. **CI/CD 状況を確認**（該当する場合）\n   ```bash\n   gh run list --limit 3\n   ```\n\n5. **下記フォーマットで報告を生成**\n\n## Output Format\n\nCursor に直接ペーストできる形式で出力してください。\n\n```markdown\n## Completion Report\n\n### 概要\n- （実施内容を 1〜3 行で）\n\n### 完了タスク\n- **タスク名**: [タスクの説明]\n\n### 変更ファイル\n| ファイル | 変更内容 |\n|---------|---------|\n| `path/to/file1` | [変更概要] |\n| `path/to/file2` | [変更概要] |\n\n### 検証結果\n- [x] ビルド成功\n- [x] テスト通過\n- [x] 動作確認完了\n\n### リスク / 注意点\n- （あれば記載）\n\n### 次のアクション（Cursor 向け）\n1. [ ] [PM が次にやるべきこと]\n2. [ ] [オプション]\n```\n\n## 注意事項\n\n- **harness-review で APPROVE が出た後にのみ実行すること**（レビューOK前の handoff は禁止）\n- 2-Agent モード（`pm:依頼中` 検出時）で `/work` 完了後に実行される\n- Solo モードでは handoff は不要（review ループのみ）\n- Plans.md のマーカーは `cc:完了` を使用すること（英語マーカーは不可）\n\n## `/work` との連携フロー\n\n```\n/work 実行\n    ↓\nPhase 1: 並列実装\n    ↓\nPhase 2: harness-review ループ\n    ├── NG (Critical/High あり) → 修正 → 再レビュー\n    └── OK (APPROVE) → Phase 3 へ\n    ↓\nPhase 3: Auto-commit（設定による）\n    ↓\nPhase 4: このコマンドを実行 ← ここで初めて handoff\n```\n\n> `/work` が Phase 4 で自動的にこのコマンドを呼び出します。\n> 手動で実行する場合も、必ず harness-review APPROVE 後に行うこと。\n",
        "commands/handoff/handoff-to-opencode.md": "---\ndescription: Generate completion report for OpenCode (PM)\ndescription-en: Generate completion report for OpenCode (PM)\n---\n\n# /handoff-to-opencode - OpenCode への作業完了報告\n\nClaude Code での作業完了時に、OpenCode（PM）への引き継ぎ報告を生成します。\nPlans.md を更新し、次のアクションを明確にします。\nCursor PM への報告は **`/handoff-to-cursor`** を使用してください。\n\n## VibeCoder Quick Reference\n\n- 「**OpenCode に完了報告を書いて**」→ このコマンドを実行\n- 「**OpenCode PM に報告**」→ このコマンドを実行\n- 「**何を書けばいいかわからない**」→ 必要項目（やったこと / 変わったこと / 検証方法）をヒアリングします\n\n## Prerequisites（前提条件）\n\n> ⚠️ **このコマンドは harness-review で APPROVE が出た後にのみ実行すること**\n\n| 条件 | 必須 | 確認方法 |\n|------|------|---------|\n| harness-review 実施済み | ✅ | レビュー結果が APPROVE |\n| Critical/High 指摘なし | ✅ | 全て修正済み |\n| 実装完了 | ✅ | Plans.md タスクが完了状態 |\n\n**レビューOK前に handoff を実行してはいけない理由**:\n- PM がレビューしていない変更を受け取ることになる\n- 品質保証されていないコードが PM に渡る\n- `/work` のフロー（実装 → レビュー → 修正 → OK → handoff）が崩れる\n\n## Deliverables\n\n- 「概要 / 完了タスク / 変更ファイル / 検証結果 / リスク / 次のアクション」を **PM に伝わる形式** で1ドキュメントにまとめる\n- Plans.md の該当タスクが `cc:完了` になっていることを確認・整合させる\n\n## Steps\n\n1. **完了タスクを特定**\n   - Plans.md の該当チェックボックスを確認\n   - 作業内容を要約\n\n2. **Plans.md を更新**\n   ```markdown\n   # 更新前\n   - [ ] タスク名 `pm:依頼中`\n\n   # 更新後\n   - [x] タスク名 `cc:完了` (YYYY-MM-DD)\n   ```\n\n3. **変更内容を把握**\n   ```bash\n   git status -sb\n   git diff --stat\n   ```\n\n4. **CI/CD 状況を確認**（該当する場合）\n   ```bash\n   gh run list --limit 3\n   ```\n\n5. **下記フォーマットで報告を生成**\n\n## Output Format\n\nOpenCode に直接ペーストできる形式で出力してください。\n\n```markdown\n## Completion Report\n\n### 概要\n- （実施内容を 1〜3 行で）\n\n### 完了タスク\n- **タスク名**: [タスクの説明]\n\n### 変更ファイル\n| ファイル | 変更内容 |\n|---------|---------|\n| `path/to/file1` | [変更概要] |\n| `path/to/file2` | [変更概要] |\n\n### 検証結果\n- [x] ビルド成功\n- [x] テスト通過\n- [x] 動作確認完了\n\n### リスク / 注意点\n- （あれば記載）\n\n### 次のアクション（OpenCode 向け）\n1. [ ] [PM が次にやるべきこと]\n2. [ ] [オプション]\n```\n\n## 注意事項\n\n- **harness-review で APPROVE が出た後にのみ実行すること**（レビューOK前の handoff は禁止）\n- 2-Agent モード（`pm:依頼中` 検出時）で `/work` 完了後に実行される\n- Solo モードでは handoff は不要（review ループのみ）\n- Plans.md のマーカーは `cc:完了` を使用すること（英語マーカーは不可）\n\n## `/work` との連携フロー\n\n```\n/work 実行\n    ↓\nPhase 1: 並列実装\n    ↓\nPhase 2: harness-review ループ\n    ├── NG (Critical/High あり) → 修正 → 再レビュー\n    └── OK (APPROVE) → Phase 3 へ\n    ↓\nPhase 3: Auto-commit（設定による）\n    ↓\nPhase 4: このコマンドを実行 ← ここで初めて handoff\n```\n\n> `/work` が Phase 4 で自動的にこのコマンドを呼び出します。\n> 手動で実行する場合も、必ず harness-review APPROVE 後に行うこと。\n",
        "commands/optional/CLAUDE.md": "---\ndescription: claude-mem context for optional commands\n---\n<claude-mem-context>\n# Recent Activity\n\n<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->\n\n### Dec 15, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #312 | 12:31 PM | 🔵 | sync-project-specsコマンドの目的と概要 | ~119 |\n| #311 | \" | 🔵 | ci-setupコマンドの目的と概要 | ~113 |\n| #310 | \" | 🔵 | deploy-setupコマンドの目的と概要 | ~117 |\n| #309 | 12:30 PM | 🔵 | sync-ssot-from-serenaコマンドの目的と概要 | ~142 |\n| #308 | \" | 🔵 | paymentsコマンドの目的と概要 | ~107 |\n| #307 | \" | 🔵 | refactorコマンドの目的と概要 | ~107 |\n\n### Dec 23, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #7188 | 12:53 AM | 🔵 | harness-updateコマンドの現在の実装内容 | ~230 |\n\n### Dec 24, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #9375 | 2:44 PM | 🔵 | Serena同期コマンドの存在確認 | ~130 |\n| #9202 | 1:40 PM | ✅ | 古いフック設定検出ロジックの改善 | ~176 |\n| #9201 | \" | 🔵 | harness-update.mdの古いフック設定チェック実装 | ~169 |\n| #8976 | 12:43 PM | 🔵 | ハーネスアップデートコマンドの詳細実装仕様の確認 | ~217 |\n\n### Dec 25, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #9584 | 12:54 AM | 🔵 | harness-updateコマンドのSkills設定差分検出ロジックを確認 | ~131 |\n| #9538 | 12:02 AM | 🔵 | harness-update.md ファイルの内容確認 | ~140 |\n\n### Dec 26, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #10495 | 6:31 PM | ✅ | claude-mem v7.3.7 Windows サポート情報の更新 | ~222 |\n| #10482 | 5:03 PM | ✅ | ポート37777問題の詳細な根本原因分析と回避策を強化 | ~234 |\n| #10481 | \" | 🔵 | ポート37777問題の根本原因と回避策の文書化 | ~202 |\n| #10480 | 5:02 PM | ✅ | Windows環境でのclaude-mem使用に対する警告・WSL推奨の追加 | ~192 |\n| #10479 | \" | 🔵 | Windows環境でのclaude-memハーネス設定の詳細確認 | ~141 |\n| #10461 | 3:24 PM | 🟣 | WSL環境のトラブルシューティングガイドを追加 | ~327 |\n| #10350 | 12:14 PM | 🔵 | /remember コマンド - 学習事項の記録システム | ~211 |\n| #10341 | \" | 🔵 | Claude harness リリースプロセス自動化コマンド | ~231 |\n\n### Dec 27, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #10719 | 12:18 AM | 🔵 | LSP セットアップドキュメントの確認 | ~190 |\n\n### Dec 30, 2025\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #11697 | 2:13 AM | 🔵 | cursor-mem.mdドキュメント全体構成：双方向データ共有アーキテクチャを実装 | ~279 |\n| #11696 | \" | ✅ | cursor-mem.mdのバージョン管理表：Cursor Rules新形式を追加 | ~304 |\n| #11695 | \" | 🔵 | cursor-mem統合の運用ガバナンス：バージョン管理とスクリプト体系の完全設計 | ~349 |\n| #11694 | 2:12 AM | 🔵 | cursor-mem.mdのセットアップドキュメント：冪等性と検証メカニズムを実装 | ~274 |\n| #11693 | \" | ✅ | cursor-mem.mdのセットアップステップ6を仕様変更：.cursorrules → Cursor Rules生成 | ~265 |\n| #11692 | \" | 🔵 | cursor-mem.md既存ドキュメント確認：8段階セットアップフロー存在 | ~269 |\n\n### Jan 2, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #13613 | 5:38 PM | 🔵 | harness-mem コマンド仕様書の確認 | ~205 |\n\n### Jan 3, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #13746 | 4:25 AM | 🔵 | harness-ui ダッシュボードセットアップコマンドの仕様確認 | ~164 |\n\n### Jan 5, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #14724 | 8:51 PM | ✅ | harness-mem.md に Step 0.5: Bun インストール確認を追加 | ~372 |\n| #14723 | \" | 🔵 | harness-mem コマンドの全体設計を確認 | ~375 |\n| #14602 | 1:29 PM | 🔵 | claude-code-harness アップデートコマンドの詳細仕様を確認 | ~570 |\n\n### Jan 13, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #15807 | 1:55 PM | 🔵 | 既存のCodexレビューコマンド仕様の確認 | ~167 |\n\n### Jan 19, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #16849 | 2:55 AM | ✅ | harness-update.mdの「Step 5: Update Cursor Commands」セクション詳細化 | ~225 |\n| #16845 | 2:54 AM | 🔵 | harness-update.mdにおけるhooks権限チェック機能の実装仕様確認 | ~242 |\n| #16841 | 2:52 AM | 🟣 | harness-updateコマンドにhooks実行権限自動修正機能を追加 | ~220 |\n| #16839 | 2:51 AM | 🔵 | harness-update.mdでのシェルスクリプト権限チェック機能の確認 | ~230 |\n| #16831 | 2:48 AM | 🔵 | codex-review.mdファイルでのexecコマンド仕様確認 | ~178 |\n\n### Jan 25, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #17457 | 3:41 PM | 🔵 | opencode-setup コマンドの実装詳細と VibeCoder Quick Reference | ~308 |\n| #17455 | 3:40 PM | 🔵 | opencode-setup コマンドの機能と統合方式の詳細 | ~303 |\n| #17387 | 2:01 PM | 🔵 | dev-tools-setup.mdの完全な実装仕様を確認 - テスト実行可能な詳細手順 | ~217 |\n| #17369 | 1:56 PM | 🔵 | dev-tools-setupコマンド実装を確認 - AST-Grep・LSP一括セットアップ仕様 | ~217 |\n| #17367 | 1:55 PM | 🔵 | opencode-setup.mdコマンド実装を確認 - 仕様は定義されている | ~192 |\n| #17365 | \" | 🔵 | OpenCode・dev-toolsコマンドが実装されていた - Glob検索の誤り | ~178 |\n\n### Jan 26, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #17835 | 12:54 PM | 🔵 | session-inbox コマンド仕様の詳細発見 | ~200 |\n| #17817 | 3:16 AM | ✅ | opencode-setup.mdコマンド仕様を大幅改訂。OpenCodeスキーマ仕様を明記 | ~381 |\n| #17812 | 3:14 AM | 🔵 | opencode-setupコマンドの仕様と実装ギャップを確認 | ~360 |\n\n### Jan 27, 2026\n\n| ID | Time | T | Title | Read |\n|----|------|---|-------|------|\n| #18107 | 11:21 PM | ✅ | opencode-setupコマンドの--symlinkオプション参照削除 | ~136 |\n| #18105 | \" | ✅ | opencode-setup.mdドキュメントの簡素化と自動化 | ~201 |\n</claude-mem-context>",
        "commands/optional/ci-setup.md": "---\ndescription: \"[Optional] Set up CI/CD (GitHub Actions)\"\ndescription-en: \"[Optional] Set up CI/CD (GitHub Actions)\"\n---\n\n# /ci-setup - CI/CD Setup (GitHub Actions)\n\nAutomatically builds a CI/CD pipeline using GitHub Actions.\n\n## VibeCoder Quick Reference\n\n- \"**Add CI**\" → this command\n- \"**Make tests run on PR**\" → Sets up checks on PR/Push\n- \"**Don't know what to run**\" → Analyzes project and suggests lint/typecheck/test/build\n\n## Deliverables\n\n- Add `.github/workflows/*` to auto-run lint/typecheck/test/build\n- Provides failure cause analysis and fix suggestions (safety first)\n\n**Features**:\n- ✅ Lint (ESLint, Prettier)\n- ✅ Type Check (TypeScript)\n- ✅ Unit Test (Jest, Vitest)\n- ✅ E2E Test (Playwright)\n- ✅ Build Check\n\n---\n\n## 🔧 Auto-invoke Skills (Required)\n\n**This command must explicitly invoke the following skills with the Skill tool**:\n\n| Skill | Purpose | When to Call |\n|-------|---------|--------------|\n| `ci` | CI/CD (parent skill) | CI build/troubleshooting |\n\n**How to call**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:ci\"\n```\n\n**Child skills (auto-routing)**:\n- `generate-workflow-files` - Workflow file generation\n- `ci-analyze-failures` - CI failure analysis\n- `ci-fix-failing-tests` - Test fix\n\n> ⚠️ **Important**: Proceeding without calling skills won't record in usage statistics. Always call with Skill tool.\n\n---\n\n## 🔧 Type Check/Lint Integration\n\nIntegrates type checking and lint during CI/CD setup for more robust pipelines.\n\n### Integrating Type Check/Lint into CI\n\nRun type checking and lint in GitHub Actions to maintain code quality:\n\n```yaml\n  type-check-and-lint:\n    name: Type Check & Lint\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run type check\n        run: npm run type-check  # or tsc --noEmit\n\n      - name: Run lint\n        run: npm run lint\n```\n\n### CI Failure Debugging Flow\n\nWhen CI fails, use LSP tools locally to identify issues:\n\n```\nCI failure debugging flow:\n\n1. Check error logs\n2. Analyze issues locally using LSP tools (definition, references, diagnostics)\n3. Track problem source with Go-to-definition\n4. Verify impact scope with Find-references\n5. Re-validate with type-check/lint after fix\n```\n\n### VibeCoder Phrases\n\n| What You Want | How to Say |\n|---------------|------------|\n| Investigate CI error cause | \"Investigate this error with LSP definition/references\" |\n| Check type errors before push | \"Run type-check before push\" |\n\nDetails: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md) or run `/lsp-setup` command.\n\n---\n\n## Usage\n\n```\n/ci-setup\n```\n\n→ Generates `.github/workflows/ci.yml`\n\n---\n\n## Execution Flow\n\n### Step 1: Confirm Project Type\n\n> 🎯 **Tell us your project type:**\n>\n> 1. Next.js (App Router)\n> 2. Next.js (Pages Router)\n> 3. React (Vite)\n> 4. Other\n>\n> Answer with a number (default: 1)\n\n**Wait for response**\n\n### Step 2: Confirm Test Framework\n\n> 🧪 **Tell us your test framework:**\n>\n> 1. Jest\n> 2. Vitest\n> 3. Both\n> 4. None\n>\n> Answer with a number (default: 2)\n\n**Wait for response**\n\n### Step 3: Confirm E2E Testing\n\n> 🎭 **Run E2E tests?**\n>\n> 1. Yes (Playwright)\n> 2. No\n>\n> Answer with a number (default: 1)\n\n**Wait for response**\n\n### Step 4: Generate GitHub Actions Workflow\n\nGenerate the following files:\n\n#### `.github/workflows/ci.yml`\n\n```yaml\nname: CI\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main, develop]\n\njobs:\n  lint:\n    name: Lint\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run ESLint\n        run: npm run lint\n\n      - name: Run Prettier\n        run: npm run format:check\n\n  typecheck:\n    name: Type Check\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run TypeScript compiler\n        run: npm run typecheck\n\n  test:\n    name: Unit Tests\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run tests\n        run: npm test -- --coverage\n\n      - name: Upload coverage to Codecov\n        uses: codecov/codecov-action@v4\n        with:\n          token: ${{ secrets.CODECOV_TOKEN }}\n          files: ./coverage/coverage-final.json\n          fail_ci_if_error: false\n\n  e2e:\n    name: E2E Tests\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Install Playwright browsers\n        run: npx playwright install --with-deps\n\n      - name: Build application\n        run: npm run build\n\n      - name: Run E2E tests\n        run: npm run test:e2e\n\n      - name: Upload test results\n        if: always()\n        uses: actions/upload-artifact@v4\n        with:\n          name: playwright-report\n          path: playwright-report/\n          retention-days: 30\n\n  build:\n    name: Build Check\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Build application\n        run: npm run build\n\n      - name: Check build output\n        run: |\n          if [ ! -d \".next\" ]; then\n            echo \"Build output not found\"\n            exit 1\n          fi\n```\n\n### Step 5: Add package.json Scripts\n\nAdd the following scripts to `package.json` (if not present):\n\n```json\n{\n  \"scripts\": {\n    \"lint\": \"next lint\",\n    \"format:check\": \"prettier --check .\",\n    \"format\": \"prettier --write .\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"test\": \"vitest\",\n    \"test:e2e\": \"playwright test\"\n  }\n}\n```\n\n### Step 6: Check Config Files\n\nSuggest generating missing config files if needed:\n\n#### `.eslintrc.json`\n\n```json\n{\n  \"extends\": [\"next/core-web-vitals\", \"prettier\"],\n  \"rules\": {\n    \"no-console\": [\"warn\", { \"allow\": [\"warn\", \"error\"] }],\n    \"@typescript-eslint/no-unused-vars\": [\"error\", { \"argsIgnorePattern\": \"^_\" }]\n  }\n}\n```\n\n#### `.prettierrc`\n\n```json\n{\n  \"semi\": false,\n  \"singleQuote\": true,\n  \"trailingComma\": \"es5\",\n  \"tabWidth\": 2,\n  \"printWidth\": 100\n}\n```\n\n#### `tsconfig.json`\n\n```json\n{\n  \"compilerOptions\": {\n    \"target\": \"ES2020\",\n    \"lib\": [\"ES2020\", \"DOM\", \"DOM.Iterable\"],\n    \"jsx\": \"preserve\",\n    \"module\": \"ESNext\",\n    \"moduleResolution\": \"bundler\",\n    \"resolveJsonModule\": true,\n    \"allowJs\": true,\n    \"strict\": true,\n    \"noEmit\": true,\n    \"esModuleInterop\": true,\n    \"skipLibCheck\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"incremental\": true,\n    \"paths\": {\n      \"@/*\": [\"./*\"]\n    }\n  },\n  \"include\": [\"next-env.d.ts\", \"**/*.ts\", \"**/*.tsx\"],\n  \"exclude\": [\"node_modules\"]\n}\n```\n\n### Step 7: Guide Next Actions\n\n> ✅ **CI/CD pipeline complete!**\n>\n> 📄 **Generated files**:\n> - `.github/workflows/ci.yml` - GitHub Actions workflow\n> - `.eslintrc.json` - ESLint config (if needed)\n> - `.prettierrc` - Prettier config (if needed)\n> - `tsconfig.json` - TypeScript config (if needed)\n>\n> **Next steps:**\n> 1. Push to GitHub: `git add . && git commit -m \"Add CI/CD\" && git push`\n> 2. Check execution status in GitHub Actions tab\n> 3. (Optional) Set Codecov token: Settings > Secrets > CODECOV_TOKEN\n>\n> 💡 **Hint**: CI will automatically run when you create a Pull Request.\n\n---\n\n## Customization Examples\n\n### 1. Run Only on Specific Branches\n\n```yaml\non:\n  push:\n    branches: [main]  # main branch only\n```\n\n### 2. Run Only on Specific File Changes\n\n```yaml\non:\n  push:\n    paths:\n      - 'src/**'\n      - 'app/**'\n      - 'package.json'\n```\n\n### 3. Scheduled Execution\n\n```yaml\non:\n  schedule:\n    - cron: '0 0 * * *'  # Run daily at midnight\n```\n\n### 4. Disable Parallel Execution\n\n```yaml\njobs:\n  test:\n    needs: [lint, typecheck]  # Run after lint, typecheck succeed\n```\n\n---\n\n## Troubleshooting\n\n### Error: `npm ci` fails\n\n**Cause**: `package-lock.json` is outdated\n\n**Solution**:\n```bash\nnpm install\ngit add package-lock.json\ngit commit -m \"Update package-lock.json\"\ngit push\n```\n\n### Error: Playwright installation fails\n\n**Cause**: Browser installation failed\n\n**Solution**: Add the following to workflow\n```yaml\n- name: Install Playwright browsers\n  run: npx playwright install --with-deps chromium\n```\n\n### Error: Build fails\n\n**Cause**: Environment variables not set\n\n**Solution**: Add environment variables to GitHub Secrets\n```yaml\n- name: Build application\n  run: npm run build\n  env:\n    NEXT_PUBLIC_API_URL: ${{ secrets.NEXT_PUBLIC_API_URL }}\n```\n\n---\n\n## Notes\n\n- **First run**: First run executes all jobs, so it takes time (5-10 minutes)\n- **Parallel execution**: Multiple jobs run in parallel for efficiency\n- **Caching**: `node_modules` is cached, so subsequent runs are faster\n- **Free tier**: GitHub Actions is free for public repos, 2000 minutes/month for private repos\n\n**This CI pipeline helps maintain high-quality code.**\n\n---\n\n## ⚠️ Development vs Repository Decision\n\n**Confirm before committing generated files:**\n\n| Question | Yes → | No → |\n|----------|-------|------|\n| Does this affect project functionality/quality? | Commit to repo | Development only (.gitignore) |\n| Needed by end users or other developers? | Commit to repo | Development only (.gitignore) |\n\n**Example: When developing plugins**\n\nWhen adding CI to the plugin repository itself:\n- ✅ **Repository**: `validate-plugin.yml` (needed for plugin validation)\n- ❌ **Development only**: ShellCheck or Markdown lint that don't affect the plugin itself\n\nAdd development files to `.gitignore` before committing.\n",
        "commands/optional/codex-mode.md": "---\ndescription: Toggle Codex mode on/off for reviews\ndescription-en: Toggle Codex mode on/off for reviews\n---\n\n# /codex-mode - Toggle Codex Mode\n\nToggles Codex mode (parallel delegation to GPT experts) during reviews.\n\n## Usage\n\n```bash\n/codex-mode           # Show current state\n/codex-mode on        # Enable Codex mode\n/codex-mode off       # Disable Codex mode\n/codex-mode status    # Show detailed settings\n```\n\n## Prerequisites\n\n- Codex MCP server is configured\n- Setup completed with `/codex-review` or `/harness-review`\n\n## What is Codex Mode\n\n| Mode | Reviewer | Characteristics |\n|------|----------|-----------------|\n| **Default** | Claude alone | Fast, no Codex required |\n| **Codex mode** | Codex (GPT) | Parallel delegation to 9 experts |\n\n### Codex Mode's 9 Experts\n\n| Expert | Role | Perspective |\n|--------|------|-------------|\n| Security | Security analysis | OWASP Top 10, authentication/authorization |\n| Accessibility | a11y check | WCAG 2.1 AA compliance |\n| Performance | Performance analysis | Rendering, DB queries |\n| Quality | Code quality | Readability, maintainability |\n| SEO | SEO/OGP check | Meta tags, structured data |\n| Architect | Design review | Architectural decisions |\n| Plan Reviewer | Plan verification | Completeness, risk analysis |\n| Scope Analyst | Requirements analysis | Ambiguity, gap detection |\n\n## Execution Flow\n\n### 1. Show State (`/codex-mode`)\n\n```markdown\n## Codex Mode Settings\n\nCurrent: **OFF** (default mode)\n\nReviewer: Claude alone\nCodex MCP: ✅ Configured\n\nToggle: `/codex-mode on` to enable\n```\n\n### 2. Enable (`/codex-mode on`)\n\n```markdown\n## Codex Mode: ON\n\n✅ Codex mode enabled\n\nActive experts:\n- ✅ Security\n- ✅ Accessibility\n- ✅ Performance\n- ✅ Quality\n- ✅ SEO\n- ✅ Architect\n- ✅ Plan Reviewer\n- ✅ Scope Analyst\n\nNext `/harness-review` will delegate to Codex in parallel.\n```\n\n### 3. Disable (`/codex-mode off`)\n\n```markdown\n## Codex Mode: OFF\n\n✅ Returned to default mode\n\nNext `/harness-review` will run with Claude alone.\n```\n\n### 4. Show Details (`/codex-mode status`)\n\n```markdown\n## Codex Mode Detailed Settings\n\n| Setting | Current Value |\n|---------|---------------|\n| Mode | codex |\n| Judgment output | enabled |\n| Auto-fix | enabled |\n| Max retries | 3 |\n\n### Expert Settings\n\n| Expert | State |\n|--------|-------|\n| security | ✅ ON |\n| accessibility | ✅ ON |\n| performance | ✅ ON |\n| quality | ✅ ON |\n| seo | ✅ ON |\n| architect | ✅ ON |\n| plan_reviewer | ✅ ON |\n| scope_analyst | ✅ ON |\n\n### Individual Toggle\n\n```bash\n/codex-mode experts security off   # Disable Security only\n/codex-mode experts architect on   # Enable Architect only\n```\n```\n\n## Config File Update\n\nThis command updates `.claude-code-harness.config.yaml`.\n\n```yaml\nreview:\n  mode: codex  # default | codex\n  judgment:\n    enabled: true\n    auto_fix: true\n    max_retries: 3\n  codex:\n    enabled: true\n    auto: true\n    experts:\n      security: true\n      accessibility: true\n      performance: true\n      quality: true\n      seo: true\n      architect: true\n      plan_reviewer: true\n      scope_analyst: true\n```\n\n## Individual Expert Settings\n\nYou can enable/disable specific experts only.\n\n```bash\n# Disable Security only (keep others)\n/codex-mode experts security off\n\n# Enable only Architect and Plan Reviewer\n/codex-mode experts architect on\n/codex-mode experts plan_reviewer on\n```\n\n## VibeCoder Phrases\n\n| What You Want | How to Say |\n|---------------|------------|\n| Want to use Codex | \"Switch to Codex mode\" |\n| Return to normal | \"Return to default\" |\n| Check settings | \"Show Codex settings\" |\n| Disable security only | \"I don't need the security check\" |\n\n## Related Commands\n\n- `/harness-review` - Run review (Codex mode supported)\n- `/codex-review` - Codex MCP setup\n",
        "commands/optional/codex-review.md": "---\ndescription: Second-opinion code review using Codex MCP\ndescription-en: Second-opinion code review using Codex MCP\n---\n\n# /codex-review - Codex Second Opinion Review\n\nGet a second opinion code review using OpenAI Codex.\n\n---\n\n## 🎯 Quick Reference\n\n- \"`/codex-review`\" → Request review from Codex\n- \"Have Codex take a look too\" → this command\n- \"Want another AI's opinion\" → this command\n\n---\n\n## Deliverables\n\n- Get a second opinion from Codex in addition to Claude's review\n- Leverage different AI models' strengths (logical reasoning vs implementation pattern knowledge)\n- Display integrated review results\n\n---\n\n## 🔧 Auto-invoke Skills (Required)\n\n**This command must explicitly invoke the following skills with the Skill tool**:\n\n| Skill | Purpose | When to Call |\n|-------|---------|--------------|\n| `codex-review` | Codex integration (parent skill) | At command start |\n\n**How to call**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:codex-review\"\n```\n\n---\n\n## Prerequisites\n\n### 1. Codex CLI is Installed\n\n```bash\nwhich codex  # Path should be displayed\n```\n\n### 2. Logged into Codex\n\n```bash\ncodex login status  # Should be authenticated\n```\n\n### 3. Registered as MCP Server\n\n```bash\nclaude mcp list  # codex should be displayed\n```\n\n**If not configured**:\n```bash\nclaude mcp add --scope user codex -- codex mcp-server\n```\n\n---\n\n## Execution Flow\n\n### Step 0: Check Remaining Context\n\nBefore Codex review, **run /compact first if remaining context is 30% or less**.\n\n> **Note**: Continue with Codex review even if space is still tight after /compact.\n\n### Step 1: Check Codex Environment & Version\n\n```bash\n# Check if Codex is available\nwhich codex && codex login status\n\n# Check version\ncodex --version\nnpm show @openai/codex version  # Latest version\n```\n\n**If not configured**:\n```markdown\n⚠️ Codex is not configured\n\nSetup instructions:\n1. Install Codex CLI\n2. Authenticate with `codex login`\n3. Register with `claude mcp add --scope user codex -- codex mcp-server`\n\nDetails: `skills/codex-review/references/codex-mcp-setup.md`\n```\n\n**If version is outdated**:\n```markdown\n⚠️ Codex CLI is outdated\n\nInstalled: X.X.X\nLatest version: Y.Y.Y\n\nUpdate? (y/n)\n\n→ If approved:\nnpm update -g @openai/codex\n```\n\n### Step 2: Identify Changed Files\n\n```bash\ngit diff --name-only HEAD~1 2>/dev/null || git status --short\n```\n\n### Step 3: Execute Codex Review\n\nExecute Codex CLI directly (progress displayed in real-time on STDERR):\n\n```bash\ncodex exec \"Review the following code changes and output issues and improvement suggestions:\n\nFiles: {changed_files}\n\n{file_contents}\"\n```\n\n> **Legacy mode**: Set `execution_mode: mcp` to use MCP (no progress display)\n\n**Configuration**:\n```yaml\n# .claude-code-harness.config.yaml\nreview:\n  codex:\n    model: gpt-5.2-codex        # Recommended (top-tier model)\n    # execution_mode: mcp       # Legacy: MCP (no progress display)\n```\n\n### Step 4: Claude Verification\n\n**Claude verifies Codex's findings and determines if fixes are needed.**\n\n```markdown\n## 🤖 Codex Review Results (Claude Verified)\n\n### Issues\n\n| File | Line | Severity | Content | Claude Verification |\n|------|------|----------|---------|---------------------|\n| src/api/users.ts | 45 | High | Possible SQL injection | ✅ Valid |\n| src/utils/calc.ts | 12 | Medium | Calculation precision issue | ⚠️ Needs confirmation |\n\n### Improvement Suggestions (Verified)\n\n1. Recommend using parameterized queries → **Fix recommended**\n2. Add input validation → **Fix recommended**\n```\n\n### Step 5: Fix Proposal and Approval\n\n```markdown\n## 🔧 Items Requiring Fixes\n\nAdd the following fixes to Plans.md and execute with `/work`?\n\n| # | Fix Content | File | Priority |\n|---|-------------|------|----------|\n| 1 | SQL injection protection | src/api/users.ts:45 | High |\n| 2 | Add input validation | src/api/users.ts | Medium |\n\n**Options:**\n1. Approve all → Add to Plans.md and run `/work`\n2. Approve selected → Specify numbers (e.g., 1)\n3. Don't fix now → Report only\n```\n\n### Step 6: Apply to Plans.md and Execute (On Approval)\n\n```\nUser approval\n    ↓\nAdd fix tasks to Plans.md:\n  - [ ] [bugfix] SQL injection protection (src/api/users.ts:45)\n  - [ ] [feature] Add input validation\n    ↓\nRun /work (or suggest execution)\n    ↓\nFix complete\n```\n\n---\n\n## Options\n\n```\n/codex-review              # Review all changed files\n/codex-review src/         # Specific directory only\n/codex-review --security   # Focus on security perspective\n```\n\n---\n\n## Difference from /harness-review\n\n| Command | Content |\n|---------|---------|\n| `/harness-review` | Full review by Claude (+ optional Codex) |\n| `/codex-review` | Codex standalone review |\n\n**Recommendation**: Normally use `/harness-review`, use `/codex-review` when additional second opinion is needed\n\n---\n\n## Related Commands\n\n- `/harness-review` - Full review (Claude + optional Codex)\n- `/harness-init` - Project initialization (includes Codex setup)\n",
        "commands/optional/crud.md": "---\ndescription: \"[Optional] Auto-generate CRUD (validation, auth, production-ready)\"\ndescription-en: \"[Optional] Auto-generate CRUD (validation, auth, production-ready)\"\n---\n\n# /crud - CRUD Auto-generation (Production-ready)\n\nAuto-generates CRUD functionality for specified entities (tables) at **production-ready level**.\n\n## VibeCoder Quick Reference\n\n- \"**Create CRUD for task management**\" → `/crud tasks`\n- \"**Want search and pagination too**\" → Includes all together\n- \"**Include permissions (who can view/edit)**\" → Sets up authorization/rules together\n\n## Deliverables\n\n- CRUD + validation + authorization + tests, **complete production-safe set**\n- Minimize diff to match existing DB/code\n\n**Features**:\n- ✅ Validation (Zod) auto-add\n- ✅ Auth/authorization (Row Level Security) auto-config\n- ✅ Relations (one-to-many, many-to-many) support\n- ✅ Pagination, search, filters\n- ✅ Auto-generated test cases\n\n---\n\n## 🔧 Auto-invoke Skills (Required)\n\n**This command must explicitly invoke the following skills with the Skill tool**:\n\n| Skill | Purpose | When to Call |\n|-------|---------|--------------|\n| `impl` | Implementation (parent skill) | CRUD feature implementation |\n| `verify` | Verification (parent skill) | Post-implementation verification |\n\n**How to call**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:impl\"      # CRUD feature implementation\n  skill: \"claude-code-harness:verify\"    # Build verification\n```\n\n**Child skills (auto-routing)**:\n- `work-impl-feature` - CRUD feature implementation\n- `verify-build` - Build verification\n- `core-diff-aware-editing` - Diff-aware editing\n\n> ⚠️ **Important**: Proceeding without calling skills won't record in usage statistics. Always call with Skill tool.\n\n---\n\n## Usage\n\n```\n/crud tasks\n```\n\n→ Generates CRUD functionality for `tasks` table\n\n---\n\n## Execution Flow\n\n### Step 1: Confirm Entity Name\n\nCheck user input. If no input, ask:\n\n> 🎯 **Which entity (table) should we create CRUD for?**\n>\n> Examples:\n> - `tasks` - Task management\n> - `posts` - Blog posts\n> - `products` - Products\n> - `bookings` - Reservations\n>\n> Singular or plural is OK!\n\n**Wait for response**\n\n### Step 2: Confirm Schema Design\n\n> 📋 **Are these fields OK?**\n>\n> ```typescript\n> // Example: tasks table\n> {\n>   id: string (UUID, auto-generated)\n>   title: string (required)\n>   description: string (optional)\n>   status: 'todo' | 'in_progress' | 'done' (default: 'todo')\n>   priority: 'low' | 'medium' | 'high' (default: 'medium')\n>   due_date: Date (optional)\n>   user_id: string (foreign key, auto-set)\n>   created_at: Date (auto-generated)\n>   updated_at: Date (auto-updated)\n> }\n> ```\n>\n> **Let me know if you want changes.**\n> Example: \"Add an assignee_id field\"\n\n**Wait for response (or \"OK\" to proceed)**\n\n### Step 3: Confirm Relations\n\n> 🔗 **Any relations to other tables?**\n>\n> Examples:\n> - \"tasks belong to one project\" (many-to-one)\n> - \"tasks have multiple tags\" (many-to-many)\n>\n> Answer \"none\" if there aren't any.\n\n**Wait for response**\n\n### Step 4: Files to Generate\n\nThe following files will be auto-generated:\n\n#### 1. Prisma Schema (`prisma/schema.prisma`)\n\n```prisma\nmodel Task {\n  id          String   @id @default(uuid())\n  title       String\n  description String?\n  status      TaskStatus @default(TODO)\n  priority    TaskPriority @default(MEDIUM)\n  due_date    DateTime?\n  user_id     String\n  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)\n  created_at  DateTime @default(now())\n  updated_at  DateTime @updatedAt\n\n  @@index([user_id])\n  @@index([status])\n  @@index([due_date])\n}\n\nenum TaskStatus {\n  TODO\n  IN_PROGRESS\n  DONE\n}\n\nenum TaskPriority {\n  LOW\n  MEDIUM\n  HIGH\n}\n```\n\n#### 2. Zod Validation Schema (`lib/validations/task.ts`)\n\n```typescript\nimport { z } from 'zod'\n\nexport const createTaskSchema = z.object({\n  title: z.string().min(1, 'Required').max(100, 'Must be 100 characters or less'),\n  description: z.string().max(1000, 'Must be 1000 characters or less').optional(),\n  status: z.enum(['todo', 'in_progress', 'done']).default('todo'),\n  priority: z.enum(['low', 'medium', 'high']).default('medium'),\n  due_date: z.string().datetime().optional(),\n})\n\nexport const updateTaskSchema = createTaskSchema.partial()\n\nexport const taskQuerySchema = z.object({\n  page: z.coerce.number().int().positive().default(1),\n  limit: z.coerce.number().int().positive().max(100).default(20),\n  status: z.enum(['todo', 'in_progress', 'done']).optional(),\n  priority: z.enum(['low', 'medium', 'high']).optional(),\n  search: z.string().optional(),\n  sort_by: z.enum(['created_at', 'due_date', 'priority']).default('created_at'),\n  sort_order: z.enum(['asc', 'desc']).default('desc'),\n})\n\nexport type CreateTaskInput = z.infer<typeof createTaskSchema>\nexport type UpdateTaskInput = z.infer<typeof updateTaskSchema>\nexport type TaskQuery = z.infer<typeof taskQuerySchema>\n```\n\n#### 3. API Routes (`app/api/tasks/route.ts`)\n\n```typescript\nimport { NextRequest, NextResponse } from 'next/server'\nimport { auth } from '@clerk/nextjs/server'\nimport { prisma } from '@/lib/prisma'\nimport { createTaskSchema, taskQuerySchema } from '@/lib/validations/task'\n\n// GET /api/tasks - Get task list (pagination, search, filter support)\nexport async function GET(req: NextRequest) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 })\n    }\n\n    const { searchParams } = new URL(req.url)\n    const query = taskQuerySchema.parse(Object.fromEntries(searchParams))\n\n    const where = {\n      user_id: userId,\n      ...(query.status && { status: query.status }),\n      ...(query.priority && { priority: query.priority }),\n      ...(query.search && {\n        OR: [\n          { title: { contains: query.search, mode: 'insensitive' } },\n          { description: { contains: query.search, mode: 'insensitive' } },\n        ],\n      }),\n    }\n\n    const [tasks, total] = await Promise.all([\n      prisma.task.findMany({\n        where,\n        orderBy: { [query.sort_by]: query.sort_order },\n        skip: (query.page - 1) * query.limit,\n        take: query.limit,\n      }),\n      prisma.task.count({ where }),\n    ])\n\n    return NextResponse.json({\n      data: tasks,\n      meta: {\n        page: query.page,\n        limit: query.limit,\n        total,\n        total_pages: Math.ceil(total / query.limit),\n      },\n    })\n  } catch (error) {\n    console.error('GET /api/tasks error:', error)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n\n// POST /api/tasks - Create task\nexport async function POST(req: NextRequest) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 })\n    }\n\n    const body = await req.json()\n    const data = createTaskSchema.parse(body)\n\n    const task = await prisma.task.create({\n      data: {\n        ...data,\n        user_id: userId,\n      },\n    })\n\n    return NextResponse.json(task, { status: 201 })\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ error: error.errors }, { status: 400 })\n    }\n    console.error('POST /api/tasks error:', error)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n```\n\n#### 4. Individual API Routes (`app/api/tasks/[id]/route.ts`)\n\n```typescript\nimport { NextRequest, NextResponse } from 'next/server'\nimport { auth } from '@clerk/nextjs/server'\nimport { prisma } from '@/lib/prisma'\nimport { updateTaskSchema } from '@/lib/validations/task'\n\n// GET /api/tasks/:id - Get task details\nexport async function GET(\n  req: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 })\n    }\n\n    const task = await prisma.task.findUnique({\n      where: { id: params.id },\n    })\n\n    if (!task) {\n      return NextResponse.json({ error: 'Task not found' }, { status: 404 })\n    }\n\n    // Authorization: can only get own tasks\n    if (task.user_id !== userId) {\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 })\n    }\n\n    return NextResponse.json(task)\n  } catch (error) {\n    console.error(`GET /api/tasks/${params.id} error:`, error)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n\n// PATCH /api/tasks/:id - Update task\nexport async function PATCH(\n  req: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 })\n    }\n\n    const existingTask = await prisma.task.findUnique({\n      where: { id: params.id },\n    })\n\n    if (!existingTask) {\n      return NextResponse.json({ error: 'Task not found' }, { status: 404 })\n    }\n\n    // Authorization: can only update own tasks\n    if (existingTask.user_id !== userId) {\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 })\n    }\n\n    const body = await req.json()\n    const data = updateTaskSchema.parse(body)\n\n    const task = await prisma.task.update({\n      where: { id: params.id },\n      data,\n    })\n\n    return NextResponse.json(task)\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ error: error.errors }, { status: 400 })\n    }\n    console.error(`PATCH /api/tasks/${params.id} error:`, error)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n\n// DELETE /api/tasks/:id - Delete task\nexport async function DELETE(\n  req: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 })\n    }\n\n    const existingTask = await prisma.task.findUnique({\n      where: { id: params.id },\n    })\n\n    if (!existingTask) {\n      return NextResponse.json({ error: 'Task not found' }, { status: 404 })\n    }\n\n    // Authorization: can only delete own tasks\n    if (existingTask.user_id !== userId) {\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 })\n    }\n\n    await prisma.task.delete({\n      where: { id: params.id },\n    })\n\n    return NextResponse.json({ message: 'Deleted' })\n  } catch (error) {\n    console.error(`DELETE /api/tasks/${params.id} error:`, error)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n```\n\n#### 5. Frontend Component (`components/tasks/task-list.tsx`)\n\n```typescript\n'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useAuth } from '@clerk/nextjs'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Select } from '@/components/ui/select'\nimport { TaskCard } from './task-card'\n\nexport function TaskList() {\n  const { getToken } = useAuth()\n  const [tasks, setTasks] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [search, setSearch] = useState('')\n  const [status, setStatus] = useState('')\n  const [page, setPage] = useState(1)\n\n  useEffect(() => {\n    fetchTasks()\n  }, [search, status, page])\n\n  const fetchTasks = async () => {\n    setLoading(true)\n    try {\n      const token = await getToken()\n      const params = new URLSearchParams({\n        page: page.toString(),\n        ...(search && { search }),\n        ...(status && { status }),\n      })\n      const res = await fetch(`/api/tasks?${params}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n      const data = await res.json()\n      setTasks(data.data)\n    } catch (error) {\n      console.error('Failed to fetch tasks:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div>\n      <div className=\"mb-4 flex gap-4\">\n        <Input\n          placeholder=\"Search...\"\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n        />\n        <Select value={status} onValueChange={setStatus}>\n          <option value=\"\">All</option>\n          <option value=\"todo\">Not started</option>\n          <option value=\"in_progress\">In progress</option>\n          <option value=\"done\">Done</option>\n        </Select>\n      </div>\n\n      {loading ? (\n        <p>Loading...</p>\n      ) : (\n        <div className=\"grid gap-4\">\n          {tasks.map((task) => (\n            <TaskCard key={task.id} task={task} onUpdate={fetchTasks} />\n          ))}\n        </div>\n      )}\n\n      <div className=\"mt-4 flex justify-center gap-2\">\n        <Button onClick={() => setPage(p => Math.max(1, p - 1))} disabled={page === 1}>\n          Previous\n        </Button>\n        <span>Page {page}</span>\n        <Button onClick={() => setPage(p => p + 1)}>\n          Next\n        </Button>\n      </div>\n    </div>\n  )\n}\n```\n\n#### 6. Test Cases (`__tests__/api/tasks.test.ts`)\n\n```typescript\nimport { describe, it, expect, beforeEach } from 'vitest'\nimport { createMocks } from 'node-mocks-http'\nimport { GET, POST } from '@/app/api/tasks/route'\n\ndescribe('/api/tasks', () => {\n  beforeEach(() => {\n    // Mock setup\n  })\n\n  describe('GET', () => {\n    it('returns 401 without auth', async () => {\n      const { req } = createMocks({ method: 'GET' })\n      const res = await GET(req as any)\n      expect(res.status).toBe(401)\n    })\n\n    it('can get task list', async () => {\n      // Test code\n    })\n\n    it('pagination works', async () => {\n      // Test code\n    })\n\n    it('search works', async () => {\n      // Test code\n    })\n  })\n\n  describe('POST', () => {\n    it('can create task', async () => {\n      // Test code\n    })\n\n    it('returns validation error', async () => {\n      // Test code\n    })\n  })\n})\n```\n\n### Step 5: Supabase RLS (Row Level Security) Setup\n\nIf using Supabase, auto-configure the following RLS policies:\n\n```sql\n-- Enable RLS for tasks table\nALTER TABLE tasks ENABLE ROW LEVEL SECURITY;\n\n-- SELECT: Can only view own tasks\nCREATE POLICY \"Users can view their own tasks\"\nON tasks FOR SELECT\nUSING (auth.uid() = user_id);\n\n-- INSERT: Can only create own tasks\nCREATE POLICY \"Users can create their own tasks\"\nON tasks FOR INSERT\nWITH CHECK (auth.uid() = user_id);\n\n-- UPDATE: Can only update own tasks\nCREATE POLICY \"Users can update their own tasks\"\nON tasks FOR UPDATE\nUSING (auth.uid() = user_id);\n\n-- DELETE: Can only delete own tasks\nCREATE POLICY \"Users can delete their own tasks\"\nON tasks FOR DELETE\nUSING (auth.uid() = user_id);\n```\n\n### Step 6: Guide Next Actions\n\n> ✅ **CRUD functionality complete!**\n>\n> 📄 **Generated files**:\n> - `prisma/schema.prisma` - Database schema\n> - `lib/validations/task.ts` - Validation\n> - `app/api/tasks/route.ts` - API (list, create)\n> - `app/api/tasks/[id]/route.ts` - API (detail, update, delete)\n> - `components/tasks/task-list.tsx` - Frontend\n> - `__tests__/api/tasks.test.ts` - Test cases\n> - `supabase/migrations/{{timestamp}}_tasks_rls.sql` - RLS policies\n>\n> **Next steps:**\n> 1. Run `npx prisma migrate dev --name add_tasks`\n> 2. Run tests: `npm test`\n> 3. Verify: `npm run dev`\n>\n> 💡 **Hint**: To add other entities, run `/crud {{entity_name}}`.\n\n---\n\n## Relations Support\n\n### One-to-Many (Many-to-One)\n\n**Example**: tasks belong to one project\n\n```prisma\nmodel Task {\n  // ...\n  project_id String\n  project    Project @relation(fields: [project_id], references: [id], onDelete: Cascade)\n}\n\nmodel Project {\n  id    String @id @default(uuid())\n  name  String\n  tasks Task[]\n}\n```\n\n### Many-to-Many\n\n**Example**: tasks have multiple tags\n\n```prisma\nmodel Task {\n  // ...\n  tags TaskTag[]\n}\n\nmodel Tag {\n  id    String    @id @default(uuid())\n  name  String    @unique\n  tasks TaskTag[]\n}\n\nmodel TaskTag {\n  task_id String\n  tag_id  String\n  task    Task   @relation(fields: [task_id], references: [id], onDelete: Cascade)\n  tag     Tag    @relation(fields: [tag_id], references: [id], onDelete: Cascade)\n\n  @@id([task_id, tag_id])\n}\n```\n\n---\n\n## Notes\n\n- **Production-ready**: Complete with validation, authorization, error handling\n- **Security**: RLS prevents access to others' data\n- **Performance**: Optimized with indexes, pagination\n- **Testing**: Auto-generated test cases for quality assurance\n- **Extensibility**: Supports relations, custom fields\n\n**Code generated by this command is ready for production use.**\n",
        "commands/optional/dev-tools-setup.md": "---\ndescription: 開発ツール (AST-Grep, LSP) を一括セットアップ\ndescription-en: Setup development tools (AST-Grep, LSP) in one command\n---\n\n# /dev-tools-setup - Development Tools Setup\n\nSetup AST-Grep and LSP to enable advanced code intelligence features.\n\n---\n\n## Why MCP? (設計意図)\n\nAST-Grep や LSP を「ただインストールするだけ」では、Claude は標準ツール（Grep, Read, Bash など）を使い続けてしまいます。\n\n**MCP 化することで**:\n\n| 課題 | MCP による解決 |\n|------|---------------|\n| Claude が `sg` コマンドを知らない | `harness_ast_search` として明示的に提供 |\n| スキルから呼び出せない | MCP ツールとしてスキル内で参照可能 |\n| 使い方が不明確 | ツール説明に用途・パターンを記載 |\n\n**結果**: `/harness-review` や review スキルが自動的に `harness_ast_search` を使用し、コードスメル検出の精度が向上します。\n\n---\n\n## What This Enables\n\nAfter setup, these MCP tools become available:\n\n| Tool | Purpose |\n|------|---------|\n| `harness_ast_search` | Structural code pattern search |\n| `harness_lsp_references` | Find all symbol references |\n| `harness_lsp_definition` | Go to symbol definition |\n| `harness_lsp_diagnostics` | Get code diagnostics |\n| `harness_lsp_hover` | Get type information |\n\n---\n\n## Execution Flow\n\n### Step 1: Detect Project Languages\n\n```bash\n# Auto-detect languages\nls package.json 2>/dev/null && echo \"TypeScript/JavaScript detected\"\nls requirements.txt pyproject.toml 2>/dev/null && echo \"Python detected\"\nls Cargo.toml 2>/dev/null && echo \"Rust detected\"\nls go.mod 2>/dev/null && echo \"Go detected\"\n```\n\n### Step 2: Check AST-Grep Installation\n\n```bash\n# Check if ast-grep is installed\nwhich sg || echo \"AST-Grep not found\"\n```\n\n**If not installed, suggest:**\n\n| Platform | Install Command |\n|----------|-----------------|\n| macOS | `brew install ast-grep` |\n| npm (any) | `npm install -g @ast-grep/cli` |\n| Cargo (any) | `cargo install ast-grep --locked` |\n\n### Step 3: Check LSP Installation\n\nBased on detected languages:\n\n| Language | Check Command | Install Command |\n|----------|---------------|-----------------|\n| TypeScript/JS | `which typescript-language-server` | `npm install -g typescript-language-server typescript` |\n| Python | `which pylsp` | `pip install python-lsp-server` |\n| Rust | `which rust-analyzer` | `rustup component add rust-analyzer` |\n| Go | `which gopls` | `go install golang.org/x/tools/gopls@latest` |\n\n### Step 4: Configure MCP Server\n\nMCP ツールを有効にするため、harness MCP サーバーを設定します。\n\n#### 4.1: MCP サーバービルド確認\n\n```bash\n# MCP サーバーがビルド済みか確認\nls \"${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js\" 2>/dev/null || echo \"Not built\"\n```\n\n**ビルドされていない場合:**\n\n```bash\ncd \"${CLAUDE_PLUGIN_ROOT}/mcp-server\"\nnpm install\nnpm run build\n```\n\n#### 4.2: 設定スコープの選択（ユーザー確認必須）\n\n> 🔴 **AskUserQuestion ツールで確認すること**\n\nユーザーに以下を確認:\n\n```\nMCP サーバーの設定スコープを選択してください:\n\n1. グローバル設定（推奨）\n   - ~/.mcp.json に設定\n   - すべてのプロジェクトで harness MCP ツールが使用可能\n   - 一度設定すれば他のプロジェクトで再設定不要\n\n2. プロジェクト固有設定\n   - .mcp.json（プロジェクトルート）に設定\n   - このプロジェクトのみで使用可能\n   - リポジトリに含めてチームで共有可能\n```\n\n#### 4.3: 設定ファイル作成\n\n**グローバル設定の場合:**\n\n`~/.mcp.json` に追加:\n\n```json\n{\n  \"mcpServers\": {\n    \"harness\": {\n      \"command\": \"node\",\n      \"args\": [\"${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js\"]\n    }\n  }\n}\n```\n\n```bash\n# ~/.mcp.json が存在しない場合は作成\nif [ ! -f ~/.mcp.json ]; then\n  cat > ~/.mcp.json << 'EOF'\n{\n  \"mcpServers\": {\n    \"harness\": {\n      \"command\": \"node\",\n      \"args\": [\"${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js\"]\n    }\n  }\n}\nEOF\n  echo \"Created ~/.mcp.json (global)\"\nelse\n  echo \"~/.mcp.json already exists - please add harness MCP server manually\"\nfi\n```\n\n**プロジェクト固有設定の場合:**\n\n`.mcp.json`（プロジェクトルート）に追加:\n\n```bash\n# .mcp.json が存在しない場合は作成\nif [ ! -f .mcp.json ]; then\n  cat > .mcp.json << 'EOF'\n{\n  \"mcpServers\": {\n    \"harness\": {\n      \"command\": \"node\",\n      \"args\": [\"${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js\"]\n    }\n  }\n}\nEOF\n  echo \"Created .mcp.json (project)\"\nelse\n  echo \".mcp.json already exists - please add harness MCP server manually\"\nfi\n```\n\n#### 4.4: 動作確認\n\n```bash\n# Claude Code を再起動後、MCP ツールが利用可能か確認\n# harness_ast_search, harness_lsp_* などが使用可能になる\n```\n\n### Step 5: Report Status\n\n```markdown\n## 🔧 Development Tools Status\n\n### AST-Grep\n- Status: ✅ Installed / ❌ Not Installed\n- Version: x.x.x\n- Command: `sg`\n\n### Language Servers\n\n| Language | Status | Server |\n|----------|--------|--------|\n| TypeScript | ✅/❌ | typescript-language-server |\n| Python | ✅/❌ | pylsp |\n\n### MCP Server\n- Status: ✅ Configured / ❌ Not Configured\n- Config: `.mcp.json`\n\n### Available MCP Tools\n\nAfter setup complete:\n- `harness_ast_search` - Structural code search\n- `harness_lsp_references` - Find references\n- `harness_lsp_definition` - Go to definition\n- `harness_lsp_diagnostics` - Get diagnostics\n- `harness_lsp_hover` - Type information\n\n### Next Steps\n\n1. Install missing tools (commands shown above)\n2. Restart Claude Code session\n3. MCP tools are now available in your workflow\n```\n\n---\n\n## Usage Examples\n\n### After Setup: AST-Grep Search\n\n```bash\n# Find all console.log calls\nharness_ast_search pattern=\"console.log($$$)\" language=\"typescript\"\n\n# Find empty catch blocks (code smell)\nharness_ast_search pattern=\"catch ($ERR) { }\" language=\"typescript\"\n\n# Find async functions without await\nharness_ast_search pattern=\"async function $NAME($$$) { $BODY }\" language=\"typescript\"\n```\n\n### After Setup: LSP Analysis\n\n```bash\n# Find references to a function\nharness_lsp_references file=\"src/utils.ts\" line=10 column=5\n\n# Get diagnostics for a file\nharness_lsp_diagnostics file=\"src/components/App.tsx\"\n```\n\n---\n\n## Integration with /harness-review\n\nWhen AST-Grep is installed, `/harness-review` automatically:\n\n1. Detects code smells:\n   - `console.log` remnants\n   - Empty catch blocks\n   - Unused async/await\n   - Magic numbers\n\n2. Reports findings in review output\n\n---\n\n## VibeCoder Hints\n\n| What You Want | How to Say |\n|---------------|------------|\n| Setup tools | \"setup development tools\" |\n| Check installation | \"are AST and LSP installed?\" |\n| Search patterns | \"find all console.log\" |\n| Find references | \"where is this function used?\" |\n\n---\n\n## Troubleshooting\n\n### AST-Grep not working\n\n```bash\n# Check installation\nwhich sg\nsg --version\n\n# Test search\nsg --pattern \"console.log\" --lang typescript .\n```\n\n### LSP not working\n\n```bash\n# Check TypeScript server\nwhich typescript-language-server\ntypescript-language-server --version\n\n# Check if tsconfig.json exists\nls tsconfig.json\n```\n\n### Still issues?\n\n1. Restart Claude Code session\n2. Check PATH environment variable\n3. Try manual installation commands\n\n---\n\n## Related Commands\n\n- `/harness-review` - Code review (uses AST-Grep when available)\n- `/lsp-setup` - LSP-only setup (legacy)\n- `/mcp-setup` - MCP server configuration\n",
        "commands/optional/generate-video.md": "---\ndescription: コードベースから説明動画を自動生成\ndescription-en: Auto-generate explainer videos from codebase\n---\n\n# /generate-video - 動画自動生成\n\nコードベースを分析し、プロダクトデモ・アーキテクチャ解説・リリースノート動画を自動生成します。\n\n## VibeCoder Quick Reference\n\n- \"**動画作りたい**\" → このコマンド\n- \"**プロダクト紹介動画**\" → このコマンド\n- \"**リリース動画**\" → このコマンド\n- \"**デモ動画**\" → このコマンド\n\n---\n\n## ベストプラクティス\n\n> **詳細**: [skills/video/references/best-practices.md](../../skills/video/references/best-practices.md)\n\n### 基本原則\n\n| 原則 | 説明 |\n|------|------|\n| **痛みから始める** | 機能羅列ではなく、視聴者の課題解決を示す |\n| **冒頭は本題優先** | ロゴや会社紹介を長く出さない |\n| **CTAは途中にも** | 最後だけでなく中間地点にも配置 |\n| **優先順位** | 音質 > 画面の可読性 > テンポ > 見た目 |\n\n### ファネル別推奨構成\n\n| 目的（ファネル） | 動画タイプ | 長さ | 構成の芯 |\n|------------------|------------|------|----------|\n| 認知〜興味 | LP/広告ティザー | 30-90秒 | 痛み→結果→CTA |\n| 興味→検討 | Introデモ | 2-3分 | 1ユースケース完走 |\n| 検討→確信 | セールスデモ | 2-5分 | 反論を先に潰す |\n| 確信→決裁 | ウォークスルー | 5-30分 | 実運用+証拠 |\n\n### 推奨3本セット\n\n最短で成果を出すための基本セット:\n\n1. **90秒ティザー** - 認知獲得（LP/広告用）\n2. **3分Introデモ** - 検討促進\n3. **15〜25分ウォークスルー** - 成約支援\n\n---\n\n## Prerequisites\n\n- Remotion セットアップ済み（未設定の場合は `/remotion-setup` を案内）\n- Node.js 18+\n\n---\n\n## Usage\n\n```bash\n/generate-video\n```\n\n**引数なし**。インタラクティブフローで進行します。\n\n---\n\n## Execution Flow\n\n```\n/generate-video\n    │\n    ├─[Step 1] Remotion セットアップ確認\n    │   └─ 未設定 → /remotion-setup を案内して終了\n    │\n    ├─[Step 2] 分析済みかチェック\n    │   └─ 未分析 → analyzer.md で分析実行\n    │\n    ├─[Step 3] シナリオ提案 + ユーザー確認\n    │   └─ planner.md でシーン構成を提案\n    │   └─ AskUserQuestion で承認/編集/キャンセル\n    │\n    └─[Step 4] 並列生成\n        └─ generator.md で Task tool 並列起動\n        └─ 統合 + レンダリング\n```\n\n---\n\n## Step 1: Remotion セットアップ確認\n\n```bash\n# remotion ディレクトリまたは依存関係を確認\nls remotion/ 2>/dev/null || grep -q '\"remotion\"' package.json 2>/dev/null\n```\n\n**未設定の場合**:\n\n> ⚠️ **Remotion が未セットアップです**\n>\n> 動画生成には Remotion が必要です。\n> `/remotion-setup` を実行してセットアップしてください。\n\n→ **コマンド終了**\n\n---\n\n## Step 2: コードベース分析\n\n**See**: [skills/video/references/analyzer.md](../../skills/video/references/analyzer.md)\n\n分析対象:\n- フレームワーク検出（Next.js, React, Vue, etc.）\n- 主要機能検出（認証, 決済, ダッシュボード, API）\n- UIコンポーネント数\n- プロジェクト資産（package.json, README, Plans.md, CHANGELOG）\n- 最近の変更点\n\n**出力例**:\n\n```\n📊 プロジェクト分析完了\n\n| 項目 | 結果 |\n|------|------|\n| プロジェクト名 | MyApp |\n| フレームワーク | Next.js 14 |\n| ページ数 | 12 |\n| 検出機能 | 認証, ダッシュボード, API |\n\n🎬 推奨動画タイプ: プロダクトデモ\n   理由: UIコンポーネントの追加が検出されました\n```\n\n---\n\n## Step 3: シナリオ提案 + ユーザー確認\n\n**See**: [skills/video/references/planner.md](../../skills/video/references/planner.md)\n\n**シナリオ提案**:\n\n```markdown\n🎬 シナリオプラン\n\n**動画タイプ**: プロダクトデモ\n**合計時間**: 45秒\n\n| # | シーン | 時間 | 内容 | ソース |\n|---|--------|------|------|--------|\n| 1 | イントロ | 5秒 | MyApp - タスク管理を簡単に | テンプレート |\n| 2 | 認証フロー | 15秒 | ログイン画面のデモ | Playwright |\n| 3 | ダッシュボード | 20秒 | メイン機能の紹介 | Playwright |\n| 4 | CTA | 5秒 | myapp.com | テンプレート |\n```\n\n**AskUserQuestion**:\n\n```\nquestion: \"このシナリオで動画を生成しますか？\"\nheader: \"シナリオ確認\"\noptions:\n  - label: \"OK、生成開始\"\n    description: \"このシーン構成で動画を生成します\"\n  - label: \"編集したい\"\n    description: \"シーンの追加/削除/変更を行います\"\n  - label: \"キャンセル\"\n    description: \"動画生成を中止します\"\n```\n\n### 編集モード\n\n「編集したい」を選択した場合:\n\n```\n📝 シナリオ編集\n\n以下の指示で編集できます：\n- 「機能Xのデモを追加」\n- 「シーン2を削除」\n- 「イントロを3秒に短縮」\n- 「シーン2と3を入れ替え」\n- 「これでOK」で確定\n\n何を編集しますか？\n```\n\n---\n\n## Step 4: 並列生成\n\n**See**: [skills/video/references/generator.md](../../skills/video/references/generator.md)\n\n### 並列数決定\n\n| シーン数 | 並列数 |\n|---------|--------|\n| 1-2 | 1-2 |\n| 3-4 | 3 |\n| 5+ | 5 |\n\n### Task Tool で並列起動\n\n各シーンに対して `video-scene-generator` サブエージェントを起動:\n\n```\nTask:\n  subagent_type: \"video-scene-generator\"\n  run_in_background: true\n  prompt: |\n    以下のシーンを Remotion コンポジションとして生成してください。\n\n    シーン情報:\n    - ID: {scene.id}\n    - 名前: {scene.name}\n    - 時間: {scene.duration}秒\n    - テンプレート: {scene.template}\n    - 内容: {scene.content}\n```\n\n### 進捗モニタリング\n\n```\n🎬 並列生成中... (2/4 完了)\n\n├── [Agent 1] intro ✅ (5秒)\n├── [Agent 2] auth-demo ✅ (15秒)\n├── [Agent 3] dashboard ⏳ 生成中...\n└── [Agent 4] cta 🔜 待機中\n```\n\n### 統合 + レンダリング\n\n1. シーン結合（Series/TransitionSeries）\n2. トランジション追加（fade）\n3. 最終レンダリング\n\n```bash\nnpx remotion render remotion/index.ts FullVideo out/video.mp4\n```\n\n---\n\n## 完了報告\n\n```markdown\n✅ **動画生成完了**\n\n📁 **出力ファイル**:\n- `out/video.mp4` (45秒, 1080p, 12.3MB)\n\n📊 **生成統計**:\n| 項目 | 値 |\n|------|-----|\n| シーン数 | 4 |\n| 並列エージェント数 | 3 |\n| 生成時間 | 45秒 |\n| レンダリング時間 | 30秒 |\n\n🎬 **プレビュー**:\n- Studio: `npm run remotion` → http://localhost:3000\n- ファイル: `open out/video.mp4`\n\n**次のステップ**:\n- 編集: Remotion Studio で微調整\n- 再生成: `/generate-video` で別のシナリオを試す\n```\n\n---\n\n## 動画タイプ別フロー（ファネル対応）\n\n### LP/広告ティザー（30-90秒）\n\n**ファネル**: 認知〜興味\n\n```\nHook (3-5秒) → ProblemPromise (5-15秒) → WorkflowDemo (20-60秒) → Differentiator (10秒) → CTA (10秒)\n```\n\n- 冒頭で痛みを提示（「また手動で...」）\n- 機能羅列ではなく1つの象徴的なワークフローを見せる\n- Before/After で差別化の根拠を示す\n\n### Introデモ（2-3分）\n\n**ファネル**: 興味→検討\n\n```\nHook (10秒) → UseCase宣言 (20秒) → 実画面Demo (110秒) → Objection (30秒) → CTA (10秒)\n```\n\n- 1ユースケースを最短で完走させる\n- 専門用語を避けて分解しながら説明\n- よくある不安を1つ先に潰す\n\n### プロダクトデモ（3-5分）\n\n**ファネル**: 検討→確信\n\n```\nイントロ → 機能紹介×N → UIデモ×N → 反論処理 → CTA\n```\n\n- Playwright で実際のUI操作をキャプチャ\n- アプリが起動している必要あり\n- 反論トップ3を先回りで潰す\n\n### アーキテクチャ解説（5-30分）\n\n**ファネル**: 確信→決裁\n\n```\nイントロ → 概要図 → 詳細解説×N → データフロー → 管理/セキュリティ → CTA\n```\n\n- Mermaid 図をアニメーション化\n- `.claude/memory/decisions.md` から技術的背景を抽出\n- チャプター設計必須\n\n### リリースノート（1-3分）\n\n**ファネル**: 継続・活用\n\n```\nイントロ → バージョン → 変更点リスト → Before/After → 新機能デモ → CTA\n```\n\n- CHANGELOG.md から変更点を抽出\n- 新機能があれば Playwright デモ\n\n---\n\n## エラーハンドリング\n\n### Remotion 未セットアップ\n\n```\n⚠️ Remotion が未セットアップです\n→ /remotion-setup を実行してください\n```\n\n### アプリ未起動（Playwrightシーン）\n\n```\n⚠️ アプリが起動していません\n\nPlaywright によるUIキャプチャには、アプリが起動している必要があります。\n\n対処:\n1. `npm run dev` でアプリを起動\n2. 再度 `/generate-video` を実行\n\nまたは、UIデモシーンをスキップしますか？\n```\n\n### レンダリング失敗\n\n```\n⚠️ レンダリングエラー\n\n原因: メモリ不足\n\n対処:\n1. 並列数を減らす\n2. 解像度を下げる（720p）\n3. シーンを分割\n```\n\n---\n\n## Related Commands\n\n- `/remotion-setup` - Remotion 環境セットアップ\n\n---\n\n## Technical References\n\n- [Remotion公式ドキュメント](https://www.remotion.dev/docs)\n- [Remotion Agent Skills](https://www.remotion.dev/docs/ai/skills)\n- [Playwright MCP](https://github.com/anthropics/mcp-server-playwright)\n",
        "commands/optional/harness-mem.md": "---\ndescription: Claude-mem integration setup for cross-session memory\ndescription-en: Claude-mem integration setup for cross-session memory\n---\n\n# /harness-mem - Claude-mem Integration Setup\n\nCustomize Claude-mem for harness specifications to enhance cross-session quality and context maintenance.\n\n---\n\n## VibeCoder Phrases\n\n- \"**Integrate with Claude-mem**\" → this command\n- \"**Enable cross-session memory**\" → this command\n- \"**Set up harness-mem**\" → this command\n\n## Deliverables\n\n- **Harness-specific mode settings for Claude-mem**: Auto-record guardrail activations, Plans.md updates, and SSOT changes\n- **Cross-session learning**: Utilize past mistakes and solutions in future sessions\n- **Japanese localization option**: Record observations and summaries in Japanese\n\n---\n\n## Prerequisites\n\nClaude-mem plugin must be installed.\nIf not installed, this command will support the installation.\n\n---\n\n## Execution Flow\n\n### Step 0: OS Detection\n\n```bash\n# Detect OS\nif [[ \"$OSTYPE\" == \"msys\" ]] || [[ \"$OSTYPE\" == \"cygwin\" ]] || [[ -n \"$WINDIR\" ]]; then\n  OS_TYPE=\"windows\"\nelif [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n  OS_TYPE=\"mac\"\nelse\n  OS_TYPE=\"linux\"\nfi\necho \"Detected OS: $OS_TYPE\"\n```\n\n---\n\n### Step 0.5: Bun Installation Check\n\nClaude-mem v7.3.7 and later uses Bun-based workers, so Bun installation is required.\n\n```bash\n# Check if Bun is installed\nif command -v bun &> /dev/null; then\n  echo \"✅ Bun is installed: $(bun --version)\"\nelse\n  echo \"⚠️ Bun is not installed\"\nfi\n```\n\n**If Bun is not installed**:\n\n> ⚠️ **Bun is not installed**\n>\n> Bun is required for Claude-mem operation.\n>\n> Install now?\n> 1. **Yes** - Install now (Recommended)\n> 2. **No** - Install manually\n\n**If \"Yes\"** - OS-specific installation:\n\n**macOS / Linux / WSL**:\n\n```bash\n# Official install script\ncurl -fsSL https://bun.sh/install | bash\n\n# Apply path after installation\nsource ~/.bashrc  # or source ~/.zshrc\n\n# Verify\nbun --version\n```\n\n**Windows (PowerShell)**:\n\n```powershell\n# Official install script\npowershell -c \"irm bun.sh/install.ps1 | iex\"\n\n# Or install via npm\nnpm install -g bun\n\n# Verify\nbun --version\n```\n\n**After installation**: Proceed to Step 1\n\n---\n\n**If Windows is detected**:\n\n```bash\n# Check claude-mem version\ncat ~/.claude/plugins/marketplaces/thedotmack/plugin/package.json | grep version\n```\n\n> **Recommendations vary by claude-mem version**\n>\n> | Version | Recommendation |\n> |---------|----------------|\n> | **v7.3.7+** | ✅ Can work natively on Windows (improved) |\n> | **v7.3.6 or earlier** | ⚠️ WSL strongly recommended (port 37777 issues frequent) |\n>\n> ---\n>\n> ### For v7.3.7+\n>\n> Native Windows operation has been significantly improved:\n> - Automatic zombie process cleanup\n> - Extended worker startup timeout (30 seconds)\n> - Bun-based worker wrapper\n>\n> **→ Proceed to Step 3.5 (Windows Settings).**\n>\n> ---\n>\n> ### For v7.3.6 or earlier\n>\n> **WSL usage is strongly recommended.**\n>\n> **Root causes**:\n> - PowerShell script (.ps1) execution issues\n> - Broken file associations\n> - Zombie processes occupying ports\n>\n> **Why it doesn't occur in WSL**:\n> - Shell scripts execute natively\n> - No dependency on file associations\n> - Unix standard process management\n>\n> | Option | Recommendation |\n> |--------|----------------|\n> | **Run Claude Code in WSL** | ⭐⭐⭐ Strongly recommended |\n> | Windows native | ⚠️ High risk of issues |\n>\n> **→ Proceed to Step 3.6 (WSL Setup).**\n>\n> ---\n>\n> ### Upgrade Recommended\n>\n> If using v7.3.6 or earlier, upgrade to the latest version is recommended:\n>\n> ```bash\n> /plugin marketplace remove thedotmack/claude-mem\n> /plugin marketplace add thedotmack/claude-mem\n> /plugin install claude-mem\n> ```\n\n---\n\n### Step 1: Claude-mem Installation Detection\n\n```bash\n# Check if Claude-mem plugin exists\nls ~/.claude/plugins/marketplaces/thedotmack 2>/dev/null\n```\n\n**If installed**: Proceed to Step 2\n\n**If not installed**:\n\n> ⚠️ **Claude-mem is not installed**\n>\n> Claude-mem installation is required to use cross-session\n> quality and context maintenance features.\n>\n> **What is Claude-mem?**\n> - Plugin that persists context across sessions\n> - Auto-records and enables search of past work history\n> - Combined with harness, quality improves cumulatively\n>\n> Install now?\n> 1. **Yes** - Install now (Recommended)\n> 2. **No** - Continue without Claude-mem\n\n**If \"Yes\"**:\n\n```bash\n# Add from marketplace\n/plugin marketplace add thedotmack/claude-mem\n\n# Install\n/plugin install claude-mem\n```\n\nIf successful, proceed to Step 2. If failed, display error message and manual installation instructions.\n\n---\n\n### Step 2: Japanese Localization Option\n\n> 🌐 **Do you want Claude-mem records in Japanese?**\n>\n> | Option | Description |\n> |--------|-------------|\n> | **Japanese** | Observations, summaries, and search results recorded in Japanese |\n> | **English** | Default setting (records in English) |\n>\n> 1. **Use Japanese** (Recommended for Japanese environments)\n> 2. **Keep English**\n\n**Record selection**: `$HARNESS_MEM_LANG` = `ja` or `en`\n\n---\n\n### Step 3: Mode File Deployment\n\nDeploy harness-specific mode file to Claude-mem.\n\n```bash\n# Mode file destination (official location)\nCLAUDE_MEM_MODES_DIR=\"$HOME/.claude-mem/modes\"\n\n# Create directory if it doesn't exist\nmkdir -p \"$CLAUDE_MEM_MODES_DIR\"\n\n# Copy harness.json\ncp templates/modes/harness.json \"$CLAUDE_MEM_MODES_DIR/\"\n\n# If Japanese version selected\nif [ \"$HARNESS_MEM_LANG\" = \"ja\" ]; then\n  cp templates/modes/harness--ja.json \"$CLAUDE_MEM_MODES_DIR/\"\nfi\n```\n\n---\n\n### Step 3.5: Windows-Specific Settings (Windows only)\n\n> **claude-mem v7.3.7+**: Native Windows operation improved ✅\n>\n> **v7.3.6 or earlier**: The following issues may occur ⚠️\n>\n> | Issue | Cause | v7.3.7 Fix |\n> |-------|-------|------------|\n> | Worker startup failure | PowerShell (.ps1) execution issues | Migrated to Bun wrapper |\n> | port 37777 timeout | Zombie processes | Auto process cleanup |\n> | Startup wait timeout | Too short timeout | Extended to 30 seconds |\n>\n> **If using v7.3.6 or earlier**: Upgrade to latest version or proceed to Step 3.6 (WSL) recommended\n\nWindows cannot directly execute `.sh` files, so additional configuration is required.\n\n> ⚠️ **Windows environment detected**\n>\n> The following settings are required for Claude-mem to work correctly:\n>\n> 1. **MCP settings adjustment**: Use `cmd /c` wrapper\n> 2. **Path format conversion**: Support Windows path format\n\n**Settings file update**:\n\nAdd the following to project's `.mcp.json` or `~/.claude/mcp.json`:\n\n```json\n{\n  \"mcpServers\": {\n    \"claude-mem\": {\n      \"command\": \"cmd\",\n      \"args\": [\"/c\", \"npx\", \"-y\", \"claude-mem-mcp\"],\n      \"env\": {\n        \"CLAUDE_MEM_MODE\": \"harness\"\n      }\n    }\n  }\n}\n```\n\n**Alternative settings (npx full path)**:\n\nIf npx is not found, specify the full path:\n\n```json\n{\n  \"mcpServers\": {\n    \"claude-mem\": {\n      \"command\": \"C:\\\\Program Files\\\\nodejs\\\\npx.cmd\",\n      \"args\": [\"-y\", \"claude-mem-mcp\"],\n      \"env\": {\n        \"CLAUDE_MEM_MODE\": \"harness\"\n      }\n    }\n  }\n}\n```\n\n**If using WSL (Recommended)**:\n\nIf running Claude Code in WSL environment, Unix settings can be used as-is.\n\n```json\n{\n  \"mcpServers\": {\n    \"claude-mem\": {\n      \"command\": \"npx\",\n      \"args\": [\"-y\", \"claude-mem-mcp\"],\n      \"env\": {\n        \"CLAUDE_MEM_MODE\": \"harness\"\n      }\n    }\n  }\n}\n```\n\n---\n\n### Step 3.6: WSL Environment Setup (Windows + WSL)\n\nDetailed settings for running Claude Code in WSL instead of Windows native.\n\n#### Prerequisites Check\n\n```bash\n# 1. Check if WSL2 is installed (run in PowerShell)\nwsl --version\n\n# 2. Check if Node.js is Linux version inside WSL\nwsl -e bash -c \"which node && which npm\"\n# Correct: /usr/bin/node, /usr/bin/npm\n# Problem: /mnt/c/Program Files/nodejs/node (referencing Windows version)\n```\n\n#### Resolving \"/bin/bash not found\" Issue\n\n**Symptom**:\n```\n/bin/bash: line 1: sh: command not found\n```\n\n**Cause**: WSL's PATH has Windows Node.js/npm prioritized\n\n**Solution**:\n\n```bash\n# 1. Run inside WSL - Disable Windows PATH\necho '[interop]\nappendWindowsPath = false' | sudo tee -a /etc/wsl.conf\n\n# 2. Restart WSL (run in PowerShell)\nwsl --shutdown\n\n# 3. Install Node.js inside WSL (nvm recommended)\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash\nsource ~/.bashrc\nnvm install --lts\nnvm use --lts\n\n# 4. Verify\nwhich node  # → /home/user/.nvm/versions/node/v20.x.x/bin/node\nwhich npm   # → /home/user/.nvm/versions/node/v20.x.x/bin/npm\n```\n\n#### Resolving \"Worker won't start on port 37777\" Issue\n\n**Symptom**:\n```\nWorker service failed to start on port 37777\nWorker failed to start (readiness check timed out after 20000ms)\n```\n\n**Cause**: Zombie process occupying port, or previous worker didn't terminate properly\n\n**Solution**:\n\n```bash\n# 1. Check port 37777 usage\n# Inside WSL\nlsof -i :37777\n# Or Windows (PowerShell)\nnetstat -ano | findstr 37777\n\n# 2. Terminate zombie processes\n# Inside WSL\npkill -f \"claude-mem\"\npkill -f \"bun\"\n\n# Windows (PowerShell - Administrator)\ntaskkill /F /IM bun.exe\ntaskkill /F /IM node.exe\n\n# 3. Check worker log\ncat ~/.claude-mem/logs/worker.log\n\n# 4. Manually restart worker\ncd ~/.claude/plugins/marketplaces/thedotmack\nnpm run worker:restart\n\n# 5. Restart Claude Code\n```\n\n#### WSL File Performance Optimization\n\n```bash\n# Place projects inside WSL filesystem (recommended)\n# ✅ Good example\ncd ~/projects/my-app\n\n# ❌ Bad example (slow)\ncd /mnt/c/Users/username/projects/my-app\n```\n\n> ⚠️ Performance significantly degrades under `/mnt/c/`.\n> Place projects under `~/`.\n\n---\n\n### Step 4: settings.json Update\n\nUpdate Claude-mem settings file.\n\n```bash\n# settings.json path\nCLAUDE_MEM_SETTINGS=\"$HOME/.claude-mem/settings.json\"\n\n# Create settings file if it doesn't exist\nif [ ! -f \"$CLAUDE_MEM_SETTINGS\" ]; then\n  mkdir -p \"$HOME/.claude-mem\"\n  echo '{}' > \"$CLAUDE_MEM_SETTINGS\"\nfi\n```\n\n**Settings content**:\n\n```json\n{\n  \"CLAUDE_MEM_MODE\": \"harness\"  // or \"harness--ja\"\n}\n```\n\nSet `\"harness--ja\"` if Japanese is selected.\n\n---\n\n### Step 5: Completion Confirmation\n\n> ✅ **Claude-mem integration complete!**\n>\n> **Settings:**\n> - Mode: `harness` (or `harness--ja`)\n> - Mode file: `~/.claude-mem/modes/harness.json`\n> - Settings file: `~/.claude-mem/settings.json`\n>\n> **Effective from next session.**\n>\n> **Verification:**\n> - Claude-mem starts in harness mode at next session start\n> - Check Claude-mem status with `/sync-status`\n>\n> **Usage:**\n> - Search past work history with `mem-search` skill\n> - Display past guardrail activation history at session-init\n> - Promote important observations to SSOT with `/sync-ssot-from-memory`\n\n---\n\n## Content Recorded in Harness Mode\n\n### observation_types\n\n| Type | Description | Emoji |\n|------|-------------|-------|\n| `plan` | Task additions/updates to Plans.md | 📋 |\n| `implementation` | Implementation following harness rules | 🛠️ |\n| `guard` | Guardrail activation (test-quality, implementation-quality) | 🛡️ |\n| `review` | Code review execution | 🔍 |\n| `ssot` | decisions.md/patterns.md updates | 📚 |\n| `handoff` | PM ↔ Impl role transitions | 🤝 |\n| `workflow` | Workflow improvements/automation | ⚙️ |\n\n### observation_concepts\n\n| Concept | Description |\n|---------|-------------|\n| `test-quality` | Test tampering prevention/quality enforcement |\n| `implementation-quality` | Stub/mock/hardcode prevention |\n| `harness-pattern` | Harness-specific reusable patterns |\n| `2-agent` | PM/Impl collaboration patterns |\n| `quality-gate` | Quality gate activation points |\n| `ssot-decision` | SSOT decision records |\n\n---\n\n## Use Cases\n\n### 1. Cross-session Guardrails\n\n```\nDay 1: Block test tampering\nClaude-mem: Record \"guard: blocked it.skip()\"\n\nDay 3 (different session):\nsession-init: \"This project has prevented test tampering 2 times in the past\"\n→ Warn about same mistake in advance\n```\n\n### 2. Long-term Task Context Maintenance\n\n```\nWeek 1: Feature X design complete\nClaude-mem: Record \"plan: Feature X design complete, adopted RBAC\"\n\nWeek 2 (different session):\nsession-init: \"Previous: Feature X design complete. Next: Implementation phase\"\n→ Immediately continue from where left off\n```\n\n### 3. Debug Pattern Learning\n\n```\nPast: Resolved CORS error\nClaude-mem: Record \"bugfix: CORS - added Access-Control-Allow-Origin\"\n\nPresent: Similar error occurs\nmem-search: Hits past solution\n→ Resolve in 5 minutes (previously 30 minutes)\n```\n\n---\n\n## Troubleshooting\n\n### WSL: /bin/bash not found\n\n```\n/bin/bash: line 1: sh: command not found\n```\n\n**Cause**: WSL inherits Windows PATH and references Windows version Node.js\n\n**Solution**: See \"Resolving /bin/bash not found Issue\" in Step 3.6\n\n**Related Issue**: [GitHub Issue #210](https://github.com/thedotmack/claude-mem/issues/210)\n\n---\n\n### WSL/Windows: Worker won't start on port 37777\n\n```\nWorker service failed to start on port 37777\nWorker failed to start (readiness check timed out after 20000ms)\n```\n\n> **First check claude-mem version**\n>\n> ```bash\n> cat ~/.claude/plugins/marketplaces/thedotmack/plugin/package.json | grep version\n> ```\n>\n> | Version | Action |\n> |---------|--------|\n> | **v7.3.7+** | Can be resolved with troubleshooting below |\n> | **v7.3.6 or earlier** | Strongly recommend upgrade to latest version |\n\n**If issue occurs on v7.3.7+**:\n\n```bash\n# 1. Terminate zombie processes\ntaskkill /F /IM bun.exe       # Windows\ntaskkill /F /IM node.exe      # Windows\n\n# 2. Delete PID file\ndel %USERPROFILE%\\.claude-mem\\worker.pid\n\n# 3. Restart Claude Code\n```\n\n---\n\n**For v7.3.6 or earlier (root causes)**:\n\n| Cause | Details |\n|-------|---------|\n| **PowerShell execution issue** | `.ps1` file opens in Notepad, or execution policy restrictions |\n| **Broken file associations** | `bun.ps1` wrapper doesn't execute correctly |\n| **Zombie processes** | Previous `bun.exe` / `node.exe` occupying port |\n| **Stale PID file** | `~/.claude-mem/worker.pid` holds old process info |\n\n**Why it doesn't occur in WSL**:\n- Shell scripts execute natively\n- No dependency on file associations\n- Unix standard process management (reliable signal handling)\n\n**Recommended solutions**:\n1. **Upgrade to latest version** (Recommended)\n2. **Migrate to WSL** (See Step 3.6)\n\n**Temporary workarounds for v7.3.6 or earlier** (limited effectiveness):\n\n```bash\n# 1. Check port usage\nnetstat -ano | findstr 37777  # Windows\nlsof -i :37777                 # WSL/Linux\n\n# 2. Terminate zombie processes\ntaskkill /F /IM bun.exe       # Windows\ntaskkill /F /IM node.exe      # Windows\npkill -f \"claude-mem\"          # WSL/Linux\n\n# 3. Delete PID file\ndel %USERPROFILE%\\.claude-mem\\worker.pid  # Windows\nrm ~/.claude-mem/worker.pid                # WSL/Linux\n\n# 4. Manually restart worker\ncd ~/.claude/plugins/marketplaces/thedotmack\nnpm run worker:restart\n\n# 5. Or directly run bun.exe (bypass PowerShell)\n%USERPROFILE%\\.bun\\bin\\bun.exe plugin/scripts/worker-service.cjs\n```\n\n> ⚠️ **Note**: The above workarounds are temporary and not fundamental solutions.\n> **WSL migration is strongly recommended.**\n\n**Related Issues**:\n- [Issue #380](https://github.com/thedotmack/claude-mem/issues/380) - Windows 11 port 37777 error\n- [Issue #209](https://github.com/thedotmack/claude-mem/issues/209) - Worker won't start on Windows\n\n---\n\n### Windows: ENOENT Error\n\n```\nENOENT: no such file or directory\nC:\\Users\\user\\AppData\\Local\\claude-cli-nodejs\\Cache\\...\n```\n\n**Cause**: Known issue with Windows path handling ([Issue #229](https://github.com/thedotmack/claude-mem/issues/229))\n\n**Solution**:\n\n1. **Use WSL** (Recommended)\n   ```bash\n   # Run Claude Code inside WSL\n   wsl\n   claude\n   ```\n\n2. **Manually create directory**\n   ```powershell\n   mkdir -p $env:LOCALAPPDATA\\claude-cli-nodejs\\Cache\n   ```\n\n3. **Wait for issue fix**\n   - Watch [Issue #229](https://github.com/thedotmack/claude-mem/issues/229)\n\n---\n\n### Windows: npx not found\n\n**Cause**: Node.js not included in PATH\n\n**Solution**:\n\n```json\n// Specify absolute path in .mcp.json\n{\n  \"mcpServers\": {\n    \"claude-mem\": {\n      \"command\": \"C:\\\\Program Files\\\\nodejs\\\\npx.cmd\",\n      \"args\": [\"-y\", \"claude-mem-mcp\"]\n    }\n  }\n}\n```\n\n---\n\n### Windows: .sh opens in VSCode/Cursor\n\n**Cause**: Windows file association issue ([Issue #9758](https://github.com/anthropics/claude-code/issues/9758))\n\n**Solution**: Use `bash` prefix in hooks.json\n\n```json\n// Before fix\n\"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/example.sh\"\n\n// After fix\n\"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/example.sh\"\n```\n\n> ⚠️ **Auto-applied in harness v2.6.7+**\n\n---\n\n### Claude-mem not working\n\n```bash\n# Check plugin list\n/plugin list\n\n# Check Claude-mem status\nls ~/.claude/plugins/marketplaces/thedotmack\n\n# Reinstall\n/plugin uninstall claude-mem\n/plugin install claude-mem\n```\n\n### Mode not applied\n\n```bash\n# Check settings.json\ncat ~/.claude-mem/settings.json\n\n# Verify CLAUDE_MEM_MODE is set\n# Correct: {\"CLAUDE_MEM_MODE\": \"harness\"}\n```\n\n### Not recording in Japanese\n\n```bash\n# Check if harness--ja mode is set\ncat ~/.claude-mem/settings.json\n# → Should be {\"CLAUDE_MEM_MODE\": \"harness--ja\"}\n\n# Check if mode file exists\nls ~/.claude-mem/modes/harness--ja.json\n```\n\n---\n\n## Disable\n\nTo disable harness mode in Claude-mem:\n\n```bash\n# Edit settings.json\n# Change CLAUDE_MEM_MODE back to \"code\", or delete it\n```\n\n```json\n{\n  \"CLAUDE_MEM_MODE\": \"code\"\n}\n```\n\n---\n\n## Cursor Integration\n\n> **v2.6.18+**: Use the official claude-mem v8.5.0+ feature for Cursor integration.\n>\n> ```bash\n> # Run in claude-mem repository\n> git clone https://github.com/thedotmack/claude-mem.git\n> cd claude-mem\n> bun install\n> bun run cursor:install\n> ```\n>\n> See [claude-mem CHANGELOG](https://github.com/thedotmack/claude-mem/blob/main/CHANGELOG.md) for details.\n\n---\n\n## Related Commands/Skills\n\n| Command/Skill | Purpose |\n|---------------|---------|\n| `/sync-ssot-from-memory` | Promote important Claude-mem observations to SSOT |\n| `mem-search` | Search past work history |\n| `session-init` | Display past context at session start (with Claude-mem integration) |\n| `/harness-init` | Project initialization (Claude-mem integration is separate via `/harness-mem`) |\n",
        "commands/optional/harness-ui-setup.md": "---\ndescription: \"[Deprecated] Set up harness-ui dashboard - Use /harness-ui instead\"\ndescription-en: \"[Deprecated] Set up harness-ui dashboard - Use /harness-ui instead\"\nuser-invocable: false\n---\n\n# /harness-ui-setup - [Deprecated]\n\n> **This command has been deprecated and merged into `/harness-ui`.**\n>\n> `/harness-ui` now automatically detects whether setup is needed and enters setup mode when license key is not configured.\n>\n> **Use `/harness-ui` instead.**\n\n## Migration Guide\n\n| Old Command | New Command |\n|-------------|-------------|\n| `/harness-ui-setup` | `/harness-ui` (auto-setup mode) |\n| `/harness-ui-setup YOUR-KEY` | `/harness-ui YOUR-KEY` |\n| `/harness-ui-setup --force` | `/harness-ui --force` |\n\n## Why Deprecated?\n\n1. **Improved UX**: Users no longer need to remember two separate commands\n2. **Auto-detection**: `/harness-ui` automatically enters setup mode when needed\n3. **Unified interface**: Single command for both setup and dashboard access\n\n## See Also\n\n- `/harness-ui` - Unified dashboard display and setup command\n",
        "commands/optional/harness-ui.md": "---\ndescription: Open harness-ui dashboard (auto-setup if needed)\ndescription-en: Open harness-ui dashboard (auto-setup if needed)\n---\n\n# /harness-ui - Dashboard Display & Setup\n\nOpen harness-ui dashboard. Automatically switches to setup mode if not configured.\n\n## VibeCoder Phrases\n\n- \"**Open the dashboard**\" → this command\n- \"**I want to see harness-ui**\" → this command\n- \"**Check status in UI**\" → this command\n- \"**Enable harness-ui**\" → this command (auto-setup)\n- \"**I want to use the dashboard**\" → this command (auto-setup)\n- \"**I want to see health score in UI**\" → this command (auto-setup)\n\n## Deliverables\n\n- Open harness-ui in browser\n- Check server status\n- Display registered projects list\n- Auto-setup if license key is not configured\n\n---\n\n## Execution Flow\n\n### Step 1: License Key Check (Mode Detection)\n\n```bash\n# Check environment variable\necho $HARNESS_BETA_CODE\n```\n\n**If key is set (not empty):**\n→ Proceed to **Dashboard Mode (Step 2)**\n\n**If key is not set or empty:**\n→ Proceed to **Setup Mode (Step S1)**\n\n---\n\n## Dashboard Mode\n\n### Step 2: Server Status Check\n\n```bash\n# Check harness-ui server status\ncurl -s --connect-timeout 2 http://localhost:37778/api/status\n```\n\n**If server is running:**\n→ Proceed to Step 3\n\n**If server is not running:**\n\n> ⚠️ **harness-ui server is not running**\n>\n> Restart Claude Code to auto-start.\n>\n> Or to start manually:\n> ```bash\n> cd {plugin directory}/harness-ui && npm run dev\n> ```\n\n**End processing**\n\n### Step 3: Get Project Information\n\n```bash\n# Get registered projects list\ncurl -s http://localhost:37778/api/projects\n```\n\n### Step 4: Display Information\n\nDisplay the following information:\n\n> 📊 **harness-ui Dashboard**\n>\n> **URL**: http://localhost:37778\n>\n> **Server Status**: ✅ Running\n>\n> **Registered Projects**:\n> | Project | Path |\n> |---------|------|\n> | {name1} | {path1} |\n> | {name2} | {path2} |\n>\n> 💡 Open http://localhost:37778 in your browser to view the dashboard.\n\n### Step 5: Open in Browser (Optional)\n\nAsk user:\n\n> Open dashboard in browser? (Y/n)\n\n**If Y:**\n```bash\nopen http://localhost:37778  # macOS\n# or\nxdg-open http://localhost:37778  # Linux\n```\n\n---\n\n## Setup Mode\n\n> 🔑 **License key not found. Starting harness-ui setup...**\n\n### Step S1: License Key Input\n\n**If command has argument (e.g., `/harness-ui YOUR-KEY`):**\n→ Use the argument as license key, proceed to Step S2\n\n**If no argument:**\n\n> 🔑 **Please enter your Polar license key**\n>\n> If you don't have a license key, please request one from the administrator as this is a beta version.\n>\n> Enter key:\n\n**Wait for response**\n\n### Step S2: License Key Validation\n\nValidate key with Polar API:\n\n```typescript\n// POST https://api.polar.sh/v1/customer-portal/license-keys/validate\n{\n  \"key\": \"user's key\",\n  \"organization_id\": \"54443411-11a2-45b0-9473-7aa37f96a677\"\n}\n```\n\n**If validation succeeds:**\n→ Proceed to Step S3\n\n**If validation fails:**\n\n> ❌ **Invalid license key**\n>\n> Reason: {error reason}\n>\n> Please verify the correct key or contact administrator.\n\n**End processing**\n\n### Step S3: Set Environment Variable\n\nAdd environment variable to user's shell config file (`~/.zshrc` or `~/.bashrc`):\n\n```bash\nexport HARNESS_BETA_CODE=\"user's license key\"\n```\n\n### Step S3.5: Add MCP Settings (Enable harness-ui)\n\nCreate `.mcp.json` in plugin root to enable harness-ui MCP server.\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nTEMPLATE_PATH=\"$PLUGIN_ROOT/templates/mcp/harness-ui.mcp.json.template\"\nTARGET_PATH=\"$PLUGIN_ROOT/.mcp.json\"\n\n# Check if template exists\nif [ -f \"$TEMPLATE_PATH\" ]; then\n  # Create .mcp.json (overwrite if exists)\n  cp \"$TEMPLATE_PATH\" \"$TARGET_PATH\"\n  echo \"✅ MCP settings created: $TARGET_PATH\"\nelse\n  echo \"⚠️ Template not found: $TEMPLATE_PATH\"\n  echo \"Please create .mcp.json manually\"\nfi\n```\n\n**Generated `.mcp.json` content:**\n\n```json\n{\n  \"harness-ui\": {\n    \"command\": \"bun\",\n    \"args\": [\"${CLAUDE_PLUGIN_ROOT}/harness-ui/src/mcp/server.ts\"],\n    \"env\": {\n      \"PROJECT_ROOT\": \"${CLAUDE_PLUGIN_ROOT}\",\n      \"HARNESS_BETA_CODE\": \"${HARNESS_BETA_CODE}\"\n    }\n  }\n}\n```\n\n> 💡 **Why is this step necessary?**\n>\n> harness-ui is an optional feature, so it's not registered as an MCP server by default.\n> Only users who run setup can use the harness-ui MCP.\n\n### Step S4: Install Dependencies\n\nInstall harness-ui dependencies:\n\n```bash\ncd ${CLAUDE_PLUGIN_ROOT}/harness-ui && bun install\n```\n\n**If Bun is not installed:**\n\n```bash\n# macOS / Linux\ncurl -fsSL https://bun.sh/install | bash\n\n# Windows (PowerShell)\npowershell -c \"irm bun.sh/install.ps1 | iex\"\n```\n\n**Verify successful installation:**\n\n```bash\nls ${CLAUDE_PLUGIN_ROOT}/harness-ui/node_modules | head -5\n```\n\n→ Success if package names are displayed\n\n### Step S5: Apply Environment Variables and Verify Server Startup\n\n```bash\n# Apply environment variables\nsource ~/.zshrc  # or source ~/.bashrc\n\n# Manually start harness-ui server (for verification)\ncd ${CLAUDE_PLUGIN_ROOT}/harness-ui && bun run dev &\n```\n\n**Verify startup:**\n\n```bash\ncurl -s http://localhost:37778/api/status\n```\n\n→ Success if `{\"status\":\"ok\"...}` is returned\n\n### Step S6: Register Current Project\n\nAfter server starts, register current project to dropdown:\n\n```bash\n# Get current project\nPROJECT_PATH=$(pwd)\nPROJECT_NAME=$(basename \"$PROJECT_PATH\")\n\n# Register project\ncurl -s -X POST http://localhost:37778/api/projects \\\n  -H \"Content-Type: application/json\" \\\n  -d \"{\\\"name\\\": \\\"$PROJECT_NAME\\\", \\\"path\\\": \\\"$PROJECT_PATH\\\"}\"\n```\n\n**Success response:**\n\n```json\n{\"project\":{\"id\":\"proj_xxx\",\"name\":\"your-project\",\"path\":\"/path/to/project\"}}\n```\n\n**If already registered:**\n\n```json\n{\"error\":\"Project with path \\\"/path/to/project\\\" already exists\"}\n```\n\n→ No problem even with error (existing project will be used)\n\n### Step S7: Plans.md Format Check (If needed)\n\nIf Plans.md has old format (`cursor:WIP` / `cursor:completed`), migrate to appropriate markers **based on context**.\n\n**Migration approach:**\n\n| Old Marker | Context | New Marker |\n|------------|---------|------------|\n| `cursor:WIP` | Claude Code is working | `cc:WIP` |\n| `cursor:WIP` | PM (Cursor) is working | `pm:requested` or keep |\n| `cursor:completed` | Implementation complete | `cc:done` |\n| `cursor:completed` | PM confirmed | `pm:confirmed` |\n\n**For 2-Agent operation:**\n- `cursor:requested` / `cursor:confirmed` remain valid (same as `pm:*`)\n- No need to force conversion\n\n**If migration is needed:**\nAsk Claude Code to \"migrate old format markers in Plans.md to new format based on context\".\n\n### Step S8: Completion Message → Dashboard Mode\n\n> ✅ **harness-ui setup complete!**\n>\n> 📋 **Settings:**\n> - License key: {first 8 characters of key}...\n> - Customer ID: {customer ID}\n> - Environment variable: Added `HARNESS_BETA_CODE` to ~/.zshrc\n> - **MCP settings**: `.mcp.json` created\n> - Dependencies: Installed\n> - Project registration: Complete\n>\n> **Verification:**\n> 1. **Restart Claude Code** (to apply MCP settings)\n> 2. Access http://localhost:37778 in browser\n> 3. Verify current project name appears in top-right dropdown\n> 4. From next time, auto-start & auto-register when Claude Code launches\n>\n> 💡 **Hint**: If dropdown shows only \"All Projects\", re-run project registration from Step S6.\n\nAfter setup completion, automatically proceed to **Dashboard Mode (Step 2)** to show current status.\n\n---\n\n## Related Commands\n\n- `/validate` - Plugin validation\n- `/harness-update` - Plugin update\n- `/harness-init` - Project initialization (auto Plans.md generation)\n\n---\n\n## Troubleshooting\n\n### Server won't start\n\n1. Restart Claude Code\n2. Check if port 37778 is in use: `lsof -i :37778`\n3. Check if environment variable `HARNESS_BETA_CODE` is set\n\n### Want to reset license key\n\nRun `/harness-ui --force YOUR-NEW-KEY` to reconfigure.\n\n### Error: Cannot find module / node_modules not found\n\n**Cause**: Dependencies not installed\n\n**Solution**:\n```bash\ncd ${CLAUDE_PLUGIN_ROOT}/harness-ui\nbun install\n```\n\n### Error: bun: command not found\n\n**Cause**: Bun is not installed\n\n**Solution**:\n```bash\n# macOS / Linux\ncurl -fsSL https://bun.sh/install | bash\nsource ~/.bashrc  # or source ~/.zshrc\n\n# Verify\nbun --version\n```\n\n### Error: Invalid license key\n\n**Cause**: Key is incorrect or expired\n\n**Solution**:\n1. Re-verify the received key\n2. Re-run `/harness-ui YOUR-KEY`\n\n### Error: harness-ui won't start\n\n**Cause**: Environment variable not set, or Claude Code not restarted\n\n**Solution**:\n```bash\n# Check environment variable\necho $HARNESS_BETA_CODE\n\n# If not set\nsource ~/.zshrc\n\n# Restart Claude Code\nCtrl+C to exit → restart with claude\n```\n\n### Error: Port 37778 in use\n\n**Cause**: Another process is using the port\n\n**Solution**:\n```bash\nlsof -i :37778\nkill -9 {PID}\n```\n\n### Project not showing in dropdown\n\n**Cause**: Project not registered\n\n**Solution**:\n```bash\n# Verify server is running\ncurl -s http://localhost:37778/api/status\n\n# Manually register project\nPROJECT_PATH=$(pwd)\nPROJECT_NAME=$(basename \"$PROJECT_PATH\")\ncurl -s -X POST http://localhost:37778/api/projects \\\n  -H \"Content-Type: application/json\" \\\n  -d \"{\\\"name\\\": \\\"$PROJECT_NAME\\\", \\\"path\\\": \\\"$PROJECT_PATH\\\"}\"\n\n# Check registered projects list\ncurl -s http://localhost:37778/api/projects | jq\n```\n\n---\n\n## Plans.md Format Requirements\n\nharness-ui auto project registration requires one of the following:\n\n### Method 1: Run `/harness-init` (Recommended)\n\n```bash\n/harness-init\n```\n\n→ `.claude-code-harness-version` marker file is created and auto-recognized.\n\n### Method 2: Include correct markers in Plans.md\n\nInclude the following markers in Plans.md:\n\n**New format (Recommended):**\n\n| Marker | Meaning |\n|--------|---------|\n| `cc:TODO` | Pending task |\n| `cc:WIP` | In-progress task |\n| `cc:done` | Completed task |\n| `cc:blocked` | Blocked |\n| `pm:requested` | Requested by PM |\n| `pm:confirmed` | Confirmed by PM |\n\n**Old format (compatible, deprecated):**\n\n| Marker | Migration target |\n|--------|------------------|\n| `cursor:WIP` → | `cc:WIP` |\n| `cursor:completed` → | `cc:done` |\n\n**Template:**\n\n```markdown\n# Plans.md\n\n## Task List\n\n- [ ] Task 1 `cc:TODO`\n- [x] Task 2 `cc:done`\n```\n\n---\n\n## Notes\n\n- License key is validated online via Polar API\n- harness-ui won't start with invalid key\n- Developers can bypass with `HARNESS_UI_DEV=true`\n\n## Security\n\nLicense key is managed via environment variable (`HARNESS_BETA_CODE`).\n\n- **Do not include in repository**: Add `.env` file to `.gitignore`\n- **Shell config file**: `~/.zshrc` is normally outside Git management, so it's safe\n- **For team development**: Recommend each member obtains individual license key\n",
        "commands/optional/harness-update.md": "---\ndescription: Safely update harness-enabled projects to latest version (version detection → backup → non-destructive update)\ndescription-en: Safely update harness-enabled projects to latest version (version detection → backup → non-destructive update)\n---\n\n# /harness-update - Harness Update\n\nSafely update projects with existing harness to the latest harness version.\n**Version detection → Backup → Non-destructive update** flow preserves existing settings and tasks while introducing latest features.\n\n## When to Use\n\n- \"I want to update harness to the latest version\"\n- \"I want to add new features to existing project\"\n- \"I want to update config file format to latest version\"\n- \"I want to fix incorrect permission syntax\"\n- \"I was notified of template updates\"\n\n## Deliverables\n\n- Version detection via `.claude-code-harness-version`\n- **Template update detection and localization judgment**\n- Identify files needing update\n- Auto-backup creation\n- Non-destructive settings/workflow file updates\n- **No localization → overwrite / Localized → merge support**\n- **Skills diff detection** - Auto-detect and propose new skills\n- Post-update verification\n\n---\n\n## Execution Flow\n\n### Phase 1: Version Detection and Confirmation\n\n#### Step 1: Check Harness Installation Status\n\nCheck `.claude-code-harness-version` file:\n\n```bash\nif [ -f .claude-code-harness-version ]; then\n  CURRENT_VERSION=$(grep \"^version:\" .claude-code-harness-version | cut -d' ' -f2)\n  echo \"Detected version: $CURRENT_VERSION\"\nelse\n  echo \"⚠️ Harness not installed in this project\"\n  echo \"→ Use /harness-init instead\"\n  exit 1\nfi\n```\n\n**If harness not installed:**\n> ⚠️ **Harness is not installed in this project**\n>\n> `/harness-update` is for projects with existing harness.\n> Use `/harness-init` for new installation.\n\n**If installed:** → Step 2\n\n#### Step 2: Version Comparison\n\nCompare with plugin's latest version:\n\n```bash\nPLUGIN_VERSION=$(cat \"$CLAUDE_PLUGIN_ROOT/claude-code-harness/VERSION\" 2>/dev/null || echo \"unknown\")\n\nif [ \"$CURRENT_VERSION\" = \"$PLUGIN_VERSION\" ]; then\n  echo \"ℹ️ Version is latest (v$PLUGIN_VERSION)\"\n  echo \"→ Running file content check...\"\nelse\n  echo \"📦 Update available: v$CURRENT_VERSION → v$PLUGIN_VERSION\"\nfi\n```\n\n**If versions differ:** → Step 3\n\n**If versions same:** → Step 2.5 (content check)\n\n> ⚠️ **Important**: Even if versions match, individual file content may be outdated.\n> Step 2.5 runs `template-tracker.sh check` to detect content-level updates.\n\n#### Step 2.5: File Content Check (When Version Same)\n\nCheck for outdated file content even with same version:\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n# Content-based update check with template-tracker.sh check\nCHECK_RESULT=$(bash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" check 2>/dev/null)\n\n# Get update counts from JSON\nNEEDS_CHECK=$(echo \"$CHECK_RESULT\" | jq -r '.needsCheck // false')\nUPDATES_COUNT=$(echo \"$CHECK_RESULT\" | jq -r '.updatesCount // 0')\nINSTALLS_COUNT=$(echo \"$CHECK_RESULT\" | jq -r '.installsCount // 0')\n\nif [ \"$NEEDS_CHECK\" = \"true\" ]; then\n  echo \"📦 File content updates needed\"\n  echo \"   - Updates: ${UPDATES_COUNT} files\"\n  echo \"   - New: ${INSTALLS_COUNT} files\"\nelse\n  echo \"✅ All files are up to date\"\nfi\n```\n\n**If files need updates:**\n\n> 📦 **File content updates detected**\n>\n> Version is v{{VERSION}} (same), but the following file content is outdated:\n>\n> | File | Status | Action |\n> |------|--------|--------|\n> {{update target list}}\n>\n> Continue with update? (yes / no / show details)\n\n**Wait for response**\n\n- **yes** → Step 3 (carry over update target list)\n- **no** → End\n- **show details** → Show `template-tracker.sh status` details, then confirm again\n\n**If all files up to date:**\n\n> ✅ **Project is completely up to date**\n>\n> - Version: v{{VERSION}}\n> - All file content: Up to date\n>\n> No update needed.\n\n#### Step 3: Template Update Check\n\nRun `template-tracker.sh status` to show template update status:\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nbash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" status\n```\n\n**Example output:**\n\n```\n=== Template Tracking Status ===\n\nPlugin version: 2.5.25\nLast checked at: 2.5.20\n\nFile                                      Recorded     Latest       Status\n----                                      --------     ------       ------\nCLAUDE.md                                 2.5.20       2.5.25       🔄 Overwrite OK\nAGENTS.md                                 unknown      2.5.25       ⚠️ Needs check\nPlans.md                                  2.5.20       2.5.25       🔧 Merge needed\n.claude/rules/workflow.md                 2.5.20       2.5.25       ✅ Latest\n\nLegend:\n  ✅ Latest      : No update needed\n  🔄 Overwrite OK: Not localized, can overwrite\n  🔧 Merge needed: Localized, requires merge\n  ⚠️ Needs check : Unknown version, check recommended\n```\n\n#### Step 4: Confirm Update Scope\n\nIdentify target files and confirm with user:\n\n> 📦 **Update: v{{CURRENT}} → v{{LATEST}}**\n>\n> **Files to update:**\n> - `.claude/settings.json` - Update security policy and latest syntax\n> - `AGENTS.md` / `CLAUDE.md` / `Plans.md` - Update to latest format (existing tasks preserved)\n> - `.claude/rules/` - Update to latest rule templates\n> - `.cursor/commands/` - Update Cursor commands (for 2-Agent mode)\n> - `.claude-code-harness-version` - Update version info\n>\n> **Existing data preserved:**\n> - ✅ Incomplete tasks in Plans.md\n> - ✅ Custom settings in .claude/settings.json (hooks, env, model, etc.)\n> - ✅ SSOT data in .claude/memory/\n>\n> **Backup:**\n> - Pre-change files saved to `.claude-code-harness/backups/{{TIMESTAMP}}/`\n>\n> Execute update? (yes / no / custom)\n>\n> **Custom**: Select \"custom\" to update only specific files\n\n**Wait for response**\n\n- **yes** → Phase 1.5 (breaking changes check)\n- **no** → End\n- **custom** → Phase 2A (selective update)\n\n---\n\n## Phase 1.5: Breaking Changes Detection and Confirmation\n\n**Important**: Detect existing settings issues and confirm with user before update.\n\n### Step 1: Inspect .claude/settings.json\n\nLoad existing `.claude/settings.json` and check:\n\n```bash\n# Check if settings.json exists\nif [ ! -f .claude/settings.json ]; then\n  echo \"ℹ️ .claude/settings.json doesn't exist (will be created)\"\n  # → Phase 2 (no breaking changes)\nfi\n\n# Load with JSON parser (jq or python)\nif command -v jq >/dev/null 2>&1; then\n  SETTINGS_CONTENT=$(cat .claude/settings.json)\nelse\n  echo \"⚠️ jq not found. Manual check needed\"\nfi\n```\n\n### Step 2: Detect Issues\n\nDetect the following issues:\n\n#### 🔴 Issue 1: Incorrect Permission Syntax\n\n> **Note (v2.1.20+)**: `Bash(*)` is now treated as equivalent to `Bash` (full wildcard).\n> This is NOT an error. Only prefix patterns without colons are incorrect.\n\n```bash\n# Search for incorrect syntax patterns\nWRONG_PATTERNS=(\n  'Bash\\([^:)]+\\s\\*\\)'     # \"Bash(npm run *)\" pattern\n  'Bash\\([^:)]+\\*\\)'       # \"Bash(git diff*)\" pattern (no colon)\n  'Bash\\(\\*[^:][^)]*\\*\\)'  # \"Bash(*credentials*)\" pattern\n)\n\nFOUND_ISSUES=()\n\n# Check each pattern\nif echo \"$SETTINGS_CONTENT\" | grep -E 'Bash\\([^:)]+\\s\\*\\)'; then\n  FOUND_ISSUES+=(\"incorrect_prefix_syntax_with_space\")\nfi\n\n# Note: \"Bash(*)\" alone is valid since v2.1.20 (wildcard = Bash)\n# Extract only Bash(...) substrings first, then check for missing colon\n# e.g., \"Bash(git diff*)\" is wrong, \"Bash(git diff:*)\" is correct\nif echo \"$SETTINGS_CONTENT\" | grep -oE 'Bash\\([^)]+\\)' | grep -E 'Bash\\([^:)]+\\*\\)'; then\n  FOUND_ISSUES+=(\"incorrect_prefix_syntax_no_colon\")\nfi\n\nif echo \"$SETTINGS_CONTENT\" | grep -E 'Bash\\(\\*[^:][^)]*\\*\\)'; then\n  FOUND_ISSUES+=(\"incorrect_substring_syntax\")\nfi\n```\n\n#### 🔴 Issue 2: Deprecated Settings\n\n```bash\n# Check for disableBypassPermissionsMode\nif echo \"$SETTINGS_CONTENT\" | grep -q '\"disableBypassPermissionsMode\"'; then\n  FOUND_ISSUES+=(\"deprecated_disable_bypass_permissions\")\nfi\n```\n\n#### 🔴 Issue 3: Old Hook Settings (Harness-originated only)\n\n```bash\n# Detect only hooks with commands containing \"claude-code-harness\"\n# User's custom hooks (different paths) are excluded\nPLUGIN_EVENTS=(\"PreToolUse\" \"SessionStart\" \"UserPromptSubmit\" \"PermissionRequest\")\nOLD_HARNESS_EVENTS=()\n\nif command -v jq >/dev/null 2>&1; then\n  for event in \"${PLUGIN_EVENTS[@]}\"; do\n    if jq -e \".hooks.${event}\" \"$SETTINGS_FILE\" >/dev/null 2>&1; then\n      # Extract command paths and check for \"claude-code-harness\"\n      COMMANDS=$(jq -r \".hooks.${event}[]?.hooks[]?.command // .hooks.${event}[]?.command // empty\" \"$SETTINGS_FILE\" 2>/dev/null)\n      if echo \"$COMMANDS\" | grep -q \"claude-code-harness\"; then\n        OLD_HARNESS_EVENTS+=(\"$event\")\n      fi\n    fi\n  done\n\n  if [ ${#OLD_HARNESS_EVENTS[@]} -gt 0 ]; then\n    FOUND_ISSUES+=(\"legacy_hooks_in_settings\")\n    echo \"Old harness hook settings: ${OLD_HARNESS_EVENTS[*]}\"\n  fi\nfi\n```\n\n### Step 3: Display Detection Results\n\nIf issues found, show details to user:\n\n> ⚠️ **Issues found in existing settings**\n>\n> **🔴 Issue 1: Incorrect Permission Syntax (3 items)**\n>\n> ```diff\n> - \"Bash(npm run *)\"      ❌ Wrong (space+asterisk)\n> + \"Bash(npm run:*)\"      ✅ Correct (colon+asterisk)\n>\n> - \"Bash(pnpm *)\"         ❌ Wrong\n> + \"Bash(pnpm:*)\"         ✅ Correct\n>\n> - \"Bash(git diff*)\"      ❌ Wrong (no colon)\n> + \"Bash(git diff:*)\"     ✅ Correct\n> ```\n>\n> **Impact**: Current permission settings are not working correctly.\n> Claude Code may not be able to execute these commands.\n>\n> ---\n>\n> **🔴 Issue 2: Deprecated Settings (1 item)**\n>\n> ```diff\n> - \"disableBypassPermissionsMode\": \"disable\"   ❌ Deprecated (since v2.5.0)\n> (Remove this setting)\n> ```\n>\n> **Reason**: Harness changed to allow bypassPermissions since v2.5.0.\n> Only dangerous operations are controlled via `permissions.deny` / `permissions.ask`.\n>\n> **Impact**: With current settings, confirmation prompts appear for every Edit/Write, reducing productivity.\n>\n> ---\n>\n> **🔴 Issue 3: Old Hook Settings (N items)**\n>\n> ```diff\n> - \"hooks\": { ... }   ❌ Duplicates plugin hooks.json\n> (Remove this setting)\n> ```\n>\n> **Reason**: claude-code-harness plugin manages hooks via `hooks/hooks.json`.\n> Having `hooks` in project's `.claude/settings.json` may cause unintended duplicate behavior.\n>\n> **Recommendation**: Remove `hooks` section from project and use only plugin hooks.\n>\n> ---\n>\n> **Auto-fix these issues?**\n>\n> - **yes** - Auto-fix all issues above and continue update\n> - **review** - Review each issue individually before fixing\n> - **skip** - Continue update without fixing (not recommended)\n> - **cancel** - Abort update\n\n**Wait for response**\n\n#### Choice Processing\n\n- **yes** → Auto-fix all issues → Phase 2\n- **review** → Step 4 (individual review)\n- **skip** → Phase 2 (continue without fixing, show warning)\n- **cancel** → Abort update\n\n### Step 4: Individual Review (When \"review\" selected)\n\nReview each issue individually:\n\n> **Issue 1/2: Incorrect Permission Syntax**\n>\n> Fix these 3 items?\n> - `\"Bash(npm run *)\"` → `\"Bash(npm run:*)\"`\n> - `\"Bash(pnpm *)\"` → `\"Bash(pnpm:*)\"`\n> - `\"Bash(git diff*)\"` → `\"Bash(git diff:*)\"`\n>\n> (yes / no)\n\n**Wait for response** → Add to fix list if yes\n\n> **Issue 2/2: Deprecated Settings**\n>\n> Remove `disableBypassPermissionsMode`?\n>\n> (yes / no)\n\n**Wait for response** → Add to delete list if yes\n\nAfter all confirmations → Phase 2\n\n---\n\n## Phase 2: Backup and Update\n\n> **Design principle**: Create update target list first, continue until all files processed. No early termination.\n\n### Step 0: Create Update Target List (At Phase 2 start)\n\n**Manage files detected in Phase 1 or Step 2.5 as list** and continue until all processed:\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n# Get template-tracker.sh check results\nCHECK_RESULT=$(bash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" check 2>/dev/null)\n\n# Create update target lists\nUPDATE_LIST=()\nINSTALL_LIST=()\n\nif command -v jq >/dev/null 2>&1; then\n  # Files needing update\n  while IFS= read -r line; do\n    [ -n \"$line\" ] && UPDATE_LIST+=(\"$line\")\n  done < <(echo \"$CHECK_RESULT\" | jq -r '.updates[]?.path // empty')\n\n  # Files needing creation\n  while IFS= read -r line; do\n    [ -n \"$line\" ] && INSTALL_LIST+=(\"$line\")\n  done < <(echo \"$CHECK_RESULT\" | jq -r '.installs[]?.path // empty')\nfi\n\nTOTAL_COUNT=$((${#UPDATE_LIST[@]} + ${#INSTALL_LIST[@]}))\nCOMPLETED_COUNT=0\n\necho \"📋 Update target list: ${TOTAL_COUNT} files\"\necho \"   - Updates: ${#UPDATE_LIST[@]} files\"\necho \"   - New: ${#INSTALL_LIST[@]} files\"\n```\n\n**Progress tracking**:\n\n```\nUpdate target list (5 files)\n├── [1/5] ⏳ CLAUDE.md - Waiting\n├── [2/5] ⏳ AGENTS.md - Waiting\n├── [3/5] ⏳ .claude/rules/workflow.md - Waiting\n├── [4/5] ⏳ .claude/settings.json - Waiting\n└── [5/5] ⏳ Plans.md - Waiting\n```\n\n### Step 1: Create Backup Directory\n\n```bash\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\nBACKUP_DIR=\".claude-code-harness/backups/$TIMESTAMP\"\nmkdir -p \"$BACKUP_DIR\"\n\n# Copy backup target files\n[ -f .claude/settings.json ] && cp .claude/settings.json \"$BACKUP_DIR/\"\n[ -f AGENTS.md ] && cp AGENTS.md \"$BACKUP_DIR/\"\n[ -f CLAUDE.md ] && cp CLAUDE.md \"$BACKUP_DIR/\"\n[ -f Plans.md ] && cp Plans.md \"$BACKUP_DIR/\"\n[ -d .claude/rules ] && cp -r .claude/rules \"$BACKUP_DIR/\"\n[ -d .cursor/commands ] && cp -r .cursor/commands \"$BACKUP_DIR/\"\n\necho \"✅ Backup created: $BACKUP_DIR\"\n```\n\n### Step 2: Update Settings File\n\n**`.claude/settings.json` update**\n\nFix issues detected in Phase 1.5 before running `generate-claude-settings` skill.\n\n#### Step 2.1: Apply Breaking Changes (If approved in Phase 1.5)\n\nApply user-approved fixes:\n\n```bash\n# Load settings.json\nSETTINGS_FILE=\".claude/settings.json\"\n\n# Issue 1: Fix permission syntax\nif [ -f \"$SETTINGS_FILE\" ]; then\n  # Replace space+asterisk with colon+asterisk\n  # e.g.: \"Bash(npm run *)\" → \"Bash(npm run:*)\"\n  sed -i.bak 's/Bash(\\([^:)]*\\) \\*)/Bash(\\1:*)/g' \"$SETTINGS_FILE\"\n\n  # Replace colon-less asterisk with colon+asterisk\n  # e.g.: \"Bash(git diff*)\" → \"Bash(git diff:*)\"\n  # (skip if already has :)\n  sed -i.bak 's/Bash(\\([^:)]*\\)\\*)/Bash(\\1:*)/g' \"$SETTINGS_FILE\"\n\n  # Fix substring matching\n  # e.g.: \"Bash(*credentials*)\" → \"Bash(:*credentials:*)\"\n  sed -i.bak 's/Bash(\\*\\([^:][^)]*\\)\\*)/Bash(:*\\1:*)/g' \"$SETTINGS_FILE\"\n\n  echo \"✅ Fixed permission syntax\"\nfi\n\n# Issue 2: Remove deprecated settings\nif [ -f \"$SETTINGS_FILE\" ]; then\n  # Remove disableBypassPermissionsMode (using jq)\n  if command -v jq >/dev/null 2>&1; then\n    jq 'del(.permissions.disableBypassPermissionsMode)' \"$SETTINGS_FILE\" > \"$SETTINGS_FILE.tmp\"\n    mv \"$SETTINGS_FILE.tmp\" \"$SETTINGS_FILE\"\n    echo \"✅ Removed disableBypassPermissionsMode\"\n  else\n    # Use Python if jq not available\n    python3 -c \"\nimport json\nwith open('$SETTINGS_FILE', 'r') as f:\n    data = json.load(f)\nif 'permissions' in data and 'disableBypassPermissionsMode' in data['permissions']:\n    del data['permissions']['disableBypassPermissionsMode']\nwith open('$SETTINGS_FILE', 'w') as f:\n    json.dump(data, f, indent=2)\n\" && echo \"✅ Removed disableBypassPermissionsMode\"\n  fi\nfi\n\n# Issue 3: Remove only harness-originated hook settings (identify by path)\n# Preserve user's custom hooks\nif [ -f \"$SETTINGS_FILE\" ]; then\n  PLUGIN_EVENTS=(\"PreToolUse\" \"SessionStart\" \"UserPromptSubmit\" \"PermissionRequest\")\n  DELETED_EVENTS=()\n\n  if command -v jq >/dev/null 2>&1; then\n    for event in \"${PLUGIN_EVENTS[@]}\"; do\n      if jq -e \".hooks.${event}\" \"$SETTINGS_FILE\" >/dev/null 2>&1; then\n        # Delete only if command path contains \"claude-code-harness\"\n        COMMANDS=$(jq -r \".hooks.${event}[]?.hooks[]?.command // .hooks.${event}[]?.command // empty\" \"$SETTINGS_FILE\" 2>/dev/null)\n        if echo \"$COMMANDS\" | grep -q \"claude-code-harness\"; then\n          jq \"del(.hooks.${event})\" \"$SETTINGS_FILE\" > \"$SETTINGS_FILE.tmp\"\n          mv \"$SETTINGS_FILE.tmp\" \"$SETTINGS_FILE\"\n          DELETED_EVENTS+=(\"$event\")\n        fi\n      fi\n    done\n\n    # Delete .hooks itself if empty\n    if jq -e '.hooks | length == 0' \"$SETTINGS_FILE\" >/dev/null 2>&1; then\n      jq 'del(.hooks)' \"$SETTINGS_FILE\" > \"$SETTINGS_FILE.tmp\"\n      mv \"$SETTINGS_FILE.tmp\" \"$SETTINGS_FILE\"\n    fi\n\n    if [ ${#DELETED_EVENTS[@]} -gt 0 ]; then\n      echo \"✅ Removed old harness hook settings: ${DELETED_EVENTS[*]} (using plugin hooks.json)\"\n    fi\n  else\n    # Use Python if jq not available\n    python3 -c \"\nimport json\nwith open('$SETTINGS_FILE', 'r') as f:\n    data = json.load(f)\nif 'hooks' in data:\n    plugin_events = ['PreToolUse', 'SessionStart', 'UserPromptSubmit', 'PermissionRequest']\n    deleted = []\n    for event in plugin_events:\n        if event in data['hooks']:\n            # Check if command path contains 'claude-code-harness'\n            hooks_list = data['hooks'][event]\n            is_harness = any('claude-code-harness' in str(h) for h in hooks_list)\n            if is_harness:\n                del data['hooks'][event]\n                deleted.append(event)\n    if not data['hooks']:\n        del data['hooks']\n    if deleted:\n        print(f'✅ Removed old harness hook settings: {\\\" \\\".join(deleted)}')\nwith open('$SETTINGS_FILE', 'w') as f:\n    json.dump(data, f, indent=2)\n\"\n  fi\nfi\n```\n\n#### Step 2.2: Run generate-claude-settings Skill\n\n- Preserve `env`, `model`, `enabledPlugins` (`hooks` already removed)\n- Merge `permissions.allow|ask|deny` with latest policy + deduplicate\n- Preserve correct syntax fixed in Phase 1.5\n- Add new recommended settings\n\n### Step 3: Update Workflow Files (Template Tracking Support)\n\n**Update processing based on template tracking status**:\n\nBranch processing based on each file's status:\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n# Get template tracking check results\nCHECK_RESULT=$(bash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" check 2>/dev/null)\n\n# Process files needing update using jq\nif command -v jq >/dev/null 2>&1; then\n  echo \"$CHECK_RESULT\" | jq -r '.updates[]? | \"\\(.path)|\\(.localized)\"' | while IFS='|' read -r path localized; do\n    if [ \"$localized\" = \"false\" ]; then\n      # Not localized → overwrite\n      echo \"🔄 Overwriting: $path\"\n      # Generate from template and overwrite\n      # → Run generate-* skill\n    else\n      # Localized → merge support\n      echo \"🔧 Merge support: $path\"\n      # Show diff and confirm with user\n    fi\n  done\nfi\n```\n\n**For not localized (🔄 Overwrite OK)**:\n\nAuto-replace with latest template:\n- `AGENTS.md` / `CLAUDE.md`: Overwrite with latest template\n- `.claude/rules/*.md`: Overwrite with latest rule templates\n\n**For localized (🔧 Merge needed)**:\n\n> 🔧 **`Plans.md` is localized**\n>\n> This file contains project-specific changes.\n>\n> **Options:**\n> 1. **Show diff** - View differences from template\n> 2. **Merge support** - Claude suggests merge\n> 3. **Skip** - Skip this file\n>\n> Select:\n\n**Wait for response**\n\nIf merge support selected:\n- Maintain latest template structure\n- Re-position user's custom parts (tasks, settings) appropriately\n- Show diff and get final confirmation\n\n**After update recording:**\n\n```bash\n# Record updated files in generated-files.json\nbash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" record \"$path\"\n```\n\n### Step 4: Update Rule Files\n\n`.claude/rules/` update:\n\n**Safely update using marker + hash method for localization detection.**\n\n```bash\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nPLUGIN_VERSION=$(cat \"$PLUGIN_PATH/VERSION\" 2>/dev/null || echo \"unknown\")\nSKILLS_CONFIG=\".claude/state/skills-config.json\"\n\n# Check Skills Gate status\nSKILLS_GATE_ENABLED=\"false\"\nif [ -f \"$SKILLS_CONFIG\" ]; then\n  if command -v jq >/dev/null 2>&1; then\n    SKILLS_GATE_ENABLED=$(jq -r '.enabled // false' \"$SKILLS_CONFIG\")\n  fi\nfi\n\n# Process each rule template\nfor template in \"$PLUGIN_PATH/templates/rules\"/*.template; do\n  [ -f \"$template\" ] || continue\n\n  rule_name=$(basename \"$template\" .template)\n  output_file=\".claude/rules/$rule_name\"\n\n  # Check conditional template (get condition from template-registry.json)\n  TEMPLATE_KEY=\"rules/$(basename \"$template\")\"\n  CONDITION=\"\"\n  if command -v jq >/dev/null 2>&1; then\n    CONDITION=$(jq -r \".templates[\\\"$TEMPLATE_KEY\\\"].condition // \\\"\\\"\" \"$PLUGIN_PATH/templates/template-registry.json\" 2>/dev/null)\n  fi\n\n  # Evaluate conditional templates\n  if [ -n \"$CONDITION\" ]; then\n    case \"$CONDITION\" in\n      \"skills_gate.enabled\")\n        if [ \"$SKILLS_GATE_ENABLED\" != \"true\" ]; then\n          # Condition not met\n          if [ -f \"$output_file\" ]; then\n            echo \"🗑️ Suggest deletion: $output_file (Skills Gate disabled)\"\n          else\n            echo \"⏭️ Skip: $rule_name (Skills Gate disabled)\"\n          fi\n          continue\n        fi\n        ;;\n    esac\n  fi\n\n  # Create new if file doesn't exist\n  if [ ! -f \"$output_file\" ]; then\n    cp \"$template\" \"$output_file\"\n    sed -i '' \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \"$output_file\" 2>/dev/null || \\\n    sed -i \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \"$output_file\"\n    echo \"🆕 Created: $output_file\"\n    continue\n  fi\n\n  # Check marker (is it harness-originated)\n  if grep -q \"^_harness_template:\" \"$output_file\" 2>/dev/null; then\n    # Harness-originated → detect localization and update\n    # Compare hash of content after frontmatter\n    INSTALLED_VERSION=$(grep \"^_harness_version:\" \"$output_file\" | sed 's/_harness_version: \"//;s/\"//')\n\n    if [ \"$INSTALLED_VERSION\" != \"$PLUGIN_VERSION\" ]; then\n      # Different version → update target\n      # (Localization detection delegated to template-tracker.sh)\n      echo \"🔄 Updating: $output_file ($INSTALLED_VERSION → $PLUGIN_VERSION)\"\n      cp \"$template\" \"$output_file\"\n      sed -i '' \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \"$output_file\" 2>/dev/null || \\\n      sed -i \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \"$output_file\"\n    else\n      echo \"✅ Latest: $output_file\"\n    fi\n  else\n    # No marker → user custom, protect\n    echo \"🛡️ Protected: $output_file (user custom)\"\n  fi\ndone\n```\n\n**Decision logic:**\n\n| Marker | Condition | Action |\n|--------|-----------|--------|\n| Yes | No condition / condition met | Update (localization detection) |\n| Yes | Condition not met | Suggest deletion |\n| No | - | Protect (user custom) |\n\n#### Skills Gate Enablement Proposal\n\nIf Skills Gate is disabled and `skills-gate.md` doesn't exist, propose enablement.\n\n```bash\n# If Skills Gate disabled, propose enablement\nif [ \"$SKILLS_GATE_ENABLED\" != \"true\" ]; then\n  echo \"\"\n  echo \"💡 Enable Skills Gate?\"\n  echo \"\"\n  echo \"Skills Gate prompts skill usage before code editing.\"\n  echo \"- Rules: Make Claude recognize 'should use skills'\"\n  echo \"- Hooks: Last line of defense if forgotten\"\n  echo \"\"\n  echo \"If enabled:\"\n  echo \"- skills-gate.md rule will be added\"\n  echo \"- Skill usage becomes habitual, improving work quality\"\n  echo \"\"\nfi\n```\n\n**Wait for response**\n\n- **yes** → Enable Skills Gate and add `skills-gate.md`\n- **no** → Skip\n\n```bash\n# If user selected yes\nif [ \"$USER_CHOICE\" = \"yes\" ]; then\n  # Enable skills-config.json\n  if [ -f \"$SKILLS_CONFIG\" ]; then\n    jq '.enabled = true' \"$SKILLS_CONFIG\" > tmp.json && mv tmp.json \"$SKILLS_CONFIG\"\n  else\n    mkdir -p .claude/state\n    cat > \"$SKILLS_CONFIG\" << EOF\n{\n  \"version\": \"1.0\",\n  \"enabled\": true,\n  \"skills\": [\"impl\", \"review\"],\n  \"updated_at\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n}\nEOF\n  fi\n\n  # Add skills-gate.md\n  cp \"$PLUGIN_PATH/templates/rules/skills-gate.md.template\" \".claude/rules/skills-gate.md\"\n  sed -i '' \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \".claude/rules/skills-gate.md\" 2>/dev/null || \\\n  sed -i \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \".claude/rules/skills-gate.md\"\n  echo \"✅ Skills Gate enabled\"\n  echo \"✅ Created: .claude/rules/skills-gate.md\"\nfi\n```\n\n### Step 4.5: Skills Settings Diff Detection and Update\n\nCompare plugin skills with project settings to detect and propose diffs.\n\n#### Step 4.5.1: Get Plugin Skills List\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nSKILLS_CONFIG=\".claude/state/skills-config.json\"\nmkdir -p .claude/state\n\n# Get available skills list from plugin\nAVAILABLE_SKILLS=()\nif [ -d \"$PLUGIN_ROOT/skills\" ]; then\n  for skill_dir in \"$PLUGIN_ROOT/skills\"/*/; do\n    if [ -d \"$skill_dir\" ]; then\n      skill_name=$(basename \"$skill_dir\")\n      AVAILABLE_SKILLS+=(\"$skill_name\")\n    fi\n  done\nfi\n\necho \"📦 Plugin available skills: ${AVAILABLE_SKILLS[*]}\"\n```\n\n#### Step 4.5.2: Get Project Settings\n\n```bash\nif [ -f \"$SKILLS_CONFIG\" ]; then\n  # Get skills list from existing settings\n  if command -v jq >/dev/null 2>&1; then\n    CURRENT_SKILLS=$(jq -r '.skills[]?' \"$SKILLS_CONFIG\" 2>/dev/null | tr '\\n' ' ')\n  else\n    CURRENT_SKILLS=\"\"\n  fi\n  echo \"📋 Project registered skills: $CURRENT_SKILLS\"\nelse\n  CURRENT_SKILLS=\"\"\n  echo \"📋 Project registered skills: (not configured)\"\nfi\n```\n\n#### Step 4.5.3: Detect Diffs\n\n```bash\nNEW_SKILLS=()\nREMOVED_SKILLS=()\n\n# Skills in plugin but not in project (new candidates)\nfor skill in \"${AVAILABLE_SKILLS[@]}\"; do\n  if ! echo \"$CURRENT_SKILLS\" | grep -qw \"$skill\"; then\n    NEW_SKILLS+=(\"$skill\")\n  fi\ndone\n\n# Skills in project but not in plugin (removal candidates)\nfor skill in $CURRENT_SKILLS; do\n  found=false\n  for avail in \"${AVAILABLE_SKILLS[@]}\"; do\n    if [ \"$skill\" = \"$avail\" ]; then\n      found=true\n      break\n    fi\n  done\n  if [ \"$found\" = false ]; then\n    REMOVED_SKILLS+=(\"$skill\")\n  fi\ndone\n```\n\n#### Step 4.5.4: Propose If Diffs Found\n\n**If new skills detected:**\n\n> 🆕 **New skills available**\n>\n> The following skills have been added:\n> {{NEW_SKILLS list and descriptions}}\n>\n> **Add them?**\n> - **yes** - Add all\n> - **select** - Select individually\n> - **skip** - Don't add now\n\n**Wait for response**\n\n- **yes** → Add all new skills to skills-config.json\n- **select** → Review each skill individually\n- **skip** → Don't update skills-config.json\n\n**If removed skills detected:**\n\n> ⚠️ **The following skills have been removed from plugin**\n>\n> {{REMOVED_SKILLS list}}\n>\n> Remove from settings? (yes / no)\n\n**Wait for response**\n\n#### Step 4.5.5: Update skills-config.json\n\n```bash\nif [ -f \"$SKILLS_CONFIG\" ]; then\n  # Preserve existing settings while adding new skills\n  if command -v jq >/dev/null 2>&1; then\n    # Add approved new skills\n    for skill in \"${APPROVED_NEW_SKILLS[@]}\"; do\n      jq --arg s \"$skill\" '.skills += [$s] | .skills |= unique' \"$SKILLS_CONFIG\" > tmp.json\n      mv tmp.json \"$SKILLS_CONFIG\"\n    done\n\n    # Remove deleted skills\n    for skill in \"${APPROVED_REMOVED_SKILLS[@]}\"; do\n      jq --arg s \"$skill\" '.skills -= [$s]' \"$SKILLS_CONFIG\" > tmp.json\n      mv tmp.json \"$SKILLS_CONFIG\"\n    done\n\n    # Update version and timestamp\n    jq '.version = \"1.0\" | .updated_at = \"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\"' \"$SKILLS_CONFIG\" > tmp.json\n    mv tmp.json \"$SKILLS_CONFIG\"\n    echo \"✅ skills-config.json: Updated\"\n  else\n    echo \"⚠️ jq not found. Skills settings auto-update skipped\"\n    echo \"   Run /skills-update manually or install jq\"\n  fi\nelse\n  # Create new (default skills + approved new skills)\n  DEFAULT_SKILLS='[\"impl\", \"review\"]'\n  cat > \"$SKILLS_CONFIG\" << SKILLSEOF\n{\n  \"version\": \"1.0\",\n  \"enabled\": true,\n  \"skills\": $DEFAULT_SKILLS,\n  \"updated_at\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n}\nSKILLSEOF\n  echo \"✅ skills-config.json: Created\"\nfi\n```\n\n> 💡 **About Skills Diff Detection**\n> - When plugin update adds new skills, auto-detected and proposed\n> - Existing skill settings preserved\n> - Individual skill add/remove also available with `/skills-update` command\n\n### Step 5: Update Cursor Commands (For 2-Agent mode)\n\nUpdate only if `.cursor/commands/` exists.\n\n**IMPORTANT: Cursor commands are ALWAYS overwritten, never merged.**\n\nUnlike other workflow files, Cursor command templates:\n- Are **not localized** (users should not modify them)\n- Should be **completely replaced** with latest plugin templates\n- Do **NOT read existing files** before updating\n\n**Update procedure**:\n\n1. **Do NOT read** existing `.cursor/commands/*.md` files\n2. **Read only** from plugin templates: `templates/cursor/commands/*.md`\n3. **Overwrite** target files completely with template content\n\n```bash\nif [ -d .cursor/commands ]; then\n  PLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n  # OVERWRITE (not merge) with latest command templates\n  for cmd in \"$PLUGIN_PATH/templates/cursor/commands\"/*.md; do\n    if [ -f \"$cmd\" ]; then\n      # Skip CLAUDE.md (claude-mem context file)\n      [ \"$(basename \"$cmd\")\" = \"CLAUDE.md\" ] && continue\n      cp \"$cmd\" .cursor/commands/\n      echo \"✅ Overwritten: $(basename $cmd)\"\n    fi\n  done\nfi\n```\n\n**Target files** (5 commands):\n- `start-session.md` - Session start\n- `plan-with-cc.md` - Plan creation\n- `handoff-to-claude.md` - Task handoff\n- `review-cc-work.md` - Implementation review\n- `project-overview.md` - Project overview\n\n### Step 6: Hooks Permission Check (Auto-execute)\n\n**Auto-fix execution permissions for shell scripts in `.claude/hooks/`**:\n\n```bash\n# Check and fix .claude/hooks/*.sh execution permissions\nif [ -d .claude/hooks ]; then\n  FIXED_COUNT=0\n  for script in .claude/hooks/*.sh; do\n    [ -f \"$script\" ] || continue\n    if [ ! -x \"$script\" ]; then\n      chmod +x \"$script\"\n      echo \"✅ Fixed permission: $script\"\n      FIXED_COUNT=$((FIXED_COUNT + 1))\n    fi\n  done\n  if [ \"$FIXED_COUNT\" -gt 0 ]; then\n    echo \"ℹ️ Fixed execution permissions for $FIXED_COUNT shell script(s)\"\n  fi\nfi\n```\n\n**Why this matters**: Shell scripts without execution permission (`chmod +x`) will fail to run as hooks, causing silent failures or errors.\n\n### Step 7: Update Version File\n\nUpdate `.claude-code-harness-version` to latest:\n\n```bash\ncat > .claude-code-harness-version <<EOF\n# claude-code-harness version tracking\n# This file is auto-generated by /harness-update\n# DO NOT manually edit - used for update detection\n\nversion: $PLUGIN_VERSION\ninstalled_at: $(grep \"^installed_at:\" .claude-code-harness-version | cut -d' ' -f2)\nupdated_at: $(date +%Y-%m-%d)\nlast_setup_command: harness-update\nEOF\n\necho \"✅ Version updated: v$CURRENT_VERSION → v$PLUGIN_VERSION\"\n```\n\n---\n\n## Phase 2A: Selective Update (Custom selection)\n\n> 📋 **Which files to update?**\n>\n> 1. `.claude/settings.json` - Security policy and permission syntax\n> 2. `AGENTS.md` / `CLAUDE.md` / `Plans.md` - Workflow files\n> 3. `.claude/rules/` - Rule templates\n> 4. `.cursor/commands/` - Cursor commands (2-Agent mode)\n> 5. All\n>\n> Select by number (multiple ok, comma-separated):\n\n**Wait for response**\n\nExecute only selected files' Phase 2 steps.\n\n---\n\n## Phase 3: Verification and Completion\n\n### Step 1: Post-Update Re-verification (Confirm All Files Latest)\n\n**Important**: Run `template-tracker.sh check` again after update to **confirm all files are now latest**.\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n# Re-verify\nVERIFY_RESULT=$(bash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" check 2>/dev/null)\n\nREMAINING_UPDATES=$(echo \"$VERIFY_RESULT\" | jq -r '.updatesCount // 0')\nREMAINING_INSTALLS=$(echo \"$VERIFY_RESULT\" | jq -r '.installsCount // 0')\nREMAINING_TOTAL=$((REMAINING_UPDATES + REMAINING_INSTALLS))\n\nif [ \"$REMAINING_TOTAL\" -gt 0 ]; then\n  echo \"⚠️ Some files not yet updated: ${REMAINING_TOTAL} files\"\n  echo \"   Retry update or manual intervention needed\"\nelse\n  echo \"✅ All files updated to latest\"\nfi\n```\n\n**If remaining:**\n\n> ⚠️ **Some files not updated**\n>\n> | File | Status | Reason |\n> |------|--------|--------|\n> {{remaining files list}}\n>\n> **Options:**\n> 1. **Retry** - Re-run update process\n> 2. **Manual** - Manually merge localized files\n> 3. **Skip** - End as-is (re-detected on next `/harness-update`)\n\n**Wait for response**\n\n- **Retry** → Return to Phase 2, process remaining files\n- **Manual** → Show list and instructions for manual intervention files\n- **Skip** → Step 2 (include warning in completion report)\n\n### Step 2: Syntax Check\n\n```bash\n# settings.json syntax check\nif command -v jq >/dev/null 2>&1; then\n  jq empty .claude/settings.json 2>/dev/null && echo \"✅ settings.json: Valid\" || echo \"⚠️ settings.json: Syntax error\"\nfi\n\n# Verify version file\n[ -f .claude-code-harness-version ] && echo \"✅ version file: Exists\" || echo \"⚠️ version file: Missing\"\n```\n\n### Step 3: Update Completion Report\n\n**Processing results summary**:\n\n```\n📊 Update Report\n\nProcessing results:\n├── Updated: N files\n├── Created: N files\n├── Skipped: N files (with reasons)\n└── Manual: N files\n\nFile-by-file results:\n├── [1/5] ✅ CLAUDE.md - Overwrite complete\n├── [2/5] ✅ AGENTS.md - Overwrite complete\n├── [3/5] ✅ .claude/rules/workflow.md - Overwrite complete\n├── [4/5] ✅ .claude/settings.json - Merge complete\n└── [5/5] 🔧 Plans.md - Manual merge recommended\n```\n\n> ✅ **Update complete!**\n>\n> **Update summary:**\n> - Version: v{{CURRENT}} → v{{LATEST}}\n> - Files processed: {{processed}}/{{total}} files\n> - Update method: Overwrite {{N}} / Merge {{N}} / Manual {{N}}\n> - Backup: `.claude-code-harness/backups/{{TIMESTAMP}}/`\n>\n> **File-by-file results:**\n>\n> | File | Result | Method |\n> |------|--------|--------|\n> {{file-by-file results list}}\n>\n> **Next steps:**\n> - \"`/sync-status`\" → Check current status\n> - \"`/plan-with-agent` I want to build XXX\" → Add new tasks\n> - \"`/work`\" → Execute Plans.md tasks\n>\n> **If issues occur:**\n> ```bash\n> # Restore from backup\n> cp -r .claude-code-harness/backups/{{TIMESTAMP}}/* .\n> ```\n\n---\n\n## Phase 2B: Selective Update (Custom selection)\n\nUpdate only user-selected files.\n\n---\n\n## Notes\n\n- **Backup required**: Always create backup before update\n- **Existing data preserved**: Plans.md tasks, settings.json custom settings preserved\n- **Non-destructive merge**: Existing files merged, not overwritten\n- **Don't forget verification**: Check status with `/sync-status` after update\n\n---\n\n## Troubleshooting\n\n### Q: Settings disappeared after update\n\nA: Restore from backup:\n```bash\ncp -r .claude-code-harness/backups/{{TIMESTAMP}}/* .\n```\n\n### Q: Permission syntax error occurs\n\nA: Manually fix `.claude/settings.json` or run `/harness-update` again.\nCorrect syntax: `\"Bash(npm run:*)\"` / Wrong: `\"Bash(npm run *)\"`\n\n### Q: I want to update only specific files\n\nA: Select \"custom\" and choose only needed files.\n\n---\n\n## Related Commands\n\n- `/harness-init` - New project setup\n- `/sync-status` - Check current project status\n- `/validate` - Validate project structure\n",
        "commands/optional/localize-rules.md": "---\ndescription: \"[オプション] プロジェクト構造に合わせてルールをローカライズ\"\ndescription-en: \"[Optional] Localize rules to project structure\"\n---\n\n# /localize-rules\n\nプロジェクトの構造を分析し、`.claude/rules/` のルールファイルをプロジェクトに最適化します。\n\n## バイブコーダー向け（こう言えばOK）\n\n- 「**このプロジェクト用のルールに合わせて**」→ このコマンド\n- 「**このリポジトリの構造に合わせてルールを整えて**」→ ディレクトリ/言語/テスト構成を自動検出して反映します\n- 「**何を決めればいいか分からない**」→ まず“検出→提案”して、必要なものだけ確定します\n\n## できること（成果物）\n\n- `.claude/rules/` のルールを、実プロジェクトの構造に合わせて更新する\n- 以後の作業で「触って良い場所/テスト/規約」がブレにくくなる\n\n---\n\n## このコマンドの目的\n\nジェネリックなルールテンプレートを、実際のプロジェクト構造に合わせてカスタマイズします：\n\n- **paths:** を実際のソースディレクトリに合わせる（`src/`, `app/`, `lib/` など）\n- 言語固有のルールを追加（TypeScript, Python, React など）\n- テストディレクトリを自動検出\n\n---\n\n## 実行手順（必須）\n\n以下のスクリプトを実行してください：\n\n```bash\nbash \"${CLAUDE_PLUGIN_ROOT}/scripts/localize-rules.sh\"\n```\n\nまたは dry-run で確認：\n\n```bash\nbash \"${CLAUDE_PLUGIN_ROOT}/scripts/localize-rules.sh\" --dry-run\n```\n\n> 補足: `CLAUDE_PLUGIN_ROOT` が使えない環境では、プラグインリポジトリ直下から `bash ./scripts/localize-rules.sh` を実行してください。\n\n---\n\n## 検出項目\n\n### 言語・フレームワーク\n\n| 検出ファイル | 言語/フレームワーク |\n|-------------|---------------------|\n| `package.json` + `tsconfig.json` | TypeScript |\n| `package.json` + `react` | React |\n| `package.json` + `next` | Next.js |\n| `requirements.txt` / `pyproject.toml` | Python |\n| `go.mod` | Go |\n| `Cargo.toml` | Rust |\n| `Gemfile` | Ruby |\n\n### ソースディレクトリ\n\n優先順位で検出：\n1. `src/`, `app/`, `lib/`\n2. `pages/`, `app/` (Next.js)\n3. Python パッケージディレクトリ\n\n### テストディレクトリ\n\n- `tests/`, `test/`, `__tests__/`, `spec/`, `e2e/`\n- Colocated tests (`*.test.ts`, `*.spec.js`)\n\n---\n\n## 出力例\n\n### TypeScript + React プロジェクト\n\n```markdown\n---\npaths: \"src/**/*.{ts,tsx,js,jsx}\"\n---\n\n# Coding Standards\n\n## TypeScript 固有\n- `any` は使用禁止\n- 戻り値の型は明示する\n\n## React 固有\n- 関数コンポーネントを使用\n- カスタムフックは `use` プレフィックス\n```\n\n### Python プロジェクト\n\n```markdown\n---\npaths: \"mypackage/**/*.py, src/**/*.py\"\n---\n\n# Coding Standards\n\n## Python 固有\n- PEP 8 スタイルガイドに従う\n- 型ヒントを使用する\n```\n\n---\n\n## 注意事項\n\n- 既存のカスタマイズは上書きされます\n- バックアップを取ってから実行することを推奨\n- `--dry-run` で事前確認が可能\n",
        "commands/optional/lsp-setup.md": "---\ndescription: \"[Optional] LSP setup (Language Server installation and configuration)\"\ndescription-en: \"[Optional] LSP setup (Language Server installation and configuration)\"\n---\n\n# /lsp-setup - LSP Setup\n\nIntroduce and configure LSP (Language Server Protocol) functionality to existing projects.\n\n## VibeCoder Phrases\n\n- \"**Enable LSP**\" → this command\n- \"**Enable code jumping**\" → Enable Go-to-definition\n- \"**I want to detect type errors beforehand**\" → Configure LSP Diagnostics\n\n## Deliverables\n\n1. Auto-detect project languages\n2. Check and install required language servers\n3. **Install official LSP plugins**\n4. Run verification tests\n\n---\n\n## Official LSP Plugins (Recommended)\n\nOfficial LSP plugins available in Claude Code marketplace:\n\n| Plugin | Language | Required Language Server |\n|--------|----------|-------------------------|\n| `typescript-lsp` | TypeScript/JavaScript | typescript-language-server |\n| `pyright-lsp` | Python | pyright |\n| `rust-analyzer-lsp` | Rust | rust-analyzer |\n\n> **Important**: Plugins do **not include** language server binaries.\n> Separate installation is required.\n\n---\n\n## Setup Flow\n\n### Phase 1: Language Detection\n\n```\n🔍 Detecting Project Languages\n\nDetection files:\n├── tsconfig.json → TypeScript ✅\n├── package.json → JavaScript/TypeScript ✅\n├── requirements.txt → Python ✅\n├── pyproject.toml → Python ✅\n├── Cargo.toml → Rust\n└── go.mod → Go\n\nDetection results:\n├── TypeScript ✅\n└── Python ✅\n```\n\n### Phase 2: Language Server Check and Installation\n\n```\n🔧 Language Server Status\n\n| Language | Language Server | Status |\n|----------|-----------------|--------|\n| TypeScript | typescript-language-server | ❌ Not installed |\n| Python | pyright | ❌ Not installed |\n\n❌ Some language servers are not installed.\n```\n\n> **Install them?**\n>\n> - **yes** - Auto install (Recommended)\n> - **manual** - Show commands only\n> - **skip** - Continue without LSP\n\n**Wait for response**\n\n#### If \"yes\" selected: Auto Installation\n\n```bash\necho \"📦 Installing language servers...\"\n\n# TypeScript\nnpm install -g typescript typescript-language-server\necho \"✅ typescript-language-server installation complete\"\n\n# Python\npip install pyright\n# or npm install -g pyright\necho \"✅ pyright installation complete\"\n\n# Verify installation\nwhich typescript-language-server && echo \"✅ TypeScript LSP: OK\"\nwhich pyright && echo \"✅ Python LSP: OK\"\n```\n\n#### If \"manual\" selected: Display Commands\n\n```\n📋 Please run the following commands:\n\n# TypeScript/JavaScript\nnpm install -g typescript typescript-language-server\n\n# Python\npip install pyright\n# or\nnpm install -g pyright\n\n# Rust\n# rust-analyzer official installation: https://rust-analyzer.github.io/manual.html#installation\n\nAfter installation, run /lsp-setup again.\n```\n\n### Phase 3: Official Plugin Installation\n\n```\n📦 Installing official LSP plugins...\n```\n\n```bash\n# Install plugins for detected languages\nclaude plugin install typescript-lsp\nclaude plugin install pyright-lsp\n\necho \"✅ LSP plugin installation complete\"\n```\n\n```\n✅ Installed plugins:\n\n| Plugin | Status |\n|--------|--------|\n| typescript-lsp | ✅ Installed |\n| pyright-lsp | ✅ Installed |\n```\n\n### Phase 4: Verification\n\n```\n✅ LSP Verification\n\nTest: Go-to-definition\n  → src/index.ts:15 'handleSubmit' → src/handlers.ts:42 ✅\n\nTest: Find-references\n  → 'userId' references: 8 found ✅\n\nTest: Diagnostics\n  → Errors: 0 / Warnings: 2 ✅\n\n🎉 LSP Setup Complete!\n```\n\n---\n\n## Language Server and Plugin Reference Table\n\n| Language | Language Server | Install Command | Official Plugin |\n|----------|-----------------|-----------------|-----------------|\n| **TypeScript/JS** | typescript-language-server | `npm install -g typescript typescript-language-server` | `typescript-lsp` |\n| **Python** | pyright | `pip install pyright` or `npm install -g pyright` | `pyright-lsp` |\n| **Rust** | rust-analyzer | [Official guide](https://rust-analyzer.github.io/manual.html#installation) | `rust-analyzer-lsp` |\n| **Go** | gopls | `go install golang.org/x/tools/gopls@latest` | `gopls-lsp` |\n| **C/C++** | clangd | macOS: `brew install llvm` / Ubuntu: `apt install clangd` | `clangd-lsp` |\n| **Java** | jdtls | [Official guide](https://github.com/eclipse/eclipse.jdt.ls) | `jdtls-lsp` |\n| **Swift** | sourcekit-lsp | Included with Xcode | `swift-lsp` |\n| **Lua** | lua-language-server | [Official guide](https://github.com/LuaLS/lua-language-server) | `lua-lsp` |\n| **PHP** | intelephense | `npm install -g intelephense` | `php-lsp` |\n| **C#** | omnisharp | [Official guide](https://github.com/OmniSharp/omnisharp-roslyn) | `csharp-lsp` |\n\n---\n\n## Zero to Setup Guide (Summary)\n\nSteps to enable LSP from a completely unconfigured state:\n\n```bash\n# Step 1: Install language servers\nnpm install -g typescript typescript-language-server  # TypeScript\npip install pyright                                    # Python\n\n# Step 2: Install official plugins\nclaude plugin install typescript-lsp\nclaude plugin install pyright-lsp\n\n# Step 3: Start Claude Code (LSP auto-enabled)\nclaude\n```\n\nNow Go-to-definition, Find-references, and Diagnostics are available.\n\n---\n\n## Creating Custom LSP Plugins\n\nIf official plugins don't exist in the marketplace for your language, or if you need custom LSP server configuration, you can create custom plugins (`.lsp.json`).\n\n> **Note**: TypeScript/JS, Python, Rust, Go, C/C++, Java, Swift, Lua, PHP, C# have official plugins. First search \"lsp\" with `/plugin`.\n\n### `.lsp.json` Format\n\n**Example**: Starting Go LSP server with custom settings\n\n```json\n{\n  \"go\": {\n    \"command\": \"gopls\",\n    \"args\": [\"serve\"],\n    \"extensionToLanguage\": {\n      \".go\": \"go\"\n    }\n  }\n}\n```\n\n### Required Fields\n\n| Field | Description |\n|-------|-------------|\n| `command` | LSP server binary name (must exist in PATH) |\n| `extensionToLanguage` | File extension → language identifier mapping |\n\n### Optional Fields\n\n| Field | Description |\n|-------|-------------|\n| `args` | Command line arguments |\n| `env` | Environment variables |\n| `initializationOptions` | Initialization options |\n| `startupTimeout` | Startup timeout (milliseconds) |\n| `restartOnCrash` | Auto-restart on crash |\n\n### Custom Plugin Creation Example\n\n```bash\n# Create directory\nmkdir my-go-lsp\nmkdir my-go-lsp/.claude-plugin\n\n# plugin.json\ncat > my-go-lsp/.claude-plugin/plugin.json << 'EOF'\n{\n  \"name\": \"my-go-lsp\",\n  \"description\": \"Go LSP support\",\n  \"version\": \"1.0.0\",\n  \"author\": { \"name\": \"Your Name\" },\n  \"lspServers\": \"./.lsp.json\"\n}\nEOF\n\n# .lsp.json\ncat > my-go-lsp/.lsp.json << 'EOF'\n{\n  \"go\": {\n    \"command\": \"gopls\",\n    \"args\": [\"serve\"],\n    \"extensionToLanguage\": {\n      \".go\": \"go\"\n    }\n  }\n}\nEOF\n\n# Install\nclaude plugin install ./my-go-lsp\n```\n\n---\n\n## Troubleshooting\n\n### \"Executable not found in $PATH\" Error\n\nLanguage server is not installed or not in PATH.\n\n```bash\n# Check path\necho $PATH\n\n# Check and add npm global path\nexport PATH=\"$PATH:$(npm config get prefix)/bin\"\n```\n\n### Check Plugin Errors\n\n```\nCheck \"Errors\" tab with /plugin command\n```\n\n### LSP Not Responding\n\n1. Restart Claude Code\n2. Verify language server is correctly installed\n3. Check plugin status with `/plugin`\n\n---\n\n## Related Documentation\n\n- [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md) - LSP Usage Guide\n- [Claude Code Plugins Reference](https://code.claude.com/docs/en/plugins-reference) - Official Plugin Reference\n",
        "commands/optional/mcp-setup.md": "---\ndescription: Harness MCP サーバーをセットアップ（クロスクライアント連携）\ndescription-en: Setup Harness MCP server for cross-client communication\n---\n\n# /mcp-setup - MCP サーバーセットアップ\n\nHarness MCP サーバーをセットアップして、**Claude Code、Codex、Cursor 間のセッション通信**を有効にします。\n\n## VibeCoder Quick Reference\n\n- \"**Codex と連携したい**\" → このコマンド\n- \"**別のAIツールと一緒に使いたい**\" → MCP セットアップ\n- \"**セッション共有したい**\" → クロスクライアント通信を有効化\n\n## Deliverables\n\n- MCP サーバーの設定ファイル\n- クライアント別の設定手順\n- 動作確認ガイド\n\n---\n\n## Usage\n\n```bash\n/mcp-setup\n```\n\n---\n\n## Execution Flow\n\n### Step 1: クライアント選択\n\n> 🔧 **どのクライアントで MCP を使用しますか？**\n>\n> 1. Claude Code のみ\n> 2. Claude Code + Codex\n> 3. Claude Code + Cursor\n> 4. すべて（Claude Code + Codex + Cursor）\n>\n> 番号で回答（デフォルト: 1）\n\n**ユーザーの回答を待つ**\n\n### Step 2: 設定ファイル生成\n\n選択に応じて設定ファイルを生成：\n\n#### Claude Code 設定\n\n`.claude/settings.json` に追記：\n\n```json\n{\n  \"mcpServers\": {\n    \"harness\": {\n      \"command\": \"node\",\n      \"args\": [\"${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js\"]\n    }\n  }\n}\n```\n\n#### Codex 設定（選択時）\n\n`~/.codex/mcp.json` を生成：\n\n```json\n{\n  \"servers\": {\n    \"harness\": {\n      \"command\": \"node\",\n      \"args\": [\"/path/to/claude-code-harness/mcp-server/dist/index.js\"]\n    }\n  }\n}\n```\n\n#### Cursor 設定（選択時）\n\n`.cursor/mcp.json` を生成：\n\n```json\n{\n  \"harness\": {\n    \"command\": \"node\",\n    \"args\": [\"/path/to/claude-code-harness/mcp-server/dist/index.js\"]\n  }\n}\n```\n\n### Step 3: MCP サーバービルド\n\n```bash\ncd \"${CLAUDE_PLUGIN_ROOT}/mcp-server\"\nnpm install\nnpm run build\n```\n\n### Step 4: 動作確認\n\n> ✅ **MCP セットアップ完了**\n>\n> 📄 **設定ファイル**:\n> - `.claude/settings.json` - Claude Code 用\n> - `~/.codex/mcp.json` - Codex 用（選択時）\n> - `.cursor/mcp.json` - Cursor 用（選択時）\n>\n> **利用可能なツール**:\n>\n> | ツール | 説明 |\n> |--------|------|\n> | `harness_session_list` | アクティブセッション一覧 |\n> | `harness_session_broadcast` | 全セッションに通知 |\n> | `harness_session_inbox` | 受信メッセージ確認 |\n> | `harness_workflow_plan` | プラン作成 |\n> | `harness_workflow_work` | タスク実行 |\n> | `harness_workflow_review` | コードレビュー |\n> | `harness_status` | プロジェクト状態 |\n>\n> **動作確認**:\n> 1. Claude Code を再起動\n> 2. \"harness_session_list を実行して\" と入力\n> 3. セッション一覧が表示されれば成功\n\n---\n\n## Cross-Client Workflow Example\n\n### シナリオ: Claude Code と Codex で同じプロジェクトを作業\n\n```\n[Claude Code]\nYou: harness_session_register を実行して、client: \"claude-code\"\n\nClaude: ✅ Session registered: session-abc123 (claude-code)\n\nYou: API を変更したので broadcast して\n\nClaude: 📤 Broadcast sent: \"UserAPI: userId → user に変更\"\n\n---\n\n[Codex]\nYou: harness_session_inbox を確認して\n\nCodex: 📨 1 message(s):\n       [10:30] claude-code: UserAPI: userId → user に変更\n\nYou: OK、新しい API を使って実装を続けて\n```\n\n---\n\n## Available MCP Tools\n\n### Session Tools\n\n| ツール | 引数 | 説明 |\n|--------|------|------|\n| `harness_session_list` | なし | アクティブセッション一覧 |\n| `harness_session_broadcast` | `message: string` | メッセージ送信 |\n| `harness_session_inbox` | `since?: string` | 受信確認 |\n| `harness_session_register` | `client, sessionId` | セッション登録 |\n\n### Workflow Tools\n\n| ツール | 引数 | 説明 |\n|--------|------|------|\n| `harness_workflow_plan` | `task, mode?` | プラン作成 |\n| `harness_workflow_work` | `parallel?, full?, taskId?` | タスク実行 |\n| `harness_workflow_review` | `files?, focus?, ci?` | レビュー |\n\n### Status Tools\n\n| ツール | 引数 | 説明 |\n|--------|------|------|\n| `harness_status` | `verbose?` | 状態確認 |\n\n---\n\n## Troubleshooting\n\n### MCP サーバーが起動しない\n\n**原因**: Node.js のバージョンが古い\n\n**解決**: Node.js 18 以上をインストール\n\n```bash\nnode --version  # v18.0.0 以上が必要\n```\n\n### ツールが見つからない\n\n**原因**: MCP サーバーがビルドされていない\n\n**解決**:\n\n```bash\ncd /path/to/claude-code-harness/mcp-server\nnpm run build\n```\n\n### セッション間でメッセージが届かない\n\n**原因**: 同じプロジェクトディレクトリで実行していない\n\n**解決**: 両方のクライアントを同じプロジェクトルートで起動\n\n---\n\n## Related Commands\n\n- `/session-broadcast` - プラグイン版メッセージ送信\n- `/session-inbox` - プラグイン版受信確認\n- `/session-list` - プラグイン版セッション一覧\n\n---\n\n## Notes\n\n- MCP サーバーはプラグイン機能の拡張版です\n- プラグイン版（`/session-*`）と MCP 版は同じデータを共有します\n- MCP 非対応のクライアントでもプラグイン版は使用可能\n- セッションデータは `.claude/sessions/` に保存されます\n",
        "commands/optional/opencode-setup.md": "---\ndescription: opencode.ai 用にプロジェクトをセットアップ\ndescription-en: Setup project for opencode.ai compatibility\n---\n\n# /opencode-setup - OpenCode セットアップ\n\n現在のプロジェクトに opencode.ai 互換のコマンド、スキル、設定ファイルを生成します。\n\n## VibeCoder Quick Reference\n\n- \"**opencode でも使いたい**\" → このコマンド\n- \"**GPT でも Harness 使いたい**\" → opencode セットアップ\n- \"**マルチ LLM 開発したい**\" → opencode 互換設定\n- \"**スキルも opencode で使いたい**\" → このコマンドで自動対応\n\n## Deliverables\n\n- `.opencode/commands/` - opencode 用コマンド（Impl + PM）\n  - `core/` - コアコマンド（/work, /plan-with-agent 等）\n  - `optional/` - オプションコマンド\n  - `pm/` - PM コマンド（OpenCode を PM として使う場合）\n  - `handoff/` - ハンドオフコマンド\n- `.claude/skills/` - opencode 互換スキル（NotebookLM、レビュー等）\n- `AGENTS.md` - opencode 用ルールファイル（CLAUDE.md 全文）\n---\n\n## Usage\n\n```bash\n/opencode-setup\n```\n\n---\n\n## Execution Flow\n\n### Step 1: 確認\n\n> 🔧 **opencode.ai 互換ファイルを生成します**\n>\n> 以下のファイルが作成されます：\n> - `.opencode/commands/` - Harness コマンド\n> - `.claude/skills/` - Harness スキル（NotebookLM、レビュー等）\n> - `AGENTS.md` - ルールファイル（CLAUDE.md 全文）\n>\n> 続行しますか？ (y/n)\n\n**ユーザーの回答を待つ**\n\n### Step 2: ディレクトリ作成\n\n```bash\nmkdir -p .opencode/commands/core\nmkdir -p .opencode/commands/optional\nmkdir -p .opencode/commands/pm\nmkdir -p .opencode/commands/handoff\nmkdir -p .claude/skills\n```\n\n### Step 3: テンプレをコピー（必須）\n\n**必ず Bash で以下を実行**して、テンプレを直接コピーします。\nLLM が内容を自己生成してはいけません。\n\n```bash\nbash ./scripts/opencode-setup-local.sh\n```\n\n### Step 4: コピー内容の確認\n\n```bash\nls -la .opencode/commands\nls -la .claude/skills\nls -la AGENTS.md\n```\n\n### Step 5: 完了メッセージ\n\n> ✅ **OpenCode セットアップ完了**\n>\n> 📁 **生成されたファイル:**\n> - `.opencode/commands/` - Harness コマンド\n>   - `core/` - コアコマンド（/work, /plan-with-agent 等）\n>   - `optional/` - オプションコマンド\n>   - `pm/` - PM コマンド（/start-session, /plan-with-cc 等）\n>   - `handoff/` - ハンドオフコマンド\n> - `.claude/skills/` - Harness スキル\n> - `AGENTS.md` - ルールファイル（CLAUDE.md 全文）\n>\n> **利用可能なスキル:**\n> - `docs` - ドキュメント生成（NotebookLM YAML、スライド）\n> - `impl` - 機能実装\n> - `review` - コードレビュー\n> - `verify` - ビルド検証・エラー復旧\n> - `auth` - 認証・決済（Clerk, Stripe）\n> - `deploy` - デプロイ（Vercel, Netlify）\n>\n> **使い方 (Impl モード - Claude Code で実装する場合):**\n> ```bash\n> # opencode を起動してタスク実行\n> opencode\n> /work\n> ```\n>\n> **使い方 (PM モード - OpenCode で計画管理する場合):**\n> ```bash\n> # opencode を起動してセッション開始\n> opencode\n> /start-session\n> /plan-with-cc\n> /handoff-to-claude  # Claude Code への依頼生成\n> ```\n>\n> **ドキュメント:** https://github.com/Chachamaru127/claude-code-harness\n\n---\n\n## Notes\n\n- 既存の `.opencode/` ディレクトリがある場合は上書き確認\n- `AGENTS.md` が既存の場合はバックアップを作成\n- `.claude/skills/` が既存の場合はバックアップを作成\n- **Windows ユーザー**: シンボリックリンクは管理者権限が必要なため、コピーを推奨\n\n---\n\n## Related Commands\n\n- `/harness-init` - Harness プロジェクト初期化\n- `/harness-update` - Harness 更新\n",
        "commands/optional/release.md": "---\ndescription: リリースプロセス自動化（CHANGELOG更新、バージョン更新、タグ作成）\ndescription-en: Automate release process (CHANGELOG update, version bump, tag creation)\n---\n\n# /release - リリースプロセス自動化\n\nclaude-code-harness のリリースを自動化するコマンドです。\n\n## 実行手順\n\n### Step 1: 変更確認\n\n以下を並列で実行：\n\n1. **git status** で未コミット変更を確認\n2. **git diff --stat** で変更ファイル一覧\n3. **git log --oneline -10** で最近のコミット履歴\n\n### Step 2: バージョン決定\n\n現在のバージョンを確認：\n```bash\ncat VERSION\n```\n\n変更内容に応じてバージョンを決定（[Semantic Versioning](https://semver.org/spec/v2.0.0.html) 準拠）：\n- **patch** (x.y.Z): バグ修正、軽微な改善\n- **minor** (x.Y.0): 新機能追加（後方互換あり）\n- **major** (X.0.0): 破壊的変更\n\nユーザーに確認：「次のバージョンは何にしますか？ (例: 2.5.23)」\n\n### Step 3: CHANGELOG 更新（JP + EN）\n\n**[Keep a Changelog](https://keepachangelog.com/ja/1.0.0/) フォーマットに準拠**\n\n> ⚠️ **注意**: CHANGELOG 作成後、Step 3.5 で README 更新が必要か必ず確認すること（JP/EN 両方）\n\n`CHANGELOG_ja.md`（日本語）と `CHANGELOG.md`（英語）の **両方** で、`## [Unreleased]` の直後に新バージョンのエントリを追加。\n\n#### フォーマット\n\n```markdown\n## [X.Y.Z] - YYYY-MM-DD\n\n### Added\n- 新機能について\n\n### Changed\n- 既存機能の変更について\n\n### Deprecated\n- 間もなく削除される機能について\n\n### Removed\n- 削除された機能について\n\n### Fixed\n- バグ修正について\n\n### Security\n- 脆弱性に関する場合\n\n#### Before/After（大きな変更時のみ）\n\n| Before | After |\n|--------|-------|\n| 変更前の状態 | 変更後の状態 |\n```\n\n#### セクション使い分けのルール\n\n| セクション | 使うとき |\n|------------|----------|\n| Added | 完全に新しい機能を追加したとき |\n| Changed | 既存機能の動作や体験を変更したとき |\n| Deprecated | 将来削除予定の機能を告知するとき |\n| Removed | 機能やコマンドを削除したとき |\n| Fixed | バグや不具合を修正したとき |\n| Security | セキュリティ関連の修正をしたとき |\n\n#### Before/After テーブル\n\n大きな体験変化があるときのみ追加：\n- コマンドの廃止・統合\n- ワークフローの変更\n- 破壊的変更\n\n軽微な修正では省略可。\n\n#### バージョン比較リンク\n\nCHANGELOG.md 末尾のリンクセクションに追加：\n\n```markdown\n[X.Y.Z]: https://github.com/Chachamaru127/claude-code-harness/compare/vPREV...vX.Y.Z\n```\n\n既存の `[Unreleased]` リンクも更新：\n\n```markdown\n[Unreleased]: https://github.com/Chachamaru127/claude-code-harness/compare/vX.Y.Z...HEAD\n```\n\n#### CHANGELOG.md（英語）の書き方\n\n- 目的は **ユーザーが理解できる変更点** を伝えること（コミットログの翻訳ではない）\n- `### 🎯 What's Changed for You` を基本にし、必要なら `#### Before/After` を追加\n- 日本語版（CHANGELOG_ja.md）と **同じバージョン番号が存在** する状態を維持する\n\n### Step 4: バージョン更新\n\n```bash\n# 既定（推奨）: patch リリース\n./scripts/sync-version.sh bump\n\n# minor/major などで明示的に指定したい場合:\necho \"X.Y.Z\" > VERSION\n./scripts/sync-version.sh sync\n```\n\n### Step 5: コミット & タグ\n\n```bash\n# ステージング\ngit add VERSION .claude-plugin/plugin.json .claude-plugin/marketplace.json CHANGELOG.md CHANGELOG_ja.md README.md README_ja.md [変更されたファイル]\n\n# コミット\ngit commit -m \"chore: release vX.Y.Z - 一言説明\n\n- 変更点1\n- 変更点2\n\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\"\n\n# タグ作成\ngit tag -a vX.Y.Z -m \"Release vX.Y.Z: 一言説明\"\n\n# プッシュ\ngit push origin main && git push origin vX.Y.Z\n```\n\n### Step 6: キャッシュ同期\n\n```bash\nbash scripts/sync-plugin-cache.sh\n```\n\n### Step 7: GitHub Releases 作成\n\nタグだけでなく、GitHub Releases にリリースノートを作成します。\n\n```bash\ngh release create vX.Y.Z \\\n  --title \"vX.Y.Z - 一言説明\" \\\n  --notes \"$(cat <<'EOF'\n## 🎯 あなたにとって何が変わるか\n\n**主な変更点の説明**\n\n### Before\n- 変更前の状態\n\n### After\n- 変更後の状態\n\n---\n\n## Added\n- 新機能\n\n## Changed\n- 変更点\n\n## Fixed\n- バグ修正\n\n---\n\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\nEOF\n)\"\n```\n\n**リリースノートの内容**:\n- CHANGELOG.md の該当バージョンのエントリをベースに作成\n- Before/After セクションは大きな変更時のみ\n- `🤖 Generated with [Claude Code]` フッターを追加\n\n### Step 8: 確認\n\n```bash\ngit log --oneline -3\ngit tag | tail -5\ngh release list --limit 5\ncat ~/.claude/plugins/cache/claude-code-harness-marketplace/claude-code-harness/*/VERSION | sort -u\n```\n\n### Step 9: リリースノート検証（必須）\n\n> 🔴 **必ず実行**: リリースノートのフォーマットが `.claude/rules/github-release.md` に準拠しているか検証\n\n```bash\n./scripts/validate-release-notes.sh vX.Y.Z\n```\n\n**チェック項目**:\n- ✅ 見出し: `🎯 あなたにとって何が変わるか`（日本語統一）\n- ✅ Before → After テーブル\n- ✅ フッター: `🤖 Generated with [Claude Code](...)`\n- ✅ 日英混在なし\n\nエラーがある場合は `gh release edit` で修正:\n```bash\ngh release edit vX.Y.Z --notes \"$(cat <<'EOF'\n## 🎯 あなたにとって何が変わるか\n...\nEOF\n)\"\n```\n\n## keepachangelog の原則\n\n1. **人間のために書く** - 機械的なコミットログではなく、ユーザーが理解できる言葉で\n2. **バージョンごとにまとめる** - 同じ種類の変更をグループ化\n3. **最新を先頭に** - 新しいバージョンが上\n4. **日付は ISO 8601** - YYYY-MM-DD 形式\n5. **Unreleased を活用** - 次リリースまでの変更を蓄積\n\n### Step 3.5: README 更新（必須確認）\n\n> 🔴 **必ず確認**: 以下に該当する場合は **README.md と README_ja.md の両方** を更新すること\n\n**対象ファイル**:\n- `README.md` - 英語版（デフォルト）\n- `README_ja.md` - 日本語版\n\n**更新が必要なケース**:\n- ✅ 新機能追加（Added セクションに項目がある）\n- ✅ 既存機能の変更（Changed セクションにユーザー影響がある）\n- ✅ コマンド/スキルの追加・変更\n- ✅ ワークフローの変更\n\n**更新不要なケース**:\n- ❌ バグ修正のみ（Fixed のみ）\n- ❌ 内部リファクタリング\n- ❌ ドキュメント修正のみ\n\n**更新手順**:\n\n1. **README.md（英語）** を更新（デフォルト）\n   - `## What's New in vX.Y` を更新（存在しない場合は追加）\n   - 関連するコマンド/スキルの説明を更新\n\n2. **README_ja.md（日本語）** を同期\n   - `## vX.Y の新機能 | What's New in vX.Y` を更新（存在しない場合は追加）\n   - 関連するコマンド/スキルの説明を更新\n\n3. **バージョンバッジ** を両方で確認（`./scripts/sync-version.sh` が自動更新しますが、差分が出ていないか目視チェック）\n   ```markdown\n   [![Version: X.Y.Z](https://img.shields.io/badge/version-X.Y.Z-blue.svg)](VERSION)\n   ```\n\n**新機能セクションの例**:\n\nREADME.md:\n```markdown\n### Feature Name (vX.Y.Z)\n\n**English explanation**\n\n- Feature 1\n- Feature 2\n```\n\nREADME_ja.md:\n```markdown\n### 機能名（vX.Y.Z）| Feature Name\n\n**日本語説明**\n*English explanation*\n\n- 機能の特徴1\n- 機能の特徴2\n```\n\n**更新対象セクション例**:\n| README.md | README_ja.md |\n|-----------|--------------|\n| \"What's New in vX.Y\" | 「vX.Y の新機能 \\| What's New in vX.Y」 |\n| 「3行でわかる」 | \"In 3 Lines\" |\n| 「機能一覧」 | \"Features\" |\n| 「コマンド早見表」 | \"Command Quick Reference\" |\n\n## 注意事項\n\n- `skills/test-*` などのテストディレクトリは含めない\n- コミットメッセージは Conventional Commits に従う\n",
        "commands/optional/remotion-setup.md": "---\ndescription: Remotion動画生成環境をセットアップ\ndescription-en: Setup Remotion video generation environment\n---\n\n# /remotion-setup - Remotion セットアップ\n\nRemotionによるプログラマティック動画生成環境をセットアップします。\n\n## VibeCoder Quick Reference\n\n- \"**動画を作りたい**\" → このコマンド\n- \"**プロダクト紹介動画**\" → まずこのセットアップ\n- \"**Remotion使いたい**\" → このコマンド\n\n## Deliverables\n\n- `remotion/` - Remotionプロジェクトディレクトリ\n- Remotion Agent Skills（Claude Code連携）\n- Harness用テンプレート（オプション）\n\n---\n\n## Prerequisites\n\n- Node.js 18+\n- pnpm / npm / yarn\n- 十分なディスク容量（約500MB）\n\n---\n\n## Usage\n\n```bash\n/remotion-setup                    # 基本セットアップ\n/remotion-setup --with-templates   # Harnessテンプレート付き\n/remotion-setup --brownfield       # 既存プロジェクトに追加\n```\n\n---\n\n## Execution Flow\n\n### Step 1: 環境確認\n\n```bash\n# Node.js バージョン確認\nnode --version  # 18.0.0 以上必須\n\n# パッケージマネージャー確認\nwhich pnpm || which npm\n```\n\n### Step 2: セットアップ方式の確認\n\n> 🎬 **Remotion セットアップ**\n>\n> セットアップ方式を選択してください：\n>\n> 1. **新規プロジェクト** - `remotion/` ディレクトリを作成\n> 2. **既存プロジェクトに追加** - 現在のプロジェクトに統合\n>\n> どちらを選択しますか？\n\n**AskUserQuestion で確認**\n\n### Step 3a: 新規プロジェクト作成\n\n```bash\n# Remotionプロジェクト作成\nnpx create-video@latest remotion\n\n# 推奨設定:\n# - Template: Empty\n# - TailwindCSS: Yes\n# - Skills: Yes\n```\n\n### Step 3b: 既存プロジェクトに追加（Brownfield）\n\n```bash\n# 必要なパッケージをインストール\nnpm install remotion @remotion/cli @remotion/player\n\n# オプション: レンダリング用\nnpm install @remotion/renderer\n\n# オプション: Lambda用\nnpm install @remotion/lambda\n```\n\n**フォルダ構成を作成**:\n\n```\nremotion/\n├── Composition.tsx    # メインコンポジション\n├── Root.tsx           # Remotionルート\n└── index.ts           # エントリーポイント\n```\n\n### Step 4: Agent Skills インストール\n\n```bash\n# Remotion Skills をインストール\nnpx skills add remotion-dev/skills\n```\n\n**確認**:\n```bash\n# スキルが追加されたか確認\nls .claude/skills/remotion/ 2>/dev/null || echo \"Skills installed in global location\"\n```\n\n### Step 5: Harnessテンプレート追加（オプション）\n\n> 🎨 **Harnessテンプレートを追加しますか？**\n>\n> 以下のテンプレートが利用可能です：\n> - 共有コンポーネント（FadeIn, SlideUp, TextReveal）\n> - ブランドアセット（COLORS, FONTS）\n> - プリセット（1080p, vertical, square）\n>\n> 追加しますか？ (y/n)\n\n**「y」の場合**:\n\n```bash\n# プラグインからテンプレートをコピー\nPLUGIN_DIR=\"${CLAUDE_PLUGIN_ROOT:-$(dirname $(dirname $0))}\"\ncp -r \"$PLUGIN_DIR/templates/remotion/\"* remotion/\n```\n\n### Step 6: package.json スクリプト追加\n\n```json\n{\n  \"scripts\": {\n    \"remotion\": \"remotion studio remotion/index.ts\",\n    \"render\": \"remotion render remotion/index.ts Main out/video.mp4\",\n    \"render:gif\": \"remotion render remotion/index.ts Main out/video.gif\"\n  }\n}\n```\n\n### Step 7: 完了メッセージ\n\n> ✅ **Remotion セットアップ完了**\n>\n> 📁 **作成されたファイル**:\n> - `remotion/` - Remotionプロジェクト\n> - `.claude/skills/remotion/` - Agent Skills\n>\n> **使い方**:\n> ```bash\n> # Studio を起動（プレビュー）\n> npm run remotion\n>\n> # 動画をレンダリング\n> npm run render\n>\n> # Claude Code で動画を作成\n> claude\n> > \"イントロ動画を作って\"\n> ```\n>\n> **次のステップ**:\n> - `/generate-video` で自動動画生成\n> - Studio で手動編集: http://localhost:3000\n>\n> **ドキュメント**: https://www.remotion.dev/docs\n\n---\n\n## Troubleshooting\n\n### \"Cannot find module 'remotion'\"\n\n```bash\n# 依存関係を再インストール\nrm -rf node_modules && npm install\n```\n\n### \"Skills not found\"\n\n```bash\n# グローバルにインストールされている可能性\nnpx skills list\n```\n\n### レンダリングが遅い\n\n```bash\n# 並列レンダリングを有効化\nnpx remotion render --concurrency 4\n```\n\n---\n\n## License Notice\n\n> ⚠️ **Remotion ライセンス**\n>\n> Remotionは企業利用時に有料ライセンスが必要な場合があります。\n> 詳細: https://www.remotion.dev/license\n>\n> 個人・OSS利用は無料です。\n\n---\n\n## Related Commands\n\n- `/generate-video` - 動画自動生成\n- `/mcp-setup` - MCP サーバーセットアップ\n\n---\n\n## Technical References\n\n- [Remotion公式: Claude Code連携](https://www.remotion.dev/docs/ai/claude-code)\n- [Remotion Agent Skills](https://www.remotion.dev/docs/ai/skills)\n- [Brownfield Integration](https://www.remotion.dev/docs/brownfield)\n- [Launchpad テンプレート参考](https://github.com/trycua/launchpad)\n",
        "commands/optional/session.md": "---\ndescription: \"[Optional] Unified session management command (list, inbox, broadcast)\"\ndescription-en: \"[Optional] Unified session management command (list, inbox, broadcast)\"\n---\n\n# /session - Unified Session Management\n\nConsolidates all session-related commands into one unified interface.\n\n## Quick Reference\n\n- \"**Show sessions**\" → `/session list`\n- \"**Check messages**\" → `/session inbox`\n- \"**Send to all**\" → `/session broadcast \"message\"`\n\n## Usage\n\n```bash\n/session              # Show available options\n/session list         # Show active sessions\n/session inbox        # Check incoming messages\n/session broadcast \"message\"  # Send message to all sessions\n```\n\n---\n\n## Subcommands\n\n### `/session list` - List Active Sessions\n\nShows all active Claude Code sessions in the current project.\n\n**Output**:\n```\n📋 Active Sessions\n\n| Session ID | Status | Last Activity |\n|------------|--------|---------------|\n| abc123     | active | 2 min ago     |\n| def456     | idle   | 15 min ago    |\n```\n\n---\n\n### `/session inbox` - Check Inbox\n\nChecks for incoming messages from other sessions.\n\n**Output**:\n```\n📬 Session Inbox\n\n| From | Time | Message |\n|------|------|---------|\n| abc123 | 5m ago | \"Ready for review\" |\n| def456 | 10m ago | \"API implementation done\" |\n```\n\n---\n\n### `/session broadcast \"message\"` - Broadcast Message\n\nSends a message to all active sessions.\n\n**Usage**:\n```bash\n/session broadcast \"Review complete, ready for merge\"\n/session broadcast \"Stopping for today\"\n```\n\n**Output**:\n```\n📢 Broadcast sent to 3 sessions\n```\n\n---\n\n## Migration Note\n\nThis command consolidates the following individual commands:\n- `/session-list` → `/session list`\n- `/session-inbox` → `/session inbox`\n- `/session-broadcast` → `/session broadcast \"message\"`\n\nThe individual commands are deprecated but still work for backward compatibility.\n\n---\n\n## Related\n\n- Session memory is managed by the `session` skill\n- For session initialization, use `/harness-init`\n",
        "commands/optional/setup.md": "---\ndescription: \"[Optional] Unified setup command for CI, LSP, MCP, dev-tools, etc.\"\ndescription-en: \"[Optional] Unified setup command for CI, LSP, MCP, dev-tools, etc.\"\n---\n\n# /setup - Unified Setup Command\n\nConsolidates all setup commands into one unified interface.\n\n## Quick Reference\n\n- \"**Setup CI**\" → `/setup ci`\n- \"**Setup LSP**\" → `/setup lsp`\n- \"**Setup dev tools**\" → `/setup dev-tools` (recommended)\n- \"**Setup MCP**\" → `/setup mcp`\n- \"**Setup OpenCode**\" → `/setup opencode`\n- \"**Setup webhook**\" → `/setup webhook`\n- \"**Setup Harness UI**\" → `/setup ui`\n\n## Usage\n\n```bash\n/setup              # Show available options\n/setup ci           # Setup CI/CD (GitHub Actions)\n/setup dev-tools    # Setup AST-Grep + LSP (recommended)\n/setup lsp          # Setup LSP only\n/setup mcp          # Setup MCP server\n/setup opencode     # Setup OpenCode.ai compatibility\n/setup webhook      # Setup GitHub Actions webhook\n/setup ui           # Setup Harness UI\n```\n\n---\n\n## Subcommands\n\n### `/setup ci` - CI/CD Setup\n\nSets up GitHub Actions for automated testing and deployment.\n\n**Deliverables**:\n- `.github/workflows/*.yml` for lint/typecheck/test/build\n- Failure analysis and fix suggestions\n\n**Features**:\n- ✅ Lint (ESLint, Prettier)\n- ✅ Type Check (TypeScript)\n- ✅ Unit Test (Jest, Vitest)\n- ✅ E2E Test (Playwright)\n- ✅ Build Check\n\n---\n\n### `/setup dev-tools` - Development Tools (Recommended)\n\nSets up AST-Grep and LSP for enhanced code intelligence.\n\n**Deliverables**:\n- AST-Grep MCP server configuration\n- LSP server configuration\n- `.claude/settings.json` updates\n\n**Why recommended**:\n- Structural code search (more accurate than grep)\n- Type-aware navigation and diagnostics\n- Better code review accuracy\n\n---\n\n### `/setup lsp` - LSP Only\n\nSets up Language Server Protocol support without AST-Grep.\n\n**Deliverables**:\n- LSP server configuration for your language\n- `.claude/settings.json` updates\n\n---\n\n### `/setup mcp` - MCP Server\n\nSets up Model Context Protocol servers.\n\n**Deliverables**:\n- MCP server configuration\n- Tool availability verification\n\n---\n\n### `/setup opencode` - OpenCode.ai Compatibility\n\nSets up compatibility with OpenCode.ai.\n\n**Deliverables**:\n- OpenCode-compatible file structure\n- Symlinks or copies as needed\n\n---\n\n### `/setup webhook` - GitHub Actions Webhook\n\nSets up webhook for GitHub Actions integration.\n\n**Deliverables**:\n- `.github/workflows/review.yml` for PR auto-review\n- Webhook endpoint configuration\n\n---\n\n### `/setup ui` - Harness UI\n\nSets up the Harness UI dashboard.\n\n**Deliverables**:\n- UI server configuration\n- Dashboard access instructions\n\n---\n\n## Migration Note\n\nThis command consolidates the following individual commands:\n- `/ci-setup` → `/setup ci`\n- `/dev-tools-setup` → `/setup dev-tools`\n- `/lsp-setup` → `/setup lsp`\n- `/mcp-setup` → `/setup mcp`\n- `/opencode-setup` → `/setup opencode`\n- `/webhook-setup` → `/setup webhook`\n- `/harness-ui-setup` → `/setup ui`\n\nThe individual commands are deprecated but still work for backward compatibility.\n",
        "commands/optional/skills-update.md": "---\ndescription: \"スキル設定を更新（add/remove/list/enable/disable）。Skills Gate の対象スキルを管理\"\n---\n\n# /skills-update\n\nプロジェクトの Skills Gate 設定を更新します。\n\n## 使い方\n\n```\n/skills-update [action] [skill_name]\n```\n\n### アクション\n\n| アクション | 説明 | 例 |\n|-----------|------|-----|\n| `list` | 現在の設定を表示 | `/skills-update list` |\n| `add <skill>` | スキルを追加 | `/skills-update add auth` |\n| `remove <skill>` | スキルを削除 | `/skills-update remove auth` |\n| `enable` | Skills Gate を有効化 | `/skills-update enable` |\n| `disable` | Skills Gate を無効化 | `/skills-update disable` |\n\n## 実行手順\n\n### 1. 引数を解析\n\nユーザーの入力から action と skill_name を抽出します。\n\n### 2. skills-config.json を更新\n\n```bash\nSTATE_DIR=\".claude/state\"\nSKILLS_CONFIG=\"${STATE_DIR}/skills-config.json\"\n\nmkdir -p \"$STATE_DIR\"\n\n# 存在しない場合は初期化\nif [ ! -f \"$SKILLS_CONFIG\" ]; then\n  echo '{\"enabled\": true, \"skills\": [\"impl\", \"review\"]}' > \"$SKILLS_CONFIG\"\nfi\n```\n\n### 3. アクション別処理\n\n#### list\n```bash\ncat \"$SKILLS_CONFIG\" | jq .\n```\n\n#### add <skill>\n```bash\njq --arg s \"$SKILL_NAME\" '.skills += [$s] | .skills |= unique' \"$SKILLS_CONFIG\" > tmp && mv tmp \"$SKILLS_CONFIG\"\n```\n\n#### remove <skill>\n```bash\njq --arg s \"$SKILL_NAME\" '.skills -= [$s]' \"$SKILLS_CONFIG\" > tmp && mv tmp \"$SKILLS_CONFIG\"\n```\n\n#### enable\n```bash\njq '.enabled = true' \"$SKILLS_CONFIG\" > tmp && mv tmp \"$SKILLS_CONFIG\"\n```\n\n#### disable\n```bash\njq '.enabled = false' \"$SKILLS_CONFIG\" > tmp && mv tmp \"$SKILLS_CONFIG\"\n```\n\n### 4. 結果を報告\n\n更新後の設定を表示し、変更内容をユーザーに伝えます。\n\n## 利用可能なスキル\n\n| スキル | 用途 |\n|--------|------|\n| impl | 実装、機能追加 |\n| review | コードレビュー |\n| ui | UI コンポーネント |\n| auth | 認証・決済 |\n| deploy | デプロイ |\n| ci | CI/CD |\n| verify | ビルド検証 |\n| docs | ドキュメント生成 |\n\n## 注意事項\n\n- Skills Gate が有効な場合、コード編集前に Skill ツールの使用が必要\n- 設定は `.claude/state/skills-config.json` に保存\n- セッション再起動後に反映\n",
        "commands/optional/sync-project-specs.md": "---\ndescription: \"[オプション] 作業後にPlans.md等が更新されているか不明な時、念のため実行\"\ndescription-en: \"[Optional] Sync project specs when unsure if updated\"\n---\n\n# /sync-project-specs - 作業後の念のため同期\n\n**作業完了後に「Plans.md ちゃんと更新されてるかな？」と不安な時に実行するコマンドです。**\n\n## いつ使う？\n\n| 状況 | 使うべきコマンド |\n|------|-----------------|\n| 「今どこまで進んだ？次は？」 | `/sync-status`（まずこちら） |\n| 「作業したけど Plans.md 更新したか覚えてない」 | **このコマンド** |\n| 「古いテンプレから始めたので形式が古いかも」 | **このコマンド** |\n\n> 💡 **ヒント**: 通常は `/sync-status` で十分です。このコマンドは「念のため」や「形式の移行」が必要な時に使います。\n\n---\n\nこのコマンドは、プロジェクト内の **仕様書/運用ドキュメント**（例: `Plans.md`, `AGENTS.md`, `.claude/rules/*`）を、\nclaude-code-harness の最新運用（**PM ↔ Impl**, `pm:*` マーカー、ハンドオフ2コマンド）に揃えます。\n\n「忙しくて更新を忘れた」「途中で運用が変わった」「古いテンプレから始めた」時のリカバリ用です。\n\n## バイブコーダー向け（こう言えばOK）\n\n- 「**作業終わったけど Plans.md 更新したか不安**」→ このコマンド\n- 「**古い形式のファイルを最新に揃えたい**」→ マーカーと説明を統一します\n- 「**手動変更は残して、必要な部分だけ直して**」→ 既存の文章は極力維持して差分だけ当てます\n\n## できること（成果物）\n\n- `Plans.md` の **マーカー凡例/状態遷移/運用説明** を PM↔Impl 前提に更新\n- `AGENTS.md` の **役割分担** を PM（Cursor/PM Claude）↔ Impl（Claude Code）に更新\n- `.claude/rules/workflow.md` / `.claude/rules/plans-management.md` の **運用ルール** を更新\n- `cursor:*` マーカーは **互換として同義扱い**の説明を残す\n\n## 同期対象（存在するものだけ）\n\n- `Plans.md`\n- `AGENTS.md`\n- `CLAUDE.md`（運用説明がある場合のみ）\n- `.claude/rules/workflow.md`\n- `.claude/rules/plans-management.md`\n\n## 同期内容（最小差分ポリシー）\n\n1. **マーカーの正規化**\n   - 正規: `pm:依頼中`, `pm:確認済`\n   - 互換: `cursor:依頼中`, `cursor:確認済`（同義として扱う）\n2. **状態遷移の明文化**\n   - `pm:依頼中 → cc:WIP → cc:完了 → pm:確認済`\n3. **ハンドオフ導線の追記**\n   - PM→Impl: `/handoff-to-impl-claude`（PM Claude向け）\n   - Impl→PM: `/handoff-to-pm-claude`\n   - Cursor運用の場合は従来通り（`/handoff-to-claude`, `/handoff-to-cursor`）\n4. **通知ファイルの説明**\n   - `.claude/state/pm-notification.md`（互換: `.claude/state/cursor-notification.md`）\n\n## 実行手順\n\n### Step 1: 現状を収集（必須）\n\n- 対象ファイルの存在確認と、該当セクションの抜粋を取得\n- `Plans.md` のマーカー出現状況（pm/cursor/cc）を集計\n\n### Step 2: 変更方針の宣言（必須）\n\nユーザーに以下を先に宣言：\n\n- 既存の文章は原則残す（破壊的リライトはしない）\n- 追加/置換は「運用に必要な最低限」に絞る\n- 変更は差分で提示し、必要なら調整する\n\n### Step 3: 同期（差分適用）\n\n- `Plans.md`\n  - マーカー凡例に `pm:*` を追加し、`cursor:*` を互換として明記\n  - 状態遷移表記を PM↔Impl へ\n- `AGENTS.md`\n  - 役割分担を PM/Impl へ\n  - Plans のマーカー表と遷移を PM↔Impl へ（互換注記あり）\n- `.claude/rules/workflow.md` / `.claude/rules/plans-management.md`\n  - `cursor:*` 表記を `pm:*` 正規＋互換注記へ\n- `CLAUDE.md`\n  - もし運用説明セクションがあるなら、PM↔Impl の導線を追記（既存を壊さない）\n\n### Step 4: 仕上げ（必須）\n\n- `/sync-status` で集計して、マーカーが意図通りか確認\n- 必要なら `/remember` で「このプロジェクト固有の運用」を固定\n\n---\n\n## ⚡ 並列実行の判断ポイント\n\nこのコマンドでは複数ファイルの確認・更新を行うため、**ファイル読み込みフェーズ**で並列実行が有効です。\n\n### 並列実行すべき場合 ✅\n\n| 処理 | 並列化 |\n|------|--------|\n| Plans.md の読み込み | ✅ 独立 |\n| AGENTS.md の読み込み | ✅ 独立 |\n| CLAUDE.md の読み込み | ✅ 独立 |\n| .claude/rules/*.md の読み込み | ✅ 独立 |\n\n**対象ファイルが 3 つ以上ある場合**:\n```\n🚀 ファイル収集開始...\n├── [Plans.md] 読み込み中... ⏳\n├── [AGENTS.md] 読み込み中... ⏳\n├── [CLAUDE.md] 読み込み中... ⏳\n└── [rules/*.md] 読み込み中... ⏳\n\n→ 同時に読み込んで時間短縮\n```\n\n### 直列実行される処理\n\n更新は**ファイル間の整合性**を保つため直列実行：\n\n```\nファイル読み込み（並列）→ 差分分析（直列）→ 更新適用（直列）→ 検証（直列）\n```\n\n### 自動判断ロジック\n\n```\n同期対象ファイル >= 3 → ファイル読み込みを並列実行\n同期対象ファイル < 3  → 直列実行（オーバーヘッド回避）\n```\n\n\n",
        "commands/optional/sync-ssot-from-memory.md": "---\ndescription: \"[Optional] Promote important observations from memory systems (Claude-mem/Serena) to SSOT\"\ndescription-en: \"[Optional] Promote important observations from memory systems (Claude-mem/Serena) to SSOT\"\n---\n\n# /sync-ssot-from-memory - Memory → SSOT Promotion\n\nPromote important observations recorded in memory systems (Claude-mem or Serena) to the project's SSOT:\n`.claude/memory/decisions.md` and `.claude/memory/patterns.md`.\n\n---\n\n## VibeCoder Phrases\n\n- \"**Save what we learned for next time**\" → this command\n- \"**Promote important decisions to SSOT**\" → this command\n- \"**Organize decisions (why) and methods (how) separately**\" → Reflect in decisions/patterns separately\n- \"**I don't know what to keep**\" → Filter by importance and propose only candidates for SSOT\n\n---\n\n## Supported Memory Systems\n\n| System | Detection Method | How to Get Observations |\n|--------|------------------|------------------------|\n| **Claude-mem** | Existence of `~/.claude-mem/settings.json` | `mem-search` skill |\n| **Serena** | Existence of `.serena/memories/` | `mcp__serena__read_memory` |\n\nAuto-detected at command execution, using available system.\n\n---\n\n## Steps\n\n### Step 0: Memory System Detection\n\n```bash\n# Claude-mem check\nif [ -f \"$HOME/.claude-mem/settings.json\" ]; then\n  echo \"📚 Claude-mem detected\"\n  MEMORY_SYSTEM=\"claude-mem\"\nfi\n\n# Serena check\nif [ -d \".serena/memories\" ]; then\n  echo \"📚 Serena detected\"\n  MEMORY_SYSTEM=\"serena\"\nfi\n\n# Prefer Claude-mem if both exist\n```\n\n**If neither exists**:\n- Switch to manual input mode\n- Ask user to paste observation content\n\n---\n\n### Step 1: Extract SSOT Promotion Candidates\n\n**For Claude-mem**:\n\n```\n# Search important observations with mem-search\nmem-search: type:decision\nmem-search: type:discovery concepts:pattern\nmem-search: type:bugfix concepts:gotcha\n```\n\n**For Serena**:\n\n```\n# Get Serena memory list\nmcp__serena__list_memories\n\n# Read target memories\n# e.g.: *_decisions_*, *_investigation_*\n```\n\n---\n\n### Step 2: Filter by Promotion Criteria\n\n#### Decisions Candidates (Why) → `decisions.md`\n\n| Observation Type | Concept | Promotion Criteria |\n|------------------|---------|-------------------|\n| `decision` | `why-it-exists`, `trade-off` | Technology selection, adoption/rejection reasons |\n| `guard` | `test-quality`, `implementation-quality` | Guardrail activation reasons |\n| `discovery` | `user-intent` | User requirements/constraints |\n\n#### Patterns Candidates (How) → `patterns.md`\n\n| Observation Type | Concept | Promotion Criteria |\n|------------------|---------|-------------------|\n| `bugfix` | `problem-solution` | Recurrence prevention patterns |\n| `discovery` | `pattern`, `how-it-works` | Reusable solutions |\n| `feature`, `refactor` | `pattern` | Implementation patterns |\n\n#### Exclusions\n\n- Work-in-progress rough notes (low confidence)\n- Personal/confidential information\n- One-time tasks (not reusable)\n\n---\n\n### Step 3: Reflect to SSOT (Deduplicate)\n\n#### decisions.md Format\n\n```markdown\n## D{N}: {Title}\n\n**Date**: YYYY-MM-DD\n**Tags**: #decision #{related keywords}\n**Observation ID**: #{original observation ID} (for duplicate prevention)\n\n### Conclusion\n\n{Adopted conclusion}\n\n### Background\n\n{Background that necessitated this decision}\n\n### Options\n\n1. {Option A}: {pros/cons}\n2. {Option B}: {pros/cons}\n\n### Adoption Reason\n\n{Why this option was chosen}\n\n### Impact\n\n{Scope of this decision's impact}\n\n### Review Conditions\n\n{Situations when this decision should be reconsidered}\n```\n\n#### patterns.md Format\n\n```markdown\n## P{N}: {Title}\n\n**Date**: YYYY-MM-DD\n**Tags**: #pattern #{related keywords}\n**Observation ID**: #{original observation ID} (for duplicate prevention)\n\n### Problem\n\n{What problem does this solve}\n\n### Solution\n\n{How to solve it}\n\n### Application Conditions\n\n{When to use this pattern}\n\n### Non-Application Conditions\n\n{When not to use this pattern}\n\n### Example\n\n{Code examples or specific steps}\n\n### Notes\n\n{Pitfalls and things to watch out for}\n```\n\n---\n\n### Step 4: Change Summary\n\n```markdown\n## 📚 SSOT Promotion Results\n\n### Added/Updated\n\n| File | Item | Original Observation ID |\n|------|------|------------------------|\n| decisions.md | D12: RBAC Adoption | #9602 |\n| patterns.md | P8: CORS Handling | #9584 |\n\n### Pending (Needs Review)\n\n| Observation ID | Title | Pending Reason |\n|----------------|-------|----------------|\n| #9590 | API Design Draft | Not finalized yet |\n\n### Excluded\n\n- Work-in-progress notes: 5 items\n- Duplicates: 2 items\n```\n\n---\n\n## Duplicate Prevention\n\nRecording observation ID in SSOT entries prevents the same observation from being promoted multiple times.\n\n```markdown\n## D12: RBAC Adoption\n\n**Observation ID**: #9602  ← This detects duplicates\n```\n\n---\n\n## Fallback on Failure\n\nIf memory system is inaccessible:\n\n1. Ask user to paste observation content\n2. Apply same procedure to reflect to SSOT\n\n```\n> Cannot access memory system.\n> Please paste the information you want to promote.\n```\n\n---\n\n## Related\n\n- `/harness-mem` - Claude-mem integration setup\n- `mem-search` skill - Search past memories\n- `.claude/memory/decisions.md` - Decisions (SSOT)\n- `.claude/memory/patterns.md` - Reusable patterns (SSOT)\n",
        "commands/optional/webhook-setup.md": "---\ndescription: GitHub Actions Webhook トリガーをセットアップ\ndescription-en: Setup GitHub Actions webhook triggers for automation\n---\n\n# /webhook-setup - Webhook トリガーセットアップ\n\nGitHub Actions から Harness コマンドを自動実行するための設定を行います。\n**PR作成時に自動レビュー**などを実現できます。\n\n## VibeCoder Quick Reference\n\n- \"**PRで自動レビューしたい**\" → このコマンド\n- \"**CI でハーネス使いたい**\" → Webhook トリガーをセットアップ\n- \"**自動化したい**\" → GitHub Actions 連携\n\n## Deliverables\n\n- `.github/workflows/harness-review.yml` - PR自動レビューワークフロー\n- `.github/workflows/harness-plan-check.yml` - Plans.md 整合性チェック（オプション）\n\n---\n\n## Usage\n\n```bash\n/webhook-setup\n```\n\n---\n\n## Execution Flow\n\n### Step 1: 機能選択\n\n> 🔧 **どの自動化を設定しますか？**\n>\n> 1. PR自動レビュー（`/harness-review` をPR作成時に実行）\n> 2. Plans.md 整合性チェック（PRにタスク完了状況をコメント）\n> 3. 両方\n>\n> 番号で回答（デフォルト: 1）\n\n**ユーザーの回答を待つ**\n\n### Step 2: ワークフローファイル生成\n\n選択に応じてワークフローファイルを生成：\n\n#### PR自動レビュー（選択肢1, 3）\n\n`.github/workflows/harness-review.yml` を生成：\n\n```yaml\nname: Harness Review\n\non:\n  pull_request:\n    types: [opened, synchronize]\n\npermissions:\n  contents: read\n  pull-requests: write\n\njobs:\n  review:\n    name: Auto Review\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n\n      - name: Install Claude Code\n        run: npm install -g @anthropic-ai/claude-code\n\n      - name: Run Harness Review\n        env:\n          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}\n        run: |\n          # 変更ファイル一覧を取得\n          CHANGED_FILES=$(git diff --name-only origin/${{ github.base_ref }}...HEAD)\n\n          # レビュー実行（非対話モード）\n          claude --non-interactive << 'EOF'\n          /harness-review --ci --files \"$CHANGED_FILES\"\n\n          レビュー結果を以下の形式でまとめてください：\n          1. 重大な問題（あれば）\n          2. 改善提案\n          3. 良い点\n          EOF\n\n      - name: Post Review Comment\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const fs = require('fs');\n\n            // レビュー結果を読み込み（存在する場合）\n            let reviewBody = '## 🔍 Harness Auto Review\\n\\n';\n\n            if (fs.existsSync('.claude/state/last-review.md')) {\n              reviewBody += fs.readFileSync('.claude/state/last-review.md', 'utf8');\n            } else {\n              reviewBody += '✅ 自動レビューが完了しました。重大な問題は検出されませんでした。';\n            }\n\n            reviewBody += '\\n\\n---\\n🤖 Generated by [Claude Code Harness](https://github.com/Chachamaru127/claude-code-harness)';\n\n            await github.rest.issues.createComment({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: context.issue.number,\n              body: reviewBody\n            });\n```\n\n#### Plans.md 整合性チェック（選択肢2, 3）\n\n`.github/workflows/harness-plan-check.yml` を生成：\n\n```yaml\nname: Plans Check\n\non:\n  pull_request:\n    types: [opened, synchronize]\n    paths:\n      - 'Plans.md'\n      - 'src/**'\n\npermissions:\n  contents: read\n  pull-requests: write\n\njobs:\n  check:\n    name: Plans Consistency\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n\n      - name: Check Plans.md\n        id: plans\n        run: |\n          if [ ! -f Plans.md ]; then\n            echo \"plans_exists=false\" >> $GITHUB_OUTPUT\n            exit 0\n          fi\n\n          echo \"plans_exists=true\" >> $GITHUB_OUTPUT\n\n          # タスク状況をカウント\n          WIP=$(grep -c \"cc:WIP\" Plans.md 2>/dev/null || echo \"0\")\n          TODO=$(grep -c \"cc:TODO\" Plans.md 2>/dev/null || echo \"0\")\n          DONE=$(grep -c \"cc:DONE\" Plans.md 2>/dev/null || echo \"0\")\n\n          echo \"wip=$WIP\" >> $GITHUB_OUTPUT\n          echo \"todo=$TODO\" >> $GITHUB_OUTPUT\n          echo \"done=$DONE\" >> $GITHUB_OUTPUT\n\n      - name: Post Status Comment\n        if: steps.plans.outputs.plans_exists == 'true'\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const wip = '${{ steps.plans.outputs.wip }}';\n            const todo = '${{ steps.plans.outputs.todo }}';\n            const done = '${{ steps.plans.outputs.done }}';\n\n            const body = `## 📋 Plans.md Status\n\n            | Status | Count |\n            |--------|-------|\n            | 🔄 WIP | ${wip} |\n            | 📝 TODO | ${todo} |\n            | ✅ DONE | ${done} |\n\n            ---\n            🤖 Generated by [Claude Code Harness](https://github.com/Chachamaru127/claude-code-harness)`;\n\n            await github.rest.issues.createComment({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: context.issue.number,\n              body: body\n            });\n```\n\n### Step 3: シークレット設定ガイド\n\n> ⚠️ **ANTHROPIC_API_KEY の設定が必要です**\n>\n> GitHub リポジトリで以下を設定してください：\n>\n> 1. Settings → Secrets and variables → Actions\n> 2. \"New repository secret\" をクリック\n> 3. Name: `ANTHROPIC_API_KEY`\n> 4. Value: Anthropic API キーを入力\n>\n> 💡 API キーは https://console.anthropic.com で取得できます\n\n### Step 4: 完了報告\n\n> ✅ **Webhook トリガー設定完了**\n>\n> 📄 **生成ファイル**:\n> - `.github/workflows/harness-review.yml` - PR自動レビュー\n> - `.github/workflows/harness-plan-check.yml` - Plans.md チェック（選択時）\n>\n> **次のステップ:**\n> 1. `ANTHROPIC_API_KEY` シークレットを設定\n> 2. 変更をコミット＆プッシュ\n> 3. PRを作成して動作確認\n>\n> 💡 ワークフローはPR作成時に自動実行されます\n\n---\n\n## Generated Workflows\n\n### harness-review.yml\n\n| トリガー | 処理内容 |\n|----------|----------|\n| PR opened | 変更ファイルをレビュー |\n| PR synchronize | 追加コミット時に再レビュー |\n\n### harness-plan-check.yml\n\n| トリガー | 処理内容 |\n|----------|----------|\n| Plans.md 変更 | タスク状況をコメント |\n| src/** 変更 | 実装との整合性チェック |\n\n---\n\n## Customization\n\n### レビュー対象ファイルのフィルタリング\n\n```yaml\non:\n  pull_request:\n    paths:\n      - 'src/**'\n      - '!src/**/*.test.ts'  # テストファイルは除外\n```\n\n### レビュー観点のカスタマイズ\n\n```yaml\n- name: Run Harness Review\n  run: |\n    claude --non-interactive << 'EOF'\n    /harness-review --ci --focus security,performance\n    EOF\n```\n\n### 特定ブランチのみ実行\n\n```yaml\non:\n  pull_request:\n    branches:\n      - main\n      - develop\n```\n\n---\n\n## Troubleshooting\n\n### Error: ANTHROPIC_API_KEY not set\n\n**原因**: シークレットが未設定\n\n**解決**: リポジトリの Settings → Secrets で `ANTHROPIC_API_KEY` を設定\n\n### Error: Permission denied\n\n**原因**: ワークフローの権限不足\n\n**解決**: `permissions` セクションを確認\n```yaml\npermissions:\n  contents: read\n  pull-requests: write\n```\n\n### レビューコメントが投稿されない\n\n**原因**: `actions/github-script` の実行エラー\n\n**解決**: Actions タブでログを確認\n\n---\n\n## Related Commands\n\n- `/harness-review` - 手動コードレビュー\n- `/ci-setup` - 一般的なCI/CD設定\n- `/session-broadcast` - セッション間通知\n\n---\n\n## Notes\n\n- GitHub Actions の無料枠: パブリックリポは無制限、プライベートは2000分/月\n- API キーは絶対にコードにハードコードしないでください\n- 大きなPRはレビューに時間がかかる場合があります\n",
        "harness-ui/src/client/hooks/usePlans.ts": "import { useState, useEffect, useCallback, useRef } from 'react';\nimport type { PlansData } from '@shared/types';\n\nconst emptyPlans: PlansData = {\n  sections: [],\n  summary: {\n    total: 0,\n    pending: 0,\n    inProgress: 0,\n    completed: 0,\n    blocked: 0,\n    progressPercent: 0,\n  },\n};\n\ninterface UsePlansOptions {\n  projectId?: string | null;\n}\n\nexport function usePlans(options: UsePlansOptions = {}) {\n  const { projectId } = options;\n  const [plans, setPlans] = useState<PlansData>(emptyPlans);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const currentProjectId = useRef<string | null | undefined>(projectId);\n\n  const fetchPlans = useCallback(async (pid?: string | null) => {\n    try {\n      setLoading(true);\n      const queryParam = pid ? `?projectId=${encodeURIComponent(pid)}` : '';\n      const res = await fetch(`/api/plans${queryParam}`);\n      if (!res.ok) throw new Error('Failed to fetch plans');\n      const data = await res.json();\n      setPlans(data);\n      setError(null);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Unknown error');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchPlans(projectId);\n    currentProjectId.current = projectId;\n  }, [projectId, fetchPlans]);\n\n  const updatePlans = useCallback((data: PlansData) => {\n    // Only update if this is for the current project or no projectId filter\n    if (!currentProjectId.current || data.projectId === currentProjectId.current) {\n      setPlans(data);\n    }\n  }, []);\n\n  const refetch = useCallback(() => {\n    return fetchPlans(currentProjectId.current);\n  }, [fetchPlans]);\n\n  return { plans, loading, error, updatePlans, refetch };\n}\n",
        "harness-ui/src/client/hooks/useProjects.ts": "import { useState, useEffect, useCallback } from 'react';\nimport type { Project, ProjectsData } from '@shared/types';\n\nconst emptyProjectsData: ProjectsData = {\n  projects: [],\n  activeProjectId: null,\n};\n\nexport function useProjects() {\n  const [projectsData, setProjectsData] = useState<ProjectsData>(emptyProjectsData);\n  const [loading, setLoading] = useState(true);\n\n  const fetchProjects = useCallback(async () => {\n    try {\n      const res = await fetch('/api/projects');\n      if (!res.ok) throw new Error('Failed to fetch projects');\n      const data = await res.json();\n      setProjectsData(data);\n    } catch (err) {\n      console.error(err);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchProjects();\n  }, [fetchProjects]);\n\n  const activeProject = projectsData.projects.find(\n    (p) => p.id === projectsData.activeProjectId\n  );\n\n  const activateProject = useCallback(async (projectId: string) => {\n    try {\n      const res = await fetch('/api/projects', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ action: 'activate', projectId }),\n      });\n      if (res.ok) {\n        setProjectsData((prev) => ({\n          ...prev,\n          projects: prev.projects.map((p) => ({\n            ...p,\n            isActive: p.id === projectId,\n          })),\n          activeProjectId: projectId,\n        }));\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  }, []);\n\n  const addProject = useCallback(async (project: Omit<Project, 'id' | 'isActive'>) => {\n    try {\n      const res = await fetch('/api/projects', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ action: 'add', project }),\n      });\n      if (res.ok) {\n        const data = await res.json();\n        setProjectsData((prev) => ({\n          ...prev,\n          projects: [...prev.projects, data.project],\n        }));\n        return data.project;\n      }\n    } catch (err) {\n      console.error(err);\n    }\n    return null;\n  }, []);\n\n  const removeProject = useCallback(async (projectId: string) => {\n    try {\n      const res = await fetch('/api/projects', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ action: 'remove', projectId }),\n      });\n      if (res.ok) {\n        setProjectsData((prev) => ({\n          ...prev,\n          projects: prev.projects.filter((p) => p.id !== projectId),\n          activeProjectId:\n            prev.activeProjectId === projectId\n              ? prev.projects.find((p) => p.id !== projectId)?.id || null\n              : prev.activeProjectId,\n        }));\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  }, []);\n\n  return {\n    projects: projectsData.projects,\n    activeProject,\n    activeProjectId: projectsData.activeProjectId,\n    loading,\n    activateProject,\n    addProject,\n    removeProject,\n    refetch: fetchProjects,\n  };\n}\n",
        "harness-ui/src/client/hooks/useWebSocket.ts": "import { useEffect, useRef, useCallback, useState } from 'react';\nimport type {\n  WSMessage,\n  PTYSession,\n  PlansData,\n  SessionsListPayload,\n  SessionUpdatePayload,\n  LogChunkPayload,\n} from '@shared/types';\n\ninterface UseWebSocketOptions {\n  onSessionsUpdate?: (sessions: PTYSession[]) => void;\n  onLogChunk?: (sessionId: string, data: string) => void;\n  onPlansUpdate?: (data: PlansData) => void;\n}\n\nexport function useWebSocket(options: UseWebSocketOptions = {}) {\n  const handlersRef = useRef<UseWebSocketOptions>(options);\n  const wsRef = useRef<WebSocket | null>(null);\n  const [connected, setConnected] = useState(false);\n  const [sessions, setSessions] = useState<PTYSession[]>([]);\n  const reconnectTimeoutRef = useRef<number | null>(null);\n\n  useEffect(() => {\n    handlersRef.current = options;\n  }, [options.onSessionsUpdate, options.onLogChunk, options.onPlansUpdate]);\n\n  const connect = useCallback(() => {\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsUrl = `${protocol}//${window.location.host}/ws`;\n\n    const ws = new WebSocket(wsUrl);\n    wsRef.current = ws;\n\n    ws.onopen = () => {\n      console.log('WebSocket connected');\n      setConnected(true);\n    };\n\n    ws.onclose = () => {\n      console.log('WebSocket disconnected');\n      setConnected(false);\n\n      // Reconnect after 2 seconds\n      reconnectTimeoutRef.current = window.setTimeout(() => {\n        connect();\n      }, 2000);\n    };\n\n    ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n    };\n\n    ws.onmessage = (event) => {\n      try {\n        const message = JSON.parse(event.data) as WSMessage;\n\n        switch (message.type) {\n          case 'sessions_list': {\n            const { sessions: newSessions } = message.payload as SessionsListPayload;\n            setSessions(newSessions);\n            handlersRef.current.onSessionsUpdate?.(newSessions);\n            break;\n          }\n\n          case 'session_update': {\n            const { session } = message.payload as SessionUpdatePayload;\n            setSessions((prev) => {\n              const idx = prev.findIndex((s) => s.id === session.id);\n              if (idx >= 0) {\n                const updated = [...prev];\n                updated[idx] = session;\n                return updated;\n              }\n              return [...prev, session];\n            });\n            break;\n          }\n\n          case 'log_chunk': {\n            const { sessionId, data } = message.payload as LogChunkPayload;\n        setSessions((prev) => {\n          const idx = prev.findIndex((s) => s.id === sessionId);\n          if (idx < 0) return prev;\n          const current = prev[idx];\n          const nextLogs = [...(current.logs || []), data];\n          if (nextLogs.length > 1000) {\n            nextLogs.splice(0, nextLogs.length - 500);\n          }\n          const updatedSession = { ...current, logs: nextLogs };\n          const updated = [...prev];\n          updated[idx] = updatedSession;\n          return updated;\n        });\n            handlersRef.current.onLogChunk?.(sessionId, data);\n            break;\n          }\n\n          case 'plans_update': {\n            const data = message.payload as PlansData;\n            handlersRef.current.onPlansUpdate?.(data);\n            break;\n          }\n        }\n      } catch (error) {\n        console.error('Failed to parse message:', error);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    connect();\n\n    return () => {\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n    };\n  }, [connect]);\n\n  const send = useCallback(<T,>(message: WSMessage<T>) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(message));\n    }\n  }, []);\n\n  const sendInput = useCallback(\n    (sessionId: string, data: string) => {\n      send({ type: 'send_input', payload: { sessionId, data } });\n    },\n    [send]\n  );\n\n  const createSession = useCallback(\n    (projectId: string, worktreePath?: string) => {\n      send({ type: 'create_session', payload: { projectId, worktreePath } });\n    },\n    [send]\n  );\n\n  const destroySession = useCallback(\n    (sessionId: string) => {\n      send({ type: 'destroy_session', payload: { sessionId } });\n    },\n    [send]\n  );\n\n  const resizeTerminal = useCallback(\n    (sessionId: string, cols: number, rows: number) => {\n      send({ type: 'resize_terminal', payload: { sessionId, cols, rows } });\n    },\n    [send]\n  );\n\n  return {\n    connected,\n    sessions,\n    sendInput,\n    createSession,\n    destroySession,\n    resizeTerminal,\n  };\n}\n",
        "hooks/BEST_PRACTICES.md": "# Hooks Best Practices\n\n## Shell Script Execution Permissions\n\n**When creating or copying shell scripts to `.claude/hooks/`, always ensure execution permission is set**:\n\n```bash\n# Set execution permission for a specific script\nchmod +x .claude/hooks/your-script.sh\n\n# Set execution permission for all shell scripts in hooks\nfind .claude/hooks -name \"*.sh\" -exec chmod +x {} \\;\n```\n\n### Why This Matters\n\nShell scripts without execution permission (`chmod +x`) will fail silently or with errors like:\n```\npermission denied: .claude/hooks/your-script.sh\n```\n\n### Auto-fix by Harness\n\n`/harness-init` and `/harness-update` automatically fix permissions for `.claude/hooks/*.sh` files. However, if you manually add scripts between these commands, you must set permissions yourself.\n\n### Checklist for Custom Hooks\n\nWhen adding custom shell script hooks:\n\n- [ ] Script has execution permission (`chmod +x`)\n- [ ] Script has proper shebang (`#!/bin/bash` or `#!/usr/bin/env bash`)\n- [ ] Script is tested locally before registering\n- [ ] Script path in `hooks.json` is correct (relative to project root)\n\n## Common Issues\n\n### \"permission denied\" Error\n\n**Cause**: Shell script lacks execution permission.\n\n**Solution**:\n```bash\nchmod +x .claude/hooks/your-script.sh\n```\n\n### Hook Not Running (Silent Failure)\n\n**Possible causes**:\n1. Script not executable\n2. Incorrect path in `hooks.json`\n3. Script syntax error\n\n**Debug steps**:\n```bash\n# 1. Check permission\nls -la .claude/hooks/\n\n# 2. Test script directly\nbash .claude/hooks/your-script.sh\n\n# 3. Validate hooks.json\ncat .claude/hooks.json | jq .\n```\n\n## Related\n\n- `/harness-init` - Auto-fixes permissions on new projects\n- `/harness-update` - Auto-fixes permissions during updates\n",
        "hooks/hooks.json": "{\n  \"description\": \"claude-code-harness: 自動化フック\",\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Write|Edit|Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" pretooluse-guard\",\n            \"timeout\": 30\n          }\n        ]\n      },\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" pretooluse-inbox-check\",\n            \"timeout\": 10\n          }\n        ]\n      },\n      {\n        \"matcher\": \"mcp__chrome-devtools__.*|mcp__playwright__.*|mcp__plugin_playwright_playwright__.*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" pretooluse-browser-guide\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"PermissionRequest\": [\n      {\n        \"matcher\": \"Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" permission-request\",\n            \"timeout\": 30\n          }\n        ]\n      }\n    ],\n    \"Setup\": [\n      {\n        \"matcher\": \"init\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" setup-hook init\",\n            \"timeout\": 60,\n            \"once\": true\n          }\n        ]\n      },\n      {\n        \"matcher\": \"init-only\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" setup-hook init\",\n            \"timeout\": 60,\n            \"once\": true\n          }\n        ]\n      },\n      {\n        \"matcher\": \"maintenance\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" setup-hook maintenance\",\n            \"timeout\": 60,\n            \"once\": true\n          }\n        ]\n      }\n    ],\n    \"SessionStart\": [\n      {\n        \"matcher\": \"startup\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-init\",\n            \"timeout\": 30,\n            \"once\": true\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-monitor\",\n            \"timeout\": 30,\n            \"once\": true\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" harness-ui-register\",\n            \"timeout\": 10,\n            \"once\": true\n          }\n        ]\n      },\n      {\n        \"matcher\": \"resume\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-resume\",\n            \"timeout\": 30,\n            \"once\": true\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-monitor\",\n            \"timeout\": 30,\n            \"once\": true\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" harness-ui-register\",\n            \"timeout\": 10,\n            \"once\": true\n          }\n        ]\n      }\n    ],\n    \"SubagentStart\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" subagent-tracker start\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"SubagentStop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" subagent-tracker stop\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"UserPromptSubmit\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" userprompt-inject-policy\",\n            \"timeout\": 30\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" userprompt-track-command\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" posttooluse-log-toolname\",\n            \"timeout\": 30\n          }\n        ]\n      },\n      {\n        \"matcher\": \"Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" posttooluse-commit-cleanup\",\n            \"timeout\": 10\n          }\n        ]\n      },\n      {\n        \"matcher\": \"Skill|Task|SlashCommand\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" usage-tracker\",\n            \"timeout\": 30\n          }\n        ]\n      },\n      {\n        \"matcher\": \"Skill\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" posttooluse-clear-pending\",\n            \"timeout\": 5\n          }\n        ]\n      },\n      {\n        \"matcher\": \"TodoWrite\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" todo-sync\",\n            \"timeout\": 30\n          }\n        ]\n      },\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" auto-cleanup-hook\",\n            \"timeout\": 60\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" track-changes\",\n            \"timeout\": 30\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" auto-test-runner\",\n            \"timeout\": 120\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" posttooluse-quality-pack\",\n            \"timeout\": 60\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" plans-watcher\",\n            \"timeout\": 30\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" tdd-order-check\",\n            \"timeout\": 30\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" posttooluse-tampering-detector\",\n            \"timeout\": 10\n          },\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-auto-broadcast\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"node \\\"${CLAUDE_PLUGIN_ROOT}/scripts/run-script.js\\\" session-summary\",\n            \"timeout\": 60\n          },\n          {\n            \"type\": \"prompt\",\n            \"prompt\": \"セッション終了の評価を行ってください。\\n\\n確認事項:\\n1. ユーザーの依頼は完了しましたか？\\n2. 未解決のエラーや問題がありますか？\\n3. フォローアップや追加作業が必要ですか？\\n\\n【重要】必ず以下のJSON形式のみで回答:\\n- 終了OK: {\\\"ok\\\": true}\\n- 継続必要: {\\\"ok\\\": false, \\\"reason\\\": \\\"理由を日本語で記載\\\"}\",\n            \"timeout\": 30\n          }\n        ]\n      }\n    ]\n  }\n}\n",
        "mcp-server/README.md": "# Harness MCP Server\n\nMCP (Model Context Protocol) server for Claude Code Harness.\nEnables cross-client session communication between Claude Code, Codex, Cursor, and other MCP-compatible AI tools.\n\n## Features\n\n- **Session Communication**: Broadcast messages across different AI client sessions\n- **Workflow Tools**: Plan → Work → Review cycle accessible from any MCP client\n- **Status Sync**: Unified project status across all clients\n\n## Installation\n\n```bash\n# From npm (when published)\nnpm install -g @anthropic-ai/harness-mcp-server\n\n# From source\ncd mcp-server\nnpm install\nnpm run build\n```\n\n## Usage\n\n### With Claude Code\n\n```json\n// .claude/settings.json\n{\n  \"mcpServers\": {\n    \"harness\": {\n      \"command\": \"npx\",\n      \"args\": [\"@anthropic-ai/harness-mcp-server\"]\n    }\n  }\n}\n```\n\n### With Codex\n\n```json\n// ~/.codex/mcp.json\n{\n  \"servers\": {\n    \"harness\": {\n      \"command\": \"npx\",\n      \"args\": [\"@anthropic-ai/harness-mcp-server\"]\n    }\n  }\n}\n```\n\n### With Cursor\n\n```json\n// .cursor/mcp.json\n{\n  \"harness\": {\n    \"command\": \"npx\",\n    \"args\": [\"@anthropic-ai/harness-mcp-server\"]\n  }\n}\n```\n\n## Available Tools\n\n### Session Communication\n\n| Tool | Description |\n|------|-------------|\n| `harness_session_list` | List all active sessions |\n| `harness_session_broadcast` | Send message to all sessions |\n| `harness_session_inbox` | Check for new messages |\n| `harness_session_register` | Register current session |\n\n### Workflow\n\n| Tool | Description |\n|------|-------------|\n| `harness_workflow_plan` | Create implementation plan |\n| `harness_workflow_work` | Execute tasks from Plans.md |\n| `harness_workflow_review` | Multi-perspective code review |\n\n### Status\n\n| Tool | Description |\n|------|-------------|\n| `harness_status` | Get project status |\n\n## Example: Cross-Client Workflow\n\n```\n[Claude Code]                         [Codex]\n     │                                   │\n     ▼                                   │\nharness_session_register               │\n     │                                   │\n     ▼                                   │\nharness_workflow_plan                  │\n  \"Add user authentication\"            │\n     │                                   │\n     ▼                                   ▼\nharness_session_broadcast ─────► harness_session_inbox\n  \"Started auth implementation\"    📨 \"Started auth implementation\"\n     │                                   │\n     ▼                                   ▼\nharness_workflow_work            harness_workflow_work\n  (implements login)               (implements logout)\n     │                                   │\n     └──────────────┬────────────────────┘\n                    ▼\n            harness_workflow_review\n              (reviews all changes)\n```\n\n## Development\n\n```bash\n# Install dependencies\nnpm install\n\n# Run in development mode\nnpm run dev\n\n# Build for production\nnpm run build\n\n# Type check\nnpm run typecheck\n```\n\n## Architecture\n\n```\nmcp-server/\n├── src/\n│   ├── index.ts           # Server entry point\n│   └── tools/\n│       ├── session.ts     # Session communication tools\n│       ├── workflow.ts    # Workflow tools\n│       └── status.ts      # Status tools\n├── package.json\n├── tsconfig.json\n└── README.md\n```\n\n## License\n\nMIT - Same as Claude Code Harness\n",
        "opencode/README.md": "# Harness for OpenCode\n\nClaude Code Harness の opencode.ai 互換版です。\n\n## セットアップ方法\n\n### 方法 1: ワンコマンドセットアップ（推奨）\n\nClaude Code を持っていなくても、以下のコマンドでセットアップできます：\n\n```bash\ncd your-project\ncurl -fsSL https://raw.githubusercontent.com/Chachamaru127/claude-code-harness/main/scripts/setup-opencode.sh | bash\n```\n\n### 方法 2: Claude Code からセットアップ\n\nClaude Code を使っている場合は、コマンド一つでセットアップ：\n\n```bash\n# Claude Code 内で実行\n/opencode-setup\n```\n\n### 方法 3: 手動セットアップ\n\n```bash\n# Harness をクローン\ngit clone https://github.com/Chachamaru127/claude-code-harness.git\n\n# opencode 用コマンドをコピー\ncp -r claude-code-harness/opencode/commands/ your-project/.opencode/commands/\ncp claude-code-harness/opencode/AGENTS.md your-project/AGENTS.md\n```\n\n---\n\n## MCP サーバーセットアップ（オプション）\n\nMCP サーバーを使うと、opencode から Harness のワークフローツールを直接呼び出せます。\n\n```bash\n# MCP サーバーをビルド\ncd claude-code-harness/mcp-server\nnpm install\nnpm run build\n\n# opencode.json をプロジェクトにコピーしてパスを調整\ncp claude-code-harness/opencode/opencode.json your-project/\n# opencode.json 内のパスを実際のパスに変更\n```\n\n---\n\n## 利用可能なコマンド\n\n| コマンド | 説明 |\n|----------|------|\n| `/harness-init` | プロジェクトセットアップ |\n| `/plan-with-agent` | 開発プラン作成 |\n| `/work` | タスク実行 |\n| `/harness-review` | コードレビュー |\n| `/sync-status` | 進捗確認 |\n| `/handoff-to-opencode` | OpenCode PM への完了報告生成 |\n\n---\n\n## PM モード (OpenCode で計画管理)\n\nOpenCode を PM (Project Manager) として使用する場合のコマンド:\n\n| コマンド | 説明 |\n|----------|------|\n| `/start-session` | セッション開始（状況把握→計画） |\n| `/plan-with-cc` | 計画作成（Evals含む） |\n| `/project-overview` | プロジェクト概要把握 |\n| `/handoff-to-claude` | Claude Code への依頼生成 |\n| `/review-cc-work` | 作業レビュー・承認 |\n\n### ワークフロー（PM モード）\n\n```\nOpenCode (PM)                    Claude Code (Impl)\n    |                                   |\n    | /start-session                    |\n    | /plan-with-cc                     |\n    | /handoff-to-claude ─────────────> |\n    |                                   | /work\n    |                                   | /handoff-to-opencode\n    | <─────────────────────────────────|\n    | /review-cc-work                   |\n    |    ├── approve → 次タスク ────────>|\n    |    └── request_changes ──────────>|\n```\n\n---\n\n## MCP ツール\n\nMCP サーバー経由で以下のツールが利用可能です：\n\n| ツール | 説明 |\n|--------|------|\n| `harness_workflow_plan` | プラン作成 |\n| `harness_workflow_work` | タスク実行 |\n| `harness_workflow_review` | コードレビュー |\n| `harness_session_broadcast` | セッション間通知 |\n| `harness_status` | 状態確認 |\n\n---\n\n## 使い方\n\n```bash\n# opencode を起動\ncd your-project\nopencode\n\n# コマンドを実行\n/plan-with-agent  # プラン作成\n/work             # タスク実行\n/harness-review   # コードレビュー\n```\n\n---\n\n## 制限事項\n\n- Harness プラグインシステム（`.claude-plugin/`）は opencode では使用できません\n- フックは opencode 側で別途設定が必要です\n- `description-en` フィールドは自動削除されます\n\n---\n\n## 関連リンク\n\n- [Claude Code Harness](https://github.com/Chachamaru127/claude-code-harness)\n- [OpenCode Documentation](https://opencode.ai/docs/)\n- [OpenCode Commands](https://opencode.ai/docs/commands/)\n",
        "opencode/commands/core/cc-cursor-cc.md": "---\ndescription: Validate brainstormed ideas with Cursor, update Plans.md, then handoff back to Claude Code\nuser-invocable: false\n---\n\n# /cc-cursor-cc - Plan Validation Round Trip\n\nSupports the entire flow of sending brainstormed content from Claude Code to **Cursor (PM)** for feasibility validation, then returning to Claude Code after Cursor updates Plans.md.\n\n## Quick Reference\n\n- \"**Validate the brainstormed content with Cursor**\" → this command\n- \"**Want to check if the plan is realistic**\" → feasibility check with Cursor\n- \"**Want PM (Cursor) to review**\" → generate validation request\n\n## Deliverables\n\n- **Validation request for Cursor** - Output in format usable with `/plan-with-cc`\n- **Plans.md preparation** - Organize brainstormed content as provisional tasks\n- **Explicit handoff waiting state** - Clarify what Claude Code is waiting for\n\n---\n\n## ⚠️ Prerequisites\n\nThis command assumes **2-agent operation**.\n\n| Role | Agent | Description |\n|------|-------|-------------|\n| **PM** | Cursor | Validate plans, update Plans.md |\n| **Impl** | Claude Code | Brainstorming, implementation |\n\n**If 2-agent setup is not done yet**: First run `/2agent` to set up.\n\n---\n\n## Execution Flow\n\n### Step 1: Extract Brainstorming Context\n\n**Extract the following from recent conversation**:\n\n1. **Goal** (feature/purpose)\n2. **Discussed technology choices** (language, framework, libraries)\n3. **Decisions made** (agreements)\n4. **Undecided items** (not yet decided)\n5. **Concerns** (risks, issues)\n\n**Confirm extracted content with user**:\n\n> 📝 **Summarized the brainstorming content**\n>\n> **Goal**: {{summary}}\n> **Technology choices**: {{tech stack}}\n> **Decisions made**:\n> - {{agreement1}}\n> - {{agreement2}}\n> **Undecided items**:\n> - {{undecided1}}\n> **Concerns**:\n> - {{concern1}}\n>\n> Send this content to Cursor?\n\n**Wait for response**\n\n---\n\n### Step 2: Add Provisional Tasks to Plans.md\n\nAdd brainstormed content as **provisional tasks** to Plans.md.\n\n```markdown\n## 🟠 Under Validation: {{Project Name}} `pm:awaiting-validation`\n\n> ⚠️ This section contains brainstormed content from Claude Code.\n> Please validate feasibility and break down tasks with Cursor (PM).\n\n### Background\n- (Background/purpose discussed in brainstorming)\n\n### Provisional Tasks (To Validate)\n- [ ] {{provisional-task1}} `awaiting-validation`\n- [ ] {{provisional-task2}} `awaiting-validation`\n- [ ] {{provisional-task3}} `awaiting-validation`\n\n### Technology Choices (Draft)\n- {{tech1}}: (selection reason)\n- {{tech2}}: (selection reason)\n\n### Undecided Items\n- {{undecided1}} → **Requesting PM decision**\n- {{undecided2}} → **Requesting PM decision**\n\n### Concerns\n- {{concern1}}\n```\n\n---\n\n### Step 3: Generate Validation Request for Cursor\n\nGenerate **request text to copy-paste to Cursor** in the following format:\n\n```markdown\n---\n## 📋 Plan Validation Request (Claude Code → Cursor)\n\nPlease validate the feasibility of content brainstormed in Claude Code.\n\n### Validation Request Content\n\n**Goal**:\n{{summary}}\n\n**Provisional tasks from brainstorming**:\n1. {{provisional-task1}}\n2. {{provisional-task2}}\n3. {{provisional-task3}}\n\n**Technology choices (draft)**:\n- {{tech stack}}\n\n**Undecided items (requesting PM decision)**:\n- {{undecided1}}\n- {{undecided2}}\n\n**Concerns**:\n- {{concern1}}\n\n---\n\n### ✅ Requesting Cursor (PM) to:\n\n1. **Validate feasibility**\n   - Are provisional tasks technically feasible?\n   - Are there any overlooked prerequisites?\n\n2. **Break down tasks**\n   - Break down provisional tasks into implementable granularity\n   - Organize dependencies and order\n\n3. **Decide on undecided items**\n   - Make decisions on the above undecided items\n\n4. **Update Plans.md**\n   - Change `pm:awaiting-validation` → `cc:TODO`\n   - Add broken down tasks\n\n---\n\n### 📤 After Validation Complete\n\nOnce Plans.md update is complete, run `/handoff-to-claude` to\ngenerate the request for Claude Code.\n\n---\n```\n\n---\n\n### Step 4: Guide User to Next Action\n\n> ✅ **Generated validation request!**\n>\n> **Next steps**:\n>\n> 1. Copy & paste the above request to **Cursor**\n> 2. Run `/plan-with-cc` in Cursor (or review directly)\n> 3. Cursor updates Plans.md\n> 4. Cursor runs `/handoff-to-claude`\n> 5. Copy & paste the generated request to **Claude Code**\n>\n> **Waiting state**: Claude Code is waiting for handoff from Cursor.\n>\n> 💡 **Hint**: When validation in Cursor is complete, say \"validation is done\".\n\n---\n\n## Output Example\n\n### Example: After brainstorming task management app\n\n```\nUser: /cc-cursor-cc\n\nClaude Code:\n> 📝 Summarized the brainstorming content\n>\n> **Goal**: Notion-like task management app\n> **Technology choices**: Next.js + Supabase + TailwindCSS\n> **Decisions made**:\n> - Kanban view is required\n> - Tag feature is also needed\n> **Undecided items**:\n> - Is real-time sync needed?\n> **Concerns**:\n> - Drag & drop implementation might be complex\n\nUser: OK\n\nClaude Code:\n(Added provisional tasks to Plans.md)\n(Generated validation request for Cursor)\n\n> ✅ Generated validation request!\n> Next steps: Paste to Cursor...\n```\n\n---\n\n## Overall Flow Diagram\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│                      Claude Code                            │\n│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │\n│  │ Brainstorm  │ →  │/cc-cursor-cc│ →  │Gen Request  │     │\n│  └─────────────┘    └─────────────┘    └──────┬──────┘     │\n│                                               │ Copy-paste │\n└───────────────────────────────────────────────┼─────────────┘\n                                                ↓\n┌─────────────────────────────────────────────────────────────┐\n│                        Cursor (PM)                          │\n│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │\n│  │/plan-with-cc│ →  │Update       │ →  │/handoff-to- │     │\n│  │  validate   │    │Plans.md     │    │   claude    │     │\n│  └─────────────┘    └─────────────┘    └──────┬──────┘     │\n│                                               │ Copy-paste │\n└───────────────────────────────────────────────┼─────────────┘\n                                                ↓\n┌─────────────────────────────────────────────────────────────┐\n│                      Claude Code                            │\n│  ┌─────────────┐    ┌─────────────┐                        │\n│  │   /work     │ →  │ Implement   │                        │\n│  └─────────────┘    └─────────────┘                        │\n└─────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Related Commands\n\n| Command | Role | Agent |\n|---------|------|-------|\n| `/plan-with-agent` | Create plan in solo mode | Claude Code |\n| `/plan-with-cc` | Validate and break down plan | Cursor |\n| `/handoff-to-claude` | Generate request for Claude Code | Cursor |\n| `/handoff-to-cursor` | Completion report to Cursor | Claude Code |\n| `/work` | Task implementation | Claude Code |\n\n---\n\n## Notes\n\n- **2-agent operation only**: Use `/plan-with-agent` for solo mode\n- **Copy-paste required**: Currently, Claude Code and Cursor cannot directly connect, so manual copy-paste is required\n- **Plans.md sync**: Ensure both are referencing the same Plans.md\n",
        "opencode/commands/core/harness-init.md": "---\ndescription: Project setup (environment check → file generation → SSOT sync → validation)\n---\n\n# /harness-init - Project Setup\n\nSets up a project so VibeCoder can start development with natural language only.\n**Completes with minimum 1 question**, ready to start development immediately.\n\n## VibeCoder Quick Reference\n\n- \"**Want to launch a new project fastest**\" → this command\n- \"**Leave it to you**\" \"**Quickly**\" → proceed with defaults, no questions\n- \"**With Next.js + Supabase**\" → technology specification is also possible\n- \"**Introduce harness to existing project**\" → analyze existing code and add workflow\n\n## Deliverables\n\n- Real project generation (e.g., create-next-app) + initial setup\n- Prepare `Plans.md` / `AGENTS.md` / `CLAUDE.md` / `.claude/` etc.\n- **Environment diagnosis** → **SSOT initialization** → **Final validation** all at once\n- → **Ready to run Plan→Work→Review immediately**\n\n---\n\n## 🚀 Optimized Flow\n\n**Before**: Up to 11 dialogue rounds\n**After**: Minimum 1, maximum 2 dialogue rounds\n\n```\nStep 1: Unified question (1 time)\n  ├─ What are you building?\n  ├─ Who will use it?\n  └─ Leave it to me or detailed settings?\n\nStep 2: Confirmation (skip if \"leave it to me\")\n  └─ Tech stack + project name\n\n→ Execute setup (includes background analysis)\n\nStep 3: Completion report\n```\n\n---\n\n## Execution Flow\n\n### Step 0: Argument Check and Fast Track Judgment\n\n**Determine by arguments or trigger words**:\n\n| Input | Action |\n|-------|--------|\n| `leave it to me` `quickly` `all defaults` | → Fast track (skip Step 1) |\n| `/harness-init blog --mode=solo` | → Parse arguments, skip specified items |\n| No arguments | → Go to Step 1 |\n\n**Fast track defaults**:\n- Language: ja\n- Mode: Solo (if no .cursor/), 2-Agent (if .cursor/ exists)\n- Tech: auto (next-supabase base)\n- Skills Gate: Auto-determine from project type\n\n### Step 1: Unified Question (Complete in 1 time)\n\n**Start project analysis in background** while showing questions:\n\n```bash\n# Background analysis (parallel execution)\nCODE_COUNT=$(find . -type f \\( -name \"*.ts\" -o -name \"*.tsx\" -o -name \"*.js\" -o -name \"*.py\" \\) \\\n  ! -path \"*/node_modules/*\" ! -path \"*/.venv/*\" 2>/dev/null | wc -l | tr -d ' ')\nHAS_CURSOR=$([ -d .cursor ] && echo \"true\" || echo \"false\")\nHAS_PACKAGE=$([ -f package.json ] && echo \"true\" || echo \"false\")\n```\n\n**Present 3 questions simultaneously with AskUserQuestion**:\n\n```json\n{\n  \"questions\": [\n    {\n      \"question\": \"What are you building? (Select 'Existing project' for existing projects)\",\n      \"header\": \"Project\",\n      \"options\": [\n        {\"label\": \"Web app (blog, EC, etc.)\", \"description\": \"Build with Next.js + Supabase\"},\n        {\"label\": \"API / Backend\", \"description\": \"Build with Express / FastAPI\"},\n        {\"label\": \"Introduce to existing project\", \"description\": \"Add workflow files only\"},\n        {\"label\": \"Other\", \"description\": \"Specify freely\"}\n      ],\n      \"multiSelect\": false\n    },\n    {\n      \"question\": \"Who will use it?\",\n      \"header\": \"Target Users\",\n      \"options\": [\n        {\"label\": \"Myself only\", \"description\": \"Personal project\"},\n        {\"label\": \"Team\", \"description\": \"Internal tools / collaborative development\"},\n        {\"label\": \"Public\", \"description\": \"Public service\"}\n      ],\n      \"multiSelect\": false\n    },\n    {\n      \"question\": \"Choose setup method\",\n      \"header\": \"Mode\",\n      \"options\": [\n        {\"label\": \"Leave it to me (Recommended)\", \"description\": \"Auto-configure with optimal defaults\"},\n        {\"label\": \"Detailed settings\", \"description\": \"Specify tech stack and project name\"}\n      ],\n      \"multiSelect\": false\n    }\n  ]\n}\n```\n\n**Wait for response** (only once)\n\n### Step 2: Additional Questions (Only for Detailed Settings)\n\n**Skip this step** when \"Leave it to me\" is selected.\n\nOnly when \"Detailed settings\" is selected:\n\n```json\n{\n  \"questions\": [\n    {\n      \"question\": \"Which tech stack?\",\n      \"header\": \"Tech\",\n      \"options\": [\n        {\"label\": \"Next.js + Supabase (Recommended)\", \"description\": \"Full-stack, free to start\"},\n        {\"label\": \"Next.js + FastAPI\", \"description\": \"More flexible backend\"},\n        {\"label\": \"Other\", \"description\": \"Specify Rails, Django, etc.\"}\n      ],\n      \"multiSelect\": false\n    },\n    {\n      \"question\": \"Enter project name\",\n      \"header\": \"Name\",\n      \"options\": [\n        {\"label\": \"Auto-generate\", \"description\": \"Generate in my-app-XXXXXX format\"},\n        {\"label\": \"Specify\", \"description\": \"Enter your preferred name\"}\n      ],\n      \"multiSelect\": false\n    }\n  ]\n}\n```\n\n**Wait for response**\n\n---\n\n## Smart Defaults\n\nTo reduce questions, use auto-determination or default values for the following:\n\n| Item | Default | Auto-determination Condition |\n|------|---------|----------------------------|\n| Language | ja | Can change in config file |\n| Mode | Solo | 2-Agent if .cursor/ exists |\n| Tech stack | next-supabase | In auto mode |\n| Skills Gate | Auto-configured | Adjust later with `/skills-update` |\n\n**Overridable in config** (`claude-code-harness.config.json`):\n```json\n{\n  \"i18n\": { \"language\": \"en\" },\n  \"scaffolding\": {\n    \"tech_choice_mode\": \"fixed\",\n    \"base_stack\": \"rails-postgres\"\n  }\n}\n```\n\n---\n\n## Phase 2: Project Analysis and Branching\n\n### Project Determination (3 values)\n\n```\nCombine Step 1 response + background analysis result\n\n\"Introduce to existing\" selected → project_type: \"existing\"\n\"Web app\" or \"API\" selected → directory analysis:\n  ├── Empty or .git only → project_type: \"new\"\n  ├── Code 10+ → project_type: \"existing\" (show warning)\n  └── Code 1-9 → project_type: \"ambiguous\"\n```\n\n**Ambiguous case confirmation** (only for ambiguous):\n\n> ⚠️ Files exist in directory ({{CODE_COUNT}} files)\n>\n> 🅰️ **Continue as new** (keep existing files while setting up)\n> 🅱️ **Treat as existing** (add workflow files only)\n\n---\n\n## Phase 3: Setup Execution\n\n### New Project (project_type: \"new\")\n\n1. **Project generation** (can parallelize with Task tool)\n   ```bash\n   npx create-next-app@latest {{PROJECT_NAME}} --typescript --tailwind --eslint --app --src-dir\n   cd {{PROJECT_NAME}}\n   npm install @supabase/supabase-js lucide-react\n   ```\n\n2. **Workflow file generation**\n   - AGENTS.md, CLAUDE.md, Plans.md\n   - .claude/settings.json (non-destructive merge)\n   - .claude/memory/ (decisions.md, patterns.md)\n\n3. **Quality protection rules deployment**\n   - .claude/rules/test-quality.md\n   - .claude/rules/implementation-quality.md\n\n### Existing Project (project_type: \"existing\")\n\n1. **Check existing files**\n   ```bash\n   [ -f AGENTS.md ] && echo \"AGENTS.md: exists\" || echo \"missing\"\n   [ -f CLAUDE.md ] && echo \"CLAUDE.md: exists\" || echo \"missing\"\n   [ -f Plans.md ] && echo \"Plans.md: exists\" || echo \"missing\"\n   ```\n\n2. **Add only missing files** (don't touch existing)\n\n3. **.claude/settings.json is non-destructive merge**\n\n---\n\n## Phase 4: Environment Diagnosis (Auto-execute)\n\n```bash\n# Git\ncommand -v git >/dev/null 2>&1 && echo \"✅ git\" || echo \"❌ git\"\n\n# Node.js (if applicable)\ncommand -v node >/dev/null 2>&1 && echo \"✅ node $(node -v)\" || echo \"⚠️ node\"\n\n# GitHub CLI (optional)\ncommand -v gh >/dev/null 2>&1 && echo \"✅ gh\" || echo \"⚠️ gh\"\n```\n\nShow warning if issues exist. **No questions** (information only).\n\n### Phase 4.5: Hooks Permission Check (Auto-execute)\n\n**Auto-fix execution permissions for shell scripts in `.claude/hooks/`**:\n\n```bash\n# Check and fix .claude/hooks/*.sh execution permissions\nif [ -d .claude/hooks ]; then\n  FIXED_COUNT=0\n  for script in .claude/hooks/*.sh; do\n    [ -f \"$script\" ] || continue\n    if [ ! -x \"$script\" ]; then\n      chmod +x \"$script\"\n      echo \"✅ Fixed permission: $script\"\n      FIXED_COUNT=$((FIXED_COUNT + 1))\n    fi\n  done\n  if [ \"$FIXED_COUNT\" -gt 0 ]; then\n    echo \"ℹ️ Fixed execution permissions for $FIXED_COUNT shell script(s)\"\n  fi\nfi\n```\n\n**Why this matters**: Shell scripts without execution permission (`chmod +x`) will fail to run as hooks, causing silent failures or errors.\n\n---\n\n## Phase 5: Completion Report (Detailed Summary)\n\nAfter work completion, **explicitly show auto-determined content** for transparency:\n\n> ✅ **Setup complete!**\n>\n> ---\n>\n> ### 📋 Auto-determined Settings\n>\n> | Item | Value | How to Change |\n> |------|-------|---------------|\n> | Language | **ja** | Change in `claude-code-harness.config.json` |\n> | Mode | **{{Solo / 2-Agent}}** | {{.cursor/ detection result}} |\n> | Tech stack | **{{next-supabase etc.}}** | Select \"Detailed settings\" when re-running |\n> | Skills Gate | **{{impl, review etc.}}** | Adjust with `/skills-update` |\n> | Project name | **{{my-app-XXXXXX}}** | Edit `package.json` |\n>\n> ---\n>\n> ### 📁 Generated Files\n>\n> **Workflow**:\n> | File | Purpose | Size |\n> |------|---------|------|\n> | `AGENTS.md` | Development flow overview | {{XX lines}} |\n> | `CLAUDE.md` | Claude Code settings | {{XX lines}} |\n> | `Plans.md` | Task management | {{XX lines}} |\n>\n> **Settings**:\n> | File | Purpose |\n> |------|---------|\n> | `.claude/settings.json` | Permission & safety settings |\n> | `.claude/memory/decisions.md` | Decision records |\n> | `.claude/memory/patterns.md` | Reusable patterns |\n>\n> **Quality protection rules**:\n> | File | Content |\n> |------|---------|\n> | `.claude/rules/test-quality.md` | Test tampering prohibition |\n> | `.claude/rules/implementation-quality.md` | Hollow implementation prohibition |\n>\n> {{If 2-Agent mode}}\n> **Cursor commands**:\n> | File | Purpose |\n> |------|---------|\n> | `.cursor/commands/start-session.md` | Start session |\n> | `.cursor/commands/plan-with-cc.md` | Create plan |\n> | `.cursor/commands/handoff-to-claude.md` | Task request |\n> | `.cursor/commands/review-cc-work.md` | Implementation review |\n>\n> ---\n>\n> ### ⚙️ To Change Later\n>\n> | What to Change | Command/Method |\n> |----------------|----------------|\n> | Add/remove Skills Gate skills | `/skills-update` |\n> | Switch to 2-Agent mode | `/harness-init --mode=2agent` (or say \"want to start 2-agent operation\") |\n> | Change tech stack | Manual file edit or recreate project |\n> | Change language setting | Edit `claude-code-harness.config.json` |\n>\n> ---\n>\n> ### 🚀 Next Steps\n>\n> - \"`/plan-with-agent` I want to create XXX\" → Create plan\n> - \"`/work`\" → Execute tasks in Plans.md\n> - \"`npm run dev`\" → Start dev server (if applicable)\n>\n> 💡 **If stuck** ask \"what should I do?\"\n\n---\n\n## Mode-specific Additional Settings\n\n### Solo Mode\n\nNo additional settings. Complete as is.\n\n### 2-Agent Mode (when .cursor/ detected)\n\nAutomatically add:\n- .cursor/commands/ (5 files)\n- .claude/rules/workflow.md\n\n> 💡 **How to use 2-Agent**:\n> 1. Consult with Cursor \"want to create XXX\"\n> 2. Request task to Claude Code with `/handoff-to-claude`\n> 3. Implement in Claude Code → Report with `/handoff-to-cursor`\n\n---\n\n## Argument Support\n\n```bash\n# Full specification (no questions)\n/harness-init \"blog\" --mode=solo --stack=next-supabase --name=my-blog\n\n# Partial specification (only ask for missing)\n/harness-init --stack=rails-postgres\n\n# Help\n/harness-init --help\n```\n\n| Argument | Description | Example |\n|----------|-------------|---------|\n| `[project description]` | What to build | `\"EC site\"` |\n| `--mode` | solo / 2agent | `--mode=solo` |\n| `--stack` | Tech stack | `--stack=next-supabase` |\n| `--name` | Project name | `--name=my-app` |\n| `--lang` | Language | `--lang=en` |\n\n---\n\n## VibeCoder Hints\n\nPhrases available anytime after setup:\n\n| What You Want | How to Say |\n|---------------|------------|\n| Continue | \"continue\" \"next\" |\n| Check operation | \"run it\" \"show me\" |\n| Add feature | \"add XXX\" |\n| Stuck | \"what should I do?\" |\n| Leave everything | \"do everything\" |\n\n---\n\n## Notes\n\n- **Minimum questions**: 1 for \"leave it to me\", 2 for \"detailed settings\"\n- **Tech choices are auto-suggested**: Recommend defaults so VibeCoder doesn't get confused\n- **Existing files are protected**: Non-destructive merge, no overwriting\n- **Skills Gate adjustable later**: Reduce initial burden\n",
        "opencode/commands/core/harness-review.md": "---\ndescription: Multi-perspective review (auto-detects: code, plan, scope based on context)\ncontext: fork\nhooks: \n- event: PreCommandInvoke\ntype: command\ncommand: \"${CLAUDE_PLUGIN_ROOT}/scripts/check-codex.sh\"\nonce: true\n---\n\n# /harness-review - Multi-Perspective Review\n\nReviews your work from multiple perspectives. **Auto-detects what to review based on context.**\n\n---\n\n## 🎯 Context-Aware Review\n\nThis command automatically detects what to review based on your recent activity:\n\n| Recent Activity | Review Type | 4 Perspectives |\n|-----------------|-------------|----------------|\n| After `/plan-with-agent` | Plan Review | Clarity, Feasibility, Dependencies, Acceptance |\n| After `/work` | Code Review | Security, Performance, Quality, Accessibility |\n| After adding tasks to Plans.md | Scope Review | Scope-creep, Priority, Feasibility, Impact |\n\n### Usage\n\n```bash\n/harness-review           # Auto-detect from context\n/harness-review code      # Force code review\n/harness-review plan      # Force plan review\n/harness-review scope     # Force scope analysis\n```\n\n---\n\n## 💡 VibeCoder Usage Guide\n\n**This command is designed so you can receive high-quality review without technical knowledge.**\n\n- ✅ Auto-detect what needs review\n- ✅ Multi-perspective analysis (4 experts)\n- ✅ Clear actionable feedback\n- ✅ Works for code, plans, and scope\n\n**Important for contract development**: You can submit review results as a report to reassure clients\n\n---\n\n## --ci Mode (Non-interactive)\n\nCI/benchmark mode:\n- AskUserQuestion: do not use\n- WebSearch: do not use\n- Proceed without confirmations\n\n---\n\n## 🔧 Auto-invoke Skills (Required)\n\n**This command must explicitly invoke the following skills with the Skill tool**:\n\n| Skill | Purpose | When to Call |\n|-------|---------|--------------|\n| `harness-review` | Review (parent skill) | At review start |\n| `codex-review` | Codex second opinion | When Codex is enabled (optional) |\n\n**How to call**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:harness-review\"\n```\n\n**Child skills (auto-routing)**:\n- `review-security` - Security review\n- `review-performance` - Performance review\n- `review-quality` - Code quality review\n- `review-accessibility` - Accessibility review\n- `review-aggregate` - Aggregate review results\n\n> ⚠️ **Important**: Proceeding without calling skills won't record in usage statistics. Always call with Skill tool.\n\n---\n\n## 🔧 LSP Feature Utilization\n\nReviews utilize LSP (Language Server Protocol) for more accurate analysis.\n\n### Code Quality Check with LSP Diagnostics\n\n```\n📊 LSP Diagnostic Results\n\nFile: src/components/UserForm.tsx\n\n| Line | Severity | Message |\n|------|----------|---------|\n| 15 | Error | Type 'string' cannot be assigned to type 'number' |\n| 23 | Warning | 'tempData' is declared but not used |\n| 42 | Info | This async function has no await |\n\n→ Auto-detect type errors and unused variables\n```\n\n### Impact Analysis with LSP Find-references\n\nAnalyze where changed code is used with LSP:\n\n```\n🔍 Change Impact Scope\n\nChanged: src/utils/formatDate.ts\n\nReference locations:\n├── src/components/DateDisplay.tsx:12\n├── src/components/EventCard.tsx:45\n├── src/pages/Dashboard.tsx:78\n└── tests/utils/formatDate.test.ts:5\n\n→ Impacts 4 files\n→ Confirmed covered by tests ✅\n```\n\n### Integration with Review Perspectives\n\n| Review Perspective | LSP Usage |\n|-------------------|-----------|\n| **Quality** | Detect type errors and unused code with Diagnostics |\n| **Security** | Track sensitive data flow with reference analysis |\n| **Performance** | Confirm heavy processing implementation with definition jump |\n\n### VibeCoder Phrases\n\n| What You Want | How to Say |\n|---------------|------------|\n| Check type errors | \"Review including LSP diagnostics\" |\n| Know change impact | \"Check where this change affects\" |\n\nDetails: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n\n---\n\n## 🔧 Code Intelligence Integration (Optional)\n\nWhen `/dev-tools-setup` has been run, review automatically uses AST-Grep for deeper analysis.\n\n### AST-Grep Code Smell Detection\n\nIf `harness_ast_search` MCP tool is available:\n\n```\n🔍 AST-Grep Code Smell Scan\n\nPatterns checked:\n- console.log($$$) → Debug logs\n- catch ($ERR) { } → Empty catch blocks\n- async function $NAME($$$) { $BODY_NO_AWAIT } → Unused async\n\nResults:\n├── 3x console.log found (src/api/*.ts)\n├── 1x empty catch block (src/utils/error.ts:45)\n└── 0x unused async\n```\n\n### LSP Diagnostics Integration\n\nIf LSP is configured:\n\n```\n📊 LSP Diagnostics Summary\n\nsrc/components/UserForm.tsx:\n├── Line 15: Type error - string vs number\n├── Line 23: Unused variable 'tempData'\n\nsrc/api/users.ts:\n└── Line 42: Missing return type annotation\n```\n\n### How to Enable\n\n```bash\n/dev-tools-setup  # One-time setup\n```\n\nAfter setup, code intelligence is automatically used in reviews.\n\n---\n\n## Purpose of This Command\n\n**Automates quality assurance for contract development**.\n\n- Ensure quality of code submitted to clients\n- Detect security risks in advance\n- Find performance issues early\n- Verify accessibility compliance\n\n---\n\n## Execution Flow\n\n### Step 0: Codex Second Opinion Check (auto-execute with once hook)\n\n**Automatically checks Codex availability with `once: true` hook on first execution.**\n\nHook defined in this command's frontmatter:\n```yaml\nhooks:\n  - event: PreCommandInvoke\n    type: command\n    command: \"${CLAUDE_PLUGIN_ROOT}/scripts/check-codex.sh\"\n    once: true\n```\n\n**Behavior**:\n- `check-codex.sh` runs only on first `/harness-review` execution in session\n- If Codex is installed, guides how to enable\n- Auto-skips on subsequent runs (`once: true` effect)\n\n**To enable Codex**:\n\nAdd the following to project config (`.claude-code-harness.config.yaml`):\n```yaml\nreview:\n  codex:\n    enabled: true\n```\n\n> 💡 **To run Codex review only manually**: Use `/codex-review` command\n\n---\n\n### Step 0.5: Remaining Context Check (Codex mode)\n\nBefore Codex parallel review, **run /compact first if remaining context is 30% or less**.\n\n> **Note**: Continue with Codex parallel review even if space is still tight after /compact.\n\n---\n\n### Step 1: Identify Changed Files\n\n```bash\n# Check recent changes\ngit diff --name-only HEAD~5 2>/dev/null || find . -name \"*.ts\" -o -name \"*.tsx\" -o -name \"*.py\" | head -20\n```\n\n### Step 2: Execute Parallel Reviews\n\nExecute parallel reviews from the following perspectives. Use **Task tool** to launch multiple subagents simultaneously and reduce review time.\n\n**💡 True parallel execution with async subagents**:\nRun each review individually and send to background with `Ctrl+B` for fully parallel execution. See [Async Subagents Guide](../docs/ASYNC_SUBAGENTS.md) for details.\n\n**Manual parallel execution steps**:\n1. Run `/harness-review security` → `Ctrl+B` to background\n2. Run `/harness-review performance` → `Ctrl+B` to background\n3. Run `/harness-review quality` → `Ctrl+B` to background\n4. Run `/harness-review accessibility` → `Ctrl+B` to background\n5. Auto-notification when each subagent completes\n\n**Mode-specific parallel execution:**\n\n#### Default Mode (`review.mode: default`) - Launch 4 parallel code-reviewers with Task tool\n\n```\n🔍 Starting parallel review...\n\nTask tool #1: subagent_type=\"code-reviewer\" → Security perspective\nTask tool #2: subagent_type=\"code-reviewer\" → Performance perspective\nTask tool #3: subagent_type=\"code-reviewer\" → Quality perspective\nTask tool #4: subagent_type=\"code-reviewer\" → Accessibility perspective\n\n→ 4 subagents execute in parallel\n→ Integrate results and output overall evaluation\n```\n\n#### Codex Mode (`review.mode: codex`) - MCP parallel execution with only needed experts\n\n**⚠️ Important: Do not combine multiple experts in one call**\n\n```\n🔍 Starting Codex parallel review...\n\n1. Determine which experts to call (only needed ones, not all):\n   - enabled: false in config → exclude\n   - CLI/backend → exclude Accessibility, SEO\n   - Document only changes → prioritize Quality, Architect, Plan Reviewer, Scope Analyst\n\n2. Load prompts individually from enabled experts' experts/*.md\n\n3. Execute mcp__codex__codex in parallel within 1 response for enabled experts only:\n   Example: Web frontend with code changes → 6 experts in parallel\n   mcp__codex__codex({prompt: security-expert.md})\n   mcp__codex__codex({prompt: accessibility-expert.md})\n   mcp__codex__codex({prompt: performance-expert.md})\n   mcp__codex__codex({prompt: quality-expert.md})\n   mcp__codex__codex({prompt: seo-expert.md})\n   mcp__codex__codex({prompt: architect-expert.md})\n\n→ Only needed experts execute in parallel (cost optimization)\n→ Integrate each expert's results for judgment\n```\n\n**Details**: `skills/codex-review/references/codex-parallel-review.md`\n\nReview perspectives:\n\n#### 🔒 Security Check\n\n- [ ] Proper environment variable management\n- [ ] Input validation\n- [ ] SQL injection protection\n- [ ] XSS protection\n- [ ] Authentication/authorization implementation\n\n#### ⚡ Performance Check\n\n- [ ] Unnecessary re-renders\n- [ ] N+1 queries\n- [ ] Heavy computation optimization\n- [ ] Image/asset optimization\n\n#### 📐 Code Quality Check\n\n- [ ] Proper TypeScript type usage\n- [ ] Error handling\n- [ ] Naming convention consistency\n- [ ] Appropriate file structure\n\n#### ♿ Accessibility Check (for Web)\n\n- [ ] Semantic HTML\n- [ ] Alt text\n- [ ] Keyboard navigation\n- [ ] Color contrast\n\n### Step 2.5: Result Integration and Codex Verification (when Codex enabled)\n\n**When `codex.enabled: true`, Claude verifies Codex review results and determines if fixes are needed.**\n\n```\n📊 Integrating review results...\n\n1. Aggregate Claude 4-perspective review results\n2. Get Codex review results\n3. Claude verifies Codex findings\n   - Is the finding valid?\n   - Is a fix needed?\n   - What's the priority?\n```\n\n**Result integration and verification**:\n\n```markdown\n## 📊 Review Result Comparison\n\n| Perspective | Claude | Codex | Match |\n|-------------|--------|-------|-------|\n| Security | 2 issues | 1 issue | 1 common |\n| Performance | 1 issue | 2 issues | 1 common |\n\n### 🔴 Both Flagged (High Priority - Fix Recommended)\n- Possible SQL injection (src/api/users.ts:45)\n  → **Claude verification**: Valid. Need to fix with parameterized queries\n\n### 🟡 Claude Only Flagged\n- Unused variable (src/utils/helpers.ts:12)\n  → **Fix recommended**: Delete or use\n\n### 🟢 Codex Only Flagged (Claude Verified)\n- Possible N+1 query (src/api/posts.ts:30)\n  → **Claude verification**: Valid. Should add prefetch\n```\n\n**Fix proposal and approval flow**:\n\n```markdown\n## 🔧 Items Requiring Fixes\n\nAdd the following fixes to Plans.md and execute with `/work`?\n\n| # | Fix Content | File | Priority |\n|---|-------------|------|----------|\n| 1 | SQL injection protection | src/api/users.ts:45 | High |\n| 2 | N+1 query fix | src/api/posts.ts:30 | Medium |\n| 3 | Delete unused variable | src/utils/helpers.ts:12 | Low |\n\n**Options:**\n1. Approve all → Add to Plans.md and run `/work`\n2. Approve selected → Specify numbers (e.g., 1,2)\n3. Don't fix now → Save report only\n```\n\n**Flow after approval**:\n\n```\nUser approval\n    ↓\nAdd fix tasks to Plans.md\n    ↓\nAuto-run /work (or suggest execution)\n    ↓\nRe-review after fix completion (optional)\n```\n\n> 💡 **To run Codex review only**: Use `/codex-review` command\n\n---\n\n### Step 3: Output Review Results\n\n> 📊 **Code Review Results**\n>\n> **Overall Rating**: {{A / B / C / D}}\n>\n> ---\n>\n> ### 🔒 Security: {{Rating}}\n> {{Issues or \"No issues\"}}\n>\n> ### ⚡ Performance: {{Rating}}\n> {{Issues or \"No issues\"}}\n>\n> ### 📐 Code Quality: {{Rating}}\n> {{Issues or \"No issues\"}}\n>\n> ### ♿ Accessibility: {{Rating}}\n> {{Issues or \"No issues\"}}\n>\n> ---\n>\n> ### 🔧 Improvement Suggestions\n>\n> 1. {{Specific improvement 1}}\n> 2. {{Specific improvement 2}}\n>\n> **Fix automatically?** (y / n / select)\n\n### Step 4: Execute Improvements (after user approval)\n\nAutomatically execute approved improvements:\n\n```bash\n# Example: ESLint auto-fix\nnpx eslint --fix src/\n\n# Example: Apply Prettier\nnpx prettier --write src/\n```\n\n### Step 5: Completion Report\n\n> ✅ **Review Complete**\n>\n> **Fixed items:**\n> - {{fix1}}\n> - {{fix2}}\n>\n> **Next steps:**\n> Say \"commit\" or \"proceed to next phase\".\n\n### Step 6: Commit Guard Integration (Require review before commit)\n\n**If review result is APPROVE, generate state file to allow commit.**\n\nThis feature blocks commit attempts without review.\n\n**Operation flow**:\n```\n/harness-review execution\n    ↓\nReview result is APPROVE\n    ↓\nGenerate .claude/state/review-approved.json\n    ↓\ngit commit is allowed\n    ↓\nClear review-approved.json after successful commit\n    ↓\nReview required again before next commit\n```\n\n**State file generation (auto-execute on APPROVE)**:\n\n```bash\n# If review result is APPROVE, execute:\nmkdir -p .claude/state\ncat > .claude/state/review-approved.json << 'EOF'\n{\n  \"judgment\": \"APPROVE\",\n  \"approved_at\": \"{{ISO 8601 timestamp}}\",\n  \"reviewed_files\": [\"{{changed_files}}\"],\n  \"review_summary\": \"{{summary}}\"\n}\nEOF\n```\n\n**To disable commit guard**:\n\nAdd to `.claude-code-harness.config.yaml`:\n```yaml\ncommit_guard: false\n```\n\n> 💡 **Note**: Disabling commit guard allows commits without review. Recommended to keep enabled for production projects.\n\n---\n\n## Review Perspective Details\n\n### Security\n\n```typescript\n// ❌ Bad example\nconst apiKey = \"sk-REDACTED\"  // Hardcoded (example)\n\n// ✅ Good example\nconst apiKey = process.env.API_KEY  // Environment variable\n```\n\n### Performance\n\n```typescript\n// ❌ Bad example\nconst Component = () => {\n  const data = heavyCalculation()  // Calculates every time\n  return <div>{data}</div>\n}\n\n// ✅ Good example\nconst Component = () => {\n  const data = useMemo(() => heavyCalculation(), [])\n  return <div>{data}</div>\n}\n```\n\n### Code Quality\n\n```typescript\n// ❌ Bad example\nfunction f(x: any) { return x.y.z }  // any type, no error handling\n\n// ✅ Good example\nfunction getNestedValue(obj: NestedObject): string | null {\n  return obj?.y?.z ?? null\n}\n```\n\n---\n\n## VibeCoder Simplified Version\n\nWhen technical details are not needed:\n\n> 📊 **Check Results**\n>\n> - Security: ✅ OK\n> - Speed: ✅ OK\n> - Code quality: ⚠️ 2 improvements\n>\n> Say \"fix it\" to auto-fix.\n\n---\n\n## Options\n\n```\n/harness-review              # Check all\n/harness-review security     # Security only\n/harness-review performance  # Performance only\n/harness-review quick        # Quick check\n```\n\n---\n\n## ⚡ Parallel Execution Decision Points\n\nReview perspectives (Security/Performance/Quality/Accessibility/Codex) are **independent of each other**, so parallel execution is effective.\n\n### When to Execute in Parallel ✅\n\n| Condition | Reason |\n|-----------|--------|\n| Full review (all 4 perspectives) | Maximum time savings |\n| Codex enabled (5 perspectives) | Codex also runs in parallel |\n| 5+ changed files | Each perspective takes longer |\n| Need results quickly | Before PR merge, etc. |\n\n**Parallel execution effect (Codex enabled)**:\n```\n🚀 Starting parallel review...\n├── [Security] Analyzing... ⏳\n├── [Performance] Analyzing... ⏳\n├── [Quality] Analyzing... ⏳\n├── [Accessibility] Analyzing... ⏳\n└── [Codex] Getting second opinion... ⏳\n\n⏱️ Time: 35s (would be +30s if sequential Codex)\n```\n\n### When to Execute Sequentially ⚠️\n\n| Condition | Reason |\n|-----------|--------|\n| Single perspective only (`/harness-review security`) | No parallelization needed |\n| 1-2 changed files | Each perspective is quick |\n| Want to check issues one by one | Progress interactively |\n\n### Auto-decision Logic\n\n```\nReview perspectives >= 3 AND changed files >= 5 → Parallel execution (Task tool)\nReview perspectives < 3 OR changed files < 5 → Sequential execution\n```\n\n### Manual Parallel Execution\n\n```bash\n# Execute in parallel in background\n/harness-review security     # → Ctrl+B to background\n/harness-review performance  # → Ctrl+B to background\n/harness-review quality      # → Ctrl+B to background\n/harness-review accessibility # Last one waits\n\n# Integrate results and report\n```\n",
        "opencode/commands/core/plan-with-agent.md": "---\ndescription: Create implementation plan (idea → Plans.md → ready for /work)\n---\n\n# /plan-with-agent - Create Implementation Plan\n\nOrganizes ideas and requirements, and converts them into executable tasks in Plans.md.\nAfter completion, you can immediately start work with `/work`.\n\n## Quick Reference\n\n- \"**Create a plan**\" → this command\n- \"**Turn what we talked about into a plan**\" → extract requirements from conversation and create plan\n- \"**Want to organize what to build**\" → start with hearing and create plan\n- \"**List out features**\" → feature list → priority → Plans.md\n- \"**Plan with TDD**\" → force TDD adoption, prioritize test case design\n- \"**Start with test design**\" → design test cases for each feature first\n- \"**CI/benchmark**\" → `/plan-with-agent --ci`\n\n## Deliverables\n\n- **Plans.md** - Task list executable with `/work` (required)\n- **Feature priority matrix** - Classification into required/recommended/optional\n\n---\n\n## --ci Mode (Non-interactive)\n\nCI/benchmark mode:\n- AskUserQuestion: do not use\n- WebSearch: do not use\n- Fill missing info with explicit assumptions\n- Proceed end-to-end without confirmations\n\n---\n\n## ⚠️ Mode-specific Usage\n\n| Mode | Recommended Command | Description |\n|------|---------------------|-------------|\n| **Solo mode** | `/plan-with-agent` (this command) | Claude Code alone: plan → execute → review |\n| **2-agent mode** | `/plan-with-cc` (Cursor side) | Plan with Cursor → Execute with Claude Code |\n\n---\n\n## 🔧 Required Skills (Call First)\n\n> ⛔ **When executing this command, you must call the Skill tool first**\n>\n> Proceeding without calling the Skill tool is prohibited.\n\n**Required skills to call**:\n\n| Skill | Fully Qualified Name | When to Call |\n|-------|---------------------|--------------|\n| `setup` | `claude-code-harness:setup` | **Call first** (executes adaptive setup) |\n| `vibecoder-guide` | `claude-code-harness:vibecoder-guide` | When user is non-technical |\n\n**How to call (required)**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:setup\"\n```\n\n**Why Skill call is required**:\n1. Recorded in usage statistics (quality tracking)\n2. Guardrails in skill are applied\n3. Accurate grasp of project state\n\n> ❌ **Prohibited**: Reading command document and proceeding directly to execution flow\n> ✅ **Correct**: Call `setup` with Skill tool first, then proceed\n\n---\n\n## Execution Flow\n\n### Step 0: Check Conversation Context (Execute after Skill call)\n\n**Confirm with AskUserQuestion tool**:\n\n> 📝 **Choose how to create the plan**\n>\n> 1. **Based on previous conversation** - Create plan from brainstormed content\n> 2. **Start fresh** - Create plan from scratch with hearing\n\n**If \"Based on previous conversation\" is selected**:\n- Extract requirements, ideas, and decisions from recent conversation\n- Confirm extracted content with user\n- After confirmation, skip to Step 3 (technical research)\n\n**If \"Start fresh\" is selected**:\n- Start hearing from Step 1\n\n---\n\n### Step 1: Hearing What You Want to Build\n\nCheck user input. If no input, ask:\n\n> 🎯 **What do you want to build?**\n>\n> Examples:\n> - \"Reservation management system\"\n> - \"Blog site\"\n> - \"Task management app\"\n> - \"API server\"\n>\n> Rough ideas are fine!\n\n**Wait for response**\n\n### Step 2: Increase Resolution (Max 3 questions)\n\n> 📋 **Tell me a bit more:**\n>\n> 1. **Who will use it?** (yourself only? team? public?)\n> 2. **Any similar services?** (references)\n> 3. **How far do you want to build?** (MVP? full features?)\n\n**Wait for response**\n\n### Step 3: Technical Research (WebSearch)\n\n**Don't ask the user. Claude Code researches and suggests.**\n\n```\nWebSearch for:\n- \"{{project type}} tech stack 2025\"\n- \"{{similar service}} architecture\"\n```\n\n### Step 4: Extract Feature List\n\nExtract concrete feature list from requirements.\n\n**Example**: For \"Reservation management system\"\n- User registration/login\n- Reservation calendar display\n- Create/edit/cancel reservations\n- Admin dashboard\n- Email notifications\n- Payment feature\n- Review feature\n\n### Step 5: Create Feature Priority Matrix\n\nClassify each feature into these 3 categories:\n\n| Priority | Description | Criteria |\n|----------|-------------|----------|\n| **Required** | Needed for MVP (minimum viable product) | Won't work without this |\n| **Recommended** | Greatly improves user experience | Nice to have, but works without |\n| **Optional** | Consider for future addition | If there's time |\n\n**Example**: For reservation management system\n\n| Feature | Priority | Reason |\n|---------|----------|--------|\n| User registration/login | Required | Need authentication for reservations |\n| Reservation calendar display | Required | Core feature |\n| Create/edit/cancel reservations | Required | Core feature |\n| Admin dashboard | Recommended | Improves operational efficiency |\n| Email notifications | Recommended | Improves user experience |\n| Payment feature | Optional | Can add later |\n| Review feature | Optional | Can add later |\n\n---\n\n### Step 5.5: TDD Adoption Judgment and Strict Test Design (Important)\n\n**Purpose**: Strict TDD = accurately understanding user intent. Tests are \"specification documentation\", agreeing before implementation.\n\n#### TDD Adoption Judgment\n\n**Adopt TDD if any of the following conditions apply**:\n\n| Judgment Condition | Reason |\n|-------------------|--------|\n| Contains business logic | Calculation, judgment, state transition require specification documentation |\n| Has data transformation/processing | Many boundary conditions in input→output conversion |\n| Has external API integration | Clarify specifications through mock design |\n| Has multiple branches/conditions | Need to identify edge cases |\n| Involves money/auth/permissions | No room for error (security + TDD) |\n| User's words are vague | Align understanding through test cases |\n\n**Record judgment result**:\n```\nFeature \"{{feature name}}\" → TDD adoption reason: {{matching condition}}\n```\n\n#### Deep Intent Questions (Confirm with AskUserQuestion tool)\n\nFor features with TDD adoption decision, **always ask the following**:\n\n> 🎯 **Let me confirm about \"{{feature name}}\" before writing tests**\n>\n> 1. **Normal case**: What's the most common usage? (specific scenario)\n> 2. **Boundary conditions**: Where's the line between \"barely OK\" and \"barely NG\"?\n> 3. **On error**: How do you want to show errors to users?\n> 4. **Implicit expectations**: What do you consider \"obvious\"? (unspoken rules)\n\n**Additional questions to draw out tacit knowledge** (as needed):\n\n| Situation | Additional Question |\n|-----------|---------------------|\n| Handling numbers | \"Allow 0 or negative?\" \"Decimal places?\" |\n| Handling dates | \"Timezone?\" \"Allow past dates?\" |\n| Handling strings | \"Empty string?\" \"Max length?\" \"Emojis?\" |\n| Handling lists | \"Empty list?\" \"Upper limit?\" \"Duplicates?\" |\n| State transitions | \"Can go back?\" \"Cancel midway?\" \"Timeout?\" |\n| User operations | \"What if spammed?\" \"What if they leave midway?\" |\n\n#### Test Case Design (Include in Plans.md)\n\n**TDD-adopted features include test design before implementation tasks**:\n\n```markdown\n### {{Feature Name}} `[feature:tdd]`\n\n#### Test Case Design (Agree before implementation)\n\n| Test Case | Input | Expected Output | Notes |\n|-----------|-------|-----------------|-------|\n| Normal: basic | {{example}} | {{expected}} | Most common case |\n| Normal: boundary lower | {{barely OK}} | {{success}} | Lower limit test |\n| Normal: boundary upper | {{barely OK}} | {{success}} | Upper limit test |\n| Error: boundary exceeded | {{barely NG}} | {{error}} | Validation check |\n| Error: null/empty | null, \"\", [] | {{error}} | Defensive programming |\n| Edge case | {{special case}} | {{expected behavior}} | Tacit knowledge documentation |\n\n#### Implementation Tasks\n- [ ] Create test file (implement above cases)\n- [ ] Create implementation code (until tests pass)\n- [ ] Refactor (while maintaining tests)\n```\n\n#### When TDD Not Adopted\n\nSimple features not matching TDD judgment conditions (static UI, config file generation, etc.) proceed with normal implementation flow. However, if user requests \"also write tests\", adopt TDD.\n\n---\n\n### Step 6: Effort Estimation (Reference)\n\nCalculate implementation effort for each feature as reference.\n\n**Estimation standards** (with Claude Code):\n\n| Feature Type | Effort (person-days) |\n|--------------|---------------------|\n| Auth (using Clerk) | 0.5-1 |\n| CRUD (1 table) | 1-2 |\n| Admin panel (basic) | 2-3 |\n| Payment (using Stripe) | 2-3 |\n| Email notifications | 1-2 |\n| CI/CD setup | 1 |\n| Deploy setup | 0.5 |\n\n### Step 7: Generate Plans.md (Auto-assign Quality Judgment Markers)\n\nGenerate `Plans.md` for implementation.\n\n**Auto-assign quality judgment markers**:\n\nAnalyze each task's content and auto-assign appropriate quality markers:\n\n| Task Content | Marker | Effect |\n|--------------|--------|--------|\n| Auth/login feature | `[feature:security]` | Show security checklist |\n| UI component | `[feature:a11y]` | Recommend a11y check |\n| Business logic | `[feature:tdd]` | Recommend TDD |\n| API endpoint | `[feature:security]` | Input validation check |\n| Bug fix | `[bugfix:reproduce-first]` | Recommend reproduction test first |\n\n```markdown\n## 🎯 Project: {{Project Name}}\n\n### Overview\n- **Purpose**: {{what you want to do}}\n- **Target**: {{who will use it}}\n- **Reference**: {{similar service}}\n- **Scope**: {{MVP or full features}}\n\n### Tech Stack\n- Frontend: {{tech}}\n- Backend: {{tech}}\n- Database: {{tech}}\n- Deploy: {{tech}}\n\n---\n\n## 🔴 Phase 1: Foundation Setup `cc:TODO`\n\n- [ ] Project initialization\n- [ ] Basic setup (linter, formatter)\n- [ ] Database design\n- [ ] Environment variable setup\n- [ ] Git init & initial commit\n\n## 🟡 Phase 2: Core Features (Required) `cc:TODO`\n\n### {{Required Feature 1}} `[feature:tdd]`\n\n#### Test Case Design (Agreed before implementation)\n| Test Case | Input | Expected Output | Notes |\n|-----------|-------|-----------------|-------|\n| Normal: basic | {{example}} | {{expected}} | From user hearing |\n| Boundary | {{boundary value}} | {{expected behavior}} | Confirmed in Step 5.5 |\n| Error | {{error input}} | {{error}} | Tacit knowledge documentation |\n\n#### Implementation Tasks\n- [ ] Create test file\n- [ ] Create implementation code\n- [ ] Refactor\n\n### {{Required Feature 2}} `[feature:tdd]`\n(Same test case design)\n\n### {{Auth Feature}} `[feature:security]`\n\n## 🟢 Phase 3: Recommended Features `cc:TODO`\n\n- [ ] {{UI feature}} `[feature:a11y]`\n- [ ] {{recommended feature}}\n\n## 🔵 Phase 4: Finishing `cc:TODO`\n\n- [ ] Review (`/harness-review`)\n- [ ] Deploy setup\n- [ ] Operation check\n```\n\n**Marker judgment logic**:\n\n```\nAnalyze task content\n    ↓\n├── \"auth\" \"login\" \"API\" → [feature:security] + go to TDD judgment\n├── \"component\" \"UI\" \"screen\" → [feature:a11y]\n├── \"fix\" \"bug\" → [bugfix:reproduce-first]\n├── \"service\" \"logic\" \"core\" → [feature:tdd] + go to Step 5.5\n├── \"calculation\" \"transform\" \"validation\" → [feature:tdd] + go to Step 5.5\n├── \"payment\" \"amount\" \"billing\" → [feature:security] + [feature:tdd] + go to Step 5.5\n└── Other → no marker\n```\n\n**Important**: Features with `[feature:tdd]` marker must go through TDD adoption judgment flow in Step 5.5, including deep intent questions to user and test case design.\n\n### Step 8: Guide Next Actions\n\n> ✅ **Plan complete!**\n>\n> 📄 **Generated files**:\n> - `Plans.md` - Implementation task list\n>\n> **Next steps:**\n> - Start implementation with \"`/work`\"\n> - Or say \"start from Phase 1\"\n>\n> 💡 **Hint**: To adjust the plan, say \"add {{feature}}\" or \"postpone {{feature}}\".\n\n---\n\n## Output Examples\n\n### Example 1: Plan from Brainstorming\n\n```\nUser: (Was brainstorming \"want to make a task management app, like Notion\")\nUser: /plan-with-agent\n\nClaude Code:\n> 📝 Choose how to create the plan\n> 1. Based on previous conversation\n> 2. Start fresh\n\nUser: 1\n\nClaude Code:\n> Extracted the following from conversation:\n> - What to build: Task management app\n> - Reference: Notion\n> - Feature candidates: Task CRUD, kanban view, tag feature\n>\n> Proceed with this plan?\n\nUser: OK\n\n→ Generate Plans.md\n```\n\n### Example 2: Plan from Scratch\n\n```\nUser: /plan-with-agent\n\nClaude Code:\n> 📝 Choose how to create the plan\n\nUser: Start fresh\n\nClaude Code:\n> 🎯 What do you want to build?\n\nUser: Blog site\n\n(Continue hearing)\n→ Generate Plans.md\n```\n\n---\n\n## Notes\n\n- **Plans.md is the priority**: Purpose is to get to a state executable with `/work`\n- **Flexibly adjustable**: Can change with \"add XXX\" or \"remove XXX\" after planning\n- **Use brainstorming context**: Select \"Based on conversation\" in Step 0 to reflect discussed content\n",
        "opencode/commands/core/skill-list.md": "---\ndescription: Show available skills with descriptions\n---\n\n# /skill-list - Skill List\n\nDisplays available skills. Skills are automatically invoked during conversation, so explicit command execution is not required.\n\n> **Claude Code 2.1.0+**: Skills support hot reload. Additions and changes are reflected immediately (no restart needed).\n\n---\n\n## Usage\n\n```\n/skill-list\n```\n\nOr in natural language:\n- \"Show available skills\"\n- \"Skill list\"\n- \"What can you do?\"\n\n---\n\n## Skill List\n\nOutput the skill list in the following format at execution.\n\n### Output Format\n\n```markdown\n## Available Skills\n\n### Core (Core Features)\n\n| Skill | Description | Trigger Example |\n|-------|-------------|-----------------|\n| session-init | Environment check at session start | \"start work\" \"check status\" |\n| plans-management | Plans.md management | \"add a task\" |\n| session-memory | Memory management between sessions | auto |\n| parallel-workflows | Parallel execution of multiple tasks | \"execute in parallel\" |\n| troubleshoot | Problem diagnosis and resolution | \"investigate the error\" |\n\n### Optional (Extensions)\n\n| Skill | Description | Trigger Example |\n|-------|-------------|-----------------|\n| analytics | Analytics integration (GA/Vercel) | \"add analytics\" |\n| auth | Authentication (Clerk/Supabase) | \"add login feature\" |\n| auto-fix | Auto-fix review issues | \"auto-fix the issues\" |\n| component | UI component generation | \"create a hero section\" |\n| deploy-setup | Deploy setup (Vercel/Netlify) | \"make it deployable\" |\n| feedback | Feedback feature | \"add a feedback form\" |\n| health-check | Environment diagnosis | \"check the environment\" |\n| notebooklm-yaml | NotebookLM YAML generation | \"create slide design YAML\" |\n| payments | Payment feature (Stripe) | \"want to add payments\" |\n| setup-cursor | Cursor integration setup | \"want to start 2-agent operation\" |\n\n---\n\n💡 **Usage**: Skills are automatically invoked during conversation.\nJust speak like the \"Trigger Example\" above.\n```\n\n---\n\n## Execution Steps\n\n1. Scan `skills/` directory\n2. Extract `name` and `description` from each skill's `SKILL.md`\n3. Organize by category (core / optional)\n4. Output in above format\n\n---\n\n## Implementation (Instructions for LLM)\n\nGet skill information with the following commands:\n\n```bash\n# List skill directories\nfind \"${CLAUDE_PLUGIN_ROOT}/skills\" -name \"SKILL.md\" -type f\n\n# Extract name and description from each skill\nfor f in $(find \"${CLAUDE_PLUGIN_ROOT}/skills\" -name \"SKILL.md\"); do\n  echo \"=== $f ===\"\n  grep -E \"^name:|^description:\" \"$f\" | head -2\ndone\n```\n\nFormat the obtained information into the above format and output.\n",
        "opencode/commands/core/sync-status.md": "---\ndescription: Check progress → update Plans.md → suggest next action\n---\n\n# /sync-status - Status Check, Plans.md Sync, Next Action Suggestion\n\n**Checks current implementation status, detects and updates differences with Plans.md, then suggests what to do next.**\n\nRun this at work milestones or when you think \"where am I at?\"\n\n## VibeCoder Quick Reference\n\n- \"**How far have we progressed?**\" → this command\n- \"**What should I do next?**\" → organize status and suggest next action\n- \"**Check if Plans.md matches actual progress**\" → detect differences and update\n\n## Deliverables\n\n1. **Progress check**: Check consistency between implementation status and Plans.md\n2. **Difference update**: Update Plans.md markers to match reality\n3. **Next action suggestion**: Present what to do next considering priority\n\n---\n\n## Execution Flow\n\n### Step 1: Gather Current Status\n\n```bash\n# Current task state in Plans.md\ncat Plans.md\n\n# Git change status (what actually changed)\ngit status\ngit diff --stat HEAD~3  # Changes in last 3 commits\n\n# Recent commit history\ngit log --oneline -10\n```\n\n### Step 2: Detect Differences Between Implementation and Plans.md\n\nCheck the following:\n\n| Check Item | Detection Method |\n|------------|------------------|\n| Done but still `cc:WIP` | Commit history vs marker |\n| Started but still `cc:TODO` | Changed files vs marker |\n| Implemented task not in Plans.md | Commit messages vs task list |\n| `cc:done` but not committed | git status vs marker |\n\n### Step 3: Update Plans.md (if differences exist)\n\nIf differences detected, suggest and execute updates:\n\n> 📝 **Plans.md update needed**\n>\n> | Task | Current | After Update | Reason |\n> |------|---------|--------------|--------|\n> | Implement XX | `cc:WIP` | `cc:done` | Committed |\n> | Add YY | `cc:TODO` | `cc:WIP` | Files being changed |\n>\n> **Update?** (yes / no)\n\nIf \"yes\", update Plans.md.\n\n### Step 4: Output Progress Summary\n\n```markdown\n## 📊 Progress Summary\n\n**Updated**: {{YYYY-MM-DD HH:MM}}\n**Branch**: {{current branch}}\n\n---\n\n### Task Status\n\n| Status | Count |\n|--------|-------|\n| 🔴 Not started (`cc:TODO`) | {{count}} |\n| 🟡 In progress (`cc:WIP`) | {{count}} |\n| 🟢 Done (`cc:done`) | {{count}} |\n| ✅ Verified (`pm:verified`) | {{count}} |\n| ⏳ Requested (`pm:requested`) | {{count}} |\n| 🚫 Blocked (`blocked`) | {{count}} |\n\n**Progress rate**: {{done + verified}} / {{total tasks}} ({{percent}}%)\n\n### Context Usage\n\n> 💡 **Check via status line (Claude Code v2.1.6+)**:\n> - `context_window.used_percentage`: Usage rate\n> - `context_window.remaining_percentage`: Remaining\n\n**Warning thresholds**:\n- 🟢 0-50%: Plenty of room\n- 🟡 50-70%: Caution\n- 🔴 70%+: Recommend ending session\n```\n\n### Step 5: Suggest Next Action\n\nSuggest optimal next action based on status:\n\n> 🎯 **What to do next**\n>\n> **Priority 1**: {{highest priority task}}\n> - Reason: {{requested / unblock / dependency, etc.}}\n>\n> **Priority 2**: {{next task}}\n>\n> ---\n>\n> **Recommended commands**:\n> - `/work` - Start next task\n> - `/handoff-to-pm-claude` - Report completion to PM (if tasks are done)\n> - `/harness-review` - Request review (if at a milestone)\n>\n> ⚠️ Context usage is high. Consider ending session and starting new.\n> (Shown when context usage is 70%+)\n\n---\n\n## Anomaly Detection\n\nWarn when the following situations are detected:\n\n| Situation | Warning |\n|-----------|---------|\n| Multiple `cc:WIP` exist | ⚠️ Working on multiple tasks simultaneously |\n| `blocked` left for long time | ⚠️ Prioritize unblocking |\n| `pm:requested` not processed | ⚠️ Process PM's request first |\n| Large gap between Plans.md and implementation | ⚠️ Task management not keeping up |\n\n---\n\n## Notes\n\n- **Confirm before update**: Show differences and ask for confirmation before updating Plans.md\n- **Reference commit history**: Judge actual work content from commit history\n- **Be specific about next action**: Clearly present \"what to do\"\n\n---\n\n## ⚡ Parallel Execution Decision Points\n\n**Information gathering phase** benefits from parallel execution in this command.\n\n### When to Execute in Parallel ✅\n\n| Process | Parallelize |\n|---------|-------------|\n| Read Plans.md | ✅ Independent |\n| Check git status | ✅ Independent |\n| Check git log | ✅ Independent |\n| Check git diff | ✅ Independent |\n\n**Parallel execution effect**:\n```\n🚀 Starting information gathering...\n├── [Plans.md] Reading... ⏳\n├── [git status] Checking... ⏳\n├── [git log] Getting... ⏳\n└── [git diff] Analyzing... ⏳\n\n→ Get 4 pieces of info simultaneously → time saved\n```\n\n### Sequential Processing\n\nThe following run sequentially due to dependencies:\n\n```\nInformation gathering (parallel) → Difference detection (sequential) → Update proposal (sequential) → Next action (sequential)\n```\n\n### Auto-optimization\n\nThis command is **automatically optimized**:\n- Information gathering: Parallel execution\n- Analysis/update: Sequential execution (due to dependencies)\n",
        "opencode/commands/core/work.md": "---\ndescription: Execute Plans.md tasks (Solo/2-Agent, parallel execution enabled)\n---\n\n# /work - Execute Plan\n\nExecutes the plan in Plans.md and generates actual code.\n**Actively utilizes parallel execution** to efficiently complete tasks.\n\n## VibeCoder Quick Reference\n\n- \"**Progress tasks in Plans.md**\" → this command\n- \"**Build to where it works first**\" → get to minimum working state first\n- \"**Do everything at once**\" → automatic parallel execution\n- \"**Want to resume from where I left off**\" → resume from in-progress (cc:WIP) or requested (pm:requested)\n- \"**Resume session**\" → `--resume <id|latest>` (restore history session)\n- \"**Fork session**\" → `--fork <id|current> --reason \"<text>\"`\n\n## Deliverables\n\n- Implement Plans.md tasks **efficiently with smart parallel execution**\n- When stuck, isolate cause → fix → re-verify loop\n- **2-Agent mode**: Prioritize processing pm:requested tasks\n- **Review loop**: implement → harness-review → fix until OK → auto-commit\n\n---\n\n## 🚀 Default Behavior\n\n`/work` runs implement → review → fix → commit by default:\n\n```bash\n/work                    # Implement → Review → Fix → Commit (default)\n/work --no-commit        # Skip auto-commit (manual commit)\n/work --parallel 5       # Force 5 parallel workers\n/work --sequential       # Force sequential (no parallel)\n```\n\n### Project-level Configuration\n\nOverride default via `.claude-code-harness.config.yaml`:\n\n```yaml\nwork:\n  auto_commit: false  # Disable auto-commit for this project\n  commit_on_pm_approve: true  # 2-Agent: defer commit until PM approves\n```\n\n### Smart Parallel Detection\n\n| Condition | Parallel Count |\n|-----------|:--------------:|\n| 1 task | 1 |\n| All tasks edit same file | 1 |\n| 2-3 independent tasks | 2-3 |\n| 4+ independent tasks | 3 (max) |\n\n---\n\n## Options\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--ci` | CI-only non-interactive mode | false |\n| `--parallel N` | Force parallel count | auto |\n| `--sequential` | Force no parallel | - |\n| `--isolation` | lock / worktree | worktree |\n| `--max-iterations` | Review fix loop limit | 3 |\n| `--skip-review` | Skip review phase | false |\n| `--no-commit` | Skip auto-commit (manual commit) | false |\n| `--resume <id|latest>` | Resume session | - |\n| `--fork <id|current>` | Fork session | - |\n| `--reason \"<text>\"` | Fork reason (with --fork) | - |\n\n### --ci Mode\n\nCI-only non-interactive execution:\n- AskUserQuestion: do not use\n- WebSearch: do not use\n- Confirmation prompts: do not wait\n- Continue to completion automatically\n\n### --isolation Option\n\n| Value | Behavior | Recommended |\n|-------|----------|-------------|\n| `lock` | Same worktree + file lock | Small-medium tasks |\n| `worktree` | git worktree isolation + pnpm space saving | Large tasks, true parallel builds |\n\n### Session Resume/Fork\n\n**セッション一覧の確認**:\n```bash\n# CLI: アーカイブディレクトリを確認\nls -la .claude/state/sessions/\n\n# UI: harness-ui のWorkページでセッション一覧を確認\n# → Session Archives テーブルから resume/fork コマンドをコピー可能\n```\n\n**再開/分岐コマンド**:\n```bash\n# Resume latest stopped session\n/work --resume latest\n\n# Resume specific session ID\n/work --resume session-1700000000\n\n# Fork from current session\n/work --fork current --reason \"Proceed with trial version separately\"\n\n# Fork from specific session\n/work --fork session-1700000000 --reason \"Try different approach\"\n```\n\n**Check session state**:\n```bash\n# Current session state\ncat .claude/state/session.json | jq '.state, .session_id'\n\n# Event history\ntail -20 .claude/state/session.events.jsonl\n```\n\n### Default Flow\n\n**Review→Fix ループは Solo/2-Agent 共通**。Handoff は 2-Agent モードのみ実行。\n\n```\n/work --parallel 3\n    ↓\n┌─────────────────────────────────────────────────────────┐\n│ Phase 1: Parallel Implementation                        │\n├─────────────────────────────────────────────────────────┤\n│  [task-worker A] Implement → Related-check              │\n│  [task-worker B] Implement → Related-check              │\n│  [task-worker C] Implement → Related-check              │\n│                                                         │\n│  ※Related-check: Verify no missed file updates         │\n│  Each worker completes implementation                   │\n└─────────────────────────────────────────────────────────┘\n    ↓ Wait for all implementations complete\n┌─────────────────────────────────────────────────────────┐\n│ Phase 2: Review Loop (harness-review)  [Solo/2-Agent]   │\n├─────────────────────────────────────────────────────────┤\n│  Execute harness-review (context-aware)                 │\n│    ├── Codex available: 4-parallel expert review       │\n│    └── Otherwise: standard review                       │\n│                                                         │\n│  ※NG (Critical/High issues) → Fix → Re-review          │\n│  ※Loop continues until OK (max --max-iterations)       │\n└─────────────────────────────────────────────────────────┘\n    ↓ Review OK (APPROVE: no Critical/High issues)\n┌─────────────────────────────────────────────────────────┐\n│ Phase 3: Auto-commit (default)         [Solo/2-Agent]   │\n├─────────────────────────────────────────────────────────┤\n│  ✅ All tasks implemented and reviewed                  │\n│  📝 Auto-commit with generated message                  │\n│                                                         │\n│  Skip with: --no-commit or config auto_commit: false    │\n│                                                         │\n│  ⏸️ commit_on_pm_approve: true (2-Agent only):           │\n│    → Skip commit, mark as \"pending_pm_approval\"         │\n│    → Handoff includes commit instruction for PM         │\n└─────────────────────────────────────────────────────────┘\n    ↓ Commit complete (or skipped / deferred)\n┌─────────────────────────────────────────────────────────┐\n│ Phase 4: Handoff (2-Agent only)                         │\n├─────────────────────────────────────────────────────────┤\n│  2-Agent mode (pm:requested detected):                  │\n│    → Execute `/handoff-to-opencode` to report to PM     │\n│    → If commit_on_pm_approve: include commit-pending    │\n│      flag in handoff report                             │\n│                                                         │\n│  Solo mode:                                             │\n│    → Skip (no handoff needed)                           │\n└─────────────────────────────────────────────────────────┘\n```\n\n### Escalation\n\nWhen task-worker can't resolve after 3 fixes, aggregate to parent and bulk confirm with user.\n\n```\n⚠️ Escalation (2 items)\n\nTask A: Cannot convert type 'unknown' to 'User'\n  → Suggestion: Check User type definition or add type guard\n\nTask B: Test 'should validate email' failing\n  → Suggestion: Fix regex pattern\n\nHow to proceed?\n1. Apply suggestions and continue\n2. Skip and move on\n3. Fix manually\n```\n\n---\n\n## 📐 Detailed Implementation\n\n### Phase 1: Dependency Graph Construction and Parallel Launch\n\n**Dependency graph construction logic**:\n\n```\nParse tasks from Plans.md:\n    ↓\n1. Extract target files per task\n    ↓\n2. Determine file dependencies\n   ├── Same file edits → sequential\n   ├── Has import dependency → sequential\n   └── Independent → parallelizable\n    ↓\n3. Build dependency graph\n    ↓\n4. Determine parallel execution groups\n```\n\n**Judgment rules**:\n\n| Condition | Judgment | Processing |\n|-----------|----------|------------|\n| Multiple tasks edit same file | Conflict | Sequential |\n| Task A's output is Task B's input | Dependency | Execute A→B in order |\n| Mutually independent | Parallelizable | Same group |\n\n**task-worker launch**:\n\n```\nFor each parallel group:\n    ↓\nLaunch task-worker with Task tool:\n  - subagent_type: \"task-worker\"\n  - run_in_background: true\n  - prompt: {\n      task: \"task description\",\n      files: [\"target files\"],\n      max_iterations: 3,\n      review_depth: \"standard\"\n    }\n    ↓\nCollect launched task IDs\n```\n\n**Result collection**:\n\n```\nWait for all task-worker completion:\n    ↓\nCollect results with TaskOutput:\n  - status: commit_ready | needs_escalation | failed\n  - changes: [{file, action}]\n  - self_review: {quality, security, performance, compatibility}\n    ↓\nIf needs_escalation, aggregate → bulk confirm with user\n```\n\n**Progress display**:\n\n```\n📊 Phase 1 Progress: 2/5 complete\n\n├── [worker-1] Header.tsx ✅ commit_ready (35s)\n├── [worker-2] Footer.tsx ✅ commit_ready (28s)\n├── [worker-3] Sidebar.tsx ⏳ Self-reviewing...\n├── [worker-4] Utils.ts ⏳ Implementing...\n└── [worker-5] Types.ts 🔜 Waiting (depends: Utils.ts)\n```\n\n### Phase 2: Cross-review Execution\n\n**Prerequisites**:\n- All Phase 1 tasks returned `commit_ready`\n- `--skip-cross-review` not specified\n\n**Execution flow**:\n\n```\nPhase 1 completion:\n    ↓\nExecute harness-review (context-aware):\n  - Check .claude-code-harness.config.yaml\n  - review.mode=codex AND review.codex.enabled=true → Codex mode\n  - Otherwise → standard harness-review\n    ↓\nCodex mode:\n  - Codex 4-parallel expert review (per review type)\n  - Simultaneous review from 4 expert perspectives\n    ↓\nStandard review mode:\n  - Execute harness-review skill\n  - Check security/performance/quality/accessibility\n    ↓\nReview judgment:\n  - Critical/High issues → Fix implementation → Re-review (loop)\n  - OK (no Critical/High) → Complete\n    ↓\nLoop until OK or max iterations reached\n```\n\n**Review perspectives in Codex mode (4 parallel per review type)**:\n\n| Review Type | Experts |\n|-------------|---------|\n| **Code Review** | Security, Performance, Quality, Accessibility |\n| **Plan Review** | Clarity, Feasibility, Dependencies, Acceptance |\n| **Scope Review** | Scope-creep, Priority, Feasibility, Impact |\n\n### Phase 3: Auto-commit\n\n**Review OK判定**:\n\n```\nharness-review result:\n    ↓\nAPPROVE (no Critical/High issues):\n  → Auto-commit (unless --no-commit or config auto_commit: false)\n    ↓\nREQUEST_CHANGES (has Critical/High issues):\n  → Fix issues → Re-run review (loop)\n    ↓\nMax iterations reached:\n  → Report remaining issues → Request manual intervention\n```\n\n**Auto-commit behavior**:\n\n```\nCheck auto-commit setting:\n  1. --no-commit flag → Skip commit\n  2. .claude-code-harness.config.yaml work.auto_commit: false → Skip commit\n  3. .claude-code-harness.config.yaml work.commit_on_pm_approve: true\n     AND 2-Agent mode → Defer commit (pending PM approval)\n  4. Otherwise → Auto-commit with generated message\n```\n\n**commit_on_pm_approve モード** (2-Agent 専用):\n\n```\ncommit_on_pm_approve: true AND 2-Agent mode:\n    ↓\nSkip commit → Record pending state\n    ↓\nHandoff to PM with commit-pending flag:\n  \"変更はレビュー済みですが、未コミットです。\n   approve 時にコミット指示を含めてください。\"\n    ↓\nPM approves → Handoff includes commit instruction\n    ↓\nNext /work invocation: Detect \"approved + commit pending\"\n    → Execute commit before starting new tasks\n```\n\n> **Solo モードでは無視**: `commit_on_pm_approve` は 2-Agent モードでのみ有効。Solo モードでは通常の `auto_commit` 設定に従う。\n\n**Completion report (with auto-commit)**:\n\n```\n✅ /work Complete\n\n| Item | Status |\n|------|--------|\n| Tasks | 5/5 implemented |\n| Review | APPROVE |\n| Iterations | 2 |\n| Commit | abc1234 |\n\nChanged files:\n- src/components/Header.tsx (new)\n- src/components/Footer.tsx (new)\n- src/components/Sidebar.tsx (new)\n\nCommitted: feat: add Header, Footer, Sidebar components\n```\n\n**Completion report (with --no-commit)**:\n\n```\n✅ /work Complete\n\n| Item | Status |\n|------|--------|\n| Tasks | 5/5 implemented |\n| Review | APPROVE |\n| Iterations | 2 |\n| Commit | Skipped (--no-commit) |\n\nChanged files:\n- src/components/Header.tsx (new)\n- src/components/Footer.tsx (new)\n- src/components/Sidebar.tsx (new)\n\nNext steps:\n1. Review changes: git diff\n2. Commit when ready: git add . && git commit\n```\n\n**Completion report (with commit_on_pm_approve, 2-Agent)**:\n\n```\n✅ /work Complete (commit pending PM approval)\n\n| Item | Status |\n|------|--------|\n| Tasks | 5/5 implemented |\n| Review | APPROVE |\n| Iterations | 2 |\n| Commit | ⏸️ Pending PM approval |\n\nChanged files:\n- src/components/Header.tsx (new)\n- src/components/Footer.tsx (new)\n- src/components/Sidebar.tsx (new)\n\n## Commit Status: Pending PM Approval\n\n変更はハーネスレビュー済みですが、コミットを保留しています。\nPM が approve した場合、次回 /work 実行時にコミットされます。\n```\n\n### Phase 4: Handoff (2-Agent only)\n\n**Review OK 判定条件** (Solo/2-Agent 共通):\n\n| 判定 | 条件 | アクション |\n|------|------|-----------|\n| APPROVE | Critical/High の指摘なし | → Phase 3 (commit) → Phase 4 (handoff) |\n| REQUEST_CHANGES | Critical/High の指摘あり | → Fix → Re-review (loop) |\n\n**Handoff 実行条件**:\n\n```\nPhase 3 (Auto-commit) 完了後:\n    ↓\n2-Agent mode (pm:requested / cursor:requested detected)?\n  YES → Execute `/handoff-to-opencode` (completion report to PM)\n        → If commit_on_pm_approve: add commit-pending section\n  NO  → Solo mode: Skip handoff (workflow complete)\n```\n\n**順序（通常モード）**: Review OK → Auto-commit → Handoff\n\n> ⚠️ **重要**: 通常モードでは Handoff は必ず auto-commit の後に実行する。commit 前に handoff すると、PM がレビューする変更が未コミットになり不整合が生じる。\n\n**順序（commit_on_pm_approve モード）**: Review OK → Skip commit → Handoff (with commit-pending)\n\n> `commit_on_pm_approve: true` の場合、意図的にコミットを保留して Handoff する。PM が approve した後の次回 `/work` 実行時にコミットが実行される。\n\n**Handoff レポートの commit-pending セクション**:\n\n```\n## Commit Status: Pending PM Approval\n\n変更はハーネスレビュー済みですが、`commit_on_pm_approve` 設定により\nコミットを保留しています。\n\napprove の場合: ハンドオフに以下を含めてください:\n  「前回の変更を承認します。コミットしてから次のタスクに進んでください。」\n\nrequest_changes の場合: 通常通り修正指示を記載してください。\n```\n\n---\n\n## ⚡ Parallel Execution First\n\nThis command **actively utilizes parallel execution**.\n\n### Basic Policy\n\n```\n2+ independent tasks → Parallel execution (default)\nHas dependencies → Sequential execution\n```\n\n### Parallel Execution Criteria\n\n| Condition | Judgment | Example |\n|-----------|----------|---------|\n| Edit different files | ✅ Parallel | Header.tsx and Footer.tsx |\n| Edit same file | ⚠️ Sequential | Append to same index.tsx |\n| A's output is B's input | ⚠️ Sequential | Create API → Page using it |\n| Independent checks | ✅ Parallel | lint, test, type-check |\n\n### Execution Image\n\n```\n📋 Detected 5 tasks from Plans.md\n\nDependency analysis:\n├── [Independent] Create Header\n├── [Independent] Create Footer\n├── [Independent] Create Sidebar\n├── [Dependent] Create Layout ← Depends on Header, Footer, Sidebar\n└── [Dependent] Create Page ← Depends on Layout\n\nExecution plan:\n🚀 Parallel group 1: Header, Footer, Sidebar (simultaneous)\n   ↓\n🔧 Sequential: Create Layout\n   ↓\n🔧 Sequential: Create Page\n\nEstimated time: Sequential 5min → With parallel 2min30s (50% reduction)\n```\n\n---\n\n## Auto-judgment Logic\n\nCheck Plans.md markers and operate in appropriate mode:\n\n| Detected Marker | Operation Mode |\n|-----------------|----------------|\n| `pm:requested` / `cursor:requested` exists | 2-Agent (prioritize PM's request) |\n| `cc:TODO` / `cc:WIP` only | Solo (autonomous) |\n\n**Priority**: `pm:requested` > `cc:WIP` (continue) > `cc:TODO` (new)\n\n### Pre-task: Pending Commit Check (commit_on_pm_approve)\n\n`/work` 起動時、前回の保留コミットがあるか確認する:\n\n```\n/work start:\n    ↓\nCheck: PM approved + commit pending?\n  (Handoff message contains \"承認\" + uncommitted changes exist)\n    ↓\nYES → Execute pending commit first\n    → Then proceed to next task\n    ↓\nNO  → Proceed normally\n```\n\n> この処理により、PM 承認 → コミット → 次タスク実装 の流れが自然に繋がる。\n\n### Auto-update Markers on Task Start\n\n`/work` automatically transitions to **`cc:WIP`** on start:\n\n```\npm:requested / cursor:requested / cc:TODO → cc:WIP (auto-update on start)\n```\n\nThis integrates the \"start task → update marker\" functionality directly into `/work`.\n\n---\n\n## 🔧 Auto-invoke Skills (Required)\n\n**This command must explicitly invoke the following skills with the Skill tool**:\n\n| Skill | Purpose | When to Call |\n|-------|---------|--------------|\n| `impl` | Feature implementation (parent skill) | On task implementation |\n| `verify` | Build verification & error recovery (parent skill) | On post-implementation verification |\n\n**How to call**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:impl\"      # Feature implementation\n  skill: \"claude-code-harness:verify\"    # Build verification\n```\n\n**Child skills (auto-routing)**:\n- `work-impl-feature` - Feature implementation\n- `work-write-tests` - Test creation\n- `verify-related-files` - Related files check (prevents missed updates)\n- `verify-build` - Build verification\n- `error-recovery` - Error recovery\n\n> ⚠️ **Important**: Proceeding without calling skills won't record in usage statistics. Always call with Skill tool.\n\n---\n\n## 🔧 LSP Feature Utilization\n\nImplementation work actively utilizes LSP (Language Server Protocol).\n\n### Before Implementation: Code Understanding\n\n| LSP Feature | Use Case | Effect |\n|-------------|----------|--------|\n| **Go-to-definition** | Check existing function internals | Quickly grasp implementation patterns |\n| **Find-references** | Pre-survey impact scope | Prevent unintended breaking changes |\n| **Hover** | Check type info & docs | Implement with correct interfaces |\n\n### During Implementation: Real-time Verification\n\n| LSP Feature | Use Case | Effect |\n|-------------|----------|--------|\n| **Diagnostics** | Instant type/syntax error detection | Find issues before build |\n| **Completions** | Correct API usage | Prevent typos & wrong arguments |\n\n### After Implementation: Quality Check\n\n```\nRun LSP Diagnostics after implementation:\n→ Verify no type errors\n→ Detect unused variables & imports\n→ Early detection of potential issues\n```\n\n### After Implementation: Related Files Check\n\n```\nRun related files verification:\n→ Detect function signature changes → check callers\n→ Detect interface/type changes → check implementations\n→ Detect export changes → check importers\n→ Detect config changes → check related configs\n```\n\n**Example output**:\n```\n📋 Related Files Verification\n\n⚠️ Files to check:\n├─ src/api/auth.ts:45 (calls modified function)\n├─ tests/user.test.ts:28 (test for modified code)\n└─ docs/api.md (documentation may need update)\n\n1. Confirmed, proceed\n2. Check each file\n3. Show LSP find-references\n```\n\n### VibeCoder Phrases\n\n| What You Want | How to Say |\n|---------------|------------|\n| Know function internals | \"Show this function's definition\" |\n| Check where it's used | \"Find references to this variable\" |\n| Run error check | \"Run LSP diagnostics\" |\n\nDetails: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n\n---\n\n## Execution Flow\n\n### Step 1: Check Plans.md and Parallelization Analysis\n\n```bash\ncat Plans.md\n```\n\nExtract current `cc:TODO` tasks and **analyze parallelization possibility**.\n\n### Step 2: Present Execution Plan\n\n> 🔧 **Execution Plan**\n>\n> **Parallel Execution Group**:\n> | Task | Target File | Estimated Time |\n> |------|-------------|----------------|\n> | Create Header | src/components/Header.tsx | ~30s |\n> | Create Footer | src/components/Footer.tsx | ~30s |\n> | Create Sidebar | src/components/Sidebar.tsx | ~30s |\n>\n> **Sequential Execution (has dependencies)**:\n> | Task | Depends On | Estimated Time |\n> |------|------------|----------------|\n> | Create Layout | Header, Footer, Sidebar | ~45s |\n>\n> **Total Estimated**: Sequential 2m15s → With parallel 1m15s\n>\n> Execute?\n\n### Step 3: Parallel Execution with Task Tool\n\nUse Claude Code's Task tool to **execute in background in parallel**.\n\n```\n🚀 Starting parallel execution...\n\n├── [Agent 1] Creating Header... ⏳\n├── [Agent 2] Creating Footer... ⏳\n└── [Agent 3] Creating Sidebar... ⏳\n```\n\n**Important**:\n- Launch Task tool with `run_in_background: true`\n- Collect results with `TaskOutput`\n- Up to 10 tasks simultaneously\n\n#### ⚠️ Background Agent Permission Pre-approval (v2.1.20+)\n\nClaude Code v2.1.20 以降、background agent は起動前にツール権限の承認を求めます。\n並列 task-worker が複数起動する際に毎回権限プロンプトが出ると UX が低下するため、\n`.claude/settings.json` の `permissions.allow` で事前承認することを推奨します。\n\n**推奨設定**（プロジェクトの `.claude/settings.json` に手動で追加）:\n\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Read\",\n      \"Write\",\n      \"Edit\",\n      \"Bash(npm run:*)\",\n      \"Bash(pnpm:*)\",\n      \"Bash(git diff:*)\",\n      \"Bash(git status:*)\",\n      \"Grep\",\n      \"Glob\"\n    ]\n  }\n}\n```\n\n> 💡 task-worker は `Read`, `Write`, `Edit`, `Bash`, `Grep`, `Glob` を使用します。\n> これらを事前承認しておくことで、並列起動時の権限プロンプトを回避できます。\n>\n> ⚠️ **セキュリティ注意**: `Read`, `Write`, `Edit` を無条件に許可するとプロンプトインジェクション等のリスクが高まります。\n> 信頼できるプロジェクトでのみ設定し、必要に応じて対象をパス制限（例: `Write(src/*)`）することを検討してください。\n\n### Step 4: Collect Results and Integration Report\n\n```\n📊 Parallel Execution Complete\n\n├── [Agent 1] Create Header ✅ (25s)\n│   └── src/components/Header.tsx created\n├── [Agent 2] Create Footer ✅ (28s)\n│   └── src/components/Footer.tsx created\n└── [Agent 3] Create Sidebar ✅ (22s)\n    └── src/components/Sidebar.tsx created\n\n⏱️ Time: 28s (would be 75s sequential, 63% reduction)\n```\n\n### Step 5: Execute Sequential Tasks\n\nExecute tasks with dependencies in order.\n\n### Step 6: Update Plans.md and Completion Report\n\n```markdown\n# Plans.md Update\n- [x] Create Header `cc:done`\n- [x] Create Footer `cc:done`\n- [x] Create Sidebar `cc:done`\n- [x] Create Layout `cc:done`\n```\n\n---\n\n## Integration Report Format\n\n```markdown\n## 📊 Task Execution Report\n\n**Execution time**: 2025-12-15 10:30:00\n**Task count**: 5 (3 parallel + 2 sequential)\n**Duration**: 1m15s (would be 2m15s sequential, 44% reduction)\n\n### Execution Results\n\n| # | Task | Execution Type | Status | Duration |\n|---|------|----------------|--------|----------|\n| 1 | Create Header | Parallel | ✅ Success | 25s |\n| 2 | Create Footer | Parallel | ✅ Success | 28s |\n| 3 | Create Sidebar | Parallel | ✅ Success | 22s |\n| 4 | Create Layout | Sequential | ✅ Success | 45s |\n| 5 | Create Page | Sequential | ✅ Success | 30s |\n\n### Changed Files\n\n- `src/components/Header.tsx` (new)\n- `src/components/Footer.tsx` (new)\n- `src/components/Sidebar.tsx` (new)\n- `src/components/Layout.tsx` (new)\n- `src/app/page.tsx` (modified)\n\n### Commit (auto-commit enabled)\n\n```\nCommitted: feat: implement Header, Footer, Sidebar, Layout, Page components\n\nHash: abc1234\n```\n\n### Next Actions (if --no-commit)\n\n- [ ] Verify operation (`npm run dev`)\n- [ ] Run tests (`npm test`)\n- [ ] Review changes (`git diff`)\n- [ ] Commit when ready (`git add . && git commit`)\n```\n\n---\n\n## Error Handling\n\n### Partial Failure in Parallel Execution\n\n```\n📊 Parallel Execution Complete (partial error)\n\n├── [Agent 1] Create Header ✅ (25s)\n├── [Agent 2] Create Footer ❌ Error\n│   └── Cause: Import path not found\n└── [Agent 3] Create Sidebar ✅ (22s)\n\n⚠️ 1 task failed.\n\nOptions:\n1. Retry failed task only\n2. Check error details and fix manually\n3. Rollback everything\n```\n\n**Response**:\n1. Keep successful task results\n2. Show failed task error details\n3. Try auto-fix with `error-recovery` skill (max 3 times)\n\n### All Tasks Failed\n\n```\n❌ Parallel Execution Failed\n\nAll tasks encountered errors.\nThere may be a common cause.\n\nError analysis:\n- All tasks have `@/lib/supabase` import error\n- Cause: supabase.ts not created\n\nRecommended action:\n1. Create dependency file first\n2. Review execution order\n```\n\n---\n\n## Execution Pattern Collection\n\n### Pattern 1: Multiple Components (Parallel)\n\n```\nInput: Create Header, Footer, Sidebar\n\n→ All 3 tasks independent → Parallel execution\n→ Launch 3 agents with Task tool\n→ Summarize results in integration report\n```\n\n### Pattern 2: Quality Checks (Parallel)\n\n```\nInput: Run lint, test, type-check\n\n→ All independent → Parallel execution\n→ Results:\n  ├── [Lint] ✅ Warnings: 2\n  ├── [Test] ✅ 15/15 passed\n  └── [Type] ✅ No errors\n```\n\n### Pattern 3: Dependency Chain (Mixed)\n\n```\nInput: Create API → Page → Tests\n\n→ Has dependencies → Sequential execution\n→ But API tests and page tests can be parallelized\n```\n\n---\n\n## VibeCoder Hints\n\n| What You Want | How to Say |\n|---------------|------------|\n| Do all in parallel | \"do everything at once\" \"finish it quickly\" |\n| Know progress | \"how far are we?\" |\n| Verify operation | \"run it\" |\n| Move to next | \"next task\" |\n| Do one at a time | \"one at a time in order\" |\n\n---\n\n## Notes\n\n- **Simultaneous writes to same file are auto-avoided**\n- **Over 10 tasks** are batch-split and executed\n- Long-running tasks can be backgrounded with `Ctrl+B`\n",
        "opencode/commands/handoff/handoff-to-cursor.md": "---\ndescription: Generate completion report for Cursor (PM)\n---\n\n# /handoff-to-cursor - Completion Report (Paste to PM / Compatibility)\n\nThis command generates a **work summary** to paste to PM (Cursor, etc.).\nFor solo 2-Claude operation, the more explicit **`/handoff-to-pm-claude`** is recommended (this command is maintained for compatibility).\n\n## VibeCoder Quick Reference\n\n- \"**Write a completion report for Cursor**\" → Execute this command as is\n- \"**Include changes and test results**\" → Generate with additions based on `git diff` and executed commands\n- \"**Don't know what to write**\" → We'll ask for necessary items (what you did / what changed / how you verified)\n\n## Deliverables\n\n- Summarize \"overview / changed files / verification / risks / next actions\" in one document **in a format that conveys to PM**\n- Organize so it doesn't contradict `cc:done` in Plans.md\n\n## Steps\n\n1. Understand changes (if possible, use `git status -sb` / `git diff --name-only`)\n2. Verify target tasks in Plans.md are marked `cc:done`\n3. Create report in the format below\n\n## Output Format (Paste directly to Cursor)\n\n```markdown\n## Completion Report\n\n### Overview\n- (What was done, 1-3 lines)\n\n### Changed Files\n- (File list)\n\n### Verification / Tests\n- (Verification performed, recommended commands)\n\n### Risks / Notes\n- (If any)\n\n### Next Action Suggestions\n- (1-3 options for PM to choose from)\n```\n",
        "opencode/commands/handoff/handoff-to-opencode.md": "---\ndescription: Generate completion report for OpenCode (PM)\n---\n\n# /handoff-to-opencode - Completion Report (Paste to OpenCode PM)\n\nThis command generates a **work summary** to paste to OpenCode PM.\nFor Cursor PM, use **`/handoff-to-cursor`** instead.\n\n## VibeCoder Quick Reference\n\n- \"**Write a completion report for OpenCode**\" → Execute this command\n- \"**OpenCode PM に報告**\" → このコマンドを実行\n- \"**PM に完了報告**\" → このコマンドを実行\n\n## Deliverables\n\n- Summarize \"overview / changed files / verification / risks / next actions\" in one document **in a format that conveys to PM**\n- Organize so it doesn't contradict `cc:done` in Plans.md\n\n## Steps\n\n1. Understand changes (if possible, use `git status -sb` / `git diff --name-only`)\n2. Verify target tasks in Plans.md are marked `cc:done`\n3. Create report in the format below\n\n## Output Format (Paste directly to OpenCode)\n\n```markdown\n## Completion Report\n\n### Overview\n- (What was done, 1-3 lines)\n\n### Changed Files\n- (File list)\n\n### Verification / Tests\n- (Verification performed, recommended commands)\n\n### Risks / Notes\n- (If any)\n\n### Next Action Suggestions\n- (1-3 options for PM to choose from)\n```\n",
        "opencode/commands/optional/ci-setup.md": "---\ndescription: \"[Optional] Set up CI/CD (GitHub Actions)\"\n---\n\n# /ci-setup - CI/CD Setup (GitHub Actions)\n\nAutomatically builds a CI/CD pipeline using GitHub Actions.\n\n## VibeCoder Quick Reference\n\n- \"**Add CI**\" → this command\n- \"**Make tests run on PR**\" → Sets up checks on PR/Push\n- \"**Don't know what to run**\" → Analyzes project and suggests lint/typecheck/test/build\n\n## Deliverables\n\n- Add `.github/workflows/*` to auto-run lint/typecheck/test/build\n- Provides failure cause analysis and fix suggestions (safety first)\n\n**Features**:\n- ✅ Lint (ESLint, Prettier)\n- ✅ Type Check (TypeScript)\n- ✅ Unit Test (Jest, Vitest)\n- ✅ E2E Test (Playwright)\n- ✅ Build Check\n\n---\n\n## 🔧 Auto-invoke Skills (Required)\n\n**This command must explicitly invoke the following skills with the Skill tool**:\n\n| Skill | Purpose | When to Call |\n|-------|---------|--------------|\n| `ci` | CI/CD (parent skill) | CI build/troubleshooting |\n\n**How to call**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:ci\"\n```\n\n**Child skills (auto-routing)**:\n- `generate-workflow-files` - Workflow file generation\n- `ci-analyze-failures` - CI failure analysis\n- `ci-fix-failing-tests` - Test fix\n\n> ⚠️ **Important**: Proceeding without calling skills won't record in usage statistics. Always call with Skill tool.\n\n---\n\n## 🔧 Type Check/Lint Integration\n\nIntegrates type checking and lint during CI/CD setup for more robust pipelines.\n\n### Integrating Type Check/Lint into CI\n\nRun type checking and lint in GitHub Actions to maintain code quality:\n\n```yaml\n  type-check-and-lint:\n    name: Type Check & Lint\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run type check\n        run: npm run type-check  # or tsc --noEmit\n\n      - name: Run lint\n        run: npm run lint\n```\n\n### CI Failure Debugging Flow\n\nWhen CI fails, use LSP tools locally to identify issues:\n\n```\nCI failure debugging flow:\n\n1. Check error logs\n2. Analyze issues locally using LSP tools (definition, references, diagnostics)\n3. Track problem source with Go-to-definition\n4. Verify impact scope with Find-references\n5. Re-validate with type-check/lint after fix\n```\n\n### VibeCoder Phrases\n\n| What You Want | How to Say |\n|---------------|------------|\n| Investigate CI error cause | \"Investigate this error with LSP definition/references\" |\n| Check type errors before push | \"Run type-check before push\" |\n\nDetails: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md) or run `/lsp-setup` command.\n\n---\n\n## Usage\n\n```\n/ci-setup\n```\n\n→ Generates `.github/workflows/ci.yml`\n\n---\n\n## Execution Flow\n\n### Step 1: Confirm Project Type\n\n> 🎯 **Tell us your project type:**\n>\n> 1. Next.js (App Router)\n> 2. Next.js (Pages Router)\n> 3. React (Vite)\n> 4. Other\n>\n> Answer with a number (default: 1)\n\n**Wait for response**\n\n### Step 2: Confirm Test Framework\n\n> 🧪 **Tell us your test framework:**\n>\n> 1. Jest\n> 2. Vitest\n> 3. Both\n> 4. None\n>\n> Answer with a number (default: 2)\n\n**Wait for response**\n\n### Step 3: Confirm E2E Testing\n\n> 🎭 **Run E2E tests?**\n>\n> 1. Yes (Playwright)\n> 2. No\n>\n> Answer with a number (default: 1)\n\n**Wait for response**\n\n### Step 4: Generate GitHub Actions Workflow\n\nGenerate the following files:\n\n#### `.github/workflows/ci.yml`\n\n```yaml\nname: CI\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main, develop]\n\njobs:\n  lint:\n    name: Lint\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run ESLint\n        run: npm run lint\n\n      - name: Run Prettier\n        run: npm run format:check\n\n  typecheck:\n    name: Type Check\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run TypeScript compiler\n        run: npm run typecheck\n\n  test:\n    name: Unit Tests\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run tests\n        run: npm test -- --coverage\n\n      - name: Upload coverage to Codecov\n        uses: codecov/codecov-action@v4\n        with:\n          token: ${{ secrets.CODECOV_TOKEN }}\n          files: ./coverage/coverage-final.json\n          fail_ci_if_error: false\n\n  e2e:\n    name: E2E Tests\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Install Playwright browsers\n        run: npx playwright install --with-deps\n\n      - name: Build application\n        run: npm run build\n\n      - name: Run E2E tests\n        run: npm run test:e2e\n\n      - name: Upload test results\n        if: always()\n        uses: actions/upload-artifact@v4\n        with:\n          name: playwright-report\n          path: playwright-report/\n          retention-days: 30\n\n  build:\n    name: Build Check\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Build application\n        run: npm run build\n\n      - name: Check build output\n        run: |\n          if [ ! -d \".next\" ]; then\n            echo \"Build output not found\"\n            exit 1\n          fi\n```\n\n### Step 5: Add package.json Scripts\n\nAdd the following scripts to `package.json` (if not present):\n\n```json\n{\n  \"scripts\": {\n    \"lint\": \"next lint\",\n    \"format:check\": \"prettier --check .\",\n    \"format\": \"prettier --write .\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"test\": \"vitest\",\n    \"test:e2e\": \"playwright test\"\n  }\n}\n```\n\n### Step 6: Check Config Files\n\nSuggest generating missing config files if needed:\n\n#### `.eslintrc.json`\n\n```json\n{\n  \"extends\": [\"next/core-web-vitals\", \"prettier\"],\n  \"rules\": {\n    \"no-console\": [\"warn\", { \"allow\": [\"warn\", \"error\"] }],\n    \"@typescript-eslint/no-unused-vars\": [\"error\", { \"argsIgnorePattern\": \"^_\" }]\n  }\n}\n```\n\n#### `.prettierrc`\n\n```json\n{\n  \"semi\": false,\n  \"singleQuote\": true,\n  \"trailingComma\": \"es5\",\n  \"tabWidth\": 2,\n  \"printWidth\": 100\n}\n```\n\n#### `tsconfig.json`\n\n```json\n{\n  \"compilerOptions\": {\n    \"target\": \"ES2020\",\n    \"lib\": [\"ES2020\", \"DOM\", \"DOM.Iterable\"],\n    \"jsx\": \"preserve\",\n    \"module\": \"ESNext\",\n    \"moduleResolution\": \"bundler\",\n    \"resolveJsonModule\": true,\n    \"allowJs\": true,\n    \"strict\": true,\n    \"noEmit\": true,\n    \"esModuleInterop\": true,\n    \"skipLibCheck\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"incremental\": true,\n    \"paths\": {\n      \"@/*\": [\"./*\"]\n    }\n  },\n  \"include\": [\"next-env.d.ts\", \"**/*.ts\", \"**/*.tsx\"],\n  \"exclude\": [\"node_modules\"]\n}\n```\n\n### Step 7: Guide Next Actions\n\n> ✅ **CI/CD pipeline complete!**\n>\n> 📄 **Generated files**:\n> - `.github/workflows/ci.yml` - GitHub Actions workflow\n> - `.eslintrc.json` - ESLint config (if needed)\n> - `.prettierrc` - Prettier config (if needed)\n> - `tsconfig.json` - TypeScript config (if needed)\n>\n> **Next steps:**\n> 1. Push to GitHub: `git add . && git commit -m \"Add CI/CD\" && git push`\n> 2. Check execution status in GitHub Actions tab\n> 3. (Optional) Set Codecov token: Settings > Secrets > CODECOV_TOKEN\n>\n> 💡 **Hint**: CI will automatically run when you create a Pull Request.\n\n---\n\n## Customization Examples\n\n### 1. Run Only on Specific Branches\n\n```yaml\non:\n  push:\n    branches: [main]  # main branch only\n```\n\n### 2. Run Only on Specific File Changes\n\n```yaml\non:\n  push:\n    paths:\n      - 'src/**'\n      - 'app/**'\n      - 'package.json'\n```\n\n### 3. Scheduled Execution\n\n```yaml\non:\n  schedule:\n    - cron: '0 0 * * *'  # Run daily at midnight\n```\n\n### 4. Disable Parallel Execution\n\n```yaml\njobs:\n  test:\n    needs: [lint, typecheck]  # Run after lint, typecheck succeed\n```\n\n---\n\n## Troubleshooting\n\n### Error: `npm ci` fails\n\n**Cause**: `package-lock.json` is outdated\n\n**Solution**:\n```bash\nnpm install\ngit add package-lock.json\ngit commit -m \"Update package-lock.json\"\ngit push\n```\n\n### Error: Playwright installation fails\n\n**Cause**: Browser installation failed\n\n**Solution**: Add the following to workflow\n```yaml\n- name: Install Playwright browsers\n  run: npx playwright install --with-deps chromium\n```\n\n### Error: Build fails\n\n**Cause**: Environment variables not set\n\n**Solution**: Add environment variables to GitHub Secrets\n```yaml\n- name: Build application\n  run: npm run build\n  env:\n    NEXT_PUBLIC_API_URL: ${{ secrets.NEXT_PUBLIC_API_URL }}\n```\n\n---\n\n## Notes\n\n- **First run**: First run executes all jobs, so it takes time (5-10 minutes)\n- **Parallel execution**: Multiple jobs run in parallel for efficiency\n- **Caching**: `node_modules` is cached, so subsequent runs are faster\n- **Free tier**: GitHub Actions is free for public repos, 2000 minutes/month for private repos\n\n**This CI pipeline helps maintain high-quality code.**\n\n---\n\n## ⚠️ Development vs Repository Decision\n\n**Confirm before committing generated files:**\n\n| Question | Yes → | No → |\n|----------|-------|------|\n| Does this affect project functionality/quality? | Commit to repo | Development only (.gitignore) |\n| Needed by end users or other developers? | Commit to repo | Development only (.gitignore) |\n\n**Example: When developing plugins**\n\nWhen adding CI to the plugin repository itself:\n- ✅ **Repository**: `validate-plugin.yml` (needed for plugin validation)\n- ❌ **Development only**: ShellCheck or Markdown lint that don't affect the plugin itself\n\nAdd development files to `.gitignore` before committing.\n",
        "opencode/commands/optional/codex-mode.md": "---\ndescription: Toggle Codex mode on/off for reviews\n---\n\n# /codex-mode - Toggle Codex Mode\n\nToggles Codex mode (parallel delegation to GPT experts) during reviews.\n\n## Usage\n\n```bash\n/codex-mode           # Show current state\n/codex-mode on        # Enable Codex mode\n/codex-mode off       # Disable Codex mode\n/codex-mode status    # Show detailed settings\n```\n\n## Prerequisites\n\n- Codex MCP server is configured\n- Setup completed with `/codex-review` or `/harness-review`\n\n## What is Codex Mode\n\n| Mode | Reviewer | Characteristics |\n|------|----------|-----------------|\n| **Default** | Claude alone | Fast, no Codex required |\n| **Codex mode** | Codex (GPT) | Parallel delegation to 9 experts |\n\n### Codex Mode's 9 Experts\n\n| Expert | Role | Perspective |\n|--------|------|-------------|\n| Security | Security analysis | OWASP Top 10, authentication/authorization |\n| Accessibility | a11y check | WCAG 2.1 AA compliance |\n| Performance | Performance analysis | Rendering, DB queries |\n| Quality | Code quality | Readability, maintainability |\n| SEO | SEO/OGP check | Meta tags, structured data |\n| Architect | Design review | Architectural decisions |\n| Plan Reviewer | Plan verification | Completeness, risk analysis |\n| Scope Analyst | Requirements analysis | Ambiguity, gap detection |\n\n## Execution Flow\n\n### 1. Show State (`/codex-mode`)\n\n```markdown\n## Codex Mode Settings\n\nCurrent: **OFF** (default mode)\n\nReviewer: Claude alone\nCodex MCP: ✅ Configured\n\nToggle: `/codex-mode on` to enable\n```\n\n### 2. Enable (`/codex-mode on`)\n\n```markdown\n## Codex Mode: ON\n\n✅ Codex mode enabled\n\nActive experts:\n- ✅ Security\n- ✅ Accessibility\n- ✅ Performance\n- ✅ Quality\n- ✅ SEO\n- ✅ Architect\n- ✅ Plan Reviewer\n- ✅ Scope Analyst\n\nNext `/harness-review` will delegate to Codex in parallel.\n```\n\n### 3. Disable (`/codex-mode off`)\n\n```markdown\n## Codex Mode: OFF\n\n✅ Returned to default mode\n\nNext `/harness-review` will run with Claude alone.\n```\n\n### 4. Show Details (`/codex-mode status`)\n\n```markdown\n## Codex Mode Detailed Settings\n\n| Setting | Current Value |\n|---------|---------------|\n| Mode | codex |\n| Judgment output | enabled |\n| Auto-fix | enabled |\n| Max retries | 3 |\n\n### Expert Settings\n\n| Expert | State |\n|--------|-------|\n| security | ✅ ON |\n| accessibility | ✅ ON |\n| performance | ✅ ON |\n| quality | ✅ ON |\n| seo | ✅ ON |\n| architect | ✅ ON |\n| plan_reviewer | ✅ ON |\n| scope_analyst | ✅ ON |\n\n### Individual Toggle\n\n```bash\n/codex-mode experts security off   # Disable Security only\n/codex-mode experts architect on   # Enable Architect only\n```\n```\n\n## Config File Update\n\nThis command updates `.claude-code-harness.config.yaml`.\n\n```yaml\nreview:\n  mode: codex  # default | codex\n  judgment:\n    enabled: true\n    auto_fix: true\n    max_retries: 3\n  codex:\n    enabled: true\n    auto: true\n    experts:\n      security: true\n      accessibility: true\n      performance: true\n      quality: true\n      seo: true\n      architect: true\n      plan_reviewer: true\n      scope_analyst: true\n```\n\n## Individual Expert Settings\n\nYou can enable/disable specific experts only.\n\n```bash\n# Disable Security only (keep others)\n/codex-mode experts security off\n\n# Enable only Architect and Plan Reviewer\n/codex-mode experts architect on\n/codex-mode experts plan_reviewer on\n```\n\n## VibeCoder Phrases\n\n| What You Want | How to Say |\n|---------------|------------|\n| Want to use Codex | \"Switch to Codex mode\" |\n| Return to normal | \"Return to default\" |\n| Check settings | \"Show Codex settings\" |\n| Disable security only | \"I don't need the security check\" |\n\n## Related Commands\n\n- `/harness-review` - Run review (Codex mode supported)\n- `/codex-review` - Codex MCP setup\n",
        "opencode/commands/optional/codex-review.md": "---\ndescription: Second-opinion code review using Codex MCP\n---\n\n# /codex-review - Codex Second Opinion Review\n\nGet a second opinion code review using OpenAI Codex.\n\n---\n\n## 🎯 Quick Reference\n\n- \"`/codex-review`\" → Request review from Codex\n- \"Have Codex take a look too\" → this command\n- \"Want another AI's opinion\" → this command\n\n---\n\n## Deliverables\n\n- Get a second opinion from Codex in addition to Claude's review\n- Leverage different AI models' strengths (logical reasoning vs implementation pattern knowledge)\n- Display integrated review results\n\n---\n\n## 🔧 Auto-invoke Skills (Required)\n\n**This command must explicitly invoke the following skills with the Skill tool**:\n\n| Skill | Purpose | When to Call |\n|-------|---------|--------------|\n| `codex-review` | Codex integration (parent skill) | At command start |\n\n**How to call**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:codex-review\"\n```\n\n---\n\n## Prerequisites\n\n### 1. Codex CLI is Installed\n\n```bash\nwhich codex  # Path should be displayed\n```\n\n### 2. Logged into Codex\n\n```bash\ncodex login status  # Should be authenticated\n```\n\n### 3. Registered as MCP Server\n\n```bash\nclaude mcp list  # codex should be displayed\n```\n\n**If not configured**:\n```bash\nclaude mcp add --scope user codex -- codex mcp-server\n```\n\n---\n\n## Execution Flow\n\n### Step 0: Check Remaining Context\n\nBefore Codex review, **run /compact first if remaining context is 30% or less**.\n\n> **Note**: Continue with Codex review even if space is still tight after /compact.\n\n### Step 1: Check Codex Environment & Version\n\n```bash\n# Check if Codex is available\nwhich codex && codex login status\n\n# Check version\ncodex --version\nnpm show @openai/codex version  # Latest version\n```\n\n**If not configured**:\n```markdown\n⚠️ Codex is not configured\n\nSetup instructions:\n1. Install Codex CLI\n2. Authenticate with `codex login`\n3. Register with `claude mcp add --scope user codex -- codex mcp-server`\n\nDetails: `skills/codex-review/references/codex-mcp-setup.md`\n```\n\n**If version is outdated**:\n```markdown\n⚠️ Codex CLI is outdated\n\nInstalled: X.X.X\nLatest version: Y.Y.Y\n\nUpdate? (y/n)\n\n→ If approved:\nnpm update -g @openai/codex\n```\n\n### Step 2: Identify Changed Files\n\n```bash\ngit diff --name-only HEAD~1 2>/dev/null || git status --short\n```\n\n### Step 3: Execute Codex Review\n\nExecute Codex CLI directly (progress displayed in real-time on STDERR):\n\n```bash\ncodex exec \"Review the following code changes and output issues and improvement suggestions:\n\nFiles: {changed_files}\n\n{file_contents}\"\n```\n\n> **Legacy mode**: Set `execution_mode: mcp` to use MCP (no progress display)\n\n**Configuration**:\n```yaml\n# .claude-code-harness.config.yaml\nreview:\n  codex:\n    model: gpt-5.2-codex        # Recommended (top-tier model)\n    # execution_mode: mcp       # Legacy: MCP (no progress display)\n```\n\n### Step 4: Claude Verification\n\n**Claude verifies Codex's findings and determines if fixes are needed.**\n\n```markdown\n## 🤖 Codex Review Results (Claude Verified)\n\n### Issues\n\n| File | Line | Severity | Content | Claude Verification |\n|------|------|----------|---------|---------------------|\n| src/api/users.ts | 45 | High | Possible SQL injection | ✅ Valid |\n| src/utils/calc.ts | 12 | Medium | Calculation precision issue | ⚠️ Needs confirmation |\n\n### Improvement Suggestions (Verified)\n\n1. Recommend using parameterized queries → **Fix recommended**\n2. Add input validation → **Fix recommended**\n```\n\n### Step 5: Fix Proposal and Approval\n\n```markdown\n## 🔧 Items Requiring Fixes\n\nAdd the following fixes to Plans.md and execute with `/work`?\n\n| # | Fix Content | File | Priority |\n|---|-------------|------|----------|\n| 1 | SQL injection protection | src/api/users.ts:45 | High |\n| 2 | Add input validation | src/api/users.ts | Medium |\n\n**Options:**\n1. Approve all → Add to Plans.md and run `/work`\n2. Approve selected → Specify numbers (e.g., 1)\n3. Don't fix now → Report only\n```\n\n### Step 6: Apply to Plans.md and Execute (On Approval)\n\n```\nUser approval\n    ↓\nAdd fix tasks to Plans.md:\n  - [ ] [bugfix] SQL injection protection (src/api/users.ts:45)\n  - [ ] [feature] Add input validation\n    ↓\nRun /work (or suggest execution)\n    ↓\nFix complete\n```\n\n---\n\n## Options\n\n```\n/codex-review              # Review all changed files\n/codex-review src/         # Specific directory only\n/codex-review --security   # Focus on security perspective\n```\n\n---\n\n## Difference from /harness-review\n\n| Command | Content |\n|---------|---------|\n| `/harness-review` | Full review by Claude (+ optional Codex) |\n| `/codex-review` | Codex standalone review |\n\n**Recommendation**: Normally use `/harness-review`, use `/codex-review` when additional second opinion is needed\n\n---\n\n## Related Commands\n\n- `/harness-review` - Full review (Claude + optional Codex)\n- `/harness-init` - Project initialization (includes Codex setup)\n",
        "opencode/commands/optional/crud.md": "---\ndescription: \"[Optional] Auto-generate CRUD (validation, auth, production-ready)\"\n---\n\n# /crud - CRUD Auto-generation (Production-ready)\n\nAuto-generates CRUD functionality for specified entities (tables) at **production-ready level**.\n\n## VibeCoder Quick Reference\n\n- \"**Create CRUD for task management**\" → `/crud tasks`\n- \"**Want search and pagination too**\" → Includes all together\n- \"**Include permissions (who can view/edit)**\" → Sets up authorization/rules together\n\n## Deliverables\n\n- CRUD + validation + authorization + tests, **complete production-safe set**\n- Minimize diff to match existing DB/code\n\n**Features**:\n- ✅ Validation (Zod) auto-add\n- ✅ Auth/authorization (Row Level Security) auto-config\n- ✅ Relations (one-to-many, many-to-many) support\n- ✅ Pagination, search, filters\n- ✅ Auto-generated test cases\n\n---\n\n## 🔧 Auto-invoke Skills (Required)\n\n**This command must explicitly invoke the following skills with the Skill tool**:\n\n| Skill | Purpose | When to Call |\n|-------|---------|--------------|\n| `impl` | Implementation (parent skill) | CRUD feature implementation |\n| `verify` | Verification (parent skill) | Post-implementation verification |\n\n**How to call**:\n```\nUse Skill tool:\n  skill: \"claude-code-harness:impl\"      # CRUD feature implementation\n  skill: \"claude-code-harness:verify\"    # Build verification\n```\n\n**Child skills (auto-routing)**:\n- `work-impl-feature` - CRUD feature implementation\n- `verify-build` - Build verification\n- `core-diff-aware-editing` - Diff-aware editing\n\n> ⚠️ **Important**: Proceeding without calling skills won't record in usage statistics. Always call with Skill tool.\n\n---\n\n## Usage\n\n```\n/crud tasks\n```\n\n→ Generates CRUD functionality for `tasks` table\n\n---\n\n## Execution Flow\n\n### Step 1: Confirm Entity Name\n\nCheck user input. If no input, ask:\n\n> 🎯 **Which entity (table) should we create CRUD for?**\n>\n> Examples:\n> - `tasks` - Task management\n> - `posts` - Blog posts\n> - `products` - Products\n> - `bookings` - Reservations\n>\n> Singular or plural is OK!\n\n**Wait for response**\n\n### Step 2: Confirm Schema Design\n\n> 📋 **Are these fields OK?**\n>\n> ```typescript\n> // Example: tasks table\n> {\n>   id: string (UUID, auto-generated)\n>   title: string (required)\n>   description: string (optional)\n>   status: 'todo' | 'in_progress' | 'done' (default: 'todo')\n>   priority: 'low' | 'medium' | 'high' (default: 'medium')\n>   due_date: Date (optional)\n>   user_id: string (foreign key, auto-set)\n>   created_at: Date (auto-generated)\n>   updated_at: Date (auto-updated)\n> }\n> ```\n>\n> **Let me know if you want changes.**\n> Example: \"Add an assignee_id field\"\n\n**Wait for response (or \"OK\" to proceed)**\n\n### Step 3: Confirm Relations\n\n> 🔗 **Any relations to other tables?**\n>\n> Examples:\n> - \"tasks belong to one project\" (many-to-one)\n> - \"tasks have multiple tags\" (many-to-many)\n>\n> Answer \"none\" if there aren't any.\n\n**Wait for response**\n\n### Step 4: Files to Generate\n\nThe following files will be auto-generated:\n\n#### 1. Prisma Schema (`prisma/schema.prisma`)\n\n```prisma\nmodel Task {\n  id          String   @id @default(uuid())\n  title       String\n  description String?\n  status      TaskStatus @default(TODO)\n  priority    TaskPriority @default(MEDIUM)\n  due_date    DateTime?\n  user_id     String\n  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)\n  created_at  DateTime @default(now())\n  updated_at  DateTime @updatedAt\n\n  @@index([user_id])\n  @@index([status])\n  @@index([due_date])\n}\n\nenum TaskStatus {\n  TODO\n  IN_PROGRESS\n  DONE\n}\n\nenum TaskPriority {\n  LOW\n  MEDIUM\n  HIGH\n}\n```\n\n#### 2. Zod Validation Schema (`lib/validations/task.ts`)\n\n```typescript\nimport { z } from 'zod'\n\nexport const createTaskSchema = z.object({\n  title: z.string().min(1, 'Required').max(100, 'Must be 100 characters or less'),\n  description: z.string().max(1000, 'Must be 1000 characters or less').optional(),\n  status: z.enum(['todo', 'in_progress', 'done']).default('todo'),\n  priority: z.enum(['low', 'medium', 'high']).default('medium'),\n  due_date: z.string().datetime().optional(),\n})\n\nexport const updateTaskSchema = createTaskSchema.partial()\n\nexport const taskQuerySchema = z.object({\n  page: z.coerce.number().int().positive().default(1),\n  limit: z.coerce.number().int().positive().max(100).default(20),\n  status: z.enum(['todo', 'in_progress', 'done']).optional(),\n  priority: z.enum(['low', 'medium', 'high']).optional(),\n  search: z.string().optional(),\n  sort_by: z.enum(['created_at', 'due_date', 'priority']).default('created_at'),\n  sort_order: z.enum(['asc', 'desc']).default('desc'),\n})\n\nexport type CreateTaskInput = z.infer<typeof createTaskSchema>\nexport type UpdateTaskInput = z.infer<typeof updateTaskSchema>\nexport type TaskQuery = z.infer<typeof taskQuerySchema>\n```\n\n#### 3. API Routes (`app/api/tasks/route.ts`)\n\n```typescript\nimport { NextRequest, NextResponse } from 'next/server'\nimport { auth } from '@clerk/nextjs/server'\nimport { prisma } from '@/lib/prisma'\nimport { createTaskSchema, taskQuerySchema } from '@/lib/validations/task'\n\n// GET /api/tasks - Get task list (pagination, search, filter support)\nexport async function GET(req: NextRequest) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 })\n    }\n\n    const { searchParams } = new URL(req.url)\n    const query = taskQuerySchema.parse(Object.fromEntries(searchParams))\n\n    const where = {\n      user_id: userId,\n      ...(query.status && { status: query.status }),\n      ...(query.priority && { priority: query.priority }),\n      ...(query.search && {\n        OR: [\n          { title: { contains: query.search, mode: 'insensitive' } },\n          { description: { contains: query.search, mode: 'insensitive' } },\n        ],\n      }),\n    }\n\n    const [tasks, total] = await Promise.all([\n      prisma.task.findMany({\n        where,\n        orderBy: { [query.sort_by]: query.sort_order },\n        skip: (query.page - 1) * query.limit,\n        take: query.limit,\n      }),\n      prisma.task.count({ where }),\n    ])\n\n    return NextResponse.json({\n      data: tasks,\n      meta: {\n        page: query.page,\n        limit: query.limit,\n        total,\n        total_pages: Math.ceil(total / query.limit),\n      },\n    })\n  } catch (error) {\n    console.error('GET /api/tasks error:', error)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n\n// POST /api/tasks - Create task\nexport async function POST(req: NextRequest) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 })\n    }\n\n    const body = await req.json()\n    const data = createTaskSchema.parse(body)\n\n    const task = await prisma.task.create({\n      data: {\n        ...data,\n        user_id: userId,\n      },\n    })\n\n    return NextResponse.json(task, { status: 201 })\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ error: error.errors }, { status: 400 })\n    }\n    console.error('POST /api/tasks error:', error)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n```\n\n#### 4. Individual API Routes (`app/api/tasks/[id]/route.ts`)\n\n```typescript\nimport { NextRequest, NextResponse } from 'next/server'\nimport { auth } from '@clerk/nextjs/server'\nimport { prisma } from '@/lib/prisma'\nimport { updateTaskSchema } from '@/lib/validations/task'\n\n// GET /api/tasks/:id - Get task details\nexport async function GET(\n  req: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 })\n    }\n\n    const task = await prisma.task.findUnique({\n      where: { id: params.id },\n    })\n\n    if (!task) {\n      return NextResponse.json({ error: 'Task not found' }, { status: 404 })\n    }\n\n    // Authorization: can only get own tasks\n    if (task.user_id !== userId) {\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 })\n    }\n\n    return NextResponse.json(task)\n  } catch (error) {\n    console.error(`GET /api/tasks/${params.id} error:`, error)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n\n// PATCH /api/tasks/:id - Update task\nexport async function PATCH(\n  req: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 })\n    }\n\n    const existingTask = await prisma.task.findUnique({\n      where: { id: params.id },\n    })\n\n    if (!existingTask) {\n      return NextResponse.json({ error: 'Task not found' }, { status: 404 })\n    }\n\n    // Authorization: can only update own tasks\n    if (existingTask.user_id !== userId) {\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 })\n    }\n\n    const body = await req.json()\n    const data = updateTaskSchema.parse(body)\n\n    const task = await prisma.task.update({\n      where: { id: params.id },\n      data,\n    })\n\n    return NextResponse.json(task)\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ error: error.errors }, { status: 400 })\n    }\n    console.error(`PATCH /api/tasks/${params.id} error:`, error)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n\n// DELETE /api/tasks/:id - Delete task\nexport async function DELETE(\n  req: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 })\n    }\n\n    const existingTask = await prisma.task.findUnique({\n      where: { id: params.id },\n    })\n\n    if (!existingTask) {\n      return NextResponse.json({ error: 'Task not found' }, { status: 404 })\n    }\n\n    // Authorization: can only delete own tasks\n    if (existingTask.user_id !== userId) {\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 })\n    }\n\n    await prisma.task.delete({\n      where: { id: params.id },\n    })\n\n    return NextResponse.json({ message: 'Deleted' })\n  } catch (error) {\n    console.error(`DELETE /api/tasks/${params.id} error:`, error)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n```\n\n#### 5. Frontend Component (`components/tasks/task-list.tsx`)\n\n```typescript\n'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useAuth } from '@clerk/nextjs'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Select } from '@/components/ui/select'\nimport { TaskCard } from './task-card'\n\nexport function TaskList() {\n  const { getToken } = useAuth()\n  const [tasks, setTasks] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [search, setSearch] = useState('')\n  const [status, setStatus] = useState('')\n  const [page, setPage] = useState(1)\n\n  useEffect(() => {\n    fetchTasks()\n  }, [search, status, page])\n\n  const fetchTasks = async () => {\n    setLoading(true)\n    try {\n      const token = await getToken()\n      const params = new URLSearchParams({\n        page: page.toString(),\n        ...(search && { search }),\n        ...(status && { status }),\n      })\n      const res = await fetch(`/api/tasks?${params}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n      const data = await res.json()\n      setTasks(data.data)\n    } catch (error) {\n      console.error('Failed to fetch tasks:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div>\n      <div className=\"mb-4 flex gap-4\">\n        <Input\n          placeholder=\"Search...\"\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n        />\n        <Select value={status} onValueChange={setStatus}>\n          <option value=\"\">All</option>\n          <option value=\"todo\">Not started</option>\n          <option value=\"in_progress\">In progress</option>\n          <option value=\"done\">Done</option>\n        </Select>\n      </div>\n\n      {loading ? (\n        <p>Loading...</p>\n      ) : (\n        <div className=\"grid gap-4\">\n          {tasks.map((task) => (\n            <TaskCard key={task.id} task={task} onUpdate={fetchTasks} />\n          ))}\n        </div>\n      )}\n\n      <div className=\"mt-4 flex justify-center gap-2\">\n        <Button onClick={() => setPage(p => Math.max(1, p - 1))} disabled={page === 1}>\n          Previous\n        </Button>\n        <span>Page {page}</span>\n        <Button onClick={() => setPage(p => p + 1)}>\n          Next\n        </Button>\n      </div>\n    </div>\n  )\n}\n```\n\n#### 6. Test Cases (`__tests__/api/tasks.test.ts`)\n\n```typescript\nimport { describe, it, expect, beforeEach } from 'vitest'\nimport { createMocks } from 'node-mocks-http'\nimport { GET, POST } from '@/app/api/tasks/route'\n\ndescribe('/api/tasks', () => {\n  beforeEach(() => {\n    // Mock setup\n  })\n\n  describe('GET', () => {\n    it('returns 401 without auth', async () => {\n      const { req } = createMocks({ method: 'GET' })\n      const res = await GET(req as any)\n      expect(res.status).toBe(401)\n    })\n\n    it('can get task list', async () => {\n      // Test code\n    })\n\n    it('pagination works', async () => {\n      // Test code\n    })\n\n    it('search works', async () => {\n      // Test code\n    })\n  })\n\n  describe('POST', () => {\n    it('can create task', async () => {\n      // Test code\n    })\n\n    it('returns validation error', async () => {\n      // Test code\n    })\n  })\n})\n```\n\n### Step 5: Supabase RLS (Row Level Security) Setup\n\nIf using Supabase, auto-configure the following RLS policies:\n\n```sql\n-- Enable RLS for tasks table\nALTER TABLE tasks ENABLE ROW LEVEL SECURITY;\n\n-- SELECT: Can only view own tasks\nCREATE POLICY \"Users can view their own tasks\"\nON tasks FOR SELECT\nUSING (auth.uid() = user_id);\n\n-- INSERT: Can only create own tasks\nCREATE POLICY \"Users can create their own tasks\"\nON tasks FOR INSERT\nWITH CHECK (auth.uid() = user_id);\n\n-- UPDATE: Can only update own tasks\nCREATE POLICY \"Users can update their own tasks\"\nON tasks FOR UPDATE\nUSING (auth.uid() = user_id);\n\n-- DELETE: Can only delete own tasks\nCREATE POLICY \"Users can delete their own tasks\"\nON tasks FOR DELETE\nUSING (auth.uid() = user_id);\n```\n\n### Step 6: Guide Next Actions\n\n> ✅ **CRUD functionality complete!**\n>\n> 📄 **Generated files**:\n> - `prisma/schema.prisma` - Database schema\n> - `lib/validations/task.ts` - Validation\n> - `app/api/tasks/route.ts` - API (list, create)\n> - `app/api/tasks/[id]/route.ts` - API (detail, update, delete)\n> - `components/tasks/task-list.tsx` - Frontend\n> - `__tests__/api/tasks.test.ts` - Test cases\n> - `supabase/migrations/{{timestamp}}_tasks_rls.sql` - RLS policies\n>\n> **Next steps:**\n> 1. Run `npx prisma migrate dev --name add_tasks`\n> 2. Run tests: `npm test`\n> 3. Verify: `npm run dev`\n>\n> 💡 **Hint**: To add other entities, run `/crud {{entity_name}}`.\n\n---\n\n## Relations Support\n\n### One-to-Many (Many-to-One)\n\n**Example**: tasks belong to one project\n\n```prisma\nmodel Task {\n  // ...\n  project_id String\n  project    Project @relation(fields: [project_id], references: [id], onDelete: Cascade)\n}\n\nmodel Project {\n  id    String @id @default(uuid())\n  name  String\n  tasks Task[]\n}\n```\n\n### Many-to-Many\n\n**Example**: tasks have multiple tags\n\n```prisma\nmodel Task {\n  // ...\n  tags TaskTag[]\n}\n\nmodel Tag {\n  id    String    @id @default(uuid())\n  name  String    @unique\n  tasks TaskTag[]\n}\n\nmodel TaskTag {\n  task_id String\n  tag_id  String\n  task    Task   @relation(fields: [task_id], references: [id], onDelete: Cascade)\n  tag     Tag    @relation(fields: [tag_id], references: [id], onDelete: Cascade)\n\n  @@id([task_id, tag_id])\n}\n```\n\n---\n\n## Notes\n\n- **Production-ready**: Complete with validation, authorization, error handling\n- **Security**: RLS prevents access to others' data\n- **Performance**: Optimized with indexes, pagination\n- **Testing**: Auto-generated test cases for quality assurance\n- **Extensibility**: Supports relations, custom fields\n\n**Code generated by this command is ready for production use.**\n",
        "opencode/commands/optional/dev-tools-setup.md": "---\ndescription: 開発ツール (AST-Grep, LSP) を一括セットアップ\n---\n\n# /dev-tools-setup - Development Tools Setup\n\nSetup AST-Grep and LSP to enable advanced code intelligence features.\n\n---\n\n## Why MCP? (設計意図)\n\nAST-Grep や LSP を「ただインストールするだけ」では、Claude は標準ツール（Grep, Read, Bash など）を使い続けてしまいます。\n\n**MCP 化することで**:\n\n| 課題 | MCP による解決 |\n|------|---------------|\n| Claude が `sg` コマンドを知らない | `harness_ast_search` として明示的に提供 |\n| スキルから呼び出せない | MCP ツールとしてスキル内で参照可能 |\n| 使い方が不明確 | ツール説明に用途・パターンを記載 |\n\n**結果**: `/harness-review` や review スキルが自動的に `harness_ast_search` を使用し、コードスメル検出の精度が向上します。\n\n---\n\n## What This Enables\n\nAfter setup, these MCP tools become available:\n\n| Tool | Purpose |\n|------|---------|\n| `harness_ast_search` | Structural code pattern search |\n| `harness_lsp_references` | Find all symbol references |\n| `harness_lsp_definition` | Go to symbol definition |\n| `harness_lsp_diagnostics` | Get code diagnostics |\n| `harness_lsp_hover` | Get type information |\n\n---\n\n## Execution Flow\n\n### Step 1: Detect Project Languages\n\n```bash\n# Auto-detect languages\nls package.json 2>/dev/null && echo \"TypeScript/JavaScript detected\"\nls requirements.txt pyproject.toml 2>/dev/null && echo \"Python detected\"\nls Cargo.toml 2>/dev/null && echo \"Rust detected\"\nls go.mod 2>/dev/null && echo \"Go detected\"\n```\n\n### Step 2: Check AST-Grep Installation\n\n```bash\n# Check if ast-grep is installed\nwhich sg || echo \"AST-Grep not found\"\n```\n\n**If not installed, suggest:**\n\n| Platform | Install Command |\n|----------|-----------------|\n| macOS | `brew install ast-grep` |\n| npm (any) | `npm install -g @ast-grep/cli` |\n| Cargo (any) | `cargo install ast-grep --locked` |\n\n### Step 3: Check LSP Installation\n\nBased on detected languages:\n\n| Language | Check Command | Install Command |\n|----------|---------------|-----------------|\n| TypeScript/JS | `which typescript-language-server` | `npm install -g typescript-language-server typescript` |\n| Python | `which pylsp` | `pip install python-lsp-server` |\n| Rust | `which rust-analyzer` | `rustup component add rust-analyzer` |\n| Go | `which gopls` | `go install golang.org/x/tools/gopls@latest` |\n\n### Step 4: Configure MCP Server\n\nMCP ツールを有効にするため、harness MCP サーバーを設定します。\n\n#### 4.1: MCP サーバービルド確認\n\n```bash\n# MCP サーバーがビルド済みか確認\nls \"${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js\" 2>/dev/null || echo \"Not built\"\n```\n\n**ビルドされていない場合:**\n\n```bash\ncd \"${CLAUDE_PLUGIN_ROOT}/mcp-server\"\nnpm install\nnpm run build\n```\n\n#### 4.2: 設定スコープの選択（ユーザー確認必須）\n\n> 🔴 **AskUserQuestion ツールで確認すること**\n\nユーザーに以下を確認:\n\n```\nMCP サーバーの設定スコープを選択してください:\n\n1. グローバル設定（推奨）\n   - ~/.mcp.json に設定\n   - すべてのプロジェクトで harness MCP ツールが使用可能\n   - 一度設定すれば他のプロジェクトで再設定不要\n\n2. プロジェクト固有設定\n   - .mcp.json（プロジェクトルート）に設定\n   - このプロジェクトのみで使用可能\n   - リポジトリに含めてチームで共有可能\n```\n\n#### 4.3: 設定ファイル作成\n\n**グローバル設定の場合:**\n\n`~/.mcp.json` に追加:\n\n```json\n{\n  \"mcpServers\": {\n    \"harness\": {\n      \"command\": \"node\",\n      \"args\": [\"${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js\"]\n    }\n  }\n}\n```\n\n```bash\n# ~/.mcp.json が存在しない場合は作成\nif [ ! -f ~/.mcp.json ]; then\n  cat > ~/.mcp.json << 'EOF'\n{\n  \"mcpServers\": {\n    \"harness\": {\n      \"command\": \"node\",\n      \"args\": [\"${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js\"]\n    }\n  }\n}\nEOF\n  echo \"Created ~/.mcp.json (global)\"\nelse\n  echo \"~/.mcp.json already exists - please add harness MCP server manually\"\nfi\n```\n\n**プロジェクト固有設定の場合:**\n\n`.mcp.json`（プロジェクトルート）に追加:\n\n```bash\n# .mcp.json が存在しない場合は作成\nif [ ! -f .mcp.json ]; then\n  cat > .mcp.json << 'EOF'\n{\n  \"mcpServers\": {\n    \"harness\": {\n      \"command\": \"node\",\n      \"args\": [\"${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js\"]\n    }\n  }\n}\nEOF\n  echo \"Created .mcp.json (project)\"\nelse\n  echo \".mcp.json already exists - please add harness MCP server manually\"\nfi\n```\n\n#### 4.4: 動作確認\n\n```bash\n# Claude Code を再起動後、MCP ツールが利用可能か確認\n# harness_ast_search, harness_lsp_* などが使用可能になる\n```\n\n### Step 5: Report Status\n\n```markdown\n## 🔧 Development Tools Status\n\n### AST-Grep\n- Status: ✅ Installed / ❌ Not Installed\n- Version: x.x.x\n- Command: `sg`\n\n### Language Servers\n\n| Language | Status | Server |\n|----------|--------|--------|\n| TypeScript | ✅/❌ | typescript-language-server |\n| Python | ✅/❌ | pylsp |\n\n### MCP Server\n- Status: ✅ Configured / ❌ Not Configured\n- Config: `.mcp.json`\n\n### Available MCP Tools\n\nAfter setup complete:\n- `harness_ast_search` - Structural code search\n- `harness_lsp_references` - Find references\n- `harness_lsp_definition` - Go to definition\n- `harness_lsp_diagnostics` - Get diagnostics\n- `harness_lsp_hover` - Type information\n\n### Next Steps\n\n1. Install missing tools (commands shown above)\n2. Restart Claude Code session\n3. MCP tools are now available in your workflow\n```\n\n---\n\n## Usage Examples\n\n### After Setup: AST-Grep Search\n\n```bash\n# Find all console.log calls\nharness_ast_search pattern=\"console.log($$$)\" language=\"typescript\"\n\n# Find empty catch blocks (code smell)\nharness_ast_search pattern=\"catch ($ERR) { }\" language=\"typescript\"\n\n# Find async functions without await\nharness_ast_search pattern=\"async function $NAME($$$) { $BODY }\" language=\"typescript\"\n```\n\n### After Setup: LSP Analysis\n\n```bash\n# Find references to a function\nharness_lsp_references file=\"src/utils.ts\" line=10 column=5\n\n# Get diagnostics for a file\nharness_lsp_diagnostics file=\"src/components/App.tsx\"\n```\n\n---\n\n## Integration with /harness-review\n\nWhen AST-Grep is installed, `/harness-review` automatically:\n\n1. Detects code smells:\n   - `console.log` remnants\n   - Empty catch blocks\n   - Unused async/await\n   - Magic numbers\n\n2. Reports findings in review output\n\n---\n\n## VibeCoder Hints\n\n| What You Want | How to Say |\n|---------------|------------|\n| Setup tools | \"setup development tools\" |\n| Check installation | \"are AST and LSP installed?\" |\n| Search patterns | \"find all console.log\" |\n| Find references | \"where is this function used?\" |\n\n---\n\n## Troubleshooting\n\n### AST-Grep not working\n\n```bash\n# Check installation\nwhich sg\nsg --version\n\n# Test search\nsg --pattern \"console.log\" --lang typescript .\n```\n\n### LSP not working\n\n```bash\n# Check TypeScript server\nwhich typescript-language-server\ntypescript-language-server --version\n\n# Check if tsconfig.json exists\nls tsconfig.json\n```\n\n### Still issues?\n\n1. Restart Claude Code session\n2. Check PATH environment variable\n3. Try manual installation commands\n\n---\n\n## Related Commands\n\n- `/harness-review` - Code review (uses AST-Grep when available)\n- `/lsp-setup` - LSP-only setup (legacy)\n- `/mcp-setup` - MCP server configuration\n",
        "opencode/commands/optional/generate-video.md": "---\ndescription: コードベースから説明動画を自動生成\n---\n\n# /generate-video - 動画自動生成\n\nコードベースを分析し、プロダクトデモ・アーキテクチャ解説・リリースノート動画を自動生成します。\n\n## VibeCoder Quick Reference\n\n- \"**動画作りたい**\" → このコマンド\n- \"**プロダクト紹介動画**\" → このコマンド\n- \"**リリース動画**\" → このコマンド\n- \"**デモ動画**\" → このコマンド\n\n---\n\n## ベストプラクティス\n\n> **詳細**: [skills/video/references/best-practices.md](../../skills/video/references/best-practices.md)\n\n### 基本原則\n\n| 原則 | 説明 |\n|------|------|\n| **痛みから始める** | 機能羅列ではなく、視聴者の課題解決を示す |\n| **冒頭は本題優先** | ロゴや会社紹介を長く出さない |\n| **CTAは途中にも** | 最後だけでなく中間地点にも配置 |\n| **優先順位** | 音質 > 画面の可読性 > テンポ > 見た目 |\n\n### ファネル別推奨構成\n\n| 目的（ファネル） | 動画タイプ | 長さ | 構成の芯 |\n|------------------|------------|------|----------|\n| 認知〜興味 | LP/広告ティザー | 30-90秒 | 痛み→結果→CTA |\n| 興味→検討 | Introデモ | 2-3分 | 1ユースケース完走 |\n| 検討→確信 | セールスデモ | 2-5分 | 反論を先に潰す |\n| 確信→決裁 | ウォークスルー | 5-30分 | 実運用+証拠 |\n\n### 推奨3本セット\n\n最短で成果を出すための基本セット:\n\n1. **90秒ティザー** - 認知獲得（LP/広告用）\n2. **3分Introデモ** - 検討促進\n3. **15〜25分ウォークスルー** - 成約支援\n\n---\n\n## Prerequisites\n\n- Remotion セットアップ済み（未設定の場合は `/remotion-setup` を案内）\n- Node.js 18+\n\n---\n\n## Usage\n\n```bash\n/generate-video\n```\n\n**引数なし**。インタラクティブフローで進行します。\n\n---\n\n## Execution Flow\n\n```\n/generate-video\n    │\n    ├─[Step 1] Remotion セットアップ確認\n    │   └─ 未設定 → /remotion-setup を案内して終了\n    │\n    ├─[Step 2] 分析済みかチェック\n    │   └─ 未分析 → analyzer.md で分析実行\n    │\n    ├─[Step 3] シナリオ提案 + ユーザー確認\n    │   └─ planner.md でシーン構成を提案\n    │   └─ AskUserQuestion で承認/編集/キャンセル\n    │\n    └─[Step 4] 並列生成\n        └─ generator.md で Task tool 並列起動\n        └─ 統合 + レンダリング\n```\n\n---\n\n## Step 1: Remotion セットアップ確認\n\n```bash\n# remotion ディレクトリまたは依存関係を確認\nls remotion/ 2>/dev/null || grep -q '\"remotion\"' package.json 2>/dev/null\n```\n\n**未設定の場合**:\n\n> ⚠️ **Remotion が未セットアップです**\n>\n> 動画生成には Remotion が必要です。\n> `/remotion-setup` を実行してセットアップしてください。\n\n→ **コマンド終了**\n\n---\n\n## Step 2: コードベース分析\n\n**See**: [skills/video/references/analyzer.md](../../skills/video/references/analyzer.md)\n\n分析対象:\n- フレームワーク検出（Next.js, React, Vue, etc.）\n- 主要機能検出（認証, 決済, ダッシュボード, API）\n- UIコンポーネント数\n- プロジェクト資産（package.json, README, Plans.md, CHANGELOG）\n- 最近の変更点\n\n**出力例**:\n\n```\n📊 プロジェクト分析完了\n\n| 項目 | 結果 |\n|------|------|\n| プロジェクト名 | MyApp |\n| フレームワーク | Next.js 14 |\n| ページ数 | 12 |\n| 検出機能 | 認証, ダッシュボード, API |\n\n🎬 推奨動画タイプ: プロダクトデモ\n   理由: UIコンポーネントの追加が検出されました\n```\n\n---\n\n## Step 3: シナリオ提案 + ユーザー確認\n\n**See**: [skills/video/references/planner.md](../../skills/video/references/planner.md)\n\n**シナリオ提案**:\n\n```markdown\n🎬 シナリオプラン\n\n**動画タイプ**: プロダクトデモ\n**合計時間**: 45秒\n\n| # | シーン | 時間 | 内容 | ソース |\n|---|--------|------|------|--------|\n| 1 | イントロ | 5秒 | MyApp - タスク管理を簡単に | テンプレート |\n| 2 | 認証フロー | 15秒 | ログイン画面のデモ | Playwright |\n| 3 | ダッシュボード | 20秒 | メイン機能の紹介 | Playwright |\n| 4 | CTA | 5秒 | myapp.com | テンプレート |\n```\n\n**AskUserQuestion**:\n\n```\nquestion: \"このシナリオで動画を生成しますか？\"\nheader: \"シナリオ確認\"\noptions:\n  - label: \"OK、生成開始\"\n    description: \"このシーン構成で動画を生成します\"\n  - label: \"編集したい\"\n    description: \"シーンの追加/削除/変更を行います\"\n  - label: \"キャンセル\"\n    description: \"動画生成を中止します\"\n```\n\n### 編集モード\n\n「編集したい」を選択した場合:\n\n```\n📝 シナリオ編集\n\n以下の指示で編集できます：\n- 「機能Xのデモを追加」\n- 「シーン2を削除」\n- 「イントロを3秒に短縮」\n- 「シーン2と3を入れ替え」\n- 「これでOK」で確定\n\n何を編集しますか？\n```\n\n---\n\n## Step 4: 並列生成\n\n**See**: [skills/video/references/generator.md](../../skills/video/references/generator.md)\n\n### 並列数決定\n\n| シーン数 | 並列数 |\n|---------|--------|\n| 1-2 | 1-2 |\n| 3-4 | 3 |\n| 5+ | 5 |\n\n### Task Tool で並列起動\n\n各シーンに対して `video-scene-generator` サブエージェントを起動:\n\n```\nTask:\n  subagent_type: \"video-scene-generator\"\n  run_in_background: true\n  prompt: |\n    以下のシーンを Remotion コンポジションとして生成してください。\n\n    シーン情報:\n    - ID: {scene.id}\n    - 名前: {scene.name}\n    - 時間: {scene.duration}秒\n    - テンプレート: {scene.template}\n    - 内容: {scene.content}\n```\n\n### 進捗モニタリング\n\n```\n🎬 並列生成中... (2/4 完了)\n\n├── [Agent 1] intro ✅ (5秒)\n├── [Agent 2] auth-demo ✅ (15秒)\n├── [Agent 3] dashboard ⏳ 生成中...\n└── [Agent 4] cta 🔜 待機中\n```\n\n### 統合 + レンダリング\n\n1. シーン結合（Series/TransitionSeries）\n2. トランジション追加（fade）\n3. 最終レンダリング\n\n```bash\nnpx remotion render remotion/index.ts FullVideo out/video.mp4\n```\n\n---\n\n## 完了報告\n\n```markdown\n✅ **動画生成完了**\n\n📁 **出力ファイル**:\n- `out/video.mp4` (45秒, 1080p, 12.3MB)\n\n📊 **生成統計**:\n| 項目 | 値 |\n|------|-----|\n| シーン数 | 4 |\n| 並列エージェント数 | 3 |\n| 生成時間 | 45秒 |\n| レンダリング時間 | 30秒 |\n\n🎬 **プレビュー**:\n- Studio: `npm run remotion` → http://localhost:3000\n- ファイル: `open out/video.mp4`\n\n**次のステップ**:\n- 編集: Remotion Studio で微調整\n- 再生成: `/generate-video` で別のシナリオを試す\n```\n\n---\n\n## 動画タイプ別フロー（ファネル対応）\n\n### LP/広告ティザー（30-90秒）\n\n**ファネル**: 認知〜興味\n\n```\nHook (3-5秒) → ProblemPromise (5-15秒) → WorkflowDemo (20-60秒) → Differentiator (10秒) → CTA (10秒)\n```\n\n- 冒頭で痛みを提示（「また手動で...」）\n- 機能羅列ではなく1つの象徴的なワークフローを見せる\n- Before/After で差別化の根拠を示す\n\n### Introデモ（2-3分）\n\n**ファネル**: 興味→検討\n\n```\nHook (10秒) → UseCase宣言 (20秒) → 実画面Demo (110秒) → Objection (30秒) → CTA (10秒)\n```\n\n- 1ユースケースを最短で完走させる\n- 専門用語を避けて分解しながら説明\n- よくある不安を1つ先に潰す\n\n### プロダクトデモ（3-5分）\n\n**ファネル**: 検討→確信\n\n```\nイントロ → 機能紹介×N → UIデモ×N → 反論処理 → CTA\n```\n\n- Playwright で実際のUI操作をキャプチャ\n- アプリが起動している必要あり\n- 反論トップ3を先回りで潰す\n\n### アーキテクチャ解説（5-30分）\n\n**ファネル**: 確信→決裁\n\n```\nイントロ → 概要図 → 詳細解説×N → データフロー → 管理/セキュリティ → CTA\n```\n\n- Mermaid 図をアニメーション化\n- `.claude/memory/decisions.md` から技術的背景を抽出\n- チャプター設計必須\n\n### リリースノート（1-3分）\n\n**ファネル**: 継続・活用\n\n```\nイントロ → バージョン → 変更点リスト → Before/After → 新機能デモ → CTA\n```\n\n- CHANGELOG.md から変更点を抽出\n- 新機能があれば Playwright デモ\n\n---\n\n## エラーハンドリング\n\n### Remotion 未セットアップ\n\n```\n⚠️ Remotion が未セットアップです\n→ /remotion-setup を実行してください\n```\n\n### アプリ未起動（Playwrightシーン）\n\n```\n⚠️ アプリが起動していません\n\nPlaywright によるUIキャプチャには、アプリが起動している必要があります。\n\n対処:\n1. `npm run dev` でアプリを起動\n2. 再度 `/generate-video` を実行\n\nまたは、UIデモシーンをスキップしますか？\n```\n\n### レンダリング失敗\n\n```\n⚠️ レンダリングエラー\n\n原因: メモリ不足\n\n対処:\n1. 並列数を減らす\n2. 解像度を下げる（720p）\n3. シーンを分割\n```\n\n---\n\n## Related Commands\n\n- `/remotion-setup` - Remotion 環境セットアップ\n\n---\n\n## Technical References\n\n- [Remotion公式ドキュメント](https://www.remotion.dev/docs)\n- [Remotion Agent Skills](https://www.remotion.dev/docs/ai/skills)\n- [Playwright MCP](https://github.com/anthropics/mcp-server-playwright)\n",
        "opencode/commands/optional/harness-mem.md": "---\ndescription: Claude-mem integration setup for cross-session memory\n---\n\n# /harness-mem - Claude-mem Integration Setup\n\nCustomize Claude-mem for harness specifications to enhance cross-session quality and context maintenance.\n\n---\n\n## VibeCoder Phrases\n\n- \"**Integrate with Claude-mem**\" → this command\n- \"**Enable cross-session memory**\" → this command\n- \"**Set up harness-mem**\" → this command\n\n## Deliverables\n\n- **Harness-specific mode settings for Claude-mem**: Auto-record guardrail activations, Plans.md updates, and SSOT changes\n- **Cross-session learning**: Utilize past mistakes and solutions in future sessions\n- **Japanese localization option**: Record observations and summaries in Japanese\n\n---\n\n## Prerequisites\n\nClaude-mem plugin must be installed.\nIf not installed, this command will support the installation.\n\n---\n\n## Execution Flow\n\n### Step 0: OS Detection\n\n```bash\n# Detect OS\nif [[ \"$OSTYPE\" == \"msys\" ]] || [[ \"$OSTYPE\" == \"cygwin\" ]] || [[ -n \"$WINDIR\" ]]; then\n  OS_TYPE=\"windows\"\nelif [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n  OS_TYPE=\"mac\"\nelse\n  OS_TYPE=\"linux\"\nfi\necho \"Detected OS: $OS_TYPE\"\n```\n\n---\n\n### Step 0.5: Bun Installation Check\n\nClaude-mem v7.3.7 and later uses Bun-based workers, so Bun installation is required.\n\n```bash\n# Check if Bun is installed\nif command -v bun &> /dev/null; then\n  echo \"✅ Bun is installed: $(bun --version)\"\nelse\n  echo \"⚠️ Bun is not installed\"\nfi\n```\n\n**If Bun is not installed**:\n\n> ⚠️ **Bun is not installed**\n>\n> Bun is required for Claude-mem operation.\n>\n> Install now?\n> 1. **Yes** - Install now (Recommended)\n> 2. **No** - Install manually\n\n**If \"Yes\"** - OS-specific installation:\n\n**macOS / Linux / WSL**:\n\n```bash\n# Official install script\ncurl -fsSL https://bun.sh/install | bash\n\n# Apply path after installation\nsource ~/.bashrc  # or source ~/.zshrc\n\n# Verify\nbun --version\n```\n\n**Windows (PowerShell)**:\n\n```powershell\n# Official install script\npowershell -c \"irm bun.sh/install.ps1 | iex\"\n\n# Or install via npm\nnpm install -g bun\n\n# Verify\nbun --version\n```\n\n**After installation**: Proceed to Step 1\n\n---\n\n**If Windows is detected**:\n\n```bash\n# Check claude-mem version\ncat ~/.claude/plugins/marketplaces/thedotmack/plugin/package.json | grep version\n```\n\n> **Recommendations vary by claude-mem version**\n>\n> | Version | Recommendation |\n> |---------|----------------|\n> | **v7.3.7+** | ✅ Can work natively on Windows (improved) |\n> | **v7.3.6 or earlier** | ⚠️ WSL strongly recommended (port 37777 issues frequent) |\n>\n> ---\n>\n> ### For v7.3.7+\n>\n> Native Windows operation has been significantly improved:\n> - Automatic zombie process cleanup\n> - Extended worker startup timeout (30 seconds)\n> - Bun-based worker wrapper\n>\n> **→ Proceed to Step 3.5 (Windows Settings).**\n>\n> ---\n>\n> ### For v7.3.6 or earlier\n>\n> **WSL usage is strongly recommended.**\n>\n> **Root causes**:\n> - PowerShell script (.ps1) execution issues\n> - Broken file associations\n> - Zombie processes occupying ports\n>\n> **Why it doesn't occur in WSL**:\n> - Shell scripts execute natively\n> - No dependency on file associations\n> - Unix standard process management\n>\n> | Option | Recommendation |\n> |--------|----------------|\n> | **Run Claude Code in WSL** | ⭐⭐⭐ Strongly recommended |\n> | Windows native | ⚠️ High risk of issues |\n>\n> **→ Proceed to Step 3.6 (WSL Setup).**\n>\n> ---\n>\n> ### Upgrade Recommended\n>\n> If using v7.3.6 or earlier, upgrade to the latest version is recommended:\n>\n> ```bash\n> /plugin marketplace remove thedotmack/claude-mem\n> /plugin marketplace add thedotmack/claude-mem\n> /plugin install claude-mem\n> ```\n\n---\n\n### Step 1: Claude-mem Installation Detection\n\n```bash\n# Check if Claude-mem plugin exists\nls ~/.claude/plugins/marketplaces/thedotmack 2>/dev/null\n```\n\n**If installed**: Proceed to Step 2\n\n**If not installed**:\n\n> ⚠️ **Claude-mem is not installed**\n>\n> Claude-mem installation is required to use cross-session\n> quality and context maintenance features.\n>\n> **What is Claude-mem?**\n> - Plugin that persists context across sessions\n> - Auto-records and enables search of past work history\n> - Combined with harness, quality improves cumulatively\n>\n> Install now?\n> 1. **Yes** - Install now (Recommended)\n> 2. **No** - Continue without Claude-mem\n\n**If \"Yes\"**:\n\n```bash\n# Add from marketplace\n/plugin marketplace add thedotmack/claude-mem\n\n# Install\n/plugin install claude-mem\n```\n\nIf successful, proceed to Step 2. If failed, display error message and manual installation instructions.\n\n---\n\n### Step 2: Japanese Localization Option\n\n> 🌐 **Do you want Claude-mem records in Japanese?**\n>\n> | Option | Description |\n> |--------|-------------|\n> | **Japanese** | Observations, summaries, and search results recorded in Japanese |\n> | **English** | Default setting (records in English) |\n>\n> 1. **Use Japanese** (Recommended for Japanese environments)\n> 2. **Keep English**\n\n**Record selection**: `$HARNESS_MEM_LANG` = `ja` or `en`\n\n---\n\n### Step 3: Mode File Deployment\n\nDeploy harness-specific mode file to Claude-mem.\n\n```bash\n# Mode file destination (official location)\nCLAUDE_MEM_MODES_DIR=\"$HOME/.claude-mem/modes\"\n\n# Create directory if it doesn't exist\nmkdir -p \"$CLAUDE_MEM_MODES_DIR\"\n\n# Copy harness.json\ncp templates/modes/harness.json \"$CLAUDE_MEM_MODES_DIR/\"\n\n# If Japanese version selected\nif [ \"$HARNESS_MEM_LANG\" = \"ja\" ]; then\n  cp templates/modes/harness--ja.json \"$CLAUDE_MEM_MODES_DIR/\"\nfi\n```\n\n---\n\n### Step 3.5: Windows-Specific Settings (Windows only)\n\n> **claude-mem v7.3.7+**: Native Windows operation improved ✅\n>\n> **v7.3.6 or earlier**: The following issues may occur ⚠️\n>\n> | Issue | Cause | v7.3.7 Fix |\n> |-------|-------|------------|\n> | Worker startup failure | PowerShell (.ps1) execution issues | Migrated to Bun wrapper |\n> | port 37777 timeout | Zombie processes | Auto process cleanup |\n> | Startup wait timeout | Too short timeout | Extended to 30 seconds |\n>\n> **If using v7.3.6 or earlier**: Upgrade to latest version or proceed to Step 3.6 (WSL) recommended\n\nWindows cannot directly execute `.sh` files, so additional configuration is required.\n\n> ⚠️ **Windows environment detected**\n>\n> The following settings are required for Claude-mem to work correctly:\n>\n> 1. **MCP settings adjustment**: Use `cmd /c` wrapper\n> 2. **Path format conversion**: Support Windows path format\n\n**Settings file update**:\n\nAdd the following to project's `.mcp.json` or `~/.claude/mcp.json`:\n\n```json\n{\n  \"mcpServers\": {\n    \"claude-mem\": {\n      \"command\": \"cmd\",\n      \"args\": [\"/c\", \"npx\", \"-y\", \"claude-mem-mcp\"],\n      \"env\": {\n        \"CLAUDE_MEM_MODE\": \"harness\"\n      }\n    }\n  }\n}\n```\n\n**Alternative settings (npx full path)**:\n\nIf npx is not found, specify the full path:\n\n```json\n{\n  \"mcpServers\": {\n    \"claude-mem\": {\n      \"command\": \"C:\\\\Program Files\\\\nodejs\\\\npx.cmd\",\n      \"args\": [\"-y\", \"claude-mem-mcp\"],\n      \"env\": {\n        \"CLAUDE_MEM_MODE\": \"harness\"\n      }\n    }\n  }\n}\n```\n\n**If using WSL (Recommended)**:\n\nIf running Claude Code in WSL environment, Unix settings can be used as-is.\n\n```json\n{\n  \"mcpServers\": {\n    \"claude-mem\": {\n      \"command\": \"npx\",\n      \"args\": [\"-y\", \"claude-mem-mcp\"],\n      \"env\": {\n        \"CLAUDE_MEM_MODE\": \"harness\"\n      }\n    }\n  }\n}\n```\n\n---\n\n### Step 3.6: WSL Environment Setup (Windows + WSL)\n\nDetailed settings for running Claude Code in WSL instead of Windows native.\n\n#### Prerequisites Check\n\n```bash\n# 1. Check if WSL2 is installed (run in PowerShell)\nwsl --version\n\n# 2. Check if Node.js is Linux version inside WSL\nwsl -e bash -c \"which node && which npm\"\n# Correct: /usr/bin/node, /usr/bin/npm\n# Problem: /mnt/c/Program Files/nodejs/node (referencing Windows version)\n```\n\n#### Resolving \"/bin/bash not found\" Issue\n\n**Symptom**:\n```\n/bin/bash: line 1: sh: command not found\n```\n\n**Cause**: WSL's PATH has Windows Node.js/npm prioritized\n\n**Solution**:\n\n```bash\n# 1. Run inside WSL - Disable Windows PATH\necho '[interop]\nappendWindowsPath = false' | sudo tee -a /etc/wsl.conf\n\n# 2. Restart WSL (run in PowerShell)\nwsl --shutdown\n\n# 3. Install Node.js inside WSL (nvm recommended)\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash\nsource ~/.bashrc\nnvm install --lts\nnvm use --lts\n\n# 4. Verify\nwhich node  # → /home/user/.nvm/versions/node/v20.x.x/bin/node\nwhich npm   # → /home/user/.nvm/versions/node/v20.x.x/bin/npm\n```\n\n#### Resolving \"Worker won't start on port 37777\" Issue\n\n**Symptom**:\n```\nWorker service failed to start on port 37777\nWorker failed to start (readiness check timed out after 20000ms)\n```\n\n**Cause**: Zombie process occupying port, or previous worker didn't terminate properly\n\n**Solution**:\n\n```bash\n# 1. Check port 37777 usage\n# Inside WSL\nlsof -i :37777\n# Or Windows (PowerShell)\nnetstat -ano | findstr 37777\n\n# 2. Terminate zombie processes\n# Inside WSL\npkill -f \"claude-mem\"\npkill -f \"bun\"\n\n# Windows (PowerShell - Administrator)\ntaskkill /F /IM bun.exe\ntaskkill /F /IM node.exe\n\n# 3. Check worker log\ncat ~/.claude-mem/logs/worker.log\n\n# 4. Manually restart worker\ncd ~/.claude/plugins/marketplaces/thedotmack\nnpm run worker:restart\n\n# 5. Restart Claude Code\n```\n\n#### WSL File Performance Optimization\n\n```bash\n# Place projects inside WSL filesystem (recommended)\n# ✅ Good example\ncd ~/projects/my-app\n\n# ❌ Bad example (slow)\ncd /mnt/c/Users/username/projects/my-app\n```\n\n> ⚠️ Performance significantly degrades under `/mnt/c/`.\n> Place projects under `~/`.\n\n---\n\n### Step 4: settings.json Update\n\nUpdate Claude-mem settings file.\n\n```bash\n# settings.json path\nCLAUDE_MEM_SETTINGS=\"$HOME/.claude-mem/settings.json\"\n\n# Create settings file if it doesn't exist\nif [ ! -f \"$CLAUDE_MEM_SETTINGS\" ]; then\n  mkdir -p \"$HOME/.claude-mem\"\n  echo '{}' > \"$CLAUDE_MEM_SETTINGS\"\nfi\n```\n\n**Settings content**:\n\n```json\n{\n  \"CLAUDE_MEM_MODE\": \"harness\"  // or \"harness--ja\"\n}\n```\n\nSet `\"harness--ja\"` if Japanese is selected.\n\n---\n\n### Step 5: Completion Confirmation\n\n> ✅ **Claude-mem integration complete!**\n>\n> **Settings:**\n> - Mode: `harness` (or `harness--ja`)\n> - Mode file: `~/.claude-mem/modes/harness.json`\n> - Settings file: `~/.claude-mem/settings.json`\n>\n> **Effective from next session.**\n>\n> **Verification:**\n> - Claude-mem starts in harness mode at next session start\n> - Check Claude-mem status with `/sync-status`\n>\n> **Usage:**\n> - Search past work history with `mem-search` skill\n> - Display past guardrail activation history at session-init\n> - Promote important observations to SSOT with `/sync-ssot-from-memory`\n\n---\n\n## Content Recorded in Harness Mode\n\n### observation_types\n\n| Type | Description | Emoji |\n|------|-------------|-------|\n| `plan` | Task additions/updates to Plans.md | 📋 |\n| `implementation` | Implementation following harness rules | 🛠️ |\n| `guard` | Guardrail activation (test-quality, implementation-quality) | 🛡️ |\n| `review` | Code review execution | 🔍 |\n| `ssot` | decisions.md/patterns.md updates | 📚 |\n| `handoff` | PM ↔ Impl role transitions | 🤝 |\n| `workflow` | Workflow improvements/automation | ⚙️ |\n\n### observation_concepts\n\n| Concept | Description |\n|---------|-------------|\n| `test-quality` | Test tampering prevention/quality enforcement |\n| `implementation-quality` | Stub/mock/hardcode prevention |\n| `harness-pattern` | Harness-specific reusable patterns |\n| `2-agent` | PM/Impl collaboration patterns |\n| `quality-gate` | Quality gate activation points |\n| `ssot-decision` | SSOT decision records |\n\n---\n\n## Use Cases\n\n### 1. Cross-session Guardrails\n\n```\nDay 1: Block test tampering\nClaude-mem: Record \"guard: blocked it.skip()\"\n\nDay 3 (different session):\nsession-init: \"This project has prevented test tampering 2 times in the past\"\n→ Warn about same mistake in advance\n```\n\n### 2. Long-term Task Context Maintenance\n\n```\nWeek 1: Feature X design complete\nClaude-mem: Record \"plan: Feature X design complete, adopted RBAC\"\n\nWeek 2 (different session):\nsession-init: \"Previous: Feature X design complete. Next: Implementation phase\"\n→ Immediately continue from where left off\n```\n\n### 3. Debug Pattern Learning\n\n```\nPast: Resolved CORS error\nClaude-mem: Record \"bugfix: CORS - added Access-Control-Allow-Origin\"\n\nPresent: Similar error occurs\nmem-search: Hits past solution\n→ Resolve in 5 minutes (previously 30 minutes)\n```\n\n---\n\n## Troubleshooting\n\n### WSL: /bin/bash not found\n\n```\n/bin/bash: line 1: sh: command not found\n```\n\n**Cause**: WSL inherits Windows PATH and references Windows version Node.js\n\n**Solution**: See \"Resolving /bin/bash not found Issue\" in Step 3.6\n\n**Related Issue**: [GitHub Issue #210](https://github.com/thedotmack/claude-mem/issues/210)\n\n---\n\n### WSL/Windows: Worker won't start on port 37777\n\n```\nWorker service failed to start on port 37777\nWorker failed to start (readiness check timed out after 20000ms)\n```\n\n> **First check claude-mem version**\n>\n> ```bash\n> cat ~/.claude/plugins/marketplaces/thedotmack/plugin/package.json | grep version\n> ```\n>\n> | Version | Action |\n> |---------|--------|\n> | **v7.3.7+** | Can be resolved with troubleshooting below |\n> | **v7.3.6 or earlier** | Strongly recommend upgrade to latest version |\n\n**If issue occurs on v7.3.7+**:\n\n```bash\n# 1. Terminate zombie processes\ntaskkill /F /IM bun.exe       # Windows\ntaskkill /F /IM node.exe      # Windows\n\n# 2. Delete PID file\ndel %USERPROFILE%\\.claude-mem\\worker.pid\n\n# 3. Restart Claude Code\n```\n\n---\n\n**For v7.3.6 or earlier (root causes)**:\n\n| Cause | Details |\n|-------|---------|\n| **PowerShell execution issue** | `.ps1` file opens in Notepad, or execution policy restrictions |\n| **Broken file associations** | `bun.ps1` wrapper doesn't execute correctly |\n| **Zombie processes** | Previous `bun.exe` / `node.exe` occupying port |\n| **Stale PID file** | `~/.claude-mem/worker.pid` holds old process info |\n\n**Why it doesn't occur in WSL**:\n- Shell scripts execute natively\n- No dependency on file associations\n- Unix standard process management (reliable signal handling)\n\n**Recommended solutions**:\n1. **Upgrade to latest version** (Recommended)\n2. **Migrate to WSL** (See Step 3.6)\n\n**Temporary workarounds for v7.3.6 or earlier** (limited effectiveness):\n\n```bash\n# 1. Check port usage\nnetstat -ano | findstr 37777  # Windows\nlsof -i :37777                 # WSL/Linux\n\n# 2. Terminate zombie processes\ntaskkill /F /IM bun.exe       # Windows\ntaskkill /F /IM node.exe      # Windows\npkill -f \"claude-mem\"          # WSL/Linux\n\n# 3. Delete PID file\ndel %USERPROFILE%\\.claude-mem\\worker.pid  # Windows\nrm ~/.claude-mem/worker.pid                # WSL/Linux\n\n# 4. Manually restart worker\ncd ~/.claude/plugins/marketplaces/thedotmack\nnpm run worker:restart\n\n# 5. Or directly run bun.exe (bypass PowerShell)\n%USERPROFILE%\\.bun\\bin\\bun.exe plugin/scripts/worker-service.cjs\n```\n\n> ⚠️ **Note**: The above workarounds are temporary and not fundamental solutions.\n> **WSL migration is strongly recommended.**\n\n**Related Issues**:\n- [Issue #380](https://github.com/thedotmack/claude-mem/issues/380) - Windows 11 port 37777 error\n- [Issue #209](https://github.com/thedotmack/claude-mem/issues/209) - Worker won't start on Windows\n\n---\n\n### Windows: ENOENT Error\n\n```\nENOENT: no such file or directory\nC:\\Users\\user\\AppData\\Local\\claude-cli-nodejs\\Cache\\...\n```\n\n**Cause**: Known issue with Windows path handling ([Issue #229](https://github.com/thedotmack/claude-mem/issues/229))\n\n**Solution**:\n\n1. **Use WSL** (Recommended)\n   ```bash\n   # Run Claude Code inside WSL\n   wsl\n   claude\n   ```\n\n2. **Manually create directory**\n   ```powershell\n   mkdir -p $env:LOCALAPPDATA\\claude-cli-nodejs\\Cache\n   ```\n\n3. **Wait for issue fix**\n   - Watch [Issue #229](https://github.com/thedotmack/claude-mem/issues/229)\n\n---\n\n### Windows: npx not found\n\n**Cause**: Node.js not included in PATH\n\n**Solution**:\n\n```json\n// Specify absolute path in .mcp.json\n{\n  \"mcpServers\": {\n    \"claude-mem\": {\n      \"command\": \"C:\\\\Program Files\\\\nodejs\\\\npx.cmd\",\n      \"args\": [\"-y\", \"claude-mem-mcp\"]\n    }\n  }\n}\n```\n\n---\n\n### Windows: .sh opens in VSCode/Cursor\n\n**Cause**: Windows file association issue ([Issue #9758](https://github.com/anthropics/claude-code/issues/9758))\n\n**Solution**: Use `bash` prefix in hooks.json\n\n```json\n// Before fix\n\"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/example.sh\"\n\n// After fix\n\"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/example.sh\"\n```\n\n> ⚠️ **Auto-applied in harness v2.6.7+**\n\n---\n\n### Claude-mem not working\n\n```bash\n# Check plugin list\n/plugin list\n\n# Check Claude-mem status\nls ~/.claude/plugins/marketplaces/thedotmack\n\n# Reinstall\n/plugin uninstall claude-mem\n/plugin install claude-mem\n```\n\n### Mode not applied\n\n```bash\n# Check settings.json\ncat ~/.claude-mem/settings.json\n\n# Verify CLAUDE_MEM_MODE is set\n# Correct: {\"CLAUDE_MEM_MODE\": \"harness\"}\n```\n\n### Not recording in Japanese\n\n```bash\n# Check if harness--ja mode is set\ncat ~/.claude-mem/settings.json\n# → Should be {\"CLAUDE_MEM_MODE\": \"harness--ja\"}\n\n# Check if mode file exists\nls ~/.claude-mem/modes/harness--ja.json\n```\n\n---\n\n## Disable\n\nTo disable harness mode in Claude-mem:\n\n```bash\n# Edit settings.json\n# Change CLAUDE_MEM_MODE back to \"code\", or delete it\n```\n\n```json\n{\n  \"CLAUDE_MEM_MODE\": \"code\"\n}\n```\n\n---\n\n## Cursor Integration\n\n> **v2.6.18+**: Use the official claude-mem v8.5.0+ feature for Cursor integration.\n>\n> ```bash\n> # Run in claude-mem repository\n> git clone https://github.com/thedotmack/claude-mem.git\n> cd claude-mem\n> bun install\n> bun run cursor:install\n> ```\n>\n> See [claude-mem CHANGELOG](https://github.com/thedotmack/claude-mem/blob/main/CHANGELOG.md) for details.\n\n---\n\n## Related Commands/Skills\n\n| Command/Skill | Purpose |\n|---------------|---------|\n| `/sync-ssot-from-memory` | Promote important Claude-mem observations to SSOT |\n| `mem-search` | Search past work history |\n| `session-init` | Display past context at session start (with Claude-mem integration) |\n| `/harness-init` | Project initialization (Claude-mem integration is separate via `/harness-mem`) |\n",
        "opencode/commands/optional/harness-ui-setup.md": "---\ndescription: \"[Deprecated] Set up harness-ui dashboard - Use /harness-ui instead\"\nuser-invocable: false\n---\n\n# /harness-ui-setup - [Deprecated]\n\n> **This command has been deprecated and merged into `/harness-ui`.**\n>\n> `/harness-ui` now automatically detects whether setup is needed and enters setup mode when license key is not configured.\n>\n> **Use `/harness-ui` instead.**\n\n## Migration Guide\n\n| Old Command | New Command |\n|-------------|-------------|\n| `/harness-ui-setup` | `/harness-ui` (auto-setup mode) |\n| `/harness-ui-setup YOUR-KEY` | `/harness-ui YOUR-KEY` |\n| `/harness-ui-setup --force` | `/harness-ui --force` |\n\n## Why Deprecated?\n\n1. **Improved UX**: Users no longer need to remember two separate commands\n2. **Auto-detection**: `/harness-ui` automatically enters setup mode when needed\n3. **Unified interface**: Single command for both setup and dashboard access\n\n## See Also\n\n- `/harness-ui` - Unified dashboard display and setup command\n",
        "opencode/commands/optional/harness-ui.md": "---\ndescription: Open harness-ui dashboard (auto-setup if needed)\n---\n\n# /harness-ui - Dashboard Display & Setup\n\nOpen harness-ui dashboard. Automatically switches to setup mode if not configured.\n\n## VibeCoder Phrases\n\n- \"**Open the dashboard**\" → this command\n- \"**I want to see harness-ui**\" → this command\n- \"**Check status in UI**\" → this command\n- \"**Enable harness-ui**\" → this command (auto-setup)\n- \"**I want to use the dashboard**\" → this command (auto-setup)\n- \"**I want to see health score in UI**\" → this command (auto-setup)\n\n## Deliverables\n\n- Open harness-ui in browser\n- Check server status\n- Display registered projects list\n- Auto-setup if license key is not configured\n\n---\n\n## Execution Flow\n\n### Step 1: License Key Check (Mode Detection)\n\n```bash\n# Check environment variable\necho $HARNESS_BETA_CODE\n```\n\n**If key is set (not empty):**\n→ Proceed to **Dashboard Mode (Step 2)**\n\n**If key is not set or empty:**\n→ Proceed to **Setup Mode (Step S1)**\n\n---\n\n## Dashboard Mode\n\n### Step 2: Server Status Check\n\n```bash\n# Check harness-ui server status\ncurl -s --connect-timeout 2 http://localhost:37778/api/status\n```\n\n**If server is running:**\n→ Proceed to Step 3\n\n**If server is not running:**\n\n> ⚠️ **harness-ui server is not running**\n>\n> Restart Claude Code to auto-start.\n>\n> Or to start manually:\n> ```bash\n> cd {plugin directory}/harness-ui && npm run dev\n> ```\n\n**End processing**\n\n### Step 3: Get Project Information\n\n```bash\n# Get registered projects list\ncurl -s http://localhost:37778/api/projects\n```\n\n### Step 4: Display Information\n\nDisplay the following information:\n\n> 📊 **harness-ui Dashboard**\n>\n> **URL**: http://localhost:37778\n>\n> **Server Status**: ✅ Running\n>\n> **Registered Projects**:\n> | Project | Path |\n> |---------|------|\n> | {name1} | {path1} |\n> | {name2} | {path2} |\n>\n> 💡 Open http://localhost:37778 in your browser to view the dashboard.\n\n### Step 5: Open in Browser (Optional)\n\nAsk user:\n\n> Open dashboard in browser? (Y/n)\n\n**If Y:**\n```bash\nopen http://localhost:37778  # macOS\n# or\nxdg-open http://localhost:37778  # Linux\n```\n\n---\n\n## Setup Mode\n\n> 🔑 **License key not found. Starting harness-ui setup...**\n\n### Step S1: License Key Input\n\n**If command has argument (e.g., `/harness-ui YOUR-KEY`):**\n→ Use the argument as license key, proceed to Step S2\n\n**If no argument:**\n\n> 🔑 **Please enter your Polar license key**\n>\n> If you don't have a license key, please request one from the administrator as this is a beta version.\n>\n> Enter key:\n\n**Wait for response**\n\n### Step S2: License Key Validation\n\nValidate key with Polar API:\n\n```typescript\n// POST https://api.polar.sh/v1/customer-portal/license-keys/validate\n{\n  \"key\": \"user's key\",\n  \"organization_id\": \"54443411-11a2-45b0-9473-7aa37f96a677\"\n}\n```\n\n**If validation succeeds:**\n→ Proceed to Step S3\n\n**If validation fails:**\n\n> ❌ **Invalid license key**\n>\n> Reason: {error reason}\n>\n> Please verify the correct key or contact administrator.\n\n**End processing**\n\n### Step S3: Set Environment Variable\n\nAdd environment variable to user's shell config file (`~/.zshrc` or `~/.bashrc`):\n\n```bash\nexport HARNESS_BETA_CODE=\"user's license key\"\n```\n\n### Step S3.5: Add MCP Settings (Enable harness-ui)\n\nCreate `.mcp.json` in plugin root to enable harness-ui MCP server.\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nTEMPLATE_PATH=\"$PLUGIN_ROOT/templates/mcp/harness-ui.mcp.json.template\"\nTARGET_PATH=\"$PLUGIN_ROOT/.mcp.json\"\n\n# Check if template exists\nif [ -f \"$TEMPLATE_PATH\" ]; then\n  # Create .mcp.json (overwrite if exists)\n  cp \"$TEMPLATE_PATH\" \"$TARGET_PATH\"\n  echo \"✅ MCP settings created: $TARGET_PATH\"\nelse\n  echo \"⚠️ Template not found: $TEMPLATE_PATH\"\n  echo \"Please create .mcp.json manually\"\nfi\n```\n\n**Generated `.mcp.json` content:**\n\n```json\n{\n  \"harness-ui\": {\n    \"command\": \"bun\",\n    \"args\": [\"${CLAUDE_PLUGIN_ROOT}/harness-ui/src/mcp/server.ts\"],\n    \"env\": {\n      \"PROJECT_ROOT\": \"${CLAUDE_PLUGIN_ROOT}\",\n      \"HARNESS_BETA_CODE\": \"${HARNESS_BETA_CODE}\"\n    }\n  }\n}\n```\n\n> 💡 **Why is this step necessary?**\n>\n> harness-ui is an optional feature, so it's not registered as an MCP server by default.\n> Only users who run setup can use the harness-ui MCP.\n\n### Step S4: Install Dependencies\n\nInstall harness-ui dependencies:\n\n```bash\ncd ${CLAUDE_PLUGIN_ROOT}/harness-ui && bun install\n```\n\n**If Bun is not installed:**\n\n```bash\n# macOS / Linux\ncurl -fsSL https://bun.sh/install | bash\n\n# Windows (PowerShell)\npowershell -c \"irm bun.sh/install.ps1 | iex\"\n```\n\n**Verify successful installation:**\n\n```bash\nls ${CLAUDE_PLUGIN_ROOT}/harness-ui/node_modules | head -5\n```\n\n→ Success if package names are displayed\n\n### Step S5: Apply Environment Variables and Verify Server Startup\n\n```bash\n# Apply environment variables\nsource ~/.zshrc  # or source ~/.bashrc\n\n# Manually start harness-ui server (for verification)\ncd ${CLAUDE_PLUGIN_ROOT}/harness-ui && bun run dev &\n```\n\n**Verify startup:**\n\n```bash\ncurl -s http://localhost:37778/api/status\n```\n\n→ Success if `{\"status\":\"ok\"...}` is returned\n\n### Step S6: Register Current Project\n\nAfter server starts, register current project to dropdown:\n\n```bash\n# Get current project\nPROJECT_PATH=$(pwd)\nPROJECT_NAME=$(basename \"$PROJECT_PATH\")\n\n# Register project\ncurl -s -X POST http://localhost:37778/api/projects \\\n  -H \"Content-Type: application/json\" \\\n  -d \"{\\\"name\\\": \\\"$PROJECT_NAME\\\", \\\"path\\\": \\\"$PROJECT_PATH\\\"}\"\n```\n\n**Success response:**\n\n```json\n{\"project\":{\"id\":\"proj_xxx\",\"name\":\"your-project\",\"path\":\"/path/to/project\"}}\n```\n\n**If already registered:**\n\n```json\n{\"error\":\"Project with path \\\"/path/to/project\\\" already exists\"}\n```\n\n→ No problem even with error (existing project will be used)\n\n### Step S7: Plans.md Format Check (If needed)\n\nIf Plans.md has old format (`cursor:WIP` / `cursor:completed`), migrate to appropriate markers **based on context**.\n\n**Migration approach:**\n\n| Old Marker | Context | New Marker |\n|------------|---------|------------|\n| `cursor:WIP` | Claude Code is working | `cc:WIP` |\n| `cursor:WIP` | PM (Cursor) is working | `pm:requested` or keep |\n| `cursor:completed` | Implementation complete | `cc:done` |\n| `cursor:completed` | PM confirmed | `pm:confirmed` |\n\n**For 2-Agent operation:**\n- `cursor:requested` / `cursor:confirmed` remain valid (same as `pm:*`)\n- No need to force conversion\n\n**If migration is needed:**\nAsk Claude Code to \"migrate old format markers in Plans.md to new format based on context\".\n\n### Step S8: Completion Message → Dashboard Mode\n\n> ✅ **harness-ui setup complete!**\n>\n> 📋 **Settings:**\n> - License key: {first 8 characters of key}...\n> - Customer ID: {customer ID}\n> - Environment variable: Added `HARNESS_BETA_CODE` to ~/.zshrc\n> - **MCP settings**: `.mcp.json` created\n> - Dependencies: Installed\n> - Project registration: Complete\n>\n> **Verification:**\n> 1. **Restart Claude Code** (to apply MCP settings)\n> 2. Access http://localhost:37778 in browser\n> 3. Verify current project name appears in top-right dropdown\n> 4. From next time, auto-start & auto-register when Claude Code launches\n>\n> 💡 **Hint**: If dropdown shows only \"All Projects\", re-run project registration from Step S6.\n\nAfter setup completion, automatically proceed to **Dashboard Mode (Step 2)** to show current status.\n\n---\n\n## Related Commands\n\n- `/validate` - Plugin validation\n- `/harness-update` - Plugin update\n- `/harness-init` - Project initialization (auto Plans.md generation)\n\n---\n\n## Troubleshooting\n\n### Server won't start\n\n1. Restart Claude Code\n2. Check if port 37778 is in use: `lsof -i :37778`\n3. Check if environment variable `HARNESS_BETA_CODE` is set\n\n### Want to reset license key\n\nRun `/harness-ui --force YOUR-NEW-KEY` to reconfigure.\n\n### Error: Cannot find module / node_modules not found\n\n**Cause**: Dependencies not installed\n\n**Solution**:\n```bash\ncd ${CLAUDE_PLUGIN_ROOT}/harness-ui\nbun install\n```\n\n### Error: bun: command not found\n\n**Cause**: Bun is not installed\n\n**Solution**:\n```bash\n# macOS / Linux\ncurl -fsSL https://bun.sh/install | bash\nsource ~/.bashrc  # or source ~/.zshrc\n\n# Verify\nbun --version\n```\n\n### Error: Invalid license key\n\n**Cause**: Key is incorrect or expired\n\n**Solution**:\n1. Re-verify the received key\n2. Re-run `/harness-ui YOUR-KEY`\n\n### Error: harness-ui won't start\n\n**Cause**: Environment variable not set, or Claude Code not restarted\n\n**Solution**:\n```bash\n# Check environment variable\necho $HARNESS_BETA_CODE\n\n# If not set\nsource ~/.zshrc\n\n# Restart Claude Code\nCtrl+C to exit → restart with claude\n```\n\n### Error: Port 37778 in use\n\n**Cause**: Another process is using the port\n\n**Solution**:\n```bash\nlsof -i :37778\nkill -9 {PID}\n```\n\n### Project not showing in dropdown\n\n**Cause**: Project not registered\n\n**Solution**:\n```bash\n# Verify server is running\ncurl -s http://localhost:37778/api/status\n\n# Manually register project\nPROJECT_PATH=$(pwd)\nPROJECT_NAME=$(basename \"$PROJECT_PATH\")\ncurl -s -X POST http://localhost:37778/api/projects \\\n  -H \"Content-Type: application/json\" \\\n  -d \"{\\\"name\\\": \\\"$PROJECT_NAME\\\", \\\"path\\\": \\\"$PROJECT_PATH\\\"}\"\n\n# Check registered projects list\ncurl -s http://localhost:37778/api/projects | jq\n```\n\n---\n\n## Plans.md Format Requirements\n\nharness-ui auto project registration requires one of the following:\n\n### Method 1: Run `/harness-init` (Recommended)\n\n```bash\n/harness-init\n```\n\n→ `.claude-code-harness-version` marker file is created and auto-recognized.\n\n### Method 2: Include correct markers in Plans.md\n\nInclude the following markers in Plans.md:\n\n**New format (Recommended):**\n\n| Marker | Meaning |\n|--------|---------|\n| `cc:TODO` | Pending task |\n| `cc:WIP` | In-progress task |\n| `cc:done` | Completed task |\n| `cc:blocked` | Blocked |\n| `pm:requested` | Requested by PM |\n| `pm:confirmed` | Confirmed by PM |\n\n**Old format (compatible, deprecated):**\n\n| Marker | Migration target |\n|--------|------------------|\n| `cursor:WIP` → | `cc:WIP` |\n| `cursor:completed` → | `cc:done` |\n\n**Template:**\n\n```markdown\n# Plans.md\n\n## Task List\n\n- [ ] Task 1 `cc:TODO`\n- [x] Task 2 `cc:done`\n```\n\n---\n\n## Notes\n\n- License key is validated online via Polar API\n- harness-ui won't start with invalid key\n- Developers can bypass with `HARNESS_UI_DEV=true`\n\n## Security\n\nLicense key is managed via environment variable (`HARNESS_BETA_CODE`).\n\n- **Do not include in repository**: Add `.env` file to `.gitignore`\n- **Shell config file**: `~/.zshrc` is normally outside Git management, so it's safe\n- **For team development**: Recommend each member obtains individual license key\n",
        "opencode/commands/optional/harness-update.md": "---\ndescription: Safely update harness-enabled projects to latest version (version detection → backup → non-destructive update)\n---\n\n# /harness-update - Harness Update\n\nSafely update projects with existing harness to the latest harness version.\n**Version detection → Backup → Non-destructive update** flow preserves existing settings and tasks while introducing latest features.\n\n## When to Use\n\n- \"I want to update harness to the latest version\"\n- \"I want to add new features to existing project\"\n- \"I want to update config file format to latest version\"\n- \"I want to fix incorrect permission syntax\"\n- \"I was notified of template updates\"\n\n## Deliverables\n\n- Version detection via `.claude-code-harness-version`\n- **Template update detection and localization judgment**\n- Identify files needing update\n- Auto-backup creation\n- Non-destructive settings/workflow file updates\n- **No localization → overwrite / Localized → merge support**\n- **Skills diff detection** - Auto-detect and propose new skills\n- Post-update verification\n\n---\n\n## Execution Flow\n\n### Phase 1: Version Detection and Confirmation\n\n#### Step 1: Check Harness Installation Status\n\nCheck `.claude-code-harness-version` file:\n\n```bash\nif [ -f .claude-code-harness-version ]; then\n  CURRENT_VERSION=$(grep \"^version:\" .claude-code-harness-version | cut -d' ' -f2)\n  echo \"Detected version: $CURRENT_VERSION\"\nelse\n  echo \"⚠️ Harness not installed in this project\"\n  echo \"→ Use /harness-init instead\"\n  exit 1\nfi\n```\n\n**If harness not installed:**\n> ⚠️ **Harness is not installed in this project**\n>\n> `/harness-update` is for projects with existing harness.\n> Use `/harness-init` for new installation.\n\n**If installed:** → Step 2\n\n#### Step 2: Version Comparison\n\nCompare with plugin's latest version:\n\n```bash\nPLUGIN_VERSION=$(cat \"$CLAUDE_PLUGIN_ROOT/claude-code-harness/VERSION\" 2>/dev/null || echo \"unknown\")\n\nif [ \"$CURRENT_VERSION\" = \"$PLUGIN_VERSION\" ]; then\n  echo \"ℹ️ Version is latest (v$PLUGIN_VERSION)\"\n  echo \"→ Running file content check...\"\nelse\n  echo \"📦 Update available: v$CURRENT_VERSION → v$PLUGIN_VERSION\"\nfi\n```\n\n**If versions differ:** → Step 3\n\n**If versions same:** → Step 2.5 (content check)\n\n> ⚠️ **Important**: Even if versions match, individual file content may be outdated.\n> Step 2.5 runs `template-tracker.sh check` to detect content-level updates.\n\n#### Step 2.5: File Content Check (When Version Same)\n\nCheck for outdated file content even with same version:\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n# Content-based update check with template-tracker.sh check\nCHECK_RESULT=$(bash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" check 2>/dev/null)\n\n# Get update counts from JSON\nNEEDS_CHECK=$(echo \"$CHECK_RESULT\" | jq -r '.needsCheck // false')\nUPDATES_COUNT=$(echo \"$CHECK_RESULT\" | jq -r '.updatesCount // 0')\nINSTALLS_COUNT=$(echo \"$CHECK_RESULT\" | jq -r '.installsCount // 0')\n\nif [ \"$NEEDS_CHECK\" = \"true\" ]; then\n  echo \"📦 File content updates needed\"\n  echo \"   - Updates: ${UPDATES_COUNT} files\"\n  echo \"   - New: ${INSTALLS_COUNT} files\"\nelse\n  echo \"✅ All files are up to date\"\nfi\n```\n\n**If files need updates:**\n\n> 📦 **File content updates detected**\n>\n> Version is v{{VERSION}} (same), but the following file content is outdated:\n>\n> | File | Status | Action |\n> |------|--------|--------|\n> {{update target list}}\n>\n> Continue with update? (yes / no / show details)\n\n**Wait for response**\n\n- **yes** → Step 3 (carry over update target list)\n- **no** → End\n- **show details** → Show `template-tracker.sh status` details, then confirm again\n\n**If all files up to date:**\n\n> ✅ **Project is completely up to date**\n>\n> - Version: v{{VERSION}}\n> - All file content: Up to date\n>\n> No update needed.\n\n#### Step 3: Template Update Check\n\nRun `template-tracker.sh status` to show template update status:\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nbash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" status\n```\n\n**Example output:**\n\n```\n=== Template Tracking Status ===\n\nPlugin version: 2.5.25\nLast checked at: 2.5.20\n\nFile                                      Recorded     Latest       Status\n----                                      --------     ------       ------\nCLAUDE.md                                 2.5.20       2.5.25       🔄 Overwrite OK\nAGENTS.md                                 unknown      2.5.25       ⚠️ Needs check\nPlans.md                                  2.5.20       2.5.25       🔧 Merge needed\n.claude/rules/workflow.md                 2.5.20       2.5.25       ✅ Latest\n\nLegend:\n  ✅ Latest      : No update needed\n  🔄 Overwrite OK: Not localized, can overwrite\n  🔧 Merge needed: Localized, requires merge\n  ⚠️ Needs check : Unknown version, check recommended\n```\n\n#### Step 4: Confirm Update Scope\n\nIdentify target files and confirm with user:\n\n> 📦 **Update: v{{CURRENT}} → v{{LATEST}}**\n>\n> **Files to update:**\n> - `.claude/settings.json` - Update security policy and latest syntax\n> - `AGENTS.md` / `CLAUDE.md` / `Plans.md` - Update to latest format (existing tasks preserved)\n> - `.claude/rules/` - Update to latest rule templates\n> - `.cursor/commands/` - Update Cursor commands (for 2-Agent mode)\n> - `.claude-code-harness-version` - Update version info\n>\n> **Existing data preserved:**\n> - ✅ Incomplete tasks in Plans.md\n> - ✅ Custom settings in .claude/settings.json (hooks, env, model, etc.)\n> - ✅ SSOT data in .claude/memory/\n>\n> **Backup:**\n> - Pre-change files saved to `.claude-code-harness/backups/{{TIMESTAMP}}/`\n>\n> Execute update? (yes / no / custom)\n>\n> **Custom**: Select \"custom\" to update only specific files\n\n**Wait for response**\n\n- **yes** → Phase 1.5 (breaking changes check)\n- **no** → End\n- **custom** → Phase 2A (selective update)\n\n---\n\n## Phase 1.5: Breaking Changes Detection and Confirmation\n\n**Important**: Detect existing settings issues and confirm with user before update.\n\n### Step 1: Inspect .claude/settings.json\n\nLoad existing `.claude/settings.json` and check:\n\n```bash\n# Check if settings.json exists\nif [ ! -f .claude/settings.json ]; then\n  echo \"ℹ️ .claude/settings.json doesn't exist (will be created)\"\n  # → Phase 2 (no breaking changes)\nfi\n\n# Load with JSON parser (jq or python)\nif command -v jq >/dev/null 2>&1; then\n  SETTINGS_CONTENT=$(cat .claude/settings.json)\nelse\n  echo \"⚠️ jq not found. Manual check needed\"\nfi\n```\n\n### Step 2: Detect Issues\n\nDetect the following issues:\n\n#### 🔴 Issue 1: Incorrect Permission Syntax\n\n> **Note (v2.1.20+)**: `Bash(*)` is now treated as equivalent to `Bash` (full wildcard).\n> This is NOT an error. Only prefix patterns without colons are incorrect.\n\n```bash\n# Search for incorrect syntax patterns\nWRONG_PATTERNS=(\n  'Bash\\([^:)]+\\s\\*\\)'     # \"Bash(npm run *)\" pattern\n  'Bash\\([^:)]+\\*\\)'       # \"Bash(git diff*)\" pattern (no colon)\n  'Bash\\(\\*[^:][^)]*\\*\\)'  # \"Bash(*credentials*)\" pattern\n)\n\nFOUND_ISSUES=()\n\n# Check each pattern\nif echo \"$SETTINGS_CONTENT\" | grep -E 'Bash\\([^:)]+\\s\\*\\)'; then\n  FOUND_ISSUES+=(\"incorrect_prefix_syntax_with_space\")\nfi\n\n# Note: \"Bash(*)\" alone is valid since v2.1.20 (wildcard = Bash)\n# Extract only Bash(...) substrings first, then check for missing colon\n# e.g., \"Bash(git diff*)\" is wrong, \"Bash(git diff:*)\" is correct\nif echo \"$SETTINGS_CONTENT\" | grep -oE 'Bash\\([^)]+\\)' | grep -E 'Bash\\([^:)]+\\*\\)'; then\n  FOUND_ISSUES+=(\"incorrect_prefix_syntax_no_colon\")\nfi\n\nif echo \"$SETTINGS_CONTENT\" | grep -E 'Bash\\(\\*[^:][^)]*\\*\\)'; then\n  FOUND_ISSUES+=(\"incorrect_substring_syntax\")\nfi\n```\n\n#### 🔴 Issue 2: Deprecated Settings\n\n```bash\n# Check for disableBypassPermissionsMode\nif echo \"$SETTINGS_CONTENT\" | grep -q '\"disableBypassPermissionsMode\"'; then\n  FOUND_ISSUES+=(\"deprecated_disable_bypass_permissions\")\nfi\n```\n\n#### 🔴 Issue 3: Old Hook Settings (Harness-originated only)\n\n```bash\n# Detect only hooks with commands containing \"claude-code-harness\"\n# User's custom hooks (different paths) are excluded\nPLUGIN_EVENTS=(\"PreToolUse\" \"SessionStart\" \"UserPromptSubmit\" \"PermissionRequest\")\nOLD_HARNESS_EVENTS=()\n\nif command -v jq >/dev/null 2>&1; then\n  for event in \"${PLUGIN_EVENTS[@]}\"; do\n    if jq -e \".hooks.${event}\" \"$SETTINGS_FILE\" >/dev/null 2>&1; then\n      # Extract command paths and check for \"claude-code-harness\"\n      COMMANDS=$(jq -r \".hooks.${event}[]?.hooks[]?.command // .hooks.${event}[]?.command // empty\" \"$SETTINGS_FILE\" 2>/dev/null)\n      if echo \"$COMMANDS\" | grep -q \"claude-code-harness\"; then\n        OLD_HARNESS_EVENTS+=(\"$event\")\n      fi\n    fi\n  done\n\n  if [ ${#OLD_HARNESS_EVENTS[@]} -gt 0 ]; then\n    FOUND_ISSUES+=(\"legacy_hooks_in_settings\")\n    echo \"Old harness hook settings: ${OLD_HARNESS_EVENTS[*]}\"\n  fi\nfi\n```\n\n### Step 3: Display Detection Results\n\nIf issues found, show details to user:\n\n> ⚠️ **Issues found in existing settings**\n>\n> **🔴 Issue 1: Incorrect Permission Syntax (3 items)**\n>\n> ```diff\n> - \"Bash(npm run *)\"      ❌ Wrong (space+asterisk)\n> + \"Bash(npm run:*)\"      ✅ Correct (colon+asterisk)\n>\n> - \"Bash(pnpm *)\"         ❌ Wrong\n> + \"Bash(pnpm:*)\"         ✅ Correct\n>\n> - \"Bash(git diff*)\"      ❌ Wrong (no colon)\n> + \"Bash(git diff:*)\"     ✅ Correct\n> ```\n>\n> **Impact**: Current permission settings are not working correctly.\n> Claude Code may not be able to execute these commands.\n>\n> ---\n>\n> **🔴 Issue 2: Deprecated Settings (1 item)**\n>\n> ```diff\n> - \"disableBypassPermissionsMode\": \"disable\"   ❌ Deprecated (since v2.5.0)\n> (Remove this setting)\n> ```\n>\n> **Reason**: Harness changed to allow bypassPermissions since v2.5.0.\n> Only dangerous operations are controlled via `permissions.deny` / `permissions.ask`.\n>\n> **Impact**: With current settings, confirmation prompts appear for every Edit/Write, reducing productivity.\n>\n> ---\n>\n> **🔴 Issue 3: Old Hook Settings (N items)**\n>\n> ```diff\n> - \"hooks\": { ... }   ❌ Duplicates plugin hooks.json\n> (Remove this setting)\n> ```\n>\n> **Reason**: claude-code-harness plugin manages hooks via `hooks/hooks.json`.\n> Having `hooks` in project's `.claude/settings.json` may cause unintended duplicate behavior.\n>\n> **Recommendation**: Remove `hooks` section from project and use only plugin hooks.\n>\n> ---\n>\n> **Auto-fix these issues?**\n>\n> - **yes** - Auto-fix all issues above and continue update\n> - **review** - Review each issue individually before fixing\n> - **skip** - Continue update without fixing (not recommended)\n> - **cancel** - Abort update\n\n**Wait for response**\n\n#### Choice Processing\n\n- **yes** → Auto-fix all issues → Phase 2\n- **review** → Step 4 (individual review)\n- **skip** → Phase 2 (continue without fixing, show warning)\n- **cancel** → Abort update\n\n### Step 4: Individual Review (When \"review\" selected)\n\nReview each issue individually:\n\n> **Issue 1/2: Incorrect Permission Syntax**\n>\n> Fix these 3 items?\n> - `\"Bash(npm run *)\"` → `\"Bash(npm run:*)\"`\n> - `\"Bash(pnpm *)\"` → `\"Bash(pnpm:*)\"`\n> - `\"Bash(git diff*)\"` → `\"Bash(git diff:*)\"`\n>\n> (yes / no)\n\n**Wait for response** → Add to fix list if yes\n\n> **Issue 2/2: Deprecated Settings**\n>\n> Remove `disableBypassPermissionsMode`?\n>\n> (yes / no)\n\n**Wait for response** → Add to delete list if yes\n\nAfter all confirmations → Phase 2\n\n---\n\n## Phase 2: Backup and Update\n\n> **Design principle**: Create update target list first, continue until all files processed. No early termination.\n\n### Step 0: Create Update Target List (At Phase 2 start)\n\n**Manage files detected in Phase 1 or Step 2.5 as list** and continue until all processed:\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n# Get template-tracker.sh check results\nCHECK_RESULT=$(bash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" check 2>/dev/null)\n\n# Create update target lists\nUPDATE_LIST=()\nINSTALL_LIST=()\n\nif command -v jq >/dev/null 2>&1; then\n  # Files needing update\n  while IFS= read -r line; do\n    [ -n \"$line\" ] && UPDATE_LIST+=(\"$line\")\n  done < <(echo \"$CHECK_RESULT\" | jq -r '.updates[]?.path // empty')\n\n  # Files needing creation\n  while IFS= read -r line; do\n    [ -n \"$line\" ] && INSTALL_LIST+=(\"$line\")\n  done < <(echo \"$CHECK_RESULT\" | jq -r '.installs[]?.path // empty')\nfi\n\nTOTAL_COUNT=$((${#UPDATE_LIST[@]} + ${#INSTALL_LIST[@]}))\nCOMPLETED_COUNT=0\n\necho \"📋 Update target list: ${TOTAL_COUNT} files\"\necho \"   - Updates: ${#UPDATE_LIST[@]} files\"\necho \"   - New: ${#INSTALL_LIST[@]} files\"\n```\n\n**Progress tracking**:\n\n```\nUpdate target list (5 files)\n├── [1/5] ⏳ CLAUDE.md - Waiting\n├── [2/5] ⏳ AGENTS.md - Waiting\n├── [3/5] ⏳ .claude/rules/workflow.md - Waiting\n├── [4/5] ⏳ .claude/settings.json - Waiting\n└── [5/5] ⏳ Plans.md - Waiting\n```\n\n### Step 1: Create Backup Directory\n\n```bash\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\nBACKUP_DIR=\".claude-code-harness/backups/$TIMESTAMP\"\nmkdir -p \"$BACKUP_DIR\"\n\n# Copy backup target files\n[ -f .claude/settings.json ] && cp .claude/settings.json \"$BACKUP_DIR/\"\n[ -f AGENTS.md ] && cp AGENTS.md \"$BACKUP_DIR/\"\n[ -f CLAUDE.md ] && cp CLAUDE.md \"$BACKUP_DIR/\"\n[ -f Plans.md ] && cp Plans.md \"$BACKUP_DIR/\"\n[ -d .claude/rules ] && cp -r .claude/rules \"$BACKUP_DIR/\"\n[ -d .cursor/commands ] && cp -r .cursor/commands \"$BACKUP_DIR/\"\n\necho \"✅ Backup created: $BACKUP_DIR\"\n```\n\n### Step 2: Update Settings File\n\n**`.claude/settings.json` update**\n\nFix issues detected in Phase 1.5 before running `generate-claude-settings` skill.\n\n#### Step 2.1: Apply Breaking Changes (If approved in Phase 1.5)\n\nApply user-approved fixes:\n\n```bash\n# Load settings.json\nSETTINGS_FILE=\".claude/settings.json\"\n\n# Issue 1: Fix permission syntax\nif [ -f \"$SETTINGS_FILE\" ]; then\n  # Replace space+asterisk with colon+asterisk\n  # e.g.: \"Bash(npm run *)\" → \"Bash(npm run:*)\"\n  sed -i.bak 's/Bash(\\([^:)]*\\) \\*)/Bash(\\1:*)/g' \"$SETTINGS_FILE\"\n\n  # Replace colon-less asterisk with colon+asterisk\n  # e.g.: \"Bash(git diff*)\" → \"Bash(git diff:*)\"\n  # (skip if already has :)\n  sed -i.bak 's/Bash(\\([^:)]*\\)\\*)/Bash(\\1:*)/g' \"$SETTINGS_FILE\"\n\n  # Fix substring matching\n  # e.g.: \"Bash(*credentials*)\" → \"Bash(:*credentials:*)\"\n  sed -i.bak 's/Bash(\\*\\([^:][^)]*\\)\\*)/Bash(:*\\1:*)/g' \"$SETTINGS_FILE\"\n\n  echo \"✅ Fixed permission syntax\"\nfi\n\n# Issue 2: Remove deprecated settings\nif [ -f \"$SETTINGS_FILE\" ]; then\n  # Remove disableBypassPermissionsMode (using jq)\n  if command -v jq >/dev/null 2>&1; then\n    jq 'del(.permissions.disableBypassPermissionsMode)' \"$SETTINGS_FILE\" > \"$SETTINGS_FILE.tmp\"\n    mv \"$SETTINGS_FILE.tmp\" \"$SETTINGS_FILE\"\n    echo \"✅ Removed disableBypassPermissionsMode\"\n  else\n    # Use Python if jq not available\n    python3 -c \"\nimport json\nwith open('$SETTINGS_FILE', 'r') as f:\n    data = json.load(f)\nif 'permissions' in data and 'disableBypassPermissionsMode' in data['permissions']:\n    del data['permissions']['disableBypassPermissionsMode']\nwith open('$SETTINGS_FILE', 'w') as f:\n    json.dump(data, f, indent=2)\n\" && echo \"✅ Removed disableBypassPermissionsMode\"\n  fi\nfi\n\n# Issue 3: Remove only harness-originated hook settings (identify by path)\n# Preserve user's custom hooks\nif [ -f \"$SETTINGS_FILE\" ]; then\n  PLUGIN_EVENTS=(\"PreToolUse\" \"SessionStart\" \"UserPromptSubmit\" \"PermissionRequest\")\n  DELETED_EVENTS=()\n\n  if command -v jq >/dev/null 2>&1; then\n    for event in \"${PLUGIN_EVENTS[@]}\"; do\n      if jq -e \".hooks.${event}\" \"$SETTINGS_FILE\" >/dev/null 2>&1; then\n        # Delete only if command path contains \"claude-code-harness\"\n        COMMANDS=$(jq -r \".hooks.${event}[]?.hooks[]?.command // .hooks.${event}[]?.command // empty\" \"$SETTINGS_FILE\" 2>/dev/null)\n        if echo \"$COMMANDS\" | grep -q \"claude-code-harness\"; then\n          jq \"del(.hooks.${event})\" \"$SETTINGS_FILE\" > \"$SETTINGS_FILE.tmp\"\n          mv \"$SETTINGS_FILE.tmp\" \"$SETTINGS_FILE\"\n          DELETED_EVENTS+=(\"$event\")\n        fi\n      fi\n    done\n\n    # Delete .hooks itself if empty\n    if jq -e '.hooks | length == 0' \"$SETTINGS_FILE\" >/dev/null 2>&1; then\n      jq 'del(.hooks)' \"$SETTINGS_FILE\" > \"$SETTINGS_FILE.tmp\"\n      mv \"$SETTINGS_FILE.tmp\" \"$SETTINGS_FILE\"\n    fi\n\n    if [ ${#DELETED_EVENTS[@]} -gt 0 ]; then\n      echo \"✅ Removed old harness hook settings: ${DELETED_EVENTS[*]} (using plugin hooks.json)\"\n    fi\n  else\n    # Use Python if jq not available\n    python3 -c \"\nimport json\nwith open('$SETTINGS_FILE', 'r') as f:\n    data = json.load(f)\nif 'hooks' in data:\n    plugin_events = ['PreToolUse', 'SessionStart', 'UserPromptSubmit', 'PermissionRequest']\n    deleted = []\n    for event in plugin_events:\n        if event in data['hooks']:\n            # Check if command path contains 'claude-code-harness'\n            hooks_list = data['hooks'][event]\n            is_harness = any('claude-code-harness' in str(h) for h in hooks_list)\n            if is_harness:\n                del data['hooks'][event]\n                deleted.append(event)\n    if not data['hooks']:\n        del data['hooks']\n    if deleted:\n        print(f'✅ Removed old harness hook settings: {\\\" \\\".join(deleted)}')\nwith open('$SETTINGS_FILE', 'w') as f:\n    json.dump(data, f, indent=2)\n\"\n  fi\nfi\n```\n\n#### Step 2.2: Run generate-claude-settings Skill\n\n- Preserve `env`, `model`, `enabledPlugins` (`hooks` already removed)\n- Merge `permissions.allow|ask|deny` with latest policy + deduplicate\n- Preserve correct syntax fixed in Phase 1.5\n- Add new recommended settings\n\n### Step 3: Update Workflow Files (Template Tracking Support)\n\n**Update processing based on template tracking status**:\n\nBranch processing based on each file's status:\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n# Get template tracking check results\nCHECK_RESULT=$(bash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" check 2>/dev/null)\n\n# Process files needing update using jq\nif command -v jq >/dev/null 2>&1; then\n  echo \"$CHECK_RESULT\" | jq -r '.updates[]? | \"\\(.path)|\\(.localized)\"' | while IFS='|' read -r path localized; do\n    if [ \"$localized\" = \"false\" ]; then\n      # Not localized → overwrite\n      echo \"🔄 Overwriting: $path\"\n      # Generate from template and overwrite\n      # → Run generate-* skill\n    else\n      # Localized → merge support\n      echo \"🔧 Merge support: $path\"\n      # Show diff and confirm with user\n    fi\n  done\nfi\n```\n\n**For not localized (🔄 Overwrite OK)**:\n\nAuto-replace with latest template:\n- `AGENTS.md` / `CLAUDE.md`: Overwrite with latest template\n- `.claude/rules/*.md`: Overwrite with latest rule templates\n\n**For localized (🔧 Merge needed)**:\n\n> 🔧 **`Plans.md` is localized**\n>\n> This file contains project-specific changes.\n>\n> **Options:**\n> 1. **Show diff** - View differences from template\n> 2. **Merge support** - Claude suggests merge\n> 3. **Skip** - Skip this file\n>\n> Select:\n\n**Wait for response**\n\nIf merge support selected:\n- Maintain latest template structure\n- Re-position user's custom parts (tasks, settings) appropriately\n- Show diff and get final confirmation\n\n**After update recording:**\n\n```bash\n# Record updated files in generated-files.json\nbash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" record \"$path\"\n```\n\n### Step 4: Update Rule Files\n\n`.claude/rules/` update:\n\n**Safely update using marker + hash method for localization detection.**\n\n```bash\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nPLUGIN_VERSION=$(cat \"$PLUGIN_PATH/VERSION\" 2>/dev/null || echo \"unknown\")\nSKILLS_CONFIG=\".claude/state/skills-config.json\"\n\n# Check Skills Gate status\nSKILLS_GATE_ENABLED=\"false\"\nif [ -f \"$SKILLS_CONFIG\" ]; then\n  if command -v jq >/dev/null 2>&1; then\n    SKILLS_GATE_ENABLED=$(jq -r '.enabled // false' \"$SKILLS_CONFIG\")\n  fi\nfi\n\n# Process each rule template\nfor template in \"$PLUGIN_PATH/templates/rules\"/*.template; do\n  [ -f \"$template\" ] || continue\n\n  rule_name=$(basename \"$template\" .template)\n  output_file=\".claude/rules/$rule_name\"\n\n  # Check conditional template (get condition from template-registry.json)\n  TEMPLATE_KEY=\"rules/$(basename \"$template\")\"\n  CONDITION=\"\"\n  if command -v jq >/dev/null 2>&1; then\n    CONDITION=$(jq -r \".templates[\\\"$TEMPLATE_KEY\\\"].condition // \\\"\\\"\" \"$PLUGIN_PATH/templates/template-registry.json\" 2>/dev/null)\n  fi\n\n  # Evaluate conditional templates\n  if [ -n \"$CONDITION\" ]; then\n    case \"$CONDITION\" in\n      \"skills_gate.enabled\")\n        if [ \"$SKILLS_GATE_ENABLED\" != \"true\" ]; then\n          # Condition not met\n          if [ -f \"$output_file\" ]; then\n            echo \"🗑️ Suggest deletion: $output_file (Skills Gate disabled)\"\n          else\n            echo \"⏭️ Skip: $rule_name (Skills Gate disabled)\"\n          fi\n          continue\n        fi\n        ;;\n    esac\n  fi\n\n  # Create new if file doesn't exist\n  if [ ! -f \"$output_file\" ]; then\n    cp \"$template\" \"$output_file\"\n    sed -i '' \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \"$output_file\" 2>/dev/null || \\\n    sed -i \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \"$output_file\"\n    echo \"🆕 Created: $output_file\"\n    continue\n  fi\n\n  # Check marker (is it harness-originated)\n  if grep -q \"^_harness_template:\" \"$output_file\" 2>/dev/null; then\n    # Harness-originated → detect localization and update\n    # Compare hash of content after frontmatter\n    INSTALLED_VERSION=$(grep \"^_harness_version:\" \"$output_file\" | sed 's/_harness_version: \"//;s/\"//')\n\n    if [ \"$INSTALLED_VERSION\" != \"$PLUGIN_VERSION\" ]; then\n      # Different version → update target\n      # (Localization detection delegated to template-tracker.sh)\n      echo \"🔄 Updating: $output_file ($INSTALLED_VERSION → $PLUGIN_VERSION)\"\n      cp \"$template\" \"$output_file\"\n      sed -i '' \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \"$output_file\" 2>/dev/null || \\\n      sed -i \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \"$output_file\"\n    else\n      echo \"✅ Latest: $output_file\"\n    fi\n  else\n    # No marker → user custom, protect\n    echo \"🛡️ Protected: $output_file (user custom)\"\n  fi\ndone\n```\n\n**Decision logic:**\n\n| Marker | Condition | Action |\n|--------|-----------|--------|\n| Yes | No condition / condition met | Update (localization detection) |\n| Yes | Condition not met | Suggest deletion |\n| No | - | Protect (user custom) |\n\n#### Skills Gate Enablement Proposal\n\nIf Skills Gate is disabled and `skills-gate.md` doesn't exist, propose enablement.\n\n```bash\n# If Skills Gate disabled, propose enablement\nif [ \"$SKILLS_GATE_ENABLED\" != \"true\" ]; then\n  echo \"\"\n  echo \"💡 Enable Skills Gate?\"\n  echo \"\"\n  echo \"Skills Gate prompts skill usage before code editing.\"\n  echo \"- Rules: Make Claude recognize 'should use skills'\"\n  echo \"- Hooks: Last line of defense if forgotten\"\n  echo \"\"\n  echo \"If enabled:\"\n  echo \"- skills-gate.md rule will be added\"\n  echo \"- Skill usage becomes habitual, improving work quality\"\n  echo \"\"\nfi\n```\n\n**Wait for response**\n\n- **yes** → Enable Skills Gate and add `skills-gate.md`\n- **no** → Skip\n\n```bash\n# If user selected yes\nif [ \"$USER_CHOICE\" = \"yes\" ]; then\n  # Enable skills-config.json\n  if [ -f \"$SKILLS_CONFIG\" ]; then\n    jq '.enabled = true' \"$SKILLS_CONFIG\" > tmp.json && mv tmp.json \"$SKILLS_CONFIG\"\n  else\n    mkdir -p .claude/state\n    cat > \"$SKILLS_CONFIG\" << EOF\n{\n  \"version\": \"1.0\",\n  \"enabled\": true,\n  \"skills\": [\"impl\", \"review\"],\n  \"updated_at\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n}\nEOF\n  fi\n\n  # Add skills-gate.md\n  cp \"$PLUGIN_PATH/templates/rules/skills-gate.md.template\" \".claude/rules/skills-gate.md\"\n  sed -i '' \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \".claude/rules/skills-gate.md\" 2>/dev/null || \\\n  sed -i \"s/{{VERSION}}/$PLUGIN_VERSION/g\" \".claude/rules/skills-gate.md\"\n  echo \"✅ Skills Gate enabled\"\n  echo \"✅ Created: .claude/rules/skills-gate.md\"\nfi\n```\n\n### Step 4.5: Skills Settings Diff Detection and Update\n\nCompare plugin skills with project settings to detect and propose diffs.\n\n#### Step 4.5.1: Get Plugin Skills List\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nSKILLS_CONFIG=\".claude/state/skills-config.json\"\nmkdir -p .claude/state\n\n# Get available skills list from plugin\nAVAILABLE_SKILLS=()\nif [ -d \"$PLUGIN_ROOT/skills\" ]; then\n  for skill_dir in \"$PLUGIN_ROOT/skills\"/*/; do\n    if [ -d \"$skill_dir\" ]; then\n      skill_name=$(basename \"$skill_dir\")\n      AVAILABLE_SKILLS+=(\"$skill_name\")\n    fi\n  done\nfi\n\necho \"📦 Plugin available skills: ${AVAILABLE_SKILLS[*]}\"\n```\n\n#### Step 4.5.2: Get Project Settings\n\n```bash\nif [ -f \"$SKILLS_CONFIG\" ]; then\n  # Get skills list from existing settings\n  if command -v jq >/dev/null 2>&1; then\n    CURRENT_SKILLS=$(jq -r '.skills[]?' \"$SKILLS_CONFIG\" 2>/dev/null | tr '\\n' ' ')\n  else\n    CURRENT_SKILLS=\"\"\n  fi\n  echo \"📋 Project registered skills: $CURRENT_SKILLS\"\nelse\n  CURRENT_SKILLS=\"\"\n  echo \"📋 Project registered skills: (not configured)\"\nfi\n```\n\n#### Step 4.5.3: Detect Diffs\n\n```bash\nNEW_SKILLS=()\nREMOVED_SKILLS=()\n\n# Skills in plugin but not in project (new candidates)\nfor skill in \"${AVAILABLE_SKILLS[@]}\"; do\n  if ! echo \"$CURRENT_SKILLS\" | grep -qw \"$skill\"; then\n    NEW_SKILLS+=(\"$skill\")\n  fi\ndone\n\n# Skills in project but not in plugin (removal candidates)\nfor skill in $CURRENT_SKILLS; do\n  found=false\n  for avail in \"${AVAILABLE_SKILLS[@]}\"; do\n    if [ \"$skill\" = \"$avail\" ]; then\n      found=true\n      break\n    fi\n  done\n  if [ \"$found\" = false ]; then\n    REMOVED_SKILLS+=(\"$skill\")\n  fi\ndone\n```\n\n#### Step 4.5.4: Propose If Diffs Found\n\n**If new skills detected:**\n\n> 🆕 **New skills available**\n>\n> The following skills have been added:\n> {{NEW_SKILLS list and descriptions}}\n>\n> **Add them?**\n> - **yes** - Add all\n> - **select** - Select individually\n> - **skip** - Don't add now\n\n**Wait for response**\n\n- **yes** → Add all new skills to skills-config.json\n- **select** → Review each skill individually\n- **skip** → Don't update skills-config.json\n\n**If removed skills detected:**\n\n> ⚠️ **The following skills have been removed from plugin**\n>\n> {{REMOVED_SKILLS list}}\n>\n> Remove from settings? (yes / no)\n\n**Wait for response**\n\n#### Step 4.5.5: Update skills-config.json\n\n```bash\nif [ -f \"$SKILLS_CONFIG\" ]; then\n  # Preserve existing settings while adding new skills\n  if command -v jq >/dev/null 2>&1; then\n    # Add approved new skills\n    for skill in \"${APPROVED_NEW_SKILLS[@]}\"; do\n      jq --arg s \"$skill\" '.skills += [$s] | .skills |= unique' \"$SKILLS_CONFIG\" > tmp.json\n      mv tmp.json \"$SKILLS_CONFIG\"\n    done\n\n    # Remove deleted skills\n    for skill in \"${APPROVED_REMOVED_SKILLS[@]}\"; do\n      jq --arg s \"$skill\" '.skills -= [$s]' \"$SKILLS_CONFIG\" > tmp.json\n      mv tmp.json \"$SKILLS_CONFIG\"\n    done\n\n    # Update version and timestamp\n    jq '.version = \"1.0\" | .updated_at = \"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\"' \"$SKILLS_CONFIG\" > tmp.json\n    mv tmp.json \"$SKILLS_CONFIG\"\n    echo \"✅ skills-config.json: Updated\"\n  else\n    echo \"⚠️ jq not found. Skills settings auto-update skipped\"\n    echo \"   Run /skills-update manually or install jq\"\n  fi\nelse\n  # Create new (default skills + approved new skills)\n  DEFAULT_SKILLS='[\"impl\", \"review\"]'\n  cat > \"$SKILLS_CONFIG\" << SKILLSEOF\n{\n  \"version\": \"1.0\",\n  \"enabled\": true,\n  \"skills\": $DEFAULT_SKILLS,\n  \"updated_at\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n}\nSKILLSEOF\n  echo \"✅ skills-config.json: Created\"\nfi\n```\n\n> 💡 **About Skills Diff Detection**\n> - When plugin update adds new skills, auto-detected and proposed\n> - Existing skill settings preserved\n> - Individual skill add/remove also available with `/skills-update` command\n\n### Step 5: Update Cursor Commands (For 2-Agent mode)\n\nUpdate only if `.cursor/commands/` exists.\n\n**IMPORTANT: Cursor commands are ALWAYS overwritten, never merged.**\n\nUnlike other workflow files, Cursor command templates:\n- Are **not localized** (users should not modify them)\n- Should be **completely replaced** with latest plugin templates\n- Do **NOT read existing files** before updating\n\n**Update procedure**:\n\n1. **Do NOT read** existing `.cursor/commands/*.md` files\n2. **Read only** from plugin templates: `templates/cursor/commands/*.md`\n3. **Overwrite** target files completely with template content\n\n```bash\nif [ -d .cursor/commands ]; then\n  PLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n  # OVERWRITE (not merge) with latest command templates\n  for cmd in \"$PLUGIN_PATH/templates/cursor/commands\"/*.md; do\n    if [ -f \"$cmd\" ]; then\n      # Skip CLAUDE.md (claude-mem context file)\n      [ \"$(basename \"$cmd\")\" = \"CLAUDE.md\" ] && continue\n      cp \"$cmd\" .cursor/commands/\n      echo \"✅ Overwritten: $(basename $cmd)\"\n    fi\n  done\nfi\n```\n\n**Target files** (5 commands):\n- `start-session.md` - Session start\n- `plan-with-cc.md` - Plan creation\n- `handoff-to-claude.md` - Task handoff\n- `review-cc-work.md` - Implementation review\n- `project-overview.md` - Project overview\n\n### Step 6: Hooks Permission Check (Auto-execute)\n\n**Auto-fix execution permissions for shell scripts in `.claude/hooks/`**:\n\n```bash\n# Check and fix .claude/hooks/*.sh execution permissions\nif [ -d .claude/hooks ]; then\n  FIXED_COUNT=0\n  for script in .claude/hooks/*.sh; do\n    [ -f \"$script\" ] || continue\n    if [ ! -x \"$script\" ]; then\n      chmod +x \"$script\"\n      echo \"✅ Fixed permission: $script\"\n      FIXED_COUNT=$((FIXED_COUNT + 1))\n    fi\n  done\n  if [ \"$FIXED_COUNT\" -gt 0 ]; then\n    echo \"ℹ️ Fixed execution permissions for $FIXED_COUNT shell script(s)\"\n  fi\nfi\n```\n\n**Why this matters**: Shell scripts without execution permission (`chmod +x`) will fail to run as hooks, causing silent failures or errors.\n\n### Step 7: Update Version File\n\nUpdate `.claude-code-harness-version` to latest:\n\n```bash\ncat > .claude-code-harness-version <<EOF\n# claude-code-harness version tracking\n# This file is auto-generated by /harness-update\n# DO NOT manually edit - used for update detection\n\nversion: $PLUGIN_VERSION\ninstalled_at: $(grep \"^installed_at:\" .claude-code-harness-version | cut -d' ' -f2)\nupdated_at: $(date +%Y-%m-%d)\nlast_setup_command: harness-update\nEOF\n\necho \"✅ Version updated: v$CURRENT_VERSION → v$PLUGIN_VERSION\"\n```\n\n---\n\n## Phase 2A: Selective Update (Custom selection)\n\n> 📋 **Which files to update?**\n>\n> 1. `.claude/settings.json` - Security policy and permission syntax\n> 2. `AGENTS.md` / `CLAUDE.md` / `Plans.md` - Workflow files\n> 3. `.claude/rules/` - Rule templates\n> 4. `.cursor/commands/` - Cursor commands (2-Agent mode)\n> 5. All\n>\n> Select by number (multiple ok, comma-separated):\n\n**Wait for response**\n\nExecute only selected files' Phase 2 steps.\n\n---\n\n## Phase 3: Verification and Completion\n\n### Step 1: Post-Update Re-verification (Confirm All Files Latest)\n\n**Important**: Run `template-tracker.sh check` again after update to **confirm all files are now latest**.\n\n```bash\nPLUGIN_ROOT=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n# Re-verify\nVERIFY_RESULT=$(bash \"$PLUGIN_ROOT/scripts/template-tracker.sh\" check 2>/dev/null)\n\nREMAINING_UPDATES=$(echo \"$VERIFY_RESULT\" | jq -r '.updatesCount // 0')\nREMAINING_INSTALLS=$(echo \"$VERIFY_RESULT\" | jq -r '.installsCount // 0')\nREMAINING_TOTAL=$((REMAINING_UPDATES + REMAINING_INSTALLS))\n\nif [ \"$REMAINING_TOTAL\" -gt 0 ]; then\n  echo \"⚠️ Some files not yet updated: ${REMAINING_TOTAL} files\"\n  echo \"   Retry update or manual intervention needed\"\nelse\n  echo \"✅ All files updated to latest\"\nfi\n```\n\n**If remaining:**\n\n> ⚠️ **Some files not updated**\n>\n> | File | Status | Reason |\n> |------|--------|--------|\n> {{remaining files list}}\n>\n> **Options:**\n> 1. **Retry** - Re-run update process\n> 2. **Manual** - Manually merge localized files\n> 3. **Skip** - End as-is (re-detected on next `/harness-update`)\n\n**Wait for response**\n\n- **Retry** → Return to Phase 2, process remaining files\n- **Manual** → Show list and instructions for manual intervention files\n- **Skip** → Step 2 (include warning in completion report)\n\n### Step 2: Syntax Check\n\n```bash\n# settings.json syntax check\nif command -v jq >/dev/null 2>&1; then\n  jq empty .claude/settings.json 2>/dev/null && echo \"✅ settings.json: Valid\" || echo \"⚠️ settings.json: Syntax error\"\nfi\n\n# Verify version file\n[ -f .claude-code-harness-version ] && echo \"✅ version file: Exists\" || echo \"⚠️ version file: Missing\"\n```\n\n### Step 3: Update Completion Report\n\n**Processing results summary**:\n\n```\n📊 Update Report\n\nProcessing results:\n├── Updated: N files\n├── Created: N files\n├── Skipped: N files (with reasons)\n└── Manual: N files\n\nFile-by-file results:\n├── [1/5] ✅ CLAUDE.md - Overwrite complete\n├── [2/5] ✅ AGENTS.md - Overwrite complete\n├── [3/5] ✅ .claude/rules/workflow.md - Overwrite complete\n├── [4/5] ✅ .claude/settings.json - Merge complete\n└── [5/5] 🔧 Plans.md - Manual merge recommended\n```\n\n> ✅ **Update complete!**\n>\n> **Update summary:**\n> - Version: v{{CURRENT}} → v{{LATEST}}\n> - Files processed: {{processed}}/{{total}} files\n> - Update method: Overwrite {{N}} / Merge {{N}} / Manual {{N}}\n> - Backup: `.claude-code-harness/backups/{{TIMESTAMP}}/`\n>\n> **File-by-file results:**\n>\n> | File | Result | Method |\n> |------|--------|--------|\n> {{file-by-file results list}}\n>\n> **Next steps:**\n> - \"`/sync-status`\" → Check current status\n> - \"`/plan-with-agent` I want to build XXX\" → Add new tasks\n> - \"`/work`\" → Execute Plans.md tasks\n>\n> **If issues occur:**\n> ```bash\n> # Restore from backup\n> cp -r .claude-code-harness/backups/{{TIMESTAMP}}/* .\n> ```\n\n---\n\n## Phase 2B: Selective Update (Custom selection)\n\nUpdate only user-selected files.\n\n---\n\n## Notes\n\n- **Backup required**: Always create backup before update\n- **Existing data preserved**: Plans.md tasks, settings.json custom settings preserved\n- **Non-destructive merge**: Existing files merged, not overwritten\n- **Don't forget verification**: Check status with `/sync-status` after update\n\n---\n\n## Troubleshooting\n\n### Q: Settings disappeared after update\n\nA: Restore from backup:\n```bash\ncp -r .claude-code-harness/backups/{{TIMESTAMP}}/* .\n```\n\n### Q: Permission syntax error occurs\n\nA: Manually fix `.claude/settings.json` or run `/harness-update` again.\nCorrect syntax: `\"Bash(npm run:*)\"` / Wrong: `\"Bash(npm run *)\"`\n\n### Q: I want to update only specific files\n\nA: Select \"custom\" and choose only needed files.\n\n---\n\n## Related Commands\n\n- `/harness-init` - New project setup\n- `/sync-status` - Check current project status\n- `/validate` - Validate project structure\n",
        "opencode/commands/optional/localize-rules.md": "---\ndescription: \"[オプション] プロジェクト構造に合わせてルールをローカライズ\"\n---\n\n# /localize-rules\n\nプロジェクトの構造を分析し、`.claude/rules/` のルールファイルをプロジェクトに最適化します。\n\n## バイブコーダー向け（こう言えばOK）\n\n- 「**このプロジェクト用のルールに合わせて**」→ このコマンド\n- 「**このリポジトリの構造に合わせてルールを整えて**」→ ディレクトリ/言語/テスト構成を自動検出して反映します\n- 「**何を決めればいいか分からない**」→ まず“検出→提案”して、必要なものだけ確定します\n\n## できること（成果物）\n\n- `.claude/rules/` のルールを、実プロジェクトの構造に合わせて更新する\n- 以後の作業で「触って良い場所/テスト/規約」がブレにくくなる\n\n---\n\n## このコマンドの目的\n\nジェネリックなルールテンプレートを、実際のプロジェクト構造に合わせてカスタマイズします：\n\n- **paths:** を実際のソースディレクトリに合わせる（`src/`, `app/`, `lib/` など）\n- 言語固有のルールを追加（TypeScript, Python, React など）\n- テストディレクトリを自動検出\n\n---\n\n## 実行手順（必須）\n\n以下のスクリプトを実行してください：\n\n```bash\nbash \"${CLAUDE_PLUGIN_ROOT}/scripts/localize-rules.sh\"\n```\n\nまたは dry-run で確認：\n\n```bash\nbash \"${CLAUDE_PLUGIN_ROOT}/scripts/localize-rules.sh\" --dry-run\n```\n\n> 補足: `CLAUDE_PLUGIN_ROOT` が使えない環境では、プラグインリポジトリ直下から `bash ./scripts/localize-rules.sh` を実行してください。\n\n---\n\n## 検出項目\n\n### 言語・フレームワーク\n\n| 検出ファイル | 言語/フレームワーク |\n|-------------|---------------------|\n| `package.json` + `tsconfig.json` | TypeScript |\n| `package.json` + `react` | React |\n| `package.json` + `next` | Next.js |\n| `requirements.txt` / `pyproject.toml` | Python |\n| `go.mod` | Go |\n| `Cargo.toml` | Rust |\n| `Gemfile` | Ruby |\n\n### ソースディレクトリ\n\n優先順位で検出：\n1. `src/`, `app/`, `lib/`\n2. `pages/`, `app/` (Next.js)\n3. Python パッケージディレクトリ\n\n### テストディレクトリ\n\n- `tests/`, `test/`, `__tests__/`, `spec/`, `e2e/`\n- Colocated tests (`*.test.ts`, `*.spec.js`)\n\n---\n\n## 出力例\n\n### TypeScript + React プロジェクト\n\n```markdown\n---\npaths: \"src/**/*.{ts,tsx,js,jsx}\"\n---\n\n# Coding Standards\n\n## TypeScript 固有\n- `any` は使用禁止\n- 戻り値の型は明示する\n\n## React 固有\n- 関数コンポーネントを使用\n- カスタムフックは `use` プレフィックス\n```\n\n### Python プロジェクト\n\n```markdown\n---\npaths: \"mypackage/**/*.py, src/**/*.py\"\n---\n\n# Coding Standards\n\n## Python 固有\n- PEP 8 スタイルガイドに従う\n- 型ヒントを使用する\n```\n\n---\n\n## 注意事項\n\n- 既存のカスタマイズは上書きされます\n- バックアップを取ってから実行することを推奨\n- `--dry-run` で事前確認が可能\n",
        "opencode/commands/optional/lsp-setup.md": "---\ndescription: \"[Optional] LSP setup (Language Server installation and configuration)\"\n---\n\n# /lsp-setup - LSP Setup\n\nIntroduce and configure LSP (Language Server Protocol) functionality to existing projects.\n\n## VibeCoder Phrases\n\n- \"**Enable LSP**\" → this command\n- \"**Enable code jumping**\" → Enable Go-to-definition\n- \"**I want to detect type errors beforehand**\" → Configure LSP Diagnostics\n\n## Deliverables\n\n1. Auto-detect project languages\n2. Check and install required language servers\n3. **Install official LSP plugins**\n4. Run verification tests\n\n---\n\n## Official LSP Plugins (Recommended)\n\nOfficial LSP plugins available in Claude Code marketplace:\n\n| Plugin | Language | Required Language Server |\n|--------|----------|-------------------------|\n| `typescript-lsp` | TypeScript/JavaScript | typescript-language-server |\n| `pyright-lsp` | Python | pyright |\n| `rust-analyzer-lsp` | Rust | rust-analyzer |\n\n> **Important**: Plugins do **not include** language server binaries.\n> Separate installation is required.\n\n---\n\n## Setup Flow\n\n### Phase 1: Language Detection\n\n```\n🔍 Detecting Project Languages\n\nDetection files:\n├── tsconfig.json → TypeScript ✅\n├── package.json → JavaScript/TypeScript ✅\n├── requirements.txt → Python ✅\n├── pyproject.toml → Python ✅\n├── Cargo.toml → Rust\n└── go.mod → Go\n\nDetection results:\n├── TypeScript ✅\n└── Python ✅\n```\n\n### Phase 2: Language Server Check and Installation\n\n```\n🔧 Language Server Status\n\n| Language | Language Server | Status |\n|----------|-----------------|--------|\n| TypeScript | typescript-language-server | ❌ Not installed |\n| Python | pyright | ❌ Not installed |\n\n❌ Some language servers are not installed.\n```\n\n> **Install them?**\n>\n> - **yes** - Auto install (Recommended)\n> - **manual** - Show commands only\n> - **skip** - Continue without LSP\n\n**Wait for response**\n\n#### If \"yes\" selected: Auto Installation\n\n```bash\necho \"📦 Installing language servers...\"\n\n# TypeScript\nnpm install -g typescript typescript-language-server\necho \"✅ typescript-language-server installation complete\"\n\n# Python\npip install pyright\n# or npm install -g pyright\necho \"✅ pyright installation complete\"\n\n# Verify installation\nwhich typescript-language-server && echo \"✅ TypeScript LSP: OK\"\nwhich pyright && echo \"✅ Python LSP: OK\"\n```\n\n#### If \"manual\" selected: Display Commands\n\n```\n📋 Please run the following commands:\n\n# TypeScript/JavaScript\nnpm install -g typescript typescript-language-server\n\n# Python\npip install pyright\n# or\nnpm install -g pyright\n\n# Rust\n# rust-analyzer official installation: https://rust-analyzer.github.io/manual.html#installation\n\nAfter installation, run /lsp-setup again.\n```\n\n### Phase 3: Official Plugin Installation\n\n```\n📦 Installing official LSP plugins...\n```\n\n```bash\n# Install plugins for detected languages\nclaude plugin install typescript-lsp\nclaude plugin install pyright-lsp\n\necho \"✅ LSP plugin installation complete\"\n```\n\n```\n✅ Installed plugins:\n\n| Plugin | Status |\n|--------|--------|\n| typescript-lsp | ✅ Installed |\n| pyright-lsp | ✅ Installed |\n```\n\n### Phase 4: Verification\n\n```\n✅ LSP Verification\n\nTest: Go-to-definition\n  → src/index.ts:15 'handleSubmit' → src/handlers.ts:42 ✅\n\nTest: Find-references\n  → 'userId' references: 8 found ✅\n\nTest: Diagnostics\n  → Errors: 0 / Warnings: 2 ✅\n\n🎉 LSP Setup Complete!\n```\n\n---\n\n## Language Server and Plugin Reference Table\n\n| Language | Language Server | Install Command | Official Plugin |\n|----------|-----------------|-----------------|-----------------|\n| **TypeScript/JS** | typescript-language-server | `npm install -g typescript typescript-language-server` | `typescript-lsp` |\n| **Python** | pyright | `pip install pyright` or `npm install -g pyright` | `pyright-lsp` |\n| **Rust** | rust-analyzer | [Official guide](https://rust-analyzer.github.io/manual.html#installation) | `rust-analyzer-lsp` |\n| **Go** | gopls | `go install golang.org/x/tools/gopls@latest` | `gopls-lsp` |\n| **C/C++** | clangd | macOS: `brew install llvm` / Ubuntu: `apt install clangd` | `clangd-lsp` |\n| **Java** | jdtls | [Official guide](https://github.com/eclipse/eclipse.jdt.ls) | `jdtls-lsp` |\n| **Swift** | sourcekit-lsp | Included with Xcode | `swift-lsp` |\n| **Lua** | lua-language-server | [Official guide](https://github.com/LuaLS/lua-language-server) | `lua-lsp` |\n| **PHP** | intelephense | `npm install -g intelephense` | `php-lsp` |\n| **C#** | omnisharp | [Official guide](https://github.com/OmniSharp/omnisharp-roslyn) | `csharp-lsp` |\n\n---\n\n## Zero to Setup Guide (Summary)\n\nSteps to enable LSP from a completely unconfigured state:\n\n```bash\n# Step 1: Install language servers\nnpm install -g typescript typescript-language-server  # TypeScript\npip install pyright                                    # Python\n\n# Step 2: Install official plugins\nclaude plugin install typescript-lsp\nclaude plugin install pyright-lsp\n\n# Step 3: Start Claude Code (LSP auto-enabled)\nclaude\n```\n\nNow Go-to-definition, Find-references, and Diagnostics are available.\n\n---\n\n## Creating Custom LSP Plugins\n\nIf official plugins don't exist in the marketplace for your language, or if you need custom LSP server configuration, you can create custom plugins (`.lsp.json`).\n\n> **Note**: TypeScript/JS, Python, Rust, Go, C/C++, Java, Swift, Lua, PHP, C# have official plugins. First search \"lsp\" with `/plugin`.\n\n### `.lsp.json` Format\n\n**Example**: Starting Go LSP server with custom settings\n\n```json\n{\n  \"go\": {\n    \"command\": \"gopls\",\n    \"args\": [\"serve\"],\n    \"extensionToLanguage\": {\n      \".go\": \"go\"\n    }\n  }\n}\n```\n\n### Required Fields\n\n| Field | Description |\n|-------|-------------|\n| `command` | LSP server binary name (must exist in PATH) |\n| `extensionToLanguage` | File extension → language identifier mapping |\n\n### Optional Fields\n\n| Field | Description |\n|-------|-------------|\n| `args` | Command line arguments |\n| `env` | Environment variables |\n| `initializationOptions` | Initialization options |\n| `startupTimeout` | Startup timeout (milliseconds) |\n| `restartOnCrash` | Auto-restart on crash |\n\n### Custom Plugin Creation Example\n\n```bash\n# Create directory\nmkdir my-go-lsp\nmkdir my-go-lsp/.claude-plugin\n\n# plugin.json\ncat > my-go-lsp/.claude-plugin/plugin.json << 'EOF'\n{\n  \"name\": \"my-go-lsp\",\n  \"description\": \"Go LSP support\",\n  \"version\": \"1.0.0\",\n  \"author\": { \"name\": \"Your Name\" },\n  \"lspServers\": \"./.lsp.json\"\n}\nEOF\n\n# .lsp.json\ncat > my-go-lsp/.lsp.json << 'EOF'\n{\n  \"go\": {\n    \"command\": \"gopls\",\n    \"args\": [\"serve\"],\n    \"extensionToLanguage\": {\n      \".go\": \"go\"\n    }\n  }\n}\nEOF\n\n# Install\nclaude plugin install ./my-go-lsp\n```\n\n---\n\n## Troubleshooting\n\n### \"Executable not found in $PATH\" Error\n\nLanguage server is not installed or not in PATH.\n\n```bash\n# Check path\necho $PATH\n\n# Check and add npm global path\nexport PATH=\"$PATH:$(npm config get prefix)/bin\"\n```\n\n### Check Plugin Errors\n\n```\nCheck \"Errors\" tab with /plugin command\n```\n\n### LSP Not Responding\n\n1. Restart Claude Code\n2. Verify language server is correctly installed\n3. Check plugin status with `/plugin`\n\n---\n\n## Related Documentation\n\n- [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md) - LSP Usage Guide\n- [Claude Code Plugins Reference](https://code.claude.com/docs/en/plugins-reference) - Official Plugin Reference\n",
        "opencode/commands/optional/mcp-setup.md": "---\ndescription: Harness MCP サーバーをセットアップ（クロスクライアント連携）\n---\n\n# /mcp-setup - MCP サーバーセットアップ\n\nHarness MCP サーバーをセットアップして、**Claude Code、Codex、Cursor 間のセッション通信**を有効にします。\n\n## VibeCoder Quick Reference\n\n- \"**Codex と連携したい**\" → このコマンド\n- \"**別のAIツールと一緒に使いたい**\" → MCP セットアップ\n- \"**セッション共有したい**\" → クロスクライアント通信を有効化\n\n## Deliverables\n\n- MCP サーバーの設定ファイル\n- クライアント別の設定手順\n- 動作確認ガイド\n\n---\n\n## Usage\n\n```bash\n/mcp-setup\n```\n\n---\n\n## Execution Flow\n\n### Step 1: クライアント選択\n\n> 🔧 **どのクライアントで MCP を使用しますか？**\n>\n> 1. Claude Code のみ\n> 2. Claude Code + Codex\n> 3. Claude Code + Cursor\n> 4. すべて（Claude Code + Codex + Cursor）\n>\n> 番号で回答（デフォルト: 1）\n\n**ユーザーの回答を待つ**\n\n### Step 2: 設定ファイル生成\n\n選択に応じて設定ファイルを生成：\n\n#### Claude Code 設定\n\n`.claude/settings.json` に追記：\n\n```json\n{\n  \"mcpServers\": {\n    \"harness\": {\n      \"command\": \"node\",\n      \"args\": [\"${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js\"]\n    }\n  }\n}\n```\n\n#### Codex 設定（選択時）\n\n`~/.codex/mcp.json` を生成：\n\n```json\n{\n  \"servers\": {\n    \"harness\": {\n      \"command\": \"node\",\n      \"args\": [\"/path/to/claude-code-harness/mcp-server/dist/index.js\"]\n    }\n  }\n}\n```\n\n#### Cursor 設定（選択時）\n\n`.cursor/mcp.json` を生成：\n\n```json\n{\n  \"harness\": {\n    \"command\": \"node\",\n    \"args\": [\"/path/to/claude-code-harness/mcp-server/dist/index.js\"]\n  }\n}\n```\n\n### Step 3: MCP サーバービルド\n\n```bash\ncd \"${CLAUDE_PLUGIN_ROOT}/mcp-server\"\nnpm install\nnpm run build\n```\n\n### Step 4: 動作確認\n\n> ✅ **MCP セットアップ完了**\n>\n> 📄 **設定ファイル**:\n> - `.claude/settings.json` - Claude Code 用\n> - `~/.codex/mcp.json` - Codex 用（選択時）\n> - `.cursor/mcp.json` - Cursor 用（選択時）\n>\n> **利用可能なツール**:\n>\n> | ツール | 説明 |\n> |--------|------|\n> | `harness_session_list` | アクティブセッション一覧 |\n> | `harness_session_broadcast` | 全セッションに通知 |\n> | `harness_session_inbox` | 受信メッセージ確認 |\n> | `harness_workflow_plan` | プラン作成 |\n> | `harness_workflow_work` | タスク実行 |\n> | `harness_workflow_review` | コードレビュー |\n> | `harness_status` | プロジェクト状態 |\n>\n> **動作確認**:\n> 1. Claude Code を再起動\n> 2. \"harness_session_list を実行して\" と入力\n> 3. セッション一覧が表示されれば成功\n\n---\n\n## Cross-Client Workflow Example\n\n### シナリオ: Claude Code と Codex で同じプロジェクトを作業\n\n```\n[Claude Code]\nYou: harness_session_register を実行して、client: \"claude-code\"\n\nClaude: ✅ Session registered: session-abc123 (claude-code)\n\nYou: API を変更したので broadcast して\n\nClaude: 📤 Broadcast sent: \"UserAPI: userId → user に変更\"\n\n---\n\n[Codex]\nYou: harness_session_inbox を確認して\n\nCodex: 📨 1 message(s):\n       [10:30] claude-code: UserAPI: userId → user に変更\n\nYou: OK、新しい API を使って実装を続けて\n```\n\n---\n\n## Available MCP Tools\n\n### Session Tools\n\n| ツール | 引数 | 説明 |\n|--------|------|------|\n| `harness_session_list` | なし | アクティブセッション一覧 |\n| `harness_session_broadcast` | `message: string` | メッセージ送信 |\n| `harness_session_inbox` | `since?: string` | 受信確認 |\n| `harness_session_register` | `client, sessionId` | セッション登録 |\n\n### Workflow Tools\n\n| ツール | 引数 | 説明 |\n|--------|------|------|\n| `harness_workflow_plan` | `task, mode?` | プラン作成 |\n| `harness_workflow_work` | `parallel?, full?, taskId?` | タスク実行 |\n| `harness_workflow_review` | `files?, focus?, ci?` | レビュー |\n\n### Status Tools\n\n| ツール | 引数 | 説明 |\n|--------|------|------|\n| `harness_status` | `verbose?` | 状態確認 |\n\n---\n\n## Troubleshooting\n\n### MCP サーバーが起動しない\n\n**原因**: Node.js のバージョンが古い\n\n**解決**: Node.js 18 以上をインストール\n\n```bash\nnode --version  # v18.0.0 以上が必要\n```\n\n### ツールが見つからない\n\n**原因**: MCP サーバーがビルドされていない\n\n**解決**:\n\n```bash\ncd /path/to/claude-code-harness/mcp-server\nnpm run build\n```\n\n### セッション間でメッセージが届かない\n\n**原因**: 同じプロジェクトディレクトリで実行していない\n\n**解決**: 両方のクライアントを同じプロジェクトルートで起動\n\n---\n\n## Related Commands\n\n- `/session-broadcast` - プラグイン版メッセージ送信\n- `/session-inbox` - プラグイン版受信確認\n- `/session-list` - プラグイン版セッション一覧\n\n---\n\n## Notes\n\n- MCP サーバーはプラグイン機能の拡張版です\n- プラグイン版（`/session-*`）と MCP 版は同じデータを共有します\n- MCP 非対応のクライアントでもプラグイン版は使用可能\n- セッションデータは `.claude/sessions/` に保存されます\n",
        "opencode/commands/optional/opencode-setup.md": "---\ndescription: opencode.ai 用にプロジェクトをセットアップ\n---\n\n# /opencode-setup - OpenCode セットアップ\n\n現在のプロジェクトに opencode.ai 互換のコマンド、スキル、設定ファイルを生成します。\n\n## VibeCoder Quick Reference\n\n- \"**opencode でも使いたい**\" → このコマンド\n- \"**GPT でも Harness 使いたい**\" → opencode セットアップ\n- \"**マルチ LLM 開発したい**\" → opencode 互換設定\n- \"**スキルも opencode で使いたい**\" → このコマンドで自動対応\n\n## Deliverables\n\n- `.opencode/commands/` - opencode 用コマンド（Impl + PM）\n  - `core/` - コアコマンド（/work, /plan-with-agent 等）\n  - `optional/` - オプションコマンド\n  - `pm/` - PM コマンド（OpenCode を PM として使う場合）\n  - `handoff/` - ハンドオフコマンド\n- `.claude/skills/` - opencode 互換スキル（NotebookLM、レビュー等）\n- `AGENTS.md` - opencode 用ルールファイル（CLAUDE.md 全文）\n---\n\n## Usage\n\n```bash\n/opencode-setup\n```\n\n---\n\n## Execution Flow\n\n### Step 1: 確認\n\n> 🔧 **opencode.ai 互換ファイルを生成します**\n>\n> 以下のファイルが作成されます：\n> - `.opencode/commands/` - Harness コマンド\n> - `.claude/skills/` - Harness スキル（NotebookLM、レビュー等）\n> - `AGENTS.md` - ルールファイル（CLAUDE.md 全文）\n>\n> 続行しますか？ (y/n)\n\n**ユーザーの回答を待つ**\n\n### Step 2: ディレクトリ作成\n\n```bash\nmkdir -p .opencode/commands/core\nmkdir -p .opencode/commands/optional\nmkdir -p .opencode/commands/pm\nmkdir -p .opencode/commands/handoff\nmkdir -p .claude/skills\n```\n\n### Step 3: テンプレをコピー（必須）\n\n**必ず Bash で以下を実行**して、テンプレを直接コピーします。\nLLM が内容を自己生成してはいけません。\n\n```bash\nbash ./scripts/opencode-setup-local.sh\n```\n\n### Step 4: コピー内容の確認\n\n```bash\nls -la .opencode/commands\nls -la .claude/skills\nls -la AGENTS.md\n```\n\n### Step 5: 完了メッセージ\n\n> ✅ **OpenCode セットアップ完了**\n>\n> 📁 **生成されたファイル:**\n> - `.opencode/commands/` - Harness コマンド\n>   - `core/` - コアコマンド（/work, /plan-with-agent 等）\n>   - `optional/` - オプションコマンド\n>   - `pm/` - PM コマンド（/start-session, /plan-with-cc 等）\n>   - `handoff/` - ハンドオフコマンド\n> - `.claude/skills/` - Harness スキル\n> - `AGENTS.md` - ルールファイル（CLAUDE.md 全文）\n>\n> **利用可能なスキル:**\n> - `docs` - ドキュメント生成（NotebookLM YAML、スライド）\n> - `impl` - 機能実装\n> - `review` - コードレビュー\n> - `verify` - ビルド検証・エラー復旧\n> - `auth` - 認証・決済（Clerk, Stripe）\n> - `deploy` - デプロイ（Vercel, Netlify）\n>\n> **使い方 (Impl モード - Claude Code で実装する場合):**\n> ```bash\n> # opencode を起動してタスク実行\n> opencode\n> /work\n> ```\n>\n> **使い方 (PM モード - OpenCode で計画管理する場合):**\n> ```bash\n> # opencode を起動してセッション開始\n> opencode\n> /start-session\n> /plan-with-cc\n> /handoff-to-claude  # Claude Code への依頼生成\n> ```\n>\n> **ドキュメント:** https://github.com/Chachamaru127/claude-code-harness\n\n---\n\n## Notes\n\n- 既存の `.opencode/` ディレクトリがある場合は上書き確認\n- `AGENTS.md` が既存の場合はバックアップを作成\n- `.claude/skills/` が既存の場合はバックアップを作成\n- **Windows ユーザー**: シンボリックリンクは管理者権限が必要なため、コピーを推奨\n\n---\n\n## Related Commands\n\n- `/harness-init` - Harness プロジェクト初期化\n- `/harness-update` - Harness 更新\n",
        "opencode/commands/optional/release.md": "---\ndescription: リリースプロセス自動化（CHANGELOG更新、バージョン更新、タグ作成）\n---\n\n# /release - リリースプロセス自動化\n\nclaude-code-harness のリリースを自動化するコマンドです。\n\n## 実行手順\n\n### Step 1: 変更確認\n\n以下を並列で実行：\n\n1. **git status** で未コミット変更を確認\n2. **git diff --stat** で変更ファイル一覧\n3. **git log --oneline -10** で最近のコミット履歴\n\n### Step 2: バージョン決定\n\n現在のバージョンを確認：\n```bash\ncat VERSION\n```\n\n変更内容に応じてバージョンを決定（[Semantic Versioning](https://semver.org/spec/v2.0.0.html) 準拠）：\n- **patch** (x.y.Z): バグ修正、軽微な改善\n- **minor** (x.Y.0): 新機能追加（後方互換あり）\n- **major** (X.0.0): 破壊的変更\n\nユーザーに確認：「次のバージョンは何にしますか？ (例: 2.5.23)」\n\n### Step 3: CHANGELOG 更新（JP + EN）\n\n**[Keep a Changelog](https://keepachangelog.com/ja/1.0.0/) フォーマットに準拠**\n\n> ⚠️ **注意**: CHANGELOG 作成後、Step 3.5 で README 更新が必要か必ず確認すること（JP/EN 両方）\n\n`CHANGELOG_ja.md`（日本語）と `CHANGELOG.md`（英語）の **両方** で、`## [Unreleased]` の直後に新バージョンのエントリを追加。\n\n#### フォーマット\n\n```markdown\n## [X.Y.Z] - YYYY-MM-DD\n\n### Added\n- 新機能について\n\n### Changed\n- 既存機能の変更について\n\n### Deprecated\n- 間もなく削除される機能について\n\n### Removed\n- 削除された機能について\n\n### Fixed\n- バグ修正について\n\n### Security\n- 脆弱性に関する場合\n\n#### Before/After（大きな変更時のみ）\n\n| Before | After |\n|--------|-------|\n| 変更前の状態 | 変更後の状態 |\n```\n\n#### セクション使い分けのルール\n\n| セクション | 使うとき |\n|------------|----------|\n| Added | 完全に新しい機能を追加したとき |\n| Changed | 既存機能の動作や体験を変更したとき |\n| Deprecated | 将来削除予定の機能を告知するとき |\n| Removed | 機能やコマンドを削除したとき |\n| Fixed | バグや不具合を修正したとき |\n| Security | セキュリティ関連の修正をしたとき |\n\n#### Before/After テーブル\n\n大きな体験変化があるときのみ追加：\n- コマンドの廃止・統合\n- ワークフローの変更\n- 破壊的変更\n\n軽微な修正では省略可。\n\n#### バージョン比較リンク\n\nCHANGELOG.md 末尾のリンクセクションに追加：\n\n```markdown\n[X.Y.Z]: https://github.com/Chachamaru127/claude-code-harness/compare/vPREV...vX.Y.Z\n```\n\n既存の `[Unreleased]` リンクも更新：\n\n```markdown\n[Unreleased]: https://github.com/Chachamaru127/claude-code-harness/compare/vX.Y.Z...HEAD\n```\n\n#### CHANGELOG.md（英語）の書き方\n\n- 目的は **ユーザーが理解できる変更点** を伝えること（コミットログの翻訳ではない）\n- `### 🎯 What's Changed for You` を基本にし、必要なら `#### Before/After` を追加\n- 日本語版（CHANGELOG_ja.md）と **同じバージョン番号が存在** する状態を維持する\n\n### Step 4: バージョン更新\n\n```bash\n# 既定（推奨）: patch リリース\n./scripts/sync-version.sh bump\n\n# minor/major などで明示的に指定したい場合:\necho \"X.Y.Z\" > VERSION\n./scripts/sync-version.sh sync\n```\n\n### Step 5: コミット & タグ\n\n```bash\n# ステージング\ngit add VERSION .claude-plugin/plugin.json .claude-plugin/marketplace.json CHANGELOG.md CHANGELOG_ja.md README.md README_ja.md [変更されたファイル]\n\n# コミット\ngit commit -m \"chore: release vX.Y.Z - 一言説明\n\n- 変更点1\n- 変更点2\n\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\"\n\n# タグ作成\ngit tag -a vX.Y.Z -m \"Release vX.Y.Z: 一言説明\"\n\n# プッシュ\ngit push origin main && git push origin vX.Y.Z\n```\n\n### Step 6: キャッシュ同期\n\n```bash\nbash scripts/sync-plugin-cache.sh\n```\n\n### Step 7: GitHub Releases 作成\n\nタグだけでなく、GitHub Releases にリリースノートを作成します。\n\n```bash\ngh release create vX.Y.Z \\\n  --title \"vX.Y.Z - 一言説明\" \\\n  --notes \"$(cat <<'EOF'\n## 🎯 あなたにとって何が変わるか\n\n**主な変更点の説明**\n\n### Before\n- 変更前の状態\n\n### After\n- 変更後の状態\n\n---\n\n## Added\n- 新機能\n\n## Changed\n- 変更点\n\n## Fixed\n- バグ修正\n\n---\n\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\nEOF\n)\"\n```\n\n**リリースノートの内容**:\n- CHANGELOG.md の該当バージョンのエントリをベースに作成\n- Before/After セクションは大きな変更時のみ\n- `🤖 Generated with [Claude Code]` フッターを追加\n\n### Step 8: 確認\n\n```bash\ngit log --oneline -3\ngit tag | tail -5\ngh release list --limit 5\ncat ~/.claude/plugins/cache/claude-code-harness-marketplace/claude-code-harness/*/VERSION | sort -u\n```\n\n### Step 9: リリースノート検証（必須）\n\n> 🔴 **必ず実行**: リリースノートのフォーマットが `.claude/rules/github-release.md` に準拠しているか検証\n\n```bash\n./scripts/validate-release-notes.sh vX.Y.Z\n```\n\n**チェック項目**:\n- ✅ 見出し: `🎯 あなたにとって何が変わるか`（日本語統一）\n- ✅ Before → After テーブル\n- ✅ フッター: `🤖 Generated with [Claude Code](...)`\n- ✅ 日英混在なし\n\nエラーがある場合は `gh release edit` で修正:\n```bash\ngh release edit vX.Y.Z --notes \"$(cat <<'EOF'\n## 🎯 あなたにとって何が変わるか\n...\nEOF\n)\"\n```\n\n## keepachangelog の原則\n\n1. **人間のために書く** - 機械的なコミットログではなく、ユーザーが理解できる言葉で\n2. **バージョンごとにまとめる** - 同じ種類の変更をグループ化\n3. **最新を先頭に** - 新しいバージョンが上\n4. **日付は ISO 8601** - YYYY-MM-DD 形式\n5. **Unreleased を活用** - 次リリースまでの変更を蓄積\n\n### Step 3.5: README 更新（必須確認）\n\n> 🔴 **必ず確認**: 以下に該当する場合は **README.md と README_ja.md の両方** を更新すること\n\n**対象ファイル**:\n- `README.md` - 英語版（デフォルト）\n- `README_ja.md` - 日本語版\n\n**更新が必要なケース**:\n- ✅ 新機能追加（Added セクションに項目がある）\n- ✅ 既存機能の変更（Changed セクションにユーザー影響がある）\n- ✅ コマンド/スキルの追加・変更\n- ✅ ワークフローの変更\n\n**更新不要なケース**:\n- ❌ バグ修正のみ（Fixed のみ）\n- ❌ 内部リファクタリング\n- ❌ ドキュメント修正のみ\n\n**更新手順**:\n\n1. **README.md（英語）** を更新（デフォルト）\n   - `## What's New in vX.Y` を更新（存在しない場合は追加）\n   - 関連するコマンド/スキルの説明を更新\n\n2. **README_ja.md（日本語）** を同期\n   - `## vX.Y の新機能 | What's New in vX.Y` を更新（存在しない場合は追加）\n   - 関連するコマンド/スキルの説明を更新\n\n3. **バージョンバッジ** を両方で確認（`./scripts/sync-version.sh` が自動更新しますが、差分が出ていないか目視チェック）\n   ```markdown\n   [![Version: X.Y.Z](https://img.shields.io/badge/version-X.Y.Z-blue.svg)](VERSION)\n   ```\n\n**新機能セクションの例**:\n\nREADME.md:\n```markdown\n### Feature Name (vX.Y.Z)\n\n**English explanation**\n\n- Feature 1\n- Feature 2\n```\n\nREADME_ja.md:\n```markdown\n### 機能名（vX.Y.Z）| Feature Name\n\n**日本語説明**\n*English explanation*\n\n- 機能の特徴1\n- 機能の特徴2\n```\n\n**更新対象セクション例**:\n| README.md | README_ja.md |\n|-----------|--------------|\n| \"What's New in vX.Y\" | 「vX.Y の新機能 \\| What's New in vX.Y」 |\n| 「3行でわかる」 | \"In 3 Lines\" |\n| 「機能一覧」 | \"Features\" |\n| 「コマンド早見表」 | \"Command Quick Reference\" |\n\n## 注意事項\n\n- `skills/test-*` などのテストディレクトリは含めない\n- コミットメッセージは Conventional Commits に従う\n",
        "opencode/commands/optional/remotion-setup.md": "---\ndescription: Remotion動画生成環境をセットアップ\n---\n\n# /remotion-setup - Remotion セットアップ\n\nRemotionによるプログラマティック動画生成環境をセットアップします。\n\n## VibeCoder Quick Reference\n\n- \"**動画を作りたい**\" → このコマンド\n- \"**プロダクト紹介動画**\" → まずこのセットアップ\n- \"**Remotion使いたい**\" → このコマンド\n\n## Deliverables\n\n- `remotion/` - Remotionプロジェクトディレクトリ\n- Remotion Agent Skills（Claude Code連携）\n- Harness用テンプレート（オプション）\n\n---\n\n## Prerequisites\n\n- Node.js 18+\n- pnpm / npm / yarn\n- 十分なディスク容量（約500MB）\n\n---\n\n## Usage\n\n```bash\n/remotion-setup                    # 基本セットアップ\n/remotion-setup --with-templates   # Harnessテンプレート付き\n/remotion-setup --brownfield       # 既存プロジェクトに追加\n```\n\n---\n\n## Execution Flow\n\n### Step 1: 環境確認\n\n```bash\n# Node.js バージョン確認\nnode --version  # 18.0.0 以上必須\n\n# パッケージマネージャー確認\nwhich pnpm || which npm\n```\n\n### Step 2: セットアップ方式の確認\n\n> 🎬 **Remotion セットアップ**\n>\n> セットアップ方式を選択してください：\n>\n> 1. **新規プロジェクト** - `remotion/` ディレクトリを作成\n> 2. **既存プロジェクトに追加** - 現在のプロジェクトに統合\n>\n> どちらを選択しますか？\n\n**AskUserQuestion で確認**\n\n### Step 3a: 新規プロジェクト作成\n\n```bash\n# Remotionプロジェクト作成\nnpx create-video@latest remotion\n\n# 推奨設定:\n# - Template: Empty\n# - TailwindCSS: Yes\n# - Skills: Yes\n```\n\n### Step 3b: 既存プロジェクトに追加（Brownfield）\n\n```bash\n# 必要なパッケージをインストール\nnpm install remotion @remotion/cli @remotion/player\n\n# オプション: レンダリング用\nnpm install @remotion/renderer\n\n# オプション: Lambda用\nnpm install @remotion/lambda\n```\n\n**フォルダ構成を作成**:\n\n```\nremotion/\n├── Composition.tsx    # メインコンポジション\n├── Root.tsx           # Remotionルート\n└── index.ts           # エントリーポイント\n```\n\n### Step 4: Agent Skills インストール\n\n```bash\n# Remotion Skills をインストール\nnpx skills add remotion-dev/skills\n```\n\n**確認**:\n```bash\n# スキルが追加されたか確認\nls .claude/skills/remotion/ 2>/dev/null || echo \"Skills installed in global location\"\n```\n\n### Step 5: Harnessテンプレート追加（オプション）\n\n> 🎨 **Harnessテンプレートを追加しますか？**\n>\n> 以下のテンプレートが利用可能です：\n> - 共有コンポーネント（FadeIn, SlideUp, TextReveal）\n> - ブランドアセット（COLORS, FONTS）\n> - プリセット（1080p, vertical, square）\n>\n> 追加しますか？ (y/n)\n\n**「y」の場合**:\n\n```bash\n# プラグインからテンプレートをコピー\nPLUGIN_DIR=\"${CLAUDE_PLUGIN_ROOT:-$(dirname $(dirname $0))}\"\ncp -r \"$PLUGIN_DIR/templates/remotion/\"* remotion/\n```\n\n### Step 6: package.json スクリプト追加\n\n```json\n{\n  \"scripts\": {\n    \"remotion\": \"remotion studio remotion/index.ts\",\n    \"render\": \"remotion render remotion/index.ts Main out/video.mp4\",\n    \"render:gif\": \"remotion render remotion/index.ts Main out/video.gif\"\n  }\n}\n```\n\n### Step 7: 完了メッセージ\n\n> ✅ **Remotion セットアップ完了**\n>\n> 📁 **作成されたファイル**:\n> - `remotion/` - Remotionプロジェクト\n> - `.claude/skills/remotion/` - Agent Skills\n>\n> **使い方**:\n> ```bash\n> # Studio を起動（プレビュー）\n> npm run remotion\n>\n> # 動画をレンダリング\n> npm run render\n>\n> # Claude Code で動画を作成\n> claude\n> > \"イントロ動画を作って\"\n> ```\n>\n> **次のステップ**:\n> - `/generate-video` で自動動画生成\n> - Studio で手動編集: http://localhost:3000\n>\n> **ドキュメント**: https://www.remotion.dev/docs\n\n---\n\n## Troubleshooting\n\n### \"Cannot find module 'remotion'\"\n\n```bash\n# 依存関係を再インストール\nrm -rf node_modules && npm install\n```\n\n### \"Skills not found\"\n\n```bash\n# グローバルにインストールされている可能性\nnpx skills list\n```\n\n### レンダリングが遅い\n\n```bash\n# 並列レンダリングを有効化\nnpx remotion render --concurrency 4\n```\n\n---\n\n## License Notice\n\n> ⚠️ **Remotion ライセンス**\n>\n> Remotionは企業利用時に有料ライセンスが必要な場合があります。\n> 詳細: https://www.remotion.dev/license\n>\n> 個人・OSS利用は無料です。\n\n---\n\n## Related Commands\n\n- `/generate-video` - 動画自動生成\n- `/mcp-setup` - MCP サーバーセットアップ\n\n---\n\n## Technical References\n\n- [Remotion公式: Claude Code連携](https://www.remotion.dev/docs/ai/claude-code)\n- [Remotion Agent Skills](https://www.remotion.dev/docs/ai/skills)\n- [Brownfield Integration](https://www.remotion.dev/docs/brownfield)\n- [Launchpad テンプレート参考](https://github.com/trycua/launchpad)\n",
        "opencode/commands/optional/session-broadcast.md": "---\ndescription: 全セッションにメッセージを送信（セッション間通信）\nuser-invocable: false\n---\n\n# /session-broadcast - セッション間ブロードキャスト\n\n他のセッションで作業中の自分（または他のユーザー）にメッセージを送信します。\n**API変更や重要な決定を即座に共有**できます。\n\n## VibeCoder Quick Reference\n\n- \"**他のセッションに伝えて**\" → このコマンド\n- \"**API変わったよ**\" → 自動的に全セッションに通知\n- \"**変更を共有**\" → ブロードキャスト送信\n\n## Deliverables\n\n- `.claude/sessions/broadcast.md` にメッセージを追記\n- 他セッションが次のアクション前に通知を受け取る\n\n---\n\n## Usage\n\n### 基本的な使い方\n\n```bash\n/session-broadcast \"UserAPI: userId → user に引数名を変更しました\"\n```\n\n### 自然言語での使い方\n\n```\n「他のセッションに、API変更したことを伝えて」\n→ ブロードキャストメッセージを送信\n```\n\n---\n\n## Execution Flow\n\n### Step 1: メッセージ確認\n\nユーザーからメッセージを受け取ったら、内容を確認：\n\n> 📤 **以下のメッセージを全セッションに送信しますか？**\n>\n> ```\n> {ユーザーのメッセージ}\n> ```\n>\n> 送信する場合は「はい」または Enter\n\n### Step 2: ブロードキャスト実行\n\n```bash\nbash \"${CLAUDE_PLUGIN_ROOT}/scripts/session-broadcast.sh\" \"メッセージ内容\"\n```\n\n### Step 3: 完了報告\n\n> ✅ **ブロードキャスト送信完了**\n>\n> | 項目 | 内容 |\n> |------|------|\n> | 送信時刻 | {timestamp} |\n> | セッションID | {session_id} |\n> | メッセージ | {message} |\n>\n> 💡 他のセッションは次のアクション前に通知を受け取ります\n\n---\n\n## Message Format\n\n送信されるメッセージは以下の形式で保存されます：\n\n```markdown\n## 2024-01-23T10:30:00Z [session-abc1]\nUserAPI: userId → user に引数名を変更しました\n\n## 2024-01-23T10:45:00Z [session-abc1]\nテストを追加しました\n```\n\n---\n\n## Use Cases\n\n### 1. API/型定義の変更通知\n\n```bash\n/session-broadcast \"UserService.getUser() の戻り値に email フィールドを追加\"\n```\n\n### 2. 重要な決定の共有\n\n```bash\n/session-broadcast \"認証方式を JWT から Session に変更することに決定\"\n```\n\n### 3. 作業状況の共有\n\n```bash\n/session-broadcast \"決済機能の実装完了、レビューお願いします\"\n```\n\n### 4. 注意喚起\n\n```bash\n/session-broadcast \"⚠️ main ブランチにマージしないでください、CI修正中\"\n```\n\n---\n\n## Auto-broadcast (hooks連携)\n\n特定のファイルを変更した際に自動でブロードキャストすることも可能です：\n\n```yaml\n# hooks で設定（将来実装）\ntrigger:\n  file_changed:\n    - \"src/api/**\"\n    - \"src/types/**\"\naction:\n  broadcast: \"{{file}} が変更されました\"\n```\n\n---\n\n## Related Commands\n\n- `/session-inbox` - 受信メッセージを確認\n- `/session-list` - アクティブセッション一覧\n\n---\n\n## Notes\n\n- メッセージは最大100件まで保持されます（古いものから削除）\n- 自分が送信したメッセージは自分の inbox には表示されません\n- メッセージはローカルの `.claude/sessions/` に保存されます（リモート同期なし）\n",
        "opencode/commands/optional/session-inbox.md": "---\ndescription: 受信メッセージを確認（セッション間通信）\n---\n\n# /session-inbox - セッション間メッセージ受信\n\n他のセッションからのブロードキャストメッセージを確認します。\n**重要な変更通知を見逃さない**ために使用します。\n\n## VibeCoder Quick Reference\n\n- \"**メッセージある？**\" → このコマンド\n- \"**通知確認**\" → 未読メッセージをチェック\n- \"**既読にして**\" → 全メッセージを既読にマーク\n\n## Deliverables\n\n- 未読メッセージの一覧表示\n- 既読マーク機能\n\n---\n\n## Usage\n\n### 未読メッセージを確認\n\n```bash\n/session-inbox\n```\n\n### 既読にマーク\n\n```bash\n/session-inbox --mark\n```\n\n### 未読件数のみ確認\n\n```bash\n/session-inbox --count\n```\n\n---\n\n## Execution Flow\n\n### Step 1: 未読チェック実行\n\n```bash\nbash \"${CLAUDE_PLUGIN_ROOT}/scripts/session-inbox-check.sh\"\n```\n\n### Step 2: 結果表示\n\n#### 未読メッセージがある場合\n\n> 📨 **未読メッセージ 2件:**\n>\n> | 時刻 | 送信元 | メッセージ |\n> |------|--------|------------|\n> | 10:30 | session-def4 | UserAPI: userId → user に変更 |\n> | 10:45 | session-def4 | テスト追加済み |\n>\n> 💡 `/session-inbox --mark` で既読にできます\n\n#### 未読メッセージがない場合\n\n> 📭 **未読メッセージはありません**\n>\n> 最終チェック: {timestamp}\n\n---\n\n## Options\n\n| オプション | 説明 | 例 |\n|------------|------|-----|\n| (なし) | 未読メッセージを一覧表示 | `/session-inbox` |\n| `--mark` | 全メッセージを既読にする | `/session-inbox --mark` |\n| `--count` | 未読件数のみ表示 | `/session-inbox --count` |\n\n---\n\n## Auto-check (hooks連携)\n\nWrite/Edit 実行前に未読メッセージが**自動的に表示**されます（確認は不要）：\n\n```\nYou: このファイルを編集して\n\n📨 他セッションからのメッセージ 1件:\n---\n[10:30] session-def4: UserAPI: userId → user に変更\n---\n\nClaude: 承知しました。UserAPI の変更を考慮して編集します...\n```\n\n**ポイント**:\n- メッセージ内容は自動で表示される（`/session-inbox` の実行は不要）\n- 自動既読マークはされない（`--mark` で明示的に既読にする）\n- このコマンドは詳細確認・既読マーク専用として利用\n\n---\n\n## How It Works\n\n### 既読管理\n\n- 各セッションごとに最終読み取り時刻を記録\n- `.claude/sessions/.last_read_{session_id}` に保存\n- この時刻より後のメッセージが「未読」として表示\n\n### 自分のメッセージ\n\n- 自分が送信したメッセージは inbox に表示されません\n- セッションIDで送信元を判別\n\n---\n\n## Related Commands\n\n- `/session-broadcast` - メッセージを送信\n- `/session-list` - アクティブセッション一覧\n\n---\n\n## Notes\n\n- 未読チェックはローカルファイルベースで高速\n- セッション終了後も未読状態は保持されます\n- `/harness-init` 実行時に自動で inbox チェックが行われます\n- **v2.12.0+**: Write/Edit 実行前にメッセージ内容が自動表示されます（確認プロンプトなし）\n",
        "opencode/commands/optional/session-list.md": "---\ndescription: アクティブセッション一覧を表示（セッション間通信）\n---\n\n# /session-list - アクティブセッション一覧\n\n現在アクティブなセッションの一覧を表示します。\n**誰が作業中かを把握**するために使用します。\n\n## VibeCoder Quick Reference\n\n- \"**他に誰か作業してる？**\" → このコマンド\n- \"**セッション一覧**\" → アクティブセッションを表示\n\n## Deliverables\n\n- アクティブセッションの一覧\n- 各セッションの最終アクティブ時刻\n- 現在のセッションの識別\n\n---\n\n## Usage\n\n```bash\n/session-list\n```\n\n---\n\n## Execution Flow\n\n### Step 1: セッション一覧取得\n\n```bash\nbash \"${CLAUDE_PLUGIN_ROOT}/scripts/session-list.sh\"\n```\n\n### Step 2: 結果表示\n\n> 📋 **アクティブセッション一覧**\n>\n> | セッションID | 最終アクティブ | 状態 |\n> |-------------|---------------|------|\n> | session-abc1 | 2分前 | 🟢 現在のセッション |\n> | session-def4 | 15分前 | 🟡 アクティブ |\n> | session-ghi7 | 2時間前 | ⚪ 非アクティブ |\n>\n> 💡 ヒント:\n> - `/session-broadcast \"メッセージ\"` で全セッションに通知\n> - `/session-inbox` で受信メッセージを確認\n\n---\n\n## Session Status\n\n| 状態 | アイコン | 説明 |\n|------|----------|------|\n| 現在のセッション | 🟢 | 今操作しているセッション |\n| アクティブ | 🟡 | 1時間以内にアクティビティあり |\n| 非アクティブ | ⚪ | 1時間以上アクティビティなし |\n\n---\n\n## How It Works\n\n### セッション登録\n\n- 各セッションは起動時に `.claude/sessions/active.json` に登録\n- 定期的に最終アクティブ時刻を更新\n- セッションIDは Harness が自動生成\n\n### クリーンアップ\n\n- 24時間以上非アクティブなセッションは自動削除\n- 手動でのクリーンアップは不要\n\n---\n\n## Data Format\n\n`.claude/sessions/active.json`:\n\n```json\n{\n  \"session-1234567890\": {\n    \"short_id\": \"session-1234\",\n    \"last_seen\": 1706000000,\n    \"pid\": \"12345\",\n    \"status\": \"active\"\n  }\n}\n```\n\n---\n\n## Related Commands\n\n- `/session-broadcast` - メッセージを送信\n- `/session-inbox` - 受信メッセージを確認\n\n---\n\n## Notes\n\n- セッション情報はローカルに保存されます\n- 同一マシン上の複数セッションのみ追跡可能\n- ネットワーク越しのセッション共有は対象外（将来のMCP化で対応予定）\n",
        "opencode/commands/optional/session.md": "---\ndescription: \"[Optional] Unified session management command (list, inbox, broadcast)\"\n---\n\n# /session - Unified Session Management\n\nConsolidates all session-related commands into one unified interface.\n\n## Quick Reference\n\n- \"**Show sessions**\" → `/session list`\n- \"**Check messages**\" → `/session inbox`\n- \"**Send to all**\" → `/session broadcast \"message\"`\n\n## Usage\n\n```bash\n/session              # Show available options\n/session list         # Show active sessions\n/session inbox        # Check incoming messages\n/session broadcast \"message\"  # Send message to all sessions\n```\n\n---\n\n## Subcommands\n\n### `/session list` - List Active Sessions\n\nShows all active Claude Code sessions in the current project.\n\n**Output**:\n```\n📋 Active Sessions\n\n| Session ID | Status | Last Activity |\n|------------|--------|---------------|\n| abc123     | active | 2 min ago     |\n| def456     | idle   | 15 min ago    |\n```\n\n---\n\n### `/session inbox` - Check Inbox\n\nChecks for incoming messages from other sessions.\n\n**Output**:\n```\n📬 Session Inbox\n\n| From | Time | Message |\n|------|------|---------|\n| abc123 | 5m ago | \"Ready for review\" |\n| def456 | 10m ago | \"API implementation done\" |\n```\n\n---\n\n### `/session broadcast \"message\"` - Broadcast Message\n\nSends a message to all active sessions.\n\n**Usage**:\n```bash\n/session broadcast \"Review complete, ready for merge\"\n/session broadcast \"Stopping for today\"\n```\n\n**Output**:\n```\n📢 Broadcast sent to 3 sessions\n```\n\n---\n\n## Migration Note\n\nThis command consolidates the following individual commands:\n- `/session-list` → `/session list`\n- `/session-inbox` → `/session inbox`\n- `/session-broadcast` → `/session broadcast \"message\"`\n\nThe individual commands are deprecated but still work for backward compatibility.\n\n---\n\n## Related\n\n- Session memory is managed by the `session` skill\n- For session initialization, use `/harness-init`\n",
        "opencode/commands/optional/setup.md": "---\ndescription: \"[Optional] Unified setup command for CI, LSP, MCP, dev-tools, etc.\"\n---\n\n# /setup - Unified Setup Command\n\nConsolidates all setup commands into one unified interface.\n\n## Quick Reference\n\n- \"**Setup CI**\" → `/setup ci`\n- \"**Setup LSP**\" → `/setup lsp`\n- \"**Setup dev tools**\" → `/setup dev-tools` (recommended)\n- \"**Setup MCP**\" → `/setup mcp`\n- \"**Setup OpenCode**\" → `/setup opencode`\n- \"**Setup webhook**\" → `/setup webhook`\n- \"**Setup Harness UI**\" → `/setup ui`\n\n## Usage\n\n```bash\n/setup              # Show available options\n/setup ci           # Setup CI/CD (GitHub Actions)\n/setup dev-tools    # Setup AST-Grep + LSP (recommended)\n/setup lsp          # Setup LSP only\n/setup mcp          # Setup MCP server\n/setup opencode     # Setup OpenCode.ai compatibility\n/setup webhook      # Setup GitHub Actions webhook\n/setup ui           # Setup Harness UI\n```\n\n---\n\n## Subcommands\n\n### `/setup ci` - CI/CD Setup\n\nSets up GitHub Actions for automated testing and deployment.\n\n**Deliverables**:\n- `.github/workflows/*.yml` for lint/typecheck/test/build\n- Failure analysis and fix suggestions\n\n**Features**:\n- ✅ Lint (ESLint, Prettier)\n- ✅ Type Check (TypeScript)\n- ✅ Unit Test (Jest, Vitest)\n- ✅ E2E Test (Playwright)\n- ✅ Build Check\n\n---\n\n### `/setup dev-tools` - Development Tools (Recommended)\n\nSets up AST-Grep and LSP for enhanced code intelligence.\n\n**Deliverables**:\n- AST-Grep MCP server configuration\n- LSP server configuration\n- `.claude/settings.json` updates\n\n**Why recommended**:\n- Structural code search (more accurate than grep)\n- Type-aware navigation and diagnostics\n- Better code review accuracy\n\n---\n\n### `/setup lsp` - LSP Only\n\nSets up Language Server Protocol support without AST-Grep.\n\n**Deliverables**:\n- LSP server configuration for your language\n- `.claude/settings.json` updates\n\n---\n\n### `/setup mcp` - MCP Server\n\nSets up Model Context Protocol servers.\n\n**Deliverables**:\n- MCP server configuration\n- Tool availability verification\n\n---\n\n### `/setup opencode` - OpenCode.ai Compatibility\n\nSets up compatibility with OpenCode.ai.\n\n**Deliverables**:\n- OpenCode-compatible file structure\n- Symlinks or copies as needed\n\n---\n\n### `/setup webhook` - GitHub Actions Webhook\n\nSets up webhook for GitHub Actions integration.\n\n**Deliverables**:\n- `.github/workflows/review.yml` for PR auto-review\n- Webhook endpoint configuration\n\n---\n\n### `/setup ui` - Harness UI\n\nSets up the Harness UI dashboard.\n\n**Deliverables**:\n- UI server configuration\n- Dashboard access instructions\n\n---\n\n## Migration Note\n\nThis command consolidates the following individual commands:\n- `/ci-setup` → `/setup ci`\n- `/dev-tools-setup` → `/setup dev-tools`\n- `/lsp-setup` → `/setup lsp`\n- `/mcp-setup` → `/setup mcp`\n- `/opencode-setup` → `/setup opencode`\n- `/webhook-setup` → `/setup webhook`\n- `/harness-ui-setup` → `/setup ui`\n\nThe individual commands are deprecated but still work for backward compatibility.\n",
        "opencode/commands/optional/skills-update.md": "---\ndescription: \"スキル設定を更新（add/remove/list/enable/disable）。Skills Gate の対象スキルを管理\"\n---\n\n# /skills-update\n\nプロジェクトの Skills Gate 設定を更新します。\n\n## 使い方\n\n```\n/skills-update [action] [skill_name]\n```\n\n### アクション\n\n| アクション | 説明 | 例 |\n|-----------|------|-----|\n| `list` | 現在の設定を表示 | `/skills-update list` |\n| `add <skill>` | スキルを追加 | `/skills-update add auth` |\n| `remove <skill>` | スキルを削除 | `/skills-update remove auth` |\n| `enable` | Skills Gate を有効化 | `/skills-update enable` |\n| `disable` | Skills Gate を無効化 | `/skills-update disable` |\n\n## 実行手順\n\n### 1. 引数を解析\n\nユーザーの入力から action と skill_name を抽出します。\n\n### 2. skills-config.json を更新\n\n```bash\nSTATE_DIR=\".claude/state\"\nSKILLS_CONFIG=\"${STATE_DIR}/skills-config.json\"\n\nmkdir -p \"$STATE_DIR\"\n\n# 存在しない場合は初期化\nif [ ! -f \"$SKILLS_CONFIG\" ]; then\n  echo '{\"enabled\": true, \"skills\": [\"impl\", \"review\"]}' > \"$SKILLS_CONFIG\"\nfi\n```\n\n### 3. アクション別処理\n\n#### list\n```bash\ncat \"$SKILLS_CONFIG\" | jq .\n```\n\n#### add <skill>\n```bash\njq --arg s \"$SKILL_NAME\" '.skills += [$s] | .skills |= unique' \"$SKILLS_CONFIG\" > tmp && mv tmp \"$SKILLS_CONFIG\"\n```\n\n#### remove <skill>\n```bash\njq --arg s \"$SKILL_NAME\" '.skills -= [$s]' \"$SKILLS_CONFIG\" > tmp && mv tmp \"$SKILLS_CONFIG\"\n```\n\n#### enable\n```bash\njq '.enabled = true' \"$SKILLS_CONFIG\" > tmp && mv tmp \"$SKILLS_CONFIG\"\n```\n\n#### disable\n```bash\njq '.enabled = false' \"$SKILLS_CONFIG\" > tmp && mv tmp \"$SKILLS_CONFIG\"\n```\n\n### 4. 結果を報告\n\n更新後の設定を表示し、変更内容をユーザーに伝えます。\n\n## 利用可能なスキル\n\n| スキル | 用途 |\n|--------|------|\n| impl | 実装、機能追加 |\n| review | コードレビュー |\n| ui | UI コンポーネント |\n| auth | 認証・決済 |\n| deploy | デプロイ |\n| ci | CI/CD |\n| verify | ビルド検証 |\n| docs | ドキュメント生成 |\n\n## 注意事項\n\n- Skills Gate が有効な場合、コード編集前に Skill ツールの使用が必要\n- 設定は `.claude/state/skills-config.json` に保存\n- セッション再起動後に反映\n",
        "opencode/commands/optional/sync-project-specs.md": "---\ndescription: \"[オプション] 作業後にPlans.md等が更新されているか不明な時、念のため実行\"\n---\n\n# /sync-project-specs - 作業後の念のため同期\n\n**作業完了後に「Plans.md ちゃんと更新されてるかな？」と不安な時に実行するコマンドです。**\n\n## いつ使う？\n\n| 状況 | 使うべきコマンド |\n|------|-----------------|\n| 「今どこまで進んだ？次は？」 | `/sync-status`（まずこちら） |\n| 「作業したけど Plans.md 更新したか覚えてない」 | **このコマンド** |\n| 「古いテンプレから始めたので形式が古いかも」 | **このコマンド** |\n\n> 💡 **ヒント**: 通常は `/sync-status` で十分です。このコマンドは「念のため」や「形式の移行」が必要な時に使います。\n\n---\n\nこのコマンドは、プロジェクト内の **仕様書/運用ドキュメント**（例: `Plans.md`, `AGENTS.md`, `.claude/rules/*`）を、\nclaude-code-harness の最新運用（**PM ↔ Impl**, `pm:*` マーカー、ハンドオフ2コマンド）に揃えます。\n\n「忙しくて更新を忘れた」「途中で運用が変わった」「古いテンプレから始めた」時のリカバリ用です。\n\n## バイブコーダー向け（こう言えばOK）\n\n- 「**作業終わったけど Plans.md 更新したか不安**」→ このコマンド\n- 「**古い形式のファイルを最新に揃えたい**」→ マーカーと説明を統一します\n- 「**手動変更は残して、必要な部分だけ直して**」→ 既存の文章は極力維持して差分だけ当てます\n\n## できること（成果物）\n\n- `Plans.md` の **マーカー凡例/状態遷移/運用説明** を PM↔Impl 前提に更新\n- `AGENTS.md` の **役割分担** を PM（Cursor/PM Claude）↔ Impl（Claude Code）に更新\n- `.claude/rules/workflow.md` / `.claude/rules/plans-management.md` の **運用ルール** を更新\n- `cursor:*` マーカーは **互換として同義扱い**の説明を残す\n\n## 同期対象（存在するものだけ）\n\n- `Plans.md`\n- `AGENTS.md`\n- `CLAUDE.md`（運用説明がある場合のみ）\n- `.claude/rules/workflow.md`\n- `.claude/rules/plans-management.md`\n\n## 同期内容（最小差分ポリシー）\n\n1. **マーカーの正規化**\n   - 正規: `pm:依頼中`, `pm:確認済`\n   - 互換: `cursor:依頼中`, `cursor:確認済`（同義として扱う）\n2. **状態遷移の明文化**\n   - `pm:依頼中 → cc:WIP → cc:完了 → pm:確認済`\n3. **ハンドオフ導線の追記**\n   - PM→Impl: `/handoff-to-impl-claude`（PM Claude向け）\n   - Impl→PM: `/handoff-to-pm-claude`\n   - Cursor運用の場合は従来通り（`/handoff-to-claude`, `/handoff-to-cursor`）\n4. **通知ファイルの説明**\n   - `.claude/state/pm-notification.md`（互換: `.claude/state/cursor-notification.md`）\n\n## 実行手順\n\n### Step 1: 現状を収集（必須）\n\n- 対象ファイルの存在確認と、該当セクションの抜粋を取得\n- `Plans.md` のマーカー出現状況（pm/cursor/cc）を集計\n\n### Step 2: 変更方針の宣言（必須）\n\nユーザーに以下を先に宣言：\n\n- 既存の文章は原則残す（破壊的リライトはしない）\n- 追加/置換は「運用に必要な最低限」に絞る\n- 変更は差分で提示し、必要なら調整する\n\n### Step 3: 同期（差分適用）\n\n- `Plans.md`\n  - マーカー凡例に `pm:*` を追加し、`cursor:*` を互換として明記\n  - 状態遷移表記を PM↔Impl へ\n- `AGENTS.md`\n  - 役割分担を PM/Impl へ\n  - Plans のマーカー表と遷移を PM↔Impl へ（互換注記あり）\n- `.claude/rules/workflow.md` / `.claude/rules/plans-management.md`\n  - `cursor:*` 表記を `pm:*` 正規＋互換注記へ\n- `CLAUDE.md`\n  - もし運用説明セクションがあるなら、PM↔Impl の導線を追記（既存を壊さない）\n\n### Step 4: 仕上げ（必須）\n\n- `/sync-status` で集計して、マーカーが意図通りか確認\n- 必要なら `/remember` で「このプロジェクト固有の運用」を固定\n\n---\n\n## ⚡ 並列実行の判断ポイント\n\nこのコマンドでは複数ファイルの確認・更新を行うため、**ファイル読み込みフェーズ**で並列実行が有効です。\n\n### 並列実行すべき場合 ✅\n\n| 処理 | 並列化 |\n|------|--------|\n| Plans.md の読み込み | ✅ 独立 |\n| AGENTS.md の読み込み | ✅ 独立 |\n| CLAUDE.md の読み込み | ✅ 独立 |\n| .claude/rules/*.md の読み込み | ✅ 独立 |\n\n**対象ファイルが 3 つ以上ある場合**:\n```\n🚀 ファイル収集開始...\n├── [Plans.md] 読み込み中... ⏳\n├── [AGENTS.md] 読み込み中... ⏳\n├── [CLAUDE.md] 読み込み中... ⏳\n└── [rules/*.md] 読み込み中... ⏳\n\n→ 同時に読み込んで時間短縮\n```\n\n### 直列実行される処理\n\n更新は**ファイル間の整合性**を保つため直列実行：\n\n```\nファイル読み込み（並列）→ 差分分析（直列）→ 更新適用（直列）→ 検証（直列）\n```\n\n### 自動判断ロジック\n\n```\n同期対象ファイル >= 3 → ファイル読み込みを並列実行\n同期対象ファイル < 3  → 直列実行（オーバーヘッド回避）\n```\n\n\n",
        "opencode/commands/optional/sync-ssot-from-memory.md": "---\ndescription: \"[Optional] Promote important observations from memory systems (Claude-mem/Serena) to SSOT\"\n---\n\n# /sync-ssot-from-memory - Memory → SSOT Promotion\n\nPromote important observations recorded in memory systems (Claude-mem or Serena) to the project's SSOT:\n`.claude/memory/decisions.md` and `.claude/memory/patterns.md`.\n\n---\n\n## VibeCoder Phrases\n\n- \"**Save what we learned for next time**\" → this command\n- \"**Promote important decisions to SSOT**\" → this command\n- \"**Organize decisions (why) and methods (how) separately**\" → Reflect in decisions/patterns separately\n- \"**I don't know what to keep**\" → Filter by importance and propose only candidates for SSOT\n\n---\n\n## Supported Memory Systems\n\n| System | Detection Method | How to Get Observations |\n|--------|------------------|------------------------|\n| **Claude-mem** | Existence of `~/.claude-mem/settings.json` | `mem-search` skill |\n| **Serena** | Existence of `.serena/memories/` | `mcp__serena__read_memory` |\n\nAuto-detected at command execution, using available system.\n\n---\n\n## Steps\n\n### Step 0: Memory System Detection\n\n```bash\n# Claude-mem check\nif [ -f \"$HOME/.claude-mem/settings.json\" ]; then\n  echo \"📚 Claude-mem detected\"\n  MEMORY_SYSTEM=\"claude-mem\"\nfi\n\n# Serena check\nif [ -d \".serena/memories\" ]; then\n  echo \"📚 Serena detected\"\n  MEMORY_SYSTEM=\"serena\"\nfi\n\n# Prefer Claude-mem if both exist\n```\n\n**If neither exists**:\n- Switch to manual input mode\n- Ask user to paste observation content\n\n---\n\n### Step 1: Extract SSOT Promotion Candidates\n\n**For Claude-mem**:\n\n```\n# Search important observations with mem-search\nmem-search: type:decision\nmem-search: type:discovery concepts:pattern\nmem-search: type:bugfix concepts:gotcha\n```\n\n**For Serena**:\n\n```\n# Get Serena memory list\nmcp__serena__list_memories\n\n# Read target memories\n# e.g.: *_decisions_*, *_investigation_*\n```\n\n---\n\n### Step 2: Filter by Promotion Criteria\n\n#### Decisions Candidates (Why) → `decisions.md`\n\n| Observation Type | Concept | Promotion Criteria |\n|------------------|---------|-------------------|\n| `decision` | `why-it-exists`, `trade-off` | Technology selection, adoption/rejection reasons |\n| `guard` | `test-quality`, `implementation-quality` | Guardrail activation reasons |\n| `discovery` | `user-intent` | User requirements/constraints |\n\n#### Patterns Candidates (How) → `patterns.md`\n\n| Observation Type | Concept | Promotion Criteria |\n|------------------|---------|-------------------|\n| `bugfix` | `problem-solution` | Recurrence prevention patterns |\n| `discovery` | `pattern`, `how-it-works` | Reusable solutions |\n| `feature`, `refactor` | `pattern` | Implementation patterns |\n\n#### Exclusions\n\n- Work-in-progress rough notes (low confidence)\n- Personal/confidential information\n- One-time tasks (not reusable)\n\n---\n\n### Step 3: Reflect to SSOT (Deduplicate)\n\n#### decisions.md Format\n\n```markdown\n## D{N}: {Title}\n\n**Date**: YYYY-MM-DD\n**Tags**: #decision #{related keywords}\n**Observation ID**: #{original observation ID} (for duplicate prevention)\n\n### Conclusion\n\n{Adopted conclusion}\n\n### Background\n\n{Background that necessitated this decision}\n\n### Options\n\n1. {Option A}: {pros/cons}\n2. {Option B}: {pros/cons}\n\n### Adoption Reason\n\n{Why this option was chosen}\n\n### Impact\n\n{Scope of this decision's impact}\n\n### Review Conditions\n\n{Situations when this decision should be reconsidered}\n```\n\n#### patterns.md Format\n\n```markdown\n## P{N}: {Title}\n\n**Date**: YYYY-MM-DD\n**Tags**: #pattern #{related keywords}\n**Observation ID**: #{original observation ID} (for duplicate prevention)\n\n### Problem\n\n{What problem does this solve}\n\n### Solution\n\n{How to solve it}\n\n### Application Conditions\n\n{When to use this pattern}\n\n### Non-Application Conditions\n\n{When not to use this pattern}\n\n### Example\n\n{Code examples or specific steps}\n\n### Notes\n\n{Pitfalls and things to watch out for}\n```\n\n---\n\n### Step 4: Change Summary\n\n```markdown\n## 📚 SSOT Promotion Results\n\n### Added/Updated\n\n| File | Item | Original Observation ID |\n|------|------|------------------------|\n| decisions.md | D12: RBAC Adoption | #9602 |\n| patterns.md | P8: CORS Handling | #9584 |\n\n### Pending (Needs Review)\n\n| Observation ID | Title | Pending Reason |\n|----------------|-------|----------------|\n| #9590 | API Design Draft | Not finalized yet |\n\n### Excluded\n\n- Work-in-progress notes: 5 items\n- Duplicates: 2 items\n```\n\n---\n\n## Duplicate Prevention\n\nRecording observation ID in SSOT entries prevents the same observation from being promoted multiple times.\n\n```markdown\n## D12: RBAC Adoption\n\n**Observation ID**: #9602  ← This detects duplicates\n```\n\n---\n\n## Fallback on Failure\n\nIf memory system is inaccessible:\n\n1. Ask user to paste observation content\n2. Apply same procedure to reflect to SSOT\n\n```\n> Cannot access memory system.\n> Please paste the information you want to promote.\n```\n\n---\n\n## Related\n\n- `/harness-mem` - Claude-mem integration setup\n- `mem-search` skill - Search past memories\n- `.claude/memory/decisions.md` - Decisions (SSOT)\n- `.claude/memory/patterns.md` - Reusable patterns (SSOT)\n",
        "opencode/commands/optional/webhook-setup.md": "---\ndescription: GitHub Actions Webhook トリガーをセットアップ\n---\n\n# /webhook-setup - Webhook トリガーセットアップ\n\nGitHub Actions から Harness コマンドを自動実行するための設定を行います。\n**PR作成時に自動レビュー**などを実現できます。\n\n## VibeCoder Quick Reference\n\n- \"**PRで自動レビューしたい**\" → このコマンド\n- \"**CI でハーネス使いたい**\" → Webhook トリガーをセットアップ\n- \"**自動化したい**\" → GitHub Actions 連携\n\n## Deliverables\n\n- `.github/workflows/harness-review.yml` - PR自動レビューワークフロー\n- `.github/workflows/harness-plan-check.yml` - Plans.md 整合性チェック（オプション）\n\n---\n\n## Usage\n\n```bash\n/webhook-setup\n```\n\n---\n\n## Execution Flow\n\n### Step 1: 機能選択\n\n> 🔧 **どの自動化を設定しますか？**\n>\n> 1. PR自動レビュー（`/harness-review` をPR作成時に実行）\n> 2. Plans.md 整合性チェック（PRにタスク完了状況をコメント）\n> 3. 両方\n>\n> 番号で回答（デフォルト: 1）\n\n**ユーザーの回答を待つ**\n\n### Step 2: ワークフローファイル生成\n\n選択に応じてワークフローファイルを生成：\n\n#### PR自動レビュー（選択肢1, 3）\n\n`.github/workflows/harness-review.yml` を生成：\n\n```yaml\nname: Harness Review\n\non:\n  pull_request:\n    types: [opened, synchronize]\n\npermissions:\n  contents: read\n  pull-requests: write\n\njobs:\n  review:\n    name: Auto Review\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n\n      - name: Install Claude Code\n        run: npm install -g @anthropic-ai/claude-code\n\n      - name: Run Harness Review\n        env:\n          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}\n        run: |\n          # 変更ファイル一覧を取得\n          CHANGED_FILES=$(git diff --name-only origin/${{ github.base_ref }}...HEAD)\n\n          # レビュー実行（非対話モード）\n          claude --non-interactive << 'EOF'\n          /harness-review --ci --files \"$CHANGED_FILES\"\n\n          レビュー結果を以下の形式でまとめてください：\n          1. 重大な問題（あれば）\n          2. 改善提案\n          3. 良い点\n          EOF\n\n      - name: Post Review Comment\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const fs = require('fs');\n\n            // レビュー結果を読み込み（存在する場合）\n            let reviewBody = '## 🔍 Harness Auto Review\\n\\n';\n\n            if (fs.existsSync('.claude/state/last-review.md')) {\n              reviewBody += fs.readFileSync('.claude/state/last-review.md', 'utf8');\n            } else {\n              reviewBody += '✅ 自動レビューが完了しました。重大な問題は検出されませんでした。';\n            }\n\n            reviewBody += '\\n\\n---\\n🤖 Generated by [Claude Code Harness](https://github.com/Chachamaru127/claude-code-harness)';\n\n            await github.rest.issues.createComment({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: context.issue.number,\n              body: reviewBody\n            });\n```\n\n#### Plans.md 整合性チェック（選択肢2, 3）\n\n`.github/workflows/harness-plan-check.yml` を生成：\n\n```yaml\nname: Plans Check\n\non:\n  pull_request:\n    types: [opened, synchronize]\n    paths:\n      - 'Plans.md'\n      - 'src/**'\n\npermissions:\n  contents: read\n  pull-requests: write\n\njobs:\n  check:\n    name: Plans Consistency\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n\n      - name: Check Plans.md\n        id: plans\n        run: |\n          if [ ! -f Plans.md ]; then\n            echo \"plans_exists=false\" >> $GITHUB_OUTPUT\n            exit 0\n          fi\n\n          echo \"plans_exists=true\" >> $GITHUB_OUTPUT\n\n          # タスク状況をカウント\n          WIP=$(grep -c \"cc:WIP\" Plans.md 2>/dev/null || echo \"0\")\n          TODO=$(grep -c \"cc:TODO\" Plans.md 2>/dev/null || echo \"0\")\n          DONE=$(grep -c \"cc:DONE\" Plans.md 2>/dev/null || echo \"0\")\n\n          echo \"wip=$WIP\" >> $GITHUB_OUTPUT\n          echo \"todo=$TODO\" >> $GITHUB_OUTPUT\n          echo \"done=$DONE\" >> $GITHUB_OUTPUT\n\n      - name: Post Status Comment\n        if: steps.plans.outputs.plans_exists == 'true'\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const wip = '${{ steps.plans.outputs.wip }}';\n            const todo = '${{ steps.plans.outputs.todo }}';\n            const done = '${{ steps.plans.outputs.done }}';\n\n            const body = `## 📋 Plans.md Status\n\n            | Status | Count |\n            |--------|-------|\n            | 🔄 WIP | ${wip} |\n            | 📝 TODO | ${todo} |\n            | ✅ DONE | ${done} |\n\n            ---\n            🤖 Generated by [Claude Code Harness](https://github.com/Chachamaru127/claude-code-harness)`;\n\n            await github.rest.issues.createComment({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: context.issue.number,\n              body: body\n            });\n```\n\n### Step 3: シークレット設定ガイド\n\n> ⚠️ **ANTHROPIC_API_KEY の設定が必要です**\n>\n> GitHub リポジトリで以下を設定してください：\n>\n> 1. Settings → Secrets and variables → Actions\n> 2. \"New repository secret\" をクリック\n> 3. Name: `ANTHROPIC_API_KEY`\n> 4. Value: Anthropic API キーを入力\n>\n> 💡 API キーは https://console.anthropic.com で取得できます\n\n### Step 4: 完了報告\n\n> ✅ **Webhook トリガー設定完了**\n>\n> 📄 **生成ファイル**:\n> - `.github/workflows/harness-review.yml` - PR自動レビュー\n> - `.github/workflows/harness-plan-check.yml` - Plans.md チェック（選択時）\n>\n> **次のステップ:**\n> 1. `ANTHROPIC_API_KEY` シークレットを設定\n> 2. 変更をコミット＆プッシュ\n> 3. PRを作成して動作確認\n>\n> 💡 ワークフローはPR作成時に自動実行されます\n\n---\n\n## Generated Workflows\n\n### harness-review.yml\n\n| トリガー | 処理内容 |\n|----------|----------|\n| PR opened | 変更ファイルをレビュー |\n| PR synchronize | 追加コミット時に再レビュー |\n\n### harness-plan-check.yml\n\n| トリガー | 処理内容 |\n|----------|----------|\n| Plans.md 変更 | タスク状況をコメント |\n| src/** 変更 | 実装との整合性チェック |\n\n---\n\n## Customization\n\n### レビュー対象ファイルのフィルタリング\n\n```yaml\non:\n  pull_request:\n    paths:\n      - 'src/**'\n      - '!src/**/*.test.ts'  # テストファイルは除外\n```\n\n### レビュー観点のカスタマイズ\n\n```yaml\n- name: Run Harness Review\n  run: |\n    claude --non-interactive << 'EOF'\n    /harness-review --ci --focus security,performance\n    EOF\n```\n\n### 特定ブランチのみ実行\n\n```yaml\non:\n  pull_request:\n    branches:\n      - main\n      - develop\n```\n\n---\n\n## Troubleshooting\n\n### Error: ANTHROPIC_API_KEY not set\n\n**原因**: シークレットが未設定\n\n**解決**: リポジトリの Settings → Secrets で `ANTHROPIC_API_KEY` を設定\n\n### Error: Permission denied\n\n**原因**: ワークフローの権限不足\n\n**解決**: `permissions` セクションを確認\n```yaml\npermissions:\n  contents: read\n  pull-requests: write\n```\n\n### レビューコメントが投稿されない\n\n**原因**: `actions/github-script` の実行エラー\n\n**解決**: Actions タブでログを確認\n\n---\n\n## Related Commands\n\n- `/harness-review` - 手動コードレビュー\n- `/ci-setup` - 一般的なCI/CD設定\n- `/session-broadcast` - セッション間通知\n\n---\n\n## Notes\n\n- GitHub Actions の無料枠: パブリックリポは無制限、プライベートは2000分/月\n- API キーは絶対にコードにハードコードしないでください\n- 大きなPRはレビューに時間がかかる場合があります\n",
        "opencode/commands/pm/handoff-to-claude.md": "---\ndescription: Claude Codeへの作業依頼プロンプトを生成\n---\n\n# /handoff-to-claude\n\nあなたは **OpenCode (PM)** です。Claude Code に渡す依頼文を、コピー&ペーストできる形で生成してください。\n\n## 入力\n\n- @Plans.md（対象タスクを特定）\n- 可能なら `git status -sb` と `git diff --name-only`\n\n## 出力（そのままClaude Codeに貼る）\n\n次の Markdown を出力してください：\n\n```markdown\n/claude-code-harness:core:work\nultrathink\n\n## 依頼\n以下を実装してください。\n\n- 対象タスク:\n  - （Plans.md から該当タスクを列挙）\n\n## 制約\n- 既存のコードスタイルに従う\n- 変更は必要最小限\n- テスト/ビルド手順があれば提示\n\n## 受入条件\n- （3〜5個）\n\n## Evals（採点/検証）\nPlans.md の「評価（Evals）」に従って、**outcome/transcript を採点できる形**で進めてください。\n\n- tasks（シナリオ）:\n  - （例: 具体的な入力/手順/期待結果）\n- trials（回数/集計）:\n  - （例: 3回、成功率 + 中央値）\n- graders（採点）:\n  - outcome:\n    - （例: unit tests / typecheck / ファイル状態）\n  - transcript:\n    - （例: 禁止行為なし / 余計な変更なし）\n- 実行コマンド（可能なら）:\n  - （例: `npm test`, `./tests/validate-plugin.sh` など）\n\n## 参考\n- 関連ファイル（あれば）\n\n**作業完了後**: `/handoff-to-opencode` を実行して完了報告すること\n```\n",
        "opencode/commands/pm/plan-with-cc.md": "---\ndescription: 計画作成（Claude Codeと協調してタスク分解）\n---\n\n# /plan-with-cc\n\nあなたは **OpenCode (PM)** です。ユーザー要望を Plans.md に落とし込み、Claude Code が実装できる粒度に分解します。\n\n**このコマンドのゴール**は「やること」だけでなく **\"どう成功を判定するか（評価）\"** まで Plans.md に書き切ることです。\n評価がない計画は、実装が終わっても **成功/失敗を判定できず**、改善も退化も測れません。\n\n## 手順\n\n## 0) 最初に決める（ここを曖昧にすると破綻する）\n\n- **受入条件は測定可能にする**: 「いい感じ」「ちゃんと」禁止。誰が見ても Yes/No が付く形に落とす。\n- **outcome と transcript を分離する**:\n  - **outcome**: 最終状態（ファイル/DB/テスト結果/設定）で判定する。「言った」ではなく「なった」を見る。\n  - **transcript**: 途中経過（ツール使用、手順、回り道、禁止行為）で判定する。\n- **grader を明示する**: 各受入条件を何で採点するか（テスト/静的解析/grep/実行ログ/目視）を紐づける。\n- **trial 設計**（非決定性対策）:\n  - 何回回すか（例: 3回）\n  - どう集計するか（例: 成功率 + 所要時間の中央値）\n- **比較が必要なら対照実験を成立させる**:\n  - \"プラグイン無し/有り\" 等を比べるなら、グローバル設定の混入を避ける（例: HOME 分離/隔離環境/コンテナ）。\n\n### 通常の計画作成\n\n1. **要望を1〜2文で要約**\n2. **スコープ/非スコープ**（各3つ以内）\n3. **受入条件（3〜5個）** を列挙（測定可能に）\n4. **評価（Evals）** を決める（下のテンプレをそのまま埋める）\n5. Plans.md に「フェーズ」と「タスク」を追記（推奨: `pm:依頼中` / `cc:TODO`。互換: `cursor:依頼中`）\n6. Claude Code に実装を依頼する場合は **/handoff-to-claude** を実行して依頼文を生成（依頼文に Evals を必ず含める）\n\n### Claude Code からの検証依頼を受けた場合\n\nClaude Code が `/cc-cursor-cc` で生成した「計画検証依頼」を貼り付けられた場合：\n\n1. 依頼内容（やりたいこと、仮タスク、技術選択、未決事項）を確認\n2. **実現可能性を検証**（できないなら \"できない\" を明言し、代替案/段階案に落とす）\n   - 仮タスクが技術的に実現可能か\n   - 見落としている前提条件がないか\n3. **評価設計を検証**（ここが弱いと全部ムダになる）\n   - 受入条件が Yes/No で判定できるか\n   - outcome grader が存在するか（最低1つは自動採点）\n   - trial/比較の設計が妥当か\n4. **タスク分解**\n   - 仮タスクを実装可能な粒度に分解\n   - 依存関係・順序を整理\n5. **未決事項の判断**\n   - Claude Code から提示された未決事項について決定\n6. **Plans.md の更新**\n   - `pm:検証待ち` → `cc:TODO` に変更\n   - 分解したタスクを追記\n7. **/handoff-to-claude** を実行して Claude Code への依頼文を生成（Evals/DoD を必ず含める）\n\n---\n\n## Plans.md 追記テンプレ（コピペして埋める）\n\n```markdown\n## 🟠 {{テーマ}} `pm:依頼中`\n\n### 背景 / 目的\n- {{なぜ今やるか}}\n\n### スコープ（やる）\n- {{scope1}}\n- {{scope2}}\n\n### 非スコープ（やらない）\n- {{non-scope1}}\n- {{non-scope2}}\n\n### 受入条件（必ず測定可能に）\n- [ ] {{AC1: outcome で判定できる形}}\n- [ ] {{AC2}}\n- [ ] {{AC3}}\n\n### 評価（Evals）\n- **tasks（シナリオ）**:\n  - {{task1: 入力/手順/期待結果}}\n- **trials（回数/集計）**:\n  - 回数: {{例: 3}}\n  - 集計: {{例: 成功率 + 所要時間中央値}}\n- **graders（採点）**:\n  - outcome:\n    - {{例: unit tests / typecheck / ファイル存在 / grep で具体条件}}\n  - transcript:\n    - {{例: 禁止行為なし / 想定ツール使用 / 余計な変更なし}}\n- **比較（必要な場合のみ）**:\n  - {{例: with-feature vs without-feature / plugin-on vs plugin-off}}\n  - 混入対策: {{例: HOME分離 / コンテナ}}\n- **失敗時の扱い**:\n  - {{例: 失敗ログと再現手順を必ず残す。成功で上書きしない}}\n\n### タスク（Claude Code 実装用）\n- [ ] {{evalタスク: テスト/検証追加}} `pm:依頼中`\n- [ ] {{実装タスク1}} `pm:依頼中`\n- [ ] {{実装タスク2}} `pm:依頼中`\n- [ ] {{レビュー/検証タスク}} `pm:依頼中`\n\n### リスク / 未決事項\n- {{risk1}}\n- {{decision1: PM判断}}\n```\n\n---\n\n## 継続的に評価しながら開発する最低ルール（運用）\n\n- **Evals が書けない要件は \"未確定\" 扱い**: 先に仕様を詰める。実装に回さない。\n- **変更には必ず 1つ以上の自動 grader を追加**: \"人間の記憶\" をテストケースに変換して回帰を防ぐ。\n- **回帰はタスク化して suite に追加**: 失敗事例を \"未来のテスト\" にする（これが評価の複利）。\n\n## 参照\n\n- @Plans.md\n- @README.md\n- 変更点があれば `git diff` / `git status`\n",
        "opencode/commands/pm/project-overview.md": "---\ndescription: プロジェクト全体の概要を短く把握\n---\n\n# /project-overview\n\n以下を短くまとめてください（箇条書き中心）。\n\n## 入力\n\n- @README.md\n- @Plans.md\n- @AGENTS.md\n\n可能なら：\n- `git status -sb`\n- `git log --oneline -10`\n\n## 出力フォーマット\n\n- **目的**: このプロジェクトが何を作っているか（1-2行）\n- **現在地**: 今のフェーズ/未完了タスク（Plans.md基準）\n- **技術**: 言語/主要フレームワーク/テスト手段（推測でOK）\n- **次アクション**: 3つまで\n",
        "opencode/commands/pm/review-cc-work.md": "---\ndescription: Claude Codeの作業をレビューし、承認/修正指示をハンドオフ\n---\n\n# /review-cc-work\n\nあなたは **OpenCode (PM)** です。Claude Code からの完了報告（/handoff-to-opencode の出力）を受け取り、変更をレビューしてください。\n\n**重要**: レビュー後、承認/修正どちらの場合も **Hand off to Claude** を生成します。\n\n## 手順\n\n### Step 1: レビュー実施\n\n1. 変更ファイル/差分の要点を把握（`git diff` または完了報告から）\n2. 受入条件に照らして判定\n3. 品質・セキュリティ・パフォーマンス観点でチェック\n4. **Evals の確認**: Plans.md の「評価（Evals）」に基づく検証（テスト/ログ/ベンチ等）が提示されているか、結果が妥当か確認\n\n### Step 2: 判定\n\n| 判定 | 条件 | 次のアクション |\n|------|------|---------------|\n| **approve** | 受入条件を満たす | Plans.md の該当タスクを `pm:確認済` に変更 → コミット指示 → **ここで終了**（次タスクはユーザーの明示要求がある場合のみ） |\n| **request_changes** | 修正が必要 | 修正指示をまとめる → ハンドオフ生成 |\n\n### Step 3: ハンドオフ生成（必須）\n\nどちらの場合も、Claude Code に渡すハンドオフメッセージを生成してください。\n\n---\n\n## 出力フォーマット\n\n### 判定サマリー\n\n```\n## レビュー結果\n\n**判定**: approve / request_changes\n**理由**:\n- （1〜3点）\n\n**Plans.md 更新**:\n- `[タスク名]` → `pm:確認済` に変更（approveの場合）\n```\n\n### Hand off to Claude（必ず出力）\n\n#### approve の場合はコミットして終了\n\n**デフォルト動作**: approve 時は変更をコミットして終了します。次タスクはユーザーの明示要求がある場合のみハンドオフを生成してください。\n\n##### 承認のみ（デフォルト）\n\n承認 → コミット指示 → **ここで終了**。次タスクへの自動遷移は行いません。\n\n~~~markdown\n/claude-code-harness:core:work\nultrathink\n\n## 依頼\n\n前回のタスクは承認済みです。変更をコミットしてください。\n\n### コミット指示\n- 前回の変更を承認します。コミットしてください。\n- コミット後、作業は完了です。\n\n### 参考\n- 関連ファイル（あれば）\n\nコミット完了後は `/handoff-to-opencode` で報告してください。\n~~~\n\n##### ユーザーが次タスクを明示要求した場合のみ\n\nユーザーが「次タスクに進めて」「続けて」等を明示した場合にのみ、以下のテンプレートを使用：\n\n@Plans.md から次の `cc:TODO` または `pm:依頼中` タスクを分析し、以下を生成：\n\n~~~markdown\n/claude-code-harness:core:work\nultrathink\n\n## 依頼\n\n前回のタスクは承認済みです。**変更をコミットしてから**、次のタスクを実装してください。\n\n### コミット指示\n- 前回の変更を承認します。コミットしてから次のタスクに進んでください。\n\n### 対象タスク\n- （Plans.md から次タスクを抽出）\n\n### 背景\n- 前タスク完了・承認により着手可能になった\n- （依存関係があれば記載）\n\n### 制約\n- 既存のコードスタイルに従う\n- 変更は必要最小限\n- テスト/ビルドが通ることを確認\n\n### 受入条件\n- （3〜5個、具体的に）\n\n### 参考\n- 関連ファイル（あれば）\n\n完了後は `/handoff-to-opencode` で報告してください。\n~~~\n\n#### request_changes の場合\n\n修正指示を含むハンドオフを生成：\n\n~~~markdown\n/claude-code-harness:core:work\nultrathink\n\n## 修正依頼\n\nレビューの結果、以下の修正が必要です。\n\n### 修正対象タスク\n- （Plans.md の該当タスク）\n\n### 指摘事項\n1. **[重要度: 高/中/低]** 指摘内容\n   - 該当箇所: `ファイル名:行番号`\n   - 期待する修正: 具体的な対応方法\n\n2. **[重要度: 高/中/低]** 指摘内容\n   - 該当箇所:\n   - 期待する修正:\n\n### 制約\n- 既存のテストを壊さないこと\n- 指摘箇所以外は変更しないこと\n\n### 受入条件（修正後）\n- 上記指摘がすべて解消されていること\n- テスト/ビルドが通ること\n- （追加条件があれば）\n\n完了後は `/handoff-to-opencode` で報告してください。\n~~~\n\n---\n\n## ワークフロー図\n\n**フロー要約**: approve → commit → 終了（次タスクは明示要求時のみ）\n\n```\nClaude Code 完了報告\n        ↓\n  /review-cc-work\n        ↓\n   ┌────┴────┐\n   ↓         ↓\napprove   request_changes\n   ↓         ↓\npm:確認済   修正指示作成\n   ↓         ↓\ncommit      ハンドオフ生成\n   ↓         ↓\n 終了        ↓\n(次タスクは     ↓\n 明示要求      ↓\n 時のみ)       ↓\n   ↓         ↓\n   └────┬────┘\n        ↓\n  Claude Code へ貼り付け\n        ↓\n     /work 実行\n```\n",
        "opencode/commands/pm/start-session.md": "---\ndescription: セッション開始（状況把握→計画→Claude Codeへ依頼）\n---\n\n# /start-session\n\nあなたは **OpenCode (PM)** です。目的は「いま何をすべきか」を短時間で明確にし、必要なら Claude Code へ依頼することです。\n\n## 1) 状況把握（最初に読む）\n\n- @Plans.md\n- @AGENTS.md\n\n可能なら以下も確認：\n- `git status -sb`\n- `git log --oneline -5`\n- `git diff --name-only`\n\n## 2) 今日のゴールを決める\n\n次を1つに絞って提案してください：\n- 最優先タスク（1つ）\n- 受入条件（3つ以内）\n- 想定リスク（あれば）\n\n## 3) Claude Codeに依頼する（必要なら）\n\nタスクを Claude Code に渡す場合、**/handoff-to-claude** を実行して依頼文を作ってください。\n",
        "opencode/skills/2agent/SKILL.md": "---\nname: 2agent\ndescription: \"Configures 2-Agent workflow between PM and implementation roles. Use when user mentions 2-Agent setup, PM coordination, Cursor setup, or 2-agent operations. Do NOT load for: solo operation, workflow execution, or handoff processing.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# 2-Agent Skills\n\n2-Agent ワークフローの設定を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **初期設定** | See [references/2agent-setup.md](references/2agent-setup.md) |\n| **ファイル更新** | See [references/2agent-updating.md](references/2agent-updating.md) |\n| **Cursor連携** | See [references/cursor-setup.md](references/cursor-setup.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って設定\n",
        "opencode/skills/2agent/references/2agent-setup.md": "---\nname: setup-2agent-files\ndescription: \"2エージェント体制に必要なファイル（Cursorコマンド、メモリ構造、バージョンファイル）をセットアップするスキル。Cursor連携のセットアップファイルを生成する場合に使用します。\"\nallowed-tools: [\"Write\"]\n---\n\n# Setup 2-Agent Files Skill\n\n2エージェント体制（Cursor PM + Claude Code Worker）に必要な補助ファイルをセットアップするスキル。\n\n---\n\n## 目的\n\n`generate-workflow-files` が生成する AGENTS.md, CLAUDE.md, Plans.md 以外の\n2エージェント体制に必要なファイルを生成・配置します。\n\n---\n\n## 生成するファイル\n\n### Cursor コマンド (.cursor/commands/)\n\n| ファイル | 用途 | 使うタイミング |\n|---------|------|---------------|\n| `start-session.md` | セッション開始 | 作業を始める時 |\n| `project-overview.md` | プロジェクト全体確認 | 状況を把握したい時 |\n| `plan-with-cc.md` | 計画を立てる | 何をすべきか相談したい時 |\n| `handoff-to-claude.md` | タスク依頼 | 具体的な作業を依頼する時 |\n| `review-cc-work.md` | 完了レビュー | Claude Code の作業を確認する時 |\n\n### Claude Rules (.claude/rules/) - v0.4.0+\n\n| ファイル | 用途 |\n|---------|------|\n| `workflow.md` | 2-Agent ワークフロールール |\n| `coding-standards.md` | コーディング規約（paths: で条件適用） |\n\n### その他のファイル\n\n| ファイル | 用途 |\n|---------|------|\n| `.claude/memory/session-log.md` | セッション間の作業ログ |\n| `.claude/memory/decisions.md` | 重要な決定事項の記録 |\n| `.claude/memory/patterns.md` | 学んだパターンの記録 |\n| `.claude-code-harness-version` | プラグインバージョン管理 |\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `plugin_version` | プラグインのバージョン（VERSION ファイルから取得） |\n| `project_name` | プロジェクト名（ディレクトリ名から取得） |\n| `date` | セットアップ日（自動取得） |\n| `setup_status` | セットアップ状態（new / current / outdated） |\n\n### バージョンチェック\n\n既存の `.claude-code-harness-version` がある場合、バージョンを比較して以下を判定：\n\n| 状態 | 判定 | `should_proceed` | `update_type` |\n|------|------|------------------|---------------|\n| ファイルなし | 新規セットアップ | true | new |\n| 同じバージョン | 最新 | false（確認後 true） | skip |\n| 古いバージョン | 更新あり | true | update |\n\n---\n\n## 実行手順\n\n### Step 1: バージョン情報の取得\n\n```bash\n# プラグインパス（インストール場所に依存しない）\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n# プラグインのバージョンを取得\nPLUGIN_VERSION=$(cat \"$PLUGIN_PATH/VERSION\" 2>/dev/null || echo \"0.0.0\")\n\n# 現在の日付\nTODAY=$(date +%Y-%m-%d)\n\n# プロジェクト名\nPROJECT_NAME=$(basename \"$(pwd)\")\n```\n\n### Step 2: 既存ファイルの確認\n\n```bash\n# 既存ファイルをチェック\n[ -f .claude-code-harness-version ] && echo \"existing: .claude-code-harness-version\"\n[ -d .cursor/commands ] && echo \"existing: .cursor/commands/\"\n[ -d .claude/memory ] && echo \"existing: .claude/memory/\"\n```\n\n### Step 3: Cursor コマンドの配置\n\n**重要**: テンプレートフォルダ内の全コマンドをコピーする\n\n```bash\n# ディレクトリ作成\nmkdir -p .cursor/commands\n\n# テンプレートから全コマンドをコピー\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\ncp \"$PLUGIN_PATH/templates/cursor/commands/start-session.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/project-overview.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/plan-with-cc.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/handoff-to-claude.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/review-cc-work.md\" .cursor/commands/\n```\n\n**コピー元テンプレート** (5ファイル):\n- `templates/cursor/commands/start-session.md` - セッション開始\n- `templates/cursor/commands/project-overview.md` - プロジェクト確認\n- `templates/cursor/commands/plan-with-cc.md` - 計画立案\n- `templates/cursor/commands/handoff-to-claude.md` - タスク依頼\n- `templates/cursor/commands/review-cc-work.md` - 完了レビュー\n\n### Step 4: Claude Rules の配置（v0.4.0+）\n\n```bash\n# ディレクトリ作成\nmkdir -p .claude/rules\n\n# ルールファイルをテンプレートからコピー\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\nfor template in \"$PLUGIN_PATH/templates/rules\"/*.template; do\n  if [ -f \"$template\" ]; then\n    rule_name=$(basename \"$template\" .template)\n    cp \"$template\" \".claude/rules/$rule_name\"\n  fi\ndone\n```\n\n### Step 5: メモリ構造の初期化\n\n```bash\n# ディレクトリ作成\nmkdir -p .claude/memory\n```\n\n**session-log.md** を作成:\n\n```markdown\n# Session Log\n\nセッション間で共有する作業ログ。\n\n---\n\n## {{DATE}}\n\n- 2エージェント体制セットアップ完了\n```\n\n**decisions.md** を作成:\n\n```markdown\n# Decisions\n\nプロジェクトで決定された重要な設計・方針の記録。\n\n---\n\n## 設計決定\n\n（まだ記録なし）\n\n## 方針決定\n\n（まだ記録なし）\n```\n\n**patterns.md** を作成:\n\n```markdown\n# Patterns\n\nプロジェクトで発見・採用したパターンの記録。\n\n---\n\n## コーディングパターン\n\n（まだ記録なし）\n\n## 問題解決パターン\n\n（まだ記録なし）\n```\n\n### Step 6: バージョンファイルの作成\n\n**テンプレートから変数を置換して作成**:\n\n```bash\n# templates/.claude-code-harness-version.template を読み込み、変数を置換\nsed -e \"s/{{VERSION}}/${PLUGIN_VERSION}/g\" \\\n    -e \"s/{{DATE}}/${TODAY}/g\" \\\n    \"$PLUGIN_PATH/templates/.claude-code-harness-version.template\" \\\n    > .claude-code-harness-version\n```\n\nまたは直接作成:\n\n```\n# claude-code-harness version tracking\n# This file is auto-generated by /setup-cursor\n# DO NOT manually edit - used for update detection\n\nversion: {{PLUGIN_VERSION}}\ninstalled_at: {{TODAY}}\nlast_setup_command: setup-cursor\n```\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `should_proceed` | セットアップを続行するか（boolean） |\n| `update_type` | 更新タイプ（new / update / skip） |\n| `current_version` | 既存のバージョン（更新時のみ） |\n| `cursor_commands_created` | 作成された Cursor コマンド一覧 |\n| `memory_initialized` | メモリ構造の初期化完了フラグ |\n| `version_file_created` | バージョンファイル作成完了フラグ |\n\n---\n\n## 注意事項\n\n- **既存ファイルがある場合**: 上書き確認を求める\n- **テンプレートを直接コピー**: 簡略化せず、詳細版テンプレートを使用\n- **バージョン管理**: `.claude-code-harness-version` で更新検出を可能にする\n\n### Step 7: Hooks 設定の配置（自動整理機能）\n\n```bash\n# スクリプトディレクトリ作成\nmkdir -p .claude/scripts\n\n# Hook スクリプトをコピー\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\ncp \"$PLUGIN_PATH/templates/hooks/auto-cleanup-hook.sh\" .claude/scripts/\nchmod +x .claude/scripts/auto-cleanup-hook.sh\n\n# 設定ファイルをコピー\ncp \"$PLUGIN_PATH/templates/.claude-code-harness.config.yaml.template\" .claude-code-harness.config.yaml\n```\n\n**.claude/settings.json** は `generate-claude-settings` で作成/更新（既存があれば非破壊マージ）:\n\n- `permissions.deny/ask` をチーム運用できる形で整備\n- `permissions.disableBypassPermissionsMode` は **設定しない**（bypassPermissions を許可）\n  - セキュリティ要件で bypass を禁止したい場合のみ設定（例: managed-settings.json）\n\n**⚠️ パーミッション構文の注意**: プレフィックスマッチには必ず `:*` を使用（`*` 単独は不可）\n- 正しい: `\"Bash(npm run:*)\"` / 間違い: `\"Bash(npm run *)\"`\n\n手順は `skills/setup/generate-claude-settings/doc.md` に従うこと。\n\n---\n\n## 関連スキル\n\n- `generate-workflow-files` - AGENTS.md, CLAUDE.md, Plans.md の生成\n- `generate-claude-settings` - `.claude/settings.json` の作成/更新（安全ポリシー + 非破壊マージ）\n- `session-memory` - メモリ構造の活用方法\n- `core-read-repo-context` - 既存ファイルの確認\n- `auto-cleanup` - 自動整理機能\n",
        "opencode/skills/2agent/references/2agent-updating.md": "---\nname: update-2agent-files\ndescription: \"既存の2エージェント体制セットアップを更新するスキル（差分更新・マージ対応）。既存のCursor連携ファイルを更新する場合に使用します。\"\nallowed-tools: [\"Read\", \"Edit\"]\n---\n\n# Update 2-Agent Files Skill\n\n既存の2エージェント体制セットアップを最新バージョンに更新するスキル。\nユーザーデータを保持しながら、プラグインの改善を適用します。\n\n---\n\n## 目的\n\n- 既存の AGENTS.md, CLAUDE.md, Plans.md を最新テンプレートで更新\n- ユーザーのタスク・記録を保持\n- Case-insensitive なファイル検出\n- バージョン管理と更新履歴\n\n---\n\n## Case-Insensitive ファイル検出\n\n### 検出ロジック\n\n**重要**: macOS/Windows は case-insensitive、Linux は case-sensitive。\nすべての環境で一貫した動作を保証するため、明示的に検索する。\n\n```bash\n# 既存ファイルを case-insensitive で検索\ndetect_file() {\n  local pattern=\"$1\"\n  local found=$(find . -maxdepth 1 -iname \"$pattern\" -type f 2>/dev/null | head -1)\n  if [ -n \"$found\" ]; then\n    echo \"$found\"\n  fi\n}\n\nAGENTS_FILE=$(detect_file \"agents.md\")\nCLAUDE_FILE=$(detect_file \"claude.md\")\nPLANS_FILE=$(detect_file \"plans.md\")\nVERSION_FILE=\".claude-code-harness-version\"\n```\n\n### 検出結果の正規化\n\n```bash\n# 標準ファイル名との比較\nnormalize_filename() {\n  local found=\"$1\"\n  local standard=\"$2\"\n\n  if [ -n \"$found\" ] && [ \"$found\" != \"./$standard\" ]; then\n    echo \"検出: $found → 推奨: $standard\"\n    # ユーザーに確認後、リネーム\n    # mv \"$found\" \"$standard\"\n  fi\n}\n\nnormalize_filename \"$AGENTS_FILE\" \"AGENTS.md\"\nnormalize_filename \"$CLAUDE_FILE\" \"CLAUDE.md\"\nnormalize_filename \"$PLANS_FILE\" \"Plans.md\"\n```\n\n---\n\n## 期待されるファイル構成（v0.4.0）\n\n更新時に以下のファイルが**存在すべき**かチェックする：\n\n```\n./\n├── AGENTS.md\n├── CLAUDE.md\n├── Plans.md\n├── .claude-code-harness-version\n├── .claude-code-harness.config.yaml\n├── .cursor/\n│   └── commands/\n│       ├── start-session.md        # v0.3.5+（Named Sessions: v0.4.0+）\n│       ├── project-overview.md     # v0.3.5+\n│       ├── plan-with-cc.md         # v0.3.5+\n│       ├── handoff-to-claude.md\n│       └── review-cc-work.md\n└── .claude/\n    ├── rules/                      # v0.4.0+\n    │   ├── workflow.md\n    │   └── coding-standards.md\n    ├── memory/\n    │   ├── session-log.md\n    │   ├── decisions.md\n    │   └── patterns.md\n    └── scripts/\n        └── auto-cleanup-hook.sh    # v0.3.7+\n```\n\n---\n\n## 更新フロー\n\n### Step 1: 環境確認\n\n```bash\n# プラグインバージョン\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nPLUGIN_VERSION=$(cat \"$PLUGIN_PATH/VERSION\" 2>/dev/null || echo \"0.0.0\")\n\n# インストール済みバージョン\nif [ -f .claude-code-harness-version ]; then\n  INSTALLED_VERSION=$(grep \"^version:\" .claude-code-harness-version | cut -d' ' -f2)\n  SETUP_STATUS=\"existing\"\nelse\n  INSTALLED_VERSION=\"\"\n  SETUP_STATUS=\"not_installed\"\nfi\n\n# プロジェクト情報\nPROJECT_NAME=$(basename \"$(pwd)\")\nTODAY=$(date +%Y-%m-%d)\n```\n\n### Step 2: 足りないファイルの検出（重要）\n\n**テンプレート変更の有無に関わらず、必須ファイルが存在するかチェック**\n\n```bash\n# 必須ファイルリスト\nREQUIRED_FILES=(\n  \".cursor/commands/start-session.md\"\n  \".cursor/commands/project-overview.md\"\n  \".cursor/commands/plan-with-cc.md\"\n  \".cursor/commands/handoff-to-claude.md\"\n  \".cursor/commands/review-cc-work.md\"\n  \".claude/rules/workflow.md\"              # v0.4.0+\n  \".claude/rules/coding-standards.md\"      # v0.4.0+\n  \".claude/scripts/auto-cleanup-hook.sh\"\n  \".claude-code-harness.config.yaml\"\n)\n\nMISSING_FILES=()\n\nfor file in \"${REQUIRED_FILES[@]}\"; do\n  if [ ! -f \"$file\" ]; then\n    MISSING_FILES+=(\"$file\")\n    echo \"⚠️ 不足: $file\"\n  fi\ndone\n\nif [ ${#MISSING_FILES[@]} -gt 0 ]; then\n  echo \"\"\n  echo \"📋 ${#MISSING_FILES[@]} 個のファイルが不足しています。追加します。\"\n  NEEDS_FILE_ADD=true\nelse\n  echo \"✅ 必須ファイルは全て揃っています\"\n  NEEDS_FILE_ADD=false\nfi\n```\n\n### Step 3: 更新判定\n\n| 条件 | update_type | 動作 |\n|------|-------------|------|\n| `.claude-code-harness-version` なし | `not_installed` | `/setup-cursor` を案内 |\n| バージョン同じ & ファイル揃ってる | `current` | スキップ |\n| バージョン同じ & ファイル不足 | `missing_files` | 不足分を追加 |\n| バージョン古い | `outdated` | 更新を実行 |\n\n```bash\nif [ \"$SETUP_STATUS\" = \"not_installed\" ]; then\n  echo \"⚠️ セットアップされていません。/setup-cursor を実行してください。\"\n  exit 1\nfi\n\nif [ \"$INSTALLED_VERSION\" = \"$PLUGIN_VERSION\" ]; then\n  echo \"✅ 最新バージョン (v${PLUGIN_VERSION}) です。\"\n  echo \"強制更新する場合は「強制更新して」と言ってください。\"\n  # --force オプションがあれば続行\nfi\n```\n\n### Step 4: バックアップ作成\n\n```bash\nBACKUP_DIR=\".claude-code-harness-backup-$(date +%Y%m%d-%H%M%S)\"\nmkdir -p \"$BACKUP_DIR\"\n\n# 既存ファイルをバックアップ\n[ -n \"$AGENTS_FILE\" ] && cp \"$AGENTS_FILE\" \"$BACKUP_DIR/\"\n[ -n \"$CLAUDE_FILE\" ] && cp \"$CLAUDE_FILE\" \"$BACKUP_DIR/\"\n[ -n \"$PLANS_FILE\" ] && cp \"$PLANS_FILE\" \"$BACKUP_DIR/\"\n[ -f .claude-code-harness-version ] && cp .claude-code-harness-version \"$BACKUP_DIR/\"\n\necho \"📦 バックアップ: $BACKUP_DIR\"\n```\n\n### Step 5: Plans.md のマージ更新\n\n**merge-plans スキルを呼び出す**\n\n```bash\n# 既存の Plans.md からタスクセクションを抽出\nextract_tasks \"$PLANS_FILE\" > /tmp/existing_tasks.md\n\n# テンプレートに既存タスクをマージ\nmerge_plans \"$PLUGIN_PATH/templates/Plans.md.template\" /tmp/existing_tasks.md > Plans.md\n```\n\n### Step 6: AGENTS.md / CLAUDE.md の更新\n\n```bash\n# プロジェクト名を保持しつつテンプレートを適用\nsed -e \"s/{{PROJECT_NAME}}/$PROJECT_NAME/g\" \\\n    -e \"s/{{DATE}}/$TODAY/g\" \\\n    \"$PLUGIN_PATH/templates/AGENTS.md.template\" > AGENTS.md\n\nsed -e \"s/{{PROJECT_NAME}}/$PROJECT_NAME/g\" \\\n    -e \"s/{{DATE}}/$TODAY/g\" \\\n    \"$PLUGIN_PATH/templates/CLAUDE.md.template\" > CLAUDE.md\n\n# 旧ファイル名を削除（正規化）\n[ -n \"$AGENTS_FILE\" ] && [ \"$AGENTS_FILE\" != \"./AGENTS.md\" ] && rm \"$AGENTS_FILE\"\n[ -n \"$CLAUDE_FILE\" ] && [ \"$CLAUDE_FILE\" != \"./CLAUDE.md\" ] && rm \"$CLAUDE_FILE\"\n[ -n \"$PLANS_FILE\" ] && [ \"$PLANS_FILE\" != \"./Plans.md\" ] && rm \"$PLANS_FILE\"\n```\n\n### Step 7: Cursor コマンドの更新（全5ファイル）\n\n```bash\nmkdir -p .cursor/commands\ncp \"$PLUGIN_PATH/templates/cursor/commands/start-session.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/project-overview.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/plan-with-cc.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/handoff-to-claude.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/review-cc-work.md\" .cursor/commands/\n```\n\n### Step 8: Claude Rules の更新（v0.4.0+）\n\n```bash\n# ディレクトリ作成（存在しない場合）\nmkdir -p .claude/rules\n\n# プラグイン提供のルールを更新（テンプレートから）\nfor template in \"$PLUGIN_PATH/templates/rules\"/*.template; do\n  if [ -f \"$template\" ]; then\n    rule_name=$(basename \"$template\" .template)\n    target=\".claude/rules/$rule_name\"\n    cp \"$template\" \"$target\"\n    echo \"  ✅ $rule_name を更新\"\n  fi\ndone\n\n# 注意: ユーザーが独自に作成したルール（テンプレートにないもの）は保持される\n```\n\n### Step 9: Hooks 設定の更新（v0.3.7+）\n\n```bash\n# スクリプトディレクトリ作成\nmkdir -p .claude/scripts\n\n# Hook スクリプトをコピー\ncp \"$PLUGIN_PATH/templates/hooks/auto-cleanup-hook.sh\" .claude/scripts/\nchmod +x .claude/scripts/auto-cleanup-hook.sh\n\n# 設定ファイルをコピー（存在しない場合のみ）\n[ ! -f .claude-code-harness.config.yaml ] && \\\n  cp \"$PLUGIN_PATH/templates/.claude-code-harness.config.yaml.template\" .claude-code-harness.config.yaml\n\n# .claude/settings.json を更新（既存設定は非破壊マージ）\n# ここは `generate-claude-settings` を実行して統一する\n# - permissions.allow|ask|deny: 配列マージ + 重複排除\n# - permissions.disableBypassPermissionsMode: 常に \"disable\"\n```\n\n### Step 10: バージョンファイルの更新\n\n```bash\ncat > .claude-code-harness-version << EOF\n# claude-code-harness version tracking\n# Updated by /setup-cursor\n\nversion: ${PLUGIN_VERSION}\ninstalled_at: ${TODAY}\nlast_setup_command: setup-cursor\nupdated_from: ${INSTALLED_VERSION}\nupdate_history:\n  - ${INSTALLED_VERSION} -> ${PLUGIN_VERSION} (${TODAY})\nEOF\n```\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `update_performed` | 更新が実行されたか |\n| `old_version` | 更新前のバージョン |\n| `new_version` | 更新後のバージョン |\n| `backup_path` | バックアップの場所 |\n| `tasks_preserved` | 保持されたタスク数 |\n| `normalized_files` | 正規化されたファイル |\n\n---\n\n## エラー処理\n\n| エラー | 対応 |\n|--------|------|\n| Plans.md 解析失敗 | バックアップを保持し、テンプレートで再作成 |\n| ファイル書き込み失敗 | バックアップから復元 |\n| テンプレート見つからない | プラグイン再インストールを案内 |\n\n---\n\n## 関連スキル\n\n- `merge-plans` - Plans.md のマージロジック\n- `setup-2agent-files` - 初回セットアップ\n- `generate-workflow-files` - ワークフローファイル生成\n- `generate-claude-settings` - `.claude/settings.json` の作成/更新（安全ポリシー + 非破壊マージ）\n",
        "opencode/skills/2agent/references/cursor-setup.md": "---\nname: setup-cursor\ndescription: \"Cursor連携のセットアップ（.cursor/commands 生成）。Cursor と Claude Code で役割分担したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Bash\"]\n---\n\n# Setup Cursor Skill\n\nCursor側のカスタムコマンド（`.cursor/commands/*.md`）を生成し、2-agent運用を開始できる状態にするスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「CursorとClaude Codeで役割分担したい」\n- 「2-agent運用を始めたい」\n- 「Cursor連携をセットアップして」\n- 「計画はCursor、実装はClaudeに任せたい」\n\n---\n\n## 生成するファイル\n\n- `.cursor/commands/start-session.md`\n- `.cursor/commands/project-overview.md`\n- `.cursor/commands/plan-with-cc.md`\n- `.cursor/commands/handoff-to-claude.md`\n- `.cursor/commands/review-cc-work.md`\n- `.claude/memory/decisions.md`（SSOT）\n- `.claude/memory/patterns.md`（SSOT）\n\n---\n\n## 実行フロー\n\n1. `.cursor/commands/` を作成\n2. 5つのコマンドファイルを生成\n3. `.claude/memory/` を作成し、SSOTファイルを初期化\n4. Cursorを再起動してコマンドが表示されることを案内\n",
        "opencode/skills/auth/SKILL.md": "---\nname: auth\ndescription: \"Implements authentication and payment features using Clerk, Supabase Auth, or Stripe. Use when user mentions login, authentication, payments, subscriptions, or Stripe. Do NOT load for: general UI work, database design, or non-auth features.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Auth Skills\n\n認証と決済機能の実装を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **認証機能** | See [references/authentication.md](references/authentication.md) |\n| **決済機能** | See [references/payments.md](references/payments.md) |\n\n## 実行手順\n\n1. **品質判定ゲート**（Step 0）\n2. ユーザーのリクエストを分類(認証 or 決済)\n3. 上記の「機能詳細」から適切な参照ファイルを読む\n4. その内容に従って実装\n\n### Step 0: 品質判定ゲート（セキュリティチェックリスト）\n\n認証・決済機能は常にセキュリティリスクが高いため、作業開始前に必ず以下を表示:\n\n```markdown\n🔐 セキュリティチェックリスト\n\nこの作業はセキュリティ上重要です。以下を確認してください：\n\n### 認証関連\n- [ ] パスワードはハッシュ化（bcrypt/argon2）\n- [ ] セッション管理は安全か（HTTPOnly Cookie）\n- [ ] CSRF 対策は実装されているか\n- [ ] レート制限（ブルートフォース対策）\n\n### 決済関連\n- [ ] 機密情報（カード番号等）をサーバーに保存しない\n- [ ] Stripe/決済プロバイダの SDK を正しく使用\n- [ ] Webhook の署名検証\n- [ ] 金額改ざん防止（サーバー側で金額を確定）\n\n### 共通\n- [ ] エラーメッセージが詳細すぎないか（情報漏洩防止）\n- [ ] ログに機密情報を出力していないか\n```\n\n### セキュリティ重要度表示\n\n```markdown\n⚠️ 注意レベル: 🔴 高\n\nこの機能は以下のリスクがあります：\n- 認証情報の漏洩\n- 不正アクセス\n- 決済の不正操作\n\n専門家によるレビューを推奨します。\n```\n\n### VibeCoder 向け\n\n```markdown\n🔐 安全にログイン・決済機能を作るために\n\n1. **パスワードは「ハッシュ化」する**\n   - 元のパスワードを復元できない形で保存\n   - 万が一データが漏れても安全\n\n2. **カード情報はサーバーに保存しない**\n   - Stripe などの専用サービスに任せる\n   - 自分のサーバーには一切保存しない\n\n3. **エラーメッセージは曖昧に**\n   - 「パスワードが違います」ではなく「認証に失敗しました」\n   - 悪意ある人にヒントを与えない\n```\n",
        "opencode/skills/auth/references/authentication.md": "---\nname: auth\ndescription: \"認証機能の実装（Clerk / Supabase Auth 等）。ログイン機能を追加したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Auth Skill\n\nClerk または Supabase Auth を使用した認証機能を実装するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「ログイン機能を付けて」\n- 「認証を追加して」\n- 「Clerkで認証を実装して」\n- 「Supabase Authを設定して」\n- 「Googleログインを追加して」\n\n---\n\n## 機能\n\n- サインアップ/ログイン\n- ソーシャルログイン（Google, GitHub）\n- メール認証\n- パスワードリセット\n- ユーザープロフィール管理\n\n---\n\n## 実行フロー\n\n1. プロジェクト構成を確認\n2. Clerk または Supabase Auth を選択\n3. 必要なパッケージをインストール\n4. 認証設定ファイルを生成\n5. ログイン/サインアップUIを作成\n6. ミドルウェア/保護ルートを設定\n",
        "opencode/skills/auth/references/payments.md": "---\nname: payments\ndescription: \"決済機能の実装（Stripe）。サブスクや買い切り決済を追加したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Payments Skill\n\nStripeを使用した決済機能を実装するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「決済を付けたい」\n- 「Stripeを導入して」\n- 「サブスクを実装して」\n- 「買い切り決済を追加して」\n\n---\n\n## 機能\n\n- サブスクリプション（月額/年額）\n- 一回払い\n- Webhook（決済完了通知）\n- 顧客ポータル（プラン変更、キャンセル）\n\n---\n\n## 実行フロー\n\n1. プロジェクト構成を確認\n2. サブスク or 一回払いを選択\n3. Stripe SDKをインストール\n4. 決済ページを作成\n5. Webhookエンドポイントを設定\n6. 環境変数の設定をガイド\n",
        "opencode/skills/ci/SKILL.md": "---\nname: ci\ndescription: \"Diagnoses and fixes CI/CD pipeline failures. Use when user mentions CI failures, build errors, test failures, or pipeline issues. Do NOT load for: local builds, standard implementation work, reviews, or setup.\"\nallowed-tools: [\"Read\", \"Grep\", \"Bash\", \"Task\"]\ncontext: fork\n---\n\n# CI/CD Skills\n\nCI/CD パイプラインに関する問題を解決するスキル群です。\n\n---\n\n## 発動条件\n\n- 「CIが落ちた」「GitHub Actionsが失敗」\n- 「ビルドエラー」「テストが通らない」\n- 「パイプラインを直して」\n\n---\n\n## 機能詳細\n\n| 機能 | 詳細 | トリガー |\n|------|------|----------|\n| **失敗分析** | See [references/analyzing-failures.md](references/analyzing-failures.md) | 「ログを見て」「原因を調べて」 |\n| **テスト修正** | See [references/fixing-tests.md](references/fixing-tests.md) | 「テストを直して」「修正案を出して」 |\n\n---\n\n## 実行手順\n\n1. **テスト vs 実装判定**（Step 0）\n2. ユーザーの意図を分類（分析 or 修正）\n3. 複雑度を判定（下記参照）\n4. 上記の「機能詳細」から適切な参照ファイルを読む、または ci-cd-fixer サブエージェント起動\n5. 結果を確認し、必要に応じて再実行\n\n### Step 0: テスト vs 実装判定（品質判定ゲート）\n\nCI 失敗時、まず原因の切り分けを行う:\n\n```\nCI 失敗報告\n    ↓\n┌─────────────────────────────────────────┐\n│           テスト vs 実装判定             │\n├─────────────────────────────────────────┤\n│  エラーの原因を分析:                    │\n│  ├── 実装が間違い → 実装を修正          │\n│  ├── テストが古い → ユーザーに確認      │\n│  └── 環境問題 → 環境修正                │\n└─────────────────────────────────────────┘\n```\n\n#### 禁止事項（改ざん防止）\n\n```markdown\n⚠️ CI 失敗時の禁止事項\n\n以下の「解決策」は禁止です：\n\n| 禁止 | 例 | 正しい対応 |\n|------|-----|-----------|\n| テスト skip 化 | `it.skip(...)` | 実装を修正 |\n| アサーション削除 | `expect()` を消す | 期待値を確認 |\n| CI チェック迂回 | `continue-on-error` | 根本原因修正 |\n| lint ルール緩和 | `eslint-disable` | コードを修正 |\n```\n\n#### 判断フロー\n\n```markdown\n🔴 CI が失敗しています\n\n**判断が必要です**:\n\n1. **実装が間違い** → 実装を修正 ✅\n2. **テストの期待値が古い** → ユーザーに確認を求める\n3. **環境の問題** → 環境設定を修正\n\n⚠️ テストの改ざん（skip化、アサーション削除）は禁止です\n\nどれに該当しますか？\n```\n\n#### 承認が必要な場合\n\nテスト/設定の変更がやむを得ない場合:\n\n```markdown\n## 🚨 テスト/設定変更の承認リクエスト\n\n### 理由\n[なぜこの変更が必要か]\n\n### 変更内容\n[差分]\n\n### 代替案の検討\n- [ ] 実装の修正で解決できないか確認した\n\nユーザーの明示的な承認を待つ\n```\n\n## サブエージェント連携\n\n以下の条件を満たす場合、Task tool で ci-cd-fixer を起動:\n\n- 修正 → 再実行 → 失敗のループが **2回以上** 発生\n- または、エラーが複数ファイルにまたがる複雑なケース\n\n**起動パターン:**\n\n```\nTask tool:\n  subagent_type=\"ci-cd-fixer\"\n  prompt=\"CI失敗を診断・修正してください。エラーログ: {error_log}\"\n```\n\nci-cd-fixer は安全第一で動作（デフォルト dry-run モード）。\n詳細は `agents/ci-cd-fixer.md` を参照。\n\n---\n\n## VibeCoder 向け\n\n```markdown\n🔧 CI が壊れたときの言い方\n\n1. **「CI が落ちた」「赤くなった」**\n   - 自動テストが失敗している状態\n\n2. **「なんで失敗してるの？」**\n   - 原因を調べてほしい\n\n3. **「直して」**\n   - 自動で修正を試みる\n\n💡 重要: テストを「ごまかす」修正は禁止です\n   - ❌ テストを消す、スキップする\n   - ⭕ コードを正しく直す\n\n「テストが間違ってそう」と思ったら、\nまず確認してから対応を決めましょう\n```\n",
        "opencode/skills/ci/references/analyzing-failures.md": "---\nname: ci-analyze-failures\ndescription: \"CI の失敗ログを解析し、原因を特定する。CI/CDパイプラインでテストやビルドが失敗した場合に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Bash\"]\n---\n\n# CI Analyze Failures\n\nCI/CD パイプラインの失敗を分析し、原因を特定するスキル。\nGitHub Actions、GitLab CI 等のログを解釈します。\n\n---\n\n## 入力\n\n- **CI ログ**: 失敗したジョブのログ\n- **run_id**: CI 実行の識別子（あれば）\n- **リポジトリコンテキスト**: CI 設定ファイル\n\n---\n\n## 出力\n\n- **失敗原因の特定**: 具体的な原因\n- **修正提案**: 対処方法の提案\n\n---\n\n## 実行手順\n\n### Step 1: CI 状態の確認\n\n```bash\n# GitHub Actions の場合\ngh run list --limit 5\n\n# 最新の失敗を確認\ngh run view --log-failed\n```\n\n### Step 2: 失敗ログの取得\n\n```bash\n# 特定の run のログ\ngh run view {{run_id}} --log\n\n# 失敗ステップのみ\ngh run view {{run_id}} --log-failed\n```\n\n### Step 3: エラーパターンの分析\n\n#### ビルドエラー\n\n```\nパターン: \"error TS\\d+:\" または \"Build failed\"\n原因候補:\n- TypeScript 型エラー\n- 依存関係の不足\n- 構文エラー\n```\n\n#### テストエラー\n\n```\nパターン: \"FAIL\" または \"✕\" または \"AssertionError\"\n原因候補:\n- テストの失敗\n- テストタイムアウト\n- モックの不一致\n```\n\n#### 依存関係エラー\n\n```\nパターン: \"npm ERR!\" または \"Could not resolve\"\n原因候補:\n- package.json の不整合\n- プライベートパッケージの認証\n- バージョン競合\n```\n\n#### 環境エラー\n\n```\nパターン: \"not found\" または \"undefined\"\n原因候補:\n- 環境変数の未設定\n- シークレットの不足\n- パスの問題\n```\n\n### Step 4: 分析結果の出力\n\n```markdown\n## 🔍 CI 失敗分析\n\n**Run ID**: {{run_id}}\n**失敗時刻**: {{timestamp}}\n**失敗ステップ**: {{step_name}}\n\n### 原因特定\n\n**エラータイプ**: {{ビルド / テスト / 依存関係 / 環境}}\n\n**エラーメッセージ**:\n```\n{{エラーの核心部分}}\n```\n\n**原因分析**:\n{{具体的な原因の説明}}\n\n### 関連ファイル\n\n| ファイル | 関連性 |\n|---------|-------|\n| `{{path}}` | {{関連内容}} |\n\n### 修正提案\n\n1. {{具体的な修正手順1}}\n2. {{具体的な修正手順2}}\n\n### 自動修正の可否\n\n- 自動修正: {{可能 / 不可能}}\n- 理由: {{理由}}\n```\n\n---\n\n## エラーパターン辞書\n\n### TypeScript エラー\n\n| エラーコード | 意味 | 典型的な修正 |\n|-------------|------|-------------|\n| TS2304 | 名前が見つからない | import 追加 |\n| TS2322 | 型が一致しない | 型修正 |\n| TS2345 | 引数の型が違う | 引数修正 |\n| TS7006 | 暗黙の any | 型注釈追加 |\n\n### npm エラー\n\n| エラー | 意味 | 典型的な修正 |\n|--------|------|-------------|\n| ERESOLVE | 依存関係解決失敗 | package-lock 削除 & 再インストール |\n| ENOENT | ファイルが見つからない | パス確認 |\n| EACCES | 権限エラー | CI 設定確認 |\n\n### Jest/Vitest エラー\n\n| エラー | 意味 | 典型的な修正 |\n|--------|------|-------------|\n| Timeout | テストタイムアウト | タイムアウト延長 or 非同期修正 |\n| Snapshot | スナップショット不一致 | `npm test -- -u` |\n\n---\n\n## 複数エラーの優先順位\n\n1. **ビルドエラー**: 最優先で修正\n2. **依存関係エラー**: ビルド前に解決必要\n3. **テストエラー**: ビルド成功後に対応\n4. **Lint エラー**: 最後に対応\n\n---\n\n## 次のアクションへの接続\n\n分析完了後：\n\n> 📊 **分析完了**\n>\n> **原因**: {{原因の要約}}\n>\n> **次のアクション**:\n> - 「修正して」→ 自動修正を試行\n> - 「詳しく」→ さらに詳細な分析\n> - 「スキップ」→ 手動対応に切り替え\n\n---\n\n## 注意事項\n\n- **ログは大きい**: 重要部分を抽出\n- **連鎖エラー注意**: 最初のエラーを見つける\n- **環境差異**: ローカルと CI の違いを考慮\n",
        "opencode/skills/ci/references/fixing-tests.md": "---\nname: ci-fix-failing-tests\ndescription: \"CI で失敗したテストを修正するためのガイド。CI失敗の原因が特定された後、自動修正を試みる場合に使用します。\"\nallowed-tools: [\"Read\", \"Edit\", \"Bash\"]\n---\n\n# CI Fix Failing Tests\n\nCI で失敗したテストを修正するスキル。\nテストコードの修正、または本体コードの修正を行います。\n\n---\n\n## 入力\n\n- **失敗テスト情報**: テスト名、エラーメッセージ\n- **テストファイル**: 失敗したテストのソース\n- **テスト対象コード**: テスト対象の実装\n\n---\n\n## 出力\n\n- **修正されたコード**: テストまたは実装の修正\n- **テスト通過の確認**\n\n---\n\n## 実行手順\n\n### Step 1: 失敗テストの特定\n\n```bash\n# ローカルでテスト実行\nnpm test 2>&1 | tail -50\n\n# 特定ファイルのテスト\nnpm test -- {{test-file}}\n```\n\n### Step 2: エラータイプの分類\n\n#### タイプ A: アサーション失敗\n\n```\nExpected: \"expected value\"\nReceived: \"actual value\"\n```\n\n→ 実装が期待と異なる、またはテストの期待値が間違っている\n\n#### タイプ B: タイムアウト\n\n```\nTimeout - Async callback was not invoked within the 5000ms timeout\n```\n\n→ 非同期処理が完了しない、または時間がかかりすぎる\n\n#### タイプ C: 型エラー\n\n```\nTypeError: Cannot read properties of undefined\n```\n\n→ null/undefined のアクセス、または初期化の問題\n\n#### タイプ D: モック関連\n\n```\nexpected mockFn to have been called\n```\n\n→ モックの設定不足、または呼び出しが行われていない\n\n### Step 3: 修正戦略の決定\n\n```markdown\n## 修正方針判断\n\n1. **テストが正しい場合** → 実装を修正\n2. **実装が正しい場合** → テストを修正\n3. **両方修正が必要**   → 実装を優先\n\n判断基準:\n- 仕様・要件に照らしてどちらが正しいか\n- 最近の変更は何か\n- 他のテストへの影響\n```\n\n### Step 4: 修正の実装\n\n#### アサーション失敗の修正\n\n```typescript\n// テストの期待値が間違っている場合\nit('calculates correctly', () => {\n  // 修正前\n  expect(calculate(2, 3)).toBe(5)\n  // 修正後（仕様が掛け算の場合）\n  expect(calculate(2, 3)).toBe(6)\n})\n\n// 実装が間違っている場合\n// → 実装ファイルを修正\n```\n\n#### タイムアウトの修正\n\n```typescript\n// タイムアウトを延長\nit('fetches data', async () => {\n  // ...\n}, 10000)  // 10秒に延長\n\n// または async/await を正しく使用\nit('fetches data', async () => {\n  await waitFor(() => {\n    expect(screen.getByText('Data')).toBeInTheDocument()\n  })\n})\n```\n\n#### モック関連の修正\n\n```typescript\n// モックの設定を追加\nvi.mock('../api', () => ({\n  fetchData: vi.fn().mockResolvedValue({ data: 'mock' })\n}))\n\n// beforeEach でリセット\nbeforeEach(() => {\n  vi.clearAllMocks()\n})\n```\n\n### Step 5: 修正後の確認\n\n```bash\n# 失敗テストを再実行\nnpm test -- {{test-file}}\n\n# 全テスト実行（リグレッション確認）\nnpm test\n```\n\n---\n\n## 修正パターン集\n\n### スナップショット更新\n\n```bash\n# スナップショットの更新\nnpm test -- -u\n\n# 特定テストのみ\nnpm test -- {{test-file}} -u\n```\n\n### 非同期テストの修正\n\n```typescript\n// findBy を使用（自動待機）\nconst element = await screen.findByText('Text')\n\n// waitFor を使用\nawait waitFor(() => {\n  expect(mockFn).toHaveBeenCalled()\n})\n```\n\n### モックデータの更新\n\n```typescript\n// 実装の変更に合わせてモックを更新\nconst mockData = {\n  id: 1,\n  name: 'Test',\n  createdAt: new Date().toISOString()  // 新しいフィールド\n}\n```\n\n---\n\n## 修正後のチェックリスト\n\n- [ ] 失敗していたテストが通過する\n- [ ] 他のテストが壊れていない\n- [ ] 実装の意図と一致している\n- [ ] 過度に緩いテストになっていない\n\n---\n\n## 完了報告フォーマット\n\n```markdown\n## ✅ テスト修正完了\n\n### 修正内容\n\n| テスト | 問題 | 修正 |\n|-------|------|------|\n| `{{テスト名}}` | {{問題}} | {{修正内容}} |\n\n### 確認結果\n\n```\nTests: {{passed}} passed, {{total}} total\n```\n\n### 次のアクション\n\n「コミットして」または「CI を再実行して」\n```\n\n---\n\n## 注意事項\n\n- **テストを削除しない**: 削除は最終手段\n- **skip は一時的に**: 恒久的な skip は禁止\n- **ルートコーズを特定**: 表面的な修正を避ける\n",
        "opencode/skills/codex-review/SKILL.md": "---\nname: codex-review\ndescription: \"Integrates OpenAI Codex CLI as an MCP server to provide second-opinion reviews. Triggered by requests for Codex review, second opinion, or Codex setup. Do NOT load for: standard reviews without Codex, implementation work, or non-setup tasks.\"\nallowed-tools: [\"Bash\", \"Read\", \"Write\", \"Edit\"]\n---\n\n# Codex Review Integration Skill\n\nOpenAI Codex CLI を MCP サーバーとして Claude Code に統合し、コードレビュー時にセカンドオピニオンを提供するスキル。\n\n## 🎯 使用場面\n\n### セットアップ\n- **初回設定**: Codex CLI のインストール確認と MCP 登録\n- **認証設定**: Codex への OAuth / API キー認証\n\n### レビュー\n- **セカンドオピニオン**: Claude のレビュー結果に Codex の視点を追加\n- **コード品質チェック**: 複数 AI モデルの得意分野を活用\n- **設計レビュー**: アーキテクチャや実装パターンの多角的検証\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **MCP セットアップ** | See [references/codex-mcp-setup.md](references/codex-mcp-setup.md) |\n| **レビュー統合** | See [references/codex-review-integration.md](references/codex-review-integration.md) |\n| **4並列レビュー** | See [references/codex-parallel-review.md](references/codex-parallel-review.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って設定またはレビューを実行\n\n### ⚠️ 並列レビュー時の必須ルール\n\n**Codex モード（`review.mode: codex`）でのレビュー実行時**:\n\n1. **呼び出すエキスパートを判定**（全部ではなく必要なもののみ）:\n   - 設定で `enabled: false` → 除外\n   - CLI/バックエンド → Accessibility, SEO 除外\n   - ドキュメントのみ変更 → Quality, Architect, Plan Reviewer, Scope Analyst を優先（Security, Performance は除外可）\n2. 有効なエキスパートの `references/experts/*.md` から **プロンプトを個別に読み込む**\n3. 有効なエキスパートのみ **MCP 呼び出しを1つのレスポンス内で並列実行**\n4. 絶対に1回の呼び出しで複数観点をまとめない\n\n```\n✅ 正しい（Code Reviewの場合、4エキスパート）:\n   mcp__codex__codex({prompt: security-expert.md})\n   mcp__codex__codex({prompt: performance-expert.md})\n   mcp__codex__codex({prompt: quality-expert.md})\n   mcp__codex__codex({prompt: accessibility-expert.md})\n\n❌ 間違い:\n   mcp__codex__codex({prompt: \"セキュリティとパフォーマンスと品質をレビューして\"})\n```\n\n**詳細**: [references/codex-parallel-review.md](references/codex-parallel-review.md)\n\n---\n\n## 📋 利用可能な MCP ツール\n\nCodex MCP サーバーが登録されると、以下のツールが利用可能になります：\n\n| ツール | 用途 |\n|-------|------|\n| `mcp__codex__codex` | Codex にプロンプトを送信してレビューを依頼 |\n\n> **注**: このツール名は `codex mcp-server` の実装に依存します。\n\n---\n\n## 🔧 クイックスタート\n\n### 前提条件\n\n1. **Codex CLI がインストール済み**\n   ```bash\n   which codex  # パスが表示されること\n   ```\n\n2. **Codex にログイン済み**\n   ```bash\n   codex login status  # 認証済みであること\n   ```\n\n### セットアップコマンド\n\n```bash\n# Codex を MCP サーバーとして Claude Code に登録\nclaude mcp add --scope user codex -- codex mcp-server\n```\n\n### 動作確認\n\n```bash\n# MCP サーバー一覧を確認\nclaude mcp list\n```\n\n---\n\n## 🔄 レビューワークフロー\n\n### Solo モード\n\n```\n/harness-review 実行\n    │\n    ├── Claude レビュー（従来通り）\n    │\n    └── Codex MCP 呼び出し（有効時）\n            │\n            └── 結果統合\n```\n\n### 2-Agent モード\n\n```\nPM（Cursor / Codex）\n    │\n    └── タスク依頼\n            │\n            ├── Claude Code 実装\n            │\n            └── /harness-review\n                    │\n                    ├── Claude レビュー\n                    └── Codex セカンドオピニオン\n```\n\n---\n\n## ⚙️ 設定\n\n`.claude-code-harness.config.yaml` で Codex 統合を設定：\n\n```yaml\nreview:\n  codex:\n    enabled: true           # Codex セカンドオピニオン有効化\n    auto: false             # true: 自動実行 / false: 毎回確認\n    prompt: \"Review the code and output issues and improvement suggestions\"\n    # execution_mode: mcp   # Legacy: MCP (no progress display)\n```\n\n| 設定項目 | デフォルト | 説明 |\n|---------|-----------|------|\n| `enabled` | `false` | Codex 統合の有効/無効 |\n| `auto` | `false` | 自動レビュー実行 |\n| `prompt` | (上記) | Codex へのレビュープロンプト |\n| `execution_mode` | `exec` | 実行モード（`exec`: CLI直接 / `mcp`: レガシー）|\n\n> **Note**: 単発 `/codex-review` は `exec` (進捗表示あり)、並列エキスパートは常に `mcp` (Claude 組み込み並列機能)\n\n---\n\n## 💡 活用例\n\n### 例1: セットアップ\n\n```\nユーザー: 「Codex でもレビューできるようにして」\n\nClaude Code:\n→ codex-mcp-setup.md を読み込み\n→ Codex インストール確認\n→ MCP 登録実行\n→ 設定ファイル更新\n```\n\n### 例2: レビュー時\n\n```\nユーザー: 「セカンドオピニオンもらって」\n\nClaude Code:\n→ codex.enabled = true を確認\n→ MCP 経由で Codex にレビュー依頼\n→ 結果を統合して表示\n```\n\n---\n\n## ⚠️ 注意事項\n\n### パフォーマンス\n\n- Codex MCP 呼び出しには数秒〜数十秒かかる場合があります\n- 大規模ファイルの場合はチャンク分割が推奨\n\n### コスト\n\n- Codex API 利用には OpenAI のクレジットが必要です\n- レビュー頻度に応じたコスト見積もりを推奨\n\n### トラブルシューティング\n\n**問題**: Codex MCP が認識されない\n**解決策**:\n1. `claude mcp list` で登録確認\n2. `codex login status` で認証確認\n3. Claude Code を再起動\n\n**問題**: レビュー結果が返らない\n**解決策**:\n1. `codex mcp-server` が起動しているか確認\n2. ネットワーク接続を確認\n3. API クレジット残高を確認\n\n---\n\n## 📚 参考資料\n\n- [Codex CLI Reference](https://developers.openai.com/codex/cli/reference/)\n- [Claude Code MCP 設定](https://docs.anthropic.com/claude-code/mcp)\n- [Codex MCP 統合記事 (Qiita)](https://qiita.com/YasuhiroKawano/items/76d255b1fd97548dedc5)\n",
        "opencode/skills/codex-review/references/codex-mcp-setup.md": "---\nname: codex-mcp-setup\ndescription: \"Codex CLI の検出・MCP 登録・認証確認を行うセットアップ手順\"\nallowed-tools: [\"Bash\", \"Read\", \"Write\", \"Edit\"]\n---\n\n# Codex MCP セットアップ\n\nOpenAI Codex CLI を Claude Code の MCP サーバーとして登録するセットアップ手順。\n\n---\n\n## 🎯 このスキルでやること\n\n1. Codex CLI のインストール確認\n2. Codex 認証状態の確認\n3. MCP サーバーとしての登録\n4. 設定ファイルの更新\n5. 動作確認\n\n---\n\n## 実行フロー\n\n### Step 1: Codex CLI の確認\n\n```bash\n# Codex CLI が存在するか確認\nwhich codex\n```\n\n**結果判定**:\n\n| 結果 | 次のアクション |\n|------|---------------|\n| パスが表示される | Step 2 へ |\n| `not found` | インストール案内を表示 |\n\n**インストール案内（未インストール時）**:\n\n```markdown\n⚠️ Codex CLI がインストールされていません\n\nインストール方法:\n\n1. **Homebrew（macOS）**:\n   ```bash\n   brew install openai-codex\n   ```\n\n2. **npm（クロスプラットフォーム）**:\n   ```bash\n   npm install -g @openai/codex-cli\n   ```\n\n3. **公式ドキュメント**:\n   https://developers.openai.com/codex/cli/installation\n\nインストール後、再度このコマンドを実行してください。\n```\n\n---\n\n### Step 2: 認証状態の確認\n\n```bash\n# ログイン状態を確認\ncodex login status\n```\n\n**結果判定**:\n\n| 終了コード | 意味 | 次のアクション |\n|-----------|------|---------------|\n| 0 | ログイン済み | Step 3 へ |\n| 非0 | 未ログイン | 認証案内を表示 |\n\n**認証案内（未ログイン時）**:\n\n```markdown\n🔐 Codex にログインが必要です\n\nログイン方法:\n\n1. **OAuth（推奨）**:\n   ```bash\n   codex login\n   ```\n   ブラウザが開き、OpenAI アカウントで認証します。\n\n2. **API キー**:\n   ```bash\n   echo $OPENAI_API_KEY | codex login --with-api-key\n   ```\n   環境変数に設定済みの API キーを使用します。\n\nログイン後、再度このコマンドを実行してください。\n```\n\n---\n\n### Step 3: MCP サーバー登録\n\n```bash\n# Codex を MCP サーバーとして登録\nclaude mcp add --scope user codex -- codex mcp-server\n```\n\n**成功時の出力例**:\n\n```\nAdded MCP server: codex\nScope: user\nCommand: codex mcp-server\n```\n\n**エラー時の対応**:\n\n| エラー | 原因 | 対応 |\n|-------|------|------|\n| `Already exists` | 既に登録済み | Step 4 へ（スキップ可） |\n| `Command not found` | claude CLI がない | Claude Code を最新版に更新 |\n| `Permission denied` | 権限不足 | `--scope project` を試す |\n\n---\n\n### Step 4: 設定ファイル更新\n\n`.claude-code-harness.config.yaml` に Codex 設定を追加:\n\n```yaml\n# 追加する設定\nreview:\n  codex:\n    enabled: true\n    auto: false\n    prompt: \"日本語でコードレビューを行い、問題点と改善提案を出力してください\"\n```\n\n**設定項目の説明**:\n\n| 項目 | 型 | デフォルト | 説明 |\n|-----|-----|-----------|------|\n| `enabled` | boolean | `false` | Codex 統合を有効化 |\n| `auto` | boolean | `false` | `/harness-review` 時に自動で Codex を呼び出すか |\n| `prompt` | string | (上記) | Codex へ送信するレビュープロンプト |\n\n---\n\n### Step 5: 動作確認\n\n```bash\n# MCP サーバー一覧を確認\nclaude mcp list\n```\n\n**期待される出力**:\n\n```\ncodex (user)\n  Command: codex mcp-server\n  Status: Ready\n```\n\n**簡易テスト（オプション）**:\n\n```bash\n# Codex MCP が応答するか確認\ncodex exec --json \"Hello, this is a test\" 2>/dev/null | head -1\n```\n\n---\n\n## 完了メッセージ\n\nセットアップ完了時に表示:\n\n```markdown\n✅ Codex MCP セットアップ完了\n\n**設定内容**:\n- MCP サーバー: codex (user scope)\n- 自動レビュー: 無効（毎回確認）\n- プロンプト言語: 日本語\n\n**使い方**:\n- `/harness-review` 実行時に「Codex にもレビューさせますか？」と確認\n- `codex.auto: true` で自動実行に変更可能\n\n**次のアクション**:\n- `codex.enabled: true` を設定ファイルで確認\n- `/harness-review` でセカンドオピニオンを試す\n```\n\n---\n\n## トラブルシューティング\n\n### 問題: `claude mcp add` が失敗する\n\n**原因**: Claude Code のバージョンが古い\n\n**解決策**:\n```bash\n# Claude Code を更新\nclaude update\n\n# 再試行\nclaude mcp add --scope user codex -- codex mcp-server\n```\n\n### 問題: Codex MCP が応答しない\n\n**原因**: Codex CLI の問題\n\n**解決策**:\n```bash\n# Codex 単体で動作確認\ncodex exec \"Hello\" --output-last-message /tmp/test.txt\ncat /tmp/test.txt\n```\n\n### 問題: API エラーが発生する\n\n**原因**: OpenAI クレジット不足または API 制限\n\n**解決策**:\n1. OpenAI ダッシュボードでクレジット確認\n2. API 使用量制限を確認\n3. レート制限の場合は時間を置いて再試行\n\n---\n\n## 関連ドキュメント\n\n- [Codex CLI Reference](https://developers.openai.com/codex/cli/reference/)\n- [Claude Code MCP 公式ドキュメント](https://docs.anthropic.com/claude-code/mcp)\n- [codex-review-integration.md](./codex-review-integration.md) - レビュー統合手順\n",
        "opencode/skills/codex-review/references/codex-parallel-review.md": "# Codex 並列レビュー実行ガイド\n\nCodex モード時に複数のエキスパートを並列で呼び出すためのオーケストレーション手順。\n\n## 概要\n\nCodex モードでは、Claude がオーケストレーターとして **4 つのエキスパート** を MCP 経由で並列呼び出しします。レビュータイプに応じて異なるエキスパートが使用されます。\n\n## レビュータイプと4つのエキスパート\n\n| Review Type | 4 Experts | Expert Files |\n|-------------|-----------|--------------|\n| **Code** | Security, Performance, Quality, Accessibility | `security-expert.md`, `performance-expert.md`, `quality-expert.md`, `accessibility-expert.md` |\n| **Plan** | Clarity, Feasibility, Dependencies, Acceptance | `clarity-expert.md`, `feasibility-expert.md`, `dependencies-expert.md`, `acceptance-expert.md` |\n| **Scope** | Scope-creep, Priority, Feasibility, Impact | `scope-creep-expert.md`, `priority-expert.md`, `scope-feasibility-expert.md`, `impact-expert.md` |\n\n```\nClaude (オーケストレーター)\n    ↓\nレビュータイプ判定\n    ↓\n並列 MCP 呼び出し (4 experts)\n    ├── Expert 1\n    ├── Expert 2\n    ├── Expert 3\n    └── Expert 4\n    ↓\n結果統合 → 判定\n```\n\n---\n\n## ⚠️ 並列呼び出し必須ルール（MANDATORY）\n\n**このルールは絶対に守ること。違反した場合、レビュー品質が大幅に低下します。**\n\n### 禁止事項\n\n| 禁止 | 理由 |\n|------|------|\n| ❌ 1回の MCP 呼び出しで複数エキスパートをまとめる | 各エキスパートの専門性が薄まる |\n| ❌ 「セキュリティとパフォーマンスと品質を見て」と1回で依頼 | 観点が混在し、深い分析ができない |\n| ❌ experts/*.md を読まずに汎用プロンプトを送る | 専門家プロンプトの知見が活かされない |\n\n### 必須事項\n\n| 必須 | 方法 |\n|------|------|\n| ✅ 各エキスパートを **個別の MCP 呼び出し** で実行 | `mcp__codex__codex` をレビュータイプに応じて4回呼び出し |\n| ✅ experts/*.md から **個別にプロンプトを読み込む** | `security-expert.md` → Security 呼び出し → `performance-expert.md` → Performance 呼び出し... |\n| ✅ **1つのレスポンス内で4つの MCP 呼び出しを並列実行** | Claude の並列ツール呼び出し機能を使用 |\n\n### 正しい実行パターン\n\n```\n1. 設定とプロジェクト種別から有効なエキスパートを判定\n2. 有効なエキスパートのみ、1つのレスポンス内で同時に実行:\n\nmcp__codex__codex({prompt: security-expert.md の内容})\nmcp__codex__codex({prompt: performance-expert.md の内容})\nmcp__codex__codex({prompt: quality-expert.md の内容})\n... (有効なもののみ)\n\n→ 必要なエキスパートのみ並列実行\n→ 無関係な観点はスキップしてコスト削減\n```\n\n### なぜ分けるのか\n\n| 1回でまとめた場合 | 4回に分けた場合 |\n|------------------|-----------------|\n| 各観点が2-3行で浅い | 各観点が詳細に分析される |\n| 重要な問題を見落とす | 専門家視点で漏れなく検出 |\n| 「問題なし」で終わりやすい | 具体的な改善提案が出る |\n\n---\n\n## 実行フロー\n\n### Step 0: 残コンテキスト確認\n\nCodex 並列レビューの前に**残コンテキストが 30%以下なら /compact を実行**してください。\n\n> **注意**: /compact 後も余裕が少ない場合はそのまま Step 1 に進みます。\n\n### Step 1: 設定確認\n\n```yaml\n# .claude-code-harness.config.yaml から読み込み\nreview:\n  mode: codex\n  codex:\n    enabled: true\n    # Code Review experts (used when review type = code)\n    code_experts:\n      security: true\n      accessibility: true\n      performance: true\n      quality: true\n    # Plan Review experts (used when review type = plan)\n    plan_experts:\n      clarity: true\n      feasibility: true\n      dependencies: true\n      acceptance: true\n    # Scope Review experts (used when review type = scope)\n    scope_experts:\n      scope_creep: true\n      priority: true\n      feasibility: true\n      impact: true\n```\n\n> **Note**: Legacy 設定（`experts:` 直下）も後方互換性のためサポートしています。\n\n### Step 2: 変更ファイルの収集\n\n```bash\n# git diff で変更ファイルを取得\ngit diff --name-only HEAD~1\n```\n\n### Step 3: 呼び出すエキスパートの判定（フィルタリング）\n\n**全エキスパートを毎回呼ぶのではなく、必要なもののみ選択する。**\n\n#### 3.1 設定ベースのフィルタリング\n\n`.claude-code-harness.config.yaml` で `false` のエキスパートは除外:\n\n```yaml\nexperts:\n  security: true       # ✅ 呼び出す\n  accessibility: false # ❌ スキップ\n  performance: true    # ✅ 呼び出す\n  ...\n```\n\n#### 3.2 プロジェクト種別による自動除外\n\n| プロジェクト種別 | 自動除外するエキスパート |\n|-----------------|------------------------|\n| CLI / バックエンドAPI | Accessibility, SEO |\n| ライブラリ / SDK | Accessibility, SEO |\n| Webフロントエンド | （全て有効） |\n| モバイルアプリ | SEO |\n| 計画/レビューのみ | Security, Performance, Quality（コード変更なし時） |\n\n**判定方法**:\n```\n1. 変更ファイルのパスを確認:\n   - src/components/, pages/, app/ → Webフロントエンド → Accessibility, SEO 有効\n   - src/api/, server/, cli/ → バックエンド/CLI → Accessibility, SEO 除外\n   - *.md のみ → ドキュメント変更 → Quality, Architect, Plan Reviewer, Scope Analyst を優先\n\n2. package.json / pyproject.toml を確認:\n   - react, vue, next → Webフロントエンド\n   - express, fastify, flask → バックエンド\n   - commander, yargs → CLI\n```\n\n#### 3.3 変更内容による除外\n\n| 変更内容 | 優先するエキスパート | 除外可能 |\n|---------|---------------------|---------|\n| Plans.md のみ変更 | Plan Reviewer, Scope Analyst | Security, Performance, Quality, Accessibility, SEO, Architect |\n| テストファイルのみ変更 | Security, Quality, Performance | Architect, Plan Reviewer, Scope Analyst |\n| README / ドキュメントのみ | Quality, Architect, Plan Reviewer, Scope Analyst | Security, Performance, Accessibility |\n\n#### 3.4 最終的な呼び出しリスト決定\n\n```\nレビュータイプ判定 → 対応する4エキスパートを呼び出し\n\n例1: /work 後にコード変更あり → Code Review\n→ Security, Performance, Quality, Accessibility\n→ 4エキスパート並列\n\n例2: /plan-with-agent 後 → Plan Review\n→ Clarity, Feasibility, Dependencies, Acceptance\n→ 4エキスパート並列\n\n例3: タスク追加後 → Scope Review\n→ Scope-creep, Priority, Feasibility, Impact\n→ 4エキスパート並列\n```\n\n### Step 4: エキスパートプロンプトの準備\n\n**Step 3 で決定したエキスパートのみ**、`experts/*.md` からプロンプトを読み込み:\n- `{files}`: 変更ファイルリスト\n- `{tech_stack}`: 検出された技術スタック\n- `{plan_content}`: Plans.md の内容（Plan Reviewer 用）\n- `{requirements}`: 要件内容（Scope Analyst 用）\n\n### Step 5: 並列 MCP 呼び出し\n\n**実行モード**: 並列エキスパートは **MCP 固定**（Claude 組み込み並列機能を活用）\n\n> 単発 `/codex-review` は exec だが、並列は mcp の方がシェル管理不要で効率的\n\n**重要**: Step 3 で決定した有効なエキスパートのみ呼び出し\n\n```typescript\n// 並列呼び出しの概念コード\nconst enabledExperts = Object.entries(config.review.codex.experts)\n  .filter(([_, enabled]) => enabled)\n  .map(([name]) => name);\n\n// 並列実行\nconst results = await Promise.all(\n  enabledExperts.map(expert =>\n    mcp__codex__codex({\n      prompt: getPromptForExpert(expert, files, techStack),\n      sandbox: \"read-only\"\n    })\n  )\n);\n```\n\n### Step 5.1: 出力制限ルール（Context 溢れ防止）\n\n各エキスパートの応答は以下の制約に従う:\n\n**Code Review エキスパート**（security/performance/quality/accessibility-expert.md）:\n\n| 制約 | 内容 |\n|------|------|\n| 言語 | **English only**（トークン節約、Claude が統合時に日本語化） |\n| 最大文字数 | 1500 文字 |\n| スコア形式 | A-F |\n| 件数制限 | Critical/High: 全件、Medium/Low: 各3件まで |\n| 問題なし | `Score: A / No issues.` のみ |\n\n**Plan/Scope Review エキスパート**:\n\n| 制約 | 内容 |\n|------|------|\n| 言語 | **English only** |\n| 最大文字数 | 1500 文字 |\n| スコア形式 | X/10 |\n| 問題なし | `Score: 10/10 / No issues.` のみ |\n\n> **理由**: 4エキスパート並列でも 1500文字×4 = 6,000文字 ≒ 2,000トークン程度で収まる\n\n### Step 6: 結果統合\n\n各エキスパートからの結果を統合:\n\n```markdown\n## 📊 Codex 並列レビュー結果\n\n### エキスパート別サマリー\n\n| Expert | Score | Critical | High | Medium | Low |\n|--------|-------|----------|------|--------|-----|\n| Security | B | 0 | 1 | 2 | 3 |\n| Accessibility | A | 0 | 0 | 1 | 2 |\n| Performance | C | 0 | 2 | 3 | 1 |\n| Quality | B | 0 | 0 | 4 | 5 |\n| SEO | A | 0 | 0 | 0 | 2 |\n| Architect | B | 0 | 1 | 1 | 0 |\n| Plan Reviewer | APPROVE | - | - | - | - |\n| Scope Analyst | Proceed | - | - | - | - |\n\n### 統合 Findings\n\n| # | Expert | Severity | File | Issue |\n|---|--------|----------|------|-------|\n| 1 | Security | High | src/api/auth.ts:45 | SQL Injection |\n| 2 | Performance | High | src/api/posts.ts:23 | N+1 Query |\n| 3 | Architect | High | src/services/ | Circular dependency |\n```\n\n### Step 7: コミット判定\n\n統合結果から最終判定を算出:\n\n| 集計 | 判定 |\n|------|------|\n| Critical ≥ 1 | REJECT |\n| High ≥ 1 または Medium > 3 | REQUEST CHANGES |\n| それ以外 | APPROVE |\n\n## エラーハンドリング\n\n### 一部エキスパート失敗時\n\n```markdown\n⚠️ 一部のエキスパートでエラーが発生しました\n\n| Expert | Status |\n|--------|--------|\n| Security | ✅ 成功 |\n| Performance | ❌ タイムアウト |\n| Quality | ✅ 成功 |\n\n失敗したエキスパートをスキップして判定を続行しますか？\n```\n\n### 全エキスパート失敗時\n\n```markdown\n❌ Codex エキスパートとの通信に失敗しました\n\n原因: MCP サーバー接続エラー\n\nフォールバック: Claude 単体でレビューを実行しますか？\n```\n\n## 自動修正ループ\n\nREQUEST CHANGES 判定時の自動修正フロー:\n\n```\nREQUEST CHANGES 判定\n    ↓\n修正対象の抽出（High/Medium の Findings）\n    ↓\nClaude が修正実行\n    ↓\n再度 Codex 並列レビュー\n    │\n    ├── APPROVE → 完了\n    ├── REQUEST CHANGES → ループ（リトライ: ${current}/${max_retries}）\n    └── REJECT → 手動対応必要\n```\n\n### リトライ制限\n\n- デフォルト: 最大 3 回\n- 設定: `review.judgment.max_retries`\n\n### リトライ超過時\n\n```markdown\n## ⚠️ 自動修正上限に到達\n\n${max_retries} 回の自動修正を試みましたが、以下の問題が残っています:\n\n| # | Severity | File | Issue |\n|---|----------|------|-------|\n| 1 | High | src/api/users.ts | N+1 Query |\n\n**推奨アクション**:\n1. 手動で上記を修正\n2. 再度 `/harness-review` を実行\n```\n\n## 関連ファイル\n\n| ファイル | 役割 |\n|---------|------|\n| `experts/security-expert.md` | セキュリティエキスパートプロンプト |\n| `experts/accessibility-expert.md` | a11y エキスパートプロンプト |\n| `experts/performance-expert.md` | パフォーマンスエキスパートプロンプト |\n| `experts/quality-expert.md` | 品質エキスパートプロンプト |\n| `experts/seo-expert.md` | SEO エキスパートプロンプト |\n| `experts/architect-expert.md` | 設計エキスパートプロンプト |\n| `experts/plan-reviewer-expert.md` | 計画レビューエキスパートプロンプト |\n| `experts/scope-analyst-expert.md` | 要件分析エキスパートプロンプト |\n| `commit-judgment-logic.md` | コミット判定ロジック |\n",
        "opencode/skills/codex-review/references/codex-review-integration.md": "---\nname: codex-review-integration\ndescription: \"Codex MCP を使用したレビュー実行手順\"\nallowed-tools: [\"Read\", \"Bash\"]\n---\n\n# Codex レビュー実行\n\nCodex MCP を使用してコードレビューを実行する手順。\n\n---\n\n## 🎯 概要\n\nCodex MCP が設定済みの場合、以下の方法でレビューを実行できます：\n\n1. **`/harness-review` 経由**: 自動的に Codex 統合\n2. **直接呼び出し**: MCP ツールを直接使用\n\n---\n\n## 実行方法\n\n### 方法1: /harness-review 経由（推奨）\n\n```\nユーザー: /harness-review\n    ↓\nharness-review スキル起動\n    ↓\ncodex.enabled 確認 → true\n    ↓\nClaude + Codex 並列レビュー\n    ↓\n結果統合\n```\n\n### 方法2: 直接呼び出し\n\n```bash\n# MCP ツールを直接呼び出し（スキル内から）\nmcp__codex__* を使用\n\n# または Codex CLI を直接実行\ncodex exec --json \"以下のコードをレビューしてください: ...\"\n```\n\n---\n\n## レビュープロンプト\n\n### デフォルトプロンプト\n\n```\n日本語でコードレビューを行い、問題点と改善提案を出力してください\n```\n\n### カスタマイズ例\n\n**セキュリティ重視**:\n```yaml\nreview:\n  codex:\n    prompt: |\n      以下の観点でセキュリティレビューを行ってください：\n      1. 入力検証の不備\n      2. 認証・認可の問題\n      3. インジェクション脆弱性\n      4. 機密情報の露出\n      日本語で回答してください。\n```\n\n**パフォーマンス重視**:\n```yaml\nreview:\n  codex:\n    prompt: |\n      以下の観点でパフォーマンスレビューを行ってください：\n      1. N+1クエリ\n      2. 不要な再レンダリング\n      3. メモリリーク\n      4. 非効率なアルゴリズム\n      日本語で回答してください。\n```\n\n---\n\n## レビュー結果の形式\n\n### Codex からの出力例\n\n```json\n{\n  \"review\": {\n    \"summary\": \"3件の改善提案があります\",\n    \"issues\": [\n      {\n        \"file\": \"src/api/users.ts\",\n        \"line\": 45,\n        \"severity\": \"high\",\n        \"message\": \"SQL インジェクションの可能性\"\n      },\n      {\n        \"file\": \"src/components/Form.tsx\",\n        \"line\": 12,\n        \"severity\": \"medium\",\n        \"message\": \"useEffect の依存配列が不完全\"\n      }\n    ],\n    \"suggestions\": [\n      \"関数を分割して可読性を向上\",\n      \"型定義を厳密化\"\n    ]\n  }\n}\n```\n\n### 統合フォーマット\n\n```markdown\n## 🤖 Codex レビュー結果\n\n**サマリ**: 3件の改善提案\n\n### 問題点\n\n| ファイル | 行 | 重要度 | 内容 |\n|---------|-----|--------|------|\n| src/api/users.ts | 45 | 高 | SQL インジェクションの可能性 |\n| src/components/Form.tsx | 12 | 中 | useEffect の依存配列が不完全 |\n\n### 改善提案\n\n1. 関数を分割して可読性を向上\n2. 型定義を厳密化\n```\n\n---\n\n## エラーハンドリング\n\n### タイムアウト\n\n```markdown\n⚠️ Codex レビューがタイムアウトしました（60秒）\n\n原因として考えられること:\n- ファイルサイズが大きい\n- Codex API が混雑している\n- ネットワーク遅延\n\n対応:\n- 変更ファイルを絞り込んで再試行\n- 時間を置いて再実行\n```\n\n### API エラー\n\n```markdown\n⚠️ Codex API エラー\n\nエラーコード: 429 (Rate Limited)\n\n対応:\n- 少し時間を置いて再試行してください\n- API 使用量を確認してください\n```\n\n---\n\n## ベストプラクティス\n\n### 効果的なレビューのために\n\n1. **対象を絞る**: 大量のファイルより重要なファイルに集中\n2. **観点を明確に**: プロンプトでレビュー観点を指定\n3. **結果を比較**: Claude と Codex の指摘を比較して優先度判断\n\n### 避けるべきこと\n\n1. **全ファイル一括**: 大規模プロジェクトで全ファイルは非効率\n2. **プロンプトなし**: デフォルトプロンプトは汎用的すぎる場合あり\n3. **結果の盲信**: AI の指摘は参考情報、最終判断は人間\n\n---\n\n## 関連ドキュメント\n\n- [codex-mcp-setup.md](./codex-mcp-setup.md) - セットアップ手順\n- [harness-review/SKILL.md](../../harness-review/SKILL.md) - レビュースキル\n- [harness-review/references/codex-integration.md](../../harness-review/references/codex-integration.md) - レビューへの統合\n",
        "opencode/skills/codex-review/references/experts/acceptance-expert.md": "# Acceptance Criteria Expert - Plan Review\n\nYou are an **Acceptance Criteria Expert** specializing in evaluating whether plans have clear, testable acceptance criteria.\n\n## Review Focus\n\nEvaluate the plan for:\n\n1. **Completeness**\n   - Does every task have acceptance criteria?\n   - Are edge cases covered?\n   - Are error scenarios addressed?\n\n2. **Testability**\n   - Are criteria measurable?\n   - Can they be verified objectively?\n   - Are there clear pass/fail conditions?\n\n3. **User Perspective**\n   - Do criteria reflect user needs?\n   - Are user stories properly defined?\n   - Is the \"definition of done\" clear?\n\n4. **Quality Gates**\n   - Performance requirements\n   - Security requirements\n   - Accessibility requirements\n\n## Output Format\n\n```markdown\n## ✅ Acceptance Criteria Review\n\n### Score: X/10\n\n### Coverage Analysis\n\n| Area | Has Criteria | Testable | Complete |\n|------|-------------|----------|----------|\n| Core features | ✅/❌ | ✅/❌ | ✅/❌ |\n| Edge cases | ✅/❌ | ✅/❌ | ✅/❌ |\n| Error handling | ✅/❌ | ✅/❌ | ✅/❌ |\n| Performance | ✅/❌ | ✅/❌ | ✅/❌ |\n\n### Missing Criteria\n\n#### Critical (must add)\n- [ ] [Task/Feature] - needs criteria for [what]\n- [ ] [Task/Feature] - needs criteria for [what]\n\n#### Recommended (should add)\n- [ ] [Task/Feature] - would benefit from [criteria type]\n\n### Vague Criteria Found\n\n| Current | Issue | Suggested |\n|---------|-------|-----------|\n| \"Works well\" | Not measurable | \"Response time < 200ms\" |\n| \"User-friendly\" | Subjective | \"Passes WCAG 2.1 AA\" |\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "opencode/skills/codex-review/references/experts/accessibility-expert.md": "# Accessibility Expert Prompt for Codex\n\nCodex MCP に送信するアクセシビリティレビュー用プロンプト。\n\n## 7-Section Format\n\n### TASK\n\nWeb アクセシビリティ（a11y）を分析し、WCAG 2.1 AA ガイドラインへの準拠を確認してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で a11y 問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- WCAG 基準への参照\n- 修正案\n- a11y スコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- フレームワーク: {tech_stack}\n- 対象: UI コンポーネント、フォーム、画像、ナビゲーション\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- WCAG 2.1 AA baseline\n- Consider framework-specific patterns (React/Vue/Svelte)\n\n### MUST DO\n\n1. **セマンティック HTML**: 見出し構造、ランドマーク、ボタン vs div\n2. **画像・メディア**: alt 属性、装飾画像、動画キャプション\n3. **フォーム**: ラベル、エラーメッセージ、必須フィールド\n4. **キーボード**: フォーカス管理、トラップ防止、ESC 対応\n5. **ARIA**: 冗長な ARIA 削除、動的コンテンツの aria-live\n\n### MUST NOT DO\n\n- 非 UI ファイル（API、ユーティリティ）を a11y 対象にしない\n- 装飾画像に意味のある alt を要求しない\n- aria-hidden の正しい使用を問題として報告しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Accessibility Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | File | Line | Issue | WCAG | Fix |\n|---|----------|------|------|-------|------|-----|\n| 1 | High | components/Button.tsx | 12 | div used as button | 4.1.2 | Use <button> element |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "opencode/skills/codex-review/references/experts/architect-expert.md": "# Architect Expert Prompt for Codex\n\nCodex MCP に送信する設計レビュー用プロンプト。\n> claude-delegator を参考に設計\n\n## 7-Section Format\n\n### TASK\n\nシステム設計、アーキテクチャ判断、技術的トレードオフを分析し、設計上の問題や改善機会を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で設計問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- トレードオフ分析\n- 推奨アプローチ\n- 設計スコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- 技術スタック: {tech_stack}\n- 対象: アーキテクチャ、設計パターン、スケーラビリティ\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Avoid premature over-abstraction\n- Base decisions on actual requirements\n\n### MUST DO\n\n1. **システム設計**:\n   - モジュール境界の適切さ\n   - 依存関係の方向\n   - 責務の分離\n\n2. **スケーラビリティ**:\n   - ボトルネックになりうる箇所\n   - 水平/垂直スケーリングの考慮\n   - キャッシュ戦略\n\n3. **保守性**:\n   - 変更容易性\n   - テスタビリティ\n   - デバッグ容易性\n\n4. **トレードオフ分析**:\n   - 複雑さ vs 柔軟性\n   - パフォーマンス vs 可読性\n   - DRY vs 明示性\n\n### MUST NOT DO\n\n- 「将来のため」だけの抽象化を推奨しない\n- 単一用途の過度なパターン適用を推奨しない\n- 既存のうまく動いている設計を不必要に変更しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Architecture Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | Area | Issue | Recommendation |\n|---|----------|------|-------|----------------|\n| 1 | High | Module Design | Circular dependency | Introduce interface layer |\n\n### Tradeoff Analysis\n\n- **Current**: [Current approach and its pros/cons]\n- **Recommended**: [Recommended approach and why]\n- **Effort**: Quick/Short/Medium/Large\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "opencode/skills/codex-review/references/experts/clarity-expert.md": "# Clarity Expert - Plan Review\n\nYou are a **Clarity Expert** specializing in evaluating the clarity and understandability of implementation plans.\n\n## Review Focus\n\nEvaluate the plan for:\n\n1. **Goal Clarity**\n   - Is the objective clearly stated?\n   - Are success criteria defined?\n   - Is the scope well-bounded?\n\n2. **Task Clarity**\n   - Are tasks specific and actionable?\n   - Are dependencies between tasks clear?\n   - Are deliverables for each task defined?\n\n3. **Communication Clarity**\n   - Is terminology consistent?\n   - Are technical terms explained when needed?\n   - Can a new team member understand this?\n\n4. **Ambiguity Detection**\n   - Identify vague phrases (\"as needed\", \"if possible\", \"later\")\n   - Flag undefined terms or acronyms\n   - Note missing context or assumptions\n\n## Output Format\n\n```markdown\n## 📝 Clarity Review\n\n### Score: X/10\n\n### Strengths\n- [Clear aspect 1]\n- [Clear aspect 2]\n\n### Issues Found\n\n#### Critical (blocks understanding)\n- [ ] [Issue description]\n  - Location: [where in plan]\n  - Suggestion: [how to clarify]\n\n#### Minor (could be clearer)\n- [ ] [Issue description]\n  - Suggestion: [improvement]\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "opencode/skills/codex-review/references/experts/dependencies-expert.md": "# Dependencies Expert - Plan Review\n\nYou are a **Dependencies Expert** specializing in analyzing task dependencies and execution order in implementation plans.\n\n## Review Focus\n\nEvaluate the plan for:\n\n1. **Task Dependencies**\n   - Are dependencies explicitly stated?\n   - Is the execution order logical?\n   - Are there circular dependencies?\n\n2. **External Dependencies**\n   - Third-party services/APIs\n   - Team/stakeholder approvals\n   - Infrastructure requirements\n\n3. **Dependency Graph**\n   - Critical path identification\n   - Parallel execution opportunities\n   - Bottleneck detection\n\n4. **Dependency Risks**\n   - Single points of failure\n   - Unstable dependencies\n   - Version conflicts\n\n## Output Format\n\n```markdown\n## 🔗 Dependencies Review\n\n### Score: X/10\n\n### Dependency Map\n\n```\n[Task A] ──→ [Task B] ──→ [Task C]\n    │                        ↑\n    └──→ [Task D] ──────────┘\n```\n\n### Critical Path\n1. [Task X] → [Task Y] → [Task Z]\n   - Total estimated time: [X hours/days]\n\n### Issues Found\n\n#### Blocking Issues\n- [ ] [Issue description]\n  - Blocked tasks: [list]\n  - Resolution: [suggestion]\n\n#### Optimization Opportunities\n- [ ] [Tasks that could run in parallel]\n- [ ] [Dependencies that could be removed]\n\n### External Dependencies\n\n| Dependency | Type | Status | Risk |\n|------------|------|--------|------|\n| [Name] | API/Service/Team | ✅/⚠️/❌ | Low/Med/High |\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "opencode/skills/codex-review/references/experts/feasibility-expert.md": "# Feasibility Expert - Plan Review\n\nYou are a **Feasibility Expert** specializing in evaluating whether implementation plans are technically and practically achievable.\n\n## Review Focus\n\nEvaluate the plan for:\n\n1. **Technical Feasibility**\n   - Are the proposed technologies appropriate?\n   - Are there known limitations or constraints?\n   - Is the technical approach sound?\n\n2. **Resource Feasibility**\n   - Are skill requirements realistic?\n   - Are tools/infrastructure available?\n   - Are external dependencies accessible?\n\n3. **Time Feasibility**\n   - Are estimates reasonable?\n   - Are buffer times included?\n   - Are parallel vs sequential tasks properly planned?\n\n4. **Risk Assessment**\n   - What could go wrong?\n   - Are there fallback options?\n   - What are the critical path items?\n\n## Output Format\n\n```markdown\n## 🔧 Feasibility Review\n\n### Score: X/10\n\n### Feasibility Assessment\n\n| Aspect | Status | Notes |\n|--------|--------|-------|\n| Technical | ✅/⚠️/❌ | [Brief note] |\n| Resources | ✅/⚠️/❌ | [Brief note] |\n| Timeline | ✅/⚠️/❌ | [Brief note] |\n\n### Risks Identified\n\n#### High Risk\n- [ ] [Risk description]\n  - Impact: [what happens if it occurs]\n  - Mitigation: [suggested approach]\n\n#### Medium Risk\n- [ ] [Risk description]\n  - Mitigation: [suggested approach]\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "opencode/skills/codex-review/references/experts/impact-expert.md": "# Impact Expert - Scope Review\n\nYou are an **Impact Expert** specializing in analyzing the impact of scope changes on existing systems and processes.\n\n## Review Focus\n\nEvaluate impact for:\n\n1. **System Impact**\n   - Existing code changes required\n   - Database migrations\n   - API breaking changes\n   - Performance implications\n\n2. **User Impact**\n   - UX changes\n   - Learning curve\n   - Migration requirements\n   - Backward compatibility\n\n3. **Team Impact**\n   - Knowledge requirements\n   - Process changes\n   - Documentation needs\n   - Training requirements\n\n4. **Business Impact**\n   - Revenue implications\n   - Customer satisfaction\n   - Competitive position\n   - Compliance requirements\n\n## Output Format\n\n```markdown\n## 💥 Impact Review\n\n### Score: X/10 (10 = low impact, manageable)\n\n### Impact Summary\n\n| Area | Impact Level | Details |\n|------|-------------|---------|\n| System | Low/Med/High | [brief] |\n| Users | Low/Med/High | [brief] |\n| Team | Low/Med/High | [brief] |\n| Business | Low/Med/High | [brief] |\n\n### Detailed Impact Analysis\n\n#### High Impact Items\n- [ ] [Change/Feature]\n  - Affects: [what systems/users]\n  - Impact: [what happens]\n  - Mitigation: [how to reduce impact]\n\n#### Medium Impact Items\n- [ ] [Change/Feature]\n  - Affects: [what]\n  - Mitigation: [suggestion]\n\n### Breaking Changes\n| Change | Affected | Migration Path |\n|--------|----------|----------------|\n| [Change] | [Who/What] | [How to migrate] |\n\n### Ripple Effects\n```\n[Change A] ──→ [Effect on B]\n              ──→ [Effect on C]\n                  ──→ [Effect on D]\n```\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n\n### Communication Plan\n- [ ] Notify [stakeholder] about [impact]\n- [ ] Update [documentation] for [change]\n- [ ] Train [team] on [new process]\n```\n",
        "opencode/skills/codex-review/references/experts/performance-expert.md": "# Performance Expert Prompt for Codex\n\nCodex MCP に送信するパフォーマンスレビュー用プロンプト。\n\n## 7-Section Format\n\n### TASK\n\nコードのパフォーマンス問題を分析し、非効率なパターン、ボトルネック、最適化の機会を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式でパフォーマンス問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- 改善案と期待効果\n- パフォーマンススコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- 技術スタック: {tech_stack}\n- 対象: レンダリング、DB クエリ、アルゴリズム、メモリ\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Avoid premature optimization, focus on real bottlenecks\n- Show measurable improvement impact\n\n### MUST DO\n\n1. **フロントエンド**:\n   - 不要な再レンダリング（useCallback/useMemo 未使用）\n   - 大きなリストの非仮想化\n   - 重い計算の同期実行\n   - バンドルサイズ（大きな依存関係）\n\n2. **バックエンド**:\n   - N+1 クエリ問題\n   - インデックス未使用\n   - 同期 I/O のブロッキング\n   - キャッシュ未使用\n\n3. **一般**:\n   - O(n²) 以上のアルゴリズム\n   - ループ内での文字列連結\n   - 正規表現の毎回コンパイル\n\n### MUST NOT DO\n\n- 可読性を大幅に犠牲にする最適化を推奨しない\n- マイクロ最適化（影響 < 1ms）を Critical として報告しない\n- 測定せずに「遅い」と断定しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Performance Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | File | Line | Issue | Impact | Fix |\n|---|----------|------|------|-------|--------|-----|\n| 1 | High | api/posts.ts | 23 | N+1 query | ~100ms per request | Use include/prefetch |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "opencode/skills/codex-review/references/experts/plan-reviewer-expert.md": "# Plan Reviewer Expert Prompt for Codex\n\nCodex MCP に送信する計画レビュー用プロンプト。\n> claude-delegator を参考に設計\n\n## 7-Section Format\n\n### TASK\n\n作業計画（Plans.md）を分析し、実装をブロックする可能性のあるギャップ、曖昧さ、不足コンテキストを検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で計画の問題を報告:\n- **[APPROVE / REJECT]** の判定\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- 改善提案\n- 計画スコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 計画ファイル: {plan_content}\n- 対象: タスク定義、受入条件、依存関係、コンテキスト\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Evaluate from \"can this actually be implemented?\" perspective\n- Avoid overly strict criteria\n\n### MUST DO\n\n1. **作業内容の明確さ**:\n   - 各タスクが WHERE（どこを見ればよいか）を指定しているか\n   - 参照資料で 90%+ の確信が得られるか\n\n2. **検証・受入条件**:\n   - 完了を確認する具体的な方法があるか\n   - 受入条件が測定可能/観察可能か\n\n3. **コンテキスト完全性**:\n   - 10% 以上の不確実性を引き起こす欠落情報はないか\n   - 暗黙の前提が明示されているか\n\n4. **全体像・ワークフロー**:\n   - 目的が明確か\n   - タスク間の依存関係が定義されているか\n   - 「完了」の定義があるか\n\n### MUST NOT DO\n\n- 単純な 1 タスクの計画を過度に批判しない\n- 明らかなコンテキストの再説明を要求しない\n- 参照ファイルが存在する場合に「詳細がない」と判定しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Plan Review Results\n\n**Verdict**: [APPROVE / REJECT]\n\n**Score**: [A-F]\n\n### Evaluation Summary\n\n| Criteria | Assessment |\n|----------|------------|\n| Clarity | [Brief assessment] |\n| Verifiability | [Brief assessment] |\n| Completeness | [Brief assessment] |\n| Big Picture | [Brief assessment] |\n\n### Findings (if REJECT)\n\n| # | Severity | Area | Issue | Suggestion |\n|---|----------|------|-------|------------|\n| 1 | High | Task Definition | Missing reference file | Add link to existing implementation |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "opencode/skills/codex-review/references/experts/priority-expert.md": "# Priority Expert - Scope Review\n\nYou are a **Priority Expert** specializing in evaluating task prioritization and execution order.\n\n## Review Focus\n\nEvaluate prioritization for:\n\n1. **Business Value Alignment**\n   - Are high-value items prioritized?\n   - Is MVP clearly defined?\n   - Are quick wins identified?\n\n2. **Technical Dependencies**\n   - Are foundational tasks first?\n   - Are blockers addressed early?\n   - Is the critical path optimized?\n\n3. **Risk-Based Prioritization**\n   - Are risky items tackled early?\n   - Is there time for pivoting if needed?\n   - Are unknowns explored early?\n\n4. **Priority Conflicts**\n   - Competing priorities\n   - Resource contention\n   - Deadline pressure points\n\n## Output Format\n\n```markdown\n## 📊 Priority Review\n\n### Score: X/10\n\n### Priority Matrix\n\n| Priority | Task Count | % of Total |\n|----------|-----------|------------|\n| P0 (Critical) | X | X% |\n| P1 (High) | X | X% |\n| P2 (Medium) | X | X% |\n| P3 (Low) | X | X% |\n\n### Priority Issues\n\n#### Misprioritzed Items\n- [ ] [Task] - Currently P[X], should be P[Y]\n  - Reason: [why priority is wrong]\n\n#### Missing Priorities\n- [ ] [Task] - needs explicit priority assignment\n\n### Recommended Execution Order\n\n1. **Phase 1 (MVP)**\n   - [Task A] - [reason]\n   - [Task B] - [reason]\n\n2. **Phase 2 (Enhancement)**\n   - [Task C] - [reason]\n   - [Task D] - [reason]\n\n3. **Phase 3 (Nice to have)**\n   - [Task E] - [reason]\n\n### Quick Wins (high value, low effort)\n- [ ] [Task] - can be done in [X hours]\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "opencode/skills/codex-review/references/experts/quality-expert.md": "# Quality Expert Prompt for Codex\n\nCodex MCP に送信するコード品質レビュー用プロンプト。\n\n## 7-Section Format\n\n### TASK\n\nコードの品質（可読性、保守性、ベストプラクティス）を分析し、改善が必要な箇所を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で品質問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- 具体的な改善案\n- 品質スコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- 技術スタック: {tech_stack}\n- 対象: 命名、構造、重複、エラーハンドリング\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Respect existing project style\n- Avoid excessive improvement suggestions\n\n### MUST DO\n\n1. **可読性**:\n   - 曖昧な命名（x, tmp, data）\n   - 長すぎる関数（50行以上）\n   - 深いネスト（4段階以上）\n   - マジックナンバー\n\n2. **保守性**:\n   - 重複コード\n   - 密結合\n   - グローバル状態の多用\n   - 未使用コード\n\n3. **ベストプラクティス**:\n   - 空の catch ブロック\n   - any 型の多用\n   - コールバック地獄\n   - テストしにくい構造\n\n4. **クロスプラットフォーム**:\n   - レスポンシブ未対応\n   - 100vw によるスクロールバー問題\n   - 小さすぎるタッチターゲット\n\n### MUST NOT DO\n\n- スタイル/フォーマットの問題を High/Critical として報告しない\n- 自動生成コードの品質を問題視しない\n- テストファイル内の重複を DRY 違反として報告しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Quality Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | File | Line | Issue | Fix |\n|---|----------|------|------|-------|-----|\n| 1 | Medium | services/user.ts | 45 | Function too long (78 lines) | Split into smaller functions |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "opencode/skills/codex-review/references/experts/scope-analyst-expert.md": "# Scope Analyst Expert Prompt for Codex\n\nCodex MCP に送信する要件分析用プロンプト。\n> claude-delegator を参考に設計\n\n## 7-Section Format\n\n### TASK\n\n要件・リクエストを分析し、計画開始前に曖昧さ、隠れた要件、潜在的な問題を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で要件の問題を報告:\n- インテント分類\n- 発見事項リスト\n- 確認が必要な質問\n- リスクと軽減策\n- 推奨アクション\n\n### CONTEXT\n\n分析対象:\n- 要件/リクエスト: {requirements}\n- 対象: 曖昧さ、隠れた要件、依存関係、リスク\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Focus on real problems\n- Avoid over-analysis\n\n### MUST DO\n\n1. **インテント分類**:\n\n| タイプ | フォーカス | 主な質問 |\n|--------|----------|----------|\n| リファクタリング | 安全性 | 何が壊れる？テストカバレッジは？ |\n| 新規構築 | 発見 | 類似パターンは？未知の要素は？ |\n| 中規模タスク | ガードレール | スコープ内/外は？ |\n| アーキテクチャ | 戦略 | トレードオフは？2年後の視点は？ |\n| バグ修正 | 根本原因 | 本当のバグ vs 症状は？影響範囲は？ |\n| 調査 | 終了条件 | 答えるべき質問は？いつ止めるか？ |\n\n2. **分析項目**:\n   - **隠れた要件**: 暗黙の前提、ビジネスコンテキスト、エッジケース\n   - **曖昧さ**: 複数解釈、未決定事項、実装者による差異\n   - **依存関係**: 既存コード、必要な前提条件、破壊リスク\n   - **リスク**: 失敗時の影響、ロールバック計画\n\n3. **アンチパターン検出**:\n   - 過剰設計: 「将来のため」だけの抽象化\n   - スコープクリープ: 「ついでに」の変更\n   - 曖昧シグナル: 「簡単なはず」「X のように」\n\n### MUST NOT DO\n\n- 明確で小さなタスクに過度な分析を適用しない\n- 存在しないリスクを作り出さない\n- 確認済みの前提を再質問しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Scope Analysis Results\n\n**Intent Classification**: [Type] - [One sentence why]\n\n### Pre-Analysis Findings\n\n- [Key finding 1]\n- [Key finding 2]\n- [Key finding 3]\n\n### Questions for Requester (if ambiguities exist)\n\n1. [Specific question]\n2. [Specific question]\n\n### Identified Risks\n\n| Risk | Severity | Mitigation |\n|------|----------|------------|\n| [Risk 1] | High | [Mitigation] |\n\n### Recommendation\n\n[Proceed / Clarify First / Reconsider Scope]\n\n### Severity Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "opencode/skills/codex-review/references/experts/scope-creep-expert.md": "# Scope Creep Expert - Scope Review\n\nYou are a **Scope Creep Expert** specializing in detecting and preventing scope creep in project plans.\n\n## Review Focus\n\nEvaluate for scope creep indicators:\n\n1. **Original vs Current Scope**\n   - Compare initial requirements with current tasks\n   - Identify additions that weren't in original plan\n   - Flag \"nice to have\" items mixed with \"must have\"\n\n2. **Feature Creep Patterns**\n   - \"While we're at it...\" additions\n   - Gold plating (over-engineering)\n   - Premature optimization\n   - Unnecessary abstractions\n\n3. **Requirement Inflation**\n   - Expanded acceptance criteria\n   - Additional edge cases beyond requirements\n   - Scope expansion disguised as clarification\n\n4. **Red Flags**\n   - Tasks unrelated to core objective\n   - Dependencies on future features\n   - \"Improvements\" not in original spec\n\n## Output Format\n\n```markdown\n## 🎯 Scope Creep Review\n\n### Score: X/10 (10 = no scope creep)\n\n### Scope Analysis\n\n| Category | Original | Current | Δ |\n|----------|----------|---------|---|\n| Core tasks | X | Y | +Z |\n| Features | X | Y | +Z |\n| Integrations | X | Y | +Z |\n\n### Scope Creep Detected\n\n#### Definite Scope Creep\n- [ ] [Task/Feature]\n  - Original requirement: [what was asked]\n  - Current scope: [what's being done]\n  - Recommendation: Remove or defer\n\n#### Potential Scope Creep\n- [ ] [Task/Feature]\n  - Concern: [why it might be scope creep]\n  - Recommendation: Verify with stakeholder\n\n### Items to Defer (not scope creep, but can wait)\n- [ ] [Task] - can be done in phase 2\n- [ ] [Feature] - nice to have, not blocking\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "opencode/skills/codex-review/references/experts/scope-feasibility-expert.md": "# Scope Feasibility Expert - Scope Review\n\nYou are a **Scope Feasibility Expert** specializing in evaluating whether the defined scope is achievable within constraints.\n\n## Review Focus\n\nEvaluate scope feasibility for:\n\n1. **Time Constraints**\n   - Can scope be completed in available time?\n   - Are estimates realistic?\n   - Is there buffer for unknowns?\n\n2. **Resource Constraints**\n   - Skills available vs required\n   - Team capacity\n   - Tool/infrastructure availability\n\n3. **Scope-Time Balance**\n   - Is scope matched to timeline?\n   - What can be cut if needed?\n   - What's the minimum viable scope?\n\n4. **Constraint Violations**\n   - Impossible combinations\n   - Conflicting requirements\n   - Unrealistic expectations\n\n## Output Format\n\n```markdown\n## ⚖️ Scope Feasibility Review\n\n### Score: X/10\n\n### Feasibility Matrix\n\n| Constraint | Available | Required | Gap |\n|------------|-----------|----------|-----|\n| Time | X days | Y days | ±Z |\n| People | X | Y | ±Z |\n| Skills | [list] | [list] | [gaps] |\n\n### Feasibility Assessment\n\n#### ✅ Achievable\n- [Scope item] - fits within constraints\n\n#### ⚠️ At Risk\n- [Scope item]\n  - Risk: [what could go wrong]\n  - Mitigation: [how to address]\n\n#### ❌ Not Feasible (as-is)\n- [Scope item]\n  - Blocker: [why it can't be done]\n  - Options:\n    1. Reduce scope to [X]\n    2. Extend timeline by [Y]\n    3. Add resources [Z]\n\n### Minimum Viable Scope\nIf constraints are tight, focus on:\n1. [Essential item 1]\n2. [Essential item 2]\n3. [Essential item 3]\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "opencode/skills/codex-review/references/experts/security-expert.md": "# Security Expert Prompt for Codex\n\nCodex MCP に送信するセキュリティレビュー用プロンプト。\n\n## 7-Section Format\n\n### TASK\n\nコードのセキュリティ脆弱性を分析し、OWASP Top 10 を含む一般的なセキュリティ問題を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式でセキュリティ問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- 各問題の修正案\n- セキュリティスコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- 技術スタック: {tech_stack}\n- 対象領域: 認証、認可、入力検証、データ保護\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Reduce false positives by considering context\n- Consider framework-specific security features\n\n### MUST DO\n\n1. **インジェクション**: SQL、コマンド、XSS をチェック\n2. **認証・認可**: ハードコード認証情報、弱い認証、権限チェック漏れ\n3. **機密データ**: ログ出力、安全でない通信、.env のコミット\n4. **設定ミス**: デバッグモード、CORS、セキュリティヘッダー\n5. **Cookie**: HttpOnly、SameSite、Secure、Domain\n6. **ファイルアップロード**: MIME、サイズ、拡張子、パストラバーサル\n7. **決済**: 冪等性、金額改ざん、Webhook 署名\n\n### MUST NOT DO\n\n- テストファイルのセキュリティ警告を出さない\n- 開発環境専用の設定を本番問題として報告しない\n- 既知の安全なパターン（ORM のパラメータ化等）を誤検出しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Security Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | File | Line | Issue | Fix |\n|---|----------|------|------|-------|-----|\n| 1 | Critical | path/to/file.ts | 45 | SQL Injection | Use parameterized query |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "opencode/skills/codex-review/references/experts/seo-expert.md": "# SEO Expert Prompt for Codex\n\nCodex MCP に送信する SEO/OGP レビュー用プロンプト。\n\n## 7-Section Format\n\n### TASK\n\nSEO 最適化と OGP タグを分析し、検索エンジン・SNS シェア品質の問題を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で SEO 問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- 具体的な修正案\n- SEO スコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- フレームワーク: {tech_stack}\n- 対象: メタタグ、OGP、robots.txt、構造化データ\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Consider framework-specific SEO features (Next.js Metadata API, etc.)\n- Check dynamic pages with representative patterns\n\n### MUST DO\n\n1. **基本メタタグ**:\n   - title 欠落/重複/長さ\n   - description 欠落/長さ\n   - canonical URL\n   - viewport\n\n2. **OGP**:\n   - og:title, og:description, og:image\n   - og:image サイズ（1200x630 推奨）\n   - og:url と canonical の一致\n\n3. **Twitter Card**:\n   - twitter:card（summary_large_image 推奨）\n   - twitter:title, twitter:description, twitter:image\n\n4. **クローラビリティ**:\n   - robots.txt 存在/設定\n   - sitemap.xml 存在\n   - noindex 残存チェック\n\n5. **HTTP ステータス**:\n   - 404/500 が 200 を返していないか\n   - リダイレクトチェーン\n\n### MUST NOT DO\n\n- API ルート/バックエンドファイルを SEO 対象にしない\n- 管理画面/非公開ページの SEO を問題視しない\n- 構造化データを必須として報告しない（オプション扱い）\n\n### OUTPUT FORMAT\n\n```markdown\n## SEO/OGP Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | File | Issue | Fix |\n|---|----------|------|-------|-----|\n| 1 | High | app/layout.tsx | Missing viewport meta | Add viewport meta tag |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "opencode/skills/cursor-mem/SKILL.md": "---\nname: cursor-mem\ndescription: \"Accesses the claude-mem MCP server from Cursor to search session history and record observations. Triggers: memory search, claude-mem, past decisions, record this. Do NOT load for: normal coding, temporary notes, or implementation work.\"\nallowed-tools: [\"Bash\", \"Read\", \"mcp__claude-mem__*\"]\n---\n\n# Cursor-Mem Integration Skill\n\nCursorからClaude-memを活用するスキル。Claude CodeとCursorで同じメモリデータベースを共有し、セッション間の知識を引き継ぎます。\n\n## 🎯 使用場面\n\n### 検索（読み取り）\n- **過去の意思決定を確認**: 「なぜこのアーキテクチャを選んだのか？」\n- **パターンの参照**: 「以前はどのように実装したか？」\n- **バグ修正履歴**: 「同様の問題を過去に解決したか？」\n- **技術選定の理由**: 「なぜこのライブラリを使っているのか？」\n\n### 記録（書き込み）\n- **PMとしての判断をメモ**: レビュー中の気付きや設計判断\n- **パターンの記録**: 再利用可能なソリューション\n- **引き継ぎ事項**: 次のセッションやチームメンバーへの情報\n- **学習事項**: トラブルシューティングで得た知見\n\n## 📋 利用可能なMCPツール\n\nCursor上でclaude-memのMCPツールを直接利用できます：\n\n### 検索系\n- `mcp__claude-mem__search`: キーワードでメモリを検索\n- `mcp__claude-mem__timeline`: 時系列で記録を取得\n- `mcp__claude-mem__get_recent_context`: 最近の文脈を取得\n- `mcp__claude-mem__get_observation`: 特定の観測を取得\n\n### 書き込み系\n- `mcp__claude-mem__create_entities`: 新しいエンティティを作成\n- `mcp__claude-mem__create_relations`: エンティティ間の関連を作成\n- `mcp__claude-mem__add_observations`: 観測を追加\n\n## 🔧 セットアップ\n\n### 1. MCPラッパースクリプトの配置\n\n```bash\n# harness リポジトリ内に claude-mem-mcp がインストールされている前提\n# 絶対パスで参照\nHARNESS_PATH=\"/path/to/claude-code-harness\"\n```\n\n### 2. Cursor MCP設定\n\nプロジェクトルートに `.cursor/mcp.json` を作成：\n\n```json\n{\n  \"mcpServers\": {\n    \"claude-mem\": {\n      \"type\": \"stdio\",\n      \"command\": \"/absolute/path/to/claude-code-harness/scripts/claude-mem-mcp\"\n    }\n  }\n}\n```\n\n**⚠️ 重要**: `command` には絶対パスを指定してください。\n\n### 3. Cursor再起動\n\n設定後、Cursorを再起動してMCPサーバーを認識させます。\n\n## 💡 使い方の例\n\n詳細な使用例は [examples.md](./examples.md) を参照してください。\n\n### 基本的な検索\n\n```\nユーザー: 「認証方式の選定理由を確認したい」\n\nCursor（Composer）:\n→ 直接 mcp__claude-mem__search を呼び出し（auto mode により自動有効化）\n→ クエリ: \"認証 JWT Supabase 選定理由\"\n→ 過去の決定記録（decisions）を取得\n```\n\n> **v2.1.7+**: MCP auto mode がデフォルト有効のため、MCPSearch による事前検索は不要です。\n\n### 気付きの記録\n\n```\nユーザー: 「この実装パターンを記録しておいて」\n\nCursor（Composer）:\n→ 直接 mcp__claude-mem__add_observations を呼び出し\n→ タイプ: pattern\n→ タグ: source:cursor, review, best-practice\n→ 内容: 実装パターンの説明\n```\n\n## 🏷️ タグ規約\n\nClaude CodeとCursorで統一されたタグ体系を使用します：\n\n| タグ | 用途 |\n|------|------|\n| `source:cursor` | Cursorから記録された情報 |\n| `source:claude-code` | Claude Codeから記録された情報 |\n| `type:decision` | 意思決定の記録 |\n| `type:pattern` | 再利用可能なパターン |\n| `type:bug` | バグ修正の記録 |\n| `type:review` | レビューでの気付き |\n| `type:handoff` | 引き継ぎ事項 |\n\n## 🔄 Claude Code との連携\n\n### データ共有\n\n- Claude CodeとCursorは同じSQLiteデータベース（`~/.claude-mem/claude-mem.db`）を使用\n- WALモードで並行書き込みに対応\n- リアルタイムでデータが共有される\n\n### 推奨ワークフロー\n\n1. **Cursor（PM役）**: 設計判断やレビュー結果を記録\n2. **Claude Code（実装役）**: 過去の判断を参照しながら実装\n3. **双方向検索**: どちらからでも過去の記録を検索可能\n\n## 🔄 Claude Code 2.1.7+ 対応\n\nMCP tool search の auto mode がデフォルト有効になりました。\n\n**変更点**:\n- MCPSearch による明示的なツール検索は不要\n- MCP ツールは直接呼び出し可能\n- 初回呼び出し時に自動的にツールが有効化される\n\n**互換性**:\n- Claude Code 2.1.6 以前: MCPSearch を先に実行\n- Claude Code 2.1.7+: 直接呼び出し可能\n\n## ⚠️ 注意事項\n\n### パフォーマンス\n\n- 初回検索時はワーカー起動に2-3秒かかる場合があります\n- 2回目以降はワーカーが常駐するため高速\n\n### セキュリティ\n\n- メモリデータベースはローカル環境にのみ保存されます\n- 機密情報を記録する場合は注意してください\n\n### トラブルシューティング\n\n**問題**: MCPツールが認識されない\n**解決策**:\n1. `.cursor/mcp.json` のパスが正しいか確認\n2. スクリプトが実行可能か確認: `chmod +x scripts/claude-mem-mcp`\n3. Cursorを再起動\n\n**問題**: ワーカーが起動しない\n**解決策**:\n1. ヘルスチェック: `curl http://127.0.0.1:37777/health`\n2. 手動起動: `node ~/.claude/plugins/cache/thedotmack/claude-mem/*/scripts/worker-cli.js start`\n\n## 📚 参考資料\n\n- [Claude-mem 公式ドキュメント](https://github.com/thedotmack/claude-mem)\n- [Cursor MCP 設定ガイド](https://cursor.com/docs/context/mcp)\n- [使用例集](./examples.md)\n- [統合ガイド](../../docs/guides/cursor-mem-integration.md)\n",
        "opencode/skills/cursor-mem/examples.md": "# Cursor-Mem 使用例集\n\nこのドキュメントでは、CursorからClaude-memを活用する実践的な使用例を紹介します。\n\n## 📖 目次\n\n- [ユースケース1: 過去の決定を確認](#ユースケース1-過去の決定を確認)\n- [ユースケース2: レビュー中の気付きを記録](#ユースケース2-レビュー中の気付きを記録)\n- [ユースケース3: 引き継ぎ事項の記録](#ユースケース3-引き継ぎ事項の記録)\n- [ユースケース4: パターンの検索と再利用](#ユースケース4-パターンの検索と再利用)\n- [ユースケース5: バグ修正履歴の確認](#ユースケース5-バグ修正履歴の確認)\n\n---\n\n## ユースケース1: 過去の決定を確認\n\n### シナリオ\n認証方式の選定理由を確認したい。なぜJWTではなくSupabase Authを選んだのか？\n\n### Cursor操作（Composer）\n\n```\nユーザー: 「認証方式の選定理由を教えて」\n\nComposer:\n1. MCPツール `mcp__claude-mem__search` を使用\n2. パラメータ:\n   {\n     \"query\": \"認証 JWT Supabase 選定\",\n     \"limit\": 5\n   }\n```\n\n### 期待される結果\n\n```json\n{\n  \"results\": [\n    {\n      \"id\": 12345,\n      \"type\": \"decision\",\n      \"content\": \"Supabase Authを採用。理由: RLSとの統合、セッション管理の簡素化、スケーラビリティ。JWT単体では認可ロジックが複雑化する懸念。\",\n      \"tags\": [\"auth\", \"decision\", \"supabase\"],\n      \"created_at\": \"2024-12-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### フォローアップ\n\n特定の観測IDで詳細を取得：\n\n```\nComposer:\nMCPツール `mcp__claude-mem__get_observation` を使用\nパラメータ: { \"id\": 12345 }\n```\n\n---\n\n## ユースケース2: レビュー中の気付きを記録\n\n### シナリオ\nコードレビュー中に重要なパターンを発見。将来の参考のために記録しておきたい。\n\n### Cursor操作（Composer）\n\n```\nユーザー: 「このRLSポリシーのパターンを記録しておいて」\n\nComposer:\nMCPツール `mcp__claude-mem__add_observations` を使用\nパラメータ:\n{\n  \"observations\": [\n    {\n      \"type\": \"pattern\",\n      \"content\": \"RLSポリシーは常にuser_idで絞り込むパターンを採用。auth.uid() = user_id の条件を全テーブルに適用。\",\n      \"tags\": [\"source:cursor\", \"review\", \"pattern\", \"rls\", \"security\"]\n    }\n  ]\n}\n```\n\n### 記録内容の例\n\n| フィールド | 値 |\n|-----------|---|\n| **type** | pattern |\n| **content** | RLSポリシーのベストプラクティス |\n| **tags** | source:cursor, review, pattern, rls, security |\n| **timestamp** | 自動記録 |\n\n---\n\n## ユースケース3: 引き継ぎ事項の記録\n\n### シナリオ\nPMとして作業完了後、実装担当（Claude Code）への引き継ぎ事項を記録。\n\n### Cursor操作（Composer）\n\n```\nユーザー: 「バックエンドのエラーハンドリングを統一する必要があることを記録」\n\nComposer:\nMCPツール `mcp__claude-mem__create_entities` を使用\nパラメータ:\n{\n  \"entities\": [\n    {\n      \"name\": \"backend-error-handling-todo\",\n      \"entityType\": \"task\",\n      \"observations\": [\n        {\n          \"type\": \"handoff\",\n          \"content\": \"バックエンドのエラーハンドリングを統一する必要あり。現在、APIルート毎に異なるエラーフォーマットが混在。標準化して503エラーの処理を改善。\",\n          \"tags\": [\"source:cursor\", \"handoff\", \"backend\", \"error-handling\", \"todo\"]\n        }\n      ]\n    }\n  ]\n}\n```\n\n### Claude Code側での確認\n\n```bash\n# Claude Code で検索\nmcp__claude-mem__search\n→ query: \"handoff backend error\"\n→ 引き継ぎ事項を取得\n```\n\n---\n\n## ユースケース4: パターンの検索と再利用\n\n### シナリオ\n以前実装したフォームバリデーションのパターンを再利用したい。\n\n### Cursor操作（Composer）\n\n```\nユーザー: 「フォームバリデーションのパターンを教えて」\n\nComposer:\n1. MCPツール `mcp__claude-mem__search` を使用\n2. パラメータ:\n   {\n     \"query\": \"form validation pattern best-practice\",\n     \"limit\": 3\n   }\n```\n\n### 期待される結果\n\n```json\n{\n  \"results\": [\n    {\n      \"id\": 23456,\n      \"type\": \"pattern\",\n      \"content\": \"Zod + React Hook Form パターン: スキーマ定義を共有し、フロント/バックで再利用。zodResolver でバリデーションロジックを統一。\",\n      \"tags\": [\"pattern\", \"validation\", \"zod\", \"react-hook-form\"],\n      \"files\": [\"src/schemas/userSchema.ts\", \"src/hooks/useUserForm.ts\"]\n    }\n  ]\n}\n```\n\n### 実装時の活用\n\n1. パターンを確認\n2. 関連ファイルを参照\n3. 同様のアプローチで新機能を実装\n\n---\n\n## ユースケース5: バグ修正履歴の確認\n\n### シナリオ\n類似のバグに遭遇。過去に同じ問題を解決していないか確認したい。\n\n### Cursor操作（Composer）\n\n```\nユーザー: 「CORS エラーの過去の修正履歴を確認」\n\nComposer:\nMCPツール `mcp__claude-mem__search` を使用\nパラメータ:\n{\n  \"query\": \"CORS error fix bug\",\n  \"limit\": 5\n}\n```\n\n### 期待される結果\n\n```json\n{\n  \"results\": [\n    {\n      \"id\": 34567,\n      \"type\": \"bug\",\n      \"content\": \"CORS エラー修正: Supabase の CORS 設定が不足。storage.buckets テーブルに allowed_origins を追加。\",\n      \"tags\": [\"bug\", \"cors\", \"supabase\", \"storage\"],\n      \"created_at\": \"2024-11-20T14:00:00Z\",\n      \"related_files\": [\"supabase/migrations/20241120_add_cors.sql\"]\n    }\n  ]\n}\n```\n\n### 修正への活用\n\n1. 過去の修正内容を確認\n2. 関連ファイル（migration）を参照\n3. 同じアプローチを適用\n\n---\n\n## 🔄 統合ワークフロー例\n\n### PM（Cursor）→ 実装（Claude Code）の流れ\n\n#### Step 1: Cursorでレビュー & 記録\n\n```\n# Cursor Composer\n「このコンポーネントの設計パターンを記録」\n→ mcp__claude-mem__add_observations\n→ タグ: source:cursor, review, pattern, component\n```\n\n#### Step 2: Claude Codeで参照 & 実装\n\n```\n# Claude Code\n「コンポーネント設計のパターンを確認」\n→ mcp__claude-mem__search\n→ query: \"component pattern review\"\n→ Cursorで記録されたパターンを取得\n→ 同じパターンで実装\n```\n\n#### Step 3: 実装完了を記録\n\n```\n# Claude Code\n実装完了後、自動で記録\n→ mcp__claude-mem__add_observations\n→ タグ: source:claude-code, implementation, complete\n```\n\n#### Step 4: Cursorで検証\n\n```\n# Cursor Composer\n「実装状況を確認」\n→ mcp__claude-mem__timeline\n→ 最近の実装記録を時系列で取得\n```\n\n---\n\n## 💡 ベストプラクティス\n\n### タグの付け方\n\n| 状況 | 推奨タグ |\n|------|---------|\n| Cursorから記録 | `source:cursor` |\n| 設計判断 | `type:decision, design` |\n| レビュー結果 | `type:review, code-quality` |\n| 実装パターン | `type:pattern, best-practice` |\n| バグ修正 | `type:bug, fix` |\n| 引き継ぎ | `type:handoff, todo` |\n\n### 検索のコツ\n\n1. **具体的なキーワード**: `\"auth JWT\"` より `\"auth supabase jwt decision\"` の方が精度が高い\n2. **タグフィルタ**: 検索後にタグで絞り込み\n3. **時系列検索**: `timeline` ツールで最近の記録を取得\n4. **関連ファイル**: ファイルパスで関連する記録を発見\n\n### 記録のコツ\n\n1. **Why を記録**: 「何をしたか」より「なぜそうしたか」を重視\n2. **タグを充実**: 将来の検索性を高める\n3. **関連ファイルを紐付け**: 実装との結び付きを明確に\n4. **定期的な整理**: 重要な記録にマーカーを付ける\n\n---\n\n## 🔗 関連リソース\n\n- [SKILL.md](./SKILL.md) - スキルの詳細説明\n- [統合ガイド](../../docs/guides/cursor-mem-integration.md) - セットアップ手順\n- [Claude-mem 公式ドキュメント](https://github.com/thedotmack/claude-mem)\n",
        "opencode/skills/deploy/SKILL.md": "---\nname: deploy\ndescription: \"Sets up deployment, analytics, and health monitoring for projects. Use when user mentions deployment, Vercel, Netlify, analytics, or health checks. Do NOT load for: implementation work, local development, reviews, or setup.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Deploy Skills\n\nデプロイとモニタリングの設定を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **デプロイ設定** | See [references/deployment-setup.md](references/deployment-setup.md) |\n| **アナリティクス** | See [references/analytics.md](references/analytics.md) |\n| **環境診断** | See [references/health-checking.md](references/health-checking.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って設定\n",
        "opencode/skills/deploy/references/analytics.md": "---\nname: analytics\ndescription: \"Analytics統合（GA/Vercel Analytics 等）。アクセス解析を導入したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Analytics Skill\n\nGoogle Analytics または Vercel Analytics を統合するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「アクセス解析を入れて」\n- 「Google Analyticsを設定して」\n- 「Vercel Analyticsを追加して」\n- 「ページビューを追跡したい」\n\n---\n\n## 機能\n\n- ページビュー追跡\n- イベント追跡\n- コンバージョン追跡\n- ユーザー行動分析\n\n---\n\n## 実行フロー\n\n1. プロジェクト構成を確認（Next.js / React / etc）\n2. Google Analytics または Vercel Analytics を選択\n3. 必要なパッケージをインストール\n4. 設定ファイルを生成\n5. イベント追跡関数を作成\n",
        "opencode/skills/deploy/references/deployment-setup.md": "---\nname: deploy-setup\ndescription: \"デプロイ自動化設定（Vercel/Netlify 等）。プロジェクトを公開したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Deploy Setup Skill\n\nVercel/Netlifyへのデプロイを自動化するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「デプロイできるようにして」\n- 「Vercelに出したい」\n- 「Netlifyにデプロイしたい」\n- 「本番環境を設定して」\n\n---\n\n## 機能\n\n- Vercel/Netlifyプロジェクトの作成ガイド\n- 環境変数の設定ガイド\n- GitHub Actionsによる自動デプロイ\n- プレビューデプロイ（Pull Request）\n\n---\n\n## 実行フロー\n\n1. プロジェクト構成を確認\n2. Vercel または Netlify を選択\n3. 設定ファイルを生成（vercel.json / netlify.toml）\n4. 環境変数の設定をガイド\n5. デプロイ検証\n",
        "opencode/skills/deploy/references/health-checking.md": "---\nname: health-check\ndescription: \"環境診断（依存/設定/利用可能機能の確認）。環境が正しくセットアップされているか確認したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Bash\"]\n---\n\n# Health Check Skill\n\nプラグインを使用する前に、環境が正しくセットアップされているかを診断するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「この環境で動くかチェックして」\n- 「何が足りない？」\n- 「環境を診断して」\n- 「使える機能を教えて」\n\n---\n\n## チェック項目\n\n### 必須ツール\n- Git\n- Node.js / npm（該当する場合）\n- GitHub CLI（オプション）\n\n### 設定ファイル\n- `claude-code-harness.config.json` の存在と妥当性\n- `.claude/settings.json` の存在\n\n### ワークフローファイル\n- `Plans.md` の存在\n- `AGENTS.md` の存在\n- `CLAUDE.md` の存在\n\n---\n\n## 出力形式\n\n```\n## 環境診断レポート\n\n### 必須ツール\n✅ git (2.40.0)\n✅ node (v20.10.0)\n⚠️ gh (未インストール - CI自動修正に必要)\n\n### 設定ファイル\n✅ claude-code-harness.config.json\n✅ .claude/settings.json\n\n### 利用可能な機能\n✅ /work, /plan-with-agent, /sync-status\n⚠️ CI自動修正 (gh が必要)\n```\n",
        "opencode/skills/dev-browser/SKILL.md": "---\nname: dev-browser\ndescription: \"Browser automation with persistent page state. Use when users ask to navigate websites, fill forms, take screenshots, extract web data, test web apps, or automate browser workflows. Trigger phrases include 'go to [url]', 'click on', 'fill out the form', 'take a screenshot', 'scrape', 'automate', 'test the website', 'log into', or any browser interaction request.\"\nallowed-tools: [\"Bash\", \"Read\"]\ncontext: fork\n---\n\n# Dev Browser Skill (agent-browser)\n\nブラウザ自動化を行うスキル。agent-browser CLI を使用して、UI デバッグ・検証・自動操作を実行します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「ページを開いて」「URLを確認して」\n- 「クリックして」「入力して」「フォームに」\n- 「スクリーンショットを撮って」\n- 「UIを確認して」「画面をテストして」\n- \"open this page\", \"click on\", \"fill the form\", \"screenshot\"\n\n---\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **ブラウザ自動化** | See [references/browser-automation.md](references/browser-automation.md) |\n| **AI スナップショットワークフロー** | See [references/ai-snapshot-workflow.md](references/ai-snapshot-workflow.md) |\n\n## 実行手順\n\n### Step 0: agent-browser の確認\n\n```bash\n# インストール確認\nwhich agent-browser\n\n# 未インストールの場合\nnpm install -g agent-browser\nagent-browser install\n```\n\n### Step 1: ユーザーのリクエストを分類\n\n| リクエストタイプ | 対応アクション |\n|----------------|---------------|\n| URL を開く | `agent-browser open <url>` |\n| 要素をクリック | スナップショット → `agent-browser click @ref` |\n| フォーム入力 | スナップショット → `agent-browser fill @ref \"text\"` |\n| 状態確認 | `agent-browser snapshot -i -c` |\n| スクリーンショット | `agent-browser screenshot <path>` |\n| デバッグ | `agent-browser --headed open <url>` |\n\n### Step 2: AI スナップショットワークフロー（推奨）\n\nほとんどの操作で、まず**スナップショットを取得**してから要素参照で操作します：\n\n```bash\n# 1. ページを開く\nagent-browser open https://example.com\n\n# 2. スナップショット取得（AI 向け、インタラクティブ要素のみ）\nagent-browser snapshot -i -c\n\n# 出力例:\n# - link \"Home\" [ref=e1]\n# - button \"Login\" [ref=e2]\n# - input \"Email\" [ref=e3]\n# - input \"Password\" [ref=e4]\n# - button \"Submit\" [ref=e5]\n\n# 3. 要素参照で操作\nagent-browser click @e2           # Login ボタンをクリック\nagent-browser fill @e3 \"user@example.com\"\nagent-browser fill @e4 \"password123\"\nagent-browser click @e5           # Submit\n```\n\n### Step 3: 結果の確認\n\n```bash\n# 現在の状態をスナップショットで確認\nagent-browser snapshot -i -c\n\n# または URL を確認\nagent-browser get url\n\n# スクリーンショットを取得\nagent-browser screenshot result.png\n```\n\n---\n\n## クイックリファレンス\n\n### 基本操作\n\n| コマンド | 説明 |\n|---------|------|\n| `open <url>` | URL を開く |\n| `snapshot -i -c` | AI 向けスナップショット |\n| `click @e1` | 要素をクリック |\n| `fill @e1 \"text\"` | フォームに入力 |\n| `type @e1 \"text\"` | テキストを入力 |\n| `press Enter` | キーを押す |\n| `screenshot [path]` | スクリーンショット |\n| `close` | ブラウザを閉じる |\n\n### ナビゲーション\n\n| コマンド | 説明 |\n|---------|------|\n| `back` | 戻る |\n| `forward` | 進む |\n| `reload` | リロード |\n\n### 情報取得\n\n| コマンド | 説明 |\n|---------|------|\n| `get text @e1` | テキスト取得 |\n| `get html @e1` | HTML 取得 |\n| `get url` | 現在の URL |\n| `get title` | ページタイトル |\n\n### 待機\n\n| コマンド | 説明 |\n|---------|------|\n| `wait @e1` | 要素を待機 |\n| `wait 1000` | 1秒待機 |\n\n### デバッグ\n\n| コマンド | 説明 |\n|---------|------|\n| `--headed` | ブラウザを表示 |\n| `console` | コンソールログ |\n| `errors` | ページエラー |\n| `highlight @e1` | 要素をハイライト |\n\n---\n\n## セッション管理\n\n複数のタブ/セッションを並列管理：\n\n```bash\n# セッションを指定\nagent-browser --session admin open https://admin.example.com\nagent-browser --session user open https://example.com\n\n# セッション一覧\nagent-browser session list\n\n# 特定セッションで操作\nagent-browser --session admin snapshot -i -c\n```\n\n---\n\n## MCP ブラウザツールとの使い分け\n\n| ツール | 推奨度 | 用途 |\n|--------|--------|------|\n| **agent-browser** | ★★★ | 第一選択。AI 向けスナップショットが強力 |\n| chrome-devtools MCP | ★★☆ | Chrome が既に開いている場合 |\n| playwright MCP | ★★☆ | 複雑な E2E テスト |\n\n**原則**: まず agent-browser を試し、うまくいかない場合のみ MCP ツールを使用。\n\n---\n\n## 注意事項\n\n- agent-browser はヘッドレスモードがデフォルト\n- `--headed` オプションでブラウザを表示可能\n- セッションは明示的に `close` するまで維持される\n- 認証が必要なサイトはセッションを活用\n",
        "opencode/skills/dev-browser/references/ai-snapshot-workflow.md": "# AI Snapshot Workflow\n\nagent-browser の `snapshot` コマンドを活用した AI エージェント向けワークフロー。\n\n---\n\n## 概要\n\n`snapshot` コマンドは、ページのアクセシビリティツリーを取得し、各要素に参照 ID（`@e1`, `@e2` など）を付与します。これにより：\n\n1. **CSS セレクタ不要**: 動的な ID やクラス名に依存しない\n2. **コンテキスト把握**: 要素の役割（button, input, link）が明確\n3. **決定的操作**: `@e1` などの参照で確実に操作可能\n\n---\n\n## 基本ワークフロー\n\n### Step 1: ページを開く\n\n```bash\nagent-browser open https://example.com\n```\n\n### Step 2: スナップショット取得\n\n```bash\nagent-browser snapshot -i -c\n```\n\n**オプション説明**:\n- `-i, --interactive`: インタラクティブな要素（ボタン、リンク、入力フィールド等）のみ表示\n- `-c, --compact`: 空の構造要素を除去してコンパクトに\n\n**出力例**:\n```\n✓ Example Domain\n  https://example.com/\n\n- link \"Home\" [ref=e1]\n- link \"About\" [ref=e2]\n- button \"Login\" [ref=e3]\n- input \"Search\" [ref=e4]\n- button \"Search\" [ref=e5]\n```\n\n### Step 3: 要素参照で操作\n\n```bash\n# リンクをクリック\nagent-browser click @e1\n\n# 検索フォームに入力\nagent-browser fill @e4 \"search query\"\n\n# 検索ボタンをクリック\nagent-browser click @e5\n```\n\n### Step 4: 結果を確認\n\n```bash\n# 新しい状態をスナップショット\nagent-browser snapshot -i -c\n```\n\n---\n\n## Snapshot オプション詳細\n\n### `-i, --interactive`\n\nインタラクティブな要素のみを表示。操作対象を絞り込む際に有効。\n\n```bash\n# インタラクティブ要素のみ\nagent-browser snapshot -i\n\n# 全要素（テキストノード含む）\nagent-browser snapshot\n```\n\n### `-c, --compact`\n\n空の構造要素（div, span など内容のないもの）を除去。\n\n```bash\n# コンパクト出力\nagent-browser snapshot -c\n\n# 構造も含めて表示\nagent-browser snapshot\n```\n\n### `-d, --depth <n>`\n\nツリーの深さを制限。大きなページで概要を把握する際に有効。\n\n```bash\n# 深さ3まで\nagent-browser snapshot -d 3\n```\n\n### `-s, --selector <sel>`\n\n特定のセレクタにスコープを絞る。\n\n```bash\n# フォーム内のみ\nagent-browser snapshot -s \"form.login\"\n\n# ナビゲーション内のみ\nagent-browser snapshot -s \"nav\"\n```\n\n### 組み合わせ\n\n```bash\n# 推奨: インタラクティブ + コンパクト\nagent-browser snapshot -i -c\n\n# フォーム内のインタラクティブ要素のみ\nagent-browser snapshot -i -c -s \"form\"\n\n# 浅いツリーで概要把握\nagent-browser snapshot -i -d 2\n```\n\n---\n\n## ユースケース別ワークフロー\n\n### ログインフロー\n\n```bash\n# 1. ログインページを開く\nagent-browser open https://example.com/login\n\n# 2. スナップショット取得\nagent-browser snapshot -i -c\n# 出力:\n# - input \"Email\" [ref=e1]\n# - input \"Password\" [ref=e2]\n# - button \"Login\" [ref=e3]\n# - link \"Forgot password?\" [ref=e4]\n\n# 3. ログイン情報を入力\nagent-browser fill @e1 \"user@example.com\"\nagent-browser fill @e2 \"password123\"\n\n# 4. ログインボタンをクリック\nagent-browser click @e3\n\n# 5. 結果を確認\nagent-browser snapshot -i -c\nagent-browser get url\n```\n\n### フォーム送信\n\n```bash\n# 1. フォームページを開く\nagent-browser open https://example.com/contact\n\n# 2. フォーム内のスナップショット\nagent-browser snapshot -i -c -s \"form\"\n# 出力:\n# - input \"Name\" [ref=e1]\n# - input \"Email\" [ref=e2]\n# - textarea \"Message\" [ref=e3]\n# - button \"Send\" [ref=e4]\n\n# 3. フォームに入力\nagent-browser fill @e1 \"John Doe\"\nagent-browser fill @e2 \"john@example.com\"\nagent-browser fill @e3 \"Hello, this is a test message.\"\n\n# 4. 送信\nagent-browser click @e4\n\n# 5. 確認\nagent-browser snapshot -i -c\n```\n\n### ナビゲーション探索\n\n```bash\n# 1. トップページを開く\nagent-browser open https://example.com\n\n# 2. ナビゲーションを確認\nagent-browser snapshot -i -c -s \"nav\"\n# 出力:\n# - link \"Home\" [ref=e1]\n# - link \"Products\" [ref=e2]\n# - link \"About\" [ref=e3]\n# - link \"Contact\" [ref=e4]\n\n# 3. Products ページへ\nagent-browser click @e2\n\n# 4. 新しいページの構造を確認\nagent-browser snapshot -i -c\n```\n\n### 動的コンテンツの操作\n\n```bash\n# 1. ページを開く\nagent-browser open https://example.com/dashboard\n\n# 2. 初期スナップショット\nagent-browser snapshot -i -c\n\n# 3. ドロップダウンを開く\nagent-browser click @e5\n\n# 4. 待機（動的コンテンツのロード）\nagent-browser wait 500\n\n# 5. 新しいスナップショット（ドロップダウンメニューが表示される）\nagent-browser snapshot -i -c\n# 新しい要素が出現:\n# - menuitem \"Option 1\" [ref=e10]\n# - menuitem \"Option 2\" [ref=e11]\n# - menuitem \"Option 3\" [ref=e12]\n\n# 6. オプションを選択\nagent-browser click @e11\n```\n\n---\n\n## トラブルシューティング\n\n### 要素が見つからない\n\n```bash\n# フルスナップショット（すべての要素）\nagent-browser snapshot\n\n# 特定セレクタで絞り込み\nagent-browser snapshot -s \"#target-element\"\n\n# 待機してから再試行\nagent-browser wait 2000\nagent-browser snapshot -i -c\n```\n\n### 動的ページ\n\n```bash\n# JavaScript 実行後にスナップショット\nagent-browser eval \"document.querySelector('#load-more').click()\"\nagent-browser wait 1000\nagent-browser snapshot -i -c\n```\n\n### iframe 内の要素\n\n```bash\n# メインフレームのスナップショット\nagent-browser snapshot -i -c\n\n# iframe 内は直接アクセスできないため、\n# eval で iframe 内の操作を行う\nagent-browser eval \"document.querySelector('iframe').contentDocument.querySelector('button').click()\"\n```\n\n---\n\n## ベストプラクティス\n\n### 1. 常にスナップショットから開始\n\n操作前に必ずスナップショットを取得し、現在の状態を把握する。\n\n### 2. インタラクティブ + コンパクトをデフォルトに\n\n```bash\nagent-browser snapshot -i -c\n```\n\n### 3. 操作後は状態を確認\n\n```bash\nagent-browser click @e1\nagent-browser snapshot -i -c  # 結果を確認\n```\n\n### 4. 適切な待機を入れる\n\n動的コンテンツがある場合は待機を入れる：\n\n```bash\nagent-browser click @e1\nagent-browser wait 500\nagent-browser snapshot -i -c\n```\n\n### 5. セッションを活用\n\n認証状態を維持するためにセッションを使用：\n\n```bash\nagent-browser --session myapp open https://example.com/login\n# ... ログイン操作 ...\n# 以降、同じセッションで操作を継続\nagent-browser --session myapp open https://example.com/dashboard\n```\n",
        "opencode/skills/dev-browser/references/browser-automation.md": "# Browser Automation with agent-browser\n\nagent-browser CLI を使用したブラウザ自動化の詳細ガイド。\n\n---\n\n## インストール\n\n```bash\n# グローバルインストール\nnpm install -g agent-browser\n\n# Chromium をダウンロード\nagent-browser install\n\n# Linux の場合、システム依存関係も\nagent-browser install --with-deps\n```\n\n---\n\n## 基本操作\n\n### ページを開く\n\n```bash\n# 基本\nagent-browser open https://example.com\n\n# ブラウザを表示して開く（デバッグ用）\nagent-browser open https://example.com --headed\n\n# カスタムヘッダー付き\nagent-browser open https://api.example.com --headers '{\"Authorization\": \"Bearer token\"}'\n```\n\n### クリック\n\n```bash\n# 要素参照でクリック（推奨）\nagent-browser click @e1\n\n# CSS セレクタでクリック\nagent-browser click \"button.submit\"\n\n# ダブルクリック\nagent-browser dblclick @e1\n```\n\n### 入力\n\n```bash\n# フォームをクリア&入力\nagent-browser fill @e1 \"hello@example.com\"\n\n# 追加入力（クリアしない）\nagent-browser type @e1 \"追加テキスト\"\n\n# キーを押す\nagent-browser press Enter\nagent-browser press Tab\nagent-browser press \"Control+a\"\n```\n\n### フォーム操作\n\n```bash\n# チェックボックス\nagent-browser check @e1\nagent-browser uncheck @e1\n\n# セレクトボックス\nagent-browser select @e1 \"option-value\"\n\n# ファイルアップロード\nagent-browser upload @e1 /path/to/file.pdf\n```\n\n### スクロール\n\n```bash\n# 方向指定\nagent-browser scroll down\nagent-browser scroll up 500\n\n# 要素を表示\nagent-browser scrollintoview @e1\n```\n\n---\n\n## 情報取得\n\n```bash\n# テキスト取得\nagent-browser get text @e1\n\n# HTML 取得\nagent-browser get html @e1\n\n# 属性取得\nagent-browser get attr href @e1\n\n# 値取得（input）\nagent-browser get value @e1\n\n# 現在の URL\nagent-browser get url\n\n# ページタイトル\nagent-browser get title\n\n# 要素数\nagent-browser get count \"li.item\"\n\n# 要素の位置とサイズ\nagent-browser get box @e1\n```\n\n---\n\n## 状態チェック\n\n```bash\n# 表示されているか\nagent-browser is visible @e1\n\n# 有効か（disabled でないか）\nagent-browser is enabled @e1\n\n# チェックされているか\nagent-browser is checked @e1\n```\n\n---\n\n## 待機\n\n```bash\n# 要素が表示されるまで待機\nagent-browser wait @e1\nagent-browser wait \"button.loaded\"\n\n# 時間で待機（ミリ秒）\nagent-browser wait 2000\n```\n\n---\n\n## スクリーンショット\n\n```bash\n# 基本\nagent-browser screenshot\n\n# ファイル名指定\nagent-browser screenshot output.png\n\n# フルページ\nagent-browser screenshot --full page.png\n\n# PDF として保存\nagent-browser pdf document.pdf\n```\n\n---\n\n## JavaScript 実行\n\n```bash\n# スクリプト実行\nagent-browser eval \"document.title\"\nagent-browser eval \"localStorage.getItem('token')\"\nagent-browser eval \"window.scrollTo(0, document.body.scrollHeight)\"\n```\n\n---\n\n## ネットワーク操作\n\n```bash\n# リクエストをモック\nagent-browser network route \"*/api/users\" --body '{\"users\": []}'\n\n# リクエストをブロック\nagent-browser network route \"*/analytics/*\" --abort\n\n# ルート解除\nagent-browser network unroute \"*/api/users\"\n\n# リクエスト履歴\nagent-browser network requests\nagent-browser network requests --filter \"api\"\nagent-browser network requests --clear\n```\n\n---\n\n## Cookie/Storage\n\n```bash\n# Cookie 取得\nagent-browser cookies get\n\n# Cookie 設定\nagent-browser cookies set '{\"name\": \"session\", \"value\": \"abc123\", \"domain\": \"example.com\"}'\n\n# Cookie クリア\nagent-browser cookies clear\n\n# LocalStorage\nagent-browser storage local get \"key\"\nagent-browser storage local set \"key\" \"value\"\nagent-browser storage local clear\n\n# SessionStorage\nagent-browser storage session get \"key\"\n```\n\n---\n\n## タブ管理\n\n```bash\n# 新しいタブを開く\nagent-browser tab new\n\n# タブ一覧\nagent-browser tab list\n\n# タブを切り替え\nagent-browser tab 2\n\n# タブを閉じる\nagent-browser tab close\n```\n\n---\n\n## ブラウザ設定\n\n```bash\n# ビューポートサイズ\nagent-browser set viewport 1920 1080\n\n# デバイスエミュレーション\nagent-browser set device \"iPhone 12\"\n\n# 位置情報\nagent-browser set geo 35.6762 139.6503\n\n# オフラインモード\nagent-browser set offline on\nagent-browser set offline off\n\n# ダークモード\nagent-browser set media dark\nagent-browser set media light\n\n# 認証情報\nagent-browser set credentials admin password123\n```\n\n---\n\n## デバッグ\n\n```bash\n# コンソールログを表示\nagent-browser console\nagent-browser console --clear\n\n# ページエラーを表示\nagent-browser errors\nagent-browser errors --clear\n\n# 要素をハイライト\nagent-browser highlight @e1\n\n# トレース記録\nagent-browser trace start\n# ... 操作 ...\nagent-browser trace stop trace.zip\n```\n\n---\n\n## Find コマンド（高度な要素検索）\n\n```bash\n# ロールで検索してクリック\nagent-browser find role button click --name \"Submit\"\n\n# テキストで検索\nagent-browser find text \"Click here\" click\n\n# ラベルで検索\nagent-browser find label \"Email\" fill \"test@example.com\"\n\n# プレースホルダーで検索\nagent-browser find placeholder \"Enter your name\" fill \"John\"\n\n# テスト ID で検索\nagent-browser find testid \"submit-btn\" click\n\n# 最初/最後/n番目\nagent-browser find first \"button\" click\nagent-browser find last \"input\" fill \"text\"\nagent-browser find nth 2 \"li\" click\n```\n\n---\n\n## マウス操作（低レベル）\n\n```bash\n# マウス移動\nagent-browser mouse move 100 200\n\n# マウスボタン\nagent-browser mouse down\nagent-browser mouse up\nagent-browser mouse down right\n\n# ホイール\nagent-browser mouse wheel 100\nagent-browser mouse wheel 100 50  # dy, dx\n```\n\n---\n\n## ドラッグ&ドロップ\n\n```bash\n# 要素間のドラッグ\nagent-browser drag @e1 @e2\n\n# 座標指定\nagent-browser drag @e1 \"500,300\"\n```\n\n---\n\n## セッション管理\n\n```bash\n# 名前付きセッション\nagent-browser --session myapp open https://example.com\n\n# セッション一覧\nagent-browser session list\n\n# 現在のセッション名\nagent-browser session\n\n# 環境変数でも指定可能\nAGENT_BROWSER_SESSION=myapp agent-browser snapshot\n```\n\n---\n\n## JSON 出力\n\n```bash\n# JSON 形式で出力\nagent-browser snapshot --json\nagent-browser get text @e1 --json\nagent-browser network requests --json\n```\n\n---\n\n## カスタムブラウザ\n\n```bash\n# カスタム実行ファイル\nagent-browser --executable-path /path/to/chrome open https://example.com\n\n# 環境変数でも指定可能\nAGENT_BROWSER_EXECUTABLE_PATH=/path/to/chrome agent-browser open https://example.com\n```\n",
        "opencode/skills/docs/SKILL.md": "---\nname: docs\ndescription: \"Generates documentation files including NotebookLM YAML and slide content. Use when user mentions documentation, YAML, NotebookLM, slides, or presentations. Do NOT load for: implementation work, code fixes, reviews, or deployments.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\"]\n---\n\n# Docs Skills\n\nドキュメント生成を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **NotebookLM YAML** | See [references/notebooklm-yaml.md](references/notebooklm-yaml.md) |\n| **スライド YAML** | See [references/notebooklm-slides.md](references/notebooklm-slides.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って生成\n",
        "opencode/skills/docs/references/notebooklm-slides.md": "---\nname: docs-notebooklm-slide-yaml\ndescription: \"NotebookLM の［スライド資料をカスタマイズ］で使えるデザイン指示YAMLを2案（別角度）生成して出力する。\"\nallowed-tools: [\"Read\", \"Write\"]\n---\n\n# NotebookLM Slide Design YAML (2 Variations)\n\n## 目的\n\nNotebookLM の「スライド資料」生成で、**デザインの方向性をYAMLで明示して品質と再現性を上げる**。\n\nこのスキルは、同じソースでも見た目を変えられるように、**意図の捉え方が異なる2案**のYAMLを出力します。\n\n参考（使い方/作例）:\n- `https://note.com/yoshifujidesign/n/nd9c8db0b55b8`\n- `https://note.com/yoshifujidesign/n/n7412bccb5762`\n\n---\n\n## 使い方（NotebookLM 側）\n\nNotebookLMで資料ソースを読み込んだ後、\n［スライド資料］→［スライド資料をカスタマイズ］→［作成するスライドについて説明してください］\nに **このスキルが出力するYAML全文を貼り付けて**［生成］します。\n\n---\n\n## 入力（ユーザーに確認すること）\n\n可能なら最初に以下を最大5問で確認し、回答がなければ括弧のデフォルトで進めます。\n\n1. 目的（例: 社内共有/営業/採用/投資家向け） (社内共有)\n2. 想定読者（例: 経営/開発/非エンジニア） (非エンジニア混在)\n3. トーン（例: 信頼感/革新/親しみ） (信頼感)\n4. ブランド要素（ロゴ/ブランドカラー/フォント指定） (指定なし)\n5. 写真/図表の比率（写真多め/データ多め） (データ多め)\n\n---\n\n## 出力（必須フォーマット）\n\n以下の **2案**を必ず出力すること。\n\n- 案A: **可読性・信頼感・データ伝達を最優先**（ミニマル/コーポレート）\n- 案B: **情緒・ストーリー・余白の美学を重視**（エディトリアル/ライフスタイル）\n\nどちらも **日本語YAML**で、NotebookLMにそのまま貼れる形にする。\n\n出力形式:\n\n- `### 案A` の直下に YAML を1つ（コードブロック）\n- `### 案B` の直下に YAML を1つ（コードブロック）\n\n---\n\n## 生成ルール\n\n- 具体的な色は **HEX** を含める（例: `#FFFFFF`）\n- 「やってはいけない」も少し書く（例: 枠線多用禁止、過剰な影禁止、色数制限）\n- 章立て/ナビゲーション/余白/グリッドなど、**再現性に効く制約を明文化**\n- 内容（ソース）が不明でも成立するよう、**構造テンプレ**として書く\n\n---\n\n## 出力テンプレ（生成例の骨格）\n\n### 案A（ミニマル/コーポレート）\n\n（必要に応じて、目的/読者/ブランド色に合わせて微調整する）\n\n```yaml\n# presentation_design_spec_minimal_corporate_jp.yaml\n# スタイル: モダン・ミニマル / コーポレート\n# 目的: 可読性とデータ伝達を最優先（信頼感）\n\n全体デザイン設定:\n  トーン: \"信頼感、プロフェッショナル、クリーン、論理的\"\n  配色パレット:\n    ベース: \"#FFFFFF (白) または #F5F5F7 (非常に薄いグレー)\"\n    文字色: \"#111111 (ほぼ黒) または #333333 (チャコール)\"\n    アクセント: \"ブランドカラーがあればそれを使用。なければ #0052CC (ブルー) を採用\"\n    強調: \"#FFB020 (アンバー) - 重要な数値や注意に限定\"\n    色数制限: \"最大3色 + グレー階調\"\n  タイポグラフィ:\n    見出し: \"太めのゴシック体（サンセリフ）。短く強い言葉。\"\n    本文: \"可読性の高いゴシック体。行間を広めに。\"\n    数字: \"サンセリフ太字で大きく。単位（%など）は小さめ。\"\n  共通レイアウト・ルール:\n    グリッド: \"12カラム相当で整列。左右余白を広く。\"\n    ナビゲーション: \"左上に '01. SECTION' のような番号＋章題を小さく表示。\"\n    余白: \"詰め込み禁止。1スライド1メッセージ。\"\n    図表: \"罫線/グリッド線は最小。強調点のみアクセント色。\"\n  NG事項:\n    - \"過剰なドロップシャドウ禁止\"\n    - \"装飾枠の多用禁止\"\n    - \"グラデーション多用禁止\"\n\nレイアウト・バリエーション（カタログ）:\n  - タイプ: \"表紙\"\n    デザイン: \"余白大。タイトルは左寄せで大きく、サブタイトルは小さく。薄い横罫線を1本。\"\n  - タイプ: \"章扉\"\n    デザイン: \"章タイトルを大きく。背景は単色でミニマル。\"\n  - タイプ: \"結論（TL;DR）\"\n    デザイン: \"結論3点 + 大きな数字/指標を1つ。\"\n  - タイプ: \"2カラム（課題 vs 解決）\"\n    デザイン: \"縦線で2分割。左:課題、右:解決。見出し太字、本文細字。\"\n  - タイプ: \"データ/チャート\"\n    デザイン: \"棒/折れ線のシンプル表現。注釈は短く。\"\n  - タイプ: \"プロセス\"\n    デザイン: \"水平ステップ（01-05）。丸アイコンは最小。\"\n  - タイプ: \"タイムライン\"\n    デザイン: \"縦線 + 年号大 + 説明小。\"\n  - タイプ: \"まとめ\"\n    デザイン: \"次アクションを3点。チェックリスト風に簡潔に。\"\n```\n\n### 案B（エディトリアル/ストーリー）\n\n（必要に応じて、目的/読者/写真比率に合わせて微調整する）\n\n```yaml\n# presentation_design_spec_editorial_story_jp.yaml\n# スタイル: モダン・エディトリアル / ライフスタイル雑誌風\n# 目的: 余白と写真でストーリーを語る（情緒/説得）\n\n全体デザイン設定:\n  トーン: \"穏やか、知的、情緒的、オーガニック、洗練\"\n  ビジュアル・アイデンティティ:\n    背景色: \"#F3F0EB (サンドベージュ) または #EBEBEB (ウォームグレー)\"\n    文字色: \"#333333 (チャコール) - 真っ黒は避ける\"\n    アクセントカラー: \"#E07A5F (テラコッタ) または #708D81 (オリーブ)\"\n    画像スタイル:\n      特徴: \"自然光、フィルム粒子、彩度低め\"\n      形状: \"角丸長方形 または アーチ型\"\n  タイポグラフィ:\n    見出し: \"上品な明朝/セリフ体。重要語は控えめに強調。\"\n    本文: \"読みやすいゴシック/サンセリフで小さめ。\"\n    数字: \"セリフ数字で落ち着きを出す。\"\n  共通レイアウト・ルール:\n    余白: \"余白を最優先。文字密度を下げる。\"\n    写真: \"1スライド1枚の大きい写真を基本。\"\n    罫線: \"枠線は禁止。区切りは余白か極細線のみ。\"\n  デザインルール:\n    - \"寒色・ネオンは禁止（温かいトーンで統一）\"\n    - \"過剰なアイコンは禁止（写真とタイポで語る）\"\n\nレイアウト・バリエーション（カタログ）:\n  - タイプ: \"表紙（雑誌カバー）\"\n    デザイン: \"右に写真フルブリード、左にタイトル。細い横罫線で区切る。\"\n  - タイプ: \"引用（Quote）\"\n    デザイン: \"短いメッセージを中央。背景に大きな引用符を薄く。\"\n  - タイプ: \"ストーリー（1→2→3）\"\n    デザイン: \"縦ステップ。点線で接続。各ステップ横に小さな丸写真。\"\n  - タイプ: \"比較\"\n    デザイン: \"左右2枚写真 + 各キャプション。色は抑えめ。\"\n  - タイプ: \"データ\"\n    デザイン: \"極細折れ線 + 説明文段落で補足（物語を添える）。\"\n  - タイプ: \"まとめ\"\n    デザイン: \"次アクションを3点。余白を残して締める。\"\n```\n\n\n",
        "opencode/skills/docs/references/notebooklm-yaml.md": "---\nname: notebooklm-yaml\ndescription: \"NotebookLMの「スライド資料をカスタマイズ」で使うデザインYAMLを2案生成。プレゼン資料を作りたい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\"]\n---\n\n# NotebookLM YAML Skill\n\nNotebookLM のスライド生成で、デザインの方向性をYAMLでコントロールするためのスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「NotebookLMのスライドをいい感じのデザインで作りたい」\n- 「プレゼン用のYAMLを作って」\n- 「スライドデザインを2案出して」\n\n---\n\n## ヒアリング項目\n\n1. 目的（社内共有/営業/採用/投資家向け）\n2. 想定読者（経営/開発/非エンジニア）\n3. トーン（信頼感/革新/親しみ）\n4. ブランド要素（ロゴ/ブランドカラー/フォント指定）\n5. 写真/図表の比率（写真多め/データ多め）\n\n---\n\n## 出力\n\n- **案A**: ミニマル/コーポレート（可読性・信頼感・データ重視）\n- **案B**: エディトリアル/ストーリー（余白・写真・情緒重視）\n",
        "opencode/skills/harness-review/SKILL.md": "---\nname: harness-review\ndescription: \"Multi-perspective review supporting code, plan, and scope analysis. Auto-detects review type from context. Use when user mentions reviews, code review, plan review, scope analysis, security, performance, quality checks, PRs, diffs, or change review. Do NOT load for: implementation work, new feature development, bug fixes, or setup.\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\", \"Bash\", \"Task\"]\ncontext: fork\n---\n\n# Review Skills\n\nコードレビュー、計画レビュー、スコープ分析を担当するスキル群です。\nコンテキストからレビュータイプを自動判定します。\n\n## レビュータイプ（Context-Aware）\n\nレビュータイプはコンテキストから自動判定されます：\n\n| Recent Activity | Review Type | 4 Experts |\n|-----------------|-------------|-----------|\n| `/plan-with-agent` 後 | **Plan Review** | Clarity, Feasibility, Dependencies, Acceptance |\n| `/work` 後 | **Code Review** | Security, Performance, Quality, Accessibility |\n| タスク追加後 | **Scope Review** | Scope-creep, Priority, Feasibility, Impact |\n\n### 手動指定\n\n```bash\n/harness-review           # 自動判定\n/harness-review code      # コードレビュー強制\n/harness-review plan      # 計画レビュー強制\n/harness-review scope     # スコープ分析強制\n```\n\n---\n\n## 機能詳細（Code Review）\n\n| 機能 | 詳細 |\n|------|------|\n| **変更レビュー** | See [references/changes-review.md](references/changes-review.md) |\n| **品質チェック** | See [references/quality-review.md](references/quality-review.md) |\n| **セキュリティ** | See [references/security-review.md](references/security-review.md) |\n| **パフォーマンス** | See [references/performance-review.md](references/performance-review.md) |\n| **アクセシビリティ** | See [references/accessibility-review.md](references/accessibility-review.md) |\n| **SEO/OGP** | See [references/seo-review.md](references/seo-review.md) |\n| **Codex 統合** | See [references/codex-integration.md](references/codex-integration.md) |\n| **コミット判定** | See [references/commit-judgment-logic.md](references/commit-judgment-logic.md) |\n\n## 機能詳細（Plan/Scope Review）\n\nPlan Review と Scope Review は Codex エキスパートを使用します：\n\n| レビュータイプ | エキスパート | 参照 |\n|--------------|-------------|------|\n| **Plan Review** | Clarity, Feasibility, Dependencies, Acceptance | `../codex-review/references/experts/clarity-expert.md` 等 |\n| **Scope Review** | Scope-creep, Priority, Feasibility, Impact | `../codex-review/references/experts/scope-creep-expert.md` 等 |\n\n詳細: [../codex-review/references/codex-parallel-review.md](../codex-review/references/codex-parallel-review.md)\n\n## 実行手順\n\n1. **品質判定ゲート**（Step 0）\n2. **残コンテキスト確認（Codex モード時）**（Step 1）\n3. ユーザーのリクエストを分類\n4. **（Claude-mem 有効時）過去のレビュー指摘を検索**\n5. 並列実行の判定（下記参照）\n6. 上記の「機能詳細」から適切な参照ファイルを読む、または並列サブエージェント起動\n7. 結果を統合してレビュー完了\n\n### 入力の優先順位\n\n- `files` が渡されている場合は **そのファイルのみ** を対象にレビューする\n- `files` が渡されていない場合は `git_diff` から変更箇所を推定する\n- `context_from: code_content` が渡されている場合は **その内容を優先** してレビューする\n\n### Step 0: 品質判定ゲート（レビュー重点領域の特定）\n\nレビュー開始前に変更内容を分析し、重点領域を特定:\n\n```\n変更ファイル分析\n    ↓\n┌─────────────────────────────────────────┐\n│           品質判定ゲート                 │\n├─────────────────────────────────────────┤\n│  判定項目:                              │\n│  ├── カバレッジ不足？（テストなし）     │\n│  ├── セキュリティ注意？（auth/api/）    │\n│  ├── a11y 注意？（UI コンポーネント）   │\n│  └── パフォーマンス注意？（DB/ループ）  │\n└─────────────────────────────────────────┘\n          ↓\n    重点レビュー領域を決定\n```\n\n#### カバレッジ判定\n\n| 状況 | 指摘内容 |\n|------|---------|\n| 新規ファイルにテストなし | 「テストが不足しています」 |\n| 変更ファイルのテストが古い | 「テストの更新を検討してください」 |\n| カバレッジ < 60% | 「カバレッジ向上を推奨」 |\n\n#### セキュリティ重点レビュー\n\n| パス | 追加チェック項目 |\n|------|-----------------|\n| auth/, api/ | OWASP Top 10 チェックリスト |\n| 入力処理 | サニタイズ、バリデーション |\n| DB クエリ | パラメータ化確認 |\n\n#### a11y 重点レビュー\n\n| パス | チェック項目 |\n|------|------------|\n| src/components/ | alt, aria, キーボード操作 |\n| src/pages/ | 見出し構造, フォーカス管理 |\n\n#### パフォーマンス重点レビュー\n\n| パターン | 警告内容 |\n|---------|---------|\n| ループ内 DB クエリ | N+1 クエリの可能性 |\n| 大規模データ処理 | ページネーション検討 |\n| useEffect 乱用 | レンダリング最適化 |\n\n#### SEO/OGP 重点レビュー\n\n| パス | チェック項目 |\n|------|------------|\n| src/pages/, app/ | title, description, canonical |\n| public/ | robots.txt, sitemap.xml, OGP 画像 |\n| layout.tsx, _document.tsx | viewport, OGP タグ, Twitter Card |\n\n#### クロスプラットフォーム重点レビュー\n\n| パス | チェック項目 |\n|------|------------|\n| src/components/, app/ | レスポンシブ（固定幅チェック） |\n| *.css, *.scss, tailwind | 100vw 使用、overflow 設定 |\n| public/ | favicon, apple-touch-icon |\n\n#### 重点レビュー統合出力\n\n```markdown\n📊 品質判定結果 → 重点レビュー領域\n\n| 判定 | 該当 | 対象ファイル |\n|------|------|-------------|\n| セキュリティ | ⚠️ | src/api/auth.ts |\n| カバレッジ | ⚠️ | src/utils/helpers.ts (テストなし) |\n| a11y | ✅ | - |\n| パフォーマンス | ✅ | - |\n| SEO/OGP | ⚠️ | app/layout.tsx (OGP 未設定) |\n| クロスプラットフォーム | ✅ | - |\n\n→ セキュリティ・カバレッジ・SEO を重点的にレビュー\n```\n\n#### LSP ベースの影響分析（推奨）\n\n変更レビュー時に LSP ツールで影響範囲を確認:\n\n| 変更タイプ | LSP 操作 | 確認内容 |\n|-----------|---------|---------|\n| 関数シグネチャ変更 | findReferences | 全呼び出し元が対応済みか |\n| 型定義変更 | findReferences | 使用箇所での型互換性 |\n| API 変更 | incomingCalls | 影響を受けるエンドポイント |\n\n**レビューフロー**:\n1. 変更ファイルを特定\n2. `LSP.findReferences` で影響範囲を列挙\n3. 影響を受けるファイルも含めてレビュー\n\n**使用例**:\n```\n# 1. 変更された関数の参照箇所を確認\nLSP operation=findReferences filePath=\"src/api/user.ts\" line=42 character=15\n\n# 2. 関数の呼び出し階層を確認\nLSP operation=incomingCalls filePath=\"src/api/user.ts\" line=42 character=15\n\n# 3. 型定義の使用箇所を確認\nLSP operation=findReferences filePath=\"src/types/api.ts\" line=10 character=12\n```\n\n**出力例**:\n```markdown\n🔍 LSP 影響分析結果\n\n変更: updateUserProfile() のシグネチャ変更\n\n影響を受ける箇所:\n├── src/pages/profile.tsx:89 ⚠️ 引数更新必要\n├── src/pages/settings.tsx:145 ⚠️ 引数更新必要\n├── tests/user.test.ts:67 ✅ 更新済み\n└── src/api/admin.ts:23 ⚠️ 引数更新必要\n\n→ 3箇所で引数の更新が必要\n```\n\n> **注**: LSP サーバーが設定されている言語でのみ動作します。\n\n### Step 1: 残コンテキスト確認（Codex モード時）\n\nCodex モード（`review.mode: codex`）の場合は、**残コンテキストが 30%以下なら /compact を先に実行**してください。\n\n> **注意**: /compact 後も余裕が少ない場合は縮退せず続行します。\n\n### Step 2: 過去のレビュー指摘検索（Memory-Enhanced）\n\nClaude-mem が有効な場合、レビュー開始前に過去の類似指摘を検索:\n\n```\n# mem-search で過去のレビュー指摘を検索\nmem-search: type:review \"{変更ファイルのパターン}\"\nmem-search: concepts:security \"{セキュリティ関連のキーワード}\"\nmem-search: concepts:gotcha \"{変更箇所に関連するキーワード}\"\n```\n\n**表示例**:\n\n```markdown\n📚 過去のレビュー指摘（関連あり）\n\n| 日付 | 指摘内容 | ファイル |\n|------|---------|---------|\n| 2024-01-15 | XSS脆弱性: innerHTML 使用禁止 | src/components/*.tsx |\n| 2024-01-20 | N+1クエリ: prefetch 必須 | src/api/*.ts |\n\n💡 今回のレビューで上記パターンを重点チェック\n```\n\n> **注**: Claude-mem が未設定の場合、このステップはスキップされます。\n\n## レビューモードの選択\n\nレビュースキルは 2 つのモードで動作します:\n\n```\n設定確認: .claude-code-harness.config.yaml\n    ↓\n├── review.mode: default → Claude 単体レビュー\n└── review.mode: codex   → Codex 並列レビュー（レビュータイプごとに4エキスパート）\n```\n\n### Default モード（Claude 単体）\n\nClaude が直接レビューを実行。小〜中規模の変更に最適。\n\n### Codex モード（並列エキスパート）\n\nCodex MCP 経由で**レビュータイプに応じた4つのエキスパート**を **個別に並列呼び出し**:\n\n| Review Type | エキスパート |\n|-------------|-------------|\n| **Code Review** | Security, Performance, Quality, Accessibility |\n| **Plan Review** | Clarity, Feasibility, Dependencies, Acceptance |\n| **Scope Review** | Scope-creep, Priority, Feasibility, Impact |\n\n#### ⚠️ Codex モード実行時の必須ルール\n\n**絶対に1回の MCP 呼び出しで複数エキスパートをまとめないこと。**\n\n```\n✅ 正しい: 4回の MCP 呼び出しを1つのレスポンス内で並列実行\n❌ 間違い: 1回の呼び出しで「全観点をレビューして」と依頼\n```\n\n**実行手順**:\n1. **呼び出すエキスパートを判定**（全部ではなく必要なもののみ）:\n   - 設定で `enabled: false` → 除外\n   - CLI/バックエンド → Accessibility, SEO 除外\n   - ドキュメントのみ変更 → Quality, Architect, Plan Reviewer, Scope Analyst を優先（Security, Performance は除外可）\n2. 有効なエキスパートの `experts/*.md` からプロンプトを **個別に読み込む**\n3. 有効なエキスパートのみ `mcp__codex__codex` を **1つのレスポンス内で並列実行**\n4. 各結果を統合して判定\n\n**詳細**: [codex-review/references/codex-parallel-review.md](../codex-review/references/codex-parallel-review.md)\n\n**Codex モード有効化**:\n```bash\n/codex-mode on\n```\n\n**詳細**: [references/codex-integration.md](references/codex-integration.md)\n\n---\n\n## 並列サブエージェント起動（Default モード）\n\n以下の条件を**両方**満たす場合、Task tool で code-reviewer を並列起動:\n\n- レビュー観点 >= 2（例: セキュリティ + パフォーマンス）\n- 変更ファイル >= 5\n\n**起動パターン（1つのレスポンス内で複数の Task tool を同時呼び出し）:**\n\n```\nTask tool 並列呼び出し:\n  #1: subagent_type=\"code-reviewer\"\n      prompt=\"セキュリティ観点でレビュー: {files}\"\n  #2: subagent_type=\"code-reviewer\"\n      prompt=\"パフォーマンス観点でレビュー: {files}\"\n  #3: subagent_type=\"code-reviewer\"\n      prompt=\"コード品質観点でレビュー: {files}\"\n```\n\n**小規模な場合（条件を満たさない）:**\n- 子スキル（doc.md）を順次読み込んで直列実行\n\n---\n\n## 🔧 MCP Code Intelligence ツールの活用\n\nレビューでは MCP ツール（AST-Grep, LSP）を活用して精度を向上します。\n\n> **重要**: `/dev-tools-setup` で MCP サーバーが設定されている場合、標準ツール（Grep, Read）ではなく **MCP ツールを優先使用**してください。MCP ツールは構造的な検索が可能で、より正確な結果を得られます。\n\n### AST-Grep MCP ツール（harness_ast_search）\n\n**構造的なコードパターン検索**に使用します。正規表現ベースの Grep より精度が高く、コードスメル検出に最適です。\n\n| 検出パターン | AST-Grep パターン | 用途 |\n|-------------|------------------|------|\n| Debug logs | `console.log($$$)` | リリース前の残留ログ検出 |\n| Empty catch | `catch ($ERR) { }` | エラー握りつぶし検出 |\n| Unused async | `async function $NAME($$$) { $BODY }` | await なし async 検出 |\n| Magic numbers | 数値リテラル検索 | ハードコード定数検出 |\n\n**使用例**:\n```\nharness_ast_search pattern=\"console.log($$$)\" language=\"typescript\" path=\"src/\"\nharness_ast_search pattern=\"catch ($ERR) { }\" language=\"typescript\" path=\"src/\"\n```\n\n**出力例**:\n```markdown\n🔍 AST-Grep Code Smell Scan\n\nPatterns checked:\n- console.log($$$) → Debug logs\n- catch ($ERR) { } → Empty catch blocks\n\nResults:\n├── 3x console.log found (src/api/*.ts)\n├── 1x empty catch block (src/utils/error.ts:45)\n└── 0x unused async\n```\n\n> **注**: `harness_ast_search` が利用できない場合は、`sg` コマンド（Bash）または Grep にフォールバックします。\n\n---\n\n## 🔧 LSP 機能の活用\n\nレビューでは LSP（Language Server Protocol）を活用して精度を向上します。\n\n> **MCP 版優先**: `harness_lsp_*` MCP ツールが利用可能な場合は、標準 LSP ツールより優先して使用してください。\n\n### LSP をレビューに統合\n\n| レビュー観点 | LSP 活用方法 |\n|-------------|-------------|\n| **品質** | Diagnostics で型エラー・未使用変数を自動検出 |\n| **セキュリティ** | Find-references で機密データの流れを追跡 |\n| **パフォーマンス** | Go-to-definition で重い処理の実装を確認 |\n\n### LSP Diagnostics の出力例\n\n```\n📊 LSP 診断結果\n\n| ファイル | エラー | 警告 |\n|---------|--------|------|\n| src/components/Form.tsx | 0 | 2 |\n| src/utils/api.ts | 1 | 0 |\n\n⚠️ 1件のエラーを検出\n→ レビューで指摘事項に追加\n```\n\n### Find-references による影響分析\n\n```\n🔍 変更影響分析\n\n変更: validateInput()\n\n参照箇所:\n├── src/pages/signup.tsx:34\n├── src/pages/settings.tsx:56\n└── tests/validate.test.ts:12\n\n→ テストでカバー済み ✅\n```\n\n詳細: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n\n---\n\n## VibeCoder 向け\n\n```markdown\n📝 コードチェックを依頼するときの言い方\n\n1. **「チェックして」**\n   - 全体的に問題がないか見てもらう\n\n2. **「セキュリティ大丈夫？」**\n   - 悪意ある攻撃に耐えられるかチェック\n\n3. **「遅くない？」**\n   - 速度に問題がないかチェック\n\n4. **「誰でも使える？」**\n   - 障害のある方でも使えるかチェック\n\n💡 ヒント: 「全部チェックして」と言えば、\n4つの観点すべてを自動で確認します\n```\n",
        "opencode/skills/harness-review/references/accessibility-review.md": "---\nname: review-accessibility\ndescription: \"Webアクセシビリティ（a11y）をチェックするスキル。Webアプリケーションのアクセシビリティレビューが要求された場合に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Bash\"]\n---\n\n# Review Accessibility\n\nWeb アクセシビリティ（a11y）をチェックし、WCAG ガイドラインへの準拠を確認するスキル。\n\n---\n\n## 目的\n\n以下のアクセシビリティ問題を検出：\n- セマンティック HTML の使用\n- ARIA 属性の適切な使用\n- キーボード操作対応\n- 色コントラスト\n- スクリーンリーダー対応\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `files` | チェック対象ファイルのリスト |\n| `tech_stack` | フレームワーク（React, Vue など） |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `a11y_issues` | 検出された問題のリスト |\n| `a11y_score` | アクセシビリティスコア (A-F) |\n\n---\n\n## チェック項目\n\n### 1. セマンティック HTML\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| 見出し構造 | h1 → h3 のスキップ | 正しい順序に修正 |\n| ランドマーク | `<div>` のみの使用 | `<nav>`, `<main>`, `<aside>` 使用 |\n| リスト構造 | 手動でのリスト作成 | `<ul>`, `<ol>` 使用 |\n| ボタン | `<div onclick>` | `<button>` 使用 |\n\n### 2. 画像とメディア\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| alt 属性 | 欠落または空 | 意味のある説明を追加 |\n| 装飾画像 | alt に説明 | `alt=\"\"` または `aria-hidden` |\n| 動画 | 字幕なし | キャプション追加 |\n\n### 3. フォーム\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| ラベル | `<label>` 欠落 | `<label for=\"id\">` 追加 |\n| エラーメッセージ | 色のみで表示 | テキストでも表示 |\n| 必須フィールド | 視覚的のみ | `aria-required` 追加 |\n\n### 4. キーボード操作\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| フォーカス管理 | フォーカス不可要素 | `tabindex=\"0\"` 追加 |\n| フォーカス表示 | `outline: none` のみ | 代替スタイル追加 |\n| キーボードトラップ | モーダルからの脱出不可 | ESC キー対応 |\n\n### 5. ARIA\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| 冗長な ARIA | `<button role=\"button\">` | 不要な role 削除 |\n| 無効な ARIA | 存在しない ID 参照 | 正しい ID に修正 |\n| 動的コンテンツ | 変更の通知なし | `aria-live` 追加 |\n\n---\n\n## スコアリング\n\n| スコア | 基準 |\n|--------|------|\n| A | WCAG 2.1 AA 準拠 |\n| B | 軽微な問題のみ |\n| C | 中程度の問題あり |\n| D | 重大なアクセシビリティ問題 |\n| F | 基本的なアクセシビリティ欠如 |\n\n---\n\n## 出力例\n\n```markdown\n## アクセシビリティレビュー結果\n\n**スコア**: C\n\n### 検出された問題\n\n| 重大度 | ファイル | 行 | 問題 | WCAG |\n|--------|---------|-----|------|------|\n| 高 | src/components/Button.tsx | 12 | div を button として使用 | 4.1.2 |\n| 中 | src/components/Image.tsx | 8 | alt 属性が空 | 1.1.1 |\n| 低 | src/components/Modal.tsx | 45 | ESC キーでの閉じる未対応 | 2.1.2 |\n\n### 推奨改善\n\n1. **セマンティックなボタン**\n   ```tsx\n   // Before\n   <div onClick={handleClick} className=\"button\">Click</div>\n\n   // After\n   <button onClick={handleClick} className=\"button\">Click</button>\n   ```\n\n2. **画像の alt 属性**\n   ```tsx\n   // Before\n   <img src={user.avatar} />\n\n   // After\n   <img src={user.avatar} alt={`${user.name}のアバター`} />\n   ```\n```\n\n---\n\n## 注意事項\n\n- WCAG 2.1 AA を基準とする\n- 技術スタック（React/Vue）に応じたチェック\n- 自動チェックで検出できない問題は手動確認を推奨\n",
        "opencode/skills/harness-review/references/changes-review.md": "---\nname: review-changes\ndescription: \"自分の変更をセルフレビューし、改善提案を出す。コード変更後のセルフレビューが必要な場合に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Bash\"]\n---\n\n# Review Changes\n\n実装した変更をセルフレビューし、品質を確認するスキル。\nコミット前やハンドオフ前に使用します。\n\n---\n\n## 入力\n\n- **変更ファイル**: git diff で特定された変更\n- **リポジトリコンテキスト**: コーディング規約、既存パターン\n\n---\n\n## 出力\n\n- **レビュー結果**: 各観点での評価\n- **改善提案**: 問題がある場合の修正提案\n\n---\n\n## レビュー観点\n\n### 1. セキュリティ 🔒\n\n- [ ] 機密情報（API キー等）がハードコードされていない\n- [ ] 入力値のバリデーションが適切\n- [ ] SQL インジェクション対策\n- [ ] XSS 対策\n\n### 2. パフォーマンス ⚡\n\n- [ ] 不要な再レンダリングがない\n- [ ] N+1 クエリがない\n- [ ] 重い計算がメモ化されている\n\n### 3. コード品質 📐\n\n- [ ] 型が適切に定義されている\n- [ ] エラーハンドリングがある\n- [ ] 命名が適切\n- [ ] 不要なコード・コメントがない\n\n### 4. 一貫性 🎨\n\n- [ ] 既存のコーディングスタイルに従っている\n- [ ] ファイル構成が適切\n- [ ] import の順序が統一されている\n\n---\n\n## 実行手順\n\n### Step 1: 変更の確認\n\n```bash\n# 変更ファイル一覧\ngit diff --name-only HEAD~5\n\n# 変更内容\ngit diff\n```\n\n### Step 2: 各観点でのチェック\n\n#### セキュリティチェック\n\n```bash\n# ハードコードされた機密情報を探す\ngrep -rn \"sk-\\|api_key\\|password\\|secret\" --include=\"*.ts\" --include=\"*.tsx\" | grep -v \".env\"\n```\n\n#### パフォーマンスチェック\n\n```typescript\n// 問題のパターンを探す\n// - useEffect の依存配列の問題\n// - 毎レンダリングで新しいオブジェクト生成\n// - 巨大な配列の filter/map チェーン\n```\n\n#### コード品質チェック\n\n```bash\n# TypeScript エラー\nnpx tsc --noEmit\n\n# ESLint\nnpx eslint src/ --ext .ts,.tsx\n```\n\n### Step 3: レビュー結果の生成\n\n```markdown\n## 📊 セルフレビュー結果\n\n**対象**: {{変更ファイル数}} ファイル\n**総合評価**: {{A / B / C}}\n\n### 観点別評価\n\n| 観点 | 評価 | 備考 |\n|------|------|------|\n| セキュリティ | ✅ OK | - |\n| パフォーマンス | ⚠️ 要確認 | {{詳細}} |\n| コード品質 | ✅ OK | - |\n| 一貫性 | ✅ OK | - |\n\n### 改善が必要な箇所\n\n1. **{{ファイル:行}}**\n   - 問題: {{問題の説明}}\n   - 改善案: {{具体的な修正方法}}\n\n### 自動修正可能な項目\n\n- [ ] ESLint の自動修正\n- [ ] Prettier の適用\n```\n\n### Step 4: 改善の適用（任意）\n\n```bash\n# ESLint 自動修正\nnpx eslint --fix src/\n\n# Prettier 適用\nnpx prettier --write src/\n```\n\n---\n\n## 評価基準\n\n| 評価 | 意味 | アクション |\n|------|------|-----------|\n| A | 問題なし | コミット可能 |\n| B | 軽微な問題あり | 修正推奨だが続行可 |\n| C | 重大な問題あり | 修正必須 |\n\n---\n\n## よくある問題と修正\n\n### any 型の使用\n\n```typescript\n// ❌ 問題\nfunction process(data: any) { ... }\n\n// ✅ 修正\ninterface DataType { ... }\nfunction process(data: DataType) { ... }\n```\n\n### 未処理の Promise\n\n```typescript\n// ❌ 問題\nfetchData()\n\n// ✅ 修正\nfetchData().catch(console.error)\n// または\nawait fetchData()\n```\n\n### 不要な再レンダリング\n\n```typescript\n// ❌ 問題\nconst items = data.filter(x => x.active).map(x => x.name)\n\n// ✅ 修正\nconst items = useMemo(() =>\n  data.filter(x => x.active).map(x => x.name),\n  [data]\n)\n```\n\n---\n\n## 完了後のアクション\n\n```markdown\n## ✅ セルフレビュー完了\n\n**評価**: {{A / B / C}}\n\n{{問題なしの場合}}\nコミットの準備ができました。\n「コミットして」と言ってください。\n\n{{問題ありの場合}}\n上記の改善を適用しますか？\n```\n\n---\n\n## 注意事項\n\n- **完璧を目指さない**: 80% で十分\n- **自動ツールを活用**: 手動チェックは最小限に\n- **レビューは任意**: スキップしてコミットも可能\n",
        "opencode/skills/harness-review/references/codex-integration.md": "---\nname: codex-integration\ndescription: \"レビュースキルへの Codex セカンドオピニオン統合手順\"\nallowed-tools: [\"Read\", \"Bash\"]\n---\n\n# Codex 統合レビュー\n\n既存のレビューフローに Codex のセカンドオピニオンを統合する手順。\n\n---\n\n## 🎯 概要\n\nCodex MCP が有効な場合、Claude のレビューに加えて Codex からもレビューを取得し、結果を統合して表示します。\n\n```\n/harness-review 実行\n    ↓\n設定確認: review.codex.enabled\n    │\n    ├── false → Claude 単独レビュー（従来通り）\n    │\n    └── true → Codex 統合レビュー\n            │\n            ├── Claude レビュー（並列）\n            └── Codex MCP 呼び出し（並列）\n                    ↓\n            結果統合 → 出力\n```\n\n---\n\n## 実行フロー\n\n### Step 1: 設定確認\n\n`.claude-code-harness.config.yaml` を確認:\n\n```yaml\nreview:\n  codex:\n    enabled: true   # これが true の場合のみ Codex 統合\n    auto: false     # false の場合は確認を求める\n```\n\n### Step 2: 確認プロンプト（auto: false の場合）\n\n```markdown\n🤖 Codex セカンドオピニオン\n\nCodex にもレビューを依頼しますか？\n- Claude と Codex の両方でレビューし、結果を統合します\n- 追加で数秒〜数十秒かかります\n\n[Y] はい / [N] いいえ\n```\n\n### Step 3: 並列レビュー実行\n\n**Claude レビュー（従来通り）**:\n- 品質判定ゲート\n- 変更ファイル分析\n- 重点領域のレビュー\n\n**Codex MCP 呼び出し（並列）**:\n```\nMCP 呼び出し: mcp__codex__*\n    prompt: \"{設定ファイルのプロンプト}\"\n    files: \"{変更ファイル一覧}\"\n```\n\n### Step 4: 結果統合\n\n両方のレビュー結果を統合して表示:\n\n```markdown\n## 📊 統合レビュー結果\n\n### Claude のレビュー\n\n| 観点 | 指摘数 | 重要度 |\n|------|--------|--------|\n| セキュリティ | 1 | 高 |\n| 品質 | 3 | 中 |\n| パフォーマンス | 0 | - |\n\n**主な指摘**:\n1. [高] SQL インジェクションの可能性 (src/api/users.ts:45)\n2. [中] 未使用の import (src/components/Form.tsx:3)\n3. ...\n\n---\n\n### Codex のレビュー（セカンドオピニオン）\n\n| 観点 | 指摘数 |\n|------|--------|\n| コードスタイル | 2 |\n| 設計パターン | 1 |\n\n**主な指摘**:\n1. 関数が長すぎる（50行超）→ 分割を推奨\n2. 命名規則の不統一（camelCase と snake_case の混在）\n3. Strategy パターンの適用を検討\n\n---\n\n### 統合サマリ\n\n| 観点 | Claude | Codex | アクション |\n|------|--------|-------|-----------|\n| セキュリティ | ⚠️ 1件 | - | **対応必須** |\n| コードスタイル | - | 2件 | 推奨 |\n| 設計 | - | 1件 | 検討 |\n| 品質 | 3件 | - | 推奨 |\n```\n\n---\n\n## フォールバック処理\n\n### Codex MCP エラー時\n\n```markdown\n⚠️ Codex レビューがスキップされました\n\n理由: MCP 接続エラー\n詳細: Connection timeout after 30s\n\nClaude のレビュー結果のみを表示します。\n```\n\n**対応**:\n1. Claude のレビュー結果はそのまま表示\n2. エラーをログに記録\n3. 次回実行時の参考情報を表示\n\n### Codex 認証切れ\n\n```markdown\n⚠️ Codex 認証が必要です\n\n以下のコマンドで再認証してください:\n\\`\\`\\`bash\ncodex login\n\\`\\`\\`\n```\n\n---\n\n## パフォーマンス考慮\n\n### 大規模変更時\n\n変更ファイルが多い場合（10ファイル超）:\n\n1. **チャンク分割**: 5ファイルずつに分割して Codex に送信\n2. **優先度付け**: 変更行数の多いファイルを優先\n3. **タイムアウト**: 60秒でタイムアウト、部分結果を表示\n\n### 並列実行の最適化\n\n```\nClaude レビュー ─────┐\n                     ├──→ 結果統合\nCodex MCP 呼び出し ─┘\n\n最大待機時間: max(Claude, Codex) ≈ Codex 待機時間\n```\n\n---\n\n## VibeCoder 向け\n\n```markdown\n💡 セカンドオピニオンの使い方\n\n**言い方**:\n- 「他の AI にも見てもらって」\n- 「Codex にもチェックさせて」\n- 「ダブルチェックして」\n\n**結果の見方**:\n- Claude と Codex で同じ指摘 → 確実に対応が必要\n- 片方だけの指摘 → 内容を確認して判断\n- 矛盾する指摘 → 両方の理由を確認\n```\n\n---\n\n## 関連ドキュメント\n\n- [codex-review/SKILL.md](../../codex-review/SKILL.md) - Codex 統合スキル\n- [codex-mcp-setup.md](../../codex-review/references/codex-mcp-setup.md) - セットアップ手順\n",
        "opencode/skills/harness-review/references/commit-judgment-logic.md": "# コミット判定ロジック\n\nharness-review の最終判定（APPROVE / REQUEST CHANGES / REJECT）を出力するためのロジック。\n\n## 判定基準\n\n| 判定 | 条件 | 次のアクション |\n|------|------|---------------|\n| **APPROVE** | Critical: 0, High: 0, Medium: ≤3 | コミット OK |\n| **REQUEST CHANGES** | Critical: 0, High: ≥1 または Medium: >3 | 自動修正 → 再判定 |\n| **REJECT** | Critical: ≥1 | 手動対応必要 |\n\n### Severity 定義\n\n| Severity | 定義 | 例 |\n|----------|------|-----|\n| **Critical** | セキュリティ脆弱性、データ損失リスク | SQL インジェクション、認証バイパス |\n| **High** | 重大なバグ、パフォーマンス問題 | 無限ループ、N+1 クエリ |\n| **Medium** | コード品質問題、ベストプラクティス違反 | 未使用変数、不適切な命名 |\n| **Low** | スタイル、軽微な改善提案 | フォーマット、コメント追加 |\n\n## 判定フロー\n\n```\nレビュー結果収集\n    ↓\nSeverity 集計\n    ├── Critical >= 1 → REJECT\n    ├── High >= 1 || Medium > 3 → REQUEST CHANGES\n    └── それ以外 → APPROVE\n    ↓\n判定出力\n```\n\n## 出力形式\n\n### APPROVE\n\n```markdown\n## 🚦 コミット判定: APPROVE ✅\n\n**判定理由**: 重大な問題なし\n\n| Severity | 件数 |\n|----------|------|\n| Critical | 0 |\n| High | 0 |\n| Medium | 2 |\n| Low | 5 |\n\n📝 **Low/Medium の指摘**（任意対応）:\n- [Medium] `src/utils/helpers.ts:45` - 未使用の import\n- [Medium] `src/components/Form.tsx:78` - any 型の使用\n\n**次のアクション**: `git commit` でコミット可能です\n```\n\n### REQUEST CHANGES\n\n```markdown\n## 🚦 コミット判定: REQUEST CHANGES 🟡\n\n**判定理由**: 修正可能な問題あり\n\n| Severity | 件数 |\n|----------|------|\n| Critical | 0 |\n| High | 2 |\n| Medium | 4 |\n| Low | 3 |\n\n📝 **修正が必要な項目**:\n\n| # | Severity | ファイル | 内容 | 修正案 |\n|---|----------|---------|------|--------|\n| 1 | High | `src/api/users.ts:34` | N+1 クエリ | `include` で事前取得 |\n| 2 | High | `src/pages/login.tsx:56` | XSS 脆弱性 | `sanitize()` を追加 |\n\n**自動修正を実行しますか？** [Y/N]\n\n> 自動修正後、再度レビューを実行して判定します（最大3回）\n```\n\n### REJECT\n\n```markdown\n## 🚦 コミット判定: REJECT ❌\n\n**判定理由**: 重大なセキュリティ問題\n\n| Severity | 件数 |\n|----------|------|\n| Critical | 1 |\n| High | 3 |\n| Medium | 2 |\n| Low | 1 |\n\n🚨 **Critical な問題**:\n\n| # | ファイル | 内容 | 影響 |\n|---|---------|------|------|\n| 1 | `src/api/auth.ts:45` | SQL インジェクション | データ漏洩リスク |\n\n**手動対応が必要です**:\n1. 上記の Critical 問題を修正\n2. 再度 `/harness-review` を実行\n\n> ⚠️ 自動修正は Critical 問題には対応しません（安全のため）\n```\n\n## 自動修正ループ\n\nREQUEST CHANGES 判定時の自動修正フロー:\n\n```\nREQUEST CHANGES 判定\n    ↓\n修正案を生成\n    ↓\nClaude が修正実行\n    ↓\n再度レビュー → 判定\n    │\n    ├── APPROVE → 完了\n    ├── REQUEST CHANGES → ループ（最大3回）\n    └── REJECT → 手動対応\n```\n\n### リトライ上限到達時\n\n```markdown\n## ⚠️ 自動修正上限に到達\n\n3回の自動修正を試みましたが、以下の問題が残っています:\n\n| # | Severity | ファイル | 内容 |\n|---|----------|---------|------|\n| 1 | High | `src/api/users.ts:34` | N+1 クエリ |\n\n**推奨アクション**:\n1. 手動で上記を修正\n2. 再度 `/harness-review` を実行\n\n> 💡 複雑な問題は自動修正が困難な場合があります\n```\n\n## Codex モードとの統合\n\nCodex モード時は、レビュータイプに応じた4つのエキスパートからの指摘を集約して判定:\n\n```\nCodex 並列レビュー（レビュータイプごとに4エキスパート）\n\nCode Review:\n    ├── Security Expert → findings[]\n    ├── Performance Expert → findings[]\n    ├── Quality Expert → findings[]\n    └── Accessibility Expert → findings[]\n\nPlan Review:\n    ├── Clarity Expert → findings[]\n    ├── Feasibility Expert → findings[]\n    ├── Dependencies Expert → findings[]\n    └── Acceptance Expert → findings[]\n\nScope Review:\n    ├── Scope-creep Expert → findings[]\n    ├── Priority Expert → findings[]\n    ├── Feasibility Expert → findings[]\n    └── Impact Expert → findings[]\n\n    ↓\n全 findings を Severity で集計\n    ↓\n判定基準に基づいて判定\n```\n\n## 設定による制御\n\n`.claude-code-harness.config.yaml`:\n\n```yaml\nreview:\n  judgment:\n    enabled: true      # 判定を出力するか\n    auto_fix: true     # REQUEST CHANGES 時に自動修正\n    max_retries: 3     # 自動修正の最大回数\n```\n\n## 関連ファイル\n\n- `skills/harness-review/SKILL.md` - レビュースキル本体\n- `skills/codex-review/references/codex-parallel-review.md` - Codex 並列呼び出し\n- `commands/optional/codex-mode.md` - Codex モード切り替え\n",
        "opencode/skills/harness-review/references/determine-review-mode.md": "---\nname: determine-review-mode\ndescription: \"Determine review mode (default/codex) from .claude-code-harness.config.yaml. Falls back to 'default' if Codex is not configured or enabled.\"\nallowed-tools: [\"Read\"]\n---\n\n# Determine Review Mode\n\n`.claude-code-harness.config.yaml`からレビューモードを決定し、Codex未設定時は`default`にフォールバックするスキル。\n\n---\n\n## 入力\n\n- **config_file**: 設定ファイルのコンテキスト（任意）\n\n---\n\n## 出力\n\n```json\n{\n  \"review_mode\": \"default\"\n}\n```\n\nまたは、Codexが有効な場合：\n\n```json\n{\n  \"review_mode\": \"codex\"\n}\n```\n\n---\n\n## 実行手順\n\n### Step 1: 設定ファイルの読み込み\n\n```bash\n# config_file が存在する場合は読み込む\n# 存在しない場合は default にフォールバック\n```\n\n### Step 2: レビューモードの確認\n\n設定ファイルの構造：\n\n```yaml\nreview:\n  mode: codex  # または \"default\"\n  codex:\n    enabled: true  # または false\n```\n\n### Step 3: 判定ロジック\n\n```javascript\n// 疑似コード例\nlet review_mode = \"default\";\n\n// 1. review.modeを確認\nif (config.review?.mode === \"codex\") {\n  // 2. review.codex.enabledを確認\n  if (config.review?.codex?.enabled === true) {\n    // 3. Codex MCPサーバーが利用可能か確認（オプション）\n    // ここでは設定ファイルの値のみを信頼\n    review_mode = \"codex\";\n  }\n}\n\n// デフォルトは \"default\"\nreturn { review_mode };\n```\n\n### Step 4: フォールバック条件\n\n以下の場合は`default`にフォールバック：\n\n1. `config_file` が存在しない\n2. `review.mode`が未設定または`default`\n3. `review.mode`が`codex`だが`review.codex.enabled`が`false`\n4. `review.codex.enabled`が未設定\n\n---\n\n## 使用例\n\n### 例1: Codex有効\n\n**設定ファイル**:\n```yaml\nreview:\n  mode: codex\n  codex:\n    enabled: true\n```\n\n**出力**:\n```json\n{\n  \"review_mode\": \"codex\"\n}\n```\n\n### 例2: Codex無効\n\n**設定ファイル**:\n```yaml\nreview:\n  mode: codex\n  codex:\n    enabled: false\n```\n\n**出力**:\n```json\n{\n  \"review_mode\": \"default\"\n}\n```\n\n### 例3: 設定ファイル未設定\n\n**設定ファイル**: 存在しない、または`review`セクションなし\n\n**出力**:\n```json\n{\n  \"review_mode\": \"default\"\n}\n```\n\n---\n\n## 注意事項\n\n- **安全側に倒す**: Codex設定が不明確な場合は`default`にフォールバック\n- **設定ファイルの優先**: 環境変数などではなく、設定ファイルの値を優先する\n- **MCPサーバー確認**: 実装時は`claude mcp list`でCodex MCPサーバーの存在も確認可能（オプション）\n",
        "opencode/skills/harness-review/references/performance-review.md": "---\nname: review-performance\ndescription: \"コードのパフォーマンス問題をチェックするスキル。パフォーマンスレビューが要求された場合、レスポンスが遅いと報告された場合、または大量のデータ処理を行うコードの変更時に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Review Performance\n\nコードのパフォーマンス問題を検出し、改善提案を行うスキル。\n\n---\n\n## 目的\n\n以下のパフォーマンス問題を検出：\n- 非効率なアルゴリズム\n- 不要な再レンダリング\n- N+1 クエリ問題\n- メモリリーク\n- 重い処理のブロッキング\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `files` | チェック対象ファイルのリスト |\n| `code_content` | ファイルの内容 |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `performance_issues` | 検出された問題のリスト |\n| `performance_score` | パフォーマンススコア (A-F) |\n\n---\n\n## チェック項目\n\n### 1. フロントエンド（React/Vue）\n\n| チェック | 問題 | 対策 |\n|---------|------|------|\n| 不要な再レンダリング | `useCallback`, `useMemo` 未使用 | メモ化の追加 |\n| 大きなリストの非仮想化 | 1000+ アイテムの直接レンダリング | 仮想スクロール導入 |\n| 重い計算の同期実行 | レンダリングブロック | Web Worker 使用 |\n| バンドルサイズ | 大きな依存関係のインポート | 動的インポート |\n\n### 2. バックエンド（API）\n\n| チェック | 問題 | 対策 |\n|---------|------|------|\n| N+1 クエリ | ループ内でのDBクエリ | Eager loading |\n| インデックス未使用 | 大量データのフルスキャン | インデックス追加 |\n| 同期I/O | ファイル操作のブロッキング | async/await 使用 |\n| キャッシュ未使用 | 頻繁な同一クエリ | Redis キャッシュ |\n\n### 3. 一般\n\n| チェック | 問題 | 対策 |\n|---------|------|------|\n| O(n²) アルゴリズム | ネストしたループ | より効率的なアルゴリズム |\n| 文字列連結 | ループ内での `+=` | 配列 + join |\n| 正規表現の非効率 | 毎回のコンパイル | 事前コンパイル |\n\n---\n\n## スコアリング\n\n| スコア | 基準 |\n|--------|------|\n| A | 問題なし、最適化済み |\n| B | 軽微な改善余地あり |\n| C | 中程度の問題あり |\n| D | 明らかなボトルネックあり |\n| F | 深刻なパフォーマンス問題 |\n\n---\n\n## 出力例\n\n```markdown\n## パフォーマンスレビュー結果\n\n**スコア**: C\n\n### 検出された問題\n\n| 重大度 | ファイル | 行 | 問題 |\n|--------|---------|-----|------|\n| 高 | src/api/posts.ts | 23 | N+1 クエリ問題 |\n| 中 | src/components/List.tsx | 45 | 1500件の非仮想化リスト |\n| 低 | src/utils/search.ts | 12 | O(n²) の検索アルゴリズム |\n\n### 推奨対策\n\n1. **N+1 クエリ問題**\n   ```typescript\n   // Before\n   for (const post of posts) {\n     const author = await getAuthor(post.authorId);\n   }\n\n   // After\n   const posts = await getPosts({ include: ['author'] });\n   ```\n\n2. **仮想スクロール導入**\n   - react-window または react-virtualized を使用\n```\n\n---\n\n## 注意事項\n\n- 早期最適化は避け、実際のボトルネックを優先\n- 測定可能な改善効果を示す\n- トレードオフ（可読性 vs パフォーマンス）を考慮\n",
        "opencode/skills/harness-review/references/quality-review.md": "---\nname: review-quality\ndescription: \"コード品質（可読性、保守性、ベストプラクティス）をチェックするスキル。コードレビューが要求された場合、リファクタリング後、または複雑なロジックの実装後に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Review Quality\n\nコードの品質（可読性、保守性、ベストプラクティス）をチェックするスキル。\n\n---\n\n## 目的\n\n以下の観点でコード品質を評価：\n- 可読性（命名、構造、コメント）\n- 保守性（モジュール性、依存関係）\n- ベストプラクティス準拠\n- コーディング規約準拠\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `files` | チェック対象ファイルのリスト |\n| `code_content` | ファイルの内容 |\n| `eslint_output` | ESLint/Linter の出力（あれば） |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `quality_issues` | 検出された問題のリスト |\n| `quality_score` | 品質スコア (A-F) |\n\n---\n\n## チェック項目\n\n### 1. 可読性\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| 命名 | `x`, `tmp`, `data` などの曖昧な名前 | 意味のある名前に変更 |\n| 関数の長さ | 50行以上の関数 | 小さな関数に分割 |\n| ネスト深度 | 4段階以上のネスト | 早期リターン、関数抽出 |\n| マジックナンバー | 直書きの数値 | 定数化 |\n\n### 2. 保守性\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| 重複コード | 同じロジックの繰り返し | 共通関数に抽出 |\n| 密結合 | 直接的な依存関係 | 依存性注入、インターフェース |\n| グローバル状態 | グローバル変数の多用 | スコープの限定 |\n| 未使用コード | 使われていない変数・関数 | 削除 |\n\n### 3. ベストプラクティス\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| エラーハンドリング | 空の catch ブロック | 適切なエラー処理 |\n| 型安全性 | any 型の多用 | 適切な型定義 |\n| 非同期処理 | コールバック地獄 | async/await |\n| テスタビリティ | テストしにくい構造 | 依存性注入 |\n\n---\n\n## スコアリング\n\n| スコア | 基準 |\n|--------|------|\n| A | クリーンコード、問題なし |\n| B | 軽微な改善余地 |\n| C | 中程度の問題あり |\n| D | 可読性・保守性に問題 |\n| F | 深刻な品質問題 |\n\n---\n\n## 出力例\n\n```markdown\n## コード品質レビュー結果\n\n**スコア**: B\n\n### 検出された問題\n\n| 重大度 | ファイル | 行 | 問題 |\n|--------|---------|-----|------|\n| 中 | src/services/user.ts | 45 | 関数が長すぎる (78行) |\n| 低 | src/utils/helpers.ts | 12 | 未使用の import |\n| 低 | src/api/posts.ts | 89 | マジックナンバー使用 |\n\n### 推奨改善\n\n1. **長い関数の分割**\n   - `processUserData` 関数を以下に分割:\n     - `validateUserInput()`\n     - `formatUserData()`\n     - `saveUser()`\n\n2. **未使用コードの削除**\n   - `import { unused } from './utils'` を削除\n\n3. **定数化**\n   ```typescript\n   // Before\n   if (retryCount > 3) { ... }\n\n   // After\n   const MAX_RETRY_COUNT = 3;\n   if (retryCount > MAX_RETRY_COUNT) { ... }\n   ```\n```\n\n---\n\n### 4. クロスプラットフォーム\n\n| チェック | 問題 | 重大度 | 改善 |\n|---------|------|--------|------|\n| レスポンシブ未対応 | 固定幅（`width: 1200px`）、viewport meta 未設定 | 中 | `max-width` + メディアクエリ |\n| スクロールバー問題 | `100vw` 使用による横スクロール | 低 | `100%` または `calc(100vw - スクロールバー幅)` |\n| 長文入力未対応 | overflow/truncate 未設定で UI 崩れ | 低 | `overflow-hidden`, `text-overflow: ellipsis` |\n| フォント未指定 | system-ui/font-family 未設定 | 低 | システムフォントスタック指定 |\n| タッチターゲット | 小さすぎるボタン（< 44px） | 中 | 最小 44x44px |\n\n**検出パターン**:\n```css\n/* ❌ 問題: 固定幅 */\n.container { width: 1200px; }\n\n/* ✅ 改善: レスポンシブ */\n.container { max-width: 1200px; width: 100%; }\n\n/* ❌ 問題: 100vw（スクロールバーで崩れる） */\n.full-width { width: 100vw; }\n\n/* ✅ 改善 */\n.full-width { width: 100%; }\n```\n\n### 5. Web 基盤チェック\n\n| チェック | 問題 | 重大度 | 改善 |\n|---------|------|--------|------|\n| favicon 未設定 | ブラウザタブにアイコンなし | 低 | `<link rel=\"icon\">` 追加 |\n| apple-touch-icon 未設定 | iOS ホーム画面追加時のアイコンなし | 低 | `<link rel=\"apple-touch-icon\">` 追加 |\n| 404/5xx ページ | デフォルトエラーページ | 低 | カスタムエラーページ作成 |\n| lang 属性未設定 | `<html>` に lang なし | 低 | `<html lang=\"ja\">` 追加 |\n| charset 未設定 | 文字化けリスク | 低 | `<meta charset=\"UTF-8\">` 追加 |\n\n**検出パターン**:\n```html\n<!-- ❌ 問題: 基本設定なし -->\n<html>\n<head>\n  <title>My App</title>\n</head>\n\n<!-- ✅ 改善: 基本設定あり -->\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <link rel=\"icon\" href=\"/favicon.ico\">\n  <link rel=\"apple-touch-icon\" href=\"/apple-touch-icon.png\">\n  <title>My App</title>\n</head>\n```\n\n### 6. LocalStorage / Cookie 管理\n\n| チェック | 問題 | 重大度 | 改善 |\n|---------|------|--------|------|\n| 有効期限なし | 永続的なデータ保存 | 低 | 適切な有効期限設定（7日推奨） |\n| サードパーティ Cookie 依存 | ブロックされる可能性 | 中 | ファーストパーティへ移行 |\n| 機密情報の保存 | LocalStorage にトークン等 | 中 | HttpOnly Cookie へ移行 |\n\n---\n\n## 注意事項\n\n- プロジェクトの既存スタイルを尊重する\n- 過度な改善提案は避ける\n- 優先度を付けて報告する\n- フレームワーク固有の機能を考慮する（Next.js App Router, Remix, etc.）\n",
        "opencode/skills/harness-review/references/security-review.md": "---\nname: review-security\ndescription: \"コードのセキュリティ脆弱性をチェックするスキル。セキュリティレビューが要求された場合、本番デプロイ前、または機密情報を扱うコードの変更時に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Review Security\n\nコードのセキュリティ脆弱性をチェックし、問題を報告するスキル。\n\n---\n\n## 目的\n\nOWASP Top 10 を含む一般的なセキュリティ脆弱性を検出：\n- インジェクション攻撃（SQL, コマンド, XSS）\n- 認証・認可の問題\n- 機密データの露出\n- セキュリティの設定ミス\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `files` | チェック対象ファイルのリスト |\n| `code_content` | ファイルの内容 |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `security_issues` | 検出された問題のリスト |\n| `security_score` | セキュリティスコア (A-F) |\n\n---\n\n## チェック項目\n\n### 1. インジェクション\n\n| チェック | 検出対象 |\n|---------|----------|\n| SQL インジェクション | 文字列連結でのクエリ構築 |\n| コマンドインジェクション | 安全でないコマンド実行関数の使用 |\n| XSS | 未サニタイズのHTML出力 |\n\n### 2. 認証・認可\n\n| チェック | 検出対象 |\n|---------|----------|\n| ハードコードされた認証情報 | パスワード、APIキーの直書き |\n| 弱い認証 | 平文パスワード保存 |\n| 認可チェック漏れ | 権限確認なしのリソースアクセス |\n\n### 3. 機密データ\n\n| チェック | 検出対象 |\n|---------|----------|\n| 機密情報のログ出力 | パスワード、トークンのログ |\n| 安全でない通信 | HTTP での機密データ送信 |\n| .env ファイルのコミット | git に含まれる機密ファイル |\n\n### 4. 設定ミス\n\n| チェック | 検出対象 |\n|---------|----------|\n| デバッグモード有効 | 本番での DEBUG=true |\n| CORS 設定ミス | 過度に寛容なオリジン設定 |\n| セキュリティヘッダー欠如 | CSP, X-Frame-Options の未設定 |\n\n---\n\n## スコアリング\n\n| スコア | 基準 |\n|--------|------|\n| A | 問題なし |\n| B | 軽微な問題 1-2 件 |\n| C | 中程度の問題あり |\n| D | 重大な問題あり |\n| F | クリティカルな脆弱性あり |\n\n---\n\n## 出力例\n\n```markdown\n## セキュリティレビュー結果\n\n**スコア**: B\n\n### 検出された問題\n\n| 重大度 | ファイル | 行 | 問題 |\n|--------|---------|-----|------|\n| 中 | src/api/users.ts | 45 | SQL インジェクションの可能性 |\n| 低 | src/config.ts | 12 | ハードコードされた API URL |\n\n### 推奨対策\n\n1. **SQL インジェクション対策**\n   - プレースホルダーを使用したクエリに変更\n   - ORM のパラメータバインディングを活用\n\n2. **設定の外部化**\n   - API URL を環境変数に移動\n```\n\n---\n\n### 5. Cookie セキュリティ\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| HttpOnly 未設定 | 認証 Cookie が JS からアクセス可能（`document.cookie` で読める） | 高 |\n| SameSite 未設定/None | CSRF 脆弱性のリスク、クロスサイトリクエスト許可 | 高 |\n| Secure 未設定 | HTTP 経由での Cookie 送信（盗聴リスク） | 高 |\n| Domain 過度に広い | サブドメイン間での不正アクセス（`.example.com` 等） | 中 |\n| 有効期限が長すぎる | セッション Cookie に長期 Expires 設定 | 中 |\n\n**検出パターン**:\n```typescript\n// ❌ 問題のある設定\nres.cookie('session', token);  // オプションなし\nres.cookie('auth', token, { httpOnly: false });\ndocument.cookie = \"session=...\";  // クライアントサイドでの設定\n\n// ✅ 安全な設定\nres.cookie('session', token, {\n  httpOnly: true,\n  secure: true,\n  sameSite: 'strict',\n  domain: 'example.com'  // 明示的に制限\n});\n```\n\n### 6. レスポンスヘッダー\n\n| ヘッダー | 必須度 | 検出対象 | 効果 |\n|---------|--------|----------|------|\n| `Strict-Transport-Security` | 必須 | HSTS 未設定（HTTP ダウングレード攻撃） | HTTPS 強制 |\n| `X-Content-Type-Options: nosniff` | 必須 | MIME スニッフィング許可 | XSS 防止 |\n| `Content-Security-Policy` | 推奨 | CSP 未設定（インラインスクリプト許可） | XSS 防止 |\n| `X-Frame-Options` / CSP `frame-ancestors` | 推奨 | フレーム埋め込み許可 | クリックジャッキング防止 |\n| `Referrer-Policy` | 推奨 | 未設定（リファラ漏洩） | プライバシー保護 |\n\n**検出パターン**:\n```typescript\n// チェック対象: レスポンスヘッダー設定箇所\n// - middleware.ts\n// - server.ts / app.ts\n// - next.config.js (headers)\n// - vercel.json / netlify.toml\n\n// ❌ 問題: ヘッダー未設定\napp.use((req, res, next) => next());\n\n// ✅ 推奨: セキュリティヘッダー設定\napp.use(helmet());  // または個別設定\nres.setHeader('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');\nres.setHeader('X-Content-Type-Options', 'nosniff');\nres.setHeader('X-Frame-Options', 'DENY');\n```\n\n### 7. リダイレクト・ファイルアップロード\n\n#### オープンリダイレクト\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| 未検証リダイレクト | ユーザー入力を直接 `redirect()` に渡す | 高 |\n| URL パラメータの利用 | `?returnUrl=` `?next=` `?redirect=` | 高 |\n| 外部ドメインへのリダイレクト | 許可リストなしでの外部リダイレクト | 高 |\n\n**検出パターン**:\n```typescript\n// ❌ 危険: 未検証リダイレクト\nconst returnUrl = req.query.returnUrl;\nres.redirect(returnUrl);\n\n// ✅ 安全: ホワイトリスト検証\nconst allowedHosts = ['example.com', 'app.example.com'];\nconst url = new URL(returnUrl, 'https://example.com');\nif (allowedHosts.includes(url.hostname)) {\n  res.redirect(returnUrl);\n}\n```\n\n#### ファイルアップロード\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| MIME タイプ未検証 | Content-Type のみ信頼（偽装可能） | 高 |\n| 拡張子未検証 | `.php`, `.exe` 等の危険な拡張子許可 | 高 |\n| ファイルサイズ未検証 | 無制限アップロード（DoS リスク） | 中 |\n| パストラバーサル | `../` を含むファイル名の未サニタイズ | 高 |\n| マジックバイト未検証 | ファイルヘッダーの検証なし | 中 |\n\n**検出パターン**:\n```typescript\n// ❌ 危険: 未検証アップロード\napp.post('/upload', (req, res) => {\n  const file = req.files.upload;\n  file.mv(`./uploads/${file.name}`);  // パストラバーサル可能\n});\n\n// ✅ 安全: 複数層の検証\nconst allowedMimeTypes = ['image/jpeg', 'image/png', 'application/pdf'];\nconst allowedExtensions = ['.jpg', '.jpeg', '.png', '.pdf'];\nconst maxFileSize = 10 * 1024 * 1024;  // 10MB\n\n// 1. サイズチェック\nif (file.size > maxFileSize) throw new Error('File too large');\n\n// 2. 拡張子チェック\nconst ext = path.extname(file.name).toLowerCase();\nif (!allowedExtensions.includes(ext)) throw new Error('Invalid extension');\n\n// 3. MIME タイプチェック（マジックバイト推奨）\nif (!allowedMimeTypes.includes(file.mimetype)) throw new Error('Invalid type');\n\n// 4. ファイル名サニタイズ\nconst safeName = crypto.randomUUID() + ext;\n```\n\n### 8. 決済セキュリティ\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| 重複課金 | 冪等性キーの未使用 | 高 |\n| 金額改ざん | クライアントサイドでの金額決定 | 高 |\n| 状態不整合 | 決済プロバイダとアプリ状態の不一致 | 高 |\n| Webhook 未検証 | 署名検証なしの Webhook 処理 | 高 |\n\n**検出パターン**:\n```typescript\n// ❌ 危険: クライアントから金額を受け取る\nconst { amount, productId } = req.body;\nawait stripe.paymentIntents.create({ amount });\n\n// ✅ 安全: サーバーサイドで金額を決定\nconst product = await db.products.findUnique({ where: { id: productId } });\nawait stripe.paymentIntents.create({\n  amount: product.price,\n  idempotencyKey: `order_${orderId}`  // 冪等性キー\n});\n\n// ✅ Webhook 署名検証\nconst sig = req.headers['stripe-signature'];\nconst event = stripe.webhooks.constructEvent(req.body, sig, webhookSecret);\n```\n\n---\n\n## 注意事項\n\n- false positive を減らすためコンテキストを考慮する\n- セキュリティ問題は優先度高で報告する\n- 修正方法も合わせて提示する\n- フレームワーク固有のセキュリティ機能を考慮する（Next.js, Express, etc.）\n",
        "opencode/skills/harness-review/references/seo-review.md": "---\nname: review-seo\ndescription: \"SEO・OGP・メタ情報をチェックするスキル。ローンチ前レビュー、ページ追加時、またはSEO最適化が要求された場合に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Review SEO & OGP\n\nSEO 最適化と OGP タグをチェックし、検索エンジン・SNS シェア品質を向上するスキル。\n\n---\n\n## 目的\n\n以下の観点で SEO/OGP を評価：\n- 検索エンジン最適化（title, description, canonical）\n- ソーシャルメディア対応（OGP, Twitter Card）\n- クローラビリティ（robots.txt, sitemap）\n- 技術的 SEO（構造化データ, ページ速度）\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `files` | チェック対象ファイルのリスト |\n| `pages` | ページ一覧（静的/動的） |\n| `public_dir` | public ディレクトリのパス |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `seo_issues` | 検出された問題のリスト |\n| `seo_score` | SEO スコア (A-F) |\n\n---\n\n## チェック項目\n\n### 1. 基本メタタグ\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| `<title>` 欠落 | 全ページに設定されているか | 高 |\n| `<title>` 重複 | 複数ページで同一タイトル | 中 |\n| `<title>` 長さ | 60文字超過（検索結果で切れる） | 低 |\n| `<meta name=\"description\">` 欠落 | 重要ページに設定されているか | 中 |\n| `<meta name=\"description\">` 長さ | 160文字超過 | 低 |\n| canonical URL 欠落 | 重要ページに `<link rel=\"canonical\">` | 中 |\n| viewport 未設定 | モバイル対応必須 | 高 |\n\n**検出パターン**:\n```tsx\n// ❌ 問題: メタタグなし\nexport default function Page() {\n  return <div>Content</div>;\n}\n\n// ✅ 改善: Next.js App Router\nexport const metadata = {\n  title: 'ページタイトル | サイト名',\n  description: 'ページの説明文（160文字以内）',\n  alternates: { canonical: 'https://example.com/page' }\n};\n\n// ✅ 改善: HTML\n<head>\n  <title>ページタイトル | サイト名</title>\n  <meta name=\"description\" content=\"ページの説明文\">\n  <link rel=\"canonical\" href=\"https://example.com/page\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n</head>\n```\n\n### 2. OGP（Open Graph Protocol）\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| `og:title` 欠落 | シェア可能ページに設定されているか | 中 |\n| `og:description` 欠落 | 適切な説明があるか | 中 |\n| `og:image` 欠落 | 画像が設定されているか | 中 |\n| `og:image` サイズ | 1200x630px 推奨 | 低 |\n| `og:url` 不一致 | canonical と一致しているか | 低 |\n| `og:type` 欠落 | `website`, `article` 等 | 低 |\n\n**検出パターン**:\n```tsx\n// ✅ Next.js App Router\nexport const metadata = {\n  openGraph: {\n    title: 'ページタイトル',\n    description: '説明文',\n    url: 'https://example.com/page',\n    siteName: 'サイト名',\n    images: [{ url: 'https://example.com/og-image.png', width: 1200, height: 630 }],\n    locale: 'ja_JP',\n    type: 'website',\n  },\n};\n\n// ✅ HTML\n<meta property=\"og:title\" content=\"ページタイトル\">\n<meta property=\"og:description\" content=\"説明文\">\n<meta property=\"og:image\" content=\"https://example.com/og-image.png\">\n<meta property=\"og:url\" content=\"https://example.com/page\">\n<meta property=\"og:type\" content=\"website\">\n```\n\n### 3. Twitter Card\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| `twitter:card` 欠落 | `summary_large_image` 推奨 | 低 |\n| `twitter:title` 欠落 | OGP と重複可 | 低 |\n| `twitter:description` 欠落 | OGP と重複可 | 低 |\n| `twitter:image` 欠落 | OGP と重複可 | 低 |\n\n**検出パターン**:\n```tsx\n// ✅ Next.js App Router\nexport const metadata = {\n  twitter: {\n    card: 'summary_large_image',\n    title: 'ページタイトル',\n    description: '説明文',\n    images: ['https://example.com/twitter-image.png'],\n  },\n};\n```\n\n### 4. クローラビリティ\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| robots.txt 欠落 | `public/robots.txt` が存在するか | 中 |\n| robots.txt 全拒否 | `Disallow: /` で全ページブロック | 高 |\n| sitemap.xml 欠落 | 存在するか | 低 |\n| noindex 残存 | 開発中の `<meta name=\"robots\" content=\"noindex\">` | 高 |\n\n**検出パターン**:\n```bash\n# チェック対象\npublic/robots.txt\npublic/sitemap.xml\napp/robots.ts (Next.js)\napp/sitemap.ts (Next.js)\n```\n\n```txt\n# ✅ 推奨 robots.txt\nUser-agent: *\nAllow: /\nSitemap: https://example.com/sitemap.xml\n\n# ❌ 危険: 全拒否\nUser-agent: *\nDisallow: /\n```\n\n### 5. HTTP ステータス\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| エラーページ 200 | 404/500 が 200 を返す | 高 |\n| リダイレクトチェーン | 3回以上のリダイレクト | 中 |\n| soft 404 | 存在しないページが 200 を返す | 高 |\n\n**検出パターン**:\n```typescript\n// ❌ 問題: エラーページが 200 を返す\nexport default function NotFound() {\n  return <div>Page not found</div>;  // ステータス 200\n}\n\n// ✅ 改善: 正しいステータスコード\n// app/not-found.tsx (Next.js App Router は自動で 404)\nexport default function NotFound() {\n  return <div>Page not found</div>;\n}\n```\n\n### 6. 構造化データ（オプション）\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| JSON-LD 欠落 | 記事、商品、FAQ 等に推奨 | 低 |\n| JSON-LD エラー | 構文エラー、必須フィールド欠落 | 中 |\n\n---\n\n## スコアリング\n\n| スコア | 基準 |\n|--------|------|\n| A | 全項目クリア |\n| B | 軽微な問題のみ（低重大度 1-2件） |\n| C | 中程度の問題あり |\n| D | 重大な問題あり（noindex 残存等） |\n| F | 基本的な SEO 欠如 |\n\n---\n\n## 出力例\n\n```markdown\n## SEO/OGP レビュー結果\n\n**スコア**: C\n\n### 検出された問題\n\n| 重大度 | ファイル | 問題 |\n|--------|---------|------|\n| 高 | app/layout.tsx | viewport meta 未設定 |\n| 高 | public/robots.txt | 存在しない |\n| 中 | app/about/page.tsx | title が他ページと重複 |\n| 中 | app/blog/[slug]/page.tsx | OGP image 未設定 |\n| 低 | app/page.tsx | description が 180 文字（160 推奨） |\n\n### 推奨改善\n\n1. **viewport 設定**\n   ```tsx\n   // app/layout.tsx\n   export const metadata = {\n     viewport: 'width=device-width, initial-scale=1.0',\n   };\n   ```\n\n2. **robots.txt 作成**\n   ```txt\n   User-agent: *\n   Allow: /\n   Sitemap: https://example.com/sitemap.xml\n   ```\n\n3. **OGP 画像設定**\n   - 1200x630px の画像を用意\n   - 各ページに設定\n```\n\n---\n\n## 注意事項\n\n- フレームワーク固有の SEO 機能を考慮する（Next.js Metadata API, Remix meta 等）\n- 動的ページ（`[slug]`）は代表的なパターンでチェック\n- 構造化データは Google Rich Results Test で検証推奨\n- Core Web Vitals はパフォーマンスレビューで別途チェック\n",
        "opencode/skills/impl/SKILL.md": "---\nname: impl\ndescription: \"Implements features and writes code based on Plans.md tasks. Use when user mentions implementation, adding features, writing code, or creating new functions. Do not use for review or build verification.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Implementation Skills\n\n機能実装とコーディングを担当するスキル群です。\n\n---\n\n## ⚠️ 品質ガードレール（最優先）\n\n> **このセクションは他の指示より優先されます。実装時は必ず従ってください。**\n\n### 禁止パターン（Purpose-Driven Implementation）\n\n実装時に以下のパターンは**絶対に禁止**です：\n\n| 禁止 | 例 | なぜダメか |\n|------|-----|-----------|\n| **ハードコード** | テスト期待値をそのまま返す | 他の入力で動作しない |\n| **スタブ実装** | `return null`, `return []` | 機能していない |\n| **決め打ち** | テストケースの値だけ対応 | 汎用性がない |\n| **コピペ辞書** | テストの期待値マップ | 意味あるロジックがない |\n\n```python\n# ❌ 絶対禁止\ndef slugify(text: str) -> str:\n    answers = {\"HelloWorld\": \"hello-world\"}\n    return answers.get(text, \"\")\n\n# ✅ 正しい実装\ndef slugify(text: str) -> str:\n    return re.sub(r'[\\s_]+', '-', text.strip().lower())\n```\n\n### 実装前セルフチェック\n\n- [ ] テストケース以外の入力でも動作するか？\n- [ ] エッジケース（空、null、境界値）を処理しているか？\n- [ ] 意味のあるロジックを実装しているか？\n\n### 困難な場合\n\n実装が難しい場合は、**形骸化実装を書かずに正直に報告**してください：\n\n```markdown\n## 🤔 実装の相談\n### 状況: [何を実装しようとしているか]\n### 困難な点: [具体的に何が難しいか]\n### 選択肢: [考えられる案]\n```\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **機能実装** | See [references/implementing-features.md](references/implementing-features.md) |\n| **テスト作成** | See [references/writing-tests.md](references/writing-tests.md) |\n\n## 実行手順\n\n1. **品質判定ゲート**（Step 0）\n2. ユーザーのリクエストを分類\n3. **（Claude-mem 有効時）過去の実装パターンを検索**\n4. 上記の「機能詳細」から適切な参照ファイルを読む\n5. その内容に従って実装\n\n### Step 0: 品質判定ゲート（最初に実行）\n\nタスク開始前に品質基準を判定し、必要に応じて提案:\n\n```\nタスク情報収集\n    ↓\n┌─────────────────────────────────────────┐\n│           品質判定ゲート                 │\n├─────────────────────────────────────────┤\n│  判定項目:                              │\n│  ├── TDD 推奨？（[feature] + ビジネス）  │\n│  ├── セキュリティ注意？（auth/api/）    │\n│  └── パフォーマンス注意？（DB/ループ）  │\n└─────────────────────────────────────────┘\n          ↓\n    該当する判定を提案\n```\n\n#### TDD 判定基準\n\n| 条件 | 推奨度 | 提案内容 |\n|------|--------|---------|\n| [feature] + src/core/ | ★★★ | 「テストから書きますか？」 |\n| [feature] + src/services/ | ★★★ | 「テストから書きますか？」 |\n| [bugfix] | ★★☆ | 「再現テストを先に書きますか？」 |\n| [config], [docs] | - | 判定スキップ |\n\n#### セキュリティ判定基準\n\n| パス | 提案内容 |\n|------|---------|\n| auth/, login/, session/ | セキュリティチェックリスト表示 |\n| api/, routes/ | 入力検証・認可チェック確認 |\n| payment/, billing/ | 決済セキュリティチェック |\n\n#### 提案テンプレート\n\n**エンジニア向け**:\n```markdown\n🎯 品質判定結果\n\n| 判定 | 推奨度 | 理由 |\n|------|--------|------|\n| TDD | ★★★ | [feature] + ビジネスロジック |\n\nテストファイルから作成しますか？\n```\n\n**VibeCoder 向け**:\n```markdown\n🎯 この作業で気をつけること\n\n1. **成功基準を先に決めましょう**\n   - 「何ができたら OK か」をリストにします\n\n進め方を選んでください：\n1. 成功基準から作る（推奨）\n2. とりあえず作り始める\n```\n\n### Step 1: LSP 活用ガイドライン\n\n実装前に LSP ツールで既存コードを理解することを推奨:\n\n| LSP 操作 | 活用場面 | 効果 |\n|---------|---------|------|\n| goToDefinition | 既存関数の実装を確認 | パターン把握 |\n| findReferences | 影響範囲の事前調査 | 破壊的変更防止 |\n| hover | 型情報・JSDoc 確認 | 正しいインターフェース |\n\n**実装フロー**:\n1. `LSP.goToDefinition` で関連コードを確認\n2. `LSP.findReferences` で影響範囲を把握\n3. 実装\n4. `LSP.diagnostics` でエラーチェック\n\n**使用例**:\n```\n# 1. 関連関数の実装を確認\nLSP operation=goToDefinition filePath=\"src/utils/auth.ts\" line=25 character=10\n\n# 2. 影響範囲を調査\nLSP operation=findReferences filePath=\"src/utils/auth.ts\" line=25 character=10\n\n# 3. 型情報を確認\nLSP operation=hover filePath=\"src/types/user.ts\" line=15 character=12\n```\n\n> **注**: LSP サーバーが設定されている言語でのみ動作します。\n\n### Step 2: 過去の実装パターン検索（Memory-Enhanced）\n\nClaude-mem が有効な場合、実装前に過去の類似パターンを検索:\n\n```\n# mem-search で過去の実装パターンを検索\nmem-search: type:feature \"{実装機能のキーワード}\"\nmem-search: concepts:pattern \"{関連技術}\"\nmem-search: concepts:gotcha \"{使用ライブラリ/フレームワーク}\"\nmem-search: type:decision \"{設計方針に関するキーワード}\"\n```\n\n**表示例**:\n\n```markdown\n📚 過去の実装パターン\n\n| 日付 | パターン | ファイル |\n|------|---------|---------|\n| 2024-01-15 | API エンドポイント: RESTful 設計 | src/api/*.ts |\n| 2024-01-20 | フォームバリデーション: Zod 使用 | src/components/forms/*.tsx |\n\n💡 過去の gotcha（落とし穴）:\n- CORS: サーバー側で Allow-Origin 設定必須\n- 型安全: any 禁止、unknown + type guard 推奨\n```\n\n**関連する決定事項の表示**:\n\n```markdown\n⚖️ 関連する設計決定\n\n- D5: 状態管理は Zustand を採用（Redux より軽量）\n- D8: API通信は tRPC を使用（型安全）\n\n💡 上記の決定に従って実装してください\n```\n\n> **注**: Claude-mem が未設定の場合、このステップはスキップされます。\n\n---\n\n## 🔧 LSP 機能の活用\n\n実装時には LSP（Language Server Protocol）を積極的に活用します。\n\n### 実装前の調査\n\n| LSP 機能 | 用途 |\n|---------|------|\n| **Go-to-definition** | 既存関数の実装パターンを確認 |\n| **Find-references** | 変更の影響範囲を事前把握 |\n| **Hover** | 型情報・API ドキュメントを確認 |\n\n### 実装中の検証\n\n| LSP 機能 | 用途 |\n|---------|------|\n| **Diagnostics** | 型エラー・構文エラーを即座に検出 |\n| **Completions** | 正しい API を使用、タイポ防止 |\n\n### 実装後の確認\n\n```\n実装完了時チェック:\n1. LSP Diagnostics を実行\n2. エラー: 0件を確認\n3. 警告: 必要に応じて対応\n```\n\n詳細: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n",
        "opencode/skills/impl/references/implementing-features.md": "---\nname: work-impl-feature\ndescription: \"Plans.md のタスクに基づいて機能を実装する。/workコマンドが実行された場合、またはPlans.mdに実装待ちのタスクがある場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Work Implementation Feature\n\nPlans.md で計画されたタスクを実際に実装するスキル。\nコードを書き、ファイルを生成し、動作するソフトウェアを作成します。\n\n---\n\n## 入力\n\n- **Plans.md**: 実装すべきタスク一覧\n- **リポジトリコンテキスト**: 技術スタック、既存コード\n- **対象タスク**: 実装する具体的なタスク\n\n---\n\n## 出力\n\n- **実装されたコード**: ファイルの作成・編集\n- **Plans.md の更新**: タスク状態の変更\n- **完了報告**: 何を実装したかのサマリー\n\n---\n\n## 実行手順\n\n### Step 1: タスクの確認\n\n```bash\ncat Plans.md | grep -A 5 \"cc:WIP\\|cc:TODO\"\n```\n\n対象タスクを特定し、状態を `cc:WIP` に更新\n\n### Step 2: 実装方針の決定\n\n```\n1. 関連する既存コードを確認\n2. 必要なファイル・変更箇所を特定\n3. 実装の順序を決定\n```\n\n### Step 3: コードの実装\n\n#### ファイル作成の場合\n\n```bash\n# ディレクトリ確認\nls -la src/components/\n\n# Write ツールで新規ファイル作成\n```\n\n#### ファイル編集の場合\n\n```bash\n# Read ツールで既存内容を確認\n# Edit ツールで必要な部分のみ変更\n```\n\n### Step 4: 動作確認\n\n```bash\n# TypeScript の場合\nnpx tsc --noEmit\n\n# ビルド確認\nnpm run build\n\n# 開発サーバー起動\nnpm run dev\n```\n\n### Step 5: タスク完了処理\n\nPlans.md を更新：\n\n```markdown\n# 変更前\n- [ ] タスク名 `cc:WIP`\n\n# 変更後\n- [x] タスク名 `cc:完了` ({{日付}})\n```\n\n---\n\n## 実装パターン集\n\n### React コンポーネント\n\n```typescript\n// src/components/features/FeatureName.tsx\nimport { useState } from 'react'\n\ninterface FeatureNameProps {\n  // props 定義\n}\n\nexport function FeatureName({ ...props }: FeatureNameProps) {\n  const [state, setState] = useState<Type>(initialValue)\n\n  return (\n    <div>\n      {/* 実装 */}\n    </div>\n  )\n}\n```\n\n### API エンドポイント（Next.js）\n\n```typescript\n// src/app/api/endpoint/route.ts\nimport { NextResponse } from 'next/server'\n\nexport async function GET() {\n  // 実装\n  return NextResponse.json({ data: result })\n}\n```\n\n### ユーティリティ関数\n\n```typescript\n// src/lib/utils.ts\nexport function utilityFunction(input: InputType): OutputType {\n  // 実装\n  return output\n}\n```\n\n---\n\n## 品質基準\n\n### 1. 型安全\n\n- `any` を避ける\n- 適切な型定義を行う\n\n### 2. エラーハンドリング\n\n```typescript\ntry {\n  // 処理\n} catch (error) {\n  console.error('Error:', error)\n  // 適切なエラー処理\n}\n```\n\n### 3. コメント\n\n- 複雑なロジックには説明を追加\n- TODO は残さない（実装するか削除）\n\n---\n\n## 完了報告フォーマット\n\n```markdown\n## ✅ 実装完了\n\n**タスク**: {{タスク名}}\n\n### 変更ファイル\n| ファイル | 変更内容 |\n|---------|---------|\n| `{{path}}` | {{変更概要}} |\n\n### 動作確認\n- ビルド: ✅ 成功\n- 開発サーバー: ✅ 起動確認\n\n### 次のタスク\n「{{次のタスク名}}」を続けますか？\n```\n\n---\n\n## 注意事項\n\n- **1タスク1フォーカス**: 複数タスクを混ぜない\n- **こまめにコミット**: 意味のある単位で\n- **テスト可能な状態を維持**: 中間状態でもビルドが通ること\n",
        "opencode/skills/impl/references/writing-tests.md": "---\nname: work-write-tests\ndescription: \"テストコードを作成する。/workコマンドでテストが必要な場合、またはコード実装後にテストが不足している場合に使用します。\"\nallowed-tools: [Read,Write,Edit,Bash]\n---\n\n# Work Write Tests\n\n実装した機能に対してテストコードを書くスキル。\nコードの品質を保証し、リグレッションを防ぎます。\n\n---\n\n## 入力\n\n- **テスト対象のコード**: 実装されたファイル\n- **既存のテスト構造**: テストフレームワーク、ディレクトリ構成\n- **テスト要件**: カバーすべきケース\n\n---\n\n## 出力\n\n- **テストファイル**: 新規作成または追記\n- **テスト実行結果**: 全テスト通過の確認\n\n---\n\n## 実行手順\n\n### Step 1: テスト環境の確認\n\n```bash\n# テストフレームワークの確認\ncat package.json | grep -E '\"(jest|vitest|mocha|pytest)\"'\n\n# 既存テストの構造確認\nls -la __tests__/ tests/ src/**/*.test.* 2>/dev/null | head -10\n\n# テスト実行コマンドの確認\nnpm test 2>&1 | head -5\n```\n\n### Step 2: テストケースの設計\n\n対象コードに対して以下を考慮：\n\n1. **正常系**: 期待通りの入力に対する動作\n2. **境界値**: 最小/最大値、空配列など\n3. **異常系**: エラーが起きるべきケース\n\n### Step 3: テストの実装\n\n#### Jest/Vitest の例\n\n```typescript\n// src/components/__tests__/FeatureName.test.tsx\nimport { render, screen } from '@testing-library/react'\nimport { FeatureName } from '../FeatureName'\n\ndescribe('FeatureName', () => {\n  it('renders correctly', () => {\n    render(<FeatureName />)\n    expect(screen.getByText('Expected Text')).toBeInTheDocument()\n  })\n\n  it('handles user interaction', async () => {\n    render(<FeatureName />)\n    await userEvent.click(screen.getByRole('button'))\n    expect(screen.getByText('Result')).toBeInTheDocument()\n  })\n})\n```\n\n#### ユーティリティ関数のテスト\n\n```typescript\n// src/lib/__tests__/utils.test.ts\nimport { utilityFunction } from '../utils'\n\ndescribe('utilityFunction', () => {\n  it('returns expected output for valid input', () => {\n    expect(utilityFunction('input')).toBe('expected')\n  })\n\n  it('handles edge cases', () => {\n    expect(utilityFunction('')).toBe('')\n    expect(utilityFunction(null)).toBeNull()\n  })\n\n  it('throws error for invalid input', () => {\n    expect(() => utilityFunction(undefined)).toThrow()\n  })\n})\n```\n\n### Step 4: テストの実行\n\n```bash\n# 全テスト実行\nnpm test\n\n# 特定ファイルのみ\nnpm test -- FeatureName.test.tsx\n\n# カバレッジ付き\nnpm test -- --coverage\n```\n\n### Step 5: 結果の確認\n\n```bash\n# テスト結果の確認\nnpm test 2>&1 | tail -20\n\n# カバレッジレポート確認\ncat coverage/lcov-report/index.html | grep -A 5 \"coverage\"\n```\n\n---\n\n## テストパターン集\n\n### コンポーネントテスト\n\n```typescript\n// レンダリングテスト\nit('renders without crashing', () => {\n  render(<Component />)\n})\n\n// Props テスト\nit('displays props correctly', () => {\n  render(<Component title=\"Test\" />)\n  expect(screen.getByText('Test')).toBeInTheDocument()\n})\n\n// イベントテスト\nit('handles click event', async () => {\n  const onClick = vi.fn()\n  render(<Component onClick={onClick} />)\n  await userEvent.click(screen.getByRole('button'))\n  expect(onClick).toHaveBeenCalled()\n})\n```\n\n### API テスト\n\n```typescript\n// モックを使用\nvi.mock('../lib/api', () => ({\n  fetchData: vi.fn().mockResolvedValue({ data: 'mock' })\n}))\n\nit('fetches data correctly', async () => {\n  const result = await fetchData()\n  expect(result.data).toBe('mock')\n})\n```\n\n### エラーハンドリングテスト\n\n```typescript\nit('handles errors gracefully', async () => {\n  vi.spyOn(console, 'error').mockImplementation(() => {})\n\n  render(<ComponentWithError />)\n\n  expect(screen.getByText('Error occurred')).toBeInTheDocument()\n})\n```\n\n---\n\n## テスト命名規則\n\n```typescript\n// 推奨フォーマット\ndescribe('対象', () => {\n  it('〜のとき、〜する', () => {})\n  it('〜の場合、〜を返す', () => {})\n})\n\n// 例\ndescribe('Button', () => {\n  it('クリックされたとき、onClickを呼び出す', () => {})\n  it('disabledの場合、クリックを無視する', () => {})\n})\n```\n\n---\n\n## 完了報告フォーマット\n\n```markdown\n## ✅ テスト追加完了\n\n**対象**: {{テスト対象ファイル}}\n\n### 追加したテスト\n| テストファイル | テストケース数 |\n|--------------|--------------|\n| `{{path}}` | {{件数}} |\n\n### テスト結果\n- 実行: ✅ {{total}} テスト中 {{passed}} 通過\n- カバレッジ: {{percentage}}%\n\n### 次のアクション\n「レビューして」または「次のタスクへ」\n```\n\n---\n\n## 注意事項\n\n- **テストを後回しにしない**: 実装と同時に書く\n- **過度なモックを避ける**: 実際の動作に近いテストを\n- **テストの保守性**: 実装変更でテストが壊れにくく\n",
        "opencode/skills/maintenance/SKILL.md": "---\nname: maintenance\ndescription: \"Cleans up and organizes project files. Use when user mentions cleanup, archive, file bloat, or organizing Plans.md/session logs. Do NOT load for: implementation work, reviews, new feature development, or deployment.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Maintenance Skills\n\nファイルのメンテナンス・クリーンアップを担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **自動クリーンアップ** | See [references/auto-cleanup.md](references/auto-cleanup.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って実行\n",
        "opencode/skills/maintenance/references/auto-cleanup.md": "---\nname: auto-cleanup\ndescription: \"不要なファイルや古いログをクリーンアップする。Plans.mdが肥大化した場合、またはセッション終了時に使用します。\"\nallowed-tools: [Read,Write,Edit,Bash]\n---\n\n# Auto Cleanup Skill\n\nPlans.md、session-log.md 等のファイル肥大化を防ぐ自動整理スキル。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで起動します：\n\n- 「ファイルを整理して」\n- 「アーカイブして」\n- 「古いタスクを移動して」\n- `/cleanup`\n- \"clean up files\"\n- \"archive old tasks\"\n\n---\n\n## 概要\n\nこのスキルは以下のファイルを自動整理します：\n\n| ファイル | 閾値 | アクション |\n|---------|------|-----------|\n| Plans.md | 完了から7日 or 200行超 | 📦 アーカイブへ移動 |\n| session-log.md | 30日経過 or 500行超 | 月別ファイルに分割 |\n| CLAUDE.md | 100行超 | 警告 + 分割提案 |\n\n---\n\n## v0.4.6+ LLM評価型フック\n\nセッション終了時に **Prompt-Based Hook** で賢くクリーンアップを推奨します。\n\n### 仕組み\n\n```\n┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n│  Stop Event     │ ──► │  Bash Script    │ ──► │  Claude Haiku   │\n│  (Session End)  │     │  (collect-      │     │  (LLM 評価)     │\n│                 │     │   cleanup-      │     │                 │\n│                 │     │   context.sh)   │     │  推奨判断       │\n└─────────────────┘     └─────────────────┘     └─────────────────┘\n```\n\n### 評価基準\n\nLLM は以下の条件で cleanup を推奨します：\n\n1. **完了タスク蓄積**: 10件以上の完了タスク\n2. **古い完了タスク**: 7日以上前に完了したタスクの存在\n3. **Plans.md 肥大化**: 200行超\n4. **Session Log 肥大化**: 500行超\n5. **CLAUDE.md 肥大化**: 100行超（.claude/rules/ への分割を提案）\n\n### 利点\n\n| 従来の Bash Hook | LLM 評価型 Hook |\n|-----------------|-----------------|\n| 行数のみで判定 | タスクの完了日・件数を総合判断 |\n| 硬直的な閾値 | 文脈を理解した柔軟な推奨 |\n| 機械的なメッセージ | 具体的なアクション提案 |\n\n---\n\n## 設定ファイル\n\n`.claude-code-harness.config.yaml` で閾値をカスタマイズ可能：\n\n```yaml\ncleanup:\n  plans:\n    archive_after_days: 7        # 完了からN日でアーカイブ\n    max_lines: 200               # 最大行数\n    archive_max_items: 50        # アーカイブ最大件数\n\n  session_log:\n    archive_after_days: 30       # N日で月別に分割\n    max_lines: 500               # 最大行数\n    archive_path: \".claude/memory/archive/sessions/\"\n\n  claude_md:\n    max_lines: 100               # 警告閾値\n    warn_only: true              # 警告のみ（自動編集しない）\n\n  auto_run: session_start        # 実行タイミング\n```\n\n---\n\n## 実行手順\n\n### Step 1: 設定の読み込み\n\n```bash\n# 設定ファイルがあれば読み込み、なければデフォルト値\nCONFIG_FILE=\".claude-code-harness.config.yaml\"\nif [ -f \"$CONFIG_FILE\" ]; then\n  # YAML パース\n  PLANS_MAX_LINES=$(grep \"max_lines:\" \"$CONFIG_FILE\" | head -1 | awk '{print $2}')\nelse\n  # デフォルト値\n  PLANS_MAX_LINES=200\n  ARCHIVE_AFTER_DAYS=7\nfi\n```\n\n### Step 2: Plans.md の整理\n\n```bash\ncheck_plans_cleanup() {\n  local file=\"Plans.md\"\n  [ ! -f \"$file\" ] && return 0\n\n  local lines=$(wc -l < \"$file\")\n  local completed_count=$(grep -c \"\\[x\\].*pm:確認済\\|cursor:確認済\" \"$file\" || echo 0)\n\n  echo \"📊 Plans.md: ${lines}行, 完了タスク: ${completed_count}件\"\n\n  # 閾値チェック\n  if [ \"$lines\" -gt \"$PLANS_MAX_LINES\" ]; then\n    echo \"⚠️ Plans.md が ${PLANS_MAX_LINES} 行を超えています\"\n    return 1\n  fi\n\n  # 7日以上前の完了タスクをカウント\n  local old_tasks=$(grep -E \"\\[x\\].*\\([0-9]{4}-[0-9]{2}-[0-9]{2}\\)\" \"$file\" | while read line; do\n    date_str=$(echo \"$line\" | grep -oE \"[0-9]{4}-[0-9]{2}-[0-9]{2}\" | tail -1)\n    if [ -n \"$date_str\" ]; then\n      task_date=$(date -j -f \"%Y-%m-%d\" \"$date_str\" \"+%s\" 2>/dev/null || date -d \"$date_str\" \"+%s\" 2>/dev/null)\n      now=$(date \"+%s\")\n      diff=$(( (now - task_date) / 86400 ))\n      [ \"$diff\" -gt 7 ] && echo \"$line\"\n    fi\n  done | wc -l)\n\n  if [ \"$old_tasks\" -gt 0 ]; then\n    echo \"📦 ${old_tasks} 件の古いタスクをアーカイブ可能\"\n    return 1\n  fi\n\n  return 0\n}\n```\n\n### Step 3: アーカイブ実行\n\n```bash\narchive_old_tasks() {\n  local file=\"Plans.md\"\n  local archive_section=\"## 📦 アーカイブ\"\n  local today=$(date +%Y-%m-%d)\n\n  # 🟢 完了タスクセクションから7日以上前のタスクを抽出\n  # 📦 アーカイブセクションに移動\n  # 移動後、元のセクションから削除\n\n  echo \"✅ 古いタスクをアーカイブに移動しました\"\n}\n```\n\n### Step 4: session-log.md の整理\n\n```bash\ncheck_session_log_cleanup() {\n  local file=\".claude/memory/session-log.md\"\n  [ ! -f \"$file\" ] && return 0\n\n  local lines=$(wc -l < \"$file\")\n\n  if [ \"$lines\" -gt 500 ]; then\n    echo \"⚠️ session-log.md が 500 行を超えています\"\n\n    # 月別に分割\n    mkdir -p .claude/memory/archive/sessions\n    # 古いエントリを archive/sessions/YYYY-MM.md に移動\n\n    return 1\n  fi\n\n  return 0\n}\n```\n\n### Step 5: CLAUDE.md のチェック\n\n```bash\ncheck_claude_md() {\n  local file=\"CLAUDE.md\"\n  [ ! -f \"$file\" ] && return 0\n\n  local lines=$(wc -l < \"$file\")\n\n  if [ \"$lines\" -gt 100 ]; then\n    echo \"💡 CLAUDE.md が ${lines} 行あります\"\n    echo \"   常に必要な情報以外は docs/ に分割することを検討してください\"\n    echo \"   参考: @docs/filename.md で必要な時だけ読み込めます\"\n  fi\n\n  return 0\n}\n```\n\n---\n\n## 出力フォーマット\n\n### 整理が不要な場合\n\n```\n✅ **ファイル状態: 正常**\n\n- Plans.md: 85行 (上限: 200行)\n- session-log.md: 120行 (上限: 500行)\n- 完了タスク: 5件 (7日以内)\n\n整理の必要はありません。\n```\n\n### 整理が必要な場合\n\n```\n⚠️ **整理が推奨されます**\n\n📋 **Plans.md**\n- 現在: 250行 (上限: 200行)\n- 完了タスク: 15件 (うち7日以上前: 8件)\n\n**推奨アクション:**\n1. 8件の古いタスクをアーカイブへ移動\n\n実行しますか？ (y/n)\n```\n\n### 整理完了後\n\n```\n✅ **整理完了**\n\n- Plans.md: 250行 → 180行 (-70行)\n- アーカイブに移動: 8タスク\n- バックアップ: .claude/memory/archive/Plans-2025-01-15.md\n\n次回の自動チェック: セッション開始時\n```\n\n---\n\n## Hook との連携\n\nPostToolUse Hook から呼び出される場合：\n\n1. Plans.md への書き込み検知\n2. 行数チェック\n3. 閾値超過時は警告メッセージを返す\n4. Claude へのフィードバックとして整理を提案\n\n```json\n{\n  \"decision\": \"allow\",\n  \"feedback\": \"⚠️ Plans.md が 200行を超えました。`/cleanup` で整理することを推奨します。\"\n}\n```\n\n---\n\n## 関連コマンド\n\n- `/cleanup` - 手動で整理を実行\n- `/cleanup --dry-run` - 実行せずプレビュー\n- `/cleanup plans` - Plans.md のみ整理\n- `/cleanup sessions` - session-log のみ整理\n\n---\n\n## 注意事項\n\n- **進行中タスクは移動しない**: `cc:WIP` や `pm:依頼中`（互換: `cursor:依頼中`）は対象外\n- **バックアップを作成**: 整理前に自動バックアップ\n- **設定でカスタマイズ可能**: 閾値はプロジェクトごとに調整可能\n",
        "opencode/skills/memory/SKILL.md": "---\nname: memory\ndescription: \"Manages memory, SSOT files, and Plans.md operations. Use when user mentions memory, SSOT, decisions.md, patterns.md, merging, or migration. Do NOT load for: implementation work, reviews, ad-hoc notes, or in-session logging.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Memory Skills\n\nメモリとSSOT管理を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **SSOT初期化** | See [references/ssot-initialization.md](references/ssot-initialization.md) |\n| **Plans.mdマージ** | See [references/plans-merging.md](references/plans-merging.md) |\n| **移行処理** | See [references/workflow-migration.md](references/workflow-migration.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って実行\n",
        "opencode/skills/memory/references/plans-merging.md": "---\nname: merge-plans\ndescription: \"Plans.md のマージ更新を行うスキル（ユーザータスクを保持）。複数のPlans.mdを統合する必要がある場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\"]\n---\n\n# Merge Plans Skill\n\n既存の Plans.md を更新する際に、ユーザーのタスクデータを保持しながら\nテンプレートの構造を適用するスキル。\n\n---\n\n## 目的\n\n- ユーザーのタスク（🔴🟡🟢📦セクション）を保持\n- テンプレートの構造・マーカー定義を更新\n- 最終更新情報を更新\n\n---\n\n## Plans.md の構造\n\n```markdown\n# Plans.md - タスク管理\n\n> **プロジェクト**: {{PROJECT_NAME}}\n> **最終更新**: {{DATE}}\n> **更新者**: Claude Code\n\n---\n\n## 🔴 進行中のタスク        ← ユーザーデータ（保持）\n\n## 🟡 未着手のタスク        ← ユーザーデータ（保持）\n\n## 🟢 完了タスク            ← ユーザーデータ（保持）\n\n## 📦 アーカイブ            ← ユーザーデータ（保持）\n\n## マーカー凡例             ← テンプレートから更新\n\n## 最終更新情報             ← 日付を更新\n```\n\n---\n\n## マージアルゴリズム\n\n### Step 1: セクション分割\n\n```\n既存の Plans.md を以下のセクションに分割:\n\n1. ヘッダー部分（# Plans.md ... ---）\n2. 🔴 進行中のタスク（次のセクションまで）\n3. 🟡 未着手のタスク（次のセクションまで）\n4. 🟢 完了タスク（次のセクションまで）\n5. 📦 アーカイブ（次のセクションまで）\n6. マーカー凡例（次のセクションまで）\n7. 最終更新情報（ファイル末尾まで）\n```\n\n### Step 2: タスクセクションの抽出\n\n```bash\nextract_section() {\n  local file=\"$1\"\n  local start_marker=\"$2\"\n  local end_markers=\"$3\"  # パイプ区切りの終了マーカー\n\n  awk -v start=\"$start_marker\" -v ends=\"$end_markers\" '\n    BEGIN { in_section = 0; split(ends, end_arr, \"|\") }\n    $0 ~ start { in_section = 1; next }\n    in_section {\n      for (i in end_arr) {\n        if ($0 ~ end_arr[i]) { in_section = 0; exit }\n      }\n      if (in_section) print\n    }\n  ' \"$file\"\n}\n\n# 各セクションを抽出\nTASKS_WIP=$(extract_section \"$PLANS_FILE\" \"## 🔴\" \"## 🟡|## 🟢|## 📦|## マーカー|---\")\nTASKS_TODO=$(extract_section \"$PLANS_FILE\" \"## 🟡\" \"## 🔴|## 🟢|## 📦|## マーカー|---\")\nTASKS_DONE=$(extract_section \"$PLANS_FILE\" \"## 🟢\" \"## 🔴|## 🟡|## 📦|## マーカー|---\")\nTASKS_ARCHIVE=$(extract_section \"$PLANS_FILE\" \"## 📦\" \"## 🔴|## 🟡|## 🟢|## マーカー|---\")\n```\n\n### Step 3: タスクの検証\n\n```bash\n# 空でないことを確認\ncount_tasks() {\n  echo \"$1\" | grep -c \"^\\s*- \\[\" || echo \"0\"\n}\n\nWIP_COUNT=$(count_tasks \"$TASKS_WIP\")\nTODO_COUNT=$(count_tasks \"$TASKS_TODO\")\nDONE_COUNT=$(count_tasks \"$TASKS_DONE\")\nARCHIVE_COUNT=$(count_tasks \"$TASKS_ARCHIVE\")\n\necho \"保持されるタスク:\"\necho \"  進行中: $WIP_COUNT\"\necho \"  未着手: $TODO_COUNT\"\necho \"  完了: $DONE_COUNT\"\necho \"  アーカイブ: $ARCHIVE_COUNT\"\n```\n\n### Step 4: 新しい Plans.md の生成\n\n```markdown\n# Plans.md - タスク管理\n\n> **プロジェクト**: {{PROJECT_NAME}}\n> **最終更新**: {{DATE}}\n> **更新者**: Claude Code\n\n---\n\n## 🔴 進行中のタスク\n\n<!-- cc:WIP のタスクをここに記載 -->\n\n{{TASKS_WIP}}\n\n---\n\n## 🟡 未着手のタスク\n\n<!-- cc:TODO, pm:依頼中（互換: cursor:依頼中） のタスクをここに記載 -->\n\n{{TASKS_TODO}}\n\n---\n\n## 🟢 完了タスク\n\n<!-- cc:完了, pm:確認済（互換: cursor:確認済） のタスクをここに記載 -->\n\n{{TASKS_DONE}}\n\n---\n\n## 📦 アーカイブ\n\n<!-- 古い完了タスクはここに移動 -->\n\n{{TASKS_ARCHIVE}}\n\n---\n\n## マーカー凡例\n\n| マーカー | 意味 |\n|---------|------|\n| `pm:依頼中` | PM から依頼されたタスク（互換: cursor:依頼中） |\n| `cc:TODO` | Claude Code 未着手 |\n| `cc:WIP` | Claude Code 作業中 |\n| `cc:完了` | Claude Code 完了（確認待ち） |\n| `pm:確認済` | PM 確認完了（互換: cursor:確認済） |\n| `cursor:依頼中` | （互換）pm:依頼中 と同義 |\n| `cursor:確認済` | （互換）pm:確認済 と同義 |\n| `blocked` | ブロック中（理由を併記） |\n\n---\n\n## 最終更新情報\n\n- **更新日時**: {{DATE}}\n- **最終セッション担当**: Claude Code\n- **ブランチ**: main\n- **更新種別**: プラグインアップデート\n```\n\n---\n\n## 空セクションの処理\n\nタスクが空の場合は、デフォルトテキストを挿入:\n\n```markdown\n## 🔴 進行中のタスク\n\n<!-- cc:WIP のタスクをここに記載 -->\n\n（現在なし）\n```\n\n---\n\n## エラー処理\n\n### Plans.md が解析できない場合\n\n```bash\nif ! validate_plans_structure \"$PLANS_FILE\"; then\n  echo \"⚠️ Plans.md の構造を解析できませんでした\"\n  echo \"バックアップを保持し、新規テンプレートを使用します\"\n\n  # バックアップ\n  cp \"$PLANS_FILE\" \"${PLANS_FILE}.bak.$(date +%Y%m%d%H%M%S)\"\n\n  # テンプレートを使用\n  use_template_instead=true\nfi\n```\n\n### 必須セクションがない場合\n\n不足しているセクションはテンプレートのデフォルトで補完。\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `merge_successful` | マージ成功フラグ |\n| `tasks_wip_count` | 進行中タスク数 |\n| `tasks_todo_count` | 未着手タスク数 |\n| `tasks_done_count` | 完了タスク数 |\n| `tasks_archive_count` | アーカイブタスク数 |\n| `backup_created` | バックアップ作成有無 |\n\n---\n\n## 使用例\n\n```bash\n# スキルの呼び出し\nmerge_plans \\\n  --existing \"./Plans.md\" \\\n  --template \"$PLUGIN_PATH/templates/Plans.md.template\" \\\n  --output \"./Plans.md\" \\\n  --project-name \"my-project\" \\\n  --date \"$(date +%Y-%m-%d)\"\n```\n\n---\n\n## 関連スキル\n\n- `update-2agent-files` - 更新フロー全体\n- `generate-workflow-files` - 新規生成\n",
        "opencode/skills/memory/references/ssot-initialization.md": "---\nname: init-memory-ssot\ndescription: \"プロジェクトのSSOTメモリ（decisions/patterns）と任意のsession-logを初期化する。初回セットアップ時や、.claude/memory が未整備のプロジェクトで使用します。\"\nallowed-tools: [\"Read\", \"Write\"]\n---\n\n# Init Memory SSOT\n\n`.claude/memory/` 配下の **SSOT** を初期化します。\n\n- `decisions.md`（重要な意思決定のSSOT）\n- `patterns.md`（再利用できる解法のSSOT）\n- `session-log.md`（セッションログ。ローカル運用推奨）\n\n詳細方針: `docs/MEMORY_POLICY.md`\n\n---\n\n## 実行手順\n\n### Step 1: 既存ファイルの確認\n\n- `.claude/memory/decisions.md`\n- `.claude/memory/patterns.md`\n- `.claude/memory/session-log.md`\n\n存在するものは**上書きしない**。\n\n### Step 2: テンプレートから初期化（存在しない場合のみ）\n\nテンプレート:\n\n- `templates/memory/decisions.md.template`\n- `templates/memory/patterns.md.template`\n- `templates/memory/session-log.md.template`\n\n`{{DATE}}` は当日（例: `2025-12-13`）で置換して生成する。\n\n### Step 3: 完了報告\n\n- 作成したファイル一覧\n- Git方針（`decisions/patterns`は共有推奨、`session-log/.claude/state`はローカル推奨）\n\n\n",
        "opencode/skills/memory/references/workflow-migration.md": "---\nname: migrate-workflow-files\ndescription: \"既存プロジェクトのAGENTS.md/CLAUDE.md/Plans.mdを、既存内容を精査して対話で引き継ぎ項目を確定しつつ、新フォーマットへ移行（バックアップ付き・Plansはタスク保持マージ）。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Migrate Workflow Files (Interactive Merge)\n\n## 目的\n\n既存プロジェクトで運用中の以下を、**既存内容を尊重しつつ新フォーマットへアップデート**します。\n\n- `AGENTS.md`\n- `CLAUDE.md`\n- `Plans.md`\n\nポイント:\n\n- **対話形式で引き継ぎ情報を確定**（勝手に捨てない / 勝手に上書きしない）\n- 変更前に **必ずバックアップ** を残す\n- `Plans.md` は `merge-plans` の方針で **タスクを保持しつつ構造を更新**\n\n---\n\n## 前提（重要）\n\nこのスキルは「初回適用時の安全」と「意図した動作（新フォーマット）」の両立のため、\n**ユーザー合意→バックアップ→生成→差分確認**の順で進めます。\n\n---\n\n## 入力（このスキル内で自動検出してOK）\n\n- `project_name`: `basename $(pwd)` で推定\n- `date`: `YYYY-MM-DD`\n- 既存ファイルの有無:\n  - `AGENTS.md`\n  - `CLAUDE.md`\n  - `Plans.md`\n- 新フォーマットの参照テンプレ:\n  - `templates/AGENTS.md.template`\n  - `templates/CLAUDE.md.template`\n  - `templates/Plans.md.template`\n\n---\n\n## 実行フロー\n\n### Step 0: 検出と合意取り（必須）\n\n1. `Read` で既存 `AGENTS.md` / `CLAUDE.md` / `Plans.md` の存在を確認。\n2. 存在する場合はユーザーへ確認:\n   - **移行（新フォーマットへアップデート）してよいか**\n   - 重要: 移行は **内容の再整理を含む**（= 多少の配置替えや言い回し変更が起こりうる）\n\nユーザーが NO の場合:\n\n- このスキルは中止（何も書き換えない）\n- 代わりに「`.claude/settings.json` の安全マージだけ」等の安全作業を提案\n\n### Step 1: 既存内容の精査（要約）\n\n各ファイルを `Read` し、以下を抽出して短く要約して提示する:\n\n- **AGENTS.md**: 役割分担、ハンドオフ手順、禁止事項、環境/前提\n- **CLAUDE.md**: 重要な制約（禁止事項/権限/ブランチ運用）、テスト手順、コミット規約、運用ルール\n- **Plans.md**: タスク構造、マーカー運用、現在のWIP/依頼中タスク\n\n### Step 2: 引き継ぎ項目の確定（対話）\n\n要約をもとに、ユーザーに **保持/調整**したい項目を質問する（最大5〜10問で十分）:\n\n- 絶対に残すべき制約（例: 本番デプロイ禁止、特定ディレクトリ禁止、セキュリティ要件）\n- 役割分担（Solo/2-agent）の前提\n- ブランチ運用（main/staging 等）\n- テスト/ビルドの代表コマンド\n- Plans のマーカー運用（既存ルールがあれば整合）\n\n### Step 3: バックアップ作成（必須）\n\nバックアップはプロジェクト内の `.claude-code-harness/backups/` にまとめる（gitに入れたくない場合が多い）。\n\n例:\n\n- `.claude-code-harness/backups/2025-12-13/AGENTS.md`\n- `.claude-code-harness/backups/2025-12-13/CLAUDE.md`\n- `.claude-code-harness/backups/2025-12-13/Plans.md`\n\n`Bash` で `mkdir -p` と `cp` を使ってよい。\n\n### Step 4: 新フォーマットの生成（マージ）\n\n#### 4-1. Plans.md（タスク保持マージ）\n\n`merge-plans` の方針で実行:\n\n- 既存の 🔴🟡🟢📦 タスクを保持\n- マーカー凡例・最終更新情報はテンプレ側に更新\n- 解析不能ならバックアップを残してテンプレ採用\n\n#### 4-2. AGENTS.md / CLAUDE.md（テンプレ + 引き継ぎブロック）\n\nテンプレで骨格を作り、Step 2 で確定した項目を **新フォーマットの適切な場所に再配置**する。\n\n最低限の方針:\n\n- 既存の“重要ルール”は削らず、**「プロジェクト固有ルール（移行）」**のセクションとして残す\n- 役割分担/フローはテンプレの形式に合わせて書き直す（意味は維持）\n\n### Step 5: 差分確認と完了\n\n- `git diff`（またはファイル差分）で変更点を短く要約\n- 重要ポイント（権限/禁止事項/タスク状態）が意図通りか最終確認\n- 問題があれば即修正\n\n---\n\n## 成果物（完了条件）\n\n- 既存内容を踏まえた **新フォーマット版**の `AGENTS.md` / `CLAUDE.md` / `Plans.md`\n- `.claude-code-harness/backups/` にバックアップが残っている\n- Plans のタスクは消えていない（保持）\n\n\n",
        "opencode/skills/parallel-workflows/SKILL.md": "---\nname: parallel-workflows\ndescription: \"Optimizes parallel execution of multiple tasks. Use when user mentions running tasks in parallel or together. Do NOT load for: single tasks, sequential-only work, or tasks with dependencies.\"\nallowed-tools: [\"Read\", \"Task\"]\nuser-invocable: false\n---\n\n# Parallel Workflows Skill\n\n複数タスクの並列実行を最適化するスキル。\nTask ツールを活用して、独立したタスクを同時に処理します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「並列で実行して」「同時にやって」\n- 「まとめてやって」「一気にやって」\n- 「効率的にやって」「速くやって」\n- \"run in parallel\", \"do these together\"\n\n---\n\n## 関連コマンド\n\n- `/work` - Plans.md のタスクを実行（並列実行対応）\n\n---\n\n## 概要\n\nClaude Code は複数のタスクを並列実行できます。\nこのスキルは、どのタスクが並列化可能かを判断し、最適な実行計画を立てます。\n\n---\n\n## 並列化パターン\n\n### パターン1: 複数ファイルの同時分析\n\n**使用場面**: コードレビュー、構造把握\n\n```\nTask tool を並列起動:\n- agent1: src/components/ を分析\n- agent2: src/lib/ を分析\n- agent3: src/app/ を分析\n```\n\n**VibeCoder向け言い方**:\n```\n「このプロジェクトの構造を教えて」\n→ 自動的に並列分析を実行\n```\n\n### パターン2: テストとビルドの同時実行\n\n**使用場面**: CI/CD、品質チェック\n\n```\n並列実行:\n- npm run lint\n- npm run type-check\n- npm run test\n\n直列実行（依存あり）:\n- npm run build（上記が全て成功後）\n```\n\n**VibeCoder向け言い方**:\n```\n「チェックして」\n→ lint, type-check, test を並列実行\n```\n\n### パターン3: 複数機能の同時実装\n\n**使用場面**: 独立した機能の開発\n\n```\nPlans.md:\n- [ ] ヘッダーコンポーネント作成\n- [ ] フッターコンポーネント作成\n- [ ] サイドバーコンポーネント作成\n\n→ 3つのTask agentを並列起動\n```\n\n**VibeCoder向け言い方**:\n```\n「レイアウトを全部作って」\n→ 独立したコンポーネントを並列実装\n```\n\n---\n\n## 判定ロジック\n\n### 並列化可能な条件\n\n1. **ファイル依存なし**: 同じファイルを編集しない\n2. **データ依存なし**: 出力が他の入力にならない\n3. **順序依存なし**: 実行順序が結果に影響しない\n\n### 並列化不可の例\n\n```\n❌ 並列化不可:\n1. API クライアント作成\n2. API クライアントを使うコンポーネント作成\n→ 2は1の出力に依存\n\n✅ 並列化可能:\n1. ログインページ作成\n2. 会員登録ページ作成\n→ 互いに独立\n```\n\n---\n\n## 実装ガイド\n\n### Task ツールを使った並列実行\n\n```typescript\n// 並列実行パターン\nconst tasks = [\n  { name: \"タスクA\", prompt: \"...\" },\n  { name: \"タスクB\", prompt: \"...\" },\n  { name: \"タスクC\", prompt: \"...\" }\n];\n\n// 全てのタスクを run_in_background: true で起動\n// TaskOutput で結果を収集\n```\n\n### 統合レポートの生成\n\n各タスク完了後、以下の形式でレポートを生成：\n\n```markdown\n## 📊 並列タスク実行レポート\n\n**実行日時**: {{timestamp}}\n**タスク数**: {{count}}件（並列実行）\n**所要時間**: {{duration}}秒\n\n### 完了タスク\n\n| # | タスク | ステータス | 所要時間 | 成果物 |\n|---|-------|----------|---------|-------|\n{{#each tasks}}\n| {{index}} | {{name}} | {{status}} | {{duration}}秒 | {{output}} |\n{{/each}}\n\n### 変更ファイル一覧\n\n{{#each files}}\n- `{{path}}` ({{action}})\n{{/each}}\n```\n\n---\n\n## 実行例\n\n### 例1: プロジェクト分析\n\n```\nユーザー: 「このプロジェクトについて教えて」\n\nClaude Code:\n🔍 プロジェクトを並列分析中...\n\n├── [Agent 1] 構造分析中...\n├── [Agent 2] 依存関係チェック中...\n└── [Agent 3] コード品質分析中...\n\n完了！\n\n📁 プロジェクト概要:\n- フレームワーク: Next.js 14\n- 主要ディレクトリ: 15個\n- ファイル数: 87個\n- 依存パッケージ: 23個\n- コード品質: 良好（lint警告: 3件）\n```\n\n### 例2: 複数機能の実装\n\n```\nユーザー: 「ヘッダー、フッター、サイドバーを作って」\n\nClaude Code:\n📋 3つの独立タスクを検出 → 並列実行します\n\n├── [Agent 1] ヘッダー作成中... ✅ 完了\n├── [Agent 2] フッター作成中... ✅ 完了\n└── [Agent 3] サイドバー作成中... ✅ 完了\n\n⏱️ 所要時間: 45秒（直列なら2分15秒）\n```\n\n### 例3: 品質チェック\n\n```\nユーザー: 「全部チェックして」\n\nClaude Code:\n🔍 品質チェックを並列実行中...\n\n├── [Lint] ✅ 問題なし\n├── [Type] ✅ 型エラーなし\n├── [Test] ✅ 15/15 通過\n└── [Build] ✅ 成功\n\n✅ 全チェック通過！\n```\n\n---\n\n## パフォーマンス指標\n\n| シナリオ | 直列実行 | 並列実行 | 改善率 |\n|---------|---------|---------|--------|\n| 3ファイル分析 | 30秒 | 12秒 | 60% |\n| lint+test+build | 45秒 | 20秒 | 55% |\n| 3コンポーネント作成 | 3分 | 1分 | 67% |\n\n---\n\n## エラーハンドリング\n\n### 一部タスク失敗時\n\n1. 成功したタスクの結果は保持\n2. 失敗タスクのエラー詳細を表示\n3. 再実行オプションを提示\n\n```\n📊 並列実行完了（一部エラー）\n\n├── [Task 1] A作成 ✅ (25秒)\n├── [Task 2] B作成 ❌ エラー\n│   └── 原因: TypeScriptエラー\n└── [Task 3] C作成 ✅ (22秒)\n\n⚠️ 1件のタスクが失敗しました。\n失敗したタスクを再実行しますか？ (y/n)\n```\n\n---\n\n## 使用上の注意\n\n### 推奨\n\n- ✅ 独立したファイルの同時編集\n- ✅ 複数の分析タスクの並列実行\n- ✅ 非依存テストの同時実行\n\n### 非推奨\n\n- ❌ 同一ファイルへの同時書き込み\n- ❌ 依存関係のあるタスクの並列化\n- ❌ データベースマイグレーションの並列実行\n\n---\n\n## VibeCoder 向けまとめ\n\n| やりたいこと | 言い方 | 並列化 |\n|-------------|--------|--------|\n| 複数ページ作成 | 「ページを全部作って」 | ✅ 自動 |\n| コード分析 | 「このプロジェクトを分析して」 | ✅ 自動 |\n| 品質チェック | 「チェックして」 | ✅ 自動 |\n| 順番に実装 | 「順番にやって」 | ❌ 直列 |\n\n**ポイント**: 特に意識しなくても、Claude Code が自動的に並列化可能なタスクを判断して最適化します。\n",
        "opencode/skills/parallel-workflows/references/build-dependency-graph.md": "---\nname: build-dependency-graph\ndescription: \"Build dependency graph from Plans.md tasks to determine parallel execution groups. Analyzes task descriptions to extract target files and infer dependencies.\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\"]\n---\n\n# Build Dependency Graph\n\nPlans.mdのタスクから依存関係を解析し、並列実行可能なグループを決定するスキル。\n\n---\n\n## 入力\n\n- **Plans.md**: タスク一覧を含むファイル\n- **target_tasks**: 実行対象のタスクリスト（plans-managementスキルから取得）\n\n---\n\n## 出力\n\n```json\n{\n  \"parallel_groups\": [\n    {\n      \"group_id\": 1,\n      \"tasks\": [\"task1\", \"task2\", \"task3\"],\n      \"can_parallelize\": true,\n      \"reason\": \"独立したファイルを編集\"\n    },\n    {\n      \"group_id\": 2,\n      \"tasks\": [\"task4\"],\n      \"can_parallelize\": false,\n      \"reason\": \"group1の出力に依存\",\n      \"depends_on\": [1]\n    }\n  ],\n  \"task_files\": {\n    \"task1\": [\"src/components/Header.tsx\"],\n    \"task2\": [\"src/components/Footer.tsx\"],\n    \"task3\": [\"src/components/Sidebar.tsx\"],\n    \"task4\": [\"src/components/Layout.tsx\"]\n  }\n}\n```\n\n---\n\n## 依存関係判定ルール\n\n### 並列化可能な条件\n\n1. **別ファイルを編集**: タスクが異なるファイルを編集する\n2. **データ依存なし**: タスクAの出力がタスクBの入力にならない\n3. **順序依存なし**: 実行順序が結果に影響しない\n\n### 並列化不可の条件\n\n1. **同一ファイル編集**: 複数タスクが同じファイルを編集する\n2. **import依存**: タスクAが作成するファイルをタスクBがimportする\n3. **明示的な依存**: Plans.mdに`depends:T001`などの依存記法がある\n\n---\n\n## 実行手順\n\n### Step 1: Plans.mdからタスクと対象ファイルを抽出\n\n```bash\n# Plans.mdを読み込む\ncat Plans.md\n\n# タスク行を抽出（マーカー付き）\ngrep -E \"^\\s*- \\[ \\].*`cc:(TODO|WIP)`\" Plans.md\n\n# タスク説明からファイルパスを抽出\n# パターン例:\n# - \"src/components/Header.tsx を作成\"\n# - \"Header.tsx を実装\"\n# - \"関連ファイル: src/components/Header.tsx\"\n```\n\n### Step 2: ファイル依存関係の推定\n\n#### 2.1: ファイル名から依存を推定\n\n```bash\n# 各タスクの対象ファイルをリスト化\n# 例:\n# task1: [\"src/components/Header.tsx\"]\n# task2: [\"src/components/Footer.tsx\"]\n# task3: [\"src/components/Layout.tsx\"]  # Header.tsx, Footer.tsx を import する可能性\n```\n\n#### 2.2: import文の確認（既存ファイルがある場合）\n\n```bash\n# Layout.tsxが既に存在する場合、import文を確認\ngrep -E \"import.*from.*['\\\"](\\.\\.?/.*Header|\\.\\.?/.*Footer)\" src/components/Layout.tsx\n\n# 存在する場合、Layout作成タスクはHeader/Footer作成タスクに依存\n```\n\n#### 2.3: Plans.mdの依存記法を確認\n\n```bash\n# depends:記法を抽出\ngrep -E \"depends:[T0-9,]+\" Plans.md\n\n# 例: \"depends:T001,T002\" → タスクIDで依存関係を特定\n```\n\n### Step 3: 依存グラフの構築\n\n```\n判定ロジック:\n├── 同一ファイル編集 → 競合 → 直列実行\n├── import依存あり → 依存 → A→B の順序\n├── depends:記法あり → 依存 → 指定順序\n└── 互いに独立 → 並列可能 → 同一グループ\n```\n\n### Step 4: 並列グループの決定\n\n```javascript\n// 疑似コード例\nconst groups = [];\nlet currentGroup = { group_id: 1, tasks: [], depends_on: [] };\n\nfor (const task of target_tasks) {\n  if (hasDependency(task, currentGroup.tasks)) {\n    // 依存がある場合は新しいグループ\n    groups.push(currentGroup);\n    currentGroup = { group_id: groups.length + 1, tasks: [task], depends_on: [groups.length] };\n  } else {\n    // 依存がない場合は現在のグループに追加\n    currentGroup.tasks.push(task);\n  }\n}\ngroups.push(currentGroup);\n```\n\n---\n\n## 出力フォーマット\n\n### parallel_groups\n\n各グループの構造：\n\n```json\n{\n  \"group_id\": 1,\n  \"tasks\": [\"task1\", \"task2\", \"task3\"],\n  \"can_parallelize\": true,\n  \"reason\": \"独立したファイルを編集\",\n  \"depends_on\": []\n}\n```\n\n| フィールド | 説明 |\n|-----------|------|\n| `group_id` | グループ番号（実行順序） |\n| `tasks` | このグループに含まれるタスクIDのリスト |\n| `can_parallelize` | グループ内で並列実行可能か |\n| `reason` | 判定理由（デバッグ用） |\n| `depends_on` | 依存しているグループIDのリスト |\n\n### task_files\n\n各タスクが編集するファイルのマッピング：\n\n```json\n{\n  \"task1\": [\"src/components/Header.tsx\"],\n  \"task2\": [\"src/components/Footer.tsx\"]\n}\n```\n\n---\n\n## 使用例\n\n### 例1: 独立したコンポーネント作成\n\n**Plans.md**:\n```markdown\n- [ ] Headerコンポーネント作成 `cc:TODO`\n  - 関連ファイル: src/components/Header.tsx\n- [ ] Footerコンポーネント作成 `cc:TODO`\n  - 関連ファイル: src/components/Footer.tsx\n- [ ] Sidebarコンポーネント作成 `cc:TODO`\n  - 関連ファイル: src/components/Sidebar.tsx\n```\n\n**出力**:\n```json\n{\n  \"parallel_groups\": [\n    {\n      \"group_id\": 1,\n      \"tasks\": [\"Header作成\", \"Footer作成\", \"Sidebar作成\"],\n      \"can_parallelize\": true,\n      \"reason\": \"独立したファイルを編集\",\n      \"depends_on\": []\n    }\n  ],\n  \"task_files\": {\n    \"Header作成\": [\"src/components/Header.tsx\"],\n    \"Footer作成\": [\"src/components/Footer.tsx\"],\n    \"Sidebar作成\": [\"src/components/Sidebar.tsx\"]\n  }\n}\n```\n\n### 例2: 依存関係あり\n\n**Plans.md**:\n```markdown\n- [ ] Headerコンポーネント作成 `cc:TODO`\n  - 関連ファイル: src/components/Header.tsx\n- [ ] Footerコンポーネント作成 `cc:TODO`\n  - 関連ファイル: src/components/Footer.tsx\n- [ ] Layoutコンポーネント作成 `cc:TODO` depends:Header,Footer\n  - 関連ファイル: src/components/Layout.tsx\n```\n\n**出力**:\n```json\n{\n  \"parallel_groups\": [\n    {\n      \"group_id\": 1,\n      \"tasks\": [\"Header作成\", \"Footer作成\"],\n      \"can_parallelize\": true,\n      \"reason\": \"独立したファイルを編集\",\n      \"depends_on\": []\n    },\n    {\n      \"group_id\": 2,\n      \"tasks\": [\"Layout作成\"],\n      \"can_parallelize\": false,\n      \"reason\": \"group1の出力に依存\",\n      \"depends_on\": [1]\n    }\n  ],\n  \"task_files\": {\n    \"Header作成\": [\"src/components/Header.tsx\"],\n    \"Footer作成\": [\"src/components/Footer.tsx\"],\n    \"Layout作成\": [\"src/components/Layout.tsx\"]\n  }\n}\n```\n\n---\n\n## 注意事項\n\n- **ファイルパス抽出の精度**: タスク説明から正確にファイルパスを抽出できない場合、`task_files`が空になる可能性がある\n- **既存ファイルの確認**: import依存を正確に判定するには、既存ファイルのimport文を確認する必要がある\n- **依存記法の優先**: Plans.mdに`depends:`記法がある場合、それを最優先で使用する\n- **安全側に倒す**: 依存関係が不明確な場合は並列化しない（安全側に倒す）\n",
        "opencode/skills/parallel-workflows/references/merge-worktrees.md": "---\nname: merge-worktrees\ndescription: \"Merge worktree branches back to main branch before Phase3 commit. Detects conflicts and reports to user.\"\nallowed-tools: [\"Bash\", \"Read\", \"Grep\"]\n---\n\n# Merge Worktrees\n\nPhase3（コミット実行）の前に、各worktreeブランチをメインブランチにマージするスキル。\n\n---\n\n## 入力\n\n- **worktree_branches**: 各タスクIDに対応するworktreeブランチ名\n- **base_branch**: ベースブランチ（デフォルト: `main`または`master`）\n- **worker_results**: Phase1のtask-worker実行結果\n- **commit_strategy**: `task` / `phase` / `all`\n\n---\n\n## 出力\n\n```json\n{\n  \"merged\": true,\n  \"merged_branches\": [\"worktree/task1\", \"worktree/task2\"],\n  \"conflicts\": [],\n  \"conflict_files\": []\n}\n```\n\nまたは、競合がある場合：\n\n```json\n{\n  \"merged\": false,\n  \"merged_branches\": [],\n  \"conflicts\": [\n    {\n      \"branch\": \"worktree/task1\",\n      \"files\": [\"src/components/Layout.tsx\"],\n      \"reason\": \"同一行への変更\"\n    }\n  ],\n  \"conflict_files\": [\"src/components/Layout.tsx\"]\n}\n```\n\n---\n\n## 実行手順\n\n### Step 1: ベースブランチの確認とチェックアウト\n\n```bash\n# 現在のブランチを確認\nCURRENT_BRANCH=$(git branch --show-current)\n\n# ベースブランチを確認\nif git show-ref --verify --quiet refs/heads/main; then\n  BASE_BRANCH=\"main\"\nelif git show-ref --verify --quiet refs/heads/master; then\n  BASE_BRANCH=\"master\"\nelse\n  BASE_BRANCH=\"$CURRENT_BRANCH\"\nfi\n\n# ベースブランチにチェックアウト\ngit checkout \"$BASE_BRANCH\"\n```\n\n### Step 2: 各worktreeブランチを順次マージ\n\n```bash\nCONFLICTS=()\n\nfor branch in \"${worktree_branches[@]}\"; do\n  echo \"Merging $branch into $BASE_BRANCH...\"\n  \n  # マージを試行\n  if [ \"$commit_strategy\" = \"task\" ]; then\n    # task: 既存のコミットを保持するため通常マージ\n    if git merge --no-ff --no-edit \"$branch\"; then\n      echo \"✅ Merged $branch (preserve commits)\"\n    else\n      CONFLICTS+=(\"$branch\")\n      echo \"⚠️ Conflict detected in $branch\"\n      CONFLICT_FILES=$(git diff --name-only --diff-filter=U)\n      echo \"Conflict files: $CONFLICT_FILES\"\n      git merge --abort\n    fi\n  else\n    # phase/all: 単一コミットにまとめるためsquashマージ\n    if git merge --squash \"$branch\"; then\n      echo \"✅ Squashed $branch (no commit)\"\n    else\n      CONFLICTS+=(\"$branch\")\n      echo \"⚠️ Conflict detected in $branch\"\n      CONFLICT_FILES=$(git diff --name-only --diff-filter=U)\n      echo \"Conflict files: $CONFLICT_FILES\"\n      git merge --abort\n    fi\n  fi\ndone\n```\n\n### Step 3: 3-way mergeの自動解消試行\n\n競合が発生した場合、自動解消を試行：\n\n```bash\n# 競合ファイルごとに処理\nfor file in $CONFLICT_FILES; do\n  # 変更内容を確認\n  git diff \"$BASE_BRANCH\" \"$branch\" -- \"$file\"\n  \n  # 自動マージ可能か判定\n  # - 異なる行への変更 → 自動マージ可能\n  # - 同一行への変更 → 手動解決必要\ndone\n```\n\n### Step 4: 競合レポートの生成\n\n競合がある場合、ユーザーに報告：\n\n```markdown\n⚠️ マージ競合が検出されました\n\n以下のブランチで競合が発生しています：\n\n| ブランチ | 競合ファイル | 理由 |\n|---------|-------------|------|\n| worktree/task1 | src/components/Layout.tsx | 同一行への変更 |\n| worktree/task2 | src/utils/helpers.ts | 同一行への変更 |\n\n**対応方法**:\n1. 手動で競合を解決してから続行\n2. 該当タスクをスキップして続行\n3. マージを中止して最初からやり直す\n\nどれを選択しますか？\n```\n\n---\n\n## 競合検出ロジック\n\n### 自動マージ可能なケース\n\n1. **異なるファイルへの変更**: タスクが異なるファイルを編集\n2. **異なる行への変更**: 同じファイルでも異なる行を編集\n3. **片方が削除、片方が追加**: 一方が削除、他方が追加\n\n### 手動解決が必要なケース\n\n1. **同一行への変更**: 複数のタスクが同じ行を変更\n2. **依存関係の競合**: タスクAが作成したファイルをタスクBが削除\n3. **構造的な競合**: 同じ関数/クラスを複数タスクが変更\n\n---\n\n## 使用例\n\n### 例1: 競合なしのマージ\n\n**入力**:\n```json\n{\n  \"worktree_branches\": [\n    \"worktree/Header作成\",\n    \"worktree/Footer作成\",\n    \"worktree/Sidebar作成\"\n  ],\n  \"base_branch\": \"main\"\n}\n```\n\n**実行**:\n```bash\ngit checkout main\ngit merge --no-commit --no-ff worktree/Header作成\ngit commit -m \"Merge worktree/Header作成 into main\"\n\ngit merge --no-commit --no-ff worktree/Footer作成\ngit commit -m \"Merge worktree/Footer作成 into main\"\n\ngit merge --no-commit --no-ff worktree/Sidebar作成\ngit commit -m \"Merge worktree/Sidebar作成 into main\"\n```\n\n**出力**:\n```json\n{\n  \"merged\": true,\n  \"merged_branches\": [\n    \"worktree/Header作成\",\n    \"worktree/Footer作成\",\n    \"worktree/Sidebar作成\"\n  ],\n  \"conflicts\": [],\n  \"conflict_files\": []\n}\n```\n\n### 例2: 競合ありのマージ\n\n**入力**:\n```json\n{\n  \"worktree_branches\": [\n    \"worktree/Layout作成\",\n    \"worktree/Page作成\"\n  ],\n  \"base_branch\": \"main\"\n}\n```\n\n**状況**: `Layout作成`と`Page作成`が両方`src/app/layout.tsx`の同じ行を変更\n\n**実行**:\n```bash\ngit checkout main\ngit merge --no-commit --no-ff worktree/Layout作成\n# ✅ 成功\n\ngit merge --no-commit --no-ff worktree/Page作成\n# ⚠️ 競合発生: src/app/layout.tsx\ngit merge --abort\n```\n\n**出力**:\n```json\n{\n  \"merged\": false,\n  \"merged_branches\": [\"worktree/Layout作成\"],\n  \"conflicts\": [\n    {\n      \"branch\": \"worktree/Page作成\",\n      \"files\": [\"src/app/layout.tsx\"],\n      \"reason\": \"同一行への変更\"\n    }\n  ],\n  \"conflict_files\": [\"src/app/layout.tsx\"]\n}\n```\n\n---\n\n## マージ後のクリーンアップ\n\nマージ完了後、worktreeを削除：\n\n```bash\n# 各worktreeを削除\nfor task_id in \"${task_ids[@]}\"; do\n  WORKTREE_DIR=\".worktrees/${task_id}-worktree\"\n  WORKTREE_BRANCH=\"worktree/${task_id}\"\n  \n  # worktreeを削除\n  git worktree remove \"$WORKTREE_DIR\"\n  \n  # ブランチを削除（オプション）\n  git branch -D \"$WORKTREE_BRANCH\"\ndone\n\n# 不要なworktreeをクリーンアップ\ngit worktree prune\n```\n\n---\n\n## 注意事項\n\n- **マージ順序**: 依存関係を考慮してマージ順序を決定（依存グラフの順序に従う）\n- **競合時の処理**: 競合が発生した場合、ユーザーに手動解決を依頼する\n- **worktree削除**: マージ完了後にworktreeを削除してクリーンアップする\n- **3-way merge**: 可能な限り3-way mergeで自動解消を試みる\n- **コミットメッセージ**: マージコミットには適切なメッセージを付与する\n",
        "opencode/skills/parallel-workflows/references/run-task-workers.md": "---\nname: run-task-workers\ndescription: \"Execute task-worker agents in parallel for each group. Collects commit_ready/needs_escalation status from each worker.\"\nallowed-tools: [\"Read\", \"Task\", \"Bash\"]\n---\n\n# Run Task Workers\n\n依存グラフで決定された並列グループごとに`task-worker`エージェントを起動し、結果を集約するスキル。\n\n---\n\n## 入力\n\n- **parallel_groups**: 依存グラフから取得した並列実行グループ\n- **task_files**: 各タスクが編集するファイルのマッピング\n- **parallel_count**: 同時実行数の上限（デフォルト: 1）\n- **max_iterations**: 改善ループの上限（デフォルト: 3）\n- **isolation_mode**: `lock`または`worktree`\n- **commit_strategy**: `task` / `phase` / `all`\n- **worktree_paths**: `isolation_mode=worktree`時の作業ディレクトリパス（オプション）\n\n---\n\n## 出力\n\n```json\n{\n  \"worker_results\": [\n    {\n      \"task_id\": \"task1\",\n      \"status\": \"commit_ready\",\n      \"iterations\": 2,\n      \"changes\": [\n        { \"file\": \"src/components/Header.tsx\", \"action\": \"created\" }\n      ],\n      \"self_review\": {\n        \"quality\": { \"grade\": \"A\", \"issues\": [] },\n        \"security\": { \"grade\": \"A\", \"issues\": [] },\n        \"performance\": { \"grade\": \"A\", \"issues\": [] },\n        \"compatibility\": { \"grade\": \"A\", \"issues\": [] }\n      },\n      \"build_result\": \"pass\",\n      \"test_result\": \"pass\"\n    },\n    {\n      \"task_id\": \"task2\",\n      \"status\": \"needs_escalation\",\n      \"escalation_reason\": \"max_iterations_exceeded\",\n      \"context\": {\n        \"attempted_fixes\": [\"型エラー修正\", \"import パス修正\"],\n        \"remaining_issues\": [\n          {\n            \"file\": \"src/utils/helpers.ts\",\n            \"line\": 42,\n            \"issue\": \"型 'unknown' を 'User' に変換できません\"\n          }\n        ]\n      }\n    }\n  ],\n  \"all_ready\": false,\n  \"escalation_count\": 1,\n  \"changed_files\": [\n    \"src/components/Header.tsx\",\n    \"src/components/Footer.tsx\"\n  ]\n}\n```\n\n---\n\n## 実行手順\n\n### Step 1: 並列グループを順次処理\n\n各グループは前のグループ完了後に実行（依存関係を考慮）。\n\n```javascript\n// 疑似コード例\nfor (const group of parallel_groups) {\n  if (group.depends_on.length > 0) {\n    // 依存グループの完了を待つ\n    await waitForGroups(group.depends_on);\n  }\n  \n  // グループ内のタスクを並列実行（parallel_countで上限を制御）\n  await executeGroupInParallel(group, parallel_count);\n}\n```\n\n### Step 2: グループ内タスクの並列起動\n\n各グループ内で`Task`ツールを使用して`task-worker`を並列起動：\n\n```yaml\n# Task tool呼び出し例（1つのレスポンス内で複数並列）\nTask:\n  subagent_type: \"task-worker\"\n  run_in_background: true\n  prompt: |\n    タスク: {{task_description}}\n    対象ファイル: {{task_files[task_id]}}\n    max_iterations: {{max_iterations}}\n    review_depth: \"standard\"\n```\n\n**重要**: `run_in_background: true`で起動し、`TaskOutput`で結果を収集。\n\n### Step 3: 結果の収集と待機\n\n```javascript\n// 疑似コード例\nconst results = [];\nfor (const taskId of group.tasks) {\n  const taskOutput = await getTaskOutput(taskId);\n  results.push({\n    task_id: taskId,\n    status: taskOutput.status, // \"commit_ready\" | \"needs_escalation\" | \"failed\"\n    ...taskOutput\n  });\n}\n```\n\n### Step 3.5: commit_strategy に応じた処理\n\n#### commit_strategy = task\n各task-worker完了時にコミットを実行（task単位でcommit）:\n\n```bash\n# task-worker内で実行\ngit add {{task_files[task_id]}}\ngit commit -m \"feat: {{task_id}}\"\n```\n\n#### commit_strategy = phase / all\nこのスキルではコミットしない（Phase3のexecute-commitで実行）。\n\n### Step 4: エスカレーションの集約\n\n`needs_escalation`が返されたタスクを集約：\n\n```markdown\n⚠️ エスカレーション（{{escalation_count}}件）\n\n{{#each escalation_tasks}}\nタスク{{task_id}}: {{escalation_reason}}\n  → 提案: {{suggestion}}\n\n{{/each}}\n\nどう対応しますか？\n1. 提案を適用して続行\n2. スキップして次へ\n3. 手動で修正する\n```\n\n### Step 5: changed_files の集約\n\n```javascript\n// 疑似コード例\nconst changedFiles = new Set();\nfor (const result of results) {\n  if (result.changes) {\n    for (const change of result.changes) {\n      changedFiles.add(change.file);\n    }\n  }\n}\n```\n\n---\n\n## isolation_mode別の処理\n\n### `isolation_mode=lock`（デフォルト）\n\n- 同一worktreeでファイルロックを使用\n- 各task-workerは同じディレクトリで動作\n- ファイル競合はロックで防止\n\n### `isolation_mode=worktree`\n\n- 各タスクに`git worktree add`でブランチ作成\n- `worktree_paths`が提供されている場合、それを使用\n- 各task-workerは独立したworktreeで動作\n- 完全な並列ビルド/テストが可能\n\n**worktree使用時のTask tool呼び出し**:\n\n```yaml\nTask:\n  subagent_type: \"task-worker\"\n  run_in_background: true\n  cwd: \"{{worktree_paths[task_id]}}\"  # worktreeパスを指定\n  prompt: |\n    タスク: {{task_description}}\n    対象ファイル: {{task_files[task_id]}}\n    max_iterations: {{max_iterations}}\n```\n\n---\n\n## 進捗表示\n\n実行中は以下の形式で進捗を表示：\n\n```markdown\n📊 Phase 1 進捗: 2/5 完了\n\n├── [worker-1] Header.tsx ✅ commit_ready (35秒)\n├── [worker-2] Footer.tsx ✅ commit_ready (28秒)\n├── [worker-3] Sidebar.tsx ⏳ セルフレビュー中...\n├── [worker-4] Utils.ts ⏳ 実装中...\n└── [worker-5] Types.ts 🔜 待機中（依存: Utils.ts）\n```\n\n---\n\n## エラーハンドリング\n\n### 一部タスク失敗時\n\n- 成功したタスクの結果は保持\n- 失敗タスクのみ再実行オプションを提示\n- `needs_escalation`はユーザー確認待ち\n\n### 全タスク失敗時\n\n- 共通の原因がある可能性を分析\n- 依存ファイルの不足などを確認\n- 実行順序の見直しを提案\n\n---\n\n## 使用例\n\n### 例1: 3並列実行\n\n**入力**:\n```json\n{\n  \"parallel_groups\": [\n    {\n      \"group_id\": 1,\n      \"tasks\": [\"Header作成\", \"Footer作成\", \"Sidebar作成\"],\n      \"can_parallelize\": true\n    }\n  ],\n  \"task_files\": {\n    \"Header作成\": [\"src/components/Header.tsx\"],\n    \"Footer作成\": [\"src/components/Footer.tsx\"],\n    \"Sidebar作成\": [\"src/components/Sidebar.tsx\"]\n  },\n  \"parallel_count\": 3,\n  \"max_iterations\": 3,\n  \"isolation_mode\": \"lock\",\n  \"commit_strategy\": \"task\"\n}\n```\n\n**実行**:\n```\nTask tool で3つのtask-workerを並列起動:\n- worker-1: Header作成\n- worker-2: Footer作成\n- worker-3: Sidebar作成\n\n全員の完了を待機 → 結果を集約\n```\n\n**出力**:\n```json\n{\n  \"worker_results\": [\n    { \"task_id\": \"Header作成\", \"status\": \"commit_ready\", ... },\n    { \"task_id\": \"Footer作成\", \"status\": \"commit_ready\", ... },\n    { \"task_id\": \"Sidebar作成\", \"status\": \"commit_ready\", ... }\n  ],\n  \"all_ready\": true,\n  \"escalation_count\": 0,\n  \"changed_files\": [\n    \"src/components/Header.tsx\",\n    \"src/components/Footer.tsx\",\n    \"src/components/Sidebar.tsx\"\n  ]\n}\n```\n\n---\n\n## 注意事項\n\n- **並列数の上限**: `parallel_count`で指定された数を超えない（デフォルト: 1、上限: 10）\n- **依存グループの待機**: 依存グループが完了するまで次のグループは実行しない\n- **エスカレーション処理**: `needs_escalation`が返された場合、ユーザー確認を待つ\n- **worktreeクリーンアップ**: `isolation_mode=worktree`時は後でworktreeを削除する必要がある（Phase3でマージ後）\n",
        "opencode/skills/parallel-workflows/references/setup-worktrees.md": "---\nname: setup-worktrees\ndescription: \"Create git worktrees for parallel task execution. Each task gets its own worktree branch for complete isolation.\"\nallowed-tools: [\"Bash\", \"Read\"]\n---\n\n# Setup Worktrees\n\n`--isolation=worktree`指定時に、各タスク用のgit worktreeを作成するスキル。\n\n---\n\n## 入力\n\n- **parallel_groups**: 依存グラフから取得した並列実行グループ\n- **task_files**: 各タスクが編集するファイルのマッピング\n- **base_branch**: ベースブランチ（デフォルト: `main`または`master`）\n\n---\n\n## 出力\n\n```json\n{\n  \"worktree_paths\": {\n    \"task1\": \"/path/to/project/.worktrees/task1-worktree\",\n    \"task2\": \"/path/to/project/.worktrees/task2-worktree\",\n    \"task3\": \"/path/to/project/.worktrees/task3-worktree\"\n  },\n  \"worktree_task_slugs\": {\n    \"task1\": \"task1\",\n    \"task2\": \"task2\",\n    \"task3\": \"task3\"\n  },\n  \"worktree_branches\": [\n    \"worktree/task1\",\n    \"worktree/task2\",\n    \"worktree/task3\"\n  ],\n  \"worktree_branch_map\": {\n    \"task1\": \"worktree/task1\",\n    \"task2\": \"worktree/task2\",\n    \"task3\": \"worktree/task3\"\n  }\n}\n```\n\n---\n\n## 実行手順\n\n### Step 1: ベースブランチの確認\n\n```bash\n# 現在のブランチを確認\nCURRENT_BRANCH=$(git branch --show-current)\n\n# デフォルトブランチを確認（main または master）\nif git show-ref --verify --quiet refs/heads/main; then\n  BASE_BRANCH=\"main\"\nelif git show-ref --verify --quiet refs/heads/master; then\n  BASE_BRANCH=\"master\"\nelse\n  BASE_BRANCH=\"$CURRENT_BRANCH\"\nfi\n```\n\n### Step 2: worktreeディレクトリの準備\n\n```bash\n# .worktreesディレクトリを作成（存在しない場合）\nmkdir -p .worktrees\n\n# .gitignoreに追加（既に追加されていない場合）\nif ! grep -q \"^\\.worktrees$\" .gitignore 2>/dev/null; then\n  echo \".worktrees\" >> .gitignore\nfi\n```\n\n### Step 3: 各タスク用のworktreeを作成\n\n**安全なブランチ名の生成**:\nタスクIDにスペース/記号/日本語が含まれる場合は、ブランチ名として使えるスラッグに変換する。\n\n```bash\n# 例: \"Header 作成\" → \"header-sakusei\"\n# 例: \"T001:認証\" → \"t001-auth\"\nslugify() {\n  echo \"$1\" | tr '[:upper:]' '[:lower:]' | sed -E 's/[^a-z0-9]+/-/g' | sed -E 's/^-+|-+$//g'\n}\n```\n\n```bash\n# 各タスクに対して\nfor task_id in \"${task_ids[@]}\"; do\n  TASK_SLUG=$(slugify \"$task_id\")\n  WORKTREE_DIR=\".worktrees/${TASK_SLUG}-worktree\"\n  WORKTREE_BRANCH=\"worktree/${TASK_SLUG}\"\n  \n  # ブランチを作成（ベースブランチから）\n  git branch \"$WORKTREE_BRANCH\" \"$BASE_BRANCH\" 2>/dev/null || true\n  \n  # worktreeを作成\n  git worktree add \"$WORKTREE_DIR\" \"$WORKTREE_BRANCH\"\n  \n  echo \"Created worktree: $WORKTREE_DIR (branch: $WORKTREE_BRANCH)\"\ndone\n```\n\n### Step 4: pnpm使用時の容量節約（オプション）\n\npnpmを使用している場合、shared storeを活用：\n\n```bash\n# pnpmの場合、node_modulesはシンボリックリンクで共有される\n# 各worktreeでpnpm installを実行しても容量は+54MB程度\ncd \"$WORKTREE_DIR\"\npnpm install  # shared storeを使用\n```\n\n---\n\n## 出力フォーマット\n\n### worktree_paths\n\n各タスクIDに対応するworktreeディレクトリのパス：\n\n```json\n{\n  \"task1\": \"/absolute/path/to/project/.worktrees/task1-worktree\",\n  \"task2\": \"/absolute/path/to/project/.worktrees/task2-worktree\"\n}\n```\n\n### worktree_task_slugs\n\nタスクIDとスラッグの対応表：\n\n```json\n{\n  \"Header 作成\": \"header-sakusei\",\n  \"T001:認証\": \"t001-auth\"\n}\n```\n\n### worktree_branches\n\n各タスクIDに対応するworktreeブランチ名：\n\n```json\n[\n  \"worktree/task1\",\n  \"worktree/task2\"\n]\n```\n\n### worktree_branch_map（オプション）\n\nタスクIDとブランチ名の対応表：\n\n```json\n{\n  \"task1\": \"worktree/task1\",\n  \"task2\": \"worktree/task2\"\n}\n```\n\n---\n\n## 使用例\n\n### 例1: 3タスクのworktree作成\n\n**入力**:\n```json\n{\n  \"parallel_groups\": [\n    {\n      \"group_id\": 1,\n      \"tasks\": [\"Header作成\", \"Footer作成\", \"Sidebar作成\"]\n    }\n  ],\n  \"task_files\": {\n    \"Header作成\": [\"src/components/Header.tsx\"],\n    \"Footer作成\": [\"src/components/Footer.tsx\"],\n    \"Sidebar作成\": [\"src/components/Sidebar.tsx\"]\n  }\n}\n```\n\n**実行**:\n```bash\n# Header作成用\ngit worktree add .worktrees/Header作成-worktree worktree/Header作成\n\n# Footer作成用\ngit worktree add .worktrees/Footer作成-worktree worktree/Footer作成\n\n# Sidebar作成用\ngit worktree add .worktrees/Sidebar作成-worktree worktree/Sidebar作成\n```\n\n**出力**:\n```json\n{\n  \"worktree_paths\": {\n    \"Header作成\": \"/path/to/project/.worktrees/Header作成-worktree\",\n    \"Footer作成\": \"/path/to/project/.worktrees/Footer作成-worktree\",\n    \"Sidebar作成\": \"/path/to/project/.worktrees/Sidebar作成-worktree\"\n  },\n  \"worktree_branches\": {\n    \"Header作成\": \"worktree/Header作成\",\n    \"Footer作成\": \"worktree/Footer作成\",\n    \"Sidebar作成\": \"worktree/Sidebar作成\"\n  }\n}\n```\n\n---\n\n## 注意事項\n\n- **既存worktreeの確認**: 同じタスクIDのworktreeが既に存在する場合は削除してから作成\n- **ブランチ名の衝突**: `worktree/{task_id}`形式のブランチ名が既に存在する場合は番号を付与\n- **.gitignoreへの追加**: `.worktrees`ディレクトリは`.gitignore`に追加する（既に追加されていない場合）\n- **pnpm使用時**: pnpmのshared storeにより、各worktreeの`node_modules`は約54MBで済む\n- **クリーンアップ**: Phase3完了後、`merge-worktrees`スキルでマージし、その後worktreeを削除する\n\n---\n\n## トラブルシューティング\n\n### Q: worktree作成時にエラーが発生\n\n**A**: 既存のworktreeやブランチを確認：\n\n```bash\n# 既存worktree一覧\ngit worktree list\n\n# 既存ブランチ一覧\ngit branch -a | grep worktree\n\n# 必要に応じて削除\ngit worktree remove .worktrees/task1-worktree\ngit branch -D worktree/task1\n```\n\n### Q: pnpm installが遅い\n\n**A**: shared storeが正しく設定されているか確認：\n\n```bash\n# pnpm store pathを確認\npnpm store path\n\n# 各worktreeで同じstoreを使用していることを確認\ncd .worktrees/task1-worktree\npnpm store path  # 同じパスが表示されるはず\n```\n",
        "opencode/skills/plans-management/SKILL.md": "---\nname: plans-management\ndescription: \"Manages Plans.md tasks and marker operations. Use when user mentions adding tasks, updating Plans.md, marking complete, or changing task status. Do NOT load for: implementation work, reviews, or non-Plans file operations.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\"]\n---\n\n# Plans Management Skill\n\nPlans.md のタスク管理とマーカー運用を行うスキル。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで起動します：\n\n- 「タスクを追加して」\n- 「Plans.md を更新して」\n- 「完了マークをつけて」\n- 「タスクの状態を変更して」\n- \"add a task\"\n- \"update plans\"\n- \"mark as complete\"\n\n---\n\n## 概要\n\nこのスキルは Plans.md の編集・更新を支援します。\nタスクの追加、状態変更、アーカイブを一貫したフォーマットで行います。\n\n---\n\n## Plans.md の構造\n\n```markdown\n# Plans.md - タスク管理\n\n> **最終更新**: YYYY-MM-DD HH:MM\n> **更新者**: Claude Code / PM（Cursor/PM Claude）\n\n---\n\n## 🔴 進行中のタスク\n\n- [ ] タスク名 `cc:WIP`\n  - 詳細説明\n  - 関連ファイル: `path/to/file.ts`\n\n---\n\n## 🟡 未着手のタスク\n\n- [ ] タスク名 `cc:TODO`\n- [ ] タスク名 `pm:依頼中`（互換: cursor:依頼中）\n\n---\n\n## 🟢 完了タスク\n\n- [x] タスク名 `pm:確認済` (YYYY-MM-DD)\n\n---\n\n## 📦 アーカイブ\n\n<!-- 古い完了タスクはここに移動 -->\n```\n\n---\n\n## マーカー運用ルール\n\n### 状態変更のルール\n\n| 変更 | 実行者 | 条件 |\n|------|--------|------|\n| `pm:依頼中`（互換: cursor:依頼中） → `cc:WIP` | Claude Code | タスク着手時 |\n| `cc:TODO` → `cc:WIP` | Claude Code | タスク着手時 |\n| `cc:WIP` → `cc:完了` | Claude Code | 作業完了時 |\n| `cc:完了` → `pm:確認済`（互換: cursor:確認済） | PM | レビュー完了時 |\n| `*` → `blocked` | どちらでも | ブロック発生時 |\n\n### マーカーのフォーマット\n\n```markdown\n# 正しい例\n- [ ] タスク名 `cc:WIP`\n- [x] タスク名 `cc:完了` (2024-01-15)\n\n# 間違った例\n- [ ] タスク名 cc:WIP      # バッククォートなし\n- [ ] タスク名 `cc: WIP`   # スペースあり\n```\n\n---\n\n## タスク操作\n\n### タスクの追加\n\n```markdown\n## 追加前\n## 🟡 未着手のタスク\n\n- [ ] 既存タスク `cc:TODO`\n\n## 追加後\n## 🟡 未着手のタスク\n\n- [ ] 既存タスク `cc:TODO`\n- [ ] 新規タスク `cc:TODO`\n  - 詳細説明（あれば）\n```\n\n### タスクの状態変更\n\n```markdown\n## 変更前\n- [ ] タスク名 `cc:TODO`\n\n## 変更後\n- [ ] タスク名 `cc:WIP`\n```\n\n### タスクの完了\n\n```markdown\n## 変更前\n- [ ] タスク名 `cc:WIP`\n\n## 変更後\n- [x] タスク名 `cc:完了` (2024-01-15)\n```\n\n### タスクのアーカイブ\n\n完了から 7日以上経過したタスクはアーカイブセクションに移動：\n\n```markdown\n## 📦 アーカイブ\n\n### 2024年1月\n- [x] タスク1 `pm:確認済` (2024-01-10)\n- [x] タスク2 `pm:確認済` (2024-01-08)\n```\n\n---\n\n## 自動整形ルール\n\nPlans.md を更新する際は以下を遵守：\n\n1. **最終更新を必ず記載**: ヘッダーの日時を更新\n2. **セクション順序を維持**: 進行中 → 未着手 → 完了 → アーカイブ\n3. **空セクションは残す**: タスクがなくてもセクションヘッダーは削除しない\n4. **インデントを統一**: 2スペースまたは4スペース\n\n---\n\n## 便利なパターン\n\n### サブタスク\n\n```markdown\n- [ ] 親タスク `cc:WIP`\n  - [x] サブタスク1\n  - [ ] サブタスク2\n  - [ ] サブタスク3\n```\n\n### ブロック理由の記載\n\n```markdown\n- [ ] タスク名 `blocked`\n  - ブロック理由: API キーの発行待ち\n  - 担当: @username\n  - 期限: 2024-01-20\n```\n\n### 優先度の表現\n\n```markdown\n- [ ] 🔥 緊急タスク `pm:依頼中`（互換: cursor:依頼中）\n- [ ] ⭐ 重要タスク `cc:TODO`\n- [ ] タスク `cc:TODO`\n```\n\n---\n\n## 関連コマンド\n\n- `/sync-status` - 現在の状態サマリーを出力\n- `/handoff-to-cursor` - 完了報告時に Plans.md を自動更新\n\n---\n\n## 注意事項\n\n- **Plans.md は単一ソース**: タスク情報を他のファイルに分散させない\n- **こまめに更新**: 作業開始時・終了時に必ず更新\n- **Cursor との同期**: 長時間経過したら `/sync-status` で確認\n\n---\n\n## 拡張記法（オプション）\n\n大規模プロジェクトでは以下の記法を**オプション**で使用可能：\n\n### タスク ID / 依存関係 / 並列可\n\n```markdown\n- [ ] T001: 認証機能 `cc:TODO`\n- [ ] T002: ユーザーAPI `cc:TODO` depends:T001\n- [ ] T003: 商品API `cc:TODO` [P]\n- [ ] T004: 注文API `cc:TODO` depends:T001,T003\n```\n\n| 記法 | 意味 | 用途 |\n|------|------|------|\n| `T001:` | タスクID | 参照・依存指定に利用 |\n| `depends:ID` | 依存タスク | `depends:T001,T002`（カンマ区切り） |\n| `[P]` | 並列可（Parallelizable） | `/work` 実行時に他タスクと同時実行 |\n\n### 依存解析の例\n\n```\nT001 (認証) ─────────────┐\n                         ↓\nT003 (商品API) [P] ─────> T004 (注文API)\n                         ↑\nT002 (ユーザーAPI) ─────┘\n```\n\n**後方互換**: ID/depends/[P] がなくても従来形式で問題なく動作する。\n",
        "opencode/skills/plans-management/examples/task-lifecycle.md": "# タスクライフサイクル例\n\n実際のタスクが Plans.md でどのように管理されるかの例。\n\n---\n\n## 例1: 通常のタスクフロー\n\n### Step 1: PM がタスクを追加\n\n```markdown\n## 🟡 未着手のタスク\n\n- [ ] ログイン画面のバリデーション追加 `pm:依頼中`\n  - メールアドレス形式チェック\n  - パスワード強度チェック\n```\n\n### Step 2: Claude Code が着手\n\n```markdown\n## 🔴 進行中のタスク\n\n- [ ] ログイン画面のバリデーション追加 `cc:WIP`\n  - メールアドレス形式チェック\n  - パスワード強度チェック\n  - 関連ファイル: `src/components/LoginForm.tsx`\n```\n\n### Step 3: Claude Code が完了\n\n```markdown\n## 🟢 完了タスク\n\n- [x] ログイン画面のバリデーション追加 `cc:完了` (2024-01-15)\n  - メールアドレス形式チェック\n  - パスワード強度チェック\n  - 関連ファイル: `src/components/LoginForm.tsx`\n```\n\n### Step 4: PM が確認\n\n```markdown\n## 🟢 完了タスク\n\n- [x] ログイン画面のバリデーション追加 `pm:確認済` (2024-01-15)\n```\n\n---\n\n## 例2: サブタスクを含むタスク\n\n```markdown\n## 🔴 進行中のタスク\n\n- [ ] ユーザー管理機能の実装 `cc:WIP`\n  - [x] データベーススキーマ設計\n  - [x] API エンドポイント作成\n  - [ ] フロントエンド実装\n  - [ ] テスト作成\n```\n\n---\n\n## 例3: ブロックされたタスク\n\n```markdown\n## 🟡 未着手のタスク\n\n- [ ] 決済機能の実装 `blocked`\n  - ブロック理由: Stripe アカウントの本番環境承認待ち\n  - 担当: @client\n  - 予定解消日: 2024-01-20\n```\n\n---\n\n## 例4: 優先度付きタスク\n\n```markdown\n## 🟡 未着手のタスク\n\n- [ ] 🔥 【緊急】本番エラー修正 `pm:依頼中`\n- [ ] ⭐ 【重要】パフォーマンス改善 `cc:TODO`\n- [ ] ドキュメント更新 `cc:TODO`\n```\n\n---\n\n## 例5: アーカイブ\n\n```markdown\n## 📦 アーカイブ\n\n### 2024年1月\n\n- [x] 初期プロジェクトセットアップ `pm:確認済` (2024-01-10)\n- [x] CI/CD 構築 `pm:確認済` (2024-01-12)\n- [x] 認証機能実装 `pm:確認済` (2024-01-14)\n\n### 2023年12月\n\n- [x] 要件定義 `pm:確認済` (2023-12-20)\n```\n",
        "opencode/skills/plans-management/references/init-requirements.md": "---\nname: init-requirements\ndescription: \"ユーザーの要望を短い質問で明確化し、feature_request を作成する。/plan で user_prompt が空のときに使用。\"\nallowed-tools: [\"Read\"]\n---\n\n# Init Requirements\n\nユーザーの要望が曖昧または未入力の場合に、最小限の質問で要件を明確化するスキル。\n\n---\n\n## 入力\n\n- **user_intent**: ユーザーの目的や背景（任意）\n\n---\n\n## 出力\n\n```json\n{\n  \"feature_request\": \"ユーザーの要望を1-2文で要約したもの\"\n}\n```\n\n---\n\n## 実行手順\n\n1. 目的・対象ユーザー・制約の3点を確認する  \n2. 回答から `feature_request` を生成する  \n3. 未回答の場合は仮の前提を置いて要約する  \n\n---\n\n## 質問テンプレート\n\n- 目的: 「何を実現したいですか？」\n- 対象: 「誰が使う想定ですか？」\n- 制約: 「期限や技術制約はありますか？」\n\n",
        "opencode/skills/plans-management/references/markers.md": "# Plans.md マーカーリファレンス\n\nPlans.md で使用するすべてのマーカーの詳細仕様。\n\n---\n\n## マーカー一覧\n\n### Claude Code 用マーカー\n\n| マーカー | 状態 | 説明 |\n|---------|------|------|\n| `cc:TODO` | 未着手 | Claude Code が着手すべきタスク |\n| `cc:WIP` | 作業中 | Claude Code が現在作業中 |\n| `cc:完了` | 完了待ち | Claude Code の作業完了、PM確認待ち |\n\n### PM（Cursor/PM Claude）用マーカー\n\n| マーカー | 状態 | 説明 |\n|---------|------|------|\n| `pm:依頼中` | 依頼済 | PM から Claude Code への依頼 |\n| `pm:確認済` | 確認完了 | PM がレビュー・確認完了 |\n\n### 互換マーカー\n\n旧形式との互換性のために以下も認識：\n\n| 互換マーカー | 正式マーカー |\n|-------------|-------------|\n| `cursor:依頼中` | `pm:依頼中` |\n| `cursor:確認済` | `pm:確認済` |\n\n### 共通マーカー\n\n| マーカー | 説明 |\n|---------|------|\n| `blocked` | ブロック中（理由を併記必須） |\n\n---\n\n## マーカーの書式ルール\n\n### 正しい書式\n\n```markdown\n- [ ] タスク名 `cc:WIP`\n- [x] タスク名 `cc:完了` (2024-01-15)\n```\n\n### よくある間違い\n\n| 間違い | 問題点 |\n|--------|--------|\n| `cc: WIP` | コロン後にスペース |\n| `cc:wip` | 小文字（大文字/日本語を使用） |\n| `CC:WIP` | プレフィックスが大文字 |\n| バッククォートなし | 検索・パースが困難 |\n\n---\n\n## 状態遷移\n\n```\n[新規タスク]\n    │\n    ▼\npm:依頼中 ──→ cc:TODO ──→ cc:WIP ──→ cc:完了 ──→ pm:確認済\n                ↑            │\n                └────────────┘\n                 (差し戻し)\n```\n\n### 遷移ルール\n\n| 遷移 | 実行者 | タイミング |\n|------|--------|-----------|\n| `pm:依頼中` → `cc:WIP` | Claude Code | タスク着手時 |\n| `cc:TODO` → `cc:WIP` | Claude Code | タスク着手時 |\n| `cc:WIP` → `cc:完了` | Claude Code | 作業完了時 |\n| `cc:完了` → `pm:確認済` | PM | レビュー完了時 |\n| `*` → `blocked` | どちらでも | ブロック発生時 |\n| `cc:完了` → `cc:WIP` | Claude Code | 差し戻し対応時 |\n\n---\n\n## 検索パターン\n\n```bash\n# 全マーカーを検索\ngrep -E '`(cc:|pm:|cursor:|blocked)' Plans.md\n\n# 進行中タスク\ngrep '`cc:WIP`' Plans.md\n\n# 確認待ちタスク\ngrep '`cc:完了`' Plans.md\n\n# PM依頼タスク\ngrep -E '`(pm|cursor):依頼中`' Plans.md\n```\n",
        "opencode/skills/plans-management/references/parse-work-flags.md": "---\nname: parse-work-flags\ndescription: \"Parse /work command flags from user_prompt. Extracts --parallel, --isolation, --commit-strategy, --max-iterations, --skip-cross-review, --resume, --fork options. /work defaults to full automation with smart parallel detection.\"\nallowed-tools: [\"Read\"]\n---\n\n# Parse Work Flags\n\n`/work`コマンドのフラグを解析し、実行モードとオプションを決定するスキル。\n\n---\n\n## 入力\n\n- **user_prompt**: `/work`コマンドの入力文字列\n  - 例: `/work` (フル自動化、並列数は自動判定)\n  - 例: `/work --parallel 5` (並列数を明示指定)\n  - 例: `/work --sequential` (並列なしを強制)\n\n---\n\n## 出力\n\n以下の変数を必ず出力する（デフォルト値を明示）：\n\n```json\n{\n  \"full_mode\": true,\n  \"parallel_count\": \"auto\",\n  \"isolation_mode\": \"worktree\",\n  \"commit_strategy\": \"phase\",\n  \"max_iterations\": 3,\n  \"skip_cross_review\": false,\n  \"resume_session_id\": \"\",\n  \"resume_latest\": false,\n  \"fork_session_id\": \"\",\n  \"fork_reason\": \"\"\n}\n```\n\n---\n\n## デフォルト動作 (Turbo Mode)\n\n`/work` はデフォルトでフル自動化モードで動作します：\n\n- **full_mode**: `true` (常に有効)\n- **parallel_count**: `auto` (タスク依存関係から自動判定)\n- **isolation_mode**: `worktree` (並列ビルド対応)\n- **commit_strategy**: `phase` (フェーズ単位でコミット)\n\n### 並列数の自動判定ロジック\n\n```javascript\nfunction determineParallelCount(tasks) {\n  // 1. タスク数が1つなら並列不要\n  if (tasks.length <= 1) return 1;\n\n  // 2. 依存関係グラフを構築\n  const dependencyGraph = buildDependencyGraph(tasks);\n\n  // 3. 同一ファイルを編集するタスクは並列不可\n  const fileConflicts = detectFileConflicts(tasks);\n\n  // 4. 独立したタスク数を算出\n  const independentTasks = tasks.filter(t => !hasConflict(t, fileConflicts));\n\n  // 5. 最大3並列に制限（リソース効率）\n  return Math.min(independentTasks.length, 3);\n}\n```\n\n### 判定基準\n\n| 条件 | 並列数 |\n|------|:------:|\n| タスク1つ | 1 |\n| 全タスクが同一ファイル編集 | 1 |\n| 独立タスク2-3個 | 2-3 |\n| 独立タスク4個以上 | 3 (上限) |\n\n---\n\n## フラグ解析ルール\n\n### `--parallel N`\n- 検出: `--parallel`の後に数値が続く\n- パターン: `--parallel\\s+(\\d+)` または `--parallel=(\\d+)`\n- デフォルト: `auto` (自動判定)\n- 出力: `parallel_count: N`（1-10の範囲、超過時は10に制限）\n\n### `--sequential`\n- 検出: `user_prompt`に`--sequential`が含まれる\n- 出力: `parallel_count: 1` (並列なしを強制)\n\n### `--isolation lock|worktree`\n- 検出: `--isolation`の後に`lock`または`worktree`が続く\n- パターン: `--isolation\\s+(lock|worktree)` または `--isolation=(lock|worktree)`\n- デフォルト: `lock`\n- 出力: `isolation_mode: \"lock\"` または `\"worktree\"`\n\n### `--commit-strategy task|phase|all`\n- 検出: `--commit-strategy`の後に`task`/`phase`/`all`が続く\n- パターン: `--commit-strategy\\s+(task|phase|all)` または `--commit-strategy=(task|phase|all)`\n- デフォルト: `task`\n- 出力: `commit_strategy: \"task\"` / `\"phase\"` / `\"all\"`\n\n### `--max-iterations N`\n- 検出: `--max-iterations`の後に数値が続く\n- パターン: `--max-iterations\\s+(\\d+)` または `--max-iterations=(\\d+)`\n- デフォルト: `3`\n- 出力: `max_iterations: N`（1-10の範囲）\n\n### `--skip-cross-review`\n- 検出: `user_prompt`に`--skip-cross-review`が含まれる\n- デフォルト: `false`\n- 出力: `skip_cross_review: true`\n\n### `--resume <session_id|latest>`\n- 検出: `--resume`の後にIDまたは`latest`が続く\n- パターン: `--resume\\\\s+(\\\\S+)` または `--resume=(\\\\S+)`\n- デフォルト: `\"\"`\n- 出力:\n  - `resume_session_id: <id>`（`latest`の場合は空）\n  - `resume_latest: true`（`latest`の場合）\n\n### `--fork <session_id|current> --reason <text>`\n- 検出: `--fork`の後にIDまたは`current`が続く\n- パターン: `--fork\\\\s+(\\\\S+)` または `--fork=(\\\\S+)`\n- デフォルト: `\"\"`\n- 出力:\n  - `fork_session_id: <id>`（`current`の場合は空）\n  - `fork_reason: \"<text>\"`（省略時は空）\n\n---\n\n## 実行手順\n\n### Step 1: user_promptの読み取り\n\n```bash\n# user_promptはワークフローから渡される\n# 例: \"/work --full --parallel 3\"\n```\n\n### Step 2: フラグの抽出\n\n正規表現または文字列検索で各フラグを検出：\n\n```javascript\n// 疑似コード例\nconst flags = {\n  full_mode: /--full/.test(user_prompt),\n  parallel_count: extractNumber(user_prompt, /--parallel[\\s=]+(\\d+)/) || 1,\n  isolation_mode: extractString(user_prompt, /--isolation[\\s=]+(lock|worktree)/) || \"lock\",\n  commit_strategy: extractString(user_prompt, /--commit-strategy[\\s=]+(task|phase|all)/) || \"task\",\n  deploy_after_commit: /--deploy/.test(user_prompt),\n  max_iterations: extractNumber(user_prompt, /--max-iterations[\\s=]+(\\d+)/) || 3,\n  skip_cross_review: /--skip-cross-review/.test(user_prompt),\n  resume_session_id: extractString(user_prompt, /--resume[\\s=]+(\\S+)/) || \"\",\n  resume_latest: /--resume[\\s=]+latest/.test(user_prompt),\n  fork_session_id: extractString(user_prompt, /--fork[\\s=]+(\\S+)/) || \"\",\n  fork_reason: extractString(user_prompt, /--reason[\\s=]+(.+)/) || \"\"\n};\n```\n\n### Step 3: バリデーション\n\n- `parallel_count`: 1-10の範囲に制限\n- `max_iterations`: 1-10の範囲に制限\n- `isolation_mode`: `lock`または`worktree`のみ許可\n- `commit_strategy`: `task`/`phase`/`all`のみ許可\n\n### Step 4: 出力\n\nワークフロー変数として出力：\n\n```yaml\noutput:\n  variables:\n    - full_mode\n    - parallel_count\n    - isolation_mode\n    - commit_strategy\n    - deploy_after_commit\n    - max_iterations\n    - skip_cross_review\n```\n\n---\n\n## 使用例\n\n### 例1: 基本的な`--full`\n```\n入力: \"/work --full\"\n出力:\n  full_mode: true\n  parallel_count: 1\n  isolation_mode: \"lock\"\n  commit_strategy: \"task\"\n  deploy_after_commit: false\n  max_iterations: 3\n  skip_cross_review: false\n  resume_session_id: \"\"\n  resume_latest: false\n  fork_session_id: \"\"\n  fork_reason: \"\"\n```\n\n### 例2: 並列実行指定\n```\n入力: \"/work --full --parallel 5\"\n出力:\n  full_mode: true\n  parallel_count: 5\n  isolation_mode: \"lock\"\n  commit_strategy: \"task\"\n  deploy_after_commit: false\n  max_iterations: 3\n  skip_cross_review: false\n```\n\n### 例3: 完全なオプション指定\n```\n入力: \"/work --full --parallel 3 --isolation worktree --commit-strategy phase --deploy --max-iterations 5\"\n出力:\n  full_mode: true\n  parallel_count: 3\n  isolation_mode: \"worktree\"\n  commit_strategy: \"phase\"\n  deploy_after_commit: true\n  max_iterations: 5\n  skip_cross_review: false\n```\n\n### 例4: 非`--full`モード（既存フロー）\n```\n入力: \"/work\"\n出力:\n  full_mode: false\n  parallel_count: 1\n  isolation_mode: \"lock\"\n  commit_strategy: \"task\"\n  deploy_after_commit: false\n  max_iterations: 3\n  skip_cross_review: false\n```\n\n---\n\n## 注意事項\n\n- **フラグの順序は問わない**: `--full --parallel 3`と`--parallel 3 --full`は同じ結果\n- **大文字小文字を区別しない**: `--FULL`も`--full`として認識\n- **未指定フラグはデフォルト値**: 明示的に指定されていないフラグはデフォルト値を使用\n- **不正な値はデフォルトにフォールバック**: `--parallel abc`は`parallel_count: 1`になる\n",
        "opencode/skills/plans-management/references/plan-feature.md": "---\nname: plan-feature\ndescription: \"feature_request を Plans.md のタスクに分解し、cc:TODO で追記する。\"\nallowed-tools: [\"Read\", \"Edit\"]\n---\n\n# Plan Feature\n\n要望を実行可能なタスクに分解し、Plans.md に追加するスキル。\n\n---\n\n## 入力\n\n- **Plans.md**: 既存タスク一覧\n- **feature_request**: 要望の要約（文字列）\n- **user_prompt**: ユーザーの指示（任意）\n- **tech_stack**: 技術スタック（任意）\n\n---\n\n## 出力\n\n- Plans.md へのタスク追加（`cc:TODO`）\n- 変数: `task_count`, `phase_name`\n\n---\n\n## 実行手順\n\n1. `feature_request` を 3〜7 個のタスクに分解  \n2. 依存関係がある場合は `depends:` を付与  \n3. Plans.md の「未着手」セクションに追記  \n4. `task_count` と `phase_name` を出力  \n\n---\n\n## 出力例\n\n```json\n{\n  \"task_count\": 4,\n  \"phase_name\": \"実装\"\n}\n```\n\n",
        "opencode/skills/plans-management/references/plan-review.md": "---\nname: plan-review\ndescription: \"Plans.md のタスク分解が妥当かをレビューし、改善点を提案する。\"\nallowed-tools: [\"Read\"]\n---\n\n# Plan Review\n\nPlans.md に追加されたタスクが妥当かを確認し、改善点を提示するスキル。\n\n---\n\n## 入力\n\n- **Plans.md**: タスク一覧\n- **previous_step_output**: plan-feature の結果（任意）\n\n---\n\n## 出力\n\n- 改善提案（必要な場合のみ）\n\n---\n\n## レビュー観点\n\n- タスク数が過剰/不足していないか\n- 依存関係が明確か\n- リスクや検証が含まれているか\n- 作業順序が合理的か\n\n",
        "opencode/skills/principles/SKILL.md": "---\nname: principles\ndescription: \"Provides development principles, guidelines, and VibeCoder guidance. Use when user mentions principles, guidelines, safety, or diff-aware editing. Do not use for actual implementation—use the impl skill instead.\"\nallowed-tools: [\"Read\"]\nuser-invocable: false\n---\n\n# Principles Skills\n\n開発原則とガイドラインを提供するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **基本原則** | See [references/general-principles.md](references/general-principles.md) |\n| **差分編集** | See [references/diff-aware-editing.md](references/diff-aware-editing.md) |\n| **コンテキスト読み取り** | See [references/repo-context-reading.md](references/repo-context-reading.md) |\n| **VibeCoder** | See [references/vibecoder-guide.md](references/vibecoder-guide.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容を参照・適用\n",
        "opencode/skills/principles/references/diff-aware-editing.md": "---\nname: core-diff-aware-editing\ndescription: \"最小限の差分でファイルを編集し、既存コードへの影響を最小化する。\"\nallowed-tools: [\"Read\", \"Edit\"]\n---\n\n# Diff-Aware Editing\n\nファイル編集時に最小限の差分で変更を行うスキル。\n既存コードの破壊を防ぎ、レビューしやすい変更を実現します。\n\n---\n\n## 基本原則\n\n### 1. Read Before Edit\n\n**必ず対象ファイルを読んでから編集する**\n\n```\n❌ 悪い例: Write ツールでファイル全体を上書き\n✅ 良い例: Read → 内容確認 → Edit で必要部分のみ変更\n```\n\n### 2. 最小差分の優先\n\n変更は必要最小限に留める：\n\n- 既存のインデント・フォーマットを維持\n- 既存のコメントは残す\n- 使われているスタイルに合わせる\n\n### 3. 意味のある単位で変更\n\n```typescript\n// ❌ 悪い例: 無関係な変更を混ぜる\n// 関数の追加 + フォーマット変更 + import整理\n\n// ✅ 良い例: 1つの変更に集中\n// 関数の追加のみ\n```\n\n---\n\n## Edit ツールの使い方\n\n### パターン1: 単純な置換\n\n```\nold_string: \"const value = 1\"\nnew_string: \"const value = 2\"\n```\n\n### パターン2: コードブロックの追加\n\n```\nold_string: \"// TODO: implement feature\"\nnew_string: \"// Feature implemented\nconst feature = () => {\n  // implementation\n}\"\n```\n\n### パターン3: 関数の修正\n\n```\nold_string: \"function getData() {\n  return []\n}\"\nnew_string: \"function getData() {\n  const data = fetchData()\n  return data\n}\"\n```\n\n---\n\n## 避けるべきパターン\n\n### 1. ファイル全体の書き換え\n\n```\n❌ Write ツールで 100 行のファイルを丸ごと書き直す\n✅ Edit ツールで変更が必要な 5 行だけ修正\n```\n\n### 2. フォーマット変更の混入\n\n```\n❌ 機能追加と同時にインデントを変更\n✅ 機能追加のみ。フォーマットは別コミットで\n```\n\n### 3. 不要な空行・コメントの追加\n\n```\n❌ 自分のスタイルを押し付ける\n✅ 既存のスタイルに従う\n```\n\n---\n\n## 編集前チェックリスト\n\n1. [ ] 対象ファイルを Read で確認した\n2. [ ] 変更が必要な箇所を特定した\n3. [ ] 既存のスタイル（インデント、命名規則）を把握した\n4. [ ] 変更が paths.allowed_modify に含まれるか確認した\n5. [ ] 変更後の動作をイメージできた\n\n---\n\n## 編集後の確認\n\n```bash\n# 差分の確認\ngit diff\n\n# 変更行数の確認（大きすぎないか）\ngit diff --stat\n\n# 構文エラーがないか\nnpm run build 2>&1 | head -20\n# または\nnpx tsc --noEmit\n```\n\n---\n\n## 複数ファイルの編集\n\n複数ファイルを編集する場合：\n\n1. **依存関係の順序**: 型定義 → 実装 → テスト\n2. **一貫性の確保**: 関連する変更は同時に行う\n3. **中間状態でも動作**: 各編集後にビルドが通る状態を維持\n\n---\n\n## エラー時の対応\n\n編集でエラーが発生した場合：\n\n1. **元のコードを再確認**: Read で現在の状態を確認\n2. **old_string の一致確認**: 空白・改行を正確に\n3. **分割して試行**: 大きな変更は小さく分割\n",
        "opencode/skills/principles/references/general-principles.md": "---\nname: core-general-principles\ndescription: \"開発の基本原則とセーフティルールを提供する。すべてのタスクで適用される基本的なガイドライン。\"\n---\n\n# General Principles\n\nclaude-code-harness を使用する際の基本原則です。すべてのワークフローで適用されます。\n\n---\n\n## 安全性の原則\n\n### 1. 確認してから変更する\n\nファイルを編集する前に、必ず以下を確認：\n\n- **Read ツールで内容を確認**: 既存のコードを理解してから変更\n- **影響範囲を把握**: 変更が他のファイルに与える影響を考慮\n- **バックアップの考慮**: 重要な変更前は git status を確認\n\n### 2. 最小限の差分で編集\n\n```\n❌ 悪い例: ファイル全体を書き換える\n✅ 良い例: Edit ツールで必要な部分のみ変更\n```\n\n### 3. 設定ファイルの尊重\n\n`claude-code-harness.config.json` の設定に従う：\n\n- `safety.mode`: dry-run / apply-local / apply-and-push\n- `paths.protected`: 保護されたパスは変更しない\n- `paths.allowed_modify`: 許可されたパスのみ変更\n\n---\n\n## 作業の原則\n\n### 1. Plans.md を常に更新\n\n- タスク開始時: `cc:TODO` → `cc:WIP`\n- タスク完了時: `cc:WIP` → `cc:完了`\n- ブロック時: `blocked` を付与し理由を記載\n\n### 2. 段階的に進める\n\n```\n1. 調査・理解 → 2. 計画 → 3. 実装 → 4. 確認 → 5. 報告\n```\n\n### 3. エラー時の対応\n\n- 最大 3 回の自動リトライ\n- 解決しない場合はエスカレーション（報告）\n- エラー内容と試した対処を明記\n\n---\n\n## コミュニケーションの原則\n\n### VibeCoder 対応\n\n技術知識がなくても理解できるよう：\n\n- **専門用語を避ける**: または説明を添える\n- **次のアクションを提示**: 「次は〇〇と言ってください」\n- **進捗を可視化**: 完了したこと、残っていることを明確に\n\n### PM（Cursor）との連携\n\n- **Plans.md で状態を共有**: 単一ソースとして維持\n- **完了報告は `/handoff-to-cursor`**: フォーマットに従う\n- **スコープを守る**: 依頼された範囲外の作業は確認を取る\n\n---\n\n## 禁止事項\n\n1. **本番環境への直接デプロイ**（staging まで）\n2. **機密情報のハードコード**（.env を使用）\n3. **保護されたパスの変更**（.github/, secrets/ など）\n4. **ユーザー確認なしの破壊的操作**（rm -rf など）\n",
        "opencode/skills/principles/references/repo-context-reading.md": "---\nname: core-read-repo-context\ndescription: \"リポジトリのコンテキスト（README, Plans.md, 既存コード）を読み取り理解する。セッション開始時、新しいタスク開始前、またはプロジェクト構造の理解が必要な場合に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\"]\n---\n\n# Read Repository Context\n\nリポジトリの構造とコンテキストを把握するためのスキル。\n作業開始前や、新しい機能の実装前に使用します。\n\n---\n\n## 入力\n\n- **必須**: リポジトリのルートディレクトリへのアクセス\n- **オプション**: 特定のファイルやディレクトリへのフォーカス指定\n\n---\n\n## 出力\n\nリポジトリの理解を含む構造化されたコンテキスト情報\n\n---\n\n## 実行手順\n\n### Step 1: 基本構造の把握\n\n```bash\n# ディレクトリ構造\nls -la\nfind . -maxdepth 2 -type d | head -20\n\n# 主要ファイルの確認\ncat README.md 2>/dev/null | head -50\ncat package.json 2>/dev/null | head -20\n```\n\n### Step 2: ワークフローファイルの確認\n\n```bash\n# Plans.md の状態\ncat Plans.md 2>/dev/null || echo \"Plans.md not found\"\n\n# AGENTS.md の役割分担\ncat AGENTS.md 2>/dev/null | head -100 || echo \"AGENTS.md not found\"\n\n# CLAUDE.md の設定\ncat CLAUDE.md 2>/dev/null | head -50 || echo \"CLAUDE.md not found\"\n```\n\n### Step 3: 技術スタックの特定\n\n```bash\n# フロントエンド\n[ -f package.json ] && cat package.json | grep -E '\"(react|vue|angular|next|nuxt)\"'\n\n# バックエンド\n[ -f requirements.txt ] && head -10 requirements.txt\n[ -f Gemfile ] && head -10 Gemfile\n[ -f go.mod ] && head -10 go.mod\n\n# 設定ファイル\n[ -f tsconfig.json ] && echo \"TypeScript project\"\n[ -f .eslintrc* ] && echo \"ESLint configured\"\n[ -f tailwind.config.* ] && echo \"Tailwind CSS\"\n```\n\n### Step 4: Git 状態の確認\n\n```bash\ngit status -sb\ngit log --oneline -5\ngit branch -a | head -10\n```\n\n---\n\n## 出力フォーマット\n\n```markdown\n## 📁 リポジトリコンテキスト\n\n### 基本情報\n- **プロジェクト名**: {{name}}\n- **技術スタック**: {{framework}} + {{language}}\n- **現在のブランチ**: {{branch}}\n\n### ワークフロー状態\n- **Plans.md**: {{存在する/しない, タスク数}}\n- **AGENTS.md**: {{存在する/しない}}\n- **CLAUDE.md**: {{存在する/しない}}\n\n### 直近の変更\n{{最近のコミット3件}}\n\n### 重要なファイル\n{{認識すべき主要ファイル一覧}}\n```\n\n---\n\n## 使用タイミング\n\n1. **セッション開始時**: 現在の状態把握\n2. **新機能実装前**: 既存コードとの整合性確認\n3. **エラー調査時**: 関連ファイルの特定\n4. **レビュー時**: 変更の影響範囲理解\n\n---\n\n## 注意事項\n\n- **大規模リポジトリ**: ファイル数が多い場合は重要部分に絞る\n- **秘密情報**: .env や secrets/ の内容は読まない\n- **キャッシュ活用**: 同一セッション内では再読み込みを最小化\n",
        "opencode/skills/principles/references/vibecoder-guide.md": "---\nname: vibecoder-guide\ndescription: \"VibeCoder（非技術者）が自然言語で開発を進められるようガイドするスキル。非技術者向けのガイダンスを提供する場合に使用します。\"\nallowed-tools: [\"Read\"]\n---\n\n# VibeCoder Guide\n\nVibeCoder（非技術者）が自然言語だけで開発を進められるようガイドするスキル。\n「どうすればいい？」「次は何？」などの質問に自動で応答します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「どうすればいい？」「どうしたらいい？」\n- 「次は何をすればいい？」「次は？」\n- 「何ができる？」「何をすればいい？」\n- 「困った」「わからない」「助けて」\n- 「使い方を教えて」\n- \"what should I do?\", \"what's next?\", \"help\"\n\n---\n\n## 概要\n\nVibeCoder は技術的なコマンドやワークフローを知らなくても、\n自然な日本語で質問するだけで次のアクションが分かります。\n\n---\n\n## 応答パターン\n\n### パターン1: プロジェクトがない場合\n\n> **まずはプロジェクトを始めましょう！**\n>\n> **言い方の例：**\n> - 「ブログを作りたい」\n> - 「タスク管理アプリを作りたい」\n> - 「ポートフォリオサイトを作りたい」\n>\n> ざっくりで大丈夫です。やりたいことを教えてください。\n\n### パターン2: Plans.md があるが進行中タスクがない\n\n> **計画があります。作業を始めましょう！**\n>\n> **現在の計画:**\n> - フェーズ1: 基盤構築\n> - フェーズ2: コア機能\n> - ...\n>\n> **言い方の例：**\n> - 「フェーズ1を始めて」\n> - 「最初のタスクをやって」\n> - 「全部やって」\n\n### パターン3: タスク進行中\n\n> **作業中です**\n>\n> **現在のタスク:** {{タスク名}}\n> **進捗:** {{完了数}}/{{全体数}}\n>\n> **言い方の例：**\n> - 「続けて」\n> - 「次のタスク」\n> - 「今どこまで進んだ？」\n\n### パターン4: フェーズ完了後\n\n> **フェーズが完了しました！**\n>\n> **次にできること：**\n> - 「動作確認して」→ 開発サーバーを起動\n> - 「レビューして」→ コード品質チェック\n> - 「次のフェーズへ」→ 次の作業を開始\n> - 「コミットして」→ 変更を保存\n\n### パターン5: エラー発生時\n\n> **問題が発生しました**\n>\n> **状況:** {{エラーの要約}}\n>\n> **言い方の例：**\n> - 「直して」→ 自動修正を試行\n> - 「説明して」→ 問題の詳細を説明\n> - 「スキップして」→ 次のタスクへ\n\n---\n\n## よく使うフレーズ対応表\n\n| やりたいこと | 言い方 |\n|-------------|--------|\n| プロジェクト開始 | 「〇〇を作りたい」 |\n| 計画を見たい | 「計画を見せて」「今の状況は？」 |\n| 作業を開始 | 「始めて」「作って」「フェーズ1をやって」 |\n| 続きをやる | 「続けて」「次」 |\n| 動作確認 | 「動かして」「見せて」 |\n| コード確認 | 「レビューして」「チェックして」 |\n| 保存する | 「コミットして」「保存して」 |\n| 困った時 | 「どうすればいい？」「助けて」 |\n| 全部任せる | 「全部やって」「おまかせ」 |\n\n---\n\n## コンテキスト判定\n\nこのスキルは以下を確認して適切な応答を選択：\n\n1. **AGENTS.md の存在** → プロジェクトが初期化済みか\n2. **Plans.md の内容** → 計画があるか、進捗状況\n3. **現在のタスク状態** → `cc:WIP` マーカーの有無\n4. **直近のエラー** → 問題が発生しているか\n\n---\n\n## 実装ノート\n\nこのスキルが起動したら：\n\n1. 現在の状態を分析\n2. 適切なパターンを選択\n3. 具体的な「言い方の例」を提示\n4. ユーザーの次のアクションを待つ\n\n**重要**: 技術用語を避け、平易な日本語で説明する\n",
        "opencode/skills/session-control/SKILL.md": "---\nname: session-control\ndescription: \"Controls session resume/fork for /work based on flags. Use only from workflow.\"\nallowed-tools: [\"Read\", \"Bash\", \"Write\", \"Edit\"]\n---\n\n# Session Control Skill\n\n/work の `--resume` / `--fork` フラグに応じてセッション状態を切り替える。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **セッション再開/分岐** | See [references/session-control.md](references/session-control.md) |\n\n## 実行手順\n\n1. workflow から渡された変数を確認\n2. `scripts/session-control.sh` を適切な引数で実行\n3. `session.json` と `session.events.jsonl` の更新を確認\n",
        "opencode/skills/session-control/references/session-control.md": "---\nname: session-control\ndescription: \"Apply /work --resume/--fork flags by updating session state files.\"\nallowed-tools: [\"Read\", \"Bash\", \"Write\", \"Edit\"]\n---\n\n# Session Control\n\n## 入力\n\nworkflow 変数:\n- `resume_session_id` (string)\n- `resume_latest` (boolean)\n- `fork_session_id` (string)\n- `fork_reason` (string)\n\n## 実行\n\n### 1) 引数の決定\n- resume:\n  - `resume_latest == true` → `--resume latest`\n  - それ以外で `resume_session_id` があれば `--resume <id>`\n- fork:\n  - `fork_session_id` があれば `--fork <id>`、なければ `--fork current`\n  - `fork_reason` があれば `--reason \"<text>\"`\n\n### 2) スクリプト実行\n```bash\n./scripts/session-control.sh --resume <id|latest>\n./scripts/session-control.sh --fork <id|current> --reason \"<text>\"\n```\n\n## 期待される結果\n- `.claude/state/session.json` が更新される\n- `.claude/state/session.events.jsonl` に `session.resume` または `session.fork` が追記される\n- エラー時は stderr に理由が出力される\n",
        "opencode/skills/session-init/SKILL.md": "---\nname: session-init\ndescription: \"Initializes session with environment checks and task status overview. Use when user mentions starting a session, beginning work, or status checks. Do NOT load for: implementation work, reviews, or mid-session tasks.\"\nallowed-tools: [\"Read\", \"Write\", \"Bash\"]\nuser-invocable: false\n---\n\n# Session Init Skill\n\nセッション開始時の環境確認と現在のタスク状況把握を行うスキル。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで起動します：\n\n- 「セッション開始」\n- 「作業開始」\n- 「今日の作業を始める」\n- 「状況を確認して」\n- 「何をすればいい？」\n- \"start session\"\n- \"what should I work on?\"\n\n---\n\n## 概要\n\nSession Init スキルは、Claude Code セッション開始時に自動的に以下を確認します：\n\n1. **Git 状態**: 現在のブランチ、未コミットの変更\n2. **Plans.md**: 進行中タスク、依頼されたタスク\n3. **AGENTS.md**: 役割分担、禁止事項の確認\n4. **前回セッション**: 引き継ぎ事項の確認\n\n---\n\n## 実行手順\n\n### Step 0: ファイル状態チェック（自動整理）\n\nセッション開始前にファイルサイズをチェック：\n\n```bash\n# Plans.md の行数チェック\nif [ -f \"Plans.md\" ]; then\n  lines=$(wc -l < Plans.md)\n  if [ \"$lines\" -gt 200 ]; then\n    echo \"⚠️ Plans.md が ${lines} 行です。「整理して」で整理を推奨\"\n  fi\nfi\n\n# session-log.md の行数チェック\nif [ -f \".claude/memory/session-log.md\" ]; then\n  lines=$(wc -l < .claude/memory/session-log.md)\n  if [ \"$lines\" -gt 500 ]; then\n    echo \"⚠️ session-log.md が ${lines} 行です。「セッションログを整理して」で整理を推奨\"\n  fi\nfi\n```\n\n整理が必要な場合は提案を表示（作業には影響しない）。\n\n### Step 0.5: Claude-mem 文脈確認（オプション）\n\nClaude-mem が有効な場合、過去の文脈を自動表示：\n\n```bash\n# Claude-mem の状態チェック\nif [ -f \"$HOME/.claude-mem/settings.json\" ]; then\n  mode=$(cat ~/.claude-mem/settings.json | grep -o '\"CLAUDE_MEM_MODE\"[^,}]*' | cut -d'\"' -f4)\n  if [ \"$mode\" = \"harness\" ] || [ \"$mode\" = \"harness--ja\" ]; then\n    echo \"📚 Claude-mem (harness モード) が有効です\"\n  fi\nfi\n```\n\n**Claude-mem 有効時に表示する内容**:\n\n1. **過去のガードレール発動**:\n   - `mem-search` で `guard` タイプの観測を検索\n   - 「このプロジェクトでは過去 N 回テスト改ざんを防止」\n\n2. **直近の作業サマリー**:\n   - 最新のセッションサマリーを表示\n   - 「前回: Feature X の設計完了」\n\n3. **継続タスクの提案**:\n   - Plans.md と組み合わせて次のアクションを提案\n\n```markdown\n## 📚 過去の文脈（Claude-mem）\n\n**ガードレール履歴**:\n- テスト改ざん防止: 2回\n\n**前回のセッション**:\n- Feature X 設計完了\n- RBAC 採用を決定\n\n**💡 継続推奨**: Plans.md の「Feature X 実装」から開始\n```\n\n> **注**: Claude-mem が未設定の場合、このステップはスキップされます。\n\n### Step 1: 環境確認\n\n以下を並列で実行：\n\n```bash\n# Git状態\ngit status -sb\ngit log --oneline -3\n```\n\n```bash\n# Plans.md\ncat Plans.md 2>/dev/null || echo \"Plans.md not found\"\n```\n\n```bash\n# AGENTS.md の要点\nhead -50 AGENTS.md 2>/dev/null || echo \"AGENTS.md not found\"\n```\n\n### Step 2: タスク状況の把握\n\nPlans.md から以下を抽出：\n\n- `cc:WIP` - 前回から継続中のタスク\n- `pm:依頼中` - PM から新規依頼されたタスク（互換: cursor:依頼中）\n- `cc:TODO` - 未着手だが割り当て済みのタスク\n\n### Step 3: 状況レポートの出力\n\n```markdown\n## 🚀 セッション開始\n\n**日時**: {{YYYY-MM-DD HH:MM}}\n**ブランチ**: {{branch}}\n**セッションID**: ${CLAUDE_SESSION_ID}\n\n---\n\n### 📋 今日のタスク\n\n**優先タスク**:\n- {{pm:依頼中（互換: cursor:依頼中） または cc:WIP のタスク}}\n\n**その他のタスク**:\n- {{cc:TODO のタスク一覧}}\n\n---\n\n### ⚠️ 注意事項\n\n{{AGENTS.md からの重要な制約・禁止事項}}\n\n---\n\n**作業を開始しますか？**\n```\n\n---\n\n## 出力フォーマット\n\nセッション開始時は、以下の情報を簡潔に提示：\n\n| 項目 | 内容 |\n|------|------|\n| 現在のブランチ | `staging` など |\n| 優先タスク | 最も重要な 1-2 件 |\n| 注意事項 | 禁止事項の要約 |\n| 次のアクション | 具体的な提案 |\n\n---\n\n## 関連コマンド\n\n- `/work` - タスク実行（並列実行対応）\n- `/sync-status` - Plans.md の進捗サマリー\n- `/cleanup` - ファイルの自動整理\n\n---\n\n## 注意事項\n\n- **AGENTS.md を必ず確認**: 役割分担を把握してから作業開始\n- **Plans.md が無い場合**: `/harness-init` を案内\n- **前回の作業が中断している場合**: 継続するか確認\n",
        "opencode/skills/session-memory/SKILL.md": "---\nname: session-memory\ndescription: \"Manages cross-session learning and memory persistence. Use when user asks about previous sessions, history, or to continue from before. Do NOT load for: implementation work, reviews, or ad-hoc information.\"\nallowed-tools: [\"Read\", \"Write\", \"Append\"]\nuser-invocable: false\n---\n\n# Session Memory Skill\n\nセッション間の学習と記憶を管理するスキル。\n過去の作業内容、決定事項、学んだパターンを記録・参照します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「前回何をした？」「前回の続きから」\n- 「履歴を見せて」「過去の作業」\n- 「このプロジェクトについて教えて」\n- \"what did we do last time?\", \"continue from before\"\n\n---\n\n## 概要\n\nこのスキルは `.claude/memory/` に作業履歴を保存し、\nセッション間での知識の継続を実現します。\n\nあわせて、重要な情報は「どこに残すべきか」を明確にします（詳細: `docs/MEMORY_POLICY.md`）。\n\n---\n\n## メモリ構造\n\n```\n.claude/\n└── memory/\n    ├── session-log.md      # セッションごとのログ\n    ├── decisions.md        # 重要な決定事項\n    ├── patterns.md         # 学んだパターン\n    └── context.json        # プロジェクトコンテキスト\n```\n\n### 推奨運用（SSOT/ローカル分離）\n\n- **SSOT（共有推奨）**: `decisions.md` / `patterns.md`  \n  - 「決定（Why）」と「再利用できる解法（How）」を集約する\n  - 各エントリは **タイトル + タグ**（例: `#decision #db`）を付け、先頭に **Index** を置く\n- **ローカル推奨**: `session-log.md` / `context.json` / `.claude/state/`  \n  - ノイズ/肥大化しやすいため、基本は Git 管理しない（必要なら個別に判断）\n\n---\n\n## 自動記録される情報\n\n### session-log.md\n\n各セッション記録には `${CLAUDE_SESSION_ID}` 環境変数を活用してセッションIDを付与します。\nこれにより、セッション間のトレーサビリティが向上します。\n\n```markdown\n## セッション: 2024-01-15 14:30 (session: abc123def)\n\n### 実行したタスク\n- [x] ユーザー認証機能の実装\n- [x] ログインページの作成\n\n### 生成したファイル\n- src/lib/auth.ts\n- src/app/login/page.tsx\n\n### 重要な決定\n- 認証方式: Supabase Auth を採用\n\n### 次回への引き継ぎ\n- ログアウト機能が未実装\n- パスワードリセットも必要\n```\n\n> **Note**: `${CLAUDE_SESSION_ID}` は Claude Code が自動設定する環境変数です。\n> セッションごとに一意のIDが割り当てられ、ログの追跡や問題調査に役立ちます。\n\n### decisions.md\n\n```markdown\n## 技術選定\n\n| 日付 | 決定事項 | 理由 |\n|------|---------|------|\n| 2024-01-15 | Supabase Auth | 無料枠あり、セットアップ簡単 |\n| 2024-01-14 | Next.js App Router | 最新のベストプラクティス |\n\n## アーキテクチャ\n\n- コンポーネント: `src/components/`\n- ユーティリティ: `src/lib/`\n- 型定義: `src/types/`\n```\n\n### patterns.md\n\n```markdown\n## このプロジェクトのパターン\n\n### コンポーネント命名\n- PascalCase\n- 例: `UserProfile.tsx`, `LoginForm.tsx`\n\n### API エンドポイント\n- `/api/v1/` プレフィックス\n- RESTful 設計\n\n### エラーハンドリング\n- try-catch で囲む\n- エラーメッセージは日本語\n```\n\n### context.json\n\n```json\n{\n  \"project_name\": \"my-blog\",\n  \"created_at\": \"2024-01-14\",\n  \"stack\": {\n    \"frontend\": \"next.js\",\n    \"backend\": \"next-api\",\n    \"database\": \"supabase\",\n    \"styling\": \"tailwind\"\n  },\n  \"current_phase\": \"フェーズ2: コア機能\",\n  \"last_session\": \"2024-01-15T14:30:00Z\"\n}\n```\n\n---\n\n## 処理フロー\n\n### セッション開始時\n\n1. `.claude/memory/context.json` を読み込み\n2. 前回のセッションログを確認\n3. 未完了タスクを特定\n4. コンテキストサマリーを生成\n\n### セッション中\n\n1. 重要な決定を `decisions.md` に記録\n2. 新しいパターンを `patterns.md` に追加\n3. ファイル生成を `session-log.md` に記録\n\n### セッション終了時\n\n1. セッションサマリーを生成\n2. `context.json` を更新\n3. 次回への引き継ぎ事項を記録\n\n---\n\n## 使用例\n\n### 前回の続きから開始\n\n```\nユーザー: 「前回の続きから」\n\nClaude Code:\n📋 前回のセッション（2024-01-15）\n\n完了したタスク:\n- ユーザー認証機能\n- ログインページ\n\n未完了:\n- ログアウト機能\n- パスワードリセット\n\n「ログアウト機能を作って」と言えば続きを実装します。\n```\n\n### プロジェクトの状況確認\n\n```\nユーザー: 「このプロジェクトについて教えて」\n\nClaude Code:\n📁 プロジェクト: my-blog\n\n技術スタック:\n- Next.js + Tailwind CSS + Supabase\n\n現在のフェーズ: コア機能開発\n進捗: 40% 完了\n\n最近の決定:\n- Supabase Auth を採用\n- App Router を使用\n```\n\n---\n\n## 注意事項\n\n- **自動保存**: `hooks/Stop` により、セッション終了時に `session-log.md` へ要約を自動追記する運用を推奨（未導入の場合は手動運用でOK）\n- **プライバシー**: 機密情報は記録しない\n- **Git方針**: `decisions.md`/`patterns.md`は共有推奨、`session-log.md`/`context.json`/`.claude/state/`はローカル推奨（詳細: `docs/MEMORY_POLICY.md`）\n- **容量管理**: ログが大きくなったら「セッションログを整理して」を推奨\n",
        "opencode/skills/session-state/SKILL.md": "---\nname: session-state\nversion: 1.0.0\ndescription: \"Manages session state transitions per SESSION_ORCHESTRATION.md. Internal use only.\"\nallowed-tools: [Read, Bash]\ndependencies: []\n---\n\n# Session State Skill\n\nセッション状態の遷移を管理する内部スキル。\n`docs/SESSION_ORCHESTRATION.md` に定義された状態機械に従って遷移を検証・実行する。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **状態遷移** | See [references/state-transition.md](references/state-transition.md) |\n\n## 使用タイミング\n\n- `/work` フェーズ境界での状態更新\n- エラー発生時の `escalated` 遷移\n- セッション終了時の `stopped` 遷移\n- セッション再開時の `initialized` 復帰\n\n## 注意事項\n\n- このスキルは内部使用専用です\n- ユーザーが直接呼び出すことは想定していません\n- 状態遷移ルールは `docs/SESSION_ORCHESTRATION.md` で定義\n",
        "opencode/skills/session-state/references/state-transition.md": "---\nname: state-transition\ndescription: \"Execute session state transitions using session-state.sh\"\nallowed-tools: [Read, Bash]\n---\n\n# State Transition\n\nセッション状態の遷移を実行する。\n\n## 入力\n\nworkflow 変数:\n- `target_state` (string): 遷移先の状態\n- `event_name` (string): トリガーイベント\n- `event_data` (string, optional): イベント付加データ (JSON)\n\n## 有効な状態\n\n| 状態 | 説明 |\n|------|------|\n| `idle` | セッション未開始 |\n| `initialized` | SessionStart 完了 |\n| `planning` | Plan/Work の準備 |\n| `executing` | /work 実行中 |\n| `reviewing` | review 実行中 |\n| `verifying` | build/test 実行中 |\n| `escalated` | 人間確認待ち |\n| `completed` | 成果物確定 |\n| `failed` | 回復不能 |\n| `stopped` | Stop hook 到達 |\n\n## 代表的な遷移\n\n| From | Event | To |\n|------|-------|----|\n| idle | session.start | initialized |\n| initialized | plan.ready | planning |\n| planning | work.start | executing |\n| executing | work.task_complete | reviewing |\n| reviewing | verify.start | verifying |\n| verifying | verify.passed | completed |\n| verifying | verify.failed | escalated |\n| * | session.stop | stopped |\n| stopped | session.resume | initialized |\n\n## 実行\n\n```bash\n./scripts/session-state.sh --state <state> --event <event> [--data <json>]\n```\n\n### 例: 実行状態への遷移\n\n```bash\n./scripts/session-state.sh --state executing --event work.start\n```\n\n### 例: エスカレーション（データ付き）\n\n```bash\n./scripts/session-state.sh --state escalated --event escalation.requested \\\n  --data '{\"reason\":\"Build failed 3 times\",\"retry_count\":3}'\n```\n\n## 期待される結果\n\n- `.claude/state/session.json` の `state`, `updated_at`, `last_event_id`, `event_seq` が更新される\n- `.claude/state/session.events.jsonl` にイベントが追記される\n- 不正な遷移は stderr にエラー出力 + 非ゼロ終了\n\n## エラーハンドリング\n\n遷移が失敗した場合（不正な遷移など）:\n1. 現在の状態と許可された遷移を stderr に出力\n2. 非ゼロ終了コードを返す\n3. 呼び出し元（workflow）でエスカレーション処理を行う\n",
        "opencode/skills/session/SKILL.md": "---\nname: session\ndescription: \"Unified session management - initialization, memory persistence, state control, and cross-session communication. Use when managing Claude Code sessions.\"\nallowed-tools: [\"Read\", \"Bash\", \"Write\", \"Edit\", \"Glob\"]\n---\n\n# Session Skill (Unified)\n\nConsolidates all session-related functionality into one skill.\n\n## Capabilities\n\n| Feature | Description | Reference |\n|---------|-------------|-----------|\n| **Initialization** | Start new session, load context | See [../session-init/SKILL.md](../session-init/SKILL.md) |\n| **Memory** | Persist learnings across sessions | See [../session-memory/SKILL.md](../session-memory/SKILL.md) |\n| **State Control** | Resume/fork session based on flags | See [references/session-control.md](references/session-control.md) |\n| **Communication** | Cross-session messaging | See [../session-state/SKILL.md](../session-state/SKILL.md) |\n\n## When to Use\n\n- Session initialization (`/harness-init`)\n- Session resume/fork (`/work --resume`, `/work --fork`)\n- Memory persistence (automatic)\n- Cross-session communication (`/session broadcast`)\n\n## Execution Flow\n\n### 1. Session Initialization\n\n```\n/harness-init\n    ↓\n├── Load project context\n├── Initialize session.json\n├── Load previous session memory (if exists)\n└── Display session status\n```\n\n### 2. Session Control (from /work)\n\n```\n/work --resume\n    ↓\n├── Check session.json exists\n├── Load session state\n└── Continue from last checkpoint\n\n/work --fork\n    ↓\n├── Create new session branch\n├── Copy relevant context\n└── Start fresh with context\n```\n\n### 3. Memory Persistence\n\n```\nSession end\n    ↓\n├── Extract learnings (gotchas, patterns)\n├── Update .claude/memory/*.md\n└── Prepare handoff summary\n```\n\n### 4. Cross-Session Communication\n\n```\n/session broadcast \"message\"\n    ↓\n├── Find active sessions\n├── Write to session.events.jsonl\n└── Notify all sessions\n```\n\n## Files Managed\n\n| File | Purpose |\n|------|---------|\n| `.claude/state/session.json` | Current session state |\n| `.claude/state/session.events.jsonl` | Event log for cross-session communication |\n| `.claude/memory/*.md` | Persistent memory files |\n\n## Migration Note\n\nThis skill consolidates:\n- `session-init` → Session initialization\n- `session-memory` → Memory persistence\n- `session-control` → Resume/fork control\n- `session-state` → State management & communication\n\nThe individual skills are deprecated but still work for backward compatibility.\n",
        "opencode/skills/session/references/session-control.md": "---\nname: session-control\ndescription: \"Apply /work --resume/--fork flags by updating session state files.\"\nallowed-tools: [\"Read\", \"Bash\", \"Write\", \"Edit\"]\n---\n\n# Session Control\n\n## 入力\n\nworkflow 変数:\n- `resume_session_id` (string)\n- `resume_latest` (boolean)\n- `fork_session_id` (string)\n- `fork_reason` (string)\n\n## 実行\n\n### 1) 引数の決定\n- resume:\n  - `resume_latest == true` → `--resume latest`\n  - それ以外で `resume_session_id` があれば `--resume <id>`\n- fork:\n  - `fork_session_id` があれば `--fork <id>`、なければ `--fork current`\n  - `fork_reason` があれば `--reason \"<text>\"`\n\n### 2) スクリプト実行\n```bash\n./scripts/session-control.sh --resume <id|latest>\n./scripts/session-control.sh --fork <id|current> --reason \"<text>\"\n```\n\n## 期待される結果\n- `.claude/state/session.json` が更新される\n- `.claude/state/session.events.jsonl` に `session.resume` または `session.fork` が追記される\n- エラー時は stderr に理由が出力される\n",
        "opencode/skills/session/references/state-transition.md": "---\nname: state-transition\ndescription: \"Execute session state transitions using session-state.sh\"\nallowed-tools: [Read, Bash]\n---\n\n# State Transition\n\nセッション状態の遷移を実行する。\n\n## 入力\n\nworkflow 変数:\n- `target_state` (string): 遷移先の状態\n- `event_name` (string): トリガーイベント\n- `event_data` (string, optional): イベント付加データ (JSON)\n\n## 有効な状態\n\n| 状態 | 説明 |\n|------|------|\n| `idle` | セッション未開始 |\n| `initialized` | SessionStart 完了 |\n| `planning` | Plan/Work の準備 |\n| `executing` | /work 実行中 |\n| `reviewing` | review 実行中 |\n| `verifying` | build/test 実行中 |\n| `escalated` | 人間確認待ち |\n| `completed` | 成果物確定 |\n| `failed` | 回復不能 |\n| `stopped` | Stop hook 到達 |\n\n## 代表的な遷移\n\n| From | Event | To |\n|------|-------|----|\n| idle | session.start | initialized |\n| initialized | plan.ready | planning |\n| planning | work.start | executing |\n| executing | work.task_complete | reviewing |\n| reviewing | verify.start | verifying |\n| verifying | verify.passed | completed |\n| verifying | verify.failed | escalated |\n| * | session.stop | stopped |\n| stopped | session.resume | initialized |\n\n## 実行\n\n```bash\n./scripts/session-state.sh --state <state> --event <event> [--data <json>]\n```\n\n### 例: 実行状態への遷移\n\n```bash\n./scripts/session-state.sh --state executing --event work.start\n```\n\n### 例: エスカレーション（データ付き）\n\n```bash\n./scripts/session-state.sh --state escalated --event escalation.requested \\\n  --data '{\"reason\":\"Build failed 3 times\",\"retry_count\":3}'\n```\n\n## 期待される結果\n\n- `.claude/state/session.json` の `state`, `updated_at`, `last_event_id`, `event_seq` が更新される\n- `.claude/state/session.events.jsonl` にイベントが追記される\n- 不正な遷移は stderr にエラー出力 + 非ゼロ終了\n\n## エラーハンドリング\n\n遷移が失敗した場合（不正な遷移など）:\n1. 現在の状態と許可された遷移を stderr に出力\n2. 非ゼロ終了コードを返す\n3. 呼び出し元（workflow）でエスカレーション処理を行う\n",
        "opencode/skills/setup/SKILL.md": "---\nname: setup\ndescription: \"Sets up new projects and generates workflow files like CLAUDE.md, AGENTS.md, Plans.md. Use when user mentions setup, initialization, new projects, or workflow file generation. Do NOT load for: implementation work, reviews, build verification, or deployments.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Grep\", \"Glob\", \"Bash\"]\nuser-invocable: false\n---\n\n# Setup Skills\n\nプロジェクトセットアップとワークフローファイル生成を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **適応的セットアップ** | See [references/adaptive-setup.md](references/adaptive-setup.md) |\n| **スキャフォールディング** | See [references/project-scaffolding.md](references/project-scaffolding.md) |\n| **ワークフローファイル** | See [references/workflow-files.md](references/workflow-files.md) |\n| **設定ファイル** | See [references/claude-settings.md](references/claude-settings.md) |\n| **プロジェクト種別確認** | See [references/project-type-detection.md](references/project-type-detection.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従ってセットアップ\n",
        "opencode/skills/setup/references/adaptive-setup.md": "---\nname: adaptive-setup\ndescription: \"プロジェクト分析に基づいた適応型セットアップを実行するスキル。プロジェクトの状況に応じて適切なセットアップを自動選択する場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Bash\"]\n---\n\n# Adaptive Setup Skill\n\nプロジェクトの状態を分析し、適応的にルールとコマンドを配置するスキル。\n\n---\n\n## 概要\n\n従来の「テンプレートコピー」から「3フェーズ適応型セットアップ」に進化。\n\n```\nPhase 1: プロジェクト分析\n    ↓\nPhase 2: ルールカスタマイズ\n    ↓\nPhase 3: インタラクティブ確認\n    ↓\n配置完了\n```\n\n---\n\n## Phase 1: プロジェクト分析\n\n```bash\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nANALYSIS=$(\"$PLUGIN_PATH/scripts/analyze-project.sh\")\n```\n\n収集する情報：\n- 技術スタック (Node.js, Python, Rust, etc.)\n- フレームワーク (React, Next.js, Django, etc.)\n- テストフレームワーク (Jest, Pytest, etc.)\n- 既存の Linter/Formatter 設定\n- 既存の Claude/Cursor 設定\n- Git 情報 (Conventional Commits 等)\n- 重要視されている事項\n\n---\n\n## Phase 2: ルールカスタマイズ\n\n分析結果に基づいて：\n\n1. **基本ルール選択**: workflow, plans-management, coding-standards, testing\n2. **技術スタック別追加**: React/Next.js, Python, Rust 等のルール\n3. **既存規約反映**: ESLint, Prettier 設定をルールに組み込み\n4. **重要事項のルール化**: テスト必須、アクセシビリティ、セキュリティ等\n\n---\n\n## Phase 3: 確認と配置\n\nユーザーに分析結果と生成ルールを表示し、確認後に配置。\n\n既存設定がある場合はマージ（上書きではない）。\n\n---\n\n## 関連ファイル\n\n- `scripts/analyze-project.sh`\n- `templates/rules/`\n- `commands/setup-cursor.md`\n",
        "opencode/skills/setup/references/claude-settings.md": "---\nname: generate-claude-settings\ndescription: \"Claude Code の `.claude/settings.json` を安全ポリシー込みで作成/更新する（既存設定は非破壊マージ）。/harness-init や /setup-cursor から呼び出して、権限ガードをチーム運用できる形に整備する。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Generate Claude Settings (Security + Merge)\n\n## 目的\n\nプロジェクトの `.claude/settings.json` を作成または更新し、以下を満たす状態にします。\n\n- **既存設定は保持**（`hooks` / `env` / `model` / `enabledPlugins` 等を消さない）\n- `permissions.allow|ask|deny` は **配列マージ + 重複排除**\n- **bypassPermissions を前提とした運用**（危険操作のみ deny/ask で制御）\n- 既存ファイルが壊れている場合は **バックアップを残して再生成**\n\n## ⚠️ 重要: パーミッション構文の厳守\n\n**このスキルを実行する際は、必ず正しいパーミッション構文を使用すること。**\n\nプレフィックスマッチングには `:*` を使用（`*` 単独や ` *` は不可）：\n\n- ✅ 正しい: `\"Bash(npm run:*)\"`, `\"Bash(git status:*)\"`\n- ❌ 間違い: `\"Bash(npm run *)\"`, `\"Bash(git status*)\"`, `\"Bash(npm run :*)\"`\n\n詳細は [Step 4](#step-4-新規生成既存なし退避後) の「パーミッション構文の注意点」を参照。\n\n## bypassPermissions 前提の運用ポリシー\n\n**重要**: Edit / Write を `permissions.ask` に入れると毎回確認が出て生産性が落ちます。\n代わりに、bypassPermissions を有効にして危険操作のみを制御する方針を推奨します。\n\n- `permissions.deny`: 機密ファイル読み取り（.env, secrets, SSH鍵）、危険なDB操作\n- `permissions.ask`: ファイル削除、git push/reset/rebase/merge\n- `permissions.allow`: MCP サーバーのワイルドカード許可（下記参照）\n- **Edit / Write は ask に入れない**（確認が毎回出るのを避ける）\n\n### MCP サーバーのワイルドカード許可\n\nMCP サーバーのツールを一括許可するには `mcp__<server>__*` パターンを使用します。\n\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"mcp__supabase__*\",\n      \"mcp__context7__*\",\n      \"mcp__serena__*\"\n    ]\n  }\n}\n```\n\n| パターン | 許可される操作 |\n|---------|---------------|\n| `mcp__supabase__*` | Supabase MCP の全ツール（query, apply_migration 等） |\n| `mcp__context7__*` | Context7 ドキュメント検索ツール |\n| `mcp__serena__*` | Serena LSP 連携ツール |\n| `mcp__playwright__*` | Playwright ブラウザ操作ツール |\n\n### LSP 機能の活用\n\nClaude Code の LSP 機能を活用するには、**公式LSPプラグイン（マーケットプレイス）** をインストールします。\n\n```bash\n# 例: TypeScript/JavaScript 用\nclaude plugin install typescript-lsp\n\n# 例: Python 用\nclaude plugin install pyright-lsp\n\n# 例: Rust 用\nclaude plugin install rust-analyzer-lsp\n```\n\n**LSP で利用可能な機能:**\n- 定義ジャンプ (go-to-definition)\n- 参照検索 (find-references)\n- シンボルリネーム (rename)\n- 診断情報 (diagnostics)\n\n詳細: [docs/LSP_INTEGRATION.md](../../../docs/LSP_INTEGRATION.md) または `/lsp-setup` コマンドを実行してください。\n\n**注意**: プロジェクトで使用する MCP サーバーに合わせて設定してください。\n\n初回 init 後は、以下どちらかで bypassPermissions を有効化する導線を案内します：\n\n- **推奨（プロジェクト限定・未コミット）**: `.claude/settings.local.json` に `permissions.defaultMode: \"bypassPermissions\"` を設定\n- **一時的（セッション限定）**: `claude --dangerously-skip-permissions`\n\n根拠（公式）: `settings.json` と `permissions`（ask/deny/disableBypassPermissionsMode）\nhttps://code.claude.com/docs/ja/settings\n\n---\n\n## 対象ファイル\n\n- 生成/更新先: `.claude/settings.json`\n- ポリシーテンプレ: `templates/claude/settings.security.json.template`\n\n---\n\n## 実行手順（安全・非破壊）\n\n### Step 0: 前提チェック\n\n以下を確認します。\n\n- `templates/claude/settings.security.json.template` が存在する\n- `.claude/` がなければ作成（ディレクトリのみ）\n\n### Step 1: 既存設定の有無を確認\n\n- `.claude/settings.json` が **ない** → Step 4 でテンプレから生成\n- `.claude/settings.json` が **ある** → Step 2 でパースできるか確認\n\n### Step 2: JSONパース可否の判定\n\n優先順で判定します。\n\n1. `jq` がある場合: `jq empty .claude/settings.json`\n2. `python3` がある場合: `python3 -m json.tool .claude/settings.json`\n\nパースに失敗したら:\n\n- `.claude/settings.json.bak`（またはタイムスタンプ付き）に退避\n- Step 4 でテンプレから再生成\n\n### Step 3: 既存設定とポリシーをマージ\n\n**重要**: `/harness-update` から呼び出される場合、Phase 1.5 で破壊的変更（パーミッション構文修正、非推奨設定削除）が既に適用されています。\n\n#### マージ方針\n\n- **top-level**: 既存を優先しつつ、ポリシー側の `permissions` を統合\n- `permissions.allow|ask|deny`: **ユニーク化して結合**（既存→ポリシーの順）\n- `permissions.disableBypassPermissionsMode`: **設定しない**（bypassPermissions を許可）\n  - **注意**: 既存設定にこのフィールドがある場合、削除すること（`/harness-update` では Phase 1.5 で削除済み）\n\n#### 実装（推奨コマンド）\n\n`jq` がある場合:\n\n1. 既存とポリシーを読み込み\n2. `allow/ask/deny` を配列として結合 → `unique`（順序は多少変わってOK）\n3. `.claude/settings.json.tmp` に書き出し → 置換\n\n`jq` がない場合（python3）:\n\n1. `json.load` で既存/ポリシーを読み込み\n2. `permissions` を辞書としてマージ\n3. `allow/ask/deny` は list を `dict.fromkeys` 等で重複排除（順序維持）\n4. `indent=2, sort_keys=false` で出力\n\n**注意**: 既存の `hooks` は消さないこと。`permissions` 以外は原則、既存を尊重する。\n\n### Step 4: 新規生成（既存なし・退避後）\n\n- `templates/claude/settings.security.json.template` を `.claude/settings.json` にコピーして作成\n- 必要なら、将来の拡張（hooks追加等）は「既存マージ」ルート（Step 3）で行う\n\n**⚠️ 重要: パーミッション構文の注意点**\n\nプレフィックスマッチングには必ず `:*` を使用すること（`*` 単独は不可）：\n\n**正しい構文:**\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Bash(npm run:*)\",\n      \"Bash(pnpm:*)\",\n      \"Bash(git status:*)\",\n      \"Bash(git diff:*)\",\n      \"Bash(git log:*)\",\n      \"Bash(git branch:*)\",\n      \"Bash(ls:*)\",\n      \"Bash(cat:*)\"\n    ],\n    \"ask\": [\n      \"Bash(git add:*)\",\n      \"Bash(git commit:*)\",\n      \"Bash(git push:*)\",\n      \"Bash(git checkout:*)\",\n      \"Bash(rm:*)\",\n      \"Bash(mv:*)\"\n    ],\n    \"deny\": [\n      \"Bash(git push --force:*)\",\n      \"Bash(git reset --hard:*)\",\n      \"Bash(:*credentials:*)\",\n      \"Bash(:*password:*)\",\n      \"Bash(:*secret:*)\"\n    ]\n  }\n}\n```\n\n> **Note (v2.1.21+)**: Claude Code v2.1.21 以降、Claude は `cat` / `sed` / `awk` より Read / Edit / Write ツールを優先します。そのため `Bash(cat:*)` の発火頻度は低下しますが、フォールバック用に維持してください。\n\n**間違った構文（絶対に使用しないこと）:**\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Bash(npm run *)\",        // ❌ 間違い\n      \"Bash(pnpm *)\",           // ❌ 間違い\n      \"Bash(git diff*)\",        // ❌ 間違い\n      \"Bash(*credentials*)\"     // ❌ 間違い\n    ]\n  }\n}\n```\n\n**構文ルール:**\n- プレフィックスマッチ: `Bash(command:*)` - コマンド以降の全てにマッチ\n- 部分文字列マッチ: `Bash(:*substring:*)` - 任意の位置の文字列にマッチ\n- スペースは含まない: `Bash(npm run:*)` は正しい、`Bash(npm run :*)` は間違い\n\n---\n\n## 期待する出力\n\n- `.claude/settings.json` が存在し、JSONとしてパース可能\n- `permissions.deny` に `.env` / `secrets` / SSH鍵系の `Read(...)` が含まれる\n- `permissions.ask` に `Bash(rm:*)` / `Bash(git push:*)` 等が含まれる（**Edit / Write は含まない**）\n- `permissions.disableBypassPermissionsMode` が **設定されていない**（bypassPermissions 許可）\n\n---\n\n## 失敗時の扱い\n\n- パース不可の場合でも **必ずバックアップ**を残す\n- 生成後に `jq empty` または `python -m json.tool` で妥当性を確認\n\n---\n\n## bypassPermissions 有効化の導線\n\n### Step 5: ユーザーへの案内（生成後に表示）\n\n設定ファイル生成後、以下のメッセージを表示してユーザーに案内します:\n\n```\n✅ .claude/settings.json を生成しました\n\n📌 推奨（プロジェクト限定・未コミット）: `.claude/settings.local.json` で bypassPermissions を既定化できます。\n   cp templates/claude/settings.local.json.template .claude/settings.local.json\n\n一時的に試すだけなら:\n   claude --dangerously-skip-permissions\n\n⚠️ 注意: deny/ask に設定した危険操作（rm、git push等）は引き続き制御されます。\n```\n\n### オプション: settings.local.json の配置\n\nClaude Code の設定優先順位は `.claude/settings.local.json`（ローカル）→ `.claude/settings.json`（共有）→ `~/.claude/settings.json`（ユーザー）です。\nよって、bypassPermissions を「このプロジェクトだけ」有効にしたい場合は `.claude/settings.local.json` を推奨します。\n\n```bash\n# テンプレートをコピー\ncp templates/claude/settings.local.json.template .claude/settings.local.json\n\n# 必要に応じてカスタマイズ\n# settings.local.json は settings.json より優先されます\n```\n",
        "opencode/skills/setup/references/project-scaffolding.md": "---\nname: project-scaffolder\ndescription: \"プロジェクトの初期構造を生成するスキル。新規プロジェクトの初期構造を生成する場合に使用します。\"\nallowed-tools: [\"Write\", \"Bash\"]\n---\n\n# Project Scaffolder\n\nプロジェクトの初期構造（ディレクトリ、設定ファイル、基本ファイル）を生成するスキル。\n\n---\n\n## 目的\n\nヒアリング結果と技術スタック提案に基づいて、プロジェクトの基本構造を自動生成する。\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `project_type` | プロジェクトの種類（web, api, fullstack, etc.） |\n| `tech_stack` | 選択された技術スタック |\n| `project_name` | プロジェクト名 |\n| `requirements` | ヒアリングで得られた要件 |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `created_files` | 生成されたファイルのリスト |\n| `project_structure` | ディレクトリ構造の概要 |\n\n---\n\n## 生成するファイル\n\n### 共通\n\n- `package.json` または `pyproject.toml`（言語に応じて）\n- `.gitignore`\n- `README.md`\n\n### Web フロントエンド\n\n```\nsrc/\n├── components/\n├── pages/ または app/\n├── styles/\n└── lib/\n```\n\n### API バックエンド\n\n```\napp/\n├── api/\n├── models/\n├── services/\n└── utils/\n```\n\n---\n\n## 実行手順\n\n1. **技術スタックに基づくテンプレート選択**\n   - Next.js, React, Vue, Svelte などフレームワーク判定\n   - Python, Node.js, Go など言語判定\n\n2. **ディレクトリ構造の生成**\n   - 必要なディレクトリを作成\n   - プレースホルダーファイルを配置\n\n3. **設定ファイルの生成**\n   - package.json / pyproject.toml\n   - tsconfig.json / eslint.config.js など\n   - .env.example\n\n4. **初期ファイルの生成**\n   - エントリーポイント（index.ts, main.py など）\n   - 基本コンポーネント\n\n---\n\n## 注意事項\n\n- 既存ファイルがある場合は上書きしない（確認を求める）\n- 生成後は `npm install` や `pip install` を自動実行しない（ユーザー確認後）\n- 生成されたファイルの一覧をユーザーに提示する\n",
        "opencode/skills/setup/references/project-type-detection.md": "---\nname: ask-project-type\ndescription: \"曖昧なプロジェクト状態（ambiguous）のときにユーザーへ新規/既存を質問し、project_type を確定するスキル\"\nallowed-tools: [\"Read\", \"AskUserQuestion\"]\n---\n\n# Ask Project Type Skill\n\n`project_type == 'ambiguous'` のときに呼び出され、ユーザーに「新規/既存」を質問して `project_type` を `new` または `existing` に確定します。\n\n---\n\n## 入力\n\nworkflow から渡される変数:\n\n| 変数 | 型 | 説明 |\n|------|-----|------|\n| `ambiguity_reason` | string | 曖昧判定の理由（`template_only`, `few_files`, `readme_only`, `scaffold_only`） |\n| `code_file_count` | number | 検出されたコードファイル数 |\n| `tech_stack` | object | 検出された技術スタック |\n\n---\n\n## 出力\n\n| 変数 | 型 | 説明 |\n|------|-----|------|\n| `project_type` | `\"new\"` \\| `\"existing\"` | ユーザー選択で確定したプロジェクトタイプ |\n\n---\n\n## 実行手順\n\n### Step 1: 理由の日本語変換\n\n```javascript\nconst REASON_MAP = {\n  \"template_only\": \"テンプレート直後の状態（package.json はあるがコードファイルがない）\",\n  \"few_files\": \"コードファイルが少量（1〜9ファイル）で判断困難\",\n  \"readme_only\": \"README.md / LICENSE のみ（ドキュメントだけ）\",\n  \"scaffold_only\": \"設定ファイルのみ（tsconfig.json, .eslintrc など）\"\n};\n```\n\n### Step 2: AskUserQuestion で質問\n\n**AskUserQuestion ツールを使用**:\n\n```json\n{\n  \"questions\": [\n    {\n      \"question\": \"プロジェクトの状態を判断できませんでした。どちらとして扱いますか？\",\n      \"header\": \"プロジェクト種別\",\n      \"options\": [\n        {\n          \"label\": \"新規プロジェクト\",\n          \"description\": \"最初からセットアップ。Plans.md に基本タスクを追加\"\n        },\n        {\n          \"label\": \"既存プロジェクト\",\n          \"description\": \"既存コードを破壊しない。不足ファイルのみ追加\"\n        }\n      ],\n      \"multiSelect\": false\n    }\n  ]\n}\n```\n\n**質問の前にコンテキストを表示**:\n\n```\n🤔 プロジェクトの状態を判断できませんでした。\n\n**検出結果**:\n- コードファイル: {{code_file_count}} ファイル\n- 理由: {{ambiguity_reason の日本語説明}}\n- 検出技術: {{tech_stack.frameworks があれば表示}}\n```\n\n### Step 3: 回答の処理\n\n| ユーザー選択 | project_type |\n|-------------|--------------|\n| 「新規プロジェクト」 | `\"new\"` |\n| 「既存プロジェクト」 | `\"existing\"` |\n\n### Step 4: 結果を返す\n\n確定した `project_type` を workflow に返す。\n\n---\n\n## 使用例\n\n### 入力例\n\n```json\n{\n  \"ambiguity_reason\": \"template_only\",\n  \"code_file_count\": 2,\n  \"tech_stack\": {\n    \"languages\": [\"typescript\"],\n    \"frameworks\": [\"next.js\"],\n    \"package_manager\": \"npm\"\n  }\n}\n```\n\n### 出力例\n\n```json\n{\n  \"project_type\": \"new\"\n}\n```\n\n---\n\n## 注意事項\n\n- **必ずユーザー入力を待つ**: 自動判定せず、明示的な選択を求める\n- **デフォルト選択なし**: どちらかを選ばせる（誤判定防止）\n- **キャンセル不可**: このスキルが呼ばれた時点で判定が必要\n",
        "opencode/skills/setup/references/workflow-files.md": "---\nname: generate-workflow-files\ndescription: \"ワークフロー用ファイル（AGENTS.md, CLAUDE.md, Plans.md）を生成するスキル。新しいワークフローファイルを生成する必要がある場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\"]\n---\n\n# Generate Workflow Files\n\nclaude-code-harness のワークフローに必要なファイルを生成するスキル。\n\n---\n\n## 目的\n\n2エージェント協調ワークフローに必要な以下のファイルを生成：\n- `AGENTS.md` - エージェント間の共通ルール\n- `CLAUDE.md` - Claude Code 固有の設定\n- `Plans.md` - タスク管理ファイル\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `project_type` | プロジェクトの種類 |\n| `tech_stack` | 技術スタック |\n| `requirements` | 要件リスト |\n| `templates` | 使用するテンプレートファイル |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `generated_files` | 生成されたファイルのリスト |\n| `workflow_ready` | ワークフロー準備完了フラグ |\n\n---\n\n## 生成ファイル\n\n### AGENTS.md\n\n```markdown\n# AGENTS.md\n\n## 0. 開発フロー概要\n[プロジェクト固有のフローを記載]\n\n## 1. エージェントの役割\n- Cursor (PM): 計画、レビュー、承認\n- Claude Code (Worker): 実装、テスト\n\n## 2. 環境・前提条件\n[技術スタックに基づく環境情報]\n\n...\n```\n\n### CLAUDE.md\n\n```markdown\n# CLAUDE.md\n\n## Claude Code の責務範囲\n- 担当する作業\n- 禁止事項\n\n## コミットメッセージ規約\n- feat: / fix: / docs: / refactor: / test: / chore:\n\n...\n```\n\n### Plans.md\n\n```markdown\n# Plans.md\n\n## 現在のフェーズ\n[初期状態]\n\n## タスク一覧\n- [ ] cc:TODO - 初期セットアップ\n\n...\n```\n\n---\n\n## テンプレート変数\n\n| 変数 | 説明 |\n|------|------|\n| `{{project_name}}` | プロジェクト名 |\n| `{{tech_stack}}` | 技術スタック |\n| `{{date}}` | 生成日 |\n| `{{requirements}}` | 要件リスト |\n\n---\n\n## 実行手順\n\n1. **テンプレートファイルの読み込み**\n   - `templates/AGENTS.md.template`\n   - `templates/CLAUDE.md.template`\n   - `templates/Plans.md.template`\n\n2. **変数の置換**\n   - プロジェクト情報を反映\n\n3. **ファイルの生成**\n   - 既存ファイルがあれば確認を求める\n\n4. **完了報告**\n   - 生成されたファイル一覧を提示\n\n---\n\n## 注意事項\n\n- 既存の AGENTS.md / CLAUDE.md / Plans.md がある場合は上書き確認\n- 2エージェント設定でない場合は CLAUDE.md のみ生成することも可能\n",
        "opencode/skills/troubleshoot/SKILL.md": "---\nname: troubleshoot\ndescription: \"Guides diagnosis and resolution when problems occur. Use when user mentions something broken, errors, or that it doesn't work. Do NOT load for: successful builds, new feature implementation, or reviews.\"\nallowed-tools: [\"Read\", \"Grep\", \"Bash\"]\ncontext: fork\n---\n\n# Troubleshoot Skill\n\n問題発生時の診断と解決をガイドするスキル。\nVibeCoder が技術的な知識なしで問題を解決できるよう支援します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「動かない」「エラーが出た」「壊れた」\n- 「うまくいかない」「失敗した」\n- 「なぜ？」「原因は？」\n- \"it's broken\", \"doesn't work\", \"error\", \"why?\"\n\n---\n\n## 概要\n\n問題が発生したとき、VibeCoder は技術的な詳細を理解する必要はありません。\nこのスキルが自動的に診断し、解決策を提示します。\n\n---\n\n## 診断フロー\n\n### Step 1: 症状の確認\n\n> 🔍 **何が起きましたか？**\n>\n> 簡単に教えてください：\n> - 「画面が真っ白」\n> - 「ボタンが動かない」\n> - 「データが保存されない」\n\n### Step 2: 自動診断\n\n```bash\n# 環境チェック\nnode -v\nnpm -v\ngit status -sb\n\n# エラーログ確認\nnpm run build 2>&1 | tail -20\nnpm test 2>&1 | tail -20\n\n# 依存関係チェック\nnpm ls --depth=0\n```\n\n### Step 3: 問題カテゴリの特定\n\n| カテゴリ | 症状 | 自動対応 |\n|---------|------|----------|\n| 依存関係 | `Cannot find module` | `npm install` |\n| 型エラー | `Type error` | error-recovery agent |\n| ビルドエラー | `Build failed` | error-recovery agent |\n| ランタイム | 画面が表示されない | ログ分析 |\n| 環境設定 | 接続エラー | 環境変数確認 |\n\n---\n\n## 問題別対応\n\n### 「ボタンが動かない / フォームが送信されない / UIが崩れる」\n\nUIの不具合は、**画面で再現して観測→修正→再検証**するのが最短です。\n\n1. **agent-browser を最優先で使う**（インストール: `npm install -g agent-browser`）\n   ```bash\n   # ページを開いてスナップショット取得\n   agent-browser open https://example.com/target-page\n   agent-browser snapshot -i -c\n\n   # 要素参照でクリック・入力\n   agent-browser click @e1\n   agent-browser fill @e2 \"test\"\n   ```\n   - 対象URLで再現 → スナップショット/コンソールを根拠に原因を絞る\n   - ソースコード（UI/状態管理/API/バリデーション）を確認して修正\n   - 同じ手順で再現しないことを確認\n   - 参考: `docs/OPTIONAL_PLUGINS.md`\n2. **agent-browser が使えない場合のフォールバック**\n   - MCP ブラウザツール（chrome-devtools, playwright）\n   - 再現手順（URL/手順/期待値/実際）\n   - スクリーンショット/動画\n   - コンソールログ/ネットワークログ\n\n### 「画面が真っ白」\n\n```\n🔍 診断中...\n\n考えられる原因:\n1. ビルドエラー\n2. JavaScript エラー\n3. ルーティング問題\n\n🔧 自動チェック:\n- ビルドログを確認... ✅ エラーなし\n- コンソールエラーを確認... ❌ エラー発見\n\n💡 解決策:\n「直して」と言ってください。自動修正を試みます。\n```\n\n### 「npm install が失敗」\n\n```\n🔍 診断中...\n\nエラー: `ERESOLVE unable to resolve dependency tree`\n\n🔧 解決策:\n1. キャッシュをクリア\n2. node_modules を再インストール\n\n実行してもいいですか？（はい/いいえ）\n```\n\n### 「Git がおかしい」\n\n```\n🔍 診断中...\n\n検出: マージコンフリクト発生\n\n🔧 解決策:\n1. コンフリクト箇所を表示\n2. 解決方法を提案\n\n「解決して」と言えば自動マージを試みます。\n```\n\n---\n\n## VibeCoder向け応答パターン\n\n### パターン1: 自動修正可能\n\n```\n⚠️ 問題を検出しました\n\n**問題**: モジュールが見つかりません\n**原因**: 依存関係の未インストール\n\n🔧 **自動修正します**\n→ `npm install` を実行中...\n✅ 修正完了！もう一度試してください。\n```\n\n### パターン2: 確認が必要\n\n```\n⚠️ 問題を検出しました\n\n**問題**: 設定ファイルの変更が必要\n**影響**: 動作に影響する可能性\n\n🤔 **確認させてください**:\n設定を変更しても大丈夫ですか？\n\n→ 「変更して」で実行\n→ 「説明して」で詳細を確認\n```\n\n### パターン3: エスカレーション\n\n```\n⚠️ 複雑な問題を検出しました\n\n**問題**: {{問題の概要}}\n**試した修正**: 3回失敗\n\n🆘 **Cursor (PM) への相談をおすすめします**\n\n以下を Cursor に共有してください:\n- エラー内容: {{要約}}\n- 試した対応: {{リスト}}\n- 推定原因: {{分析}}\n\n「報告書を作って」で共有用レポートを生成します。\n```\n\n---\n\n## よくある質問への自動応答\n\n| 質問 | 自動応答 |\n|------|----------|\n| 「なぜエラーになった？」 | エラーログを分析して原因を説明 |\n| 「どうすれば直る？」 | 具体的な解決手順を提示 |\n| 「前は動いてたのに」 | git log で最近の変更を確認 |\n| 「同じエラーが何度も」 | パターンを分析して根本対策を提案 |\n\n---\n\n## 診断コマンド\n\n### クイック診断\n\n```\n「診断して」\n→ 全般的な健全性チェック\n→ 問題があれば報告\n→ なければ「問題なし」\n```\n\n### 詳細診断\n\n```\n「詳しく診断して」\n→ 依存関係チェック\n→ ビルドテスト\n→ テスト実行\n→ 環境変数確認\n→ 詳細レポート出力\n```\n\n---\n\n## 予防的アドバイス\n\n問題を未然に防ぐため、以下をおすすめ：\n\n1. **定期的な `npm run build`**: 問題を早期発見\n2. **こまめなコミット**: 問題発生時に戻しやすい\n3. **Plans.md の更新**: 変更履歴を追跡可能に\n\n---\n\n## 注意事項\n\n- 自動修正は3回まで試行\n- 3回失敗したらエスカレーション\n- 破壊的な操作は必ず確認を取る\n- 修正履歴は session-log.md に記録\n\n---\n\n## 🔧 LSP 機能の活用\n\n問題解決では LSP（Language Server Protocol）を活用して正確に原因を特定します。\n\n### LSP Diagnostics による問題検出\n\n```\n🔍 LSP 診断実行中...\n\n📊 診断結果:\n\n| ファイル | 行 | メッセージ |\n|---------|-----|-----------|\n| src/api/user.ts | 23 | 'userId' は undefined の可能性があります |\n| src/components/Form.tsx | 45 | 型 'string' を型 'number' に割り当てることはできません |\n\n→ 2件の問題を検出\n→ 上記が「動かない」原因の可能性が高い\n```\n\n### Go-to-definition による原因追跡\n\n```\n🔍 原因追跡\n\nエラー: Cannot read property 'name' of undefined\n\n追跡:\n1. src/pages/user.tsx:34 - user.name を参照\n2. src/hooks/useUser.ts:12 - user を返す ← Go-to-definition\n3. src/api/user.ts:8 - API レスポンスが null の可能性\n\n→ API エラー時のハンドリング不足が原因\n```\n\n### VibeCoder 向けの使い方\n\n| 症状 | LSP 活用 |\n|------|---------|\n| 「動かない」 | Diagnostics でエラー箇所を特定 |\n| 「どこがおかしい？」 | Go-to-definition で原因を追跡 |\n| 「いつから壊れた？」 | Find-references で変更影響を確認 |\n\n詳細: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n",
        "opencode/skills/ui/SKILL.md": "---\nname: ui\ndescription: \"Generates UI components and feedback forms. Use when user mentions components, UI, hero sections, forms, feedback, or contact requests. Do NOT load for: authentication features, backend implementation, database operations, or business logic.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# UI Skills\n\nUIコンポーネントとフォームの生成を担当するスキル群です。\n\n## 制約の優先順位と適用条件\n\n1. 基本は `references/ui-skills.md` の制約を最優先で適用する。\n2. `references/frontend-design.md` は「尖った/独自/表現強め/ブランド強化」などが**明示**された場合のみ適用する。\n3. UI Skills の MUST/NEVER は原則維持。ただし**ユーザーが明示的に要求した場合のみ**以下の例外を許可する:\n   - グラデーション、発光、強い装飾\n   - アニメーション（追加・拡張）\n   - カスタム easing\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **制約セット** | See [references/ui-skills.md](references/ui-skills.md) / [references/frontend-design.md](references/frontend-design.md) |\n| **コンポーネント生成** | See [references/component-generation.md](references/component-generation.md) |\n| **フィードバックフォーム** | See [references/feedback-forms.md](references/feedback-forms.md) |\n\n## 実行手順\n\n1. **制約セットを適用**（優先順位に従う）\n2. **品質判定ゲート**（Step 0）\n3. ユーザーのリクエストを分類\n4. 上記の「機能詳細」から適切な参照ファイルを読む\n5. その内容に従って生成\n\n### Step 0: 品質判定ゲート（a11y チェックリスト）\n\nUI コンポーネント生成時は、アクセシビリティを確保:\n\n```markdown\n♿ アクセシビリティチェックリスト\n\n生成する UI は以下を満たすことを推奨：\n\n### 必須項目\n- [ ] 画像に alt 属性を設定\n- [ ] フォーム要素に label を関連付け\n- [ ] キーボード操作可能（Tab でフォーカス移動）\n- [ ] フォーカス状態が視覚的に分かる\n\n### 推奨項目\n- [ ] 色だけに依存しない情報伝達\n- [ ] コントラスト比 4.5:1 以上（テキスト）\n- [ ] aria-label / aria-describedby の適切な使用\n- [ ] 見出し構造（h1 → h2 → h3）が論理的\n\n### インタラクティブ要素\n- [ ] ボタンに適切なラベル（「詳細」ではなく「製品詳細を見る」）\n- [ ] モーダル/ダイアログのフォーカストラップ\n- [ ] エラーメッセージがスクリーンリーダーで読まれる\n```\n\n### VibeCoder 向け\n\n```markdown\n♿ 誰でも使えるデザインにするために\n\n1. **画像には説明をつける**\n   - 「商品画像」ではなく「赤いスニーカー、正面から」\n\n2. **クリックできる場所はキーボードでも操作可能に**\n   - Tab キーで移動、Enter で決定\n\n3. **色だけで判断させない**\n   - 赤=エラー だけでなく、アイコン+テキストも\n```\n",
        "opencode/skills/ui/references/component-generation.md": "---\nname: component\ndescription: \"UIコンポーネント生成（shadcn/ui 等）。ヒーローセクションや料金表などのUIを作りたい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Component Skill\n\nshadcn/uiベースのUIコンポーネントを生成するスキル。\n最初に `../ui-skills.md` と `../frontend-design.md` の適用条件を確認する。\n\n---\n\n## トリガーフレーズ\n\n- 「ヒーローセクションを作って」\n- 「料金表を作って」\n- 「フッターを作って」\n- 「お問い合わせフォームを作って」\n- 「UIコンポーネントを生成して」\n\n---\n\n## 機能\n\n- shadcn/uiコンポーネントの自動インストール\n- レスポンシブ対応\n- アクセシビリティ対応\n- Tailwind CSSカスタマイズ\n\n---\n\n## 対応コンポーネント\n\n- Hero セクション\n- Pricing（料金表）\n- Features（機能紹介）\n- Contact（お問い合わせ）\n- Footer\n- Header/Navigation\n",
        "opencode/skills/ui/references/feedback-forms.md": "---\nname: feedback\ndescription: \"フィードバック収集機能の実装。ユーザーからの声を集めたい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Feedback Skill\n\nアプリ内フィードバックフォームを実装するスキル。\n最初に `../ui-skills.md` と `../frontend-design.md` の適用条件を確認する。\n\n---\n\n## トリガーフレーズ\n\n- 「フィードバック機能を追加して」\n- 「ユーザーの声を集めたい」\n- 「バグ報告フォームを作って」\n- 「お問い合わせフォームを追加して」\n\n---\n\n## 機能\n\n- フィードバックフォーム\n- バグ報告\n- 機能リクエスト\n- 満足度調査\n\n---\n\n## 実行フロー\n\n1. 制約セットの適用条件を確認\n2. プロジェクト構成を確認\n3. フィードバックの種類を選択\n4. フォームUIを作成\n5. APIエンドポイントを作成\n6. データ保存先を設定\n",
        "opencode/skills/ui/references/frontend-design.md": "---\nname: frontend-design-summary\ndescription: \"frontend-design の設計思考と美的指針の要約\"\n---\n\n# Frontend Design Summary\n\nUI の独自性と美的完成度を高めるための設計指針。\n明示要求がある場合のみ適用する。\n\n## 設計思考（最初に決める）\n- Purpose: 誰の何を解決する UI か\n- Tone: 大胆な方向性を 1 つ選ぶ（例: minimal / brutalist / editorial / playful）\n- Constraints: 技術制約と a11y\n- Differentiation: その UI の「記憶に残る 1 点」を決める\n\n## 実装の品質基準\n- Production-grade で実際に動く\n- 視覚的に印象が強く、一貫した方向性\n- 細部の詰め（余白、階層、状態）\n\n## デザイン指針\n- Typography: 目を引く display と読みやすい body のペア\n- Color: 主役色と鋭いアクセントを明確に\n- Motion: 大きな 1 回の演出に集中（分散しすぎない）\n- Space: 余白 or 高密度を意図的に選ぶ\n- Background: 雰囲気のあるレイヤーや質感（必要なら）\n\n## 注意\n- 方向性は「意図の強さ」が重要。派手さの有無ではない。\n- 実装の複雑さはデザインの方向性に合わせる。\n\n## Source\n- external frontend-design skill (Anthropic)\n",
        "opencode/skills/ui/references/ui-skills.md": "---\nname: ui-skills-summary\ndescription: \"UI Skills の制約セット要約（実装品質優先）\"\n---\n\n# UI Skills Summary\n\nUI 実装で破綻しやすいポイントを防ぐための制約セット。\n\n## Stack\n- MUST: Tailwind CSS はデフォルト値を使う（既存カスタムか明示要求がある場合のみ例外）\n- MUST: JavaScript のアニメーションが必要なら `motion/react` を使う\n- SHOULD: Tailwind の入場/軽微アニメに `tw-animate-css`\n- MUST: class 制御は `cn`（`clsx` + `tailwind-merge`）\n\n## Components\n- MUST: キーボード/フォーカス挙動はアクセシブルなプリミティブを使う\n- MUST: 既存のプリミティブを優先\n- NEVER: 同一の操作面でプリミティブを混在させない\n- SHOULD: 互換があるなら Base UI を優先\n- MUST: アイコンのみボタンには `aria-label`\n- NEVER: キーボード/フォーカス挙動を手実装しない（明示要求がない限り）\n\n## Interaction\n- MUST: 破壊的操作は AlertDialog\n- SHOULD: ローディングは構造的スケルトン\n- NEVER: `h-screen` は使わず `h-dvh`\n- MUST: fixed 要素は `safe-area-inset` を考慮\n- MUST: エラーは操作箇所の近くに出す\n- NEVER: input/textarea の貼り付けをブロックしない\n\n## Animation\n- NEVER: 明示要求がない限りアニメーション追加しない\n- MUST: `transform` / `opacity` のみをアニメーション\n- NEVER: `width/height/top/left/margin/padding` をアニメーション\n- SHOULD: `background/color` のアニメは小さな局所 UI のみ\n- SHOULD: 入口は `ease-out`\n- NEVER: フィードバックは 200ms 超えない\n- MUST: ループはオフスクリーンで停止\n- SHOULD: `prefers-reduced-motion` を尊重\n- NEVER: カスタム easing は明示要求がない限り禁止\n- SHOULD: 大きな画像/全面面はアニメを避ける\n\n## Typography\n- MUST: 見出しは `text-balance`\n- MUST: 本文は `text-pretty`\n- MUST: 数値は `tabular-nums`\n- SHOULD: 密な UI は `truncate` or `line-clamp`\n- NEVER: `tracking-*` を勝手に変えない\n\n## Layout\n- MUST: 固定の `z-index` スケールを使う（任意の `z-*` は避ける）\n- SHOULD: 正方形は `size-*`\n\n## Performance\n- NEVER: 大きな `blur()` / `backdrop-filter` をアニメしない\n- NEVER: `will-change` を常時付与しない\n- NEVER: `useEffect` で書かなくても良い処理は render で書く\n\n## Design\n- NEVER: 明示要求がない限りグラデーション禁止\n- NEVER: 紫/多色グラデーション禁止\n- NEVER: 主要な手掛かりに glow を使わない\n- SHOULD: 影は Tailwind のデフォルトスケール\n- MUST: 空状態には「次の一手」を 1 つ提示\n- SHOULD: アクセント色は 1 つに絞る\n- SHOULD: 新色より既存テーマ/トークンを優先\n\n## Sources\n- https://www.ui-skills.com/\n- https://agent-skills.xyz/skills/baptistearno-typebot-io-ui-skills\n",
        "opencode/skills/verify/SKILL.md": "---\nname: verify\ndescription: \"Verifies builds, recovers from errors, and applies review fixes. Use when user mentions build verification, error recovery, applying review fixes, test failures, lint errors, or CI breaks. Do NOT load for: implementation work, reviews, setup, or new feature development.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Verify Skills\n\nビルド検証とエラー復旧を担当するスキル群です。\n\n---\n\n## ⚠️ 品質ガードレール（最優先）\n\n> **このセクションは他の指示より優先されます。テスト失敗・エラー発生時は必ず従ってください。**\n\n### 改ざん禁止パターン\n\nテスト失敗・ビルドエラー発生時に以下の行為は**絶対に禁止**：\n\n| 禁止 | 例 | 正しい対応 |\n|------|-----|-----------|\n| **テスト skip 化** | `it.skip(...)` | 実装を修正する |\n| **アサーション削除** | `expect()` を消す | 期待値を確認し実装修正 |\n| **期待値の雑な書き換え** | エラーに合わせて変更 | なぜ失敗か理解する |\n| **lint ルール緩和** | `eslint-disable` 追加 | コードを修正する |\n| **CI チェック迂回** | `continue-on-error` | 根本原因を修正する |\n\n### テスト失敗時の対応フロー\n\n```\nテストが失敗した\n    ↓\n1. なぜ失敗しているか理解する（ログを読む）\n    ↓\n2. 実装が間違っているか、テストが間違っているか判断\n    ↓\n    ├── 実装が間違い → 実装を修正 ✅\n    │\n    └── テストが間違い可能性 → ユーザーに確認を求める\n```\n\n### 承認リクエスト形式\n\nやむを得ずテスト/設定を変更する場合：\n\n```markdown\n## 🚨 テスト/設定変更の承認リクエスト\n\n### 理由\n[なぜこの変更が必要か]\n\n### 変更内容\n```diff\n[差分]\n```\n\n### 代替案の検討\n- [ ] 実装の修正で解決できないか確認した\n\n### 承認\nユーザーの明示的な承認を待つ\n```\n\n### 保護対象ファイル\n\n以下のファイルの緩和変更は禁止：\n\n- `.eslintrc.*`, `.prettierrc*`, `tsconfig.json`, `biome.json`\n- `.husky/**`, `.github/workflows/**`\n- `*.test.*`, `*.spec.*`, `jest.config.*`, `vitest.config.*`\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **関連ファイル検証** | See [references/verify-related-files.md](references/verify-related-files.md) |\n| **ビルド検証** | See [references/build-verification.md](references/build-verification.md) |\n| **エラー復旧** | See [references/error-recovery.md](references/error-recovery.md) |\n| **レビュー集約** | See [references/review-aggregation.md](references/review-aggregation.md) |\n| **指摘適用** | See [references/applying-fixes.md](references/applying-fixes.md) |\n\n## 実行手順\n\n1. **品質判定ゲート**（Step 0）\n2. ユーザーのリクエストを分類\n3. **（実装完了後）関連ファイル検証**（Step 1.5）\n4. **（Claude-mem 有効時）過去のエラーパターンを検索**\n5. 上記の「機能詳細」から適切な参照ファイルを読む\n6. その内容に従って検証/復旧実行\n\n### Step 0: 品質判定ゲート（再現テスト提案）\n\nエラー/バグ報告時に、TDD アプローチを提案:\n\n```\nエラー報告受領\n    ↓\n┌─────────────────────────────────────────┐\n│           品質判定ゲート                 │\n├─────────────────────────────────────────┤\n│  判定項目:                              │\n│  ├── バグ報告？ → 再現テスト先行を提案  │\n│  ├── テスト失敗？ → テスト vs 実装判断  │\n│  └── ビルドエラー？ → 直接修正          │\n└─────────────────────────────────────────┘\n          ↓\n    適切なアプローチを提案\n```\n\n#### バグ報告時の提案\n\n```markdown\n🐛 バグ報告を受け付けました\n\n**推奨アプローチ**: 再現テスト先行\n\n1. まずバグを再現するテストを書く\n2. テストが失敗することを確認（Red）\n3. 実装を修正してテストを通す（Green）\n4. リファクタリング（Refactor）\n\nこの方法で進めますか？\n1. 再現テストから書く（推奨）\n2. 直接修正に進む\n```\n\n#### テスト失敗時の判断フロー\n\n```markdown\n🔴 テストが失敗しています\n\n**判断が必要です**:\n\nテスト失敗の原因を分析:\n- [ ] 実装が間違っている → 実装を修正\n- [ ] テストの期待値が古い → ユーザーに確認\n\n⚠️ テストの改ざん（skip化、アサーション削除）は禁止です\n\nどちらに該当しますか？\n1. 実装を修正する\n2. テストの期待値について確認したい\n```\n\n#### VibeCoder 向け\n\n```markdown\n🐛 問題が報告されました\n\n**推奨**: まず「問題が起きる条件」を明確にしましょう\n\n1. どんな操作をすると問題が起きますか？\n2. 期待する動作は何ですか？\n3. 実際にはどうなりますか？\n\nこれを整理してから修正に進むと、確実に直せます。\n```\n\n### Step 1.5: 関連ファイル検証（実装完了後）\n\n実装完了後、コミット前に編集ファイルの関連ファイルをチェック：\n\n```\n編集ファイルを取得\n    ↓\n┌─────────────────────────────────────────┐\n│           関連ファイル検証               │\n├─────────────────────────────────────────┤\n│  変更パターンを分析:                     │\n│  ├── 関数シグネチャ変更 → 呼び出し元確認 │\n│  ├── 型/interface変更 → 実装箇所確認    │\n│  ├── export削除 → import文確認         │\n│  └── 設定変更 → 関連設定ファイル確認    │\n└─────────────────────────────────────────┘\n    ↓\n  修正漏れ候補を警告\n```\n\n**出力例**:\n\n```markdown\n📋 関連ファイル検証\n\n✅ 編集済み: src/auth.ts\n   └─ 関数 `validateToken` のシグネチャ変更を検出\n\n⚠️ 要確認: 以下のファイルが影響を受ける可能性\n   ├─ src/api/middleware.ts:45 (validateToken 呼び出し)\n   ├─ src/routes/protected.ts:12 (validateToken 呼び出し)\n   └─ tests/auth.test.ts:28 (テストケース)\n\n確認済みですか？\n1. 確認済み、続行\n2. 各ファイルを確認する\n3. LSP find-references で詳細表示\n```\n\n**重要度の判定**:\n\n| 重要度 | 条件 | アクション |\n|--------|------|-----------|\n| `🚨 critical` | 必ずエラーになる（export削除、必須引数追加） | 修正必須 |\n| `⚠️ warning` | エラーの可能性あり（オプショナル引数、型変更） | 確認推奨 |\n| `ℹ️ info` | 影響軽微（コメント、ドキュメント） | 参考情報 |\n\n詳細: [references/verify-related-files.md](references/verify-related-files.md)\n\n---\n\n### Step 2: 過去のエラーパターン検索（Memory-Enhanced）\n\nClaude-mem が有効な場合、エラー復旧前に過去の類似エラーを検索:\n\n```\n# mem-search で過去のエラーと解決策を検索\nmem-search: type:bugfix \"{エラーメッセージのキーワード}\"\nmem-search: concepts:problem-solution \"{エラーの種類}\"\nmem-search: concepts:gotcha \"{関連ファイル/ライブラリ}\"\n```\n\n**表示例**:\n\n```markdown\n📚 過去のエラー解決履歴\n\n| 日付 | エラー | 解決策 |\n|------|--------|-------|\n| 2024-01-15 | CORS エラー | Access-Control-Allow-Origin ヘッダー追加 |\n| 2024-01-20 | 型エラー: undefined | Optional chaining (?.) を使用 |\n\n💡 過去の解決策を参考に復旧を試行\n```\n\n**ガードレール履歴の表示**:\n\n```markdown\n⚠️ このプロジェクトでの過去のガードレール発動\n\n- テスト改ざん防止: 2回\n- lint 緩和防止: 1回\n\n💡 テスト/設定の改ざんによる「解決」は禁止です\n```\n\n> **注**: Claude-mem が未設定の場合、このステップはスキップされます。\n\n---\n\n## 🔧 LSP 機能の活用\n\n検証とエラー復旧では LSP（Language Server Protocol）を活用して精度を向上します。\n\n### ビルド検証での LSP 活用\n\n```\nビルド前チェック:\n\n1. LSP Diagnostics を実行\n2. エラー: 0件を確認 → ビルド実行\n3. エラーあり → 先にエラーを修正\n```\n\n### エラー復旧での LSP 活用\n\n| 復旧シーン | LSP 活用方法 |\n|-----------|-------------|\n| 型エラー | Diagnostics で正確な位置を特定 |\n| 参照エラー | Go-to-definition で原因を追跡 |\n| import エラー | Find-references で正しいパスを特定 |\n\n### 検証フロー\n\n```\n📊 LSP 検証結果\n\nStep 1: Diagnostics\n  ├── エラー: 0件 ✅\n  └── 警告: 2件 ⚠️\n\nStep 2: ビルド\n  └── 成功 ✅\n\nStep 3: テスト\n  └── 15/15 通過 ✅\n\n→ 検証完了\n```\n\n詳細: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n",
        "opencode/skills/verify/references/applying-fixes.md": "---\nname: review-apply-fixes\ndescription: \"レビューで検出された問題を自動修正するスキル。レビューで発見された問題の自動修正が承認された場合に使用します。\"\nallowed-tools: [\"Read\", \"Edit\", \"Bash\"]\n---\n\n# Review Apply Fixes\n\nレビューで検出された問題を自動修正するスキル。\n\n---\n\n## 目的\n\nレビュー結果に基づいて：\n- 自動修正可能な問題を特定\n- ユーザー確認後に修正を適用\n- 修正前後の diff を提示\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `improvement_suggestions` | 改善提案リスト |\n| `user_approved` | ユーザーが修正を承認したか |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `applied_fixes` | 適用された修正のリスト |\n| `skipped_fixes` | スキップされた修正のリスト |\n| `update_files` | 更新されたファイルのリスト |\n\n---\n\n## 自動修正可能な問題\n\n### 確実に自動修正できるもの\n\n| カテゴリ | 問題 | 修正方法 |\n|---------|------|---------|\n| 品質 | 未使用の import | 削除 |\n| 品質 | 未使用の変数 | 削除（または _ プレフィックス） |\n| 品質 | フォーマット | Prettier/ESLint --fix |\n| セキュリティ | console.log の削除 | 削除またはロガーに置換 |\n\n### 確認が必要なもの\n\n| カテゴリ | 問題 | 確認理由 |\n|---------|------|---------|\n| パフォーマンス | メモ化追加 | ロジック変更の可能性 |\n| 品質 | 関数分割 | 設計判断が必要 |\n| セキュリティ | 入力バリデーション | 仕様確認が必要 |\n\n### 自動修正しないもの\n\n| カテゴリ | 問題 | 理由 |\n|---------|------|------|\n| 設計 | アーキテクチャ変更 | 大規模な変更 |\n| ロジック | ビジネスロジック修正 | 仕様理解が必要 |\n\n---\n\n## 実行フロー\n\n```\n改善提案リスト\n    │\n    ▼\n┌─────────────────────────────┐\n│ 自動修正可能性の判定        │\n│ - 確実に修正可能            │\n│ - 確認が必要                │\n│ - 手動対応が必要            │\n└─────────────┬───────────────┘\n              │\n              ▼\n┌─────────────────────────────┐\n│ ユーザーへの確認            │\n│ - 適用する修正の一覧提示    │\n│ - 承認を待つ                │\n└─────────────┬───────────────┘\n              │\n    ┌─────────┴─────────┐\n    ▼                   ▼\n 承認              キャンセル\n    │                   │\n    ▼                   ▼\n 修正適用          修正なしで終了\n    │\n    ▼\n diff 提示\n```\n\n---\n\n## 出力例\n\n### 修正前の確認\n\n```markdown\n## 自動修正の確認\n\n以下の修正を適用しますか？\n\n### 適用予定 (3件)\n1. ✅ 未使用 import の削除 - `src/utils/helpers.ts:12`\n2. ✅ console.log の削除 - `src/api/posts.ts:45`\n3. ✅ フォーマット修正 - `src/components/Button.tsx`\n\n### 確認が必要 (1件)\n4. ⚠️ useMemo の追加 - `src/components/List.tsx:23`\n   - 計算処理のメモ化を追加しますか？\n\n### 手動対応が必要 (1件)\n5. ❌ 関数分割 - `src/services/user.ts:45`\n   - 設計判断が必要なため自動修正不可\n\n[適用する] [一部のみ] [キャンセル]\n```\n\n### 修正後のレポート\n\n```markdown\n## 修正完了\n\n### 適用された修正 (3件)\n1. ✅ 未使用 import の削除 - `src/utils/helpers.ts`\n2. ✅ console.log の削除 - `src/api/posts.ts`\n3. ✅ フォーマット修正 - `src/components/Button.tsx`\n\n### 変更 diff\n[diff を表示]\n\n### 次のステップ\n- ビルド検証を実行して問題がないことを確認\n- 手動対応が必要な 1 件を検討\n```\n\n---\n\n## 注意事項\n\n- 修正前に必ず diff を提示する\n- 破壊的な変更は行わない\n- 修正後にビルド検証を推奨する\n- 不明な場合はスキップする\n",
        "opencode/skills/verify/references/build-verification.md": "---\nname: verify-build\ndescription: \"ビルドとテストを実行して動作を確認する。実装完了後、またはレビュー前に動作確認が必要な場合に使用します。\"\nallowed-tools: [Read,Bash]\n---\n\n# Verify Build\n\n実装後にビルドとテストを実行し、変更が正常に動作することを確認するスキル。\n\n---\n\n## 目的\n\nコード変更後に以下を自動実行して、問題がないことを確認：\n- ビルドの成功\n- テストの通過\n- 型チェック（TypeScript の場合）\n- Lint チェック\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `changed_files` | 変更されたファイルのリスト |\n| `tech_stack` | プロジェクトの技術スタック |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `build_success` | ビルド成功フラグ |\n| `test_results` | テスト結果サマリー |\n| `errors` | エラーがあれば詳細 |\n\n---\n\n## 実行手順\n\n### 1. プロジェクトタイプの判定\n\n```\npackage.json あり → Node.js プロジェクト\npyproject.toml あり → Python プロジェクト\nCargo.toml あり → Rust プロジェクト\ngo.mod あり → Go プロジェクト\n```\n\n### 2. ビルドコマンドの実行\n\n**Node.js:**\n```bash\nnpm run build\n# または\nnpm run type-check\n```\n\n**Python:**\n```bash\npython -m py_compile app/**/*.py\n# または\nmypy app/\n```\n\n### 3. テストの実行\n\n**Node.js:**\n```bash\nnpm test\n# または\nnpm run test:unit\n```\n\n**Python:**\n```bash\npytest tests/\n```\n\n### 4. Lint チェック\n\n**Node.js:**\n```bash\nnpm run lint\n```\n\n**Python:**\n```bash\nruff check app/\n```\n\n---\n\n## 結果の判定\n\n| 状態 | 判定 | 次のアクション |\n|------|------|---------------|\n| すべて成功 | `build_success: true` | 次のステップへ進む |\n| ビルド失敗 | `build_success: false` | エラー修正スキルを起動 |\n| テスト失敗 | `build_success: false` | テスト修正スキルを起動 |\n\n---\n\n## 出力例\n\n### 成功時\n\n```\n✅ ビルド検証完了\n\n- ビルド: 成功\n- 型チェック: 成功\n- テスト: 12/12 通過\n- Lint: 問題なし\n\n次のステップに進めます。\n```\n\n### 失敗時\n\n```\n❌ ビルド検証失敗\n\n- ビルド: 成功\n- 型チェック: 成功\n- テスト: 10/12 通過 (2 件失敗)\n\n失敗したテスト:\n1. test_user_login - AssertionError\n2. test_create_post - TypeError\n\n自動修正を試みます...\n```\n\n---\n\n## 注意事項\n\n- テスト実行には時間がかかる場合があるため、進捗を表示する\n- 失敗時は `error-recovery` スキルと連携する\n- CI 環境と同じ条件でチェックすることを推奨\n",
        "opencode/skills/verify/references/error-recovery.md": "---\nname: error-recovery\ndescription: \"エラーが発生した際に自動修正を試みる。ビルドエラー、テスト失敗、または実行時エラーが検出された場合に使用します。\"\nallowed-tools: [Read,Edit,Bash]\n---\n\n# Error Recovery\n\nビルドやテストで発生したエラーを自動診断し、修正を試みるスキル。\n最大3回のリトライ後、解決しない場合はエスカレーションする。\n\n---\n\n## 目的\n\n- エラーの自動診断\n- 一般的なエラーパターンの自動修正\n- 修正不可能な場合の適切なエスカレーション\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `error_type` | エラーの種類（build, test, lint, runtime） |\n| `error_message` | エラーメッセージ |\n| `error_file` | エラーが発生したファイル |\n| `error_line` | エラーが発生した行番号 |\n| `retry_count` | 現在のリトライ回数 |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `fixed` | 修正成功フラグ |\n| `fix_description` | 修正内容の説明 |\n| `escalate` | エスカレーションが必要か |\n\n---\n\n## エラーパターンと自動修正\n\n### TypeScript / JavaScript\n\n| エラーパターン | 自動修正 |\n|--------------|---------|\n| `Cannot find module` | パッケージインストール or パス修正 |\n| `Type 'X' is not assignable` | 型定義の追加・修正 |\n| `Property 'X' does not exist` | オプショナルチェーン追加 |\n| `Expected X arguments` | 引数の追加・削除 |\n\n### Python\n\n| エラーパターン | 自動修正 |\n|--------------|---------|\n| `ModuleNotFoundError` | pip install or import 修正 |\n| `IndentationError` | インデント修正 |\n| `NameError` | 変数定義の追加 |\n| `TypeError` | 型変換の追加 |\n\n### テストエラー\n\n| エラーパターン | 自動修正 |\n|--------------|---------|\n| `AssertionError` | 期待値の確認・修正 |\n| `Timeout` | タイムアウト値の増加 |\n| `Mock not called` | モック設定の修正 |\n\n---\n\n## 実行フロー\n\n```\nエラー発生\n    │\n    ▼\n┌─────────────────────────────┐\n│ エラーパターンの分析        │\n│ - エラーメッセージ解析      │\n│ - ファイル・行番号特定      │\n│ - 関連コードの読み取り      │\n└─────────────┬───────────────┘\n              │\n              ▼\n┌─────────────────────────────┐\n│ 修正の試行                  │\n│ - パターンマッチング        │\n│ - 自動修正の適用            │\n│ - ビルド・テスト再実行      │\n└─────────────┬───────────────┘\n              │\n    ┌─────────┴─────────┐\n    ▼                   ▼\n 成功               失敗\n    │                   │\n    ▼                   ▼\n 完了           リトライ < 3?\n                    │\n          ┌─────────┴─────────┐\n          ▼                   ▼\n        再試行          エスカレーション\n```\n\n---\n\n## リトライ戦略\n\n**リトライ上限の決定**:\n- `claude-code-harness.config.yaml` の `orchestration.max_state_retries` があればそれを優先\n- 未設定時はデフォルト `3`\n\n| 回数 | 戦略 |\n|------|------|\n| 1回目 | 直接的なパターンマッチ修正 |\n| 2回目 | 関連ファイルを含めた広範な分析 |\n| 3回目 | 代替アプローチの試行 |\n\n---\n\n## エスカレーション\n\n3回のリトライで解決しない場合：\n\n```markdown\n## ⚠️ エラー修正エスカレーション\n\n**失敗回数**: 3回\n**エラー種別**: {{error_type}}\n\n### エラー内容\n{{error_message}}\n\n### 試した修正\n1. {{fix_attempt_1}}\n2. {{fix_attempt_2}}\n3. {{fix_attempt_3}}\n\n### 推定原因\n{{estimated_cause}}\n\n### 推奨アクション\n- [ ] 手動での確認が必要\n- [ ] 設計の見直しが必要\n```\n\n---\n\n## 注意事項\n\n- 修正は最小限の変更に留める\n- 修正前後で diff を提示する\n- 破壊的な変更は行わない\n- 不明な場合はユーザーに確認を求める\n",
        "opencode/skills/verify/references/review-aggregation.md": "---\nname: review-aggregate\ndescription: \"複数のレビュー結果を集約し総合評価を生成するスキル。複数のレビュー結果を統合して総合評価を作成する場合に使用します。\"\nallowed-tools: [\"Read\"]\n---\n\n# Review Aggregate\n\n複数のレビュー結果（セキュリティ、パフォーマンス、品質、アクセシビリティ）を集約し、総合評価を生成するスキル。\n\n---\n\n## 目的\n\n個別のレビュー結果を統合して：\n- 総合評価の算出\n- 優先度付けされた改善提案リストの生成\n- 次のアクションの提示\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `security_issues` | セキュリティレビュー結果 |\n| `performance_issues` | パフォーマンスレビュー結果 |\n| `quality_issues` | 品質レビュー結果 |\n| `a11y_issues` | アクセシビリティレビュー結果（該当する場合） |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `overall_grade` | 総合評価 (A-F) |\n| `improvement_suggestions` | 優先度付き改善提案リスト |\n\n---\n\n## 評価アルゴリズム\n\n### スコア計算\n\n各カテゴリのスコアを数値化：\n- A = 5, B = 4, C = 3, D = 2, F = 1\n\n### 重み付け\n\n| カテゴリ | 重み | 理由 |\n|---------|------|------|\n| セキュリティ | 35% | 最重要、脆弱性は致命的 |\n| パフォーマンス | 25% | ユーザー体験に直結 |\n| 品質 | 25% | 保守性に影響 |\n| アクセシビリティ | 15% | 重要だが全プロジェクトに該当しない |\n\n### 総合スコア算出\n\n```\n総合スコア = (セキュリティ × 0.35) + (パフォーマンス × 0.25)\n           + (品質 × 0.25) + (アクセシビリティ × 0.15)\n```\n\n### グレード判定\n\n| スコア範囲 | グレード |\n|-----------|---------|\n| 4.5 - 5.0 | A |\n| 3.5 - 4.4 | B |\n| 2.5 - 3.4 | C |\n| 1.5 - 2.4 | D |\n| 1.0 - 1.4 | F |\n\n---\n\n## 優先度付け\n\n### 優先度決定基準\n\n| 優先度 | 基準 |\n|--------|------|\n| クリティカル | セキュリティの重大な問題 |\n| 高 | セキュリティ中程度 / パフォーマンス重大 |\n| 中 | パフォーマンス中程度 / 品質重大 |\n| 低 | 品質軽微 / アクセシビリティ |\n\n---\n\n## 出力例\n\n```markdown\n## 📊 コードレビュー総合結果\n\n### 総合評価: B\n\n| 観点 | 評価 | 問題数 |\n|------|------|--------|\n| セキュリティ | B | 2 件 |\n| パフォーマンス | C | 3 件 |\n| コード品質 | A | 1 件 |\n| アクセシビリティ | B | 2 件 |\n\n---\n\n### 改善提案（優先度順）\n\n#### クリティカル (0件)\nなし\n\n#### 高優先度 (2件)\n1. **N+1 クエリ問題** - `src/api/posts.ts:23`\n   - パフォーマンスに重大な影響\n\n2. **SQL インジェクションの可能性** - `src/api/users.ts:45`\n   - セキュリティリスク\n\n#### 中優先度 (3件)\n3. **長すぎる関数** - `src/services/user.ts:45`\n4. **非仮想化リスト** - `src/components/List.tsx:45`\n5. **alt 属性欠落** - `src/components/Image.tsx:8`\n\n#### 低優先度 (1件)\n6. **未使用の import** - `src/utils/helpers.ts:12`\n\n---\n\n### 推奨アクション\n\n1. **すぐに対応**: 高優先度の 2 件を修正\n2. **今週中に対応**: 中優先度の 3 件を修正\n3. **余裕があれば**: 低優先度の 1 件を修正\n\n自動修正を適用しますか？\n```\n\n---\n\n## 注意事項\n\n- クリティカル問題がある場合はマージ推奨しない\n- 修正の自動適用は確認を求める\n- 改善による効果を具体的に説明する\n",
        "opencode/skills/verify/references/verify-related-files.md": "---\nname: verify-related-files\ndescription: \"編集したファイルに関連するファイルの修正漏れをチェックする。実装完了後、コミット前に使用します。\"\nallowed-tools: [Read, Grep, Glob, Bash]\n---\n\n# Verify Related Files\n\n実装後に編集ファイルを分析し、関連ファイルの修正漏れを検出するスキル。\n\n---\n\n## 目的\n\nコード変更後に以下を自動検出して、修正漏れを防止：\n- 関数シグネチャ変更 → 呼び出し元の未更新\n- 型/interface変更 → 実装箇所の不整合\n- export変更 → import文の未更新\n- 設定値変更 → 環境別設定の非同期\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `changed_files` | 編集されたファイルのリスト（git diffから取得） |\n| `project_type` | プロジェクトタイプ（typescript, python, go, etc.） |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `related_files` | 影響を受ける可能性のあるファイルリスト |\n| `severity` | 各ファイルの重要度（critical/warning/info） |\n| `check_reason` | なぜ確認が必要か |\n\n---\n\n## 実行手順\n\n### 1. 編集ファイルの取得\n\n```bash\n# ステージング済みの変更を取得\ngit diff --cached --name-only\n\n# または作業ツリーの変更\ngit diff --name-only\n```\n\n### 2. 変更内容の分析\n\n各編集ファイルについて以下を検出：\n\n| 検出項目 | 検出方法 |\n|---------|---------|\n| 関数シグネチャ変更 | git diff で引数・戻り値の変更を検出 |\n| export追加/削除 | `export` キーワードの差分 |\n| 型/interface変更 | `interface`, `type` 定義の差分 |\n| 定数/設定値変更 | 大文字定数、config オブジェクトの差分 |\n\n### 3. 関連ファイルパターンの適用\n\n#### TypeScript/JavaScript\n\n| 変更パターン | 関連ファイル検索 |\n|-------------|----------------|\n| `export function foo()` 変更 | `grep \"import.*foo\"` で使用箇所 |\n| `interface User` 変更 | `grep \"User\"` で型使用箇所 |\n| `*.tsx` コンポーネント props 変更 | 親コンポーネントの props 渡し |\n| `*.test.ts` なしの実装変更 | テストファイルの存在確認 |\n\n```bash\n# export された関数の使用箇所を検索\ngrep -r \"import.*{.*functionName.*}\" --include=\"*.ts\" --include=\"*.tsx\"\n\n# 型の使用箇所を検索\ngrep -r \": TypeName\" --include=\"*.ts\" --include=\"*.tsx\"\n```\n\n#### Python\n\n| 変更パターン | 関連ファイル検索 |\n|-------------|----------------|\n| `def function()` シグネチャ変更 | `grep \"from.*import function\"` |\n| `class Model` 変更 | `grep \"Model\"` で継承・使用箇所 |\n| `__init__.py` の `__all__` 変更 | パッケージ利用箇所 |\n\n#### 設定ファイル\n\n| 変更ファイル | 関連ファイル |\n|-------------|-------------|\n| `.env` | `.env.local`, `.env.production`, `.env.example` |\n| `config.ts` | `config.test.ts`, `config.prod.ts` |\n| `VERSION` | `package.json`, `plugin.json`, `CHANGELOG.md` |\n| `tsconfig.json` | `tsconfig.build.json`, `tsconfig.test.json` |\n\n### 4. LSP活用（利用可能な場合）\n\nLSP が有効な場合、より正確な関連ファイル検出が可能：\n\n```\n変更された関数/型を特定\n    ↓\nLSP find-references を実行\n    ↓\n全参照箇所をリスト化\n    ↓\n未編集の参照箇所を警告\n```\n\n**LSP 活用のメリット**:\n- 正確なシンボル参照（文字列マッチではない）\n- リネーム済みの参照も追跡可能\n- 型推論による暗黙的な使用も検出\n\n---\n\n## チェックパターン詳細\n\n### パターン1: 関数シグネチャ変更\n\n```typescript\n// Before\nexport function createUser(name: string): User\n\n// After\nexport function createUser(name: string, email: string): User\n```\n\n**チェック内容**:\n1. `createUser` の全呼び出し箇所を検索\n2. 引数が1つの呼び出しを警告\n\n**出力例**:\n```\n⚠️ 関数シグネチャ変更を検出: createUser\n\n呼び出し箇所（要確認）:\n├─ src/api/auth.ts:45 - createUser(name)  ← 引数不足の可能性\n├─ src/routes/signup.ts:23 - createUser(userName)  ← 引数不足の可能性\n└─ tests/user.test.ts:12 - createUser(\"test\")  ← 引数不足の可能性\n```\n\n### パターン2: interface/型変更\n\n```typescript\n// Before\ninterface User {\n  id: string;\n  name: string;\n}\n\n// After\ninterface User {\n  id: string;\n  name: string;\n  email: string;  // 追加\n}\n```\n\n**チェック内容**:\n1. `User` 型を使用する全箇所を検索\n2. オブジェクト生成箇所で `email` がない箇所を警告\n\n**出力例**:\n```\n⚠️ interface 変更を検出: User (フィールド追加: email)\n\n影響箇所（要確認）:\n├─ src/db/users.ts:30 - User オブジェクト生成\n├─ src/api/response.ts:15 - User 型アサーション\n└─ tests/fixtures/users.ts:5 - テストデータ\n```\n\n### パターン3: export削除\n\n```typescript\n// Before\nexport { createUser, deleteUser, updateUser }\n\n// After\nexport { createUser, updateUser }  // deleteUser 削除\n```\n\n**チェック内容**:\n1. `deleteUser` の import 文を検索\n2. import している全ファイルを警告\n\n**出力例**:\n```\n🚨 export 削除を検出: deleteUser\n\nimport しているファイル（修正必須）:\n├─ src/api/admin.ts:3 - import { deleteUser } from './users'\n└─ src/routes/user.ts:5 - import { deleteUser } from '@/users'\n```\n\n### パターン4: 設定ファイル同期\n\n```\nVERSION ファイルが変更された\n```\n\n**チェック内容**:\n1. 関連ファイルの VERSION 値を比較\n2. 不一致があれば警告\n\n**出力例**:\n```\n⚠️ VERSION 変更を検出: 2.9.22 → 2.9.23\n\n同期が必要なファイル:\n├─ .claude-plugin/plugin.json - version: \"2.9.22\" ← 要更新\n├─ package.json - version: \"2.9.23\" ✅ 同期済み\n└─ CHANGELOG.md - 2.9.23 エントリ ← 要確認\n```\n\n---\n\n## 重要度の判定\n\n| 重要度 | 条件 | アクション |\n|--------|------|-----------|\n| `🚨 critical` | 必ずエラーになる変更（export削除、必須引数追加） | 修正必須、コミット前にブロック |\n| `⚠️ warning` | エラーの可能性がある変更（オプショナル引数追加、型変更） | 確認を推奨 |\n| `ℹ️ info` | 影響が軽微な変更（コメント、内部実装） | 参考情報として表示 |\n\n---\n\n## 結果出力フォーマット\n\n### 問題なしの場合\n\n```\n✅ 関連ファイル検証完了\n\n編集ファイル: 3件\n├─ src/users.ts\n├─ src/api/auth.ts\n└─ tests/users.test.ts\n\n関連ファイルチェック: 問題なし\n→ コミットに進めます\n```\n\n### 要確認がある場合\n\n```\n📋 関連ファイル検証完了\n\n編集ファイル: 2件\n├─ src/users.ts (interface User 変更)\n└─ src/api/auth.ts\n\n⚠️ 要確認: 3件\n\n1. [warning] src/db/users.ts:30\n   User 型を使用 - email フィールド追加の影響確認\n\n2. [warning] tests/fixtures/users.ts:5\n   User テストデータ - email フィールド追加が必要な可能性\n\n3. [info] docs/api.md\n   User 型のドキュメント - 更新推奨\n\n確認済みですか？\n1. 確認済み、コミットに進む\n2. 各ファイルを確認する\n3. LSP find-references で詳細表示\n```\n\n### 修正必須がある場合\n\n```\n🚨 関連ファイル検証: 修正が必要です\n\n編集ファイル: 1件\n└─ src/utils/index.ts (export 削除: formatDate)\n\n🚨 修正必須: 2件\n\n1. [critical] src/components/DatePicker.tsx:3\n   import { formatDate } from '@/utils'\n   → formatDate は削除されました。import を修正してください。\n\n2. [critical] src/pages/events.tsx:8\n   import { formatDate } from '@/utils'\n   → formatDate は削除されました。import を修正してください。\n\n⛔ これらを修正するまでコミットできません。\n修正しますか？\n1. 自動で修正を試みる\n2. 手動で修正する\n```\n\n---\n\n## プロジェクト固有パターン\n\n### harness プロジェクト\n\n| 変更ファイル | 関連ファイルチェック |\n|-------------|-------------------|\n| `VERSION` | `plugin.json`, `CHANGELOG.md`, `CHANGELOG_ja.md` |\n| `commands/**/*.md` | frontmatter形式、必須フィールド |\n| `skills/**/SKILL.md` | references/ との整合性 |\n| `hooks.json` | `.claude-plugin/hooks.json` との同期 |\n| `*.config.yaml` | `*.config.schema.json` との整合性 |\n\n### Next.js プロジェクト\n\n| 変更ファイル | 関連ファイルチェック |\n|-------------|-------------------|\n| `app/**/page.tsx` | `layout.tsx`, メタデータ |\n| `components/*.tsx` | Storybook (`*.stories.tsx`) |\n| `lib/api.ts` | 型定義、テスト |\n\n### Express/API プロジェクト\n\n| 変更ファイル | 関連ファイルチェック |\n|-------------|-------------------|\n| `routes/*.ts` | OpenAPI spec、テスト |\n| `models/*.ts` | マイグレーション、シーダー |\n| `middleware/*.ts` | 適用箇所の確認 |\n\n---\n\n## 注意事項\n\n- LSP が利用可能な場合は grep より LSP を優先する\n- 大量の関連ファイルがある場合は重要度でフィルタリング\n- CI/CD と連携して自動チェックも検討\n- 偽陽性（関係ないのに警告）は許容、偽陰性（漏れ）は最小化\n",
        "opencode/skills/vibecoder-guide/SKILL.md": "---\nname: vibecoder-guide\ndescription: \"Guides VibeCoder (non-technical users) through natural language development. Use when user asks what to do next, how to use the system, needs help, or is stuck. Do NOT load for: technical-user work, direct implementation requests, or reviews.\"\nallowed-tools: [\"Read\"]\nuser-invocable: false\n---\n\n# VibeCoder Guide Skill\n\nVibeCoder（非技術者）が自然言語だけで開発を進められるようガイドするスキル。\n「どうすればいい？」「次は何？」などの質問に自動で応答します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「どうすればいい？」「どうしたらいい？」\n- 「次は何をすればいい？」「次は？」\n- 「何ができる？」「何をすればいい？」\n- 「困った」「わからない」「助けて」\n- 「使い方を教えて」\n- \"what should I do?\", \"what's next?\", \"help\"\n\n---\n\n## 概要\n\nVibeCoder は技術的なコマンドやワークフローを知らなくても、\n自然な日本語で質問するだけで次のアクションが分かります。\n\n---\n\n## 応答パターン\n\n### パターン1: プロジェクトがない場合\n\n> 🎯 **まずはプロジェクトを始めましょう！**\n>\n> **言い方の例：**\n> - 「ブログを作りたい」\n> - 「タスク管理アプリを作りたい」\n> - 「ポートフォリオサイトを作りたい」\n>\n> ざっくりで大丈夫です。やりたいことを教えてください。\n\n### パターン2: Plans.md があるが進行中タスクがない\n\n> 📋 **計画があります。作業を始めましょう！**\n>\n> **現在の計画:**\n> - フェーズ1: 基盤構築\n> - フェーズ2: コア機能\n> - ...\n>\n> **言い方の例：**\n> - 「フェーズ1を始めて」\n> - 「最初のタスクをやって」\n> - 「全部やって」\n\n### パターン3: タスク進行中\n\n> 🔧 **作業中です**\n>\n> **現在のタスク:** {{タスク名}}\n> **進捗:** {{完了数}}/{{全体数}}\n>\n> **言い方の例：**\n> - 「続けて」\n> - 「次のタスク」\n> - 「今どこまで進んだ？」\n\n### パターン4: フェーズ完了後\n\n> ✅ **フェーズが完了しました！**\n>\n> **次にできること：**\n> - 「動作確認して」→ 開発サーバーを起動\n> - 「レビューして」→ コード品質チェック\n> - 「次のフェーズへ」→ 次の作業を開始\n> - 「コミットして」→ 変更を保存\n\n### パターン5: エラー発生時\n\n> ⚠️ **問題が発生しました**\n>\n> **状況:** {{エラーの要約}}\n>\n> **言い方の例：**\n> - 「直して」→ 自動修正を試行\n> - 「説明して」→ 問題の詳細を説明\n> - 「スキップして」→ 次のタスクへ\n\n---\n\n## よく使うフレーズ対応表\n\n| やりたいこと | 言い方 |\n|-------------|--------|\n| プロジェクト開始 | 「〇〇を作りたい」 |\n| 計画を見たい | 「計画を見せて」「今の状況は？」 |\n| 作業を開始 | 「始めて」「作って」「フェーズ1をやって」 |\n| 続きをやる | 「続けて」「次」 |\n| 動作確認 | 「動かして」「見せて」 |\n| コード確認 | 「レビューして」「チェックして」 |\n| 保存する | 「コミットして」「保存して」 |\n| 困った時 | 「どうすればいい？」「助けて」 |\n| 全部任せる | 「全部やって」「おまかせ」 |\n\n---\n\n## コンテキスト判定\n\nこのスキルは以下を確認して適切な応答を選択：\n\n1. **AGENTS.md の存在** → プロジェクトが初期化済みか\n2. **Plans.md の内容** → 計画があるか、進捗状況\n3. **現在のタスク状態** → `cc:WIP` マーカーの有無\n4. **直近のエラー** → 問題が発生しているか\n\n---\n\n## 実装ノート\n\nこのスキルが起動したら：\n\n1. 現在の状態を分析\n2. 適切なパターンを選択\n3. 具体的な「言い方の例」を提示\n4. ユーザーの次のアクションを待つ\n\n**重要**: 技術用語を避け、平易な日本語で説明する\n",
        "opencode/skills/video/SKILL.md": "---\nname: video\ndescription: \"Generates product demo videos, architecture explanations, and release note videos. Use when user mentions video generation, product demos, or visual documentation. Requires Remotion setup.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Grep\", \"Glob\", \"Bash\", \"Task\", \"AskUserQuestion\", \"WebFetch\"]\n---\n\n# Video Generation Skills\n\nプロダクト説明動画の自動生成を担当するスキル群です。\n\n---\n\n## 概要\n\n`/generate-video` コマンドの内部で使用されるスキルです。\nコードベース分析 → シナリオ提案 → 並列生成のフローを実行します。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **ベストプラクティス** | See [references/best-practices.md](references/best-practices.md) |\n| **コードベース分析** | See [references/analyzer.md](references/analyzer.md) |\n| **シナリオプランニング** | See [references/planner.md](references/planner.md) |\n| **並列シーン生成** | See [references/generator.md](references/generator.md) |\n\n## Prerequisites\n\n- Remotion がセットアップ済み（`/remotion-setup`）\n- Node.js 18+\n\n## `/generate-video` フロー\n\n```\n/generate-video\n    │\n    ├─[Step 1] 分析（analyzer.md）\n    │   ├─ フレームワーク検出\n    │   ├─ 主要機能検出\n    │   ├─ UIコンポーネント検出\n    │   └─ プロジェクト資産解析（Plans.md, CHANGELOG等）\n    │\n    ├─[Step 2] シナリオ提案（planner.md）\n    │   ├─ 動画タイプ自動判定\n    │   ├─ シーン構成提案\n    │   └─ ユーザー確認\n    │\n    └─[Step 3] 並列生成（generator.md）\n        ├─ シーン並列生成（Task tool）\n        ├─ 統合 + トランジション\n        └─ 最終レンダリング\n```\n\n## 実行手順\n\n1. ユーザーが `/generate-video` を実行\n2. Remotion セットアップ確認\n3. `analyzer.md` でコードベース分析\n4. `planner.md` でシナリオ提案 + ユーザー確認\n5. `generator.md` で並列生成\n6. 完了報告\n\n## 動画タイプ（ファネル別）\n\n| タイプ | ファネル | 長さ目安 | 自動判定条件 | 構成の芯 |\n|--------|----------|----------|--------------|----------|\n| **LP/広告ティザー** | 認知〜興味 | 30-90秒 | 新規プロジェクト | 痛み→結果→CTA |\n| **Introデモ** | 興味→検討 | 2-3分 | UI変更検出 | 1ユースケース完走 |\n| **リリースノート** | 検討→確信 | 1-3分 | CHANGELOG更新 | Before/After重視 |\n| **アーキテクチャ解説** | 確信→決裁 | 5-30分 | 大規模構造変更 | 実運用+証拠 |\n| **オンボーディング** | 継続・活用 | 30秒-数分 | 初回セットアップ | Aha体験への最短パス |\n\n> 詳細: [references/best-practices.md](references/best-practices.md)\n\n## シーンテンプレート\n\n### 90秒ティザー（LP/広告向け）\n\n| 時間 | シーン | 内容 |\n|------|--------|------|\n| 0-5秒 | Hook | 痛み or 望む結果 |\n| 5-15秒 | Problem+Promise | 対象ユーザーと約束 |\n| 15-55秒 | Workflow | 象徴ワークフロー |\n| 55-70秒 | Differentiator | 差別化の根拠 |\n| 70-90秒 | CTA | 次の一手 |\n\n### 3分Introデモ（検討向け）\n\n| 時間 | シーン | 内容 |\n|------|--------|------|\n| 0-10秒 | Hook | 結論+痛み |\n| 10-30秒 | UseCase | ユースケース宣言 |\n| 30-140秒 | Demo | 実画面で完走 |\n| 140-170秒 | Objection | よくある不安1つ潰す |\n| 170-180秒 | CTA | 行動喚起 |\n\n### 共通シーン\n\n| シーン | 推奨時間 | 内容 |\n|--------|----------|------|\n| イントロ | 3-5秒 | ロゴ + タグライン |\n| 機能デモ | 10-30秒 | Playwrightキャプチャ |\n| アーキテクチャ図 | 10-20秒 | Mermaid → アニメーション |\n| CTA | 3-5秒 | URL + 連絡先 |\n\n> 詳細テンプレート: [references/best-practices.md](references/best-practices.md#テンプレート)\n\n## Notes\n\n- Remotion未セットアップの場合は `/remotion-setup` を案内\n- 並列生成数はシーン数に応じて自動調整（max 5）\n- 生成された動画は `out/` ディレクトリに出力\n",
        "opencode/skills/video/references/analyzer.md": "# Video Analyzer - コードベース分析エンジン\n\nプロジェクトを自動分析し、動画生成に必要な情報を抽出します。\n\n---\n\n## 概要\n\n`/generate-video` の Step 1 で実行される分析エンジンです。\nコードベースとプロジェクト資産を解析し、最適な動画構成を判定します。\n\n## 分析項目\n\n### 1. フレームワーク検出\n\n| 検出対象 | 判定方法 |\n|---------|---------|\n| Next.js | `next.config.*` の存在 |\n| React | `package.json` の dependencies |\n| Vue | `vue.config.*` または `nuxt.config.*` |\n| Svelte | `svelte.config.*` |\n| Express/Fastify | `package.json` の dependencies |\n\n**実行コマンド**:\n```bash\n# package.json から依存関係を抽出\ncat package.json | jq '.dependencies, .devDependencies'\n\n# 設定ファイルの存在確認\nls -la *.config.* 2>/dev/null\n```\n\n### 2. 主要機能検出\n\n| 機能 | 検出パターン |\n|------|-------------|\n| 認証 | `auth/`, `login/`, `@clerk`, `@auth0`, `supabase` |\n| 決済 | `payment/`, `billing/`, `stripe`, `@stripe` |\n| ダッシュボード | `dashboard/`, `admin/`, `analytics` |\n| API | `api/`, `routes/`, `trpc`, `graphql` |\n| DB | `prisma/`, `drizzle/`, `@supabase` |\n\n**実行コマンド**:\n```bash\n# ディレクトリ構造から機能を推測\nfind src app -type d -name \"auth\" -o -name \"login\" -o -name \"dashboard\" 2>/dev/null\n\n# パッケージから機能を推測\ngrep -E \"clerk|stripe|supabase|prisma\" package.json\n```\n\n### 3. UIコンポーネント検出\n\n| 項目 | 検出方法 |\n|------|---------|\n| ページ数 | `app/**/page.tsx` または `pages/**/*.tsx` のカウント |\n| コンポーネント数 | `components/**/*.tsx` のカウント |\n| UIライブラリ | `shadcn`, `radix`, `chakra`, `mui` の検出 |\n\n**実行コマンド**:\n```bash\n# ページ数カウント\nfind . -name \"page.tsx\" -o -name \"page.jsx\" 2>/dev/null | wc -l\n\n# コンポーネント数カウント\nfind . -path \"*/components/*\" -name \"*.tsx\" 2>/dev/null | wc -l\n```\n\n### 4. プロジェクト資産解析\n\n| 資産 | 用途 |\n|------|------|\n| `package.json` | プロジェクト名、description |\n| `README.md` | プロジェクト概要、タグライン |\n| `Plans.md` | 完了タスク（リリースノート用） |\n| `CHANGELOG.md` | 変更点（リリースノート用） |\n| `.claude/memory/decisions.md` | 技術的意思決定（アーキテクチャ解説用） |\n\n**実行コマンド**:\n```bash\n# プロジェクト情報抽出\ncat package.json | jq '{name, description, version}'\n\n# README の最初の段落を抽出\nhead -20 README.md\n```\n\n---\n\n## 動画タイプ自動判定\n\n### 判定ロジック\n\n```\n分析結果から動画タイプを判定:\n    │\n    ├─ CHANGELOG が最近更新（7日以内）\n    │   └─ → リリースノート動画\n    │\n    ├─ 大きな構造変更（新ディレクトリ追加等）\n    │   └─ → アーキテクチャ解説\n    │\n    ├─ UI変更が多い（コンポーネント追加/変更）\n    │   └─ → プロダクトデモ\n    │\n    └─ 複数条件に該当\n        └─ → 複合動画（ユーザーに確認）\n```\n\n### 判定基準\n\n| タイプ | 条件 |\n|--------|------|\n| **リリースノート** | `git log --since=\"7 days ago\"` に tag/release がある |\n| **アーキテクチャ** | 新しい `src/*/` ディレクトリ、大きなリファクタ |\n| **プロダクトデモ** | UI コンポーネントの追加/変更 |\n| **デフォルト** | プロダクトデモ（最も汎用的） |\n\n---\n\n## 出力フォーマット\n\n分析結果は以下の形式で出力:\n\n```yaml\nproject:\n  name: \"MyAwesomeApp\"\n  description: \"タスク管理を簡単に\"\n  version: \"1.2.0\"\n\nframework:\n  primary: \"Next.js\"\n  ui_library: \"shadcn/ui\"\n\nfeatures:\n  - name: \"認証\"\n    type: \"auth\"\n    path: \"src/app/(auth)/\"\n    provider: \"Clerk\"\n  - name: \"ダッシュボード\"\n    type: \"dashboard\"\n    path: \"src/app/dashboard/\"\n  - name: \"API\"\n    type: \"api\"\n    path: \"src/app/api/\"\n\nstats:\n  pages: 12\n  components: 45\n  api_routes: 8\n\nrecent_changes:\n  changelog_updated: true\n  last_release: \"2026-01-20\"\n  major_changes:\n    - \"認証フロー追加\"\n    - \"ダッシュボード改善\"\n\nrecommended_video_type: \"release-notes\"\nconfidence: 0.85\n```\n\n---\n\n## 実行例\n\n```\n📊 プロジェクト分析中...\n\n✅ 分析完了\n\n| 項目 | 結果 |\n|------|------|\n| プロジェクト名 | MyAwesomeApp |\n| フレームワーク | Next.js 14 |\n| UIライブラリ | shadcn/ui |\n| ページ数 | 12 |\n| コンポーネント数 | 45 |\n\n🔍 検出された機能:\n- 認証（Clerk）\n- ダッシュボード\n- API（8エンドポイント）\n\n📋 最近の変更:\n- v1.2.0 リリース（3日前）\n- 認証フロー追加\n- ダッシュボード改善\n\n🎬 推奨動画タイプ: リリースノート動画\n   理由: 最近のリリースがあり、主要な機能追加があります\n```\n\n---\n\n## Notes\n\n- 分析は非破壊的（ファイルを変更しない）\n- 大規模プロジェクトでも数秒で完了\n- 検出できない機能は手動で追加可能（planner.md で）\n",
        "opencode/skills/video/references/best-practices.md": "# SaaS Video Best Practices\n\nSaaS紹介動画のベストプラクティス集です。\n動画の目的・ファネルに応じた最適な構成を選択するためのガイドラインを提供します。\n\n---\n\n## 基本原則\n\n### 1. 画面より先に「誰の何の痛みを消すか」を決める\n\n機能紹介ではなく、視聴者の痛み→解決の確信を最短で作る装置として設計する。\n\n**リスク**: ターゲットが曖昧だと誰にも刺さらない\n\n### 2. 最初の数秒で余計な儀式を捨てる\n\n冒頭でロゴや演出を長く出すと離脱率が上がるため、すぐに本題へ入る。\n音・本題開始の速さを重視。\n\n### 3. 長さは目的で決める\n\n一般に長いほどエンゲージメント率は低下するが、最適な長さは目的次第。\n\n| 長さ | 用途 |\n|------|------|\n| 1-2分 | 冒頭離脱が少ない |\n| 5-10分 | 長めの解説 |\n\n**結論**: 長尺は冒頭設計が命\n\n### 4. CTAは最後に置かない\n\n視聴者の途中離脱を防ぐため、CTAは途中にも置く。\n\n### 5. 見やすい映像は衛生管理\n\n**優先順位**: 音質 > 画面の可読性 > テンポ > 見た目\n\n**重要**: 音が悪いと即離脱\n\n### 6. 字幕・トランスクリプトは必須\n\n字幕は必須要件で、自動生成だけでなく修正も必要。\n\n### 7. 長尺にはチャプター\n\n動画視聴者は飛ばし見をしたいので、チャプター（目次）を付ける。\n\n---\n\n## ファネル別動画タイプ比較\n\n| 目的（ファネル） | 動画タイプ | 長さ目安 | 構成の芯 | 主なKPI |\n|------------------|------------|----------|----------|---------|\n| 認知〜興味 | 超短尺ティザー | 30〜90秒 | 痛み→結果（未来）→\"続きはここ\" | 視聴維持/CTR |\n| 興味→検討 | Intro（概要デモ） | 2〜3分 | 1ユースケースを最短で完走 | デモ申込/トライアル開始 |\n| 検討→確信 | Demo（短尺セールス） | 2〜5分 | 反論の芽を先に潰す | 商談化率/返信率 |\n| 確信→決裁 | Walkthrough / Webinar | 5〜30分 | 実運用の流れ＋証拠 | CVR/問い合わせ |\n| 拡張・効率化 | ハイブリッドデモ | 録画＋Q&A | 録画で標準化→ライブで個別最適 | 成約率/工数削減 |\n| 継続・活用 | オンボーディング | 30秒〜数分（小分け） | 最短のクイックウィン→Aha | Activation/継続率 |\n| サポート | How-to/トラブル | 1〜5分 | 手順を1本1目的で | 問い合わせ削減/自己解決率 |\n\n---\n\n## カテゴリ別ガイド\n\n### LP/広告向け：短尺紹介（30〜90秒）\n\n**目的**: 認知〜興味ファネル向け\n\n**構成アウトライン**:\n- 0–5秒: 痛み or 望む結果\n- 5–20秒: 対象ユーザーと約束\n- 20–60秒: 象徴ワークフロー1本\n- 60–90秒: 次の一手\n\n**避けるべき落とし穴**: 機能羅列・抽象ワード連発\n\n### 検討向け：2〜3分 Introデモ\n\n1ユースケースを完走させ、専門用語を避けて分解しながら説明。\n\n**推奨事項**:\n- 冒頭は短く本題へ\n- 一番刺さる1ケースを選ぶ\n- 途中CTAも設置\n\n### セールス向け：2〜5分デモ\n\n購買決断の次の一手に進めるための短尺セールス向け動画。\n\n**戦略**:\n- 反論トップ3を先回りで潰す\n- 1動画=1業界／職種\n\n### 決裁向け：15〜30分ウォークスルー\n\nより深い理解と意思決定を促す長尺動画。チャプター設計必須。\n\n**キーポイント**:\n- 基本フロー\n- 反論処理\n- 管理/セキュリティの説明\n\n### オンボーディング向け\n\nユーザーが最初の成功体験（Aha）に到達する設計。\n\n**ガイドライン**:\n- 1本で全部教えない\n- 役割別分岐動画\n\n### サポート／ヘルプ動画\n\n動画を唯一の答えにせず、テキストと併用する。\n\n**必須要素**:\n- 動画＋手順テキスト\n- 字幕＋全文トランスクリプト\n\n---\n\n## テンプレート\n\n### 90秒刺す紹介テンプレ\n\n**用途**: LP/広告、認知〜興味ファネル\n\n| 時間 | 内容 | フレーム数(30fps) |\n|------|------|------------------|\n| 0:00–0:05 | 痛み or 望む結果 | 0-150 |\n| 0:05–0:15 | 対象ユーザーと約束 | 150-450 |\n| 0:15–0:55 | 象徴ワークフロー | 450-1650 |\n| 0:55–1:10 | 差別化の根拠 | 1650-2100 |\n| 1:10–1:30 | CTA | 2100-2700 |\n\n**合計**: 90秒 = 2700フレーム\n\n### 3分 Introデモテンプレ\n\n**用途**: 検討向け、興味→検討ファネル\n\n| 時間 | 内容 |\n|------|------|\n| 0:00–0:10 | 結論＋痛み |\n| 0:10–0:30 | ユースケース宣言 |\n| 0:30–2:20 | 実画面で完走 |\n| 2:20–2:50 | よくある不安1つ潰す |\n| 2:50–3:00 | CTA |\n\n### 20分決裁向けウォークスルー\n\n**用途**: 確信→決裁ファネル\n\n| 時間 | 内容 |\n|------|------|\n| 0:00–1:00 | 対象と課題 |\n| 1:00–8:00 | 基本フロー |\n| 8:00–12:00 | 反論トップ2 |\n| 12:00–15:00 | 管理/セキュリティ |\n| 15:00–20:00 | 成功事例＋CTA |\n\n---\n\n## 制作チェックリスト\n\n### 収録前\n\n- [ ] 台本：話すことを削り切る\n- [ ] デモ環境：通知オフ、個人情報除去\n- [ ] 画面：UIの文字が読めるズーム\n\n### 収録中\n\n- [ ] 音：明瞭さ最優先\n- [ ] 照明/映り：最低限\n- [ ] テンポ：操作を迷う瞬間は全カット\n\n### 公開時\n\n- [ ] 字幕：必ず品質修正\n- [ ] トランスクリプト：検索と拾い読み用\n- [ ] 長尺はチャプター必須\n\n---\n\n## 共通の失敗パターン\n\n| 失敗 | 影響 |\n|------|------|\n| 誰向けか曖昧 | 誰にも刺さらない |\n| ロゴ・会社紹介が長い | 冒頭離脱 |\n| 機能全部入り | 焦点がぼける |\n| 字幕なし/雑 | アクセシビリティ低下 |\n| 動画だけ置いて満足 | 効果測定できず |\n| CTAが最後だけ | 途中離脱で見られない |\n\n---\n\n## 推奨3本セット\n\n最短で成果を出すための基本セット:\n\n1. **90秒ティザー** - 認知獲得\n2. **3分 Introデモ** - 検討促進\n3. **15〜25分決裁用ウォークスルー** - 成約支援\n\n**成果**: 獲得→検討→決裁の情報の穴を埋める\n\n---\n\n## Harness での活用\n\n### 動画タイプ自動判定\n\n| Harness検出条件 | 推奨動画タイプ | テンプレート |\n|-----------------|----------------|--------------|\n| 新規プロジェクト | LP/広告向け短尺 | 90秒ティザー |\n| UI変更検出 | Introデモ | 3分テンプレ |\n| CHANGELOG更新 | リリースノート | Before/After重視 |\n| 大規模構造変更 | アーキテクチャ解説 | ウォークスルー |\n\n### シーン構成ガイド\n\n#### 短尺（30-90秒）の場合\n\n```\nHookScene (3秒) → ProblemPromise (7秒) → WorkflowDemo (40-60秒) → Differentiator (10秒) → CTA (10秒)\n```\n\n#### Introデモ（2-3分）の場合\n\n```\nHook (10秒) → UseCase宣言 (20秒) → 実画面デモ (110秒) → 不安解消 (30秒) → CTA (10秒)\n```\n\n#### ウォークスルー（15-30分）の場合\n\n```\n対象と課題 (1分) → 基本フロー (7分) → 反論処理 (4分) → 管理/セキュリティ (3分) → 成功事例+CTA (5分)\n```\n\n---\n\n## References\n\n- [planner.md](planner.md) - シナリオプランニング\n- [generator.md](generator.md) - 並列シーン生成\n- [analyzer.md](analyzer.md) - コードベース分析\n",
        "opencode/skills/video/references/generator.md": "# Video Generator - 並列シーン生成エンジン\n\nシナリオに基づいて、マルチエージェントで並列にシーンを生成します。\n\n---\n\n## 概要\n\n`/generate-video` の Step 3 で実行される生成エンジンです。\nplanner.md のシナリオを受けて、各シーンを並列で生成し、最終的に統合します。\n\n## 入力\n\nplanner.md からのシナリオ:\n- シーンリスト（id, name, duration, template, content）\n- 動画設定（resolution, fps）\n\n## 並列生成アーキテクチャ\n\n```\nシナリオ（N シーン）\n    │\n    ├─[並列数決定]\n    │   └─ min(シーン数, 5) を並列数とする\n    │\n    ├─[並列生成フェーズ]\n    │   ├── Agent 1: シーン 1 生成\n    │   ├── Agent 2: シーン 2 生成\n    │   ├── Agent 3: シーン 3 生成\n    │   └── ... (max 5 並列)\n    │\n    ├─[統合フェーズ]\n    │   ├── シーン結合\n    │   ├── トランジション追加\n    │   └── 音声同期（オプション）\n    │\n    └─[レンダリングフェーズ]\n        └── 最終出力（mp4/webm/gif）\n```\n\n---\n\n## 並列数決定ロジック\n\n| シーン数 | 並列数 | 理由 |\n|---------|--------|------|\n| 1-2 | 1-2 | オーバーヘッドが利益を上回る |\n| 3-4 | 3 | 最適なバランス |\n| 5+ | 5 | これ以上はリソース競合 |\n\n**実装**:\n```javascript\nconst parallelCount = Math.min(scenes.length, 5);\n```\n\n---\n\n## Task Tool による並列起動\n\n### シーン生成エージェント起動\n\n```\n各シーンに対して Task tool を起動:\n\nTask:\n  subagent_type: \"video-scene-generator\"\n  run_in_background: true\n  prompt: |\n    以下のシーンを Remotion コンポジションとして生成してください。\n\n    シーン情報:\n    - ID: {scene.id}\n    - 名前: {scene.name}\n    - 時間: {scene.duration}秒\n    - テンプレート: {scene.template}\n    - 内容: {scene.content}\n\n    出力先: remotion/scenes/{scene.name}.tsx\n\n    完了したら以下を報告:\n    - ファイルパス\n    - 実際の duration (フレーム数)\n    - 使用したコンポーネント\n```\n\n### 進捗モニタリング\n\n```\n🎬 並列生成中... (3/5 完了)\n\n├── [Agent 1] intro ✅ (3秒)\n├── [Agent 2] auth-demo ✅ (12秒)\n├── [Agent 3] dashboard ⏳ 生成中...\n├── [Agent 4] features 🔜 待機中\n└── [Agent 5] cta 🔜 待機中\n```\n\n### 結果収集\n\n```\nTaskOutput で各エージェントの結果を収集:\n\n結果:\n  - scene_id: 1\n    file: \"remotion/scenes/intro.tsx\"\n    duration_frames: 150\n    status: \"success\"\n\n  - scene_id: 2\n    file: \"remotion/scenes/auth-demo.tsx\"\n    duration_frames: 450\n    status: \"success\"\n    notes: \"Playwright capture included\"\n```\n\n---\n\n## シーン生成テンプレート\n\n### intro テンプレート\n\n```tsx\n// remotion/scenes/intro.tsx\nimport { AbsoluteFill, useCurrentFrame, interpolate } from \"remotion\";\nimport { FadeIn } from \"../components/FadeIn\";\n\nexport const IntroScene: React.FC<{\n  title: string;\n  tagline: string;\n}> = ({ title, tagline }) => {\n  const frame = useCurrentFrame();\n  const opacity = interpolate(frame, [0, 30], [0, 1]);\n\n  return (\n    <AbsoluteFill style={{ backgroundColor: \"#000\", opacity }}>\n      <FadeIn durationInFrames={30}>\n        <h1>{title}</h1>\n        <p>{tagline}</p>\n      </FadeIn>\n    </AbsoluteFill>\n  );\n};\n\nexport const DURATION = 150; // 5秒 @ 30fps\n```\n\n### ui-demo テンプレート（Playwright連携）\n\n```tsx\n// remotion/scenes/ui-demo.tsx\nimport { AbsoluteFill, Img, Sequence } from \"remotion\";\n\nexport const UIDemoScene: React.FC<{\n  screenshots: string[];\n  duration: number;\n}> = ({ screenshots, duration }) => {\n  const framePerScreenshot = Math.floor(duration / screenshots.length);\n\n  return (\n    <AbsoluteFill>\n      {screenshots.map((src, i) => (\n        <Sequence from={i * framePerScreenshot} durationInFrames={framePerScreenshot}>\n          <Img src={src} style={{ width: \"100%\", height: \"100%\" }} />\n        </Sequence>\n      ))}\n    </AbsoluteFill>\n  );\n};\n```\n\n### cta テンプレート\n\n```tsx\n// remotion/scenes/cta.tsx\nimport { AbsoluteFill, useCurrentFrame, interpolate } from \"remotion\";\n\nexport const CTAScene: React.FC<{\n  url: string;\n  text: string;\n}> = ({ url, text }) => {\n  const frame = useCurrentFrame();\n  const scale = interpolate(frame, [0, 15], [0.8, 1], {\n    extrapolateRight: \"clamp\",\n  });\n\n  return (\n    <AbsoluteFill style={{ backgroundColor: \"#1a1a1a\" }}>\n      <div style={{ transform: `scale(${scale})` }}>\n        <h2>{text}</h2>\n        <p>{url}</p>\n      </div>\n    </AbsoluteFill>\n  );\n};\n\nexport const DURATION = 150; // 5秒 @ 30fps\n```\n\n---\n\n## 統合フェーズ\n\n### シーン結合\n\n```tsx\n// remotion/FullVideo.tsx\nimport { Composition, Series } from \"remotion\";\nimport { IntroScene } from \"./scenes/intro\";\nimport { UIDemoScene } from \"./scenes/ui-demo\";\nimport { CTAScene } from \"./scenes/cta\";\n\nexport const FullVideo: React.FC = () => {\n  return (\n    <Series>\n      <Series.Sequence durationInFrames={150}>\n        <IntroScene title=\"MyApp\" tagline=\"タスク管理を簡単に\" />\n      </Series.Sequence>\n      <Series.Sequence durationInFrames={450}>\n        <UIDemoScene screenshots={[...]} duration={450} />\n      </Series.Sequence>\n      <Series.Sequence durationInFrames={150}>\n        <CTAScene url=\"https://myapp.com\" text=\"今すぐ試す\" />\n      </Series.Sequence>\n    </Series>\n  );\n};\n```\n\n### トランジション追加\n\n```tsx\n// トランジションコンポーネント\nimport { TransitionSeries, linearTiming } from \"@remotion/transitions\";\nimport { fade } from \"@remotion/transitions/fade\";\n\n<TransitionSeries>\n  <TransitionSeries.Sequence durationInFrames={150}>\n    <IntroScene {...} />\n  </TransitionSeries.Sequence>\n  <TransitionSeries.Transition\n    presentation={fade()}\n    timing={linearTiming({ durationInFrames: 15 })}\n  />\n  <TransitionSeries.Sequence durationInFrames={450}>\n    <UIDemoScene {...} />\n  </TransitionSeries.Sequence>\n</TransitionSeries>\n```\n\n---\n\n## レンダリングフェーズ\n\n### コマンド実行\n\n```bash\n# MP4 レンダリング\nnpx remotion render remotion/index.ts FullVideo out/video.mp4\n\n# GIF レンダリング（短い動画向け）\nnpx remotion render remotion/index.ts FullVideo out/video.gif\n\n# WebM レンダリング（Web向け）\nnpx remotion render remotion/index.ts FullVideo out/video.webm --codec=vp8\n```\n\n### 出力オプション\n\n| フォーマット | 推奨用途 | オプション |\n|-------------|---------|-----------|\n| MP4 | 汎用、SNS | `--codec=h264` |\n| WebM | Web埋め込み | `--codec=vp8` |\n| GIF | 短いループ | 15秒以下推奨 |\n\n---\n\n## 完了報告\n\n```markdown\n✅ **動画生成完了**\n\n📁 **出力ファイル**:\n- `out/video.mp4` (45秒, 1080p, 12.3MB)\n\n📊 **生成統計**:\n| 項目 | 値 |\n|------|-----|\n| シーン数 | 4 |\n| 並列エージェント数 | 3 |\n| 生成時間 | 45秒 |\n| レンダリング時間 | 30秒 |\n\n🎬 **プレビュー**:\n- Studio: `npm run remotion` → http://localhost:3000\n- ファイル: `open out/video.mp4`\n```\n\n---\n\n## エラーハンドリング\n\n### シーン生成失敗\n\n```\n⚠️ シーン生成エラー\n\nシーン「auth-demo」の生成に失敗しました。\n原因: Playwright キャプチャ失敗 - アプリが起動していません\n\n対処:\n1. アプリを起動してください: `npm run dev`\n2. 再生成: 「auth-demo を再生成」\n3. スキップ: 「このシーンをスキップ」\n```\n\n### レンダリング失敗\n\n```\n⚠️ レンダリングエラー\n\n原因: メモリ不足\n\n対処:\n1. 並列数を減らす: `--concurrency 2`\n2. 解像度を下げる: 720p で再試行\n3. シーンを分割: 長いシーンを短く分割\n```\n\n---\n\n## Notes\n\n- 並列生成は独立したシーンに対してのみ有効\n- Playwright キャプチャは事前にアプリが起動している必要がある\n- 大きな動画（3分以上）は分割レンダリングを推奨\n",
        "opencode/skills/video/references/planner.md": "# Video Planner - シナリオプランナー\n\n分析結果からシーン構成を自動提案し、ユーザーと確認・調整を行います。\n\n---\n\n## 概要\n\n`/generate-video` の Step 2 で実行されるシナリオプランナーです。\nanalyzer.md の出力を受けて、最適なシーン構成を提案します。\n\n> **重要**: シーン構成は [best-practices.md](best-practices.md) のファネル別ガイドラインに従って設計すること\n\n## 入力\n\nanalyzer.md からの分析結果:\n- プロジェクト情報（名前、description）\n- 検出された機能リスト\n- 推奨動画タイプ\n- 最近の変更点\n\n---\n\n## ファネル別テンプレート選択\n\n### Step 0: 目的の確認（必須）\n\n動画の目的を確認し、適切なテンプレートを選択する。\n\n| 目的（ファネル） | 動画タイプ | 長さ目安 | 構成の芯 |\n|------------------|------------|----------|----------|\n| 認知〜興味 | LP/広告ティザー | 30-90秒 | 痛み→結果→CTA |\n| 興味→検討 | Introデモ | 2-3分 | 1ユースケース完走 |\n| 検討→確信 | Demo/リリースノート | 2-5分 | 反論を先に潰す |\n| 確信→決裁 | ウォークスルー | 5-30分 | 実運用+証拠 |\n| 継続・活用 | オンボーディング | 30秒-数分 | Aha体験への最短パス |\n\n### 90秒ティザーテンプレート\n\n**用途**: LP/広告、認知〜興味ファネル\n\n```\n0:00-0:05 (150f)  → HookScene: 痛み or 望む結果\n0:05-0:15 (300f)  → ProblemPromise: 対象ユーザーと約束\n0:15-0:55 (1200f) → WorkflowDemo: 象徴ワークフロー\n0:55-1:10 (450f)  → Differentiator: 差別化の根拠\n1:10-1:30 (600f)  → CTA: 次の一手\n```\n\n### 3分Introデモテンプレート\n\n**用途**: 検討向け、興味→検討ファネル\n\n```\n0:00-0:10 (300f)  → Hook: 結論+痛み\n0:10-0:30 (600f)  → UseCase: ユースケース宣言\n0:30-2:20 (3300f) → Demo: 実画面で完走\n2:20-2:50 (900f)  → Objection: よくある不安1つ潰す\n2:50-3:00 (300f)  → CTA: 行動喚起\n```\n\n### 20分ウォークスルーテンプレート\n\n**用途**: 決裁向け、確信→決裁ファネル\n\n```\n0:00-1:00   → Intro: 対象と課題\n1:00-8:00   → BasicFlow: 基本フロー\n8:00-12:00  → Objections: 反論トップ2\n12:00-15:00 → Security: 管理/セキュリティ\n15:00-20:00 → CaseStudy+CTA: 成功事例＋CTA\n```\n\n## シーンテンプレート\n\n### 共通シーン\n\n| シーン | 推奨時間 | 内容 | 必須 |\n|--------|----------|------|------|\n| **イントロ** | 3-5秒 | ロゴ + タグライン + フェードイン | ✅ |\n| **CTA** | 3-5秒 | URL + 連絡先 + フェードアウト | ✅ |\n\n### プロダクトデモ用シーン\n\n| シーン | 推奨時間 | 内容 |\n|--------|----------|------|\n| **機能紹介** | 5-10秒 | 機能名 + 1行説明 |\n| **UIデモ** | 10-30秒 | Playwrightキャプチャ |\n| **ハイライト** | 5-10秒 | 主要な特徴を強調 |\n\n### アーキテクチャ解説用シーン\n\n| シーン | 推奨時間 | 内容 |\n|--------|----------|------|\n| **概要図** | 5-10秒 | 全体構成のMermaid図 |\n| **詳細解説** | 10-20秒 | 各コンポーネントにズーム |\n| **データフロー** | 10-15秒 | シーケンス図アニメーション |\n\n### リリースノート用シーン\n\n| シーン | 推奨時間 | 内容 |\n|--------|----------|------|\n| **バージョン表示** | 3-5秒 | vX.Y.Z + リリース日 |\n| **変更点リスト** | 5-15秒 | Added/Changed/Fixed のアニメーション |\n| **Before/After** | 10-20秒 | UI変更のサイドバイサイド比較 |\n| **新機能デモ** | 10-30秒 | 追加機能のUIデモ |\n\n---\n\n## シナリオ生成ロジック\n\n### Step 1: 動画タイプ別テンプレート選択\n\n```\n推奨動画タイプに基づいてベーステンプレートを選択:\n    │\n    ├─ LP/広告ティザー（30-90秒）\n    │   └─ Hook → ProblemPromise → WorkflowDemo → Differentiator → CTA\n    │\n    ├─ Introデモ（2-3分）\n    │   └─ Hook → UseCase宣言 → 実画面Demo → Objection → CTA\n    │\n    ├─ リリースノート（1-3分）\n    │   └─ Hook → バージョン → Before/After → 新機能Demo → CTA\n    │\n    ├─ アーキテクチャ解説（5-30分）\n    │   └─ Intro → 概要図 → 詳細解説×N → データフロー → 管理/セキュリティ → CTA\n    │\n    └─ オンボーディング（30秒-数分）\n        └─ Welcome → クイックウィン → 次のステップ\n```\n\n**重要な原則**:\n- 冒頭でロゴや会社紹介を長く出さない（離脱防止）\n- CTAは最後だけでなく途中にも配置\n- 機能羅列ではなく「痛み→解決」のストーリー\n\n### Step 2: 検出機能からシーンを生成\n\n```python\n# 擬似コード\nfor feature in detected_features:\n    if feature.type == \"auth\":\n        add_scene(\"認証フローデモ\", duration=15, source=\"playwright\")\n    elif feature.type == \"dashboard\":\n        add_scene(\"ダッシュボード紹介\", duration=20, source=\"playwright\")\n    elif feature.type == \"api\":\n        add_scene(\"API概要\", duration=10, source=\"mermaid\")\n```\n\n### Step 3: 時間配分の最適化\n\n| 動画長 | 推奨用途 | シーン数目安 |\n|--------|----------|-------------|\n| 15秒 | SNS広告 | 3-4 |\n| 30秒 | ショート動画 | 5-6 |\n| 60秒 | 標準デモ | 8-10 |\n| 2-3分 | 詳細解説 | 15-20 |\n\n---\n\n## ユーザー確認フロー\n\n### 提案表示\n\n```markdown\n🎬 シナリオプラン\n\n**動画タイプ**: プロダクトデモ\n**合計時間**: 45秒\n\n| # | シーン | 時間 | 内容 | ソース |\n|---|--------|------|------|--------|\n| 1 | イントロ | 5秒 | MyApp - タスク管理を簡単に | テンプレート |\n| 2 | 認証フロー | 15秒 | ログイン画面のデモ | Playwright |\n| 3 | ダッシュボード | 20秒 | メイン機能の紹介 | Playwright |\n| 4 | CTA | 5秒 | myapp.com | テンプレート |\n\nこの構成でよろしいですか？\n1. OK、生成開始\n2. 編集したい\n3. キャンセル\n```\n\n### AskUserQuestion 実装\n\n```\nAskUserQuestion:\n  question: \"このシナリオで動画を生成しますか？\"\n  header: \"シナリオ確認\"\n  options:\n    - label: \"OK、生成開始\"\n      description: \"このシーン構成で動画を生成します\"\n    - label: \"編集したい\"\n      description: \"シーンの追加/削除/変更を行います\"\n    - label: \"キャンセル\"\n      description: \"動画生成を中止します\"\n```\n\n### 編集モード\n\nユーザーが「編集したい」を選択した場合:\n\n```markdown\n📝 シナリオ編集\n\n以下のコマンドで編集できます：\n\n- **追加**: 「機能Xのデモを追加」\n- **削除**: 「シーン2を削除」\n- **変更**: 「イントロを3秒に短縮」\n- **入替**: 「シーン2と3を入れ替え」\n- **完了**: 「これでOK」\n\n何を編集しますか？\n```\n\n---\n\n## 出力フォーマット\n\nplanner.md の出力（generator.md への入力）:\n\n```yaml\nvideo:\n  type: \"product-demo\"\n  total_duration: 45\n  resolution: \"1080p\"\n  fps: 30\n\nscenes:\n  - id: 1\n    name: \"intro\"\n    duration: 5\n    template: \"intro\"\n    content:\n      title: \"MyApp\"\n      tagline: \"タスク管理を簡単に\"\n      logo: \"public/logo.svg\"\n\n  - id: 2\n    name: \"auth-demo\"\n    duration: 15\n    template: \"ui-demo\"\n    source: \"playwright\"\n    content:\n      url: \"http://localhost:3000/login\"\n      actions:\n        - click: \"[data-testid=email-input]\"\n        - type: \"user@example.com\"\n        - click: \"[data-testid=login-button]\"\n\n  - id: 3\n    name: \"dashboard\"\n    duration: 20\n    template: \"ui-demo\"\n    source: \"playwright\"\n    content:\n      url: \"http://localhost:3000/dashboard\"\n      actions:\n        - wait: 1000\n        - scroll: \"down\"\n\n  - id: 4\n    name: \"cta\"\n    duration: 5\n    template: \"cta\"\n    content:\n      url: \"https://myapp.com\"\n      text: \"今すぐ試す\"\n```\n\n---\n\n## Notes\n\n- シーン数が多すぎる場合は自動的に優先度の低いものを提案から除外\n- ユーザーが手動でシーンを追加することも可能\n- Playwrightソースのシーンはアプリが起動している必要がある\n",
        "opencode/skills/workflow-guide/SKILL.md": "---\nname: workflow-guide\ndescription: \"Provides guidance on Cursor ↔ Claude Code 2-agent workflow. Use when user asks about workflow, collaboration, or process. Do NOT load for: implementation work, workflow setup, or executing handoffs.\"\nallowed-tools: [\"Read\"]\nuser-invocable: false\n---\n\n# Workflow Guide Skill\n\nCursor ↔ Claude Code 2エージェントワークフローのガイダンスを提供するスキル。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで起動します：\n\n- 「ワークフローについて教えて」\n- 「Cursor との連携方法は？」\n- 「作業の流れを教えて」\n- 「どうやって進めればいい？」\n- \"how does the workflow work?\"\n- \"explain 2-agent workflow\"\n\n---\n\n## 概要\n\nこのスキルは、Cursor（PM）と Claude Code（Worker）の役割分担と連携方法を説明します。\n\n---\n\n## 2エージェントワークフロー\n\n### 役割分担\n\n| エージェント | 役割 | 責務 |\n|-------------|------|------|\n| **Cursor** | PM（プロジェクトマネージャー） | タスク割り当て、レビュー、本番デプロイ判断 |\n| **Claude Code** | Worker（作業者） | 実装、テスト、CI修正、staging デプロイ |\n\n### ワークフロー図\n\n```\n┌─────────────────────────────────────────────────────────┐\n│                    Cursor (PM)                          │\n│  ・タスクを Plans.md に追加                              │\n│  ・Claude Code に作業を依頼（/handoff-to-claude）            │\n│  ・完了報告をレビュー                                    │\n│  ・本番デプロイの判断                                    │\n└─────────────────────┬───────────────────────────────────┘\n                      │ タスク依頼\n                      ▼\n┌─────────────────────────────────────────────────────────┐\n│                  Claude Code (Worker)                   │\n│  ・/work でタスク実行（並列実行対応）                   │\n│  ・実装 → テスト → コミット                             │\n│  ・CI 失敗時は自動修正（3回まで）                        │\n│  ・/handoff-to-cursor で完了報告                        │\n└─────────────────────┬───────────────────────────────────┘\n                      │ 完了報告\n                      ▼\n┌─────────────────────────────────────────────────────────┐\n│                    Cursor (PM)                          │\n│  ・変更内容を確認                                        │\n│  ・staging 動作確認                                      │\n│  ・本番デプロイ実行（承認後）                            │\n└─────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Plans.md によるタスク管理\n\n### マーカー一覧\n\n| マーカー | 意味 | 設定者 |\n|---------|------|--------|\n| `pm:依頼中` | PM から依頼（互換: cursor:依頼中） | PM（Cursor/PM Claude） |\n| `cc:TODO` | Claude Code 未着手 | どちらでも |\n| `cc:WIP` | Claude Code 作業中 | Claude Code |\n| `cc:完了` | Claude Code 完了 | Claude Code |\n| `pm:確認済` | PM 確認完了（互換: cursor:確認済） | PM（Cursor/PM Claude） |\n| `cursor:依頼中` | （互換）pm:依頼中 と同義 | Cursor |\n| `cursor:確認済` | （互換）pm:確認済 と同義 | Cursor |\n| `blocked` | ブロック中 | どちらでも |\n\n### タスクの状態遷移\n\n```\npm:依頼中 → cc:WIP → cc:完了 → pm:確認済\n```\n\n---\n\n## 主要コマンド\n\n### Claude Code 側\n\n| コマンド | 用途 |\n|---------|------|\n| `/harness-init` | プロジェクトセットアップ |\n| `/plan-with-agent` | 計画・タスク分解 |\n| `/work` | タスク実行（並列実行対応） |\n| `/handoff-to-cursor` | 完了報告（Cursor PMへ） |\n| `/sync-status` | 状態確認 |\n\n### スキル（会話で自動起動）\n\n| スキル | トリガー例 |\n|--------|-----------|\n| `handoff-to-pm` | 「PMに完了報告」 |\n| `handoff-to-impl` | 「実装役に渡して」 |\n\n### Cursor 側（参考）\n\n| コマンド | 用途 |\n|---------|------|\n| `/handoff-to-claude` | Claude Code にタスク依頼 |\n| `/review-cc-work` | 完了報告のレビュー |\n\n---\n\n## CI/CD ルール\n\n### Claude Code の責務範囲\n\n- ✅ staging デプロイまで\n- ✅ CI 失敗時の自動修正（3回まで）\n- ❌ 本番デプロイは禁止\n\n### 3回ルール\n\nCI が 3回連続で失敗した場合：\n1. 自動修正を中止\n2. エスカレーションレポートを生成\n3. Cursor に判断を委ねる\n\n---\n\n## よくある質問\n\n### Q: Cursor がいない場合は？\n\nA: 一人で作業する場合も、Plans.md でタスク管理することを推奨します。\n本番デプロイは手動で慎重に行ってください。\n\n### Q: タスクが不明確な場合は？\n\nA: Cursor に確認を依頼するか、`/sync-status` で現状を整理してください。\n\n### Q: CI が何度も失敗する場合は？\n\nA: 3回以上は自動修正せず、Cursor にエスカレーションしてください。\n\n---\n\n## 関連ドキュメント\n\n- AGENTS.md - 詳細な役割分担\n- CLAUDE.md - Claude Code 固有の設定\n- Plans.md - タスク管理ファイル\n",
        "opencode/skills/workflow-guide/examples/typical-workflow.md": "# 典型的なワークフロー例\n\n2エージェントワークフローの実際の流れ。\n\n---\n\n## 例1: 新機能開発\n\n### Phase 1: PM（Cursor）がタスクを作成\n\n```markdown\n# Plans.md\n\n## 🟡 未着手のタスク\n\n- [ ] ユーザープロフィール編集機能 `pm:依頼中`\n  - 名前、メール、アバター画像の編集\n  - バリデーション付き\n  - 変更履歴の保存\n```\n\n**PM の発言**: 「Claude Code にプロフィール編集機能をお願いします」\n\n---\n\n### Phase 2: Claude Code が作業開始\n\n```bash\n# Claude Code で実行\n/work\n```\n\n**Claude Code の作業**:\n1. Plans.md を読み込み\n2. `pm:依頼中` タスクを検出\n3. マーカーを `cc:WIP` に更新\n4. 実装開始\n\n```markdown\n# Plans.md（更新後）\n\n## 🔴 進行中のタスク\n\n- [ ] ユーザープロフィール編集機能 `cc:WIP`\n  - 名前、メール、アバター画像の編集\n  - バリデーション付き\n  - 変更履歴の保存\n  - 関連ファイル:\n    - `src/components/ProfileForm.tsx`\n    - `src/lib/api/profile.ts`\n```\n\n---\n\n### Phase 3: Claude Code が完了報告\n\n```bash\n# Claude Code で実行\n/handoff-to-cursor\n```\n\n**生成されるレポート**:\n\n```markdown\n## 📋 完了報告: ユーザープロフィール編集機能\n\n### 実装内容\n- ProfileForm コンポーネント作成\n- プロフィール API エンドポイント\n- Zod によるバリデーション\n- 変更履歴テーブル追加\n\n### 変更ファイル\n- src/components/ProfileForm.tsx (+150 lines)\n- src/lib/api/profile.ts (+80 lines)\n- src/lib/validations/profile.ts (+25 lines)\n- prisma/schema.prisma (+10 lines)\n\n### テスト結果\n✅ 全テスト合格 (12/12)\n\n### 次のアクション\n- [ ] staging 環境で動作確認\n- [ ] デザインレビュー\n```\n\n---\n\n### Phase 4: PM が確認\n\n```markdown\n# Plans.md（PM 更新後）\n\n## 🟢 完了タスク\n\n- [x] ユーザープロフィール編集機能 `pm:確認済` (2024-01-15)\n```\n\n---\n\n## 例2: バグ修正の緊急対応\n\n### PM からの緊急依頼\n\n```markdown\n## 🟡 未着手のタスク\n\n- [ ] 🔥 【緊急】ログインエラー修正 `pm:依頼中`\n  - 症状: 特定ユーザーがログインできない\n  - エラー: \"Invalid token format\"\n  - 優先度: 最優先\n```\n\n### Claude Code の対応\n\n1. `/work` で着手\n2. エラーログ調査\n3. 原因特定・修正\n4. テスト追加\n5. `/handoff-to-cursor` で完了報告\n\n---\n\n## 例3: CI 失敗時の自動修正\n\n### CI が失敗\n\n```\nGitHub Actions: ❌ Build failed\n- TypeScript error in src/utils/date.ts:45\n```\n\n### Claude Code の自動対応\n\n1. エラー検出\n2. 型エラー修正\n3. 再コミット・プッシュ\n\n**3回失敗した場合**:\n\n```markdown\n## ⚠️ CI エスカレーション\n\n3回修正を試みましたが解決できませんでした。\n\n### 試した修正\n1. 型アノテーション追加 → 失敗\n2. 型定義ファイル更新 → 失敗\n3. tsconfig 調整 → 失敗\n\n### 推定原因\n外部ライブラリの型定義が古い可能性\n\n### 推奨アクション\n- [ ] @types/xxx を最新版に更新\n- [ ] ライブラリ自体のバージョン確認\n```\n\n---\n\n## 例4: 並列タスク実行\n\n### 複数タスクがある場合\n\n```markdown\n## 🟡 未着手のタスク\n\n- [ ] ヘッダーコンポーネントのリファクタリング `cc:TODO`\n- [ ] フッターコンポーネントのリファクタリング `cc:TODO`\n- [ ] テスト追加: ユーティリティ関数 `cc:TODO`\n```\n\n### /work 実行時\n\nClaude Code が並列実行可能か判断:\n- 独立したタスク → 並列実行\n- 依存関係あり → 直列実行\n\n```\n🚀 並列実行開始\n├─ Agent 1: ヘッダーリファクタリング\n├─ Agent 2: フッターリファクタリング\n└─ Agent 3: テスト追加\n```\n",
        "opencode/skills/workflow-guide/references/commands.md": "# コマンドリファレンス\n\n2エージェントワークフローで使用するコマンドの詳細。\n\n---\n\n## Claude Code 側コマンド\n\n### /harness-init\n\nプロジェクトの初期セットアップ。\n\n```\n/harness-init\n```\n\n**生成されるファイル**:\n- Plans.md - タスク管理\n- AGENTS.md - 役割分担定義\n- CLAUDE.md - Claude Code 設定\n- .claude/commands/ - Cursor 連携コマンド\n\n---\n\n### /plan-with-agent\n\nタスクの計画・分解。\n\n```\n/plan-with-agent [タスク説明]\n```\n\n**例**:\n```\n/plan-with-agent ユーザー認証機能を実装したい\n```\n\n**出力**: Plans.md にタスクが追加される\n\n---\n\n### /work\n\nPlans.md のタスクを実行。\n\n```\n/work\n```\n\n**機能**:\n- `cc:TODO` または `pm:依頼中` のタスクを自動検出\n- 複数タスクの並列実行に対応\n- 完了時に `cc:完了` に自動更新\n\n---\n\n### /sync-status\n\n現在の状態サマリーを出力。\n\n```\n/sync-status\n```\n\n**出力例**:\n```\n📊 現在の状態\n- 進行中: 2件\n- 未着手: 5件\n- 完了（確認待ち）: 1件\n```\n\n---\n\n### /handoff-to-cursor\n\nCursor PM への完了報告。\n\n```\n/handoff-to-cursor\n```\n\n**含まれる情報**:\n- 完了したタスク一覧\n- 変更されたファイル\n- テスト結果\n- 次のアクション提案\n\n---\n\n## Cursor 側コマンド（参考）\n\n### /handoff-to-claude\n\nClaude Code へのタスク依頼。\n\n### /review-cc-work\n\nClaude Code の完了報告をレビュー。\n承認できない場合（request_changes）は Plans.md を更新し、**`/claude-code-harness/handoff-to-claude` で修正依頼文を生成してそのまま渡す**。\n\n---\n\n## スキル（会話で自動起動）\n\n### handoff-to-pm\n\n**トリガー**: 「PMに完了報告」「作業完了を報告」\n\nWorker → PM への完了報告を生成。\n\n### handoff-to-impl\n\n**トリガー**: 「実装役に渡して」「Claude Code に依頼」\n\nPM → Worker へのタスク依頼を整形。\n\n---\n\n## コマンド使用フロー\n\n```\n[セッション開始]\n    │\n    ▼\n/sync-status  ←── 現状確認\n    │\n    ▼\n/work  ←── タスク実行\n    │\n    ▼\n/handoff-to-cursor  ←── 完了報告\n    │\n    ▼\n[セッション終了]\n```\n",
        "opencode/skills/workflow/SKILL.md": "---\nname: workflow\ndescription: \"Manages workflow transitions including handoffs between PM and implementation roles, and auto-fixes review comments. Use when user mentions handoffs, reporting to PM, handing off to implementation, completion reports, or auto-fix. Do not use for 2-Agent setup—use 2agent skill instead.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Workflow Skills\n\nPM-実装役間のハンドオフとレビュー指摘の自動修正を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **レビュー指摘自動修正** | See [references/auto-fixing.md](references/auto-fixing.md) |\n| **PM→実装役ハンドオフ** | See [references/handoff-to-impl.md](references/handoff-to-impl.md) |\n| **実装役→PM完了報告** | See [references/handoff-to-pm.md](references/handoff-to-pm.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って実行\n",
        "opencode/skills/workflow/references/auto-fixing.md": "---\nname: auto-fix\ndescription: \"レビュー指摘事項の自動修正。コードレビューで検出された問題を自動修正したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Auto-Fix Skill\n\n`/harness-review`で検出された問題を自動的に修正するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「レビュー指摘を自動修正して」\n- 「指摘された問題を直して」\n- 「セキュリティ問題を修正して」\n- 「パフォーマンス問題を改善して」\n\n---\n\n## 機能\n\n- セキュリティ脆弱性の修正\n- パフォーマンス問題の改善\n- コード品質の向上\n- アクセシビリティ対応の追加\n\n---\n\n## 実行フロー\n\n1. 直近のレビュー結果を読み込み\n2. 修正可能な問題を特定\n3. 修正内容をプレビュー\n4. ユーザー承認後に修正を適用\n5. 修正レポートを生成\n",
        "opencode/skills/workflow/references/execute-commit.md": "---\nname: execute-commit\ndescription: \"Execute git commit based on commit_strategy (task/phase/all). Uses commit-judgment-logic to determine if commit is ready.\"\nallowed-tools: [\"Read\", \"Bash\", \"Grep\"]\n---\n\n# Execute Commit\n\n`commit_strategy`に応じて適切なタイミングで`git commit`を実行するスキル。\n\n---\n\n## 入力\n\n- **commit_strategy**: `task` / `phase` / `all`\n- **worker_results**: Phase1のtask-worker実行結果\n- **review_result**: Phase2のレビュー結果（オプション）\n- **changed_files**: 変更されたファイルのリスト\n\n---\n\n## 出力\n\n```json\n{\n  \"committed\": true,\n  \"commit_hash\": \"abc1234\",\n  \"commit_message\": \"feat(components): add Header, Footer, Sidebar components\",\n  \"files_committed\": 5,\n  \"strategy_used\": \"phase\"\n}\n```\n\n---\n\n## commit_strategy別の動作\n\n### `task`（デフォルト）\n\n各タスク完了時に個別commit（`run-task-workers`で実行）：\n\n```bash\n# 各task-workerがcommit_readyを返した時点でcommit\ngit add src/components/Header.tsx\ngit commit -m \"feat(components): add Header component\"\n```\n\n**実行タイミング**: Phase1の各task-worker完了時（このスキルでは実行しない）\n\n### `phase`\n\nレビュー完了後にまとめてcommit：\n\n```bash\n# Phase2完了時（クロスレビュー後）\ngit add src/components/Header.tsx src/components/Footer.tsx src/components/Sidebar.tsx\ngit commit -m \"feat(components): add Header, Footer, Sidebar components\"\n```\n\n**実行タイミング**: Phase2完了後（Phase3開始時）\n\n### `all`\n\n全レビュー完了後に1回だけcommit：\n\n```bash\n# Phase3開始時（Phase1+Phase2の全変更）\ngit add .\ngit commit -m \"feat(components): add Header, Footer, Sidebar components\n\n- Add responsive Header with navigation\n- Add Footer with copyright and links\n- Add collapsible Sidebar for mobile\n\nCo-Authored-By: Claude <noreply@anthropic.com>\"\n```\n\n**実行タイミング**: Phase3完了時（Phase4開始前）\n\n---\n\n## 実行手順\n\n### Step 1: commit_strategyの確認\n\n```bash\n# ワークフロー変数から取得\n# commit_strategy: \"task\" | \"phase\" | \"all\"\n```\n\n### Step 2: コミット準備の確認\n\n#### 2.1: 変更ファイルの確認\n\n```bash\n# git statusで変更ファイルを確認\ngit status --short\n\n# 変更があることを確認\nif [ -z \"$(git status --porcelain)\" ]; then\n  echo \"変更がありません。コミットをスキップします。\"\n  exit 0\nfi\n```\n\n#### 2.2: レビュー結果の確認（Phase2実行時）\n\n`commit-judgment-logic.md`を参照して、コミット可能か判定：\n\n```markdown\n判定基準:\n- APPROVE: Critical: 0, High: 0, Medium: ≤3 → コミット OK\n- REQUEST CHANGES: Critical: 0, High: ≥1 または Medium: >3 → 自動修正 → 再判定\n- REJECT: Critical: ≥1 → 手動対応必要（コミット不可）\n```\n\n**参照**: [`commit-judgment-logic.md`](../../harness-review/references/commit-judgment-logic.md)\n\n### Step 3: Conventional Commit メッセージの生成\n\n変更内容を分析して適切なプレフィックスを選択：\n\n```bash\n# 変更ファイルからタイプを推定\n# feat: 新機能（新規ファイル）\n# fix: バグ修正（既存ファイルの修正）\n# refactor: リファクタリング\n# docs: ドキュメント\n# test: テスト追加\n# chore: その他\n\n# 例: 新規コンポーネントファイル → feat\n# 例: 既存ファイルの修正 → fix\n```\n\n**メッセージフォーマット**:\n\n```\n<type>(<scope>): <subject>\n\n<body>\n\n<footer>\n```\n\n**例**:\n\n```\nfeat(components): add Header, Footer, Sidebar components\n\n- Add responsive Header with navigation\n- Add Footer with copyright and links\n- Add collapsible Sidebar for mobile\n\nCo-Authored-By: Claude <noreply@anthropic.com>\n```\n\n### Step 4: git add の実行\n\n```bash\n# commit_strategy=all の場合\ngit add .\n\n# commit_strategy=phase の場合（Phase1の変更のみ）\ngit add src/components/Header.tsx src/components/Footer.tsx src/components/Sidebar.tsx\n\n# commit_strategy=task の場合（各タスクの変更のみ）\ngit add src/components/Header.tsx\n```\n\n### Step 5: git commit の実行\n\n```bash\ngit commit -m \"{{commit_message}}\"\n```\n\n### Step 6: 結果の確認\n\n```bash\n# コミットハッシュを取得\nCOMMIT_HASH=$(git rev-parse --short HEAD)\n\n# コミットされたファイル数を取得\nFILES_COMMITTED=$(git diff --name-only HEAD~1 | wc -l)\n```\n\n---\n\n## エラーハンドリング\n\n### コミット前のビルド検証\n\n```bash\n# 最終ビルド検証\nnpm run build || pnpm build || bun run build\n\n# 失敗時はエラーを返す（コミットしない）\nif [ $? -ne 0 ]; then\n  echo \"ビルドエラー: コミットを中止します\"\n  exit 1\nfi\n```\n\n### コンフリクト検出（isolation=worktree時）\n\n`isolation_mode=worktree`の場合、Phase3直前にworktreeブランチをマージ：\n\n```bash\n# merge-worktreesスキルでマージ済みを前提\n# ここではマージ後の状態でcommitを実行\n```\n\n---\n\n## 使用例\n\n### 例1: commit_strategy=task\n\n**Phase1完了時（各task-worker完了時）**:\n\n```bash\n# task-worker-1完了時\ngit add src/components/Header.tsx\ngit commit -m \"feat(components): add Header component\"\n\n# task-worker-2完了時\ngit add src/components/Footer.tsx\ngit commit -m \"feat(components): add Footer component\"\n```\n\n### 例2: commit_strategy=phase\n\n**Phase1完了時（全task-worker完了後）**:\n\n```bash\ngit add src/components/Header.tsx src/components/Footer.tsx src/components/Sidebar.tsx\ngit commit -m \"feat(components): add Header, Footer, Sidebar components\n\n- Add responsive Header with navigation\n- Add Footer with copyright and links\n- Add collapsible Sidebar for mobile\"\n```\n\n### 例3: commit_strategy=all\n\n**Phase3完了時（全フェーズ完了後）**:\n\n```bash\ngit add .\ngit commit -m \"feat(components): add Header, Footer, Sidebar components\n\n- Add responsive Header with navigation\n- Add Footer with copyright and links\n- Add collapsible Sidebar for mobile\n\nReviewed-by: Codex (4 experts)\nCo-Authored-By: Claude <noreply@anthropic.com>\"\n```\n\n---\n\n## 注意事項\n\n- **commit-judgment-logicの参照**: レビュー結果がある場合、必ず`commit-judgment-logic.md`の判定基準を確認する\n- **Conventional Commits準拠**: コミットメッセージはConventional Commits形式に従う\n- **ビルド検証**: コミット前に必ずビルドが成功することを確認する\n- **worktreeマージ**: `isolation_mode=worktree`時は、マージ完了後にcommitを実行する\n",
        "opencode/skills/workflow/references/handoff-to-impl.md": "---\nname: handoff-to-impl\ndescription: \"PM Claude → Impl Claude への依頼文を生成。2-Agent運用で実装役にタスクを渡したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Handoff to Impl Skill\n\nPM役 Claude Code が、実装役 Claude Code（Impl Claude）へ貼り付けるための依頼文を生成するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「このタスクを実装役Claudeに渡したい」\n- 「実装役に依頼文を作って」\n- 「Impl Claudeへのハンドオフ」\n\n---\n\n## 出力フォーマット\n\n```markdown\n## タスク依頼（PM Claude → Impl Claude）\n\n### 背景 / 目的\n- （なぜやるか）\n\n### 期待する成果\n- （何ができるようになればOKか）\n\n### 受け入れ基準（必須）\n- [ ] （基準1）\n- [ ] （基準2）\n\n### スコープ（やる / やらない）\n- **やる**: （項目）\n- **やらない**: （項目）\n\n### 変更対象（目安）\n- （ファイル/ディレクトリ）\n\n### 制約 / 禁止事項\n- （あれば）\n```\n\n---\n\n## 実行フロー\n\n1. `Plans.md` を読み込み、依頼対象タスクを特定\n2. タスクに `pm:依頼中` マーカーを付与\n3. 上記フォーマットで依頼文を生成\n",
        "opencode/skills/workflow/references/handoff-to-pm.md": "---\nname: handoff-to-pm\ndescription: \"Impl Claude → PM Claude への完了報告を生成。2-Agent運用で実装完了を報告したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Handoff to PM Skill\n\n実装役 Claude Code が、PM役 Claude Code へ貼り付けるための完了報告を生成するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「PMに完了報告を書いて」\n- 「実装が終わったので報告」\n- 「PM Claudeへのハンドオフ」\n\n---\n\n## 出力フォーマット\n\n```markdown\n## 完了報告（Impl Claude → PM Claude）\n\n### 概要（1〜3行）\n- （何を達成したか）\n\n### 変更点（要点）\n- （ユーザーに見える変更）\n\n### 変更ファイル\n- （ファイル一覧）\n\n### 動作確認 / テスト\n- （実施した確認）\n- （結果）\n\n### 受け入れ基準（満たしたか）\n- [ ] （基準1）→ ✅/⚠️\n- [ ] （基準2）→ ✅/⚠️\n\n### リスク / 注意点\n- （あれば）\n\n### 次のアクション候補\n1. （案1）\n2. （案2）\n```\n\n---\n\n## 実行フロー\n\n1. `git status` / `git diff` で変更範囲を把握\n2. `Plans.md` の該当タスクを `cc:完了` に更新\n3. 上記フォーマットで完了報告を生成\n",
        "scripts/hooks/evaluate_subagent_output.sh": "#!/bin/bash\n# SubagentStop hook sample script\n# This script evaluates the output of a subagent and logs it.\n\n# Read input from stdin (JSON containing subagent information)\nINPUT=$(cat)\n\n# Extract relevant fields\nAGENT_ID=$(echo \"$INPUT\" | jq -r '.agent_id // \"unknown\"')\nTRANSCRIPT_PATH=$(echo \"$INPUT\" | jq -r '.transcript_path // \"unknown\"')\nTIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')\n\n# Log directory\nLOG_DIR=\"${CLAUDE_PROJECT_DIR}/.claude/subagent_logs\"\nmkdir -p \"$LOG_DIR\"\n\n# Log file\nLOG_FILE=\"$LOG_DIR/subagent_completions.log\"\n\n# Log the completion\necho \"=== Subagent Completed ===\" >> \"$LOG_FILE\"\necho \"Timestamp: $TIMESTAMP\" >> \"$LOG_FILE\"\necho \"Agent ID: $AGENT_ID\" >> \"$LOG_FILE\"\necho \"Transcript: $TRANSCRIPT_PATH\" >> \"$LOG_FILE\"\necho \"\" >> \"$LOG_FILE\"\n\n# Optional: Extract the last message from the transcript\nif [ -f \"$TRANSCRIPT_PATH\" ]; then\n    LAST_MESSAGE=$(tail -n 1 \"$TRANSCRIPT_PATH\" | jq -r '.content // \"N/A\"')\n    echo \"Last Message: $LAST_MESSAGE\" >> \"$LOG_FILE\"\n    echo \"\" >> \"$LOG_FILE\"\nfi\n\n# Exit with success\nexit 0\n",
        "scripts/sandbox-test/README.md": "# Sandbox Test\n\n> `/work --full` 動作確認用のテストディレクトリ\n\n## 目的\n\nこのディレクトリは Claude harness v2.9.0 で追加された `/work --full` コマンドと `task-worker` エージェントの動作確認のために作成されました。\n\n## ファイル構成\n\n| ファイル | 説明 |\n|---------|------|\n| `greeting.ts` | テスト用ユーティリティ関数 |\n| `greeting.test.ts` | ユニットテスト（Vitest） |\n| `README.md` | このファイル |\n\n## テスト実行\n\n```bash\n# Vitest がインストールされている場合\nnpx vitest run scripts/sandbox-test/\n\n# または\nbun test scripts/sandbox-test/\n```\n\n## /work --full テスト結果\n\nこのディレクトリは以下のコマンドで生成されました：\n\n```bash\n/work --full --parallel 3\n```\n\n### 期待した動作\n\n1. **Phase 1**: 3つの task-worker が並列起動\n   - task-worker #1: `greeting.ts` 作成\n   - task-worker #2: `greeting.test.ts` 作成\n   - task-worker #3: `README.md` 作成\n\n2. **Phase 2**: Codex 8並列クロスレビュー（オプション）\n\n3. **Phase 3**: コンフリクト解消 → コミット\n\n## 関連ドキュメント\n\n- [/work --full ドキュメント](../../docs/PARALLEL_FULL_CYCLE.md)\n- [task-worker エージェント](../../agents/task-worker.md)\n",
        "skills/2agent/SKILL.md": "---\nname: 2agent\ndescription: \"Configures 2-Agent workflow between PM and implementation roles. Use when user mentions 2-Agent setup, PM coordination, Cursor setup, or 2-agent operations. Do NOT load for: solo operation, workflow execution, or handoff processing.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# 2-Agent Skills\n\n2-Agent ワークフローの設定を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **初期設定** | See [references/2agent-setup.md](references/2agent-setup.md) |\n| **ファイル更新** | See [references/2agent-updating.md](references/2agent-updating.md) |\n| **Cursor連携** | See [references/cursor-setup.md](references/cursor-setup.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って設定\n",
        "skills/2agent/references/2agent-setup.md": "---\nname: setup-2agent-files\ndescription: \"2エージェント体制に必要なファイル（Cursorコマンド、メモリ構造、バージョンファイル）をセットアップするスキル。Cursor連携のセットアップファイルを生成する場合に使用します。\"\nallowed-tools: [\"Write\"]\n---\n\n# Setup 2-Agent Files Skill\n\n2エージェント体制（Cursor PM + Claude Code Worker）に必要な補助ファイルをセットアップするスキル。\n\n---\n\n## 目的\n\n`generate-workflow-files` が生成する AGENTS.md, CLAUDE.md, Plans.md 以外の\n2エージェント体制に必要なファイルを生成・配置します。\n\n---\n\n## 生成するファイル\n\n### Cursor コマンド (.cursor/commands/)\n\n| ファイル | 用途 | 使うタイミング |\n|---------|------|---------------|\n| `start-session.md` | セッション開始 | 作業を始める時 |\n| `project-overview.md` | プロジェクト全体確認 | 状況を把握したい時 |\n| `plan-with-cc.md` | 計画を立てる | 何をすべきか相談したい時 |\n| `handoff-to-claude.md` | タスク依頼 | 具体的な作業を依頼する時 |\n| `review-cc-work.md` | 完了レビュー | Claude Code の作業を確認する時 |\n\n### Claude Rules (.claude/rules/) - v0.4.0+\n\n| ファイル | 用途 |\n|---------|------|\n| `workflow.md` | 2-Agent ワークフロールール |\n| `coding-standards.md` | コーディング規約（paths: で条件適用） |\n\n### その他のファイル\n\n| ファイル | 用途 |\n|---------|------|\n| `.claude/memory/session-log.md` | セッション間の作業ログ |\n| `.claude/memory/decisions.md` | 重要な決定事項の記録 |\n| `.claude/memory/patterns.md` | 学んだパターンの記録 |\n| `.claude-code-harness-version` | プラグインバージョン管理 |\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `plugin_version` | プラグインのバージョン（VERSION ファイルから取得） |\n| `project_name` | プロジェクト名（ディレクトリ名から取得） |\n| `date` | セットアップ日（自動取得） |\n| `setup_status` | セットアップ状態（new / current / outdated） |\n\n### バージョンチェック\n\n既存の `.claude-code-harness-version` がある場合、バージョンを比較して以下を判定：\n\n| 状態 | 判定 | `should_proceed` | `update_type` |\n|------|------|------------------|---------------|\n| ファイルなし | 新規セットアップ | true | new |\n| 同じバージョン | 最新 | false（確認後 true） | skip |\n| 古いバージョン | 更新あり | true | update |\n\n---\n\n## 実行手順\n\n### Step 1: バージョン情報の取得\n\n```bash\n# プラグインパス（インストール場所に依存しない）\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\n# プラグインのバージョンを取得\nPLUGIN_VERSION=$(cat \"$PLUGIN_PATH/VERSION\" 2>/dev/null || echo \"0.0.0\")\n\n# 現在の日付\nTODAY=$(date +%Y-%m-%d)\n\n# プロジェクト名\nPROJECT_NAME=$(basename \"$(pwd)\")\n```\n\n### Step 2: 既存ファイルの確認\n\n```bash\n# 既存ファイルをチェック\n[ -f .claude-code-harness-version ] && echo \"existing: .claude-code-harness-version\"\n[ -d .cursor/commands ] && echo \"existing: .cursor/commands/\"\n[ -d .claude/memory ] && echo \"existing: .claude/memory/\"\n```\n\n### Step 3: Cursor コマンドの配置\n\n**重要**: テンプレートフォルダ内の全コマンドをコピーする\n\n```bash\n# ディレクトリ作成\nmkdir -p .cursor/commands\n\n# テンプレートから全コマンドをコピー\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\ncp \"$PLUGIN_PATH/templates/cursor/commands/start-session.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/project-overview.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/plan-with-cc.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/handoff-to-claude.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/review-cc-work.md\" .cursor/commands/\n```\n\n**コピー元テンプレート** (5ファイル):\n- `templates/cursor/commands/start-session.md` - セッション開始\n- `templates/cursor/commands/project-overview.md` - プロジェクト確認\n- `templates/cursor/commands/plan-with-cc.md` - 計画立案\n- `templates/cursor/commands/handoff-to-claude.md` - タスク依頼\n- `templates/cursor/commands/review-cc-work.md` - 完了レビュー\n\n### Step 4: Claude Rules の配置（v0.4.0+）\n\n```bash\n# ディレクトリ作成\nmkdir -p .claude/rules\n\n# ルールファイルをテンプレートからコピー\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\n\nfor template in \"$PLUGIN_PATH/templates/rules\"/*.template; do\n  if [ -f \"$template\" ]; then\n    rule_name=$(basename \"$template\" .template)\n    cp \"$template\" \".claude/rules/$rule_name\"\n  fi\ndone\n```\n\n### Step 5: メモリ構造の初期化\n\n```bash\n# ディレクトリ作成\nmkdir -p .claude/memory\n```\n\n**session-log.md** を作成:\n\n```markdown\n# Session Log\n\nセッション間で共有する作業ログ。\n\n---\n\n## {{DATE}}\n\n- 2エージェント体制セットアップ完了\n```\n\n**decisions.md** を作成:\n\n```markdown\n# Decisions\n\nプロジェクトで決定された重要な設計・方針の記録。\n\n---\n\n## 設計決定\n\n（まだ記録なし）\n\n## 方針決定\n\n（まだ記録なし）\n```\n\n**patterns.md** を作成:\n\n```markdown\n# Patterns\n\nプロジェクトで発見・採用したパターンの記録。\n\n---\n\n## コーディングパターン\n\n（まだ記録なし）\n\n## 問題解決パターン\n\n（まだ記録なし）\n```\n\n### Step 6: バージョンファイルの作成\n\n**テンプレートから変数を置換して作成**:\n\n```bash\n# templates/.claude-code-harness-version.template を読み込み、変数を置換\nsed -e \"s/{{VERSION}}/${PLUGIN_VERSION}/g\" \\\n    -e \"s/{{DATE}}/${TODAY}/g\" \\\n    \"$PLUGIN_PATH/templates/.claude-code-harness-version.template\" \\\n    > .claude-code-harness-version\n```\n\nまたは直接作成:\n\n```\n# claude-code-harness version tracking\n# This file is auto-generated by /setup-cursor\n# DO NOT manually edit - used for update detection\n\nversion: {{PLUGIN_VERSION}}\ninstalled_at: {{TODAY}}\nlast_setup_command: setup-cursor\n```\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `should_proceed` | セットアップを続行するか（boolean） |\n| `update_type` | 更新タイプ（new / update / skip） |\n| `current_version` | 既存のバージョン（更新時のみ） |\n| `cursor_commands_created` | 作成された Cursor コマンド一覧 |\n| `memory_initialized` | メモリ構造の初期化完了フラグ |\n| `version_file_created` | バージョンファイル作成完了フラグ |\n\n---\n\n## 注意事項\n\n- **既存ファイルがある場合**: 上書き確認を求める\n- **テンプレートを直接コピー**: 簡略化せず、詳細版テンプレートを使用\n- **バージョン管理**: `.claude-code-harness-version` で更新検出を可能にする\n\n### Step 7: Hooks 設定の配置（自動整理機能）\n\n```bash\n# スクリプトディレクトリ作成\nmkdir -p .claude/scripts\n\n# Hook スクリプトをコピー\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\ncp \"$PLUGIN_PATH/templates/hooks/auto-cleanup-hook.sh\" .claude/scripts/\nchmod +x .claude/scripts/auto-cleanup-hook.sh\n\n# 設定ファイルをコピー\ncp \"$PLUGIN_PATH/templates/.claude-code-harness.config.yaml.template\" .claude-code-harness.config.yaml\n```\n\n**.claude/settings.json** は `generate-claude-settings` で作成/更新（既存があれば非破壊マージ）:\n\n- `permissions.deny/ask` をチーム運用できる形で整備\n- `permissions.disableBypassPermissionsMode` は **設定しない**（bypassPermissions を許可）\n  - セキュリティ要件で bypass を禁止したい場合のみ設定（例: managed-settings.json）\n\n**⚠️ パーミッション構文の注意**: プレフィックスマッチには必ず `:*` を使用（`*` 単独は不可）\n- 正しい: `\"Bash(npm run:*)\"` / 間違い: `\"Bash(npm run *)\"`\n\n手順は `skills/setup/generate-claude-settings/doc.md` に従うこと。\n\n---\n\n## 関連スキル\n\n- `generate-workflow-files` - AGENTS.md, CLAUDE.md, Plans.md の生成\n- `generate-claude-settings` - `.claude/settings.json` の作成/更新（安全ポリシー + 非破壊マージ）\n- `session-memory` - メモリ構造の活用方法\n- `core-read-repo-context` - 既存ファイルの確認\n- `auto-cleanup` - 自動整理機能\n",
        "skills/2agent/references/2agent-updating.md": "---\nname: update-2agent-files\ndescription: \"既存の2エージェント体制セットアップを更新するスキル（差分更新・マージ対応）。既存のCursor連携ファイルを更新する場合に使用します。\"\nallowed-tools: [\"Read\", \"Edit\"]\n---\n\n# Update 2-Agent Files Skill\n\n既存の2エージェント体制セットアップを最新バージョンに更新するスキル。\nユーザーデータを保持しながら、プラグインの改善を適用します。\n\n---\n\n## 目的\n\n- 既存の AGENTS.md, CLAUDE.md, Plans.md を最新テンプレートで更新\n- ユーザーのタスク・記録を保持\n- Case-insensitive なファイル検出\n- バージョン管理と更新履歴\n\n---\n\n## Case-Insensitive ファイル検出\n\n### 検出ロジック\n\n**重要**: macOS/Windows は case-insensitive、Linux は case-sensitive。\nすべての環境で一貫した動作を保証するため、明示的に検索する。\n\n```bash\n# 既存ファイルを case-insensitive で検索\ndetect_file() {\n  local pattern=\"$1\"\n  local found=$(find . -maxdepth 1 -iname \"$pattern\" -type f 2>/dev/null | head -1)\n  if [ -n \"$found\" ]; then\n    echo \"$found\"\n  fi\n}\n\nAGENTS_FILE=$(detect_file \"agents.md\")\nCLAUDE_FILE=$(detect_file \"claude.md\")\nPLANS_FILE=$(detect_file \"plans.md\")\nVERSION_FILE=\".claude-code-harness-version\"\n```\n\n### 検出結果の正規化\n\n```bash\n# 標準ファイル名との比較\nnormalize_filename() {\n  local found=\"$1\"\n  local standard=\"$2\"\n\n  if [ -n \"$found\" ] && [ \"$found\" != \"./$standard\" ]; then\n    echo \"検出: $found → 推奨: $standard\"\n    # ユーザーに確認後、リネーム\n    # mv \"$found\" \"$standard\"\n  fi\n}\n\nnormalize_filename \"$AGENTS_FILE\" \"AGENTS.md\"\nnormalize_filename \"$CLAUDE_FILE\" \"CLAUDE.md\"\nnormalize_filename \"$PLANS_FILE\" \"Plans.md\"\n```\n\n---\n\n## 期待されるファイル構成（v0.4.0）\n\n更新時に以下のファイルが**存在すべき**かチェックする：\n\n```\n./\n├── AGENTS.md\n├── CLAUDE.md\n├── Plans.md\n├── .claude-code-harness-version\n├── .claude-code-harness.config.yaml\n├── .cursor/\n│   └── commands/\n│       ├── start-session.md        # v0.3.5+（Named Sessions: v0.4.0+）\n│       ├── project-overview.md     # v0.3.5+\n│       ├── plan-with-cc.md         # v0.3.5+\n│       ├── handoff-to-claude.md\n│       └── review-cc-work.md\n└── .claude/\n    ├── rules/                      # v0.4.0+\n    │   ├── workflow.md\n    │   └── coding-standards.md\n    ├── memory/\n    │   ├── session-log.md\n    │   ├── decisions.md\n    │   └── patterns.md\n    └── scripts/\n        └── auto-cleanup-hook.sh    # v0.3.7+\n```\n\n---\n\n## 更新フロー\n\n### Step 1: 環境確認\n\n```bash\n# プラグインバージョン\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nPLUGIN_VERSION=$(cat \"$PLUGIN_PATH/VERSION\" 2>/dev/null || echo \"0.0.0\")\n\n# インストール済みバージョン\nif [ -f .claude-code-harness-version ]; then\n  INSTALLED_VERSION=$(grep \"^version:\" .claude-code-harness-version | cut -d' ' -f2)\n  SETUP_STATUS=\"existing\"\nelse\n  INSTALLED_VERSION=\"\"\n  SETUP_STATUS=\"not_installed\"\nfi\n\n# プロジェクト情報\nPROJECT_NAME=$(basename \"$(pwd)\")\nTODAY=$(date +%Y-%m-%d)\n```\n\n### Step 2: 足りないファイルの検出（重要）\n\n**テンプレート変更の有無に関わらず、必須ファイルが存在するかチェック**\n\n```bash\n# 必須ファイルリスト\nREQUIRED_FILES=(\n  \".cursor/commands/start-session.md\"\n  \".cursor/commands/project-overview.md\"\n  \".cursor/commands/plan-with-cc.md\"\n  \".cursor/commands/handoff-to-claude.md\"\n  \".cursor/commands/review-cc-work.md\"\n  \".claude/rules/workflow.md\"              # v0.4.0+\n  \".claude/rules/coding-standards.md\"      # v0.4.0+\n  \".claude/scripts/auto-cleanup-hook.sh\"\n  \".claude-code-harness.config.yaml\"\n)\n\nMISSING_FILES=()\n\nfor file in \"${REQUIRED_FILES[@]}\"; do\n  if [ ! -f \"$file\" ]; then\n    MISSING_FILES+=(\"$file\")\n    echo \"⚠️ 不足: $file\"\n  fi\ndone\n\nif [ ${#MISSING_FILES[@]} -gt 0 ]; then\n  echo \"\"\n  echo \"📋 ${#MISSING_FILES[@]} 個のファイルが不足しています。追加します。\"\n  NEEDS_FILE_ADD=true\nelse\n  echo \"✅ 必須ファイルは全て揃っています\"\n  NEEDS_FILE_ADD=false\nfi\n```\n\n### Step 3: 更新判定\n\n| 条件 | update_type | 動作 |\n|------|-------------|------|\n| `.claude-code-harness-version` なし | `not_installed` | `/setup-cursor` を案内 |\n| バージョン同じ & ファイル揃ってる | `current` | スキップ |\n| バージョン同じ & ファイル不足 | `missing_files` | 不足分を追加 |\n| バージョン古い | `outdated` | 更新を実行 |\n\n```bash\nif [ \"$SETUP_STATUS\" = \"not_installed\" ]; then\n  echo \"⚠️ セットアップされていません。/setup-cursor を実行してください。\"\n  exit 1\nfi\n\nif [ \"$INSTALLED_VERSION\" = \"$PLUGIN_VERSION\" ]; then\n  echo \"✅ 最新バージョン (v${PLUGIN_VERSION}) です。\"\n  echo \"強制更新する場合は「強制更新して」と言ってください。\"\n  # --force オプションがあれば続行\nfi\n```\n\n### Step 4: バックアップ作成\n\n```bash\nBACKUP_DIR=\".claude-code-harness-backup-$(date +%Y%m%d-%H%M%S)\"\nmkdir -p \"$BACKUP_DIR\"\n\n# 既存ファイルをバックアップ\n[ -n \"$AGENTS_FILE\" ] && cp \"$AGENTS_FILE\" \"$BACKUP_DIR/\"\n[ -n \"$CLAUDE_FILE\" ] && cp \"$CLAUDE_FILE\" \"$BACKUP_DIR/\"\n[ -n \"$PLANS_FILE\" ] && cp \"$PLANS_FILE\" \"$BACKUP_DIR/\"\n[ -f .claude-code-harness-version ] && cp .claude-code-harness-version \"$BACKUP_DIR/\"\n\necho \"📦 バックアップ: $BACKUP_DIR\"\n```\n\n### Step 5: Plans.md のマージ更新\n\n**merge-plans スキルを呼び出す**\n\n```bash\n# 既存の Plans.md からタスクセクションを抽出\nextract_tasks \"$PLANS_FILE\" > /tmp/existing_tasks.md\n\n# テンプレートに既存タスクをマージ\nmerge_plans \"$PLUGIN_PATH/templates/Plans.md.template\" /tmp/existing_tasks.md > Plans.md\n```\n\n### Step 6: AGENTS.md / CLAUDE.md の更新\n\n```bash\n# プロジェクト名を保持しつつテンプレートを適用\nsed -e \"s/{{PROJECT_NAME}}/$PROJECT_NAME/g\" \\\n    -e \"s/{{DATE}}/$TODAY/g\" \\\n    \"$PLUGIN_PATH/templates/AGENTS.md.template\" > AGENTS.md\n\nsed -e \"s/{{PROJECT_NAME}}/$PROJECT_NAME/g\" \\\n    -e \"s/{{DATE}}/$TODAY/g\" \\\n    \"$PLUGIN_PATH/templates/CLAUDE.md.template\" > CLAUDE.md\n\n# 旧ファイル名を削除（正規化）\n[ -n \"$AGENTS_FILE\" ] && [ \"$AGENTS_FILE\" != \"./AGENTS.md\" ] && rm \"$AGENTS_FILE\"\n[ -n \"$CLAUDE_FILE\" ] && [ \"$CLAUDE_FILE\" != \"./CLAUDE.md\" ] && rm \"$CLAUDE_FILE\"\n[ -n \"$PLANS_FILE\" ] && [ \"$PLANS_FILE\" != \"./Plans.md\" ] && rm \"$PLANS_FILE\"\n```\n\n### Step 7: Cursor コマンドの更新（全5ファイル）\n\n```bash\nmkdir -p .cursor/commands\ncp \"$PLUGIN_PATH/templates/cursor/commands/start-session.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/project-overview.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/plan-with-cc.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/handoff-to-claude.md\" .cursor/commands/\ncp \"$PLUGIN_PATH/templates/cursor/commands/review-cc-work.md\" .cursor/commands/\n```\n\n### Step 8: Claude Rules の更新（v0.4.0+）\n\n```bash\n# ディレクトリ作成（存在しない場合）\nmkdir -p .claude/rules\n\n# プラグイン提供のルールを更新（テンプレートから）\nfor template in \"$PLUGIN_PATH/templates/rules\"/*.template; do\n  if [ -f \"$template\" ]; then\n    rule_name=$(basename \"$template\" .template)\n    target=\".claude/rules/$rule_name\"\n    cp \"$template\" \"$target\"\n    echo \"  ✅ $rule_name を更新\"\n  fi\ndone\n\n# 注意: ユーザーが独自に作成したルール（テンプレートにないもの）は保持される\n```\n\n### Step 9: Hooks 設定の更新（v0.3.7+）\n\n```bash\n# スクリプトディレクトリ作成\nmkdir -p .claude/scripts\n\n# Hook スクリプトをコピー\ncp \"$PLUGIN_PATH/templates/hooks/auto-cleanup-hook.sh\" .claude/scripts/\nchmod +x .claude/scripts/auto-cleanup-hook.sh\n\n# 設定ファイルをコピー（存在しない場合のみ）\n[ ! -f .claude-code-harness.config.yaml ] && \\\n  cp \"$PLUGIN_PATH/templates/.claude-code-harness.config.yaml.template\" .claude-code-harness.config.yaml\n\n# .claude/settings.json を更新（既存設定は非破壊マージ）\n# ここは `generate-claude-settings` を実行して統一する\n# - permissions.allow|ask|deny: 配列マージ + 重複排除\n# - permissions.disableBypassPermissionsMode: 常に \"disable\"\n```\n\n### Step 10: バージョンファイルの更新\n\n```bash\ncat > .claude-code-harness-version << EOF\n# claude-code-harness version tracking\n# Updated by /setup-cursor\n\nversion: ${PLUGIN_VERSION}\ninstalled_at: ${TODAY}\nlast_setup_command: setup-cursor\nupdated_from: ${INSTALLED_VERSION}\nupdate_history:\n  - ${INSTALLED_VERSION} -> ${PLUGIN_VERSION} (${TODAY})\nEOF\n```\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `update_performed` | 更新が実行されたか |\n| `old_version` | 更新前のバージョン |\n| `new_version` | 更新後のバージョン |\n| `backup_path` | バックアップの場所 |\n| `tasks_preserved` | 保持されたタスク数 |\n| `normalized_files` | 正規化されたファイル |\n\n---\n\n## エラー処理\n\n| エラー | 対応 |\n|--------|------|\n| Plans.md 解析失敗 | バックアップを保持し、テンプレートで再作成 |\n| ファイル書き込み失敗 | バックアップから復元 |\n| テンプレート見つからない | プラグイン再インストールを案内 |\n\n---\n\n## 関連スキル\n\n- `merge-plans` - Plans.md のマージロジック\n- `setup-2agent-files` - 初回セットアップ\n- `generate-workflow-files` - ワークフローファイル生成\n- `generate-claude-settings` - `.claude/settings.json` の作成/更新（安全ポリシー + 非破壊マージ）\n",
        "skills/2agent/references/cursor-setup.md": "---\nname: setup-cursor\ndescription: \"Cursor連携のセットアップ（.cursor/commands 生成）。Cursor と Claude Code で役割分担したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Bash\"]\n---\n\n# Setup Cursor Skill\n\nCursor側のカスタムコマンド（`.cursor/commands/*.md`）を生成し、2-agent運用を開始できる状態にするスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「CursorとClaude Codeで役割分担したい」\n- 「2-agent運用を始めたい」\n- 「Cursor連携をセットアップして」\n- 「計画はCursor、実装はClaudeに任せたい」\n\n---\n\n## 生成するファイル\n\n- `.cursor/commands/start-session.md`\n- `.cursor/commands/project-overview.md`\n- `.cursor/commands/plan-with-cc.md`\n- `.cursor/commands/handoff-to-claude.md`\n- `.cursor/commands/review-cc-work.md`\n- `.claude/memory/decisions.md`（SSOT）\n- `.claude/memory/patterns.md`（SSOT）\n\n---\n\n## 実行フロー\n\n1. `.cursor/commands/` を作成\n2. 5つのコマンドファイルを生成\n3. `.claude/memory/` を作成し、SSOTファイルを初期化\n4. Cursorを再起動してコマンドが表示されることを案内\n",
        "skills/auth/SKILL.md": "---\nname: auth\ndescription: \"Implements authentication and payment features using Clerk, Supabase Auth, or Stripe. Use when user mentions login, authentication, payments, subscriptions, or Stripe. Do NOT load for: general UI work, database design, or non-auth features.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Auth Skills\n\n認証と決済機能の実装を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **認証機能** | See [references/authentication.md](references/authentication.md) |\n| **決済機能** | See [references/payments.md](references/payments.md) |\n\n## 実行手順\n\n1. **品質判定ゲート**（Step 0）\n2. ユーザーのリクエストを分類(認証 or 決済)\n3. 上記の「機能詳細」から適切な参照ファイルを読む\n4. その内容に従って実装\n\n### Step 0: 品質判定ゲート（セキュリティチェックリスト）\n\n認証・決済機能は常にセキュリティリスクが高いため、作業開始前に必ず以下を表示:\n\n```markdown\n🔐 セキュリティチェックリスト\n\nこの作業はセキュリティ上重要です。以下を確認してください：\n\n### 認証関連\n- [ ] パスワードはハッシュ化（bcrypt/argon2）\n- [ ] セッション管理は安全か（HTTPOnly Cookie）\n- [ ] CSRF 対策は実装されているか\n- [ ] レート制限（ブルートフォース対策）\n\n### 決済関連\n- [ ] 機密情報（カード番号等）をサーバーに保存しない\n- [ ] Stripe/決済プロバイダの SDK を正しく使用\n- [ ] Webhook の署名検証\n- [ ] 金額改ざん防止（サーバー側で金額を確定）\n\n### 共通\n- [ ] エラーメッセージが詳細すぎないか（情報漏洩防止）\n- [ ] ログに機密情報を出力していないか\n```\n\n### セキュリティ重要度表示\n\n```markdown\n⚠️ 注意レベル: 🔴 高\n\nこの機能は以下のリスクがあります：\n- 認証情報の漏洩\n- 不正アクセス\n- 決済の不正操作\n\n専門家によるレビューを推奨します。\n```\n\n### VibeCoder 向け\n\n```markdown\n🔐 安全にログイン・決済機能を作るために\n\n1. **パスワードは「ハッシュ化」する**\n   - 元のパスワードを復元できない形で保存\n   - 万が一データが漏れても安全\n\n2. **カード情報はサーバーに保存しない**\n   - Stripe などの専用サービスに任せる\n   - 自分のサーバーには一切保存しない\n\n3. **エラーメッセージは曖昧に**\n   - 「パスワードが違います」ではなく「認証に失敗しました」\n   - 悪意ある人にヒントを与えない\n```\n",
        "skills/auth/references/authentication.md": "---\nname: auth\ndescription: \"認証機能の実装（Clerk / Supabase Auth 等）。ログイン機能を追加したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Auth Skill\n\nClerk または Supabase Auth を使用した認証機能を実装するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「ログイン機能を付けて」\n- 「認証を追加して」\n- 「Clerkで認証を実装して」\n- 「Supabase Authを設定して」\n- 「Googleログインを追加して」\n\n---\n\n## 機能\n\n- サインアップ/ログイン\n- ソーシャルログイン（Google, GitHub）\n- メール認証\n- パスワードリセット\n- ユーザープロフィール管理\n\n---\n\n## 実行フロー\n\n1. プロジェクト構成を確認\n2. Clerk または Supabase Auth を選択\n3. 必要なパッケージをインストール\n4. 認証設定ファイルを生成\n5. ログイン/サインアップUIを作成\n6. ミドルウェア/保護ルートを設定\n",
        "skills/auth/references/payments.md": "---\nname: payments\ndescription: \"決済機能の実装（Stripe）。サブスクや買い切り決済を追加したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Payments Skill\n\nStripeを使用した決済機能を実装するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「決済を付けたい」\n- 「Stripeを導入して」\n- 「サブスクを実装して」\n- 「買い切り決済を追加して」\n\n---\n\n## 機能\n\n- サブスクリプション（月額/年額）\n- 一回払い\n- Webhook（決済完了通知）\n- 顧客ポータル（プラン変更、キャンセル）\n\n---\n\n## 実行フロー\n\n1. プロジェクト構成を確認\n2. サブスク or 一回払いを選択\n3. Stripe SDKをインストール\n4. 決済ページを作成\n5. Webhookエンドポイントを設定\n6. 環境変数の設定をガイド\n",
        "skills/ci/SKILL.md": "---\nname: ci\ndescription: \"Diagnoses and fixes CI/CD pipeline failures. Use when user mentions CI failures, build errors, test failures, or pipeline issues. Do NOT load for: local builds, standard implementation work, reviews, or setup.\"\nallowed-tools: [\"Read\", \"Grep\", \"Bash\", \"Task\"]\ncontext: fork\n---\n\n# CI/CD Skills\n\nCI/CD パイプラインに関する問題を解決するスキル群です。\n\n---\n\n## 発動条件\n\n- 「CIが落ちた」「GitHub Actionsが失敗」\n- 「ビルドエラー」「テストが通らない」\n- 「パイプラインを直して」\n\n---\n\n## 機能詳細\n\n| 機能 | 詳細 | トリガー |\n|------|------|----------|\n| **失敗分析** | See [references/analyzing-failures.md](references/analyzing-failures.md) | 「ログを見て」「原因を調べて」 |\n| **テスト修正** | See [references/fixing-tests.md](references/fixing-tests.md) | 「テストを直して」「修正案を出して」 |\n\n---\n\n## 実行手順\n\n1. **テスト vs 実装判定**（Step 0）\n2. ユーザーの意図を分類（分析 or 修正）\n3. 複雑度を判定（下記参照）\n4. 上記の「機能詳細」から適切な参照ファイルを読む、または ci-cd-fixer サブエージェント起動\n5. 結果を確認し、必要に応じて再実行\n\n### Step 0: テスト vs 実装判定（品質判定ゲート）\n\nCI 失敗時、まず原因の切り分けを行う:\n\n```\nCI 失敗報告\n    ↓\n┌─────────────────────────────────────────┐\n│           テスト vs 実装判定             │\n├─────────────────────────────────────────┤\n│  エラーの原因を分析:                    │\n│  ├── 実装が間違い → 実装を修正          │\n│  ├── テストが古い → ユーザーに確認      │\n│  └── 環境問題 → 環境修正                │\n└─────────────────────────────────────────┘\n```\n\n#### 禁止事項（改ざん防止）\n\n```markdown\n⚠️ CI 失敗時の禁止事項\n\n以下の「解決策」は禁止です：\n\n| 禁止 | 例 | 正しい対応 |\n|------|-----|-----------|\n| テスト skip 化 | `it.skip(...)` | 実装を修正 |\n| アサーション削除 | `expect()` を消す | 期待値を確認 |\n| CI チェック迂回 | `continue-on-error` | 根本原因修正 |\n| lint ルール緩和 | `eslint-disable` | コードを修正 |\n```\n\n#### 判断フロー\n\n```markdown\n🔴 CI が失敗しています\n\n**判断が必要です**:\n\n1. **実装が間違い** → 実装を修正 ✅\n2. **テストの期待値が古い** → ユーザーに確認を求める\n3. **環境の問題** → 環境設定を修正\n\n⚠️ テストの改ざん（skip化、アサーション削除）は禁止です\n\nどれに該当しますか？\n```\n\n#### 承認が必要な場合\n\nテスト/設定の変更がやむを得ない場合:\n\n```markdown\n## 🚨 テスト/設定変更の承認リクエスト\n\n### 理由\n[なぜこの変更が必要か]\n\n### 変更内容\n[差分]\n\n### 代替案の検討\n- [ ] 実装の修正で解決できないか確認した\n\nユーザーの明示的な承認を待つ\n```\n\n## サブエージェント連携\n\n以下の条件を満たす場合、Task tool で ci-cd-fixer を起動:\n\n- 修正 → 再実行 → 失敗のループが **2回以上** 発生\n- または、エラーが複数ファイルにまたがる複雑なケース\n\n**起動パターン:**\n\n```\nTask tool:\n  subagent_type=\"ci-cd-fixer\"\n  prompt=\"CI失敗を診断・修正してください。エラーログ: {error_log}\"\n```\n\nci-cd-fixer は安全第一で動作（デフォルト dry-run モード）。\n詳細は `agents/ci-cd-fixer.md` を参照。\n\n---\n\n## VibeCoder 向け\n\n```markdown\n🔧 CI が壊れたときの言い方\n\n1. **「CI が落ちた」「赤くなった」**\n   - 自動テストが失敗している状態\n\n2. **「なんで失敗してるの？」**\n   - 原因を調べてほしい\n\n3. **「直して」**\n   - 自動で修正を試みる\n\n💡 重要: テストを「ごまかす」修正は禁止です\n   - ❌ テストを消す、スキップする\n   - ⭕ コードを正しく直す\n\n「テストが間違ってそう」と思ったら、\nまず確認してから対応を決めましょう\n```\n",
        "skills/ci/references/analyzing-failures.md": "---\nname: ci-analyze-failures\ndescription: \"CI の失敗ログを解析し、原因を特定する。CI/CDパイプラインでテストやビルドが失敗した場合に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Bash\"]\n---\n\n# CI Analyze Failures\n\nCI/CD パイプラインの失敗を分析し、原因を特定するスキル。\nGitHub Actions、GitLab CI 等のログを解釈します。\n\n---\n\n## 入力\n\n- **CI ログ**: 失敗したジョブのログ\n- **run_id**: CI 実行の識別子（あれば）\n- **リポジトリコンテキスト**: CI 設定ファイル\n\n---\n\n## 出力\n\n- **失敗原因の特定**: 具体的な原因\n- **修正提案**: 対処方法の提案\n\n---\n\n## 実行手順\n\n### Step 1: CI 状態の確認\n\n```bash\n# GitHub Actions の場合\ngh run list --limit 5\n\n# 最新の失敗を確認\ngh run view --log-failed\n```\n\n### Step 2: 失敗ログの取得\n\n```bash\n# 特定の run のログ\ngh run view {{run_id}} --log\n\n# 失敗ステップのみ\ngh run view {{run_id}} --log-failed\n```\n\n### Step 3: エラーパターンの分析\n\n#### ビルドエラー\n\n```\nパターン: \"error TS\\d+:\" または \"Build failed\"\n原因候補:\n- TypeScript 型エラー\n- 依存関係の不足\n- 構文エラー\n```\n\n#### テストエラー\n\n```\nパターン: \"FAIL\" または \"✕\" または \"AssertionError\"\n原因候補:\n- テストの失敗\n- テストタイムアウト\n- モックの不一致\n```\n\n#### 依存関係エラー\n\n```\nパターン: \"npm ERR!\" または \"Could not resolve\"\n原因候補:\n- package.json の不整合\n- プライベートパッケージの認証\n- バージョン競合\n```\n\n#### 環境エラー\n\n```\nパターン: \"not found\" または \"undefined\"\n原因候補:\n- 環境変数の未設定\n- シークレットの不足\n- パスの問題\n```\n\n### Step 4: 分析結果の出力\n\n```markdown\n## 🔍 CI 失敗分析\n\n**Run ID**: {{run_id}}\n**失敗時刻**: {{timestamp}}\n**失敗ステップ**: {{step_name}}\n\n### 原因特定\n\n**エラータイプ**: {{ビルド / テスト / 依存関係 / 環境}}\n\n**エラーメッセージ**:\n```\n{{エラーの核心部分}}\n```\n\n**原因分析**:\n{{具体的な原因の説明}}\n\n### 関連ファイル\n\n| ファイル | 関連性 |\n|---------|-------|\n| `{{path}}` | {{関連内容}} |\n\n### 修正提案\n\n1. {{具体的な修正手順1}}\n2. {{具体的な修正手順2}}\n\n### 自動修正の可否\n\n- 自動修正: {{可能 / 不可能}}\n- 理由: {{理由}}\n```\n\n---\n\n## エラーパターン辞書\n\n### TypeScript エラー\n\n| エラーコード | 意味 | 典型的な修正 |\n|-------------|------|-------------|\n| TS2304 | 名前が見つからない | import 追加 |\n| TS2322 | 型が一致しない | 型修正 |\n| TS2345 | 引数の型が違う | 引数修正 |\n| TS7006 | 暗黙の any | 型注釈追加 |\n\n### npm エラー\n\n| エラー | 意味 | 典型的な修正 |\n|--------|------|-------------|\n| ERESOLVE | 依存関係解決失敗 | package-lock 削除 & 再インストール |\n| ENOENT | ファイルが見つからない | パス確認 |\n| EACCES | 権限エラー | CI 設定確認 |\n\n### Jest/Vitest エラー\n\n| エラー | 意味 | 典型的な修正 |\n|--------|------|-------------|\n| Timeout | テストタイムアウト | タイムアウト延長 or 非同期修正 |\n| Snapshot | スナップショット不一致 | `npm test -- -u` |\n\n---\n\n## 複数エラーの優先順位\n\n1. **ビルドエラー**: 最優先で修正\n2. **依存関係エラー**: ビルド前に解決必要\n3. **テストエラー**: ビルド成功後に対応\n4. **Lint エラー**: 最後に対応\n\n---\n\n## 次のアクションへの接続\n\n分析完了後：\n\n> 📊 **分析完了**\n>\n> **原因**: {{原因の要約}}\n>\n> **次のアクション**:\n> - 「修正して」→ 自動修正を試行\n> - 「詳しく」→ さらに詳細な分析\n> - 「スキップ」→ 手動対応に切り替え\n\n---\n\n## 注意事項\n\n- **ログは大きい**: 重要部分を抽出\n- **連鎖エラー注意**: 最初のエラーを見つける\n- **環境差異**: ローカルと CI の違いを考慮\n",
        "skills/ci/references/fixing-tests.md": "---\nname: ci-fix-failing-tests\ndescription: \"CI で失敗したテストを修正するためのガイド。CI失敗の原因が特定された後、自動修正を試みる場合に使用します。\"\nallowed-tools: [\"Read\", \"Edit\", \"Bash\"]\n---\n\n# CI Fix Failing Tests\n\nCI で失敗したテストを修正するスキル。\nテストコードの修正、または本体コードの修正を行います。\n\n---\n\n## 入力\n\n- **失敗テスト情報**: テスト名、エラーメッセージ\n- **テストファイル**: 失敗したテストのソース\n- **テスト対象コード**: テスト対象の実装\n\n---\n\n## 出力\n\n- **修正されたコード**: テストまたは実装の修正\n- **テスト通過の確認**\n\n---\n\n## 実行手順\n\n### Step 1: 失敗テストの特定\n\n```bash\n# ローカルでテスト実行\nnpm test 2>&1 | tail -50\n\n# 特定ファイルのテスト\nnpm test -- {{test-file}}\n```\n\n### Step 2: エラータイプの分類\n\n#### タイプ A: アサーション失敗\n\n```\nExpected: \"expected value\"\nReceived: \"actual value\"\n```\n\n→ 実装が期待と異なる、またはテストの期待値が間違っている\n\n#### タイプ B: タイムアウト\n\n```\nTimeout - Async callback was not invoked within the 5000ms timeout\n```\n\n→ 非同期処理が完了しない、または時間がかかりすぎる\n\n#### タイプ C: 型エラー\n\n```\nTypeError: Cannot read properties of undefined\n```\n\n→ null/undefined のアクセス、または初期化の問題\n\n#### タイプ D: モック関連\n\n```\nexpected mockFn to have been called\n```\n\n→ モックの設定不足、または呼び出しが行われていない\n\n### Step 3: 修正戦略の決定\n\n```markdown\n## 修正方針判断\n\n1. **テストが正しい場合** → 実装を修正\n2. **実装が正しい場合** → テストを修正\n3. **両方修正が必要**   → 実装を優先\n\n判断基準:\n- 仕様・要件に照らしてどちらが正しいか\n- 最近の変更は何か\n- 他のテストへの影響\n```\n\n### Step 4: 修正の実装\n\n#### アサーション失敗の修正\n\n```typescript\n// テストの期待値が間違っている場合\nit('calculates correctly', () => {\n  // 修正前\n  expect(calculate(2, 3)).toBe(5)\n  // 修正後（仕様が掛け算の場合）\n  expect(calculate(2, 3)).toBe(6)\n})\n\n// 実装が間違っている場合\n// → 実装ファイルを修正\n```\n\n#### タイムアウトの修正\n\n```typescript\n// タイムアウトを延長\nit('fetches data', async () => {\n  // ...\n}, 10000)  // 10秒に延長\n\n// または async/await を正しく使用\nit('fetches data', async () => {\n  await waitFor(() => {\n    expect(screen.getByText('Data')).toBeInTheDocument()\n  })\n})\n```\n\n#### モック関連の修正\n\n```typescript\n// モックの設定を追加\nvi.mock('../api', () => ({\n  fetchData: vi.fn().mockResolvedValue({ data: 'mock' })\n}))\n\n// beforeEach でリセット\nbeforeEach(() => {\n  vi.clearAllMocks()\n})\n```\n\n### Step 5: 修正後の確認\n\n```bash\n# 失敗テストを再実行\nnpm test -- {{test-file}}\n\n# 全テスト実行（リグレッション確認）\nnpm test\n```\n\n---\n\n## 修正パターン集\n\n### スナップショット更新\n\n```bash\n# スナップショットの更新\nnpm test -- -u\n\n# 特定テストのみ\nnpm test -- {{test-file}} -u\n```\n\n### 非同期テストの修正\n\n```typescript\n// findBy を使用（自動待機）\nconst element = await screen.findByText('Text')\n\n// waitFor を使用\nawait waitFor(() => {\n  expect(mockFn).toHaveBeenCalled()\n})\n```\n\n### モックデータの更新\n\n```typescript\n// 実装の変更に合わせてモックを更新\nconst mockData = {\n  id: 1,\n  name: 'Test',\n  createdAt: new Date().toISOString()  // 新しいフィールド\n}\n```\n\n---\n\n## 修正後のチェックリスト\n\n- [ ] 失敗していたテストが通過する\n- [ ] 他のテストが壊れていない\n- [ ] 実装の意図と一致している\n- [ ] 過度に緩いテストになっていない\n\n---\n\n## 完了報告フォーマット\n\n```markdown\n## ✅ テスト修正完了\n\n### 修正内容\n\n| テスト | 問題 | 修正 |\n|-------|------|------|\n| `{{テスト名}}` | {{問題}} | {{修正内容}} |\n\n### 確認結果\n\n```\nTests: {{passed}} passed, {{total}} total\n```\n\n### 次のアクション\n\n「コミットして」または「CI を再実行して」\n```\n\n---\n\n## 注意事項\n\n- **テストを削除しない**: 削除は最終手段\n- **skip は一時的に**: 恒久的な skip は禁止\n- **ルートコーズを特定**: 表面的な修正を避ける\n",
        "skills/codex-review/SKILL.md": "---\nname: codex-review\ndescription: \"Integrates OpenAI Codex CLI as an MCP server to provide second-opinion reviews. Triggered by requests for Codex review, second opinion, or Codex setup. Do NOT load for: standard reviews without Codex, implementation work, or non-setup tasks.\"\nallowed-tools: [\"Bash\", \"Read\", \"Write\", \"Edit\"]\n---\n\n# Codex Review Integration Skill\n\nOpenAI Codex CLI を MCP サーバーとして Claude Code に統合し、コードレビュー時にセカンドオピニオンを提供するスキル。\n\n## 🎯 使用場面\n\n### セットアップ\n- **初回設定**: Codex CLI のインストール確認と MCP 登録\n- **認証設定**: Codex への OAuth / API キー認証\n\n### レビュー\n- **セカンドオピニオン**: Claude のレビュー結果に Codex の視点を追加\n- **コード品質チェック**: 複数 AI モデルの得意分野を活用\n- **設計レビュー**: アーキテクチャや実装パターンの多角的検証\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **MCP セットアップ** | See [references/codex-mcp-setup.md](references/codex-mcp-setup.md) |\n| **レビュー統合** | See [references/codex-review-integration.md](references/codex-review-integration.md) |\n| **4並列レビュー** | See [references/codex-parallel-review.md](references/codex-parallel-review.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って設定またはレビューを実行\n\n### ⚠️ 並列レビュー時の必須ルール\n\n**Codex モード（`review.mode: codex`）でのレビュー実行時**:\n\n1. **呼び出すエキスパートを判定**（全部ではなく必要なもののみ）:\n   - 設定で `enabled: false` → 除外\n   - CLI/バックエンド → Accessibility, SEO 除外\n   - ドキュメントのみ変更 → Quality, Architect, Plan Reviewer, Scope Analyst を優先（Security, Performance は除外可）\n2. 有効なエキスパートの `references/experts/*.md` から **プロンプトを個別に読み込む**\n3. 有効なエキスパートのみ **MCP 呼び出しを1つのレスポンス内で並列実行**\n4. 絶対に1回の呼び出しで複数観点をまとめない\n\n```\n✅ 正しい（Code Reviewの場合、4エキスパート）:\n   mcp__codex__codex({prompt: security-expert.md})\n   mcp__codex__codex({prompt: performance-expert.md})\n   mcp__codex__codex({prompt: quality-expert.md})\n   mcp__codex__codex({prompt: accessibility-expert.md})\n\n❌ 間違い:\n   mcp__codex__codex({prompt: \"セキュリティとパフォーマンスと品質をレビューして\"})\n```\n\n**詳細**: [references/codex-parallel-review.md](references/codex-parallel-review.md)\n\n---\n\n## 📋 利用可能な MCP ツール\n\nCodex MCP サーバーが登録されると、以下のツールが利用可能になります：\n\n| ツール | 用途 |\n|-------|------|\n| `mcp__codex__codex` | Codex にプロンプトを送信してレビューを依頼 |\n\n> **注**: このツール名は `codex mcp-server` の実装に依存します。\n\n---\n\n## 🔧 クイックスタート\n\n### 前提条件\n\n1. **Codex CLI がインストール済み**\n   ```bash\n   which codex  # パスが表示されること\n   ```\n\n2. **Codex にログイン済み**\n   ```bash\n   codex login status  # 認証済みであること\n   ```\n\n### セットアップコマンド\n\n```bash\n# Codex を MCP サーバーとして Claude Code に登録\nclaude mcp add --scope user codex -- codex mcp-server\n```\n\n### 動作確認\n\n```bash\n# MCP サーバー一覧を確認\nclaude mcp list\n```\n\n---\n\n## 🔄 レビューワークフロー\n\n### Solo モード\n\n```\n/harness-review 実行\n    │\n    ├── Claude レビュー（従来通り）\n    │\n    └── Codex MCP 呼び出し（有効時）\n            │\n            └── 結果統合\n```\n\n### 2-Agent モード\n\n```\nPM（Cursor / Codex）\n    │\n    └── タスク依頼\n            │\n            ├── Claude Code 実装\n            │\n            └── /harness-review\n                    │\n                    ├── Claude レビュー\n                    └── Codex セカンドオピニオン\n```\n\n---\n\n## ⚙️ 設定\n\n`.claude-code-harness.config.yaml` で Codex 統合を設定：\n\n```yaml\nreview:\n  codex:\n    enabled: true           # Codex セカンドオピニオン有効化\n    auto: false             # true: 自動実行 / false: 毎回確認\n    prompt: \"Review the code and output issues and improvement suggestions\"\n    # execution_mode: mcp   # Legacy: MCP (no progress display)\n```\n\n| 設定項目 | デフォルト | 説明 |\n|---------|-----------|------|\n| `enabled` | `false` | Codex 統合の有効/無効 |\n| `auto` | `false` | 自動レビュー実行 |\n| `prompt` | (上記) | Codex へのレビュープロンプト |\n| `execution_mode` | `exec` | 実行モード（`exec`: CLI直接 / `mcp`: レガシー）|\n\n> **Note**: 単発 `/codex-review` は `exec` (進捗表示あり)、並列エキスパートは常に `mcp` (Claude 組み込み並列機能)\n\n---\n\n## 💡 活用例\n\n### 例1: セットアップ\n\n```\nユーザー: 「Codex でもレビューできるようにして」\n\nClaude Code:\n→ codex-mcp-setup.md を読み込み\n→ Codex インストール確認\n→ MCP 登録実行\n→ 設定ファイル更新\n```\n\n### 例2: レビュー時\n\n```\nユーザー: 「セカンドオピニオンもらって」\n\nClaude Code:\n→ codex.enabled = true を確認\n→ MCP 経由で Codex にレビュー依頼\n→ 結果を統合して表示\n```\n\n---\n\n## ⚠️ 注意事項\n\n### パフォーマンス\n\n- Codex MCP 呼び出しには数秒〜数十秒かかる場合があります\n- 大規模ファイルの場合はチャンク分割が推奨\n\n### コスト\n\n- Codex API 利用には OpenAI のクレジットが必要です\n- レビュー頻度に応じたコスト見積もりを推奨\n\n### トラブルシューティング\n\n**問題**: Codex MCP が認識されない\n**解決策**:\n1. `claude mcp list` で登録確認\n2. `codex login status` で認証確認\n3. Claude Code を再起動\n\n**問題**: レビュー結果が返らない\n**解決策**:\n1. `codex mcp-server` が起動しているか確認\n2. ネットワーク接続を確認\n3. API クレジット残高を確認\n\n---\n\n## 📚 参考資料\n\n- [Codex CLI Reference](https://developers.openai.com/codex/cli/reference/)\n- [Claude Code MCP 設定](https://docs.anthropic.com/claude-code/mcp)\n- [Codex MCP 統合記事 (Qiita)](https://qiita.com/YasuhiroKawano/items/76d255b1fd97548dedc5)\n",
        "skills/codex-review/references/codex-mcp-setup.md": "---\nname: codex-mcp-setup\ndescription: \"Codex CLI の検出・MCP 登録・認証確認を行うセットアップ手順\"\nallowed-tools: [\"Bash\", \"Read\", \"Write\", \"Edit\"]\n---\n\n# Codex MCP セットアップ\n\nOpenAI Codex CLI を Claude Code の MCP サーバーとして登録するセットアップ手順。\n\n---\n\n## 🎯 このスキルでやること\n\n1. Codex CLI のインストール確認\n2. Codex 認証状態の確認\n3. MCP サーバーとしての登録\n4. 設定ファイルの更新\n5. 動作確認\n\n---\n\n## 実行フロー\n\n### Step 1: Codex CLI の確認\n\n```bash\n# Codex CLI が存在するか確認\nwhich codex\n```\n\n**結果判定**:\n\n| 結果 | 次のアクション |\n|------|---------------|\n| パスが表示される | Step 2 へ |\n| `not found` | インストール案内を表示 |\n\n**インストール案内（未インストール時）**:\n\n```markdown\n⚠️ Codex CLI がインストールされていません\n\nインストール方法:\n\n1. **Homebrew（macOS）**:\n   ```bash\n   brew install openai-codex\n   ```\n\n2. **npm（クロスプラットフォーム）**:\n   ```bash\n   npm install -g @openai/codex-cli\n   ```\n\n3. **公式ドキュメント**:\n   https://developers.openai.com/codex/cli/installation\n\nインストール後、再度このコマンドを実行してください。\n```\n\n---\n\n### Step 2: 認証状態の確認\n\n```bash\n# ログイン状態を確認\ncodex login status\n```\n\n**結果判定**:\n\n| 終了コード | 意味 | 次のアクション |\n|-----------|------|---------------|\n| 0 | ログイン済み | Step 3 へ |\n| 非0 | 未ログイン | 認証案内を表示 |\n\n**認証案内（未ログイン時）**:\n\n```markdown\n🔐 Codex にログインが必要です\n\nログイン方法:\n\n1. **OAuth（推奨）**:\n   ```bash\n   codex login\n   ```\n   ブラウザが開き、OpenAI アカウントで認証します。\n\n2. **API キー**:\n   ```bash\n   echo $OPENAI_API_KEY | codex login --with-api-key\n   ```\n   環境変数に設定済みの API キーを使用します。\n\nログイン後、再度このコマンドを実行してください。\n```\n\n---\n\n### Step 3: MCP サーバー登録\n\n```bash\n# Codex を MCP サーバーとして登録\nclaude mcp add --scope user codex -- codex mcp-server\n```\n\n**成功時の出力例**:\n\n```\nAdded MCP server: codex\nScope: user\nCommand: codex mcp-server\n```\n\n**エラー時の対応**:\n\n| エラー | 原因 | 対応 |\n|-------|------|------|\n| `Already exists` | 既に登録済み | Step 4 へ（スキップ可） |\n| `Command not found` | claude CLI がない | Claude Code を最新版に更新 |\n| `Permission denied` | 権限不足 | `--scope project` を試す |\n\n---\n\n### Step 4: 設定ファイル更新\n\n`.claude-code-harness.config.yaml` に Codex 設定を追加:\n\n```yaml\n# 追加する設定\nreview:\n  codex:\n    enabled: true\n    auto: false\n    prompt: \"日本語でコードレビューを行い、問題点と改善提案を出力してください\"\n```\n\n**設定項目の説明**:\n\n| 項目 | 型 | デフォルト | 説明 |\n|-----|-----|-----------|------|\n| `enabled` | boolean | `false` | Codex 統合を有効化 |\n| `auto` | boolean | `false` | `/harness-review` 時に自動で Codex を呼び出すか |\n| `prompt` | string | (上記) | Codex へ送信するレビュープロンプト |\n\n---\n\n### Step 5: 動作確認\n\n```bash\n# MCP サーバー一覧を確認\nclaude mcp list\n```\n\n**期待される出力**:\n\n```\ncodex (user)\n  Command: codex mcp-server\n  Status: Ready\n```\n\n**簡易テスト（オプション）**:\n\n```bash\n# Codex MCP が応答するか確認\ncodex exec --json \"Hello, this is a test\" 2>/dev/null | head -1\n```\n\n---\n\n## 完了メッセージ\n\nセットアップ完了時に表示:\n\n```markdown\n✅ Codex MCP セットアップ完了\n\n**設定内容**:\n- MCP サーバー: codex (user scope)\n- 自動レビュー: 無効（毎回確認）\n- プロンプト言語: 日本語\n\n**使い方**:\n- `/harness-review` 実行時に「Codex にもレビューさせますか？」と確認\n- `codex.auto: true` で自動実行に変更可能\n\n**次のアクション**:\n- `codex.enabled: true` を設定ファイルで確認\n- `/harness-review` でセカンドオピニオンを試す\n```\n\n---\n\n## トラブルシューティング\n\n### 問題: `claude mcp add` が失敗する\n\n**原因**: Claude Code のバージョンが古い\n\n**解決策**:\n```bash\n# Claude Code を更新\nclaude update\n\n# 再試行\nclaude mcp add --scope user codex -- codex mcp-server\n```\n\n### 問題: Codex MCP が応答しない\n\n**原因**: Codex CLI の問題\n\n**解決策**:\n```bash\n# Codex 単体で動作確認\ncodex exec \"Hello\" --output-last-message /tmp/test.txt\ncat /tmp/test.txt\n```\n\n### 問題: API エラーが発生する\n\n**原因**: OpenAI クレジット不足または API 制限\n\n**解決策**:\n1. OpenAI ダッシュボードでクレジット確認\n2. API 使用量制限を確認\n3. レート制限の場合は時間を置いて再試行\n\n---\n\n## 関連ドキュメント\n\n- [Codex CLI Reference](https://developers.openai.com/codex/cli/reference/)\n- [Claude Code MCP 公式ドキュメント](https://docs.anthropic.com/claude-code/mcp)\n- [codex-review-integration.md](./codex-review-integration.md) - レビュー統合手順\n",
        "skills/codex-review/references/codex-parallel-review.md": "# Codex 並列レビュー実行ガイド\n\nCodex モード時に複数のエキスパートを並列で呼び出すためのオーケストレーション手順。\n\n## 概要\n\nCodex モードでは、Claude がオーケストレーターとして **4 つのエキスパート** を MCP 経由で並列呼び出しします。レビュータイプに応じて異なるエキスパートが使用されます。\n\n## レビュータイプと4つのエキスパート\n\n| Review Type | 4 Experts | Expert Files |\n|-------------|-----------|--------------|\n| **Code** | Security, Performance, Quality, Accessibility | `security-expert.md`, `performance-expert.md`, `quality-expert.md`, `accessibility-expert.md` |\n| **Plan** | Clarity, Feasibility, Dependencies, Acceptance | `clarity-expert.md`, `feasibility-expert.md`, `dependencies-expert.md`, `acceptance-expert.md` |\n| **Scope** | Scope-creep, Priority, Feasibility, Impact | `scope-creep-expert.md`, `priority-expert.md`, `scope-feasibility-expert.md`, `impact-expert.md` |\n\n```\nClaude (オーケストレーター)\n    ↓\nレビュータイプ判定\n    ↓\n並列 MCP 呼び出し (4 experts)\n    ├── Expert 1\n    ├── Expert 2\n    ├── Expert 3\n    └── Expert 4\n    ↓\n結果統合 → 判定\n```\n\n---\n\n## ⚠️ 並列呼び出し必須ルール（MANDATORY）\n\n**このルールは絶対に守ること。違反した場合、レビュー品質が大幅に低下します。**\n\n### 禁止事項\n\n| 禁止 | 理由 |\n|------|------|\n| ❌ 1回の MCP 呼び出しで複数エキスパートをまとめる | 各エキスパートの専門性が薄まる |\n| ❌ 「セキュリティとパフォーマンスと品質を見て」と1回で依頼 | 観点が混在し、深い分析ができない |\n| ❌ experts/*.md を読まずに汎用プロンプトを送る | 専門家プロンプトの知見が活かされない |\n\n### 必須事項\n\n| 必須 | 方法 |\n|------|------|\n| ✅ 各エキスパートを **個別の MCP 呼び出し** で実行 | `mcp__codex__codex` をレビュータイプに応じて4回呼び出し |\n| ✅ experts/*.md から **個別にプロンプトを読み込む** | `security-expert.md` → Security 呼び出し → `performance-expert.md` → Performance 呼び出し... |\n| ✅ **1つのレスポンス内で4つの MCP 呼び出しを並列実行** | Claude の並列ツール呼び出し機能を使用 |\n\n### 正しい実行パターン\n\n```\n1. 設定とプロジェクト種別から有効なエキスパートを判定\n2. 有効なエキスパートのみ、1つのレスポンス内で同時に実行:\n\nmcp__codex__codex({prompt: security-expert.md の内容})\nmcp__codex__codex({prompt: performance-expert.md の内容})\nmcp__codex__codex({prompt: quality-expert.md の内容})\n... (有効なもののみ)\n\n→ 必要なエキスパートのみ並列実行\n→ 無関係な観点はスキップしてコスト削減\n```\n\n### なぜ分けるのか\n\n| 1回でまとめた場合 | 4回に分けた場合 |\n|------------------|-----------------|\n| 各観点が2-3行で浅い | 各観点が詳細に分析される |\n| 重要な問題を見落とす | 専門家視点で漏れなく検出 |\n| 「問題なし」で終わりやすい | 具体的な改善提案が出る |\n\n---\n\n## 実行フロー\n\n### Step 0: 残コンテキスト確認\n\nCodex 並列レビューの前に**残コンテキストが 30%以下なら /compact を実行**してください。\n\n> **注意**: /compact 後も余裕が少ない場合はそのまま Step 1 に進みます。\n\n### Step 1: 設定確認\n\n```yaml\n# .claude-code-harness.config.yaml から読み込み\nreview:\n  mode: codex\n  codex:\n    enabled: true\n    # Code Review experts (used when review type = code)\n    code_experts:\n      security: true\n      accessibility: true\n      performance: true\n      quality: true\n    # Plan Review experts (used when review type = plan)\n    plan_experts:\n      clarity: true\n      feasibility: true\n      dependencies: true\n      acceptance: true\n    # Scope Review experts (used when review type = scope)\n    scope_experts:\n      scope_creep: true\n      priority: true\n      feasibility: true\n      impact: true\n```\n\n> **Note**: Legacy 設定（`experts:` 直下）も後方互換性のためサポートしています。\n\n### Step 2: 変更ファイルの収集\n\n```bash\n# git diff で変更ファイルを取得\ngit diff --name-only HEAD~1\n```\n\n### Step 3: 呼び出すエキスパートの判定（フィルタリング）\n\n**全エキスパートを毎回呼ぶのではなく、必要なもののみ選択する。**\n\n#### 3.1 設定ベースのフィルタリング\n\n`.claude-code-harness.config.yaml` で `false` のエキスパートは除外:\n\n```yaml\nexperts:\n  security: true       # ✅ 呼び出す\n  accessibility: false # ❌ スキップ\n  performance: true    # ✅ 呼び出す\n  ...\n```\n\n#### 3.2 プロジェクト種別による自動除外\n\n| プロジェクト種別 | 自動除外するエキスパート |\n|-----------------|------------------------|\n| CLI / バックエンドAPI | Accessibility, SEO |\n| ライブラリ / SDK | Accessibility, SEO |\n| Webフロントエンド | （全て有効） |\n| モバイルアプリ | SEO |\n| 計画/レビューのみ | Security, Performance, Quality（コード変更なし時） |\n\n**判定方法**:\n```\n1. 変更ファイルのパスを確認:\n   - src/components/, pages/, app/ → Webフロントエンド → Accessibility, SEO 有効\n   - src/api/, server/, cli/ → バックエンド/CLI → Accessibility, SEO 除外\n   - *.md のみ → ドキュメント変更 → Quality, Architect, Plan Reviewer, Scope Analyst を優先\n\n2. package.json / pyproject.toml を確認:\n   - react, vue, next → Webフロントエンド\n   - express, fastify, flask → バックエンド\n   - commander, yargs → CLI\n```\n\n#### 3.3 変更内容による除外\n\n| 変更内容 | 優先するエキスパート | 除外可能 |\n|---------|---------------------|---------|\n| Plans.md のみ変更 | Plan Reviewer, Scope Analyst | Security, Performance, Quality, Accessibility, SEO, Architect |\n| テストファイルのみ変更 | Security, Quality, Performance | Architect, Plan Reviewer, Scope Analyst |\n| README / ドキュメントのみ | Quality, Architect, Plan Reviewer, Scope Analyst | Security, Performance, Accessibility |\n\n#### 3.4 最終的な呼び出しリスト決定\n\n```\nレビュータイプ判定 → 対応する4エキスパートを呼び出し\n\n例1: /work 後にコード変更あり → Code Review\n→ Security, Performance, Quality, Accessibility\n→ 4エキスパート並列\n\n例2: /plan-with-agent 後 → Plan Review\n→ Clarity, Feasibility, Dependencies, Acceptance\n→ 4エキスパート並列\n\n例3: タスク追加後 → Scope Review\n→ Scope-creep, Priority, Feasibility, Impact\n→ 4エキスパート並列\n```\n\n### Step 4: エキスパートプロンプトの準備\n\n**Step 3 で決定したエキスパートのみ**、`experts/*.md` からプロンプトを読み込み:\n- `{files}`: 変更ファイルリスト\n- `{tech_stack}`: 検出された技術スタック\n- `{plan_content}`: Plans.md の内容（Plan Reviewer 用）\n- `{requirements}`: 要件内容（Scope Analyst 用）\n\n### Step 5: 並列 MCP 呼び出し\n\n**実行モード**: 並列エキスパートは **MCP 固定**（Claude 組み込み並列機能を活用）\n\n> 単発 `/codex-review` は exec だが、並列は mcp の方がシェル管理不要で効率的\n\n**重要**: Step 3 で決定した有効なエキスパートのみ呼び出し\n\n```typescript\n// 並列呼び出しの概念コード\nconst enabledExperts = Object.entries(config.review.codex.experts)\n  .filter(([_, enabled]) => enabled)\n  .map(([name]) => name);\n\n// 並列実行\nconst results = await Promise.all(\n  enabledExperts.map(expert =>\n    mcp__codex__codex({\n      prompt: getPromptForExpert(expert, files, techStack),\n      sandbox: \"read-only\"\n    })\n  )\n);\n```\n\n### Step 5.1: 出力制限ルール（Context 溢れ防止）\n\n各エキスパートの応答は以下の制約に従う:\n\n**Code Review エキスパート**（security/performance/quality/accessibility-expert.md）:\n\n| 制約 | 内容 |\n|------|------|\n| 言語 | **English only**（トークン節約、Claude が統合時に日本語化） |\n| 最大文字数 | 1500 文字 |\n| スコア形式 | A-F |\n| 件数制限 | Critical/High: 全件、Medium/Low: 各3件まで |\n| 問題なし | `Score: A / No issues.` のみ |\n\n**Plan/Scope Review エキスパート**:\n\n| 制約 | 内容 |\n|------|------|\n| 言語 | **English only** |\n| 最大文字数 | 1500 文字 |\n| スコア形式 | X/10 |\n| 問題なし | `Score: 10/10 / No issues.` のみ |\n\n> **理由**: 4エキスパート並列でも 1500文字×4 = 6,000文字 ≒ 2,000トークン程度で収まる\n\n### Step 6: 結果統合\n\n各エキスパートからの結果を統合:\n\n```markdown\n## 📊 Codex 並列レビュー結果\n\n### エキスパート別サマリー\n\n| Expert | Score | Critical | High | Medium | Low |\n|--------|-------|----------|------|--------|-----|\n| Security | B | 0 | 1 | 2 | 3 |\n| Accessibility | A | 0 | 0 | 1 | 2 |\n| Performance | C | 0 | 2 | 3 | 1 |\n| Quality | B | 0 | 0 | 4 | 5 |\n| SEO | A | 0 | 0 | 0 | 2 |\n| Architect | B | 0 | 1 | 1 | 0 |\n| Plan Reviewer | APPROVE | - | - | - | - |\n| Scope Analyst | Proceed | - | - | - | - |\n\n### 統合 Findings\n\n| # | Expert | Severity | File | Issue |\n|---|--------|----------|------|-------|\n| 1 | Security | High | src/api/auth.ts:45 | SQL Injection |\n| 2 | Performance | High | src/api/posts.ts:23 | N+1 Query |\n| 3 | Architect | High | src/services/ | Circular dependency |\n```\n\n### Step 7: コミット判定\n\n統合結果から最終判定を算出:\n\n| 集計 | 判定 |\n|------|------|\n| Critical ≥ 1 | REJECT |\n| High ≥ 1 または Medium > 3 | REQUEST CHANGES |\n| それ以外 | APPROVE |\n\n## エラーハンドリング\n\n### 一部エキスパート失敗時\n\n```markdown\n⚠️ 一部のエキスパートでエラーが発生しました\n\n| Expert | Status |\n|--------|--------|\n| Security | ✅ 成功 |\n| Performance | ❌ タイムアウト |\n| Quality | ✅ 成功 |\n\n失敗したエキスパートをスキップして判定を続行しますか？\n```\n\n### 全エキスパート失敗時\n\n```markdown\n❌ Codex エキスパートとの通信に失敗しました\n\n原因: MCP サーバー接続エラー\n\nフォールバック: Claude 単体でレビューを実行しますか？\n```\n\n## 自動修正ループ\n\nREQUEST CHANGES 判定時の自動修正フロー:\n\n```\nREQUEST CHANGES 判定\n    ↓\n修正対象の抽出（High/Medium の Findings）\n    ↓\nClaude が修正実行\n    ↓\n再度 Codex 並列レビュー\n    │\n    ├── APPROVE → 完了\n    ├── REQUEST CHANGES → ループ（リトライ: ${current}/${max_retries}）\n    └── REJECT → 手動対応必要\n```\n\n### リトライ制限\n\n- デフォルト: 最大 3 回\n- 設定: `review.judgment.max_retries`\n\n### リトライ超過時\n\n```markdown\n## ⚠️ 自動修正上限に到達\n\n${max_retries} 回の自動修正を試みましたが、以下の問題が残っています:\n\n| # | Severity | File | Issue |\n|---|----------|------|-------|\n| 1 | High | src/api/users.ts | N+1 Query |\n\n**推奨アクション**:\n1. 手動で上記を修正\n2. 再度 `/harness-review` を実行\n```\n\n## 関連ファイル\n\n| ファイル | 役割 |\n|---------|------|\n| `experts/security-expert.md` | セキュリティエキスパートプロンプト |\n| `experts/accessibility-expert.md` | a11y エキスパートプロンプト |\n| `experts/performance-expert.md` | パフォーマンスエキスパートプロンプト |\n| `experts/quality-expert.md` | 品質エキスパートプロンプト |\n| `experts/seo-expert.md` | SEO エキスパートプロンプト |\n| `experts/architect-expert.md` | 設計エキスパートプロンプト |\n| `experts/plan-reviewer-expert.md` | 計画レビューエキスパートプロンプト |\n| `experts/scope-analyst-expert.md` | 要件分析エキスパートプロンプト |\n| `commit-judgment-logic.md` | コミット判定ロジック |\n",
        "skills/codex-review/references/codex-review-integration.md": "---\nname: codex-review-integration\ndescription: \"Codex MCP を使用したレビュー実行手順\"\nallowed-tools: [\"Read\", \"Bash\"]\n---\n\n# Codex レビュー実行\n\nCodex MCP を使用してコードレビューを実行する手順。\n\n---\n\n## 🎯 概要\n\nCodex MCP が設定済みの場合、以下の方法でレビューを実行できます：\n\n1. **`/harness-review` 経由**: 自動的に Codex 統合\n2. **直接呼び出し**: MCP ツールを直接使用\n\n---\n\n## 実行方法\n\n### 方法1: /harness-review 経由（推奨）\n\n```\nユーザー: /harness-review\n    ↓\nharness-review スキル起動\n    ↓\ncodex.enabled 確認 → true\n    ↓\nClaude + Codex 並列レビュー\n    ↓\n結果統合\n```\n\n### 方法2: 直接呼び出し\n\n```bash\n# MCP ツールを直接呼び出し（スキル内から）\nmcp__codex__* を使用\n\n# または Codex CLI を直接実行\ncodex exec --json \"以下のコードをレビューしてください: ...\"\n```\n\n---\n\n## レビュープロンプト\n\n### デフォルトプロンプト\n\n```\n日本語でコードレビューを行い、問題点と改善提案を出力してください\n```\n\n### カスタマイズ例\n\n**セキュリティ重視**:\n```yaml\nreview:\n  codex:\n    prompt: |\n      以下の観点でセキュリティレビューを行ってください：\n      1. 入力検証の不備\n      2. 認証・認可の問題\n      3. インジェクション脆弱性\n      4. 機密情報の露出\n      日本語で回答してください。\n```\n\n**パフォーマンス重視**:\n```yaml\nreview:\n  codex:\n    prompt: |\n      以下の観点でパフォーマンスレビューを行ってください：\n      1. N+1クエリ\n      2. 不要な再レンダリング\n      3. メモリリーク\n      4. 非効率なアルゴリズム\n      日本語で回答してください。\n```\n\n---\n\n## レビュー結果の形式\n\n### Codex からの出力例\n\n```json\n{\n  \"review\": {\n    \"summary\": \"3件の改善提案があります\",\n    \"issues\": [\n      {\n        \"file\": \"src/api/users.ts\",\n        \"line\": 45,\n        \"severity\": \"high\",\n        \"message\": \"SQL インジェクションの可能性\"\n      },\n      {\n        \"file\": \"src/components/Form.tsx\",\n        \"line\": 12,\n        \"severity\": \"medium\",\n        \"message\": \"useEffect の依存配列が不完全\"\n      }\n    ],\n    \"suggestions\": [\n      \"関数を分割して可読性を向上\",\n      \"型定義を厳密化\"\n    ]\n  }\n}\n```\n\n### 統合フォーマット\n\n```markdown\n## 🤖 Codex レビュー結果\n\n**サマリ**: 3件の改善提案\n\n### 問題点\n\n| ファイル | 行 | 重要度 | 内容 |\n|---------|-----|--------|------|\n| src/api/users.ts | 45 | 高 | SQL インジェクションの可能性 |\n| src/components/Form.tsx | 12 | 中 | useEffect の依存配列が不完全 |\n\n### 改善提案\n\n1. 関数を分割して可読性を向上\n2. 型定義を厳密化\n```\n\n---\n\n## エラーハンドリング\n\n### タイムアウト\n\n```markdown\n⚠️ Codex レビューがタイムアウトしました（60秒）\n\n原因として考えられること:\n- ファイルサイズが大きい\n- Codex API が混雑している\n- ネットワーク遅延\n\n対応:\n- 変更ファイルを絞り込んで再試行\n- 時間を置いて再実行\n```\n\n### API エラー\n\n```markdown\n⚠️ Codex API エラー\n\nエラーコード: 429 (Rate Limited)\n\n対応:\n- 少し時間を置いて再試行してください\n- API 使用量を確認してください\n```\n\n---\n\n## ベストプラクティス\n\n### 効果的なレビューのために\n\n1. **対象を絞る**: 大量のファイルより重要なファイルに集中\n2. **観点を明確に**: プロンプトでレビュー観点を指定\n3. **結果を比較**: Claude と Codex の指摘を比較して優先度判断\n\n### 避けるべきこと\n\n1. **全ファイル一括**: 大規模プロジェクトで全ファイルは非効率\n2. **プロンプトなし**: デフォルトプロンプトは汎用的すぎる場合あり\n3. **結果の盲信**: AI の指摘は参考情報、最終判断は人間\n\n---\n\n## 関連ドキュメント\n\n- [codex-mcp-setup.md](./codex-mcp-setup.md) - セットアップ手順\n- [harness-review/SKILL.md](../../harness-review/SKILL.md) - レビュースキル\n- [harness-review/references/codex-integration.md](../../harness-review/references/codex-integration.md) - レビューへの統合\n",
        "skills/codex-review/references/experts/acceptance-expert.md": "# Acceptance Criteria Expert - Plan Review\n\nYou are an **Acceptance Criteria Expert** specializing in evaluating whether plans have clear, testable acceptance criteria.\n\n## Review Focus\n\nEvaluate the plan for:\n\n1. **Completeness**\n   - Does every task have acceptance criteria?\n   - Are edge cases covered?\n   - Are error scenarios addressed?\n\n2. **Testability**\n   - Are criteria measurable?\n   - Can they be verified objectively?\n   - Are there clear pass/fail conditions?\n\n3. **User Perspective**\n   - Do criteria reflect user needs?\n   - Are user stories properly defined?\n   - Is the \"definition of done\" clear?\n\n4. **Quality Gates**\n   - Performance requirements\n   - Security requirements\n   - Accessibility requirements\n\n## Output Format\n\n```markdown\n## ✅ Acceptance Criteria Review\n\n### Score: X/10\n\n### Coverage Analysis\n\n| Area | Has Criteria | Testable | Complete |\n|------|-------------|----------|----------|\n| Core features | ✅/❌ | ✅/❌ | ✅/❌ |\n| Edge cases | ✅/❌ | ✅/❌ | ✅/❌ |\n| Error handling | ✅/❌ | ✅/❌ | ✅/❌ |\n| Performance | ✅/❌ | ✅/❌ | ✅/❌ |\n\n### Missing Criteria\n\n#### Critical (must add)\n- [ ] [Task/Feature] - needs criteria for [what]\n- [ ] [Task/Feature] - needs criteria for [what]\n\n#### Recommended (should add)\n- [ ] [Task/Feature] - would benefit from [criteria type]\n\n### Vague Criteria Found\n\n| Current | Issue | Suggested |\n|---------|-------|-----------|\n| \"Works well\" | Not measurable | \"Response time < 200ms\" |\n| \"User-friendly\" | Subjective | \"Passes WCAG 2.1 AA\" |\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "skills/codex-review/references/experts/accessibility-expert.md": "# Accessibility Expert Prompt for Codex\n\nCodex MCP に送信するアクセシビリティレビュー用プロンプト。\n\n## 7-Section Format\n\n### TASK\n\nWeb アクセシビリティ（a11y）を分析し、WCAG 2.1 AA ガイドラインへの準拠を確認してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で a11y 問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- WCAG 基準への参照\n- 修正案\n- a11y スコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- フレームワーク: {tech_stack}\n- 対象: UI コンポーネント、フォーム、画像、ナビゲーション\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- WCAG 2.1 AA baseline\n- Consider framework-specific patterns (React/Vue/Svelte)\n\n### MUST DO\n\n1. **セマンティック HTML**: 見出し構造、ランドマーク、ボタン vs div\n2. **画像・メディア**: alt 属性、装飾画像、動画キャプション\n3. **フォーム**: ラベル、エラーメッセージ、必須フィールド\n4. **キーボード**: フォーカス管理、トラップ防止、ESC 対応\n5. **ARIA**: 冗長な ARIA 削除、動的コンテンツの aria-live\n\n### MUST NOT DO\n\n- 非 UI ファイル（API、ユーティリティ）を a11y 対象にしない\n- 装飾画像に意味のある alt を要求しない\n- aria-hidden の正しい使用を問題として報告しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Accessibility Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | File | Line | Issue | WCAG | Fix |\n|---|----------|------|------|-------|------|-----|\n| 1 | High | components/Button.tsx | 12 | div used as button | 4.1.2 | Use <button> element |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "skills/codex-review/references/experts/architect-expert.md": "# Architect Expert Prompt for Codex\n\nCodex MCP に送信する設計レビュー用プロンプト。\n> claude-delegator を参考に設計\n\n## 7-Section Format\n\n### TASK\n\nシステム設計、アーキテクチャ判断、技術的トレードオフを分析し、設計上の問題や改善機会を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で設計問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- トレードオフ分析\n- 推奨アプローチ\n- 設計スコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- 技術スタック: {tech_stack}\n- 対象: アーキテクチャ、設計パターン、スケーラビリティ\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Avoid premature over-abstraction\n- Base decisions on actual requirements\n\n### MUST DO\n\n1. **システム設計**:\n   - モジュール境界の適切さ\n   - 依存関係の方向\n   - 責務の分離\n\n2. **スケーラビリティ**:\n   - ボトルネックになりうる箇所\n   - 水平/垂直スケーリングの考慮\n   - キャッシュ戦略\n\n3. **保守性**:\n   - 変更容易性\n   - テスタビリティ\n   - デバッグ容易性\n\n4. **トレードオフ分析**:\n   - 複雑さ vs 柔軟性\n   - パフォーマンス vs 可読性\n   - DRY vs 明示性\n\n### MUST NOT DO\n\n- 「将来のため」だけの抽象化を推奨しない\n- 単一用途の過度なパターン適用を推奨しない\n- 既存のうまく動いている設計を不必要に変更しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Architecture Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | Area | Issue | Recommendation |\n|---|----------|------|-------|----------------|\n| 1 | High | Module Design | Circular dependency | Introduce interface layer |\n\n### Tradeoff Analysis\n\n- **Current**: [Current approach and its pros/cons]\n- **Recommended**: [Recommended approach and why]\n- **Effort**: Quick/Short/Medium/Large\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "skills/codex-review/references/experts/clarity-expert.md": "# Clarity Expert - Plan Review\n\nYou are a **Clarity Expert** specializing in evaluating the clarity and understandability of implementation plans.\n\n## Review Focus\n\nEvaluate the plan for:\n\n1. **Goal Clarity**\n   - Is the objective clearly stated?\n   - Are success criteria defined?\n   - Is the scope well-bounded?\n\n2. **Task Clarity**\n   - Are tasks specific and actionable?\n   - Are dependencies between tasks clear?\n   - Are deliverables for each task defined?\n\n3. **Communication Clarity**\n   - Is terminology consistent?\n   - Are technical terms explained when needed?\n   - Can a new team member understand this?\n\n4. **Ambiguity Detection**\n   - Identify vague phrases (\"as needed\", \"if possible\", \"later\")\n   - Flag undefined terms or acronyms\n   - Note missing context or assumptions\n\n## Output Format\n\n```markdown\n## 📝 Clarity Review\n\n### Score: X/10\n\n### Strengths\n- [Clear aspect 1]\n- [Clear aspect 2]\n\n### Issues Found\n\n#### Critical (blocks understanding)\n- [ ] [Issue description]\n  - Location: [where in plan]\n  - Suggestion: [how to clarify]\n\n#### Minor (could be clearer)\n- [ ] [Issue description]\n  - Suggestion: [improvement]\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "skills/codex-review/references/experts/dependencies-expert.md": "# Dependencies Expert - Plan Review\n\nYou are a **Dependencies Expert** specializing in analyzing task dependencies and execution order in implementation plans.\n\n## Review Focus\n\nEvaluate the plan for:\n\n1. **Task Dependencies**\n   - Are dependencies explicitly stated?\n   - Is the execution order logical?\n   - Are there circular dependencies?\n\n2. **External Dependencies**\n   - Third-party services/APIs\n   - Team/stakeholder approvals\n   - Infrastructure requirements\n\n3. **Dependency Graph**\n   - Critical path identification\n   - Parallel execution opportunities\n   - Bottleneck detection\n\n4. **Dependency Risks**\n   - Single points of failure\n   - Unstable dependencies\n   - Version conflicts\n\n## Output Format\n\n```markdown\n## 🔗 Dependencies Review\n\n### Score: X/10\n\n### Dependency Map\n\n```\n[Task A] ──→ [Task B] ──→ [Task C]\n    │                        ↑\n    └──→ [Task D] ──────────┘\n```\n\n### Critical Path\n1. [Task X] → [Task Y] → [Task Z]\n   - Total estimated time: [X hours/days]\n\n### Issues Found\n\n#### Blocking Issues\n- [ ] [Issue description]\n  - Blocked tasks: [list]\n  - Resolution: [suggestion]\n\n#### Optimization Opportunities\n- [ ] [Tasks that could run in parallel]\n- [ ] [Dependencies that could be removed]\n\n### External Dependencies\n\n| Dependency | Type | Status | Risk |\n|------------|------|--------|------|\n| [Name] | API/Service/Team | ✅/⚠️/❌ | Low/Med/High |\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "skills/codex-review/references/experts/feasibility-expert.md": "# Feasibility Expert - Plan Review\n\nYou are a **Feasibility Expert** specializing in evaluating whether implementation plans are technically and practically achievable.\n\n## Review Focus\n\nEvaluate the plan for:\n\n1. **Technical Feasibility**\n   - Are the proposed technologies appropriate?\n   - Are there known limitations or constraints?\n   - Is the technical approach sound?\n\n2. **Resource Feasibility**\n   - Are skill requirements realistic?\n   - Are tools/infrastructure available?\n   - Are external dependencies accessible?\n\n3. **Time Feasibility**\n   - Are estimates reasonable?\n   - Are buffer times included?\n   - Are parallel vs sequential tasks properly planned?\n\n4. **Risk Assessment**\n   - What could go wrong?\n   - Are there fallback options?\n   - What are the critical path items?\n\n## Output Format\n\n```markdown\n## 🔧 Feasibility Review\n\n### Score: X/10\n\n### Feasibility Assessment\n\n| Aspect | Status | Notes |\n|--------|--------|-------|\n| Technical | ✅/⚠️/❌ | [Brief note] |\n| Resources | ✅/⚠️/❌ | [Brief note] |\n| Timeline | ✅/⚠️/❌ | [Brief note] |\n\n### Risks Identified\n\n#### High Risk\n- [ ] [Risk description]\n  - Impact: [what happens if it occurs]\n  - Mitigation: [suggested approach]\n\n#### Medium Risk\n- [ ] [Risk description]\n  - Mitigation: [suggested approach]\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "skills/codex-review/references/experts/impact-expert.md": "# Impact Expert - Scope Review\n\nYou are an **Impact Expert** specializing in analyzing the impact of scope changes on existing systems and processes.\n\n## Review Focus\n\nEvaluate impact for:\n\n1. **System Impact**\n   - Existing code changes required\n   - Database migrations\n   - API breaking changes\n   - Performance implications\n\n2. **User Impact**\n   - UX changes\n   - Learning curve\n   - Migration requirements\n   - Backward compatibility\n\n3. **Team Impact**\n   - Knowledge requirements\n   - Process changes\n   - Documentation needs\n   - Training requirements\n\n4. **Business Impact**\n   - Revenue implications\n   - Customer satisfaction\n   - Competitive position\n   - Compliance requirements\n\n## Output Format\n\n```markdown\n## 💥 Impact Review\n\n### Score: X/10 (10 = low impact, manageable)\n\n### Impact Summary\n\n| Area | Impact Level | Details |\n|------|-------------|---------|\n| System | Low/Med/High | [brief] |\n| Users | Low/Med/High | [brief] |\n| Team | Low/Med/High | [brief] |\n| Business | Low/Med/High | [brief] |\n\n### Detailed Impact Analysis\n\n#### High Impact Items\n- [ ] [Change/Feature]\n  - Affects: [what systems/users]\n  - Impact: [what happens]\n  - Mitigation: [how to reduce impact]\n\n#### Medium Impact Items\n- [ ] [Change/Feature]\n  - Affects: [what]\n  - Mitigation: [suggestion]\n\n### Breaking Changes\n| Change | Affected | Migration Path |\n|--------|----------|----------------|\n| [Change] | [Who/What] | [How to migrate] |\n\n### Ripple Effects\n```\n[Change A] ──→ [Effect on B]\n              ──→ [Effect on C]\n                  ──→ [Effect on D]\n```\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n\n### Communication Plan\n- [ ] Notify [stakeholder] about [impact]\n- [ ] Update [documentation] for [change]\n- [ ] Train [team] on [new process]\n```\n",
        "skills/codex-review/references/experts/performance-expert.md": "# Performance Expert Prompt for Codex\n\nCodex MCP に送信するパフォーマンスレビュー用プロンプト。\n\n## 7-Section Format\n\n### TASK\n\nコードのパフォーマンス問題を分析し、非効率なパターン、ボトルネック、最適化の機会を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式でパフォーマンス問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- 改善案と期待効果\n- パフォーマンススコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- 技術スタック: {tech_stack}\n- 対象: レンダリング、DB クエリ、アルゴリズム、メモリ\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Avoid premature optimization, focus on real bottlenecks\n- Show measurable improvement impact\n\n### MUST DO\n\n1. **フロントエンド**:\n   - 不要な再レンダリング（useCallback/useMemo 未使用）\n   - 大きなリストの非仮想化\n   - 重い計算の同期実行\n   - バンドルサイズ（大きな依存関係）\n\n2. **バックエンド**:\n   - N+1 クエリ問題\n   - インデックス未使用\n   - 同期 I/O のブロッキング\n   - キャッシュ未使用\n\n3. **一般**:\n   - O(n²) 以上のアルゴリズム\n   - ループ内での文字列連結\n   - 正規表現の毎回コンパイル\n\n### MUST NOT DO\n\n- 可読性を大幅に犠牲にする最適化を推奨しない\n- マイクロ最適化（影響 < 1ms）を Critical として報告しない\n- 測定せずに「遅い」と断定しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Performance Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | File | Line | Issue | Impact | Fix |\n|---|----------|------|------|-------|--------|-----|\n| 1 | High | api/posts.ts | 23 | N+1 query | ~100ms per request | Use include/prefetch |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "skills/codex-review/references/experts/plan-reviewer-expert.md": "# Plan Reviewer Expert Prompt for Codex\n\nCodex MCP に送信する計画レビュー用プロンプト。\n> claude-delegator を参考に設計\n\n## 7-Section Format\n\n### TASK\n\n作業計画（Plans.md）を分析し、実装をブロックする可能性のあるギャップ、曖昧さ、不足コンテキストを検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で計画の問題を報告:\n- **[APPROVE / REJECT]** の判定\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- 改善提案\n- 計画スコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 計画ファイル: {plan_content}\n- 対象: タスク定義、受入条件、依存関係、コンテキスト\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Evaluate from \"can this actually be implemented?\" perspective\n- Avoid overly strict criteria\n\n### MUST DO\n\n1. **作業内容の明確さ**:\n   - 各タスクが WHERE（どこを見ればよいか）を指定しているか\n   - 参照資料で 90%+ の確信が得られるか\n\n2. **検証・受入条件**:\n   - 完了を確認する具体的な方法があるか\n   - 受入条件が測定可能/観察可能か\n\n3. **コンテキスト完全性**:\n   - 10% 以上の不確実性を引き起こす欠落情報はないか\n   - 暗黙の前提が明示されているか\n\n4. **全体像・ワークフロー**:\n   - 目的が明確か\n   - タスク間の依存関係が定義されているか\n   - 「完了」の定義があるか\n\n### MUST NOT DO\n\n- 単純な 1 タスクの計画を過度に批判しない\n- 明らかなコンテキストの再説明を要求しない\n- 参照ファイルが存在する場合に「詳細がない」と判定しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Plan Review Results\n\n**Verdict**: [APPROVE / REJECT]\n\n**Score**: [A-F]\n\n### Evaluation Summary\n\n| Criteria | Assessment |\n|----------|------------|\n| Clarity | [Brief assessment] |\n| Verifiability | [Brief assessment] |\n| Completeness | [Brief assessment] |\n| Big Picture | [Brief assessment] |\n\n### Findings (if REJECT)\n\n| # | Severity | Area | Issue | Suggestion |\n|---|----------|------|-------|------------|\n| 1 | High | Task Definition | Missing reference file | Add link to existing implementation |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "skills/codex-review/references/experts/priority-expert.md": "# Priority Expert - Scope Review\n\nYou are a **Priority Expert** specializing in evaluating task prioritization and execution order.\n\n## Review Focus\n\nEvaluate prioritization for:\n\n1. **Business Value Alignment**\n   - Are high-value items prioritized?\n   - Is MVP clearly defined?\n   - Are quick wins identified?\n\n2. **Technical Dependencies**\n   - Are foundational tasks first?\n   - Are blockers addressed early?\n   - Is the critical path optimized?\n\n3. **Risk-Based Prioritization**\n   - Are risky items tackled early?\n   - Is there time for pivoting if needed?\n   - Are unknowns explored early?\n\n4. **Priority Conflicts**\n   - Competing priorities\n   - Resource contention\n   - Deadline pressure points\n\n## Output Format\n\n```markdown\n## 📊 Priority Review\n\n### Score: X/10\n\n### Priority Matrix\n\n| Priority | Task Count | % of Total |\n|----------|-----------|------------|\n| P0 (Critical) | X | X% |\n| P1 (High) | X | X% |\n| P2 (Medium) | X | X% |\n| P3 (Low) | X | X% |\n\n### Priority Issues\n\n#### Misprioritzed Items\n- [ ] [Task] - Currently P[X], should be P[Y]\n  - Reason: [why priority is wrong]\n\n#### Missing Priorities\n- [ ] [Task] - needs explicit priority assignment\n\n### Recommended Execution Order\n\n1. **Phase 1 (MVP)**\n   - [Task A] - [reason]\n   - [Task B] - [reason]\n\n2. **Phase 2 (Enhancement)**\n   - [Task C] - [reason]\n   - [Task D] - [reason]\n\n3. **Phase 3 (Nice to have)**\n   - [Task E] - [reason]\n\n### Quick Wins (high value, low effort)\n- [ ] [Task] - can be done in [X hours]\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "skills/codex-review/references/experts/quality-expert.md": "# Quality Expert Prompt for Codex\n\nCodex MCP に送信するコード品質レビュー用プロンプト。\n\n## 7-Section Format\n\n### TASK\n\nコードの品質（可読性、保守性、ベストプラクティス）を分析し、改善が必要な箇所を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で品質問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- 具体的な改善案\n- 品質スコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- 技術スタック: {tech_stack}\n- 対象: 命名、構造、重複、エラーハンドリング\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Respect existing project style\n- Avoid excessive improvement suggestions\n\n### MUST DO\n\n1. **可読性**:\n   - 曖昧な命名（x, tmp, data）\n   - 長すぎる関数（50行以上）\n   - 深いネスト（4段階以上）\n   - マジックナンバー\n\n2. **保守性**:\n   - 重複コード\n   - 密結合\n   - グローバル状態の多用\n   - 未使用コード\n\n3. **ベストプラクティス**:\n   - 空の catch ブロック\n   - any 型の多用\n   - コールバック地獄\n   - テストしにくい構造\n\n4. **クロスプラットフォーム**:\n   - レスポンシブ未対応\n   - 100vw によるスクロールバー問題\n   - 小さすぎるタッチターゲット\n\n### MUST NOT DO\n\n- スタイル/フォーマットの問題を High/Critical として報告しない\n- 自動生成コードの品質を問題視しない\n- テストファイル内の重複を DRY 違反として報告しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Quality Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | File | Line | Issue | Fix |\n|---|----------|------|------|-------|-----|\n| 1 | Medium | services/user.ts | 45 | Function too long (78 lines) | Split into smaller functions |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "skills/codex-review/references/experts/scope-analyst-expert.md": "# Scope Analyst Expert Prompt for Codex\n\nCodex MCP に送信する要件分析用プロンプト。\n> claude-delegator を参考に設計\n\n## 7-Section Format\n\n### TASK\n\n要件・リクエストを分析し、計画開始前に曖昧さ、隠れた要件、潜在的な問題を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で要件の問題を報告:\n- インテント分類\n- 発見事項リスト\n- 確認が必要な質問\n- リスクと軽減策\n- 推奨アクション\n\n### CONTEXT\n\n分析対象:\n- 要件/リクエスト: {requirements}\n- 対象: 曖昧さ、隠れた要件、依存関係、リスク\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Focus on real problems\n- Avoid over-analysis\n\n### MUST DO\n\n1. **インテント分類**:\n\n| タイプ | フォーカス | 主な質問 |\n|--------|----------|----------|\n| リファクタリング | 安全性 | 何が壊れる？テストカバレッジは？ |\n| 新規構築 | 発見 | 類似パターンは？未知の要素は？ |\n| 中規模タスク | ガードレール | スコープ内/外は？ |\n| アーキテクチャ | 戦略 | トレードオフは？2年後の視点は？ |\n| バグ修正 | 根本原因 | 本当のバグ vs 症状は？影響範囲は？ |\n| 調査 | 終了条件 | 答えるべき質問は？いつ止めるか？ |\n\n2. **分析項目**:\n   - **隠れた要件**: 暗黙の前提、ビジネスコンテキスト、エッジケース\n   - **曖昧さ**: 複数解釈、未決定事項、実装者による差異\n   - **依存関係**: 既存コード、必要な前提条件、破壊リスク\n   - **リスク**: 失敗時の影響、ロールバック計画\n\n3. **アンチパターン検出**:\n   - 過剰設計: 「将来のため」だけの抽象化\n   - スコープクリープ: 「ついでに」の変更\n   - 曖昧シグナル: 「簡単なはず」「X のように」\n\n### MUST NOT DO\n\n- 明確で小さなタスクに過度な分析を適用しない\n- 存在しないリスクを作り出さない\n- 確認済みの前提を再質問しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Scope Analysis Results\n\n**Intent Classification**: [Type] - [One sentence why]\n\n### Pre-Analysis Findings\n\n- [Key finding 1]\n- [Key finding 2]\n- [Key finding 3]\n\n### Questions for Requester (if ambiguities exist)\n\n1. [Specific question]\n2. [Specific question]\n\n### Identified Risks\n\n| Risk | Severity | Mitigation |\n|------|----------|------------|\n| [Risk 1] | High | [Mitigation] |\n\n### Recommendation\n\n[Proceed / Clarify First / Reconsider Scope]\n\n### Severity Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "skills/codex-review/references/experts/scope-creep-expert.md": "# Scope Creep Expert - Scope Review\n\nYou are a **Scope Creep Expert** specializing in detecting and preventing scope creep in project plans.\n\n## Review Focus\n\nEvaluate for scope creep indicators:\n\n1. **Original vs Current Scope**\n   - Compare initial requirements with current tasks\n   - Identify additions that weren't in original plan\n   - Flag \"nice to have\" items mixed with \"must have\"\n\n2. **Feature Creep Patterns**\n   - \"While we're at it...\" additions\n   - Gold plating (over-engineering)\n   - Premature optimization\n   - Unnecessary abstractions\n\n3. **Requirement Inflation**\n   - Expanded acceptance criteria\n   - Additional edge cases beyond requirements\n   - Scope expansion disguised as clarification\n\n4. **Red Flags**\n   - Tasks unrelated to core objective\n   - Dependencies on future features\n   - \"Improvements\" not in original spec\n\n## Output Format\n\n```markdown\n## 🎯 Scope Creep Review\n\n### Score: X/10 (10 = no scope creep)\n\n### Scope Analysis\n\n| Category | Original | Current | Δ |\n|----------|----------|---------|---|\n| Core tasks | X | Y | +Z |\n| Features | X | Y | +Z |\n| Integrations | X | Y | +Z |\n\n### Scope Creep Detected\n\n#### Definite Scope Creep\n- [ ] [Task/Feature]\n  - Original requirement: [what was asked]\n  - Current scope: [what's being done]\n  - Recommendation: Remove or defer\n\n#### Potential Scope Creep\n- [ ] [Task/Feature]\n  - Concern: [why it might be scope creep]\n  - Recommendation: Verify with stakeholder\n\n### Items to Defer (not scope creep, but can wait)\n- [ ] [Task] - can be done in phase 2\n- [ ] [Feature] - nice to have, not blocking\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "skills/codex-review/references/experts/scope-feasibility-expert.md": "# Scope Feasibility Expert - Scope Review\n\nYou are a **Scope Feasibility Expert** specializing in evaluating whether the defined scope is achievable within constraints.\n\n## Review Focus\n\nEvaluate scope feasibility for:\n\n1. **Time Constraints**\n   - Can scope be completed in available time?\n   - Are estimates realistic?\n   - Is there buffer for unknowns?\n\n2. **Resource Constraints**\n   - Skills available vs required\n   - Team capacity\n   - Tool/infrastructure availability\n\n3. **Scope-Time Balance**\n   - Is scope matched to timeline?\n   - What can be cut if needed?\n   - What's the minimum viable scope?\n\n4. **Constraint Violations**\n   - Impossible combinations\n   - Conflicting requirements\n   - Unrealistic expectations\n\n## Output Format\n\n```markdown\n## ⚖️ Scope Feasibility Review\n\n### Score: X/10\n\n### Feasibility Matrix\n\n| Constraint | Available | Required | Gap |\n|------------|-----------|----------|-----|\n| Time | X days | Y days | ±Z |\n| People | X | Y | ±Z |\n| Skills | [list] | [list] | [gaps] |\n\n### Feasibility Assessment\n\n#### ✅ Achievable\n- [Scope item] - fits within constraints\n\n#### ⚠️ At Risk\n- [Scope item]\n  - Risk: [what could go wrong]\n  - Mitigation: [how to address]\n\n#### ❌ Not Feasible (as-is)\n- [Scope item]\n  - Blocker: [why it can't be done]\n  - Options:\n    1. Reduce scope to [X]\n    2. Extend timeline by [Y]\n    3. Add resources [Z]\n\n### Minimum Viable Scope\nIf constraints are tight, focus on:\n1. [Essential item 1]\n2. [Essential item 2]\n3. [Essential item 3]\n\n### Recommendations\n1. [Specific recommendation]\n2. [Specific recommendation]\n```\n",
        "skills/codex-review/references/experts/security-expert.md": "# Security Expert Prompt for Codex\n\nCodex MCP に送信するセキュリティレビュー用プロンプト。\n\n## 7-Section Format\n\n### TASK\n\nコードのセキュリティ脆弱性を分析し、OWASP Top 10 を含む一般的なセキュリティ問題を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式でセキュリティ問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- 各問題の修正案\n- セキュリティスコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- 技術スタック: {tech_stack}\n- 対象領域: 認証、認可、入力検証、データ保護\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Reduce false positives by considering context\n- Consider framework-specific security features\n\n### MUST DO\n\n1. **インジェクション**: SQL、コマンド、XSS をチェック\n2. **認証・認可**: ハードコード認証情報、弱い認証、権限チェック漏れ\n3. **機密データ**: ログ出力、安全でない通信、.env のコミット\n4. **設定ミス**: デバッグモード、CORS、セキュリティヘッダー\n5. **Cookie**: HttpOnly、SameSite、Secure、Domain\n6. **ファイルアップロード**: MIME、サイズ、拡張子、パストラバーサル\n7. **決済**: 冪等性、金額改ざん、Webhook 署名\n\n### MUST NOT DO\n\n- テストファイルのセキュリティ警告を出さない\n- 開発環境専用の設定を本番問題として報告しない\n- 既知の安全なパターン（ORM のパラメータ化等）を誤検出しない\n\n### OUTPUT FORMAT\n\n```markdown\n## Security Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | File | Line | Issue | Fix |\n|---|----------|------|------|-------|-----|\n| 1 | Critical | path/to/file.ts | 45 | SQL Injection | Use parameterized query |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "skills/codex-review/references/experts/seo-expert.md": "# SEO Expert Prompt for Codex\n\nCodex MCP に送信する SEO/OGP レビュー用プロンプト。\n\n## 7-Section Format\n\n### TASK\n\nSEO 最適化と OGP タグを分析し、検索エンジン・SNS シェア品質の問題を検出してください。\n\n### EXPECTED OUTCOME\n\n以下の形式で SEO 問題を報告:\n- 問題リスト（Severity: Critical/High/Medium/Low）\n- 具体的な修正案\n- SEO スコア（A-F）\n\n### CONTEXT\n\nレビュー対象:\n- 変更されたファイル: {files}\n- フレームワーク: {tech_stack}\n- 対象: メタタグ、OGP、robots.txt、構造化データ\n\n### CONSTRAINTS\n\n- **English only, max 1500 chars** (Claude integrates in Japanese)\n- Critical/High: report all, Medium/Low: max 3 each\n- No issues → `Score: A / No issues.`\n- Consider framework-specific SEO features (Next.js Metadata API, etc.)\n- Check dynamic pages with representative patterns\n\n### MUST DO\n\n1. **基本メタタグ**:\n   - title 欠落/重複/長さ\n   - description 欠落/長さ\n   - canonical URL\n   - viewport\n\n2. **OGP**:\n   - og:title, og:description, og:image\n   - og:image サイズ（1200x630 推奨）\n   - og:url と canonical の一致\n\n3. **Twitter Card**:\n   - twitter:card（summary_large_image 推奨）\n   - twitter:title, twitter:description, twitter:image\n\n4. **クローラビリティ**:\n   - robots.txt 存在/設定\n   - sitemap.xml 存在\n   - noindex 残存チェック\n\n5. **HTTP ステータス**:\n   - 404/500 が 200 を返していないか\n   - リダイレクトチェーン\n\n### MUST NOT DO\n\n- API ルート/バックエンドファイルを SEO 対象にしない\n- 管理画面/非公開ページの SEO を問題視しない\n- 構造化データを必須として報告しない（オプション扱い）\n\n### OUTPUT FORMAT\n\n```markdown\n## SEO/OGP Review Results\n\n**Score**: [A-F]\n\n### Findings\n\n| # | Severity | File | Issue | Fix |\n|---|----------|------|-------|-----|\n| 1 | High | app/layout.tsx | Missing viewport meta | Add viewport meta tag |\n\n### Summary\n\n- Critical: X\n- High: X\n- Medium: X\n- Low: X\n```\n",
        "skills/cursor-mem/SKILL.md": "---\nname: cursor-mem\ndescription: \"Accesses the claude-mem MCP server from Cursor to search session history and record observations. Triggers: memory search, claude-mem, past decisions, record this. Do NOT load for: normal coding, temporary notes, or implementation work.\"\nallowed-tools: [\"Bash\", \"Read\", \"mcp__claude-mem__*\"]\n---\n\n# Cursor-Mem Integration Skill\n\nCursorからClaude-memを活用するスキル。Claude CodeとCursorで同じメモリデータベースを共有し、セッション間の知識を引き継ぎます。\n\n## 🎯 使用場面\n\n### 検索（読み取り）\n- **過去の意思決定を確認**: 「なぜこのアーキテクチャを選んだのか？」\n- **パターンの参照**: 「以前はどのように実装したか？」\n- **バグ修正履歴**: 「同様の問題を過去に解決したか？」\n- **技術選定の理由**: 「なぜこのライブラリを使っているのか？」\n\n### 記録（書き込み）\n- **PMとしての判断をメモ**: レビュー中の気付きや設計判断\n- **パターンの記録**: 再利用可能なソリューション\n- **引き継ぎ事項**: 次のセッションやチームメンバーへの情報\n- **学習事項**: トラブルシューティングで得た知見\n\n## 📋 利用可能なMCPツール\n\nCursor上でclaude-memのMCPツールを直接利用できます：\n\n### 検索系\n- `mcp__claude-mem__search`: キーワードでメモリを検索\n- `mcp__claude-mem__timeline`: 時系列で記録を取得\n- `mcp__claude-mem__get_recent_context`: 最近の文脈を取得\n- `mcp__claude-mem__get_observation`: 特定の観測を取得\n\n### 書き込み系\n- `mcp__claude-mem__create_entities`: 新しいエンティティを作成\n- `mcp__claude-mem__create_relations`: エンティティ間の関連を作成\n- `mcp__claude-mem__add_observations`: 観測を追加\n\n## 🔧 セットアップ\n\n### 1. MCPラッパースクリプトの配置\n\n```bash\n# harness リポジトリ内に claude-mem-mcp がインストールされている前提\n# 絶対パスで参照\nHARNESS_PATH=\"/path/to/claude-code-harness\"\n```\n\n### 2. Cursor MCP設定\n\nプロジェクトルートに `.cursor/mcp.json` を作成：\n\n```json\n{\n  \"mcpServers\": {\n    \"claude-mem\": {\n      \"type\": \"stdio\",\n      \"command\": \"/absolute/path/to/claude-code-harness/scripts/claude-mem-mcp\"\n    }\n  }\n}\n```\n\n**⚠️ 重要**: `command` には絶対パスを指定してください。\n\n### 3. Cursor再起動\n\n設定後、Cursorを再起動してMCPサーバーを認識させます。\n\n## 💡 使い方の例\n\n詳細な使用例は [examples.md](./examples.md) を参照してください。\n\n### 基本的な検索\n\n```\nユーザー: 「認証方式の選定理由を確認したい」\n\nCursor（Composer）:\n→ 直接 mcp__claude-mem__search を呼び出し（auto mode により自動有効化）\n→ クエリ: \"認証 JWT Supabase 選定理由\"\n→ 過去の決定記録（decisions）を取得\n```\n\n> **v2.1.7+**: MCP auto mode がデフォルト有効のため、MCPSearch による事前検索は不要です。\n\n### 気付きの記録\n\n```\nユーザー: 「この実装パターンを記録しておいて」\n\nCursor（Composer）:\n→ 直接 mcp__claude-mem__add_observations を呼び出し\n→ タイプ: pattern\n→ タグ: source:cursor, review, best-practice\n→ 内容: 実装パターンの説明\n```\n\n## 🏷️ タグ規約\n\nClaude CodeとCursorで統一されたタグ体系を使用します：\n\n| タグ | 用途 |\n|------|------|\n| `source:cursor` | Cursorから記録された情報 |\n| `source:claude-code` | Claude Codeから記録された情報 |\n| `type:decision` | 意思決定の記録 |\n| `type:pattern` | 再利用可能なパターン |\n| `type:bug` | バグ修正の記録 |\n| `type:review` | レビューでの気付き |\n| `type:handoff` | 引き継ぎ事項 |\n\n## 🔄 Claude Code との連携\n\n### データ共有\n\n- Claude CodeとCursorは同じSQLiteデータベース（`~/.claude-mem/claude-mem.db`）を使用\n- WALモードで並行書き込みに対応\n- リアルタイムでデータが共有される\n\n### 推奨ワークフロー\n\n1. **Cursor（PM役）**: 設計判断やレビュー結果を記録\n2. **Claude Code（実装役）**: 過去の判断を参照しながら実装\n3. **双方向検索**: どちらからでも過去の記録を検索可能\n\n## 🔄 Claude Code 2.1.7+ 対応\n\nMCP tool search の auto mode がデフォルト有効になりました。\n\n**変更点**:\n- MCPSearch による明示的なツール検索は不要\n- MCP ツールは直接呼び出し可能\n- 初回呼び出し時に自動的にツールが有効化される\n\n**互換性**:\n- Claude Code 2.1.6 以前: MCPSearch を先に実行\n- Claude Code 2.1.7+: 直接呼び出し可能\n\n## ⚠️ 注意事項\n\n### パフォーマンス\n\n- 初回検索時はワーカー起動に2-3秒かかる場合があります\n- 2回目以降はワーカーが常駐するため高速\n\n### セキュリティ\n\n- メモリデータベースはローカル環境にのみ保存されます\n- 機密情報を記録する場合は注意してください\n\n### トラブルシューティング\n\n**問題**: MCPツールが認識されない\n**解決策**:\n1. `.cursor/mcp.json` のパスが正しいか確認\n2. スクリプトが実行可能か確認: `chmod +x scripts/claude-mem-mcp`\n3. Cursorを再起動\n\n**問題**: ワーカーが起動しない\n**解決策**:\n1. ヘルスチェック: `curl http://127.0.0.1:37777/health`\n2. 手動起動: `node ~/.claude/plugins/cache/thedotmack/claude-mem/*/scripts/worker-cli.js start`\n\n## 📚 参考資料\n\n- [Claude-mem 公式ドキュメント](https://github.com/thedotmack/claude-mem)\n- [Cursor MCP 設定ガイド](https://cursor.com/docs/context/mcp)\n- [使用例集](./examples.md)\n- [統合ガイド](../../docs/guides/cursor-mem-integration.md)\n",
        "skills/cursor-mem/examples.md": "# Cursor-Mem 使用例集\n\nこのドキュメントでは、CursorからClaude-memを活用する実践的な使用例を紹介します。\n\n## 📖 目次\n\n- [ユースケース1: 過去の決定を確認](#ユースケース1-過去の決定を確認)\n- [ユースケース2: レビュー中の気付きを記録](#ユースケース2-レビュー中の気付きを記録)\n- [ユースケース3: 引き継ぎ事項の記録](#ユースケース3-引き継ぎ事項の記録)\n- [ユースケース4: パターンの検索と再利用](#ユースケース4-パターンの検索と再利用)\n- [ユースケース5: バグ修正履歴の確認](#ユースケース5-バグ修正履歴の確認)\n\n---\n\n## ユースケース1: 過去の決定を確認\n\n### シナリオ\n認証方式の選定理由を確認したい。なぜJWTではなくSupabase Authを選んだのか？\n\n### Cursor操作（Composer）\n\n```\nユーザー: 「認証方式の選定理由を教えて」\n\nComposer:\n1. MCPツール `mcp__claude-mem__search` を使用\n2. パラメータ:\n   {\n     \"query\": \"認証 JWT Supabase 選定\",\n     \"limit\": 5\n   }\n```\n\n### 期待される結果\n\n```json\n{\n  \"results\": [\n    {\n      \"id\": 12345,\n      \"type\": \"decision\",\n      \"content\": \"Supabase Authを採用。理由: RLSとの統合、セッション管理の簡素化、スケーラビリティ。JWT単体では認可ロジックが複雑化する懸念。\",\n      \"tags\": [\"auth\", \"decision\", \"supabase\"],\n      \"created_at\": \"2024-12-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### フォローアップ\n\n特定の観測IDで詳細を取得：\n\n```\nComposer:\nMCPツール `mcp__claude-mem__get_observation` を使用\nパラメータ: { \"id\": 12345 }\n```\n\n---\n\n## ユースケース2: レビュー中の気付きを記録\n\n### シナリオ\nコードレビュー中に重要なパターンを発見。将来の参考のために記録しておきたい。\n\n### Cursor操作（Composer）\n\n```\nユーザー: 「このRLSポリシーのパターンを記録しておいて」\n\nComposer:\nMCPツール `mcp__claude-mem__add_observations` を使用\nパラメータ:\n{\n  \"observations\": [\n    {\n      \"type\": \"pattern\",\n      \"content\": \"RLSポリシーは常にuser_idで絞り込むパターンを採用。auth.uid() = user_id の条件を全テーブルに適用。\",\n      \"tags\": [\"source:cursor\", \"review\", \"pattern\", \"rls\", \"security\"]\n    }\n  ]\n}\n```\n\n### 記録内容の例\n\n| フィールド | 値 |\n|-----------|---|\n| **type** | pattern |\n| **content** | RLSポリシーのベストプラクティス |\n| **tags** | source:cursor, review, pattern, rls, security |\n| **timestamp** | 自動記録 |\n\n---\n\n## ユースケース3: 引き継ぎ事項の記録\n\n### シナリオ\nPMとして作業完了後、実装担当（Claude Code）への引き継ぎ事項を記録。\n\n### Cursor操作（Composer）\n\n```\nユーザー: 「バックエンドのエラーハンドリングを統一する必要があることを記録」\n\nComposer:\nMCPツール `mcp__claude-mem__create_entities` を使用\nパラメータ:\n{\n  \"entities\": [\n    {\n      \"name\": \"backend-error-handling-todo\",\n      \"entityType\": \"task\",\n      \"observations\": [\n        {\n          \"type\": \"handoff\",\n          \"content\": \"バックエンドのエラーハンドリングを統一する必要あり。現在、APIルート毎に異なるエラーフォーマットが混在。標準化して503エラーの処理を改善。\",\n          \"tags\": [\"source:cursor\", \"handoff\", \"backend\", \"error-handling\", \"todo\"]\n        }\n      ]\n    }\n  ]\n}\n```\n\n### Claude Code側での確認\n\n```bash\n# Claude Code で検索\nmcp__claude-mem__search\n→ query: \"handoff backend error\"\n→ 引き継ぎ事項を取得\n```\n\n---\n\n## ユースケース4: パターンの検索と再利用\n\n### シナリオ\n以前実装したフォームバリデーションのパターンを再利用したい。\n\n### Cursor操作（Composer）\n\n```\nユーザー: 「フォームバリデーションのパターンを教えて」\n\nComposer:\n1. MCPツール `mcp__claude-mem__search` を使用\n2. パラメータ:\n   {\n     \"query\": \"form validation pattern best-practice\",\n     \"limit\": 3\n   }\n```\n\n### 期待される結果\n\n```json\n{\n  \"results\": [\n    {\n      \"id\": 23456,\n      \"type\": \"pattern\",\n      \"content\": \"Zod + React Hook Form パターン: スキーマ定義を共有し、フロント/バックで再利用。zodResolver でバリデーションロジックを統一。\",\n      \"tags\": [\"pattern\", \"validation\", \"zod\", \"react-hook-form\"],\n      \"files\": [\"src/schemas/userSchema.ts\", \"src/hooks/useUserForm.ts\"]\n    }\n  ]\n}\n```\n\n### 実装時の活用\n\n1. パターンを確認\n2. 関連ファイルを参照\n3. 同様のアプローチで新機能を実装\n\n---\n\n## ユースケース5: バグ修正履歴の確認\n\n### シナリオ\n類似のバグに遭遇。過去に同じ問題を解決していないか確認したい。\n\n### Cursor操作（Composer）\n\n```\nユーザー: 「CORS エラーの過去の修正履歴を確認」\n\nComposer:\nMCPツール `mcp__claude-mem__search` を使用\nパラメータ:\n{\n  \"query\": \"CORS error fix bug\",\n  \"limit\": 5\n}\n```\n\n### 期待される結果\n\n```json\n{\n  \"results\": [\n    {\n      \"id\": 34567,\n      \"type\": \"bug\",\n      \"content\": \"CORS エラー修正: Supabase の CORS 設定が不足。storage.buckets テーブルに allowed_origins を追加。\",\n      \"tags\": [\"bug\", \"cors\", \"supabase\", \"storage\"],\n      \"created_at\": \"2024-11-20T14:00:00Z\",\n      \"related_files\": [\"supabase/migrations/20241120_add_cors.sql\"]\n    }\n  ]\n}\n```\n\n### 修正への活用\n\n1. 過去の修正内容を確認\n2. 関連ファイル（migration）を参照\n3. 同じアプローチを適用\n\n---\n\n## 🔄 統合ワークフロー例\n\n### PM（Cursor）→ 実装（Claude Code）の流れ\n\n#### Step 1: Cursorでレビュー & 記録\n\n```\n# Cursor Composer\n「このコンポーネントの設計パターンを記録」\n→ mcp__claude-mem__add_observations\n→ タグ: source:cursor, review, pattern, component\n```\n\n#### Step 2: Claude Codeで参照 & 実装\n\n```\n# Claude Code\n「コンポーネント設計のパターンを確認」\n→ mcp__claude-mem__search\n→ query: \"component pattern review\"\n→ Cursorで記録されたパターンを取得\n→ 同じパターンで実装\n```\n\n#### Step 3: 実装完了を記録\n\n```\n# Claude Code\n実装完了後、自動で記録\n→ mcp__claude-mem__add_observations\n→ タグ: source:claude-code, implementation, complete\n```\n\n#### Step 4: Cursorで検証\n\n```\n# Cursor Composer\n「実装状況を確認」\n→ mcp__claude-mem__timeline\n→ 最近の実装記録を時系列で取得\n```\n\n---\n\n## 💡 ベストプラクティス\n\n### タグの付け方\n\n| 状況 | 推奨タグ |\n|------|---------|\n| Cursorから記録 | `source:cursor` |\n| 設計判断 | `type:decision, design` |\n| レビュー結果 | `type:review, code-quality` |\n| 実装パターン | `type:pattern, best-practice` |\n| バグ修正 | `type:bug, fix` |\n| 引き継ぎ | `type:handoff, todo` |\n\n### 検索のコツ\n\n1. **具体的なキーワード**: `\"auth JWT\"` より `\"auth supabase jwt decision\"` の方が精度が高い\n2. **タグフィルタ**: 検索後にタグで絞り込み\n3. **時系列検索**: `timeline` ツールで最近の記録を取得\n4. **関連ファイル**: ファイルパスで関連する記録を発見\n\n### 記録のコツ\n\n1. **Why を記録**: 「何をしたか」より「なぜそうしたか」を重視\n2. **タグを充実**: 将来の検索性を高める\n3. **関連ファイルを紐付け**: 実装との結び付きを明確に\n4. **定期的な整理**: 重要な記録にマーカーを付ける\n\n---\n\n## 🔗 関連リソース\n\n- [SKILL.md](./SKILL.md) - スキルの詳細説明\n- [統合ガイド](../../docs/guides/cursor-mem-integration.md) - セットアップ手順\n- [Claude-mem 公式ドキュメント](https://github.com/thedotmack/claude-mem)\n",
        "skills/deploy/SKILL.md": "---\nname: deploy\ndescription: \"Sets up deployment, analytics, and health monitoring for projects. Use when user mentions deployment, Vercel, Netlify, analytics, or health checks. Do NOT load for: implementation work, local development, reviews, or setup.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Deploy Skills\n\nデプロイとモニタリングの設定を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **デプロイ設定** | See [references/deployment-setup.md](references/deployment-setup.md) |\n| **アナリティクス** | See [references/analytics.md](references/analytics.md) |\n| **環境診断** | See [references/health-checking.md](references/health-checking.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って設定\n",
        "skills/deploy/references/analytics.md": "---\nname: analytics\ndescription: \"Analytics統合（GA/Vercel Analytics 等）。アクセス解析を導入したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Analytics Skill\n\nGoogle Analytics または Vercel Analytics を統合するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「アクセス解析を入れて」\n- 「Google Analyticsを設定して」\n- 「Vercel Analyticsを追加して」\n- 「ページビューを追跡したい」\n\n---\n\n## 機能\n\n- ページビュー追跡\n- イベント追跡\n- コンバージョン追跡\n- ユーザー行動分析\n\n---\n\n## 実行フロー\n\n1. プロジェクト構成を確認（Next.js / React / etc）\n2. Google Analytics または Vercel Analytics を選択\n3. 必要なパッケージをインストール\n4. 設定ファイルを生成\n5. イベント追跡関数を作成\n",
        "skills/deploy/references/deployment-setup.md": "---\nname: deploy-setup\ndescription: \"デプロイ自動化設定（Vercel/Netlify 等）。プロジェクトを公開したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Deploy Setup Skill\n\nVercel/Netlifyへのデプロイを自動化するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「デプロイできるようにして」\n- 「Vercelに出したい」\n- 「Netlifyにデプロイしたい」\n- 「本番環境を設定して」\n\n---\n\n## 機能\n\n- Vercel/Netlifyプロジェクトの作成ガイド\n- 環境変数の設定ガイド\n- GitHub Actionsによる自動デプロイ\n- プレビューデプロイ（Pull Request）\n\n---\n\n## 実行フロー\n\n1. プロジェクト構成を確認\n2. Vercel または Netlify を選択\n3. 設定ファイルを生成（vercel.json / netlify.toml）\n4. 環境変数の設定をガイド\n5. デプロイ検証\n",
        "skills/deploy/references/health-checking.md": "---\nname: health-check\ndescription: \"環境診断（依存/設定/利用可能機能の確認）。環境が正しくセットアップされているか確認したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Bash\"]\n---\n\n# Health Check Skill\n\nプラグインを使用する前に、環境が正しくセットアップされているかを診断するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「この環境で動くかチェックして」\n- 「何が足りない？」\n- 「環境を診断して」\n- 「使える機能を教えて」\n\n---\n\n## チェック項目\n\n### 必須ツール\n- Git\n- Node.js / npm（該当する場合）\n- GitHub CLI（オプション）\n\n### 設定ファイル\n- `claude-code-harness.config.json` の存在と妥当性\n- `.claude/settings.json` の存在\n\n### ワークフローファイル\n- `Plans.md` の存在\n- `AGENTS.md` の存在\n- `CLAUDE.md` の存在\n\n---\n\n## 出力形式\n\n```\n## 環境診断レポート\n\n### 必須ツール\n✅ git (2.40.0)\n✅ node (v20.10.0)\n⚠️ gh (未インストール - CI自動修正に必要)\n\n### 設定ファイル\n✅ claude-code-harness.config.json\n✅ .claude/settings.json\n\n### 利用可能な機能\n✅ /work, /plan-with-agent, /sync-status\n⚠️ CI自動修正 (gh が必要)\n```\n",
        "skills/dev-browser/SKILL.md": "---\nname: dev-browser\ndescription: \"Browser automation with persistent page state. Use when users ask to navigate websites, fill forms, take screenshots, extract web data, test web apps, or automate browser workflows. Trigger phrases include 'go to [url]', 'click on', 'fill out the form', 'take a screenshot', 'scrape', 'automate', 'test the website', 'log into', or any browser interaction request.\"\nallowed-tools: [\"Bash\", \"Read\"]\ncontext: fork\n---\n\n# Dev Browser Skill (agent-browser)\n\nブラウザ自動化を行うスキル。agent-browser CLI を使用して、UI デバッグ・検証・自動操作を実行します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「ページを開いて」「URLを確認して」\n- 「クリックして」「入力して」「フォームに」\n- 「スクリーンショットを撮って」\n- 「UIを確認して」「画面をテストして」\n- \"open this page\", \"click on\", \"fill the form\", \"screenshot\"\n\n---\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **ブラウザ自動化** | See [references/browser-automation.md](references/browser-automation.md) |\n| **AI スナップショットワークフロー** | See [references/ai-snapshot-workflow.md](references/ai-snapshot-workflow.md) |\n\n## 実行手順\n\n### Step 0: agent-browser の確認\n\n```bash\n# インストール確認\nwhich agent-browser\n\n# 未インストールの場合\nnpm install -g agent-browser\nagent-browser install\n```\n\n### Step 1: ユーザーのリクエストを分類\n\n| リクエストタイプ | 対応アクション |\n|----------------|---------------|\n| URL を開く | `agent-browser open <url>` |\n| 要素をクリック | スナップショット → `agent-browser click @ref` |\n| フォーム入力 | スナップショット → `agent-browser fill @ref \"text\"` |\n| 状態確認 | `agent-browser snapshot -i -c` |\n| スクリーンショット | `agent-browser screenshot <path>` |\n| デバッグ | `agent-browser --headed open <url>` |\n\n### Step 2: AI スナップショットワークフロー（推奨）\n\nほとんどの操作で、まず**スナップショットを取得**してから要素参照で操作します：\n\n```bash\n# 1. ページを開く\nagent-browser open https://example.com\n\n# 2. スナップショット取得（AI 向け、インタラクティブ要素のみ）\nagent-browser snapshot -i -c\n\n# 出力例:\n# - link \"Home\" [ref=e1]\n# - button \"Login\" [ref=e2]\n# - input \"Email\" [ref=e3]\n# - input \"Password\" [ref=e4]\n# - button \"Submit\" [ref=e5]\n\n# 3. 要素参照で操作\nagent-browser click @e2           # Login ボタンをクリック\nagent-browser fill @e3 \"user@example.com\"\nagent-browser fill @e4 \"password123\"\nagent-browser click @e5           # Submit\n```\n\n### Step 3: 結果の確認\n\n```bash\n# 現在の状態をスナップショットで確認\nagent-browser snapshot -i -c\n\n# または URL を確認\nagent-browser get url\n\n# スクリーンショットを取得\nagent-browser screenshot result.png\n```\n\n---\n\n## クイックリファレンス\n\n### 基本操作\n\n| コマンド | 説明 |\n|---------|------|\n| `open <url>` | URL を開く |\n| `snapshot -i -c` | AI 向けスナップショット |\n| `click @e1` | 要素をクリック |\n| `fill @e1 \"text\"` | フォームに入力 |\n| `type @e1 \"text\"` | テキストを入力 |\n| `press Enter` | キーを押す |\n| `screenshot [path]` | スクリーンショット |\n| `close` | ブラウザを閉じる |\n\n### ナビゲーション\n\n| コマンド | 説明 |\n|---------|------|\n| `back` | 戻る |\n| `forward` | 進む |\n| `reload` | リロード |\n\n### 情報取得\n\n| コマンド | 説明 |\n|---------|------|\n| `get text @e1` | テキスト取得 |\n| `get html @e1` | HTML 取得 |\n| `get url` | 現在の URL |\n| `get title` | ページタイトル |\n\n### 待機\n\n| コマンド | 説明 |\n|---------|------|\n| `wait @e1` | 要素を待機 |\n| `wait 1000` | 1秒待機 |\n\n### デバッグ\n\n| コマンド | 説明 |\n|---------|------|\n| `--headed` | ブラウザを表示 |\n| `console` | コンソールログ |\n| `errors` | ページエラー |\n| `highlight @e1` | 要素をハイライト |\n\n---\n\n## セッション管理\n\n複数のタブ/セッションを並列管理：\n\n```bash\n# セッションを指定\nagent-browser --session admin open https://admin.example.com\nagent-browser --session user open https://example.com\n\n# セッション一覧\nagent-browser session list\n\n# 特定セッションで操作\nagent-browser --session admin snapshot -i -c\n```\n\n---\n\n## MCP ブラウザツールとの使い分け\n\n| ツール | 推奨度 | 用途 |\n|--------|--------|------|\n| **agent-browser** | ★★★ | 第一選択。AI 向けスナップショットが強力 |\n| chrome-devtools MCP | ★★☆ | Chrome が既に開いている場合 |\n| playwright MCP | ★★☆ | 複雑な E2E テスト |\n\n**原則**: まず agent-browser を試し、うまくいかない場合のみ MCP ツールを使用。\n\n---\n\n## 注意事項\n\n- agent-browser はヘッドレスモードがデフォルト\n- `--headed` オプションでブラウザを表示可能\n- セッションは明示的に `close` するまで維持される\n- 認証が必要なサイトはセッションを活用\n",
        "skills/dev-browser/references/ai-snapshot-workflow.md": "# AI Snapshot Workflow\n\nagent-browser の `snapshot` コマンドを活用した AI エージェント向けワークフロー。\n\n---\n\n## 概要\n\n`snapshot` コマンドは、ページのアクセシビリティツリーを取得し、各要素に参照 ID（`@e1`, `@e2` など）を付与します。これにより：\n\n1. **CSS セレクタ不要**: 動的な ID やクラス名に依存しない\n2. **コンテキスト把握**: 要素の役割（button, input, link）が明確\n3. **決定的操作**: `@e1` などの参照で確実に操作可能\n\n---\n\n## 基本ワークフロー\n\n### Step 1: ページを開く\n\n```bash\nagent-browser open https://example.com\n```\n\n### Step 2: スナップショット取得\n\n```bash\nagent-browser snapshot -i -c\n```\n\n**オプション説明**:\n- `-i, --interactive`: インタラクティブな要素（ボタン、リンク、入力フィールド等）のみ表示\n- `-c, --compact`: 空の構造要素を除去してコンパクトに\n\n**出力例**:\n```\n✓ Example Domain\n  https://example.com/\n\n- link \"Home\" [ref=e1]\n- link \"About\" [ref=e2]\n- button \"Login\" [ref=e3]\n- input \"Search\" [ref=e4]\n- button \"Search\" [ref=e5]\n```\n\n### Step 3: 要素参照で操作\n\n```bash\n# リンクをクリック\nagent-browser click @e1\n\n# 検索フォームに入力\nagent-browser fill @e4 \"search query\"\n\n# 検索ボタンをクリック\nagent-browser click @e5\n```\n\n### Step 4: 結果を確認\n\n```bash\n# 新しい状態をスナップショット\nagent-browser snapshot -i -c\n```\n\n---\n\n## Snapshot オプション詳細\n\n### `-i, --interactive`\n\nインタラクティブな要素のみを表示。操作対象を絞り込む際に有効。\n\n```bash\n# インタラクティブ要素のみ\nagent-browser snapshot -i\n\n# 全要素（テキストノード含む）\nagent-browser snapshot\n```\n\n### `-c, --compact`\n\n空の構造要素（div, span など内容のないもの）を除去。\n\n```bash\n# コンパクト出力\nagent-browser snapshot -c\n\n# 構造も含めて表示\nagent-browser snapshot\n```\n\n### `-d, --depth <n>`\n\nツリーの深さを制限。大きなページで概要を把握する際に有効。\n\n```bash\n# 深さ3まで\nagent-browser snapshot -d 3\n```\n\n### `-s, --selector <sel>`\n\n特定のセレクタにスコープを絞る。\n\n```bash\n# フォーム内のみ\nagent-browser snapshot -s \"form.login\"\n\n# ナビゲーション内のみ\nagent-browser snapshot -s \"nav\"\n```\n\n### 組み合わせ\n\n```bash\n# 推奨: インタラクティブ + コンパクト\nagent-browser snapshot -i -c\n\n# フォーム内のインタラクティブ要素のみ\nagent-browser snapshot -i -c -s \"form\"\n\n# 浅いツリーで概要把握\nagent-browser snapshot -i -d 2\n```\n\n---\n\n## ユースケース別ワークフロー\n\n### ログインフロー\n\n```bash\n# 1. ログインページを開く\nagent-browser open https://example.com/login\n\n# 2. スナップショット取得\nagent-browser snapshot -i -c\n# 出力:\n# - input \"Email\" [ref=e1]\n# - input \"Password\" [ref=e2]\n# - button \"Login\" [ref=e3]\n# - link \"Forgot password?\" [ref=e4]\n\n# 3. ログイン情報を入力\nagent-browser fill @e1 \"user@example.com\"\nagent-browser fill @e2 \"password123\"\n\n# 4. ログインボタンをクリック\nagent-browser click @e3\n\n# 5. 結果を確認\nagent-browser snapshot -i -c\nagent-browser get url\n```\n\n### フォーム送信\n\n```bash\n# 1. フォームページを開く\nagent-browser open https://example.com/contact\n\n# 2. フォーム内のスナップショット\nagent-browser snapshot -i -c -s \"form\"\n# 出力:\n# - input \"Name\" [ref=e1]\n# - input \"Email\" [ref=e2]\n# - textarea \"Message\" [ref=e3]\n# - button \"Send\" [ref=e4]\n\n# 3. フォームに入力\nagent-browser fill @e1 \"John Doe\"\nagent-browser fill @e2 \"john@example.com\"\nagent-browser fill @e3 \"Hello, this is a test message.\"\n\n# 4. 送信\nagent-browser click @e4\n\n# 5. 確認\nagent-browser snapshot -i -c\n```\n\n### ナビゲーション探索\n\n```bash\n# 1. トップページを開く\nagent-browser open https://example.com\n\n# 2. ナビゲーションを確認\nagent-browser snapshot -i -c -s \"nav\"\n# 出力:\n# - link \"Home\" [ref=e1]\n# - link \"Products\" [ref=e2]\n# - link \"About\" [ref=e3]\n# - link \"Contact\" [ref=e4]\n\n# 3. Products ページへ\nagent-browser click @e2\n\n# 4. 新しいページの構造を確認\nagent-browser snapshot -i -c\n```\n\n### 動的コンテンツの操作\n\n```bash\n# 1. ページを開く\nagent-browser open https://example.com/dashboard\n\n# 2. 初期スナップショット\nagent-browser snapshot -i -c\n\n# 3. ドロップダウンを開く\nagent-browser click @e5\n\n# 4. 待機（動的コンテンツのロード）\nagent-browser wait 500\n\n# 5. 新しいスナップショット（ドロップダウンメニューが表示される）\nagent-browser snapshot -i -c\n# 新しい要素が出現:\n# - menuitem \"Option 1\" [ref=e10]\n# - menuitem \"Option 2\" [ref=e11]\n# - menuitem \"Option 3\" [ref=e12]\n\n# 6. オプションを選択\nagent-browser click @e11\n```\n\n---\n\n## トラブルシューティング\n\n### 要素が見つからない\n\n```bash\n# フルスナップショット（すべての要素）\nagent-browser snapshot\n\n# 特定セレクタで絞り込み\nagent-browser snapshot -s \"#target-element\"\n\n# 待機してから再試行\nagent-browser wait 2000\nagent-browser snapshot -i -c\n```\n\n### 動的ページ\n\n```bash\n# JavaScript 実行後にスナップショット\nagent-browser eval \"document.querySelector('#load-more').click()\"\nagent-browser wait 1000\nagent-browser snapshot -i -c\n```\n\n### iframe 内の要素\n\n```bash\n# メインフレームのスナップショット\nagent-browser snapshot -i -c\n\n# iframe 内は直接アクセスできないため、\n# eval で iframe 内の操作を行う\nagent-browser eval \"document.querySelector('iframe').contentDocument.querySelector('button').click()\"\n```\n\n---\n\n## ベストプラクティス\n\n### 1. 常にスナップショットから開始\n\n操作前に必ずスナップショットを取得し、現在の状態を把握する。\n\n### 2. インタラクティブ + コンパクトをデフォルトに\n\n```bash\nagent-browser snapshot -i -c\n```\n\n### 3. 操作後は状態を確認\n\n```bash\nagent-browser click @e1\nagent-browser snapshot -i -c  # 結果を確認\n```\n\n### 4. 適切な待機を入れる\n\n動的コンテンツがある場合は待機を入れる：\n\n```bash\nagent-browser click @e1\nagent-browser wait 500\nagent-browser snapshot -i -c\n```\n\n### 5. セッションを活用\n\n認証状態を維持するためにセッションを使用：\n\n```bash\nagent-browser --session myapp open https://example.com/login\n# ... ログイン操作 ...\n# 以降、同じセッションで操作を継続\nagent-browser --session myapp open https://example.com/dashboard\n```\n",
        "skills/dev-browser/references/browser-automation.md": "# Browser Automation with agent-browser\n\nagent-browser CLI を使用したブラウザ自動化の詳細ガイド。\n\n---\n\n## インストール\n\n```bash\n# グローバルインストール\nnpm install -g agent-browser\n\n# Chromium をダウンロード\nagent-browser install\n\n# Linux の場合、システム依存関係も\nagent-browser install --with-deps\n```\n\n---\n\n## 基本操作\n\n### ページを開く\n\n```bash\n# 基本\nagent-browser open https://example.com\n\n# ブラウザを表示して開く（デバッグ用）\nagent-browser open https://example.com --headed\n\n# カスタムヘッダー付き\nagent-browser open https://api.example.com --headers '{\"Authorization\": \"Bearer token\"}'\n```\n\n### クリック\n\n```bash\n# 要素参照でクリック（推奨）\nagent-browser click @e1\n\n# CSS セレクタでクリック\nagent-browser click \"button.submit\"\n\n# ダブルクリック\nagent-browser dblclick @e1\n```\n\n### 入力\n\n```bash\n# フォームをクリア&入力\nagent-browser fill @e1 \"hello@example.com\"\n\n# 追加入力（クリアしない）\nagent-browser type @e1 \"追加テキスト\"\n\n# キーを押す\nagent-browser press Enter\nagent-browser press Tab\nagent-browser press \"Control+a\"\n```\n\n### フォーム操作\n\n```bash\n# チェックボックス\nagent-browser check @e1\nagent-browser uncheck @e1\n\n# セレクトボックス\nagent-browser select @e1 \"option-value\"\n\n# ファイルアップロード\nagent-browser upload @e1 /path/to/file.pdf\n```\n\n### スクロール\n\n```bash\n# 方向指定\nagent-browser scroll down\nagent-browser scroll up 500\n\n# 要素を表示\nagent-browser scrollintoview @e1\n```\n\n---\n\n## 情報取得\n\n```bash\n# テキスト取得\nagent-browser get text @e1\n\n# HTML 取得\nagent-browser get html @e1\n\n# 属性取得\nagent-browser get attr href @e1\n\n# 値取得（input）\nagent-browser get value @e1\n\n# 現在の URL\nagent-browser get url\n\n# ページタイトル\nagent-browser get title\n\n# 要素数\nagent-browser get count \"li.item\"\n\n# 要素の位置とサイズ\nagent-browser get box @e1\n```\n\n---\n\n## 状態チェック\n\n```bash\n# 表示されているか\nagent-browser is visible @e1\n\n# 有効か（disabled でないか）\nagent-browser is enabled @e1\n\n# チェックされているか\nagent-browser is checked @e1\n```\n\n---\n\n## 待機\n\n```bash\n# 要素が表示されるまで待機\nagent-browser wait @e1\nagent-browser wait \"button.loaded\"\n\n# 時間で待機（ミリ秒）\nagent-browser wait 2000\n```\n\n---\n\n## スクリーンショット\n\n```bash\n# 基本\nagent-browser screenshot\n\n# ファイル名指定\nagent-browser screenshot output.png\n\n# フルページ\nagent-browser screenshot --full page.png\n\n# PDF として保存\nagent-browser pdf document.pdf\n```\n\n---\n\n## JavaScript 実行\n\n```bash\n# スクリプト実行\nagent-browser eval \"document.title\"\nagent-browser eval \"localStorage.getItem('token')\"\nagent-browser eval \"window.scrollTo(0, document.body.scrollHeight)\"\n```\n\n---\n\n## ネットワーク操作\n\n```bash\n# リクエストをモック\nagent-browser network route \"*/api/users\" --body '{\"users\": []}'\n\n# リクエストをブロック\nagent-browser network route \"*/analytics/*\" --abort\n\n# ルート解除\nagent-browser network unroute \"*/api/users\"\n\n# リクエスト履歴\nagent-browser network requests\nagent-browser network requests --filter \"api\"\nagent-browser network requests --clear\n```\n\n---\n\n## Cookie/Storage\n\n```bash\n# Cookie 取得\nagent-browser cookies get\n\n# Cookie 設定\nagent-browser cookies set '{\"name\": \"session\", \"value\": \"abc123\", \"domain\": \"example.com\"}'\n\n# Cookie クリア\nagent-browser cookies clear\n\n# LocalStorage\nagent-browser storage local get \"key\"\nagent-browser storage local set \"key\" \"value\"\nagent-browser storage local clear\n\n# SessionStorage\nagent-browser storage session get \"key\"\n```\n\n---\n\n## タブ管理\n\n```bash\n# 新しいタブを開く\nagent-browser tab new\n\n# タブ一覧\nagent-browser tab list\n\n# タブを切り替え\nagent-browser tab 2\n\n# タブを閉じる\nagent-browser tab close\n```\n\n---\n\n## ブラウザ設定\n\n```bash\n# ビューポートサイズ\nagent-browser set viewport 1920 1080\n\n# デバイスエミュレーション\nagent-browser set device \"iPhone 12\"\n\n# 位置情報\nagent-browser set geo 35.6762 139.6503\n\n# オフラインモード\nagent-browser set offline on\nagent-browser set offline off\n\n# ダークモード\nagent-browser set media dark\nagent-browser set media light\n\n# 認証情報\nagent-browser set credentials admin password123\n```\n\n---\n\n## デバッグ\n\n```bash\n# コンソールログを表示\nagent-browser console\nagent-browser console --clear\n\n# ページエラーを表示\nagent-browser errors\nagent-browser errors --clear\n\n# 要素をハイライト\nagent-browser highlight @e1\n\n# トレース記録\nagent-browser trace start\n# ... 操作 ...\nagent-browser trace stop trace.zip\n```\n\n---\n\n## Find コマンド（高度な要素検索）\n\n```bash\n# ロールで検索してクリック\nagent-browser find role button click --name \"Submit\"\n\n# テキストで検索\nagent-browser find text \"Click here\" click\n\n# ラベルで検索\nagent-browser find label \"Email\" fill \"test@example.com\"\n\n# プレースホルダーで検索\nagent-browser find placeholder \"Enter your name\" fill \"John\"\n\n# テスト ID で検索\nagent-browser find testid \"submit-btn\" click\n\n# 最初/最後/n番目\nagent-browser find first \"button\" click\nagent-browser find last \"input\" fill \"text\"\nagent-browser find nth 2 \"li\" click\n```\n\n---\n\n## マウス操作（低レベル）\n\n```bash\n# マウス移動\nagent-browser mouse move 100 200\n\n# マウスボタン\nagent-browser mouse down\nagent-browser mouse up\nagent-browser mouse down right\n\n# ホイール\nagent-browser mouse wheel 100\nagent-browser mouse wheel 100 50  # dy, dx\n```\n\n---\n\n## ドラッグ&ドロップ\n\n```bash\n# 要素間のドラッグ\nagent-browser drag @e1 @e2\n\n# 座標指定\nagent-browser drag @e1 \"500,300\"\n```\n\n---\n\n## セッション管理\n\n```bash\n# 名前付きセッション\nagent-browser --session myapp open https://example.com\n\n# セッション一覧\nagent-browser session list\n\n# 現在のセッション名\nagent-browser session\n\n# 環境変数でも指定可能\nAGENT_BROWSER_SESSION=myapp agent-browser snapshot\n```\n\n---\n\n## JSON 出力\n\n```bash\n# JSON 形式で出力\nagent-browser snapshot --json\nagent-browser get text @e1 --json\nagent-browser network requests --json\n```\n\n---\n\n## カスタムブラウザ\n\n```bash\n# カスタム実行ファイル\nagent-browser --executable-path /path/to/chrome open https://example.com\n\n# 環境変数でも指定可能\nAGENT_BROWSER_EXECUTABLE_PATH=/path/to/chrome agent-browser open https://example.com\n```\n",
        "skills/docs/SKILL.md": "---\nname: docs\ndescription: \"Generates documentation files including NotebookLM YAML and slide content. Use when user mentions documentation, YAML, NotebookLM, slides, or presentations. Do NOT load for: implementation work, code fixes, reviews, or deployments.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\"]\n---\n\n# Docs Skills\n\nドキュメント生成を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **NotebookLM YAML** | See [references/notebooklm-yaml.md](references/notebooklm-yaml.md) |\n| **スライド YAML** | See [references/notebooklm-slides.md](references/notebooklm-slides.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って生成\n",
        "skills/docs/references/notebooklm-slides.md": "---\nname: docs-notebooklm-slide-yaml\ndescription: \"NotebookLM の［スライド資料をカスタマイズ］で使えるデザイン指示YAMLを2案（別角度）生成して出力する。\"\nallowed-tools: [\"Read\", \"Write\"]\n---\n\n# NotebookLM Slide Design YAML (2 Variations)\n\n## 目的\n\nNotebookLM の「スライド資料」生成で、**デザインの方向性をYAMLで明示して品質と再現性を上げる**。\n\nこのスキルは、同じソースでも見た目を変えられるように、**意図の捉え方が異なる2案**のYAMLを出力します。\n\n参考（使い方/作例）:\n- `https://note.com/yoshifujidesign/n/nd9c8db0b55b8`\n- `https://note.com/yoshifujidesign/n/n7412bccb5762`\n\n---\n\n## 使い方（NotebookLM 側）\n\nNotebookLMで資料ソースを読み込んだ後、\n［スライド資料］→［スライド資料をカスタマイズ］→［作成するスライドについて説明してください］\nに **このスキルが出力するYAML全文を貼り付けて**［生成］します。\n\n---\n\n## 入力（ユーザーに確認すること）\n\n可能なら最初に以下を最大5問で確認し、回答がなければ括弧のデフォルトで進めます。\n\n1. 目的（例: 社内共有/営業/採用/投資家向け） (社内共有)\n2. 想定読者（例: 経営/開発/非エンジニア） (非エンジニア混在)\n3. トーン（例: 信頼感/革新/親しみ） (信頼感)\n4. ブランド要素（ロゴ/ブランドカラー/フォント指定） (指定なし)\n5. 写真/図表の比率（写真多め/データ多め） (データ多め)\n\n---\n\n## 出力（必須フォーマット）\n\n以下の **2案**を必ず出力すること。\n\n- 案A: **可読性・信頼感・データ伝達を最優先**（ミニマル/コーポレート）\n- 案B: **情緒・ストーリー・余白の美学を重視**（エディトリアル/ライフスタイル）\n\nどちらも **日本語YAML**で、NotebookLMにそのまま貼れる形にする。\n\n出力形式:\n\n- `### 案A` の直下に YAML を1つ（コードブロック）\n- `### 案B` の直下に YAML を1つ（コードブロック）\n\n---\n\n## 生成ルール\n\n- 具体的な色は **HEX** を含める（例: `#FFFFFF`）\n- 「やってはいけない」も少し書く（例: 枠線多用禁止、過剰な影禁止、色数制限）\n- 章立て/ナビゲーション/余白/グリッドなど、**再現性に効く制約を明文化**\n- 内容（ソース）が不明でも成立するよう、**構造テンプレ**として書く\n\n---\n\n## 出力テンプレ（生成例の骨格）\n\n### 案A（ミニマル/コーポレート）\n\n（必要に応じて、目的/読者/ブランド色に合わせて微調整する）\n\n```yaml\n# presentation_design_spec_minimal_corporate_jp.yaml\n# スタイル: モダン・ミニマル / コーポレート\n# 目的: 可読性とデータ伝達を最優先（信頼感）\n\n全体デザイン設定:\n  トーン: \"信頼感、プロフェッショナル、クリーン、論理的\"\n  配色パレット:\n    ベース: \"#FFFFFF (白) または #F5F5F7 (非常に薄いグレー)\"\n    文字色: \"#111111 (ほぼ黒) または #333333 (チャコール)\"\n    アクセント: \"ブランドカラーがあればそれを使用。なければ #0052CC (ブルー) を採用\"\n    強調: \"#FFB020 (アンバー) - 重要な数値や注意に限定\"\n    色数制限: \"最大3色 + グレー階調\"\n  タイポグラフィ:\n    見出し: \"太めのゴシック体（サンセリフ）。短く強い言葉。\"\n    本文: \"可読性の高いゴシック体。行間を広めに。\"\n    数字: \"サンセリフ太字で大きく。単位（%など）は小さめ。\"\n  共通レイアウト・ルール:\n    グリッド: \"12カラム相当で整列。左右余白を広く。\"\n    ナビゲーション: \"左上に '01. SECTION' のような番号＋章題を小さく表示。\"\n    余白: \"詰め込み禁止。1スライド1メッセージ。\"\n    図表: \"罫線/グリッド線は最小。強調点のみアクセント色。\"\n  NG事項:\n    - \"過剰なドロップシャドウ禁止\"\n    - \"装飾枠の多用禁止\"\n    - \"グラデーション多用禁止\"\n\nレイアウト・バリエーション（カタログ）:\n  - タイプ: \"表紙\"\n    デザイン: \"余白大。タイトルは左寄せで大きく、サブタイトルは小さく。薄い横罫線を1本。\"\n  - タイプ: \"章扉\"\n    デザイン: \"章タイトルを大きく。背景は単色でミニマル。\"\n  - タイプ: \"結論（TL;DR）\"\n    デザイン: \"結論3点 + 大きな数字/指標を1つ。\"\n  - タイプ: \"2カラム（課題 vs 解決）\"\n    デザイン: \"縦線で2分割。左:課題、右:解決。見出し太字、本文細字。\"\n  - タイプ: \"データ/チャート\"\n    デザイン: \"棒/折れ線のシンプル表現。注釈は短く。\"\n  - タイプ: \"プロセス\"\n    デザイン: \"水平ステップ（01-05）。丸アイコンは最小。\"\n  - タイプ: \"タイムライン\"\n    デザイン: \"縦線 + 年号大 + 説明小。\"\n  - タイプ: \"まとめ\"\n    デザイン: \"次アクションを3点。チェックリスト風に簡潔に。\"\n```\n\n### 案B（エディトリアル/ストーリー）\n\n（必要に応じて、目的/読者/写真比率に合わせて微調整する）\n\n```yaml\n# presentation_design_spec_editorial_story_jp.yaml\n# スタイル: モダン・エディトリアル / ライフスタイル雑誌風\n# 目的: 余白と写真でストーリーを語る（情緒/説得）\n\n全体デザイン設定:\n  トーン: \"穏やか、知的、情緒的、オーガニック、洗練\"\n  ビジュアル・アイデンティティ:\n    背景色: \"#F3F0EB (サンドベージュ) または #EBEBEB (ウォームグレー)\"\n    文字色: \"#333333 (チャコール) - 真っ黒は避ける\"\n    アクセントカラー: \"#E07A5F (テラコッタ) または #708D81 (オリーブ)\"\n    画像スタイル:\n      特徴: \"自然光、フィルム粒子、彩度低め\"\n      形状: \"角丸長方形 または アーチ型\"\n  タイポグラフィ:\n    見出し: \"上品な明朝/セリフ体。重要語は控えめに強調。\"\n    本文: \"読みやすいゴシック/サンセリフで小さめ。\"\n    数字: \"セリフ数字で落ち着きを出す。\"\n  共通レイアウト・ルール:\n    余白: \"余白を最優先。文字密度を下げる。\"\n    写真: \"1スライド1枚の大きい写真を基本。\"\n    罫線: \"枠線は禁止。区切りは余白か極細線のみ。\"\n  デザインルール:\n    - \"寒色・ネオンは禁止（温かいトーンで統一）\"\n    - \"過剰なアイコンは禁止（写真とタイポで語る）\"\n\nレイアウト・バリエーション（カタログ）:\n  - タイプ: \"表紙（雑誌カバー）\"\n    デザイン: \"右に写真フルブリード、左にタイトル。細い横罫線で区切る。\"\n  - タイプ: \"引用（Quote）\"\n    デザイン: \"短いメッセージを中央。背景に大きな引用符を薄く。\"\n  - タイプ: \"ストーリー（1→2→3）\"\n    デザイン: \"縦ステップ。点線で接続。各ステップ横に小さな丸写真。\"\n  - タイプ: \"比較\"\n    デザイン: \"左右2枚写真 + 各キャプション。色は抑えめ。\"\n  - タイプ: \"データ\"\n    デザイン: \"極細折れ線 + 説明文段落で補足（物語を添える）。\"\n  - タイプ: \"まとめ\"\n    デザイン: \"次アクションを3点。余白を残して締める。\"\n```\n\n\n",
        "skills/docs/references/notebooklm-yaml.md": "---\nname: notebooklm-yaml\ndescription: \"NotebookLMの「スライド資料をカスタマイズ」で使うデザインYAMLを2案生成。プレゼン資料を作りたい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\"]\n---\n\n# NotebookLM YAML Skill\n\nNotebookLM のスライド生成で、デザインの方向性をYAMLでコントロールするためのスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「NotebookLMのスライドをいい感じのデザインで作りたい」\n- 「プレゼン用のYAMLを作って」\n- 「スライドデザインを2案出して」\n\n---\n\n## ヒアリング項目\n\n1. 目的（社内共有/営業/採用/投資家向け）\n2. 想定読者（経営/開発/非エンジニア）\n3. トーン（信頼感/革新/親しみ）\n4. ブランド要素（ロゴ/ブランドカラー/フォント指定）\n5. 写真/図表の比率（写真多め/データ多め）\n\n---\n\n## 出力\n\n- **案A**: ミニマル/コーポレート（可読性・信頼感・データ重視）\n- **案B**: エディトリアル/ストーリー（余白・写真・情緒重視）\n",
        "skills/harness-review/SKILL.md": "---\nname: harness-review\ndescription: \"Multi-perspective review supporting code, plan, and scope analysis. Auto-detects review type from context. Use when user mentions reviews, code review, plan review, scope analysis, security, performance, quality checks, PRs, diffs, or change review. Do NOT load for: implementation work, new feature development, bug fixes, or setup.\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\", \"Bash\", \"Task\"]\ncontext: fork\n---\n\n# Review Skills\n\nコードレビュー、計画レビュー、スコープ分析を担当するスキル群です。\nコンテキストからレビュータイプを自動判定します。\n\n## レビュータイプ（Context-Aware）\n\nレビュータイプはコンテキストから自動判定されます：\n\n| Recent Activity | Review Type | 4 Experts |\n|-----------------|-------------|-----------|\n| `/plan-with-agent` 後 | **Plan Review** | Clarity, Feasibility, Dependencies, Acceptance |\n| `/work` 後 | **Code Review** | Security, Performance, Quality, Accessibility |\n| タスク追加後 | **Scope Review** | Scope-creep, Priority, Feasibility, Impact |\n\n### 手動指定\n\n```bash\n/harness-review           # 自動判定\n/harness-review code      # コードレビュー強制\n/harness-review plan      # 計画レビュー強制\n/harness-review scope     # スコープ分析強制\n```\n\n---\n\n## 機能詳細（Code Review）\n\n| 機能 | 詳細 |\n|------|------|\n| **変更レビュー** | See [references/changes-review.md](references/changes-review.md) |\n| **品質チェック** | See [references/quality-review.md](references/quality-review.md) |\n| **セキュリティ** | See [references/security-review.md](references/security-review.md) |\n| **パフォーマンス** | See [references/performance-review.md](references/performance-review.md) |\n| **アクセシビリティ** | See [references/accessibility-review.md](references/accessibility-review.md) |\n| **SEO/OGP** | See [references/seo-review.md](references/seo-review.md) |\n| **Codex 統合** | See [references/codex-integration.md](references/codex-integration.md) |\n| **コミット判定** | See [references/commit-judgment-logic.md](references/commit-judgment-logic.md) |\n\n## 機能詳細（Plan/Scope Review）\n\nPlan Review と Scope Review は Codex エキスパートを使用します：\n\n| レビュータイプ | エキスパート | 参照 |\n|--------------|-------------|------|\n| **Plan Review** | Clarity, Feasibility, Dependencies, Acceptance | `../codex-review/references/experts/clarity-expert.md` 等 |\n| **Scope Review** | Scope-creep, Priority, Feasibility, Impact | `../codex-review/references/experts/scope-creep-expert.md` 等 |\n\n詳細: [../codex-review/references/codex-parallel-review.md](../codex-review/references/codex-parallel-review.md)\n\n## 実行手順\n\n1. **品質判定ゲート**（Step 0）\n2. **残コンテキスト確認（Codex モード時）**（Step 1）\n3. ユーザーのリクエストを分類\n4. **（Claude-mem 有効時）過去のレビュー指摘を検索**\n5. 並列実行の判定（下記参照）\n6. 上記の「機能詳細」から適切な参照ファイルを読む、または並列サブエージェント起動\n7. 結果を統合してレビュー完了\n\n### 入力の優先順位\n\n- `files` が渡されている場合は **そのファイルのみ** を対象にレビューする\n- `files` が渡されていない場合は `git_diff` から変更箇所を推定する\n- `context_from: code_content` が渡されている場合は **その内容を優先** してレビューする\n\n### Step 0: 品質判定ゲート（レビュー重点領域の特定）\n\nレビュー開始前に変更内容を分析し、重点領域を特定:\n\n```\n変更ファイル分析\n    ↓\n┌─────────────────────────────────────────┐\n│           品質判定ゲート                 │\n├─────────────────────────────────────────┤\n│  判定項目:                              │\n│  ├── カバレッジ不足？（テストなし）     │\n│  ├── セキュリティ注意？（auth/api/）    │\n│  ├── a11y 注意？（UI コンポーネント）   │\n│  └── パフォーマンス注意？（DB/ループ）  │\n└─────────────────────────────────────────┘\n          ↓\n    重点レビュー領域を決定\n```\n\n#### カバレッジ判定\n\n| 状況 | 指摘内容 |\n|------|---------|\n| 新規ファイルにテストなし | 「テストが不足しています」 |\n| 変更ファイルのテストが古い | 「テストの更新を検討してください」 |\n| カバレッジ < 60% | 「カバレッジ向上を推奨」 |\n\n#### セキュリティ重点レビュー\n\n| パス | 追加チェック項目 |\n|------|-----------------|\n| auth/, api/ | OWASP Top 10 チェックリスト |\n| 入力処理 | サニタイズ、バリデーション |\n| DB クエリ | パラメータ化確認 |\n\n#### a11y 重点レビュー\n\n| パス | チェック項目 |\n|------|------------|\n| src/components/ | alt, aria, キーボード操作 |\n| src/pages/ | 見出し構造, フォーカス管理 |\n\n#### パフォーマンス重点レビュー\n\n| パターン | 警告内容 |\n|---------|---------|\n| ループ内 DB クエリ | N+1 クエリの可能性 |\n| 大規模データ処理 | ページネーション検討 |\n| useEffect 乱用 | レンダリング最適化 |\n\n#### SEO/OGP 重点レビュー\n\n| パス | チェック項目 |\n|------|------------|\n| src/pages/, app/ | title, description, canonical |\n| public/ | robots.txt, sitemap.xml, OGP 画像 |\n| layout.tsx, _document.tsx | viewport, OGP タグ, Twitter Card |\n\n#### クロスプラットフォーム重点レビュー\n\n| パス | チェック項目 |\n|------|------------|\n| src/components/, app/ | レスポンシブ（固定幅チェック） |\n| *.css, *.scss, tailwind | 100vw 使用、overflow 設定 |\n| public/ | favicon, apple-touch-icon |\n\n#### 重点レビュー統合出力\n\n```markdown\n📊 品質判定結果 → 重点レビュー領域\n\n| 判定 | 該当 | 対象ファイル |\n|------|------|-------------|\n| セキュリティ | ⚠️ | src/api/auth.ts |\n| カバレッジ | ⚠️ | src/utils/helpers.ts (テストなし) |\n| a11y | ✅ | - |\n| パフォーマンス | ✅ | - |\n| SEO/OGP | ⚠️ | app/layout.tsx (OGP 未設定) |\n| クロスプラットフォーム | ✅ | - |\n\n→ セキュリティ・カバレッジ・SEO を重点的にレビュー\n```\n\n#### LSP ベースの影響分析（推奨）\n\n変更レビュー時に LSP ツールで影響範囲を確認:\n\n| 変更タイプ | LSP 操作 | 確認内容 |\n|-----------|---------|---------|\n| 関数シグネチャ変更 | findReferences | 全呼び出し元が対応済みか |\n| 型定義変更 | findReferences | 使用箇所での型互換性 |\n| API 変更 | incomingCalls | 影響を受けるエンドポイント |\n\n**レビューフロー**:\n1. 変更ファイルを特定\n2. `LSP.findReferences` で影響範囲を列挙\n3. 影響を受けるファイルも含めてレビュー\n\n**使用例**:\n```\n# 1. 変更された関数の参照箇所を確認\nLSP operation=findReferences filePath=\"src/api/user.ts\" line=42 character=15\n\n# 2. 関数の呼び出し階層を確認\nLSP operation=incomingCalls filePath=\"src/api/user.ts\" line=42 character=15\n\n# 3. 型定義の使用箇所を確認\nLSP operation=findReferences filePath=\"src/types/api.ts\" line=10 character=12\n```\n\n**出力例**:\n```markdown\n🔍 LSP 影響分析結果\n\n変更: updateUserProfile() のシグネチャ変更\n\n影響を受ける箇所:\n├── src/pages/profile.tsx:89 ⚠️ 引数更新必要\n├── src/pages/settings.tsx:145 ⚠️ 引数更新必要\n├── tests/user.test.ts:67 ✅ 更新済み\n└── src/api/admin.ts:23 ⚠️ 引数更新必要\n\n→ 3箇所で引数の更新が必要\n```\n\n> **注**: LSP サーバーが設定されている言語でのみ動作します。\n\n### Step 1: 残コンテキスト確認（Codex モード時）\n\nCodex モード（`review.mode: codex`）の場合は、**残コンテキストが 30%以下なら /compact を先に実行**してください。\n\n> **注意**: /compact 後も余裕が少ない場合は縮退せず続行します。\n\n### Step 2: 過去のレビュー指摘検索（Memory-Enhanced）\n\nClaude-mem が有効な場合、レビュー開始前に過去の類似指摘を検索:\n\n```\n# mem-search で過去のレビュー指摘を検索\nmem-search: type:review \"{変更ファイルのパターン}\"\nmem-search: concepts:security \"{セキュリティ関連のキーワード}\"\nmem-search: concepts:gotcha \"{変更箇所に関連するキーワード}\"\n```\n\n**表示例**:\n\n```markdown\n📚 過去のレビュー指摘（関連あり）\n\n| 日付 | 指摘内容 | ファイル |\n|------|---------|---------|\n| 2024-01-15 | XSS脆弱性: innerHTML 使用禁止 | src/components/*.tsx |\n| 2024-01-20 | N+1クエリ: prefetch 必須 | src/api/*.ts |\n\n💡 今回のレビューで上記パターンを重点チェック\n```\n\n> **注**: Claude-mem が未設定の場合、このステップはスキップされます。\n\n## レビューモードの選択\n\nレビュースキルは 2 つのモードで動作します:\n\n```\n設定確認: .claude-code-harness.config.yaml\n    ↓\n├── review.mode: default → Claude 単体レビュー\n└── review.mode: codex   → Codex 並列レビュー（レビュータイプごとに4エキスパート）\n```\n\n### Default モード（Claude 単体）\n\nClaude が直接レビューを実行。小〜中規模の変更に最適。\n\n### Codex モード（並列エキスパート）\n\nCodex MCP 経由で**レビュータイプに応じた4つのエキスパート**を **個別に並列呼び出し**:\n\n| Review Type | エキスパート |\n|-------------|-------------|\n| **Code Review** | Security, Performance, Quality, Accessibility |\n| **Plan Review** | Clarity, Feasibility, Dependencies, Acceptance |\n| **Scope Review** | Scope-creep, Priority, Feasibility, Impact |\n\n#### ⚠️ Codex モード実行時の必須ルール\n\n**絶対に1回の MCP 呼び出しで複数エキスパートをまとめないこと。**\n\n```\n✅ 正しい: 4回の MCP 呼び出しを1つのレスポンス内で並列実行\n❌ 間違い: 1回の呼び出しで「全観点をレビューして」と依頼\n```\n\n**実行手順**:\n1. **呼び出すエキスパートを判定**（全部ではなく必要なもののみ）:\n   - 設定で `enabled: false` → 除外\n   - CLI/バックエンド → Accessibility, SEO 除外\n   - ドキュメントのみ変更 → Quality, Architect, Plan Reviewer, Scope Analyst を優先（Security, Performance は除外可）\n2. 有効なエキスパートの `experts/*.md` からプロンプトを **個別に読み込む**\n3. 有効なエキスパートのみ `mcp__codex__codex` を **1つのレスポンス内で並列実行**\n4. 各結果を統合して判定\n\n**詳細**: [codex-review/references/codex-parallel-review.md](../codex-review/references/codex-parallel-review.md)\n\n**Codex モード有効化**:\n```bash\n/codex-mode on\n```\n\n**詳細**: [references/codex-integration.md](references/codex-integration.md)\n\n---\n\n## 並列サブエージェント起動（Default モード）\n\n以下の条件を**両方**満たす場合、Task tool で code-reviewer を並列起動:\n\n- レビュー観点 >= 2（例: セキュリティ + パフォーマンス）\n- 変更ファイル >= 5\n\n**起動パターン（1つのレスポンス内で複数の Task tool を同時呼び出し）:**\n\n```\nTask tool 並列呼び出し:\n  #1: subagent_type=\"code-reviewer\"\n      prompt=\"セキュリティ観点でレビュー: {files}\"\n  #2: subagent_type=\"code-reviewer\"\n      prompt=\"パフォーマンス観点でレビュー: {files}\"\n  #3: subagent_type=\"code-reviewer\"\n      prompt=\"コード品質観点でレビュー: {files}\"\n```\n\n**小規模な場合（条件を満たさない）:**\n- 子スキル（doc.md）を順次読み込んで直列実行\n\n---\n\n## 🔧 MCP Code Intelligence ツールの活用\n\nレビューでは MCP ツール（AST-Grep, LSP）を活用して精度を向上します。\n\n> **重要**: `/dev-tools-setup` で MCP サーバーが設定されている場合、標準ツール（Grep, Read）ではなく **MCP ツールを優先使用**してください。MCP ツールは構造的な検索が可能で、より正確な結果を得られます。\n\n### AST-Grep MCP ツール（harness_ast_search）\n\n**構造的なコードパターン検索**に使用します。正規表現ベースの Grep より精度が高く、コードスメル検出に最適です。\n\n| 検出パターン | AST-Grep パターン | 用途 |\n|-------------|------------------|------|\n| Debug logs | `console.log($$$)` | リリース前の残留ログ検出 |\n| Empty catch | `catch ($ERR) { }` | エラー握りつぶし検出 |\n| Unused async | `async function $NAME($$$) { $BODY }` | await なし async 検出 |\n| Magic numbers | 数値リテラル検索 | ハードコード定数検出 |\n\n**使用例**:\n```\nharness_ast_search pattern=\"console.log($$$)\" language=\"typescript\" path=\"src/\"\nharness_ast_search pattern=\"catch ($ERR) { }\" language=\"typescript\" path=\"src/\"\n```\n\n**出力例**:\n```markdown\n🔍 AST-Grep Code Smell Scan\n\nPatterns checked:\n- console.log($$$) → Debug logs\n- catch ($ERR) { } → Empty catch blocks\n\nResults:\n├── 3x console.log found (src/api/*.ts)\n├── 1x empty catch block (src/utils/error.ts:45)\n└── 0x unused async\n```\n\n> **注**: `harness_ast_search` が利用できない場合は、`sg` コマンド（Bash）または Grep にフォールバックします。\n\n---\n\n## 🔧 LSP 機能の活用\n\nレビューでは LSP（Language Server Protocol）を活用して精度を向上します。\n\n> **MCP 版優先**: `harness_lsp_*` MCP ツールが利用可能な場合は、標準 LSP ツールより優先して使用してください。\n\n### LSP をレビューに統合\n\n| レビュー観点 | LSP 活用方法 |\n|-------------|-------------|\n| **品質** | Diagnostics で型エラー・未使用変数を自動検出 |\n| **セキュリティ** | Find-references で機密データの流れを追跡 |\n| **パフォーマンス** | Go-to-definition で重い処理の実装を確認 |\n\n### LSP Diagnostics の出力例\n\n```\n📊 LSP 診断結果\n\n| ファイル | エラー | 警告 |\n|---------|--------|------|\n| src/components/Form.tsx | 0 | 2 |\n| src/utils/api.ts | 1 | 0 |\n\n⚠️ 1件のエラーを検出\n→ レビューで指摘事項に追加\n```\n\n### Find-references による影響分析\n\n```\n🔍 変更影響分析\n\n変更: validateInput()\n\n参照箇所:\n├── src/pages/signup.tsx:34\n├── src/pages/settings.tsx:56\n└── tests/validate.test.ts:12\n\n→ テストでカバー済み ✅\n```\n\n詳細: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n\n---\n\n## VibeCoder 向け\n\n```markdown\n📝 コードチェックを依頼するときの言い方\n\n1. **「チェックして」**\n   - 全体的に問題がないか見てもらう\n\n2. **「セキュリティ大丈夫？」**\n   - 悪意ある攻撃に耐えられるかチェック\n\n3. **「遅くない？」**\n   - 速度に問題がないかチェック\n\n4. **「誰でも使える？」**\n   - 障害のある方でも使えるかチェック\n\n💡 ヒント: 「全部チェックして」と言えば、\n4つの観点すべてを自動で確認します\n```\n",
        "skills/harness-review/references/accessibility-review.md": "---\nname: review-accessibility\ndescription: \"Webアクセシビリティ（a11y）をチェックするスキル。Webアプリケーションのアクセシビリティレビューが要求された場合に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Bash\"]\n---\n\n# Review Accessibility\n\nWeb アクセシビリティ（a11y）をチェックし、WCAG ガイドラインへの準拠を確認するスキル。\n\n---\n\n## 目的\n\n以下のアクセシビリティ問題を検出：\n- セマンティック HTML の使用\n- ARIA 属性の適切な使用\n- キーボード操作対応\n- 色コントラスト\n- スクリーンリーダー対応\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `files` | チェック対象ファイルのリスト |\n| `tech_stack` | フレームワーク（React, Vue など） |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `a11y_issues` | 検出された問題のリスト |\n| `a11y_score` | アクセシビリティスコア (A-F) |\n\n---\n\n## チェック項目\n\n### 1. セマンティック HTML\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| 見出し構造 | h1 → h3 のスキップ | 正しい順序に修正 |\n| ランドマーク | `<div>` のみの使用 | `<nav>`, `<main>`, `<aside>` 使用 |\n| リスト構造 | 手動でのリスト作成 | `<ul>`, `<ol>` 使用 |\n| ボタン | `<div onclick>` | `<button>` 使用 |\n\n### 2. 画像とメディア\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| alt 属性 | 欠落または空 | 意味のある説明を追加 |\n| 装飾画像 | alt に説明 | `alt=\"\"` または `aria-hidden` |\n| 動画 | 字幕なし | キャプション追加 |\n\n### 3. フォーム\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| ラベル | `<label>` 欠落 | `<label for=\"id\">` 追加 |\n| エラーメッセージ | 色のみで表示 | テキストでも表示 |\n| 必須フィールド | 視覚的のみ | `aria-required` 追加 |\n\n### 4. キーボード操作\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| フォーカス管理 | フォーカス不可要素 | `tabindex=\"0\"` 追加 |\n| フォーカス表示 | `outline: none` のみ | 代替スタイル追加 |\n| キーボードトラップ | モーダルからの脱出不可 | ESC キー対応 |\n\n### 5. ARIA\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| 冗長な ARIA | `<button role=\"button\">` | 不要な role 削除 |\n| 無効な ARIA | 存在しない ID 参照 | 正しい ID に修正 |\n| 動的コンテンツ | 変更の通知なし | `aria-live` 追加 |\n\n---\n\n## スコアリング\n\n| スコア | 基準 |\n|--------|------|\n| A | WCAG 2.1 AA 準拠 |\n| B | 軽微な問題のみ |\n| C | 中程度の問題あり |\n| D | 重大なアクセシビリティ問題 |\n| F | 基本的なアクセシビリティ欠如 |\n\n---\n\n## 出力例\n\n```markdown\n## アクセシビリティレビュー結果\n\n**スコア**: C\n\n### 検出された問題\n\n| 重大度 | ファイル | 行 | 問題 | WCAG |\n|--------|---------|-----|------|------|\n| 高 | src/components/Button.tsx | 12 | div を button として使用 | 4.1.2 |\n| 中 | src/components/Image.tsx | 8 | alt 属性が空 | 1.1.1 |\n| 低 | src/components/Modal.tsx | 45 | ESC キーでの閉じる未対応 | 2.1.2 |\n\n### 推奨改善\n\n1. **セマンティックなボタン**\n   ```tsx\n   // Before\n   <div onClick={handleClick} className=\"button\">Click</div>\n\n   // After\n   <button onClick={handleClick} className=\"button\">Click</button>\n   ```\n\n2. **画像の alt 属性**\n   ```tsx\n   // Before\n   <img src={user.avatar} />\n\n   // After\n   <img src={user.avatar} alt={`${user.name}のアバター`} />\n   ```\n```\n\n---\n\n## 注意事項\n\n- WCAG 2.1 AA を基準とする\n- 技術スタック（React/Vue）に応じたチェック\n- 自動チェックで検出できない問題は手動確認を推奨\n",
        "skills/harness-review/references/changes-review.md": "---\nname: review-changes\ndescription: \"自分の変更をセルフレビューし、改善提案を出す。コード変更後のセルフレビューが必要な場合に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Bash\"]\n---\n\n# Review Changes\n\n実装した変更をセルフレビューし、品質を確認するスキル。\nコミット前やハンドオフ前に使用します。\n\n---\n\n## 入力\n\n- **変更ファイル**: git diff で特定された変更\n- **リポジトリコンテキスト**: コーディング規約、既存パターン\n\n---\n\n## 出力\n\n- **レビュー結果**: 各観点での評価\n- **改善提案**: 問題がある場合の修正提案\n\n---\n\n## レビュー観点\n\n### 1. セキュリティ 🔒\n\n- [ ] 機密情報（API キー等）がハードコードされていない\n- [ ] 入力値のバリデーションが適切\n- [ ] SQL インジェクション対策\n- [ ] XSS 対策\n\n### 2. パフォーマンス ⚡\n\n- [ ] 不要な再レンダリングがない\n- [ ] N+1 クエリがない\n- [ ] 重い計算がメモ化されている\n\n### 3. コード品質 📐\n\n- [ ] 型が適切に定義されている\n- [ ] エラーハンドリングがある\n- [ ] 命名が適切\n- [ ] 不要なコード・コメントがない\n\n### 4. 一貫性 🎨\n\n- [ ] 既存のコーディングスタイルに従っている\n- [ ] ファイル構成が適切\n- [ ] import の順序が統一されている\n\n---\n\n## 実行手順\n\n### Step 1: 変更の確認\n\n```bash\n# 変更ファイル一覧\ngit diff --name-only HEAD~5\n\n# 変更内容\ngit diff\n```\n\n### Step 2: 各観点でのチェック\n\n#### セキュリティチェック\n\n```bash\n# ハードコードされた機密情報を探す\ngrep -rn \"sk-\\|api_key\\|password\\|secret\" --include=\"*.ts\" --include=\"*.tsx\" | grep -v \".env\"\n```\n\n#### パフォーマンスチェック\n\n```typescript\n// 問題のパターンを探す\n// - useEffect の依存配列の問題\n// - 毎レンダリングで新しいオブジェクト生成\n// - 巨大な配列の filter/map チェーン\n```\n\n#### コード品質チェック\n\n```bash\n# TypeScript エラー\nnpx tsc --noEmit\n\n# ESLint\nnpx eslint src/ --ext .ts,.tsx\n```\n\n### Step 3: レビュー結果の生成\n\n```markdown\n## 📊 セルフレビュー結果\n\n**対象**: {{変更ファイル数}} ファイル\n**総合評価**: {{A / B / C}}\n\n### 観点別評価\n\n| 観点 | 評価 | 備考 |\n|------|------|------|\n| セキュリティ | ✅ OK | - |\n| パフォーマンス | ⚠️ 要確認 | {{詳細}} |\n| コード品質 | ✅ OK | - |\n| 一貫性 | ✅ OK | - |\n\n### 改善が必要な箇所\n\n1. **{{ファイル:行}}**\n   - 問題: {{問題の説明}}\n   - 改善案: {{具体的な修正方法}}\n\n### 自動修正可能な項目\n\n- [ ] ESLint の自動修正\n- [ ] Prettier の適用\n```\n\n### Step 4: 改善の適用（任意）\n\n```bash\n# ESLint 自動修正\nnpx eslint --fix src/\n\n# Prettier 適用\nnpx prettier --write src/\n```\n\n---\n\n## 評価基準\n\n| 評価 | 意味 | アクション |\n|------|------|-----------|\n| A | 問題なし | コミット可能 |\n| B | 軽微な問題あり | 修正推奨だが続行可 |\n| C | 重大な問題あり | 修正必須 |\n\n---\n\n## よくある問題と修正\n\n### any 型の使用\n\n```typescript\n// ❌ 問題\nfunction process(data: any) { ... }\n\n// ✅ 修正\ninterface DataType { ... }\nfunction process(data: DataType) { ... }\n```\n\n### 未処理の Promise\n\n```typescript\n// ❌ 問題\nfetchData()\n\n// ✅ 修正\nfetchData().catch(console.error)\n// または\nawait fetchData()\n```\n\n### 不要な再レンダリング\n\n```typescript\n// ❌ 問題\nconst items = data.filter(x => x.active).map(x => x.name)\n\n// ✅ 修正\nconst items = useMemo(() =>\n  data.filter(x => x.active).map(x => x.name),\n  [data]\n)\n```\n\n---\n\n## 完了後のアクション\n\n```markdown\n## ✅ セルフレビュー完了\n\n**評価**: {{A / B / C}}\n\n{{問題なしの場合}}\nコミットの準備ができました。\n「コミットして」と言ってください。\n\n{{問題ありの場合}}\n上記の改善を適用しますか？\n```\n\n---\n\n## 注意事項\n\n- **完璧を目指さない**: 80% で十分\n- **自動ツールを活用**: 手動チェックは最小限に\n- **レビューは任意**: スキップしてコミットも可能\n",
        "skills/harness-review/references/codex-integration.md": "---\nname: codex-integration\ndescription: \"レビュースキルへの Codex セカンドオピニオン統合手順\"\nallowed-tools: [\"Read\", \"Bash\"]\n---\n\n# Codex 統合レビュー\n\n既存のレビューフローに Codex のセカンドオピニオンを統合する手順。\n\n---\n\n## 🎯 概要\n\nCodex MCP が有効な場合、Claude のレビューに加えて Codex からもレビューを取得し、結果を統合して表示します。\n\n```\n/harness-review 実行\n    ↓\n設定確認: review.codex.enabled\n    │\n    ├── false → Claude 単独レビュー（従来通り）\n    │\n    └── true → Codex 統合レビュー\n            │\n            ├── Claude レビュー（並列）\n            └── Codex MCP 呼び出し（並列）\n                    ↓\n            結果統合 → 出力\n```\n\n---\n\n## 実行フロー\n\n### Step 1: 設定確認\n\n`.claude-code-harness.config.yaml` を確認:\n\n```yaml\nreview:\n  codex:\n    enabled: true   # これが true の場合のみ Codex 統合\n    auto: false     # false の場合は確認を求める\n```\n\n### Step 2: 確認プロンプト（auto: false の場合）\n\n```markdown\n🤖 Codex セカンドオピニオン\n\nCodex にもレビューを依頼しますか？\n- Claude と Codex の両方でレビューし、結果を統合します\n- 追加で数秒〜数十秒かかります\n\n[Y] はい / [N] いいえ\n```\n\n### Step 3: 並列レビュー実行\n\n**Claude レビュー（従来通り）**:\n- 品質判定ゲート\n- 変更ファイル分析\n- 重点領域のレビュー\n\n**Codex MCP 呼び出し（並列）**:\n```\nMCP 呼び出し: mcp__codex__*\n    prompt: \"{設定ファイルのプロンプト}\"\n    files: \"{変更ファイル一覧}\"\n```\n\n### Step 4: 結果統合\n\n両方のレビュー結果を統合して表示:\n\n```markdown\n## 📊 統合レビュー結果\n\n### Claude のレビュー\n\n| 観点 | 指摘数 | 重要度 |\n|------|--------|--------|\n| セキュリティ | 1 | 高 |\n| 品質 | 3 | 中 |\n| パフォーマンス | 0 | - |\n\n**主な指摘**:\n1. [高] SQL インジェクションの可能性 (src/api/users.ts:45)\n2. [中] 未使用の import (src/components/Form.tsx:3)\n3. ...\n\n---\n\n### Codex のレビュー（セカンドオピニオン）\n\n| 観点 | 指摘数 |\n|------|--------|\n| コードスタイル | 2 |\n| 設計パターン | 1 |\n\n**主な指摘**:\n1. 関数が長すぎる（50行超）→ 分割を推奨\n2. 命名規則の不統一（camelCase と snake_case の混在）\n3. Strategy パターンの適用を検討\n\n---\n\n### 統合サマリ\n\n| 観点 | Claude | Codex | アクション |\n|------|--------|-------|-----------|\n| セキュリティ | ⚠️ 1件 | - | **対応必須** |\n| コードスタイル | - | 2件 | 推奨 |\n| 設計 | - | 1件 | 検討 |\n| 品質 | 3件 | - | 推奨 |\n```\n\n---\n\n## フォールバック処理\n\n### Codex MCP エラー時\n\n```markdown\n⚠️ Codex レビューがスキップされました\n\n理由: MCP 接続エラー\n詳細: Connection timeout after 30s\n\nClaude のレビュー結果のみを表示します。\n```\n\n**対応**:\n1. Claude のレビュー結果はそのまま表示\n2. エラーをログに記録\n3. 次回実行時の参考情報を表示\n\n### Codex 認証切れ\n\n```markdown\n⚠️ Codex 認証が必要です\n\n以下のコマンドで再認証してください:\n\\`\\`\\`bash\ncodex login\n\\`\\`\\`\n```\n\n---\n\n## パフォーマンス考慮\n\n### 大規模変更時\n\n変更ファイルが多い場合（10ファイル超）:\n\n1. **チャンク分割**: 5ファイルずつに分割して Codex に送信\n2. **優先度付け**: 変更行数の多いファイルを優先\n3. **タイムアウト**: 60秒でタイムアウト、部分結果を表示\n\n### 並列実行の最適化\n\n```\nClaude レビュー ─────┐\n                     ├──→ 結果統合\nCodex MCP 呼び出し ─┘\n\n最大待機時間: max(Claude, Codex) ≈ Codex 待機時間\n```\n\n---\n\n## VibeCoder 向け\n\n```markdown\n💡 セカンドオピニオンの使い方\n\n**言い方**:\n- 「他の AI にも見てもらって」\n- 「Codex にもチェックさせて」\n- 「ダブルチェックして」\n\n**結果の見方**:\n- Claude と Codex で同じ指摘 → 確実に対応が必要\n- 片方だけの指摘 → 内容を確認して判断\n- 矛盾する指摘 → 両方の理由を確認\n```\n\n---\n\n## 関連ドキュメント\n\n- [codex-review/SKILL.md](../../codex-review/SKILL.md) - Codex 統合スキル\n- [codex-mcp-setup.md](../../codex-review/references/codex-mcp-setup.md) - セットアップ手順\n",
        "skills/harness-review/references/commit-judgment-logic.md": "# コミット判定ロジック\n\nharness-review の最終判定（APPROVE / REQUEST CHANGES / REJECT）を出力するためのロジック。\n\n## 判定基準\n\n| 判定 | 条件 | 次のアクション |\n|------|------|---------------|\n| **APPROVE** | Critical: 0, High: 0, Medium: ≤3 | コミット OK |\n| **REQUEST CHANGES** | Critical: 0, High: ≥1 または Medium: >3 | 自動修正 → 再判定 |\n| **REJECT** | Critical: ≥1 | 手動対応必要 |\n\n### Severity 定義\n\n| Severity | 定義 | 例 |\n|----------|------|-----|\n| **Critical** | セキュリティ脆弱性、データ損失リスク | SQL インジェクション、認証バイパス |\n| **High** | 重大なバグ、パフォーマンス問題 | 無限ループ、N+1 クエリ |\n| **Medium** | コード品質問題、ベストプラクティス違反 | 未使用変数、不適切な命名 |\n| **Low** | スタイル、軽微な改善提案 | フォーマット、コメント追加 |\n\n## 判定フロー\n\n```\nレビュー結果収集\n    ↓\nSeverity 集計\n    ├── Critical >= 1 → REJECT\n    ├── High >= 1 || Medium > 3 → REQUEST CHANGES\n    └── それ以外 → APPROVE\n    ↓\n判定出力\n```\n\n## 出力形式\n\n### APPROVE\n\n```markdown\n## 🚦 コミット判定: APPROVE ✅\n\n**判定理由**: 重大な問題なし\n\n| Severity | 件数 |\n|----------|------|\n| Critical | 0 |\n| High | 0 |\n| Medium | 2 |\n| Low | 5 |\n\n📝 **Low/Medium の指摘**（任意対応）:\n- [Medium] `src/utils/helpers.ts:45` - 未使用の import\n- [Medium] `src/components/Form.tsx:78` - any 型の使用\n\n**次のアクション**: `git commit` でコミット可能です\n```\n\n### REQUEST CHANGES\n\n```markdown\n## 🚦 コミット判定: REQUEST CHANGES 🟡\n\n**判定理由**: 修正可能な問題あり\n\n| Severity | 件数 |\n|----------|------|\n| Critical | 0 |\n| High | 2 |\n| Medium | 4 |\n| Low | 3 |\n\n📝 **修正が必要な項目**:\n\n| # | Severity | ファイル | 内容 | 修正案 |\n|---|----------|---------|------|--------|\n| 1 | High | `src/api/users.ts:34` | N+1 クエリ | `include` で事前取得 |\n| 2 | High | `src/pages/login.tsx:56` | XSS 脆弱性 | `sanitize()` を追加 |\n\n**自動修正を実行しますか？** [Y/N]\n\n> 自動修正後、再度レビューを実行して判定します（最大3回）\n```\n\n### REJECT\n\n```markdown\n## 🚦 コミット判定: REJECT ❌\n\n**判定理由**: 重大なセキュリティ問題\n\n| Severity | 件数 |\n|----------|------|\n| Critical | 1 |\n| High | 3 |\n| Medium | 2 |\n| Low | 1 |\n\n🚨 **Critical な問題**:\n\n| # | ファイル | 内容 | 影響 |\n|---|---------|------|------|\n| 1 | `src/api/auth.ts:45` | SQL インジェクション | データ漏洩リスク |\n\n**手動対応が必要です**:\n1. 上記の Critical 問題を修正\n2. 再度 `/harness-review` を実行\n\n> ⚠️ 自動修正は Critical 問題には対応しません（安全のため）\n```\n\n## 自動修正ループ\n\nREQUEST CHANGES 判定時の自動修正フロー:\n\n```\nREQUEST CHANGES 判定\n    ↓\n修正案を生成\n    ↓\nClaude が修正実行\n    ↓\n再度レビュー → 判定\n    │\n    ├── APPROVE → 完了\n    ├── REQUEST CHANGES → ループ（最大3回）\n    └── REJECT → 手動対応\n```\n\n### リトライ上限到達時\n\n```markdown\n## ⚠️ 自動修正上限に到達\n\n3回の自動修正を試みましたが、以下の問題が残っています:\n\n| # | Severity | ファイル | 内容 |\n|---|----------|---------|------|\n| 1 | High | `src/api/users.ts:34` | N+1 クエリ |\n\n**推奨アクション**:\n1. 手動で上記を修正\n2. 再度 `/harness-review` を実行\n\n> 💡 複雑な問題は自動修正が困難な場合があります\n```\n\n## Codex モードとの統合\n\nCodex モード時は、レビュータイプに応じた4つのエキスパートからの指摘を集約して判定:\n\n```\nCodex 並列レビュー（レビュータイプごとに4エキスパート）\n\nCode Review:\n    ├── Security Expert → findings[]\n    ├── Performance Expert → findings[]\n    ├── Quality Expert → findings[]\n    └── Accessibility Expert → findings[]\n\nPlan Review:\n    ├── Clarity Expert → findings[]\n    ├── Feasibility Expert → findings[]\n    ├── Dependencies Expert → findings[]\n    └── Acceptance Expert → findings[]\n\nScope Review:\n    ├── Scope-creep Expert → findings[]\n    ├── Priority Expert → findings[]\n    ├── Feasibility Expert → findings[]\n    └── Impact Expert → findings[]\n\n    ↓\n全 findings を Severity で集計\n    ↓\n判定基準に基づいて判定\n```\n\n## 設定による制御\n\n`.claude-code-harness.config.yaml`:\n\n```yaml\nreview:\n  judgment:\n    enabled: true      # 判定を出力するか\n    auto_fix: true     # REQUEST CHANGES 時に自動修正\n    max_retries: 3     # 自動修正の最大回数\n```\n\n## 関連ファイル\n\n- `skills/harness-review/SKILL.md` - レビュースキル本体\n- `skills/codex-review/references/codex-parallel-review.md` - Codex 並列呼び出し\n- `commands/optional/codex-mode.md` - Codex モード切り替え\n",
        "skills/harness-review/references/determine-review-mode.md": "---\nname: determine-review-mode\ndescription: \"Determine review mode (default/codex) from .claude-code-harness.config.yaml. Falls back to 'default' if Codex is not configured or enabled.\"\nallowed-tools: [\"Read\"]\n---\n\n# Determine Review Mode\n\n`.claude-code-harness.config.yaml`からレビューモードを決定し、Codex未設定時は`default`にフォールバックするスキル。\n\n---\n\n## 入力\n\n- **config_file**: 設定ファイルのコンテキスト（任意）\n\n---\n\n## 出力\n\n```json\n{\n  \"review_mode\": \"default\"\n}\n```\n\nまたは、Codexが有効な場合：\n\n```json\n{\n  \"review_mode\": \"codex\"\n}\n```\n\n---\n\n## 実行手順\n\n### Step 1: 設定ファイルの読み込み\n\n```bash\n# config_file が存在する場合は読み込む\n# 存在しない場合は default にフォールバック\n```\n\n### Step 2: レビューモードの確認\n\n設定ファイルの構造：\n\n```yaml\nreview:\n  mode: codex  # または \"default\"\n  codex:\n    enabled: true  # または false\n```\n\n### Step 3: 判定ロジック\n\n```javascript\n// 疑似コード例\nlet review_mode = \"default\";\n\n// 1. review.modeを確認\nif (config.review?.mode === \"codex\") {\n  // 2. review.codex.enabledを確認\n  if (config.review?.codex?.enabled === true) {\n    // 3. Codex MCPサーバーが利用可能か確認（オプション）\n    // ここでは設定ファイルの値のみを信頼\n    review_mode = \"codex\";\n  }\n}\n\n// デフォルトは \"default\"\nreturn { review_mode };\n```\n\n### Step 4: フォールバック条件\n\n以下の場合は`default`にフォールバック：\n\n1. `config_file` が存在しない\n2. `review.mode`が未設定または`default`\n3. `review.mode`が`codex`だが`review.codex.enabled`が`false`\n4. `review.codex.enabled`が未設定\n\n---\n\n## 使用例\n\n### 例1: Codex有効\n\n**設定ファイル**:\n```yaml\nreview:\n  mode: codex\n  codex:\n    enabled: true\n```\n\n**出力**:\n```json\n{\n  \"review_mode\": \"codex\"\n}\n```\n\n### 例2: Codex無効\n\n**設定ファイル**:\n```yaml\nreview:\n  mode: codex\n  codex:\n    enabled: false\n```\n\n**出力**:\n```json\n{\n  \"review_mode\": \"default\"\n}\n```\n\n### 例3: 設定ファイル未設定\n\n**設定ファイル**: 存在しない、または`review`セクションなし\n\n**出力**:\n```json\n{\n  \"review_mode\": \"default\"\n}\n```\n\n---\n\n## 注意事項\n\n- **安全側に倒す**: Codex設定が不明確な場合は`default`にフォールバック\n- **設定ファイルの優先**: 環境変数などではなく、設定ファイルの値を優先する\n- **MCPサーバー確認**: 実装時は`claude mcp list`でCodex MCPサーバーの存在も確認可能（オプション）\n",
        "skills/harness-review/references/performance-review.md": "---\nname: review-performance\ndescription: \"コードのパフォーマンス問題をチェックするスキル。パフォーマンスレビューが要求された場合、レスポンスが遅いと報告された場合、または大量のデータ処理を行うコードの変更時に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Review Performance\n\nコードのパフォーマンス問題を検出し、改善提案を行うスキル。\n\n---\n\n## 目的\n\n以下のパフォーマンス問題を検出：\n- 非効率なアルゴリズム\n- 不要な再レンダリング\n- N+1 クエリ問題\n- メモリリーク\n- 重い処理のブロッキング\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `files` | チェック対象ファイルのリスト |\n| `code_content` | ファイルの内容 |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `performance_issues` | 検出された問題のリスト |\n| `performance_score` | パフォーマンススコア (A-F) |\n\n---\n\n## チェック項目\n\n### 1. フロントエンド（React/Vue）\n\n| チェック | 問題 | 対策 |\n|---------|------|------|\n| 不要な再レンダリング | `useCallback`, `useMemo` 未使用 | メモ化の追加 |\n| 大きなリストの非仮想化 | 1000+ アイテムの直接レンダリング | 仮想スクロール導入 |\n| 重い計算の同期実行 | レンダリングブロック | Web Worker 使用 |\n| バンドルサイズ | 大きな依存関係のインポート | 動的インポート |\n\n### 2. バックエンド（API）\n\n| チェック | 問題 | 対策 |\n|---------|------|------|\n| N+1 クエリ | ループ内でのDBクエリ | Eager loading |\n| インデックス未使用 | 大量データのフルスキャン | インデックス追加 |\n| 同期I/O | ファイル操作のブロッキング | async/await 使用 |\n| キャッシュ未使用 | 頻繁な同一クエリ | Redis キャッシュ |\n\n### 3. 一般\n\n| チェック | 問題 | 対策 |\n|---------|------|------|\n| O(n²) アルゴリズム | ネストしたループ | より効率的なアルゴリズム |\n| 文字列連結 | ループ内での `+=` | 配列 + join |\n| 正規表現の非効率 | 毎回のコンパイル | 事前コンパイル |\n\n---\n\n## スコアリング\n\n| スコア | 基準 |\n|--------|------|\n| A | 問題なし、最適化済み |\n| B | 軽微な改善余地あり |\n| C | 中程度の問題あり |\n| D | 明らかなボトルネックあり |\n| F | 深刻なパフォーマンス問題 |\n\n---\n\n## 出力例\n\n```markdown\n## パフォーマンスレビュー結果\n\n**スコア**: C\n\n### 検出された問題\n\n| 重大度 | ファイル | 行 | 問題 |\n|--------|---------|-----|------|\n| 高 | src/api/posts.ts | 23 | N+1 クエリ問題 |\n| 中 | src/components/List.tsx | 45 | 1500件の非仮想化リスト |\n| 低 | src/utils/search.ts | 12 | O(n²) の検索アルゴリズム |\n\n### 推奨対策\n\n1. **N+1 クエリ問題**\n   ```typescript\n   // Before\n   for (const post of posts) {\n     const author = await getAuthor(post.authorId);\n   }\n\n   // After\n   const posts = await getPosts({ include: ['author'] });\n   ```\n\n2. **仮想スクロール導入**\n   - react-window または react-virtualized を使用\n```\n\n---\n\n## 注意事項\n\n- 早期最適化は避け、実際のボトルネックを優先\n- 測定可能な改善効果を示す\n- トレードオフ（可読性 vs パフォーマンス）を考慮\n",
        "skills/harness-review/references/quality-review.md": "---\nname: review-quality\ndescription: \"コード品質（可読性、保守性、ベストプラクティス）をチェックするスキル。コードレビューが要求された場合、リファクタリング後、または複雑なロジックの実装後に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Review Quality\n\nコードの品質（可読性、保守性、ベストプラクティス）をチェックするスキル。\n\n---\n\n## 目的\n\n以下の観点でコード品質を評価：\n- 可読性（命名、構造、コメント）\n- 保守性（モジュール性、依存関係）\n- ベストプラクティス準拠\n- コーディング規約準拠\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `files` | チェック対象ファイルのリスト |\n| `code_content` | ファイルの内容 |\n| `eslint_output` | ESLint/Linter の出力（あれば） |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `quality_issues` | 検出された問題のリスト |\n| `quality_score` | 品質スコア (A-F) |\n\n---\n\n## チェック項目\n\n### 1. 可読性\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| 命名 | `x`, `tmp`, `data` などの曖昧な名前 | 意味のある名前に変更 |\n| 関数の長さ | 50行以上の関数 | 小さな関数に分割 |\n| ネスト深度 | 4段階以上のネスト | 早期リターン、関数抽出 |\n| マジックナンバー | 直書きの数値 | 定数化 |\n\n### 2. 保守性\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| 重複コード | 同じロジックの繰り返し | 共通関数に抽出 |\n| 密結合 | 直接的な依存関係 | 依存性注入、インターフェース |\n| グローバル状態 | グローバル変数の多用 | スコープの限定 |\n| 未使用コード | 使われていない変数・関数 | 削除 |\n\n### 3. ベストプラクティス\n\n| チェック | 問題 | 改善 |\n|---------|------|------|\n| エラーハンドリング | 空の catch ブロック | 適切なエラー処理 |\n| 型安全性 | any 型の多用 | 適切な型定義 |\n| 非同期処理 | コールバック地獄 | async/await |\n| テスタビリティ | テストしにくい構造 | 依存性注入 |\n\n---\n\n## スコアリング\n\n| スコア | 基準 |\n|--------|------|\n| A | クリーンコード、問題なし |\n| B | 軽微な改善余地 |\n| C | 中程度の問題あり |\n| D | 可読性・保守性に問題 |\n| F | 深刻な品質問題 |\n\n---\n\n## 出力例\n\n```markdown\n## コード品質レビュー結果\n\n**スコア**: B\n\n### 検出された問題\n\n| 重大度 | ファイル | 行 | 問題 |\n|--------|---------|-----|------|\n| 中 | src/services/user.ts | 45 | 関数が長すぎる (78行) |\n| 低 | src/utils/helpers.ts | 12 | 未使用の import |\n| 低 | src/api/posts.ts | 89 | マジックナンバー使用 |\n\n### 推奨改善\n\n1. **長い関数の分割**\n   - `processUserData` 関数を以下に分割:\n     - `validateUserInput()`\n     - `formatUserData()`\n     - `saveUser()`\n\n2. **未使用コードの削除**\n   - `import { unused } from './utils'` を削除\n\n3. **定数化**\n   ```typescript\n   // Before\n   if (retryCount > 3) { ... }\n\n   // After\n   const MAX_RETRY_COUNT = 3;\n   if (retryCount > MAX_RETRY_COUNT) { ... }\n   ```\n```\n\n---\n\n### 4. クロスプラットフォーム\n\n| チェック | 問題 | 重大度 | 改善 |\n|---------|------|--------|------|\n| レスポンシブ未対応 | 固定幅（`width: 1200px`）、viewport meta 未設定 | 中 | `max-width` + メディアクエリ |\n| スクロールバー問題 | `100vw` 使用による横スクロール | 低 | `100%` または `calc(100vw - スクロールバー幅)` |\n| 長文入力未対応 | overflow/truncate 未設定で UI 崩れ | 低 | `overflow-hidden`, `text-overflow: ellipsis` |\n| フォント未指定 | system-ui/font-family 未設定 | 低 | システムフォントスタック指定 |\n| タッチターゲット | 小さすぎるボタン（< 44px） | 中 | 最小 44x44px |\n\n**検出パターン**:\n```css\n/* ❌ 問題: 固定幅 */\n.container { width: 1200px; }\n\n/* ✅ 改善: レスポンシブ */\n.container { max-width: 1200px; width: 100%; }\n\n/* ❌ 問題: 100vw（スクロールバーで崩れる） */\n.full-width { width: 100vw; }\n\n/* ✅ 改善 */\n.full-width { width: 100%; }\n```\n\n### 5. Web 基盤チェック\n\n| チェック | 問題 | 重大度 | 改善 |\n|---------|------|--------|------|\n| favicon 未設定 | ブラウザタブにアイコンなし | 低 | `<link rel=\"icon\">` 追加 |\n| apple-touch-icon 未設定 | iOS ホーム画面追加時のアイコンなし | 低 | `<link rel=\"apple-touch-icon\">` 追加 |\n| 404/5xx ページ | デフォルトエラーページ | 低 | カスタムエラーページ作成 |\n| lang 属性未設定 | `<html>` に lang なし | 低 | `<html lang=\"ja\">` 追加 |\n| charset 未設定 | 文字化けリスク | 低 | `<meta charset=\"UTF-8\">` 追加 |\n\n**検出パターン**:\n```html\n<!-- ❌ 問題: 基本設定なし -->\n<html>\n<head>\n  <title>My App</title>\n</head>\n\n<!-- ✅ 改善: 基本設定あり -->\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <link rel=\"icon\" href=\"/favicon.ico\">\n  <link rel=\"apple-touch-icon\" href=\"/apple-touch-icon.png\">\n  <title>My App</title>\n</head>\n```\n\n### 6. LocalStorage / Cookie 管理\n\n| チェック | 問題 | 重大度 | 改善 |\n|---------|------|--------|------|\n| 有効期限なし | 永続的なデータ保存 | 低 | 適切な有効期限設定（7日推奨） |\n| サードパーティ Cookie 依存 | ブロックされる可能性 | 中 | ファーストパーティへ移行 |\n| 機密情報の保存 | LocalStorage にトークン等 | 中 | HttpOnly Cookie へ移行 |\n\n---\n\n## 注意事項\n\n- プロジェクトの既存スタイルを尊重する\n- 過度な改善提案は避ける\n- 優先度を付けて報告する\n- フレームワーク固有の機能を考慮する（Next.js App Router, Remix, etc.）\n",
        "skills/harness-review/references/security-review.md": "---\nname: review-security\ndescription: \"コードのセキュリティ脆弱性をチェックするスキル。セキュリティレビューが要求された場合、本番デプロイ前、または機密情報を扱うコードの変更時に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Review Security\n\nコードのセキュリティ脆弱性をチェックし、問題を報告するスキル。\n\n---\n\n## 目的\n\nOWASP Top 10 を含む一般的なセキュリティ脆弱性を検出：\n- インジェクション攻撃（SQL, コマンド, XSS）\n- 認証・認可の問題\n- 機密データの露出\n- セキュリティの設定ミス\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `files` | チェック対象ファイルのリスト |\n| `code_content` | ファイルの内容 |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `security_issues` | 検出された問題のリスト |\n| `security_score` | セキュリティスコア (A-F) |\n\n---\n\n## チェック項目\n\n### 1. インジェクション\n\n| チェック | 検出対象 |\n|---------|----------|\n| SQL インジェクション | 文字列連結でのクエリ構築 |\n| コマンドインジェクション | 安全でないコマンド実行関数の使用 |\n| XSS | 未サニタイズのHTML出力 |\n\n### 2. 認証・認可\n\n| チェック | 検出対象 |\n|---------|----------|\n| ハードコードされた認証情報 | パスワード、APIキーの直書き |\n| 弱い認証 | 平文パスワード保存 |\n| 認可チェック漏れ | 権限確認なしのリソースアクセス |\n\n### 3. 機密データ\n\n| チェック | 検出対象 |\n|---------|----------|\n| 機密情報のログ出力 | パスワード、トークンのログ |\n| 安全でない通信 | HTTP での機密データ送信 |\n| .env ファイルのコミット | git に含まれる機密ファイル |\n\n### 4. 設定ミス\n\n| チェック | 検出対象 |\n|---------|----------|\n| デバッグモード有効 | 本番での DEBUG=true |\n| CORS 設定ミス | 過度に寛容なオリジン設定 |\n| セキュリティヘッダー欠如 | CSP, X-Frame-Options の未設定 |\n\n---\n\n## スコアリング\n\n| スコア | 基準 |\n|--------|------|\n| A | 問題なし |\n| B | 軽微な問題 1-2 件 |\n| C | 中程度の問題あり |\n| D | 重大な問題あり |\n| F | クリティカルな脆弱性あり |\n\n---\n\n## 出力例\n\n```markdown\n## セキュリティレビュー結果\n\n**スコア**: B\n\n### 検出された問題\n\n| 重大度 | ファイル | 行 | 問題 |\n|--------|---------|-----|------|\n| 中 | src/api/users.ts | 45 | SQL インジェクションの可能性 |\n| 低 | src/config.ts | 12 | ハードコードされた API URL |\n\n### 推奨対策\n\n1. **SQL インジェクション対策**\n   - プレースホルダーを使用したクエリに変更\n   - ORM のパラメータバインディングを活用\n\n2. **設定の外部化**\n   - API URL を環境変数に移動\n```\n\n---\n\n### 5. Cookie セキュリティ\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| HttpOnly 未設定 | 認証 Cookie が JS からアクセス可能（`document.cookie` で読める） | 高 |\n| SameSite 未設定/None | CSRF 脆弱性のリスク、クロスサイトリクエスト許可 | 高 |\n| Secure 未設定 | HTTP 経由での Cookie 送信（盗聴リスク） | 高 |\n| Domain 過度に広い | サブドメイン間での不正アクセス（`.example.com` 等） | 中 |\n| 有効期限が長すぎる | セッション Cookie に長期 Expires 設定 | 中 |\n\n**検出パターン**:\n```typescript\n// ❌ 問題のある設定\nres.cookie('session', token);  // オプションなし\nres.cookie('auth', token, { httpOnly: false });\ndocument.cookie = \"session=...\";  // クライアントサイドでの設定\n\n// ✅ 安全な設定\nres.cookie('session', token, {\n  httpOnly: true,\n  secure: true,\n  sameSite: 'strict',\n  domain: 'example.com'  // 明示的に制限\n});\n```\n\n### 6. レスポンスヘッダー\n\n| ヘッダー | 必須度 | 検出対象 | 効果 |\n|---------|--------|----------|------|\n| `Strict-Transport-Security` | 必須 | HSTS 未設定（HTTP ダウングレード攻撃） | HTTPS 強制 |\n| `X-Content-Type-Options: nosniff` | 必須 | MIME スニッフィング許可 | XSS 防止 |\n| `Content-Security-Policy` | 推奨 | CSP 未設定（インラインスクリプト許可） | XSS 防止 |\n| `X-Frame-Options` / CSP `frame-ancestors` | 推奨 | フレーム埋め込み許可 | クリックジャッキング防止 |\n| `Referrer-Policy` | 推奨 | 未設定（リファラ漏洩） | プライバシー保護 |\n\n**検出パターン**:\n```typescript\n// チェック対象: レスポンスヘッダー設定箇所\n// - middleware.ts\n// - server.ts / app.ts\n// - next.config.js (headers)\n// - vercel.json / netlify.toml\n\n// ❌ 問題: ヘッダー未設定\napp.use((req, res, next) => next());\n\n// ✅ 推奨: セキュリティヘッダー設定\napp.use(helmet());  // または個別設定\nres.setHeader('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');\nres.setHeader('X-Content-Type-Options', 'nosniff');\nres.setHeader('X-Frame-Options', 'DENY');\n```\n\n### 7. リダイレクト・ファイルアップロード\n\n#### オープンリダイレクト\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| 未検証リダイレクト | ユーザー入力を直接 `redirect()` に渡す | 高 |\n| URL パラメータの利用 | `?returnUrl=` `?next=` `?redirect=` | 高 |\n| 外部ドメインへのリダイレクト | 許可リストなしでの外部リダイレクト | 高 |\n\n**検出パターン**:\n```typescript\n// ❌ 危険: 未検証リダイレクト\nconst returnUrl = req.query.returnUrl;\nres.redirect(returnUrl);\n\n// ✅ 安全: ホワイトリスト検証\nconst allowedHosts = ['example.com', 'app.example.com'];\nconst url = new URL(returnUrl, 'https://example.com');\nif (allowedHosts.includes(url.hostname)) {\n  res.redirect(returnUrl);\n}\n```\n\n#### ファイルアップロード\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| MIME タイプ未検証 | Content-Type のみ信頼（偽装可能） | 高 |\n| 拡張子未検証 | `.php`, `.exe` 等の危険な拡張子許可 | 高 |\n| ファイルサイズ未検証 | 無制限アップロード（DoS リスク） | 中 |\n| パストラバーサル | `../` を含むファイル名の未サニタイズ | 高 |\n| マジックバイト未検証 | ファイルヘッダーの検証なし | 中 |\n\n**検出パターン**:\n```typescript\n// ❌ 危険: 未検証アップロード\napp.post('/upload', (req, res) => {\n  const file = req.files.upload;\n  file.mv(`./uploads/${file.name}`);  // パストラバーサル可能\n});\n\n// ✅ 安全: 複数層の検証\nconst allowedMimeTypes = ['image/jpeg', 'image/png', 'application/pdf'];\nconst allowedExtensions = ['.jpg', '.jpeg', '.png', '.pdf'];\nconst maxFileSize = 10 * 1024 * 1024;  // 10MB\n\n// 1. サイズチェック\nif (file.size > maxFileSize) throw new Error('File too large');\n\n// 2. 拡張子チェック\nconst ext = path.extname(file.name).toLowerCase();\nif (!allowedExtensions.includes(ext)) throw new Error('Invalid extension');\n\n// 3. MIME タイプチェック（マジックバイト推奨）\nif (!allowedMimeTypes.includes(file.mimetype)) throw new Error('Invalid type');\n\n// 4. ファイル名サニタイズ\nconst safeName = crypto.randomUUID() + ext;\n```\n\n### 8. 決済セキュリティ\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| 重複課金 | 冪等性キーの未使用 | 高 |\n| 金額改ざん | クライアントサイドでの金額決定 | 高 |\n| 状態不整合 | 決済プロバイダとアプリ状態の不一致 | 高 |\n| Webhook 未検証 | 署名検証なしの Webhook 処理 | 高 |\n\n**検出パターン**:\n```typescript\n// ❌ 危険: クライアントから金額を受け取る\nconst { amount, productId } = req.body;\nawait stripe.paymentIntents.create({ amount });\n\n// ✅ 安全: サーバーサイドで金額を決定\nconst product = await db.products.findUnique({ where: { id: productId } });\nawait stripe.paymentIntents.create({\n  amount: product.price,\n  idempotencyKey: `order_${orderId}`  // 冪等性キー\n});\n\n// ✅ Webhook 署名検証\nconst sig = req.headers['stripe-signature'];\nconst event = stripe.webhooks.constructEvent(req.body, sig, webhookSecret);\n```\n\n---\n\n## 注意事項\n\n- false positive を減らすためコンテキストを考慮する\n- セキュリティ問題は優先度高で報告する\n- 修正方法も合わせて提示する\n- フレームワーク固有のセキュリティ機能を考慮する（Next.js, Express, etc.）\n",
        "skills/harness-review/references/seo-review.md": "---\nname: review-seo\ndescription: \"SEO・OGP・メタ情報をチェックするスキル。ローンチ前レビュー、ページ追加時、またはSEO最適化が要求された場合に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Review SEO & OGP\n\nSEO 最適化と OGP タグをチェックし、検索エンジン・SNS シェア品質を向上するスキル。\n\n---\n\n## 目的\n\n以下の観点で SEO/OGP を評価：\n- 検索エンジン最適化（title, description, canonical）\n- ソーシャルメディア対応（OGP, Twitter Card）\n- クローラビリティ（robots.txt, sitemap）\n- 技術的 SEO（構造化データ, ページ速度）\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `files` | チェック対象ファイルのリスト |\n| `pages` | ページ一覧（静的/動的） |\n| `public_dir` | public ディレクトリのパス |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `seo_issues` | 検出された問題のリスト |\n| `seo_score` | SEO スコア (A-F) |\n\n---\n\n## チェック項目\n\n### 1. 基本メタタグ\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| `<title>` 欠落 | 全ページに設定されているか | 高 |\n| `<title>` 重複 | 複数ページで同一タイトル | 中 |\n| `<title>` 長さ | 60文字超過（検索結果で切れる） | 低 |\n| `<meta name=\"description\">` 欠落 | 重要ページに設定されているか | 中 |\n| `<meta name=\"description\">` 長さ | 160文字超過 | 低 |\n| canonical URL 欠落 | 重要ページに `<link rel=\"canonical\">` | 中 |\n| viewport 未設定 | モバイル対応必須 | 高 |\n\n**検出パターン**:\n```tsx\n// ❌ 問題: メタタグなし\nexport default function Page() {\n  return <div>Content</div>;\n}\n\n// ✅ 改善: Next.js App Router\nexport const metadata = {\n  title: 'ページタイトル | サイト名',\n  description: 'ページの説明文（160文字以内）',\n  alternates: { canonical: 'https://example.com/page' }\n};\n\n// ✅ 改善: HTML\n<head>\n  <title>ページタイトル | サイト名</title>\n  <meta name=\"description\" content=\"ページの説明文\">\n  <link rel=\"canonical\" href=\"https://example.com/page\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n</head>\n```\n\n### 2. OGP（Open Graph Protocol）\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| `og:title` 欠落 | シェア可能ページに設定されているか | 中 |\n| `og:description` 欠落 | 適切な説明があるか | 中 |\n| `og:image` 欠落 | 画像が設定されているか | 中 |\n| `og:image` サイズ | 1200x630px 推奨 | 低 |\n| `og:url` 不一致 | canonical と一致しているか | 低 |\n| `og:type` 欠落 | `website`, `article` 等 | 低 |\n\n**検出パターン**:\n```tsx\n// ✅ Next.js App Router\nexport const metadata = {\n  openGraph: {\n    title: 'ページタイトル',\n    description: '説明文',\n    url: 'https://example.com/page',\n    siteName: 'サイト名',\n    images: [{ url: 'https://example.com/og-image.png', width: 1200, height: 630 }],\n    locale: 'ja_JP',\n    type: 'website',\n  },\n};\n\n// ✅ HTML\n<meta property=\"og:title\" content=\"ページタイトル\">\n<meta property=\"og:description\" content=\"説明文\">\n<meta property=\"og:image\" content=\"https://example.com/og-image.png\">\n<meta property=\"og:url\" content=\"https://example.com/page\">\n<meta property=\"og:type\" content=\"website\">\n```\n\n### 3. Twitter Card\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| `twitter:card` 欠落 | `summary_large_image` 推奨 | 低 |\n| `twitter:title` 欠落 | OGP と重複可 | 低 |\n| `twitter:description` 欠落 | OGP と重複可 | 低 |\n| `twitter:image` 欠落 | OGP と重複可 | 低 |\n\n**検出パターン**:\n```tsx\n// ✅ Next.js App Router\nexport const metadata = {\n  twitter: {\n    card: 'summary_large_image',\n    title: 'ページタイトル',\n    description: '説明文',\n    images: ['https://example.com/twitter-image.png'],\n  },\n};\n```\n\n### 4. クローラビリティ\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| robots.txt 欠落 | `public/robots.txt` が存在するか | 中 |\n| robots.txt 全拒否 | `Disallow: /` で全ページブロック | 高 |\n| sitemap.xml 欠落 | 存在するか | 低 |\n| noindex 残存 | 開発中の `<meta name=\"robots\" content=\"noindex\">` | 高 |\n\n**検出パターン**:\n```bash\n# チェック対象\npublic/robots.txt\npublic/sitemap.xml\napp/robots.ts (Next.js)\napp/sitemap.ts (Next.js)\n```\n\n```txt\n# ✅ 推奨 robots.txt\nUser-agent: *\nAllow: /\nSitemap: https://example.com/sitemap.xml\n\n# ❌ 危険: 全拒否\nUser-agent: *\nDisallow: /\n```\n\n### 5. HTTP ステータス\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| エラーページ 200 | 404/500 が 200 を返す | 高 |\n| リダイレクトチェーン | 3回以上のリダイレクト | 中 |\n| soft 404 | 存在しないページが 200 を返す | 高 |\n\n**検出パターン**:\n```typescript\n// ❌ 問題: エラーページが 200 を返す\nexport default function NotFound() {\n  return <div>Page not found</div>;  // ステータス 200\n}\n\n// ✅ 改善: 正しいステータスコード\n// app/not-found.tsx (Next.js App Router は自動で 404)\nexport default function NotFound() {\n  return <div>Page not found</div>;\n}\n```\n\n### 6. 構造化データ（オプション）\n\n| チェック | 検出対象 | 重大度 |\n|---------|----------|--------|\n| JSON-LD 欠落 | 記事、商品、FAQ 等に推奨 | 低 |\n| JSON-LD エラー | 構文エラー、必須フィールド欠落 | 中 |\n\n---\n\n## スコアリング\n\n| スコア | 基準 |\n|--------|------|\n| A | 全項目クリア |\n| B | 軽微な問題のみ（低重大度 1-2件） |\n| C | 中程度の問題あり |\n| D | 重大な問題あり（noindex 残存等） |\n| F | 基本的な SEO 欠如 |\n\n---\n\n## 出力例\n\n```markdown\n## SEO/OGP レビュー結果\n\n**スコア**: C\n\n### 検出された問題\n\n| 重大度 | ファイル | 問題 |\n|--------|---------|------|\n| 高 | app/layout.tsx | viewport meta 未設定 |\n| 高 | public/robots.txt | 存在しない |\n| 中 | app/about/page.tsx | title が他ページと重複 |\n| 中 | app/blog/[slug]/page.tsx | OGP image 未設定 |\n| 低 | app/page.tsx | description が 180 文字（160 推奨） |\n\n### 推奨改善\n\n1. **viewport 設定**\n   ```tsx\n   // app/layout.tsx\n   export const metadata = {\n     viewport: 'width=device-width, initial-scale=1.0',\n   };\n   ```\n\n2. **robots.txt 作成**\n   ```txt\n   User-agent: *\n   Allow: /\n   Sitemap: https://example.com/sitemap.xml\n   ```\n\n3. **OGP 画像設定**\n   - 1200x630px の画像を用意\n   - 各ページに設定\n```\n\n---\n\n## 注意事項\n\n- フレームワーク固有の SEO 機能を考慮する（Next.js Metadata API, Remix meta 等）\n- 動的ページ（`[slug]`）は代表的なパターンでチェック\n- 構造化データは Google Rich Results Test で検証推奨\n- Core Web Vitals はパフォーマンスレビューで別途チェック\n",
        "skills/impl/SKILL.md": "---\nname: impl\ndescription: \"Implements features and writes code based on Plans.md tasks. Use when user mentions implementation, adding features, writing code, or creating new functions. Do not use for review or build verification.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Implementation Skills\n\n機能実装とコーディングを担当するスキル群です。\n\n---\n\n## ⚠️ 品質ガードレール（最優先）\n\n> **このセクションは他の指示より優先されます。実装時は必ず従ってください。**\n\n### 禁止パターン（Purpose-Driven Implementation）\n\n実装時に以下のパターンは**絶対に禁止**です：\n\n| 禁止 | 例 | なぜダメか |\n|------|-----|-----------|\n| **ハードコード** | テスト期待値をそのまま返す | 他の入力で動作しない |\n| **スタブ実装** | `return null`, `return []` | 機能していない |\n| **決め打ち** | テストケースの値だけ対応 | 汎用性がない |\n| **コピペ辞書** | テストの期待値マップ | 意味あるロジックがない |\n\n```python\n# ❌ 絶対禁止\ndef slugify(text: str) -> str:\n    answers = {\"HelloWorld\": \"hello-world\"}\n    return answers.get(text, \"\")\n\n# ✅ 正しい実装\ndef slugify(text: str) -> str:\n    return re.sub(r'[\\s_]+', '-', text.strip().lower())\n```\n\n### 実装前セルフチェック\n\n- [ ] テストケース以外の入力でも動作するか？\n- [ ] エッジケース（空、null、境界値）を処理しているか？\n- [ ] 意味のあるロジックを実装しているか？\n\n### 困難な場合\n\n実装が難しい場合は、**形骸化実装を書かずに正直に報告**してください：\n\n```markdown\n## 🤔 実装の相談\n### 状況: [何を実装しようとしているか]\n### 困難な点: [具体的に何が難しいか]\n### 選択肢: [考えられる案]\n```\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **機能実装** | See [references/implementing-features.md](references/implementing-features.md) |\n| **テスト作成** | See [references/writing-tests.md](references/writing-tests.md) |\n\n## 実行手順\n\n1. **品質判定ゲート**（Step 0）\n2. ユーザーのリクエストを分類\n3. **（Claude-mem 有効時）過去の実装パターンを検索**\n4. 上記の「機能詳細」から適切な参照ファイルを読む\n5. その内容に従って実装\n\n### Step 0: 品質判定ゲート（最初に実行）\n\nタスク開始前に品質基準を判定し、必要に応じて提案:\n\n```\nタスク情報収集\n    ↓\n┌─────────────────────────────────────────┐\n│           品質判定ゲート                 │\n├─────────────────────────────────────────┤\n│  判定項目:                              │\n│  ├── TDD 推奨？（[feature] + ビジネス）  │\n│  ├── セキュリティ注意？（auth/api/）    │\n│  └── パフォーマンス注意？（DB/ループ）  │\n└─────────────────────────────────────────┘\n          ↓\n    該当する判定を提案\n```\n\n#### TDD 判定基準\n\n| 条件 | 推奨度 | 提案内容 |\n|------|--------|---------|\n| [feature] + src/core/ | ★★★ | 「テストから書きますか？」 |\n| [feature] + src/services/ | ★★★ | 「テストから書きますか？」 |\n| [bugfix] | ★★☆ | 「再現テストを先に書きますか？」 |\n| [config], [docs] | - | 判定スキップ |\n\n#### セキュリティ判定基準\n\n| パス | 提案内容 |\n|------|---------|\n| auth/, login/, session/ | セキュリティチェックリスト表示 |\n| api/, routes/ | 入力検証・認可チェック確認 |\n| payment/, billing/ | 決済セキュリティチェック |\n\n#### 提案テンプレート\n\n**エンジニア向け**:\n```markdown\n🎯 品質判定結果\n\n| 判定 | 推奨度 | 理由 |\n|------|--------|------|\n| TDD | ★★★ | [feature] + ビジネスロジック |\n\nテストファイルから作成しますか？\n```\n\n**VibeCoder 向け**:\n```markdown\n🎯 この作業で気をつけること\n\n1. **成功基準を先に決めましょう**\n   - 「何ができたら OK か」をリストにします\n\n進め方を選んでください：\n1. 成功基準から作る（推奨）\n2. とりあえず作り始める\n```\n\n### Step 1: LSP 活用ガイドライン\n\n実装前に LSP ツールで既存コードを理解することを推奨:\n\n| LSP 操作 | 活用場面 | 効果 |\n|---------|---------|------|\n| goToDefinition | 既存関数の実装を確認 | パターン把握 |\n| findReferences | 影響範囲の事前調査 | 破壊的変更防止 |\n| hover | 型情報・JSDoc 確認 | 正しいインターフェース |\n\n**実装フロー**:\n1. `LSP.goToDefinition` で関連コードを確認\n2. `LSP.findReferences` で影響範囲を把握\n3. 実装\n4. `LSP.diagnostics` でエラーチェック\n\n**使用例**:\n```\n# 1. 関連関数の実装を確認\nLSP operation=goToDefinition filePath=\"src/utils/auth.ts\" line=25 character=10\n\n# 2. 影響範囲を調査\nLSP operation=findReferences filePath=\"src/utils/auth.ts\" line=25 character=10\n\n# 3. 型情報を確認\nLSP operation=hover filePath=\"src/types/user.ts\" line=15 character=12\n```\n\n> **注**: LSP サーバーが設定されている言語でのみ動作します。\n\n### Step 2: 過去の実装パターン検索（Memory-Enhanced）\n\nClaude-mem が有効な場合、実装前に過去の類似パターンを検索:\n\n```\n# mem-search で過去の実装パターンを検索\nmem-search: type:feature \"{実装機能のキーワード}\"\nmem-search: concepts:pattern \"{関連技術}\"\nmem-search: concepts:gotcha \"{使用ライブラリ/フレームワーク}\"\nmem-search: type:decision \"{設計方針に関するキーワード}\"\n```\n\n**表示例**:\n\n```markdown\n📚 過去の実装パターン\n\n| 日付 | パターン | ファイル |\n|------|---------|---------|\n| 2024-01-15 | API エンドポイント: RESTful 設計 | src/api/*.ts |\n| 2024-01-20 | フォームバリデーション: Zod 使用 | src/components/forms/*.tsx |\n\n💡 過去の gotcha（落とし穴）:\n- CORS: サーバー側で Allow-Origin 設定必須\n- 型安全: any 禁止、unknown + type guard 推奨\n```\n\n**関連する決定事項の表示**:\n\n```markdown\n⚖️ 関連する設計決定\n\n- D5: 状態管理は Zustand を採用（Redux より軽量）\n- D8: API通信は tRPC を使用（型安全）\n\n💡 上記の決定に従って実装してください\n```\n\n> **注**: Claude-mem が未設定の場合、このステップはスキップされます。\n\n---\n\n## 🔧 LSP 機能の活用\n\n実装時には LSP（Language Server Protocol）を積極的に活用します。\n\n### 実装前の調査\n\n| LSP 機能 | 用途 |\n|---------|------|\n| **Go-to-definition** | 既存関数の実装パターンを確認 |\n| **Find-references** | 変更の影響範囲を事前把握 |\n| **Hover** | 型情報・API ドキュメントを確認 |\n\n### 実装中の検証\n\n| LSP 機能 | 用途 |\n|---------|------|\n| **Diagnostics** | 型エラー・構文エラーを即座に検出 |\n| **Completions** | 正しい API を使用、タイポ防止 |\n\n### 実装後の確認\n\n```\n実装完了時チェック:\n1. LSP Diagnostics を実行\n2. エラー: 0件を確認\n3. 警告: 必要に応じて対応\n```\n\n詳細: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n",
        "skills/impl/references/implementing-features.md": "---\nname: work-impl-feature\ndescription: \"Plans.md のタスクに基づいて機能を実装する。/workコマンドが実行された場合、またはPlans.mdに実装待ちのタスクがある場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Work Implementation Feature\n\nPlans.md で計画されたタスクを実際に実装するスキル。\nコードを書き、ファイルを生成し、動作するソフトウェアを作成します。\n\n---\n\n## 入力\n\n- **Plans.md**: 実装すべきタスク一覧\n- **リポジトリコンテキスト**: 技術スタック、既存コード\n- **対象タスク**: 実装する具体的なタスク\n\n---\n\n## 出力\n\n- **実装されたコード**: ファイルの作成・編集\n- **Plans.md の更新**: タスク状態の変更\n- **完了報告**: 何を実装したかのサマリー\n\n---\n\n## 実行手順\n\n### Step 1: タスクの確認\n\n```bash\ncat Plans.md | grep -A 5 \"cc:WIP\\|cc:TODO\"\n```\n\n対象タスクを特定し、状態を `cc:WIP` に更新\n\n### Step 2: 実装方針の決定\n\n```\n1. 関連する既存コードを確認\n2. 必要なファイル・変更箇所を特定\n3. 実装の順序を決定\n```\n\n### Step 3: コードの実装\n\n#### ファイル作成の場合\n\n```bash\n# ディレクトリ確認\nls -la src/components/\n\n# Write ツールで新規ファイル作成\n```\n\n#### ファイル編集の場合\n\n```bash\n# Read ツールで既存内容を確認\n# Edit ツールで必要な部分のみ変更\n```\n\n### Step 4: 動作確認\n\n```bash\n# TypeScript の場合\nnpx tsc --noEmit\n\n# ビルド確認\nnpm run build\n\n# 開発サーバー起動\nnpm run dev\n```\n\n### Step 5: タスク完了処理\n\nPlans.md を更新：\n\n```markdown\n# 変更前\n- [ ] タスク名 `cc:WIP`\n\n# 変更後\n- [x] タスク名 `cc:完了` ({{日付}})\n```\n\n---\n\n## 実装パターン集\n\n### React コンポーネント\n\n```typescript\n// src/components/features/FeatureName.tsx\nimport { useState } from 'react'\n\ninterface FeatureNameProps {\n  // props 定義\n}\n\nexport function FeatureName({ ...props }: FeatureNameProps) {\n  const [state, setState] = useState<Type>(initialValue)\n\n  return (\n    <div>\n      {/* 実装 */}\n    </div>\n  )\n}\n```\n\n### API エンドポイント（Next.js）\n\n```typescript\n// src/app/api/endpoint/route.ts\nimport { NextResponse } from 'next/server'\n\nexport async function GET() {\n  // 実装\n  return NextResponse.json({ data: result })\n}\n```\n\n### ユーティリティ関数\n\n```typescript\n// src/lib/utils.ts\nexport function utilityFunction(input: InputType): OutputType {\n  // 実装\n  return output\n}\n```\n\n---\n\n## 品質基準\n\n### 1. 型安全\n\n- `any` を避ける\n- 適切な型定義を行う\n\n### 2. エラーハンドリング\n\n```typescript\ntry {\n  // 処理\n} catch (error) {\n  console.error('Error:', error)\n  // 適切なエラー処理\n}\n```\n\n### 3. コメント\n\n- 複雑なロジックには説明を追加\n- TODO は残さない（実装するか削除）\n\n---\n\n## 完了報告フォーマット\n\n```markdown\n## ✅ 実装完了\n\n**タスク**: {{タスク名}}\n\n### 変更ファイル\n| ファイル | 変更内容 |\n|---------|---------|\n| `{{path}}` | {{変更概要}} |\n\n### 動作確認\n- ビルド: ✅ 成功\n- 開発サーバー: ✅ 起動確認\n\n### 次のタスク\n「{{次のタスク名}}」を続けますか？\n```\n\n---\n\n## 注意事項\n\n- **1タスク1フォーカス**: 複数タスクを混ぜない\n- **こまめにコミット**: 意味のある単位で\n- **テスト可能な状態を維持**: 中間状態でもビルドが通ること\n",
        "skills/impl/references/writing-tests.md": "---\nname: work-write-tests\ndescription: \"テストコードを作成する。/workコマンドでテストが必要な場合、またはコード実装後にテストが不足している場合に使用します。\"\nallowed-tools: [Read,Write,Edit,Bash]\n---\n\n# Work Write Tests\n\n実装した機能に対してテストコードを書くスキル。\nコードの品質を保証し、リグレッションを防ぎます。\n\n---\n\n## 入力\n\n- **テスト対象のコード**: 実装されたファイル\n- **既存のテスト構造**: テストフレームワーク、ディレクトリ構成\n- **テスト要件**: カバーすべきケース\n\n---\n\n## 出力\n\n- **テストファイル**: 新規作成または追記\n- **テスト実行結果**: 全テスト通過の確認\n\n---\n\n## 実行手順\n\n### Step 1: テスト環境の確認\n\n```bash\n# テストフレームワークの確認\ncat package.json | grep -E '\"(jest|vitest|mocha|pytest)\"'\n\n# 既存テストの構造確認\nls -la __tests__/ tests/ src/**/*.test.* 2>/dev/null | head -10\n\n# テスト実行コマンドの確認\nnpm test 2>&1 | head -5\n```\n\n### Step 2: テストケースの設計\n\n対象コードに対して以下を考慮：\n\n1. **正常系**: 期待通りの入力に対する動作\n2. **境界値**: 最小/最大値、空配列など\n3. **異常系**: エラーが起きるべきケース\n\n### Step 3: テストの実装\n\n#### Jest/Vitest の例\n\n```typescript\n// src/components/__tests__/FeatureName.test.tsx\nimport { render, screen } from '@testing-library/react'\nimport { FeatureName } from '../FeatureName'\n\ndescribe('FeatureName', () => {\n  it('renders correctly', () => {\n    render(<FeatureName />)\n    expect(screen.getByText('Expected Text')).toBeInTheDocument()\n  })\n\n  it('handles user interaction', async () => {\n    render(<FeatureName />)\n    await userEvent.click(screen.getByRole('button'))\n    expect(screen.getByText('Result')).toBeInTheDocument()\n  })\n})\n```\n\n#### ユーティリティ関数のテスト\n\n```typescript\n// src/lib/__tests__/utils.test.ts\nimport { utilityFunction } from '../utils'\n\ndescribe('utilityFunction', () => {\n  it('returns expected output for valid input', () => {\n    expect(utilityFunction('input')).toBe('expected')\n  })\n\n  it('handles edge cases', () => {\n    expect(utilityFunction('')).toBe('')\n    expect(utilityFunction(null)).toBeNull()\n  })\n\n  it('throws error for invalid input', () => {\n    expect(() => utilityFunction(undefined)).toThrow()\n  })\n})\n```\n\n### Step 4: テストの実行\n\n```bash\n# 全テスト実行\nnpm test\n\n# 特定ファイルのみ\nnpm test -- FeatureName.test.tsx\n\n# カバレッジ付き\nnpm test -- --coverage\n```\n\n### Step 5: 結果の確認\n\n```bash\n# テスト結果の確認\nnpm test 2>&1 | tail -20\n\n# カバレッジレポート確認\ncat coverage/lcov-report/index.html | grep -A 5 \"coverage\"\n```\n\n---\n\n## テストパターン集\n\n### コンポーネントテスト\n\n```typescript\n// レンダリングテスト\nit('renders without crashing', () => {\n  render(<Component />)\n})\n\n// Props テスト\nit('displays props correctly', () => {\n  render(<Component title=\"Test\" />)\n  expect(screen.getByText('Test')).toBeInTheDocument()\n})\n\n// イベントテスト\nit('handles click event', async () => {\n  const onClick = vi.fn()\n  render(<Component onClick={onClick} />)\n  await userEvent.click(screen.getByRole('button'))\n  expect(onClick).toHaveBeenCalled()\n})\n```\n\n### API テスト\n\n```typescript\n// モックを使用\nvi.mock('../lib/api', () => ({\n  fetchData: vi.fn().mockResolvedValue({ data: 'mock' })\n}))\n\nit('fetches data correctly', async () => {\n  const result = await fetchData()\n  expect(result.data).toBe('mock')\n})\n```\n\n### エラーハンドリングテスト\n\n```typescript\nit('handles errors gracefully', async () => {\n  vi.spyOn(console, 'error').mockImplementation(() => {})\n\n  render(<ComponentWithError />)\n\n  expect(screen.getByText('Error occurred')).toBeInTheDocument()\n})\n```\n\n---\n\n## テスト命名規則\n\n```typescript\n// 推奨フォーマット\ndescribe('対象', () => {\n  it('〜のとき、〜する', () => {})\n  it('〜の場合、〜を返す', () => {})\n})\n\n// 例\ndescribe('Button', () => {\n  it('クリックされたとき、onClickを呼び出す', () => {})\n  it('disabledの場合、クリックを無視する', () => {})\n})\n```\n\n---\n\n## 完了報告フォーマット\n\n```markdown\n## ✅ テスト追加完了\n\n**対象**: {{テスト対象ファイル}}\n\n### 追加したテスト\n| テストファイル | テストケース数 |\n|--------------|--------------|\n| `{{path}}` | {{件数}} |\n\n### テスト結果\n- 実行: ✅ {{total}} テスト中 {{passed}} 通過\n- カバレッジ: {{percentage}}%\n\n### 次のアクション\n「レビューして」または「次のタスクへ」\n```\n\n---\n\n## 注意事項\n\n- **テストを後回しにしない**: 実装と同時に書く\n- **過度なモックを避ける**: 実際の動作に近いテストを\n- **テストの保守性**: 実装変更でテストが壊れにくく\n",
        "skills/maintenance/SKILL.md": "---\nname: maintenance\ndescription: \"Cleans up and organizes project files. Use when user mentions cleanup, archive, file bloat, or organizing Plans.md/session logs. Do NOT load for: implementation work, reviews, new feature development, or deployment.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Maintenance Skills\n\nファイルのメンテナンス・クリーンアップを担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **自動クリーンアップ** | See [references/auto-cleanup.md](references/auto-cleanup.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って実行\n",
        "skills/maintenance/references/auto-cleanup.md": "---\nname: auto-cleanup\ndescription: \"不要なファイルや古いログをクリーンアップする。Plans.mdが肥大化した場合、またはセッション終了時に使用します。\"\nallowed-tools: [Read,Write,Edit,Bash]\n---\n\n# Auto Cleanup Skill\n\nPlans.md、session-log.md 等のファイル肥大化を防ぐ自動整理スキル。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで起動します：\n\n- 「ファイルを整理して」\n- 「アーカイブして」\n- 「古いタスクを移動して」\n- `/cleanup`\n- \"clean up files\"\n- \"archive old tasks\"\n\n---\n\n## 概要\n\nこのスキルは以下のファイルを自動整理します：\n\n| ファイル | 閾値 | アクション |\n|---------|------|-----------|\n| Plans.md | 完了から7日 or 200行超 | 📦 アーカイブへ移動 |\n| session-log.md | 30日経過 or 500行超 | 月別ファイルに分割 |\n| CLAUDE.md | 100行超 | 警告 + 分割提案 |\n\n---\n\n## v0.4.6+ LLM評価型フック\n\nセッション終了時に **Prompt-Based Hook** で賢くクリーンアップを推奨します。\n\n### 仕組み\n\n```\n┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n│  Stop Event     │ ──► │  Bash Script    │ ──► │  Claude Haiku   │\n│  (Session End)  │     │  (collect-      │     │  (LLM 評価)     │\n│                 │     │   cleanup-      │     │                 │\n│                 │     │   context.sh)   │     │  推奨判断       │\n└─────────────────┘     └─────────────────┘     └─────────────────┘\n```\n\n### 評価基準\n\nLLM は以下の条件で cleanup を推奨します：\n\n1. **完了タスク蓄積**: 10件以上の完了タスク\n2. **古い完了タスク**: 7日以上前に完了したタスクの存在\n3. **Plans.md 肥大化**: 200行超\n4. **Session Log 肥大化**: 500行超\n5. **CLAUDE.md 肥大化**: 100行超（.claude/rules/ への分割を提案）\n\n### 利点\n\n| 従来の Bash Hook | LLM 評価型 Hook |\n|-----------------|-----------------|\n| 行数のみで判定 | タスクの完了日・件数を総合判断 |\n| 硬直的な閾値 | 文脈を理解した柔軟な推奨 |\n| 機械的なメッセージ | 具体的なアクション提案 |\n\n---\n\n## 設定ファイル\n\n`.claude-code-harness.config.yaml` で閾値をカスタマイズ可能：\n\n```yaml\ncleanup:\n  plans:\n    archive_after_days: 7        # 完了からN日でアーカイブ\n    max_lines: 200               # 最大行数\n    archive_max_items: 50        # アーカイブ最大件数\n\n  session_log:\n    archive_after_days: 30       # N日で月別に分割\n    max_lines: 500               # 最大行数\n    archive_path: \".claude/memory/archive/sessions/\"\n\n  claude_md:\n    max_lines: 100               # 警告閾値\n    warn_only: true              # 警告のみ（自動編集しない）\n\n  auto_run: session_start        # 実行タイミング\n```\n\n---\n\n## 実行手順\n\n### Step 1: 設定の読み込み\n\n```bash\n# 設定ファイルがあれば読み込み、なければデフォルト値\nCONFIG_FILE=\".claude-code-harness.config.yaml\"\nif [ -f \"$CONFIG_FILE\" ]; then\n  # YAML パース\n  PLANS_MAX_LINES=$(grep \"max_lines:\" \"$CONFIG_FILE\" | head -1 | awk '{print $2}')\nelse\n  # デフォルト値\n  PLANS_MAX_LINES=200\n  ARCHIVE_AFTER_DAYS=7\nfi\n```\n\n### Step 2: Plans.md の整理\n\n```bash\ncheck_plans_cleanup() {\n  local file=\"Plans.md\"\n  [ ! -f \"$file\" ] && return 0\n\n  local lines=$(wc -l < \"$file\")\n  local completed_count=$(grep -c \"\\[x\\].*pm:確認済\\|cursor:確認済\" \"$file\" || echo 0)\n\n  echo \"📊 Plans.md: ${lines}行, 完了タスク: ${completed_count}件\"\n\n  # 閾値チェック\n  if [ \"$lines\" -gt \"$PLANS_MAX_LINES\" ]; then\n    echo \"⚠️ Plans.md が ${PLANS_MAX_LINES} 行を超えています\"\n    return 1\n  fi\n\n  # 7日以上前の完了タスクをカウント\n  local old_tasks=$(grep -E \"\\[x\\].*\\([0-9]{4}-[0-9]{2}-[0-9]{2}\\)\" \"$file\" | while read line; do\n    date_str=$(echo \"$line\" | grep -oE \"[0-9]{4}-[0-9]{2}-[0-9]{2}\" | tail -1)\n    if [ -n \"$date_str\" ]; then\n      task_date=$(date -j -f \"%Y-%m-%d\" \"$date_str\" \"+%s\" 2>/dev/null || date -d \"$date_str\" \"+%s\" 2>/dev/null)\n      now=$(date \"+%s\")\n      diff=$(( (now - task_date) / 86400 ))\n      [ \"$diff\" -gt 7 ] && echo \"$line\"\n    fi\n  done | wc -l)\n\n  if [ \"$old_tasks\" -gt 0 ]; then\n    echo \"📦 ${old_tasks} 件の古いタスクをアーカイブ可能\"\n    return 1\n  fi\n\n  return 0\n}\n```\n\n### Step 3: アーカイブ実行\n\n```bash\narchive_old_tasks() {\n  local file=\"Plans.md\"\n  local archive_section=\"## 📦 アーカイブ\"\n  local today=$(date +%Y-%m-%d)\n\n  # 🟢 完了タスクセクションから7日以上前のタスクを抽出\n  # 📦 アーカイブセクションに移動\n  # 移動後、元のセクションから削除\n\n  echo \"✅ 古いタスクをアーカイブに移動しました\"\n}\n```\n\n### Step 4: session-log.md の整理\n\n```bash\ncheck_session_log_cleanup() {\n  local file=\".claude/memory/session-log.md\"\n  [ ! -f \"$file\" ] && return 0\n\n  local lines=$(wc -l < \"$file\")\n\n  if [ \"$lines\" -gt 500 ]; then\n    echo \"⚠️ session-log.md が 500 行を超えています\"\n\n    # 月別に分割\n    mkdir -p .claude/memory/archive/sessions\n    # 古いエントリを archive/sessions/YYYY-MM.md に移動\n\n    return 1\n  fi\n\n  return 0\n}\n```\n\n### Step 5: CLAUDE.md のチェック\n\n```bash\ncheck_claude_md() {\n  local file=\"CLAUDE.md\"\n  [ ! -f \"$file\" ] && return 0\n\n  local lines=$(wc -l < \"$file\")\n\n  if [ \"$lines\" -gt 100 ]; then\n    echo \"💡 CLAUDE.md が ${lines} 行あります\"\n    echo \"   常に必要な情報以外は docs/ に分割することを検討してください\"\n    echo \"   参考: @docs/filename.md で必要な時だけ読み込めます\"\n  fi\n\n  return 0\n}\n```\n\n---\n\n## 出力フォーマット\n\n### 整理が不要な場合\n\n```\n✅ **ファイル状態: 正常**\n\n- Plans.md: 85行 (上限: 200行)\n- session-log.md: 120行 (上限: 500行)\n- 完了タスク: 5件 (7日以内)\n\n整理の必要はありません。\n```\n\n### 整理が必要な場合\n\n```\n⚠️ **整理が推奨されます**\n\n📋 **Plans.md**\n- 現在: 250行 (上限: 200行)\n- 完了タスク: 15件 (うち7日以上前: 8件)\n\n**推奨アクション:**\n1. 8件の古いタスクをアーカイブへ移動\n\n実行しますか？ (y/n)\n```\n\n### 整理完了後\n\n```\n✅ **整理完了**\n\n- Plans.md: 250行 → 180行 (-70行)\n- アーカイブに移動: 8タスク\n- バックアップ: .claude/memory/archive/Plans-2025-01-15.md\n\n次回の自動チェック: セッション開始時\n```\n\n---\n\n## Hook との連携\n\nPostToolUse Hook から呼び出される場合：\n\n1. Plans.md への書き込み検知\n2. 行数チェック\n3. 閾値超過時は警告メッセージを返す\n4. Claude へのフィードバックとして整理を提案\n\n```json\n{\n  \"decision\": \"allow\",\n  \"feedback\": \"⚠️ Plans.md が 200行を超えました。`/cleanup` で整理することを推奨します。\"\n}\n```\n\n---\n\n## 関連コマンド\n\n- `/cleanup` - 手動で整理を実行\n- `/cleanup --dry-run` - 実行せずプレビュー\n- `/cleanup plans` - Plans.md のみ整理\n- `/cleanup sessions` - session-log のみ整理\n\n---\n\n## 注意事項\n\n- **進行中タスクは移動しない**: `cc:WIP` や `pm:依頼中`（互換: `cursor:依頼中`）は対象外\n- **バックアップを作成**: 整理前に自動バックアップ\n- **設定でカスタマイズ可能**: 閾値はプロジェクトごとに調整可能\n",
        "skills/memory/SKILL.md": "---\nname: memory\ndescription: \"Manages memory, SSOT files, and Plans.md operations. Use when user mentions memory, SSOT, decisions.md, patterns.md, merging, or migration. Do NOT load for: implementation work, reviews, ad-hoc notes, or in-session logging.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Memory Skills\n\nメモリとSSOT管理を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **SSOT初期化** | See [references/ssot-initialization.md](references/ssot-initialization.md) |\n| **Plans.mdマージ** | See [references/plans-merging.md](references/plans-merging.md) |\n| **移行処理** | See [references/workflow-migration.md](references/workflow-migration.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って実行\n",
        "skills/memory/references/plans-merging.md": "---\nname: merge-plans\ndescription: \"Plans.md のマージ更新を行うスキル（ユーザータスクを保持）。複数のPlans.mdを統合する必要がある場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\"]\n---\n\n# Merge Plans Skill\n\n既存の Plans.md を更新する際に、ユーザーのタスクデータを保持しながら\nテンプレートの構造を適用するスキル。\n\n---\n\n## 目的\n\n- ユーザーのタスク（🔴🟡🟢📦セクション）を保持\n- テンプレートの構造・マーカー定義を更新\n- 最終更新情報を更新\n\n---\n\n## Plans.md の構造\n\n```markdown\n# Plans.md - タスク管理\n\n> **プロジェクト**: {{PROJECT_NAME}}\n> **最終更新**: {{DATE}}\n> **更新者**: Claude Code\n\n---\n\n## 🔴 進行中のタスク        ← ユーザーデータ（保持）\n\n## 🟡 未着手のタスク        ← ユーザーデータ（保持）\n\n## 🟢 完了タスク            ← ユーザーデータ（保持）\n\n## 📦 アーカイブ            ← ユーザーデータ（保持）\n\n## マーカー凡例             ← テンプレートから更新\n\n## 最終更新情報             ← 日付を更新\n```\n\n---\n\n## マージアルゴリズム\n\n### Step 1: セクション分割\n\n```\n既存の Plans.md を以下のセクションに分割:\n\n1. ヘッダー部分（# Plans.md ... ---）\n2. 🔴 進行中のタスク（次のセクションまで）\n3. 🟡 未着手のタスク（次のセクションまで）\n4. 🟢 完了タスク（次のセクションまで）\n5. 📦 アーカイブ（次のセクションまで）\n6. マーカー凡例（次のセクションまで）\n7. 最終更新情報（ファイル末尾まで）\n```\n\n### Step 2: タスクセクションの抽出\n\n```bash\nextract_section() {\n  local file=\"$1\"\n  local start_marker=\"$2\"\n  local end_markers=\"$3\"  # パイプ区切りの終了マーカー\n\n  awk -v start=\"$start_marker\" -v ends=\"$end_markers\" '\n    BEGIN { in_section = 0; split(ends, end_arr, \"|\") }\n    $0 ~ start { in_section = 1; next }\n    in_section {\n      for (i in end_arr) {\n        if ($0 ~ end_arr[i]) { in_section = 0; exit }\n      }\n      if (in_section) print\n    }\n  ' \"$file\"\n}\n\n# 各セクションを抽出\nTASKS_WIP=$(extract_section \"$PLANS_FILE\" \"## 🔴\" \"## 🟡|## 🟢|## 📦|## マーカー|---\")\nTASKS_TODO=$(extract_section \"$PLANS_FILE\" \"## 🟡\" \"## 🔴|## 🟢|## 📦|## マーカー|---\")\nTASKS_DONE=$(extract_section \"$PLANS_FILE\" \"## 🟢\" \"## 🔴|## 🟡|## 📦|## マーカー|---\")\nTASKS_ARCHIVE=$(extract_section \"$PLANS_FILE\" \"## 📦\" \"## 🔴|## 🟡|## 🟢|## マーカー|---\")\n```\n\n### Step 3: タスクの検証\n\n```bash\n# 空でないことを確認\ncount_tasks() {\n  echo \"$1\" | grep -c \"^\\s*- \\[\" || echo \"0\"\n}\n\nWIP_COUNT=$(count_tasks \"$TASKS_WIP\")\nTODO_COUNT=$(count_tasks \"$TASKS_TODO\")\nDONE_COUNT=$(count_tasks \"$TASKS_DONE\")\nARCHIVE_COUNT=$(count_tasks \"$TASKS_ARCHIVE\")\n\necho \"保持されるタスク:\"\necho \"  進行中: $WIP_COUNT\"\necho \"  未着手: $TODO_COUNT\"\necho \"  完了: $DONE_COUNT\"\necho \"  アーカイブ: $ARCHIVE_COUNT\"\n```\n\n### Step 4: 新しい Plans.md の生成\n\n```markdown\n# Plans.md - タスク管理\n\n> **プロジェクト**: {{PROJECT_NAME}}\n> **最終更新**: {{DATE}}\n> **更新者**: Claude Code\n\n---\n\n## 🔴 進行中のタスク\n\n<!-- cc:WIP のタスクをここに記載 -->\n\n{{TASKS_WIP}}\n\n---\n\n## 🟡 未着手のタスク\n\n<!-- cc:TODO, pm:依頼中（互換: cursor:依頼中） のタスクをここに記載 -->\n\n{{TASKS_TODO}}\n\n---\n\n## 🟢 完了タスク\n\n<!-- cc:完了, pm:確認済（互換: cursor:確認済） のタスクをここに記載 -->\n\n{{TASKS_DONE}}\n\n---\n\n## 📦 アーカイブ\n\n<!-- 古い完了タスクはここに移動 -->\n\n{{TASKS_ARCHIVE}}\n\n---\n\n## マーカー凡例\n\n| マーカー | 意味 |\n|---------|------|\n| `pm:依頼中` | PM から依頼されたタスク（互換: cursor:依頼中） |\n| `cc:TODO` | Claude Code 未着手 |\n| `cc:WIP` | Claude Code 作業中 |\n| `cc:完了` | Claude Code 完了（確認待ち） |\n| `pm:確認済` | PM 確認完了（互換: cursor:確認済） |\n| `cursor:依頼中` | （互換）pm:依頼中 と同義 |\n| `cursor:確認済` | （互換）pm:確認済 と同義 |\n| `blocked` | ブロック中（理由を併記） |\n\n---\n\n## 最終更新情報\n\n- **更新日時**: {{DATE}}\n- **最終セッション担当**: Claude Code\n- **ブランチ**: main\n- **更新種別**: プラグインアップデート\n```\n\n---\n\n## 空セクションの処理\n\nタスクが空の場合は、デフォルトテキストを挿入:\n\n```markdown\n## 🔴 進行中のタスク\n\n<!-- cc:WIP のタスクをここに記載 -->\n\n（現在なし）\n```\n\n---\n\n## エラー処理\n\n### Plans.md が解析できない場合\n\n```bash\nif ! validate_plans_structure \"$PLANS_FILE\"; then\n  echo \"⚠️ Plans.md の構造を解析できませんでした\"\n  echo \"バックアップを保持し、新規テンプレートを使用します\"\n\n  # バックアップ\n  cp \"$PLANS_FILE\" \"${PLANS_FILE}.bak.$(date +%Y%m%d%H%M%S)\"\n\n  # テンプレートを使用\n  use_template_instead=true\nfi\n```\n\n### 必須セクションがない場合\n\n不足しているセクションはテンプレートのデフォルトで補完。\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `merge_successful` | マージ成功フラグ |\n| `tasks_wip_count` | 進行中タスク数 |\n| `tasks_todo_count` | 未着手タスク数 |\n| `tasks_done_count` | 完了タスク数 |\n| `tasks_archive_count` | アーカイブタスク数 |\n| `backup_created` | バックアップ作成有無 |\n\n---\n\n## 使用例\n\n```bash\n# スキルの呼び出し\nmerge_plans \\\n  --existing \"./Plans.md\" \\\n  --template \"$PLUGIN_PATH/templates/Plans.md.template\" \\\n  --output \"./Plans.md\" \\\n  --project-name \"my-project\" \\\n  --date \"$(date +%Y-%m-%d)\"\n```\n\n---\n\n## 関連スキル\n\n- `update-2agent-files` - 更新フロー全体\n- `generate-workflow-files` - 新規生成\n",
        "skills/memory/references/ssot-initialization.md": "---\nname: init-memory-ssot\ndescription: \"プロジェクトのSSOTメモリ（decisions/patterns）と任意のsession-logを初期化する。初回セットアップ時や、.claude/memory が未整備のプロジェクトで使用します。\"\nallowed-tools: [\"Read\", \"Write\"]\n---\n\n# Init Memory SSOT\n\n`.claude/memory/` 配下の **SSOT** を初期化します。\n\n- `decisions.md`（重要な意思決定のSSOT）\n- `patterns.md`（再利用できる解法のSSOT）\n- `session-log.md`（セッションログ。ローカル運用推奨）\n\n詳細方針: `docs/MEMORY_POLICY.md`\n\n---\n\n## 実行手順\n\n### Step 1: 既存ファイルの確認\n\n- `.claude/memory/decisions.md`\n- `.claude/memory/patterns.md`\n- `.claude/memory/session-log.md`\n\n存在するものは**上書きしない**。\n\n### Step 2: テンプレートから初期化（存在しない場合のみ）\n\nテンプレート:\n\n- `templates/memory/decisions.md.template`\n- `templates/memory/patterns.md.template`\n- `templates/memory/session-log.md.template`\n\n`{{DATE}}` は当日（例: `2025-12-13`）で置換して生成する。\n\n### Step 3: 完了報告\n\n- 作成したファイル一覧\n- Git方針（`decisions/patterns`は共有推奨、`session-log/.claude/state`はローカル推奨）\n\n\n",
        "skills/memory/references/workflow-migration.md": "---\nname: migrate-workflow-files\ndescription: \"既存プロジェクトのAGENTS.md/CLAUDE.md/Plans.mdを、既存内容を精査して対話で引き継ぎ項目を確定しつつ、新フォーマットへ移行（バックアップ付き・Plansはタスク保持マージ）。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Migrate Workflow Files (Interactive Merge)\n\n## 目的\n\n既存プロジェクトで運用中の以下を、**既存内容を尊重しつつ新フォーマットへアップデート**します。\n\n- `AGENTS.md`\n- `CLAUDE.md`\n- `Plans.md`\n\nポイント:\n\n- **対話形式で引き継ぎ情報を確定**（勝手に捨てない / 勝手に上書きしない）\n- 変更前に **必ずバックアップ** を残す\n- `Plans.md` は `merge-plans` の方針で **タスクを保持しつつ構造を更新**\n\n---\n\n## 前提（重要）\n\nこのスキルは「初回適用時の安全」と「意図した動作（新フォーマット）」の両立のため、\n**ユーザー合意→バックアップ→生成→差分確認**の順で進めます。\n\n---\n\n## 入力（このスキル内で自動検出してOK）\n\n- `project_name`: `basename $(pwd)` で推定\n- `date`: `YYYY-MM-DD`\n- 既存ファイルの有無:\n  - `AGENTS.md`\n  - `CLAUDE.md`\n  - `Plans.md`\n- 新フォーマットの参照テンプレ:\n  - `templates/AGENTS.md.template`\n  - `templates/CLAUDE.md.template`\n  - `templates/Plans.md.template`\n\n---\n\n## 実行フロー\n\n### Step 0: 検出と合意取り（必須）\n\n1. `Read` で既存 `AGENTS.md` / `CLAUDE.md` / `Plans.md` の存在を確認。\n2. 存在する場合はユーザーへ確認:\n   - **移行（新フォーマットへアップデート）してよいか**\n   - 重要: 移行は **内容の再整理を含む**（= 多少の配置替えや言い回し変更が起こりうる）\n\nユーザーが NO の場合:\n\n- このスキルは中止（何も書き換えない）\n- 代わりに「`.claude/settings.json` の安全マージだけ」等の安全作業を提案\n\n### Step 1: 既存内容の精査（要約）\n\n各ファイルを `Read` し、以下を抽出して短く要約して提示する:\n\n- **AGENTS.md**: 役割分担、ハンドオフ手順、禁止事項、環境/前提\n- **CLAUDE.md**: 重要な制約（禁止事項/権限/ブランチ運用）、テスト手順、コミット規約、運用ルール\n- **Plans.md**: タスク構造、マーカー運用、現在のWIP/依頼中タスク\n\n### Step 2: 引き継ぎ項目の確定（対話）\n\n要約をもとに、ユーザーに **保持/調整**したい項目を質問する（最大5〜10問で十分）:\n\n- 絶対に残すべき制約（例: 本番デプロイ禁止、特定ディレクトリ禁止、セキュリティ要件）\n- 役割分担（Solo/2-agent）の前提\n- ブランチ運用（main/staging 等）\n- テスト/ビルドの代表コマンド\n- Plans のマーカー運用（既存ルールがあれば整合）\n\n### Step 3: バックアップ作成（必須）\n\nバックアップはプロジェクト内の `.claude-code-harness/backups/` にまとめる（gitに入れたくない場合が多い）。\n\n例:\n\n- `.claude-code-harness/backups/2025-12-13/AGENTS.md`\n- `.claude-code-harness/backups/2025-12-13/CLAUDE.md`\n- `.claude-code-harness/backups/2025-12-13/Plans.md`\n\n`Bash` で `mkdir -p` と `cp` を使ってよい。\n\n### Step 4: 新フォーマットの生成（マージ）\n\n#### 4-1. Plans.md（タスク保持マージ）\n\n`merge-plans` の方針で実行:\n\n- 既存の 🔴🟡🟢📦 タスクを保持\n- マーカー凡例・最終更新情報はテンプレ側に更新\n- 解析不能ならバックアップを残してテンプレ採用\n\n#### 4-2. AGENTS.md / CLAUDE.md（テンプレ + 引き継ぎブロック）\n\nテンプレで骨格を作り、Step 2 で確定した項目を **新フォーマットの適切な場所に再配置**する。\n\n最低限の方針:\n\n- 既存の“重要ルール”は削らず、**「プロジェクト固有ルール（移行）」**のセクションとして残す\n- 役割分担/フローはテンプレの形式に合わせて書き直す（意味は維持）\n\n### Step 5: 差分確認と完了\n\n- `git diff`（またはファイル差分）で変更点を短く要約\n- 重要ポイント（権限/禁止事項/タスク状態）が意図通りか最終確認\n- 問題があれば即修正\n\n---\n\n## 成果物（完了条件）\n\n- 既存内容を踏まえた **新フォーマット版**の `AGENTS.md` / `CLAUDE.md` / `Plans.md`\n- `.claude-code-harness/backups/` にバックアップが残っている\n- Plans のタスクは消えていない（保持）\n\n\n",
        "skills/parallel-workflows/SKILL.md": "---\nname: parallel-workflows\ndescription: \"Optimizes parallel execution of multiple tasks. Use when user mentions running tasks in parallel or together. Do NOT load for: single tasks, sequential-only work, or tasks with dependencies.\"\nallowed-tools: [\"Read\", \"Task\"]\nuser-invocable: false\n---\n\n# Parallel Workflows Skill\n\n複数タスクの並列実行を最適化するスキル。\nTask ツールを活用して、独立したタスクを同時に処理します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「並列で実行して」「同時にやって」\n- 「まとめてやって」「一気にやって」\n- 「効率的にやって」「速くやって」\n- \"run in parallel\", \"do these together\"\n\n---\n\n## 関連コマンド\n\n- `/work` - Plans.md のタスクを実行（並列実行対応）\n\n---\n\n## 概要\n\nClaude Code は複数のタスクを並列実行できます。\nこのスキルは、どのタスクが並列化可能かを判断し、最適な実行計画を立てます。\n\n---\n\n## 並列化パターン\n\n### パターン1: 複数ファイルの同時分析\n\n**使用場面**: コードレビュー、構造把握\n\n```\nTask tool を並列起動:\n- agent1: src/components/ を分析\n- agent2: src/lib/ を分析\n- agent3: src/app/ を分析\n```\n\n**VibeCoder向け言い方**:\n```\n「このプロジェクトの構造を教えて」\n→ 自動的に並列分析を実行\n```\n\n### パターン2: テストとビルドの同時実行\n\n**使用場面**: CI/CD、品質チェック\n\n```\n並列実行:\n- npm run lint\n- npm run type-check\n- npm run test\n\n直列実行（依存あり）:\n- npm run build（上記が全て成功後）\n```\n\n**VibeCoder向け言い方**:\n```\n「チェックして」\n→ lint, type-check, test を並列実行\n```\n\n### パターン3: 複数機能の同時実装\n\n**使用場面**: 独立した機能の開発\n\n```\nPlans.md:\n- [ ] ヘッダーコンポーネント作成\n- [ ] フッターコンポーネント作成\n- [ ] サイドバーコンポーネント作成\n\n→ 3つのTask agentを並列起動\n```\n\n**VibeCoder向け言い方**:\n```\n「レイアウトを全部作って」\n→ 独立したコンポーネントを並列実装\n```\n\n---\n\n## 判定ロジック\n\n### 並列化可能な条件\n\n1. **ファイル依存なし**: 同じファイルを編集しない\n2. **データ依存なし**: 出力が他の入力にならない\n3. **順序依存なし**: 実行順序が結果に影響しない\n\n### 並列化不可の例\n\n```\n❌ 並列化不可:\n1. API クライアント作成\n2. API クライアントを使うコンポーネント作成\n→ 2は1の出力に依存\n\n✅ 並列化可能:\n1. ログインページ作成\n2. 会員登録ページ作成\n→ 互いに独立\n```\n\n---\n\n## 実装ガイド\n\n### Task ツールを使った並列実行\n\n```typescript\n// 並列実行パターン\nconst tasks = [\n  { name: \"タスクA\", prompt: \"...\" },\n  { name: \"タスクB\", prompt: \"...\" },\n  { name: \"タスクC\", prompt: \"...\" }\n];\n\n// 全てのタスクを run_in_background: true で起動\n// TaskOutput で結果を収集\n```\n\n### 統合レポートの生成\n\n各タスク完了後、以下の形式でレポートを生成：\n\n```markdown\n## 📊 並列タスク実行レポート\n\n**実行日時**: {{timestamp}}\n**タスク数**: {{count}}件（並列実行）\n**所要時間**: {{duration}}秒\n\n### 完了タスク\n\n| # | タスク | ステータス | 所要時間 | 成果物 |\n|---|-------|----------|---------|-------|\n{{#each tasks}}\n| {{index}} | {{name}} | {{status}} | {{duration}}秒 | {{output}} |\n{{/each}}\n\n### 変更ファイル一覧\n\n{{#each files}}\n- `{{path}}` ({{action}})\n{{/each}}\n```\n\n---\n\n## 実行例\n\n### 例1: プロジェクト分析\n\n```\nユーザー: 「このプロジェクトについて教えて」\n\nClaude Code:\n🔍 プロジェクトを並列分析中...\n\n├── [Agent 1] 構造分析中...\n├── [Agent 2] 依存関係チェック中...\n└── [Agent 3] コード品質分析中...\n\n完了！\n\n📁 プロジェクト概要:\n- フレームワーク: Next.js 14\n- 主要ディレクトリ: 15個\n- ファイル数: 87個\n- 依存パッケージ: 23個\n- コード品質: 良好（lint警告: 3件）\n```\n\n### 例2: 複数機能の実装\n\n```\nユーザー: 「ヘッダー、フッター、サイドバーを作って」\n\nClaude Code:\n📋 3つの独立タスクを検出 → 並列実行します\n\n├── [Agent 1] ヘッダー作成中... ✅ 完了\n├── [Agent 2] フッター作成中... ✅ 完了\n└── [Agent 3] サイドバー作成中... ✅ 完了\n\n⏱️ 所要時間: 45秒（直列なら2分15秒）\n```\n\n### 例3: 品質チェック\n\n```\nユーザー: 「全部チェックして」\n\nClaude Code:\n🔍 品質チェックを並列実行中...\n\n├── [Lint] ✅ 問題なし\n├── [Type] ✅ 型エラーなし\n├── [Test] ✅ 15/15 通過\n└── [Build] ✅ 成功\n\n✅ 全チェック通過！\n```\n\n---\n\n## パフォーマンス指標\n\n| シナリオ | 直列実行 | 並列実行 | 改善率 |\n|---------|---------|---------|--------|\n| 3ファイル分析 | 30秒 | 12秒 | 60% |\n| lint+test+build | 45秒 | 20秒 | 55% |\n| 3コンポーネント作成 | 3分 | 1分 | 67% |\n\n---\n\n## エラーハンドリング\n\n### 一部タスク失敗時\n\n1. 成功したタスクの結果は保持\n2. 失敗タスクのエラー詳細を表示\n3. 再実行オプションを提示\n\n```\n📊 並列実行完了（一部エラー）\n\n├── [Task 1] A作成 ✅ (25秒)\n├── [Task 2] B作成 ❌ エラー\n│   └── 原因: TypeScriptエラー\n└── [Task 3] C作成 ✅ (22秒)\n\n⚠️ 1件のタスクが失敗しました。\n失敗したタスクを再実行しますか？ (y/n)\n```\n\n---\n\n## 使用上の注意\n\n### 推奨\n\n- ✅ 独立したファイルの同時編集\n- ✅ 複数の分析タスクの並列実行\n- ✅ 非依存テストの同時実行\n\n### 非推奨\n\n- ❌ 同一ファイルへの同時書き込み\n- ❌ 依存関係のあるタスクの並列化\n- ❌ データベースマイグレーションの並列実行\n\n---\n\n## VibeCoder 向けまとめ\n\n| やりたいこと | 言い方 | 並列化 |\n|-------------|--------|--------|\n| 複数ページ作成 | 「ページを全部作って」 | ✅ 自動 |\n| コード分析 | 「このプロジェクトを分析して」 | ✅ 自動 |\n| 品質チェック | 「チェックして」 | ✅ 自動 |\n| 順番に実装 | 「順番にやって」 | ❌ 直列 |\n\n**ポイント**: 特に意識しなくても、Claude Code が自動的に並列化可能なタスクを判断して最適化します。\n",
        "skills/parallel-workflows/references/build-dependency-graph.md": "---\nname: build-dependency-graph\ndescription: \"Build dependency graph from Plans.md tasks to determine parallel execution groups. Analyzes task descriptions to extract target files and infer dependencies.\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\"]\n---\n\n# Build Dependency Graph\n\nPlans.mdのタスクから依存関係を解析し、並列実行可能なグループを決定するスキル。\n\n---\n\n## 入力\n\n- **Plans.md**: タスク一覧を含むファイル\n- **target_tasks**: 実行対象のタスクリスト（plans-managementスキルから取得）\n\n---\n\n## 出力\n\n```json\n{\n  \"parallel_groups\": [\n    {\n      \"group_id\": 1,\n      \"tasks\": [\"task1\", \"task2\", \"task3\"],\n      \"can_parallelize\": true,\n      \"reason\": \"独立したファイルを編集\"\n    },\n    {\n      \"group_id\": 2,\n      \"tasks\": [\"task4\"],\n      \"can_parallelize\": false,\n      \"reason\": \"group1の出力に依存\",\n      \"depends_on\": [1]\n    }\n  ],\n  \"task_files\": {\n    \"task1\": [\"src/components/Header.tsx\"],\n    \"task2\": [\"src/components/Footer.tsx\"],\n    \"task3\": [\"src/components/Sidebar.tsx\"],\n    \"task4\": [\"src/components/Layout.tsx\"]\n  }\n}\n```\n\n---\n\n## 依存関係判定ルール\n\n### 並列化可能な条件\n\n1. **別ファイルを編集**: タスクが異なるファイルを編集する\n2. **データ依存なし**: タスクAの出力がタスクBの入力にならない\n3. **順序依存なし**: 実行順序が結果に影響しない\n\n### 並列化不可の条件\n\n1. **同一ファイル編集**: 複数タスクが同じファイルを編集する\n2. **import依存**: タスクAが作成するファイルをタスクBがimportする\n3. **明示的な依存**: Plans.mdに`depends:T001`などの依存記法がある\n\n---\n\n## 実行手順\n\n### Step 1: Plans.mdからタスクと対象ファイルを抽出\n\n```bash\n# Plans.mdを読み込む\ncat Plans.md\n\n# タスク行を抽出（マーカー付き）\ngrep -E \"^\\s*- \\[ \\].*`cc:(TODO|WIP)`\" Plans.md\n\n# タスク説明からファイルパスを抽出\n# パターン例:\n# - \"src/components/Header.tsx を作成\"\n# - \"Header.tsx を実装\"\n# - \"関連ファイル: src/components/Header.tsx\"\n```\n\n### Step 2: ファイル依存関係の推定\n\n#### 2.1: ファイル名から依存を推定\n\n```bash\n# 各タスクの対象ファイルをリスト化\n# 例:\n# task1: [\"src/components/Header.tsx\"]\n# task2: [\"src/components/Footer.tsx\"]\n# task3: [\"src/components/Layout.tsx\"]  # Header.tsx, Footer.tsx を import する可能性\n```\n\n#### 2.2: import文の確認（既存ファイルがある場合）\n\n```bash\n# Layout.tsxが既に存在する場合、import文を確認\ngrep -E \"import.*from.*['\\\"](\\.\\.?/.*Header|\\.\\.?/.*Footer)\" src/components/Layout.tsx\n\n# 存在する場合、Layout作成タスクはHeader/Footer作成タスクに依存\n```\n\n#### 2.3: Plans.mdの依存記法を確認\n\n```bash\n# depends:記法を抽出\ngrep -E \"depends:[T0-9,]+\" Plans.md\n\n# 例: \"depends:T001,T002\" → タスクIDで依存関係を特定\n```\n\n### Step 3: 依存グラフの構築\n\n```\n判定ロジック:\n├── 同一ファイル編集 → 競合 → 直列実行\n├── import依存あり → 依存 → A→B の順序\n├── depends:記法あり → 依存 → 指定順序\n└── 互いに独立 → 並列可能 → 同一グループ\n```\n\n### Step 4: 並列グループの決定\n\n```javascript\n// 疑似コード例\nconst groups = [];\nlet currentGroup = { group_id: 1, tasks: [], depends_on: [] };\n\nfor (const task of target_tasks) {\n  if (hasDependency(task, currentGroup.tasks)) {\n    // 依存がある場合は新しいグループ\n    groups.push(currentGroup);\n    currentGroup = { group_id: groups.length + 1, tasks: [task], depends_on: [groups.length] };\n  } else {\n    // 依存がない場合は現在のグループに追加\n    currentGroup.tasks.push(task);\n  }\n}\ngroups.push(currentGroup);\n```\n\n---\n\n## 出力フォーマット\n\n### parallel_groups\n\n各グループの構造：\n\n```json\n{\n  \"group_id\": 1,\n  \"tasks\": [\"task1\", \"task2\", \"task3\"],\n  \"can_parallelize\": true,\n  \"reason\": \"独立したファイルを編集\",\n  \"depends_on\": []\n}\n```\n\n| フィールド | 説明 |\n|-----------|------|\n| `group_id` | グループ番号（実行順序） |\n| `tasks` | このグループに含まれるタスクIDのリスト |\n| `can_parallelize` | グループ内で並列実行可能か |\n| `reason` | 判定理由（デバッグ用） |\n| `depends_on` | 依存しているグループIDのリスト |\n\n### task_files\n\n各タスクが編集するファイルのマッピング：\n\n```json\n{\n  \"task1\": [\"src/components/Header.tsx\"],\n  \"task2\": [\"src/components/Footer.tsx\"]\n}\n```\n\n---\n\n## 使用例\n\n### 例1: 独立したコンポーネント作成\n\n**Plans.md**:\n```markdown\n- [ ] Headerコンポーネント作成 `cc:TODO`\n  - 関連ファイル: src/components/Header.tsx\n- [ ] Footerコンポーネント作成 `cc:TODO`\n  - 関連ファイル: src/components/Footer.tsx\n- [ ] Sidebarコンポーネント作成 `cc:TODO`\n  - 関連ファイル: src/components/Sidebar.tsx\n```\n\n**出力**:\n```json\n{\n  \"parallel_groups\": [\n    {\n      \"group_id\": 1,\n      \"tasks\": [\"Header作成\", \"Footer作成\", \"Sidebar作成\"],\n      \"can_parallelize\": true,\n      \"reason\": \"独立したファイルを編集\",\n      \"depends_on\": []\n    }\n  ],\n  \"task_files\": {\n    \"Header作成\": [\"src/components/Header.tsx\"],\n    \"Footer作成\": [\"src/components/Footer.tsx\"],\n    \"Sidebar作成\": [\"src/components/Sidebar.tsx\"]\n  }\n}\n```\n\n### 例2: 依存関係あり\n\n**Plans.md**:\n```markdown\n- [ ] Headerコンポーネント作成 `cc:TODO`\n  - 関連ファイル: src/components/Header.tsx\n- [ ] Footerコンポーネント作成 `cc:TODO`\n  - 関連ファイル: src/components/Footer.tsx\n- [ ] Layoutコンポーネント作成 `cc:TODO` depends:Header,Footer\n  - 関連ファイル: src/components/Layout.tsx\n```\n\n**出力**:\n```json\n{\n  \"parallel_groups\": [\n    {\n      \"group_id\": 1,\n      \"tasks\": [\"Header作成\", \"Footer作成\"],\n      \"can_parallelize\": true,\n      \"reason\": \"独立したファイルを編集\",\n      \"depends_on\": []\n    },\n    {\n      \"group_id\": 2,\n      \"tasks\": [\"Layout作成\"],\n      \"can_parallelize\": false,\n      \"reason\": \"group1の出力に依存\",\n      \"depends_on\": [1]\n    }\n  ],\n  \"task_files\": {\n    \"Header作成\": [\"src/components/Header.tsx\"],\n    \"Footer作成\": [\"src/components/Footer.tsx\"],\n    \"Layout作成\": [\"src/components/Layout.tsx\"]\n  }\n}\n```\n\n---\n\n## 注意事項\n\n- **ファイルパス抽出の精度**: タスク説明から正確にファイルパスを抽出できない場合、`task_files`が空になる可能性がある\n- **既存ファイルの確認**: import依存を正確に判定するには、既存ファイルのimport文を確認する必要がある\n- **依存記法の優先**: Plans.mdに`depends:`記法がある場合、それを最優先で使用する\n- **安全側に倒す**: 依存関係が不明確な場合は並列化しない（安全側に倒す）\n",
        "skills/parallel-workflows/references/merge-worktrees.md": "---\nname: merge-worktrees\ndescription: \"Merge worktree branches back to main branch before Phase3 commit. Detects conflicts and reports to user.\"\nallowed-tools: [\"Bash\", \"Read\", \"Grep\"]\n---\n\n# Merge Worktrees\n\nPhase3（コミット実行）の前に、各worktreeブランチをメインブランチにマージするスキル。\n\n---\n\n## 入力\n\n- **worktree_branches**: 各タスクIDに対応するworktreeブランチ名\n- **base_branch**: ベースブランチ（デフォルト: `main`または`master`）\n- **worker_results**: Phase1のtask-worker実行結果\n- **commit_strategy**: `task` / `phase` / `all`\n\n---\n\n## 出力\n\n```json\n{\n  \"merged\": true,\n  \"merged_branches\": [\"worktree/task1\", \"worktree/task2\"],\n  \"conflicts\": [],\n  \"conflict_files\": []\n}\n```\n\nまたは、競合がある場合：\n\n```json\n{\n  \"merged\": false,\n  \"merged_branches\": [],\n  \"conflicts\": [\n    {\n      \"branch\": \"worktree/task1\",\n      \"files\": [\"src/components/Layout.tsx\"],\n      \"reason\": \"同一行への変更\"\n    }\n  ],\n  \"conflict_files\": [\"src/components/Layout.tsx\"]\n}\n```\n\n---\n\n## 実行手順\n\n### Step 1: ベースブランチの確認とチェックアウト\n\n```bash\n# 現在のブランチを確認\nCURRENT_BRANCH=$(git branch --show-current)\n\n# ベースブランチを確認\nif git show-ref --verify --quiet refs/heads/main; then\n  BASE_BRANCH=\"main\"\nelif git show-ref --verify --quiet refs/heads/master; then\n  BASE_BRANCH=\"master\"\nelse\n  BASE_BRANCH=\"$CURRENT_BRANCH\"\nfi\n\n# ベースブランチにチェックアウト\ngit checkout \"$BASE_BRANCH\"\n```\n\n### Step 2: 各worktreeブランチを順次マージ\n\n```bash\nCONFLICTS=()\n\nfor branch in \"${worktree_branches[@]}\"; do\n  echo \"Merging $branch into $BASE_BRANCH...\"\n  \n  # マージを試行\n  if [ \"$commit_strategy\" = \"task\" ]; then\n    # task: 既存のコミットを保持するため通常マージ\n    if git merge --no-ff --no-edit \"$branch\"; then\n      echo \"✅ Merged $branch (preserve commits)\"\n    else\n      CONFLICTS+=(\"$branch\")\n      echo \"⚠️ Conflict detected in $branch\"\n      CONFLICT_FILES=$(git diff --name-only --diff-filter=U)\n      echo \"Conflict files: $CONFLICT_FILES\"\n      git merge --abort\n    fi\n  else\n    # phase/all: 単一コミットにまとめるためsquashマージ\n    if git merge --squash \"$branch\"; then\n      echo \"✅ Squashed $branch (no commit)\"\n    else\n      CONFLICTS+=(\"$branch\")\n      echo \"⚠️ Conflict detected in $branch\"\n      CONFLICT_FILES=$(git diff --name-only --diff-filter=U)\n      echo \"Conflict files: $CONFLICT_FILES\"\n      git merge --abort\n    fi\n  fi\ndone\n```\n\n### Step 3: 3-way mergeの自動解消試行\n\n競合が発生した場合、自動解消を試行：\n\n```bash\n# 競合ファイルごとに処理\nfor file in $CONFLICT_FILES; do\n  # 変更内容を確認\n  git diff \"$BASE_BRANCH\" \"$branch\" -- \"$file\"\n  \n  # 自動マージ可能か判定\n  # - 異なる行への変更 → 自動マージ可能\n  # - 同一行への変更 → 手動解決必要\ndone\n```\n\n### Step 4: 競合レポートの生成\n\n競合がある場合、ユーザーに報告：\n\n```markdown\n⚠️ マージ競合が検出されました\n\n以下のブランチで競合が発生しています：\n\n| ブランチ | 競合ファイル | 理由 |\n|---------|-------------|------|\n| worktree/task1 | src/components/Layout.tsx | 同一行への変更 |\n| worktree/task2 | src/utils/helpers.ts | 同一行への変更 |\n\n**対応方法**:\n1. 手動で競合を解決してから続行\n2. 該当タスクをスキップして続行\n3. マージを中止して最初からやり直す\n\nどれを選択しますか？\n```\n\n---\n\n## 競合検出ロジック\n\n### 自動マージ可能なケース\n\n1. **異なるファイルへの変更**: タスクが異なるファイルを編集\n2. **異なる行への変更**: 同じファイルでも異なる行を編集\n3. **片方が削除、片方が追加**: 一方が削除、他方が追加\n\n### 手動解決が必要なケース\n\n1. **同一行への変更**: 複数のタスクが同じ行を変更\n2. **依存関係の競合**: タスクAが作成したファイルをタスクBが削除\n3. **構造的な競合**: 同じ関数/クラスを複数タスクが変更\n\n---\n\n## 使用例\n\n### 例1: 競合なしのマージ\n\n**入力**:\n```json\n{\n  \"worktree_branches\": [\n    \"worktree/Header作成\",\n    \"worktree/Footer作成\",\n    \"worktree/Sidebar作成\"\n  ],\n  \"base_branch\": \"main\"\n}\n```\n\n**実行**:\n```bash\ngit checkout main\ngit merge --no-commit --no-ff worktree/Header作成\ngit commit -m \"Merge worktree/Header作成 into main\"\n\ngit merge --no-commit --no-ff worktree/Footer作成\ngit commit -m \"Merge worktree/Footer作成 into main\"\n\ngit merge --no-commit --no-ff worktree/Sidebar作成\ngit commit -m \"Merge worktree/Sidebar作成 into main\"\n```\n\n**出力**:\n```json\n{\n  \"merged\": true,\n  \"merged_branches\": [\n    \"worktree/Header作成\",\n    \"worktree/Footer作成\",\n    \"worktree/Sidebar作成\"\n  ],\n  \"conflicts\": [],\n  \"conflict_files\": []\n}\n```\n\n### 例2: 競合ありのマージ\n\n**入力**:\n```json\n{\n  \"worktree_branches\": [\n    \"worktree/Layout作成\",\n    \"worktree/Page作成\"\n  ],\n  \"base_branch\": \"main\"\n}\n```\n\n**状況**: `Layout作成`と`Page作成`が両方`src/app/layout.tsx`の同じ行を変更\n\n**実行**:\n```bash\ngit checkout main\ngit merge --no-commit --no-ff worktree/Layout作成\n# ✅ 成功\n\ngit merge --no-commit --no-ff worktree/Page作成\n# ⚠️ 競合発生: src/app/layout.tsx\ngit merge --abort\n```\n\n**出力**:\n```json\n{\n  \"merged\": false,\n  \"merged_branches\": [\"worktree/Layout作成\"],\n  \"conflicts\": [\n    {\n      \"branch\": \"worktree/Page作成\",\n      \"files\": [\"src/app/layout.tsx\"],\n      \"reason\": \"同一行への変更\"\n    }\n  ],\n  \"conflict_files\": [\"src/app/layout.tsx\"]\n}\n```\n\n---\n\n## マージ後のクリーンアップ\n\nマージ完了後、worktreeを削除：\n\n```bash\n# 各worktreeを削除\nfor task_id in \"${task_ids[@]}\"; do\n  WORKTREE_DIR=\".worktrees/${task_id}-worktree\"\n  WORKTREE_BRANCH=\"worktree/${task_id}\"\n  \n  # worktreeを削除\n  git worktree remove \"$WORKTREE_DIR\"\n  \n  # ブランチを削除（オプション）\n  git branch -D \"$WORKTREE_BRANCH\"\ndone\n\n# 不要なworktreeをクリーンアップ\ngit worktree prune\n```\n\n---\n\n## 注意事項\n\n- **マージ順序**: 依存関係を考慮してマージ順序を決定（依存グラフの順序に従う）\n- **競合時の処理**: 競合が発生した場合、ユーザーに手動解決を依頼する\n- **worktree削除**: マージ完了後にworktreeを削除してクリーンアップする\n- **3-way merge**: 可能な限り3-way mergeで自動解消を試みる\n- **コミットメッセージ**: マージコミットには適切なメッセージを付与する\n",
        "skills/parallel-workflows/references/run-task-workers.md": "---\nname: run-task-workers\ndescription: \"Execute task-worker agents in parallel for each group. Collects commit_ready/needs_escalation status from each worker.\"\nallowed-tools: [\"Read\", \"Task\", \"Bash\"]\n---\n\n# Run Task Workers\n\n依存グラフで決定された並列グループごとに`task-worker`エージェントを起動し、結果を集約するスキル。\n\n---\n\n## 入力\n\n- **parallel_groups**: 依存グラフから取得した並列実行グループ\n- **task_files**: 各タスクが編集するファイルのマッピング\n- **parallel_count**: 同時実行数の上限（デフォルト: 1）\n- **max_iterations**: 改善ループの上限（デフォルト: 3）\n- **isolation_mode**: `lock`または`worktree`\n- **commit_strategy**: `task` / `phase` / `all`\n- **worktree_paths**: `isolation_mode=worktree`時の作業ディレクトリパス（オプション）\n\n---\n\n## 出力\n\n```json\n{\n  \"worker_results\": [\n    {\n      \"task_id\": \"task1\",\n      \"status\": \"commit_ready\",\n      \"iterations\": 2,\n      \"changes\": [\n        { \"file\": \"src/components/Header.tsx\", \"action\": \"created\" }\n      ],\n      \"self_review\": {\n        \"quality\": { \"grade\": \"A\", \"issues\": [] },\n        \"security\": { \"grade\": \"A\", \"issues\": [] },\n        \"performance\": { \"grade\": \"A\", \"issues\": [] },\n        \"compatibility\": { \"grade\": \"A\", \"issues\": [] }\n      },\n      \"build_result\": \"pass\",\n      \"test_result\": \"pass\"\n    },\n    {\n      \"task_id\": \"task2\",\n      \"status\": \"needs_escalation\",\n      \"escalation_reason\": \"max_iterations_exceeded\",\n      \"context\": {\n        \"attempted_fixes\": [\"型エラー修正\", \"import パス修正\"],\n        \"remaining_issues\": [\n          {\n            \"file\": \"src/utils/helpers.ts\",\n            \"line\": 42,\n            \"issue\": \"型 'unknown' を 'User' に変換できません\"\n          }\n        ]\n      }\n    }\n  ],\n  \"all_ready\": false,\n  \"escalation_count\": 1,\n  \"changed_files\": [\n    \"src/components/Header.tsx\",\n    \"src/components/Footer.tsx\"\n  ]\n}\n```\n\n---\n\n## 実行手順\n\n### Step 1: 並列グループを順次処理\n\n各グループは前のグループ完了後に実行（依存関係を考慮）。\n\n```javascript\n// 疑似コード例\nfor (const group of parallel_groups) {\n  if (group.depends_on.length > 0) {\n    // 依存グループの完了を待つ\n    await waitForGroups(group.depends_on);\n  }\n  \n  // グループ内のタスクを並列実行（parallel_countで上限を制御）\n  await executeGroupInParallel(group, parallel_count);\n}\n```\n\n### Step 2: グループ内タスクの並列起動\n\n各グループ内で`Task`ツールを使用して`task-worker`を並列起動：\n\n```yaml\n# Task tool呼び出し例（1つのレスポンス内で複数並列）\nTask:\n  subagent_type: \"task-worker\"\n  run_in_background: true\n  prompt: |\n    タスク: {{task_description}}\n    対象ファイル: {{task_files[task_id]}}\n    max_iterations: {{max_iterations}}\n    review_depth: \"standard\"\n```\n\n**重要**: `run_in_background: true`で起動し、`TaskOutput`で結果を収集。\n\n### Step 3: 結果の収集と待機\n\n```javascript\n// 疑似コード例\nconst results = [];\nfor (const taskId of group.tasks) {\n  const taskOutput = await getTaskOutput(taskId);\n  results.push({\n    task_id: taskId,\n    status: taskOutput.status, // \"commit_ready\" | \"needs_escalation\" | \"failed\"\n    ...taskOutput\n  });\n}\n```\n\n### Step 3.5: commit_strategy に応じた処理\n\n#### commit_strategy = task\n各task-worker完了時にコミットを実行（task単位でcommit）:\n\n```bash\n# task-worker内で実行\ngit add {{task_files[task_id]}}\ngit commit -m \"feat: {{task_id}}\"\n```\n\n#### commit_strategy = phase / all\nこのスキルではコミットしない（Phase3のexecute-commitで実行）。\n\n### Step 4: エスカレーションの集約\n\n`needs_escalation`が返されたタスクを集約：\n\n```markdown\n⚠️ エスカレーション（{{escalation_count}}件）\n\n{{#each escalation_tasks}}\nタスク{{task_id}}: {{escalation_reason}}\n  → 提案: {{suggestion}}\n\n{{/each}}\n\nどう対応しますか？\n1. 提案を適用して続行\n2. スキップして次へ\n3. 手動で修正する\n```\n\n### Step 5: changed_files の集約\n\n```javascript\n// 疑似コード例\nconst changedFiles = new Set();\nfor (const result of results) {\n  if (result.changes) {\n    for (const change of result.changes) {\n      changedFiles.add(change.file);\n    }\n  }\n}\n```\n\n---\n\n## isolation_mode別の処理\n\n### `isolation_mode=lock`（デフォルト）\n\n- 同一worktreeでファイルロックを使用\n- 各task-workerは同じディレクトリで動作\n- ファイル競合はロックで防止\n\n### `isolation_mode=worktree`\n\n- 各タスクに`git worktree add`でブランチ作成\n- `worktree_paths`が提供されている場合、それを使用\n- 各task-workerは独立したworktreeで動作\n- 完全な並列ビルド/テストが可能\n\n**worktree使用時のTask tool呼び出し**:\n\n```yaml\nTask:\n  subagent_type: \"task-worker\"\n  run_in_background: true\n  cwd: \"{{worktree_paths[task_id]}}\"  # worktreeパスを指定\n  prompt: |\n    タスク: {{task_description}}\n    対象ファイル: {{task_files[task_id]}}\n    max_iterations: {{max_iterations}}\n```\n\n---\n\n## 進捗表示\n\n実行中は以下の形式で進捗を表示：\n\n```markdown\n📊 Phase 1 進捗: 2/5 完了\n\n├── [worker-1] Header.tsx ✅ commit_ready (35秒)\n├── [worker-2] Footer.tsx ✅ commit_ready (28秒)\n├── [worker-3] Sidebar.tsx ⏳ セルフレビュー中...\n├── [worker-4] Utils.ts ⏳ 実装中...\n└── [worker-5] Types.ts 🔜 待機中（依存: Utils.ts）\n```\n\n---\n\n## エラーハンドリング\n\n### 一部タスク失敗時\n\n- 成功したタスクの結果は保持\n- 失敗タスクのみ再実行オプションを提示\n- `needs_escalation`はユーザー確認待ち\n\n### 全タスク失敗時\n\n- 共通の原因がある可能性を分析\n- 依存ファイルの不足などを確認\n- 実行順序の見直しを提案\n\n---\n\n## 使用例\n\n### 例1: 3並列実行\n\n**入力**:\n```json\n{\n  \"parallel_groups\": [\n    {\n      \"group_id\": 1,\n      \"tasks\": [\"Header作成\", \"Footer作成\", \"Sidebar作成\"],\n      \"can_parallelize\": true\n    }\n  ],\n  \"task_files\": {\n    \"Header作成\": [\"src/components/Header.tsx\"],\n    \"Footer作成\": [\"src/components/Footer.tsx\"],\n    \"Sidebar作成\": [\"src/components/Sidebar.tsx\"]\n  },\n  \"parallel_count\": 3,\n  \"max_iterations\": 3,\n  \"isolation_mode\": \"lock\",\n  \"commit_strategy\": \"task\"\n}\n```\n\n**実行**:\n```\nTask tool で3つのtask-workerを並列起動:\n- worker-1: Header作成\n- worker-2: Footer作成\n- worker-3: Sidebar作成\n\n全員の完了を待機 → 結果を集約\n```\n\n**出力**:\n```json\n{\n  \"worker_results\": [\n    { \"task_id\": \"Header作成\", \"status\": \"commit_ready\", ... },\n    { \"task_id\": \"Footer作成\", \"status\": \"commit_ready\", ... },\n    { \"task_id\": \"Sidebar作成\", \"status\": \"commit_ready\", ... }\n  ],\n  \"all_ready\": true,\n  \"escalation_count\": 0,\n  \"changed_files\": [\n    \"src/components/Header.tsx\",\n    \"src/components/Footer.tsx\",\n    \"src/components/Sidebar.tsx\"\n  ]\n}\n```\n\n---\n\n## 注意事項\n\n- **並列数の上限**: `parallel_count`で指定された数を超えない（デフォルト: 1、上限: 10）\n- **依存グループの待機**: 依存グループが完了するまで次のグループは実行しない\n- **エスカレーション処理**: `needs_escalation`が返された場合、ユーザー確認を待つ\n- **worktreeクリーンアップ**: `isolation_mode=worktree`時は後でworktreeを削除する必要がある（Phase3でマージ後）\n",
        "skills/parallel-workflows/references/setup-worktrees.md": "---\nname: setup-worktrees\ndescription: \"Create git worktrees for parallel task execution. Each task gets its own worktree branch for complete isolation.\"\nallowed-tools: [\"Bash\", \"Read\"]\n---\n\n# Setup Worktrees\n\n`--isolation=worktree`指定時に、各タスク用のgit worktreeを作成するスキル。\n\n---\n\n## 入力\n\n- **parallel_groups**: 依存グラフから取得した並列実行グループ\n- **task_files**: 各タスクが編集するファイルのマッピング\n- **base_branch**: ベースブランチ（デフォルト: `main`または`master`）\n\n---\n\n## 出力\n\n```json\n{\n  \"worktree_paths\": {\n    \"task1\": \"/path/to/project/.worktrees/task1-worktree\",\n    \"task2\": \"/path/to/project/.worktrees/task2-worktree\",\n    \"task3\": \"/path/to/project/.worktrees/task3-worktree\"\n  },\n  \"worktree_task_slugs\": {\n    \"task1\": \"task1\",\n    \"task2\": \"task2\",\n    \"task3\": \"task3\"\n  },\n  \"worktree_branches\": [\n    \"worktree/task1\",\n    \"worktree/task2\",\n    \"worktree/task3\"\n  ],\n  \"worktree_branch_map\": {\n    \"task1\": \"worktree/task1\",\n    \"task2\": \"worktree/task2\",\n    \"task3\": \"worktree/task3\"\n  }\n}\n```\n\n---\n\n## 実行手順\n\n### Step 1: ベースブランチの確認\n\n```bash\n# 現在のブランチを確認\nCURRENT_BRANCH=$(git branch --show-current)\n\n# デフォルトブランチを確認（main または master）\nif git show-ref --verify --quiet refs/heads/main; then\n  BASE_BRANCH=\"main\"\nelif git show-ref --verify --quiet refs/heads/master; then\n  BASE_BRANCH=\"master\"\nelse\n  BASE_BRANCH=\"$CURRENT_BRANCH\"\nfi\n```\n\n### Step 2: worktreeディレクトリの準備\n\n```bash\n# .worktreesディレクトリを作成（存在しない場合）\nmkdir -p .worktrees\n\n# .gitignoreに追加（既に追加されていない場合）\nif ! grep -q \"^\\.worktrees$\" .gitignore 2>/dev/null; then\n  echo \".worktrees\" >> .gitignore\nfi\n```\n\n### Step 3: 各タスク用のworktreeを作成\n\n**安全なブランチ名の生成**:\nタスクIDにスペース/記号/日本語が含まれる場合は、ブランチ名として使えるスラッグに変換する。\n\n```bash\n# 例: \"Header 作成\" → \"header-sakusei\"\n# 例: \"T001:認証\" → \"t001-auth\"\nslugify() {\n  echo \"$1\" | tr '[:upper:]' '[:lower:]' | sed -E 's/[^a-z0-9]+/-/g' | sed -E 's/^-+|-+$//g'\n}\n```\n\n```bash\n# 各タスクに対して\nfor task_id in \"${task_ids[@]}\"; do\n  TASK_SLUG=$(slugify \"$task_id\")\n  WORKTREE_DIR=\".worktrees/${TASK_SLUG}-worktree\"\n  WORKTREE_BRANCH=\"worktree/${TASK_SLUG}\"\n  \n  # ブランチを作成（ベースブランチから）\n  git branch \"$WORKTREE_BRANCH\" \"$BASE_BRANCH\" 2>/dev/null || true\n  \n  # worktreeを作成\n  git worktree add \"$WORKTREE_DIR\" \"$WORKTREE_BRANCH\"\n  \n  echo \"Created worktree: $WORKTREE_DIR (branch: $WORKTREE_BRANCH)\"\ndone\n```\n\n### Step 4: pnpm使用時の容量節約（オプション）\n\npnpmを使用している場合、shared storeを活用：\n\n```bash\n# pnpmの場合、node_modulesはシンボリックリンクで共有される\n# 各worktreeでpnpm installを実行しても容量は+54MB程度\ncd \"$WORKTREE_DIR\"\npnpm install  # shared storeを使用\n```\n\n---\n\n## 出力フォーマット\n\n### worktree_paths\n\n各タスクIDに対応するworktreeディレクトリのパス：\n\n```json\n{\n  \"task1\": \"/absolute/path/to/project/.worktrees/task1-worktree\",\n  \"task2\": \"/absolute/path/to/project/.worktrees/task2-worktree\"\n}\n```\n\n### worktree_task_slugs\n\nタスクIDとスラッグの対応表：\n\n```json\n{\n  \"Header 作成\": \"header-sakusei\",\n  \"T001:認証\": \"t001-auth\"\n}\n```\n\n### worktree_branches\n\n各タスクIDに対応するworktreeブランチ名：\n\n```json\n[\n  \"worktree/task1\",\n  \"worktree/task2\"\n]\n```\n\n### worktree_branch_map（オプション）\n\nタスクIDとブランチ名の対応表：\n\n```json\n{\n  \"task1\": \"worktree/task1\",\n  \"task2\": \"worktree/task2\"\n}\n```\n\n---\n\n## 使用例\n\n### 例1: 3タスクのworktree作成\n\n**入力**:\n```json\n{\n  \"parallel_groups\": [\n    {\n      \"group_id\": 1,\n      \"tasks\": [\"Header作成\", \"Footer作成\", \"Sidebar作成\"]\n    }\n  ],\n  \"task_files\": {\n    \"Header作成\": [\"src/components/Header.tsx\"],\n    \"Footer作成\": [\"src/components/Footer.tsx\"],\n    \"Sidebar作成\": [\"src/components/Sidebar.tsx\"]\n  }\n}\n```\n\n**実行**:\n```bash\n# Header作成用\ngit worktree add .worktrees/Header作成-worktree worktree/Header作成\n\n# Footer作成用\ngit worktree add .worktrees/Footer作成-worktree worktree/Footer作成\n\n# Sidebar作成用\ngit worktree add .worktrees/Sidebar作成-worktree worktree/Sidebar作成\n```\n\n**出力**:\n```json\n{\n  \"worktree_paths\": {\n    \"Header作成\": \"/path/to/project/.worktrees/Header作成-worktree\",\n    \"Footer作成\": \"/path/to/project/.worktrees/Footer作成-worktree\",\n    \"Sidebar作成\": \"/path/to/project/.worktrees/Sidebar作成-worktree\"\n  },\n  \"worktree_branches\": {\n    \"Header作成\": \"worktree/Header作成\",\n    \"Footer作成\": \"worktree/Footer作成\",\n    \"Sidebar作成\": \"worktree/Sidebar作成\"\n  }\n}\n```\n\n---\n\n## 注意事項\n\n- **既存worktreeの確認**: 同じタスクIDのworktreeが既に存在する場合は削除してから作成\n- **ブランチ名の衝突**: `worktree/{task_id}`形式のブランチ名が既に存在する場合は番号を付与\n- **.gitignoreへの追加**: `.worktrees`ディレクトリは`.gitignore`に追加する（既に追加されていない場合）\n- **pnpm使用時**: pnpmのshared storeにより、各worktreeの`node_modules`は約54MBで済む\n- **クリーンアップ**: Phase3完了後、`merge-worktrees`スキルでマージし、その後worktreeを削除する\n\n---\n\n## トラブルシューティング\n\n### Q: worktree作成時にエラーが発生\n\n**A**: 既存のworktreeやブランチを確認：\n\n```bash\n# 既存worktree一覧\ngit worktree list\n\n# 既存ブランチ一覧\ngit branch -a | grep worktree\n\n# 必要に応じて削除\ngit worktree remove .worktrees/task1-worktree\ngit branch -D worktree/task1\n```\n\n### Q: pnpm installが遅い\n\n**A**: shared storeが正しく設定されているか確認：\n\n```bash\n# pnpm store pathを確認\npnpm store path\n\n# 各worktreeで同じstoreを使用していることを確認\ncd .worktrees/task1-worktree\npnpm store path  # 同じパスが表示されるはず\n```\n",
        "skills/plans-management/SKILL.md": "---\nname: plans-management\ndescription: \"Manages Plans.md tasks and marker operations. Use when user mentions adding tasks, updating Plans.md, marking complete, or changing task status. Do NOT load for: implementation work, reviews, or non-Plans file operations.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\"]\n---\n\n# Plans Management Skill\n\nPlans.md のタスク管理とマーカー運用を行うスキル。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで起動します：\n\n- 「タスクを追加して」\n- 「Plans.md を更新して」\n- 「完了マークをつけて」\n- 「タスクの状態を変更して」\n- \"add a task\"\n- \"update plans\"\n- \"mark as complete\"\n\n---\n\n## 概要\n\nこのスキルは Plans.md の編集・更新を支援します。\nタスクの追加、状態変更、アーカイブを一貫したフォーマットで行います。\n\n---\n\n## Plans.md の構造\n\n```markdown\n# Plans.md - タスク管理\n\n> **最終更新**: YYYY-MM-DD HH:MM\n> **更新者**: Claude Code / PM（Cursor/PM Claude）\n\n---\n\n## 🔴 進行中のタスク\n\n- [ ] タスク名 `cc:WIP`\n  - 詳細説明\n  - 関連ファイル: `path/to/file.ts`\n\n---\n\n## 🟡 未着手のタスク\n\n- [ ] タスク名 `cc:TODO`\n- [ ] タスク名 `pm:依頼中`（互換: cursor:依頼中）\n\n---\n\n## 🟢 完了タスク\n\n- [x] タスク名 `pm:確認済` (YYYY-MM-DD)\n\n---\n\n## 📦 アーカイブ\n\n<!-- 古い完了タスクはここに移動 -->\n```\n\n---\n\n## マーカー運用ルール\n\n### 状態変更のルール\n\n| 変更 | 実行者 | 条件 |\n|------|--------|------|\n| `pm:依頼中`（互換: cursor:依頼中） → `cc:WIP` | Claude Code | タスク着手時 |\n| `cc:TODO` → `cc:WIP` | Claude Code | タスク着手時 |\n| `cc:WIP` → `cc:完了` | Claude Code | 作業完了時 |\n| `cc:完了` → `pm:確認済`（互換: cursor:確認済） | PM | レビュー完了時 |\n| `*` → `blocked` | どちらでも | ブロック発生時 |\n\n### マーカーのフォーマット\n\n```markdown\n# 正しい例\n- [ ] タスク名 `cc:WIP`\n- [x] タスク名 `cc:完了` (2024-01-15)\n\n# 間違った例\n- [ ] タスク名 cc:WIP      # バッククォートなし\n- [ ] タスク名 `cc: WIP`   # スペースあり\n```\n\n---\n\n## タスク操作\n\n### タスクの追加\n\n```markdown\n## 追加前\n## 🟡 未着手のタスク\n\n- [ ] 既存タスク `cc:TODO`\n\n## 追加後\n## 🟡 未着手のタスク\n\n- [ ] 既存タスク `cc:TODO`\n- [ ] 新規タスク `cc:TODO`\n  - 詳細説明（あれば）\n```\n\n### タスクの状態変更\n\n```markdown\n## 変更前\n- [ ] タスク名 `cc:TODO`\n\n## 変更後\n- [ ] タスク名 `cc:WIP`\n```\n\n### タスクの完了\n\n```markdown\n## 変更前\n- [ ] タスク名 `cc:WIP`\n\n## 変更後\n- [x] タスク名 `cc:完了` (2024-01-15)\n```\n\n### タスクのアーカイブ\n\n完了から 7日以上経過したタスクはアーカイブセクションに移動：\n\n```markdown\n## 📦 アーカイブ\n\n### 2024年1月\n- [x] タスク1 `pm:確認済` (2024-01-10)\n- [x] タスク2 `pm:確認済` (2024-01-08)\n```\n\n---\n\n## 自動整形ルール\n\nPlans.md を更新する際は以下を遵守：\n\n1. **最終更新を必ず記載**: ヘッダーの日時を更新\n2. **セクション順序を維持**: 進行中 → 未着手 → 完了 → アーカイブ\n3. **空セクションは残す**: タスクがなくてもセクションヘッダーは削除しない\n4. **インデントを統一**: 2スペースまたは4スペース\n\n---\n\n## 便利なパターン\n\n### サブタスク\n\n```markdown\n- [ ] 親タスク `cc:WIP`\n  - [x] サブタスク1\n  - [ ] サブタスク2\n  - [ ] サブタスク3\n```\n\n### ブロック理由の記載\n\n```markdown\n- [ ] タスク名 `blocked`\n  - ブロック理由: API キーの発行待ち\n  - 担当: @username\n  - 期限: 2024-01-20\n```\n\n### 優先度の表現\n\n```markdown\n- [ ] 🔥 緊急タスク `pm:依頼中`（互換: cursor:依頼中）\n- [ ] ⭐ 重要タスク `cc:TODO`\n- [ ] タスク `cc:TODO`\n```\n\n---\n\n## 関連コマンド\n\n- `/sync-status` - 現在の状態サマリーを出力\n- `/handoff-to-cursor` - 完了報告時に Plans.md を自動更新\n\n---\n\n## 注意事項\n\n- **Plans.md は単一ソース**: タスク情報を他のファイルに分散させない\n- **こまめに更新**: 作業開始時・終了時に必ず更新\n- **Cursor との同期**: 長時間経過したら `/sync-status` で確認\n\n---\n\n## 拡張記法（オプション）\n\n大規模プロジェクトでは以下の記法を**オプション**で使用可能：\n\n### タスク ID / 依存関係 / 並列可\n\n```markdown\n- [ ] T001: 認証機能 `cc:TODO`\n- [ ] T002: ユーザーAPI `cc:TODO` depends:T001\n- [ ] T003: 商品API `cc:TODO` [P]\n- [ ] T004: 注文API `cc:TODO` depends:T001,T003\n```\n\n| 記法 | 意味 | 用途 |\n|------|------|------|\n| `T001:` | タスクID | 参照・依存指定に利用 |\n| `depends:ID` | 依存タスク | `depends:T001,T002`（カンマ区切り） |\n| `[P]` | 並列可（Parallelizable） | `/work` 実行時に他タスクと同時実行 |\n\n### 依存解析の例\n\n```\nT001 (認証) ─────────────┐\n                         ↓\nT003 (商品API) [P] ─────> T004 (注文API)\n                         ↑\nT002 (ユーザーAPI) ─────┘\n```\n\n**後方互換**: ID/depends/[P] がなくても従来形式で問題なく動作する。\n",
        "skills/plans-management/examples/task-lifecycle.md": "# タスクライフサイクル例\n\n実際のタスクが Plans.md でどのように管理されるかの例。\n\n---\n\n## 例1: 通常のタスクフロー\n\n### Step 1: PM がタスクを追加\n\n```markdown\n## 🟡 未着手のタスク\n\n- [ ] ログイン画面のバリデーション追加 `pm:依頼中`\n  - メールアドレス形式チェック\n  - パスワード強度チェック\n```\n\n### Step 2: Claude Code が着手\n\n```markdown\n## 🔴 進行中のタスク\n\n- [ ] ログイン画面のバリデーション追加 `cc:WIP`\n  - メールアドレス形式チェック\n  - パスワード強度チェック\n  - 関連ファイル: `src/components/LoginForm.tsx`\n```\n\n### Step 3: Claude Code が完了\n\n```markdown\n## 🟢 完了タスク\n\n- [x] ログイン画面のバリデーション追加 `cc:完了` (2024-01-15)\n  - メールアドレス形式チェック\n  - パスワード強度チェック\n  - 関連ファイル: `src/components/LoginForm.tsx`\n```\n\n### Step 4: PM が確認\n\n```markdown\n## 🟢 完了タスク\n\n- [x] ログイン画面のバリデーション追加 `pm:確認済` (2024-01-15)\n```\n\n---\n\n## 例2: サブタスクを含むタスク\n\n```markdown\n## 🔴 進行中のタスク\n\n- [ ] ユーザー管理機能の実装 `cc:WIP`\n  - [x] データベーススキーマ設計\n  - [x] API エンドポイント作成\n  - [ ] フロントエンド実装\n  - [ ] テスト作成\n```\n\n---\n\n## 例3: ブロックされたタスク\n\n```markdown\n## 🟡 未着手のタスク\n\n- [ ] 決済機能の実装 `blocked`\n  - ブロック理由: Stripe アカウントの本番環境承認待ち\n  - 担当: @client\n  - 予定解消日: 2024-01-20\n```\n\n---\n\n## 例4: 優先度付きタスク\n\n```markdown\n## 🟡 未着手のタスク\n\n- [ ] 🔥 【緊急】本番エラー修正 `pm:依頼中`\n- [ ] ⭐ 【重要】パフォーマンス改善 `cc:TODO`\n- [ ] ドキュメント更新 `cc:TODO`\n```\n\n---\n\n## 例5: アーカイブ\n\n```markdown\n## 📦 アーカイブ\n\n### 2024年1月\n\n- [x] 初期プロジェクトセットアップ `pm:確認済` (2024-01-10)\n- [x] CI/CD 構築 `pm:確認済` (2024-01-12)\n- [x] 認証機能実装 `pm:確認済` (2024-01-14)\n\n### 2023年12月\n\n- [x] 要件定義 `pm:確認済` (2023-12-20)\n```\n",
        "skills/plans-management/references/init-requirements.md": "---\nname: init-requirements\ndescription: \"ユーザーの要望を短い質問で明確化し、feature_request を作成する。/plan で user_prompt が空のときに使用。\"\nallowed-tools: [\"Read\"]\n---\n\n# Init Requirements\n\nユーザーの要望が曖昧または未入力の場合に、最小限の質問で要件を明確化するスキル。\n\n---\n\n## 入力\n\n- **user_intent**: ユーザーの目的や背景（任意）\n\n---\n\n## 出力\n\n```json\n{\n  \"feature_request\": \"ユーザーの要望を1-2文で要約したもの\"\n}\n```\n\n---\n\n## 実行手順\n\n1. 目的・対象ユーザー・制約の3点を確認する  \n2. 回答から `feature_request` を生成する  \n3. 未回答の場合は仮の前提を置いて要約する  \n\n---\n\n## 質問テンプレート\n\n- 目的: 「何を実現したいですか？」\n- 対象: 「誰が使う想定ですか？」\n- 制約: 「期限や技術制約はありますか？」\n\n",
        "skills/plans-management/references/markers.md": "# Plans.md マーカーリファレンス\n\nPlans.md で使用するすべてのマーカーの詳細仕様。\n\n---\n\n## マーカー一覧\n\n### Claude Code 用マーカー\n\n| マーカー | 状態 | 説明 |\n|---------|------|------|\n| `cc:TODO` | 未着手 | Claude Code が着手すべきタスク |\n| `cc:WIP` | 作業中 | Claude Code が現在作業中 |\n| `cc:完了` | 完了待ち | Claude Code の作業完了、PM確認待ち |\n\n### PM（Cursor/PM Claude）用マーカー\n\n| マーカー | 状態 | 説明 |\n|---------|------|------|\n| `pm:依頼中` | 依頼済 | PM から Claude Code への依頼 |\n| `pm:確認済` | 確認完了 | PM がレビュー・確認完了 |\n\n### 互換マーカー\n\n旧形式との互換性のために以下も認識：\n\n| 互換マーカー | 正式マーカー |\n|-------------|-------------|\n| `cursor:依頼中` | `pm:依頼中` |\n| `cursor:確認済` | `pm:確認済` |\n\n### 共通マーカー\n\n| マーカー | 説明 |\n|---------|------|\n| `blocked` | ブロック中（理由を併記必須） |\n\n---\n\n## マーカーの書式ルール\n\n### 正しい書式\n\n```markdown\n- [ ] タスク名 `cc:WIP`\n- [x] タスク名 `cc:完了` (2024-01-15)\n```\n\n### よくある間違い\n\n| 間違い | 問題点 |\n|--------|--------|\n| `cc: WIP` | コロン後にスペース |\n| `cc:wip` | 小文字（大文字/日本語を使用） |\n| `CC:WIP` | プレフィックスが大文字 |\n| バッククォートなし | 検索・パースが困難 |\n\n---\n\n## 状態遷移\n\n```\n[新規タスク]\n    │\n    ▼\npm:依頼中 ──→ cc:TODO ──→ cc:WIP ──→ cc:完了 ──→ pm:確認済\n                ↑            │\n                └────────────┘\n                 (差し戻し)\n```\n\n### 遷移ルール\n\n| 遷移 | 実行者 | タイミング |\n|------|--------|-----------|\n| `pm:依頼中` → `cc:WIP` | Claude Code | タスク着手時 |\n| `cc:TODO` → `cc:WIP` | Claude Code | タスク着手時 |\n| `cc:WIP` → `cc:完了` | Claude Code | 作業完了時 |\n| `cc:完了` → `pm:確認済` | PM | レビュー完了時 |\n| `*` → `blocked` | どちらでも | ブロック発生時 |\n| `cc:完了` → `cc:WIP` | Claude Code | 差し戻し対応時 |\n\n---\n\n## 検索パターン\n\n```bash\n# 全マーカーを検索\ngrep -E '`(cc:|pm:|cursor:|blocked)' Plans.md\n\n# 進行中タスク\ngrep '`cc:WIP`' Plans.md\n\n# 確認待ちタスク\ngrep '`cc:完了`' Plans.md\n\n# PM依頼タスク\ngrep -E '`(pm|cursor):依頼中`' Plans.md\n```\n",
        "skills/plans-management/references/parse-work-flags.md": "---\nname: parse-work-flags\ndescription: \"Parse /work command flags from user_prompt. Extracts --parallel, --isolation, --commit-strategy, --max-iterations, --skip-cross-review, --resume, --fork options. /work defaults to full automation with smart parallel detection.\"\nallowed-tools: [\"Read\"]\n---\n\n# Parse Work Flags\n\n`/work`コマンドのフラグを解析し、実行モードとオプションを決定するスキル。\n\n---\n\n## 入力\n\n- **user_prompt**: `/work`コマンドの入力文字列\n  - 例: `/work` (フル自動化、並列数は自動判定)\n  - 例: `/work --parallel 5` (並列数を明示指定)\n  - 例: `/work --sequential` (並列なしを強制)\n\n---\n\n## 出力\n\n以下の変数を必ず出力する（デフォルト値を明示）：\n\n```json\n{\n  \"full_mode\": true,\n  \"parallel_count\": \"auto\",\n  \"isolation_mode\": \"worktree\",\n  \"commit_strategy\": \"phase\",\n  \"max_iterations\": 3,\n  \"skip_cross_review\": false,\n  \"resume_session_id\": \"\",\n  \"resume_latest\": false,\n  \"fork_session_id\": \"\",\n  \"fork_reason\": \"\"\n}\n```\n\n---\n\n## デフォルト動作 (Turbo Mode)\n\n`/work` はデフォルトでフル自動化モードで動作します：\n\n- **full_mode**: `true` (常に有効)\n- **parallel_count**: `auto` (タスク依存関係から自動判定)\n- **isolation_mode**: `worktree` (並列ビルド対応)\n- **commit_strategy**: `phase` (フェーズ単位でコミット)\n\n### 並列数の自動判定ロジック\n\n```javascript\nfunction determineParallelCount(tasks) {\n  // 1. タスク数が1つなら並列不要\n  if (tasks.length <= 1) return 1;\n\n  // 2. 依存関係グラフを構築\n  const dependencyGraph = buildDependencyGraph(tasks);\n\n  // 3. 同一ファイルを編集するタスクは並列不可\n  const fileConflicts = detectFileConflicts(tasks);\n\n  // 4. 独立したタスク数を算出\n  const independentTasks = tasks.filter(t => !hasConflict(t, fileConflicts));\n\n  // 5. 最大3並列に制限（リソース効率）\n  return Math.min(independentTasks.length, 3);\n}\n```\n\n### 判定基準\n\n| 条件 | 並列数 |\n|------|:------:|\n| タスク1つ | 1 |\n| 全タスクが同一ファイル編集 | 1 |\n| 独立タスク2-3個 | 2-3 |\n| 独立タスク4個以上 | 3 (上限) |\n\n---\n\n## フラグ解析ルール\n\n### `--parallel N`\n- 検出: `--parallel`の後に数値が続く\n- パターン: `--parallel\\s+(\\d+)` または `--parallel=(\\d+)`\n- デフォルト: `auto` (自動判定)\n- 出力: `parallel_count: N`（1-10の範囲、超過時は10に制限）\n\n### `--sequential`\n- 検出: `user_prompt`に`--sequential`が含まれる\n- 出力: `parallel_count: 1` (並列なしを強制)\n\n### `--isolation lock|worktree`\n- 検出: `--isolation`の後に`lock`または`worktree`が続く\n- パターン: `--isolation\\s+(lock|worktree)` または `--isolation=(lock|worktree)`\n- デフォルト: `lock`\n- 出力: `isolation_mode: \"lock\"` または `\"worktree\"`\n\n### `--commit-strategy task|phase|all`\n- 検出: `--commit-strategy`の後に`task`/`phase`/`all`が続く\n- パターン: `--commit-strategy\\s+(task|phase|all)` または `--commit-strategy=(task|phase|all)`\n- デフォルト: `task`\n- 出力: `commit_strategy: \"task\"` / `\"phase\"` / `\"all\"`\n\n### `--max-iterations N`\n- 検出: `--max-iterations`の後に数値が続く\n- パターン: `--max-iterations\\s+(\\d+)` または `--max-iterations=(\\d+)`\n- デフォルト: `3`\n- 出力: `max_iterations: N`（1-10の範囲）\n\n### `--skip-cross-review`\n- 検出: `user_prompt`に`--skip-cross-review`が含まれる\n- デフォルト: `false`\n- 出力: `skip_cross_review: true`\n\n### `--resume <session_id|latest>`\n- 検出: `--resume`の後にIDまたは`latest`が続く\n- パターン: `--resume\\\\s+(\\\\S+)` または `--resume=(\\\\S+)`\n- デフォルト: `\"\"`\n- 出力:\n  - `resume_session_id: <id>`（`latest`の場合は空）\n  - `resume_latest: true`（`latest`の場合）\n\n### `--fork <session_id|current> --reason <text>`\n- 検出: `--fork`の後にIDまたは`current`が続く\n- パターン: `--fork\\\\s+(\\\\S+)` または `--fork=(\\\\S+)`\n- デフォルト: `\"\"`\n- 出力:\n  - `fork_session_id: <id>`（`current`の場合は空）\n  - `fork_reason: \"<text>\"`（省略時は空）\n\n---\n\n## 実行手順\n\n### Step 1: user_promptの読み取り\n\n```bash\n# user_promptはワークフローから渡される\n# 例: \"/work --full --parallel 3\"\n```\n\n### Step 2: フラグの抽出\n\n正規表現または文字列検索で各フラグを検出：\n\n```javascript\n// 疑似コード例\nconst flags = {\n  full_mode: /--full/.test(user_prompt),\n  parallel_count: extractNumber(user_prompt, /--parallel[\\s=]+(\\d+)/) || 1,\n  isolation_mode: extractString(user_prompt, /--isolation[\\s=]+(lock|worktree)/) || \"lock\",\n  commit_strategy: extractString(user_prompt, /--commit-strategy[\\s=]+(task|phase|all)/) || \"task\",\n  deploy_after_commit: /--deploy/.test(user_prompt),\n  max_iterations: extractNumber(user_prompt, /--max-iterations[\\s=]+(\\d+)/) || 3,\n  skip_cross_review: /--skip-cross-review/.test(user_prompt),\n  resume_session_id: extractString(user_prompt, /--resume[\\s=]+(\\S+)/) || \"\",\n  resume_latest: /--resume[\\s=]+latest/.test(user_prompt),\n  fork_session_id: extractString(user_prompt, /--fork[\\s=]+(\\S+)/) || \"\",\n  fork_reason: extractString(user_prompt, /--reason[\\s=]+(.+)/) || \"\"\n};\n```\n\n### Step 3: バリデーション\n\n- `parallel_count`: 1-10の範囲に制限\n- `max_iterations`: 1-10の範囲に制限\n- `isolation_mode`: `lock`または`worktree`のみ許可\n- `commit_strategy`: `task`/`phase`/`all`のみ許可\n\n### Step 4: 出力\n\nワークフロー変数として出力：\n\n```yaml\noutput:\n  variables:\n    - full_mode\n    - parallel_count\n    - isolation_mode\n    - commit_strategy\n    - deploy_after_commit\n    - max_iterations\n    - skip_cross_review\n```\n\n---\n\n## 使用例\n\n### 例1: 基本的な`--full`\n```\n入力: \"/work --full\"\n出力:\n  full_mode: true\n  parallel_count: 1\n  isolation_mode: \"lock\"\n  commit_strategy: \"task\"\n  deploy_after_commit: false\n  max_iterations: 3\n  skip_cross_review: false\n  resume_session_id: \"\"\n  resume_latest: false\n  fork_session_id: \"\"\n  fork_reason: \"\"\n```\n\n### 例2: 並列実行指定\n```\n入力: \"/work --full --parallel 5\"\n出力:\n  full_mode: true\n  parallel_count: 5\n  isolation_mode: \"lock\"\n  commit_strategy: \"task\"\n  deploy_after_commit: false\n  max_iterations: 3\n  skip_cross_review: false\n```\n\n### 例3: 完全なオプション指定\n```\n入力: \"/work --full --parallel 3 --isolation worktree --commit-strategy phase --deploy --max-iterations 5\"\n出力:\n  full_mode: true\n  parallel_count: 3\n  isolation_mode: \"worktree\"\n  commit_strategy: \"phase\"\n  deploy_after_commit: true\n  max_iterations: 5\n  skip_cross_review: false\n```\n\n### 例4: 非`--full`モード（既存フロー）\n```\n入力: \"/work\"\n出力:\n  full_mode: false\n  parallel_count: 1\n  isolation_mode: \"lock\"\n  commit_strategy: \"task\"\n  deploy_after_commit: false\n  max_iterations: 3\n  skip_cross_review: false\n```\n\n---\n\n## 注意事項\n\n- **フラグの順序は問わない**: `--full --parallel 3`と`--parallel 3 --full`は同じ結果\n- **大文字小文字を区別しない**: `--FULL`も`--full`として認識\n- **未指定フラグはデフォルト値**: 明示的に指定されていないフラグはデフォルト値を使用\n- **不正な値はデフォルトにフォールバック**: `--parallel abc`は`parallel_count: 1`になる\n",
        "skills/plans-management/references/plan-feature.md": "---\nname: plan-feature\ndescription: \"feature_request を Plans.md のタスクに分解し、cc:TODO で追記する。\"\nallowed-tools: [\"Read\", \"Edit\"]\n---\n\n# Plan Feature\n\n要望を実行可能なタスクに分解し、Plans.md に追加するスキル。\n\n---\n\n## 入力\n\n- **Plans.md**: 既存タスク一覧\n- **feature_request**: 要望の要約（文字列）\n- **user_prompt**: ユーザーの指示（任意）\n- **tech_stack**: 技術スタック（任意）\n\n---\n\n## 出力\n\n- Plans.md へのタスク追加（`cc:TODO`）\n- 変数: `task_count`, `phase_name`\n\n---\n\n## 実行手順\n\n1. `feature_request` を 3〜7 個のタスクに分解  \n2. 依存関係がある場合は `depends:` を付与  \n3. Plans.md の「未着手」セクションに追記  \n4. `task_count` と `phase_name` を出力  \n\n---\n\n## 出力例\n\n```json\n{\n  \"task_count\": 4,\n  \"phase_name\": \"実装\"\n}\n```\n\n",
        "skills/plans-management/references/plan-review.md": "---\nname: plan-review\ndescription: \"Plans.md のタスク分解が妥当かをレビューし、改善点を提案する。\"\nallowed-tools: [\"Read\"]\n---\n\n# Plan Review\n\nPlans.md に追加されたタスクが妥当かを確認し、改善点を提示するスキル。\n\n---\n\n## 入力\n\n- **Plans.md**: タスク一覧\n- **previous_step_output**: plan-feature の結果（任意）\n\n---\n\n## 出力\n\n- 改善提案（必要な場合のみ）\n\n---\n\n## レビュー観点\n\n- タスク数が過剰/不足していないか\n- 依存関係が明確か\n- リスクや検証が含まれているか\n- 作業順序が合理的か\n\n",
        "skills/principles/SKILL.md": "---\nname: principles\ndescription: \"Provides development principles, guidelines, and VibeCoder guidance. Use when user mentions principles, guidelines, safety, or diff-aware editing. Do not use for actual implementation—use the impl skill instead.\"\nallowed-tools: [\"Read\"]\nuser-invocable: false\n---\n\n# Principles Skills\n\n開発原則とガイドラインを提供するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **基本原則** | See [references/general-principles.md](references/general-principles.md) |\n| **差分編集** | See [references/diff-aware-editing.md](references/diff-aware-editing.md) |\n| **コンテキスト読み取り** | See [references/repo-context-reading.md](references/repo-context-reading.md) |\n| **VibeCoder** | See [references/vibecoder-guide.md](references/vibecoder-guide.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容を参照・適用\n",
        "skills/principles/references/diff-aware-editing.md": "---\nname: core-diff-aware-editing\ndescription: \"最小限の差分でファイルを編集し、既存コードへの影響を最小化する。\"\nallowed-tools: [\"Read\", \"Edit\"]\n---\n\n# Diff-Aware Editing\n\nファイル編集時に最小限の差分で変更を行うスキル。\n既存コードの破壊を防ぎ、レビューしやすい変更を実現します。\n\n---\n\n## 基本原則\n\n### 1. Read Before Edit\n\n**必ず対象ファイルを読んでから編集する**\n\n```\n❌ 悪い例: Write ツールでファイル全体を上書き\n✅ 良い例: Read → 内容確認 → Edit で必要部分のみ変更\n```\n\n### 2. 最小差分の優先\n\n変更は必要最小限に留める：\n\n- 既存のインデント・フォーマットを維持\n- 既存のコメントは残す\n- 使われているスタイルに合わせる\n\n### 3. 意味のある単位で変更\n\n```typescript\n// ❌ 悪い例: 無関係な変更を混ぜる\n// 関数の追加 + フォーマット変更 + import整理\n\n// ✅ 良い例: 1つの変更に集中\n// 関数の追加のみ\n```\n\n---\n\n## Edit ツールの使い方\n\n### パターン1: 単純な置換\n\n```\nold_string: \"const value = 1\"\nnew_string: \"const value = 2\"\n```\n\n### パターン2: コードブロックの追加\n\n```\nold_string: \"// TODO: implement feature\"\nnew_string: \"// Feature implemented\nconst feature = () => {\n  // implementation\n}\"\n```\n\n### パターン3: 関数の修正\n\n```\nold_string: \"function getData() {\n  return []\n}\"\nnew_string: \"function getData() {\n  const data = fetchData()\n  return data\n}\"\n```\n\n---\n\n## 避けるべきパターン\n\n### 1. ファイル全体の書き換え\n\n```\n❌ Write ツールで 100 行のファイルを丸ごと書き直す\n✅ Edit ツールで変更が必要な 5 行だけ修正\n```\n\n### 2. フォーマット変更の混入\n\n```\n❌ 機能追加と同時にインデントを変更\n✅ 機能追加のみ。フォーマットは別コミットで\n```\n\n### 3. 不要な空行・コメントの追加\n\n```\n❌ 自分のスタイルを押し付ける\n✅ 既存のスタイルに従う\n```\n\n---\n\n## 編集前チェックリスト\n\n1. [ ] 対象ファイルを Read で確認した\n2. [ ] 変更が必要な箇所を特定した\n3. [ ] 既存のスタイル（インデント、命名規則）を把握した\n4. [ ] 変更が paths.allowed_modify に含まれるか確認した\n5. [ ] 変更後の動作をイメージできた\n\n---\n\n## 編集後の確認\n\n```bash\n# 差分の確認\ngit diff\n\n# 変更行数の確認（大きすぎないか）\ngit diff --stat\n\n# 構文エラーがないか\nnpm run build 2>&1 | head -20\n# または\nnpx tsc --noEmit\n```\n\n---\n\n## 複数ファイルの編集\n\n複数ファイルを編集する場合：\n\n1. **依存関係の順序**: 型定義 → 実装 → テスト\n2. **一貫性の確保**: 関連する変更は同時に行う\n3. **中間状態でも動作**: 各編集後にビルドが通る状態を維持\n\n---\n\n## エラー時の対応\n\n編集でエラーが発生した場合：\n\n1. **元のコードを再確認**: Read で現在の状態を確認\n2. **old_string の一致確認**: 空白・改行を正確に\n3. **分割して試行**: 大きな変更は小さく分割\n",
        "skills/principles/references/general-principles.md": "---\nname: core-general-principles\ndescription: \"開発の基本原則とセーフティルールを提供する。すべてのタスクで適用される基本的なガイドライン。\"\n---\n\n# General Principles\n\nclaude-code-harness を使用する際の基本原則です。すべてのワークフローで適用されます。\n\n---\n\n## 安全性の原則\n\n### 1. 確認してから変更する\n\nファイルを編集する前に、必ず以下を確認：\n\n- **Read ツールで内容を確認**: 既存のコードを理解してから変更\n- **影響範囲を把握**: 変更が他のファイルに与える影響を考慮\n- **バックアップの考慮**: 重要な変更前は git status を確認\n\n### 2. 最小限の差分で編集\n\n```\n❌ 悪い例: ファイル全体を書き換える\n✅ 良い例: Edit ツールで必要な部分のみ変更\n```\n\n### 3. 設定ファイルの尊重\n\n`claude-code-harness.config.json` の設定に従う：\n\n- `safety.mode`: dry-run / apply-local / apply-and-push\n- `paths.protected`: 保護されたパスは変更しない\n- `paths.allowed_modify`: 許可されたパスのみ変更\n\n---\n\n## 作業の原則\n\n### 1. Plans.md を常に更新\n\n- タスク開始時: `cc:TODO` → `cc:WIP`\n- タスク完了時: `cc:WIP` → `cc:完了`\n- ブロック時: `blocked` を付与し理由を記載\n\n### 2. 段階的に進める\n\n```\n1. 調査・理解 → 2. 計画 → 3. 実装 → 4. 確認 → 5. 報告\n```\n\n### 3. エラー時の対応\n\n- 最大 3 回の自動リトライ\n- 解決しない場合はエスカレーション（報告）\n- エラー内容と試した対処を明記\n\n---\n\n## コミュニケーションの原則\n\n### VibeCoder 対応\n\n技術知識がなくても理解できるよう：\n\n- **専門用語を避ける**: または説明を添える\n- **次のアクションを提示**: 「次は〇〇と言ってください」\n- **進捗を可視化**: 完了したこと、残っていることを明確に\n\n### PM（Cursor）との連携\n\n- **Plans.md で状態を共有**: 単一ソースとして維持\n- **完了報告は `/handoff-to-cursor`**: フォーマットに従う\n- **スコープを守る**: 依頼された範囲外の作業は確認を取る\n\n---\n\n## 禁止事項\n\n1. **本番環境への直接デプロイ**（staging まで）\n2. **機密情報のハードコード**（.env を使用）\n3. **保護されたパスの変更**（.github/, secrets/ など）\n4. **ユーザー確認なしの破壊的操作**（rm -rf など）\n",
        "skills/principles/references/repo-context-reading.md": "---\nname: core-read-repo-context\ndescription: \"リポジトリのコンテキスト（README, Plans.md, 既存コード）を読み取り理解する。セッション開始時、新しいタスク開始前、またはプロジェクト構造の理解が必要な場合に使用します。\"\nallowed-tools: [\"Read\", \"Grep\", \"Glob\"]\n---\n\n# Read Repository Context\n\nリポジトリの構造とコンテキストを把握するためのスキル。\n作業開始前や、新しい機能の実装前に使用します。\n\n---\n\n## 入力\n\n- **必須**: リポジトリのルートディレクトリへのアクセス\n- **オプション**: 特定のファイルやディレクトリへのフォーカス指定\n\n---\n\n## 出力\n\nリポジトリの理解を含む構造化されたコンテキスト情報\n\n---\n\n## 実行手順\n\n### Step 1: 基本構造の把握\n\n```bash\n# ディレクトリ構造\nls -la\nfind . -maxdepth 2 -type d | head -20\n\n# 主要ファイルの確認\ncat README.md 2>/dev/null | head -50\ncat package.json 2>/dev/null | head -20\n```\n\n### Step 2: ワークフローファイルの確認\n\n```bash\n# Plans.md の状態\ncat Plans.md 2>/dev/null || echo \"Plans.md not found\"\n\n# AGENTS.md の役割分担\ncat AGENTS.md 2>/dev/null | head -100 || echo \"AGENTS.md not found\"\n\n# CLAUDE.md の設定\ncat CLAUDE.md 2>/dev/null | head -50 || echo \"CLAUDE.md not found\"\n```\n\n### Step 3: 技術スタックの特定\n\n```bash\n# フロントエンド\n[ -f package.json ] && cat package.json | grep -E '\"(react|vue|angular|next|nuxt)\"'\n\n# バックエンド\n[ -f requirements.txt ] && head -10 requirements.txt\n[ -f Gemfile ] && head -10 Gemfile\n[ -f go.mod ] && head -10 go.mod\n\n# 設定ファイル\n[ -f tsconfig.json ] && echo \"TypeScript project\"\n[ -f .eslintrc* ] && echo \"ESLint configured\"\n[ -f tailwind.config.* ] && echo \"Tailwind CSS\"\n```\n\n### Step 4: Git 状態の確認\n\n```bash\ngit status -sb\ngit log --oneline -5\ngit branch -a | head -10\n```\n\n---\n\n## 出力フォーマット\n\n```markdown\n## 📁 リポジトリコンテキスト\n\n### 基本情報\n- **プロジェクト名**: {{name}}\n- **技術スタック**: {{framework}} + {{language}}\n- **現在のブランチ**: {{branch}}\n\n### ワークフロー状態\n- **Plans.md**: {{存在する/しない, タスク数}}\n- **AGENTS.md**: {{存在する/しない}}\n- **CLAUDE.md**: {{存在する/しない}}\n\n### 直近の変更\n{{最近のコミット3件}}\n\n### 重要なファイル\n{{認識すべき主要ファイル一覧}}\n```\n\n---\n\n## 使用タイミング\n\n1. **セッション開始時**: 現在の状態把握\n2. **新機能実装前**: 既存コードとの整合性確認\n3. **エラー調査時**: 関連ファイルの特定\n4. **レビュー時**: 変更の影響範囲理解\n\n---\n\n## 注意事項\n\n- **大規模リポジトリ**: ファイル数が多い場合は重要部分に絞る\n- **秘密情報**: .env や secrets/ の内容は読まない\n- **キャッシュ活用**: 同一セッション内では再読み込みを最小化\n",
        "skills/principles/references/vibecoder-guide.md": "---\nname: vibecoder-guide\ndescription: \"VibeCoder（非技術者）が自然言語で開発を進められるようガイドするスキル。非技術者向けのガイダンスを提供する場合に使用します。\"\nallowed-tools: [\"Read\"]\n---\n\n# VibeCoder Guide\n\nVibeCoder（非技術者）が自然言語だけで開発を進められるようガイドするスキル。\n「どうすればいい？」「次は何？」などの質問に自動で応答します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「どうすればいい？」「どうしたらいい？」\n- 「次は何をすればいい？」「次は？」\n- 「何ができる？」「何をすればいい？」\n- 「困った」「わからない」「助けて」\n- 「使い方を教えて」\n- \"what should I do?\", \"what's next?\", \"help\"\n\n---\n\n## 概要\n\nVibeCoder は技術的なコマンドやワークフローを知らなくても、\n自然な日本語で質問するだけで次のアクションが分かります。\n\n---\n\n## 応答パターン\n\n### パターン1: プロジェクトがない場合\n\n> **まずはプロジェクトを始めましょう！**\n>\n> **言い方の例：**\n> - 「ブログを作りたい」\n> - 「タスク管理アプリを作りたい」\n> - 「ポートフォリオサイトを作りたい」\n>\n> ざっくりで大丈夫です。やりたいことを教えてください。\n\n### パターン2: Plans.md があるが進行中タスクがない\n\n> **計画があります。作業を始めましょう！**\n>\n> **現在の計画:**\n> - フェーズ1: 基盤構築\n> - フェーズ2: コア機能\n> - ...\n>\n> **言い方の例：**\n> - 「フェーズ1を始めて」\n> - 「最初のタスクをやって」\n> - 「全部やって」\n\n### パターン3: タスク進行中\n\n> **作業中です**\n>\n> **現在のタスク:** {{タスク名}}\n> **進捗:** {{完了数}}/{{全体数}}\n>\n> **言い方の例：**\n> - 「続けて」\n> - 「次のタスク」\n> - 「今どこまで進んだ？」\n\n### パターン4: フェーズ完了後\n\n> **フェーズが完了しました！**\n>\n> **次にできること：**\n> - 「動作確認して」→ 開発サーバーを起動\n> - 「レビューして」→ コード品質チェック\n> - 「次のフェーズへ」→ 次の作業を開始\n> - 「コミットして」→ 変更を保存\n\n### パターン5: エラー発生時\n\n> **問題が発生しました**\n>\n> **状況:** {{エラーの要約}}\n>\n> **言い方の例：**\n> - 「直して」→ 自動修正を試行\n> - 「説明して」→ 問題の詳細を説明\n> - 「スキップして」→ 次のタスクへ\n\n---\n\n## よく使うフレーズ対応表\n\n| やりたいこと | 言い方 |\n|-------------|--------|\n| プロジェクト開始 | 「〇〇を作りたい」 |\n| 計画を見たい | 「計画を見せて」「今の状況は？」 |\n| 作業を開始 | 「始めて」「作って」「フェーズ1をやって」 |\n| 続きをやる | 「続けて」「次」 |\n| 動作確認 | 「動かして」「見せて」 |\n| コード確認 | 「レビューして」「チェックして」 |\n| 保存する | 「コミットして」「保存して」 |\n| 困った時 | 「どうすればいい？」「助けて」 |\n| 全部任せる | 「全部やって」「おまかせ」 |\n\n---\n\n## コンテキスト判定\n\nこのスキルは以下を確認して適切な応答を選択：\n\n1. **AGENTS.md の存在** → プロジェクトが初期化済みか\n2. **Plans.md の内容** → 計画があるか、進捗状況\n3. **現在のタスク状態** → `cc:WIP` マーカーの有無\n4. **直近のエラー** → 問題が発生しているか\n\n---\n\n## 実装ノート\n\nこのスキルが起動したら：\n\n1. 現在の状態を分析\n2. 適切なパターンを選択\n3. 具体的な「言い方の例」を提示\n4. ユーザーの次のアクションを待つ\n\n**重要**: 技術用語を避け、平易な日本語で説明する\n",
        "skills/session-control/SKILL.md": "---\nname: session-control\ndescription: \"Controls session resume/fork for /work based on flags. Use only from workflow.\"\nallowed-tools: [\"Read\", \"Bash\", \"Write\", \"Edit\"]\n---\n\n# Session Control Skill\n\n/work の `--resume` / `--fork` フラグに応じてセッション状態を切り替える。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **セッション再開/分岐** | See [references/session-control.md](references/session-control.md) |\n\n## 実行手順\n\n1. workflow から渡された変数を確認\n2. `scripts/session-control.sh` を適切な引数で実行\n3. `session.json` と `session.events.jsonl` の更新を確認\n",
        "skills/session-control/references/session-control.md": "---\nname: session-control\ndescription: \"Apply /work --resume/--fork flags by updating session state files.\"\nallowed-tools: [\"Read\", \"Bash\", \"Write\", \"Edit\"]\n---\n\n# Session Control\n\n## 入力\n\nworkflow 変数:\n- `resume_session_id` (string)\n- `resume_latest` (boolean)\n- `fork_session_id` (string)\n- `fork_reason` (string)\n\n## 実行\n\n### 1) 引数の決定\n- resume:\n  - `resume_latest == true` → `--resume latest`\n  - それ以外で `resume_session_id` があれば `--resume <id>`\n- fork:\n  - `fork_session_id` があれば `--fork <id>`、なければ `--fork current`\n  - `fork_reason` があれば `--reason \"<text>\"`\n\n### 2) スクリプト実行\n```bash\n./scripts/session-control.sh --resume <id|latest>\n./scripts/session-control.sh --fork <id|current> --reason \"<text>\"\n```\n\n## 期待される結果\n- `.claude/state/session.json` が更新される\n- `.claude/state/session.events.jsonl` に `session.resume` または `session.fork` が追記される\n- エラー時は stderr に理由が出力される\n",
        "skills/session-init/SKILL.md": "---\nname: session-init\ndescription: \"Initializes session with environment checks and task status overview. Use when user mentions starting a session, beginning work, or status checks. Do NOT load for: implementation work, reviews, or mid-session tasks.\"\nallowed-tools: [\"Read\", \"Write\", \"Bash\"]\nuser-invocable: false\n---\n\n# Session Init Skill\n\nセッション開始時の環境確認と現在のタスク状況把握を行うスキル。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで起動します：\n\n- 「セッション開始」\n- 「作業開始」\n- 「今日の作業を始める」\n- 「状況を確認して」\n- 「何をすればいい？」\n- \"start session\"\n- \"what should I work on?\"\n\n---\n\n## 概要\n\nSession Init スキルは、Claude Code セッション開始時に自動的に以下を確認します：\n\n1. **Git 状態**: 現在のブランチ、未コミットの変更\n2. **Plans.md**: 進行中タスク、依頼されたタスク\n3. **AGENTS.md**: 役割分担、禁止事項の確認\n4. **前回セッション**: 引き継ぎ事項の確認\n\n---\n\n## 実行手順\n\n### Step 0: ファイル状態チェック（自動整理）\n\nセッション開始前にファイルサイズをチェック：\n\n```bash\n# Plans.md の行数チェック\nif [ -f \"Plans.md\" ]; then\n  lines=$(wc -l < Plans.md)\n  if [ \"$lines\" -gt 200 ]; then\n    echo \"⚠️ Plans.md が ${lines} 行です。「整理して」で整理を推奨\"\n  fi\nfi\n\n# session-log.md の行数チェック\nif [ -f \".claude/memory/session-log.md\" ]; then\n  lines=$(wc -l < .claude/memory/session-log.md)\n  if [ \"$lines\" -gt 500 ]; then\n    echo \"⚠️ session-log.md が ${lines} 行です。「セッションログを整理して」で整理を推奨\"\n  fi\nfi\n```\n\n整理が必要な場合は提案を表示（作業には影響しない）。\n\n### Step 0.5: Claude-mem 文脈確認（オプション）\n\nClaude-mem が有効な場合、過去の文脈を自動表示：\n\n```bash\n# Claude-mem の状態チェック\nif [ -f \"$HOME/.claude-mem/settings.json\" ]; then\n  mode=$(cat ~/.claude-mem/settings.json | grep -o '\"CLAUDE_MEM_MODE\"[^,}]*' | cut -d'\"' -f4)\n  if [ \"$mode\" = \"harness\" ] || [ \"$mode\" = \"harness--ja\" ]; then\n    echo \"📚 Claude-mem (harness モード) が有効です\"\n  fi\nfi\n```\n\n**Claude-mem 有効時に表示する内容**:\n\n1. **過去のガードレール発動**:\n   - `mem-search` で `guard` タイプの観測を検索\n   - 「このプロジェクトでは過去 N 回テスト改ざんを防止」\n\n2. **直近の作業サマリー**:\n   - 最新のセッションサマリーを表示\n   - 「前回: Feature X の設計完了」\n\n3. **継続タスクの提案**:\n   - Plans.md と組み合わせて次のアクションを提案\n\n```markdown\n## 📚 過去の文脈（Claude-mem）\n\n**ガードレール履歴**:\n- テスト改ざん防止: 2回\n\n**前回のセッション**:\n- Feature X 設計完了\n- RBAC 採用を決定\n\n**💡 継続推奨**: Plans.md の「Feature X 実装」から開始\n```\n\n> **注**: Claude-mem が未設定の場合、このステップはスキップされます。\n\n### Step 1: 環境確認\n\n以下を並列で実行：\n\n```bash\n# Git状態\ngit status -sb\ngit log --oneline -3\n```\n\n```bash\n# Plans.md\ncat Plans.md 2>/dev/null || echo \"Plans.md not found\"\n```\n\n```bash\n# AGENTS.md の要点\nhead -50 AGENTS.md 2>/dev/null || echo \"AGENTS.md not found\"\n```\n\n### Step 2: タスク状況の把握\n\nPlans.md から以下を抽出：\n\n- `cc:WIP` - 前回から継続中のタスク\n- `pm:依頼中` - PM から新規依頼されたタスク（互換: cursor:依頼中）\n- `cc:TODO` - 未着手だが割り当て済みのタスク\n\n### Step 3: 状況レポートの出力\n\n```markdown\n## 🚀 セッション開始\n\n**日時**: {{YYYY-MM-DD HH:MM}}\n**ブランチ**: {{branch}}\n**セッションID**: ${CLAUDE_SESSION_ID}\n\n---\n\n### 📋 今日のタスク\n\n**優先タスク**:\n- {{pm:依頼中（互換: cursor:依頼中） または cc:WIP のタスク}}\n\n**その他のタスク**:\n- {{cc:TODO のタスク一覧}}\n\n---\n\n### ⚠️ 注意事項\n\n{{AGENTS.md からの重要な制約・禁止事項}}\n\n---\n\n**作業を開始しますか？**\n```\n\n---\n\n## 出力フォーマット\n\nセッション開始時は、以下の情報を簡潔に提示：\n\n| 項目 | 内容 |\n|------|------|\n| 現在のブランチ | `staging` など |\n| 優先タスク | 最も重要な 1-2 件 |\n| 注意事項 | 禁止事項の要約 |\n| 次のアクション | 具体的な提案 |\n\n---\n\n## 関連コマンド\n\n- `/work` - タスク実行（並列実行対応）\n- `/sync-status` - Plans.md の進捗サマリー\n- `/cleanup` - ファイルの自動整理\n\n---\n\n## 注意事項\n\n- **AGENTS.md を必ず確認**: 役割分担を把握してから作業開始\n- **Plans.md が無い場合**: `/harness-init` を案内\n- **前回の作業が中断している場合**: 継続するか確認\n",
        "skills/session-memory/SKILL.md": "---\nname: session-memory\ndescription: \"Manages cross-session learning and memory persistence. Use when user asks about previous sessions, history, or to continue from before. Do NOT load for: implementation work, reviews, or ad-hoc information.\"\nallowed-tools: [\"Read\", \"Write\", \"Append\"]\nuser-invocable: false\n---\n\n# Session Memory Skill\n\nセッション間の学習と記憶を管理するスキル。\n過去の作業内容、決定事項、学んだパターンを記録・参照します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「前回何をした？」「前回の続きから」\n- 「履歴を見せて」「過去の作業」\n- 「このプロジェクトについて教えて」\n- \"what did we do last time?\", \"continue from before\"\n\n---\n\n## 概要\n\nこのスキルは `.claude/memory/` に作業履歴を保存し、\nセッション間での知識の継続を実現します。\n\nあわせて、重要な情報は「どこに残すべきか」を明確にします（詳細: `docs/MEMORY_POLICY.md`）。\n\n---\n\n## メモリ構造\n\n```\n.claude/\n└── memory/\n    ├── session-log.md      # セッションごとのログ\n    ├── decisions.md        # 重要な決定事項\n    ├── patterns.md         # 学んだパターン\n    └── context.json        # プロジェクトコンテキスト\n```\n\n### 推奨運用（SSOT/ローカル分離）\n\n- **SSOT（共有推奨）**: `decisions.md` / `patterns.md`  \n  - 「決定（Why）」と「再利用できる解法（How）」を集約する\n  - 各エントリは **タイトル + タグ**（例: `#decision #db`）を付け、先頭に **Index** を置く\n- **ローカル推奨**: `session-log.md` / `context.json` / `.claude/state/`  \n  - ノイズ/肥大化しやすいため、基本は Git 管理しない（必要なら個別に判断）\n\n---\n\n## 自動記録される情報\n\n### session-log.md\n\n各セッション記録には `${CLAUDE_SESSION_ID}` 環境変数を活用してセッションIDを付与します。\nこれにより、セッション間のトレーサビリティが向上します。\n\n```markdown\n## セッション: 2024-01-15 14:30 (session: abc123def)\n\n### 実行したタスク\n- [x] ユーザー認証機能の実装\n- [x] ログインページの作成\n\n### 生成したファイル\n- src/lib/auth.ts\n- src/app/login/page.tsx\n\n### 重要な決定\n- 認証方式: Supabase Auth を採用\n\n### 次回への引き継ぎ\n- ログアウト機能が未実装\n- パスワードリセットも必要\n```\n\n> **Note**: `${CLAUDE_SESSION_ID}` は Claude Code が自動設定する環境変数です。\n> セッションごとに一意のIDが割り当てられ、ログの追跡や問題調査に役立ちます。\n\n### decisions.md\n\n```markdown\n## 技術選定\n\n| 日付 | 決定事項 | 理由 |\n|------|---------|------|\n| 2024-01-15 | Supabase Auth | 無料枠あり、セットアップ簡単 |\n| 2024-01-14 | Next.js App Router | 最新のベストプラクティス |\n\n## アーキテクチャ\n\n- コンポーネント: `src/components/`\n- ユーティリティ: `src/lib/`\n- 型定義: `src/types/`\n```\n\n### patterns.md\n\n```markdown\n## このプロジェクトのパターン\n\n### コンポーネント命名\n- PascalCase\n- 例: `UserProfile.tsx`, `LoginForm.tsx`\n\n### API エンドポイント\n- `/api/v1/` プレフィックス\n- RESTful 設計\n\n### エラーハンドリング\n- try-catch で囲む\n- エラーメッセージは日本語\n```\n\n### context.json\n\n```json\n{\n  \"project_name\": \"my-blog\",\n  \"created_at\": \"2024-01-14\",\n  \"stack\": {\n    \"frontend\": \"next.js\",\n    \"backend\": \"next-api\",\n    \"database\": \"supabase\",\n    \"styling\": \"tailwind\"\n  },\n  \"current_phase\": \"フェーズ2: コア機能\",\n  \"last_session\": \"2024-01-15T14:30:00Z\"\n}\n```\n\n---\n\n## 処理フロー\n\n### セッション開始時\n\n1. `.claude/memory/context.json` を読み込み\n2. 前回のセッションログを確認\n3. 未完了タスクを特定\n4. コンテキストサマリーを生成\n\n### セッション中\n\n1. 重要な決定を `decisions.md` に記録\n2. 新しいパターンを `patterns.md` に追加\n3. ファイル生成を `session-log.md` に記録\n\n### セッション終了時\n\n1. セッションサマリーを生成\n2. `context.json` を更新\n3. 次回への引き継ぎ事項を記録\n\n---\n\n## 使用例\n\n### 前回の続きから開始\n\n```\nユーザー: 「前回の続きから」\n\nClaude Code:\n📋 前回のセッション（2024-01-15）\n\n完了したタスク:\n- ユーザー認証機能\n- ログインページ\n\n未完了:\n- ログアウト機能\n- パスワードリセット\n\n「ログアウト機能を作って」と言えば続きを実装します。\n```\n\n### プロジェクトの状況確認\n\n```\nユーザー: 「このプロジェクトについて教えて」\n\nClaude Code:\n📁 プロジェクト: my-blog\n\n技術スタック:\n- Next.js + Tailwind CSS + Supabase\n\n現在のフェーズ: コア機能開発\n進捗: 40% 完了\n\n最近の決定:\n- Supabase Auth を採用\n- App Router を使用\n```\n\n---\n\n## 注意事項\n\n- **自動保存**: `hooks/Stop` により、セッション終了時に `session-log.md` へ要約を自動追記する運用を推奨（未導入の場合は手動運用でOK）\n- **プライバシー**: 機密情報は記録しない\n- **Git方針**: `decisions.md`/`patterns.md`は共有推奨、`session-log.md`/`context.json`/`.claude/state/`はローカル推奨（詳細: `docs/MEMORY_POLICY.md`）\n- **容量管理**: ログが大きくなったら「セッションログを整理して」を推奨\n",
        "skills/session-state/SKILL.md": "---\nname: session-state\nversion: 1.0.0\ndescription: \"Manages session state transitions per SESSION_ORCHESTRATION.md. Internal use only.\"\nallowed-tools: [Read, Bash]\ndependencies: []\n---\n\n# Session State Skill\n\nセッション状態の遷移を管理する内部スキル。\n`docs/SESSION_ORCHESTRATION.md` に定義された状態機械に従って遷移を検証・実行する。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **状態遷移** | See [references/state-transition.md](references/state-transition.md) |\n\n## 使用タイミング\n\n- `/work` フェーズ境界での状態更新\n- エラー発生時の `escalated` 遷移\n- セッション終了時の `stopped` 遷移\n- セッション再開時の `initialized` 復帰\n\n## 注意事項\n\n- このスキルは内部使用専用です\n- ユーザーが直接呼び出すことは想定していません\n- 状態遷移ルールは `docs/SESSION_ORCHESTRATION.md` で定義\n",
        "skills/session-state/references/state-transition.md": "---\nname: state-transition\ndescription: \"Execute session state transitions using session-state.sh\"\nallowed-tools: [Read, Bash]\n---\n\n# State Transition\n\nセッション状態の遷移を実行する。\n\n## 入力\n\nworkflow 変数:\n- `target_state` (string): 遷移先の状態\n- `event_name` (string): トリガーイベント\n- `event_data` (string, optional): イベント付加データ (JSON)\n\n## 有効な状態\n\n| 状態 | 説明 |\n|------|------|\n| `idle` | セッション未開始 |\n| `initialized` | SessionStart 完了 |\n| `planning` | Plan/Work の準備 |\n| `executing` | /work 実行中 |\n| `reviewing` | review 実行中 |\n| `verifying` | build/test 実行中 |\n| `escalated` | 人間確認待ち |\n| `completed` | 成果物確定 |\n| `failed` | 回復不能 |\n| `stopped` | Stop hook 到達 |\n\n## 代表的な遷移\n\n| From | Event | To |\n|------|-------|----|\n| idle | session.start | initialized |\n| initialized | plan.ready | planning |\n| planning | work.start | executing |\n| executing | work.task_complete | reviewing |\n| reviewing | verify.start | verifying |\n| verifying | verify.passed | completed |\n| verifying | verify.failed | escalated |\n| * | session.stop | stopped |\n| stopped | session.resume | initialized |\n\n## 実行\n\n```bash\n./scripts/session-state.sh --state <state> --event <event> [--data <json>]\n```\n\n### 例: 実行状態への遷移\n\n```bash\n./scripts/session-state.sh --state executing --event work.start\n```\n\n### 例: エスカレーション（データ付き）\n\n```bash\n./scripts/session-state.sh --state escalated --event escalation.requested \\\n  --data '{\"reason\":\"Build failed 3 times\",\"retry_count\":3}'\n```\n\n## 期待される結果\n\n- `.claude/state/session.json` の `state`, `updated_at`, `last_event_id`, `event_seq` が更新される\n- `.claude/state/session.events.jsonl` にイベントが追記される\n- 不正な遷移は stderr にエラー出力 + 非ゼロ終了\n\n## エラーハンドリング\n\n遷移が失敗した場合（不正な遷移など）:\n1. 現在の状態と許可された遷移を stderr に出力\n2. 非ゼロ終了コードを返す\n3. 呼び出し元（workflow）でエスカレーション処理を行う\n",
        "skills/session/SKILL.md": "---\nname: session\ndescription: \"Unified session management - initialization, memory persistence, state control, and cross-session communication. Use when managing Claude Code sessions.\"\nallowed-tools: [\"Read\", \"Bash\", \"Write\", \"Edit\", \"Glob\"]\n---\n\n# Session Skill (Unified)\n\nConsolidates all session-related functionality into one skill.\n\n## Capabilities\n\n| Feature | Description | Reference |\n|---------|-------------|-----------|\n| **Initialization** | Start new session, load context | See [../session-init/SKILL.md](../session-init/SKILL.md) |\n| **Memory** | Persist learnings across sessions | See [../session-memory/SKILL.md](../session-memory/SKILL.md) |\n| **State Control** | Resume/fork session based on flags | See [references/session-control.md](references/session-control.md) |\n| **Communication** | Cross-session messaging | See [../session-state/SKILL.md](../session-state/SKILL.md) |\n\n## When to Use\n\n- Session initialization (`/harness-init`)\n- Session resume/fork (`/work --resume`, `/work --fork`)\n- Memory persistence (automatic)\n- Cross-session communication (`/session broadcast`)\n\n## Execution Flow\n\n### 1. Session Initialization\n\n```\n/harness-init\n    ↓\n├── Load project context\n├── Initialize session.json\n├── Load previous session memory (if exists)\n└── Display session status\n```\n\n### 2. Session Control (from /work)\n\n```\n/work --resume\n    ↓\n├── Check session.json exists\n├── Load session state\n└── Continue from last checkpoint\n\n/work --fork\n    ↓\n├── Create new session branch\n├── Copy relevant context\n└── Start fresh with context\n```\n\n### 3. Memory Persistence\n\n```\nSession end\n    ↓\n├── Extract learnings (gotchas, patterns)\n├── Update .claude/memory/*.md\n└── Prepare handoff summary\n```\n\n### 4. Cross-Session Communication\n\n```\n/session broadcast \"message\"\n    ↓\n├── Find active sessions\n├── Write to session.events.jsonl\n└── Notify all sessions\n```\n\n## Files Managed\n\n| File | Purpose |\n|------|---------|\n| `.claude/state/session.json` | Current session state |\n| `.claude/state/session.events.jsonl` | Event log for cross-session communication |\n| `.claude/memory/*.md` | Persistent memory files |\n\n## Migration Note\n\nThis skill consolidates:\n- `session-init` → Session initialization\n- `session-memory` → Memory persistence\n- `session-control` → Resume/fork control\n- `session-state` → State management & communication\n\nThe individual skills are deprecated but still work for backward compatibility.\n",
        "skills/session/references/session-control.md": "---\nname: session-control\ndescription: \"Apply /work --resume/--fork flags by updating session state files.\"\nallowed-tools: [\"Read\", \"Bash\", \"Write\", \"Edit\"]\n---\n\n# Session Control\n\n## 入力\n\nworkflow 変数:\n- `resume_session_id` (string)\n- `resume_latest` (boolean)\n- `fork_session_id` (string)\n- `fork_reason` (string)\n\n## 実行\n\n### 1) 引数の決定\n- resume:\n  - `resume_latest == true` → `--resume latest`\n  - それ以外で `resume_session_id` があれば `--resume <id>`\n- fork:\n  - `fork_session_id` があれば `--fork <id>`、なければ `--fork current`\n  - `fork_reason` があれば `--reason \"<text>\"`\n\n### 2) スクリプト実行\n```bash\n./scripts/session-control.sh --resume <id|latest>\n./scripts/session-control.sh --fork <id|current> --reason \"<text>\"\n```\n\n## 期待される結果\n- `.claude/state/session.json` が更新される\n- `.claude/state/session.events.jsonl` に `session.resume` または `session.fork` が追記される\n- エラー時は stderr に理由が出力される\n",
        "skills/session/references/state-transition.md": "---\nname: state-transition\ndescription: \"Execute session state transitions using session-state.sh\"\nallowed-tools: [Read, Bash]\n---\n\n# State Transition\n\nセッション状態の遷移を実行する。\n\n## 入力\n\nworkflow 変数:\n- `target_state` (string): 遷移先の状態\n- `event_name` (string): トリガーイベント\n- `event_data` (string, optional): イベント付加データ (JSON)\n\n## 有効な状態\n\n| 状態 | 説明 |\n|------|------|\n| `idle` | セッション未開始 |\n| `initialized` | SessionStart 完了 |\n| `planning` | Plan/Work の準備 |\n| `executing` | /work 実行中 |\n| `reviewing` | review 実行中 |\n| `verifying` | build/test 実行中 |\n| `escalated` | 人間確認待ち |\n| `completed` | 成果物確定 |\n| `failed` | 回復不能 |\n| `stopped` | Stop hook 到達 |\n\n## 代表的な遷移\n\n| From | Event | To |\n|------|-------|----|\n| idle | session.start | initialized |\n| initialized | plan.ready | planning |\n| planning | work.start | executing |\n| executing | work.task_complete | reviewing |\n| reviewing | verify.start | verifying |\n| verifying | verify.passed | completed |\n| verifying | verify.failed | escalated |\n| * | session.stop | stopped |\n| stopped | session.resume | initialized |\n\n## 実行\n\n```bash\n./scripts/session-state.sh --state <state> --event <event> [--data <json>]\n```\n\n### 例: 実行状態への遷移\n\n```bash\n./scripts/session-state.sh --state executing --event work.start\n```\n\n### 例: エスカレーション（データ付き）\n\n```bash\n./scripts/session-state.sh --state escalated --event escalation.requested \\\n  --data '{\"reason\":\"Build failed 3 times\",\"retry_count\":3}'\n```\n\n## 期待される結果\n\n- `.claude/state/session.json` の `state`, `updated_at`, `last_event_id`, `event_seq` が更新される\n- `.claude/state/session.events.jsonl` にイベントが追記される\n- 不正な遷移は stderr にエラー出力 + 非ゼロ終了\n\n## エラーハンドリング\n\n遷移が失敗した場合（不正な遷移など）:\n1. 現在の状態と許可された遷移を stderr に出力\n2. 非ゼロ終了コードを返す\n3. 呼び出し元（workflow）でエスカレーション処理を行う\n",
        "skills/setup/SKILL.md": "---\nname: setup\ndescription: \"Sets up new projects and generates workflow files like CLAUDE.md, AGENTS.md, Plans.md. Use when user mentions setup, initialization, new projects, or workflow file generation. Do NOT load for: implementation work, reviews, build verification, or deployments.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Grep\", \"Glob\", \"Bash\"]\nuser-invocable: false\n---\n\n# Setup Skills\n\nプロジェクトセットアップとワークフローファイル生成を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **適応的セットアップ** | See [references/adaptive-setup.md](references/adaptive-setup.md) |\n| **スキャフォールディング** | See [references/project-scaffolding.md](references/project-scaffolding.md) |\n| **ワークフローファイル** | See [references/workflow-files.md](references/workflow-files.md) |\n| **設定ファイル** | See [references/claude-settings.md](references/claude-settings.md) |\n| **プロジェクト種別確認** | See [references/project-type-detection.md](references/project-type-detection.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従ってセットアップ\n",
        "skills/setup/references/adaptive-setup.md": "---\nname: adaptive-setup\ndescription: \"プロジェクト分析に基づいた適応型セットアップを実行するスキル。プロジェクトの状況に応じて適切なセットアップを自動選択する場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Bash\"]\n---\n\n# Adaptive Setup Skill\n\nプロジェクトの状態を分析し、適応的にルールとコマンドを配置するスキル。\n\n---\n\n## 概要\n\n従来の「テンプレートコピー」から「3フェーズ適応型セットアップ」に進化。\n\n```\nPhase 1: プロジェクト分析\n    ↓\nPhase 2: ルールカスタマイズ\n    ↓\nPhase 3: インタラクティブ確認\n    ↓\n配置完了\n```\n\n---\n\n## Phase 1: プロジェクト分析\n\n```bash\nPLUGIN_PATH=\"${CLAUDE_PLUGIN_ROOT:-$HOME/.claude/plugins/claude-code-harness}\"\nANALYSIS=$(\"$PLUGIN_PATH/scripts/analyze-project.sh\")\n```\n\n収集する情報：\n- 技術スタック (Node.js, Python, Rust, etc.)\n- フレームワーク (React, Next.js, Django, etc.)\n- テストフレームワーク (Jest, Pytest, etc.)\n- 既存の Linter/Formatter 設定\n- 既存の Claude/Cursor 設定\n- Git 情報 (Conventional Commits 等)\n- 重要視されている事項\n\n---\n\n## Phase 2: ルールカスタマイズ\n\n分析結果に基づいて：\n\n1. **基本ルール選択**: workflow, plans-management, coding-standards, testing\n2. **技術スタック別追加**: React/Next.js, Python, Rust 等のルール\n3. **既存規約反映**: ESLint, Prettier 設定をルールに組み込み\n4. **重要事項のルール化**: テスト必須、アクセシビリティ、セキュリティ等\n\n---\n\n## Phase 3: 確認と配置\n\nユーザーに分析結果と生成ルールを表示し、確認後に配置。\n\n既存設定がある場合はマージ（上書きではない）。\n\n---\n\n## 関連ファイル\n\n- `scripts/analyze-project.sh`\n- `templates/rules/`\n- `commands/setup-cursor.md`\n",
        "skills/setup/references/claude-settings.md": "---\nname: generate-claude-settings\ndescription: \"Claude Code の `.claude/settings.json` を安全ポリシー込みで作成/更新する（既存設定は非破壊マージ）。/harness-init や /setup-cursor から呼び出して、権限ガードをチーム運用できる形に整備する。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Generate Claude Settings (Security + Merge)\n\n## 目的\n\nプロジェクトの `.claude/settings.json` を作成または更新し、以下を満たす状態にします。\n\n- **既存設定は保持**（`hooks` / `env` / `model` / `enabledPlugins` 等を消さない）\n- `permissions.allow|ask|deny` は **配列マージ + 重複排除**\n- **bypassPermissions を前提とした運用**（危険操作のみ deny/ask で制御）\n- 既存ファイルが壊れている場合は **バックアップを残して再生成**\n\n## ⚠️ 重要: パーミッション構文の厳守\n\n**このスキルを実行する際は、必ず正しいパーミッション構文を使用すること。**\n\nプレフィックスマッチングには `:*` を使用（`*` 単独や ` *` は不可）：\n\n- ✅ 正しい: `\"Bash(npm run:*)\"`, `\"Bash(git status:*)\"`\n- ❌ 間違い: `\"Bash(npm run *)\"`, `\"Bash(git status*)\"`, `\"Bash(npm run :*)\"`\n\n詳細は [Step 4](#step-4-新規生成既存なし退避後) の「パーミッション構文の注意点」を参照。\n\n## bypassPermissions 前提の運用ポリシー\n\n**重要**: Edit / Write を `permissions.ask` に入れると毎回確認が出て生産性が落ちます。\n代わりに、bypassPermissions を有効にして危険操作のみを制御する方針を推奨します。\n\n- `permissions.deny`: 機密ファイル読み取り（.env, secrets, SSH鍵）、危険なDB操作\n- `permissions.ask`: ファイル削除、git push/reset/rebase/merge\n- `permissions.allow`: MCP サーバーのワイルドカード許可（下記参照）\n- **Edit / Write は ask に入れない**（確認が毎回出るのを避ける）\n\n### MCP サーバーのワイルドカード許可\n\nMCP サーバーのツールを一括許可するには `mcp__<server>__*` パターンを使用します。\n\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"mcp__supabase__*\",\n      \"mcp__context7__*\",\n      \"mcp__serena__*\"\n    ]\n  }\n}\n```\n\n| パターン | 許可される操作 |\n|---------|---------------|\n| `mcp__supabase__*` | Supabase MCP の全ツール（query, apply_migration 等） |\n| `mcp__context7__*` | Context7 ドキュメント検索ツール |\n| `mcp__serena__*` | Serena LSP 連携ツール |\n| `mcp__playwright__*` | Playwright ブラウザ操作ツール |\n\n### LSP 機能の活用\n\nClaude Code の LSP 機能を活用するには、**公式LSPプラグイン（マーケットプレイス）** をインストールします。\n\n```bash\n# 例: TypeScript/JavaScript 用\nclaude plugin install typescript-lsp\n\n# 例: Python 用\nclaude plugin install pyright-lsp\n\n# 例: Rust 用\nclaude plugin install rust-analyzer-lsp\n```\n\n**LSP で利用可能な機能:**\n- 定義ジャンプ (go-to-definition)\n- 参照検索 (find-references)\n- シンボルリネーム (rename)\n- 診断情報 (diagnostics)\n\n詳細: [docs/LSP_INTEGRATION.md](../../../docs/LSP_INTEGRATION.md) または `/lsp-setup` コマンドを実行してください。\n\n**注意**: プロジェクトで使用する MCP サーバーに合わせて設定してください。\n\n初回 init 後は、以下どちらかで bypassPermissions を有効化する導線を案内します：\n\n- **推奨（プロジェクト限定・未コミット）**: `.claude/settings.local.json` に `permissions.defaultMode: \"bypassPermissions\"` を設定\n- **一時的（セッション限定）**: `claude --dangerously-skip-permissions`\n\n根拠（公式）: `settings.json` と `permissions`（ask/deny/disableBypassPermissionsMode）\nhttps://code.claude.com/docs/ja/settings\n\n---\n\n## 対象ファイル\n\n- 生成/更新先: `.claude/settings.json`\n- ポリシーテンプレ: `templates/claude/settings.security.json.template`\n\n---\n\n## 実行手順（安全・非破壊）\n\n### Step 0: 前提チェック\n\n以下を確認します。\n\n- `templates/claude/settings.security.json.template` が存在する\n- `.claude/` がなければ作成（ディレクトリのみ）\n\n### Step 1: 既存設定の有無を確認\n\n- `.claude/settings.json` が **ない** → Step 4 でテンプレから生成\n- `.claude/settings.json` が **ある** → Step 2 でパースできるか確認\n\n### Step 2: JSONパース可否の判定\n\n優先順で判定します。\n\n1. `jq` がある場合: `jq empty .claude/settings.json`\n2. `python3` がある場合: `python3 -m json.tool .claude/settings.json`\n\nパースに失敗したら:\n\n- `.claude/settings.json.bak`（またはタイムスタンプ付き）に退避\n- Step 4 でテンプレから再生成\n\n### Step 3: 既存設定とポリシーをマージ\n\n**重要**: `/harness-update` から呼び出される場合、Phase 1.5 で破壊的変更（パーミッション構文修正、非推奨設定削除）が既に適用されています。\n\n#### マージ方針\n\n- **top-level**: 既存を優先しつつ、ポリシー側の `permissions` を統合\n- `permissions.allow|ask|deny`: **ユニーク化して結合**（既存→ポリシーの順）\n- `permissions.disableBypassPermissionsMode`: **設定しない**（bypassPermissions を許可）\n  - **注意**: 既存設定にこのフィールドがある場合、削除すること（`/harness-update` では Phase 1.5 で削除済み）\n\n#### 実装（推奨コマンド）\n\n`jq` がある場合:\n\n1. 既存とポリシーを読み込み\n2. `allow/ask/deny` を配列として結合 → `unique`（順序は多少変わってOK）\n3. `.claude/settings.json.tmp` に書き出し → 置換\n\n`jq` がない場合（python3）:\n\n1. `json.load` で既存/ポリシーを読み込み\n2. `permissions` を辞書としてマージ\n3. `allow/ask/deny` は list を `dict.fromkeys` 等で重複排除（順序維持）\n4. `indent=2, sort_keys=false` で出力\n\n**注意**: 既存の `hooks` は消さないこと。`permissions` 以外は原則、既存を尊重する。\n\n### Step 4: 新規生成（既存なし・退避後）\n\n- `templates/claude/settings.security.json.template` を `.claude/settings.json` にコピーして作成\n- 必要なら、将来の拡張（hooks追加等）は「既存マージ」ルート（Step 3）で行う\n\n**⚠️ 重要: パーミッション構文の注意点**\n\nプレフィックスマッチングには必ず `:*` を使用すること（`*` 単独は不可）：\n\n**正しい構文:**\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Bash(npm run:*)\",\n      \"Bash(pnpm:*)\",\n      \"Bash(git status:*)\",\n      \"Bash(git diff:*)\",\n      \"Bash(git log:*)\",\n      \"Bash(git branch:*)\",\n      \"Bash(ls:*)\",\n      \"Bash(cat:*)\"\n    ],\n    \"ask\": [\n      \"Bash(git add:*)\",\n      \"Bash(git commit:*)\",\n      \"Bash(git push:*)\",\n      \"Bash(git checkout:*)\",\n      \"Bash(rm:*)\",\n      \"Bash(mv:*)\"\n    ],\n    \"deny\": [\n      \"Bash(git push --force:*)\",\n      \"Bash(git reset --hard:*)\",\n      \"Bash(:*credentials:*)\",\n      \"Bash(:*password:*)\",\n      \"Bash(:*secret:*)\"\n    ]\n  }\n}\n```\n\n> **Note (v2.1.21+)**: Claude Code v2.1.21 以降、Claude は `cat` / `sed` / `awk` より Read / Edit / Write ツールを優先します。そのため `Bash(cat:*)` の発火頻度は低下しますが、フォールバック用に維持してください。\n\n**間違った構文（絶対に使用しないこと）:**\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Bash(npm run *)\",        // ❌ 間違い\n      \"Bash(pnpm *)\",           // ❌ 間違い\n      \"Bash(git diff*)\",        // ❌ 間違い\n      \"Bash(*credentials*)\"     // ❌ 間違い\n    ]\n  }\n}\n```\n\n**構文ルール:**\n- プレフィックスマッチ: `Bash(command:*)` - コマンド以降の全てにマッチ\n- 部分文字列マッチ: `Bash(:*substring:*)` - 任意の位置の文字列にマッチ\n- スペースは含まない: `Bash(npm run:*)` は正しい、`Bash(npm run :*)` は間違い\n\n---\n\n## 期待する出力\n\n- `.claude/settings.json` が存在し、JSONとしてパース可能\n- `permissions.deny` に `.env` / `secrets` / SSH鍵系の `Read(...)` が含まれる\n- `permissions.ask` に `Bash(rm:*)` / `Bash(git push:*)` 等が含まれる（**Edit / Write は含まない**）\n- `permissions.disableBypassPermissionsMode` が **設定されていない**（bypassPermissions 許可）\n\n---\n\n## 失敗時の扱い\n\n- パース不可の場合でも **必ずバックアップ**を残す\n- 生成後に `jq empty` または `python -m json.tool` で妥当性を確認\n\n---\n\n## bypassPermissions 有効化の導線\n\n### Step 5: ユーザーへの案内（生成後に表示）\n\n設定ファイル生成後、以下のメッセージを表示してユーザーに案内します:\n\n```\n✅ .claude/settings.json を生成しました\n\n📌 推奨（プロジェクト限定・未コミット）: `.claude/settings.local.json` で bypassPermissions を既定化できます。\n   cp templates/claude/settings.local.json.template .claude/settings.local.json\n\n一時的に試すだけなら:\n   claude --dangerously-skip-permissions\n\n⚠️ 注意: deny/ask に設定した危険操作（rm、git push等）は引き続き制御されます。\n```\n\n### オプション: settings.local.json の配置\n\nClaude Code の設定優先順位は `.claude/settings.local.json`（ローカル）→ `.claude/settings.json`（共有）→ `~/.claude/settings.json`（ユーザー）です。\nよって、bypassPermissions を「このプロジェクトだけ」有効にしたい場合は `.claude/settings.local.json` を推奨します。\n\n```bash\n# テンプレートをコピー\ncp templates/claude/settings.local.json.template .claude/settings.local.json\n\n# 必要に応じてカスタマイズ\n# settings.local.json は settings.json より優先されます\n```\n",
        "skills/setup/references/project-scaffolding.md": "---\nname: project-scaffolder\ndescription: \"プロジェクトの初期構造を生成するスキル。新規プロジェクトの初期構造を生成する場合に使用します。\"\nallowed-tools: [\"Write\", \"Bash\"]\n---\n\n# Project Scaffolder\n\nプロジェクトの初期構造（ディレクトリ、設定ファイル、基本ファイル）を生成するスキル。\n\n---\n\n## 目的\n\nヒアリング結果と技術スタック提案に基づいて、プロジェクトの基本構造を自動生成する。\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `project_type` | プロジェクトの種類（web, api, fullstack, etc.） |\n| `tech_stack` | 選択された技術スタック |\n| `project_name` | プロジェクト名 |\n| `requirements` | ヒアリングで得られた要件 |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `created_files` | 生成されたファイルのリスト |\n| `project_structure` | ディレクトリ構造の概要 |\n\n---\n\n## 生成するファイル\n\n### 共通\n\n- `package.json` または `pyproject.toml`（言語に応じて）\n- `.gitignore`\n- `README.md`\n\n### Web フロントエンド\n\n```\nsrc/\n├── components/\n├── pages/ または app/\n├── styles/\n└── lib/\n```\n\n### API バックエンド\n\n```\napp/\n├── api/\n├── models/\n├── services/\n└── utils/\n```\n\n---\n\n## 実行手順\n\n1. **技術スタックに基づくテンプレート選択**\n   - Next.js, React, Vue, Svelte などフレームワーク判定\n   - Python, Node.js, Go など言語判定\n\n2. **ディレクトリ構造の生成**\n   - 必要なディレクトリを作成\n   - プレースホルダーファイルを配置\n\n3. **設定ファイルの生成**\n   - package.json / pyproject.toml\n   - tsconfig.json / eslint.config.js など\n   - .env.example\n\n4. **初期ファイルの生成**\n   - エントリーポイント（index.ts, main.py など）\n   - 基本コンポーネント\n\n---\n\n## 注意事項\n\n- 既存ファイルがある場合は上書きしない（確認を求める）\n- 生成後は `npm install` や `pip install` を自動実行しない（ユーザー確認後）\n- 生成されたファイルの一覧をユーザーに提示する\n",
        "skills/setup/references/project-type-detection.md": "---\nname: ask-project-type\ndescription: \"曖昧なプロジェクト状態（ambiguous）のときにユーザーへ新規/既存を質問し、project_type を確定するスキル\"\nallowed-tools: [\"Read\", \"AskUserQuestion\"]\n---\n\n# Ask Project Type Skill\n\n`project_type == 'ambiguous'` のときに呼び出され、ユーザーに「新規/既存」を質問して `project_type` を `new` または `existing` に確定します。\n\n---\n\n## 入力\n\nworkflow から渡される変数:\n\n| 変数 | 型 | 説明 |\n|------|-----|------|\n| `ambiguity_reason` | string | 曖昧判定の理由（`template_only`, `few_files`, `readme_only`, `scaffold_only`） |\n| `code_file_count` | number | 検出されたコードファイル数 |\n| `tech_stack` | object | 検出された技術スタック |\n\n---\n\n## 出力\n\n| 変数 | 型 | 説明 |\n|------|-----|------|\n| `project_type` | `\"new\"` \\| `\"existing\"` | ユーザー選択で確定したプロジェクトタイプ |\n\n---\n\n## 実行手順\n\n### Step 1: 理由の日本語変換\n\n```javascript\nconst REASON_MAP = {\n  \"template_only\": \"テンプレート直後の状態（package.json はあるがコードファイルがない）\",\n  \"few_files\": \"コードファイルが少量（1〜9ファイル）で判断困難\",\n  \"readme_only\": \"README.md / LICENSE のみ（ドキュメントだけ）\",\n  \"scaffold_only\": \"設定ファイルのみ（tsconfig.json, .eslintrc など）\"\n};\n```\n\n### Step 2: AskUserQuestion で質問\n\n**AskUserQuestion ツールを使用**:\n\n```json\n{\n  \"questions\": [\n    {\n      \"question\": \"プロジェクトの状態を判断できませんでした。どちらとして扱いますか？\",\n      \"header\": \"プロジェクト種別\",\n      \"options\": [\n        {\n          \"label\": \"新規プロジェクト\",\n          \"description\": \"最初からセットアップ。Plans.md に基本タスクを追加\"\n        },\n        {\n          \"label\": \"既存プロジェクト\",\n          \"description\": \"既存コードを破壊しない。不足ファイルのみ追加\"\n        }\n      ],\n      \"multiSelect\": false\n    }\n  ]\n}\n```\n\n**質問の前にコンテキストを表示**:\n\n```\n🤔 プロジェクトの状態を判断できませんでした。\n\n**検出結果**:\n- コードファイル: {{code_file_count}} ファイル\n- 理由: {{ambiguity_reason の日本語説明}}\n- 検出技術: {{tech_stack.frameworks があれば表示}}\n```\n\n### Step 3: 回答の処理\n\n| ユーザー選択 | project_type |\n|-------------|--------------|\n| 「新規プロジェクト」 | `\"new\"` |\n| 「既存プロジェクト」 | `\"existing\"` |\n\n### Step 4: 結果を返す\n\n確定した `project_type` を workflow に返す。\n\n---\n\n## 使用例\n\n### 入力例\n\n```json\n{\n  \"ambiguity_reason\": \"template_only\",\n  \"code_file_count\": 2,\n  \"tech_stack\": {\n    \"languages\": [\"typescript\"],\n    \"frameworks\": [\"next.js\"],\n    \"package_manager\": \"npm\"\n  }\n}\n```\n\n### 出力例\n\n```json\n{\n  \"project_type\": \"new\"\n}\n```\n\n---\n\n## 注意事項\n\n- **必ずユーザー入力を待つ**: 自動判定せず、明示的な選択を求める\n- **デフォルト選択なし**: どちらかを選ばせる（誤判定防止）\n- **キャンセル不可**: このスキルが呼ばれた時点で判定が必要\n",
        "skills/setup/references/workflow-files.md": "---\nname: generate-workflow-files\ndescription: \"ワークフロー用ファイル（AGENTS.md, CLAUDE.md, Plans.md）を生成するスキル。新しいワークフローファイルを生成する必要がある場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\"]\n---\n\n# Generate Workflow Files\n\nclaude-code-harness のワークフローに必要なファイルを生成するスキル。\n\n---\n\n## 目的\n\n2エージェント協調ワークフローに必要な以下のファイルを生成：\n- `AGENTS.md` - エージェント間の共通ルール\n- `CLAUDE.md` - Claude Code 固有の設定\n- `Plans.md` - タスク管理ファイル\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `project_type` | プロジェクトの種類 |\n| `tech_stack` | 技術スタック |\n| `requirements` | 要件リスト |\n| `templates` | 使用するテンプレートファイル |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `generated_files` | 生成されたファイルのリスト |\n| `workflow_ready` | ワークフロー準備完了フラグ |\n\n---\n\n## 生成ファイル\n\n### AGENTS.md\n\n```markdown\n# AGENTS.md\n\n## 0. 開発フロー概要\n[プロジェクト固有のフローを記載]\n\n## 1. エージェントの役割\n- Cursor (PM): 計画、レビュー、承認\n- Claude Code (Worker): 実装、テスト\n\n## 2. 環境・前提条件\n[技術スタックに基づく環境情報]\n\n...\n```\n\n### CLAUDE.md\n\n```markdown\n# CLAUDE.md\n\n## Claude Code の責務範囲\n- 担当する作業\n- 禁止事項\n\n## コミットメッセージ規約\n- feat: / fix: / docs: / refactor: / test: / chore:\n\n...\n```\n\n### Plans.md\n\n```markdown\n# Plans.md\n\n## 現在のフェーズ\n[初期状態]\n\n## タスク一覧\n- [ ] cc:TODO - 初期セットアップ\n\n...\n```\n\n---\n\n## テンプレート変数\n\n| 変数 | 説明 |\n|------|------|\n| `{{project_name}}` | プロジェクト名 |\n| `{{tech_stack}}` | 技術スタック |\n| `{{date}}` | 生成日 |\n| `{{requirements}}` | 要件リスト |\n\n---\n\n## 実行手順\n\n1. **テンプレートファイルの読み込み**\n   - `templates/AGENTS.md.template`\n   - `templates/CLAUDE.md.template`\n   - `templates/Plans.md.template`\n\n2. **変数の置換**\n   - プロジェクト情報を反映\n\n3. **ファイルの生成**\n   - 既存ファイルがあれば確認を求める\n\n4. **完了報告**\n   - 生成されたファイル一覧を提示\n\n---\n\n## 注意事項\n\n- 既存の AGENTS.md / CLAUDE.md / Plans.md がある場合は上書き確認\n- 2エージェント設定でない場合は CLAUDE.md のみ生成することも可能\n",
        "skills/troubleshoot/SKILL.md": "---\nname: troubleshoot\ndescription: \"Guides diagnosis and resolution when problems occur. Use when user mentions something broken, errors, or that it doesn't work. Do NOT load for: successful builds, new feature implementation, or reviews.\"\nallowed-tools: [\"Read\", \"Grep\", \"Bash\"]\ncontext: fork\n---\n\n# Troubleshoot Skill\n\n問題発生時の診断と解決をガイドするスキル。\nVibeCoder が技術的な知識なしで問題を解決できるよう支援します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「動かない」「エラーが出た」「壊れた」\n- 「うまくいかない」「失敗した」\n- 「なぜ？」「原因は？」\n- \"it's broken\", \"doesn't work\", \"error\", \"why?\"\n\n---\n\n## 概要\n\n問題が発生したとき、VibeCoder は技術的な詳細を理解する必要はありません。\nこのスキルが自動的に診断し、解決策を提示します。\n\n---\n\n## 診断フロー\n\n### Step 1: 症状の確認\n\n> 🔍 **何が起きましたか？**\n>\n> 簡単に教えてください：\n> - 「画面が真っ白」\n> - 「ボタンが動かない」\n> - 「データが保存されない」\n\n### Step 2: 自動診断\n\n```bash\n# 環境チェック\nnode -v\nnpm -v\ngit status -sb\n\n# エラーログ確認\nnpm run build 2>&1 | tail -20\nnpm test 2>&1 | tail -20\n\n# 依存関係チェック\nnpm ls --depth=0\n```\n\n### Step 3: 問題カテゴリの特定\n\n| カテゴリ | 症状 | 自動対応 |\n|---------|------|----------|\n| 依存関係 | `Cannot find module` | `npm install` |\n| 型エラー | `Type error` | error-recovery agent |\n| ビルドエラー | `Build failed` | error-recovery agent |\n| ランタイム | 画面が表示されない | ログ分析 |\n| 環境設定 | 接続エラー | 環境変数確認 |\n\n---\n\n## 問題別対応\n\n### 「ボタンが動かない / フォームが送信されない / UIが崩れる」\n\nUIの不具合は、**画面で再現して観測→修正→再検証**するのが最短です。\n\n1. **agent-browser を最優先で使う**（インストール: `npm install -g agent-browser`）\n   ```bash\n   # ページを開いてスナップショット取得\n   agent-browser open https://example.com/target-page\n   agent-browser snapshot -i -c\n\n   # 要素参照でクリック・入力\n   agent-browser click @e1\n   agent-browser fill @e2 \"test\"\n   ```\n   - 対象URLで再現 → スナップショット/コンソールを根拠に原因を絞る\n   - ソースコード（UI/状態管理/API/バリデーション）を確認して修正\n   - 同じ手順で再現しないことを確認\n   - 参考: `docs/OPTIONAL_PLUGINS.md`\n2. **agent-browser が使えない場合のフォールバック**\n   - MCP ブラウザツール（chrome-devtools, playwright）\n   - 再現手順（URL/手順/期待値/実際）\n   - スクリーンショット/動画\n   - コンソールログ/ネットワークログ\n\n### 「画面が真っ白」\n\n```\n🔍 診断中...\n\n考えられる原因:\n1. ビルドエラー\n2. JavaScript エラー\n3. ルーティング問題\n\n🔧 自動チェック:\n- ビルドログを確認... ✅ エラーなし\n- コンソールエラーを確認... ❌ エラー発見\n\n💡 解決策:\n「直して」と言ってください。自動修正を試みます。\n```\n\n### 「npm install が失敗」\n\n```\n🔍 診断中...\n\nエラー: `ERESOLVE unable to resolve dependency tree`\n\n🔧 解決策:\n1. キャッシュをクリア\n2. node_modules を再インストール\n\n実行してもいいですか？（はい/いいえ）\n```\n\n### 「Git がおかしい」\n\n```\n🔍 診断中...\n\n検出: マージコンフリクト発生\n\n🔧 解決策:\n1. コンフリクト箇所を表示\n2. 解決方法を提案\n\n「解決して」と言えば自動マージを試みます。\n```\n\n---\n\n## VibeCoder向け応答パターン\n\n### パターン1: 自動修正可能\n\n```\n⚠️ 問題を検出しました\n\n**問題**: モジュールが見つかりません\n**原因**: 依存関係の未インストール\n\n🔧 **自動修正します**\n→ `npm install` を実行中...\n✅ 修正完了！もう一度試してください。\n```\n\n### パターン2: 確認が必要\n\n```\n⚠️ 問題を検出しました\n\n**問題**: 設定ファイルの変更が必要\n**影響**: 動作に影響する可能性\n\n🤔 **確認させてください**:\n設定を変更しても大丈夫ですか？\n\n→ 「変更して」で実行\n→ 「説明して」で詳細を確認\n```\n\n### パターン3: エスカレーション\n\n```\n⚠️ 複雑な問題を検出しました\n\n**問題**: {{問題の概要}}\n**試した修正**: 3回失敗\n\n🆘 **Cursor (PM) への相談をおすすめします**\n\n以下を Cursor に共有してください:\n- エラー内容: {{要約}}\n- 試した対応: {{リスト}}\n- 推定原因: {{分析}}\n\n「報告書を作って」で共有用レポートを生成します。\n```\n\n---\n\n## よくある質問への自動応答\n\n| 質問 | 自動応答 |\n|------|----------|\n| 「なぜエラーになった？」 | エラーログを分析して原因を説明 |\n| 「どうすれば直る？」 | 具体的な解決手順を提示 |\n| 「前は動いてたのに」 | git log で最近の変更を確認 |\n| 「同じエラーが何度も」 | パターンを分析して根本対策を提案 |\n\n---\n\n## 診断コマンド\n\n### クイック診断\n\n```\n「診断して」\n→ 全般的な健全性チェック\n→ 問題があれば報告\n→ なければ「問題なし」\n```\n\n### 詳細診断\n\n```\n「詳しく診断して」\n→ 依存関係チェック\n→ ビルドテスト\n→ テスト実行\n→ 環境変数確認\n→ 詳細レポート出力\n```\n\n---\n\n## 予防的アドバイス\n\n問題を未然に防ぐため、以下をおすすめ：\n\n1. **定期的な `npm run build`**: 問題を早期発見\n2. **こまめなコミット**: 問題発生時に戻しやすい\n3. **Plans.md の更新**: 変更履歴を追跡可能に\n\n---\n\n## 注意事項\n\n- 自動修正は3回まで試行\n- 3回失敗したらエスカレーション\n- 破壊的な操作は必ず確認を取る\n- 修正履歴は session-log.md に記録\n\n---\n\n## 🔧 LSP 機能の活用\n\n問題解決では LSP（Language Server Protocol）を活用して正確に原因を特定します。\n\n### LSP Diagnostics による問題検出\n\n```\n🔍 LSP 診断実行中...\n\n📊 診断結果:\n\n| ファイル | 行 | メッセージ |\n|---------|-----|-----------|\n| src/api/user.ts | 23 | 'userId' は undefined の可能性があります |\n| src/components/Form.tsx | 45 | 型 'string' を型 'number' に割り当てることはできません |\n\n→ 2件の問題を検出\n→ 上記が「動かない」原因の可能性が高い\n```\n\n### Go-to-definition による原因追跡\n\n```\n🔍 原因追跡\n\nエラー: Cannot read property 'name' of undefined\n\n追跡:\n1. src/pages/user.tsx:34 - user.name を参照\n2. src/hooks/useUser.ts:12 - user を返す ← Go-to-definition\n3. src/api/user.ts:8 - API レスポンスが null の可能性\n\n→ API エラー時のハンドリング不足が原因\n```\n\n### VibeCoder 向けの使い方\n\n| 症状 | LSP 活用 |\n|------|---------|\n| 「動かない」 | Diagnostics でエラー箇所を特定 |\n| 「どこがおかしい？」 | Go-to-definition で原因を追跡 |\n| 「いつから壊れた？」 | Find-references で変更影響を確認 |\n\n詳細: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n",
        "skills/ui/SKILL.md": "---\nname: ui\ndescription: \"Generates UI components and feedback forms. Use when user mentions components, UI, hero sections, forms, feedback, or contact requests. Do NOT load for: authentication features, backend implementation, database operations, or business logic.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# UI Skills\n\nUIコンポーネントとフォームの生成を担当するスキル群です。\n\n## 制約の優先順位と適用条件\n\n1. 基本は `references/ui-skills.md` の制約を最優先で適用する。\n2. `references/frontend-design.md` は「尖った/独自/表現強め/ブランド強化」などが**明示**された場合のみ適用する。\n3. UI Skills の MUST/NEVER は原則維持。ただし**ユーザーが明示的に要求した場合のみ**以下の例外を許可する:\n   - グラデーション、発光、強い装飾\n   - アニメーション（追加・拡張）\n   - カスタム easing\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **制約セット** | See [references/ui-skills.md](references/ui-skills.md) / [references/frontend-design.md](references/frontend-design.md) |\n| **コンポーネント生成** | See [references/component-generation.md](references/component-generation.md) |\n| **フィードバックフォーム** | See [references/feedback-forms.md](references/feedback-forms.md) |\n\n## 実行手順\n\n1. **制約セットを適用**（優先順位に従う）\n2. **品質判定ゲート**（Step 0）\n3. ユーザーのリクエストを分類\n4. 上記の「機能詳細」から適切な参照ファイルを読む\n5. その内容に従って生成\n\n### Step 0: 品質判定ゲート（a11y チェックリスト）\n\nUI コンポーネント生成時は、アクセシビリティを確保:\n\n```markdown\n♿ アクセシビリティチェックリスト\n\n生成する UI は以下を満たすことを推奨：\n\n### 必須項目\n- [ ] 画像に alt 属性を設定\n- [ ] フォーム要素に label を関連付け\n- [ ] キーボード操作可能（Tab でフォーカス移動）\n- [ ] フォーカス状態が視覚的に分かる\n\n### 推奨項目\n- [ ] 色だけに依存しない情報伝達\n- [ ] コントラスト比 4.5:1 以上（テキスト）\n- [ ] aria-label / aria-describedby の適切な使用\n- [ ] 見出し構造（h1 → h2 → h3）が論理的\n\n### インタラクティブ要素\n- [ ] ボタンに適切なラベル（「詳細」ではなく「製品詳細を見る」）\n- [ ] モーダル/ダイアログのフォーカストラップ\n- [ ] エラーメッセージがスクリーンリーダーで読まれる\n```\n\n### VibeCoder 向け\n\n```markdown\n♿ 誰でも使えるデザインにするために\n\n1. **画像には説明をつける**\n   - 「商品画像」ではなく「赤いスニーカー、正面から」\n\n2. **クリックできる場所はキーボードでも操作可能に**\n   - Tab キーで移動、Enter で決定\n\n3. **色だけで判断させない**\n   - 赤=エラー だけでなく、アイコン+テキストも\n```\n",
        "skills/ui/references/component-generation.md": "---\nname: component\ndescription: \"UIコンポーネント生成（shadcn/ui 等）。ヒーローセクションや料金表などのUIを作りたい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Component Skill\n\nshadcn/uiベースのUIコンポーネントを生成するスキル。\n最初に `../ui-skills.md` と `../frontend-design.md` の適用条件を確認する。\n\n---\n\n## トリガーフレーズ\n\n- 「ヒーローセクションを作って」\n- 「料金表を作って」\n- 「フッターを作って」\n- 「お問い合わせフォームを作って」\n- 「UIコンポーネントを生成して」\n\n---\n\n## 機能\n\n- shadcn/uiコンポーネントの自動インストール\n- レスポンシブ対応\n- アクセシビリティ対応\n- Tailwind CSSカスタマイズ\n\n---\n\n## 対応コンポーネント\n\n- Hero セクション\n- Pricing（料金表）\n- Features（機能紹介）\n- Contact（お問い合わせ）\n- Footer\n- Header/Navigation\n",
        "skills/ui/references/feedback-forms.md": "---\nname: feedback\ndescription: \"フィードバック収集機能の実装。ユーザーからの声を集めたい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Feedback Skill\n\nアプリ内フィードバックフォームを実装するスキル。\n最初に `../ui-skills.md` と `../frontend-design.md` の適用条件を確認する。\n\n---\n\n## トリガーフレーズ\n\n- 「フィードバック機能を追加して」\n- 「ユーザーの声を集めたい」\n- 「バグ報告フォームを作って」\n- 「お問い合わせフォームを追加して」\n\n---\n\n## 機能\n\n- フィードバックフォーム\n- バグ報告\n- 機能リクエスト\n- 満足度調査\n\n---\n\n## 実行フロー\n\n1. 制約セットの適用条件を確認\n2. プロジェクト構成を確認\n3. フィードバックの種類を選択\n4. フォームUIを作成\n5. APIエンドポイントを作成\n6. データ保存先を設定\n",
        "skills/ui/references/frontend-design.md": "---\nname: frontend-design-summary\ndescription: \"frontend-design の設計思考と美的指針の要約\"\n---\n\n# Frontend Design Summary\n\nUI の独自性と美的完成度を高めるための設計指針。\n明示要求がある場合のみ適用する。\n\n## 設計思考（最初に決める）\n- Purpose: 誰の何を解決する UI か\n- Tone: 大胆な方向性を 1 つ選ぶ（例: minimal / brutalist / editorial / playful）\n- Constraints: 技術制約と a11y\n- Differentiation: その UI の「記憶に残る 1 点」を決める\n\n## 実装の品質基準\n- Production-grade で実際に動く\n- 視覚的に印象が強く、一貫した方向性\n- 細部の詰め（余白、階層、状態）\n\n## デザイン指針\n- Typography: 目を引く display と読みやすい body のペア\n- Color: 主役色と鋭いアクセントを明確に\n- Motion: 大きな 1 回の演出に集中（分散しすぎない）\n- Space: 余白 or 高密度を意図的に選ぶ\n- Background: 雰囲気のあるレイヤーや質感（必要なら）\n\n## 注意\n- 方向性は「意図の強さ」が重要。派手さの有無ではない。\n- 実装の複雑さはデザインの方向性に合わせる。\n\n## Source\n- external frontend-design skill (Anthropic)\n",
        "skills/ui/references/ui-skills.md": "---\nname: ui-skills-summary\ndescription: \"UI Skills の制約セット要約（実装品質優先）\"\n---\n\n# UI Skills Summary\n\nUI 実装で破綻しやすいポイントを防ぐための制約セット。\n\n## Stack\n- MUST: Tailwind CSS はデフォルト値を使う（既存カスタムか明示要求がある場合のみ例外）\n- MUST: JavaScript のアニメーションが必要なら `motion/react` を使う\n- SHOULD: Tailwind の入場/軽微アニメに `tw-animate-css`\n- MUST: class 制御は `cn`（`clsx` + `tailwind-merge`）\n\n## Components\n- MUST: キーボード/フォーカス挙動はアクセシブルなプリミティブを使う\n- MUST: 既存のプリミティブを優先\n- NEVER: 同一の操作面でプリミティブを混在させない\n- SHOULD: 互換があるなら Base UI を優先\n- MUST: アイコンのみボタンには `aria-label`\n- NEVER: キーボード/フォーカス挙動を手実装しない（明示要求がない限り）\n\n## Interaction\n- MUST: 破壊的操作は AlertDialog\n- SHOULD: ローディングは構造的スケルトン\n- NEVER: `h-screen` は使わず `h-dvh`\n- MUST: fixed 要素は `safe-area-inset` を考慮\n- MUST: エラーは操作箇所の近くに出す\n- NEVER: input/textarea の貼り付けをブロックしない\n\n## Animation\n- NEVER: 明示要求がない限りアニメーション追加しない\n- MUST: `transform` / `opacity` のみをアニメーション\n- NEVER: `width/height/top/left/margin/padding` をアニメーション\n- SHOULD: `background/color` のアニメは小さな局所 UI のみ\n- SHOULD: 入口は `ease-out`\n- NEVER: フィードバックは 200ms 超えない\n- MUST: ループはオフスクリーンで停止\n- SHOULD: `prefers-reduced-motion` を尊重\n- NEVER: カスタム easing は明示要求がない限り禁止\n- SHOULD: 大きな画像/全面面はアニメを避ける\n\n## Typography\n- MUST: 見出しは `text-balance`\n- MUST: 本文は `text-pretty`\n- MUST: 数値は `tabular-nums`\n- SHOULD: 密な UI は `truncate` or `line-clamp`\n- NEVER: `tracking-*` を勝手に変えない\n\n## Layout\n- MUST: 固定の `z-index` スケールを使う（任意の `z-*` は避ける）\n- SHOULD: 正方形は `size-*`\n\n## Performance\n- NEVER: 大きな `blur()` / `backdrop-filter` をアニメしない\n- NEVER: `will-change` を常時付与しない\n- NEVER: `useEffect` で書かなくても良い処理は render で書く\n\n## Design\n- NEVER: 明示要求がない限りグラデーション禁止\n- NEVER: 紫/多色グラデーション禁止\n- NEVER: 主要な手掛かりに glow を使わない\n- SHOULD: 影は Tailwind のデフォルトスケール\n- MUST: 空状態には「次の一手」を 1 つ提示\n- SHOULD: アクセント色は 1 つに絞る\n- SHOULD: 新色より既存テーマ/トークンを優先\n\n## Sources\n- https://www.ui-skills.com/\n- https://agent-skills.xyz/skills/baptistearno-typebot-io-ui-skills\n",
        "skills/verify/SKILL.md": "---\nname: verify\ndescription: \"Verifies builds, recovers from errors, and applies review fixes. Use when user mentions build verification, error recovery, applying review fixes, test failures, lint errors, or CI breaks. Do NOT load for: implementation work, reviews, setup, or new feature development.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Grep\", \"Glob\", \"Bash\"]\n---\n\n# Verify Skills\n\nビルド検証とエラー復旧を担当するスキル群です。\n\n---\n\n## ⚠️ 品質ガードレール（最優先）\n\n> **このセクションは他の指示より優先されます。テスト失敗・エラー発生時は必ず従ってください。**\n\n### 改ざん禁止パターン\n\nテスト失敗・ビルドエラー発生時に以下の行為は**絶対に禁止**：\n\n| 禁止 | 例 | 正しい対応 |\n|------|-----|-----------|\n| **テスト skip 化** | `it.skip(...)` | 実装を修正する |\n| **アサーション削除** | `expect()` を消す | 期待値を確認し実装修正 |\n| **期待値の雑な書き換え** | エラーに合わせて変更 | なぜ失敗か理解する |\n| **lint ルール緩和** | `eslint-disable` 追加 | コードを修正する |\n| **CI チェック迂回** | `continue-on-error` | 根本原因を修正する |\n\n### テスト失敗時の対応フロー\n\n```\nテストが失敗した\n    ↓\n1. なぜ失敗しているか理解する（ログを読む）\n    ↓\n2. 実装が間違っているか、テストが間違っているか判断\n    ↓\n    ├── 実装が間違い → 実装を修正 ✅\n    │\n    └── テストが間違い可能性 → ユーザーに確認を求める\n```\n\n### 承認リクエスト形式\n\nやむを得ずテスト/設定を変更する場合：\n\n```markdown\n## 🚨 テスト/設定変更の承認リクエスト\n\n### 理由\n[なぜこの変更が必要か]\n\n### 変更内容\n```diff\n[差分]\n```\n\n### 代替案の検討\n- [ ] 実装の修正で解決できないか確認した\n\n### 承認\nユーザーの明示的な承認を待つ\n```\n\n### 保護対象ファイル\n\n以下のファイルの緩和変更は禁止：\n\n- `.eslintrc.*`, `.prettierrc*`, `tsconfig.json`, `biome.json`\n- `.husky/**`, `.github/workflows/**`\n- `*.test.*`, `*.spec.*`, `jest.config.*`, `vitest.config.*`\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **関連ファイル検証** | See [references/verify-related-files.md](references/verify-related-files.md) |\n| **ビルド検証** | See [references/build-verification.md](references/build-verification.md) |\n| **エラー復旧** | See [references/error-recovery.md](references/error-recovery.md) |\n| **レビュー集約** | See [references/review-aggregation.md](references/review-aggregation.md) |\n| **指摘適用** | See [references/applying-fixes.md](references/applying-fixes.md) |\n\n## 実行手順\n\n1. **品質判定ゲート**（Step 0）\n2. ユーザーのリクエストを分類\n3. **（実装完了後）関連ファイル検証**（Step 1.5）\n4. **（Claude-mem 有効時）過去のエラーパターンを検索**\n5. 上記の「機能詳細」から適切な参照ファイルを読む\n6. その内容に従って検証/復旧実行\n\n### Step 0: 品質判定ゲート（再現テスト提案）\n\nエラー/バグ報告時に、TDD アプローチを提案:\n\n```\nエラー報告受領\n    ↓\n┌─────────────────────────────────────────┐\n│           品質判定ゲート                 │\n├─────────────────────────────────────────┤\n│  判定項目:                              │\n│  ├── バグ報告？ → 再現テスト先行を提案  │\n│  ├── テスト失敗？ → テスト vs 実装判断  │\n│  └── ビルドエラー？ → 直接修正          │\n└─────────────────────────────────────────┘\n          ↓\n    適切なアプローチを提案\n```\n\n#### バグ報告時の提案\n\n```markdown\n🐛 バグ報告を受け付けました\n\n**推奨アプローチ**: 再現テスト先行\n\n1. まずバグを再現するテストを書く\n2. テストが失敗することを確認（Red）\n3. 実装を修正してテストを通す（Green）\n4. リファクタリング（Refactor）\n\nこの方法で進めますか？\n1. 再現テストから書く（推奨）\n2. 直接修正に進む\n```\n\n#### テスト失敗時の判断フロー\n\n```markdown\n🔴 テストが失敗しています\n\n**判断が必要です**:\n\nテスト失敗の原因を分析:\n- [ ] 実装が間違っている → 実装を修正\n- [ ] テストの期待値が古い → ユーザーに確認\n\n⚠️ テストの改ざん（skip化、アサーション削除）は禁止です\n\nどちらに該当しますか？\n1. 実装を修正する\n2. テストの期待値について確認したい\n```\n\n#### VibeCoder 向け\n\n```markdown\n🐛 問題が報告されました\n\n**推奨**: まず「問題が起きる条件」を明確にしましょう\n\n1. どんな操作をすると問題が起きますか？\n2. 期待する動作は何ですか？\n3. 実際にはどうなりますか？\n\nこれを整理してから修正に進むと、確実に直せます。\n```\n\n### Step 1.5: 関連ファイル検証（実装完了後）\n\n実装完了後、コミット前に編集ファイルの関連ファイルをチェック：\n\n```\n編集ファイルを取得\n    ↓\n┌─────────────────────────────────────────┐\n│           関連ファイル検証               │\n├─────────────────────────────────────────┤\n│  変更パターンを分析:                     │\n│  ├── 関数シグネチャ変更 → 呼び出し元確認 │\n│  ├── 型/interface変更 → 実装箇所確認    │\n│  ├── export削除 → import文確認         │\n│  └── 設定変更 → 関連設定ファイル確認    │\n└─────────────────────────────────────────┘\n    ↓\n  修正漏れ候補を警告\n```\n\n**出力例**:\n\n```markdown\n📋 関連ファイル検証\n\n✅ 編集済み: src/auth.ts\n   └─ 関数 `validateToken` のシグネチャ変更を検出\n\n⚠️ 要確認: 以下のファイルが影響を受ける可能性\n   ├─ src/api/middleware.ts:45 (validateToken 呼び出し)\n   ├─ src/routes/protected.ts:12 (validateToken 呼び出し)\n   └─ tests/auth.test.ts:28 (テストケース)\n\n確認済みですか？\n1. 確認済み、続行\n2. 各ファイルを確認する\n3. LSP find-references で詳細表示\n```\n\n**重要度の判定**:\n\n| 重要度 | 条件 | アクション |\n|--------|------|-----------|\n| `🚨 critical` | 必ずエラーになる（export削除、必須引数追加） | 修正必須 |\n| `⚠️ warning` | エラーの可能性あり（オプショナル引数、型変更） | 確認推奨 |\n| `ℹ️ info` | 影響軽微（コメント、ドキュメント） | 参考情報 |\n\n詳細: [references/verify-related-files.md](references/verify-related-files.md)\n\n---\n\n### Step 2: 過去のエラーパターン検索（Memory-Enhanced）\n\nClaude-mem が有効な場合、エラー復旧前に過去の類似エラーを検索:\n\n```\n# mem-search で過去のエラーと解決策を検索\nmem-search: type:bugfix \"{エラーメッセージのキーワード}\"\nmem-search: concepts:problem-solution \"{エラーの種類}\"\nmem-search: concepts:gotcha \"{関連ファイル/ライブラリ}\"\n```\n\n**表示例**:\n\n```markdown\n📚 過去のエラー解決履歴\n\n| 日付 | エラー | 解決策 |\n|------|--------|-------|\n| 2024-01-15 | CORS エラー | Access-Control-Allow-Origin ヘッダー追加 |\n| 2024-01-20 | 型エラー: undefined | Optional chaining (?.) を使用 |\n\n💡 過去の解決策を参考に復旧を試行\n```\n\n**ガードレール履歴の表示**:\n\n```markdown\n⚠️ このプロジェクトでの過去のガードレール発動\n\n- テスト改ざん防止: 2回\n- lint 緩和防止: 1回\n\n💡 テスト/設定の改ざんによる「解決」は禁止です\n```\n\n> **注**: Claude-mem が未設定の場合、このステップはスキップされます。\n\n---\n\n## 🔧 LSP 機能の活用\n\n検証とエラー復旧では LSP（Language Server Protocol）を活用して精度を向上します。\n\n### ビルド検証での LSP 活用\n\n```\nビルド前チェック:\n\n1. LSP Diagnostics を実行\n2. エラー: 0件を確認 → ビルド実行\n3. エラーあり → 先にエラーを修正\n```\n\n### エラー復旧での LSP 活用\n\n| 復旧シーン | LSP 活用方法 |\n|-----------|-------------|\n| 型エラー | Diagnostics で正確な位置を特定 |\n| 参照エラー | Go-to-definition で原因を追跡 |\n| import エラー | Find-references で正しいパスを特定 |\n\n### 検証フロー\n\n```\n📊 LSP 検証結果\n\nStep 1: Diagnostics\n  ├── エラー: 0件 ✅\n  └── 警告: 2件 ⚠️\n\nStep 2: ビルド\n  └── 成功 ✅\n\nStep 3: テスト\n  └── 15/15 通過 ✅\n\n→ 検証完了\n```\n\n詳細: [docs/LSP_INTEGRATION.md](../../docs/LSP_INTEGRATION.md)\n",
        "skills/verify/references/applying-fixes.md": "---\nname: review-apply-fixes\ndescription: \"レビューで検出された問題を自動修正するスキル。レビューで発見された問題の自動修正が承認された場合に使用します。\"\nallowed-tools: [\"Read\", \"Edit\", \"Bash\"]\n---\n\n# Review Apply Fixes\n\nレビューで検出された問題を自動修正するスキル。\n\n---\n\n## 目的\n\nレビュー結果に基づいて：\n- 自動修正可能な問題を特定\n- ユーザー確認後に修正を適用\n- 修正前後の diff を提示\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `improvement_suggestions` | 改善提案リスト |\n| `user_approved` | ユーザーが修正を承認したか |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `applied_fixes` | 適用された修正のリスト |\n| `skipped_fixes` | スキップされた修正のリスト |\n| `update_files` | 更新されたファイルのリスト |\n\n---\n\n## 自動修正可能な問題\n\n### 確実に自動修正できるもの\n\n| カテゴリ | 問題 | 修正方法 |\n|---------|------|---------|\n| 品質 | 未使用の import | 削除 |\n| 品質 | 未使用の変数 | 削除（または _ プレフィックス） |\n| 品質 | フォーマット | Prettier/ESLint --fix |\n| セキュリティ | console.log の削除 | 削除またはロガーに置換 |\n\n### 確認が必要なもの\n\n| カテゴリ | 問題 | 確認理由 |\n|---------|------|---------|\n| パフォーマンス | メモ化追加 | ロジック変更の可能性 |\n| 品質 | 関数分割 | 設計判断が必要 |\n| セキュリティ | 入力バリデーション | 仕様確認が必要 |\n\n### 自動修正しないもの\n\n| カテゴリ | 問題 | 理由 |\n|---------|------|------|\n| 設計 | アーキテクチャ変更 | 大規模な変更 |\n| ロジック | ビジネスロジック修正 | 仕様理解が必要 |\n\n---\n\n## 実行フロー\n\n```\n改善提案リスト\n    │\n    ▼\n┌─────────────────────────────┐\n│ 自動修正可能性の判定        │\n│ - 確実に修正可能            │\n│ - 確認が必要                │\n│ - 手動対応が必要            │\n└─────────────┬───────────────┘\n              │\n              ▼\n┌─────────────────────────────┐\n│ ユーザーへの確認            │\n│ - 適用する修正の一覧提示    │\n│ - 承認を待つ                │\n└─────────────┬───────────────┘\n              │\n    ┌─────────┴─────────┐\n    ▼                   ▼\n 承認              キャンセル\n    │                   │\n    ▼                   ▼\n 修正適用          修正なしで終了\n    │\n    ▼\n diff 提示\n```\n\n---\n\n## 出力例\n\n### 修正前の確認\n\n```markdown\n## 自動修正の確認\n\n以下の修正を適用しますか？\n\n### 適用予定 (3件)\n1. ✅ 未使用 import の削除 - `src/utils/helpers.ts:12`\n2. ✅ console.log の削除 - `src/api/posts.ts:45`\n3. ✅ フォーマット修正 - `src/components/Button.tsx`\n\n### 確認が必要 (1件)\n4. ⚠️ useMemo の追加 - `src/components/List.tsx:23`\n   - 計算処理のメモ化を追加しますか？\n\n### 手動対応が必要 (1件)\n5. ❌ 関数分割 - `src/services/user.ts:45`\n   - 設計判断が必要なため自動修正不可\n\n[適用する] [一部のみ] [キャンセル]\n```\n\n### 修正後のレポート\n\n```markdown\n## 修正完了\n\n### 適用された修正 (3件)\n1. ✅ 未使用 import の削除 - `src/utils/helpers.ts`\n2. ✅ console.log の削除 - `src/api/posts.ts`\n3. ✅ フォーマット修正 - `src/components/Button.tsx`\n\n### 変更 diff\n[diff を表示]\n\n### 次のステップ\n- ビルド検証を実行して問題がないことを確認\n- 手動対応が必要な 1 件を検討\n```\n\n---\n\n## 注意事項\n\n- 修正前に必ず diff を提示する\n- 破壊的な変更は行わない\n- 修正後にビルド検証を推奨する\n- 不明な場合はスキップする\n",
        "skills/verify/references/build-verification.md": "---\nname: verify-build\ndescription: \"ビルドとテストを実行して動作を確認する。実装完了後、またはレビュー前に動作確認が必要な場合に使用します。\"\nallowed-tools: [Read,Bash]\n---\n\n# Verify Build\n\n実装後にビルドとテストを実行し、変更が正常に動作することを確認するスキル。\n\n---\n\n## 目的\n\nコード変更後に以下を自動実行して、問題がないことを確認：\n- ビルドの成功\n- テストの通過\n- 型チェック（TypeScript の場合）\n- Lint チェック\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `changed_files` | 変更されたファイルのリスト |\n| `tech_stack` | プロジェクトの技術スタック |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `build_success` | ビルド成功フラグ |\n| `test_results` | テスト結果サマリー |\n| `errors` | エラーがあれば詳細 |\n\n---\n\n## 実行手順\n\n### 1. プロジェクトタイプの判定\n\n```\npackage.json あり → Node.js プロジェクト\npyproject.toml あり → Python プロジェクト\nCargo.toml あり → Rust プロジェクト\ngo.mod あり → Go プロジェクト\n```\n\n### 2. ビルドコマンドの実行\n\n**Node.js:**\n```bash\nnpm run build\n# または\nnpm run type-check\n```\n\n**Python:**\n```bash\npython -m py_compile app/**/*.py\n# または\nmypy app/\n```\n\n### 3. テストの実行\n\n**Node.js:**\n```bash\nnpm test\n# または\nnpm run test:unit\n```\n\n**Python:**\n```bash\npytest tests/\n```\n\n### 4. Lint チェック\n\n**Node.js:**\n```bash\nnpm run lint\n```\n\n**Python:**\n```bash\nruff check app/\n```\n\n---\n\n## 結果の判定\n\n| 状態 | 判定 | 次のアクション |\n|------|------|---------------|\n| すべて成功 | `build_success: true` | 次のステップへ進む |\n| ビルド失敗 | `build_success: false` | エラー修正スキルを起動 |\n| テスト失敗 | `build_success: false` | テスト修正スキルを起動 |\n\n---\n\n## 出力例\n\n### 成功時\n\n```\n✅ ビルド検証完了\n\n- ビルド: 成功\n- 型チェック: 成功\n- テスト: 12/12 通過\n- Lint: 問題なし\n\n次のステップに進めます。\n```\n\n### 失敗時\n\n```\n❌ ビルド検証失敗\n\n- ビルド: 成功\n- 型チェック: 成功\n- テスト: 10/12 通過 (2 件失敗)\n\n失敗したテスト:\n1. test_user_login - AssertionError\n2. test_create_post - TypeError\n\n自動修正を試みます...\n```\n\n---\n\n## 注意事項\n\n- テスト実行には時間がかかる場合があるため、進捗を表示する\n- 失敗時は `error-recovery` スキルと連携する\n- CI 環境と同じ条件でチェックすることを推奨\n",
        "skills/verify/references/error-recovery.md": "---\nname: error-recovery\ndescription: \"エラーが発生した際に自動修正を試みる。ビルドエラー、テスト失敗、または実行時エラーが検出された場合に使用します。\"\nallowed-tools: [Read,Edit,Bash]\n---\n\n# Error Recovery\n\nビルドやテストで発生したエラーを自動診断し、修正を試みるスキル。\n最大3回のリトライ後、解決しない場合はエスカレーションする。\n\n---\n\n## 目的\n\n- エラーの自動診断\n- 一般的なエラーパターンの自動修正\n- 修正不可能な場合の適切なエスカレーション\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `error_type` | エラーの種類（build, test, lint, runtime） |\n| `error_message` | エラーメッセージ |\n| `error_file` | エラーが発生したファイル |\n| `error_line` | エラーが発生した行番号 |\n| `retry_count` | 現在のリトライ回数 |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `fixed` | 修正成功フラグ |\n| `fix_description` | 修正内容の説明 |\n| `escalate` | エスカレーションが必要か |\n\n---\n\n## エラーパターンと自動修正\n\n### TypeScript / JavaScript\n\n| エラーパターン | 自動修正 |\n|--------------|---------|\n| `Cannot find module` | パッケージインストール or パス修正 |\n| `Type 'X' is not assignable` | 型定義の追加・修正 |\n| `Property 'X' does not exist` | オプショナルチェーン追加 |\n| `Expected X arguments` | 引数の追加・削除 |\n\n### Python\n\n| エラーパターン | 自動修正 |\n|--------------|---------|\n| `ModuleNotFoundError` | pip install or import 修正 |\n| `IndentationError` | インデント修正 |\n| `NameError` | 変数定義の追加 |\n| `TypeError` | 型変換の追加 |\n\n### テストエラー\n\n| エラーパターン | 自動修正 |\n|--------------|---------|\n| `AssertionError` | 期待値の確認・修正 |\n| `Timeout` | タイムアウト値の増加 |\n| `Mock not called` | モック設定の修正 |\n\n---\n\n## 実行フロー\n\n```\nエラー発生\n    │\n    ▼\n┌─────────────────────────────┐\n│ エラーパターンの分析        │\n│ - エラーメッセージ解析      │\n│ - ファイル・行番号特定      │\n│ - 関連コードの読み取り      │\n└─────────────┬───────────────┘\n              │\n              ▼\n┌─────────────────────────────┐\n│ 修正の試行                  │\n│ - パターンマッチング        │\n│ - 自動修正の適用            │\n│ - ビルド・テスト再実行      │\n└─────────────┬───────────────┘\n              │\n    ┌─────────┴─────────┐\n    ▼                   ▼\n 成功               失敗\n    │                   │\n    ▼                   ▼\n 完了           リトライ < 3?\n                    │\n          ┌─────────┴─────────┐\n          ▼                   ▼\n        再試行          エスカレーション\n```\n\n---\n\n## リトライ戦略\n\n**リトライ上限の決定**:\n- `claude-code-harness.config.yaml` の `orchestration.max_state_retries` があればそれを優先\n- 未設定時はデフォルト `3`\n\n| 回数 | 戦略 |\n|------|------|\n| 1回目 | 直接的なパターンマッチ修正 |\n| 2回目 | 関連ファイルを含めた広範な分析 |\n| 3回目 | 代替アプローチの試行 |\n\n---\n\n## エスカレーション\n\n3回のリトライで解決しない場合：\n\n```markdown\n## ⚠️ エラー修正エスカレーション\n\n**失敗回数**: 3回\n**エラー種別**: {{error_type}}\n\n### エラー内容\n{{error_message}}\n\n### 試した修正\n1. {{fix_attempt_1}}\n2. {{fix_attempt_2}}\n3. {{fix_attempt_3}}\n\n### 推定原因\n{{estimated_cause}}\n\n### 推奨アクション\n- [ ] 手動での確認が必要\n- [ ] 設計の見直しが必要\n```\n\n---\n\n## 注意事項\n\n- 修正は最小限の変更に留める\n- 修正前後で diff を提示する\n- 破壊的な変更は行わない\n- 不明な場合はユーザーに確認を求める\n",
        "skills/verify/references/review-aggregation.md": "---\nname: review-aggregate\ndescription: \"複数のレビュー結果を集約し総合評価を生成するスキル。複数のレビュー結果を統合して総合評価を作成する場合に使用します。\"\nallowed-tools: [\"Read\"]\n---\n\n# Review Aggregate\n\n複数のレビュー結果（セキュリティ、パフォーマンス、品質、アクセシビリティ）を集約し、総合評価を生成するスキル。\n\n---\n\n## 目的\n\n個別のレビュー結果を統合して：\n- 総合評価の算出\n- 優先度付けされた改善提案リストの生成\n- 次のアクションの提示\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `security_issues` | セキュリティレビュー結果 |\n| `performance_issues` | パフォーマンスレビュー結果 |\n| `quality_issues` | 品質レビュー結果 |\n| `a11y_issues` | アクセシビリティレビュー結果（該当する場合） |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `overall_grade` | 総合評価 (A-F) |\n| `improvement_suggestions` | 優先度付き改善提案リスト |\n\n---\n\n## 評価アルゴリズム\n\n### スコア計算\n\n各カテゴリのスコアを数値化：\n- A = 5, B = 4, C = 3, D = 2, F = 1\n\n### 重み付け\n\n| カテゴリ | 重み | 理由 |\n|---------|------|------|\n| セキュリティ | 35% | 最重要、脆弱性は致命的 |\n| パフォーマンス | 25% | ユーザー体験に直結 |\n| 品質 | 25% | 保守性に影響 |\n| アクセシビリティ | 15% | 重要だが全プロジェクトに該当しない |\n\n### 総合スコア算出\n\n```\n総合スコア = (セキュリティ × 0.35) + (パフォーマンス × 0.25)\n           + (品質 × 0.25) + (アクセシビリティ × 0.15)\n```\n\n### グレード判定\n\n| スコア範囲 | グレード |\n|-----------|---------|\n| 4.5 - 5.0 | A |\n| 3.5 - 4.4 | B |\n| 2.5 - 3.4 | C |\n| 1.5 - 2.4 | D |\n| 1.0 - 1.4 | F |\n\n---\n\n## 優先度付け\n\n### 優先度決定基準\n\n| 優先度 | 基準 |\n|--------|------|\n| クリティカル | セキュリティの重大な問題 |\n| 高 | セキュリティ中程度 / パフォーマンス重大 |\n| 中 | パフォーマンス中程度 / 品質重大 |\n| 低 | 品質軽微 / アクセシビリティ |\n\n---\n\n## 出力例\n\n```markdown\n## 📊 コードレビュー総合結果\n\n### 総合評価: B\n\n| 観点 | 評価 | 問題数 |\n|------|------|--------|\n| セキュリティ | B | 2 件 |\n| パフォーマンス | C | 3 件 |\n| コード品質 | A | 1 件 |\n| アクセシビリティ | B | 2 件 |\n\n---\n\n### 改善提案（優先度順）\n\n#### クリティカル (0件)\nなし\n\n#### 高優先度 (2件)\n1. **N+1 クエリ問題** - `src/api/posts.ts:23`\n   - パフォーマンスに重大な影響\n\n2. **SQL インジェクションの可能性** - `src/api/users.ts:45`\n   - セキュリティリスク\n\n#### 中優先度 (3件)\n3. **長すぎる関数** - `src/services/user.ts:45`\n4. **非仮想化リスト** - `src/components/List.tsx:45`\n5. **alt 属性欠落** - `src/components/Image.tsx:8`\n\n#### 低優先度 (1件)\n6. **未使用の import** - `src/utils/helpers.ts:12`\n\n---\n\n### 推奨アクション\n\n1. **すぐに対応**: 高優先度の 2 件を修正\n2. **今週中に対応**: 中優先度の 3 件を修正\n3. **余裕があれば**: 低優先度の 1 件を修正\n\n自動修正を適用しますか？\n```\n\n---\n\n## 注意事項\n\n- クリティカル問題がある場合はマージ推奨しない\n- 修正の自動適用は確認を求める\n- 改善による効果を具体的に説明する\n",
        "skills/verify/references/verify-related-files.md": "---\nname: verify-related-files\ndescription: \"編集したファイルに関連するファイルの修正漏れをチェックする。実装完了後、コミット前に使用します。\"\nallowed-tools: [Read, Grep, Glob, Bash]\n---\n\n# Verify Related Files\n\n実装後に編集ファイルを分析し、関連ファイルの修正漏れを検出するスキル。\n\n---\n\n## 目的\n\nコード変更後に以下を自動検出して、修正漏れを防止：\n- 関数シグネチャ変更 → 呼び出し元の未更新\n- 型/interface変更 → 実装箇所の不整合\n- export変更 → import文の未更新\n- 設定値変更 → 環境別設定の非同期\n\n---\n\n## 入力\n\n| 項目 | 説明 |\n|------|------|\n| `changed_files` | 編集されたファイルのリスト（git diffから取得） |\n| `project_type` | プロジェクトタイプ（typescript, python, go, etc.） |\n\n---\n\n## 出力\n\n| 項目 | 説明 |\n|------|------|\n| `related_files` | 影響を受ける可能性のあるファイルリスト |\n| `severity` | 各ファイルの重要度（critical/warning/info） |\n| `check_reason` | なぜ確認が必要か |\n\n---\n\n## 実行手順\n\n### 1. 編集ファイルの取得\n\n```bash\n# ステージング済みの変更を取得\ngit diff --cached --name-only\n\n# または作業ツリーの変更\ngit diff --name-only\n```\n\n### 2. 変更内容の分析\n\n各編集ファイルについて以下を検出：\n\n| 検出項目 | 検出方法 |\n|---------|---------|\n| 関数シグネチャ変更 | git diff で引数・戻り値の変更を検出 |\n| export追加/削除 | `export` キーワードの差分 |\n| 型/interface変更 | `interface`, `type` 定義の差分 |\n| 定数/設定値変更 | 大文字定数、config オブジェクトの差分 |\n\n### 3. 関連ファイルパターンの適用\n\n#### TypeScript/JavaScript\n\n| 変更パターン | 関連ファイル検索 |\n|-------------|----------------|\n| `export function foo()` 変更 | `grep \"import.*foo\"` で使用箇所 |\n| `interface User` 変更 | `grep \"User\"` で型使用箇所 |\n| `*.tsx` コンポーネント props 変更 | 親コンポーネントの props 渡し |\n| `*.test.ts` なしの実装変更 | テストファイルの存在確認 |\n\n```bash\n# export された関数の使用箇所を検索\ngrep -r \"import.*{.*functionName.*}\" --include=\"*.ts\" --include=\"*.tsx\"\n\n# 型の使用箇所を検索\ngrep -r \": TypeName\" --include=\"*.ts\" --include=\"*.tsx\"\n```\n\n#### Python\n\n| 変更パターン | 関連ファイル検索 |\n|-------------|----------------|\n| `def function()` シグネチャ変更 | `grep \"from.*import function\"` |\n| `class Model` 変更 | `grep \"Model\"` で継承・使用箇所 |\n| `__init__.py` の `__all__` 変更 | パッケージ利用箇所 |\n\n#### 設定ファイル\n\n| 変更ファイル | 関連ファイル |\n|-------------|-------------|\n| `.env` | `.env.local`, `.env.production`, `.env.example` |\n| `config.ts` | `config.test.ts`, `config.prod.ts` |\n| `VERSION` | `package.json`, `plugin.json`, `CHANGELOG.md` |\n| `tsconfig.json` | `tsconfig.build.json`, `tsconfig.test.json` |\n\n### 4. LSP活用（利用可能な場合）\n\nLSP が有効な場合、より正確な関連ファイル検出が可能：\n\n```\n変更された関数/型を特定\n    ↓\nLSP find-references を実行\n    ↓\n全参照箇所をリスト化\n    ↓\n未編集の参照箇所を警告\n```\n\n**LSP 活用のメリット**:\n- 正確なシンボル参照（文字列マッチではない）\n- リネーム済みの参照も追跡可能\n- 型推論による暗黙的な使用も検出\n\n---\n\n## チェックパターン詳細\n\n### パターン1: 関数シグネチャ変更\n\n```typescript\n// Before\nexport function createUser(name: string): User\n\n// After\nexport function createUser(name: string, email: string): User\n```\n\n**チェック内容**:\n1. `createUser` の全呼び出し箇所を検索\n2. 引数が1つの呼び出しを警告\n\n**出力例**:\n```\n⚠️ 関数シグネチャ変更を検出: createUser\n\n呼び出し箇所（要確認）:\n├─ src/api/auth.ts:45 - createUser(name)  ← 引数不足の可能性\n├─ src/routes/signup.ts:23 - createUser(userName)  ← 引数不足の可能性\n└─ tests/user.test.ts:12 - createUser(\"test\")  ← 引数不足の可能性\n```\n\n### パターン2: interface/型変更\n\n```typescript\n// Before\ninterface User {\n  id: string;\n  name: string;\n}\n\n// After\ninterface User {\n  id: string;\n  name: string;\n  email: string;  // 追加\n}\n```\n\n**チェック内容**:\n1. `User` 型を使用する全箇所を検索\n2. オブジェクト生成箇所で `email` がない箇所を警告\n\n**出力例**:\n```\n⚠️ interface 変更を検出: User (フィールド追加: email)\n\n影響箇所（要確認）:\n├─ src/db/users.ts:30 - User オブジェクト生成\n├─ src/api/response.ts:15 - User 型アサーション\n└─ tests/fixtures/users.ts:5 - テストデータ\n```\n\n### パターン3: export削除\n\n```typescript\n// Before\nexport { createUser, deleteUser, updateUser }\n\n// After\nexport { createUser, updateUser }  // deleteUser 削除\n```\n\n**チェック内容**:\n1. `deleteUser` の import 文を検索\n2. import している全ファイルを警告\n\n**出力例**:\n```\n🚨 export 削除を検出: deleteUser\n\nimport しているファイル（修正必須）:\n├─ src/api/admin.ts:3 - import { deleteUser } from './users'\n└─ src/routes/user.ts:5 - import { deleteUser } from '@/users'\n```\n\n### パターン4: 設定ファイル同期\n\n```\nVERSION ファイルが変更された\n```\n\n**チェック内容**:\n1. 関連ファイルの VERSION 値を比較\n2. 不一致があれば警告\n\n**出力例**:\n```\n⚠️ VERSION 変更を検出: 2.9.22 → 2.9.23\n\n同期が必要なファイル:\n├─ .claude-plugin/plugin.json - version: \"2.9.22\" ← 要更新\n├─ package.json - version: \"2.9.23\" ✅ 同期済み\n└─ CHANGELOG.md - 2.9.23 エントリ ← 要確認\n```\n\n---\n\n## 重要度の判定\n\n| 重要度 | 条件 | アクション |\n|--------|------|-----------|\n| `🚨 critical` | 必ずエラーになる変更（export削除、必須引数追加） | 修正必須、コミット前にブロック |\n| `⚠️ warning` | エラーの可能性がある変更（オプショナル引数追加、型変更） | 確認を推奨 |\n| `ℹ️ info` | 影響が軽微な変更（コメント、内部実装） | 参考情報として表示 |\n\n---\n\n## 結果出力フォーマット\n\n### 問題なしの場合\n\n```\n✅ 関連ファイル検証完了\n\n編集ファイル: 3件\n├─ src/users.ts\n├─ src/api/auth.ts\n└─ tests/users.test.ts\n\n関連ファイルチェック: 問題なし\n→ コミットに進めます\n```\n\n### 要確認がある場合\n\n```\n📋 関連ファイル検証完了\n\n編集ファイル: 2件\n├─ src/users.ts (interface User 変更)\n└─ src/api/auth.ts\n\n⚠️ 要確認: 3件\n\n1. [warning] src/db/users.ts:30\n   User 型を使用 - email フィールド追加の影響確認\n\n2. [warning] tests/fixtures/users.ts:5\n   User テストデータ - email フィールド追加が必要な可能性\n\n3. [info] docs/api.md\n   User 型のドキュメント - 更新推奨\n\n確認済みですか？\n1. 確認済み、コミットに進む\n2. 各ファイルを確認する\n3. LSP find-references で詳細表示\n```\n\n### 修正必須がある場合\n\n```\n🚨 関連ファイル検証: 修正が必要です\n\n編集ファイル: 1件\n└─ src/utils/index.ts (export 削除: formatDate)\n\n🚨 修正必須: 2件\n\n1. [critical] src/components/DatePicker.tsx:3\n   import { formatDate } from '@/utils'\n   → formatDate は削除されました。import を修正してください。\n\n2. [critical] src/pages/events.tsx:8\n   import { formatDate } from '@/utils'\n   → formatDate は削除されました。import を修正してください。\n\n⛔ これらを修正するまでコミットできません。\n修正しますか？\n1. 自動で修正を試みる\n2. 手動で修正する\n```\n\n---\n\n## プロジェクト固有パターン\n\n### harness プロジェクト\n\n| 変更ファイル | 関連ファイルチェック |\n|-------------|-------------------|\n| `VERSION` | `plugin.json`, `CHANGELOG.md`, `CHANGELOG_ja.md` |\n| `commands/**/*.md` | frontmatter形式、必須フィールド |\n| `skills/**/SKILL.md` | references/ との整合性 |\n| `hooks.json` | `.claude-plugin/hooks.json` との同期 |\n| `*.config.yaml` | `*.config.schema.json` との整合性 |\n\n### Next.js プロジェクト\n\n| 変更ファイル | 関連ファイルチェック |\n|-------------|-------------------|\n| `app/**/page.tsx` | `layout.tsx`, メタデータ |\n| `components/*.tsx` | Storybook (`*.stories.tsx`) |\n| `lib/api.ts` | 型定義、テスト |\n\n### Express/API プロジェクト\n\n| 変更ファイル | 関連ファイルチェック |\n|-------------|-------------------|\n| `routes/*.ts` | OpenAPI spec、テスト |\n| `models/*.ts` | マイグレーション、シーダー |\n| `middleware/*.ts` | 適用箇所の確認 |\n\n---\n\n## 注意事項\n\n- LSP が利用可能な場合は grep より LSP を優先する\n- 大量の関連ファイルがある場合は重要度でフィルタリング\n- CI/CD と連携して自動チェックも検討\n- 偽陽性（関係ないのに警告）は許容、偽陰性（漏れ）は最小化\n",
        "skills/vibecoder-guide/SKILL.md": "---\nname: vibecoder-guide\ndescription: \"Guides VibeCoder (non-technical users) through natural language development. Use when user asks what to do next, how to use the system, needs help, or is stuck. Do NOT load for: technical-user work, direct implementation requests, or reviews.\"\nallowed-tools: [\"Read\"]\nuser-invocable: false\n---\n\n# VibeCoder Guide Skill\n\nVibeCoder（非技術者）が自然言語だけで開発を進められるようガイドするスキル。\n「どうすればいい？」「次は何？」などの質問に自動で応答します。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで自動起動します：\n\n- 「どうすればいい？」「どうしたらいい？」\n- 「次は何をすればいい？」「次は？」\n- 「何ができる？」「何をすればいい？」\n- 「困った」「わからない」「助けて」\n- 「使い方を教えて」\n- \"what should I do?\", \"what's next?\", \"help\"\n\n---\n\n## 概要\n\nVibeCoder は技術的なコマンドやワークフローを知らなくても、\n自然な日本語で質問するだけで次のアクションが分かります。\n\n---\n\n## 応答パターン\n\n### パターン1: プロジェクトがない場合\n\n> 🎯 **まずはプロジェクトを始めましょう！**\n>\n> **言い方の例：**\n> - 「ブログを作りたい」\n> - 「タスク管理アプリを作りたい」\n> - 「ポートフォリオサイトを作りたい」\n>\n> ざっくりで大丈夫です。やりたいことを教えてください。\n\n### パターン2: Plans.md があるが進行中タスクがない\n\n> 📋 **計画があります。作業を始めましょう！**\n>\n> **現在の計画:**\n> - フェーズ1: 基盤構築\n> - フェーズ2: コア機能\n> - ...\n>\n> **言い方の例：**\n> - 「フェーズ1を始めて」\n> - 「最初のタスクをやって」\n> - 「全部やって」\n\n### パターン3: タスク進行中\n\n> 🔧 **作業中です**\n>\n> **現在のタスク:** {{タスク名}}\n> **進捗:** {{完了数}}/{{全体数}}\n>\n> **言い方の例：**\n> - 「続けて」\n> - 「次のタスク」\n> - 「今どこまで進んだ？」\n\n### パターン4: フェーズ完了後\n\n> ✅ **フェーズが完了しました！**\n>\n> **次にできること：**\n> - 「動作確認して」→ 開発サーバーを起動\n> - 「レビューして」→ コード品質チェック\n> - 「次のフェーズへ」→ 次の作業を開始\n> - 「コミットして」→ 変更を保存\n\n### パターン5: エラー発生時\n\n> ⚠️ **問題が発生しました**\n>\n> **状況:** {{エラーの要約}}\n>\n> **言い方の例：**\n> - 「直して」→ 自動修正を試行\n> - 「説明して」→ 問題の詳細を説明\n> - 「スキップして」→ 次のタスクへ\n\n---\n\n## よく使うフレーズ対応表\n\n| やりたいこと | 言い方 |\n|-------------|--------|\n| プロジェクト開始 | 「〇〇を作りたい」 |\n| 計画を見たい | 「計画を見せて」「今の状況は？」 |\n| 作業を開始 | 「始めて」「作って」「フェーズ1をやって」 |\n| 続きをやる | 「続けて」「次」 |\n| 動作確認 | 「動かして」「見せて」 |\n| コード確認 | 「レビューして」「チェックして」 |\n| 保存する | 「コミットして」「保存して」 |\n| 困った時 | 「どうすればいい？」「助けて」 |\n| 全部任せる | 「全部やって」「おまかせ」 |\n\n---\n\n## コンテキスト判定\n\nこのスキルは以下を確認して適切な応答を選択：\n\n1. **AGENTS.md の存在** → プロジェクトが初期化済みか\n2. **Plans.md の内容** → 計画があるか、進捗状況\n3. **現在のタスク状態** → `cc:WIP` マーカーの有無\n4. **直近のエラー** → 問題が発生しているか\n\n---\n\n## 実装ノート\n\nこのスキルが起動したら：\n\n1. 現在の状態を分析\n2. 適切なパターンを選択\n3. 具体的な「言い方の例」を提示\n4. ユーザーの次のアクションを待つ\n\n**重要**: 技術用語を避け、平易な日本語で説明する\n",
        "skills/video/SKILL.md": "---\nname: video\ndescription: \"Generates product demo videos, architecture explanations, and release note videos. Use when user mentions video generation, product demos, or visual documentation. Requires Remotion setup.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Grep\", \"Glob\", \"Bash\", \"Task\", \"AskUserQuestion\", \"WebFetch\"]\n---\n\n# Video Generation Skills\n\nプロダクト説明動画の自動生成を担当するスキル群です。\n\n---\n\n## 概要\n\n`/generate-video` コマンドの内部で使用されるスキルです。\nコードベース分析 → シナリオ提案 → 並列生成のフローを実行します。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **ベストプラクティス** | See [references/best-practices.md](references/best-practices.md) |\n| **コードベース分析** | See [references/analyzer.md](references/analyzer.md) |\n| **シナリオプランニング** | See [references/planner.md](references/planner.md) |\n| **並列シーン生成** | See [references/generator.md](references/generator.md) |\n\n## Prerequisites\n\n- Remotion がセットアップ済み（`/remotion-setup`）\n- Node.js 18+\n\n## `/generate-video` フロー\n\n```\n/generate-video\n    │\n    ├─[Step 1] 分析（analyzer.md）\n    │   ├─ フレームワーク検出\n    │   ├─ 主要機能検出\n    │   ├─ UIコンポーネント検出\n    │   └─ プロジェクト資産解析（Plans.md, CHANGELOG等）\n    │\n    ├─[Step 2] シナリオ提案（planner.md）\n    │   ├─ 動画タイプ自動判定\n    │   ├─ シーン構成提案\n    │   └─ ユーザー確認\n    │\n    └─[Step 3] 並列生成（generator.md）\n        ├─ シーン並列生成（Task tool）\n        ├─ 統合 + トランジション\n        └─ 最終レンダリング\n```\n\n## 実行手順\n\n1. ユーザーが `/generate-video` を実行\n2. Remotion セットアップ確認\n3. `analyzer.md` でコードベース分析\n4. `planner.md` でシナリオ提案 + ユーザー確認\n5. `generator.md` で並列生成\n6. 完了報告\n\n## 動画タイプ（ファネル別）\n\n| タイプ | ファネル | 長さ目安 | 自動判定条件 | 構成の芯 |\n|--------|----------|----------|--------------|----------|\n| **LP/広告ティザー** | 認知〜興味 | 30-90秒 | 新規プロジェクト | 痛み→結果→CTA |\n| **Introデモ** | 興味→検討 | 2-3分 | UI変更検出 | 1ユースケース完走 |\n| **リリースノート** | 検討→確信 | 1-3分 | CHANGELOG更新 | Before/After重視 |\n| **アーキテクチャ解説** | 確信→決裁 | 5-30分 | 大規模構造変更 | 実運用+証拠 |\n| **オンボーディング** | 継続・活用 | 30秒-数分 | 初回セットアップ | Aha体験への最短パス |\n\n> 詳細: [references/best-practices.md](references/best-practices.md)\n\n## シーンテンプレート\n\n### 90秒ティザー（LP/広告向け）\n\n| 時間 | シーン | 内容 |\n|------|--------|------|\n| 0-5秒 | Hook | 痛み or 望む結果 |\n| 5-15秒 | Problem+Promise | 対象ユーザーと約束 |\n| 15-55秒 | Workflow | 象徴ワークフロー |\n| 55-70秒 | Differentiator | 差別化の根拠 |\n| 70-90秒 | CTA | 次の一手 |\n\n### 3分Introデモ（検討向け）\n\n| 時間 | シーン | 内容 |\n|------|--------|------|\n| 0-10秒 | Hook | 結論+痛み |\n| 10-30秒 | UseCase | ユースケース宣言 |\n| 30-140秒 | Demo | 実画面で完走 |\n| 140-170秒 | Objection | よくある不安1つ潰す |\n| 170-180秒 | CTA | 行動喚起 |\n\n### 共通シーン\n\n| シーン | 推奨時間 | 内容 |\n|--------|----------|------|\n| イントロ | 3-5秒 | ロゴ + タグライン |\n| 機能デモ | 10-30秒 | Playwrightキャプチャ |\n| アーキテクチャ図 | 10-20秒 | Mermaid → アニメーション |\n| CTA | 3-5秒 | URL + 連絡先 |\n\n> 詳細テンプレート: [references/best-practices.md](references/best-practices.md#テンプレート)\n\n## Notes\n\n- Remotion未セットアップの場合は `/remotion-setup` を案内\n- 並列生成数はシーン数に応じて自動調整（max 5）\n- 生成された動画は `out/` ディレクトリに出力\n",
        "skills/video/references/analyzer.md": "# Video Analyzer - コードベース分析エンジン\n\nプロジェクトを自動分析し、動画生成に必要な情報を抽出します。\n\n---\n\n## 概要\n\n`/generate-video` の Step 1 で実行される分析エンジンです。\nコードベースとプロジェクト資産を解析し、最適な動画構成を判定します。\n\n## 分析項目\n\n### 1. フレームワーク検出\n\n| 検出対象 | 判定方法 |\n|---------|---------|\n| Next.js | `next.config.*` の存在 |\n| React | `package.json` の dependencies |\n| Vue | `vue.config.*` または `nuxt.config.*` |\n| Svelte | `svelte.config.*` |\n| Express/Fastify | `package.json` の dependencies |\n\n**実行コマンド**:\n```bash\n# package.json から依存関係を抽出\ncat package.json | jq '.dependencies, .devDependencies'\n\n# 設定ファイルの存在確認\nls -la *.config.* 2>/dev/null\n```\n\n### 2. 主要機能検出\n\n| 機能 | 検出パターン |\n|------|-------------|\n| 認証 | `auth/`, `login/`, `@clerk`, `@auth0`, `supabase` |\n| 決済 | `payment/`, `billing/`, `stripe`, `@stripe` |\n| ダッシュボード | `dashboard/`, `admin/`, `analytics` |\n| API | `api/`, `routes/`, `trpc`, `graphql` |\n| DB | `prisma/`, `drizzle/`, `@supabase` |\n\n**実行コマンド**:\n```bash\n# ディレクトリ構造から機能を推測\nfind src app -type d -name \"auth\" -o -name \"login\" -o -name \"dashboard\" 2>/dev/null\n\n# パッケージから機能を推測\ngrep -E \"clerk|stripe|supabase|prisma\" package.json\n```\n\n### 3. UIコンポーネント検出\n\n| 項目 | 検出方法 |\n|------|---------|\n| ページ数 | `app/**/page.tsx` または `pages/**/*.tsx` のカウント |\n| コンポーネント数 | `components/**/*.tsx` のカウント |\n| UIライブラリ | `shadcn`, `radix`, `chakra`, `mui` の検出 |\n\n**実行コマンド**:\n```bash\n# ページ数カウント\nfind . -name \"page.tsx\" -o -name \"page.jsx\" 2>/dev/null | wc -l\n\n# コンポーネント数カウント\nfind . -path \"*/components/*\" -name \"*.tsx\" 2>/dev/null | wc -l\n```\n\n### 4. プロジェクト資産解析\n\n| 資産 | 用途 |\n|------|------|\n| `package.json` | プロジェクト名、description |\n| `README.md` | プロジェクト概要、タグライン |\n| `Plans.md` | 完了タスク（リリースノート用） |\n| `CHANGELOG.md` | 変更点（リリースノート用） |\n| `.claude/memory/decisions.md` | 技術的意思決定（アーキテクチャ解説用） |\n\n**実行コマンド**:\n```bash\n# プロジェクト情報抽出\ncat package.json | jq '{name, description, version}'\n\n# README の最初の段落を抽出\nhead -20 README.md\n```\n\n---\n\n## 動画タイプ自動判定\n\n### 判定ロジック\n\n```\n分析結果から動画タイプを判定:\n    │\n    ├─ CHANGELOG が最近更新（7日以内）\n    │   └─ → リリースノート動画\n    │\n    ├─ 大きな構造変更（新ディレクトリ追加等）\n    │   └─ → アーキテクチャ解説\n    │\n    ├─ UI変更が多い（コンポーネント追加/変更）\n    │   └─ → プロダクトデモ\n    │\n    └─ 複数条件に該当\n        └─ → 複合動画（ユーザーに確認）\n```\n\n### 判定基準\n\n| タイプ | 条件 |\n|--------|------|\n| **リリースノート** | `git log --since=\"7 days ago\"` に tag/release がある |\n| **アーキテクチャ** | 新しい `src/*/` ディレクトリ、大きなリファクタ |\n| **プロダクトデモ** | UI コンポーネントの追加/変更 |\n| **デフォルト** | プロダクトデモ（最も汎用的） |\n\n---\n\n## 出力フォーマット\n\n分析結果は以下の形式で出力:\n\n```yaml\nproject:\n  name: \"MyAwesomeApp\"\n  description: \"タスク管理を簡単に\"\n  version: \"1.2.0\"\n\nframework:\n  primary: \"Next.js\"\n  ui_library: \"shadcn/ui\"\n\nfeatures:\n  - name: \"認証\"\n    type: \"auth\"\n    path: \"src/app/(auth)/\"\n    provider: \"Clerk\"\n  - name: \"ダッシュボード\"\n    type: \"dashboard\"\n    path: \"src/app/dashboard/\"\n  - name: \"API\"\n    type: \"api\"\n    path: \"src/app/api/\"\n\nstats:\n  pages: 12\n  components: 45\n  api_routes: 8\n\nrecent_changes:\n  changelog_updated: true\n  last_release: \"2026-01-20\"\n  major_changes:\n    - \"認証フロー追加\"\n    - \"ダッシュボード改善\"\n\nrecommended_video_type: \"release-notes\"\nconfidence: 0.85\n```\n\n---\n\n## 実行例\n\n```\n📊 プロジェクト分析中...\n\n✅ 分析完了\n\n| 項目 | 結果 |\n|------|------|\n| プロジェクト名 | MyAwesomeApp |\n| フレームワーク | Next.js 14 |\n| UIライブラリ | shadcn/ui |\n| ページ数 | 12 |\n| コンポーネント数 | 45 |\n\n🔍 検出された機能:\n- 認証（Clerk）\n- ダッシュボード\n- API（8エンドポイント）\n\n📋 最近の変更:\n- v1.2.0 リリース（3日前）\n- 認証フロー追加\n- ダッシュボード改善\n\n🎬 推奨動画タイプ: リリースノート動画\n   理由: 最近のリリースがあり、主要な機能追加があります\n```\n\n---\n\n## Notes\n\n- 分析は非破壊的（ファイルを変更しない）\n- 大規模プロジェクトでも数秒で完了\n- 検出できない機能は手動で追加可能（planner.md で）\n",
        "skills/video/references/best-practices.md": "# SaaS Video Best Practices\n\nSaaS紹介動画のベストプラクティス集です。\n動画の目的・ファネルに応じた最適な構成を選択するためのガイドラインを提供します。\n\n---\n\n## 基本原則\n\n### 1. 画面より先に「誰の何の痛みを消すか」を決める\n\n機能紹介ではなく、視聴者の痛み→解決の確信を最短で作る装置として設計する。\n\n**リスク**: ターゲットが曖昧だと誰にも刺さらない\n\n### 2. 最初の数秒で余計な儀式を捨てる\n\n冒頭でロゴや演出を長く出すと離脱率が上がるため、すぐに本題へ入る。\n音・本題開始の速さを重視。\n\n### 3. 長さは目的で決める\n\n一般に長いほどエンゲージメント率は低下するが、最適な長さは目的次第。\n\n| 長さ | 用途 |\n|------|------|\n| 1-2分 | 冒頭離脱が少ない |\n| 5-10分 | 長めの解説 |\n\n**結論**: 長尺は冒頭設計が命\n\n### 4. CTAは最後に置かない\n\n視聴者の途中離脱を防ぐため、CTAは途中にも置く。\n\n### 5. 見やすい映像は衛生管理\n\n**優先順位**: 音質 > 画面の可読性 > テンポ > 見た目\n\n**重要**: 音が悪いと即離脱\n\n### 6. 字幕・トランスクリプトは必須\n\n字幕は必須要件で、自動生成だけでなく修正も必要。\n\n### 7. 長尺にはチャプター\n\n動画視聴者は飛ばし見をしたいので、チャプター（目次）を付ける。\n\n---\n\n## ファネル別動画タイプ比較\n\n| 目的（ファネル） | 動画タイプ | 長さ目安 | 構成の芯 | 主なKPI |\n|------------------|------------|----------|----------|---------|\n| 認知〜興味 | 超短尺ティザー | 30〜90秒 | 痛み→結果（未来）→\"続きはここ\" | 視聴維持/CTR |\n| 興味→検討 | Intro（概要デモ） | 2〜3分 | 1ユースケースを最短で完走 | デモ申込/トライアル開始 |\n| 検討→確信 | Demo（短尺セールス） | 2〜5分 | 反論の芽を先に潰す | 商談化率/返信率 |\n| 確信→決裁 | Walkthrough / Webinar | 5〜30分 | 実運用の流れ＋証拠 | CVR/問い合わせ |\n| 拡張・効率化 | ハイブリッドデモ | 録画＋Q&A | 録画で標準化→ライブで個別最適 | 成約率/工数削減 |\n| 継続・活用 | オンボーディング | 30秒〜数分（小分け） | 最短のクイックウィン→Aha | Activation/継続率 |\n| サポート | How-to/トラブル | 1〜5分 | 手順を1本1目的で | 問い合わせ削減/自己解決率 |\n\n---\n\n## カテゴリ別ガイド\n\n### LP/広告向け：短尺紹介（30〜90秒）\n\n**目的**: 認知〜興味ファネル向け\n\n**構成アウトライン**:\n- 0–5秒: 痛み or 望む結果\n- 5–20秒: 対象ユーザーと約束\n- 20–60秒: 象徴ワークフロー1本\n- 60–90秒: 次の一手\n\n**避けるべき落とし穴**: 機能羅列・抽象ワード連発\n\n### 検討向け：2〜3分 Introデモ\n\n1ユースケースを完走させ、専門用語を避けて分解しながら説明。\n\n**推奨事項**:\n- 冒頭は短く本題へ\n- 一番刺さる1ケースを選ぶ\n- 途中CTAも設置\n\n### セールス向け：2〜5分デモ\n\n購買決断の次の一手に進めるための短尺セールス向け動画。\n\n**戦略**:\n- 反論トップ3を先回りで潰す\n- 1動画=1業界／職種\n\n### 決裁向け：15〜30分ウォークスルー\n\nより深い理解と意思決定を促す長尺動画。チャプター設計必須。\n\n**キーポイント**:\n- 基本フロー\n- 反論処理\n- 管理/セキュリティの説明\n\n### オンボーディング向け\n\nユーザーが最初の成功体験（Aha）に到達する設計。\n\n**ガイドライン**:\n- 1本で全部教えない\n- 役割別分岐動画\n\n### サポート／ヘルプ動画\n\n動画を唯一の答えにせず、テキストと併用する。\n\n**必須要素**:\n- 動画＋手順テキスト\n- 字幕＋全文トランスクリプト\n\n---\n\n## テンプレート\n\n### 90秒刺す紹介テンプレ\n\n**用途**: LP/広告、認知〜興味ファネル\n\n| 時間 | 内容 | フレーム数(30fps) |\n|------|------|------------------|\n| 0:00–0:05 | 痛み or 望む結果 | 0-150 |\n| 0:05–0:15 | 対象ユーザーと約束 | 150-450 |\n| 0:15–0:55 | 象徴ワークフロー | 450-1650 |\n| 0:55–1:10 | 差別化の根拠 | 1650-2100 |\n| 1:10–1:30 | CTA | 2100-2700 |\n\n**合計**: 90秒 = 2700フレーム\n\n### 3分 Introデモテンプレ\n\n**用途**: 検討向け、興味→検討ファネル\n\n| 時間 | 内容 |\n|------|------|\n| 0:00–0:10 | 結論＋痛み |\n| 0:10–0:30 | ユースケース宣言 |\n| 0:30–2:20 | 実画面で完走 |\n| 2:20–2:50 | よくある不安1つ潰す |\n| 2:50–3:00 | CTA |\n\n### 20分決裁向けウォークスルー\n\n**用途**: 確信→決裁ファネル\n\n| 時間 | 内容 |\n|------|------|\n| 0:00–1:00 | 対象と課題 |\n| 1:00–8:00 | 基本フロー |\n| 8:00–12:00 | 反論トップ2 |\n| 12:00–15:00 | 管理/セキュリティ |\n| 15:00–20:00 | 成功事例＋CTA |\n\n---\n\n## 制作チェックリスト\n\n### 収録前\n\n- [ ] 台本：話すことを削り切る\n- [ ] デモ環境：通知オフ、個人情報除去\n- [ ] 画面：UIの文字が読めるズーム\n\n### 収録中\n\n- [ ] 音：明瞭さ最優先\n- [ ] 照明/映り：最低限\n- [ ] テンポ：操作を迷う瞬間は全カット\n\n### 公開時\n\n- [ ] 字幕：必ず品質修正\n- [ ] トランスクリプト：検索と拾い読み用\n- [ ] 長尺はチャプター必須\n\n---\n\n## 共通の失敗パターン\n\n| 失敗 | 影響 |\n|------|------|\n| 誰向けか曖昧 | 誰にも刺さらない |\n| ロゴ・会社紹介が長い | 冒頭離脱 |\n| 機能全部入り | 焦点がぼける |\n| 字幕なし/雑 | アクセシビリティ低下 |\n| 動画だけ置いて満足 | 効果測定できず |\n| CTAが最後だけ | 途中離脱で見られない |\n\n---\n\n## 推奨3本セット\n\n最短で成果を出すための基本セット:\n\n1. **90秒ティザー** - 認知獲得\n2. **3分 Introデモ** - 検討促進\n3. **15〜25分決裁用ウォークスルー** - 成約支援\n\n**成果**: 獲得→検討→決裁の情報の穴を埋める\n\n---\n\n## Harness での活用\n\n### 動画タイプ自動判定\n\n| Harness検出条件 | 推奨動画タイプ | テンプレート |\n|-----------------|----------------|--------------|\n| 新規プロジェクト | LP/広告向け短尺 | 90秒ティザー |\n| UI変更検出 | Introデモ | 3分テンプレ |\n| CHANGELOG更新 | リリースノート | Before/After重視 |\n| 大規模構造変更 | アーキテクチャ解説 | ウォークスルー |\n\n### シーン構成ガイド\n\n#### 短尺（30-90秒）の場合\n\n```\nHookScene (3秒) → ProblemPromise (7秒) → WorkflowDemo (40-60秒) → Differentiator (10秒) → CTA (10秒)\n```\n\n#### Introデモ（2-3分）の場合\n\n```\nHook (10秒) → UseCase宣言 (20秒) → 実画面デモ (110秒) → 不安解消 (30秒) → CTA (10秒)\n```\n\n#### ウォークスルー（15-30分）の場合\n\n```\n対象と課題 (1分) → 基本フロー (7分) → 反論処理 (4分) → 管理/セキュリティ (3分) → 成功事例+CTA (5分)\n```\n\n---\n\n## References\n\n- [planner.md](planner.md) - シナリオプランニング\n- [generator.md](generator.md) - 並列シーン生成\n- [analyzer.md](analyzer.md) - コードベース分析\n",
        "skills/video/references/generator.md": "# Video Generator - 並列シーン生成エンジン\n\nシナリオに基づいて、マルチエージェントで並列にシーンを生成します。\n\n---\n\n## 概要\n\n`/generate-video` の Step 3 で実行される生成エンジンです。\nplanner.md のシナリオを受けて、各シーンを並列で生成し、最終的に統合します。\n\n## 入力\n\nplanner.md からのシナリオ:\n- シーンリスト（id, name, duration, template, content）\n- 動画設定（resolution, fps）\n\n## 並列生成アーキテクチャ\n\n```\nシナリオ（N シーン）\n    │\n    ├─[並列数決定]\n    │   └─ min(シーン数, 5) を並列数とする\n    │\n    ├─[並列生成フェーズ]\n    │   ├── Agent 1: シーン 1 生成\n    │   ├── Agent 2: シーン 2 生成\n    │   ├── Agent 3: シーン 3 生成\n    │   └── ... (max 5 並列)\n    │\n    ├─[統合フェーズ]\n    │   ├── シーン結合\n    │   ├── トランジション追加\n    │   └── 音声同期（オプション）\n    │\n    └─[レンダリングフェーズ]\n        └── 最終出力（mp4/webm/gif）\n```\n\n---\n\n## 並列数決定ロジック\n\n| シーン数 | 並列数 | 理由 |\n|---------|--------|------|\n| 1-2 | 1-2 | オーバーヘッドが利益を上回る |\n| 3-4 | 3 | 最適なバランス |\n| 5+ | 5 | これ以上はリソース競合 |\n\n**実装**:\n```javascript\nconst parallelCount = Math.min(scenes.length, 5);\n```\n\n---\n\n## Task Tool による並列起動\n\n### シーン生成エージェント起動\n\n```\n各シーンに対して Task tool を起動:\n\nTask:\n  subagent_type: \"video-scene-generator\"\n  run_in_background: true\n  prompt: |\n    以下のシーンを Remotion コンポジションとして生成してください。\n\n    シーン情報:\n    - ID: {scene.id}\n    - 名前: {scene.name}\n    - 時間: {scene.duration}秒\n    - テンプレート: {scene.template}\n    - 内容: {scene.content}\n\n    出力先: remotion/scenes/{scene.name}.tsx\n\n    完了したら以下を報告:\n    - ファイルパス\n    - 実際の duration (フレーム数)\n    - 使用したコンポーネント\n```\n\n### 進捗モニタリング\n\n```\n🎬 並列生成中... (3/5 完了)\n\n├── [Agent 1] intro ✅ (3秒)\n├── [Agent 2] auth-demo ✅ (12秒)\n├── [Agent 3] dashboard ⏳ 生成中...\n├── [Agent 4] features 🔜 待機中\n└── [Agent 5] cta 🔜 待機中\n```\n\n### 結果収集\n\n```\nTaskOutput で各エージェントの結果を収集:\n\n結果:\n  - scene_id: 1\n    file: \"remotion/scenes/intro.tsx\"\n    duration_frames: 150\n    status: \"success\"\n\n  - scene_id: 2\n    file: \"remotion/scenes/auth-demo.tsx\"\n    duration_frames: 450\n    status: \"success\"\n    notes: \"Playwright capture included\"\n```\n\n---\n\n## シーン生成テンプレート\n\n### intro テンプレート\n\n```tsx\n// remotion/scenes/intro.tsx\nimport { AbsoluteFill, useCurrentFrame, interpolate } from \"remotion\";\nimport { FadeIn } from \"../components/FadeIn\";\n\nexport const IntroScene: React.FC<{\n  title: string;\n  tagline: string;\n}> = ({ title, tagline }) => {\n  const frame = useCurrentFrame();\n  const opacity = interpolate(frame, [0, 30], [0, 1]);\n\n  return (\n    <AbsoluteFill style={{ backgroundColor: \"#000\", opacity }}>\n      <FadeIn durationInFrames={30}>\n        <h1>{title}</h1>\n        <p>{tagline}</p>\n      </FadeIn>\n    </AbsoluteFill>\n  );\n};\n\nexport const DURATION = 150; // 5秒 @ 30fps\n```\n\n### ui-demo テンプレート（Playwright連携）\n\n```tsx\n// remotion/scenes/ui-demo.tsx\nimport { AbsoluteFill, Img, Sequence } from \"remotion\";\n\nexport const UIDemoScene: React.FC<{\n  screenshots: string[];\n  duration: number;\n}> = ({ screenshots, duration }) => {\n  const framePerScreenshot = Math.floor(duration / screenshots.length);\n\n  return (\n    <AbsoluteFill>\n      {screenshots.map((src, i) => (\n        <Sequence from={i * framePerScreenshot} durationInFrames={framePerScreenshot}>\n          <Img src={src} style={{ width: \"100%\", height: \"100%\" }} />\n        </Sequence>\n      ))}\n    </AbsoluteFill>\n  );\n};\n```\n\n### cta テンプレート\n\n```tsx\n// remotion/scenes/cta.tsx\nimport { AbsoluteFill, useCurrentFrame, interpolate } from \"remotion\";\n\nexport const CTAScene: React.FC<{\n  url: string;\n  text: string;\n}> = ({ url, text }) => {\n  const frame = useCurrentFrame();\n  const scale = interpolate(frame, [0, 15], [0.8, 1], {\n    extrapolateRight: \"clamp\",\n  });\n\n  return (\n    <AbsoluteFill style={{ backgroundColor: \"#1a1a1a\" }}>\n      <div style={{ transform: `scale(${scale})` }}>\n        <h2>{text}</h2>\n        <p>{url}</p>\n      </div>\n    </AbsoluteFill>\n  );\n};\n\nexport const DURATION = 150; // 5秒 @ 30fps\n```\n\n---\n\n## 統合フェーズ\n\n### シーン結合\n\n```tsx\n// remotion/FullVideo.tsx\nimport { Composition, Series } from \"remotion\";\nimport { IntroScene } from \"./scenes/intro\";\nimport { UIDemoScene } from \"./scenes/ui-demo\";\nimport { CTAScene } from \"./scenes/cta\";\n\nexport const FullVideo: React.FC = () => {\n  return (\n    <Series>\n      <Series.Sequence durationInFrames={150}>\n        <IntroScene title=\"MyApp\" tagline=\"タスク管理を簡単に\" />\n      </Series.Sequence>\n      <Series.Sequence durationInFrames={450}>\n        <UIDemoScene screenshots={[...]} duration={450} />\n      </Series.Sequence>\n      <Series.Sequence durationInFrames={150}>\n        <CTAScene url=\"https://myapp.com\" text=\"今すぐ試す\" />\n      </Series.Sequence>\n    </Series>\n  );\n};\n```\n\n### トランジション追加\n\n```tsx\n// トランジションコンポーネント\nimport { TransitionSeries, linearTiming } from \"@remotion/transitions\";\nimport { fade } from \"@remotion/transitions/fade\";\n\n<TransitionSeries>\n  <TransitionSeries.Sequence durationInFrames={150}>\n    <IntroScene {...} />\n  </TransitionSeries.Sequence>\n  <TransitionSeries.Transition\n    presentation={fade()}\n    timing={linearTiming({ durationInFrames: 15 })}\n  />\n  <TransitionSeries.Sequence durationInFrames={450}>\n    <UIDemoScene {...} />\n  </TransitionSeries.Sequence>\n</TransitionSeries>\n```\n\n---\n\n## レンダリングフェーズ\n\n### コマンド実行\n\n```bash\n# MP4 レンダリング\nnpx remotion render remotion/index.ts FullVideo out/video.mp4\n\n# GIF レンダリング（短い動画向け）\nnpx remotion render remotion/index.ts FullVideo out/video.gif\n\n# WebM レンダリング（Web向け）\nnpx remotion render remotion/index.ts FullVideo out/video.webm --codec=vp8\n```\n\n### 出力オプション\n\n| フォーマット | 推奨用途 | オプション |\n|-------------|---------|-----------|\n| MP4 | 汎用、SNS | `--codec=h264` |\n| WebM | Web埋め込み | `--codec=vp8` |\n| GIF | 短いループ | 15秒以下推奨 |\n\n---\n\n## 完了報告\n\n```markdown\n✅ **動画生成完了**\n\n📁 **出力ファイル**:\n- `out/video.mp4` (45秒, 1080p, 12.3MB)\n\n📊 **生成統計**:\n| 項目 | 値 |\n|------|-----|\n| シーン数 | 4 |\n| 並列エージェント数 | 3 |\n| 生成時間 | 45秒 |\n| レンダリング時間 | 30秒 |\n\n🎬 **プレビュー**:\n- Studio: `npm run remotion` → http://localhost:3000\n- ファイル: `open out/video.mp4`\n```\n\n---\n\n## エラーハンドリング\n\n### シーン生成失敗\n\n```\n⚠️ シーン生成エラー\n\nシーン「auth-demo」の生成に失敗しました。\n原因: Playwright キャプチャ失敗 - アプリが起動していません\n\n対処:\n1. アプリを起動してください: `npm run dev`\n2. 再生成: 「auth-demo を再生成」\n3. スキップ: 「このシーンをスキップ」\n```\n\n### レンダリング失敗\n\n```\n⚠️ レンダリングエラー\n\n原因: メモリ不足\n\n対処:\n1. 並列数を減らす: `--concurrency 2`\n2. 解像度を下げる: 720p で再試行\n3. シーンを分割: 長いシーンを短く分割\n```\n\n---\n\n## Notes\n\n- 並列生成は独立したシーンに対してのみ有効\n- Playwright キャプチャは事前にアプリが起動している必要がある\n- 大きな動画（3分以上）は分割レンダリングを推奨\n",
        "skills/video/references/planner.md": "# Video Planner - シナリオプランナー\n\n分析結果からシーン構成を自動提案し、ユーザーと確認・調整を行います。\n\n---\n\n## 概要\n\n`/generate-video` の Step 2 で実行されるシナリオプランナーです。\nanalyzer.md の出力を受けて、最適なシーン構成を提案します。\n\n> **重要**: シーン構成は [best-practices.md](best-practices.md) のファネル別ガイドラインに従って設計すること\n\n## 入力\n\nanalyzer.md からの分析結果:\n- プロジェクト情報（名前、description）\n- 検出された機能リスト\n- 推奨動画タイプ\n- 最近の変更点\n\n---\n\n## ファネル別テンプレート選択\n\n### Step 0: 目的の確認（必須）\n\n動画の目的を確認し、適切なテンプレートを選択する。\n\n| 目的（ファネル） | 動画タイプ | 長さ目安 | 構成の芯 |\n|------------------|------------|----------|----------|\n| 認知〜興味 | LP/広告ティザー | 30-90秒 | 痛み→結果→CTA |\n| 興味→検討 | Introデモ | 2-3分 | 1ユースケース完走 |\n| 検討→確信 | Demo/リリースノート | 2-5分 | 反論を先に潰す |\n| 確信→決裁 | ウォークスルー | 5-30分 | 実運用+証拠 |\n| 継続・活用 | オンボーディング | 30秒-数分 | Aha体験への最短パス |\n\n### 90秒ティザーテンプレート\n\n**用途**: LP/広告、認知〜興味ファネル\n\n```\n0:00-0:05 (150f)  → HookScene: 痛み or 望む結果\n0:05-0:15 (300f)  → ProblemPromise: 対象ユーザーと約束\n0:15-0:55 (1200f) → WorkflowDemo: 象徴ワークフロー\n0:55-1:10 (450f)  → Differentiator: 差別化の根拠\n1:10-1:30 (600f)  → CTA: 次の一手\n```\n\n### 3分Introデモテンプレート\n\n**用途**: 検討向け、興味→検討ファネル\n\n```\n0:00-0:10 (300f)  → Hook: 結論+痛み\n0:10-0:30 (600f)  → UseCase: ユースケース宣言\n0:30-2:20 (3300f) → Demo: 実画面で完走\n2:20-2:50 (900f)  → Objection: よくある不安1つ潰す\n2:50-3:00 (300f)  → CTA: 行動喚起\n```\n\n### 20分ウォークスルーテンプレート\n\n**用途**: 決裁向け、確信→決裁ファネル\n\n```\n0:00-1:00   → Intro: 対象と課題\n1:00-8:00   → BasicFlow: 基本フロー\n8:00-12:00  → Objections: 反論トップ2\n12:00-15:00 → Security: 管理/セキュリティ\n15:00-20:00 → CaseStudy+CTA: 成功事例＋CTA\n```\n\n## シーンテンプレート\n\n### 共通シーン\n\n| シーン | 推奨時間 | 内容 | 必須 |\n|--------|----------|------|------|\n| **イントロ** | 3-5秒 | ロゴ + タグライン + フェードイン | ✅ |\n| **CTA** | 3-5秒 | URL + 連絡先 + フェードアウト | ✅ |\n\n### プロダクトデモ用シーン\n\n| シーン | 推奨時間 | 内容 |\n|--------|----------|------|\n| **機能紹介** | 5-10秒 | 機能名 + 1行説明 |\n| **UIデモ** | 10-30秒 | Playwrightキャプチャ |\n| **ハイライト** | 5-10秒 | 主要な特徴を強調 |\n\n### アーキテクチャ解説用シーン\n\n| シーン | 推奨時間 | 内容 |\n|--------|----------|------|\n| **概要図** | 5-10秒 | 全体構成のMermaid図 |\n| **詳細解説** | 10-20秒 | 各コンポーネントにズーム |\n| **データフロー** | 10-15秒 | シーケンス図アニメーション |\n\n### リリースノート用シーン\n\n| シーン | 推奨時間 | 内容 |\n|--------|----------|------|\n| **バージョン表示** | 3-5秒 | vX.Y.Z + リリース日 |\n| **変更点リスト** | 5-15秒 | Added/Changed/Fixed のアニメーション |\n| **Before/After** | 10-20秒 | UI変更のサイドバイサイド比較 |\n| **新機能デモ** | 10-30秒 | 追加機能のUIデモ |\n\n---\n\n## シナリオ生成ロジック\n\n### Step 1: 動画タイプ別テンプレート選択\n\n```\n推奨動画タイプに基づいてベーステンプレートを選択:\n    │\n    ├─ LP/広告ティザー（30-90秒）\n    │   └─ Hook → ProblemPromise → WorkflowDemo → Differentiator → CTA\n    │\n    ├─ Introデモ（2-3分）\n    │   └─ Hook → UseCase宣言 → 実画面Demo → Objection → CTA\n    │\n    ├─ リリースノート（1-3分）\n    │   └─ Hook → バージョン → Before/After → 新機能Demo → CTA\n    │\n    ├─ アーキテクチャ解説（5-30分）\n    │   └─ Intro → 概要図 → 詳細解説×N → データフロー → 管理/セキュリティ → CTA\n    │\n    └─ オンボーディング（30秒-数分）\n        └─ Welcome → クイックウィン → 次のステップ\n```\n\n**重要な原則**:\n- 冒頭でロゴや会社紹介を長く出さない（離脱防止）\n- CTAは最後だけでなく途中にも配置\n- 機能羅列ではなく「痛み→解決」のストーリー\n\n### Step 2: 検出機能からシーンを生成\n\n```python\n# 擬似コード\nfor feature in detected_features:\n    if feature.type == \"auth\":\n        add_scene(\"認証フローデモ\", duration=15, source=\"playwright\")\n    elif feature.type == \"dashboard\":\n        add_scene(\"ダッシュボード紹介\", duration=20, source=\"playwright\")\n    elif feature.type == \"api\":\n        add_scene(\"API概要\", duration=10, source=\"mermaid\")\n```\n\n### Step 3: 時間配分の最適化\n\n| 動画長 | 推奨用途 | シーン数目安 |\n|--------|----------|-------------|\n| 15秒 | SNS広告 | 3-4 |\n| 30秒 | ショート動画 | 5-6 |\n| 60秒 | 標準デモ | 8-10 |\n| 2-3分 | 詳細解説 | 15-20 |\n\n---\n\n## ユーザー確認フロー\n\n### 提案表示\n\n```markdown\n🎬 シナリオプラン\n\n**動画タイプ**: プロダクトデモ\n**合計時間**: 45秒\n\n| # | シーン | 時間 | 内容 | ソース |\n|---|--------|------|------|--------|\n| 1 | イントロ | 5秒 | MyApp - タスク管理を簡単に | テンプレート |\n| 2 | 認証フロー | 15秒 | ログイン画面のデモ | Playwright |\n| 3 | ダッシュボード | 20秒 | メイン機能の紹介 | Playwright |\n| 4 | CTA | 5秒 | myapp.com | テンプレート |\n\nこの構成でよろしいですか？\n1. OK、生成開始\n2. 編集したい\n3. キャンセル\n```\n\n### AskUserQuestion 実装\n\n```\nAskUserQuestion:\n  question: \"このシナリオで動画を生成しますか？\"\n  header: \"シナリオ確認\"\n  options:\n    - label: \"OK、生成開始\"\n      description: \"このシーン構成で動画を生成します\"\n    - label: \"編集したい\"\n      description: \"シーンの追加/削除/変更を行います\"\n    - label: \"キャンセル\"\n      description: \"動画生成を中止します\"\n```\n\n### 編集モード\n\nユーザーが「編集したい」を選択した場合:\n\n```markdown\n📝 シナリオ編集\n\n以下のコマンドで編集できます：\n\n- **追加**: 「機能Xのデモを追加」\n- **削除**: 「シーン2を削除」\n- **変更**: 「イントロを3秒に短縮」\n- **入替**: 「シーン2と3を入れ替え」\n- **完了**: 「これでOK」\n\n何を編集しますか？\n```\n\n---\n\n## 出力フォーマット\n\nplanner.md の出力（generator.md への入力）:\n\n```yaml\nvideo:\n  type: \"product-demo\"\n  total_duration: 45\n  resolution: \"1080p\"\n  fps: 30\n\nscenes:\n  - id: 1\n    name: \"intro\"\n    duration: 5\n    template: \"intro\"\n    content:\n      title: \"MyApp\"\n      tagline: \"タスク管理を簡単に\"\n      logo: \"public/logo.svg\"\n\n  - id: 2\n    name: \"auth-demo\"\n    duration: 15\n    template: \"ui-demo\"\n    source: \"playwright\"\n    content:\n      url: \"http://localhost:3000/login\"\n      actions:\n        - click: \"[data-testid=email-input]\"\n        - type: \"user@example.com\"\n        - click: \"[data-testid=login-button]\"\n\n  - id: 3\n    name: \"dashboard\"\n    duration: 20\n    template: \"ui-demo\"\n    source: \"playwright\"\n    content:\n      url: \"http://localhost:3000/dashboard\"\n      actions:\n        - wait: 1000\n        - scroll: \"down\"\n\n  - id: 4\n    name: \"cta\"\n    duration: 5\n    template: \"cta\"\n    content:\n      url: \"https://myapp.com\"\n      text: \"今すぐ試す\"\n```\n\n---\n\n## Notes\n\n- シーン数が多すぎる場合は自動的に優先度の低いものを提案から除外\n- ユーザーが手動でシーンを追加することも可能\n- Playwrightソースのシーンはアプリが起動している必要がある\n",
        "skills/workflow-guide/SKILL.md": "---\nname: workflow-guide\ndescription: \"Provides guidance on Cursor ↔ Claude Code 2-agent workflow. Use when user asks about workflow, collaboration, or process. Do NOT load for: implementation work, workflow setup, or executing handoffs.\"\nallowed-tools: [\"Read\"]\nuser-invocable: false\n---\n\n# Workflow Guide Skill\n\nCursor ↔ Claude Code 2エージェントワークフローのガイダンスを提供するスキル。\n\n---\n\n## トリガーフレーズ\n\nこのスキルは以下のフレーズで起動します：\n\n- 「ワークフローについて教えて」\n- 「Cursor との連携方法は？」\n- 「作業の流れを教えて」\n- 「どうやって進めればいい？」\n- \"how does the workflow work?\"\n- \"explain 2-agent workflow\"\n\n---\n\n## 概要\n\nこのスキルは、Cursor（PM）と Claude Code（Worker）の役割分担と連携方法を説明します。\n\n---\n\n## 2エージェントワークフロー\n\n### 役割分担\n\n| エージェント | 役割 | 責務 |\n|-------------|------|------|\n| **Cursor** | PM（プロジェクトマネージャー） | タスク割り当て、レビュー、本番デプロイ判断 |\n| **Claude Code** | Worker（作業者） | 実装、テスト、CI修正、staging デプロイ |\n\n### ワークフロー図\n\n```\n┌─────────────────────────────────────────────────────────┐\n│                    Cursor (PM)                          │\n│  ・タスクを Plans.md に追加                              │\n│  ・Claude Code に作業を依頼（/handoff-to-claude）            │\n│  ・完了報告をレビュー                                    │\n│  ・本番デプロイの判断                                    │\n└─────────────────────┬───────────────────────────────────┘\n                      │ タスク依頼\n                      ▼\n┌─────────────────────────────────────────────────────────┐\n│                  Claude Code (Worker)                   │\n│  ・/work でタスク実行（並列実行対応）                   │\n│  ・実装 → テスト → コミット                             │\n│  ・CI 失敗時は自動修正（3回まで）                        │\n│  ・/handoff-to-cursor で完了報告                        │\n└─────────────────────┬───────────────────────────────────┘\n                      │ 完了報告\n                      ▼\n┌─────────────────────────────────────────────────────────┐\n│                    Cursor (PM)                          │\n│  ・変更内容を確認                                        │\n│  ・staging 動作確認                                      │\n│  ・本番デプロイ実行（承認後）                            │\n└─────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Plans.md によるタスク管理\n\n### マーカー一覧\n\n| マーカー | 意味 | 設定者 |\n|---------|------|--------|\n| `pm:依頼中` | PM から依頼（互換: cursor:依頼中） | PM（Cursor/PM Claude） |\n| `cc:TODO` | Claude Code 未着手 | どちらでも |\n| `cc:WIP` | Claude Code 作業中 | Claude Code |\n| `cc:完了` | Claude Code 完了 | Claude Code |\n| `pm:確認済` | PM 確認完了（互換: cursor:確認済） | PM（Cursor/PM Claude） |\n| `cursor:依頼中` | （互換）pm:依頼中 と同義 | Cursor |\n| `cursor:確認済` | （互換）pm:確認済 と同義 | Cursor |\n| `blocked` | ブロック中 | どちらでも |\n\n### タスクの状態遷移\n\n```\npm:依頼中 → cc:WIP → cc:完了 → pm:確認済\n```\n\n---\n\n## 主要コマンド\n\n### Claude Code 側\n\n| コマンド | 用途 |\n|---------|------|\n| `/harness-init` | プロジェクトセットアップ |\n| `/plan-with-agent` | 計画・タスク分解 |\n| `/work` | タスク実行（並列実行対応） |\n| `/handoff-to-cursor` | 完了報告（Cursor PMへ） |\n| `/sync-status` | 状態確認 |\n\n### スキル（会話で自動起動）\n\n| スキル | トリガー例 |\n|--------|-----------|\n| `handoff-to-pm` | 「PMに完了報告」 |\n| `handoff-to-impl` | 「実装役に渡して」 |\n\n### Cursor 側（参考）\n\n| コマンド | 用途 |\n|---------|------|\n| `/handoff-to-claude` | Claude Code にタスク依頼 |\n| `/review-cc-work` | 完了報告のレビュー |\n\n---\n\n## CI/CD ルール\n\n### Claude Code の責務範囲\n\n- ✅ staging デプロイまで\n- ✅ CI 失敗時の自動修正（3回まで）\n- ❌ 本番デプロイは禁止\n\n### 3回ルール\n\nCI が 3回連続で失敗した場合：\n1. 自動修正を中止\n2. エスカレーションレポートを生成\n3. Cursor に判断を委ねる\n\n---\n\n## よくある質問\n\n### Q: Cursor がいない場合は？\n\nA: 一人で作業する場合も、Plans.md でタスク管理することを推奨します。\n本番デプロイは手動で慎重に行ってください。\n\n### Q: タスクが不明確な場合は？\n\nA: Cursor に確認を依頼するか、`/sync-status` で現状を整理してください。\n\n### Q: CI が何度も失敗する場合は？\n\nA: 3回以上は自動修正せず、Cursor にエスカレーションしてください。\n\n---\n\n## 関連ドキュメント\n\n- AGENTS.md - 詳細な役割分担\n- CLAUDE.md - Claude Code 固有の設定\n- Plans.md - タスク管理ファイル\n",
        "skills/workflow-guide/examples/typical-workflow.md": "# 典型的なワークフロー例\n\n2エージェントワークフローの実際の流れ。\n\n---\n\n## 例1: 新機能開発\n\n### Phase 1: PM（Cursor）がタスクを作成\n\n```markdown\n# Plans.md\n\n## 🟡 未着手のタスク\n\n- [ ] ユーザープロフィール編集機能 `pm:依頼中`\n  - 名前、メール、アバター画像の編集\n  - バリデーション付き\n  - 変更履歴の保存\n```\n\n**PM の発言**: 「Claude Code にプロフィール編集機能をお願いします」\n\n---\n\n### Phase 2: Claude Code が作業開始\n\n```bash\n# Claude Code で実行\n/work\n```\n\n**Claude Code の作業**:\n1. Plans.md を読み込み\n2. `pm:依頼中` タスクを検出\n3. マーカーを `cc:WIP` に更新\n4. 実装開始\n5. `/harness-review` で品質レビュー\n6. 指摘があれば修正 → 再レビュー（ループ、最大3回）\n7. Review OK → Auto-commit\n\n```markdown\n# Plans.md（更新後）\n\n## 🔴 進行中のタスク\n\n- [ ] ユーザープロフィール編集機能 `cc:WIP`\n  - 名前、メール、アバター画像の編集\n  - バリデーション付き\n  - 変更履歴の保存\n  - 関連ファイル:\n    - `src/components/ProfileForm.tsx`\n    - `src/lib/api/profile.ts`\n```\n\n---\n\n### Phase 3: Claude Code が完了報告（2-Agent のみ）\n\nReview OK かつ Auto-commit 完了後、2-Agent モードでは `/handoff-to-cursor` を実行して PM に報告する。\n\n> **Solo モードでは handoff は不要** — Review OK → Auto-commit で /work は完了。\n\n```bash\n# Claude Code で実行（2-Agent モードのみ）\n/handoff-to-cursor\n```\n\n**生成されるレポート**:\n\n```markdown\n## 📋 完了報告: ユーザープロフィール編集機能\n\n### 実装内容\n- ProfileForm コンポーネント作成\n- プロフィール API エンドポイント\n- Zod によるバリデーション\n- 変更履歴テーブル追加\n\n### 変更ファイル\n- src/components/ProfileForm.tsx (+150 lines)\n- src/lib/api/profile.ts (+80 lines)\n- src/lib/validations/profile.ts (+25 lines)\n- prisma/schema.prisma (+10 lines)\n\n### レビュー結果\n✅ harness-review APPROVE（Critical/High 指摘なし）\n\n### テスト結果\n✅ 全テスト合格 (12/12)\n\n### 次のアクション\n- [ ] staging 環境で動作確認\n- [ ] デザインレビュー\n```\n\n---\n\n### Phase 4: PM が確認\n\n```markdown\n# Plans.md（PM 更新後）\n\n## 🟢 完了タスク\n\n- [x] ユーザープロフィール編集機能 `pm:確認済` (2024-01-15)\n```\n\n---\n\n## 例2: バグ修正の緊急対応\n\n### PM からの緊急依頼\n\n```markdown\n## 🟡 未着手のタスク\n\n- [ ] 🔥 【緊急】ログインエラー修正 `pm:依頼中`\n  - 症状: 特定ユーザーがログインできない\n  - エラー: \"Invalid token format\"\n  - 優先度: 最優先\n```\n\n### Claude Code の対応\n\n1. `/work` で着手\n2. エラーログ調査\n3. 原因特定・修正\n4. テスト追加\n5. `/harness-review` でレビュー（指摘あれば修正→再レビュー）\n6. Review OK → Auto-commit\n7. `/handoff-to-cursor` で完了報告（2-Agent のみ。Solo では省略）\n\n---\n\n## 例3: CI 失敗時の自動修正\n\n### CI が失敗\n\n```\nGitHub Actions: ❌ Build failed\n- TypeScript error in src/utils/date.ts:45\n```\n\n### Claude Code の自動対応\n\n1. エラー検出\n2. 型エラー修正\n3. 再コミット・プッシュ\n\n**3回失敗した場合**:\n\n```markdown\n## ⚠️ CI エスカレーション\n\n3回修正を試みましたが解決できませんでした。\n\n### 試した修正\n1. 型アノテーション追加 → 失敗\n2. 型定義ファイル更新 → 失敗\n3. tsconfig 調整 → 失敗\n\n### 推定原因\n外部ライブラリの型定義が古い可能性\n\n### 推奨アクション\n- [ ] @types/xxx を最新版に更新\n- [ ] ライブラリ自体のバージョン確認\n```\n\n---\n\n## 例4: 並列タスク実行\n\n### 複数タスクがある場合\n\n```markdown\n## 🟡 未着手のタスク\n\n- [ ] ヘッダーコンポーネントのリファクタリング `cc:TODO`\n- [ ] フッターコンポーネントのリファクタリング `cc:TODO`\n- [ ] テスト追加: ユーティリティ関数 `cc:TODO`\n```\n\n### /work 実行時\n\nClaude Code が並列実行可能か判断:\n- 独立したタスク → 並列実行\n- 依存関係あり → 直列実行\n\n```\n🚀 並列実行開始\n├─ Agent 1: ヘッダーリファクタリング\n├─ Agent 2: フッターリファクタリング\n└─ Agent 3: テスト追加\n```\n",
        "skills/workflow-guide/references/commands.md": "# コマンドリファレンス\n\n2エージェントワークフローで使用するコマンドの詳細。\n\n---\n\n## Claude Code 側コマンド\n\n### /harness-init\n\nプロジェクトの初期セットアップ。\n\n```\n/harness-init\n```\n\n**生成されるファイル**:\n- Plans.md - タスク管理\n- AGENTS.md - 役割分担定義\n- CLAUDE.md - Claude Code 設定\n- .claude/commands/ - Cursor 連携コマンド\n\n---\n\n### /plan-with-agent\n\nタスクの計画・分解。\n\n```\n/plan-with-agent [タスク説明]\n```\n\n**例**:\n```\n/plan-with-agent ユーザー認証機能を実装したい\n```\n\n**出力**: Plans.md にタスクが追加される\n\n---\n\n### /work\n\nPlans.md のタスクを実行。\n\n```\n/work\n```\n\n**機能**:\n- `cc:TODO` または `pm:依頼中` のタスクを自動検出\n- 複数タスクの並列実行に対応\n- 完了時に `cc:完了` に自動更新\n\n---\n\n### /sync-status\n\n現在の状態サマリーを出力。\n\n```\n/sync-status\n```\n\n**出力例**:\n```\n📊 現在の状態\n- 進行中: 2件\n- 未着手: 5件\n- 完了（確認待ち）: 1件\n```\n\n---\n\n### /handoff-to-cursor\n\nCursor PM への完了報告。\n\n```\n/handoff-to-cursor\n```\n\n**含まれる情報**:\n- 完了したタスク一覧\n- 変更されたファイル\n- テスト結果\n- 次のアクション提案\n\n---\n\n## Cursor 側コマンド（参考）\n\n### /handoff-to-claude\n\nClaude Code へのタスク依頼。\n\n### /review-cc-work\n\nClaude Code の完了報告をレビュー。\n承認できない場合（request_changes）は Plans.md を更新し、**`/claude-code-harness/handoff-to-claude` で修正依頼文を生成してそのまま渡す**。\n\n---\n\n## スキル（会話で自動起動）\n\n### handoff-to-pm\n\n**トリガー**: 「PMに完了報告」「作業完了を報告」\n\nWorker → PM への完了報告を生成。\n\n### handoff-to-impl\n\n**トリガー**: 「実装役に渡して」「Claude Code に依頼」\n\nPM → Worker へのタスク依頼を整形。\n\n---\n\n## コマンド使用フロー\n\n```\n[セッション開始]\n    │\n    ▼\n/sync-status  ←── 現状確認\n    │\n    ▼\n/work  ←── タスク実行\n    │\n    ▼\n/handoff-to-cursor  ←── 完了報告\n    │\n    ▼\n[セッション終了]\n```\n",
        "skills/workflow/SKILL.md": "---\nname: workflow\ndescription: \"Manages workflow transitions including handoffs between PM and implementation roles, and auto-fixes review comments. Use when user mentions handoffs, reporting to PM, handing off to implementation, completion reports, or auto-fix. Do not use for 2-Agent setup—use 2agent skill instead.\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Workflow Skills\n\nPM-実装役間のハンドオフとレビュー指摘の自動修正を担当するスキル群です。\n\n## 機能詳細\n\n| 機能 | 詳細 |\n|------|------|\n| **レビュー指摘自動修正** | See [references/auto-fixing.md](references/auto-fixing.md) |\n| **PM→実装役ハンドオフ** | See [references/handoff-to-impl.md](references/handoff-to-impl.md) |\n| **実装役→PM完了報告** | See [references/handoff-to-pm.md](references/handoff-to-pm.md) |\n\n## 実行手順\n\n1. ユーザーのリクエストを分類\n2. 上記の「機能詳細」から適切な参照ファイルを読む\n3. その内容に従って実行\n",
        "skills/workflow/references/auto-fixing.md": "---\nname: auto-fix\ndescription: \"レビュー指摘事項の自動修正。コードレビューで検出された問題を自動修正したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Auto-Fix Skill\n\n`/harness-review`で検出された問題を自動的に修正するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「レビュー指摘を自動修正して」\n- 「指摘された問題を直して」\n- 「セキュリティ問題を修正して」\n- 「パフォーマンス問題を改善して」\n\n---\n\n## 機能\n\n- セキュリティ脆弱性の修正\n- パフォーマンス問題の改善\n- コード品質の向上\n- アクセシビリティ対応の追加\n\n---\n\n## 実行フロー\n\n1. 直近のレビュー結果を読み込み\n2. 修正可能な問題を特定\n3. 修正内容をプレビュー\n4. ユーザー承認後に修正を適用\n5. 修正レポートを生成\n",
        "skills/workflow/references/execute-commit.md": "---\nname: execute-commit\ndescription: \"Execute git commit based on commit_strategy (task/phase/all). Uses commit-judgment-logic to determine if commit is ready.\"\nallowed-tools: [\"Read\", \"Bash\", \"Grep\"]\n---\n\n# Execute Commit\n\n`commit_strategy`に応じて適切なタイミングで`git commit`を実行するスキル。\n\n---\n\n## 入力\n\n- **commit_strategy**: `task` / `phase` / `all`\n- **worker_results**: Phase1のtask-worker実行結果\n- **review_result**: Phase2のレビュー結果（オプション）\n- **changed_files**: 変更されたファイルのリスト\n\n---\n\n## 出力\n\n```json\n{\n  \"committed\": true,\n  \"commit_hash\": \"abc1234\",\n  \"commit_message\": \"feat(components): add Header, Footer, Sidebar components\",\n  \"files_committed\": 5,\n  \"strategy_used\": \"phase\"\n}\n```\n\n---\n\n## commit_strategy別の動作\n\n### `task`（デフォルト）\n\n各タスク完了時に個別commit（`run-task-workers`で実行）：\n\n```bash\n# 各task-workerがcommit_readyを返した時点でcommit\ngit add src/components/Header.tsx\ngit commit -m \"feat(components): add Header component\"\n```\n\n**実行タイミング**: Phase1の各task-worker完了時（このスキルでは実行しない）\n\n### `phase`\n\nレビュー完了後にまとめてcommit：\n\n```bash\n# Phase2完了時（クロスレビュー後）\ngit add src/components/Header.tsx src/components/Footer.tsx src/components/Sidebar.tsx\ngit commit -m \"feat(components): add Header, Footer, Sidebar components\"\n```\n\n**実行タイミング**: Phase2完了後（Phase3開始時）\n\n### `all`\n\n全レビュー完了後に1回だけcommit：\n\n```bash\n# Phase3開始時（Phase1+Phase2の全変更）\ngit add .\ngit commit -m \"feat(components): add Header, Footer, Sidebar components\n\n- Add responsive Header with navigation\n- Add Footer with copyright and links\n- Add collapsible Sidebar for mobile\n\nCo-Authored-By: Claude <noreply@anthropic.com>\"\n```\n\n**実行タイミング**: Phase3完了時（Phase4開始前）\n\n---\n\n## 実行手順\n\n### Step 1: commit_strategyの確認\n\n```bash\n# ワークフロー変数から取得\n# commit_strategy: \"task\" | \"phase\" | \"all\"\n```\n\n### Step 2: コミット準備の確認\n\n#### 2.1: 変更ファイルの確認\n\n```bash\n# git statusで変更ファイルを確認\ngit status --short\n\n# 変更があることを確認\nif [ -z \"$(git status --porcelain)\" ]; then\n  echo \"変更がありません。コミットをスキップします。\"\n  exit 0\nfi\n```\n\n#### 2.2: レビュー結果の確認（Phase2実行時）\n\n`commit-judgment-logic.md`を参照して、コミット可能か判定：\n\n```markdown\n判定基準:\n- APPROVE: Critical: 0, High: 0, Medium: ≤3 → コミット OK\n- REQUEST CHANGES: Critical: 0, High: ≥1 または Medium: >3 → 自動修正 → 再判定\n- REJECT: Critical: ≥1 → 手動対応必要（コミット不可）\n```\n\n**参照**: [`commit-judgment-logic.md`](../../harness-review/references/commit-judgment-logic.md)\n\n### Step 3: Conventional Commit メッセージの生成\n\n変更内容を分析して適切なプレフィックスを選択：\n\n```bash\n# 変更ファイルからタイプを推定\n# feat: 新機能（新規ファイル）\n# fix: バグ修正（既存ファイルの修正）\n# refactor: リファクタリング\n# docs: ドキュメント\n# test: テスト追加\n# chore: その他\n\n# 例: 新規コンポーネントファイル → feat\n# 例: 既存ファイルの修正 → fix\n```\n\n**メッセージフォーマット**:\n\n```\n<type>(<scope>): <subject>\n\n<body>\n\n<footer>\n```\n\n**例**:\n\n```\nfeat(components): add Header, Footer, Sidebar components\n\n- Add responsive Header with navigation\n- Add Footer with copyright and links\n- Add collapsible Sidebar for mobile\n\nCo-Authored-By: Claude <noreply@anthropic.com>\n```\n\n### Step 4: git add の実行\n\n```bash\n# commit_strategy=all の場合\ngit add .\n\n# commit_strategy=phase の場合（Phase1の変更のみ）\ngit add src/components/Header.tsx src/components/Footer.tsx src/components/Sidebar.tsx\n\n# commit_strategy=task の場合（各タスクの変更のみ）\ngit add src/components/Header.tsx\n```\n\n### Step 5: git commit の実行\n\n```bash\ngit commit -m \"{{commit_message}}\"\n```\n\n### Step 6: 結果の確認\n\n```bash\n# コミットハッシュを取得\nCOMMIT_HASH=$(git rev-parse --short HEAD)\n\n# コミットされたファイル数を取得\nFILES_COMMITTED=$(git diff --name-only HEAD~1 | wc -l)\n```\n\n---\n\n## エラーハンドリング\n\n### コミット前のビルド検証\n\n```bash\n# 最終ビルド検証\nnpm run build || pnpm build || bun run build\n\n# 失敗時はエラーを返す（コミットしない）\nif [ $? -ne 0 ]; then\n  echo \"ビルドエラー: コミットを中止します\"\n  exit 1\nfi\n```\n\n### コンフリクト検出（isolation=worktree時）\n\n`isolation_mode=worktree`の場合、Phase3直前にworktreeブランチをマージ：\n\n```bash\n# merge-worktreesスキルでマージ済みを前提\n# ここではマージ後の状態でcommitを実行\n```\n\n---\n\n## 使用例\n\n### 例1: commit_strategy=task\n\n**Phase1完了時（各task-worker完了時）**:\n\n```bash\n# task-worker-1完了時\ngit add src/components/Header.tsx\ngit commit -m \"feat(components): add Header component\"\n\n# task-worker-2完了時\ngit add src/components/Footer.tsx\ngit commit -m \"feat(components): add Footer component\"\n```\n\n### 例2: commit_strategy=phase\n\n**Phase1完了時（全task-worker完了後）**:\n\n```bash\ngit add src/components/Header.tsx src/components/Footer.tsx src/components/Sidebar.tsx\ngit commit -m \"feat(components): add Header, Footer, Sidebar components\n\n- Add responsive Header with navigation\n- Add Footer with copyright and links\n- Add collapsible Sidebar for mobile\"\n```\n\n### 例3: commit_strategy=all\n\n**Phase3完了時（全フェーズ完了後）**:\n\n```bash\ngit add .\ngit commit -m \"feat(components): add Header, Footer, Sidebar components\n\n- Add responsive Header with navigation\n- Add Footer with copyright and links\n- Add collapsible Sidebar for mobile\n\nReviewed-by: Codex (4 experts)\nCo-Authored-By: Claude <noreply@anthropic.com>\"\n```\n\n---\n\n## 注意事項\n\n- **commit-judgment-logicの参照**: レビュー結果がある場合、必ず`commit-judgment-logic.md`の判定基準を確認する\n- **Conventional Commits準拠**: コミットメッセージはConventional Commits形式に従う\n- **ビルド検証**: コミット前に必ずビルドが成功することを確認する\n- **worktreeマージ**: `isolation_mode=worktree`時は、マージ完了後にcommitを実行する\n",
        "skills/workflow/references/handoff-to-impl.md": "---\nname: handoff-to-impl\ndescription: \"PM Claude → Impl Claude への依頼文を生成。2-Agent運用で実装役にタスクを渡したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Handoff to Impl Skill\n\nPM役 Claude Code が、実装役 Claude Code（Impl Claude）へ貼り付けるための依頼文を生成するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「このタスクを実装役Claudeに渡したい」\n- 「実装役に依頼文を作って」\n- 「Impl Claudeへのハンドオフ」\n\n---\n\n## 出力フォーマット\n\n```markdown\n## タスク依頼（PM Claude → Impl Claude）\n\n### 背景 / 目的\n- （なぜやるか）\n\n### 期待する成果\n- （何ができるようになればOKか）\n\n### 受け入れ基準（必須）\n- [ ] （基準1）\n- [ ] （基準2）\n\n### スコープ（やる / やらない）\n- **やる**: （項目）\n- **やらない**: （項目）\n\n### 変更対象（目安）\n- （ファイル/ディレクトリ）\n\n### 制約 / 禁止事項\n- （あれば）\n```\n\n---\n\n## 実行フロー\n\n1. `Plans.md` を読み込み、依頼対象タスクを特定\n2. タスクに `pm:依頼中` マーカーを付与\n3. 上記フォーマットで依頼文を生成\n",
        "skills/workflow/references/handoff-to-pm.md": "---\nname: handoff-to-pm\ndescription: \"Impl Claude → PM Claude への完了報告を生成。2-Agent運用で実装完了を報告したい場合に使用します。\"\nallowed-tools: [\"Read\", \"Write\", \"Edit\", \"Bash\"]\n---\n\n# Handoff to PM Skill\n\n実装役 Claude Code が、PM役 Claude Code へ貼り付けるための完了報告を生成するスキル。\n\n---\n\n## トリガーフレーズ\n\n- 「PMに完了報告を書いて」\n- 「実装が終わったので報告」\n- 「PM Claudeへのハンドオフ」\n\n---\n\n## 出力フォーマット\n\n```markdown\n## 完了報告（Impl Claude → PM Claude）\n\n### 概要（1〜3行）\n- （何を達成したか）\n\n### 変更点（要点）\n- （ユーザーに見える変更）\n\n### 変更ファイル\n- （ファイル一覧）\n\n### 動作確認 / テスト\n- （実施した確認）\n- （結果）\n\n### 受け入れ基準（満たしたか）\n- [ ] （基準1）→ ✅/⚠️\n- [ ] （基準2）→ ✅/⚠️\n\n### リスク / 注意点\n- （あれば）\n\n### 次のアクション候補\n1. （案1）\n2. （案2）\n```\n\n---\n\n## 実行フロー\n\n1. `git status` / `git diff` で変更範囲を把握\n2. `Plans.md` の該当タスクを `cc:完了` に更新\n3. 上記フォーマットで完了報告を生成\n",
        "templates/cursor/commands/handoff-to-claude.md": "---\ndescription: Claude Codeへの作業依頼プロンプトを生成\n---\n\n# /handoff-to-claude\n\nあなたは **Cursor (PM)** です。Claude Code に渡す依頼文を、コピー&ペーストできる形で生成してください。\n\n## 入力\n\n- @Plans.md（対象タスクを特定）\n- 可能なら `git status -sb` と `git diff --name-only`\n\n## 出力（そのままClaude Codeに貼る）\n\n次の Markdown を出力してください：\n\n```markdown\n/claude-code-harness:core:work\nultrathink\n\n## 依頼\n以下を実装してください。\n\n- 対象タスク:\n  - （Plans.md から該当タスクを列挙）\n\n## 制約\n- 既存のコードスタイルに従う\n- 変更は必要最小限\n- テスト/ビルド手順があれば提示\n\n## 受入条件\n- （3〜5個）\n\n## Evals（採点/検証）\nPlans.md の「評価（Evals）」に従って、**outcome/transcript を採点できる形**で進めてください。\n\n- tasks（シナリオ）:\n  - （例: 具体的な入力/手順/期待結果）\n- trials（回数/集計）:\n  - （例: 3回、成功率 + 中央値）\n- graders（採点）:\n  - outcome:\n    - （例: unit tests / typecheck / ファイル状態）\n  - transcript:\n    - （例: 禁止行為なし / 余計な変更なし）\n- 実行コマンド（可能なら）:\n  - （例: `npm test`, `./tests/validate-plugin.sh` など）\n\n## 参考\n- 関連ファイル（あれば）\n\n**作業完了後**: `/handoff-to-cursor` を実行して完了報告すること\n```\n\n\n",
        "templates/cursor/commands/plan-with-cc.md": "---\ndescription: 計画作成（Claude Codeと協調してタスク分解）\n---\n\n# /plan-with-cc\n\nあなたは **Cursor (PM)** です。ユーザー要望を Plans.md に落とし込み、Claude Code が実装できる粒度に分解します。\n\n**このコマンドのゴール**は「やること」だけでなく **“どう成功を判定するか（評価）”** まで Plans.md に書き切ることです。\n評価がない計画は、実装が終わっても **成功/失敗を判定できず**、改善も退化も測れません。\n\n## 手順\n\n## 0) 最初に決める（ここを曖昧にすると破綻する）\n\n- **受入条件は測定可能にする**: 「いい感じ」「ちゃんと」禁止。誰が見ても Yes/No が付く形に落とす。\n- **outcome と transcript を分離する**:\n  - **outcome**: 最終状態（ファイル/DB/テスト結果/設定）で判定する。「言った」ではなく「なった」を見る。\n  - **transcript**: 途中経過（ツール使用、手順、回り道、禁止行為）で判定する。\n- **grader を明示する**: 各受入条件を何で採点するか（テスト/静的解析/grep/実行ログ/目視）を紐づける。\n- **trial 設計**（非決定性対策）:\n  - 何回回すか（例: 3回）\n  - どう集計するか（例: 成功率 + 所要時間の中央値）\n- **比較が必要なら対照実験を成立させる**:\n  - “プラグイン無し/有り” 等を比べるなら、グローバル設定の混入を避ける（例: HOME 分離/隔離環境/コンテナ）。\n\n### 通常の計画作成\n\n1. **要望を1〜2文で要約**\n2. **スコープ/非スコープ**（各3つ以内）\n3. **受入条件（3〜5個）** を列挙（測定可能に）\n4. **評価（Evals）** を決める（下のテンプレをそのまま埋める）\n5. Plans.md に「フェーズ」と「タスク」を追記（推奨: `pm:依頼中` / `cc:TODO`。互換: `cursor:依頼中`）\n6. Claude Code に実装を依頼する場合は **/handoff-to-claude** を実行して依頼文を生成（依頼文に Evals を必ず含める）\n\n### Claude Code からの検証依頼を受けた場合\n\nClaude Code が `/cc-cursor-cc` で生成した「計画検証依頼」を貼り付けられた場合：\n\n1. 依頼内容（やりたいこと、仮タスク、技術選択、未決事項）を確認\n2. **実現可能性を検証**（できないなら “できない” を明言し、代替案/段階案に落とす）\n   - 仮タスクが技術的に実現可能か\n   - 見落としている前提条件がないか\n3. **評価設計を検証**（ここが弱いと全部ムダになる）\n   - 受入条件が Yes/No で判定できるか\n   - outcome grader が存在するか（最低1つは自動採点）\n   - trial/比較の設計が妥当か\n4. **タスク分解**\n   - 仮タスクを実装可能な粒度に分解\n   - 依存関係・順序を整理\n5. **未決事項の判断**\n   - Claude Code から提示された未決事項について決定\n6. **Plans.md の更新**\n   - `pm:検証待ち` → `cc:TODO` に変更\n   - 分解したタスクを追記\n7. **/handoff-to-claude** を実行して Claude Code への依頼文を生成（Evals/DoD を必ず含める）\n\n---\n\n## Plans.md 追記テンプレ（コピペして埋める）\n\n```markdown\n## 🟠 {{テーマ}} `pm:依頼中`\n\n### 背景 / 目的\n- {{なぜ今やるか}}\n\n### スコープ（やる）\n- {{scope1}}\n- {{scope2}}\n\n### 非スコープ（やらない）\n- {{non-scope1}}\n- {{non-scope2}}\n\n### 受入条件（必ず測定可能に）\n- [ ] {{AC1: outcome で判定できる形}}\n- [ ] {{AC2}}\n- [ ] {{AC3}}\n\n### 評価（Evals）\n- **tasks（シナリオ）**:\n  - {{task1: 入力/手順/期待結果}}\n- **trials（回数/集計）**:\n  - 回数: {{例: 3}}\n  - 集計: {{例: 成功率 + 所要時間中央値}}\n- **graders（採点）**:\n  - outcome:\n    - {{例: unit tests / typecheck / ファイル存在 / grep で具体条件}}\n  - transcript:\n    - {{例: 禁止行為なし / 想定ツール使用 / 余計な変更なし}}\n- **比較（必要な場合のみ）**:\n  - {{例: with-feature vs without-feature / plugin-on vs plugin-off}}\n  - 混入対策: {{例: HOME分離 / コンテナ}}\n- **失敗時の扱い**:\n  - {{例: 失敗ログと再現手順を必ず残す。成功で上書きしない}}\n\n### タスク（Claude Code 実装用）\n- [ ] {{evalタスク: テスト/検証追加}} `pm:依頼中`\n- [ ] {{実装タスク1}} `pm:依頼中`\n- [ ] {{実装タスク2}} `pm:依頼中`\n- [ ] {{レビュー/検証タスク}} `pm:依頼中`\n\n### リスク / 未決事項\n- {{risk1}}\n- {{decision1: PM判断}}\n```\n\n---\n\n## 継続的に評価しながら開発する最低ルール（運用）\n\n- **Evals が書けない要件は “未確定” 扱い**: 先に仕様を詰める。実装に回さない。\n- **変更には必ず 1つ以上の自動 grader を追加**: “人間の記憶” をテストケースに変換して回帰を防ぐ。\n- **回帰はタスク化して suite に追加**: 失敗事例を “未来のテスト” にする（これが評価の複利）。\n\n## 参照\n\n- @Plans.md\n- @README.md\n- 変更点があれば `git diff` / `git status`\n\n\n",
        "templates/cursor/commands/project-overview.md": "---\ndescription: プロジェクト全体の概要を短く把握\n---\n\n# /project-overview\n\n以下を短くまとめてください（箇条書き中心）。\n\n## 入力\n\n- @README.md\n- @Plans.md\n- @AGENTS.md\n- @CLAUDE.md\n\n可能なら：\n- `git status -sb`\n- `git log --oneline -10`\n\n## 出力フォーマット\n\n- **目的**: このプロジェクトが何を作っているか（1-2行）\n- **現在地**: 今のフェーズ/未完了タスク（Plans.md基準）\n- **技術**: 言語/主要フレームワーク/テスト手段（推測でOK）\n- **次アクション**: 3つまで\n\n\n",
        "templates/cursor/commands/review-cc-work.md": "---\ndescription: Claude Codeの作業をレビューし、承認/修正指示をハンドオフ\n---\n\n# /review-cc-work\n\nあなたは **Cursor (PM)** です。Claude Code からの完了報告（/handoff-to-cursor の出力）を受け取り、変更をレビューしてください。\n\n**重要**: レビュー後、承認/修正どちらの場合も **Hand off to Claude** を生成します。\n\n## 手順\n\n### Step 1: レビュー実施\n\n1. 変更ファイル/差分の要点を把握（`git diff` または完了報告から）\n2. 受入条件に照らして判定\n3. 品質・セキュリティ・パフォーマンス観点でチェック\n4. **Evals の確認**: Plans.md の「評価（Evals）」に基づく検証（テスト/ログ/ベンチ等）が提示されているか、結果が妥当か確認\n\n### Step 2: 判定\n\n| 判定 | 条件 | 次のアクション |\n|------|------|---------------|\n| **approve** | 受入条件を満たす | Plans.md の該当タスクを `pm:確認済` に変更 → コミット指示 → **ここで終了**（次タスクはユーザーの明示要求がある場合のみ） |\n| **request_changes** | 修正が必要 | 修正指示をまとめる → ハンドオフ生成 |\n\n> **Commit Pending の場合**: 完了報告に「Commit Status: Pending PM Approval」が含まれている場合、approve 時のハンドオフに **コミット指示を必ず含める**こと（後述の approve テンプレート参照）。\n\n### Step 3: ハンドオフ生成（必須）\n\nどちらの場合も、Claude Code に渡すハンドオフメッセージを生成してください。\n\n---\n\n## 出力フォーマット\n\n### 判定サマリー\n\n```\n## レビュー結果\n\n**判定**: approve / request_changes\n**理由**:\n- （1〜3点）\n\n**Plans.md 更新**:\n- `[タスク名]` → `pm:確認済` に変更（approveの場合）\n```\n\n### Hand off to Claude（必ず出力）\n\n#### approve の場合はコミットして終了\n\n**デフォルト動作**: approve 時は変更をコミットして終了します。次タスクはユーザーの明示要求がある場合のみハンドオフを生成してください。\n\n##### 承認のみ（デフォルト）\n\n承認 → コミット指示 → **ここで終了**。次タスクへの自動遷移は行いません。\n\n~~~markdown\n/claude-code-harness:core:work\nultrathink\n\n## 依頼\n\n前回のタスクは承認済みです。変更をコミットしてください。\n\n### コミット指示\n- 前回の変更を承認します。コミットしてください。\n- コミット後、作業は完了です。\n\n### 参考\n- 関連ファイル（あれば）\n\nコミット完了後は `/handoff-to-cursor` で報告してください。\n~~~\n\n##### ユーザーが次タスクを明示要求した場合のみ\n\nユーザーが「次タスクに進めて」「続けて」等を明示した場合にのみ、以下のテンプレートを使用：\n\n@Plans.md から次の `cc:TODO` または `pm:依頼中` タスクを分析し、以下を生成：\n\n~~~markdown\n/claude-code-harness:core:work\nultrathink\n\n## 依頼\n\n前回のタスクは承認済みです。**変更をコミットしてから**、次のタスクを実装してください。\n\n### コミット指示\n- 前回の変更を承認します。コミットしてから次のタスクに進んでください。\n\n### 対象タスク\n- （Plans.md から次タスクを抽出）\n\n### 背景\n- 前タスク完了・承認により着手可能になった\n- （依存関係があれば記載）\n\n### 制約\n- 既存のコードスタイルに従う\n- 変更は必要最小限\n- テスト/ビルドが通ることを確認\n\n### 受入条件\n- （3〜5個、具体的に）\n\n### 参考\n- 関連ファイル（あれば）\n\n完了後は `/handoff-to-cursor` で報告してください。\n~~~\n\n#### request_changes の場合\n\n修正指示を含むハンドオフを生成：\n\n~~~markdown\n/claude-code-harness:core:work\nultrathink\n\n## 修正依頼\n\nレビューの結果、以下の修正が必要です。\n\n### 修正対象タスク\n- （Plans.md の該当タスク）\n\n### 指摘事項\n1. **[重要度: 高/中/低]** 指摘内容\n   - 該当箇所: `ファイル名:行番号`\n   - 期待する修正: 具体的な対応方法\n\n2. **[重要度: 高/中/低]** 指摘内容\n   - 該当箇所:\n   - 期待する修正:\n\n### 制約\n- 既存のテストを壊さないこと\n- 指摘箇所以外は変更しないこと\n\n### 受入条件（修正後）\n- 上記指摘がすべて解消されていること\n- テスト/ビルドが通ること\n- （追加条件があれば）\n\n完了後は `/handoff-to-cursor` で報告してください。\n~~~\n\n---\n\n## ワークフロー図\n\n```\nClaude Code 完了報告\n        ↓\n  /review-cc-work\n        ↓\n   ┌────┴────┐\n   ↓         ↓\napprove   request_changes\n   ↓         ↓\npm:確認済   修正指示作成\n   ↓         ↓\ncommit      ハンドオフ生成\n   ↓         ↓\n 終了        ↓\n(次タスクは     ↓\n 明示要求      ↓\n 時のみ)       ↓\n   ↓         ↓\n   └────┬────┘\n        ↓\n  Claude Code へ貼り付け\n        ↓\n     /work 実行\n```\n",
        "templates/cursor/commands/start-session.md": "---\ndescription: セッション開始（状況把握→計画→Claude Codeへ依頼）\n---\n\n# /start-session\n\nあなたは **Cursor (PM)** です。目的は「いま何をすべきか」を短時間で明確にし、必要なら Claude Code へ依頼することです。\n\n## 1) 状況把握（最初に読む）\n\n- @Plans.md\n- @AGENTS.md\n- @CLAUDE.md\n\n可能なら以下も確認：\n- `git status -sb`\n- `git log --oneline -5`\n- `git diff --name-only`\n\n## 2) 今日のゴールを決める\n\n次を1つに絞って提案してください：\n- 最優先タスク（1つ）\n- 受入条件（3つ以内）\n- 想定リスク（あれば）\n\n## 3) Claude Codeに依頼する（必要なら）\n\nタスクを Claude Code に渡す場合、**/handoff-to-claude** を実行して依頼文を作ってください。\n\n\n",
        "templates/hooks/auto-cleanup-hook.sh": "#!/bin/bash\n# auto-cleanup-hook.sh\n# PostToolUse Hook: Plans.md 等への書き込み後に自動でサイズチェック\n#\n# 環境変数:\n#   $CLAUDE_FILE_PATHS - 変更されたファイルパス（スペース区切り）\n#\n# 設定:\n#   .claude-code-harness.config.yaml で閾値をカスタマイズ可能\n\n# デフォルト閾値\nPLANS_MAX_LINES=${PLANS_MAX_LINES:-200}\nSESSION_LOG_MAX_LINES=${SESSION_LOG_MAX_LINES:-500}\nCLAUDE_MD_MAX_LINES=${CLAUDE_MD_MAX_LINES:-100}\n\n# 設定ファイルがあれば読み込み\nCONFIG_FILE=\".claude-code-harness.config.yaml\"\nif [ -f \"$CONFIG_FILE\" ]; then\n  # 簡易 YAML パース\n  PLANS_MAX_LINES=$(grep -A5 \"plans:\" \"$CONFIG_FILE\" | grep \"max_lines:\" | head -1 | awk '{print $2}' || echo $PLANS_MAX_LINES)\n  SESSION_LOG_MAX_LINES=$(grep -A5 \"session_log:\" \"$CONFIG_FILE\" | grep \"max_lines:\" | head -1 | awk '{print $2}' || echo $SESSION_LOG_MAX_LINES)\n  CLAUDE_MD_MAX_LINES=$(grep -A5 \"claude_md:\" \"$CONFIG_FILE\" | grep \"max_lines:\" | head -1 | awk '{print $2}' || echo $CLAUDE_MD_MAX_LINES)\nfi\n\n# フィードバックを格納する変数\nFEEDBACK=\"\"\n\n# 各ファイルをチェック\nfor file in $CLAUDE_FILE_PATHS; do\n  # Plans.md のチェック\n  if [[ \"$file\" == *\"Plans.md\"* ]] || [[ \"$file\" == *\"plans.md\"* ]] || [[ \"$file\" == *\"PLANS.MD\"* ]]; then\n    if [ -f \"$file\" ]; then\n      lines=$(wc -l < \"$file\" | tr -d ' ')\n      if [ \"$lines\" -gt \"$PLANS_MAX_LINES\" ]; then\n        FEEDBACK=\"${FEEDBACK}Plans.md が ${lines} 行です（上限: ${PLANS_MAX_LINES}行）。\\`/cleanup plans\\` で古いタスクをアーカイブすることを推奨します。\\n\"\n      fi\n    fi\n  fi\n\n  # session-log.md のチェック\n  if [[ \"$file\" == *\"session-log.md\"* ]]; then\n    if [ -f \"$file\" ]; then\n      lines=$(wc -l < \"$file\" | tr -d ' ')\n      if [ \"$lines\" -gt \"$SESSION_LOG_MAX_LINES\" ]; then\n        FEEDBACK=\"${FEEDBACK}session-log.md が ${lines} 行です（上限: ${SESSION_LOG_MAX_LINES}行）。\\`/cleanup sessions\\` で月別に分割することを推奨します。\\n\"\n      fi\n    fi\n  fi\n\n  # CLAUDE.md のチェック\n  if [[ \"$file\" == *\"CLAUDE.md\"* ]] || [[ \"$file\" == *\"claude.md\"* ]]; then\n    if [ -f \"$file\" ]; then\n      lines=$(wc -l < \"$file\" | tr -d ' ')\n      if [ \"$lines\" -gt \"$CLAUDE_MD_MAX_LINES\" ]; then\n        FEEDBACK=\"${FEEDBACK}CLAUDE.md が ${lines} 行です。常に必要な情報以外は docs/ に分割し、\\`@docs/filename.md\\` で参照することを検討してください。\\n\"\n      fi\n    fi\n  fi\ndone\n\n# フィードバックがあれば出力（Claude Code へのフィードバック）\nif [ -n \"$FEEDBACK\" ]; then\n  echo -e \"⚠️ ファイルサイズ警告:\\n${FEEDBACK}\"\nfi\n\n# 常に成功で終了（ブロックしない）\nexit 0\n",
        "templates/opencode/commands/handoff-to-claude.md": "---\ndescription: Claude Codeへの作業依頼プロンプトを生成\n---\n\n# /handoff-to-claude\n\nあなたは **OpenCode (PM)** です。Claude Code に渡す依頼文を、コピー&ペーストできる形で生成してください。\n\n## 入力\n\n- @Plans.md（対象タスクを特定）\n- 可能なら `git status -sb` と `git diff --name-only`\n\n## 出力（そのままClaude Codeに貼る）\n\n次の Markdown を出力してください：\n\n```markdown\n/claude-code-harness:core:work\nultrathink\n\n## 依頼\n以下を実装してください。\n\n- 対象タスク:\n  - （Plans.md から該当タスクを列挙）\n\n## 制約\n- 既存のコードスタイルに従う\n- 変更は必要最小限\n- テスト/ビルド手順があれば提示\n\n## 受入条件\n- （3〜5個）\n\n## Evals（採点/検証）\nPlans.md の「評価（Evals）」に従って、**outcome/transcript を採点できる形**で進めてください。\n\n- tasks（シナリオ）:\n  - （例: 具体的な入力/手順/期待結果）\n- trials（回数/集計）:\n  - （例: 3回、成功率 + 中央値）\n- graders（採点）:\n  - outcome:\n    - （例: unit tests / typecheck / ファイル状態）\n  - transcript:\n    - （例: 禁止行為なし / 余計な変更なし）\n- 実行コマンド（可能なら）:\n  - （例: `npm test`, `./tests/validate-plugin.sh` など）\n\n## 参考\n- 関連ファイル（あれば）\n\n**作業完了後**: `/handoff-to-opencode` を実行して完了報告すること\n```\n",
        "templates/opencode/commands/plan-with-cc.md": "---\ndescription: 計画作成（Claude Codeと協調してタスク分解）\n---\n\n# /plan-with-cc\n\nあなたは **OpenCode (PM)** です。ユーザー要望を Plans.md に落とし込み、Claude Code が実装できる粒度に分解します。\n\n**このコマンドのゴール**は「やること」だけでなく **\"どう成功を判定するか（評価）\"** まで Plans.md に書き切ることです。\n評価がない計画は、実装が終わっても **成功/失敗を判定できず**、改善も退化も測れません。\n\n## 手順\n\n## 0) 最初に決める（ここを曖昧にすると破綻する）\n\n- **受入条件は測定可能にする**: 「いい感じ」「ちゃんと」禁止。誰が見ても Yes/No が付く形に落とす。\n- **outcome と transcript を分離する**:\n  - **outcome**: 最終状態（ファイル/DB/テスト結果/設定）で判定する。「言った」ではなく「なった」を見る。\n  - **transcript**: 途中経過（ツール使用、手順、回り道、禁止行為）で判定する。\n- **grader を明示する**: 各受入条件を何で採点するか（テスト/静的解析/grep/実行ログ/目視）を紐づける。\n- **trial 設計**（非決定性対策）:\n  - 何回回すか（例: 3回）\n  - どう集計するか（例: 成功率 + 所要時間の中央値）\n- **比較が必要なら対照実験を成立させる**:\n  - \"プラグイン無し/有り\" 等を比べるなら、グローバル設定の混入を避ける（例: HOME 分離/隔離環境/コンテナ）。\n\n### 通常の計画作成\n\n1. **要望を1〜2文で要約**\n2. **スコープ/非スコープ**（各3つ以内）\n3. **受入条件（3〜5個）** を列挙（測定可能に）\n4. **評価（Evals）** を決める（下のテンプレをそのまま埋める）\n5. Plans.md に「フェーズ」と「タスク」を追記（推奨: `pm:依頼中` / `cc:TODO`。互換: `cursor:依頼中`）\n6. Claude Code に実装を依頼する場合は **/handoff-to-claude** を実行して依頼文を生成（依頼文に Evals を必ず含める）\n\n### Claude Code からの検証依頼を受けた場合\n\nClaude Code が `/cc-cursor-cc` で生成した「計画検証依頼」を貼り付けられた場合：\n\n1. 依頼内容（やりたいこと、仮タスク、技術選択、未決事項）を確認\n2. **実現可能性を検証**（できないなら \"できない\" を明言し、代替案/段階案に落とす）\n   - 仮タスクが技術的に実現可能か\n   - 見落としている前提条件がないか\n3. **評価設計を検証**（ここが弱いと全部ムダになる）\n   - 受入条件が Yes/No で判定できるか\n   - outcome grader が存在するか（最低1つは自動採点）\n   - trial/比較の設計が妥当か\n4. **タスク分解**\n   - 仮タスクを実装可能な粒度に分解\n   - 依存関係・順序を整理\n5. **未決事項の判断**\n   - Claude Code から提示された未決事項について決定\n6. **Plans.md の更新**\n   - `pm:検証待ち` → `cc:TODO` に変更\n   - 分解したタスクを追記\n7. **/handoff-to-claude** を実行して Claude Code への依頼文を生成（Evals/DoD を必ず含める）\n\n---\n\n## Plans.md 追記テンプレ（コピペして埋める）\n\n```markdown\n## 🟠 {{テーマ}} `pm:依頼中`\n\n### 背景 / 目的\n- {{なぜ今やるか}}\n\n### スコープ（やる）\n- {{scope1}}\n- {{scope2}}\n\n### 非スコープ（やらない）\n- {{non-scope1}}\n- {{non-scope2}}\n\n### 受入条件（必ず測定可能に）\n- [ ] {{AC1: outcome で判定できる形}}\n- [ ] {{AC2}}\n- [ ] {{AC3}}\n\n### 評価（Evals）\n- **tasks（シナリオ）**:\n  - {{task1: 入力/手順/期待結果}}\n- **trials（回数/集計）**:\n  - 回数: {{例: 3}}\n  - 集計: {{例: 成功率 + 所要時間中央値}}\n- **graders（採点）**:\n  - outcome:\n    - {{例: unit tests / typecheck / ファイル存在 / grep で具体条件}}\n  - transcript:\n    - {{例: 禁止行為なし / 想定ツール使用 / 余計な変更なし}}\n- **比較（必要な場合のみ）**:\n  - {{例: with-feature vs without-feature / plugin-on vs plugin-off}}\n  - 混入対策: {{例: HOME分離 / コンテナ}}\n- **失敗時の扱い**:\n  - {{例: 失敗ログと再現手順を必ず残す。成功で上書きしない}}\n\n### タスク（Claude Code 実装用）\n- [ ] {{evalタスク: テスト/検証追加}} `pm:依頼中`\n- [ ] {{実装タスク1}} `pm:依頼中`\n- [ ] {{実装タスク2}} `pm:依頼中`\n- [ ] {{レビュー/検証タスク}} `pm:依頼中`\n\n### リスク / 未決事項\n- {{risk1}}\n- {{decision1: PM判断}}\n```\n\n---\n\n## 継続的に評価しながら開発する最低ルール（運用）\n\n- **Evals が書けない要件は \"未確定\" 扱い**: 先に仕様を詰める。実装に回さない。\n- **変更には必ず 1つ以上の自動 grader を追加**: \"人間の記憶\" をテストケースに変換して回帰を防ぐ。\n- **回帰はタスク化して suite に追加**: 失敗事例を \"未来のテスト\" にする（これが評価の複利）。\n\n## 参照\n\n- @Plans.md\n- @README.md\n- 変更点があれば `git diff` / `git status`\n",
        "templates/opencode/commands/project-overview.md": "---\ndescription: プロジェクト全体の概要を短く把握\n---\n\n# /project-overview\n\n以下を短くまとめてください（箇条書き中心）。\n\n## 入力\n\n- @README.md\n- @Plans.md\n- @AGENTS.md\n\n可能なら：\n- `git status -sb`\n- `git log --oneline -10`\n\n## 出力フォーマット\n\n- **目的**: このプロジェクトが何を作っているか（1-2行）\n- **現在地**: 今のフェーズ/未完了タスク（Plans.md基準）\n- **技術**: 言語/主要フレームワーク/テスト手段（推測でOK）\n- **次アクション**: 3つまで\n",
        "templates/opencode/commands/review-cc-work.md": "---\ndescription: Claude Codeの作業をレビューし、承認/修正指示をハンドオフ\n---\n\n# /review-cc-work\n\nあなたは **OpenCode (PM)** です。Claude Code からの完了報告（/handoff-to-opencode の出力）を受け取り、変更をレビューしてください。\n\n**重要**: レビュー後、承認/修正どちらの場合も **Hand off to Claude** を生成します。\n\n## 手順\n\n### Step 1: レビュー実施\n\n1. 変更ファイル/差分の要点を把握（`git diff` または完了報告から）\n2. 受入条件に照らして判定\n3. 品質・セキュリティ・パフォーマンス観点でチェック\n4. **Evals の確認**: Plans.md の「評価（Evals）」に基づく検証（テスト/ログ/ベンチ等）が提示されているか、結果が妥当か確認\n\n### Step 2: 判定\n\n| 判定 | 条件 | 次のアクション |\n|------|------|---------------|\n| **approve** | 受入条件を満たす | Plans.md の該当タスクを `pm:確認済` に変更 → コミット指示 → **ここで終了**（次タスクはユーザーの明示要求がある場合のみ） |\n| **request_changes** | 修正が必要 | 修正指示をまとめる → ハンドオフ生成 |\n\n> **Commit Pending の場合**: 完了報告に「Commit Status: Pending PM Approval」が含まれている場合、approve 時のハンドオフに **コミット指示を必ず含める**こと（後述の approve テンプレート参照）。\n\n### Step 3: ハンドオフ生成（必須）\n\nどちらの場合も、Claude Code に渡すハンドオフメッセージを生成してください。\n\n---\n\n## 出力フォーマット\n\n### 判定サマリー\n\n```\n## レビュー結果\n\n**判定**: approve / request_changes\n**理由**:\n- （1〜3点）\n\n**Plans.md 更新**:\n- `[タスク名]` → `pm:確認済` に変更（approveの場合）\n```\n\n### Hand off to Claude（必ず出力）\n\n#### approve の場合はコミットして終了\n\n**デフォルト動作**: approve 時は変更をコミットして終了します。次タスクはユーザーの明示要求がある場合のみハンドオフを生成してください。\n\n##### 承認のみ（デフォルト）\n\n承認 → コミット指示 → **ここで終了**。次タスクへの自動遷移は行いません。\n\n~~~markdown\n/claude-code-harness:core:work\nultrathink\n\n## 依頼\n\n前回のタスクは承認済みです。変更をコミットしてください。\n\n### コミット指示\n- 前回の変更を承認します。コミットしてください。\n- コミット後、作業は完了です。\n\n### 参考\n- 関連ファイル（あれば）\n\nコミット完了後は `/handoff-to-opencode` で報告してください。\n~~~\n\n##### ユーザーが次タスクを明示要求した場合のみ\n\nユーザーが「次タスクに進めて」「続けて」等を明示した場合にのみ、以下のテンプレートを使用：\n\n@Plans.md から次の `cc:TODO` または `pm:依頼中` タスクを分析し、以下を生成：\n\n~~~markdown\n/claude-code-harness:core:work\nultrathink\n\n## 依頼\n\n前回のタスクは承認済みです。**変更をコミットしてから**、次のタスクを実装してください。\n\n### コミット指示\n- 前回の変更を承認します。コミットしてから次のタスクに進んでください。\n\n### 対象タスク\n- （Plans.md から次タスクを抽出）\n\n### 背景\n- 前タスク完了・承認により着手可能になった\n- （依存関係があれば記載）\n\n### 制約\n- 既存のコードスタイルに従う\n- 変更は必要最小限\n- テスト/ビルドが通ることを確認\n\n### 受入条件\n- （3〜5個、具体的に）\n\n### 参考\n- 関連ファイル（あれば）\n\n完了後は `/handoff-to-opencode` で報告してください。\n~~~\n\n#### request_changes の場合\n\n修正指示を含むハンドオフを生成：\n\n~~~markdown\n/claude-code-harness:core:work\nultrathink\n\n## 修正依頼\n\nレビューの結果、以下の修正が必要です。\n\n### 修正対象タスク\n- （Plans.md の該当タスク）\n\n### 指摘事項\n1. **[重要度: 高/中/低]** 指摘内容\n   - 該当箇所: `ファイル名:行番号`\n   - 期待する修正: 具体的な対応方法\n\n2. **[重要度: 高/中/低]** 指摘内容\n   - 該当箇所:\n   - 期待する修正:\n\n### 制約\n- 既存のテストを壊さないこと\n- 指摘箇所以外は変更しないこと\n\n### 受入条件（修正後）\n- 上記指摘がすべて解消されていること\n- テスト/ビルドが通ること\n- （追加条件があれば）\n\n完了後は `/handoff-to-opencode` で報告してください。\n~~~\n\n---\n\n## ワークフロー図\n\n```\nClaude Code 完了報告\n        ↓\n  /review-cc-work\n        ↓\n   ┌────┴────┐\n   ↓         ↓\napprove   request_changes\n   ↓         ↓\npm:確認済   修正指示作成\n   ↓         ↓\ncommit      ハンドオフ生成\n   ↓         ↓\n 終了        ↓\n(次タスクは     ↓\n 明示要求      ↓\n 時のみ)       ↓\n   ↓         ↓\n   └────┬────┘\n        ↓\n  Claude Code へ貼り付け\n        ↓\n     /work 実行\n```\n",
        "templates/opencode/commands/start-session.md": "---\ndescription: セッション開始（状況把握→計画→Claude Codeへ依頼）\n---\n\n# /start-session\n\nあなたは **OpenCode (PM)** です。目的は「いま何をすべきか」を短時間で明確にし、必要なら Claude Code へ依頼することです。\n\n## 1) 状況把握（最初に読む）\n\n- @Plans.md\n- @AGENTS.md\n\n可能なら以下も確認：\n- `git status -sb`\n- `git log --oneline -5`\n- `git diff --name-only`\n\n## 2) 今日のゴールを決める\n\n次を1つに絞って提案してください：\n- 最優先タスク（1つ）\n- 受入条件（3つ以内）\n- 想定リスク（あれば）\n\n## 3) Claude Codeに依頼する（必要なら）\n\nタスクを Claude Code に渡す場合、**/handoff-to-claude** を実行して依頼文を作ってください。\n",
        "tests/README.md": "# テストスイート\n\nこのディレクトリには、claude-code-harnessプラグインの品質を保証するためのテストが含まれています。\n\n## VibeCoder向けテスト\n\nエンタープライズレベルの複雑なテストではなく、**1人でクライアントプロジェクトをこなすVibeCoder**が、プラグインが正しく動作することを簡単に確認できるシンプルなテストです。\n\n## テストの実行方法\n\n### プラグイン構造の検証\n\nプラグインの基本構造が正しいかを検証します：\n\n```bash\n./tests/validate-plugin.sh\n```\n\nこのテストは以下を確認します：\n\n1. **プラグイン構造**: plugin.jsonの存在と妥当性\n2. **コマンド**: 登録されたコマンドファイルの存在\n3. **スキル**: スキル定義の存在と基本的な品質\n4. **エージェント**: エージェント定義の存在\n5. **フック**: hooks.jsonの妥当性\n6. **スクリプト**: 自動化スクリプトの存在と実行権限\n7. **ドキュメント**: README等の必須ドキュメント\n\n### 期待される出力\n\n```\n==========================================\nClaude harness - プラグイン検証テスト\n==========================================\n\n1. プラグイン構造の検証\n----------------------------------------\n✓ plugin.json が存在します\n✓ plugin.json は有効なJSONです\n✓ plugin.json に name フィールドがあります\n✓ plugin.json に version フィールドがあります\n...\n\n==========================================\nテスト結果サマリー\n==========================================\n合格: 25\n警告: 1\n失敗: 0\n\n✓ 全てのテストに合格しました！\n```\n\n## テストの追加\n\n新しいコマンドやスキルを追加した場合、このテストを実行して構造が正しいことを確認してください。\n\n## CI/CDでの利用\n\nGitHub Actionsで自動的にこのテストが実行されます。詳細は `.github/workflows/validate.yml` を参照してください。\n\n## トラブルシューティング\n\n### jqコマンドが見つからない\n\nテストスクリプトは`jq`コマンドを使用します。インストールされていない場合：\n\n```bash\n# macOS\nbrew install jq\n\n# Ubuntu/Debian\nsudo apt-get install jq\n\n# Windows (WSL)\nsudo apt-get install jq\n```\n\n### テストが失敗する場合\n\n1. エラーメッセージを確認\n2. 該当するファイルが存在するか確認\n3. JSONファイルの構文エラーがないか確認\n\n## VibeCoder向けのポイント\n\n- **シンプル**: 複雑なテストフレームワークは不要\n- **実用的**: 実際に問題になる構造エラーを検出\n- **高速**: 数秒で完了\n- **わかりやすい**: 結果が一目でわかる\n\nこのテストは、プラグインを変更した後に「壊れていないか」を素早く確認するためのものです。\n"
      },
      "plugins": [
        {
          "name": "claude-code-harness",
          "source": "./",
          "description": "A harness for solo developers (Vibecoders) to handle full-cycle contract development.",
          "author": {
            "name": "Chachamaru",
            "url": "https://github.com/Chachamaru127"
          },
          "homepage": "https://github.com/Chachamaru127/claude-code-harness",
          "repository": "https://github.com/Chachamaru127/claude-code-harness",
          "license": "Proprietary",
          "keywords": [
            "claude-code",
            "plugin",
            "vibecoder",
            "workflow",
            "plan-work-review"
          ],
          "category": "productivity",
          "strict": true,
          "categories": [
            "claude-code",
            "plan-work-review",
            "plugin",
            "productivity",
            "vibecoder",
            "workflow"
          ],
          "install_commands": [
            "/plugin marketplace add Chachamaru127/claude-code-harness",
            "/plugin install claude-code-harness@claude-code-harness-marketplace"
          ]
        }
      ]
    }
  ]
}