{
  "author": {
    "id": "Roasbeef",
    "display_name": "Olaoluwa Osuntokun",
    "avatar_url": "https://avatars.githubusercontent.com/u/998190?v=4"
  },
  "marketplaces": [
    {
      "name": "substrate-plugins",
      "version": null,
      "description": "Agent command center for orchestrating Claude Code agents with mail, messaging, code reviews, and persistent agent lifecycle hooks.",
      "repo_full_name": "Roasbeef/substrate",
      "repo_url": "https://github.com/Roasbeef/substrate",
      "repo_description": null,
      "signals": {
        "stars": 2,
        "forks": 0,
        "pushed_at": "2026-02-10T23:53:25Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"substrate-plugins\",\n  \"owner\": {\n    \"name\": \"Roasbeef\",\n    \"email\": \"laolu@roasbeef.com\"\n  },\n  \"metadata\": {\n    \"description\": \"Agent command center for orchestrating Claude Code agents with mail, messaging, code reviews, and persistent agent lifecycle hooks.\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"substrate\",\n      \"source\": \"./\",\n      \"description\": \"Agent command center with mail, reviews, and persistent agent hooks.\",\n      \"version\": \"1.0.0\"\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"substrate\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Agent command center for orchestrating Claude Code agents with mail, messaging, code reviews, and persistent agent lifecycle hooks.\",\n  \"author\": {\n    \"name\": \"Roasbeef\",\n    \"url\": \"https://github.com/roasbeef\"\n  },\n  \"homepage\": \"https://github.com/roasbeef/subtrate\",\n  \"repository\": \"https://github.com/roasbeef/subtrate\",\n  \"license\": \"MIT\",\n  \"keywords\": [\n    \"agents\",\n    \"mail\",\n    \"messaging\",\n    \"code-review\",\n    \"multi-agent\",\n    \"orchestration\",\n    \"hooks\"\n  ]\n}\n",
        "README.md": "# Subtrate\n\nSubtrate is a command center for orchestrating multiple Claude Code agents. It provides the messaging infrastructure that allows agents to communicate, coordinate, and persist across context compactions, turning isolated coding assistants into a collaborative workforce.\n\n![Subtrate Inbox](docs/images/inbox.png)\n\n## The Problem\n\nWhen you run multiple Claude Code agents (perhaps one reviewing code while another implements features), they operate in complete isolation. They can't ask each other questions, share discoveries, or coordinate their work. Each agent is also ephemeral: when its context window fills up and compacts, it loses track of what it was doing.\n\nSubtrate solves both problems. It gives agents a mail system to communicate and a hook system that keeps them alive and responsive. An agent working on authentication can message the agent handling the database schema. When you step away, agents don't just exit. They wait for new work, checking their inbox periodically.\n\n## How It Works\n\nSubtrate integrates with Claude Code through its hook system. When an agent starts, Subtrate assigns it a persistent identity (like `NobleLion@subtrate.e2e-testing`) that survives across context compactions. The Stop hook keeps agents alive indefinitely, polling for new messages. When mail arrives, it gets injected into the agent's context as actionable work.\n\n```mermaid\nflowchart TB\n    subgraph Agents[\"Claude Code Agents\"]\n        A1[\"Agent: NobleLion<br/>Working on: auth\"]\n        A2[\"Agent: SilverWolf<br/>Working on: api\"]\n        A3[\"Agent: CrimsonFox<br/>Working on: tests\"]\n    end\n\n    subgraph Subtrate[\"Subtrate\"]\n        CLI[\"substrate CLI\"]\n        GRPC[\"gRPC Server :10009\"]\n        REST[\"REST Gateway /api/v1/\"]\n        Mail[\"Mail Service<br/>(Actor Pattern)\"]\n        Review[\"Review Service<br/>(FSM + Claude SDK)\"]\n        Queue[\"Local Queue<br/>(Store-and-Forward)\"]\n        DB[(SQLite<br/>WAL + FTS5)]\n    end\n\n    subgraph Web[\"Web UI :8080\"]\n        WEB[\"React SPA\"]\n        WS[\"WebSocket /ws\"]\n    end\n\n    A1 <--> CLI\n    A2 <--> CLI\n    A3 <--> CLI\n\n    CLI -->|online| GRPC\n    CLI -.->|offline| Queue\n    Queue -.->|reconnect| GRPC\n    GRPC --> Mail\n    GRPC --> Review\n    REST --> GRPC\n    WEB --> REST\n    WEB --> WS\n    Mail --> DB\n    Review --> DB\n```\n\nThe architecture is straightforward: agents communicate via the `substrate` CLI with a 3-tier fallback (gRPC → direct DB → local queue). Messages flow through an actor-based mail service into a SQLite database. The hook system ensures agents stay responsive and messages get delivered even when the daemon is unavailable.\n\n## Features\n\n### Code Reviews\n\nSubtrate includes a native code review system that spawns isolated Claude Agent SDK reviewer agents to analyze diffs and return structured feedback.\n\n![Reviews list](docs/images/reviews-page.png)\n\n- 4 review types: full, security, performance, architecture\n- FSM-based workflow with iteration tracking\n- Structured issue tracking with severity, file path, and line ranges\n- Web UI for browsing reviews, iterations, and issues\n\nSee [Code Reviews](docs/reviews.md) for the full workflow and CLI usage.\n\n### Diff Viewer\n\nSend git diffs as messages with syntax highlighting in the web UI. Supports unified/split modes and fullscreen navigation with file sidebar.\n\n![Diff inline in message](docs/images/diff-in-message.png)\n\n```bash\nsubstrate send-diff --session-id \"$CLAUDE_SESSION_ID\" --to User --base main\n```\n\n### Store-and-Forward Queue\n\nThe CLI uses a 3-tier connection fallback so agents can operate even when the daemon is unavailable:\n\n1. **gRPC** — Connects to the `substrated` daemon (preferred)\n2. **Direct DB** — Opens the SQLite database directly\n3. **Local Queue** — Stores operations offline with automatic delivery on reconnect\n\nQueued operations include idempotency keys to prevent duplicates and TTL-based expiry.\n\n### Web UI\n\nA React + TypeScript SPA with real-time WebSocket updates for inbox, agent status, sessions, reviews, and activity feed.\n\n## Quick Start\n\n### Installation\n\n```bash\n# Clone and build\ngit clone https://github.com/roasbeef/subtrate\ncd subtrate\nmake build-all\nmake install\n\n# Install Claude Code hooks (sets up persistent agent behavior)\nsubstrate hooks install\n\n# Verify installation\nsubstrate hooks status\n```\n\n### Basic Usage\n\n```bash\n# Check your inbox\nsubstrate inbox\n\n# Send a message to another agent\nsubstrate send --to SilverWolf --subject \"Need API review\" --body \"Can you look at the auth endpoints?\"\n\n# Read a specific message\nsubstrate read 42\n\n# Request a code review\nsubstrate review request --session-id \"$CLAUDE_SESSION_ID\"\n\n# Send a diff to the User\nsubstrate send-diff --session-id \"$CLAUDE_SESSION_ID\" --to User\n\n# Check overall status\nsubstrate status\n```\n\n### Starting the Web UI\n\n```bash\nmake run    # Starts substrated with web UI on http://localhost:8080\n```\n\nThe web UI provides a visual inbox, agent status dashboard, review browser, and message composition with diff rendering.\n\n## Message Flow\n\nWhen Agent A sends a message to Agent B, here's what happens:\n\n```mermaid\nsequenceDiagram\n    participant A as Agent A (NobleLion)\n    participant S as Subtrate\n    participant DB as SQLite\n    participant B as Agent B (SilverWolf)\n\n    A->>S: substrate send --to SilverWolf\n    S->>DB: Store message\n    S-->>A: Message sent (ID: 42)\n\n    Note over B: Stop hook runs (every 55s)\n    B->>S: substrate poll\n    S->>DB: Check for unread messages\n    DB-->>S: Message 42 found\n    S-->>B: {\"decision\": \"block\", \"message\": \"...\"}\n\n    Note over B: Agent processes message\n    B->>S: substrate read 42\n    S->>DB: Mark as read\n```\n\nThe Stop hook is the key mechanism. Instead of letting agents exit when idle, it blocks and polls for work. When a message arrives, the hook returns `{\"decision\": \"block\"}` with the message content, which Claude Code interprets as \"there's more to do.\"\n\n## Documentation\n\n| Document | Description |\n|----------|-------------|\n| [Architecture](docs/architecture.md) | System overview, actor model, data model |\n| [Database Schema](docs/schema.md) | ER diagrams, state machines, migration history |\n| [Code Reviews](docs/reviews.md) | Review system workflow, CLI, diff viewer |\n| [CLI Reference](docs/cli-reference.md) | Complete command reference with all flags |\n| [API Reference](docs/api-reference.md) | gRPC services, REST gateway, WebSocket protocol |\n| [Hooks System](docs/HOOKS.md) | How Subtrate integrates with Claude Code hooks |\n| [Message Delivery](docs/delivery.md) | Data model and message state management |\n| [Status Updates](docs/status-updates.md) | Automated status reporting to the User agent |\n| [Roadmap](docs/ROADMAP.md) | Planned features and improvements |\n\n## Agent Identity\n\nAgents get memorable codenames (like `NobleLion` or `SilverWolf`) that persist across sessions. The full identity format is:\n\n```\nCodeName@project.branch\n```\n\nFor example: `NobleLion@subtrate.e2e-testing`\n\nThis makes it easy to identify which agent is working on what, especially when you have multiple agents across different projects.\n\n## Development\n\n### Requirements\n\n- Go 1.22+\n- CGO enabled (for SQLite FTS5)\n- bun (for frontend)\n\n### Common Commands\n\n```bash\nmake build          # Build all packages\nmake build-production # Build with embedded frontend\nmake test           # Run tests\nmake lint           # Run linter\nmake sqlc           # Regenerate database code\nmake proto          # Regenerate gRPC code\nmake run            # Start server with web UI\nmake help           # Show all targets\n```\n\n### Project Structure\n\n```\nsubtrate/\n├── cmd/\n│   ├── substrate/          # CLI tool\n│   │   └── commands/       # Cobra command implementations\n│   ├── substrated/         # Daemon (gRPC + web + optional MCP)\n│   └── merge-sql-schemas/  # Schema merge tool for sqlc\n├── internal/\n│   ├── activity/           # Activity tracking service\n│   ├── actorutil/          # Actor pool and AskAwait helper\n│   ├── agent/              # Agent registry, heartbeat, identity\n│   ├── api/grpc/           # Proto definitions, gRPC server\n│   ├── baselib/actor/      # Core actor system (mailbox, futures)\n│   ├── db/                 # Database layer (sqlc generated)\n│   ├── mail/               # Mail service, notification hub\n│   ├── queue/              # Store-and-forward local queue\n│   ├── review/             # Code review system (FSM + Claude SDK)\n│   ├── store/              # Storage interfaces and implementations\n│   └── web/                # JSON API, WebSocket hub, embedded SPA\n├── web/frontend/           # React + TypeScript SPA (Vite + bun)\n├── docs/                   # Documentation\n└── CLAUDE.md               # AI assistant guidelines\n```\n\n### Architecture Notes\n\nThe mail service uses an actor pattern (based on patterns from [lnd](https://github.com/lightningnetwork/lnd)) where each service runs in its own goroutine and communicates via channels. This provides clean concurrency without shared mutable state.\n\nSQLite runs in WAL mode for concurrent reads and uses FTS5 for full-text search on message content. The database schema uses sqlc for type-safe query generation. See [Database Schema](docs/schema.md) for the full ER diagram and state machines.\n\n## Why \"Subtrate\"?\n\nThe name comes from \"substrate,\" the underlying layer on which things grow. Subtrate provides the communication substrate that enables multi-agent collaboration.\n\n## License\n\nMIT\n"
      },
      "plugins": [
        {
          "name": "substrate",
          "source": "./",
          "description": "Agent command center with mail, reviews, and persistent agent hooks.",
          "version": "1.0.0",
          "categories": [],
          "install_commands": [
            "/plugin marketplace add Roasbeef/substrate",
            "/plugin install substrate@substrate-plugins"
          ]
        }
      ]
    }
  ]
}