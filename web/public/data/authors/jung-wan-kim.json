{
  "author": {
    "id": "jung-wan-kim",
    "display_name": "Hugh Kim",
    "avatar_url": "https://avatars.githubusercontent.com/u/2568504?u=8902ce65effb61272ed2309bfc9e3390c88552ad&v=4"
  },
  "marketplaces": [
    {
      "name": "usage-gate",
      "version": "1.0.0",
      "description": "Auto-switch sub-agent models based on real-time usage percentage",
      "repo_full_name": "jung-wan-kim/usage-gate",
      "repo_url": "https://github.com/jung-wan-kim/usage-gate",
      "repo_description": "Claude Code plugin: auto-switch sub-agent models based on real-time Anthropic usage percentages",
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2026-02-10T02:00:41Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"usage-gate\",\n  \"owner\": {\n    \"name\": \"jung-wankim\",\n    \"email\": \"\"\n  },\n  \"metadata\": {\n    \"description\": \"Auto-switch sub-agent models based on real-time usage percentage\",\n    \"version\": \"1.0.0\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"usage-gate\",\n      \"source\": \"./\",\n      \"description\": \"Tracks Anthropic API usage (5h/7d rolling limits) and automatically blocks opus sub-agent calls when thresholds are exceeded, forcing sonnet fallback. Includes real-time usage display on every prompt.\",\n      \"category\": \"monitoring\",\n      \"tags\": [\n        \"usage\",\n        \"rate-limit\",\n        \"model-switching\",\n        \"cost-optimization\"\n      ]\n    }\n  ],\n  \"version\": \"1.0.0\"\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"usage-gate\",\n  \"version\": \"1.1.0\",\n  \"description\": \"Automatically switches sub-agent models from opus to sonnet based on real-time Anthropic Usage API percentages. Includes a persistent status line showing gate status, thresholds, and fallback models.\",\n  \"author\": {\n    \"name\": \"jung-wankim\"\n  },\n  \"homepage\": \"https://github.com/jung-wankim/usage-gate\",\n  \"repository\": \"https://github.com/jung-wankim/usage-gate\",\n  \"license\": \"MIT\",\n  \"keywords\": [\n    \"usage\",\n    \"rate-limit\",\n    \"model-switching\",\n    \"cost-optimization\",\n    \"opus\",\n    \"sonnet\",\n    \"auto-gate\",\n    \"statusline\"\n  ]\n}\n",
        "README.md": "# usage-gate\n\nA Claude Code plugin that automatically switches sub-agent models from **opus to sonnet/haiku** when your Anthropic API usage approaches rate limits. Fully configurable via interactive setup command.\n\n## How It Works\n\n```\nYou submit a prompt\n  ‚Üì\nusage-tracker.js fetches real-time usage from Anthropic API\n  ‚Üí Caches result (60s TTL)\n  ‚Üí Shows usage warning if approaching threshold\n  ‚Üì\nClaude wants to spawn a sub-agent (Task tool)\n  ‚Üì\nmodel-gate.js checks cached usage\n  ‚Üí Usage < threshold  ‚Üí  ALLOW (opus OK)\n  ‚Üí Usage >= threshold ‚Üí  AUTO-SWITCH model via updatedInput\n  ‚Üì\nTask executes with fallback model (sonnet/haiku) ‚Äî no retry needed\n```\n\n## Installation\n\n```bash\nclaude plugin add /path/to/usage-gate\n```\n\nOr from GitHub:\n\n```bash\nclaude plugin add github:jung-wankim/usage-gate\n```\n\n## Configuration\n\n### Quick Setup (Recommended)\n\nUse the interactive setup command:\n\n```bash\n/usage-gate:setup\n```\n\nThis will guide you through:\n1. **Enable/Disable** - Turn usage-gate on or off\n2. **5H Threshold** - Set 5-hour usage limit and fallback model\n3. **7D Threshold** - Set 7-day usage limit and fallback model\n\nAll settings are saved to `~/.claude/settings.json` automatically.\n\n### Manual Configuration\n\nYou can also manually set thresholds via environment variables in your Claude Code settings:\n\n```json\n// ~/.claude/settings.json\n{\n  \"env\": {\n    \"CLAUDE_USAGE_GATE_ENABLED\": \"true\",\n    \"CLAUDE_OPUS_LIMIT_5H\": \"90\",\n    \"CLAUDE_FALLBACK_MODEL_5H\": \"sonnet\",\n    \"CLAUDE_OPUS_LIMIT_7D\": \"90\",\n    \"CLAUDE_FALLBACK_MODEL_7D\": \"sonnet\",\n    \"CLAUDE_USAGE_CACHE_TTL\": \"60\"\n  }\n}\n```\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| `CLAUDE_USAGE_GATE_ENABLED` | `true` | Enable/disable the usage gate |\n| `CLAUDE_OPUS_LIMIT_5H` | `90` | 5-hour usage threshold (%) |\n| `CLAUDE_FALLBACK_MODEL_5H` | `sonnet` | Model to use when 5H limit exceeded (`sonnet` or `haiku`) |\n| `CLAUDE_OPUS_LIMIT_7D` | `90` | 7-day usage threshold (%) |\n| `CLAUDE_FALLBACK_MODEL_7D` | `sonnet` | Model to use when 7D limit exceeded (`sonnet` or `haiku`) |\n| `CLAUDE_USAGE_CACHE_TTL` | `60` | API cache TTL (seconds) |\n\n### Configuration Strategies\n\n**Conservative** (Recommended - Early switch, maximize cost savings):\n- 5H: 70% ‚Üí sonnet\n- 7D: 70% ‚Üí sonnet\n\n**Balanced**:\n- 5H: 80% ‚Üí sonnet\n- 7D: 80% ‚Üí sonnet\n\n**Aggressive** (Use opus as much as possible):\n- 5H: 90% ‚Üí sonnet\n- 7D: 90% ‚Üí sonnet\n\n**Very Aggressive** (Almost no limits):\n- 5H: 95% ‚Üí haiku\n- 7D: 95% ‚Üí haiku\n\n## Status Line\n\nusage-gate includes a persistent status line that displays gate status under the Claude Code prompt.\n\n### Standalone Mode\n\n```json\n// ~/.claude/settings.json\n{\n  \"statusLine\": {\n    \"type\": \"command\",\n    \"command\": \"node ~/.claude/plugins/cache/usage-gate/usage-gate/1.0.0/statusline/index.js\"\n  }\n}\n```\n\n### Chain Mode (with claude-dashboard)\n\nRun alongside another statusline plugin by setting `USAGE_GATE_CHAIN_CMD`:\n\n```json\n// ~/.claude/settings.json\n{\n  \"env\": {\n    \"USAGE_GATE_CHAIN_CMD\": \"node ~/.claude/plugins/cache/claude-dashboard/claude-dashboard/1.3.0/dist/index.js\"\n  },\n  \"statusLine\": {\n    \"type\": \"command\",\n    \"command\": \"node ~/.claude/plugins/cache/usage-gate/usage-gate/1.0.0/statusline/index.js\"\n  }\n}\n```\n\n**Output example** (chain mode):\n```\nü§ñ Opus ‚îÇ ‚ñë‚ñë‚ñë‚ñë‚ñë ‚îÇ 30% ‚îÇ 60K/200K ‚îÇ $1.25 ‚îÇ 5h: 26% ‚îÇ 7d: 80%   ‚Üê claude-dashboard\n‚è± 3Î∂Ñ ‚îÇ üî• 2/min                                                  ‚Üê claude-dashboard\nGate ACTIVE ‚îÇ 5h 25%/70% ‚îÇ 7d 80%/70% ‚ÜíS                          ‚Üê usage-gate\n```\n\n### Status Indicators\n\n| Display | Meaning |\n|---------|---------|\n| `Gate standby` (green) | Gate enabled, usage below all thresholds |\n| `Gate ACTIVE` (orange/red) | Usage exceeded a threshold, auto-switching active |\n| `Gate OFF` | Gate disabled via settings |\n| `‚ÜíS` | Fallback to Sonnet |\n| `‚ÜíH` | Fallback to Haiku |\n\n## Slash Commands\n\n- `/usage-gate:setup` - **Interactive configuration** - Set thresholds, fallback models, and enable/disable the gate\n\n## Requirements\n\n- **Claude Code** with plugin support\n- **Node.js** (bundled with Claude Code)\n- **macOS**, **Linux**, or **Windows**\n\nNo additional dependencies needed. Uses only Node.js built-in modules.\n\n### Authentication\n\nThe plugin retrieves your OAuth token automatically:\n\n1. **Environment variable**: `ANTHROPIC_ACCESS_TOKEN` (all platforms)\n2. **macOS Keychain**: Reads from `Claude Code-credentials` (automatic)\n3. **Windows Credential Manager**: Reads from stored credentials (automatic)\n4. **Credential files**: `~/.claude/credentials.json` or `~/.config/claude/credentials.json` (Linux)\n\n## How the Gate Works\n\nWhen usage exceeds the threshold, the hook **automatically injects** the fallback model into the Task parameters using `updatedInput`. No blocking, no retry ‚Äî the model is switched transparently in a single call.\n\n1. Claude calls `Task({ subagent_type: \"...\", prompt: \"...\" })`\n2. The PreToolUse hook detects usage exceeds threshold\n3. Hook injects `model: \"sonnet\"` (or `\"haiku\"`) into the Task parameters via `updatedInput`\n4. Task executes immediately with the fallback model\n\nNo retry, no error message, no user intervention needed.\n\n### Smart Fallback Selection\n\n- **5H limit exceeded** ‚Üí Auto-injects `CLAUDE_FALLBACK_MODEL_5H` (default: `sonnet`)\n- **7D limit exceeded** ‚Üí Auto-injects `CLAUDE_FALLBACK_MODEL_7D` (default: `sonnet`)\n- **Both exceeded** ‚Üí Uses the 7D fallback (more conservative choice)\n- **Already using sonnet/haiku** ‚Üí Passes through unchanged\n\n### Disabling the Gate\n\nSet `CLAUDE_USAGE_GATE_ENABLED=false` to temporarily disable the gate without removing the plugin. Usage tracking will continue, but no model switching will occur.\n\n## License\n\nMIT\n"
      },
      "plugins": [
        {
          "name": "usage-gate",
          "source": "./",
          "description": "Tracks Anthropic API usage (5h/7d rolling limits) and automatically blocks opus sub-agent calls when thresholds are exceeded, forcing sonnet fallback. Includes real-time usage display on every prompt.",
          "category": "monitoring",
          "tags": [
            "usage",
            "rate-limit",
            "model-switching",
            "cost-optimization"
          ],
          "categories": [
            "cost-optimization",
            "model-switching",
            "monitoring",
            "rate-limit",
            "usage"
          ],
          "install_commands": [
            "/plugin marketplace add jung-wan-kim/usage-gate",
            "/plugin install usage-gate@usage-gate"
          ]
        }
      ]
    }
  ]
}