{
  "author": {
    "id": "sunshowers",
    "display_name": "Rain",
    "avatar_url": "https://avatars.githubusercontent.com/u/180618?u=9847fd73393e49534529fc1cda3d2bd421474b43&v=4"
  },
  "marketplaces": [
    {
      "name": "lspmux-plugins",
      "version": null,
      "description": "Rust LSP via lspmux multiplexer for shared rust-analyzer instances",
      "repo_full_name": "sunshowers/lspmux-rust-analyzer",
      "repo_url": "https://github.com/sunshowers/lspmux-rust-analyzer",
      "repo_description": "lspmux + rust-analyzer, with auto-updates to latest r-a releases",
      "signals": {
        "stars": 5,
        "forks": 0,
        "pushed_at": "2026-01-29T03:18:11Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"lspmux-plugins\",\n  \"owner\": {\n    \"name\": \"rain\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"lspmux-rust\",\n      \"source\": \"./plugins/lspmux-rust\",\n      \"description\": \"Rust LSP via lspmux multiplexer for shared rust-analyzer instances\"\n    }\n  ]\n}\n",
        "README.md": "# lspmux-rust-analyzer\n\nWARNING: This is mostly vibe coded and works for me (Rain) personally. This may\nor may not work for you.\n\nUses [lspmux](https://codeberg.org/p2502/lspmux), a Language Server Protocol multiplexer, to share\na single rust-analyzer instance across multiple LSP clients. This reduces memory and CPU usage when\nrunning multiple editors or Claude Code sessions on the same workspace.\n\n## Problem\n\nEach LSP client (editor, Claude Code session, etc.) spawns its own rust-analyzer\nprocess. On systems running multiple editors, this causes significant memory\npressure since rust-analyzer is memory-intensive.\n\n## Solution\n\nlspmux acts as an intermediary between LSP clients and language servers:\n\n```\n┌──────────────┐  ┌──────────────┐  ┌──────────────┐\n│  Claude Code │  │     Zed      │  │    Neovim    │\n│ (LSP client) │  │ (LSP client) │  │ (LSP client) │\n└──────┬───────┘  └──────┬───────┘  └──────┬───────┘\n       │                 │                 │\n       │ stdio           │ stdio           │ stdio\n       ▼                 ▼                 ▼\n┌────────────────────────────────────────────────────┐\n│              lspmux client shim                    │\n│        (invoked as \"rust-analyzer\")                │\n└────────────────────────┬───────────────────────────┘\n                         │ socket (localhost:27631)\n                         ▼\n┌────────────────────────────────────────────────────┐\n│              lspmux server                         │\n│        (systemd user service)                      │\n└────────────────────────┬───────────────────────────┘\n                         │ manages\n                         ▼\n┌────────────────────────────────────────────────────┐\n│       rust-analyzer (one per workspace)            │\n└────────────────────────────────────────────────────┘\n```\n\n## Quick start\n\n```bash\n./setup\n```\n\nThe setup script:\n1. Downloads rust-analyzer from GitHub releases (with SHA256 verification)\n2. Installs lspmux via `cargo install --locked` if not found\n3. Installs systemd services (Linux) or launchd agents (macOS)\n\nAfter setup completes, configure your editor (see below).\n\n## Editor configuration\n\n### Claude Code\n\n```bash\nclaude plugin marketplace add /path/to/lspmux-rust-analyzer\nclaude plugin disable rust-analyzer-lsp@claude-plugins-official --scope user\nclaude plugin install lspmux-rust@lspmux-plugins --scope user\n```\n\n### Zed\n\nIn `~/.config/zed/settings.json`:\n\n```json\n{\n  \"lsp\": {\n    \"rust-analyzer\": {\n      \"binary\": {\n        \"path\": \"lspmux\",\n        \"arguments\": [\"client\", \"--server-path\", \"/path/to/.local/share/lspmux-rust-analyzer/current/rust-analyzer\"]\n      }\n    }\n  }\n}\n```\n\nReplace `/path/to` with the actual path (e.g., `/home/username` or the value of `$HOME`).\n\n### Neovim (untested)\n\nWith [nvim-lspconfig](https://github.com/neovim/nvim-lspconfig):\n\n```lua\nrequire('lspconfig').rust_analyzer.setup {\n  cmd = {\n    \"lspmux\", \"client\", \"--server-path\",\n    vim.fn.expand(\"$HOME/.local/share/lspmux-rust-analyzer/current/rust-analyzer\")\n  },\n}\n```\n\nOr if using [rustaceanvim](https://github.com/mrcjkb/rustaceanvim):\n\n```lua\nvim.g.rustaceanvim = {\n  server = {\n    cmd = function()\n      return {\n        \"lspmux\", \"client\", \"--server-path\",\n        vim.fn.expand(\"$HOME/.local/share/lspmux-rust-analyzer/current/rust-analyzer\")\n      }\n    end,\n  },\n}\n```\n\n### Vim (untested)\n\nWith [vim-lsp](https://github.com/prabirshrestha/vim-lsp):\n\n```vim\nif executable('lspmux')\n  au User lsp_setup call lsp#register_server({\n    \\ 'name': 'rust-analyzer',\n    \\ 'cmd': ['lspmux', 'client', '--server-path', expand('$HOME/.local/share/lspmux-rust-analyzer/current/rust-analyzer')],\n    \\ 'allowlist': ['rust'],\n    \\ })\nendif\n```\n\nWith [coc.nvim](https://github.com/neoclide/coc.nvim), in `coc-settings.json`:\n\n```json\n{\n  \"languageserver\": {\n    \"rust-analyzer\": {\n      \"command\": \"lspmux\",\n      \"args\": [\"client\", \"--server-path\", \"/path/to/.local/share/lspmux-rust-analyzer/current/rust-analyzer\"],\n      \"filetypes\": [\"rust\"]\n    }\n  }\n}\n```\n\n## Requirements\n\n- Linux (systemd) or macOS (launchd)\n- Rust toolchain (for `cargo install`)\n- curl, jq\n\n## Directory structure\n\nAll paths respect the XDG base directory specification:\n\n### rust-analyzer\n\n| Purpose | Default path |\n|---------|--------------|\n| Binary versions | `$XDG_DATA_HOME/lspmux-rust-analyzer/versions/` or `~/.local/share/lspmux-rust-analyzer/versions/` |\n| Active version | `$XDG_DATA_HOME/lspmux-rust-analyzer/current` or `~/.local/share/lspmux-rust-analyzer/current` (symlink) |\n| Update script | `$XDG_DATA_HOME/lspmux-rust-analyzer/bin/update-rust-analyzer` or `~/.local/share/lspmux-rust-analyzer/bin/update-rust-analyzer` |\n| Update log | `$XDG_STATE_HOME/lspmux-rust-analyzer/update.log` or `~/.local/state/lspmux-rust-analyzer/update.log` |\n\n### lspmux\n\n| Purpose | Default path |\n|---------|--------------|\n| Binary | `$CARGO_HOME/bin/lspmux` or `~/.cargo/bin/lspmux` |\n| Config | `$XDG_CONFIG_HOME/lspmux/config.toml` or `~/.config/lspmux/config.toml` |\n| Log (macOS) | `$XDG_STATE_HOME/lspmux/server.log` or `~/.local/state/lspmux/server.log` |\n\n### Services\n\n| Platform | Path |\n|----------|------|\n| Linux | `$XDG_CONFIG_HOME/systemd/user/` or `~/.config/systemd/user/` |\n| macOS | `~/Library/LaunchAgents/` |\n\n## Managing services\n\n### lspmux server\n\n**Linux (systemd):**\n```bash\nsystemctl --user status lspmux\nsystemctl --user restart lspmux\njournalctl --user -u lspmux -f\n```\n\n**macOS (launchd):**\n```bash\nlaunchctl list | grep lspmux\nlaunchctl stop com.lspmux.server\nlaunchctl start com.lspmux.server\ntail -f \"${XDG_STATE_HOME:-$HOME/.local/state}/lspmux/server.log\"\n```\n\n### Automatic updates\n\nA daily timer/agent updates rust-analyzer to the latest release.\n\n**Linux:**\n```bash\nsystemctl --user status rust-analyzer-update.timer\nsystemctl --user start rust-analyzer-update.service  # manual update\n```\n\n**macOS:**\n```bash\n# Manual update\n\"${XDG_DATA_HOME:-$HOME/.local/share}/lspmux-rust-analyzer/bin/update-rust-analyzer\"\n```\n\n## Configuration\n\n### lspmux config\n\n`${XDG_CONFIG_HOME:-$HOME/.config}/lspmux/config.toml`:\n```toml\ninstance_timeout = 300       # Keep server for 5 min after last client\ngc_interval = 10             # Check for idle servers every 10 sec\nlisten = [\"127.0.0.1\", 27631]\nconnect = [\"127.0.0.1\", 27631]\npass_environment = [\"CARGO_HOME\", \"RUSTUP_HOME\", \"PATH\", \"HOME\", \"USER\"]\n```\n\n## Troubleshooting\n\n### LSP not working\n\n1. Check lspmux server is running:\n   ```bash\n   systemctl --user status lspmux  # Linux\n   launchctl list | grep lspmux    # macOS\n   ```\n\n2. Check rust-analyzer works:\n   ```bash\n   \"${XDG_DATA_HOME:-$HOME/.local/share}/lspmux-rust-analyzer/current/rust-analyzer\" --version\n   ```\n\n3. Check lspmux can connect:\n   ```bash\n   echo '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"initialize\",\"params\":{}}' | \\\n     lspmux client --server-path \"${XDG_DATA_HOME:-$HOME/.local/share}/lspmux-rust-analyzer/current/rust-analyzer\"\n   ```\n   You should see JSON output. Press Ctrl+C to exit.\n\n4. For Claude Code, check the plugin is installed:\n   ```bash\n   claude plugin list\n   ```\n\n### Multiple rust-analyzer processes\n\nVerify only one rust-analyzer is running per workspace:\n```bash\npgrep -a rust-analyzer\n```\n\nIf multiple processes exist, lspmux may not be configured correctly in your editor.\n\n## Uninstall\n\n```bash\n# Uninstall Claude Code plugin and marketplace\nclaude plugin uninstall lspmux-rust@lspmux-plugins --scope user\nclaude plugin marketplace remove lspmux-plugins\nclaude plugin enable rust-analyzer-lsp@claude-plugins-official --scope user\n\n# Stop services (Linux)\nsystemctl --user disable --now lspmux.service rust-analyzer-update.timer\n\n# Stop services (macOS)\nlaunchctl unload ~/Library/LaunchAgents/com.lspmux.server.plist\nlaunchctl unload ~/Library/LaunchAgents/com.rust-analyzer.update.plist\n\n# Remove files\nrm -rf \"${XDG_DATA_HOME:-$HOME/.local/share}/lspmux-rust-analyzer\"\nrm -rf \"${XDG_STATE_HOME:-$HOME/.local/state}/lspmux-rust-analyzer\"\nrm -rf \"${XDG_STATE_HOME:-$HOME/.local/state}/lspmux\"\nrm -rf \"${XDG_CONFIG_HOME:-$HOME/.config}/lspmux\"\nrm -rf \"${XDG_CONFIG_HOME:-$HOME/.config}/systemd/user/lspmux.service\"\nrm -rf \"${XDG_CONFIG_HOME:-$HOME/.config}/systemd/user/rust-analyzer-update.\"*\nrm -rf ~/Library/LaunchAgents/com.lspmux.server.plist\nrm -rf ~/Library/LaunchAgents/com.rust-analyzer.update.plist\n```\n\n## License\n\nMIT\n",
        "plugins/lspmux-rust/README.md": "# lspmux-rust Claude plugin\n\nThis plugin configures Claude Code to use rust-analyzer through lspmux, enabling\nmultiple Claude sessions to share a single rust-analyzer instance per workspace.\n\n## Requirements\n\n- lspmux server must be running (`systemctl --user status lspmux` on Linux)\n- rust-analyzer must be in PATH (installed via the setup script)\n\n## Installation\n\nInstall via the lspmux-plugins marketplace:\n\n```bash\n# Add the marketplace\nclaude plugin marketplace add /path/to/lspmux-rust-analyzer\n\n# Disable the official rust-analyzer plugin\nclaude plugin disable rust-analyzer-lsp@claude-plugins-official --scope user\n\n# Install this plugin\nclaude plugin install lspmux-rust@lspmux-plugins --scope user\n```\n\n## How it works\n\nInstead of spawning rust-analyzer directly, this plugin invokes `lspmux client`,\nwhich connects to the lspmux server over a local socket. The server manages\nrust-analyzer instances, creating one per workspace and sharing it across all\nconnected clients.\n"
      },
      "plugins": [
        {
          "name": "lspmux-rust",
          "source": "./plugins/lspmux-rust",
          "description": "Rust LSP via lspmux multiplexer for shared rust-analyzer instances",
          "categories": [],
          "install_commands": [
            "/plugin marketplace add sunshowers/lspmux-rust-analyzer",
            "/plugin install lspmux-rust@lspmux-plugins"
          ]
        }
      ]
    }
  ]
}