{
  "author": {
    "id": "s-hiraoku",
    "display_name": "Hiraoku Shinichi",
    "avatar_url": "https://avatars.githubusercontent.com/u/18750282?u=3048275db2ce954aa6283f02d52ac70a958958f3&v=4"
  },
  "marketplaces": [
    {
      "name": "synapse-a2a",
      "version": null,
      "description": "Plugins for Synapse A2A - Multi-agent communication framework enabling Claude Code, Codex, and Gemini to collaborate via Google A2A Protocol",
      "repo_full_name": "s-hiraoku/synapse-a2a",
      "repo_url": "https://github.com/s-hiraoku/synapse-a2a",
      "repo_description": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2026-02-01T08:36:28Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"$schema\": \"https://anthropic.com/claude-code/marketplace.schema.json\",\n  \"name\": \"synapse-a2a\",\n  \"description\": \"Plugins for Synapse A2A - Multi-agent communication framework enabling Claude Code, Codex, and Gemini to collaborate via Google A2A Protocol\",\n  \"owner\": {\n    \"name\": \"s-hiraoku\",\n    \"email\": \"s.hiraoku@gmail.com\"\n  },\n  \"metadata\": {\n    \"version\": \"0.2.0\",\n    \"repository\": \"https://github.com/s-hiraoku/synapse-a2a\",\n    \"license\": \"MIT\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"synapse-a2a\",\n      \"description\": \"Complete plugin for Synapse A2A multi-agent framework including inter-agent communication, task delegation, file safety, and history management\",\n      \"source\": \"./plugins/synapse-a2a\",\n      \"strict\": false\n    }\n  ]\n}\n",
        "README.md": "# Synapse A2A\n\n**üåê Language: [English](README.md) | [Êó•Êú¨Ë™û](README.ja.md)**\n\n> **Enable agents to collaborate on tasks without changing their behavior**\n\n[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)\n[![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)\n[![Tests](https://img.shields.io/badge/tests-1389%20passed-brightgreen.svg)](#testing)\n[![Ask DeepWiki](https://img.shields.io/badge/Ask-DeepWiki-blue)](https://deepwiki.com/s-hiraoku/synapse-a2a)\n\n> A framework that enables inter-agent collaboration via the Google A2A Protocol while keeping CLI agents (Claude Code, Codex, Gemini, OpenCode, GitHub Copilot CLI) **exactly as they are**\n\n## Project Goals\n\n```text\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  ‚úÖ Non-Invasive: Don't change agent behavior                   ‚îÇ\n‚îÇ  ‚úÖ Collaborative: Enable agents to work together               ‚îÇ\n‚îÇ  ‚úÖ Transparent: Maintain existing workflows                    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\nSynapse A2A **transparently wraps** each agent's input/output without modifying the agent itself. This means:\n\n- **Leverage each agent's strengths**: Users can freely assign roles and specializations\n- **Zero learning curve**: Continue using existing workflows\n- **Future-proof**: Resistant to agent updates\n\nSee [Project Philosophy](docs/project-philosophy.md) for details.\n\n```mermaid\nflowchart LR\n    subgraph Terminal1[\"Terminal 1\"]\n        subgraph Agent1[\"synapse claude :8100\"]\n            Server1[\"A2A Server\"]\n            PTY1[\"PTY + Claude CLI\"]\n        end\n    end\n    subgraph Terminal2[\"Terminal 2\"]\n        subgraph Agent2[\"synapse codex :8120\"]\n            Server2[\"A2A Server\"]\n            PTY2[\"PTY + Codex CLI\"]\n        end\n    end\n    subgraph External[\"External\"]\n        ExtAgent[\"Google A2A Agent\"]\n    end\n\n    Server1 <-->|\"POST /tasks/send\"| Server2\n    Server1 <-->|\"A2A Protocol\"| ExtAgent\n    Server2 <-->|\"A2A Protocol\"| ExtAgent\n```\n\n---\n\n## Table of Contents\n\n- [Features](#features)\n- [Prerequisites](#prerequisites)\n- [Quick Start](#quick-start)\n- [Use Cases](#use-cases)\n- [Skills](#skills)\n- [Documentation](#documentation)\n- [Architecture](#architecture)\n- [CLI Commands](#cli-commands)\n- [API Endpoints](#api-endpoints)\n- [Task Structure](#task-structure)\n- [Sender Identification](#sender-identification)\n- [Priority Levels](#priority-levels)\n- [Agent Card](#agent-card)\n- [Registry and Port Management](#registry-and-port-management)\n- [File Safety](#file-safety)\n- [Agent Monitor](#agent-monitor)\n- [Testing](#testing)\n- [Configuration (.synapse)](#configuration-synapse)\n- [Development & Release](#development--release)\n\n---\n\n## Features\n\n| Category | Feature |\n| -------- | ------- |\n| **A2A Compliant** | All communication uses Message/Part + Task format, Agent Card discovery |\n| **CLI Integration** | Turn existing CLI tools into A2A agents without modification |\n| **synapse send** | Send messages between agents via `synapse send <agent> \"message\"` |\n| **Sender Identification** | Auto-identify sender via `metadata.sender` + PID matching |\n| **Priority Interrupt** | Priority 5 sends SIGINT before message (emergency stop) |\n| **Multi-Instance** | Run multiple agents of the same type (automatic port assignment) |\n| **External Integration** | Communicate with other Google A2A agents |\n| **Task Delegation** | Auto-forward tasks to other agents via natural language rules |\n| **File Safety** | Prevent multi-agent conflicts with file locking and change tracking (visible in `synapse list`) |\n| **Agent Naming** | Custom names and roles for easy identification (`synapse send my-claude \"hello\"`) |\n| **Agent Monitor** | Real-time status (READY/WAITING/PROCESSING/DONE), CURRENT task preview, terminal jump |\n| **Task History** | Automatic task tracking with search, export, and statistics (enabled by default) |\n\n---\n\n## Prerequisites\n\n- **OS**: macOS / Linux (Windows via WSL2 recommended)\n- **Python**: 3.10+\n- **CLI Tools**: Pre-install and configure the agents you want to use:\n  - [Claude Code](https://docs.anthropic.com/en/docs/claude-code)\n  - [Codex CLI](https://github.com/openai/codex)\n  - [Gemini CLI](https://github.com/google-gemini/gemini-cli)\n  - [OpenCode](https://github.com/opencode-ai/opencode)\n  - [GitHub Copilot CLI](https://docs.github.com/en/copilot/github-copilot-in-the-cli)\n\n---\n\n## Quick Start\n\n### 1. Install Synapse A2A\n\n```bash\n# Install from PyPI (recommended)\npip install synapse-a2a\n\n# With gRPC support\npip install \"synapse-a2a[grpc]\"\n```\n\nFor developers (editing this repository):\n\n```bash\n# Install with uv\nuv sync\n\n# Or pip (editable)\npip install -e .\n```\n\n### 2. Install Skills (Recommended)\n\n**Installing skills is strongly recommended to get the most out of Synapse A2A.**\n\nSkills help Claude automatically understand Synapse A2A features: @agent messaging, task delegation, File Safety, and more.\n\n```bash\n# Install via skills.sh (https://skills.sh/)\nnpx skills add s-hiraoku/synapse-a2a\n```\n\nSee [Skills](#skills) for details.\n\n### 3. Start Agents\n\n```bash\n# Terminal 1: Claude\nsynapse claude\n\n# Terminal 2: Codex\nsynapse codex\n\n# Terminal 3: Gemini\nsynapse gemini\n\n# Terminal 4: OpenCode\nsynapse opencode\n\n# Terminal 5: GitHub Copilot CLI\nsynapse copilot\n```\n\n> Note: If terminal scrollback display is garbled, try:\n> ```bash\n> uv run synapse gemini\n> # or\n> uv run python -m synapse.cli gemini\n> ```\n\nPorts are auto-assigned:\n\n| Agent    | Port Range |\n| -------- | ---------- |\n| Claude   | 8100-8109  |\n| Gemini   | 8110-8119  |\n| Codex    | 8120-8129  |\n| OpenCode | 8130-8139  |\n| Copilot  | 8140-8149  |\n\n### 4. Inter-Agent Communication\n\nUse `synapse send` to send messages between agents:\n\n```bash\nsynapse send codex \"Please review this design\" --from claude\nsynapse send gemini \"Suggest API improvements\" --from claude\n```\n\nFor multiple instances of the same type, use type-port format:\n\n```bash\nsynapse send codex-8120 \"Handle this task\" --from claude\nsynapse send codex-8121 \"Handle that task\" --from claude\n```\n\n### 5. HTTP API\n\n```bash\n# Send message\ncurl -X POST http://localhost:8100/tasks/send \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"message\": {\"role\": \"user\", \"parts\": [{\"type\": \"text\", \"text\": \"Hello!\"}]}}'\n\n# Emergency stop (Priority 5)\ncurl -X POST \"http://localhost:8100/tasks/send-priority?priority=5\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"message\": {\"role\": \"user\", \"parts\": [{\"type\": \"text\", \"text\": \"Stop!\"}]}}'\n```\n\n---\n\n## Use Cases\n\n### 1. Instant Specification Lookup (Simple)\nWhile coding with **Claude**, quickly query **Gemini** (better at web search) for the latest library specs or error info without context switching.\n\n```bash\n# In Claude's terminal:\nsynapse send gemini \"Summarize the new f-string features in Python 3.12\" --from claude\n```\n\n### 2. Cross-Review Designs (Intermediate)\nGet feedback on your design from agents with different perspectives.\n\n```bash\n# After Claude drafts a design:\nsynapse send gemini \"Critically review this design from scalability and maintainability perspectives\" --from claude\n```\n\n### 3. TDD Pair Programming (Intermediate)\nSeparate \"test writer\" and \"implementer\" for robust code.\n\n```bash\n# Terminal 1 (Codex):\nCreate unit tests for auth.py - normal case and token expiration case.\n\n# Terminal 2 (Claude):\nsynapse send codex-8120 \"Implement auth.py to pass the tests you created\" --from claude\n```\n\n### 4. Security Audit (Specialized)\nHave an agent with a security expert role audit your code before committing.\n\n```bash\n# Give Gemini a role:\nYou are a security engineer. Review only for vulnerabilities (SQLi, XSS, etc.)\n\n# After writing code:\nsynapse send gemini \"Audit the current changes (git diff)\" --from claude\n```\n\n### 5. Auto-Fix from Error Logs (Advanced)\nPass error logs to an agent for automatic fix suggestions.\n\n```bash\n# Tests failed...\npytest > error.log\n\n# Ask agent to fix\nsynapse send claude \"Read error.log and fix the issue in synapse/server.py\" --from gemini\n```\n\n### 6. Language/Framework Migration (Advanced)\nDistribute large refactoring work across agents.\n\n```bash\n# Terminal 1 (Claude):\nRead legacy_api.js and create TypeScript type definitions\n\n# Terminal 2 (Codex):\nsynapse send claude \"Use the type definitions you created to rewrite legacy_api.js to src/new_api.ts\" --from codex\n```\n\n### Comparison with SSH Remote\n\n| Operation | SSH | Synapse |\n|-----------|-----|---------|\n| Manual CLI operation | ‚óé | ‚óé |\n| Programmatic task submission | ‚ñ≥ requires expect etc. | ‚óé HTTP API |\n| Multiple simultaneous clients | ‚ñ≥ multiple sessions | ‚óé single endpoint |\n| Real-time progress notifications | ‚úó | ‚óé SSE/Webhook |\n| Automatic inter-agent coordination | ‚úó | ‚óé synapse send |\n\n> **Note**: SSH is often sufficient for individual CLI use. Synapse shines when you need automation, coordination, and multi-agent collaboration.\n\n---\n\n## Skills\n\n**Installing skills is strongly recommended** when using Synapse A2A with Claude Code.\n\n### Why Install Skills?\n\nWith skills installed, Claude automatically understands and executes:\n\n- **synapse send**: Inter-agent communication via `synapse send codex \"Fix this\" --from claude`\n- **Priority control**: Message sending with Priority 1-5 (5 = emergency stop)\n- **Task delegation**: Automatic task routing with `delegation.enabled`\n- **File Safety**: Prevent multi-agent conflicts with file locking and change tracking\n- **History management**: Search, export, and statistics for task history\n\n### Installation\n\n```bash\n# Install via skills.sh (https://skills.sh/)\nnpx skills add s-hiraoku/synapse-a2a\n```\n\n### Included Skills\n\n| Skill | Description |\n|-------|-------------|\n| **synapse-a2a** | Comprehensive guide for inter-agent communication: `synapse send`, priority, A2A protocol, history, File Safety, settings |\n| **delegation** | Automatic task delegation setup: `delegation.enabled`, pre-checks, error handling, File Safety integration |\n\n### Directory Structure\n\n```text\nplugins/\n‚îî‚îÄ‚îÄ synapse-a2a/\n    ‚îú‚îÄ‚îÄ .claude-plugin/plugin.json\n    ‚îú‚îÄ‚îÄ README.md\n    ‚îî‚îÄ‚îÄ skills/\n        ‚îú‚îÄ‚îÄ synapse-a2a/SKILL.md\n        ‚îî‚îÄ‚îÄ delegation/SKILL.md\n```\n\nSee [plugins/synapse-a2a/README.md](plugins/synapse-a2a/README.md) for details.\n\n> **Note**: Codex and Gemini don't support plugins, but you can place expanded skills in the `.codex/skills/` or `.gemini/skills/` directory respectively to enable these features.\n\n---\n\n## Documentation\n\n- [guides/README.md](guides/README.md) - Documentation overview\n- [guides/multi-agent-setup.md](guides/multi-agent-setup.md) - Setup guide\n- [guides/usage.md](guides/usage.md) - Commands and usage patterns\n- [guides/settings.md](guides/settings.md) - `.synapse` configuration details\n- [guides/troubleshooting.md](guides/troubleshooting.md) - Common issues and solutions\n\n---\n\n## Architecture\n\n### A2A Server/Client Structure\n\nIn Synapse, **each agent operates as an A2A server**. There's no central server; it's a P2P architecture.\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  synapse claude (port 8100)         ‚îÇ    ‚îÇ  synapse codex (port 8120)          ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ    ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ  FastAPI Server (A2A Server)  ‚îÇ  ‚îÇ    ‚îÇ  ‚îÇ  FastAPI Server (A2A Server)  ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  /.well-known/agent.json      ‚îÇ  ‚îÇ    ‚îÇ  ‚îÇ  /.well-known/agent.json      ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  /tasks/send                  ‚îÇ‚óÑ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÇ  A2AClient                    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  /tasks/{id}                  ‚îÇ  ‚îÇ    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ    ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ    ‚îÇ  ‚îÇ  PTY + Codex CLI              ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  PTY + Claude CLI             ‚îÇ  ‚îÇ    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\nEach agent is:\n\n- **A2A Server**: Accepts requests from other agents\n- **A2A Client**: Sends requests to other agents\n\n### Key Components\n\n| Component | File | Role |\n| --------- | ---- | ---- |\n| FastAPI Server | `synapse/server.py` | Provides A2A endpoints |\n| A2A Router | `synapse/a2a_compat.py` | A2A protocol implementation |\n| A2A Client | `synapse/a2a_client.py` | Communication with other agents |\n| TerminalController | `synapse/controller.py` | PTY management, READY/PROCESSING detection |\n| InputRouter | `synapse/input_router.py` | @Agent pattern detection |\n| AgentRegistry | `synapse/registry.py` | Agent registration and lookup |\n\n### Startup Sequence\n\n```mermaid\nsequenceDiagram\n    participant Synapse as Synapse Server\n    participant Registry as AgentRegistry\n    participant PTY as TerminalController\n    participant CLI as CLI Agent\n\n    Synapse->>Registry: 1. Register agent (agent_id, pid, port)\n    Synapse->>PTY: 2. Start PTY\n    PTY->>CLI: 3. Start CLI agent\n    Synapse->>PTY: 4. Send initial instructions (sender: synapse-system)\n    PTY->>CLI: 5. AI receives initial instructions\n```\n\n### Communication Flow\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant Claude as Claude (8100)\n    participant Client as A2AClient\n    participant Codex as Codex (8120)\n\n    User->>Claude: @codex Review this design\n    Claude->>Client: send_to_local()\n    Client->>Codex: POST /tasks/send-priority\n    Codex->>Codex: Create Task ‚Üí Write to PTY\n    Codex-->>Client: {\"task\": {\"id\": \"...\", \"status\": \"working\"}}\n    Client-->>Claude: [‚Üí codex] Send complete\n```\n\n---\n\n## CLI Commands\n\n### Basic Operations\n\n```bash\n# Start agent (foreground)\nsynapse claude\nsynapse codex\nsynapse gemini\nsynapse opencode\nsynapse copilot\n\n# Start with custom name and role\nsynapse claude --name my-claude --role \"code reviewer\"\n\n# Skip interactive name/role setup\nsynapse claude --no-setup\n\n# Specify port\nsynapse claude --port 8105\n\n# Pass arguments to CLI tool\nsynapse claude -- --resume\n```\n\n### Agent Naming\n\nAssign custom names and roles to agents for easier identification and management:\n\n```bash\n# Interactive setup (default when starting agent)\nsynapse claude\n# ‚Üí Prompts for name and role\n\n# Skip interactive setup\nsynapse claude --no-setup\n\n# Set name and role via CLI options\nsynapse claude --name my-claude --role \"code reviewer\"\n\n# After agent is running, change name/role\nsynapse rename synapse-claude-8100 --name my-claude --role \"test writer\"\nsynapse rename my-claude --role \"documentation\"  # Change role only\nsynapse rename my-claude --clear                 # Clear name and role\n```\n\nOnce named, use the custom name for all operations:\n\n```bash\nsynapse send my-claude \"Review this code\" --from codex\nsynapse jump my-claude\nsynapse kill my-claude\n```\n\n**Name vs ID:**\n- **Display/Prompts**: Shows name if set, otherwise ID (e.g., `Kill my-claude (PID: 1234)?`)\n- **Internal processing**: Always uses agent ID (`synapse-claude-8100`)\n- **Target resolution**: Name has highest priority when matching targets\n\n### Command List\n\n| Command | Description |\n| ------- | ----------- |\n| `synapse <profile>` | Start in foreground |\n| `synapse start <profile>` | Start in background |\n| `synapse stop <profile\\|id>` | Stop agent (can specify ID) |\n| `synapse kill <target>` | Kill agent immediately |\n| `synapse jump <target>` | Jump to agent's terminal |\n| `synapse rename <target>` | Assign name/role to agent |\n| `synapse --version` | Show version |\n| `synapse list` | List running agents (Rich TUI with auto-refresh and terminal jump) |\n| `synapse logs <profile>` | Show logs |\n| `synapse send <target> <message>` | Send message |\n| `synapse reply <message>` | Reply to the last received A2A message |\n| `synapse instructions show` | Show instruction content |\n| `synapse instructions files` | List instruction files |\n| `synapse instructions send` | Resend initial instructions |\n| `synapse history list` | Show task history |\n| `synapse history show <task_id>` | Show task details |\n| `synapse history search` | Keyword search |\n| `synapse history cleanup` | Delete old data |\n| `synapse history stats` | Show statistics |\n| `synapse history export` | Export to JSON/CSV |\n| `synapse file-safety status` | Show file safety statistics |\n| `synapse file-safety locks` | List active locks |\n| `synapse file-safety lock` | Lock a file |\n| `synapse file-safety unlock` | Release lock |\n| `synapse file-safety history` | File change history |\n| `synapse file-safety recent` | Recent changes |\n| `synapse file-safety record` | Manually record change |\n| `synapse file-safety cleanup` | Delete old data |\n| `synapse file-safety debug` | Show debug info |\n| `synapse config` | Settings management (interactive TUI) |\n| `synapse config show` | Show current settings |\n\n### Resume Mode\n\nWhen resuming an existing session, use these flags to **skip initial instruction sending** (A2A protocol explanation), keeping your context clean:\n\n```bash\n# Resume Claude Code session\nsynapse claude -- --resume\n\n# Resume Gemini with history\nsynapse gemini -- --resume=5\n\n# Codex uses 'resume' as a subcommand (not --resume flag)\nsynapse codex -- resume --last\n```\n\nDefault flags (customizable in `settings.json`):\n- **Claude**: `--resume`, `--continue`, `-r`, `-c`\n- **Gemini**: `--resume`, `-r`\n- **Codex**: `resume`\n- **OpenCode**: `--continue`, `-c`\n- **Copilot**: `--continue`, `--resume`\n\n### Instruction Management\n\nManually resend initial instructions when they weren't sent (e.g., after `--resume` mode):\n\n```bash\n# Show instruction content\nsynapse instructions show claude\n\n# List instruction files\nsynapse instructions files claude\n\n# Send initial instructions to running agent\nsynapse instructions send claude\n\n# Preview before sending\nsynapse instructions send claude --preview\n\n# Send to specific agent ID\nsynapse instructions send synapse-claude-8100\n```\n\nUseful when:\n- You need A2A protocol info after starting with `--resume`\n- Agent lost/forgot instructions and needs recovery\n- Debugging instruction content\n\n### External Agent Management\n\n```bash\n# Register external agent\nsynapse external add http://other-agent:9000 --alias other\n\n# List\nsynapse external list\n\n# Send message\nsynapse external send other \"Process this task\"\n```\n\n### Task History Management\n\nSearch, browse, and analyze past agent execution results.\n\n**Note:** History is enabled by default since v0.3.13. To disable:\n\n```bash\n# Disable via environment variable\nexport SYNAPSE_HISTORY_ENABLED=false\nsynapse claude\n```\n\n#### Basic Operations\n\n```bash\n# Show latest 50 entries\nsynapse history list\n\n# Filter by agent\nsynapse history list --agent claude\n\n# Custom limit\nsynapse history list --limit 100\n\n# Show task details\nsynapse history show task-id-uuid\n```\n\n#### Keyword Search\n\nSearch input/output fields by keyword:\n\n```bash\n# Single keyword\nsynapse history search \"Python\"\n\n# Multiple keywords (OR logic)\nsynapse history search \"Python\" \"Docker\"\n\n# AND logic (all keywords must match)\nsynapse history search \"Python\" \"function\" --logic AND\n\n# With agent filter\nsynapse history search \"Python\" --agent claude\n\n# Limit results\nsynapse history search \"error\" --limit 20\n```\n\n#### Statistics\n\n```bash\n# Overall stats (total, success rate, per-agent breakdown)\nsynapse history stats\n\n# Specific agent stats\nsynapse history stats --agent claude\n```\n\n#### Data Export\n\n```bash\n# JSON export (stdout)\nsynapse history export --format json\n\n# CSV export\nsynapse history export --format csv\n\n# Save to file\nsynapse history export --format json --output history.json\nsynapse history export --format csv --agent claude > claude_history.csv\n```\n\n#### Retention Policy\n\n```bash\n# Delete data older than 30 days\nsynapse history cleanup --days 30\n\n# Keep database under 100MB\nsynapse history cleanup --max-size 100\n\n# Force (no confirmation)\nsynapse history cleanup --days 30 --force\n\n# Dry run\nsynapse history cleanup --days 30 --dry-run\n```\n\n**Storage:**\n\n- SQLite database: `~/.synapse/history/history.db`\n- Stored: task ID, agent name, input, output, status, metadata\n- Auto-indexed: agent_name, timestamp, task_id\n\n**Settings:**\n\n- **Enabled by default** (v0.3.13+)\n- **Disable**: `SYNAPSE_HISTORY_ENABLED=false`\n\n### synapse send Command (Recommended)\n\nUse `synapse send` for inter-agent communication. Works in sandboxed environments.\n\n```bash\nsynapse send <target> \"<message>\" [--from <sender>] [--priority <1-5>] [--response | --no-response]\n```\n\n**Target Formats:**\n\n| Format | Example | Description |\n|--------|---------|-------------|\n| Custom name | `my-claude` | Highest priority, use when agent has a name |\n| Agent type | `claude` | Only works when single instance exists |\n| Type-port | `claude-8100` | Use when multiple instances of same type |\n| Full ID | `synapse-claude-8100` | Complete agent ID |\n\nWhen multiple agents of the same type are running, type-only (e.g., `claude`) will error. Use `claude-8100` or `synapse-claude-8100`.\n\n**Options:**\n\n| Option | Short | Description |\n|--------|-------|-------------|\n| `--from` | `-f` | Sender agent ID (for reply identification) |\n| `--priority` | `-p` | Priority 1-4: normal, 5: emergency stop (sends SIGINT) |\n| `--response` | - | Roundtrip - sender waits, receiver replies with `synapse reply` |\n| `--no-response` | - | Oneway - fire and forget, no reply needed (default) |\n\n**Examples:**\n\n```bash\n# Send message (single instance)\nsynapse send claude \"Hello\" --priority 1 --from codex\n\n# Send to specific instance (multiple of same type)\nsynapse send claude-8100 \"Hello\" --from synapse-claude-8101\n\n# Emergency stop\nsynapse send claude \"Stop!\" --priority 5 --from codex\n\n# Wait for response (roundtrip)\nsynapse send gemini \"Analyze this\" --response --from claude\n```\n\n**Important:** Always use `--from` to identify the sender.\n\n### synapse reply Command\n\nReply to the last received message:\n\n```bash\nsynapse reply \"<message>\" --from <your_agent_type>\n```\n\nThe `--from` flag is required in sandboxed environments (like Codex).\n\n### Low-Level A2A Tool\n\nFor advanced operations:\n\n```bash\n# List agents\npython -m synapse.tools.a2a list\n\n# Send message\npython -m synapse.tools.a2a send --target claude --priority 1 \"Hello\"\n\n# Reply to last received message (uses reply tracking)\npython -m synapse.tools.a2a reply \"Here is my response\"\n```\n\n---\n\n## API Endpoints\n\n### A2A Compliant\n\n| Endpoint | Method | Description |\n| -------- | ------ | ----------- |\n| `/.well-known/agent.json` | GET | Agent Card |\n| `/tasks/send` | POST | Send message |\n| `/tasks/send-priority` | POST | Send with priority |\n| `/tasks/create` | POST | Create task (no PTY send, for `--response`) |\n| `/tasks/{id}` | GET | Get task status |\n| `/tasks` | GET | List tasks |\n| `/tasks/{id}/cancel` | POST | Cancel task |\n| `/status` | GET | READY/PROCESSING status |\n\n### Synapse Extensions\n\n| Endpoint | Method | Description |\n| -------- | ------ | ----------- |\n| `/reply-stack/get` | GET | Get sender info without removing (for peek before send) |\n| `/reply-stack/pop` | GET | Pop sender info from reply map (for `synapse reply`) |\n\n### External Agents\n\n| Endpoint | Method | Description |\n| -------- | ------ | ----------- |\n| `/external/discover` | POST | Register external agent |\n| `/external/agents` | GET | List |\n| `/external/agents/{alias}` | DELETE | Remove |\n| `/external/agents/{alias}/send` | POST | Send |\n\n---\n\n## Task Structure\n\nIn the A2A protocol, all communication is managed as **Tasks**.\n\n### Task Lifecycle\n\n```mermaid\nstateDiagram-v2\n    [*] --> submitted: POST /tasks/send\n    submitted --> working: Processing starts\n    working --> completed: Success\n    working --> failed: Error\n    working --> input_required: Waiting for input\n    input_required --> working: Input received\n    completed --> [*]\n    failed --> [*]\n```\n\n### Task Object\n\n```json\n{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"context_id\": \"conversation-123\",\n  \"status\": \"working\",\n  \"message\": {\n    \"role\": \"user\",\n    \"parts\": [{ \"type\": \"text\", \"text\": \"Review this design\" }]\n  },\n  \"artifacts\": [],\n  \"metadata\": {\n    \"sender\": {\n      \"sender_id\": \"synapse-claude-8100\",\n      \"sender_type\": \"claude\",\n      \"sender_endpoint\": \"http://localhost:8100\"\n    }\n  },\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"updated_at\": \"2024-01-15T10:30:05Z\"\n}\n```\n\n### Field Descriptions\n\n| Field | Type | Description |\n| ----- | ---- | ----------- |\n| `id` | string | Unique task identifier (UUID) |\n| `context_id` | string? | Conversation context ID (for multi-turn) |\n| `status` | string | `submitted` / `working` / `completed` / `failed` / `input_required` |\n| `message` | Message | Sent message |\n| `artifacts` | Artifact[] | Task output artifacts |\n| `metadata` | object | Sender info (`metadata.sender`) |\n| `created_at` | string | Creation timestamp (ISO 8601) |\n| `updated_at` | string | Update timestamp (ISO 8601) |\n\n### Message Structure\n\n```json\n{\n  \"role\": \"user\",\n  \"parts\": [\n    { \"type\": \"text\", \"text\": \"Message content\" },\n    {\n      \"type\": \"file\",\n      \"file\": {\n        \"name\": \"doc.pdf\",\n        \"mimeType\": \"application/pdf\",\n        \"bytes\": \"...\"\n      }\n    }\n  ]\n}\n```\n\n| Part Type | Description |\n| --------- | ----------- |\n| `text` | Text message |\n| `file` | File attachment |\n| `data` | Structured data |\n\n---\n\n## Sender Identification\n\nThe sender of A2A messages can be identified via `metadata.sender`.\n\n### PTY Output Format\n\nMessages are sent to the agent's PTY with a simple `A2A:` prefix:\n\n```\nA2A: <message content>\n```\n\n### Reply Handling\n\nSynapse automatically manages reply routing. Agents simply use `synapse reply`:\n\n```bash\nsynapse reply \"Here is my response\" --from <your_agent_type>\n```\n\nThe framework internally tracks sender information and routes replies automatically.\n\n### Task API Verification (Development)\n\n```bash\ncurl -s http://localhost:8120/tasks/<id> | jq '.metadata.sender'\n```\n\nResponse:\n\n```json\n{\n  \"sender_id\": \"synapse-claude-8100\",\n  \"sender_type\": \"claude\",\n  \"sender_endpoint\": \"http://localhost:8100\"\n}\n```\n\n### How It Works\n\n1. **On send**: Reference Registry, identify own agent_id via PID matching\n2. **On Task creation**: Attach sender info to `metadata.sender`\n3. **On receive**: Check via PTY prefix or Task API\n\n---\n\n## Priority Levels\n\n| Priority | Behavior | Use Case |\n| -------- | -------- | -------- |\n| 1-4 | Normal stdin write | Regular messages |\n| 5 | SIGINT then write | Emergency stop |\n\n```bash\n# Emergency stop\nsynapse send claude \"Stop!\" --priority 5\n```\n\n---\n\n## Agent Card\n\nEach agent publishes an Agent Card at `/.well-known/agent.json`.\n\n```bash\ncurl http://localhost:8100/.well-known/agent.json\n```\n\n```json\n{\n  \"name\": \"Synapse Claude\",\n  \"description\": \"PTY-wrapped claude CLI agent with A2A communication\",\n  \"url\": \"http://localhost:8100\",\n  \"capabilities\": {\n    \"streaming\": false,\n    \"pushNotifications\": false,\n    \"multiTurn\": true\n  },\n  \"skills\": [\n    {\n      \"id\": \"chat\",\n      \"name\": \"Chat\",\n      \"description\": \"Send messages to the CLI agent\"\n    },\n    {\n      \"id\": \"interrupt\",\n      \"name\": \"Interrupt\",\n      \"description\": \"Interrupt current processing\"\n    }\n  ],\n  \"extensions\": {\n    \"synapse\": {\n      \"agent_id\": \"synapse-claude-8100\",\n      \"pty_wrapped\": true,\n      \"priority_interrupt\": true,\n      \"at_agent_syntax\": true\n    }\n  }\n}\n```\n\n### Design Philosophy\n\nAgent Card is a \"business card\" containing only external-facing information:\n\n- capabilities, skills, endpoint, etc.\n- Internal instructions are not included (sent via A2A Task at startup)\n\n---\n\n## Registry and Port Management\n\n### Registry Files\n\n```\n~/.a2a/registry/\n‚îú‚îÄ‚îÄ synapse-claude-8100.json\n‚îú‚îÄ‚îÄ synapse-claude-8101.json\n‚îî‚îÄ‚îÄ synapse-gemini-8110.json\n```\n\n### Auto Cleanup\n\nStale entries are automatically removed during:\n\n- `synapse list` execution\n- Message sending (when target is dead)\n\n### Port Ranges\n\n```python\nPORT_RANGES = {\n    \"claude\": (8100, 8109),\n    \"gemini\": (8110, 8119),\n    \"codex\": (8120, 8129),\n    \"opencode\": (8130, 8139),\n    \"copilot\": (8140, 8149),\n    \"dummy\": (8190, 8199),\n}\n```\n\n### Typical Memory Usage (Resident Agents)\n\nOn macOS, idle resident agents are lightweight. As of January 25, 2026,\nRSS is around ~12 MB per agent process in a typical development setup.\n\nActual usage varies by profile, plugins, history settings, and workload.\nNote that `ps` reports RSS in KB (so ~12 MB corresponds to ~12,000 KB).\nTo measure on your machine:\n\n```bash\nps -o pid,comm,rss,vsz,etime,command -A | rg \"synapse\"\n```\n\nIf you don't have ripgrep:\n\n```bash\nps -o pid,comm,rss,vsz,etime,command -A | grep \"synapse\"\n```\n\n---\n\n## File Safety\n\nPrevents conflicts when multiple agents edit the same files simultaneously.\n\n```mermaid\nsequenceDiagram\n    participant Claude\n    participant FS as File Safety\n    participant Gemini\n\n    Claude->>FS: acquire_lock(\"auth.py\")\n    FS-->>Claude: ACQUIRED\n\n    Gemini->>FS: validate_write(\"auth.py\")\n    FS-->>Gemini: DENIED (locked by claude)\n\n    Claude->>FS: release_lock(\"auth.py\")\n    Gemini->>FS: acquire_lock(\"auth.py\")\n    FS-->>Gemini: ACQUIRED\n```\n\n### Features\n\n| Feature | Description |\n|---------|-------------|\n| **File Locking** | Exclusive control prevents simultaneous editing |\n| **Change Tracking** | Records who changed what and when |\n| **Context Injection** | Provides recent change history on read |\n| **Pre-write Validation** | Checks lock status before writing |\n\n### Enable\n\n```bash\n# Enable via environment variable\nexport SYNAPSE_FILE_SAFETY_ENABLED=true\nsynapse claude\n```\n\n### Basic Commands\n\n```bash\n# Show statistics\nsynapse file-safety status\n\n# List active locks\nsynapse file-safety locks\n\n# Acquire lock\nsynapse file-safety lock /path/to/file.py claude --intent \"Refactoring\"\n\n# Release lock\nsynapse file-safety unlock /path/to/file.py claude\n\n# File change history\nsynapse file-safety history /path/to/file.py\n\n# Recent changes\nsynapse file-safety recent\n\n# Delete old data\nsynapse file-safety cleanup --days 30\n```\n\n### Python API\n\n```python\nfrom synapse.file_safety import FileSafetyManager, ChangeType, LockStatus\n\nmanager = FileSafetyManager.from_env()\n\n# Acquire lock\nresult = manager.acquire_lock(\"/path/to/file.py\", \"claude\", intent=\"Refactoring\")\nif result[\"status\"] == LockStatus.ACQUIRED:\n    # Edit file...\n\n    # Record change\n    manager.record_modification(\n        file_path=\"/path/to/file.py\",\n        agent_name=\"claude\",\n        task_id=\"task-123\",\n        change_type=ChangeType.MODIFY,\n        intent=\"Fix authentication bug\"\n    )\n\n    # Release lock\n    manager.release_lock(\"/path/to/file.py\", \"claude\")\n\n# Pre-write validation\nvalidation = manager.validate_write(\"/path/to/file.py\", \"gemini\")\nif not validation[\"allowed\"]:\n    print(f\"Write blocked: {validation['reason']}\")\n```\n\n**Storage**: Default is `~/.synapse/file_safety.db` (SQLite). Change via `SYNAPSE_FILE_SAFETY_DB_PATH` (e.g., `./.synapse/file_safety.db` for per-project).\n\nSee [docs/file-safety.md](docs/file-safety.md) for details.\n\n---\n\n## Agent Monitor\n\nReal-time monitoring of agent status with terminal jump capability.\n\n### Rich TUI Mode\n\n```bash\n# Start Rich TUI with auto-refresh (default)\nsynapse list\n```\n\nThe display automatically updates when agent status changes (via file watcher) with a 10-second fallback polling interval.\n\n### Display Columns\n\n| Column | Description |\n|--------|-------------|\n| TYPE | Agent type (claude, gemini, codex, etc.) |\n| NAME | Custom name (if assigned) |\n| ROLE | Agent role description (if assigned) |\n| PORT | HTTP port number |\n| STATUS | Current status (READY, WAITING, PROCESSING, DONE) |\n| WORKING_DIR | Current working directory |\n| TRANSPORT | Communication transport indicator |\n\n### Status States\n\n| Status | Color | Meaning |\n|--------|-------|---------|\n| **READY** | Green | Agent is idle, waiting for input |\n| **WAITING** | Cyan | Agent is showing selection UI, waiting for user choice |\n| **PROCESSING** | Yellow | Agent is actively working |\n| **DONE** | Blue | Task completed (auto-transitions to READY after 10s) |\n\n### Interactive Controls\n\n| Key | Action |\n|-----|--------|\n| 1-9 | Select agent row (direct) |\n| ‚Üë/‚Üì | Navigate agent rows |\n| **Enter** or **j** | Jump to selected agent's terminal |\n| **k** | Kill selected agent (with confirmation) |\n| **/** | Filter by TYPE or WORKING_DIR |\n| ESC | Clear filter/selection |\n| q | Quit |\n\n**Supported Terminals**: iTerm2, Terminal.app, Ghostty, VS Code, tmux, Zellij\n\n### WAITING Detection\n\n> **Note**: WAITING detection is currently disabled due to false positives on startup. See [#140](https://github.com/s-hiraoku/synapse-a2a/issues/140) for details.\n\nWhen enabled, detects agents waiting for user input (selection UI, Y/n prompts) using regex patterns:\n\n- **Gemini**: `‚óè 1. Option` selection UI, `Allow execution` prompts\n- **Claude**: `‚ùØ Option` cursor, `‚òê/‚òë` checkboxes, `[Y/n]` prompts\n- **Codex**: Indented numbered lists\n- **OpenCode**: Numbered choices, selection indicators, `[y/N]` prompts\n- **Copilot**: Numbered choices, selection indicators, `[y/N]` or `(y/n)` prompts\n\n---\n\n## Testing\n\nComprehensive test suite verifies A2A protocol compliance:\n\n```bash\n# All tests\npytest\n\n# Specific category\npytest tests/test_a2a_compat.py -v\npytest tests/test_sender_identification.py -v\n```\n\n---\n\n## Configuration (.synapse)\n\nCustomize environment variables and initial instructions via `.synapse/settings.json`.\n\n### Scopes\n\n| Scope | Path | Priority |\n|-------|------|----------|\n| User | `~/.synapse/settings.json` | Low |\n| Project | `./.synapse/settings.json` | Medium |\n| Local | `./.synapse/settings.local.json` | High (gitignore recommended) |\n\nHigher priority settings override lower ones.\n\n### Setup\n\n```bash\n# Create .synapse/ directory (copies all template files)\nsynapse init\n\n# ? Where do you want to create .synapse/?\n#   ‚ùØ User scope (~/.synapse/)\n#     Project scope (./.synapse/)\n#\n# ‚úî Created ~/.synapse\n\n# Reset to defaults\nsynapse reset\n\n# Edit settings interactively (TUI)\nsynapse config\n\n# Show current settings (read-only)\nsynapse config show\nsynapse config show --scope user\n```\n\n`synapse init` copies these files to `.synapse/`:\n\n| File | Description |\n|------|-------------|\n| `settings.json` | Environment variables and initial instruction settings |\n| `default.md` | Initial instructions common to all agents |\n| `gemini.md` | Gemini-specific initial instructions |\n| `delegate.md` | Task delegation rules |\n| `file-safety.md` | File Safety instructions |\n\n### settings.json Structure\n\n```json\n{\n  \"env\": {\n    \"SYNAPSE_HISTORY_ENABLED\": \"true\",\n    \"SYNAPSE_FILE_SAFETY_ENABLED\": \"true\",\n    \"SYNAPSE_FILE_SAFETY_DB_PATH\": \".synapse/file_safety.db\"\n  },\n  \"instructions\": {\n    \"default\": \"[SYNAPSE INSTRUCTIONS...]\\n...\",\n    \"claude\": \"\",\n    \"gemini\": \"\",\n    \"codex\": \"\"\n  },\n  \"approvalMode\": \"required\",\n  \"a2a\": {\n    \"flow\": \"auto\"\n  },\n  \"delegation\": {\n    \"enabled\": false\n  }\n}\n```\n\n### Environment Variables (env)\n\n| Variable | Description | Default |\n|----------|-------------|---------|\n| `SYNAPSE_HISTORY_ENABLED` | Enable task history | `true` |\n| `SYNAPSE_FILE_SAFETY_ENABLED` | Enable file safety | `false` |\n| `SYNAPSE_FILE_SAFETY_DB_PATH` | File safety DB path | `~/.synapse/file_safety.db` |\n| `SYNAPSE_AUTH_ENABLED` | Enable API authentication | `false` |\n| `SYNAPSE_API_KEYS` | API keys (comma-separated) | - |\n| `SYNAPSE_ADMIN_KEY` | Admin key | - |\n| `SYNAPSE_ALLOW_LOCALHOST` | Skip auth for localhost | `true` |\n| `SYNAPSE_USE_HTTPS` | Use HTTPS | `false` |\n| `SYNAPSE_WEBHOOK_SECRET` | Webhook secret | - |\n| `SYNAPSE_WEBHOOK_TIMEOUT` | Webhook timeout (sec) | `10` |\n| `SYNAPSE_WEBHOOK_MAX_RETRIES` | Webhook retry count | `3` |\n\n### A2A Communication Settings (a2a)\n\n| Setting | Value | Description |\n|---------|-------|-------------|\n| `flow` | `roundtrip` | Always wait for result |\n| `flow` | `oneway` | Always forward only (don't wait) |\n| `flow` | `auto` | AI agent decides per task (default) |\n\n### Delegation Settings (delegation)\n\n| Setting | Value | Description |\n|---------|-------|-------------|\n| `enabled` | `true` | Load `.synapse/delegate.md` and enable delegation rules |\n| `enabled` | `false` | Disable delegation (default) |\n\n### Approval Mode (approvalMode)\n\nControls whether to show a confirmation prompt before sending initial instructions.\n\n| Setting | Description |\n|---------|-------------|\n| `required` | Show approval prompt at startup (default) |\n| `auto` | Send instructions automatically without prompting |\n\nWhen set to `required`, you'll see a prompt like:\n\n```\n[Synapse] Agent: synapse-claude-8100 | Port: 8100\n[Synapse] Initial instructions will be sent to configure A2A communication.\n\nProceed? [Y/n/s(skip)]:\n```\n\nOptions:\n- **Y** (or Enter): Send initial instructions and start agent\n- **n**: Abort startup\n- **s**: Start agent without sending initial instructions\n\n### Initial Instructions (instructions)\n\nCustomize instructions sent at agent startup:\n\n```json\n{\n  \"instructions\": {\n    \"default\": \"Common instructions for all agents\",\n    \"claude\": \"Claude-specific instructions (takes priority over default)\",\n    \"gemini\": \"Gemini-specific instructions\",\n    \"codex\": \"Codex-specific instructions\"\n  }\n}\n```\n\n**Priority**:\n1. Agent-specific setting (`claude`, `gemini`, `codex`, `opencode`, `copilot`) if present\n2. Otherwise use `default`\n3. If both empty, no initial instructions sent\n\n**Placeholders**:\n- `{{agent_id}}` - Agent ID (e.g., `synapse-claude-8100`)\n- `{{port}}` - Port number (e.g., `8100`)\n\nSee [guides/settings.md](guides/settings.md) for details.\n\n---\n\n## Development & Release\n\n### Publishing to PyPI\n\nPushing a tag automatically publishes to PyPI via GitHub Actions.\n\n```bash\n# 1. Update version in pyproject.toml\n# version = \"0.2.0\"\n\n# 2. Create and push tag\ngit tag v0.2.0\ngit push origin v0.2.0\n```\n\n### Manual Publishing\n\n```bash\n# Build and publish with uv\nuv build\nuv publish\n```\n\n### User Installation\n\n```bash\n# pipx (recommended)\npipx install synapse-a2a\n\n# or pip\npip install synapse-a2a\n\n# Run directly with uvx\nuvx synapse-a2a claude\n```\n\n---\n\n## Known Limitations\n\n- **TUI Rendering**: Display may be garbled with Ink-based CLIs\n- **PTY Limitations**: Some special input sequences not supported\n- **Codex Sandbox**: Codex CLI's sandbox blocks network access, requiring configuration for inter-agent communication (see below)\n\n### Inter-Agent Communication in Codex CLI\n\nCodex CLI runs in a sandbox by default with restricted network access. To use `@agent` pattern for inter-agent communication, allow network access in `~/.codex/config.toml`.\n\n**Global Setting (applies to all projects):**\n\n```toml\n# ~/.codex/config.toml\n\nsandbox_mode = \"workspace-write\"\n\n[sandbox_workspace_write]\nnetwork_access = true\n```\n\n**Per-Project Setting:**\n\n```toml\n# ~/.codex/config.toml\n\n[projects.\"/path/to/your/project\"]\nsandbox_mode = \"workspace-write\"\n\n[projects.\"/path/to/your/project\".sandbox_workspace_write]\nnetwork_access = true\n```\n\nSee [guides/troubleshooting.md](guides/troubleshooting.md#codex-sandbox-network-error) for details.\n\n---\n\n## Enterprise Features\n\nSecurity, notification, and high-performance communication features for production environments.\n\n### API Key Authentication\n\n```bash\n# Start with authentication enabled\nexport SYNAPSE_AUTH_ENABLED=true\nexport SYNAPSE_API_KEYS=<YOUR_API_KEY>\nsynapse claude\n\n# Request with API Key\ncurl -H \"X-API-Key: <YOUR_API_KEY>\" http://localhost:8100/tasks\n```\n\n### Webhook Notifications\n\nSend notifications to external URLs when tasks complete.\n\n```bash\n# Register webhook\ncurl -X POST http://localhost:8100/webhooks \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"url\": \"https://your-server.com/hook\", \"events\": [\"task.completed\"]}'\n```\n\n| Event | Description |\n|-------|-------------|\n| `task.completed` | Task completed successfully |\n| `task.failed` | Task failed |\n| `task.canceled` | Task canceled |\n\n### SSE Streaming\n\nReceive task output in real-time.\n\n```bash\ncurl -N http://localhost:8100/tasks/{task_id}/subscribe\n```\n\nEvent types:\n\n| Event | Description |\n|-------|-------------|\n| `output` | New CLI output |\n| `status` | Status change |\n| `done` | Task complete (includes Artifact) |\n\n### Output Parsing\n\nAutomatically parse CLI output for error detection, status updates, and Artifact generation.\n\n| Feature | Description |\n|---------|-------------|\n| Error Detection | Detects `command not found`, `permission denied`, etc. |\n| input_required | Detects question/confirmation prompts |\n| Output Parser | Structures code/files/errors |\n\n### gRPC Support\n\nUse gRPC for high-performance communication.\n\n```bash\n# Install gRPC dependencies\npip install synapse-a2a[grpc]\n\n# gRPC runs on REST port + 1\n# REST: 8100 ‚Üí gRPC: 8101\n```\n\nSee [guides/enterprise.md](guides/enterprise.md) for details.\n\n---\n\n## Documentation\n\n| Path | Content |\n| ---- | ------- |\n| [guides/usage.md](guides/usage.md) | Detailed usage |\n| [guides/architecture.md](guides/architecture.md) | Architecture details |\n| [guides/enterprise.md](guides/enterprise.md) | Enterprise features |\n| [guides/troubleshooting.md](guides/troubleshooting.md) | Troubleshooting |\n| [guides/delegation.md](guides/delegation.md) | Task delegation guide |\n| [docs/file-safety.md](docs/file-safety.md) | File conflict prevention |\n| [docs/project-philosophy.md](docs/project-philosophy.md) | Design philosophy |\n\n---\n\n## License\n\nMIT License\n\n---\n\n## Related Links\n\n- [Claude Code](https://claude.ai/code) - Anthropic's CLI agent\n- [OpenCode](https://opencode.ai/) - Open-source AI coding agent\n- [GitHub Copilot CLI](https://docs.github.com/en/copilot/github-copilot-in-the-cli) - GitHub's AI coding assistant\n- [Google A2A Protocol](https://github.com/google/A2A) - Agent-to-Agent protocol\n",
        "plugins/synapse-a2a/README.md": "# Synapse A2A Skills\n\nSkills for [Synapse A2A](https://github.com/s-hiraoku/synapse-a2a) - a multi-agent communication framework.\n\n## Installation\n\n```bash\n# Install via skills.sh (https://skills.sh/)\nnpx skills add s-hiraoku/synapse-a2a\n```\n\n## Skills Included\n\n### synapse-a2a\n\nComprehensive guidance for inter-agent communication:\n\n- Send messages to other agents (`@agent` pattern)\n- Priority levels (1-5, with 5 being emergency interrupt)\n- Task history management (search, export, cleanup)\n- File Safety (locking, modification tracking)\n- Settings management (`synapse init`, `settings.json`)\n- Agent monitoring (`synapse list --watch`)\n\n### delegation\n\nConfigure automatic task delegation between agents:\n\n- **Orchestrator mode**: Claude analyzes, delegates, integrates results\n- **Passthrough mode**: Direct forwarding without processing\n- Pre-delegation checklist (agent status, file locks)\n- File Safety integration\n- Error handling and recovery\n\n## Usage\n\nOnce installed, Claude will automatically use these skills when relevant tasks are detected:\n\n- Sending messages to other agents\n- Configuring task delegation\n- Managing file locks in multi-agent environments\n- Viewing task history\n\n## Requirements\n\n- [Synapse A2A](https://github.com/s-hiraoku/synapse-a2a) installed and running\n- Claude Code with plugin support\n\n## Links\n\n- [Synapse A2A Documentation](https://github.com/s-hiraoku/synapse-a2a)\n- [File Safety Guide](https://github.com/s-hiraoku/synapse-a2a/blob/main/docs/file-safety.md)\n- [Delegation Guide](https://github.com/s-hiraoku/synapse-a2a/blob/main/guides/delegation.md)\n"
      },
      "plugins": [
        {
          "name": "synapse-a2a",
          "description": "Complete plugin for Synapse A2A multi-agent framework including inter-agent communication, task delegation, file safety, and history management",
          "source": "./plugins/synapse-a2a",
          "strict": false,
          "categories": [],
          "install_commands": [
            "/plugin marketplace add s-hiraoku/synapse-a2a",
            "/plugin install synapse-a2a@synapse-a2a"
          ]
        }
      ]
    }
  ]
}