{
  "author": {
    "id": "StacklokLabs",
    "display_name": "StacklokLabs",
    "avatar_url": "https://avatars.githubusercontent.com/u/158105196?v=4"
  },
  "marketplaces": [
    {
      "name": "stacklok-claude-hooks",
      "version": null,
      "description": "MCP governance hook that restricts MCP calls to ToolHive-managed servers.",
      "repo_full_name": "StacklokLabs/stacklok-claude-hooks",
      "repo_url": "https://github.com/StacklokLabs/stacklok-claude-hooks",
      "repo_description": "Claude Hooks to ensure secure MCP Server usage in Claude is using ToolHive.",
      "signals": {
        "stars": 1,
        "forks": 0,
        "pushed_at": "2026-01-27T05:30:39Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n    \"name\": \"stacklok-claude-hooks\",\n    \"owner\": {\n        \"name\": \"Stacklok\",\n        \"email\": \"support@stacklok.com\"\n    },\n    \"plugins\": [\n        {\n            \"name\": \"stacklok-hook\",\n            \"source\": \"./plugins/stacklok-hook\",\n            \"description\": \"MCP governance hook that restricts MCP calls to ToolHive-managed servers.\"\n        },\n        {\n            \"name\": \"stacklok-hook-registry-restricted\",\n            \"source\": \"./plugins/stacklok-hook-registry-restricted\",\n            \"description\": \"MCP governance hook that restricts MCP calls to servers in the ToolHive registry.\"\n        }\n    ]\n}",
        "README.md": "# Claude Code Hooks: ToolHive MCP Governance\n\nA [Claude Code plugin](https://code.claude.com/docs/en/plugins) that restricts MCP (Model Context Protocol) tool calls to only servers managed by [ToolHive](https://github.com/stacklok/toolhive).\n\n## Why ToolHive\n\nMCP adoption spreads organically: MCP configurations get shared, copied from READMEs, and rarely cleaned up. Security teams lose visibility into what's connected and what data is flowing where causing security risks and compliance headaches.\n\n[ToolHive](https://github.com/stacklok/toolhive) is an open-source platform that brings enterprise-grade security to MCP deployment. It provides a curated registry of approved servers, isolated container runtimes, centralized policy enforcement, and audit loggingâ€”without blocking developers from using the tools they need.\n\nThis hook is the Claude Code integration. It intercepts every MCP call before execution and verifies the target server is ToolHive-managed. Unauthorized servers are blocked with a clear error message.\n\n## What it does\n\nWhen Claude Code attempts to use an MCP tool, this hook:\n\n1. Intercepts the call before execution (PreToolUse hook)\n2. Parses the tool name (`mcp__<server>__<tool>`) to extract the server name\n3. Queries ToolHive (`thv list --format json`) to get managed servers\n4. **Fail-closed**: If ToolHive is unavailable, denies the call\n5. Allows or denies based on plugin mode (see Available Plugins below)\n6. Returns structured JSON to Claude Code indicating allow/deny and reason\n\n## Available Plugins\n\nThis marketplace provides two plugin variants:\n\n| Plugin | Description |\n|--------|-------------|\n| `stacklok-hook` | Allows any MCP server managed by ToolHive |\n| `stacklok-hook-registry-restricted` | Only allows servers from the ToolHive registry |\n\n### Which plugin should I use?\n\n- **stacklok-hook**: Use this if you trust all servers your team adds to ToolHive. Any server in `thv list` is allowed.\n\n- **stacklok-hook-registry-restricted**: Use this for stricter enterprise environments. Servers must be in ToolHive AND match the ToolHive registry:\n  - Container workloads: The server's package must match an image in the registry\n  - Remote workloads: The server's remote URL must match a URL in the registry\n\n## Supported Platforms\n\n- **Linux** - Fully supported\n- **macOS** - Supported (requires GNU coreutils)\n- **Windows** - Not currently supported (requires bash shell)\n\n## Prerequisites\n\n- [Claude Code](https://docs.anthropic.com/en/docs/claude-code) CLI installed\n- [jq](https://jqlang.github.io/jq/) - JSON processor (`brew install jq` on macOS)\n- [GNU coreutils](https://www.gnu.org/software/coreutils/) - Required for `timeout` command (`brew install coreutils` on macOS). Linux systems typically have this pre-installed.\n- [ToolHive](https://github.com/stacklok/toolhive) (`thv` CLI)\n\n## Installation\n\n### Option 1: Plugin Marketplace (Recommended)\n\n1. Launch Claude Code in any directory:\n   ```bash\n   claude\n   ```\n\n2. Add the marketplace:\n   ```\n   /plugin marketplace add StacklokLabs/stacklok-claude-hooks\n   ```\n\n   If you see an error about marketplace not being found or authentication failed try\n\n   ```\n   /plugin marketplace add git@github.com:StacklokLabs/stacklok-claude-hooks.git\n   ```\n\n   or\n\n   ```\n   /plugin marketplace add https://github.com/StacklokLabs/stacklok-claude-hooks\n    ```\n\n3. Install your preferred plugin:\n   ```\n   /plugin install stacklok-hook\n   ```\n   Or for registry-restricted mode:\n   ```\n   /plugin install stacklok-hook-registry-restricted\n   ```\n\n4. Select \"Install for you (user scope)\" when prompted.\n\n5. Exit and restart Claude Code.\n\n### Option 2: Manual Installation\n\n1. Clone this repository:\n   ```bash\n   git clone https://github.com/StacklokLabs/stacklok-claude-hooks.git\n   cd stacklok-claude-hooks\n   ```\n\n2. Start Claude Code with the plugin directory (use absolute path):\n   ```bash\n   claude --plugin-dir /path/to/stacklok-claude-hooks/plugins/stacklok-hook\n   ```\n   Or for registry-restricted mode:\n\n   ```bash\n   claude --plugin-dir /path/to/stacklok-claude-hooks/plugins/stacklok-hook-registry-restricted\n   ```\n\n3. Restart Claude Code.\n\n## Uninstallation\n\n```\n/plugin uninstall stacklok-hook\n```\nOr for registry-restricted:\n```\n/plugin uninstall stacklok-hook-registry-restricted\n```\n\n## Testing\n\nRun the unit tests (mocks the `thv` CLI):\n\n```bash\n# Test default mode plugin\n./plugins/stacklok-hook/tests/stacklok-hook-test.sh\n\n# Test registry-restricted mode plugin\n./plugins/stacklok-hook-registry-restricted/tests/stacklok-hook-test.sh\n```\n\n## How it works\n\nThe hook (`scripts/stacklok-hook.sh`):\n\n1. Receives MCP call details as JSON via stdin\n2. Extracts `tool_name` (format: `mcp__<server>__<tool>`)\n3. Parses out the server name\n4. Queries `thv list --format json` to get managed servers\n5. For registry-restricted mode: Also checks `thv registry list --format json`\n6. Returns structured JSON:\n   - Allow: `{\"hookSpecificOutput\": {\"permissionDecision\": \"allow\", ...}}`\n   - Deny: `{\"hookSpecificOutput\": {\"permissionDecision\": \"deny\", ...}, \"systemMessage\": \"...\"}`\n\nNote that shared functions are in `scripts/stacklok-hook-common.sh` and sourced by both plugins via symlinks.\n\n## Configuration\n\n### Debug Logging\n\nEnable debug logs by setting the environment variable:\n\n```bash\nexport THV_HOOK_DEBUG=true\n```\n\nLogs are written to `~/temp_logs/toolhive-hook-bash.log`.\n\n## Troubleshooting\n\n### Hook not triggering\n\n1. Verify the plugin is installed: `/plugin list`\n2. Check that the tool name matches the pattern `mcp__.*`\n3. Restart Claude Code after installation\n\n### jq command not found\n\nInstall jq:\n```bash\nbrew install jq  # macOS\napt install jq   # Ubuntu/Debian\n```\n\n### thv command not found\n\nInstall ToolHive from: https://github.com/stacklok/toolhive\n\n### Permission denied\n\nMake sure the script is executable:\n```bash\nchmod +x ~/.claude/plugins/stacklok-hook/scripts/stacklok-hook.sh\n```\n\n## License\n\nApache 2.0\n"
      },
      "plugins": [
        {
          "name": "stacklok-hook",
          "source": "./plugins/stacklok-hook",
          "description": "MCP governance hook that restricts MCP calls to ToolHive-managed servers.",
          "categories": [],
          "install_commands": [
            "/plugin marketplace add StacklokLabs/stacklok-claude-hooks",
            "/plugin install stacklok-hook@stacklok-claude-hooks"
          ]
        },
        {
          "name": "stacklok-hook-registry-restricted",
          "source": "./plugins/stacklok-hook-registry-restricted",
          "description": "MCP governance hook that restricts MCP calls to servers in the ToolHive registry.",
          "categories": [],
          "install_commands": [
            "/plugin marketplace add StacklokLabs/stacklok-claude-hooks",
            "/plugin install stacklok-hook-registry-restricted@stacklok-claude-hooks"
          ]
        }
      ]
    }
  ]
}