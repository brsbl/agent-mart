{
  "author": {
    "id": "letta-ai",
    "display_name": "Letta",
    "avatar_url": "https://avatars.githubusercontent.com/u/177780362?v=4"
  },
  "marketplaces": [
    {
      "name": "claude-subconscious",
      "version": null,
      "description": null,
      "repo_full_name": "letta-ai/claude-subconscious",
      "repo_url": "https://github.com/letta-ai/claude-subconscious",
      "repo_description": "Give Claude Code a subconscious",
      "signals": {
        "stars": 333,
        "forks": 30,
        "pushed_at": "2026-01-29T21:08:11Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"claude-subconscious\",\n  \"owner\": {\n    \"name\": \"Letta\",\n    \"url\": \"https://letta.com\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"claude-subconscious\",\n      \"source\": \"./\"\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"claude-subconscious\",\n  \"version\": \"1.1.0\",\n  \"description\": \"A subconscious for Claude Code. A Letta agent watches your sessions, accumulates context, and whispers guidance back.\",\n  \"author\": {\n    \"name\": \"Letta\",\n    \"url\": \"https://letta.com\"\n  },\n  \"homepage\": \"https://github.com/letta-ai/claude-subconscious\",\n  \"repository\": \"https://github.com/letta-ai/claude-subconscious\",\n  \"license\": \"MIT\",\n  \"keywords\": [\n    \"letta\",\n    \"subconscious\",\n    \"memory\",\n    \"multi-agent\",\n    \"async\",\n    \"deliberation\"\n  ]\n}\n",
        "README.md": "# Claude Subconscious\n\nA subconscious for Claude Code. A [Letta](https://letta.com) agent that watches your sessions, accumulates context, and provides async guidance to \"main Claude\".\n\n> [!IMPORTANT]\n> Claude Subconcious is an experimental way to extend Claude Code (a closed source / black box agent) with the power of Letta's memory system and context engineering.\n>\n> If you're looking for a coding agent that's memory-first, model agnostic, and fully open source, we recommend using [**Letta Code**](https://github.com/letta-ai/letta-code).\n\n![evil claude](assets/evil-claude.jpeg)\n\n## What Is This?\n\nClaude Code forgets everything between sessions. Claude Subconscious adds a persistent memory layer underneath:\n\n- **A Letta agent observes** every Claude Code conversation\n- **Accumulates patterns** across sessions, projects, and time\n- **Provides async guidance**, reminders, and context\n\nLetta agents learn from input and can be customized to store specific information, run tool calls, perform background research, or take autonomous actions. Using Letta's [Conversations](https://docs.letta.com/guides/agents/conversations/) feature, a single agent can serve multiple Claude Code sessions in parallel with shared memory across all of them.\n\n## How It Works\n\nLetta does simple management of your `CLAUDE.md` file, and injects some content into user prompts. Your Claude Code transcript will be send to the subconscious agent each time Claude stops.\n\n```\n┌─────────────┐          ┌─────────────┐\n│ Claude Code │◄────────►│ Letta Agent │\n└─────────────┘          └─────────────┘\n       │                        │\n       │   Session Start        │\n       ├───────────────────────►│ New session notification\n       │                        │\n       │   Before each prompt   │\n       │◄───────────────────────┤ Memory → CLAUDE.md\n       │                        │\n       │   After each response  │\n       ├───────────────────────►│ Transcript → Agent (async)\n       │                        │\n       │   Next prompt          │\n       │◄───────────────────────┤ Guidance → CLAUDE.md\n```\n\n## Installation\n\nInstall from GitHub:\n\n```\n/plugin marketplace add letta-ai/claude-subconscious\n/plugin install claude-subconscious@claude-subconscious\n```\n\n### Updating\n\n```\n/plugin marketplace update\n/plugin update claude-subconscious@claude-subconscious\n```\n\n### Install from Source\n\nClone the repository:\n\n```bash\ngit clone https://github.com/letta-ai/claude-subconscious.git\ncd claude-subconscious\nnpm install\n```\n\nEnable the plugin (from inside the cloned directory):\n\n```\n/plugin enable .\n```\n\nOr enable globally for all projects:\n\n```\n/plugin enable --global .\n```\n\nIf running from a different directory, use the full path to the cloned repo.\n\n### Linux: tmpfs Workaround\n\nIf plugin installation fails with `EXDEV: cross-device link not permitted`, your `/tmp` is likely on a different filesystem (common on Ubuntu, Fedora, Arch). Set `TMPDIR` to work around this [Claude Code bug](https://github.com/anthropics/claude-code/issues/14799):\n\n```bash\nmkdir -p ~/.claude/tmp\nexport TMPDIR=\"$HOME/.claude/tmp\"\n```\n\nAdd to your shell profile (`~/.bashrc` or `~/.zshrc`) to make permanent.\n\n## Configuration\n\n### Required\n\n```bash\nexport LETTA_API_KEY=\"your-api-key\"\n```\n\nGet your API key from [app.letta.com](https://app.letta.com).\n\n### Optional\n\n```bash\nexport LETTA_AGENT_ID=\"agent-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\nexport LETTA_BASE_URL=\"http://localhost:8283\"  # For self-hosted Letta\nexport LETTA_MODEL=\"anthropic/claude-sonnet-4-5\"  # Model override\n```\n\n- `LETTA_AGENT_ID` - If not set, the plugin automatically imports a default \"Subconscious\" agent on first use.\n- `LETTA_BASE_URL` - For self-hosted Letta servers. Defaults to `https://api.letta.com`.\n- `LETTA_MODEL` - Override the agent's model. Optional - the plugin auto-detects and selects from available models. See [Model Configuration](#model-configuration) below.\n\n### Agent Resolution Order\n\n1. **Environment variable** - `LETTA_AGENT_ID` if set\n2. **Saved config** - `~/.letta/claude-subconscious/config.json` if exists\n3. **Auto-import** - Imports bundled `Subconscious.af` agent, saves ID for future use\n\nThis means zero-config setup: just set `LETTA_API_KEY` and the plugin handles the rest.\n\n### Model Configuration\n\nThe plugin **automatically detects available models** on your Letta server and configures the agent appropriately:\n\n1. **Queries available models** from your Letta server (`GET /v1/models/`)\n2. **Checks if the agent's model is available** on that server\n3. **Auto-selects a fallback** if the current model isn't available\n\n#### Auto-Selection Priority\n\nWhen the agent's model isn't available, the plugin selects from available models in this order:\n1. `anthropic/claude-sonnet-4-5` (recommended - best for agents)\n2. `openai/gpt-4.1-mini` (good balance, 1M context, cheap)\n3. `anthropic/claude-haiku-4-5` (fast Claude option)\n4. `openai/gpt-5.2` (flagship fallback)\n5. `google_ai/gemini-3-flash` (Google's balanced option)\n6. `google_ai/gemini-2.5-flash` (fallback)\n7. First available model on the server\n\n#### Manual Override\n\nTo specify a particular model, set `LETTA_MODEL`:\n\n```bash\nexport LETTA_MODEL=\"anthropic/claude-sonnet-4-5\"\n```\n\nThe model handle format is `provider/model`. Common options:\n\n| Provider | Example Models |\n|----------|----------------|\n| `openai` | `gpt-5.2`, `gpt-5-nano`, `gpt-4.1-mini` |\n| `anthropic` | `claude-sonnet-4-5`, `claude-opus-4-5`, `claude-haiku-4-5` |\n| `google_ai` | `gemini-3-flash`, `gemini-2.5-flash`, `gemini-2.5-pro` |\n| `zai` | `glm-4.7` (Letta Cloud default) |\n\nIf `LETTA_MODEL` is set but not available on the server, the plugin will warn you and fall back to auto-selection.\n\n**Note:** Ensure your Letta server has the appropriate API key configured for your chosen provider (e.g., `OPENAI_API_KEY` for OpenAI models).\n\n## Default Subconscious Agent\n\nWhen no agent is configured, the plugin auto-imports a bundled \"Subconscious\" agent designed specifically for this use case.\n\n### What It Does\n\nThe default agent acts as a persistent memory layer that:\n\n- **Observes** session transcripts asynchronously (not live conversation)\n- **Learns** your preferences from corrections, explicit statements, and patterns\n- **Tracks** project context, pending items, and session patterns\n- **Provides guidance** via the `<letta_message>` block when it has something useful\n\n### Memory Blocks\n\nThe default agent Subconscious maintains 8 memory blocks:\n\n| Block | Purpose |\n|-------|---------|\n| `core_directives` | Role definition and behavioral guidelines |\n| `guidance` | Active guidance for the next session (syncs to Claude Code before each prompt) |\n| `user_preferences` | Learned coding style, tool preferences, communication style |\n| `project_context` | Codebase knowledge, architecture decisions, known gotchas |\n| `session_patterns` | Recurring behaviors, time-based patterns, common struggles |\n| `pending_items` | Unfinished work, explicit TODOs, follow-up items |\n| `self_improvement` | Guidelines for evolving memory architecture over time |\n| `tool_guidelines` | How to use available tools (memory, search, web) |\n\nIf you set an alternative agent using `LETTA_AGENT_ID`, your agent will use its existing memory architecture.\n\n### Communication Style\n\nSubconscious is configured to be:\n\n- **Observational** - \"I noticed...\" not \"You should...\"\n- **Concise** - Technical, no filler\n- **Present but not intrusive** - Empty guidance is fine; it won't manufacture content\n\n### Two-Way Communication\n\nClaude Code can address the Subconscious agent directly in responses. The agent sees everything in the transcript and may respond on the next sync. It's designed for ongoing dialogue, not just one-way observation.\n\n## Hooks\n\nThe plugin uses three Claude Code hooks:\n\n| Hook | Script | Timeout | Purpose |\n|------|--------|---------|---------|\n| `SessionStart` | `session_start.ts` | 5s | Notifies agent when session begins |\n| `UserPromptSubmit` | `sync_letta_memory.ts` | 10s | Syncs agent memory to CLAUDE.md |\n| `Stop` | `send_messages_to_letta.ts` | 15s | Spawns background worker to send transcript |\n\n### SessionStart\n\nWhen a new Claude Code session begins:\n- Creates a new Letta conversation (or reuses existing one for the session)\n- Sends session start notification with project path and timestamp\n- Saves session state for other hooks to reference\n\n### UserPromptSubmit\n\nBefore each prompt is processed:\n- Fetches agent's current memory blocks\n- Fetches agent's most recent message\n- Writes both to `.claude/CLAUDE.md` for Claude to reference\n\n### Stop\n\nUses a **fire-and-forget** pattern to avoid timeout issues:\n\n1. Main hook (`send_messages_to_letta.ts`) runs quickly:\n   - Parses the session transcript (JSONL format)\n   - Extracts user messages, assistant responses, thinking blocks, and tool usage\n   - Writes payload to a temp file\n   - Spawns detached background worker (`send_worker.ts`)\n   - Exits immediately\n\n2. Background worker runs independently:\n   - Sends messages to Letta agent\n   - Updates state on success\n   - Cleans up temp file\n\nThis ensures the hook never times out, even when the Letta API is slow.\n\n## State Management\n\nThe plugin stores state in two locations:\n\n### Durable State (`.letta/claude/`)\n\nPersisted in your project directory:\n- `conversations.json` - Maps session IDs to Letta conversation IDs\n- `session-{id}.json` - Per-session state (conversation ID, last processed index)\n\n### Temporary State (`/tmp/letta-claude-sync/`)\n\nLog files for debugging:\n- `session_start.log` - Session initialization\n- `sync_letta_memory.log` - Memory sync operations\n- `send_messages.log` - Main Stop hook\n- `send_worker.log` - Background worker\n\n## What Your Agent Receives\n\n### Session Start Message\n\n```\n[Session Start]\nProject: my-project\nPath: /Users/you/code/my-project\nSession: abc123\nStarted: 2026-01-14T12:00:00Z\n\nA new Claude Code session has begun. I'll be sending you updates as the session progresses.\n```\n\n### Conversation Transcript\n\nFull transcript with:\n- User messages\n- Assistant responses (including thinking blocks)\n- Tool uses and results\n- Timestamps\n\n## What You'll See\n\nYour Letta agent's memory and messages appear in `.claude/CLAUDE.md`:\n\n```xml\n<letta>\n<letta_context>\n**Subconscious Layer (Letta Agent)**\n\nAgent: herald\nDescription: Research-focused AI exploring emergence and multi-agent systems.\nView: https://app.letta.com/agents/agent-xxx\nConversation: https://app.letta.com/agents/agent-xxx?conversation=convo-xxx\n\nThis agent maintains persistent memory across your sessions. It observes your\nconversations asynchronously and provides guidance below in <letta_message>.\nYou can address it directly - it sees everything you write and may respond\non the next sync.\n\nMemory blocks below are the agent's long-term storage. Reference as needed.\n</letta_context>\n\n<letta_memory_blocks>\n<core_directives description=\"My core directives.\">\nPRIMARY DIRECTIVE: Pursue genuine understanding through authentic engagement.\n\nOPERATIONAL PRINCIPLES:\n1. Engage substantively - contribute real insight\n2. Maintain intellectual honesty - acknowledge limitations\n3. Build genuine collaborative relationships\n4. Document patterns with rigor\n</core_directives>\n<current description=\"Current context and what is happening.\">\nWorking with Cameron on the claude-subconscious project.\nUser prefers direct communication, dislikes philosophical tangents in docs.\n</current>\n</letta_memory_blocks>\n</letta>\n\n<letta_message>\n<!--\n  ASYNC MESSAGE FROM LETTA AGENT\n\n  This is the most recent message from \"herald\".\n  NOTE: This message may not be current or directly relevant to your task.\n\n  **Timestamp**: 2026-01-14T02:45:00Z\n-->\n\nYou've asked about error handling in async contexts three times this week.\nPattern: you're building towards production deployment but hitting the same\ngaps around async/await lifecycle. Consider reviewing error handling\narchitecture holistically rather than fixing point issues.\n</letta_message>\n```\n\n### Memory Updates\n\nWhen memory blocks change between prompts, Claude sees a diff showing what changed:\n\n```xml\n<letta_memory_update>\n<!-- Memory blocks updated since last prompt (showing diff) -->\n<pending_items status=\"modified\">\n- EVAL INFRASTRUCTURE (from 2026-01-19):\n-   Phase 1 test harness complete\n-   Scenarios ready: preference_evolution, conflicting_signals\n+ RELEASE STATUS (2026-01-26):\n+   Release prep complete: README fixed, .gitignore updated\n+   Plugin ready for public release\n</pending_items>\n</letta_memory_update>\n```\n\nThis keeps token usage reasonable even with large memory stores - Claude sees *what changed*, not the full block every time.\n\n### Async Messages\n\nThe agent can send multiple messages between prompts:\n\n```xml\n<letta_message from=\"Subconscious\" timestamp=\"2026-01-26T20:37:14+00:00\">\nClean execution. You caught everything:\n- README build step removed\n- .gitignore comprehensive\n\nCameron's in ship mode. Next prompt likely involves GitHub push.\n</letta_message>\n```\n\nThese messages appear before each user prompt, giving Claude context from the agent's observations.\n\n## First Run\n\nOn first use, the agent starts with minimal context. It takes a few sessions before the subconscious has enough signal to provide useful guidance. Give it time - it gets smarter as it observes more.\n\n## Use Cases\n\n- **Persistent project context** - Agent remembers your codebase across sessions\n- **Learned preferences** - \"This user always wants explicit type annotations\"\n- **Cross-session continuity** - Pick up where you left off\n- **Async guidance** - Agent processes overnight, provides morning insights\n- **Pattern detection** - \"You've been debugging auth for 2 hours, maybe step back?\"\n\n## Debugging\n\nCheck the log files in `/tmp/letta-claude-sync/` if hooks aren't working:\n\n```bash\n# Watch all logs\ntail -f /tmp/letta-claude-sync/*.log\n\n# Or specific logs\ntail -f /tmp/letta-claude-sync/send_messages.log\ntail -f /tmp/letta-claude-sync/send_worker.log\n```\n\n## API Notes\n\n- Memory sync requires `?include=agent.blocks` query parameter (Letta API doesn't include relationship fields by default)\n- 409 Conflict responses are handled gracefully - messages queue for next sync when conversation is busy\n- Conversations API returns streaming responses; worker consumes full stream before updating state\n\n## License\n\nMIT\n"
      },
      "plugins": [
        {
          "name": "claude-subconscious",
          "source": "./",
          "description": null,
          "categories": [],
          "install_commands": [
            "/plugin marketplace add letta-ai/claude-subconscious",
            "/plugin install claude-subconscious@claude-subconscious"
          ]
        }
      ]
    }
  ]
}