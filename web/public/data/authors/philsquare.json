{
  "author": {
    "id": "philsquare",
    "display_name": "Philsquare",
    "avatar_url": "https://avatars.githubusercontent.com/u/882551?v=4"
  },
  "marketplaces": [
    {
      "name": "philsquare-permissions",
      "version": null,
      "description": "Claude Code plugin for philsquare/permissions - policy-based role permissions for Laravel",
      "repo_full_name": "philsquare/permissions",
      "repo_url": "https://github.com/philsquare/permissions",
      "repo_description": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2025-12-12T21:57:23Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"philsquare-permissions\",\n  \"owner\": {\n    \"name\": \"Phil Mareu\",\n    \"email\": \"phil@philsquare.com\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"philsquare-permissions\",\n      \"source\": \"./\",\n      \"description\": \"Claude Code plugin for philsquare/permissions - policy-based role permissions for Laravel\",\n      \"version\": \"1.0.0\",\n      \"author\": {\n        \"name\": \"Phil Mareu\",\n        \"email\": \"phil@philsquare.com\"\n      },\n      \"repository\": \"https://github.com/philsquare/permissions\",\n      \"license\": \"MIT\",\n      \"keywords\": [\"laravel\", \"permissions\", \"roles\", \"authorization\", \"policy\"],\n      \"category\": \"framework\"\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"philsquare-permissions\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Claude Code plugin for philsquare/permissions - policy-based role permissions for Laravel\",\n  \"author\": {\n    \"name\": \"Phil Mareu\",\n    \"email\": \"phil@philsquare.com\"\n  },\n  \"license\": \"MIT\"\n}\n",
        "README.md": "# Philsquare Permissions\n\nA Laravel package for managing role-based permissions through policies. Define permissions declaratively in your policies and sync them to your database with a single command.\n\n## Requirements\n\n- PHP 8.1+\n- Laravel 10+\n- [spatie/laravel-permission](https://github.com/spatie/laravel-permission) ^6.21\n\n## Installation\n\n```bash\ncomposer require philsquare/permissions\n```\n\nThe service provider is auto-registered via Laravel's package discovery.\n\n### Setup Spatie Permissions\n\nIf you haven't already, publish and run the Spatie migrations:\n\n```bash\nphp artisan vendor:publish --provider=\"Spatie\\Permission\\PermissionServiceProvider\"\nphp artisan migrate\n```\n\nAdd the `HasRoles` trait to your User model:\n\n```php\nuse Spatie\\Permission\\Traits\\HasRoles;\n\nclass User extends Authenticatable\n{\n    use HasRoles;\n}\n```\n\n## Quick Start\n\n### 1. Create a Policy\n\nUse the artisan command with the `--withPermissions` flag:\n\n```bash\nphp artisan make:policy PostPolicy --model=Post --withPermissions\n```\n\nOr add permissions to an existing policy by extending `BasePolicy`:\n\n```php\n<?php\n\nnamespace App\\Policies;\n\nuse App\\Models\\Post;\nuse App\\Models\\User;\nuse Philsquare\\Permissions\\BasePolicy;\n\nclass PostPolicy extends BasePolicy\n{\n    public function rolePermissions(): array\n    {\n        return [\n            'admin' => $this->permissions()->all(),\n            'editor' => $this->permissions()->crud(),\n            'viewer' => $this->permissions()->only(['viewAny', 'view']),\n        ];\n    }\n\n    public function viewAny(User $user): bool\n    {\n        return true;\n    }\n\n    public function view(User $user, Post $post): bool\n    {\n        return true;\n    }\n\n    public function create(User $user): bool\n    {\n        return true;\n    }\n\n    public function update(User $user, Post $post): bool\n    {\n        return true;\n    }\n\n    public function delete(User $user, Post $post): bool\n    {\n        return true;\n    }\n}\n```\n\n### 2. Sync Permissions to Database\n\nRun the refresh command whenever you add or modify permissions:\n\n```bash\nphp artisan permissions:refresh\n```\n\nThis command:\n- Scans all policies in `app/Policies/` that extend `BasePolicy`\n- Creates any missing roles\n- Creates any missing permissions\n- Syncs role-permission assignments\n\n### 3. Assign Roles to Users\n\nUse Spatie's methods to assign roles:\n\n```php\n$user->assignRole('editor');\n```\n\n### 4. Check Permissions\n\nUse Laravel's built-in authorization:\n\n```php\n// In controllers\n$this->authorize('update', $post);\n\n// Using Gate\nGate::authorize('update', $post);\n\n// On User model\n$user->can('update', $post);\n\n// In Blade\n@can('update', $post)\n    <button>Edit</button>\n@endcan\n```\n\n## How It Works\n\n### Permission Naming Convention\n\nPermissions are stored in kebab-case format: `{model}:{action}`\n\n| Policy Method | Database Permission |\n|---------------|---------------------|\n| `PostPolicy::viewAny()` | `post:view-any` |\n| `PostPolicy::create()` | `post:create` |\n| `PostPolicy::forceDelete()` | `post:force-delete` |\n| `PurchaseOrderPolicy::updateEta()` | `purchase-order:update-eta` |\n\n### The `before()` Hook\n\nWhen you extend `BasePolicy`, the `before()` method automatically checks if the user's roles have the required permission. If the permission exists, it returns `null` (allowing the policy method to execute). If not, it returns `false` (denying access).\n\nThis means your policy methods define the *logic* for when an action should be allowed, and the role-permission mapping controls *who* can attempt it.\n\n### Policy Method Return Values\n\nYour policy methods should return `true` or `false` based on business logic:\n\n```php\npublic function update(User $user, Post $post): bool\n{\n    // Only allow updates if post is draft OR user has force-update permission\n    return $post->status === 'draft' || $user->can('force-update', $post);\n}\n```\n\nThe `before()` hook runs first. If the user lacks the permission, they're denied immediately. If they have the permission, your method's logic determines the final result.\n\n## Permission Helpers\n\nThe `permissions()` method provides helpers for building permission lists:\n\n### `all()`\n\nReturns all public methods from the policy (excluding system methods):\n\n```php\npublic function rolePermissions(): array\n{\n    return [\n        'admin' => $this->permissions()->all(),\n    ];\n}\n```\n\n### `crud(array $additional = [])`\n\nReturns standard CRUD methods plus any additional methods:\n\n```php\n// Returns: viewAny, view, create, update, delete\n'editor' => $this->permissions()->crud(),\n\n// Returns: viewAny, view, create, update, delete, publish, archive\n'editor' => $this->permissions()->crud(['publish', 'archive']),\n```\n\n### `only(array $methods)`\n\nReturns only the specified methods:\n\n```php\n'viewer' => $this->permissions()->only(['viewAny', 'view']),\n```\n\n### `except(array $methods)`\n\nReturns all methods except the specified ones:\n\n```php\n'editor' => $this->permissions()->except(['delete', 'forceDelete']),\n```\n\n## Full Example\n\n```php\n<?php\n\nnamespace App\\Policies;\n\nuse App\\Enums\\OrderStatus;\nuse App\\Models\\Order;\nuse App\\Models\\User;\nuse Philsquare\\Permissions\\BasePolicy;\n\nclass OrderPolicy extends BasePolicy\n{\n    public function rolePermissions(): array\n    {\n        return [\n            'admin' => $this->permissions()->all(),\n            'manager' => $this->permissions()->crud(['cancel', 'refund']),\n            'sales' => $this->permissions()->only(['viewAny', 'view', 'create']),\n            'support' => $this->permissions()->only(['viewAny', 'view', 'addNote']),\n        ];\n    }\n\n    public function viewAny(User $user): bool\n    {\n        return true;\n    }\n\n    public function view(User $user, Order $order): bool\n    {\n        return true;\n    }\n\n    public function create(User $user): bool\n    {\n        return true;\n    }\n\n    public function update(User $user, Order $order): bool\n    {\n        // Can only update pending orders\n        return $order->status === OrderStatus::PENDING;\n    }\n\n    public function delete(User $user, Order $order): bool\n    {\n        // Can only delete draft orders with no items\n        return $order->status === OrderStatus::DRAFT\n            && $order->items()->count() === 0;\n    }\n\n    public function cancel(User $user, Order $order): bool\n    {\n        return in_array($order->status, [\n            OrderStatus::PENDING,\n            OrderStatus::PROCESSING,\n        ]);\n    }\n\n    public function refund(User $user, Order $order): bool\n    {\n        return $order->status === OrderStatus::COMPLETED\n            && $order->paid_at !== null;\n    }\n\n    public function addNote(User $user, Order $order): bool\n    {\n        return true;\n    }\n}\n```\n\n## Commands\n\n### `permissions:refresh`\n\nSyncs all role permissions from policies to the database. Run this after:\n- Adding a new policy method\n- Changing the `rolePermissions()` array\n- Adding a new role\n\n```bash\nphp artisan permissions:refresh\n```\n\n### `make:policy --withPermissions`\n\nCreates a new policy that extends `BasePolicy`:\n\n```bash\nphp artisan make:policy ArticlePolicy --model=Article --withPermissions\n```\n\n## Deployment\n\nAdd `permissions:refresh` to your deploy script to ensure permissions stay in sync:\n\n```bash\nphp artisan migrate --force\nphp artisan permissions:refresh\nphp artisan config:cache\nphp artisan route:cache\n```\n\nThis ensures any new permissions added in the release are automatically synced to the database without manual intervention.\n\n## Defining Roles\n\nRoles are created automatically when you run `permissions:refresh`. Any role name used in a `rolePermissions()` array will be created if it doesn't exist.\n\nFor better organization, you can define roles in an enum:\n\n```php\n<?php\n\nnamespace App\\Enums;\n\nenum Roles: string\n{\n    case Admin = 'admin';\n    case Manager = 'manager';\n    case Editor = 'editor';\n    case Viewer = 'viewer';\n}\n```\n\nThen use it in your policies:\n\n```php\nuse App\\Enums\\Roles;\n\npublic function rolePermissions(): array\n{\n    return [\n        Roles::Admin->value => $this->permissions()->all(),\n        Roles::Editor->value => $this->permissions()->crud(),\n    ];\n}\n```\n\n## Claude Code Plugin\n\nThis package includes a [Claude Code](https://claude.com/claude-code) plugin that provides AI-assisted permission implementation.\n\n### Features\n\n**Autonomous Implementation**: When you create a new policy in a project using this package, the plugin's agent will proactively offer to add role-based permissions - extending `BasePolicy` and implementing `rolePermissions()` with appropriate helpers.\n\n**Skill Knowledge**: The plugin provides Claude with knowledge about permission helpers, naming conventions, and best practices so it can correctly implement permissions without documentation lookups.\n\n**Commands**:\n- `/philsquare-permissions:refresh` - Run `permissions:refresh` to sync permissions\n- `/philsquare-permissions:make-policy <Model>` - Create a new policy with permissions scaffold\n\n### Installation\n\nThe plugin is included in the package. To enable it in Claude Code:\n\n**Option 1: Using the /plugins command**\n\nRun `/plugins` in Claude Code and add `vendor/philsquare/permissions` as a local plugin.\n\n**Option 2: Manual configuration**\n\nAdd the plugin path to your project's `.claude/settings.json`:\n\n```json\n{\n  \"plugins\": [\n    \"vendor/philsquare/permissions\"\n  ]\n}\n```\n\n### Plugin Structure\n\n```\n.claude-plugin/\n├── plugin.json           # Plugin manifest\ncommands/\n├── refresh.md            # Refresh command\n├── make-policy.md        # Make policy command\nagents/\n├── permissions-implementer.md  # Autonomous agent\nskills/\n└── permissions-usage/\n    ├── SKILL.md          # Package knowledge\n    └── references/\n        └── permission-helpers.md\n```\n\n### Using the Plugin\n\nThe plugin activates automatically in projects that have `philsquare/permissions` in their `composer.json`. When creating policies, Claude will:\n\n1. Detect the package is installed\n2. Extend `BasePolicy` instead of Laravel's base policy\n3. Add the `rolePermissions()` method with appropriate role mappings\n4. Remind you to run `permissions:refresh`\n\n## License\n\nMIT\n"
      },
      "plugins": [
        {
          "name": "philsquare-permissions",
          "source": "./",
          "description": "Claude Code plugin for philsquare/permissions - policy-based role permissions for Laravel",
          "version": "1.0.0",
          "author": {
            "name": "Phil Mareu",
            "email": "phil@philsquare.com"
          },
          "repository": "https://github.com/philsquare/permissions",
          "license": "MIT",
          "keywords": [
            "laravel",
            "permissions",
            "roles",
            "authorization",
            "policy"
          ],
          "category": "framework",
          "categories": [
            "authorization",
            "framework",
            "laravel",
            "permissions",
            "policy",
            "roles"
          ],
          "install_commands": [
            "/plugin marketplace add philsquare/permissions",
            "/plugin install philsquare-permissions@philsquare-permissions"
          ]
        }
      ]
    }
  ]
}