{
  "author": {
    "id": "jack-michaud",
    "display_name": "Jack Michaud",
    "avatar_url": "https://avatars.githubusercontent.com/u/13189762?u=8d79e7306506674c8f947f68be6cad21c8c238e9&v=4"
  },
  "marketplaces": [
    {
      "name": "ephemeral-environments",
      "version": null,
      "description": "Plugins for integrating projects with the ephemeral environments PR preview system",
      "repo_full_name": "jack-michaud/ephemeral-environments",
      "repo_url": "https://github.com/jack-michaud/ephemeral-environments",
      "repo_description": "Run your docker composes in EC2 instances for each PR in your repo - automatically updates and cleans up after PRs close",
      "signals": {
        "stars": 1,
        "forks": 0,
        "pushed_at": "2026-01-18T16:34:34Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"ephemeral-environments\",\n  \"owner\": {\n    \"name\": \"Jack Michaud\"\n  },\n  \"metadata\": {\n    \"description\": \"Plugins for integrating projects with the ephemeral environments PR preview system\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"ephemeral-environments\",\n      \"source\": \"./.claude-plugin/plugin\",\n      \"description\": \"Integrate any project with the ephemeral environments system for automatic PR preview deployments\",\n      \"version\": \"0.1.0\",\n      \"author\": {\n        \"name\": \"Jack Michaud\"\n      },\n      \"repository\": \"https://github.com/jack-michaud/ephemeral-environments\",\n      \"keywords\": [\"ephemeral\", \"preview\", \"pr\", \"deployment\", \"docker\", \"github\"],\n      \"category\": \"devops\"\n    }\n  ]\n}\n",
        "README.md": "# Ephemeral Environments\n\nThis sort of thing should be commoditized at this point, right?\n\nSpin up temporary environments for pull requests. Each PR gets its own isolated environment with a public URL.\n\nhttps://github.com/user-attachments/assets/d8c23964-01a9-4853-95cf-01c927398327\n\n**Contents:** [How It Works](#how-it-works) | [Quick Start](#quick-start) | [Integrating Your Project](#integrating-your-project) | [Setup](#setup) | [Performance](#performance) | [Cost](#cost)\n\n## How It Works\n\n```\nGitHub PR Event → Cloudflare Worker → SQS → Lambda\n                                              ├─ Launch EC2\n                                              ├─ Clone repo and run docker-compose\n                                              ├─ Create Cloudflare Quick Tunnel\n                                              └─ Post URL to GitHub PR\n```\n\nWhen you open a PR, the system:\n1. Receives the webhook and queues a deployment\n2. Launches an EC2 instance from a pre-built AMI\n3. Clones your branch and starts services with Docker Compose\n4. Creates a public tunnel URL\n5. Comments the URL on your PR\n\nEnvironments stop after 4 hours idle and terminate after 24 hours stopped. A reconciler runs every 30 minutes to clean up orphaned instances from closed PRs.\n\n## Quick Start\n\n```bash\n# Copy and configure environment\ncp .env.example .env\n# Edit .env with your AWS, Cloudflare, and GitHub credentials\n\n# Deploy everything\nmake deploy\n```\n\n## Commands\n\n| Command | Purpose |\n|---------|---------|\n| `make deploy` | Full deployment (Terraform + AMI + Worker + Lambda) |\n| `make destroy` | Tear down all infrastructure |\n| `make tf-plan` | Preview infrastructure changes |\n| `make tf-apply` | Apply infrastructure changes |\n| `make ami-build` | Build the EC2 environment AMI |\n| `make worker-dev` | Run Cloudflare Worker locally (port 8787) |\n| `make worker-deploy` | Deploy Worker to Cloudflare |\n| `make lambda-update` | Rebuild and deploy Lambda functions |\n| `make test-e2e` | Run end-to-end tests |\n\n## Architecture\n\n| Component | Location | Role |\n|-----------|----------|------|\n| Webhook Handler | `worker/src/index.ts` | Receives GitHub webhooks, queues to SQS |\n| Deploy Lambda | `src/deployer/` | Orchestrates EC2, tunnels, and GitHub updates |\n| Cleanup Lambda | `src/cleanup/` | Auto-stops idle environments |\n| Reconciler Lambda | `src/reconciler/` | Terminates orphans, reconciles state |\n| AWS Infrastructure | `infra/aws/` | Terraform for EC2, Lambda, SQS, DynamoDB, VPC |\n| AMI Builder | `packer/` | Amazon Linux 2023 with Docker and cloudflared |\n\n## Integrating Your Project\n\nThis repo includes a Claude Code plugin that helps integrate any project with the ephemeral environment system.\n\n### Install the Plugin\n\n```bash\n/plugin marketplace add jack-michaud/ephemeral-environments\n/plugin install ephemeral-environments@ephemeral-environments\n```\n\n### Use the /integrate Command\n\nIn your project directory, run:\n\n```bash\n/integrate\n```\n\nThe command analyzes your project and:\n1. Checks for a compatible `docker-compose.yml`\n2. Verifies port 80 is exposed\n3. Detects your tech stack and dependencies\n4. Generates configuration if needed\n\n### Requirements\n\nYour project needs:\n- A `docker-compose.yml` that exposes port 80\n- A Dockerfile that builds your application\n- The GitHub App installed on your repository\n\n**Example docker-compose.yml:**\n```yaml\nservices:\n  app:\n    build: .\n    ports:\n      - \"80:3000\"  # Expose your app on port 80\n```\n\n## Setup\n\n### GitHub App\n\nThe system uses a GitHub App to receive webhooks and post comments. Run the setup script:\n\n```bash\n./scripts/setup-github-app.sh\n```\n\nThis guides you through creating an app with minimal permissions:\n- **Contents**: Read (clone repos)\n- **Commit statuses**: Write (post status checks)\n- **Pull requests**: Write (post comments)\n\nAfter creating the app, save the private key as `github-app.pem` and add the App ID to your `.env`.\n\n### AWS and Cloudflare\n\nSetup scripts create credentials with minimal permissions:\n\n```bash\n./scripts/setup-aws-credentials.sh\n./scripts/setup-cloudflare-token.sh\n```\n\n### Configuration\n\nAll settings live in `.env`. See `.env.example` for the full list.\n\n## Performance\n\nTypical end-to-end deployment times from webhook to environment ready:\n\n| Phase | Duration | Description |\n|-------|----------|-------------|\n| Webhook → Lambda | ~1s | Cloudflare Worker queues to SQS |\n| Secrets + Auth | ~2-3s | Fetch Cloudflare/GitHub credentials |\n| EC2 Launch | ~1-2s | Request instance from launch template |\n| Instance Ready | ~6-7s | Wait for instance to pass status checks |\n| SSM Bootstrap | ~50-65s | Clone repo, docker-compose build/up, tunnel start |\n| **Total** | **~60-75s** | End-to-end deployment |\n\n**Rebuild times** (existing environment): ~60-65s (terminates old instance first)\n\n**Cleanup times**:\n- Destroy on PR close: <1s\n- Auto-stop (4h idle): Immediate stop\n- Terminate (24h stopped): Immediate terminate\n- Reconciler cleanup: Every 30 min scan\n\n*Metrics last validated: 2026-01-18 (from Lambda CloudWatch logs)*\n\n## Cost\n\n**Idle cost: ~$2-3/month** (no active environments)\n\n| Resource | Monthly Cost | Notes |\n|----------|-------------|-------|\n| Secrets Manager (2x) | $0.80 | GitHub App + Cloudflare credentials |\n| CloudWatch Logs | ~$1 | Scheduled Lambda execution logs |\n| Lambda/EventBridge | <$0.50 | Free tier covers cleanup/reconciler runs |\n\n**Active environments:** EC2 instances (t3.small ~$0.02/hour) + data transfer. Environments auto-stop after 4 hours idle and terminate after 24 hours stopped.\n\n**Design decisions that minimize cost:**\n- DynamoDB on-demand (scales to zero)\n- Lambda pay-per-invocation (no provisioned concurrency)\n- Public subnets with public IPs (no NAT Gateway)\n- No VPC endpoints (EC2 reaches SSM over internet)\n\n## Tech Stack\n\n- **TypeScript**: Cloudflare Worker\n- **Python 3.11**: Lambda functions (boto3, PyGithub)\n- **Terraform**: AWS and Cloudflare infrastructure\n- **Packer**: AMI builds\n- **Docker Compose**: Application runtime\n"
      },
      "plugins": [
        {
          "name": "ephemeral-environments",
          "source": "./.claude-plugin/plugin",
          "description": "Integrate any project with the ephemeral environments system for automatic PR preview deployments",
          "version": "0.1.0",
          "author": {
            "name": "Jack Michaud"
          },
          "repository": "https://github.com/jack-michaud/ephemeral-environments",
          "keywords": [
            "ephemeral",
            "preview",
            "pr",
            "deployment",
            "docker",
            "github"
          ],
          "category": "devops",
          "categories": [
            "deployment",
            "devops",
            "docker",
            "ephemeral",
            "github",
            "pr",
            "preview"
          ],
          "install_commands": [
            "/plugin marketplace add jack-michaud/ephemeral-environments",
            "/plugin install ephemeral-environments@ephemeral-environments"
          ]
        }
      ]
    }
  ]
}