{
  "author": {
    "id": "morris-y",
    "display_name": "Morris Yang",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/86863014?u=2056f8d98caeb1d04863da05f43b7d16e5ecbddd&v=4",
    "url": "https://github.com/morris-y",
    "bio": null,
    "stats": {
      "total_marketplaces": 2,
      "total_plugins": 2,
      "total_commands": 4,
      "total_skills": 4,
      "total_stars": 0,
      "total_forks": 0
    }
  },
  "marketplaces": [
    {
      "name": "blueprint-marketplace",
      "version": null,
      "description": "Personal marketplace for blueprint trading strategy skills",
      "owner_info": {
        "name": "morrisy"
      },
      "keywords": [],
      "repo_full_name": "morris-y/blueprint-skills",
      "repo_url": "https://github.com/morris-y/blueprint-skills",
      "repo_description": "Claude Code plugin: Trading strategy lifecycle skills with postmortem compliance (plan, develop, review, optimize)",
      "homepage": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2026-01-15T03:38:39Z",
        "created_at": "2026-01-14T12:04:32Z",
        "license": "MIT"
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 445
        },
        {
          "path": ".claude-plugin/plugin.json",
          "type": "blob",
          "size": 310
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 3042
        },
        {
          "path": "commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "commands/blueprint-develop.md",
          "type": "blob",
          "size": 306
        },
        {
          "path": "commands/blueprint-optimize.md",
          "type": "blob",
          "size": 304
        },
        {
          "path": "commands/blueprint-plan.md",
          "type": "blob",
          "size": 325
        },
        {
          "path": "commands/blueprint-review.md",
          "type": "blob",
          "size": 290
        },
        {
          "path": "skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/blueprint-develop",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/blueprint-develop/SKILL.md",
          "type": "blob",
          "size": 19724
        },
        {
          "path": "skills/blueprint-optimize",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/blueprint-optimize/SKILL.md",
          "type": "blob",
          "size": 19160
        },
        {
          "path": "skills/blueprint-plan",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/blueprint-plan/SKILL.md",
          "type": "blob",
          "size": 12943
        },
        {
          "path": "skills/blueprint-review",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/blueprint-review/SKILL.md",
          "type": "blob",
          "size": 19340
        }
      ],
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"blueprint-marketplace\",\n  \"description\": \"Personal marketplace for blueprint trading strategy skills\",\n  \"owner\": {\n    \"name\": \"morrisy\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"blueprint-skills\",\n      \"description\": \"Trading strategy lifecycle skills: plan, develop, review, and optimize with postmortem compliance\",\n      \"version\": \"1.0.0\",\n      \"source\": \"./\",\n      \"author\": {\n        \"name\": \"morrisy\"\n      }\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"blueprint-skills\",\n  \"description\": \"Trading strategy lifecycle skills: plan, develop, review, and optimize with postmortem compliance\",\n  \"version\": \"1.0.4\",\n  \"author\": {\n    \"name\": \"morrisy\"\n  },\n  \"keywords\": [\"trading\", \"strategy\", \"backtest\", \"polymarket\", \"postmortem\", \"tdd\", \"linear\"]\n}\n",
        "README.md": "# Blueprint Skills\n\nClaude Code plugin for trading strategy lifecycle management with postmortem compliance.\n\n## Skills Included\n\n| Skill | Description |\n|-------|-------------|\n| `blueprint-plan` | Transform strategy ideas into Linear tickets with PM immune screening |\n| `blueprint-develop` | TDD-based strategy implementation with PM regression prevention |\n| `blueprint-review` | Security, quality, and PM compliance review before merging |\n| `blueprint-optimize` | Post-merge iteration: Linear sync, PM creation, CLAUDE.md updates |\n\n## Installation\n\n### Option 1: Create Personal Marketplace (Recommended)\n\n1. Create your own marketplace repo (e.g., `my-claude-marketplace`)\n2. Add this plugin to your marketplace's plugin list\n3. Install via: `claude plugins add-marketplace <your-marketplace-repo>`\n\n### Option 2: Direct Installation\n\n```bash\n# Clone to local plugins directory\ngit clone https://github.com/morris-y/blueprint-skills.git ~/.claude/plugins/cache/blueprint-local/blueprint-skills/1.0.0\n\n# Then manually add to ~/.claude/plugins/installed_plugins.json\n```\n\n## Usage\n\nAfter installation and restarting Claude Code:\n\n- `/blueprint-plan` - Start planning a new strategy\n- `/blueprint-develop` - Begin TDD implementation\n- `/blueprint-review` - Run pre-merge review\n- `/blueprint-optimize` - Complete iteration cycle\n\nOr use full qualified names:\n- `blueprint-skills:blueprint-plan`\n- `blueprint-skills:blueprint-develop`\n- `blueprint-skills:blueprint-review`\n- `blueprint-skills:blueprint-optimize`\n\n## Core Concepts\n\n### Dual-Layer Memory System\n\n```\n./postmortem/ = æ·±åº¦ç—…å†åº“ (Deep Case History)\n                â†’ å®Œæ•´çš„äº‹æ•…åˆ†æã€root causeã€è¯¦ç»†ä¿®å¤\n                â†’ æ— è¡Œæ•°é™åˆ¶\n\n./CLAUDE.md   = é«˜é¢‘æ‰‹æœ¯å‡†åˆ™ (High-Frequency Operating Rules)\n                â†’ åªæœ‰æŒ‡ä»¤å’Œè­¦å‘Šï¼Œæ— è§£é‡Š\n                â†’ ä¸¥æ ¼ â‰¤ 100 è¡Œ\n```\n\n### Workflow\n\n```\nblueprint-plan -> blueprint-develop -> blueprint-review -> blueprint-optimize\n                       ^                                           |\n                       +-------------------------------------------+\n```\n\n## Dependencies\n\nThese skills integrate with:\n- `ralph-loop` - For iterative refinement loops\n- `superpowers` - TDD (`test-driven-development`), debugging (`systematic-debugging`), code review (`requesting-code-review`), planning (`writing-plans`, `executing-plans`), verification (`verification-before-completion`), branch management (`finishing-a-development-branch`)\n- `code-review` - PR code review (`code-review`)\n- `security-guidance` - Security best practices and vulnerability guidance (in `blueprint-review`)\n- `frontend-design` - High-quality frontend interfaces (in `blueprint-develop` when frontend-related)\n- `code-simplifier` - Code simplification and refactoring (in `blueprint-develop`, `blueprint-review`)\n- `context7` - Comprehensive context gathering (throughout all phases)\n- `linear` - Ticket management\n- `commit-commands` - Git operations (`commit`, `commit-push-pr`)\n\n## License\n\nMIT\n",
        "commands/blueprint-develop.md": "---\ndescription: \"TDD-based strategy implementation with PM regression prevention\"\n---\n# Blueprint Develop Command\n\nUse the blueprint-develop skill for test-driven development of trading strategies.\n\nYou should use the Skill tool to invoke `blueprint-skills:blueprint-develop` and follow its instructions.\n",
        "commands/blueprint-optimize.md": "---\ndescription: \"Post-merge iteration: Linear sync, PM creation, CLAUDE.md updates\"\n---\n# Blueprint Optimize Command\n\nUse the blueprint-optimize skill to complete iteration cycle after PR merge.\n\nYou should use the Skill tool to invoke `blueprint-skills:blueprint-optimize` and follow its instructions.\n",
        "commands/blueprint-plan.md": "---\ndescription: \"Transform strategy ideas into Linear tickets with PM immune screening\"\n---\n# Blueprint Plan Command\n\nUse the blueprint-plan skill to transform a new trading strategy idea into actionable Linear tickets.\n\nYou should use the Skill tool to invoke `blueprint-skills:blueprint-plan` and follow its instructions.\n",
        "commands/blueprint-review.md": "---\ndescription: \"Security, quality, and PM compliance review before merging\"\n---\n# Blueprint Review Command\n\nUse the blueprint-review skill for pre-merge security and quality review.\n\nYou should use the Skill tool to invoke `blueprint-skills:blueprint-review` and follow its instructions.\n",
        "skills/blueprint-develop/SKILL.md": "---\nname: blueprint-develop\ndescription: Use for test-driven development of trading strategies. Supports Ralph Loop iterative mode for complex implementations. Ensures backtest interface alignment, atomic implementation, synchronized test updates, PM regression prevention, and dependency impact analysis.\n---\n\n# Blueprint Develop - Test-Driven Strategy Implementation\n\n## Overview\n\nExecute strategy implementation with TDD discipline and **Postmortem regression prevention**. Every code change must align with backtest interfaces, pass PM compliance checks, and have synchronized test coverage.\n\n## Core Principle\n\n```\n./postmortem/ = æ·±åº¦ç—…å†åº“ (Deep Case History)\n./CLAUDE.md   = é«˜é¢‘æ‰‹æœ¯å‡†åˆ™ (High-Frequency Operating Rules)\n\nRule: æ¯å†™ä¸€è¡Œä»£ç å‰ï¼Œå…ˆæŸ¥ CLAUDE.mdï¼›æ¯æ”¹ä¸€ä¸ªæ¨¡å—å‰ï¼Œå…ˆæŸ¥ç›¸å…³ postmortem\n```\n\n## When to Use\n\n- Implementing new trading strategy logic from Linear tickets\n- Modifying existing strategy code in `strategies/`\n- User mentions \"å¼€å‘\", \"implement\", or \"code the strategy\"\n- Any code change that affects trading logic\n\n**Do NOT use when:**\n- Planning strategy (use `blueprint-plan` instead)\n- Pure backtest runs without code changes\n- Documentation or config changes only\n\n## Prerequisites\n\nBefore invoking this skill, verify:\n- [ ] Linear ticket exists for the work (from `blueprint-plan`)\n- [ ] Backtest framework is in place (`backtest/` directory)\n- [ ] Test file location confirmed (`tests/backtest_unit.py`)\n- [ ] **PM mitigations from ticket identified** (from `blueprint-plan` Phase 0)\n\n## Workflow\n\n```dot\ndigraph blueprint_develop {\n    rankdir=TB;\n    node [shape=box];\n\n    start [label=\"Start: Linear Ticket Ready\" shape=ellipse];\n    pm_load [label=\"0. Load PM Context\\n(CLAUDE.md + postmortem/)\" style=filled fillcolor=lightyellow];\n    env [label=\"1. Environment Alignment\\n(GitHub MCP)\"];\n    pm_test [label=\"2. PM Regression Tests First\\n(TDD Red Phase)\" style=filled fillcolor=lightyellow];\n    test_first [label=\"3. Feature Tests\\n(TDD Red Phase)\"];\n    impl [label=\"4. Atomic Implementation\\n(code-simplifier)\"];\n    sync [label=\"5. Sync Test Update\\n(TDD Green Phase)\"];\n    impact [label=\"6. Impact + PM Compliance\\n(context7)\"];\n    done [label=\"Code Ready for Review\" shape=ellipse];\n\n    start -> pm_load;\n    pm_load -> env;\n    env -> pm_test;\n    pm_test -> test_first;\n    test_first -> impl;\n    impl -> sync;\n    sync -> impact;\n    impact -> done;\n}\n```\n\n## ğŸ”„ Ralph Loop Integration (Optional Iterative Mode)\n\n**When to Activate:** Complex implementations requiring multiple test-fix cycles.\n\nRalph Loop enables **iterative self-correction**: Claude repeatedly sees its own work and improves until all tests pass.\n\n### Triggering Ralph Loop\n\nInvoke when:\n- Multiple test failures expected during implementation\n- Complex logic requiring iterative refinement\n- User requests \"è¿­ä»£å¼€å‘\" or \"ralph mode\"\n\n```\nSkill: ralph-loop:ralph-loop\n\nPrompt Template:\n\"Implement [strategy component] following TDD.\nPM Compliance Checklist: [from Phase 0]\nCurrent test failures: [list from pytest]\nTarget: ALL tests in tests/backtest_unit.py and tests/pm_regression/ passing.\nOutput <promise>ALL TESTS PASSING</promise> when complete.\"\n\nOptions:\n--max-iterations 15\n--completion-promise \"ALL TESTS PASSING\"\n```\n\n### Ralph Loop Development Cycle\n\n```dot\ndigraph ralph_develop {\n    rankdir=LR;\n    node [shape=box];\n\n    start [label=\"Ralph Start\" shape=ellipse];\n    pytest [label=\"Run pytest\"];\n    fail [label=\"Tests Fail?\" shape=diamond];\n    fix [label=\"Fix Code\\n(PM Compliant)\"];\n    pass [label=\"<promise>\\nALL TESTS PASSING\" shape=ellipse style=filled fillcolor=lightgreen];\n\n    start -> pytest;\n    pytest -> fail;\n    fail -> fix [label=\"Yes\"];\n    fix -> pytest;\n    fail -> pass [label=\"No\"];\n}\n```\n\n### Ralph Loop Exit Conditions\n\n| Condition | Action |\n|-----------|--------|\n| All tests pass | Output `<promise>ALL TESTS PASSING</promise>`, exit loop |\n| Max iterations reached | Exit with summary, human decision needed |\n| PM violation detected | **STOP LOOP**, fix compliance first |\n| Blocked by external issue | Exit with `<promise>BLOCKED: [reason]</promise>` |\n\n### PM Compliance During Ralph Loop\n\n**CRITICAL:** Each iteration must maintain PM compliance:\n\n```python\n# Ralph Loop PM Check (every iteration)\n1. Before each code change:\n   - Reference PM Compliance Checklist\n   - Check CLAUDE.md directives\n\n2. After each test run:\n   - Verify no PM regression test failures\n   - If PM test fails: PRIORITY FIX before feature tests\n```\n\n### When NOT to Use Ralph Loop\n\n- Simple single-function implementations\n- Clear, non-iterative changes\n- When human guidance needed mid-implementation\n\n## Phase 0: Load PM Context (MANDATORY)\n\n**Goal:** Internalize all relevant warnings before writing any code.\n\n### Step 0.1: Read CLAUDE.md\n\n```bash\n# ALWAYS read first\ncat ./CLAUDE.md\n```\n\nExtract all directives and warnings relevant to the current task.\n\n### Step 0.2: Read Relevant Postmortems\n\nFrom the Linear ticket's PM Immune Screening section, identify related PMs:\n\n```bash\n# Read each PM mentioned in ticket\ncat ./postmortem/PM-XXX-*.md\n```\n\n### Step 0.3: Create PM Compliance Checklist\n\nGenerate a checklist to verify during implementation:\n\n```markdown\n## ğŸ“‹ PM Compliance Checklist for This Implementation\n\n### From CLAUDE.md (High-Frequency Rules)\n- [ ] [Directive 1]\n- [ ] [Directive 2]\n- [ ] [Warning to avoid]\n\n### From Postmortems (Specific to Ticket)\n- [ ] PM-001: [Specific mitigation]\n- [ ] PM-003: [Specific mitigation]\n\n### Code Patterns to AVOID (from PMs)\n```python\n# DON'T: [anti-pattern from PM]\n# DO: [correct pattern]\n```\n```\n\n**Output:** PM Compliance Checklist visible throughout implementation.\n\n## Phase 1: Environment Alignment\n\n**Goal:** Ensure new strategy aligns with existing backtest interfaces.\n\n### Step 1.1: Execute Implementation Plan\n\n```\nUse Skill tool: superpowers:executing-plans\nPurpose: Execute the implementation plan from Linear ticket\nContext: Strategy requirements, PM mitigations, test requirements\n```\n\n### Checklist\n\nUse GitHub MCP to inspect:\n\n```\n1. mcp__github__get_file_contents: backtest/ directory structure\n2. Identify interface contracts:\n   - Data input format (OHLCV? Tick? Custom?)\n   - Required method signatures (run(), evaluate(), etc.)\n   - Output format (trades[], metrics{})\n```\n\n### Interface Alignment Matrix\n\n| Interface | Check | Action if Mismatch |\n|-----------|-------|-------------------|\n| **Data Format** | Input schema matches historical data | Adapt strategy to use existing format |\n| **Method Signature** | Strategy implements required methods | Add missing methods |\n| **Output Format** | Results compatible with metrics pipeline | Convert output format |\n| **Dependencies** | No version conflicts | Pin versions in requirements |\n\n**Output:** Interface alignment report or list of adaptations needed.\n\n## Phase 2: PM Regression Tests First (CRITICAL)\n\n**Goal:** Write tests that specifically prevent PM-documented failures from recurring.\n\n### PM Regression Test Template\n\n```python\n# tests/pm_regression/test_pm_XXX.py\n\nclass TestPM001Regression:\n    \"\"\"Regression tests for PM-001: Order Duplication\n\n    Root Cause: Missing idempotency key\n    Mitigation: All orders must include client_order_id\n    \"\"\"\n\n    def test_order_has_idempotency_key(self):\n        \"\"\"Every order placement must include client_order_id\"\"\"\n        order = strategy.create_order(...)\n        assert order.client_order_id is not None\n        assert len(order.client_order_id) >= 16\n\n    def test_duplicate_order_rejected(self):\n        \"\"\"Attempting duplicate order raises DuplicateOrderError\"\"\"\n        order_id = \"test-order-123\"\n        strategy.place_order(client_order_id=order_id)\n        with pytest.raises(DuplicateOrderError):\n            strategy.place_order(client_order_id=order_id)\n\n\nclass TestPM003Regression:\n    \"\"\"Regression tests for PM-003: Liquidity Trap\n\n    Root Cause: No exit strategy for illiquid markets\n    Mitigation: Check liquidity before entry, implement timeout exit\n    \"\"\"\n\n    def test_liquidity_check_before_entry(self):\n        \"\"\"Strategy refuses entry when liquidity below threshold\"\"\"\n        illiquid_market = MockMarket(depth=100)  # Below threshold\n        signal = strategy.evaluate(illiquid_market)\n        assert signal.action == \"NO_ENTRY\"\n        assert \"insufficient_liquidity\" in signal.reason\n\n    def test_timeout_exit_triggered(self):\n        \"\"\"Position exits after max_hold_time if no liquidity\"\"\"\n        # ... test implementation\n```\n\n### Required PM Test Categories\n\n| PM Category | Test Coverage |\n|-------------|--------------|\n| **API Issues** | Rate limit handling, timeout recovery, retry logic |\n| **Order Issues** | Idempotency, duplication, rejection handling |\n| **Market Issues** | Liquidity checks, spread validation, halt detection |\n| **Data Issues** | Missing data handling, stale data detection |\n\n**BLOCKING:** All PM regression tests must PASS before proceeding to feature tests.\n\n## Phase 3: Feature Tests (TDD Red Phase)\n\n**Goal:** Define expected feature behavior before implementation.\n\n### Test File Location\n\n```\ntests/backtest_unit.py  # Primary location\ntests/strategies/       # Strategy-specific tests (if exists)\ntests/pm_regression/    # PM regression tests (NEW)\n```\n\n### Test Template\n\n```python\n# tests/backtest_unit.py\n\nclass Test[StrategyName]:\n    \"\"\"Tests for [Strategy Name] - Ticket: [LINEAR-XXX]\"\"\"\n\n    def test_entry_signal(self):\n        \"\"\"Strategy generates entry signal under expected conditions\"\"\"\n        # Arrange: Set up market state\n        # Act: Call strategy logic\n        # Assert: Verify signal generated\n        pass\n\n    def test_exit_signal(self):\n        \"\"\"Strategy generates exit signal for position management\"\"\"\n        pass\n\n    def test_position_limits(self):\n        \"\"\"Strategy respects position limits from risk parameters\"\"\"\n        pass\n\n    def test_edge_case_no_data(self):\n        \"\"\"Strategy handles missing data gracefully\"\"\"\n        pass\n```\n\n### Test Categories Required\n\n| Category | Coverage | Priority |\n|----------|----------|----------|\n| **PM Regression** | All PM mitigations from ticket | P0 (BLOCKING) |\n| **Entry Logic** | Signal generation, threshold triggers | P0 |\n| **Exit Logic** | Stop loss, take profit, time-based | P0 |\n| **Risk Limits** | Position caps, exposure limits | P0 |\n| **Edge Cases** | Missing data, API errors, market halts | P1 |\n| **Performance** | Execution time, memory usage | P2 |\n\n**Action:** Write failing tests BEFORE any implementation code.\n\n## Phase 4: Atomic Implementation\n\n**Goal:** Keep strategy logic minimal, PM-compliant, and focused.\n\n### Pre-Implementation PM Check\n\nBefore writing ANY code, verify against PM Compliance Checklist:\n\n```\nFor each function/method:\n1. Does this touch any PM-flagged area?\n   - If YES: Reference the PM mitigation pattern\n   - If NO: Proceed with standard implementation\n2. Am I violating any CLAUDE.md directive?\n3. Am I introducing a pattern documented as \"DON'T\" in a PM?\n```\n\n### Step 4.1: Frontend Design (if frontend-related)\n\nIf the implementation involves frontend components, UI, or web interfaces:\n\n```\nUse Skill tool: frontend-design:frontend-design\nPurpose: Create high-quality frontend interfaces\nFocus: Modern UI/UX, component design, user experience\n```\n\n### Step 4.2: Invoke code-simplifier Skill\n\n```\nUse Skill tool: code-simplifier:code-simplifier\nPurpose: Review implementation for simplicity before commit\n```\n\n### Atomic Implementation Rules\n\n| Rule | Guideline | Anti-pattern |\n|------|-----------|--------------|\n| **Single File < 200 LOC** | Split into modules if exceeding | 500+ line strategy file |\n| **One Responsibility** | Each function does one thing | `calculate_and_place_and_log()` |\n| **No Premature Optimization** | Simple first, optimize with profiler | Custom data structures without need |\n| **Explicit Dependencies** | Import at top, no dynamic imports | `__import__()` or lazy loading |\n| **PM Pattern Compliance** | Use patterns from PMs, not anti-patterns | Repeating documented mistakes |\n\n### File Structure\n\n```\nstrategies/\nâ”œâ”€â”€ base.py           # Abstract base class\nâ”œâ”€â”€ [strategy_name]/\nâ”‚   â”œâ”€â”€ __init__.py\nâ”‚   â”œâ”€â”€ signals.py    # Signal generation (< 100 LOC)\nâ”‚   â”œâ”€â”€ execution.py  # Order management (< 100 LOC)\nâ”‚   â””â”€â”€ risk.py       # Risk checks (< 50 LOC)\n```\n\n**Output:** Implementation that passes tests from Phase 2 AND Phase 3.\n\n## Phase 5: Synchronized Test Update\n\n**Goal:** Maintain 1:1 correspondence between code and tests.\n\n### Sync Protocol\n\nFor EVERY code change:\n\n```\nCode Change                    â†’ Required Test Update\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nNew function added             â†’ New test case added\nFunction signature changed     â†’ Update test calls\nThreshold/parameter changed    â†’ Update test assertions\nLogic branch added             â†’ Add test for branch\nPM mitigation added            â†’ Add PM regression test\n```\n\n### Verification Command\n\n```bash\n# Run ALL tests including PM regression\npytest tests/ -v --tb=short\n\n# PM regression tests specifically (must all pass)\npytest tests/pm_regression/ -v\n\n# Coverage check (should increase or stay same, never decrease)\npytest --cov=strategies --cov-report=term-missing\n```\n\n### Step 5.2: Systematic Debugging (if tests fail)\n\nIf any tests fail:\n\n```\nUse Skill tool: superpowers:systematic-debugging\nPurpose: Systematic approach to debugging test failures\nFocus: Identify root cause, fix while maintaining PM compliance\n```\n\n**Output:** All tests passing, coverage maintained.\n\n## Phase 6: Impact + PM Compliance Analysis\n\n**Goal:** Verify changes don't break existing strategies AND don't violate PM mitigations.\n\n### Step 6.1: Gather Context for Impact Analysis\n\n```\nUse Skill tool: context7:context7\nPurpose: Gather comprehensive context about code changes and their impact\nFocus: Related code patterns, dependencies, existing strategies, PM mitigations\n```\n\n### Step 6.2: PM Compliance Final Check\n\n```markdown\n## PM Compliance Verification\n\n### CLAUDE.md Directives\n| Directive | Compliant? | Evidence |\n|-----------|------------|----------|\n| [Directive 1] | âœ… | Line XX in file.py |\n| [Directive 2] | âœ… | Test case test_xxx |\n\n### Postmortem Mitigations\n| PM | Mitigation | Implemented? | Test Coverage |\n|----|------------|--------------|---------------|\n| PM-001 | Idempotency key | âœ… | test_pm_001.py |\n| PM-003 | Liquidity check | âœ… | test_pm_003.py |\n\n### Anti-Patterns Avoided\n- [x] No hardcoded API keys (PM-002)\n- [x] No unbounded retries (PM-004)\n```\n\n### Cross-Strategy Impact Matrix\n\n```\nUse Grep to search for:\n1. Shared base class usage\n2. Common utility function calls\n3. Config key references\n4. Event/signal handlers\n```\n\n**Output:** Impact report + PM Compliance Verification.\n\n## Phase 7: Finalize Development Branch\n\n**Goal:** Commit changes and prepare branch for review.\n\n### Step 7.1: Commit Changes\n\n```\nUse Skill tool: commit-commands:commit\nPurpose: Create standardized commit message for strategy implementation\nMessage should reference: Linear ticket, PM mitigations implemented\n```\n\n### Step 7.2: Finish Development Branch\n\n```\nUse Skill tool: superpowers:finishing-a-development-branch\nPurpose: Integrate work, ensure branch is ready for review\nVerify:\n- All tests passing\n- PM compliance verified\n- Code follows conventions\n- Ready for blueprint-review\n```\n\n**Output:** Branch committed and ready for review.\n\n## Quick Reference\n\n| Phase | Tool/Skill | Key Action |\n|-------|-----------|------------|\n| 0. PM Load | `Read` | Load CLAUDE.md + relevant postmortems |\n| 1. Execute | `superpowers:executing-plans` | Execute implementation plan |\n| 1. Align | `mcp__github__get_file_contents` | Check backtest/ interfaces |\n| 2. PM Test | Manual | Write PM regression tests FIRST |\n| 3. Test | `superpowers:test-driven-development` | Write feature tests |\n| 4. Frontend | `frontend-design:frontend-design` | If frontend-related (optional) |\n| 4. Implement | `code-simplifier:code-simplifier` | PM-compliant, atomic, < 200 LOC |\n| 5. Sync | `pytest` via Bash | Run ALL tests after each change |\n| 5b. Debug | `superpowers:systematic-debugging` | If tests fail |\n| 6. Impact | `context7:context7` + `Grep` | Gather context + Impact + PM compliance check |\n| 7. Finish | `commit-commands:commit` + `superpowers:finishing-a-development-branch` | Commit and prepare for review |\n| ğŸ”„ Ralph | `ralph-loop:ralph-loop` | Iterative test-fix cycle (optional) |\n\n## Common Mistakes\n\n| Mistake | Prevention |\n|---------|------------|\n| **Skipping PM context load** | Phase 0 is MANDATORY before any code |\n| **No PM regression tests** | Write PM tests before feature tests |\n| Implementing before tests | Always write test first, run to see it fail |\n| Large monolithic files | Split at 200 LOC, use module structure |\n| Changing shared code without impact check | Run Phase 6 before any shared code change |\n| **Repeating PM anti-patterns** | Reference PM \"DON'T\" patterns before coding |\n| Test-code desync | Use checklist: code change â†’ test change |\n\n## Exit Criteria\n\nBefore marking Linear ticket as \"Done\":\n\n- [ ] **PM Compliance Checklist: All items verified**\n- [ ] **PM regression tests: All passing**\n- [ ] All feature tests in `tests/backtest_unit.py` pass\n- [ ] Test coverage â‰¥ 80% for new code\n- [ ] No files exceed 200 LOC\n- [ ] Impact analysis completed\n- [ ] No regression in existing strategy tests\n\n## Example Invocation\n\n### Standard Mode\n```\nUser: \"Implement the mean-reversion strategy from ticket LIN-123\"\n\nClaude:\n0. [PM Load] Reading CLAUDE.md... 5 relevant directives found\n   Reading PM-003 (liquidity trap)... Mitigation: exit_timeout required\n   PM Compliance Checklist created with 7 items\n\n1. [Align] Checking backtest/ interfaces... Data format: OHLCV, 1-min candles\n\n2. [PM Test] Writing PM regression tests...\n   - test_liquidity_check_before_entry âŒ (not implemented yet)\n   - test_exit_timeout_triggers âŒ (not implemented yet)\n\n3. [Test] Writing feature tests...\n   - test_entry_signal âŒ\n   - test_exit_signal âŒ\n\n4. [Implement] Creating strategies/mean_reversion/...\n   - PM-compliant: liquidity check added to signals.py:45\n   - PM-compliant: exit_timeout in execution.py:78\n\n5. [Sync] All tests passing:\n   - PM regression: 4/4 âœ…\n   - Feature tests: 12/12 âœ…\n   - Coverage: 87%\n\n6. [Impact] No impact on existing strategies\n   PM Compliance: All 7 checklist items verified âœ…\n\nOutput: PR ready for review, PM compliant\n```\n\n### ğŸ”„ Ralph Loop Mode (Iterative)\n```\nUser: \"è¿­ä»£å¼€å‘ order execution moduleï¼Œç”¨ ralph loop\"\n\nClaude:\n0-3. [Standard Phases Complete]\n   PM Compliance Checklist: 5 items\n   Tests written: 8 failing\n\nğŸ”„ [Ralph Loop Activated]\n   Invoking: /ralph-loop \"Implement order execution for mean-reversion.\n   PM Checklist: [5 items]\n   Failing tests: 8\n   Output <promise>ALL TESTS PASSING</promise> when done.\"\n   --max-iterations 10\n   --completion-promise \"ALL TESTS PASSING\"\n\n   Iteration 1: 8/8 tests failing â†’ Fixed signal generation\n   Iteration 2: 5/8 tests failing â†’ Fixed order placement\n   Iteration 3: 3/8 tests failing â†’ Fixed PM-001 idempotency\n   Iteration 4: 1/8 tests failing â†’ Fixed edge case\n   Iteration 5: 0/8 tests failing\n\n   <promise>ALL TESTS PASSING</promise>\n\nğŸ”„ [Ralph Loop Complete]\n   Iterations: 5/10\n   Tests: 8/8 âœ…\n   PM Compliance: Maintained throughout âœ…\n\n6. [Impact] Proceeding with impact analysis...\n\nOutput: Complex implementation completed via iterative refinement\n```\n",
        "skills/blueprint-optimize/SKILL.md": "---\nname: blueprint-optimize\ndescription: Use after PR merge to complete iteration cycle. Supports Ralph Loop for iterative PM refinement. Syncs Linear status, commits with standards, creates Postmortems for significant incidents, and crystallizes high-frequency rules into CLAUDE.md.\n---\n\n# Blueprint Optimize - Dual-Layer Memory Crystallization\n\n## Overview\n\nComplete the iteration cycle by syncing status, committing properly, and permanently capturing hard-won lessons in the **dual-layer memory system**:\n\n- `./postmortem/` = Deep case history (detailed analysis)\n- `./CLAUDE.md` = High-frequency operating rules (concise directives)\n\n## Core Principle\n\n```\n./postmortem/ = æ·±åº¦ç—…å†åº“ (Deep Case History)\n                â†’ å®Œæ•´çš„äº‹æ•…åˆ†æã€root causeã€æ—¶é—´çº¿ã€è¯¦ç»†ä¿®å¤\n                â†’ æ— è¡Œæ•°é™åˆ¶ï¼Œè¶Šè¯¦ç»†è¶Šå¥½\n\n./CLAUDE.md   = é«˜é¢‘æ‰‹æœ¯å‡†åˆ™ (High-Frequency Operating Rules)\n                â†’ åªæœ‰æŒ‡ä»¤å’Œè­¦å‘Šï¼Œæ— è§£é‡Š\n                â†’ ä¸¥æ ¼ â‰¤ 100 è¡Œ\n\nRule: å…ˆå†™ç—…å† (postmortem)ï¼Œå†æç‚¼å‡†åˆ™ (CLAUDE.md)\n```\n\n## When to Use\n\n- PR has been merged (after `blueprint-review`)\n- Ready to close out the iteration\n- User mentions \"ä¸Šçº¿\", \"merge complete\", \"close ticket\", or \"è®°å½•ç»éªŒ\"\n- **After any incident, bug, or significant learning**\n\n**Do NOT use when:**\n- PR still under review (use `blueprint-review`)\n- Still implementing (use `blueprint-develop`)\n\n## Prerequisites\n\nBefore invoking this skill, verify:\n- [ ] PR merged to main branch\n- [ ] All tests passing on main\n- [ ] Linear ticket exists and is linked to PR\n\n## Workflow\n\n```dot\ndigraph blueprint_optimize {\n    rankdir=TB;\n    node [shape=box];\n\n    start [label=\"Start: PR Merged\" shape=ellipse];\n    sync [label=\"1. Status Sync\\n(Linear MCP)\"];\n    commit [label=\"2. Final Commit\\n(commit-commands)\"];\n    pm_decision [label=\"3. PM Decision\\n(Need New Postmortem?)\" shape=diamond style=filled fillcolor=lightyellow];\n    pm_write [label=\"3a. Write Postmortem\\n(./postmortem/)\" style=filled fillcolor=lightyellow];\n    claude_preview [label=\"4. CLAUDE.md Preview\\n(Extract from PM)\" style=filled fillcolor=lightyellow];\n    confirm [label=\"5. Human Confirms\" shape=diamond];\n    claude_write [label=\"6. Write to CLAUDE.md\"];\n    done [label=\"Iteration Complete\" shape=ellipse];\n\n    start -> sync;\n    sync -> commit;\n    commit -> pm_decision;\n    pm_decision -> pm_write [label=\"Yes: Incident/Bug Found\"];\n    pm_decision -> claude_preview [label=\"No: Minor Learnings Only\"];\n    pm_write -> claude_preview;\n    claude_preview -> confirm;\n    confirm -> claude_write [label=\"Approved\"];\n    confirm -> claude_preview [label=\"Revise\"];\n    claude_write -> done;\n}\n```\n\n## Phase 1: Status Sync\n\n**Goal:** Mark Linear ticket as Done and ensure all links are in place.\n\n### Step 1.0: Gather Context (if needed)\n\nWhen syncing status or analyzing merged changes:\n\n```\nUse Skill tool: context7:context7\nPurpose: Gather context about merged PR, related tickets, and impact\nFocus: PR changes, related code, dependencies, PM context\n```\n\n### Update Linear Ticket\n\n```\nTool: mcp__plugin_linear_linear__update_issue\n\nParameters:\n- id: [ticket_id]\n- state: \"Done\"\n```\n\n### Verification Checklist\n\n| Item | Action |\n|------|--------|\n| Ticket state â†’ Done | `update_issue` with state |\n| PR link attached | Verify via `get_issue` |\n| Sub-tickets closed | Update each child ticket |\n| Labels updated | Add \"shipped\" or equivalent |\n\n### Comment Summary\n\nAdd closing comment to ticket:\n\n```\nTool: mcp__plugin_linear_linear__create_comment\n\nBody:\nâœ… Strategy shipped to main\n- PR: [PR link]\n- Backtest Sharpe: X.XX\n- PM: [PM-XXX if created, or \"None\"]\n- CLAUDE.md: [Updated/No change]\n```\n\n**Output:** Linear ticket marked Done with closing comment.\n\n## Phase 2: Final Commit (if needed)\n\n**Goal:** Ensure any final changes follow commit conventions.\n\n### Invoke commit-commands Skill\n\n```\nUse Skill tool: commit-commands:commit\nPurpose: Generate standardized commit message\n```\n\n### Commit Message Format\n\n```\n<type>(<scope>): <subject>\n\n<body>\n\n<footer>\n\nCo-Authored-By: Claude Code <noreply@anthropic.com>\n```\n\n**Output:** Clean commit following project conventions.\n\n## Phase 3: Postmortem Decision & Creation\n\n**Goal:** Determine if a new postmortem is needed, and create if yes.\n\n### Decision Matrix\n\n| Condition | Create PM? | PM Severity |\n|-----------|-----------|-------------|\n| Bug caused incorrect trades | YES | CRITICAL |\n| API issue discovered | YES | HIGH |\n| Performance degradation found | YES | MEDIUM |\n| Edge case hit in backtest | YES | MEDIUM |\n| Code worked but pattern was suboptimal | NO | - |\n| Simple refactor, no issues | NO | - |\n\n### Postmortem Template\n\nCreate file: `./postmortem/PM-[NNN]-[brief-description].md`\n\n```markdown\n# PM-[NNN]: [Incident Title]\n\n## Metadata\n- **Date:** [YYYY-MM-DD]\n- **Severity:** CRITICAL | HIGH | MEDIUM | LOW\n- **Strategy:** [Strategy Name]\n- **Linear Ticket:** [LIN-XXX]\n- **Author:** [Name/Claude Code]\n\n## Summary\n[One paragraph describing what happened]\n\n## Timeline\n- [HH:MM] [Event 1]\n- [HH:MM] [Event 2]\n- [HH:MM] [Detection/Discovery]\n- [HH:MM] [Resolution]\n\n## Root Cause Analysis\n\n### What Happened\n[Detailed technical explanation]\n\n### Why It Happened\n[5 Whys analysis or similar]\n\n### Contributing Factors\n- [Factor 1]\n- [Factor 2]\n\n## Impact\n- **Financial:** [Estimated loss/gain, if any]\n- **Operational:** [Service disruption, if any]\n- **Data:** [Data corruption/loss, if any]\n\n## Resolution\n[What was done to fix the immediate issue]\n\n## Mitigations Implemented\n\n### Code Changes\n```python\n# BEFORE (anti-pattern)\n[code snippet]\n\n# AFTER (correct pattern)\n[code snippet]\n```\n\n### Tests Added\n- `tests/pm_regression/test_pm_[NNN].py`\n\n### Configuration Changes\n- [Config change 1]\n\n## Lessons Learned\n\n### What Went Well\n- [Item 1]\n\n### What Went Wrong\n- [Item 1]\n\n### Action Items\n- [ ] [Action 1] - Owner: [Name]\n- [ ] [Action 2] - Owner: [Name]\n\n## Keywords\n`[keyword1]` `[keyword2]` `[keyword3]`\n\n## Related\n- Previous: PM-[XXX] (if related)\n- See also: [Link to docs/code]\n```\n\n### PM Naming Convention\n\n```\nPM-001-order-duplication.md\nPM-002-api-timeout-cascade.md\nPM-003-liquidity-trap-election.md\n```\n\n**Output:** Postmortem file created (or decision to skip documented).\n\n### ğŸ”„ Ralph Loop: Iterative PM Refinement (Optional)\n\n**When to Activate:** Complex incidents requiring thorough root cause analysis.\n\nFor significant incidents, use Ralph Loop to iteratively refine the postmortem quality:\n\n```\nSkill: ralph-loop:ralph-loop\n\nPrompt Template:\n\"Refine Postmortem PM-[NNN] for quality.\nIncident: [brief description]\n\nQuality Checklist:\n- [ ] Root cause identified (not just symptoms)\n- [ ] 5 Whys analysis complete\n- [ ] Code snippets include before/after\n- [ ] Action items are specific and assigned\n- [ ] Keywords comprehensive for future search\n\nCurrent gaps: [list]\nOutput <promise>PM REFINED</promise> when all checklist items complete.\"\n\nOptions:\n--max-iterations 5\n--completion-promise \"PM REFINED\"\n```\n\n### Ralph Loop PM Refinement Cycle\n\n```dot\ndigraph ralph_pm {\n    rankdir=LR;\n    node [shape=box];\n\n    start [label=\"Draft PM\\nCreated\" shape=ellipse];\n    check [label=\"Quality Check\"];\n    gaps [label=\"Gaps Found?\" shape=diamond];\n    refine [label=\"Refine Section\"];\n    done [label=\"<promise>\\nPM REFINED\" shape=ellipse style=filled fillcolor=lightgreen];\n\n    start -> check;\n    check -> gaps;\n    gaps -> refine [label=\"Yes\"];\n    refine -> check;\n    gaps -> done [label=\"No\"];\n}\n```\n\n### PM Quality Checklist for Ralph Loop\n\n| Section | Quality Criteria |\n|---------|------------------|\n| **Root Cause** | Specific, technical, not \"human error\" |\n| **5 Whys** | Chain leads to systemic fix, not blame |\n| **Code Snippets** | Actual code, not pseudocode |\n| **Timeline** | Timestamped, includes detection method |\n| **Action Items** | SMART: Specific, Measurable, Assigned |\n| **Keywords** | â‰¥5 relevant search terms |\n\n### When to Use Ralph Loop for PM\n\n| Situation | Use Ralph Loop? |\n|-----------|----------------|\n| CRITICAL severity incident | âœ… Yes - thorough analysis needed |\n| First incident of its type | âœ… Yes - establish good template |\n| Similar to existing PM | âŒ No - reference existing, add delta |\n| Simple config error | âŒ No - straightforward PM sufficient |\n\n## Phase 4: CLAUDE.md Preview Generation\n\n**Goal:** Extract high-frequency rules from postmortem (or learnings) for CLAUDE.md.\n\n### Extraction Rules\n\n| From Postmortem | To CLAUDE.md |\n|-----------------|--------------|\n| Root Cause | âš ï¸ WARNING (one line) |\n| Code Fix Pattern | ğŸ“‹ DIRECTIVE (one line) |\n| Parameter Value | ğŸ”¢ PARAMETER (one line) |\n| Timeline Detail | âŒ OMIT |\n| 5 Whys Analysis | âŒ OMIT |\n| Impact Assessment | âŒ OMIT |\n\n### CRITICAL: Human Review Required\n\n**DO NOT write directly to CLAUDE.md. Generate preview first.**\n\n### Preview Template\n\n```markdown\n---\n## ğŸ“ Proposed Addition to CLAUDE.md\n\n### Source: PM-[NNN] - [Title] ([Date])\n\n#### âš ï¸ WARNINGS\n- [Extracted from Root Cause - ONE LINE, specific values]\n\n#### ğŸ“‹ DIRECTIVES\n- [Extracted from Resolution - ONE LINE, actionable]\n\n#### ğŸ”¢ PARAMETERS\n- [Parameter]: [Value] ([brief reason])\n\n---\n\n**Estimated CLAUDE.md impact:** +X lines (current: Y, after: Z)\n**Total after update:** Z/100 lines\n\nâš¡ Please review the above. Reply \"ç¡®è®¤\" to write, or provide edits.\n```\n\n### Quality Checklist for Preview\n\n| Check | Example Pass | Example Fail |\n|-------|--------------|--------------|\n| Specific values | \"429 after 50 req/min\" | \"API has rate limits\" |\n| Actionable | \"Use decimal.Decimal\" | \"Be careful with floats\" |\n| One line max | \"Check market.active before orders\" | [Multi-line explanation] |\n| No prose | Just the rule | \"Because we found that...\" |\n\n**Output:** Markdown preview displayed to user, awaiting confirmation.\n\n## Phase 5: Human Confirmation\n\n**Goal:** Ensure human approves before modifying project memory.\n\n### Wait for User Response\n\n| Response | Action |\n|----------|--------|\n| \"ç¡®è®¤\" / \"confirm\" / \"yes\" | Proceed to Phase 6 |\n| Edits provided | Regenerate preview with changes |\n| \"å–æ¶ˆ\" / \"cancel\" | Skip CLAUDE.md update |\n\n### Revision Handling\n\nIf user provides edits:\n1. Incorporate feedback\n2. Regenerate preview\n3. Show updated preview\n4. Wait for confirmation again\n\n**Output:** User confirmation received.\n\n## Phase 6: Write to CLAUDE.md\n\n**Goal:** Append high-frequency rules to project memory file.\n\n### Pre-Write Line Count Check\n\n```bash\nwc -l CLAUDE.md\n# MUST check before writing\n```\n\n### 100 Line Limit Enforcement\n\nIf exceeding 100 lines after addition:\n\n```markdown\nâš ï¸ CLAUDE.md will exceed 100 lines after this addition.\n\nCurrent: 92 lines\nAdding: 15 lines\nTotal: 107 lines (7 over limit)\n\n### Pruning Candidates (Oldest First)\n\n1. **Lines 5-12:** Mean-Reversion v1 (2023-06-01) - 8 lines\n   - Superseded by PM-015? [Y/N]\n\n2. **Lines 13-20:** Early API Learnings (2023-07-15) - 8 lines\n   - Still relevant? [Y/N]\n\n### Options:\n1. Prune selected entries\n2. Condense new content further\n3. Move old entries to postmortem archive\n4. Proceed anyway (NOT RECOMMENDED)\n\nWhich entries should be pruned?\n```\n\n### Write Rules\n\n| Rule | Implementation |\n|------|---------------|\n| **Append only** | Add at end, never delete without approval |\n| **100 line HARD limit** | Must prune if exceeding |\n| **Preserve structure** | Match existing formatting |\n| **Date stamp** | Always include date for each entry |\n| **PM Reference** | Always link to source postmortem |\n\n### Write Action\n\n```\nTool: Edit or Write (append mode)\nFile: CLAUDE.md\nContent: [Approved preview content]\n```\n\n### Post-Write Verification\n\n```bash\n# Verify line count\nwc -l CLAUDE.md\n# MUST be â‰¤ 100\n```\n\n**Output:** CLAUDE.md updated, line count confirmed.\n\n## Quick Reference\n\n| Phase | Tool/Skill | Key Action |\n|-------|-----------|------------|\n| 1. Context | `context7:context7` (if needed) | Gather context about merged PR |\n| 1. Sync | `mcp__plugin_linear_linear__update_issue` | Mark ticket Done |\n| 2. Commit | `commit-commands:commit` | Standardized commit |\n| 3. PM | `Write` to `./postmortem/` | Create if incident found |\n| 3b. ğŸ”„ Ralph | `ralph-loop:ralph-loop` | Iterative PM refinement (optional) |\n| 4. Preview | Manual generation | Extract rules from PM |\n| 5. Confirm | `AskUserQuestion` or wait | Human approval required |\n| 6. Write | `Edit` to `CLAUDE.md` | Append, enforce 100 line limit |\n\n## Dual-Layer Memory Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    INCIDENT OCCURS                           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                            â”‚\n                            â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  ./postmortem/PM-XXX.md (æ·±åº¦ç—…å†åº“)                          â”‚\nâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚\nâ”‚  â€¢ Full timeline                                            â”‚\nâ”‚  â€¢ Root cause analysis (5 Whys)                             â”‚\nâ”‚  â€¢ Code snippets (before/after)                             â”‚\nâ”‚  â€¢ Impact assessment                                        â”‚\nâ”‚  â€¢ Action items                                             â”‚\nâ”‚  â€¢ NO LINE LIMIT - be thorough                              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                            â”‚\n                            â”‚ EXTRACT\n                            â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  ./CLAUDE.md (é«˜é¢‘æ‰‹æœ¯å‡†åˆ™)                                   â”‚\nâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚\nâ”‚  â€¢ âš ï¸ WARNING: [one line]                                   â”‚\nâ”‚  â€¢ ğŸ“‹ DIRECTIVE: [one line]                                 â”‚\nâ”‚  â€¢ ğŸ”¢ PARAMETER: [value]                                    â”‚\nâ”‚  â€¢ STRICT 100 LINE LIMIT                                    â”‚\nâ”‚  â€¢ Reference: PM-XXX                                        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Common Mistakes\n\n| Mistake | Prevention |\n|---------|------------|\n| **Skipping postmortem for incidents** | If there was a bug/issue, PM is MANDATORY |\n| **Verbose CLAUDE.md entries** | Extract only: warning, directive, parameter |\n| **Exceeding 100 lines** | Prune old entries, ask user to choose |\n| **No PM reference in CLAUDE.md** | Always link source: \"See: PM-XXX\" |\n| Writing CLAUDE.md without preview | ALWAYS generate preview, wait for \"ç¡®è®¤\" |\n| Missing specifics | \"API is slow\" âŒ â†’ \"API 429s after 50 req/min\" âœ… |\n| Forgetting Linear sync | First action is always status update |\n\n## Exit Criteria\n\nBefore marking iteration complete:\n\n- [ ] Linear ticket state = Done\n- [ ] Closing comment added with summary\n- [ ] Final commit follows conventions\n- [ ] **Postmortem created (if incident occurred)**\n- [ ] Lesson preview shown to user\n- [ ] User explicitly confirmed (\"ç¡®è®¤\")\n- [ ] CLAUDE.md updated with PM reference\n- [ ] **Line count â‰¤ 100 verified**\n\n## Example Invocation\n\n### Standard Mode\n```\nUser: \"PR merged, close out the mean-reversion iteration. We hit a rate limit bug during testing.\"\n\nClaude:\n1. [Sync] Updating Linear ticket LIN-123 â†’ Done âœ…\n   Added closing comment\n\n2. [Commit] No pending changes, main branch clean âœ…\n\n3. [PM Decision] Rate limit bug found â†’ Creating postmortem\n\n   Creating: ./postmortem/PM-007-rate-limit-429.md\n   - Severity: HIGH\n   - Root Cause: No delay between API calls\n   - Resolution: Added 1.2s minimum delay\n   - Tests Added: tests/pm_regression/test_pm_007.py âœ…\n\n4. [Preview] Extracting rules from PM-007...\n\n---\n## ğŸ“ Proposed Addition to CLAUDE.md\n\n### Source: PM-007 - Rate Limit 429 (2024-01-15)\n\n#### âš ï¸ WARNINGS\n- Polymarket API returns 429 after 50 req/min without warning header\n\n#### ğŸ“‹ DIRECTIVES\n- Implement minimum 1.2s delay between all API calls\n- Parse X-RateLimit-Remaining header when available\n\n#### ğŸ”¢ PARAMETERS\n- API_MIN_DELAY: 1.2s (discovered empirically, see PM-007)\n\n---\n\n**Estimated CLAUDE.md impact:** +8 lines (current: 52, after: 60)\n**Total after update:** 60/100 lines âœ…\n\nâš¡ Please review the above. Reply \"ç¡®è®¤\" to write, or provide edits.\n\nUser: \"ç¡®è®¤\"\n\nClaude:\n5. [Write] Appending to CLAUDE.md... âœ…\n   Line count verified: 60/100 âœ…\n\nIteration complete:\n- Linear: LIN-123 Done\n- Postmortem: PM-007-rate-limit-429.md created\n- CLAUDE.md: +8 lines (total: 60/100)\n- Ready for next strategy\n```\n\n### ğŸ”„ Ralph Loop Mode (PM Refinement)\n```\nUser: \"PR merged. æœ‰ä¸ªä¸¥é‡çš„ order cascade äº‹æ•…éœ€è¦è¯¦ç»†åˆ†æ\"\n\nClaude:\n1-2. [Standard Phases Complete] âœ…\n\n3. [PM Decision] CRITICAL severity â†’ Creating postmortem\n   Creating: ./postmortem/PM-008-order-cascade-failure.md\n\n   Initial draft quality check:\n   - Root cause: âŒ Too vague (\"system overload\")\n   - 5 Whys: âŒ Incomplete (only 2 levels)\n   - Code snippets: âš ï¸ Missing before/after\n   - Action items: âŒ Not specific\n\n   CRITICAL incident â†’ Activating Ralph Loop for thorough analysis\n\nğŸ”„ [Ralph Loop: PM Refinement]\n   Invoking: /ralph-loop \"Refine PM-008 for quality.\n   Incident: Order cascade causing $X loss\n   Gaps: root cause vague, 5 whys incomplete, no code snippets\n   Output <promise>PM REFINED</promise> when all sections complete.\"\n   --max-iterations 5\n   --completion-promise \"PM REFINED\"\n\n   Iteration 1: Root cause refined â†’ \"Unbounded retry loop in error handler\"\n   Iteration 2: 5 Whys complete â†’ leads to \"missing circuit breaker\"\n   Iteration 3: Code snippets added with before/after\n   Iteration 4: Action items made SMART, owners assigned\n\n   <promise>PM REFINED</promise>\n\nğŸ”„ [Ralph Loop Complete]\n   PM Quality: All checklist items âœ…\n   - Root cause: Specific technical issue identified\n   - 5 Whys: Complete chain to systemic fix\n   - Code: Actual snippets with fix\n   - Actions: 4 SMART items with owners\n\n4-6. [Continuing to CLAUDE.md preview and write...]\n\nOutput: High-quality PM-008 created via iterative refinement\n```\n",
        "skills/blueprint-plan/SKILL.md": "---\nname: blueprint-plan\ndescription: Use when transforming a new trading strategy idea into actionable Linear tickets. Supports Ralph Loop for thorough context gathering. Triggers include strategy brainstorming, feature planning for Polymarket, or when user says \"plan a new strategy\". Includes mandatory Postmortem immune screening.\n---\n\n# Blueprint Plan - Strategy Architecture & Task Decomposition\n\n## Overview\n\nTransform vague strategy ideas into executable Linear Tickets with proper risk assessment, backtest specifications, and **Postmortem immune screening** to prevent regression.\n\n## Core Principle\n\n```\n./postmortem/ = æ·±åº¦ç—…å†åº“ (Deep Case History)\n./CLAUDE.md   = é«˜é¢‘æ‰‹æœ¯å‡†åˆ™ (High-Frequency Operating Rules)\n\nRule: æ–°ç­–ç•¥å¿…é¡»é€šè¿‡å†å²ç—…å†çš„\"å…ç–«ç­›æŸ¥\"\n```\n\n## When to Use\n\n- User wants to plan a **new trading strategy** for Polymarket\n- User mentions \"ç­–ç•¥è§„åˆ’\", \"strategy planning\", or \"feature decomposition\"\n- Before any implementation of market-making or trading logic\n\n**Do NOT use when:**\n- Debugging existing strategy code\n- Running backtests (use execution skills instead)\n- Simple code changes unrelated to strategy\n\n## Workflow\n\n```dot\ndigraph blueprint_plan {\n    rankdir=TB;\n    node [shape=box];\n\n    start [label=\"User: New Strategy Idea\" shape=ellipse];\n    pm_scan [label=\"0. Postmortem Immune Scan\\n(MANDATORY FIRST)\" style=filled fillcolor=lightyellow];\n    context [label=\"1. Context Retrieval\\n(GitHub MCP)\"];\n    review [label=\"2. Strategy Risk Review\\n(Superpowers Analysis)\"];\n    linear [label=\"3. Linear Ticket Creation\\n(Linear MCP)\"];\n    done [label=\"Tickets Ready\" shape=ellipse];\n\n    start -> pm_scan;\n    pm_scan -> context;\n    context -> review;\n    review -> linear;\n    linear -> done;\n}\n```\n\n## Phase 0: Postmortem Immune Scan (MANDATORY)\n\n**Goal:** Screen new strategy against historical failures to prevent regression.\n\n### Step 0.1: Scan Postmortem Directory\n\n```bash\n# List all postmortem files\nls -la ./postmortem/\n\n# Read each relevant postmortem\ncat ./postmortem/*.md\n```\n\n### Step 0.2: Keyword Matching\n\nSearch postmortems for terms related to the new strategy:\n\n| Strategy Type | Keywords to Scan |\n|---------------|------------------|\n| **Market Making** | spread, inventory, quote, bid, ask, fill |\n| **Mean Reversion** | revert, mean, deviation, zscore, band |\n| **Momentum** | trend, breakout, signal, momentum |\n| **Arbitrage** | arb, spread, cross-market, latency |\n| **Any Strategy** | API, rate limit, timeout, websocket, order |\n\n```\nTool: Grep\nPattern: [relevant keywords]\nPath: ./postmortem/\n```\n\n### Step 0.3: Immune Report Generation\n\nFor each relevant postmortem found, extract:\n\n```markdown\n## ğŸ›¡ï¸ Immune Screening Report\n\n### Relevant Historical Incidents\n\n| PM File | Incident | Root Cause | Relevance to New Strategy |\n|---------|----------|------------|---------------------------|\n| PM-001.md | Order duplication | Missing idempotency | HIGH - uses same order API |\n| PM-003.md | Liquidity trap | No exit strategy | MEDIUM - similar market type |\n\n### Mandatory Mitigations (from Postmortems)\n\n- [ ] [Mitigation 1 from PM-001]\n- [ ] [Mitigation 2 from PM-003]\n\n### Cleared (No Relevant History)\n\n- [List of scanned categories with no matches]\n```\n\n**BLOCKING:** If HIGH relevance incidents found, mitigations MUST be included in ticket acceptance criteria.\n\n**Output:** Immune Screening Report appended to ticket.\n\n### ğŸ”„ Ralph Loop: Thorough Context Gathering (Optional)\n\n**When to Activate:** Complex strategies requiring deep codebase understanding.\n\nFor strategies touching multiple existing systems, use Ralph Loop to iteratively build comprehensive context:\n\n```\nSkill: ralph-loop:ralph-loop\n\nPrompt Template:\n\"Gather comprehensive context for [strategy_name].\n\nTarget areas:\n- Existing strategies in strategies/\n- Backtest framework in backtest/\n- API integrations in api/\n- PM files in postmortem/\n\nBuild context map:\n- [ ] All relevant files identified\n- [ ] Interface contracts documented\n- [ ] PM risks catalogued\n- [ ] Dependencies mapped\n\nOutput <promise>CONTEXT COMPLETE</promise> when context map is comprehensive.\"\n\nOptions:\n--max-iterations 8\n--completion-promise \"CONTEXT COMPLETE\"\n```\n\n### Ralph Loop Context Gathering Cycle\n\n```dot\ndigraph ralph_context {\n    rankdir=LR;\n    node [shape=box];\n\n    start [label=\"Strategy Idea\" shape=ellipse];\n    explore [label=\"Explore Codebase\"];\n    gap [label=\"Gaps Found?\" shape=diamond];\n    deepen [label=\"Deepen Search\"];\n    done [label=\"<promise>\\nCONTEXT COMPLETE\" shape=ellipse style=filled fillcolor=lightgreen];\n\n    start -> explore;\n    explore -> gap;\n    gap -> deepen [label=\"Yes\"];\n    deepen -> explore;\n    gap -> done [label=\"No\"];\n}\n```\n\n### Context Completeness Checklist\n\n| Area | Questions to Answer |\n|------|---------------------|\n| **Strategies** | What patterns exist? What interfaces are required? |\n| **Backtest** | What data format? What metrics calculated? |\n| **API** | What rate limits? What auth method? |\n| **Postmortems** | What risks relate to this strategy type? |\n| **Dependencies** | What versions? What conflicts possible? |\n\n### When to Use Ralph Loop for Planning\n\n| Situation | Use Ralph Loop? |\n|-----------|----------------|\n| New strategy type (no similar exists) | âœ… Yes - need thorough exploration |\n| Many existing strategies to learn from | âœ… Yes - comprehensive pattern mining |\n| Simple variant of existing strategy | âŒ No - direct PM scan sufficient |\n| User provided detailed specs | âŒ No - context already clear |\n\n## Phase 1: Context Retrieval\n\n**Required:** Confirm project structure before proceeding.\n\n### Step 1.1: Write Implementation Plan\n\n```\nUse Skill tool: superpowers:writing-plans\nPurpose: Create structured implementation plan for the strategy\nInput: Strategy idea, PM mitigations from Phase 0, risk assessment\nOutput: Detailed plan with phases, acceptance criteria, dependencies\n```\n\n### Step 1.2: Gather Comprehensive Context\n\n```\nUse Skill tool: context7:context7\nPurpose: Gather comprehensive context about existing codebase\nFocus: Backtest framework, existing strategies, patterns, dependencies\n```\n\n### Step 1.3: Retrieve Codebase Context\n\nUse GitHub MCP to inspect:\n- `backtest/` directory: Existing backtest framework, data sources, metrics\n- `strategies/` directory: Current strategy implementations, common patterns\n\n```\nAction: Use mcp__github__get_file_contents to list directories\nIf directories don't exist: Note this as \"greenfield implementation\"\n```\n\n**Output:** Implementation plan + comprehensive context + summary of existing codebase or \"greenfield\" status.\n\n## Phase 2: Strategy Risk Review\n\nAnalyze the proposed strategy for Polymarket-specific risks.\n\n### Step 2.1: Invoke Code Review for Risk Analysis\n\nIf strategy design document or pseudo-code exists, use superpowers to analyze risks:\n\n```\nUse Skill tool: superpowers:requesting-code-review\nFocus areas:\n- Risk patterns in strategy logic\n- Error handling assumptions\n- Edge case coverage\n- PM anti-pattern detection in design\n```\n\n### Step 2.2: Manual Risk Matrix Analysis\n\nAnalyze the proposed strategy for Polymarket-specific risks:\n\n| Risk Category | Check Items |\n|---------------|-------------|\n| **Inventory Risk** | Position limits, hedging approach, exposure caps |\n| **Slippage** | Order book depth, spread compensation, market impact |\n| **Liquidity** | Market depth assumptions, exit strategy |\n| **Model Risk** | Probability estimation method, edge decay |\n| **PM-Flagged Risks** | All HIGH/MEDIUM items from Phase 0 |\n\n**Output:** Risk assessment summary with mitigation recommendations (combining superpowers analysis + manual review).\n\n## Phase 3: Linear Ticket Creation\n\n### Main Ticket Structure\n\nCreate a **Feature/Strategy** ticket with:\n\n```markdown\n## Strategy: [Strategy Name]\n\n### Description\n[Brief strategy overview]\n\n### ğŸ›¡ï¸ Postmortem Immune Screening\n[Summary from Phase 0 - REQUIRED SECTION]\n\n**Relevant Incidents:** [count]\n**Mandatory Mitigations:** [list]\n\n### Risk Assessment\n[Summary from Phase 2]\n\n### Backtest Baseline Metrics\n| Metric | Target | Minimum Acceptable |\n|--------|--------|-------------------|\n| Sharpe Ratio | â‰¥ 2.0 | â‰¥ 1.5 |\n| Max Drawdown (MDD) | â‰¤ 10% | â‰¤ 15% |\n| APR | â‰¥ 30% | â‰¥ 20% |\n\n### Acceptance Criteria\n- [ ] Strategy passes backtest with baseline metrics\n- [ ] Risk limits implemented\n- [ ] Paper trading validation complete\n- [ ] **PM mitigations verified:** [list each]\n```\n\n### Required Sub-tickets\n\nAuto-create two child tickets:\n\n1. **ç­–ç•¥å®ç° (Strategy Implementation)**\n   - Core trading logic\n   - Order placement/cancellation\n   - Position management\n   - **PM mitigation implementations**\n\n2. **å›æµ‹ç”¨ä¾‹ç¼–å†™ (Backtest Case Development)**\n   - Historical data integration\n   - Performance metrics calculation\n   - Edge case scenarios\n   - **PM regression test cases**\n\nUse `mcp__plugin_linear_linear__create_issue` with `parentId` for sub-tickets.\n\n## Quick Reference\n\n| Phase | Tool | Key Action |\n|-------|------|------------|\n| 0. PM Scan | `Grep` + `Read` | Scan `postmortem/` for relevant incidents |\n| 0b. ğŸ”„ Ralph | `ralph-loop:ralph-loop` | Thorough context gathering (optional) |\n| 1. Plan | `superpowers:writing-plans` | Create structured implementation plan |\n| 1. Context | `context7:context7` | Gather comprehensive codebase context |\n| 1. Context | `mcp__github__get_file_contents` | List `backtest/`, `strategies/` |\n| 2. Review | `superpowers:requesting-code-review` | Risk analysis + code review (if design doc exists) |\n| 3. Linear | `mcp__plugin_linear_linear__create_issue` | Create tickets with PM section |\n\n## Common Mistakes\n\n| Mistake | Fix |\n|---------|-----|\n| **Skipping PM scan** | Phase 0 is MANDATORY, not optional |\n| Ignoring HIGH relevance incidents | MUST include mitigations in acceptance criteria |\n| Skipping context check | Always verify codebase structure first |\n| Missing metrics baseline | Include Sharpe, MDD, APR targets in every ticket |\n| No sub-ticket linking | Use `parentId` to properly link sub-tasks |\n| Vague risk assessment | Be specific: \"10% position cap\" not \"manage inventory\" |\n\n## Postmortem File Format Reference\n\nExpected structure in `./postmortem/`:\n\n```\npostmortem/\nâ”œâ”€â”€ PM-001-order-duplication.md\nâ”œâ”€â”€ PM-002-api-timeout-cascade.md\nâ”œâ”€â”€ PM-003-liquidity-trap.md\nâ””â”€â”€ TEMPLATE.md\n```\n\nEach PM file should contain:\n- **Incident Date**\n- **Root Cause**\n- **Impact**\n- **Mitigations Implemented**\n- **Keywords** (for searchability)\n\n## Example Invocation\n\n### Standard Mode\n```\nUser: \"Plan a mean-reversion strategy for Polymarket presidential election markets\"\n\nClaude:\n0. [PM Scan] Scanning postmortem/ for: revert, mean, election, spread...\n   Found: PM-003 (liquidity trap in election markets) - HIGH relevance\n   Mitigation required: Exit strategy for illiquid periods\n\n1. [Context] Checking backtest/ and strategies/ via GitHub...\n   Found existing mean-reversion base class\n\n2. [Review] Risk assessment for mean-reversion in binary markets...\n   Added PM-003 mitigation to risk matrix\n\n3. [Linear] Creating main ticket + 2 sub-tickets...\n   - Main ticket includes PM Immune Screening section\n   - Acceptance criteria includes PM-003 mitigation verification\n\nOutput: Links to created Linear tickets with PM screening embedded\n```\n\n### ğŸ”„ Ralph Loop Mode (Deep Context Gathering)\n```\nUser: \"Plan a cross-market arbitrage strategyï¼Œè¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡åšå¥—åˆ©\"\n\nClaude:\n0. [PM Scan] Scanning postmortem/ for: arb, spread, cross-market, latency...\n   Found: Multiple potential risks\n   First arbitrage strategy â†’ Need thorough context\n\nğŸ”„ [Ralph Loop: Context Gathering]\n   Invoking: /ralph-loop \"Gather comprehensive context for cross-market arbitrage.\n   Areas: strategies/, backtest/, api/, postmortem/\n   First arb strategy - need complete understanding.\n   Output <promise>CONTEXT COMPLETE</promise> when map is comprehensive.\"\n   --max-iterations 8\n   --completion-promise \"CONTEXT COMPLETE\"\n\n   Iteration 1: Explored strategies/ â†’ Found market-making base, no arb\n   Iteration 2: Explored backtest/ â†’ Multi-market data format identified\n   Iteration 3: Explored api/ â†’ Rate limits per exchange documented\n   Iteration 4: Deep PM scan â†’ 3 latency-related incidents found\n   Iteration 5: Dependencies â†’ Websocket libraries identified\n\n   <promise>CONTEXT COMPLETE</promise>\n\nğŸ”„ [Ralph Loop Complete]\n   Context Map Built:\n   - Existing patterns: Market-making (adaptable)\n   - Backtest: Supports multi-market (need sync logic)\n   - API: 3 exchange connectors, different rate limits\n   - PM Risks: Latency (PM-004), Data sync (PM-006), Order timing (PM-009)\n   - Dependencies: asyncio, websockets (no conflicts)\n\n1-3. [Proceeding with Context, Review, Linear...]\n   Tickets created with comprehensive PM risks from deep scan\n\nOutput: Well-informed tickets based on thorough codebase exploration\n```\n",
        "skills/blueprint-review/SKILL.md": "---\nname: blueprint-review\ndescription: Use for security, quality, and PM compliance review before merging strategy code. Supports Ralph Loop iterative mode for backtest optimization. Runs PM audit, security audit, code review, backtest validation, and creates PR with comprehensive documentation.\n---\n\n# Blueprint Review - Security, Quality & PM Compliance Assessment\n\n## Overview\n\nMulti-dimensional code review ensuring **Postmortem compliance**, security compliance, error handling robustness, and validated backtest results before PR creation.\n\n## Core Principle\n\n```\n./postmortem/ = æ·±åº¦ç—…å†åº“ (Deep Case History)\n./CLAUDE.md   = é«˜é¢‘æ‰‹æœ¯å‡†åˆ™ (High-Frequency Operating Rules)\n\nRule: PR ä¸èƒ½å¼•å…¥ä»»ä½•å·²è®°å½•åœ¨æ¡ˆçš„åæ¨¡å¼ï¼Œå¿…é¡»é€šè¿‡\"ç—…å†å¤æŸ¥\"\n```\n\n## When to Use\n\n- Strategy implementation is complete (after `blueprint-develop`)\n- Ready to create PR for merge\n- User mentions \"review\", \"å®¡æ ¸\", \"PR ready\", or \"quality check\"\n- Before any strategy code goes to production\n\n**Do NOT use when:**\n- Still implementing features (use `blueprint-develop`)\n- Planning phase (use `blueprint-plan`)\n- Backtest-only runs without code review intent\n\n## Prerequisites\n\nBefore invoking this skill, verify:\n- [ ] All tests passing (from `blueprint-develop` Phase 5)\n- [ ] **PM regression tests passing** (from `blueprint-develop` Phase 2)\n- [ ] Code committed to feature branch\n- [ ] Linear ticket linked to the work\n\n## Workflow\n\n```dot\ndigraph blueprint_review {\n    rankdir=TB;\n    node [shape=box];\n\n    start [label=\"Start: Code Ready for Review\" shape=ellipse];\n    pm_audit [label=\"0. PM Compliance Audit\\n(MANDATORY FIRST)\" style=filled fillcolor=lightyellow];\n    security [label=\"1. Security Audit\\n(security-guidance)\"];\n    code_review [label=\"2. Code Quality Review\\n(code-review)\"];\n    backtest [label=\"3. Backtest Validation\\n(Execute & Capture)\"];\n    pm_final [label=\"4. PM Final Check\\n(Anti-Pattern Scan)\" style=filled fillcolor=lightyellow];\n    pr [label=\"5. Create PR\\n(GitHub MCP)\"];\n    done [label=\"PR Ready for Human Review\" shape=ellipse];\n\n    start -> pm_audit;\n    pm_audit -> security;\n    security -> code_review;\n    code_review -> backtest;\n    backtest -> pm_final;\n    pm_final -> pr;\n    pr -> done;\n}\n```\n\n## Phase 0: PM Compliance Audit (MANDATORY)\n\n**Goal:** Verify implementation doesn't repeat any documented failures.\n\n### Step 0.0: Gather Context (if needed)\n\nWhen analyzing complex PM compliance issues:\n\n```\nUse Skill tool: context7:context7\nPurpose: Gather comprehensive context about PM mitigations and related code\nFocus: PM-related code patterns, historical fixes, compliance requirements\n```\n\n### Step 0.1: Run PM Regression Tests\n\n```bash\n# MUST pass before proceeding\npytest tests/pm_regression/ -v --tb=short\n\n# If any fail, STOP and return to blueprint-develop\n```\n\n### Step 0.2: Cross-Reference PM Mitigations\n\nFrom the Linear ticket, verify each PM mitigation is implemented:\n\n```markdown\n## PM Compliance Verification\n\n| PM | Required Mitigation | Implemented? | Evidence |\n|----|---------------------|--------------|----------|\n| PM-001 | Idempotency key on orders | âœ… | execution.py:45 |\n| PM-003 | Liquidity check before entry | âœ… | signals.py:23 |\n| PM-003 | Exit timeout mechanism | âœ… | execution.py:89 |\n```\n\n### Step 0.3: CLAUDE.md Directive Check\n\n```bash\n# Read current directives\ncat ./CLAUDE.md\n```\n\nVerify code adheres to ALL directives:\n\n```markdown\n## CLAUDE.md Compliance\n\n| Directive | Compliant? | Evidence |\n|-----------|------------|----------|\n| Use decimal.Decimal for prices | âœ… | grep -r \"Decimal\" strategies/ |\n| Rate limit: 1.2s min delay | âœ… | api/client.py:34 |\n| Log order IDs immediately | âœ… | execution.py:47 |\n```\n\n**BLOCKING:** If ANY PM mitigation is missing or CLAUDE.md directive violated, STOP and return to `blueprint-develop`.\n\n**Output:** PM Compliance Report.\n\n## Phase 1: Security Audit\n\n**Goal:** Ensure no security vulnerabilities in trading bot code.\n\n### Step 1.1: Invoke Security Guidance\n\n```\nUse Skill tool: security-guidance:security-guidance\nPurpose: Get security best practices and vulnerability guidance\nFocus: Trading bot security, API key handling, credential management\n```\n\n### Step 1.2: Security Checklist\n\n| Category | Check Items | Severity |\n|----------|-------------|----------|\n| **Private Key Handling** | No hardcoded keys, env vars only, no logging of secrets | CRITICAL |\n| **API Credentials** | Secure storage, rotation support, no plaintext | CRITICAL |\n| **Rate Limiting** | Backoff logic, rate limit headers respected | HIGH |\n| **Input Validation** | All external data sanitized | HIGH |\n| **Error Messages** | No sensitive data in logs/errors | MEDIUM |\n\n### Security Scan Actions\n\n```\n1. Grep for security anti-patterns:\n   - \"private_key\\s*=\" (hardcoded keys)\n   - \"api_key\\s*=\" (hardcoded credentials)\n   - \"password\\s*=\" (plaintext passwords)\n   - \"print.*key|secret|password\" (secret logging)\n\n2. Verify secure patterns:\n   - os.environ.get() or dotenv usage\n   - try/except around API calls with rate limit handling\n   - No credentials in git history\n```\n\n### PM-Informed Security Patterns\n\nCheck for security issues documented in postmortems:\n\n```bash\n# Search postmortems for security-related incidents\ngrep -l \"security\\|credential\\|key\\|leak\" ./postmortem/*.md\n```\n\n**Output:** Security audit report with PASS/FAIL per category.\n\n## Phase 2: Code Quality Review\n\n**Goal:** Ensure robust error handling for market-making bot reliability.\n\n### Step 2.1: Invoke Superpowers Code Review\n\n```\nUse Skill tool: superpowers:requesting-code-review\nFocus areas:\n- Exception handling completeness\n- Network resilience\n- State recovery after failures\n- PM anti-pattern avoidance\n```\n\n### Step 2.2: Invoke Code Review Skill (Complementary)\n\n```\nUse Skill tool: code-review:code-review\nPurpose: Additional code review perspective, especially for PR-specific concerns\nFocus: PR readiness, merge conflicts, branch hygiene\n```\n\n### Step 2.3: Code Simplification\n\nBefore creating PR, simplify and refactor code if needed:\n\n```\nUse Skill tool: code-simplifier:code-simplifier\nPurpose: Simplify code before PR creation\nFocus: Reduce complexity, improve maintainability, remove redundancy\n```\n\n### Critical Error Handling Patterns\n\n| Scenario | Required Handling | Anti-pattern |\n|----------|------------------|--------------|\n| **Network Timeout** | Retry with exponential backoff | Single try, crash on fail |\n| **API Error 5xx** | Log, wait, retry (max 3) | Immediate retry flood |\n| **WebSocket Disconnect** | Auto-reconnect with state sync | Manual restart required |\n| **Order Rejection** | Log reason, adjust, retry | Silent failure |\n| **Data Feed Gap** | Detect, flag, use stale indicator | Trade on stale data |\n\n### PM-Specific Anti-Pattern Scan\n\n```bash\n# For each PM, grep for the documented anti-pattern\n# Example from PM-002:\ngrep -rn \"time.sleep(0)\" strategies/  # Should find nothing\n\n# Example from PM-004:\ngrep -rn \"while True:\" strategies/  # Check for unbounded loops\n```\n\n### Bot Resilience Checklist\n\n- [ ] All API calls wrapped in try/except\n- [ ] Retry logic with backoff for transient errors\n- [ ] WebSocket auto-reconnect implemented\n- [ ] Graceful shutdown on SIGTERM/SIGINT\n- [ ] State persistence for recovery after restart\n- [ ] Health check endpoint or heartbeat logging\n\n**Output:** Code review report with findings and required fixes.\n\n## Phase 3: Backtest Validation\n\n**Goal:** Execute backtest and capture results for PR documentation.\n\n### CRITICAL: Claude Code MUST Execute Backtest\n\nDo not skip this phase. Run the actual backtest script.\n\n```bash\n# Standard backtest execution\npython -m backtest.run --strategy [strategy_name] --output results/\n\n# Or project-specific command (check backtest/README.md)\n```\n\n### Capture Required Outputs\n\n| Output Type | Location | PR Inclusion |\n|-------------|----------|--------------|\n| **Performance Metrics** | Terminal stdout | Copy to PR body |\n| **Equity Curve Chart** | `results/*.png` | Reference path in PR |\n| **Trade Log** | `results/trades.csv` | Summarize stats |\n| **Risk Metrics** | Terminal or JSON | Include in table |\n\n### Metrics Summary Template\n\n```markdown\n## Backtest Results\n\n**Period:** [start_date] to [end_date]\n**Markets:** [list of markets tested]\n\n### Performance Metrics\n| Metric | Value | Target | Status |\n|--------|-------|--------|--------|\n| Sharpe Ratio | X.XX | â‰¥ 2.0 | âœ…/âŒ |\n| Max Drawdown | X.X% | â‰¤ 10% | âœ…/âŒ |\n| APR | XX.X% | â‰¥ 30% | âœ…/âŒ |\n| Win Rate | XX.X% | â‰¥ 55% | âœ…/âŒ |\n| Total Trades | XXX | - | - |\n\n### Charts\n- Equity Curve: `results/equity_curve.png`\n- Drawdown Chart: `results/drawdown.png`\n\n### Notes\n[Any observations, edge cases, or caveats]\n```\n\n### Backtest Failure Handling\n\nIf backtest fails or metrics below threshold:\n1. **DO NOT proceed to PR creation**\n2. Document failure reason\n3. **Check if failure relates to a PM** (potential new PM candidate)\n4. Return to `blueprint-develop` for fixes\n5. Re-run this skill after fixes\n\n**Output:** Backtest results summary formatted for PR.\n\n### ğŸ”„ Ralph Loop: Iterative Backtest Optimization (Optional)\n\n**When to Activate:** Backtest metrics close to threshold but not passing.\n\nInstead of returning to `blueprint-develop`, use Ralph Loop for iterative parameter tuning:\n\n```\nSkill: ralph-loop:ralph-loop\n\nPrompt Template:\n\"Optimize [strategy_name] backtest parameters.\nCurrent metrics:\n- Sharpe: X.XX (target: â‰¥ 2.0)\n- MDD: X.X% (target: â‰¤ 10%)\n- APR: XX% (target: â‰¥ 30%)\n\nConstraints:\n- PM compliance must be maintained\n- Only tune: [allowed_parameters]\n- DO NOT modify core logic\n\nOutput <promise>BACKTEST PASSED</promise> when ALL metrics meet targets.\"\n\nOptions:\n--max-iterations 10\n--completion-promise \"BACKTEST PASSED\"\n```\n\n### Ralph Loop Backtest Cycle\n\n```dot\ndigraph ralph_backtest {\n    rankdir=LR;\n    node [shape=box];\n\n    start [label=\"Backtest\\nBelow Threshold\" shape=ellipse];\n    tune [label=\"Tune Parameters\"];\n    run [label=\"Run Backtest\"];\n    check [label=\"Metrics OK?\" shape=diamond];\n    pass [label=\"<promise>\\nBACKTEST PASSED\" shape=ellipse style=filled fillcolor=lightgreen];\n\n    start -> tune;\n    tune -> run;\n    run -> check;\n    check -> tune [label=\"No\"];\n    check -> pass [label=\"Yes\"];\n}\n```\n\n### Ralph Loop Constraints for Backtest\n\n| Allowed | NOT Allowed |\n|---------|-------------|\n| Risk parameters (stop loss %, position size) | Core signal logic |\n| Entry/exit thresholds | PM mitigation removal |\n| Spread compensation factors | Test modifications |\n| Timing parameters | Changing target metrics |\n\n### When to Use Ralph Loop vs Return to Develop\n\n| Situation | Action |\n|-----------|--------|\n| Sharpe 1.8, need 2.0 | ğŸ”„ Ralph Loop - tune params |\n| Sharpe 0.5, need 2.0 | âŒ Return to develop - fundamental issue |\n| MDD 12%, need 10% | ğŸ”„ Ralph Loop - adjust risk params |\n| Tests failing | âŒ Return to develop - not a tuning issue |\n| PM compliance issue | âŒ Return to develop - NEVER tune away compliance |\n\n## Phase 4: PM Final Check (Anti-Pattern Scan)\n\n**Goal:** Final sweep for any PM-documented anti-patterns that may have slipped through.\n\n### Comprehensive Anti-Pattern Grep\n\n```bash\n# Load all anti-patterns from postmortems\nfor pm in ./postmortem/PM-*.md; do\n    echo \"=== Checking patterns from $pm ===\"\n    # Extract \"DON'T\" patterns and grep for them\ndone\n```\n\n### Anti-Pattern Checklist from All PMs\n\nGenerate a comprehensive checklist:\n\n```markdown\n## Final Anti-Pattern Sweep\n\n### From PM Files\n| PM | Anti-Pattern | Found? | Action |\n|----|--------------|--------|--------|\n| PM-001 | Missing client_order_id | âŒ None | OK |\n| PM-002 | Hardcoded API delay | âŒ None | OK |\n| PM-003 | No liquidity check | âŒ None | OK |\n| PM-004 | Unbounded retry loop | âŒ None | OK |\n\n### From CLAUDE.md\n| Directive Violation | Found? | Action |\n|--------------------|--------|--------|\n| Float for price calc | âŒ None | OK |\n| Missing order log | âŒ None | OK |\n```\n\n**BLOCKING:** If ANY anti-pattern found, STOP and fix before PR.\n\n**Output:** Clean anti-pattern scan report.\n\n## Phase 5: PR Creation\n\n**Goal:** Create PR with comprehensive PM compliance documentation.\n\n### Step 5.1: Final Verification Before PR\n\n```\nUse Skill tool: superpowers:verification-before-completion\nPurpose: Final check that all review phases completed successfully\nVerify:\n- PM compliance audit passed\n- Security audit passed\n- Code review passed\n- Backtest metrics meet baseline\n- Anti-pattern scan clean\n```\n\n### Step 5.2: Commit and Push (if needed)\n\nIf there are uncommitted changes:\n\n```\nUse Skill tool: commit-commands:commit\nPurpose: Create standardized commit before PR\n```\n\n### Step 5.3: Create PR\n\n**Option A: Use commit-push-pr (Recommended if uncommitted changes)**\n\n```\nUse Skill tool: commit-commands:commit-push-pr\nPurpose: Commit, push, and create PR in one step\n```\n\n**Option B: Use GitHub MCP (if already committed)**\n\n```\nTool: mcp__github__create_pull_request\n\nParameters:\n- owner: [repo owner]\n- repo: [repo name]\n- title: \"[Strategy] [Brief Description] - LIN-XXX\"\n- head: [feature-branch]\n- base: main\n- body: [Formatted PR body below]\n```\n\n### PR Body Template (PM-Enhanced)\n\n```markdown\n## Summary\n[1-2 sentence description of the strategy/change]\n\n**Linear Ticket:** [LIN-XXX](link)\n\n## ğŸ›¡ï¸ PM Compliance Report\n\n### Postmortem Mitigations Verified\n| PM | Mitigation | Status | Test |\n|----|------------|--------|------|\n| PM-001 | Idempotency key | âœ… | test_pm_001.py |\n| PM-003 | Liquidity check | âœ… | test_pm_003.py |\n| PM-003 | Exit timeout | âœ… | test_pm_003.py |\n\n### CLAUDE.md Directives\n| Directive | Status |\n|-----------|--------|\n| Decimal for prices | âœ… |\n| Rate limit 1.2s | âœ… |\n| Log order IDs | âœ… |\n\n### Anti-Pattern Scan\n- [x] No PM-documented anti-patterns found\n- [x] All regression tests passing\n\n## Security Review\n| Check | Status |\n|-------|--------|\n| Private Key Handling | âœ… Passed |\n| API Credentials | âœ… Passed |\n| Rate Limiting | âœ… Passed |\n| Input Validation | âœ… Passed |\n\n## Code Quality Review\n| Check | Status |\n|-------|--------|\n| Exception Handling | âœ… Passed |\n| Network Resilience | âœ… Passed |\n| State Recovery | âœ… Passed |\n\n## Backtest Results\n\n**Period:** [dates]\n\n| Metric | Value | Target | Status |\n|--------|-------|--------|--------|\n| Sharpe Ratio | X.XX | â‰¥ 2.0 | âœ… |\n| Max Drawdown | X.X% | â‰¤ 10% | âœ… |\n| APR | XX.X% | â‰¥ 30% | âœ… |\n\n<details>\n<summary>Full Backtest Output</summary>\n\n```\n[Paste terminal output here]\n```\n\n</details>\n\n## Test Coverage\n- Unit Tests: XX passing\n- **PM Regression Tests: XX passing**\n- Coverage: XX%\n\n## Checklist\n- [ ] **PM compliance audit passed**\n- [ ] Security audit passed\n- [ ] Code review passed\n- [ ] Backtest meets baseline metrics\n- [ ] **Anti-pattern scan clean**\n- [ ] Tests passing\n- [ ] Ready for human review\n\n---\nğŸ¤– Generated with Claude Code | PM Compliant âœ…\n```\n\n### Post-PR Actions\n\nAfter PR creation:\n1. Add reviewers if known\n2. Link PR to Linear ticket using `mcp__plugin_linear_linear__update_issue`\n3. Add PR link as attachment to Linear ticket\n\n**Output:** PR URL and confirmation of Linear ticket update.\n\n## Quick Reference\n\n| Phase | Tool/Skill | Key Action |\n|-------|-----------|------------|\n| 0. PM Audit | `context7:context7` (if needed) + `pytest tests/pm_regression/` | Gather context + Verify PM mitigations |\n| 1. Security | `security-guidance:security-guidance` + `Grep` + security patterns | Security guidance + Scan for secrets |\n| 2. Quality | `superpowers:requesting-code-review` + `code-review:code-review` | Exception handling + PR review |\n| 2b. Simplify | `code-simplifier:code-simplifier` | Simplify code before PR |\n| 3. Backtest | `Bash` (execute script) | Run backtest |\n| 3b. ğŸ”„ Ralph | `ralph-loop:ralph-loop` | Iterative param tuning (optional) |\n| 4. PM Final | `context7:context7` (if needed) + `Grep` + PM anti-patterns | Gather context + Final sweep |\n| 5. Verify | `superpowers:verification-before-completion` | Final check before PR |\n| 5. PR | `commit-commands:commit-push-pr` or `mcp__github__create_pull_request` | Create with PM report |\n\n## Common Mistakes\n\n| Mistake | Prevention |\n|---------|------------|\n| **Skipping PM audit** | Phase 0 is MANDATORY, blocking gate |\n| **No PM section in PR** | Always include PM Compliance Report |\n| Skipping backtest execution | MUST run actual script |\n| Generic security scan | Use trading-bot-specific patterns |\n| PR without metrics | Always include Sharpe, MDD, APR |\n| Missing Linear link | Update ticket with PR reference |\n| **Ignoring anti-pattern scan** | Phase 4 must pass before PR |\n\n## Exit Criteria\n\nBefore marking review complete:\n\n- [ ] **PM Compliance Audit: All mitigations verified**\n- [ ] **PM Regression Tests: All passing**\n- [ ] **Anti-Pattern Scan: Clean**\n- [ ] Security audit: All categories PASSED\n- [ ] Code review: No blocking issues\n- [ ] Backtest: All metrics meet or exceed baseline\n- [ ] PR created with PM Compliance Report\n- [ ] Linear ticket updated with PR link\n\n## Example Invocation\n\n### Standard Mode\n```\nUser: \"Review the mean-reversion strategy and create PR\"\n\nClaude:\n0. [PM Audit] Running PM regression tests...\n   pytest tests/pm_regression/ â†’ 6/6 passed âœ…\n   PM-001 mitigation: verified in execution.py:45 âœ…\n   PM-003 mitigations: verified in signals.py:23, execution.py:89 âœ…\n   CLAUDE.md directives: 5/5 compliant âœ…\n\n1. [Security] Scanning for secrets... No hardcoded keys found âœ…\n   Rate limit handling verified in api/client.py âœ…\n\n2. [Quality] Running code-review skill...\n   Exception handling: 12/12 API calls wrapped âœ…\n   Network resilience: Auto-reconnect implemented âœ…\n\n3. [Backtest] Executing: python -m backtest.run --strategy mean_reversion\n   Sharpe: 2.3 âœ… | MDD: 8.2% âœ… | APR: 34% âœ…\n\n4. [PM Final] Anti-pattern scan...\n   Scanned for 12 anti-patterns from 4 PMs â†’ None found âœ…\n\n5. [PR] Created: https://github.com/org/repo/pull/42\n   Includes PM Compliance Report âœ…\n   Linear ticket LIN-123 updated with PR link\n\nOutput: PR #42 ready for human review (PM Compliant)\n```\n\n### ğŸ”„ Ralph Loop Mode (Backtest Optimization)\n```\nUser: \"Review strategy, backtest è¿˜å·®ä¸€ç‚¹ç‚¹è¾¾æ ‡\"\n\nClaude:\n0-2. [Standard Phases Complete] âœ…\n\n3. [Backtest] First run results:\n   Sharpe: 1.85 âŒ (target: â‰¥ 2.0)\n   MDD: 9.5% âœ…\n   APR: 28% âŒ (target: â‰¥ 30%)\n\n   Metrics close to threshold â†’ Activating Ralph Loop\n\nğŸ”„ [Ralph Loop: Backtest Optimization]\n   Invoking: /ralph-loop \"Optimize mean-reversion parameters.\n   Current: Sharpe 1.85, APR 28%\n   Target: Sharpe â‰¥ 2.0, APR â‰¥ 30%\n   Allowed params: spread_threshold, position_size_pct, exit_timeout_hours\n   PM compliance must be maintained.\n   Output <promise>BACKTEST PASSED</promise> when targets met.\"\n   --max-iterations 8\n   --completion-promise \"BACKTEST PASSED\"\n\n   Iteration 1: Sharpe 1.85 â†’ 1.92 (adjusted spread_threshold)\n   Iteration 2: Sharpe 1.92 â†’ 1.98 (tuned position_size_pct)\n   Iteration 3: Sharpe 1.98 â†’ 2.05, APR 31% âœ…\n\n   <promise>BACKTEST PASSED</promise>\n\nğŸ”„ [Ralph Loop Complete]\n   Final metrics: Sharpe 2.05 âœ… | MDD 9.8% âœ… | APR 31% âœ…\n   PM Compliance: Maintained âœ…\n\n4-5. [Continuing to PM Final Check and PR...]\n\nOutput: PR created with optimized parameters via Ralph Loop\n```\n"
      },
      "plugins": [
        {
          "name": "blueprint-skills",
          "description": "Trading strategy lifecycle skills: plan, develop, review, and optimize with postmortem compliance",
          "version": "1.0.0",
          "source": "./",
          "author": {
            "name": "morrisy"
          },
          "categories": [],
          "install_commands": [
            "/plugin marketplace add morris-y/blueprint-skills",
            "/plugin install blueprint-skills@blueprint-marketplace"
          ]
        }
      ]
    },
    {
      "name": "morris-marketplace",
      "version": null,
      "description": "Personal Claude Code plugin marketplace by morris-y",
      "owner_info": {
        "name": "morris-y",
        "email": "morris-y@users.noreply.github.com"
      },
      "keywords": [],
      "repo_full_name": "morris-y/claude-marketplace",
      "repo_url": "https://github.com/morris-y/claude-marketplace",
      "repo_description": "Personal Claude Code plugin marketplace",
      "homepage": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2026-01-15T03:39:49Z",
        "created_at": "2026-01-14T12:06:28Z",
        "license": null
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 561
        }
      ],
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"morris-marketplace\",\n  \"description\": \"Personal Claude Code plugin marketplace by morris-y\",\n  \"owner\": {\n    \"name\": \"morris-y\",\n    \"email\": \"morris-y@users.noreply.github.com\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"blueprint-skills\",\n      \"description\": \"Trading strategy lifecycle skills with postmortem compliance (plan, develop, review, optimize)\",\n      \"version\": \"1.0.4\",\n      \"source\": {\n        \"source\": \"github\",\n        \"repo\": \"morris-y/blueprint-skills\"\n      },\n      \"author\": {\n        \"name\": \"morris-y\"\n      }\n    }\n  ]\n}\n"
      },
      "plugins": [
        {
          "name": "blueprint-skills",
          "description": "Trading strategy lifecycle skills with postmortem compliance (plan, develop, review, optimize)",
          "version": "1.0.4",
          "source": {
            "source": "github",
            "repo": "morris-y/blueprint-skills"
          },
          "author": {
            "name": "morris-y"
          },
          "categories": [],
          "install_commands": [
            "/plugin marketplace add morris-y/claude-marketplace",
            "/plugin install blueprint-skills@morris-marketplace"
          ]
        }
      ]
    }
  ]
}