{
  "author": {
    "id": "cruzanstx",
    "display_name": "cruzanstx",
    "avatar_url": "https://avatars.githubusercontent.com/u/2927083?v=4"
  },
  "marketplaces": [
    {
      "name": "cruzanstx",
      "version": null,
      "description": "Single-plugin marketplace for daplug - AI-assisted development workflows",
      "repo_full_name": "cruzanstx/daplug",
      "repo_url": "https://github.com/cruzanstx/daplug",
      "repo_description": null,
      "signals": {
        "stars": 4,
        "forks": 0,
        "pushed_at": "2026-01-31T22:44:20Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"cruzanstx\",\n  \"owner\": {\n    \"name\": \"CruzanSTX\",\n    \"url\": \"https://github.com/cruzanstx\"\n  },\n  \"metadata\": {\n    \"description\": \"Single-plugin marketplace for daplug - AI-assisted development workflows\",\n    \"version\": \"1.0.0\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"daplug\",\n      \"source\": \"./\",\n      \"category\": \"development\",\n      \"tags\": [\"ai\", \"automation\", \"codex\", \"gemini\", \"prompts\", \"worktrees\"]\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"daplug\",\n  \"version\": \"0.22.0\",\n  \"description\": \"AI-assisted development workflows with multi-model prompt execution\",\n  \"author\": {\n    \"name\": \"CruzanSTX\",\n    \"url\": \"https://github.com/cruzanstx/daplug\"\n  },\n  \"repository\": \"https://github.com/cruzanstx/daplug\",\n  \"license\": \"MIT\",\n  \"keywords\": [\n    \"ai\",\n    \"automation\",\n    \"codex\",\n    \"gemini\",\n    \"prompts\",\n    \"worktrees\",\n    \"agents\"\n  ]\n}\n",
        "README.md": "# daplug\n\nDelegate prompts to Codex, Gemini, Z.AI, or local models from Claude Code ‚Äî with worktree isolation and Ralph-Wiggum-inspired verification loops.\n\n## Installation\n\n### From Marketplace (Recommended)\n\nRun these commands in your terminal (not inside Claude Code):\n\n```bash\n# Add the marketplace (SSH)\nclaude plugin marketplace add cruzanstx/daplug\n\n# Or via HTTPS\nclaude plugin marketplace add https://github.com/cruzanstx/daplug\n\n# Install daplug\nclaude plugin install daplug@cruzanstx\n```\n\n### Manual Installation\n\nClone/copy this plugin to one of:\n- `~/.claude/plugins/daplug/` (user scope)\n- `.claude/plugins/daplug/` (project scope)\n\n## What's Included\n\n### Commands (17)\n\n| Command | Description |\n|---------|-------------|\n| `/daplug:check-config` | Verify daplug configuration status and detect legacy settings |\n| `/daplug:cclimits` | Check AI CLI usage/quota (Claude, Codex, Gemini, Z.AI) |\n| `/daplug:check-updates` | Check if plugin has updates available |\n| `/daplug:codex-cli` | Run task with OpenAI Codex CLI |\n| `/daplug:create-llms-txt` | Research and generate llms_txt documentation |\n| `/daplug:create-prompt` | Create optimized, XML-structured prompts |\n| `/daplug:devstral-cli` | Run task with local Devstral model via Codex CLI |\n| `/daplug:gemini-cli` | Run task with Google Gemini CLI |\n| `/daplug:detect-clis` | Scan and manage available AI coding CLIs |\n| `/daplug:migrate-config` | Migrate legacy CLAUDE.md settings to <daplug_config> |\n| `/daplug:prompts` | Analyze prompts folder and recommend next steps |\n| `/daplug:qwen-cli` | Run task with local Qwen model via Codex CLI |\n| `/daplug:run-prompt` | Execute prompts with various AI models |\n| `/daplug:sprint` | Automated sprint planning from specs or existing prompts |\n| `/daplug:uvc` | Update docs and push to version control |\n| `/daplug:zai-cli` | Run task with Z.AI GLM-4.7 via Codex CLI |\n| `/daplug:opencode-cli` | Run task with Z.AI GLM-4.7 via OpenCode CLI (recommended) |\n\n### Agents (5)\n\n| Agent | Description |\n|-------|-------------|\n| `frontend-build-optimizer` | Optimize frontend build times (SvelteKit, Next.js, Vite) |\n| `go-build-optimizer` | Optimize Go compilation and Docker builds |\n| `infra-troubleshooter` | Diagnose infrastructure issues |\n| `k8s-cicd-troubleshooter` | Troubleshoot Kubernetes and CI/CD pipelines |\n| `readonly-log-watcher` | Monitor prompt execution logs without touching files |\n\n### Skills (8)\n\n| Skill | Description |\n|-------|-------------|\n| `ai-usage` | Check AI CLI usage/quota (Claude, Codex, Gemini, Z.AI) |\n| `config-reader` | Read and manage daplug config from CLAUDE.md (<daplug_config>) |\n| `prompt-executor` | Execute prompts with AI models, worktrees, tmux |\n| `prompt-finder` | Find and resolve prompts in ./prompts/ directory |\n| `prompt-manager` | CRUD operations for prompts with subfolder support |\n| `sprint` | Automated sprint planning, dependency graphs, execution plans |\n| `tmux-manager` | Manage tmux sessions for background tasks |\n| `worktree` | Manage git worktrees for isolated development |\n\n### Hooks\n- `example-hook.json` - Example hook (logs before bash commands)\n\n### MCP Servers\n- `servers.json` - Placeholder MCP config (disabled by default)\n\n## Showcase\n\nCommands below are shown without the `/daplug:` prefix for readability. In Claude Code, use `/daplug:<command>` if you prefer namespaced commands.\n\n### Create & Execute Prompts\n![create-prompt demo](demos/create-and-run-prompt.gif)\n\n> `/create-prompt` generates XML-structured prompts optimized for each task type, then `/run-prompt` executes them with your chosen model.\n\n### Multi-Model Delegation\n![multi-model demo](demos/multi-model-delegation.gif)\n\n> Run prompt batches across Claude, Codex, Gemini, or Z.AI with parallel execution and quota-aware routing.\n\n### Worktree Isolation\n![worktree demo](demos/worktree-isolation.gif)\n\n> Execute prompts in isolated git worktrees to keep your main branch clean while tasks run.\n\n### Verification Loops\n![loop demo](demos/verification-loop.gif)\n\n> Re-run prompts until tests pass with `--loop` and completion-marker detection.\n\n### Quota Awareness\n![quota demo](demos/quota-awareness.gif)\n\n> Check usage across all AI CLIs and pick the model with the most headroom.\n\n### LLMS.txt Generation\n![llms-txt demo](demos/llms-txt-creation.gif)\n\n> `/create-llms-txt` scaffolds research prompts in your llms_txt repo and supports cross-repo execution.\n\n## Quick Examples\n\n### Generate a Feature Prompt\n```bash\n# In Claude Code:\n/create-prompt \"add user authentication with JWT\"\n```\n\n### Run Across Multiple Models\n```bash\n/run-prompt 005 --model codex        # OpenAI Codex\n/run-prompt 005 --model gemini       # Google Gemini 3 Flash\n/run-prompt 005 --model opencode     # Z.AI GLM-4.7 (recommended)\n/run-prompt 005 --model zai          # Z.AI GLM-4.7 (via Codex)\n```\n\n### Parallel Execution\n```bash\n/run-prompt 001 002 003 --parallel --worktree\n```\n\n### Check Quota Before Running\n```bash\n/cclimits\n# Shows: Claude: 18% | Codex: 0% | Gemini: 7% | Z.AI: 1%\n```\n\n## Recent Changes\n\n### v0.20.0 (2026-01-18)\n- **OpenCode CLI support**: New `opencode` model for Z.AI GLM-4.7 via OpenCode CLI\n- **Recommended for Z.AI**: OpenCode handles GLM-4.7 message format correctly (fixes GitHub Issue #4)\n- **PTY wrapper**: Automatic pseudo-terminal wrapping for CLIs that require it\n- **New tests**: 7 unit tests for model configuration and PTY command wrapping\n\n### v0.19.0 (2026-01-18)\n- **Sprint from existing prompts**: New `--from-existing` flag analyzes prompts already in `prompts/` instead of generating from a spec\n- **Prompt filtering**: `--prompts 001-005,010`, `--folder providers/`, `--exclude 003,007` for precise selection\n- **Dependency detection**: Scans prompt content for `depends on`, `requires`, `@file` references\n- **Run script generation**: Produces executable `run-sprint.sh` for batch execution\n\n### v0.18.0 (2026-01-17)\n- **Sprint command**: New `/sprint` command for automated sprint planning from technical specifications\n- **5-phase workflow**: Spec analysis ‚Üí prompt generation ‚Üí dependency graph ‚Üí model assignment ‚Üí execution plan\n- **State management**: Persistent `.sprint-state.json` for pause/resume/status tracking\n- **Sub-commands**: `status`, `add`, `remove`, `replan`, `pause`, `resume`, `cancel`, `history`\n\n### v0.15.0 (2026-01-11)\n- **Subfolder support**: Organize prompts into topic-based subfolders (e.g., `prompts/providers/`, `prompts/backend/`)\n- **New flags**: `--folder/-f` for create, `--tree` for list, `--folder` for next-number\n- **Folder-aware resolution**: `find 011` searches all folders, `find providers/011` targets specific folder\n- **Range expansion**: `providers/011-013` expands correctly with folder prefix\n- **Auto-create folders**: Folders created automatically on first prompt\n- **JSON output**: Now includes `folder`, `path`, `status` fields\n- **Branch naming**: Includes folder path to avoid collisions (e.g., `prompt/providers/001-name`)\n\n### v0.14.1 (2026-01-10)\n- **Fix**: Corrected marketplace name in `/check-updates` command (`cruzanstx` not `daplug`)\n\n### v0.14.0 (2026-01-10)\n- **GPT-5.2 model support**: Added `gpt52`, `gpt52-high`, `gpt52-xhigh` for planning and research tasks\n- **Model management utility**: New `scripts/manage-models.py` for listing, checking, and adding models\n- **Documentation**: Added \"Managing Models\" section to CLAUDE.md with checklist and templates\n\n### v0.13.0 (2026-01-05)\n- **New config format**: Settings now stored in `<daplug_config>` XML blocks in CLAUDE.md files\n- **Migration command**: `/daplug:migrate-config` automatically converts legacy plaintext settings\n- **Config detection**: `/daplug:check-config` verifies config status and detects legacy settings\n- **New skill: config-reader**: Python-based config parsing with project ‚Üí user fallback\n\n### v0.12.9 (2026-01-04)\n- **Central llms_txt prompts**: `/create-llms-txt` now creates prompts in `$LLMS_TXT_DIR/prompts/` (the llms_txt repo) instead of the current project's `./prompts/`\n- **Auto-discovery**: Reads `llms_txt_dir` from `~/.claude/CLAUDE.md`, offers clone/configure flow if not set\n- **Cross-repo execution**: Uses `--prompt-file` flag for running prompts from external repos\n\n### v0.12.8 (2026-01-03)\n- **New skill: prompt-manager**: Python-based CRUD for prompts (create, list, find, complete, delete)\n- **Centralized git root detection**: All prompt operations now use prompt-manager, fixing zsh parsing issues\n- `/create-prompt` and `prompt-finder` updated to use prompt-manager\n\n### v0.12.7 (2026-01-03)\n- **Zsh compatibility**: Fixed parse error when `$()` command substitution passed through eval in zsh\n\n### v0.12.5 (2026-01-03)\n- **Prompts always at git root**: `/create-prompt` now saves to `{git_root}/prompts/` instead of `./prompts/` (relative to cwd)\n- **Error handling**: `/run-prompt` now reports errors clearly instead of attempting manual CLI execution\n- Models will no longer go off-script when executor fails to find prompts\n\n### v0.12.4 (2026-01-01)\n- Made monitor spawning mandatory in Step 2 of `/run-prompt`\n- Auto-verify monitor permissions before spawning agents\n\n### v0.12.2 (2025-12-31)\n- Added `readonly-log-watcher` agent for lightweight monitoring\n- Refactored `/create-llms-txt` to generate prompts for `/run-prompt`\n\n## Customization\n\n1. Edit `.claude-plugin/plugin.json` to change name, version, description, author\n2. Add more commands in `commands/`\n3. Add agents in `agents/`\n4. Add skills in `skills/<skill-name>/SKILL.md`\n5. Add hooks in `hooks/`\n6. Configure MCP servers in `mcp/servers.json`\n\n### plugin.json Schema\n\n```json\n{\n  \"name\": \"plugin-name\",\n  \"version\": \"1.0.0\",\n  \"description\": \"What the plugin does\",\n  \"author\": {\n    \"name\": \"Your Name\",\n    \"email\": \"you@example.com\",\n    \"url\": \"https://your-site.com\"\n  },\n  \"homepage\": \"https://docs.example.com\",\n  \"repository\": \"https://github.com/you/plugin\",\n  \"license\": \"MIT\",\n  \"keywords\": [\"utility\", \"helper\"]\n}\n```\n\n| Field | Required | Description |\n|-------|----------|-------------|\n| `name` | Yes | Unique identifier (kebab-case) |\n| `version` | No | Semantic version (e.g., \"1.0.0\") |\n| `description` | No | Brief plugin purpose |\n| `author` | No | Object with `name`, `email`, `url` |\n| `homepage` | No | Documentation URL |\n| `repository` | No | Source code URL |\n| `license` | No | License identifier |\n| `keywords` | No | Discovery tags array |\n\n**Custom paths** (optional): `commands`, `agents`, `skills`, `hooks`, `mcpServers`, `outputStyles`, `lspServers`\n\n**INVALID fields** (will cause installation to fail): `manifest_version`, `type`, `permissions`, `entry`\n\n## Distribution\n\n### Via Marketplace (Recommended)\n\nThis repo is configured as a Claude Code marketplace. Run in terminal:\n```bash\n# Add marketplace (SSH)\nclaude plugin marketplace add cruzanstx/daplug\n\n# Or via HTTPS\nclaude plugin marketplace add https://github.com/cruzanstx/daplug\n\n# Install the plugin\nclaude plugin install daplug@cruzanstx\n```\n\n### Via Git Clone\n\n```bash\ngit clone cruzanstx/daplug\ncp -r daplug ~/.claude/plugins/\n```\n\n### Symlink for Development\n\n```bash\nln -s $(pwd) ~/.claude/plugins/daplug\n```\n\n### Team Auto-Install\n\nAdd to your project's `.claude/settings.json`:\n```json\n{\n  \"plugins\": {\n    \"marketplaces\": {\n      \"extraKnown\": [\"cruzanstx/daplug\"]\n    }\n  },\n  \"enabledPlugins\": [\"daplug@cruzanstx\"]\n}\n```\n\nOr install manually for each team member:\n```bash\nclaude plugin marketplace add cruzanstx/daplug\nclaude plugin install daplug@cruzanstx\n```\n\n## Updating\n\nClaude Code doesn't have built-in plugin update notifications yet ([feature request #10265](https://github.com/anthropics/claude-code/issues/10265)). Here are workarounds:\n\n### Manual Update\n\n```bash\n# Uninstall, refresh marketplace, then reinstall\nclaude plugin uninstall daplug@cruzanstx\nclaude plugin marketplace update cruzanstx\nclaude plugin install daplug@cruzanstx\n```\n\n**Important**: You must uninstall first - `claude plugin install` won't overwrite an existing cached version.\n\n### Option 1: GitLab CI Notification\n\nAdd to `.gitlab-ci.yml` to notify your team when the plugin version changes:\n\n```yaml\nnotify-plugin-update:\n  stage: notify\n  rules:\n    - changes:\n        - .claude-plugin/plugin.json\n  script:\n    - |\n      VERSION=$(jq -r '.version' .claude-plugin/plugin.json)\n      echo \"daplug updated to v${VERSION}\"\n      # Slack notification (uncomment and configure):\n      # curl -X POST -H 'Content-type: application/json' \\\n      #   --data \"{\\\"text\\\":\\\"daplug plugin updated to v${VERSION} - run: claude plugin uninstall daplug@cruzanstx && claude plugin marketplace update cruzanstx && claude plugin install daplug@cruzanstx\\\"}\" \\\n      #   $SLACK_WEBHOOK_URL\n\n      # Email notification (uncomment and configure):\n      # echo \"daplug v${VERSION} released\" | mail -s \"Plugin Update\" team@example.com\n```\n\n### Option 2: Check Command (Included)\n\nThis plugin includes `/daplug:check-updates` which compares your installed version against the marketplace:\n\n```\n/daplug:check-updates\n```\n\nOutput:\n```\ndaplug: v0.3.0 -> v0.3.0\nUP_TO_DATE\n```\n\nOr when an update is available:\n```\ndaplug: v0.2.0 -> v0.3.0\nNEEDS_UPDATE\n\nUpdate available! Run:\n  claude plugin uninstall daplug@cruzanstx && claude plugin marketplace update cruzanstx && claude plugin install daplug@cruzanstx\n\nThen resume session:\n  claude --resume\n```\n\nRunning `--resume` without an ID shows available sessions to pick from.\n\n**Note**: The uninstall is required because `claude plugin install` won't overwrite an existing cached version.\n\n### Option 3: Notification Hook (Limited)\n\nClaude Code hooks can't trigger on startup, but you can create a reminder that fires on specific events. Add `hooks/update-reminder.json`:\n\n```json\n{\n  \"name\": \"update-reminder\",\n  \"description\": \"Periodic reminder to check for plugin updates\",\n  \"hooks\": [\n    {\n      \"matcher\": {\n        \"type\": \"event\",\n        \"event\": \"Notification\"\n      },\n      \"hooks\": [\n        {\n          \"type\": \"command\",\n          \"command\": \"echo 'Tip: Run /daplug:check-updates to check for plugin updates'\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Note**: This approach is limited since there's no \"on startup\" or \"periodic\" hook event. It only triggers when Claude sends a notification.\n\n### Recommended Setup\n\nFor teams, combine:\n1. **GitLab CI** (Option 1) - Automatic team-wide notifications on release\n2. **Check command** (Option 2) - On-demand version checking for individuals\n\n## First-Run Setup\n\nOn first use, daplug prompts for user settings and saves them to `~/.claude/CLAUDE.md` under a `<daplug_config>` block:\n\n```markdown\n<daplug_config>\npreferred_agent: codex\nworktree_dir: .worktrees/\nllms_txt_dir: /storage/projects/docker/llms_txt\nai_usage_awareness: enabled\ncli_logs_dir: ~/.claude/cli-logs/\n</daplug_config>\n```\n\n| Setting | When Prompted | Default |\n|---------|---------------|---------|\n| `preferred_agent` | Running `/daplug:prompts` | Asks user to choose |\n| `worktree_dir` | Running `/daplug:run-prompt --worktree` | `../worktrees` |\n| `llms_txt_dir` | Running `/daplug:create-llms-txt` | `../llms_txt` |\n| `ai_usage_awareness` | Running `/daplug:create-prompt` (when choosing executor) | Asks user (enabled/disabled) |\n| `cli_logs_dir` | Not prompted (advanced) | `~/.claude/cli-logs/` |\n\nSettings are checked in order: project `./CLAUDE.md` ‚Üí user `~/.claude/CLAUDE.md`\n\nIf you still have legacy plaintext settings, run `/daplug:migrate-config` to upgrade them.\n\n### AI Usage Awareness\n\nDaplug integrates with [cclimits](https://github.com/cruzanstx/cclimits) ([npm](https://www.npmjs.com/package/cclimits)) to provide real-time quota monitoring across all AI CLI tools.\n\n**What is cclimits?**\n\nA standalone CLI tool that checks quota/usage for AI coding tools:\n- **Claude Code** - 5-hour and 7-day rolling windows\n- **OpenAI Codex** - Primary and secondary rate limits\n- **Google Gemini CLI** - Per-model quotas (3-Flash, Flash, Pro tiers)\n- **Z.AI** - Token quota percentage\n- **OpenRouter** - Account balance\n\n**Integration with daplug:**\n\nWhen `ai_usage_awareness` is enabled, `/create-prompt` will:\n- Run `npx cclimits --json` before presenting model options\n- Show quota percentages for each AI model\n- Warn about models near their limits (>70% ‚ö†Ô∏è, >90% üî¥)\n- Suggest fallback models when preferred agent is unavailable\n- Show individual Gemini model quotas\n\nYou can also check usage directly:\n```bash\n# Via daplug command\n/daplug:cclimits\n\n# Or directly via npx\nnpx cclimits              # Detailed output\nnpx cclimits --oneline    # Compact one-liner\nnpx cclimits --json       # JSON for scripting\n```\n\n**Example output:**\n```\nClaude: 4.0% (5h) ‚úÖ | Codex: 0% (5h) ‚úÖ | Z.AI: 1% ‚úÖ | Gemini: ( 3-Flash 7% ‚úÖ | Flash 1% ‚úÖ | Pro 10% ‚úÖ )\n```\n\n**Status icons:**\n| Icon | Meaning |\n|------|---------|\n| ‚úÖ | Under 70% - plenty of capacity |\n| ‚ö†Ô∏è | 70-90% - moderate usage |\n| üî¥ | 90-100% - near limit |\n| ‚ùå | 100% or unavailable |\n\n**Toggle setting:**\n\nUpdate `~/.claude/CLAUDE.md` under `<daplug_config>`:\n```markdown\n<daplug_config>\nai_usage_awareness: enabled   # or 'disabled'\n</daplug_config>\n```\n\n**Learn more:** [cclimits on GitHub](https://github.com/cruzanstx/cclimits) | [cclimits on npm](https://www.npmjs.com/package/cclimits)\n\n### Codex CLI Prerequisites\n\nCommands that use Codex CLI (`codex-cli`, `qwen-cli`, `zai-cli`) check for required config on first run:\n\n**For qwen-cli (LMStudio):**\n```toml\n# ~/.codex/config.toml\n[model_providers.lmstudio-remote]\nname = \"LMStudio\"\nbase_url = \"http://YOUR_IP:1234/v1\"\nenv_key = \"LMSTUDIO_API_KEY\"\nwire_api = \"chat\"\n\n[profiles.local]\nmodel_provider = \"lmstudio-remote\"\nmodel = \"qwen/qwen3-next-80b\"\n\n[env]\nLMSTUDIO_API_KEY = \"lm-studio\"\n```\n\n**For zai-cli (Z.AI):**\n```toml\n# ~/.codex/config.toml\n[model_providers.zai]\nname = \"Z.AI\"\nbase_url = \"https://api.z.ai/api/coding/paas/v4\"\nenv_key = \"ZAI_KEY\"\nwire_api = \"chat\"\n\n[profiles.zai]\nmodel_provider = \"zai\"\nmodel = \"glm-4.7\"\n\n[env]\nZAI_KEY = \"your-api-key\"  # Get from https://z.ai/manage-apikey\n```\n\nIf config is missing, the commands will prompt you to set it up.\n\n## Known Limitations\n\n### Plugin Path References\n\nCommands that reference internal plugin files (like `run-prompt.md` calling `executor.py`) should read the install path from Claude's manifest:\n\n```bash\n# Get exact install path from Claude's tracking\nPLUGIN_ROOT=$(jq -r '.plugins.\"daplug@cruzanstx\"[0].installPath' ~/.claude/plugins/installed_plugins.json)\nEXECUTOR=\"$PLUGIN_ROOT/skills/prompt-executor/scripts/executor.py\"\npython3 \"$EXECUTOR\" 123 --model codex\n```\n\n**Why read from `installed_plugins.json`?**\n\nThe cache directory may contain multiple plugin versions (0.1.0, 0.2.0, 0.3.0, etc.) after upgrades. Glob patterns would expand to ALL versions:\n```bash\n# BAD - expands to multiple paths\necho ~/.claude/plugins/cache/.../*/...executor.py\n# Result: \"/path/0.1.0/.../executor.py /path/0.2.0/.../executor.py ...\"\n```\n\nReading from `installed_plugins.json`:\n- Uses Claude's own tracking of the active install path\n- No glob expansion issues\n- Single source of truth\n\n**Why not use `${CLAUDE_PLUGIN_ROOT}`?**\n\nClaude Code provides a `${CLAUDE_PLUGIN_ROOT}` variable, but there's a [known bug (#9354)](https://github.com/anthropics/claude-code/issues/9354) where it doesn't work in command markdown files.\n\n**Where `${CLAUDE_PLUGIN_ROOT}` works:** Hooks JSON, MCP configs, LSP configs\n\n**Where it doesn't work:** Command `.md` files\n\n### Prompt Execution\n\nThe executor uses stdin for codex models to avoid shell escaping issues with complex prompts:\n\n```python\n# Codex: uses stdin with '-' flag\ncodex exec --full-auto -  # reads from stdin\n\n# Gemini: uses -p flag for headless mode\ngemini -y -p \"prompt content\"\n```\n\nThis prevents issues with prompts containing newlines, quotes, backticks, and XML tags.\n\n### Gemini CLI Model Tiers\n\nGemini models share quotas in tiers (observed with Google One Premium):\n\n| Tier | Models | Shorthand |\n|------|--------|-----------|\n| **Pro** | gemini-2.5-pro, gemini-3-pro-preview | `gemini-high`, `gemini-xhigh` |\n| **Flash** | gemini-2.5-flash, gemini-2.5-flash-lite | `gemini25flash`, `gemini25lite` |\n| **3 Flash** | gemini-3-flash-preview | `gemini` (default) |\n\n**Why `gemini` defaults to 3 Flash:**\n- Best coding performance (78% SWE-bench score)\n- Has its own separate quota bucket\n- Won't eat into Pro limits for complex tasks\n\n**Check usage:** Run `gemini` interactively and type `/usage`.\n\n**Model shortcuts:**\n| Shorthand | Model | Use Case |\n|-----------|-------|----------|\n| `gemini` | 3 Flash | Fast, daily driver (default) |\n| `gemini-high` | 2.5 Pro | Stable, more capable |\n| `gemini-xhigh` | 3 Pro | Most capable, complex tasks |\n\n### OpenAI Model Tiers\n\n| Shorthand | Model | Best For |\n|-----------|-------|----------|\n| `codex` | gpt-5.2-codex | Fast coding execution |\n| `codex-high` | gpt-5.2-codex (high) | Complex coding |\n| `codex-xhigh` | gpt-5.2-codex (xhigh) | Large refactors |\n| `gpt52` | gpt-5.2 | Planning, research, analysis |\n| `gpt52-high` | gpt-5.2 (high) | Deep reasoning |\n| `gpt52-xhigh` | gpt-5.2 (xhigh) | Maximum reasoning (30+ min) |\n\n**When to use GPT-5.2 vs GPT-5.2-Codex:**\n- **GPT-5.2-Codex**: Best when plans are clear, need fast execution\n- **GPT-5.2**: Best for ambiguous problems, research, methodical analysis\n\n## Worktree Auto-Install\n\nWhen using `--worktree`, the executor automatically detects and installs project dependencies after creating the worktree. This ensures verification commands (build, test, lint) work correctly in the isolated environment.\n\n### Supported Package Managers\n\n| Type | Lock File | Install Command | Search Dirs |\n|------|-----------|-----------------|-------------|\n| npm | `package-lock.json` | `npm ci` | `.`, `frontend`, `web`, `client`, `app` |\n| pnpm | `pnpm-lock.yaml` | `pnpm install --frozen-lockfile` | same |\n| yarn | `yarn.lock` | `yarn install --frozen-lockfile` | same |\n| Go | `go.mod` | `go mod download` | `.` |\n| pip | `requirements.txt` | `pip install -r requirements.txt` | `.` |\n| poetry | `poetry.lock` | `poetry install` | `.` |\n| uv | `uv.lock` | `uv sync` | `.` |\n\n### Behavior\n\n- Runs automatically after worktree creation (no flag needed)\n- Logs progress to stderr: `[Worktree] Detected: frontend/package-lock.json (npm)`\n- Install failures are logged but don't block prompt execution\n- Results included in JSON output under `dependencies_installed`\n\n### Example Output\n\n```\n[Worktree] Installing dependencies...\n[Worktree]   Detected: frontend/package-lock.json (npm)\n[Worktree]   Running: npm ci\n[Worktree]   npm ci completed (23.4s)\n[Worktree] Dependencies installed successfully\n```\n\n---\n\n## Verification Loop\n\nThe `--loop` flag enables iterative execution where prompts re-run until they report completion. Useful for test/build tasks that may need multiple attempts.\n\n### Inspiration\n\nThis feature is inspired by the [ralph-wiggum](https://github.com/anthropics/claude-plugins-official/tree/main/plugins/ralph-wiggum) plugin from Anthropic's official plugin collection. Ralph-wiggum implements a \"self-referential feedback loop\" that re-runs Claude until a completion promise is found.\n\n**Compare & Contrast:**\n\n| Aspect | ralph-wiggum | daplug `--loop` |\n|--------|--------------|-----------------|\n| **Mechanism** | [Stop hooks](https://github.com/anthropics/claude-plugins-official/blob/main/plugins/ralph-wiggum/hooks/hooks.json) intercept Claude's exit | Python loop in executor.py |\n| **Loop control** | Hook script feeds prompt back to Claude | Executor re-runs CLI directly |\n| **State file** | `.claude/ralph-loop.local.md` | `~/.claude/loop-state/{num}.json` |\n| **Completion marker** | `<promise>COMPLETE</promise>` | `<verification>VERIFICATION_COMPLETE</verification>` |\n| **Works with** | Claude Code only | Any CLI (codex, gemini, zai, etc.) |\n| **Runs in** | Interactive Claude session | Background process |\n\n**Why no hooks?** Ralph-wiggum's hook approach only works within Claude Code sessions. Our implementation needs to support external CLIs (Codex, Gemini, Z.AI) that don't have Claude's hook system. The Python-based loop runs the CLI, waits for completion, checks logs for markers, and re-runs if needed - all without requiring hooks.\n\n### Usage\n\n```bash\n/daplug:run-prompt 123 --model codex --loop\n/daplug:run-prompt 123 --model codex --loop --max-iterations 5\n```\n\n### Completion Markers\n\nThe executor wraps your prompt with verification protocol instructions. The agent signals completion by outputting:\n\n```xml\n<!-- Success - task complete -->\n<verification>VERIFICATION_COMPLETE</verification>\n\n<!-- Retry needed - explain why -->\n<verification>NEEDS_RETRY: Tests failing - 3 auth tests need fixing</verification>\n```\n\n### How It Works\n\n1. Your prompt is wrapped with verification instructions\n2. Agent runs and outputs a completion marker\n3. If `VERIFICATION_COMPLETE` found ‚Üí loop ends successfully\n4. If `NEEDS_RETRY` found or no marker ‚Üí loop continues\n5. Retry reasons are passed into the next iteration as feedback\n6. Each iteration sees previous work (files, git history)\n7. Loop ends at max iterations (default: 3)\n\n### Loop State\n\nState is persisted in `~/.claude/loop-state/{prompt-number}.json`:\n\n```json\n{\n  \"prompt_number\": \"123\",\n  \"iteration\": 3,\n  \"max_iterations\": 3,\n  \"status\": \"running\",\n  \"last_updated_at\": \"2025-12-29T18:30:00\",\n  \"history\": [\n    {\"iteration\": 1, \"exit_code\": 0, \"marker_found\": false, \"retry_reason\": \"Tests failing\"},\n    {\"iteration\": 2, \"exit_code\": 1, \"marker_found\": false, \"retry_reason\": \"Lint errors remain\"}\n  ],\n  \"suggested_next_steps\": [\n    {\"text\": \"Deploy to staging\", \"original\": \"1) Deploy to staging\", \"source_iteration\": 1}\n  ]\n}\n```\n\nCheck status: `python3 \"$EXECUTOR\" 123 --loop-status`\n\nThe executor also extracts \"Next steps\" / \"TODO\" suggestions from logs and returns them in the loop result JSON so follow-up prompts can be created automatically.\n\n### Writing Verification-Aware Prompts\n\nFor best results with `--loop`:\n\n1. **Include explicit verification steps** - List what must pass (tests, build, lint)\n2. **Make verification checkable** - Use commands that return clear pass/fail\n3. **Be specific about \"done\"** - Avoid ambiguous completion criteria\n\nExample prompt structure:\n```markdown\n## Requirements\n- Add login/logout endpoints\n- Password hashing with bcrypt\n\n## Verification Criteria\n- [ ] All tests pass: `npm test`\n- [ ] Build succeeds: `npm run build`\n- [ ] No lint errors: `npm run lint`\n\nWhen ALL criteria verified, output:\n<verification>VERIFICATION_COMPLETE</verification>\n```\n"
      },
      "plugins": [
        {
          "name": "daplug",
          "source": "./",
          "category": "development",
          "tags": [
            "ai",
            "automation",
            "codex",
            "gemini",
            "prompts",
            "worktrees"
          ],
          "description": null,
          "categories": [
            "ai",
            "automation",
            "codex",
            "development",
            "gemini",
            "prompts",
            "worktrees"
          ],
          "install_commands": [
            "/plugin marketplace add cruzanstx/daplug",
            "/plugin install daplug@cruzanstx"
          ]
        }
      ]
    }
  ]
}