{
  "author": {
    "id": "panayiotism",
    "display_name": "Panayiotis Menelaou",
    "avatar_url": "https://avatars.githubusercontent.com/u/76447192?v=4"
  },
  "marketplaces": [
    {
      "name": "claude-harness",
      "version": null,
      "description": "Claude Code agent harness with 5-layer memory, test-driven features, and autonomous batch processing",
      "repo_full_name": "panayiotism/claude-harness",
      "repo_url": "https://github.com/panayiotism/claude-harness",
      "repo_description": null,
      "signals": {
        "stars": 69,
        "forks": 7,
        "pushed_at": "2026-02-15T08:59:16Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"$schema\": \"https://anthropic.com/claude-code/marketplace.schema.json\",\n  \"name\": \"claude-harness\",\n  \"metadata\": {\n    \"description\": \"Claude Code agent harness with 5-layer memory, test-driven features, and autonomous batch processing\"\n  },\n  \"owner\": {\n    \"name\": \"panayiotis\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"claude-harness\",\n      \"source\": \"./claude-harness\",\n      \"description\": \"Long-running agent harness with 5-layer memory, test-driven features, GitHub integration, and autonomous batch processing\",\n      \"category\": \"development\",\n      \"homepage\": \"https://github.com/panayiotism/claude-harness\"\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"claude-harness\",\n  \"description\": \"Long-running agent harness with 5-layer memory architecture, GitHub integration, autonomous batch processing, 6 hooks (safety, quality gates), and 5 commands\",\n  \"version\": \"8.2.0\",\n  \"author\": {\n    \"name\": \"panayiotis\"\n  }\n}\n",
        "README.md": "# Claude Code Long-Running Agent Harness\n\nA Claude Code plugin for automated, context-preserving coding sessions with **5-layer memory architecture**, failure prevention, test-driven features, and GitHub integration.\n\nBased on [Anthropic's engineering article](https://www.anthropic.com/engineering/effective-harnesses-for-long-running-agents) and enhanced with patterns from:\n- [Context-Engine](https://github.com/zeddy89/Context-Engine) - Memory architecture\n- [Agent-Foreman](https://github.com/mylukin/agent-foreman) - Task management patterns\n- [Autonomous-Coding](https://github.com/anthropics/claude-quickstarts/tree/main/autonomous-coding) - Test-driven approach\n\n## TL;DR - End-to-End Workflow\n\n### Quick Start\n\n```bash\n# Step 1: Add the marketplace (registers the catalog)\n/plugin marketplace add panayiotism/claude-harness\n\n# Step 2: Install the plugin\n/plugin install claude-harness@panayiotism-claude-harness\n```\n\nOr from the terminal:\n\n```bash\nclaude plugin marketplace add panayiotism/claude-harness\nclaude plugin install claude-harness@panayiotism-claude-harness\n```\n\n```bash\n# Initialize in your project (one-time)\ncd your-project && claude\n/claude-harness:setup\n\n# Single command for entire workflow (start → do → checkpoint → merge)\n/claude-harness:flow \"Add user authentication with JWT tokens\"\n# Auto-compiles context, creates issue/branch, implements, checkpoints, merges\n\n# Or batch-process all active features autonomously with TDD\n/claude-harness:flow --autonomous\n\n# Or step-by-step without auto-merge\n/claude-harness:flow --no-merge \"Add user authentication with JWT tokens\"\n```\n\nThe **`/flow`** command handles the entire lifecycle automatically - from context compilation to PR merge. It enforces test-driven development practices with a RED-GREEN-REFACTOR cycle and acceptance testing. Use `--autonomous` to batch-process all active features. Use `--no-merge` for step-by-step control, `--quick` to skip planning for simple tasks.\n\n### Complete Workflow (5 Commands Total)\n\n```bash\n# 1. SETUP (one-time)\n/claude-harness:setup                              # Initialize harness in project\n\n# 2. START SESSION (or skip with /flow)\n/claude-harness:start                              # Compile context, show status\n\n# 3. DEVELOPMENT (unified /flow command)\n/claude-harness:flow \"Add dark mode\"               # Complete lifecycle in one command\n/claude-harness:flow --no-merge \"Add feature\"      # Stop at checkpoint (don't auto-merge)\n/claude-harness:flow --autonomous                   # Batch-process all features\n/claude-harness:flow --fix feature-001 \"Token bug\" # Bug fix linked to feature\n/claude-harness:flow feature-001                   # Resume existing feature/fix\n\n# 4. MANUAL CHECKPOINT (optional - /flow includes checkpoint)\n/claude-harness:checkpoint               # Commit, push, create PR\n\n# 5. RELEASE\n/claude-harness:merge                    # Merge all PRs, close issues\n```\n\n### What Happens Behind the Scenes\n\n```\n/setup           → One-time: Creates .claude-harness/ with memory architecture\n\n/start           → Compiles working context from 4 memory layers\n                   Shows status, syncs GitHub, displays learned rules\n\n/flow            → UNIFIED END-TO-END WORKFLOW:\n                   1. Auto-compiles context (replaces /start)\n                   2. Creates feature (GitHub issue + branch)\n                   3. Plans implementation (checks past failures)\n                   4. Implements feature with TDD enforcement\n                   5. Verifies: RED → GREEN → REFACTOR\n                   6. Auto-checkpoints when all tests pass\n                   7. Auto-merges when PR approved\n                   Options: --no-merge, --quick, --autonomous,\n                            --plan-only, --fix\n                   --autonomous: Batch loop through ALL features\n                   OPTIMIZATIONS: Parallel memory reads, cached GitHub parsing\n\n/checkpoint      → Manual commit + push + PR (when not using /flow)\n                   Auto-reflects on user corrections\n\n/merge           → Merges PRs in dependency order\n                   Closes linked issues\n                   Cleans up branches\n```\n\n### v3.0 Memory Architecture\n\n```\n.claude-harness/\n├── memory/\n│   ├── episodic/    → Rolling window of 50 recent decisions\n│   ├── semantic/    → Persistent project architecture & patterns\n│   ├── procedural/  → Append-only success/failure logs (never repeat mistakes)\n│   └── learned/     → Rules from user corrections (self-improving)\n├── features/        → Shared feature registry (active.json, archive.json)\n└── sessions/        → Per-session state (gitignored, enables parallel work)\n    └── {uuid}/      → Each Claude instance gets isolated loop/context state\n```\n\n### Session Cleanup (Automatic)\n\nSession directories are automatically cleaned up at session start. The `SessionStart` hook detects stale sessions by checking their PID:\n\n- **Active sessions** (PID still running) are preserved\n- **Stale sessions** (PID no longer running) are deleted\n- **Current session** gets a fresh state directory\n\nThis ensures parallel Claude instances don't interfere with each other while preventing disk bloat from accumulated sessions.\n\n## Session Start Hook\n\nWhen you start Claude Code in a harness-enabled project:\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│                  CLAUDE HARNESS v8.0.0                            │\n├─────────────────────────────────────────────────────────────────┤\n│  P:2 WIP:1 Tests:1 Fixes:1 | Active: feature-001                │\n│  Memory: 12 decisions | 3 failures | 8 successes                │\n│  GitHub: owner/repo (cached)                                    │\n├─────────────────────────────────────────────────────────────────┤\n│  /claude-harness:setup          Initialize harness (one-time)   │\n│  /claude-harness:start          Compile context + GitHub sync   │\n│  /claude-harness:flow           Unified workflow (all flags)    │\n│  /claude-harness:checkpoint     Commit + persist memory         │\n│  /claude-harness:merge          Merge PRs + close issues        │\n└─────────────────────────────────────────────────────────────────┘\n```\n\nShows:\n- **Feature status**: P (Pending) / WIP (Work-in-progress) / Tests (Needs tests)\n- **Memory stats**: Decisions recorded, failures to avoid, successes to reuse\n- **Failure prevention**: If failures exist, warns before implementing\n\n## v3.0 Memory Architecture\n\n### Four Layers\n\n```\n.claude-harness/memory/\n├── working/context.json      # Rebuilt each session (computed)\n├── episodic/decisions.json   # Rolling window of recent decisions\n├── semantic/                 # Persistent project knowledge\n│   ├── architecture.json\n│   ├── entities.json\n│   └── constraints.json\n└── procedural/               # Success/failure patterns (append-only)\n    ├── failures.json\n    ├── successes.json\n    └── patterns.json\n```\n\n| Layer | Purpose | Lifecycle |\n|-------|---------|-----------|\n| **Working** | Current task only | Rebuilt each session |\n| **Episodic** | Recent decisions, context | Rolling window (50 max) |\n| **Semantic** | Project architecture, patterns | Persistent |\n| **Procedural** | What worked, what failed | Append-only |\n\n### Context Compilation\n\nEach session compiles **fresh working context** by pulling relevant information from memory layers:\n\n```\n/claude-harness:start\n\n→ Compile working context:\n  • Pull recent decisions from episodic (last 10 relevant)\n  • Pull project patterns from semantic\n  • Pull failures to avoid from procedural\n  • Pull successful approaches from procedural\n\n→ Result: Clean, relevant context without accumulation\n```\n\n## Failure Prevention System\n\nNever repeat the same mistakes. When you try an approach that fails, it's recorded:\n\n```json\n// .claude-harness/memory/procedural/failures.json\n{\n  \"entries\": [\n    {\n      \"id\": \"uuid\",\n      \"timestamp\": \"2025-01-20T10:30:00Z\",\n      \"feature\": \"feature-001\",\n      \"approach\": \"Used direct DOM manipulation for state\",\n      \"files\": [\"src/components/Auth.tsx\"],\n      \"errors\": [\"React hydration mismatch\"],\n      \"rootCause\": \"SSR incompatibility with direct DOM access\",\n      \"prevention\": \"Use useState and useEffect instead\"\n    }\n  ]\n}\n```\n\nBefore each implementation attempt, `/flow` automatically checks past failures:\n\n```\n/claude-harness:flow feature-002\n\n⚠️  SIMILAR APPROACH FAILED BEFORE\n\nFailure: Used direct DOM manipulation for state\nWhen: 2025-01-20\nFiles: src/components/Auth.tsx\nError: React hydration mismatch\nRoot Cause: SSR incompatibility with direct DOM access\n\nPrevention Tip: Use useState and useEffect instead\n\n✅ SUCCESSFUL ALTERNATIVE\nApproach: React hooks with conditional rendering\nFiles: src/components/User.tsx\nWhy it worked: Proper SSR hydration\n```\n\n## Test-Driven Features\n\nThe `/flow` command enforces test-driven development practices. Every feature follows a RED-GREEN-REFACTOR cycle with acceptance testing:\n\n```\n/claude-harness:flow \"Add user authentication\"\n\n→ Creates feature entry with status: \"pending\"\n→ Creates GitHub issue (if MCP configured)\n→ Creates feature branch\n→ Plans implementation (generates tests if needed)\n→ Implements until all verification passes\n```\n\n### Test Cases Schema\n\n```json\n// .claude-harness/features/tests/feature-001.json\n{\n  \"featureId\": \"feature-001\",\n  \"generatedAt\": \"2025-01-20T10:30:00Z\",\n  \"framework\": \"jest\",\n  \"cases\": [\n    {\n      \"id\": \"test-001\",\n      \"type\": \"unit\",\n      \"description\": \"Should authenticate user with valid credentials\",\n      \"file\": \"tests/auth/login.test.ts\",\n      \"status\": \"pending\",\n      \"code\": \"test('authenticates with valid credentials', async () => {...})\"\n    }\n  ],\n  \"coverage\": {\n    \"target\": 80,\n    \"current\": 0\n  }\n}\n```\n\n## Two-Phase Pattern\n\nThe `/flow` command separates planning from implementation internally:\n\n### Phase 1: Plan (automatic in /flow)\n\n```\n/claude-harness:flow \"Add authentication\"\n\n→ Planning Phase:\n  → Analyzes requirements\n  → Identifies files to create/modify\n  → Runs impact analysis\n  → Checks failure patterns\n  → Generates tests (if needed)\n  → Creates implementation plan\n```\n\nOutput:\n```\nImplementation Plan for feature-001:\n\nSteps:\n1. Create auth service (src/services/auth.ts)\n2. Add login API route (src/app/api/auth/login/route.ts)\n3. Create login form component (src/components/LoginForm.tsx)\n4. Add protected route wrapper (src/components/ProtectedRoute.tsx)\n\nImpact Analysis:\n- High: src/app/layout.tsx (15 dependents)\n- Medium: src/lib/api.ts (8 dependents)\n\nFailures to Avoid:\n- Don't use direct DOM manipulation (failed in feature-003)\n\nSuccessful Patterns to Use:\n- React hooks with conditional rendering\n- Server-side session validation\n```\n\n### Phase 2: Implement (automatic in /flow)\n\n```\n→ Implementation Phase:\n  → Loads loop state (resume if active)\n  → Checks failure patterns before each attempt\n  → Verifies tests are generated\n  → Implements to pass tests\n  → Runs ALL verification commands\n  → Records success/failure to procedural memory\n```\n\nUse `--quick` to skip planning, or `--plan-only` to stop after planning.\n\n## Commands Reference (5 Total)\n\n| Command | Purpose |\n|---------|---------|\n| `/claude-harness:setup` | Initialize harness in project (one-time) |\n| `/claude-harness:start` | Compile context + GitHub sync + status |\n| **`/claude-harness:flow`** | **Unified workflow**: start→implement→checkpoint→merge (flags: `--no-merge`, `--plan-only`, `--autonomous`, `--quick`, `--fix`) |\n| `/claude-harness:checkpoint` | Manual commit + push + PR |\n| `/claude-harness:merge` | Merge all PRs, close issues |\n\n### `/flow` Command Options\n\n| Syntax | Behavior |\n|--------|----------|\n| `/flow \"Add feature\"` | Complete lifecycle: TDD (RED→GREEN→REFACTOR) → checkpoint → merge |\n| `/flow feature-001` | Resume existing feature from current phase |\n| `/flow --no-merge \"Add feature\"` | Stop at checkpoint (don't auto-merge) |\n| `/flow --plan-only \"Big feature\"` | Plan only, implement later |\n| `/flow --quick \"Simple change\"` | Skip planning phase |\n| `/flow --fix feature-001 \"Bug\"` | Complete lifecycle for a bug fix |\n| `/flow --autonomous` | **Batch loop**: process all active features, checkpoint, merge, repeat |\n| `/flow --autonomous --no-merge` | Batch loop but stop each feature at checkpoint (PRs created, not merged) |\n\n**Key Features in /flow**:\n- **TDD enforcement**: RED→GREEN→REFACTOR cycle enforced by design\n- **Acceptance testing**: Deterministic E2E tests run after refactoring\n- Memory layers read in parallel (30-40% faster startup)\n- GitHub repo parsed once and cached for entire flow\n- Streaming memory updates after each verification attempt\n\n**TDD Phases (always-on):**\n```\nRED      → Write failing tests\nGREEN    → Write minimal code to pass tests\nREFACTOR → Validate quality, fix issues\n```\n\n### `/prd-breakdown` Command Options\n\n| Syntax | Behavior |\n|--------|----------|\n| `/prd-breakdown \"Your PRD markdown...\"` | Analyze inline PRD |\n| `/prd-breakdown @./docs/prd.md` | Read PRD from file (@ syntax - preferred) |\n| `/prd-breakdown --file ./docs/prd.md` | Read PRD from file (--flag syntax) |\n| `/prd-breakdown --url https://github.com/org/repo/issues/42` | Fetch PRD from GitHub issue |\n| `/prd-breakdown --analyze-only` | Run analysis without creating features |\n| `/prd-breakdown --auto` | No prompts, create all features |\n| `/prd-breakdown --max-features 10` | Limit to 10 highest-priority features |\n| `/prd-breakdown @./prd.md --create-issues` | Create GitHub issues for each feature |\n| `/prd-breakdown @./prd.md --create-issues --auto` | Full automation: analyze, create features AND GitHub issues |\n\n**PRD Breakdown Workflow:**\n```\nInput         → Read PRD from inline, file, or GitHub\nAnalyze       → Analyzes requirements from product, architecture, and QA perspectives\nDecompose     → Transform requirements into atomic features\n  • Resolve dependencies (topological sort)\n  • Assign priorities (MVP first)\n  • Generate acceptance criteria\nReview        → Preview breakdown, select features to create\nCreate        → Add features to active.json with PRD metadata\nIssues (opt)  → Create GitHub issues for tracking (--create-issues flag)\n```\n\n#### Auto-Creating GitHub Issues from PRD\n\nWhen using the `--create-issues` flag, the `/prd-breakdown` command will automatically create one GitHub issue per generated feature:\n\n```bash\n/prd-breakdown @./prd.md --create-issues              # Manual review then create issues\n/prd-breakdown @./prd.md --create-issues --auto       # Fully automated\n```\n\nEach issue will:\n- Contain the feature description and acceptance criteria\n- Be labeled with `feature` and `prd-generated` tags\n- Be linked to the feature in `.claude-harness/features/active.json` (stored in `github.issueNumber`)\n- Be assigned the PRD breakdown ID for traceability across sessions\n\nThis is useful when you want to:\n- Create a complete GitHub-tracked backlog from a PRD\n- Ensure every generated feature has an issue for team visibility\n- Maintain bidirectional links between PRD decomposition and issue tracking\n\n**Note**: Requires GitHub MCP integration to be configured in Claude Code.\n\n## v3.0 Directory Structure\n\n```\n.claude-harness/\n├── memory/\n│   ├── working/\n│   │   └── context.json          # Rebuilt each session\n│   ├── episodic/\n│   │   └── decisions.json        # Rolling window (50 max)\n│   ├── semantic/\n│   │   ├── architecture.json     # Project structure\n│   │   ├── entities.json         # Key components\n│   │   └── constraints.json      # Rules & conventions\n│   ├── procedural/\n│   │   ├── failures.json         # Append-only failure log\n│   │   ├── successes.json        # Append-only success log\n│   │   └── patterns.json         # Learned patterns\n│   └── learned/\n│       └── rules.json            # Rules from user corrections\n├── impact/\n│   ├── dependency-graph.json     # File dependencies\n│   └── change-log.json           # Recent changes\n├── features/\n│   ├── active.json               # Current features\n│   ├── archive.json              # Completed features\n│   └── tests/\n│       └── {feature-id}.json     # Test cases per feature\n├── agents/\n│   └── context.json              # Orchestration state\n├── prd/                          # PRD analysis and decomposition\n│   ├── input.md                  # Original PRD document\n│   ├── metadata.json             # PRD metadata and hash\n│   ├── analysis.json             # Analysis results\n│   ├── breakdown.json            # Decomposed features\n│   └── analyst-prompts.json      # Reusable analysis prompts\n├── loops/\n│   └── state.json                # Agentic loop state\n├── sessions/                     # Per-session state (gitignored)\n│   └── {uuid}/                   # Isolated loop/context per session\n├── config.json                   # Plugin configuration\n└── claude-progress.json          # Session summary\n```\n\n## Feature Schema (v3.0)\n\n```json\n{\n  \"id\": \"feature-001\",\n  \"name\": \"User Authentication\",\n  \"description\": \"Add login/logout with session management\",\n  \"priority\": 1,\n  \"status\": \"pending|needs_tests|in_progress|passing|failing|blocked|escalated\",\n  \"phase\": \"planning|test_generation|implementation|verification\",\n  \"tests\": {\n    \"generated\": true,\n    \"file\": \"features/tests/feature-001.json\",\n    \"passing\": 0,\n    \"total\": 15\n  },\n  \"verification\": {\n    \"build\": \"npm run build\",\n    \"tests\": \"npm run test\",\n    \"lint\": \"npm run lint\",\n    \"typecheck\": \"npx tsc --noEmit\",\n    \"custom\": []\n  },\n  \"attempts\": 0,\n  \"maxAttempts\": 15,\n  \"relatedFiles\": [],\n  \"github\": {\n    \"issueNumber\": 42,\n    \"prNumber\": null,\n    \"branch\": \"feature/feature-001\"\n  },\n  \"createdAt\": \"2025-01-20T10:30:00Z\",\n  \"updatedAt\": \"2025-01-20T10:30:00Z\"\n}\n```\n\n## Fix Schema (v3.1)\n\nBug fixes are linked to their original features:\n\n```json\n{\n  \"id\": \"fix-feature-001-001\",\n  \"name\": \"Token expiry not handled\",\n  \"description\": \"User gets stuck on expired token\",\n  \"linkedTo\": {\n    \"featureId\": \"feature-001\",\n    \"featureName\": \"User Authentication\",\n    \"issueNumber\": 42\n  },\n  \"type\": \"bugfix\",\n  \"status\": \"pending|in_progress|passing|escalated\",\n  \"verification\": {\n    \"build\": \"npm run build\",\n    \"tests\": \"npm run test\",\n    \"lint\": \"npm run lint\",\n    \"typecheck\": \"npx tsc --noEmit\",\n    \"custom\": [],\n    \"inherited\": true\n  },\n  \"attempts\": 0,\n  \"maxAttempts\": 15,\n  \"relatedFiles\": [],\n  \"github\": {\n    \"issueNumber\": 55,\n    \"prNumber\": null,\n    \"branch\": \"fix/feature-001-token-expiry\"\n  },\n  \"createdAt\": \"2025-01-20T11:00:00Z\",\n  \"updatedAt\": \"2025-01-20T11:00:00Z\"\n}\n```\n\nKey differences from features:\n- `linkedTo` - References the original feature\n- `type: \"bugfix\"` - Distinguishes from features\n- `verification.inherited` - Indicates commands came from original feature\n- Branch format: `fix/{feature-id}-{slug}` instead of `feature/`\n- Commits use `fix:` prefix (triggers PATCH version bump)\n\n## Agentic Loops\n\nThe `/flow` command runs autonomous implementation loops that continue until ALL tests pass:\n\n```\n/claude-harness:flow feature-001\n\n┌─────────────────────────────────────────────────────────────────┐\n│  AGENTIC LOOP: User Authentication                              │\n├─────────────────────────────────────────────────────────────────┤\n│  Attempt 3/10                                                   │\n│  ├─ Failure Prevention: Checked 3 past failures                 │\n│  ├─ Implementation: Using React hooks pattern                   │\n│  ├─ Verification:                                               │\n│  │   ├─ Build:     PASSED                                       │\n│  │   ├─ Tests:     PASSED (15/15)                               │\n│  │   ├─ Lint:      PASSED                                       │\n│  │   └─ Typecheck: PASSED                                       │\n│  └─ Result: SUCCESS                                             │\n├─────────────────────────────────────────────────────────────────┤\n│  Feature complete! Approach saved to successes.json             │\n└─────────────────────────────────────────────────────────────────┘\n```\n\nOn failure:\n- Records approach to `failures.json` with root cause analysis\n- Analyzes errors and tries different approach\n- Consults `successes.json` for working patterns\n- Up to 10 attempts before escalation\n\n## Impact Analysis\n\nTrack how changes affect other components:\n\n```json\n// .claude-harness/impact/dependency-graph.json\n{\n  \"nodes\": {\n    \"src/lib/auth.ts\": {\n      \"imports\": [\"src/lib/api.ts\", \"src/types/user.ts\"],\n      \"importedBy\": [\"src/app/api/auth/login/route.ts\", \"src/components/LoginForm.tsx\"],\n      \"tests\": [\"tests/lib/auth.test.ts\"],\n      \"type\": \"module\"\n    }\n  },\n  \"hotspots\": [\"src/lib/api.ts\"],\n  \"criticalPaths\": [\"src/app/layout.tsx\"]\n}\n```\n\nWhen modifying files:\n- Identifies dependent files\n- Warns about high-impact changes\n- Suggests running related tests\n\n## Migration from v2.x\n\n```bash\n# In your project with existing harness\n./setup.sh --migrate\n\n# Creates backup: .claude-harness-backup-{timestamp}/\n# Migrates:\n#   feature-list.json → features/active.json\n#   agent-memory.json → memory/procedural/\n#   working-context.json → memory/working/context.json\n#   loop-state.json → loops/state.json\n```\n\nOr let it auto-migrate on first run of a harness command.\n\n## GitHub MCP Integration\n\n```bash\n# Setup\nclaude mcp add github -s user\n\n# Workflow (all in one command!)\n/claude-harness:flow \"Add dark mode\"      # Creates issue + branch, implements, commits, creates PR\n\n# Or step by step\n/claude-harness:flow --plan-only \"Add dark mode\"  # Create + plan only\n/claude-harness:flow feature-001                  # Resume and implement\n/claude-harness:checkpoint                        # Manual commit + PR if needed\n/claude-harness:merge                             # Merge all PRs, auto-version\n```\n\n## Configuration\n\n```json\n// .claude-harness/config.json\n{\n  \"version\": 3,\n  \"verification\": {\n    \"build\": \"npm run build\",\n    \"tests\": \"npm run test\",\n    \"lint\": \"npm run lint\",\n    \"typecheck\": \"npx tsc --noEmit\"\n  },\n  \"memory\": {\n    \"episodicMaxEntries\": 50,\n    \"contextCompilationEnabled\": true\n  },\n  \"failurePrevention\": {\n    \"enabled\": true,\n    \"similarityThreshold\": 0.7\n  },\n  \"impactAnalysis\": {\n    \"enabled\": true,\n    \"warnOnHighImpact\": true\n  },\n  \"testDriven\": {\n    \"enabled\": true,\n    \"generateTestsBeforeImplementation\": true\n  }\n}\n```\n\n## Troubleshooting\n\n### Stuck on Old Plugin Version\n\n`claude plugin update` has a known bug where it doesn't re-download plugin files. Run this one-liner to fix it:\n\n```bash\nbash <(curl -sf https://raw.githubusercontent.com/panayiotism/claude-harness/main/fix-plugin-cache.sh)\n```\n\nThis updates the marketplace cache, downloads the latest plugin, and updates the registry. Then restart Claude Code and run `/claude-harness:setup`.\n\n**Note:** v8.1.0+ includes auto-update — the session-start hook automatically fixes stale caches on startup.\n\n## Changelog\n\n### v8.1.0 (2026-02-15) - Auto-update stale plugin cache\n\n- session-start.sh auto-downloads latest plugin from GitHub when stale cache detected\n- Updates cache directory and `installed_plugins.json` registry automatically\n- Works around Claude Code `plugin update` bug (#19197, #14061, #13799, #15642)\n- Added `fix-plugin-cache.sh` curl-able script for users stuck on older versions\n\n### v8.0.0 (2026-02-15) - Remove Agent Teams\n\n- **BREAKING**: Remove Agent Teams: Direct implementation model replaces 3-specialist team orchestration. Removed SubagentStart, TeammateIdle, TaskCompleted hooks. 9→6 hook registrations. No longer requires CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS.\n\n### v7.0.0 (2026-02-14) - Restructure repo for marketplace compatibility\n\n- **BREAKING**: Moved plugin files (`commands/`, `hooks/`, `setup.sh`) into `claude-harness/` subdirectory\n- **Fixed**: Plugin install fails with \"not found in marketplace\" and GitHub self-reference causes infinite recursion\n- Root cause: Claude Code requires plugins in subdirectories within a marketplace repo. Having `marketplace.json` and `plugin.json` in the same `.claude-plugin/` at root is unsupported — every working marketplace (Anthropic, gmickel, cbrake, EveryInc) uses `source: \"./subdirectory\"`\n- Marketplace source now `\"./claude-harness\"` pointing to the plugin subdirectory\n- Existing users: run `claude plugin update claude-harness` to get the new structure\n\n### v6.0.6 (2026-02-14) - Fix installation instructions\n\n- **Fixed**: README Quick Start used invalid `github:owner/repo` syntax for `claude plugin install`\n- Root cause: There is no `github:` prefix in Claude Code's plugin install command. Plugins must be installed via the marketplace workflow (add marketplace first, then install from it)\n- Replaced incorrect \"Option B: Direct GitHub install\" with correct two-step marketplace commands\n- Added terminal CLI equivalent (`claude plugin marketplace add` / `claude plugin install`)\n\n### v6.0.5 (2026-02-14) - Remove stale cache detection\n\n- **Removed**: Custom stale cache detection system from `session-start.sh`\n  - Removed `version_lt()`, `check_latest_version()`, GitHub API/curl version fetch, 24h TTL cache\n  - Removed \"STALE CACHE\" user warning and \"STALE PLUGIN CACHE DETECTED\" AI context blocker\n- **Rationale**: No other Claude Code plugin implements custom update detection. Claude Code's native `claude plugin update` is sufficient.\n- **Kept**: Local plugin-vs-project version mismatch detection (`.plugin-version` comparison) for `/setup` migration prompts\n\n### v6.0.4 (2026-02-14) - Fix stale SessionEnd hook in settings.local.json\n\n- **Fixed**: `SessionEnd hook [session-end.sh] failed: not found` error on session exit\n- Root cause: `settings.local.json` retained a stale `SessionEnd` hook from pre-v6.0.0, but the hook script was removed during the v6.0.0 consolidation (12 → 6 hooks)\n- `setup.sh` skips existing `settings.local.json` files, so the stale entry was never cleaned up\n- Added cleanup step to `setup.sh` that strips `SessionEnd` from existing `settings.local.json` files\n\n### v6.0.3 (2026-02-14) - Fix false-positive stale cache warning\n\n- **Fixed**: Stale cache warning showing even after plugin update (installed version newer than cached \"latest\")\n- Root cause: version comparison used string `!=` instead of semver less-than — any version difference triggered the warning, including when installed > latest\n- Added `version_lt()` using `sort -V` for proper semver comparison\n- Auto-clears stale `.version-check` cache when installed version is already up-to-date\n\n### v6.0.0 (2026-02-14) - Official Plugin Alignment + Hook Consolidation\n\n**Major release**: Aligns plugin with official Claude Code plugin guidelines. Commands served from plugin cache, redundant hooks removed, setup.sh simplified.\n\n#### Plugin Alignment\n- Commands served from plugin cache (removed command-copying from `setup.sh`)\n- Deprecated `--force-commands` flag (use `claude plugin update` instead)\n- `setup.sh` now cleans up legacy command copies from target projects' `.claude/commands/`\n\n#### Hook Consolidation (12 → 6 registrations)\n- Removed `SessionEnd` hook (stale session cleanup already handled by SessionStart)\n- Removed `UserPromptSubmit` hook (active loop context already injected by SessionStart)\n- Removed `PostToolUse` hook (async test-on-edit duplicated verification gates)\n- Removed `PostToolUseFailure` hook (low-value failure recording; gates handled elsewhere)\n- Removed `SubagentStart` hook (no longer needed without team orchestration)\n- Removed `TeammateIdle` hook (no longer needed without team orchestration)\n- Removed `TaskCompleted` hook (no longer needed without team orchestration)\n- Removed dead `session-start-compact.sh` script (not registered in hooks.json)\n- Remaining hooks, 6 registrations: SessionStart, PreCompact, Stop, PreToolUse (Bash + Edit|Write), PermissionRequest\n\n#### Upgrade\n```bash\nclaude plugin update claude-harness\n/claude-harness:setup\n```\n\n---\n\n### v7.0.0 (2026-02-12) - Hook Compliance, Performance & Trim\n\n**Major release**: 7 hook compliance fixes, performance optimization, and context trimming across hooks and commands.\n\n#### Hook Compliance (feature-019)\n- **SessionStart**: Added `matcher: \"fresh\"` to prevent double-fire on compaction\n- **PreCompact**: Added `hookEventName` to hookSpecificOutput\n- **Stop**: Replaced plain text echo with structured output\n- **PreCompact**: Replaced emoji with text in user messages\n\n#### Context Trimming\n- **flow.md** (feature-020): 1434 → 514 lines (64% reduction). Deduplicated effort tables, loop-state schema, eliminated redundant ASCII boxes\n- **session-start.sh** (feature-021): 633 → 377 lines (40% reduction). Added reusable `build_box()` function, removed Opus 4.6 capabilities section, condensed workflow listing\n\n#### Metadata\n- All hook version headers updated to v7.0.0\n- Plugin version bumped to 7.0.0\n\n---\n\n### v6.5.1 (2026-02-10) - Performance Hotfix\n\n**CRITICAL FIX**: Resolves 40+ minute agent hang issue in v6.5.0\n\n#### Fixes\n- **Performance**: Add 10-second timeout wrappers to all `eval` commands in hooks\n  - Prevents indefinite blocking when test suites or verification commands take too long\n  - Hook timeouts in hooks.json were not enforced on the actual eval commands\n- **Performance**: Skip TDD validation for non-verification tasks\n  - Only verify/checkpoint/review/accept tasks run TDD validation gate\n  - Reduces redundant verification runs\n\n#### Impact\n- Hooks now complete in < 10 seconds (was 10+ minutes with slow test suites)\n- Eliminates 40+ minute hangs reported in v6.5.0\n\n#### Upgrade from v6.5.0\nThis is a critical hotfix. Users experiencing agent hangs should upgrade immediately:\n```bash\n/plugin update claude-harness\n```\n\n---\n\n> **v4.1.0 Release Notes**: See [RELEASES/v4.1.0.md](./RELEASES/v4.1.0.md) for full details on auto-issue creation and GitHub integration.\n> **v3.0.0 Release Notes**: See [RELEASE-NOTES-v3.0.0.md](./RELEASE-NOTES-v3.0.0.md) for full details with architecture diagrams.\n\n| Version | Changes |\n|---------|---------|\n| **8.0.0** | **Remove Agent Teams**: Direct implementation model replaces 3-specialist team orchestration. Removed SubagentStart, TeammateIdle, TaskCompleted hooks. 9→6 hook registrations. No longer requires CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS. |\n| **7.0.0** | **Restructure repo for marketplace compatibility**: Moved plugin files into `claude-harness/` subdirectory. Fixes \"not found in marketplace\" install error and infinite recursion from self-referencing GitHub source. Marketplace source now `\"./claude-harness\"`. |\n| **6.0.6** | **Fix installation instructions**: README Quick Start used invalid `github:owner/repo` syntax. Replaced with correct marketplace workflow (add marketplace → install plugin). Added terminal CLI equivalent. |\n| **6.0.5** | **Remove stale cache detection**: Removed custom GitHub version-check system from `session-start.sh` (66 lines). No other Claude Code plugin does this — `claude plugin update` is sufficient. Eliminates network calls on session start and false-positive warnings. |\n| **6.0.4** | **Fix stale SessionEnd hook in settings.local.json**: `SessionEnd hook [session-end.sh] failed: not found` on session exit. Stale hook entry in `settings.local.json` survived v6.0.0 consolidation because `setup.sh` skips existing files. Added cleanup step to strip stale `SessionEnd` from existing `settings.local.json`. |\n| **6.0.0** | **Official Plugin Alignment + Hook Consolidation**: Commands served from plugin cache (removed command-copying from setup.sh). Deprecated `--force-commands` flag. Removed redundant hooks. Consolidated from 12 → 6 hook registrations. setup.sh now cleans up legacy command copies from target projects. Update via `claude plugin update claude-harness`. |\n| **7.0.0** | **Hook Compliance, Performance & Trim**: Hook compliance fixes (SessionStart matcher, PreCompact hookEventName, stop structured output, emoji removal). Context trimming: flow.md 1434→514 lines (64%), session-start.sh 633→377 lines (40%). All hook version headers updated to v7.0.0. |\n| **6.5.0** | **Acceptance Testing Phase (TDD Step 4: ACCEPT)**: Added end-to-end acceptance testing as the 4th step in the TDD cycle (RED → GREEN → REFACTOR → **ACCEPT**). After unit tests pass and code is refactored, deterministic acceptance tests verify the feature works from a user/production perspective. New `verification.acceptance` config field for project-specific E2E test commands (auto-detected for Playwright/Cypress/test:e2e/test:acceptance). Loop-state schema bumped to v7. Works in both standard and autonomous modes. `setup.sh` auto-detects E2E frameworks. |\n| **6.4.1** | **Fix PreToolUse Blocking /flow State Writes**: The Edit/Write matcher in PreToolUse hook was blocking writes to `loop-state.json` and `active.json`, which `/flow` itself needs to write. Removed state file protection from the Edit/Write guard — the hook cannot distinguish between `/flow` managing its own state (legitimate) and random agent writes. Hooks self-modification prevention retained. |\n| **6.4.0** | **Full Hook Coverage**: Expanded hook registrations covering all major Claude Code hook types. **NEW hooks**: (1) `PreToolUse` with dual matchers — Bash matcher blocks dangerous git commands (`push --force`, `reset --hard`, `checkout main`, `branch -D`, `clean -f`) and state destruction (`rm -rf .claude-harness`); Edit/Write matcher blocks writes to harness-managed files. (2) `PermissionRequest` — in autonomous mode, auto-approves safe operations (read-only git, feature branch commits, configured test/build/lint commands, package installs) and auto-denies destructive operations; no-op in standard mode. (3) `SessionStart` with `compact` matcher — re-injects active feature, TDD phase, and recent failures after context compaction. |\n| **6.3.0** | **Interrupt Recovery**: Fixed agent getting stuck in infinite retry loop after user interrupt (Ctrl+C/Escape). The Stop hook does NOT fire on user interrupts, so interrupted sessions left `loop-state.json` in `\"in_progress\"` with stale references. On resume, the agent retried the same failing approach indefinitely. Fix adds 3-layer interrupt recovery: (1) `session-start.sh` detects stale sessions (dead PID) with active loops and writes a recovery marker. (2) `stop.sh` rewritten to also detect natural stops (output limits, premature stops) and write recovery markers. (3) `flow.md` resume behavior now checks for interrupt markers first, displays what was happening when interrupted, and offers 3 recovery options: FRESH APPROACH, RETRY SAME, or RESET. Autonomous mode auto-selects FRESH APPROACH. |\n| **6.2.1** | **Fix Delegation Mode Loss After Context Compaction**: During `--autonomous` sessions with many features, context compaction could erase delegation instructions, causing the agent to implement features directly instead of following the intended workflow. Fix persists delegation mode to `autonomous-state.json` (schema v2) and `loop-state.json`. Backward compatible with v1 autonomous-state files (auto-migrated on resume). |\n| **6.2.0** | **PRD Breakdown Analysis Migration**: Migrated `/prd-breakdown` command analysis to use parallel analysis perspectives (product, architecture, QA). Renamed `subagent-prompts.json` → `analyst-prompts.json`. |\n| **6.1.0** | **Stale Plugin Cache Detection & Self-Healing**: `session-start.sh` now checks GitHub for the latest version (24h TTL cache) and shows a prominent warning if the plugin cache is outdated. New `fix-stale-cache.sh` bootstrap script downloads the latest version, replaces the stale cache, and updates `installed_plugins.json`. Fixes the self-referential version detection loop where both the cached plugin and project `.plugin-version` show the same stale version. |\n| **6.0.1** | **v6 Upgrade Cleanup**: `setup.sh` now auto-cleans v5.x artifacts on upgrade — removes `worktrees/` directory, `agents/handoffs.json`, stale `worktree.md` command, and `pendingHandoffs` from context.json. Removed handoffs.json creation and all `pendingHandoffs` references from commands. |\n| **5.2.0** | **Consolidated Workflow + Enforced TDD**: Merged /do, /do-tdd, and /orchestrate into unified /flow command with flags (--plan-only). TDD enforcement (Research → Implement → Review) is now part of every flow run. Auto-detects feature complexity (simple/standard/complex). Command count reduced from 8 to 5. |\n| **5.1.4** | **Fix Autonomous Archive**: Passing features were not being archived during autonomous mode. Phase A.4.6 (Auto-Merge) updated status to \"passing\" but never moved the feature from `active.json` to `archive.json`. Added explicit archive step (new step 29) in Phase A.5 (Post-Feature Cleanup) that moves completed features to archive after merge. The normal flow Phase 6 already had this logic — autonomous mode was missing it. |\n| **5.1.3** | **Dynamic Command Sync**: Replaced 5 hardcoded simplified command stubs in `setup.sh` with a dynamic copy loop that copies ALL `.md` files from the plugin's `commands/` directory. Previously 5 commands (flow, do-tdd, prd-breakdown, worktree, setup) were completely missing from target projects, and the 5 existing stubs were outdated simplified versions. Now all commands are auto-discovered, always full-version, and automatically synced on version upgrade. |\n| **5.1.2** | **Fix Setup Auto-Update (v2)**: Session-start hook no longer writes `.plugin-version` on version mismatch — only `setup.sh` updates it now. This ensures `setup.sh` can detect the version gap and auto-force command file updates. Also tagged `hooks/session-end.sh` and `.claude-harness/init.sh` as updatable on version upgrade. |\n| **5.1.1** | **Fix Setup Auto-Update**: `setup.sh` now auto-detects version upgrades by comparing installed `.plugin-version` against `plugin.json`. When a version change is detected, command files are automatically updated (equivalent to `--force-commands`) without requiring the flag. Fixes issue where running setup on existing projects only bumped the version file but skipped command updates. |\n| **5.1.0** | **Autonomous Multi-Feature Processing**: New `--autonomous` flag on `/flow` command enables unattended batch processing of the entire feature backlog. Iterates through all active features with strict TDD enforcement (Red-Green-Refactor), automatic checkpoint (commit, push, PR), merge to main, context reset, and loop back. Git rebase conflict detection auto-skips conflicting features. Configurable termination: max iterations (20), consecutive failure threshold (3), or all features complete. Autonomous state persisted to `autonomous-state.json` for crash recovery and resume. Compatible with `--no-merge` (stop at checkpoint) and `--quick` (skip planning). Forces `--inline` mode. TDD-specific task chain (7 tasks) with visual progress tracking. |\n| **5.0.0** | **Opus 4.6 Optimizations**: Effort controls per workflow phase (low for mechanical operations, max for planning/debugging) across `/flow`. 128K output token utilization for richer PRD analysis (exhaustive output, PRD size limit increased to 100KB). Increased maxAttempts from 10 to 15 for better agentic loop sustaining. Adaptive loop strategy with progressive effort escalation on retries. Native context compaction awareness in PreCompact hook. Session banner now displays Opus 4.6 capabilities. All changes backward compatible with pre-Opus 4.6 models. |\n| **4.5.1** | **Fix Version Tracking & Stale State Detection**: Removed hardcoded version from `setup.md` — now reads dynamically from `plugin.json`. Fixed `setup.sh` to use `$PLUGIN_VERSION` variable everywhere instead of hardcoded strings. Added active.json validation to prevent stale loop-state from falsely reporting archived features as active. Cleaned up stale legacy `loops/state.json`. |\n| **4.5.0** | **Native Claude Code Tasks Integration**: Features now create a 5-task chain using Claude Code's native Tasks system (TaskCreate, TaskUpdate, TaskList). Tasks provide visual progress tracking (`[x] Research [x] Plan [→] Implement [ ] Verify [ ] Checkpoint`), persist across sessions, and have built-in dependency management. Loop-state schema updated to v4 with task references. Backward compatible with v3 loop-state. Graceful fallback if TaskCreate fails. |\n| **4.4.2** | **Fix Stop Hook Command-Type**: Converted Stop hook from prompt-type (unreliable JSON validation) to command-type shell script for reliable completion detection. |\n| **4.4.1** | **Fix Stop Hook Schema**: Fixed prompt-based Stop hook schema validation error. The hook response must include `ok` boolean field for Claude Code to process it correctly. |\n| **4.4.0** | **Automated End-to-End Flow**: New `/claude-harness:flow` command combines start→do→checkpoint→merge into single automated workflow. Added prompt-based `Stop` hook (Haiku LLM) for intelligent completion detection. Added `UserPromptSubmit` hook for smart routing to active loops. GitHub repo now cached in SessionStart hook (eliminates 4 redundant parses). Memory layers read in parallel for 30-40% faster startup. Streaming memory updates after each verification attempt. Commands updated to use cached GitHub repo. |\n| **4.3.0** | **Enforce GitHub Issue Creation**: Made GitHub issue creation MANDATORY (not optional) for all features and fixes. Added explicit issue body templates with required sections (Problem, Solution, Acceptance Criteria, Verification). Added \"MANDATORY REQUIREMENTS\" section at top of `/do` command. Issues now MUST be created before any code work - failure blocks progression. Fixes context loss when issues were sometimes skipped. |\n| **4.2.3** | **Remove Legacy State Files**: Removed creation of unused legacy files (`loop-state.json`, `working-context.json`, `loops/state.json`, `memory/working/`). All workflow state is now session-scoped under `sessions/{session-id}/`. Updated setup.md and start.md to reflect current architecture. Cleaned up .gitignore patterns. |\n| **4.2.2** | **Fix Session Cleanup on WSL**: Moved stale session cleanup from SessionEnd hook to SessionStart hook for reliability. SessionEnd may not trigger on `/clear` or crashes, so cleanup now happens proactively when a new session starts. Removed `jq` dependency from both hooks (uses grep/sed instead). Fixes fix-feature-013-001. |\n| **4.2.1** | **Removed Obsolete File References**: Cleaned up all references to legacy `feature-list.json` and `feature-archive.json` files. Fresh setups now only create `features/active.json` and `features/archive.json`. Updated migration instructions to properly move old files to new locations. |\n| **4.2.0** | **Simplified /merge Command**: Removed version tagging and GitHub release creation from `/merge` command since git tag operations are not directly supported by GitHub MCP. The command now focuses on merging PRs, closing issues, and cleaning up branches. Version tagging should be done manually using git commands or GitHub's release UI. |\n| **4.1.0** | **Auto-Create GitHub Issues from PRD**: New `--create-issues` flag on `/prd-breakdown` command automatically creates one GitHub issue per generated feature. Designed for explicit opt-in (not automatic) with full automation once flag is used. Issues include feature description, acceptance criteria, and priority metadata. Labeled with `feature` and `prd-generated` tags. Gracefully degrades if GitHub MCP unavailable. Enables teams to go from PRD → features → tracked backlog in one command. See [RELEASES/v4.1.0.md](./RELEASES/v4.1.0.md). |\n| **4.0.0** | **PRD Analysis & Decomposition**: New `/claude-harness:prd-breakdown` command analyzes Product Requirements Documents using 3 parallel analysis perspectives (Product, Architecture, QA). Automatically decomposes PRDs into atomic features with dependencies, priorities, and acceptance criteria. Supports inline PRD, file-based, GitHub issues, or interactive input. Essential for bootstrapping feature lists in new projects. Version bumped across all files (setup.sh, plugin.json, hooks, README). See [RELEASES/v4.0.0.md](./RELEASES/v4.0.0.md). |\n| **3.9.6** | **Remote Branch Cleanup in Merge**: `/merge` command now explicitly deletes remote branches after PR merge using `git push origin --delete {branch}`. Phase 4 clarified to include both remote and local deletion, Phase 7 adds verification step, Phase 8 reports both local and remote deletions. |\n| **3.9.2** | **Fix Multi-Select in Interactive Menu**: Made `multiSelect: true` requirement more explicit in `/do` Phase 0 documentation. Added CRITICAL marker and \"DO NOT use multiSelect: false\" warning to ensure parallel feature selection works correctly. |\n| **3.9.1** | **Interactive Feature Selection**: Running `/do` without arguments now shows an interactive menu of pending features with multi-select checkboxes. Select one to resume, select multiple to create worktrees for parallel development, or choose \"Other\" to create a new feature. |\n| **3.9.0** | **Git Worktree Support**: True parallel development with isolated working directories. `/do` now auto-creates worktrees by default (use `--inline` to skip). New `/worktree` command for managing worktrees (list, create, remove, prune). All commands are worktree-aware, reading shared state (features, memory) from main repo while keeping session state local. Industry-standard approach used by incident.io and others. |\n| **3.8.6** | **Fix SessionEnd Hook for Plugin Installations**: SessionEnd hook now uses `hooks/hooks.json` (plugin configuration) instead of `.claude/settings.json` (project configuration). This ensures automatic session cleanup works in all projects where the plugin is installed, not just the plugin's own repo. |\n| **3.8.5** | **Automatic Session Cleanup**: Added `SessionEnd` hook that automatically cleans up inactive session directories when Claude exits. Uses PID-based detection to preserve active parallel sessions while removing stale ones. Prevents disk bloat from accumulated sessions. |\n| **3.8.4** | **Enforce Gitignore in /setup**: Made Phase 3 (gitignore update) MANDATORY with explicit instructions. Marked as CRITICAL with \"DO NOT SKIP\" to ensure ephemeral patterns are always added. |\n| **3.8.3** | **Add Gitignore to /setup Command**: The `/claude-harness:setup` command now includes Phase 3 to update project `.gitignore` with harness ephemeral patterns (sessions/, compaction-backups/, working/). |\n| **3.8.2** | **Fix setup.sh Syntax Error**: Fixed heredoc quoting issue that prevented `setup.sh` from running. The init.sh content now uses proper quoted heredoc (`<<'EOF'`) to preserve special characters. |\n| **3.8.1** | **Fix Uncommitted Harness Files**: `setup.sh` now automatically adds gitignore patterns to target projects. Prevents ephemeral files (sessions/, compaction-backups/, working/) from appearing as uncommitted after checkpoint. |\n| **3.8.0** | **Parallel Work Streams**: Session-scoped state enables multiple Claude instances to work on different features simultaneously without conflicts. Each session gets unique ID and isolated state directory (`.claude-harness/sessions/{id}/`). Sessions are gitignored, shared state (features, memory) remains committed. |\n| **3.7.1** | **Fix Missing Learned Rules**: Fixed error when reading `.claude-harness/memory/learned/rules.json` on installations from pre-v3.6. `/start` Phase 0 now creates the file if missing. |\n| **3.7.0** | **TDD Enforcement Command**: New `/claude-harness:do-tdd` command for test-driven development. Enforces RED-GREEN-REFACTOR workflow, blocks implementation until tests exist. Keeps `/do` unchanged for backward compatibility. |\n| **3.6.7** | **Fix GitHub Repo Detection**: Added explicit `git remote get-url origin` parsing instructions to all commands that use GitHub MCP. Prevents Claude from guessing or caching wrong owner/repo values from previous sessions. |\n| **3.6.6** | **Full Command Prefixes**: All command references now use full `/claude-harness:` prefix for clarity and to avoid conflicts with other plugins. |\n| **3.6.5** | **Context Management**: Added `/clear` recommendation after checkpoint to prevent context rot. Added PreCompact hook as safety net to backup state before automatic compaction. |\n| **3.6.4** | **Fix Argument Hints**: Use correct `argument-hint` field (with hyphen) instead of `argumentsPrompt`. Now displays input suggestions like ralph-loop. |\n| **3.6.3** | **Improved Argument Hints**: Updated command hints to use CLI-style bracket notation (e.g., `\"DESC\" \\| ID [--quick] [--auto]`) for better scannability. Added hints to `/checkpoint`. |\n| **3.6.2** | **Branch Safety**: Fixed `/do` to enforce GitHub issue and branch creation BEFORE any code work. Added branch verification safety check that stops if on main/master. Explicit step-by-step instructions with \"DO NOT PROCEED\" markers. |\n| **3.6.1** | **Hooks Fix**: Removed duplicate `hooks` reference from plugin.json - `hooks/hooks.json` is auto-loaded by convention. |\n| **3.6.0** | **Command Consolidation**: Reduced from 13 to 6 commands. `/do` now handles fixes via `--fix` flag. Removed redundant commands (`/feature`, `/plan-feature`, `/implement`, `/fix`, `/reflect`, `/generate-tests`, `/check-approach`). Renamed `/merge-all` to `/merge`. Auto-reflect always enabled at checkpoint. |\n| **3.5.0** | **Unified Workflow**: `/do` command - chains feature creation, planning, implementation, and checkpoint in one command with interactive prompts. Options: `--quick` (skip planning), `--auto` (no prompts), `--plan-only`. Resumable with `/do resume` or `/do feature-XXX` |\n| **3.4.0** | **Safe Permissions**: Comprehensive permission configuration to avoid `--dangerously-skip-permissions` - deny list for dangerous commands, ask list for destructive ops, allow list for safe harness operations |\n| **3.3.2** | **Chore**: Fixed legacy file path references in command docs - all commands now reference correct v3.0+ paths (`agents/context.json`, `memory/procedural/`, `loops/state.json`) |\n| **3.3.1** | **Bug Fix**: Fixed inconsistent file path references - all commands now consistently use `features/active.json` instead of legacy `feature-list.json` |\n| **3.3.0** | **Self-Improving Skills**: `/reflect` command - Extract rules from user corrections, auto-reflect at checkpoint, display learned rules at session start |\n| **3.2.0** | **Memory System Utilization**: Commands now actually use the 4-layer memory system - `/start` compiles context, `/implement` queries failures before attempting, `/checkpoint` persists to memory |\n| **3.1.0** | **Bug Fix Command**: `/fix` - Create bug fixes linked to original features with shared memory context, GitHub issue linkage, and PATCH versioning |\n| **3.0.0** | **Memory Architecture Release** - See release notes above |\n| 2.6.0 | Agentic Loops: `/implement` runs until verification passes |\n| 2.5.1 | Full command paths in session output |\n| 2.5.0 | Box-drawn UI in session start |\n| 2.4.0 | Fixed hooks loading |\n| 2.3.0 | SessionStart hook, auto-setup detection |\n| 2.2.0 | Moved files to `.claude-harness/` |\n| 2.1.0 | Added `working-context.json` |\n| 2.0.0 | Shortened command names |\n| 1.1.0 | Multi-agent orchestration |\n| 1.0.0 | Initial release |\n\n## Safe Permissions (Avoiding --dangerously-skip-permissions)\n\nThe harness includes a comprehensive permission configuration that allows Claude Code to run without the dangerous `--dangerously-skip-permissions` flag while maintaining full functionality.\n\n### Configuration Location\n\n```\n.claude/settings.local.json    # Personal settings (gitignored)\n.claude/settings.json          # Team-shared settings (committed)\n```\n\n### Permission Model\n\n| Category | Behavior | Examples |\n|----------|----------|----------|\n| **Allow** | Auto-approved | `git add`, `npm run`, `ls`, `cat` |\n| **Ask** | Prompts user | `rm`, `git push`, `npm install` |\n| **Deny** | Always blocked | `curl`, `sudo`, `rm -rf /` |\n\n### Safe Operations (Auto-Allowed)\n\n```json\n{\n  \"allow\": [\n    \"Bash(git status:*)\", \"Bash(git add:*)\", \"Bash(git commit:*)\",\n    \"Bash(git checkout:*)\", \"Bash(git branch:*)\", \"Bash(git log:*)\",\n    \"Bash(npm run:*)\", \"Bash(npx tsc:*)\", \"Bash(npx jest:*)\",\n    \"Bash(mkdir:*)\", \"Bash(ls:*)\", \"Bash(cat:*)\", \"Bash(grep:*)\",\n    \"Bash(./hooks/*)\", \"Bash(./.claude-harness/*)\"\n  ]\n}\n```\n\n### User Confirmation Required\n\n```json\n{\n  \"ask\": [\n    \"Bash(rm:*)\",           // All file deletion\n    \"Bash(rmdir:*)\",        // All directory deletion\n    \"Bash(git push:*)\",     // Remote operations\n    \"Bash(git reset:*)\",    // Destructive git\n    \"Bash(npm install:*)\",  // Package installation\n    \"Bash(chmod:*)\"         // Permission changes\n  ]\n}\n```\n\n### Dangerous Operations (Always Blocked)\n\n```json\n{\n  \"deny\": [\n    // Network (data exfiltration risk)\n    \"Bash(curl:*)\", \"Bash(wget:*)\", \"Bash(nc:*)\", \"Bash(ssh:*)\",\n\n    // Privilege escalation\n    \"Bash(sudo:*)\", \"Bash(su:*)\", \"Bash(doas:*)\",\n\n    // Destructive filesystem operations\n    \"Bash(rm -rf /)\", \"Bash(rm -rf ~)\", \"Bash(rm -rf /home:*)\",\n    \"Bash(rm -rf /etc:*)\", \"Bash(rm -rf /usr:*)\", \"Bash(rm -rf /var:*)\",\n\n    // Low-level system operations\n    \"Bash(dd:*)\", \"Bash(mkfs:*)\", \"Bash(fdisk:*)\",\n    \"Bash(systemctl:*)\", \"Bash(shutdown:*)\", \"Bash(reboot:*)\",\n\n    // User/group management\n    \"Bash(useradd:*)\", \"Bash(userdel:*)\", \"Bash(passwd:*)\",\n\n    // Code execution (potential RCE)\n    \"Bash(python -c:*)\", \"Bash(node -e:*)\", \"Bash(eval:*)\",\n\n    // Secrets protection\n    \"Read(.env)\", \"Read(.env.*)\", \"Read(**/credentials*)\", \"Read(**/*.pem)\"\n  ]\n}\n```\n\n### How Precedence Works\n\n1. **Deny rules checked first** - If matched, command is blocked\n2. **Ask rules checked second** - If matched, user is prompted\n3. **Allow rules checked last** - If matched, command runs\n\nThis means dangerous patterns like `rm -rf /home/*` are blocked even though `rm:*` is in the ask list.\n\n### Using the Configuration\n\n```bash\n# Run Claude Code normally (no dangerous flag needed)\ncd your-project\nclaude\n\n# The harness commands work with auto-approved safe operations\n/claude-harness:start       # Uses git status, cat, grep\n/claude-harness:checkpoint  # Uses git add, commit (push prompts)\n/claude-harness:flow        # Uses npm run, npx tsc\n```\n\n### Extending for Your Project\n\nAdd project-specific safe commands to `.claude/settings.json`:\n\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Bash(docker compose up:*)\",\n      \"Bash(make build:*)\",\n      \"Bash(cargo test:*)\"\n    ]\n  }\n}\n```\n\n## Key Principles\n\n1. **Never Trust Self-Assessment** - All verification is mandatory via commands\n2. **Learn From Mistakes** - Failure prevention system records and warns\n3. **Test First** - Generate tests before implementation\n4. **Computed Context** - Fresh, relevant context each session (no accumulation)\n5. **Memory Persistence** - Knowledge survives context windows\n6. **Single Feature Focus** - One feature at a time prevents scope creep\n\n## Sources\n\n- [Anthropic: Effective Harnesses for Long-Running Agents](https://www.anthropic.com/engineering/effective-harnesses-for-long-running-agents)\n- [Context-Engine](https://github.com/zeddy89/Context-Engine) - Memory architecture inspiration\n- [Agent-Foreman](https://github.com/mylukin/agent-foreman) - Task management patterns\n- [Autonomous-Coding](https://github.com/anthropics/claude-quickstarts/tree/main/autonomous-coding) - Test-driven approach\n"
      },
      "plugins": [
        {
          "name": "claude-harness",
          "source": "./claude-harness",
          "description": "Long-running agent harness with 5-layer memory, test-driven features, GitHub integration, and autonomous batch processing",
          "category": "development",
          "homepage": "https://github.com/panayiotism/claude-harness",
          "categories": [
            "development"
          ],
          "install_commands": [
            "/plugin marketplace add panayiotism/claude-harness",
            "/plugin install claude-harness@claude-harness"
          ]
        }
      ]
    }
  ]
}