{
  "author": {
    "id": "dherman",
    "display_name": "Dave Herman",
    "avatar_url": "https://avatars.githubusercontent.com/u/307871?u=b660aacb665f9522f41b5cb255638ae3180c9830&v=4"
  },
  "marketplaces": [
    {
      "name": "dherman",
      "version": null,
      "description": "Rewrite git commit sequences to create clean, readable branches",
      "repo_full_name": "dherman/claude-plugins",
      "repo_url": "https://github.com/dherman/claude-plugins",
      "repo_description": "A Claude Code plugin that automates the process of rewriting git commit sequences to create clean, readable branches optimized for code review.",
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2025-10-27T22:11:32Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"dherman\",\n  \"owner\": {\n    \"name\": \"David Herman\",\n    \"email\": \"david.herman@gmail.com\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"historian\",\n      \"source\": \"./plugins/historian\",\n      \"description\": \"Rewrite git commit sequences to create clean, readable branches\",\n      \"version\": \"0.6.13\",\n      \"author\": {\n        \"name\": \"David Herman\"\n      }\n    },\n    {\n      \"name\": \"poet\",\n      \"source\": \"./plugins/poet\",\n      \"description\": \"Experimental plugin to test agent user interaction\",\n      \"version\": \"0.1.0\",\n      \"author\": {\n        \"name\": \"David Herman\"\n      }\n    }\n  ]\n}\n",
        "README.md": "# My Claude Code Plugin Marketplace\n\nThis is my personal marketplace of Claude Code plugins.\n\n## Available Plugins\n\n### [Historian](plugins/historian/)\n\nRewrite git commit sequences to create clean, readable branches optimized for code review.\n\nTakes messy commit history (WIP commits, fixes, typos) and rewrites it into logical, well-documented commits that tell a clear story.\n\n[View Plugin Documentation →](plugins/historian/README.md)\n\n## Installation\n\n### Adding This Marketplace\n\nTo add this marketplace to Claude Code:\n\n```bash\n/plugin marketplace add https://github.com/dherman/claude-plugins\n```\n\n### Installing Plugins\n\nOnce the marketplace is added, install plugins with:\n\n```bash\n/plugin install historian@dherman\n```\n\nOr browse available plugins:\n\n```bash\n/plugin marketplace\n```\n\n## License\n\nSee individual plugin directories for licensing information.\n",
        "plugins/historian/README.md": "# Historian - Claude Code Plugin\n\nA Claude Code plugin that automates the process of rewriting git commit sequences to create clean, readable branches optimized for code review.\n\n## Overview\n\nWhen working on features or bug fixes, commit history often becomes messy with \"WIP\", \"fix typo\", \"oops\", and other non-descriptive commits. This plugin helps you take that messy history and rewrite it into a logical, well-documented sequence that tells a clear story.\n\n## What It Does\n\nThe plugin takes your current branch (with messy commits) and creates a new \"clean\" branch with the same final code changes, but organized into logical commits that:\n\n- Tell a clear story explaining the feature in layers\n- Are appropriately sized for code review\n- Have descriptive commit messages\n- Follow a logical progression\n\n## Architecture\n\nThe plugin uses **three parallel long-running agents** with **direct user interaction** and **sidechat MCP** for agent coordination. Simple and elegant!\n\n### Components\n\n#### 1. Slash Command: `/narrate`\n\nA lightweight wrapper that invokes the \"Rewriting Git Commits\" skill.\n\n**Usage:**\n```bash\n/narrate Add user authentication with OAuth support\n```\n\n**Location:** `commands/narrate.md`\n\n#### 2. Skill: Rewriting Git Commits\n\nSimple coordinator that:\n- Establishes a unique session ID for agent communication\n- Creates a work directory in `/tmp/historian-{timestamp}/`\n- Launches analyst, narrator, and scribe agents **once** in parallel\n- Waits for all to complete\n- Reports final results\n\n**Location:** `skills/rewriting-git-commits/SKILL.md`\n\n#### 3. Agent: `analyst` (purple)\n\nAnalyzes the changeset and prepares the commit plan:\n\n1. **Validates** - Ensures git working tree is clean\n2. **Prepares** - Creates clean branch and master diff\n3. **Determines Build** - Detects project type and build command (cargo check, tsc --noEmit, etc.)\n4. **Analyzes** - Reads diff and creates commit plan\n5. **Asks User** - Uses **AskUserQuestion** to get approval for plan\n6. **Coordinates** - Sends commit_plan to narrator and build_config to scribe via sidechat\n7. **Exits** - Writes \"done\" status and terminates\n\n**Location:** `agents/analyst.md`\n\n#### 4. Agent: `narrator` (cyan)\n\nOrchestrator that executes the commit plan:\n\n1. **Waits** - Blocks until analyst sends commit_plan\n2. **Executes** - Sends commit requests to scribe via sidechat, waits for responses\n3. **Validates** - Compares final branch tree to original branch\n4. **Fixes** - Amends last commit if trees don't match\n5. **Completes** - Writes \"done\" status\n\n**Location:** `agents/narrator.md`\n\n#### 5. Agent: `scribe` (orange)\n\nWorker that creates commits and validates builds:\n\n1. **Waits for Config** - Blocks until analyst sends build_config\n2. **Receives** - Blocks on `receive_message` waiting for commit requests from narrator\n3. **Processes** - Reads master diff and creates commit\n4. **Validates Build** - Runs build command, auto-fixes failures up to 3 times\n5. **Responds** - Sends result back to narrator via sidechat\n6. **Repeats** - Continues until narrator writes \"done\" status\n\n**Location:** `agents/scribe.md`\n\n#### 6. MCP Server: Sidechat\n\nSession-based message passing system for agent coordination:\n\n- Provides `send_message` and `receive_message` tools\n- Handles message queuing and delivery (FIFO)\n- Agents communicate through named sessions\n- Messages stored in `/tmp/sidechat-{instance-id}/`\n\n**Location:** `servers/sidechat-mcp/`\n\n### Work Directory Structure\n\nThe work directory in `/tmp/historian-{timestamp}/` contains:\n\n```\n/tmp/historian-{timestamp}/\n  ├── transcript.log              # Shared log\n  ├── master.diff                 # All changes\n  ├── state.json                  # Final results\n  └── narrator/\n      └── status                  # \"done\" | \"error\"\n```\n\nAgent communication happens via sidechat MCP, not files. Messages are stored separately in `/tmp/sidechat-{instance-id}/`.\n\n## How It Works\n\n### Single Execution Cycle\n\nThe skill launches all three agents once and waits for completion:\n\n**Setup:**\n1. **Skill:** Establishes session ID `historian-20251024-140530`\n2. **Skill:** Creates work directory `/tmp/historian-20251024-140530/`\n3. **Skill:** Launches analyst + narrator + scribe in parallel with session ID\n\n**All three agents start running simultaneously:**\n\n**Analyst (runs once, exits):**\n4. Validates git repository\n5. Creates clean branch and master diff\n6. Determines build command (cargo check, tsc --noEmit, etc.)\n7. Analyzes changes and creates commit plan\n8. **Asks you directly** \"Approve this commit plan?\" using AskUserQuestion\n9. You respond \"Proceed\"\n10. Sends commit_plan to narrator via sidechat\n11. Sends build_config to scribe via sidechat\n12. Writes \"done\" status and exits\n\n**Narrator (long-running):**\n4. Waits for commit_plan from analyst (`receive_message` blocks)\n5. Receives commit plan with list of commits\n6. Sends commit request #1 to scribe via sidechat (`send_message`)\n7. Waits for scribe's response (`receive_message`)\n8. Receives success response, sends request #2\n9. Repeats for all commits in the plan\n10. Validates final branch tree matches original branch tree\n11. Amends last commit if trees don't match (fixes missing changes)\n12. Writes \"done\" status and exits\n\n**Scribe (long-running):**\n4. Waits for build_config from analyst (`receive_message` blocks)\n5. Receives build command (or null)\n6. Waits for commit request from narrator (`receive_message` blocks)\n7. Receives request #1, creates commit\n8. Validates build: runs build command, auto-fixes failures, retries up to 3 times\n9. Sends success response to narrator via sidechat\n10. Waits for request #2 (`receive_message` blocks)\n11. Repeats until narrator writes \"done\" status\n12. Exits\n\n**Completion:**\n13. **Skill:** All agents finished, reads final state\n14. **Skill:** Reports results to you\n\n### Advantages of This Architecture\n\n1. **Simple** - Single launch, single execution\n2. **Direct User Interaction** - Agents use AskUserQuestion mid-execution\n3. **Easy to Understand** - Three agents with clear responsibilities\n4. **Clean Communication** - Sidechat MCP handles message passing\n5. **Easy Debugging** - View transcript log and message files\n6. **Reusable** - Sidechat MCP can be used in other plugins\n7. **Build Validation** - Catches missing changes automatically\n8. **Self-Healing** - Both scribe (build fixes) and narrator (tree fixes) can repair issues\n\n### Example: Build Validation\n\nThe scribe validates builds after each commit and auto-fixes failures:\n\n**Scenario:** Commit #2 \"Implement OAuth token validation\" fails to build because it's missing some imports that are part of a later commit.\n\n**What happens:**\n1. Scribe creates the commit\n2. Runs `cargo check` (the build command)\n3. Build fails with \"cannot find module `oauth_helpers`\"\n4. Scribe analyzes error, finds the missing module in master.diff\n5. Applies the missing changes\n6. Amends the commit\n7. Retries build → passes\n8. Sends success response to narrator\n\nIf after 3 attempts the build still fails, scribe **asks you directly** for help.\n\n### Example: Handling Large Commits\n\nIf the scribe detects a commit is too large, it **asks you directly**:\n\n```\nThis commit \"Add authentication\" is quite large (23 files, 1200 lines).\n\nHow would you like to split it?\n\n1. Split by layer (backend/frontend/tests)\n2. Split by feature area\n3. Keep as one commit\n```\n\nYou respond, scribe creates multiple commits accordingly, then continues.\n\n## Installation\n\nThis plugin can be installed from GitHub. See [INSTALL.md](INSTALL.md) for detailed instructions.\n\nQuick start:\n\n```bash\n/plugin marketplace add https://github.com/dherman/claude-plugins\n/plugin install historian@dherman\n```\n\n### Plugin Structure\n\nThe plugin contains:\n\n```\nhistorian/\n├── .claude-plugin/\n│   └── plugin.json                    # Plugin manifest (includes MCP server config)\n├── commands/\n│   └── narrate.md                     # Slash command wrapper\n├── skills/\n│   └── rewriting-git-commits/\n│       └── SKILL.md                   # Coordinator skill\n├── agents/\n│   ├── analyst.md                     # Analyzer and planner (purple)\n│   ├── narrator.md                    # Orchestrator (cyan)\n│   └── scribe.md                      # Commit creator (orange)\n├── servers/\n│   └── sidechat-mcp/                  # Message passing MCP server\n│       ├── src/\n│       │   └── index.ts               # TypeScript implementation\n│       ├── dist/                      # Compiled JavaScript\n│       ├── package.json\n│       ├── tsconfig.json\n│       └── README.md\n└── settings.json                       # Recommended permissions\n```\n\n## Usage Examples\n\n### Example 1: Feature Branch\n\n**Before:**\n```\n* feat: wip\n* fix: oops forgot file\n* feat: add more stuff\n* fix: typo\n* feat: initial implementation\n```\n\n**Command:**\n```bash\n/narrate Add user profile feature with avatar uploads\n```\n\n**After:**\n```\n* feat: add user profile data model\n* feat: implement profile CRUD API\n* feat: add avatar upload with S3 integration\n* feat: create profile UI components\n* test: add profile feature test coverage\n```\n\n### Example 2: Refactoring\n\n**Before:**\n```\n* refactor: move stuff around\n* fix: broken tests\n* refactor: more changes\n* fix: lint errors\n```\n\n**Command:**\n```bash\n/narrate Extract user validation logic into separate module\n```\n\n**After:**\n```\n* refactor: create user validation module\n* refactor: migrate validators to new module\n* refactor: update imports and dependencies\n* test: add validation module tests\n```\n\n\n## Design Philosophy\n\n### Atomic Commits\n\nEach commit should:\n- Do one thing well\n- Leave code in a working state\n- Be independently reviewable\n- Have a clear purpose\n\n### Story-Driven\n\nCommits should tell a story:\n- Foundation/infrastructure first\n- Core functionality next\n- Polish and refinements last\n- Logical dependencies respected\n\n### Review-Optimized\n\nCommits are sized for human review:\n- Small: < 5 files, < 150 lines\n- Medium: 5-15 files, 150-500 lines\n- Large: Needs splitting (triggers agent question)\n\n## Configuration\n\n### Commit Message Format\n\nThe scribe agent uses conventional commits format:\n\n```\n<type>: <short summary>\n\n<detailed explanation>\n```\n\n**Types:** feat, fix, refactor, docs, test, chore, perf, style\n\n### Agent Behavior\n\nThe scribe agent is configured to:\n- Ask questions when commits exceed 15 files or 500 lines\n- Use Read, Write, Edit, Bash, Grep, and Glob tools\n- Run on the Sonnet model for balance of capability and speed\n\n## Troubleshooting\n\n### \"Working tree is not clean\"\n\nCommit or stash your changes before running the rewriter:\n```bash\ngit stash\n/narrate Your changeset description\ngit stash pop  # After rewriting\n```\n\n### \"Cannot find base commit\"\n\nEnsure your branch has a clear merge-base with main/master:\n```bash\ngit merge-base HEAD origin/main  # Should return a commit hash\n```\n\n### \"Clean branch differs from original\"\n\nThis shouldn't happen, but if it does:\n1. Check the git diff output provided\n2. Review the commit sequence\n3. Consider re-running or manual fixes\n\n## Development\n\n### Testing\n\nTo test the plugin, you can:\n\n1. Create a test repository with messy commits\n2. Invoke the rewriter\n3. Verify the clean branch matches original\n4. Review commit quality\n\n### Extending\n\nYou can extend the plugin by:\n\n- Customizing the scribe agent prompt\n- Adjusting size thresholds for large commits\n- Adding additional validation steps\n- Customizing commit message format\n\n## License\n\nMIT\n\n## Contributing\n\nTo improve this plugin:\n\n1. Modify the files in `.claude/`\n2. Test with real-world scenarios\n3. Share improvements with the community\n",
        "plugins/poet/README.md": "# Poet - Experimental Plugin\n\nA simple experimental plugin to test whether Claude Code agents can directly use the AskUserQuestion tool.\n\n## Purpose\n\nThis plugin tests if:\n- An agent launched via Task can use AskUserQuestion\n- User responses are properly passed back to the agent\n- The agent can continue execution after receiving the response\n\n## Usage\n\n```\n/poem\n```\n\nThe agent will:\n1. Ask for your name\n2. Write a personalized poem\n3. Show you the result\n\n## What We're Testing\n\nIf this works directly without any trampoline/coordinator:\n- Agents CAN ask users questions directly\n- The fork/join model supports user interaction\n- We may not need the complex trampoline pattern in historian\n\nIf this doesn't work:\n- We'll see how the agent behaves\n- We'll learn what limitations exist\n- We can design around them\n"
      },
      "plugins": [
        {
          "name": "historian",
          "source": "./plugins/historian",
          "description": "Rewrite git commit sequences to create clean, readable branches",
          "version": "0.6.13",
          "author": {
            "name": "David Herman"
          },
          "categories": [],
          "install_commands": [
            "/plugin marketplace add dherman/claude-plugins",
            "/plugin install historian@dherman"
          ]
        },
        {
          "name": "poet",
          "source": "./plugins/poet",
          "description": "Experimental plugin to test agent user interaction",
          "version": "0.1.0",
          "author": {
            "name": "David Herman"
          },
          "categories": [],
          "install_commands": [
            "/plugin marketplace add dherman/claude-plugins",
            "/plugin install poet@dherman"
          ]
        }
      ]
    }
  ]
}