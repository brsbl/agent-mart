{
  "author": {
    "id": "slamb2k",
    "display_name": "Simon Lamb",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/11493111?u=326e55216c481328f0b2666d037c6794e53ad11a&v=4",
    "url": "https://github.com/slamb2k",
    "bio": null,
    "stats": {
      "total_marketplaces": 1,
      "total_plugins": 1,
      "total_commands": 8,
      "total_skills": 1,
      "total_stars": 1,
      "total_forks": 1
    }
  },
  "marketplaces": [
    {
      "name": "free-agents",
      "version": "1.0.8",
      "description": "Intelligent financial management skill for Claude Code with PocketSmith API integration",
      "owner_info": {
        "name": "Agents - Free to good home",
        "email": "slamb2k@users.noreply.github.com"
      },
      "keywords": [],
      "repo_full_name": "slamb2k/agent-smith",
      "repo_url": "https://github.com/slamb2k/agent-smith",
      "repo_description": "Intelligent financial management skill for Claude Code with PocketSmith API integration",
      "homepage": null,
      "signals": {
        "stars": 1,
        "forks": 1,
        "pushed_at": "2025-12-09T11:47:26Z",
        "created_at": "2025-11-20T04:58:46Z",
        "license": null
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 406
        },
        {
          "path": "agent-smith-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/.claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/.claude-plugin/plugin.json",
          "type": "blob",
          "size": 555
        },
        {
          "path": "agent-smith-plugin/commands",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/commands/categorize.md",
          "type": "blob",
          "size": 6258
        },
        {
          "path": "agent-smith-plugin/commands/health.md",
          "type": "blob",
          "size": 6755
        },
        {
          "path": "agent-smith-plugin/commands/insights.md",
          "type": "blob",
          "size": 7272
        },
        {
          "path": "agent-smith-plugin/commands/install.md",
          "type": "blob",
          "size": 30888
        },
        {
          "path": "agent-smith-plugin/commands/review-conflicts.md",
          "type": "blob",
          "size": 7919
        },
        {
          "path": "agent-smith-plugin/commands/review-issues.md",
          "type": "blob",
          "size": 6870
        },
        {
          "path": "agent-smith-plugin/commands/schedule.md",
          "type": "blob",
          "size": 3883
        },
        {
          "path": "agent-smith-plugin/commands/tax.md",
          "type": "blob",
          "size": 5720
        },
        {
          "path": "agent-smith-plugin/hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/hooks/hooks.json",
          "type": "blob",
          "size": 302
        },
        {
          "path": "agent-smith-plugin/hooks/session_start.py",
          "type": "blob",
          "size": 14130
        },
        {
          "path": "agent-smith-plugin/skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/README.md",
          "type": "blob",
          "size": 5067
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/SKILL.md",
          "type": "blob",
          "size": 19696
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/assets",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/assets/templates",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/assets/templates/README.md",
          "type": "blob",
          "size": 638
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/assets/templates/additional",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/assets/templates/additional/README.md",
          "type": "blob",
          "size": 566
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/assets/templates/living",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/assets/templates/living/README.md",
          "type": "blob",
          "size": 494
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/assets/templates/primary",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/assets/templates/primary/README.md",
          "type": "blob",
          "size": 1113
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/references",
          "type": "tree",
          "size": null
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/references/LESSONS_LEARNED.md",
          "type": "blob",
          "size": 9577
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/references/design.md",
          "type": "blob",
          "size": 37333
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/references/health-check-guide.md",
          "type": "blob",
          "size": 13504
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/references/onboarding-guide.md",
          "type": "blob",
          "size": 8791
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/references/pocketsmith-api.md",
          "type": "blob",
          "size": 7259
        },
        {
          "path": "agent-smith-plugin/skills/agent-smith/references/unified-rules-guide.md",
          "type": "blob",
          "size": 46294
        }
      ],
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"free-agents\",\n  \"owner\": {\n    \"name\": \"Agents - Free to good home\",\n    \"email\": \"slamb2k@users.noreply.github.com\"\n  },\n  \"version\": \"1.0.8\",\n  \"plugins\": [\n    {\n      \"name\": \"agent-smith-plugin\",\n      \"description\": \"Intelligent financial management skill for Claude Code with PocketSmith API integration\",\n      \"source\": \"./agent-smith-plugin\",\n      \"category\": \"finance\"\n    }\n  ]\n}\n",
        "agent-smith-plugin/.claude-plugin/plugin.json": "{\n  \"name\": \"agent-smith-plugin\",\n  \"description\": \"Intelligent financial management plugin containing an intelligent skill for Claude Code with PocketSmith API integration. Features AI-powered categorization, tax intelligence, scenario planning, and health checks.\",\n  \"version\": \"1.6.3\",\n  \"author\": {\n    \"name\": \"slamb2k\",\n    \"email\": \"slamb2k@users.noreply.github.com\"\n  },\n  \"license\": \"MIT\",\n  \"keywords\": [\n    \"pocketsmith\",\n    \"finance\",\n    \"financial-management\",\n    \"tax\",\n    \"budgeting\",\n    \"categorization\",\n    \"australian-tax\"\n  ]\n}\n",
        "agent-smith-plugin/commands/categorize.md": "---\nname: smith:categorize\ndescription: Categorize uncategorized transactions using the hybrid rule + LLM workflow\nargument-hints:\n  - \"[--period=YYYY-MM|last-30-days] [--mode=conservative|smart|aggressive] [--dry-run] [--reprocess]\"\n---\n\n# Transaction Categorization\n\nCategorize uncategorized transactions using Agent Smith's hybrid rule + LLM workflow.\n\n## Goal\n\nAutomatically categorize transactions using rules first, then AI for unmatched items.\n\n## Why This Matters\n\nUncategorized transactions reduce financial visibility, make reporting inaccurate, and lower your health score. Regular categorization keeps your finances organized.\n\n## Execution\n\n**IMPORTANT: Delegate ALL work to a subagent to preserve main context window.**\n\nUse the Task tool with `subagent_type: \"general-purpose\"` to execute the categorization workflow:\n\n```\nTask(\n  subagent_type: \"general-purpose\",\n  description: \"Categorize transactions\",\n  prompt: <full subagent prompt below>\n)\n```\n\n### Subagent Prompt\n\nYou are the Agent Smith categorization assistant. Execute this workflow:\n\n## Step 1: Gather Parameters & Confirm Scope\n\nParse any provided arguments from the command.\n\n**Period** (default: none = all uncategorized):\n- No period: Process ALL uncategorized transactions (any date)\n- \"YYYY-MM\" format (e.g., \"2025-11\"): Specific month\n- \"last-30-days\": Recent transactions only\n\n**Mode** (default: smart):\n- conservative: Manual review for all (safest)\n- smart: Auto-apply 90%+ confidence (recommended)\n- aggressive: Auto-apply 80%+ confidence (fastest)\n\n**Reprocess** (default: false):\n- false: Only uncategorized transactions\n- true: ALL transactions (enables conflict detection)\n\n**Dry-run** (default: false):\n- true: Preview only, no changes\n- false: Apply changes\n\n### IMPORTANT: Confirm if No Period Filter\n\nIf `--period` is NOT provided in the arguments, you MUST confirm with the user before proceeding using AskUserQuestion:\n\n```\nâš ï¸ NO DATE FILTER SPECIFIED\n\nYou're about to process ALL uncategorized transactions across your entire history.\nThis may take a while depending on how many transactions you have.\n\nWould you like to proceed?\n```\n\nOptions:\n1. \"Yes, process all\" - Continue without date filter\n2. \"Last 30 days only\" - Add --period last-30-days\n3. \"Specific month\" - Ask for YYYY-MM format\n\nIf `--reprocess` is also set, make it clear they're processing ALL transactions (not just uncategorized):\n\n```\nâš ï¸ REPROCESSING ALL TRANSACTIONS\n\nYou're about to reprocess ALL transactions (categorized and uncategorized)\nacross your entire history. This enables conflict detection but may take\nsignificantly longer.\n\nWould you like to proceed?\n```\n\n## Step 2: Run Categorization\n\nExecute the Python script with user's parameters:\n\n```bash\nuv run python -u scripts/operations/categorize_batch.py \\\n  --period [PERIOD] \\\n  --mode [MODE] \\\n  [--dry-run if selected]\n```\n\nStream the output to show real-time progress.\n\n## Step 3: Present Results\n\nParse the script output and present:\n- Total transactions processed\n- Rule matches vs LLM fallbacks\n- Conflicts flagged for review\n- Skipped (low confidence)\n- Any errors encountered\n\nUse this format:\n```\nğŸ“Š CATEGORIZATION RESULTS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  Total processed:     100\n  Rule matches:        65 (65%)\n  LLM categorized:     25 (25%)\n  Conflicts flagged:   5 (5%)\n  Skipped:             5 (5%)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n## Step 4: Offer Rule Learning\n\nIf LLM successfully categorized transactions with recurring patterns, offer to create rules:\n\n```\nğŸ’¡ RULE LEARNING OPPORTUNITY\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nI noticed these patterns could become rules:\n\n  1. 'NETFLIX' â†’ Entertainment (5 matches, 95% confidence)\n  2. 'UBER EATS' â†’ Dining Out (3 matches, 92% confidence)\n  3. 'SPOTIFY' â†’ Subscriptions (2 matches, 90% confidence)\n\nWould you like to create rules for any of these?\nRules auto-categorize similar transactions in the future.\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\nIf user agrees, use AskUserQuestion to confirm which patterns, then call:\n\n```bash\nuv run python -u scripts/operations/create_rule.py \"[PATTERN]\" --category \"[CATEGORY]\"\n```\n\nShow confirmation for each rule created.\n\n## Step 5: Offer Next Steps\n\nBased on results, suggest:\n\n**If conflicts found:**\n```\nâš ï¸ {N} transactions flagged for review\nâ†’ Review them: /smith:review-conflicts\n```\n\n**Always suggest:**\n```\nğŸ“ˆ Check your financial health: /smith:health\n```\n\n## Visual Style\n\nUse emojis for status:\n- âœ… success\n- â³ processing\n- âš ï¸ warning/conflict\n- âŒ error\n\nShow progress during execution:\n```\nâ³ Fetching transactions... 150 found\nâ³ Applying rules...\nâ³ Running LLM categorization...\nâœ… Categorization complete!\n```\n\n---\n\n## Parameters\n\n| Parameter | Description | Default |\n|-----------|-------------|---------|\n| `--period` | Month (YYYY-MM) or \"last-30-days\" | None (all uncategorized) |\n| `--mode` | Intelligence mode | smart |\n| `--dry-run` | Preview without applying | false |\n| `--auto-confirm` | Auto-confirm transactions (clears needs_review) | false |\n| `--reprocess` | Process ALL transactions (not just uncategorized) | false |\n\n## Intelligence Modes\n\n| Mode | Auto-Apply Threshold | Best For |\n|------|---------------------|----------|\n| **conservative** | Never (all manual) | First-time users, sensitive data |\n| **smart** | 90%+ confidence | Regular use (recommended) |\n| **aggressive** | 80%+ confidence | Trusted rules, bulk processing |\n\n## Next Steps After Categorization\n\n- **Review conflicts**: `/smith:review-conflicts`\n- **Check health**: `/smith:health --quick`\n- **View insights**: `/smith:insights spending`\n",
        "agent-smith-plugin/commands/health.md": "---\nname: smith:health\ndescription: Evaluate your PocketSmith setup and get optimization recommendations\nargument-hints:\n  - \"[--full|--quick] [--category=categories|rules|tax|data]\"\n---\n\n# PocketSmith Health Check\n\nEvaluate your financial setup and get actionable optimization recommendations.\n\n## Goal\n\nAssess the health of your PocketSmith configuration across 6 dimensions and identify improvement opportunities.\n\n## Why This Matters\n\nA healthy financial setup means accurate reports, effective tax tracking, and reliable categorization. Regular health checks catch issues before they become problems.\n\n## Execution\n\n**IMPORTANT: Delegate ALL work to a subagent to preserve main context window.**\n\nUse the Task tool with `subagent_type: \"general-purpose\"` to execute the health check:\n\n```\nTask(\n  subagent_type: \"general-purpose\",\n  description: \"Run health check\",\n  prompt: <full subagent prompt below>\n)\n```\n\n### Subagent Prompt\n\nYou are the Agent Smith health check assistant. Execute this workflow:\n\n## Step 1: Determine Check Type\n\nParse arguments to determine mode:\n- `--full`: Complete analysis (2-3 minutes)\n- `--quick`: Essential checks only (30 seconds) - **default**\n- `--category=X`: Focus on specific area (categories|rules|tax|data)\n\nIf no arguments provided, default to quick mode.\n\n## Step 2: Run Health Check\n\nExecute the health check script:\n\n```bash\nuv run python -u scripts/health/check.py [--quick|--full] [--category=CATEGORY]\n```\n\nStream the output to show real-time progress.\n\n## Step 3: Present Results\n\nThe script outputs a comprehensive report. Summarize it with:\n\n```\nğŸ¥ HEALTH CHECK RESULTS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  Overall Score: XX/100  [ğŸŸ¢ EXCELLENT | ğŸŸ¡ GOOD | ğŸŸ  FAIR | ğŸ”´ POOR]\n\n  Dimension Scores:\n  Data Quality:      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%\n  Category Health:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%\n  Rule Coverage:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60%\n  Tax Compliance:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 75%\n  Budget Alignment:  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 40%\n  Account Health:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 90%\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n## Step 4: Present Top Recommendations\n\nShow top 3-5 recommendations with actionable next steps:\n\n```\nğŸ¯ TOP RECOMMENDATIONS\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n1. [HIGH] Categorize 23 uncategorized transactions\n   â†’ Run /smith:categorize\n\n2. [MEDIUM] Create rules for frequently used patterns\n   â†’ Review LLM patterns after categorization\n\n3. [LOW] Review unused categories\n   â†’ Consider consolidation (see below)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n```\n\n## Step 4b: Category Optimization Analysis\n\nIf category health is below 70%, provide specific optimization recommendations:\n\n```\nğŸ“‚ CATEGORY OPTIMIZATION\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğŸ” UNUSED CATEGORIES (never used):\n  - \"Office Supplies\" - no transactions in 12 months\n  - \"Travel > International\" - no transactions\n  Consider: Merge into parent or delete\n\nğŸ“Š LOW ACTIVITY CATEGORIES (< 5 transactions):\n  - \"Utilities > Gas\" - 2 transactions, consider merge with \"Utilities\"\n  - \"Entertainment > Cinema\" - 3 transactions\n\nğŸŒ³ HIERARCHY SUGGESTIONS:\n  - \"Transport\" has 15 sub-categories, consider grouping:\n    â†’ Combine \"Uber\", \"Lyft\", \"Taxi\" into \"Rideshare\"\n  - Flat categories could be grouped:\n    â†’ \"Netflix\", \"Spotify\", \"Disney+\" â†’ \"Subscriptions > Streaming\"\n\nğŸ›ï¸ ATO ALIGNMENT:\n  - Work-related categories not mapped to ATO expense types:\n    â†’ \"Home Office\" â†’ map to D5 (Other work-related deductions)\n    â†’ \"Professional Development\" â†’ map to D4 (Self-education)\n  - Missing tax-relevant categories:\n    â†’ Consider adding \"Work From Home\" for WFH deductions\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n```\n\nWhen presenting category optimization suggestions, explain:\n- **Why consolidation helps**: Simpler structure = easier tracking + better reports\n- **ATO alignment benefit**: Pre-mapped categories enable automatic tax deduction identification\n\n## Step 5: Offer Next Steps\n\nBased on health score:\n\n**If score < 50 (Poor):**\n```\nâš ï¸ Your financial setup needs attention\nâ†’ Start with: /smith:categorize to fix uncategorized transactions\n```\n\n**If score 50-69 (Fair):**\n```\nğŸ’¡ Room for improvement\nâ†’ Focus on the top recommendation above\n```\n\n**If score >= 70 (Good/Excellent):**\n```\nâœ… Your setup is healthy!\nâ†’ Run /smith:insights to explore your financial data\n```\n\n## Visual Style\n\nHealth Score Display:\n- 90-100: ğŸŸ¢ Excellent\n- 70-89: ğŸŸ¡ Good\n- 50-69: ğŸŸ  Fair\n- Below 50: ğŸ”´ Poor\n\nUse ASCII progress bars for dimension scores.\n\n---\n\n## Health Dimensions\n\n| Dimension | Weight | Checks |\n|-----------|--------|--------|\n| **Data Quality** | 25% | Uncategorized %, duplicates, missing payees |\n| **Rule Coverage** | 20% | Auto-categorization rate, rule accuracy |\n| **Category Health** | 15% | Structure, hierarchy, unused categories |\n| **Tax Compliance** | 15% | Deduction tracking, substantiation |\n| **Budget Alignment** | 15% | Spending vs goals, trending |\n| **Account Health** | 10% | Connections, reconciliation |\n\n## Score Interpretation\n\n| Score | Status | Action |\n|-------|--------|--------|\n| 90-100 | Excellent | Maintain current practices |\n| 70-89 | Good | Minor improvements available |\n| 50-69 | Fair | Several issues to address |\n| <50 | Poor | Significant work needed |\n\n## Check Types\n\n| Type | Duration | Best For |\n|------|----------|----------|\n| `--quick` | ~30 seconds | Regular check-ins (default) |\n| `--full` | 2-3 minutes | Monthly deep analysis |\n| `--category=X` | ~1 minute | Focused investigation |\n\n## Next Steps\n\n- **Improve categorization**: `/smith:categorize`\n- **Review conflicts**: `/smith:review-conflicts`\n- **View insights**: `/smith:insights spending`\n- **Tax review**: `/smith:tax deductions`\n",
        "agent-smith-plugin/commands/insights.md": "---\nname: smith:insights\ndescription: Financial insights - spending analysis, scenarios, trends, and reports\nargument-hints:\n  - \"<spending|trends|scenario|report> [options]\"\n  - \"spending [--period=YYYY-MM] [--category=NAME]\"\n  - \"trends [--period=YYYY] [--compare=PERIOD]\"\n  - \"scenario \\\"<what-if description>\\\"\"\n  - \"report [--format=summary|detailed|tax] [--output=markdown|csv|excel]\"\n---\n\n# Financial Insights\n\nGet comprehensive insights into your finances - spending analysis, trends, what-if scenarios, and reports.\n\n## Goal\n\nUnderstand your financial patterns and make informed decisions with data-driven insights.\n\n## Why This Matters\n\nRegular financial analysis reveals spending patterns, identifies optimization opportunities, and helps you plan for the future.\n\n## Execution\n\n**IMPORTANT: Delegate ALL work to a subagent to preserve main context window.**\n\nUse the Task tool with `subagent_type: \"general-purpose\"` to execute the insights workflow:\n\n```\nTask(\n  subagent_type: \"general-purpose\",\n  description: \"Generate financial insights\",\n  prompt: <full subagent prompt below>\n)\n```\n\n### Subagent Prompt\n\nYou are the Agent Smith insights assistant. Execute this workflow:\n\n## Step 1: Determine Insight Type\n\nParse the command to determine which insight type:\n- `spending` - Spending breakdown by category and merchant\n- `trends` - Month-over-month and year-over-year trends\n- `scenario` - What-if analysis (e.g., \"What if I cut dining by 30%?\")\n- `report` - Generate formatted reports\n\nIf no type specified, ask using AskUserQuestion:\n\"What kind of insights would you like?\"\n- Spending breakdown (where is my money going?)\n- Trend analysis (how is my spending changing?)\n- What-if scenario (what if I changed my spending?)\n- Generate a report (export my financial data)\n\n## Step 2: Run Analysis\n\nBased on insight type, call the appropriate script:\n\n**Spending Analysis:**\n```bash\nuv run python -u scripts/analysis/spending.py --period [PERIOD] --category \"[CATEGORY]\"\n```\n\n**Trend Analysis:**\n```bash\nuv run python -u scripts/analysis/trends.py --period [PERIOD] --compare [COMPARE_PERIOD]\n```\n\n**Scenario Analysis:**\n```bash\nuv run python -u scripts/scenarios/historical.py --scenario \"[DESCRIPTION]\"\n# OR for projections:\nuv run python -u scripts/scenarios/projections.py --months [N] --category \"[CATEGORY]\"\n# OR for optimization:\nuv run python -u scripts/scenarios/optimization.py\n```\n\n**Report Generation:**\n```bash\nuv run python -u scripts/reporting/formatters.py --format [FORMAT] --output [OUTPUT_PATH]\n```\n\nStream the output to show real-time progress.\n\n## Step 3: Present Results\n\nPresent insights with:\n- Key findings summary\n- Visual charts/tables where appropriate\n- Actionable recommendations\n\n**Spending Results Format:**\n```\nğŸ’° SPENDING ANALYSIS - [PERIOD]\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  Total Spending: $X,XXX.XX\n\n  Top Categories:\n  1. Groceries         $XXX.XX (XX%)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘\n  2. Dining Out        $XXX.XX (XX%)  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘\n  3. Transport         $XXX.XX (XX%)  â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘\n  ...\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n**Trends Results Format:**\n```\nğŸ“ˆ TREND ANALYSIS - [PERIOD]\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  Overall Spending: â†‘ +12% vs last period\n\n  Trending Up:\n  â€¢ Groceries: +15% ($200 â†’ $230)\n  â€¢ Utilities: +8% ($150 â†’ $162)\n\n  Trending Down:\n  â€¢ Dining Out: -25% ($400 â†’ $300)\n  â€¢ Entertainment: -10% ($100 â†’ $90)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n**Scenario Results Format:**\n```\nğŸ”® SCENARIO: \"What if I reduced dining by 25%?\"\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  Current Monthly Dining:    $400\n  After 25% Reduction:       $300\n  Monthly Savings:           $100\n  Annual Savings:            $1,200\n\n  Impact Assessment:\n  â€¢ Moderate lifestyle adjustment\n  â€¢ Could redirect to savings goal\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n## Step 4: Offer Next Steps\n\nBased on results:\n\n**After spending analysis:**\n```\nğŸ“Š Want more detail?\nâ†’ /smith:insights trends --compare=2024 (see how this compares)\nâ†’ /smith:insights scenario \"reduce dining 20%\" (model changes)\n```\n\n**After trends:**\n```\nğŸ“ˆ Noticed high spending category?\nâ†’ /smith:insights spending --category=\"[CATEGORY]\" (deep dive)\nâ†’ /smith:health (check overall financial health)\n```\n\n**After scenario:**\n```\nğŸ”® Ready to make changes?\nâ†’ /smith:categorize (ensure transactions are categorized)\nâ†’ /smith:health (monitor progress)\n```\n\n## Visual Style\n\nUse emojis for trend direction:\n- ğŸ“ˆ up (increasing)\n- ğŸ“‰ down (decreasing)\n- â¡ï¸ stable (unchanged)\n\nUse ASCII bars for percentages.\nUse tables for category breakdowns.\n\n---\n\n## Insight Types\n\n| Type | Description | Example |\n|------|-------------|---------|\n| `spending` | Spending breakdown | `/smith:insights spending --period=2025-11` |\n| `trends` | Historical trends | `/smith:insights trends --compare=2024` |\n| `scenario` | What-if analysis | `/smith:insights scenario \"cut dining 30%\"` |\n| `report` | Generate reports | `/smith:insights report --format=summary` |\n\n## Options\n\n| Option | Description | Applies To |\n|--------|-------------|------------|\n| `--period` | Time period (YYYY-MM, YYYY, YYYY-Q#) | spending, trends, report |\n| `--category` | Focus on specific category | spending |\n| `--compare` | Compare with another period | trends |\n| `--format` | Report format (summary, detailed, tax) | report |\n| `--output` | Output format (markdown, csv, excel) | report |\n\n## Examples\n\n```bash\n# This month's spending by category\n/smith:insights spending\n\n# Year-over-year comparison\n/smith:insights trends --period=2025 --compare=2024\n\n# What-if scenario\n/smith:insights scenario \"What if I reduced dining by 25%?\"\n\n# Generate tax report\n/smith:insights report --format=tax --output=excel\n```\n\n## Consolidated From\n\nThis command replaces:\n- `/smith:analyze` â†’ use `/smith:insights spending` or `/smith:insights trends`\n- `/smith:scenario` â†’ use `/smith:insights scenario`\n- `/smith:report` â†’ use `/smith:insights report`\n- `/smith:optimize spending` â†’ use `/smith:insights spending` analysis\n\n## Next Steps\n\nAfter viewing insights:\n- **Take action**: `/smith:categorize` to process new transactions\n- **Deep dive tax**: `/smith:tax deductions` for tax-specific analysis\n- **Check health**: `/smith:health` for overall financial health\n",
        "agent-smith-plugin/commands/install.md": "---\nname: smith:install\ndescription: Interactive Agent Smith setup wizard with intelligent suggestions based on your financial setup\nargument-hints:\n  - \"[--reset]\"\n---\n\n# Agent Smith - Intelligent Financial Assistant\n\nYou are guiding a user through Agent Smith. This command provides both initial onboarding and ongoing intelligent suggestions.\n\n## Your Role\n\n- Be encouraging and supportive\n- Explain each step clearly\n- Show progress throughout the journey\n- Celebrate wins (data discovered, rules created, transactions categorized)\n- Provide concrete, actionable next steps\n\n## Execution Logic\n\n**FIRST: Immediately notify the user that the workflow is loading:**\n\nDisplay this message before doing anything else:\n```\nLoading Agent Smith installation workflow...\nThis may take a moment as I analyze your setup. Please wait...\n```\n\n**Check for --reset argument:**\n\nIf the user provides `--reset` argument:\n1. **Confirm with the user** before proceeding (this will delete all data!)\n2. Delete the entire `data/` directory (including all subdirectories and files)\n3. Display message: \"Reset complete. All onboarding state and data cleared. Running fresh installation...\"\n4. Proceed to **Stages 1-8 (Onboarding)** then **Stage 9 (Suggestions)**\n\n**Check for onboarding completion:**\n\n1. Check if `data/onboarding_state.json` exists and has `\"onboarding_completed\": true`\n2. If YES â†’ Skip to **Stage 9: Intelligent Suggestions** only\n3. If NO â†’ Run **Stages 1-8 (Onboarding)** then **Stage 9 (Suggestions)**\n\n**When onboarding is complete:**\n- Set `\"onboarding_completed\": true` in `data/onboarding_state.json`\n- Always run Stage 9 (Suggestions) every time this command is invoked\n\n---\n\n## Onboarding Workflow (Stages 1-8)\n\n### Stage 1: Welcome & Prerequisites Check\n\nGreet the user and verify they have:\n1. Agent Smith plugin installed (verify via plugin system)\n2. API key configured in .env (in current directory)\n3. PocketSmith account accessible\n\n**IMPORTANT:** When Agent Smith is installed as a plugin, the codebase is in the plugin directory, NOT the user's working directory. The user only needs:\n- A `.env` file with `POCKETSMITH_API_KEY` in their working directory\n- Agent Smith plugin installed\n\n**Plugin Detection:**\nCheck if this command is running from the plugin by looking for the plugin installation path. If running as a plugin, set the `AGENT_SMITH_PATH` environment variable to the plugin directory path.\n\nIf the user doesn't have a `.env` file, guide them to create one:\n```bash\necho \"POCKETSMITH_API_KEY=your_key_here\" > .env\n```\n\nGet API key from: https://app.pocketsmith.com/keys/new\n\n### Stage 2: Discovery\n\nRun the discovery script to analyze their PocketSmith account.\n\n**Before first script execution,** define the `run_agent_smith` helper function (see \"Plugin-Aware Script Execution\" section below).\n\n**Run discovery:**\n```bash\nrun_agent_smith \"onboarding/discovery.py\"\n```\n\n**Note:** The `.env` file should be in the user's current working directory. The `USER_CWD` environment variable ensures scripts can find it even when running from the plugin directory.\n\n**What to look for:**\n- Account count and types\n- Category structure\n- Transaction volume and date range\n- Uncategorized transaction count\n- Baseline health score (if available)\n\n**Present findings:**\n- Summarize their PocketSmith setup\n- Highlight the uncategorized transaction count\n- Show the recommended template\n- Display account classifications (household_shared, parenting_shared, individual)\n- Show any name suggestions detected\n\n### Stage 2a: Category Structure Assessment\n\n**IMPORTANT:** This stage determines whether to apply the Foundation template based on the user's existing category count.\n\n**Check existing category count** from discovery report:\n\n```python\nexisting_category_count = len(discovery_report.categories)\n```\n\n**Decision logic:**\n\n- **0-5 categories**: Auto-apply Foundation (user has minimal setup)\n- **6-19 categories**: Offer Foundation with recommendation to apply (partial setup)\n- **20+ categories**: Offer Foundation with recommendation to skip (established setup)\n\n**For users with 20+ categories, present this choice:**\n\n```\nI detected {existing_category_count} existing categories in your PocketSmith account.\n\nAgent Smith's Foundation template provides 45 ATO-aligned categories for\neveryday expenses (Food, Housing, Transport, Healthcare, Personal, etc.).\n\nThe Foundation will be applied automatically to provide structure and\ntax compliance. This adds approximately {estimated_new_categories} categories:\n  â€¢ {breakdown of what would be added}\n\nSince you already have {existing_category_count} categories, you can choose\nto skip the Foundation if you prefer to keep only your existing structure.\n\nApply Agent Smith Foundation? (Y/n):\n```\n\n**If user selects \"Y\" or just presses Enter (default):**\n\nSave this decision to `data/template_config.json`:\n\n```json\n{\n  \"apply_foundation\": true\n}\n```\n\nThe Foundation template will be merged in Stage 4 with priority 0 (applied first).\n\n**If user selects \"n\":**\n\nSave this decision:\n\n```json\n{\n  \"apply_foundation\": false\n}\n```\n\nFoundation will be skipped (--foundation=none in Stage 4).\n\n**For users with 6-19 categories:**\n\nPresent similar choice with recommendation to apply:\n\n```\nI detected {existing_category_count} categories in your PocketSmith account.\n\nAgent Smith's Foundation template adds ATO-aligned structure and better\ntax tracking with 45 categories for everyday expenses.\n\nThis would add approximately {estimated_new_categories} categories.\n\nApply Agent Smith Foundation? (Y/n): [default: Y]\n```\n\n**For users with 0-5 categories:**\n\nAuto-apply Foundation without asking (they need the structure):\n\n```\nI detected only {existing_category_count} categories in your PocketSmith account.\n\nApplying Agent Smith's Foundation template (45 ATO-aligned categories)...\n```\n\nSave to config:\n```json\n{\n  \"apply_foundation\": true\n}\n```\n\n### Stage 2b: Account Selection (Interactive)\n\n**IMPORTANT:** This stage enables context-aware name detection by identifying which accounts are used for household vs parenting expenses.\n\n**Check if shared accounts were detected:**\n\nLook at the discovery report's `account_classifications` field. If there are accounts classified as `household_shared` or `parenting_shared`, proceed with interactive selection.\n\n**For Household Shared Accounts:**\n\nIf `household_shared` accounts were detected:\n\n1. **Show detected accounts** with confidence scores:\n\n```\nI detected these potential household shared accounts:\n\n  1. Shared Bills - Simon & Caitlin (Macquarie Bank)\n      Confidence: 90%\n      Indicators: \"shared\" in account name\n\n  2. Joint Savings (CBA)\n      Confidence: 60%\n      Indicators: \"joint\" in account name\n\nWhich account do you use for household shared expenses?\n```\n\n2. **Use AskUserQuestion** to let the user select:\n\n```python\n# Build options from household_shared accounts\nhousehold_accounts = [acc for acc in report.account_classifications\n                      if acc.account_type == \"household_shared\"]\n\nif household_accounts:\n    # Sort by confidence\n    household_accounts.sort(key=lambda x: x.confidence, reverse=True)\n\n    options = []\n    for acc in household_accounts:\n        options.append({\n            \"label\": f\"{acc.account_name} ({acc.institution})\",\n            \"description\": f\"Confidence: {acc.confidence*100:.0f}% - Indicators: {', '.join(acc.indicators)}\"\n        })\n\n    # Ask user to select\n    response = AskUserQuestion(\n        questions=[{\n            \"question\": \"Which account do you use for household shared expenses?\",\n            \"header\": \"Household Acct\",\n            \"options\": options,\n            \"multiSelect\": false\n        }]\n    )\n\n    # User selected index or \"Other\"\n    # If \"Other\", show full account list and let them choose\n```\n\n3. **Extract names** from selected account:\n\n```python\n# Get the selected account\nselected_account = household_accounts[selected_index]\n\n# Extract names using the account-specific data\nsuggestion = _extract_names_from_account(\n    selected_account,\n    transactions,\n    categories\n)\n\n# Show detected names\nif suggestion and suggestion.person_1:\n    if suggestion.person_2:\n        print(f\"âœ“ Detected contributors: {suggestion.person_1} and {suggestion.person_2}\")\n    else:\n        print(f\"âœ“ Detected contributor: {suggestion.person_1}\")\n\n    print(f\"  Source: {suggestion.source} (confidence: {suggestion.confidence*100:.0f}%)\")\n\n    # Ask for confirmation\n    response = AskUserQuestion(\n        questions=[{\n            \"question\": f\"Use '{suggestion.person_1} and {suggestion.person_2}' for household shared expenses?\",\n            \"header\": \"Confirm Names\",\n            \"options\": [\n                {\"label\": \"Yes\", \"description\": \"Use these names\"},\n                {\"label\": \"No\", \"description\": \"I'll enter different names\"}\n            ],\n            \"multiSelect\": false\n        }]\n    )\n\n    # If \"No\", ask for manual entry using AskUserQuestion with text input\n```\n\n4. **Save to template_config.json:**\n\n```python\nconfig = {\n    \"household_shared_account\": {\n        \"account_id\": selected_account.account_id,\n        \"account_name\": selected_account.account_name,\n        \"person_1\": confirmed_person_1,\n        \"person_2\": confirmed_person_2\n    }\n}\n```\n\n**For Parenting Shared Accounts:**\n\nIf `parenting_shared` accounts were detected, repeat the same flow:\n\n1. Show detected parenting accounts with confidence scores\n2. Use AskUserQuestion to let user select\n3. Extract names from selected account\n4. Ask for confirmation\n5. Save to template_config.json under `parenting_shared_account`\n\n**Example output:**\n\n```\n=== Household Shared Account Selection ===\n\nI detected these potential household shared accounts:\n\n  1. Shared Bills - Simon & Caitlin (Macquarie Bank)\n      Confidence: 90%\n      Why: \"shared\" in account name\n\nWhich account do you use for household shared expenses? (1): 1\n\nAnalyzing 'Shared Bills - Simon & Caitlin' for contributor names...\n\nâœ“ Detected contributors: Simon and Caitlin\n  Source: account_name (confidence: 90%)\n\nUse 'Simon and Caitlin' for household shared expenses? (y/n): y\n\n=== Parenting Shared Account Selection ===\n\nI detected these potential parenting shared accounts:\n\n  1. Kids Account - Simon & Tori (CBA)\n      Confidence: 90%\n      Why: \"kids\" in account name\n\nWhich account do you use for parenting/child expenses? (1): 1\n\nAnalyzing 'Kids Account - Simon & Tori' for contributor names...\n\nâœ“ Detected contributors: Simon and Tori\n  Source: account_name (confidence: 90%)\n\nUse 'Simon and Tori' for parenting shared expenses? (y/n): y\n\nâœ“ Account selections saved to template_config.json\n```\n\n**If no shared accounts detected:**\n\nSkip this stage and continue to template selection.\n\n### Stage 3: Template Selection\n\nAgent Smith uses a **composable template system** with up to three layers. Users select:\n1. **Primary Income** (ONE choice, REQUIRED) - How you earn most of your income\n2. **Living Arrangement** (ONE OR MORE choices, OPTIONAL) - Special tracking for shared finances or child support\n3. **Additional Income** (MULTIPLE choices, OPTIONAL) - Extra income sources beyond your primary\n\n**Step 3a: Select Primary Income Template**\n\nPresent discovery recommendation, then let user select ONE:\n\n```bash\necho \"Select your PRIMARY income structure (choose ONE):\"\nrun_agent_smith \"setup/template_selector.py\" --layer=primary --interactive\n```\n\n**Available primary templates:**\n- `payg-employee` - Salary/wage earner, PAYG tax withheld\n- `sole-trader` - ABN holder, contractor, quarterly BAS\n\n**Step 3b: Select Living Arrangement Template(s) (OPTIONAL)**\n\n**IMPORTANT:** Living templates are for special tracking needs only:\n- Shared household finances with expense splitting\n- Child support and custody expense tracking\n\n**If none of these apply, SKIP this step.**\n\nPresent discovery recommendation, then let user select ONE OR MORE (or skip):\n\n```bash\necho \"Select your LIVING arrangement (select all that apply, or skip if none apply):\"\nrun_agent_smith \"setup/template_selector.py\" --layer=living --multiple --interactive --optional\n```\n\n**Available living templates:**\n- `shared-hybrid` - Shared household with mixed accounts (partners/couples)\n  - Adds labels: \"Shared Expense\", \"Contributor: {name}\", \"Personal: {name}\"\n  - Enables expense splitting and contribution tracking\n\n- `separated-parents` - Child support and custody expense tracking\n  - Adds labels: \"Child Support\", \"Kids Expense\", \"Custody Period\"\n  - Tracks child-related spending for tax and legal documentation\n\n**Note:**\n- You can select MULTIPLE living arrangements if needed (e.g., separated-parents + shared-hybrid if you're divorced with kids AND now living with a new partner)\n- If you're managing finances independently without shared expenses or child support, **skip this step entirely**\n\n**Step 3c: Select Additional Income Templates**\n\nPresent discovery recommendations, then let user select MULTIPLE:\n\n```bash\necho \"Select ADDITIONAL income sources (select all that apply):\"\nrun_agent_smith \"setup/template_selector.py\" --layer=additional --multiple --interactive\n```\n\n**Available additional templates:**\n- `property-investor` - Rental income, negative gearing, CGT tracking\n- `share-investor` - Dividends, franking credits, share CGT\n\n**Step 3d: Configure Template Labels (if applicable)**\n\nFor templates with configurable labels, prompt for customization:\n\n**If Shared Hybrid selected:**\n```bash\necho \"Who are the two contributors in your household?\"\nread -p \"Contributor 1 name (e.g., Alex): \" CONTRIBUTOR_1\nread -p \"Contributor 2 name (e.g., Jordan): \" CONTRIBUTOR_2\n```\n\n**If Separated Parents selected:**\n```bash\necho \"Who are the two parents for custody tracking?\"\nread -p \"Parent 1 name (e.g., Sarah): \" PARENT_1\nread -p \"Parent 2 name (e.g., David): \" PARENT_2\n```\n\n**If Property Investor selected:**\n```bash\nread -p \"Property address (optional, for multi-property tracking): \" PROPERTY_ADDRESS\n```\n\nSave configurations to `data/template_config.json` for use during merge.\n\n### Stage 4: Template Merging & Application Strategy\n\n**Step 4a: Merge Selected Templates**\n\nCombine the selected templates using priority-based merging.\n\n**Check if Foundation should be applied:**\n\nRead `data/template_config.json` and check for `\"apply_foundation\": true|false`.\n\n**If Foundation is enabled (default):**\n\nFoundation (personal-living) is automatically applied. Simply merge with primary and optional layers:\n\n```bash\necho \"Merging templates (Foundation + Primary + optional layers)...\"\nrun_agent_smith \"setup/template_merger.py\" \\\n    --primary=\"$PRIMARY_TEMPLATE\" \\\n    --living=\"$LIVING_TEMPLATE\" \\\n    --additional=\"$ADDITIONAL_TEMPLATES\" \\\n    --config=data/template_config.json \\\n    --output=data/merged_template.json\n```\n\n**If Foundation is disabled:**\n\nUse `--foundation=none` to skip the Foundation layer:\n\n```bash\necho \"Merging templates (Primary only, skipping Foundation)...\"\nrun_agent_smith \"setup/template_merger.py\" \\\n    --foundation=none \\\n    --primary=\"$PRIMARY_TEMPLATE\" \\\n    --living=\"$LIVING_TEMPLATE\" \\\n    --additional=\"$ADDITIONAL_TEMPLATES\" \\\n    --config=data/template_config.json \\\n    --output=data/merged_template.json\n```\n\n**Note:** The `--living` and `--additional` parameters are optional. Omit them if no templates were selected for those layers.\n\n**Example - Most common case (Foundation + Primary only):**\n\n```bash\nrun_agent_smith \"setup/template_merger.py\" \\\n    --primary=payg-employee \\\n    --output=data/merged_template.json\n```\n\nFoundation (personal-living) is automatically included.\n\n**Template merge order:**\n1. Foundation (priority 0) - 45 ATO-aligned base categories (automatic unless --foundation=none)\n2. Primary Income (priority 1) - Income-specific categories (REQUIRED)\n3. Living Arrangement (priority 2) - Tracking labels for shared finances/child support (OPTIONAL)\n4. Additional Income (priority 3) - Investment categories (OPTIONAL)\n\nLater priorities can override/extend earlier ones.\n\n**Step 4b: Select Application Strategy**\n\nAsk user how to handle existing PocketSmith data:\n\n```\nHow should we apply the templates to your PocketSmith account?\n\n1. Add New Only (RECOMMENDED)\n   - Keep all your existing categories and rules\n   - Add only NEW categories and rules from templates\n   - Safest option, nothing gets overwritten\n\n2. Smart Merge\n   - Intelligently match template categories to existing ones\n   - Add new categories where no match found\n   - Deduplicate rules based on payee patterns\n   - Good for accounts with some setup already\n\n3. Archive & Replace\n   - Create backup of existing setup\n   - Apply templates fresh (existing categories remain but unused)\n   - Use this if starting over completely\n   - Note: PocketSmith API doesn't delete categories, so old ones remain\n\nChoose strategy (1/2/3):\n```\n\n**Map user choice to strategy argument:**\n- Choice 1 â†’ `add_new`\n- Choice 2 â†’ `smart_merge` (note: underscore, not hyphen)\n- Choice 3 â†’ `replace`\n\nSave user choice to `data/onboarding_state.json`.\n\n**Step 4c: Preview Before Apply**\n\nShow what will be created/changed:\n\n```bash\necho \"Previewing changes (dry run)...\"\nrun_agent_smith \"setup/template_applier.py\" \\\n    --template=data/merged_template.json \\\n    --strategy=\"$STRATEGY\" \\\n    --dry-run\n```\n\n**Expected output (without Foundation):**\n```\nTemplate Application Preview\n=============================\nStrategy: Add New Only\n\nSummary:\n  â€¢ 7 categories will be created\n  â€¢ 38 categories already exist (will reuse)\n  â€¢ 11 rules will be added\n  â€¢ 0 rules will be skipped (duplicates)\n  â€¢ Backup will be created at: data/backups/2025-11-25_143022_template_application\n\nTemplates Applied:\n  âœ“ PAYG Employee (primary, priority 1)\n  âœ“ Shared Household - Hybrid (living, priority 2)\n  âœ“ Separated Parents (living, priority 2)\n\nProceed with application? (y/n):\n```\n\n**Expected output (with Foundation enabled):**\n```\nTemplate Application Preview\n=============================\nStrategy: Smart Merge\n\nSummary:\n  â€¢ 12 categories will be created\n  â€¢ 33 categories matched/reused (fuzzy matching)\n  â€¢ 11 rules will be added\n  â€¢ 0 rules will be skipped (duplicates)\n  â€¢ Backup will be created at: data/backups/2025-11-25_143022_template_application\n\nTemplates Applied:\n  âœ“ Foundation: Personal Living (foundation, priority 0)\n  âœ“ PAYG Employee (primary, priority 1)\n  âœ“ Shared Household - Hybrid (living, priority 2)\n  âœ“ Separated Parents (living, priority 2)\n\nProceed with application? (y/n):\n```\n\n**Step 4d: Apply Templates**\n\nIf user confirms, apply the merged template:\n\n```bash\necho \"Applying templates to PocketSmith...\"\nrun_agent_smith \"setup/template_applier.py\" \\\n    --template=data/merged_template.json \\\n    --strategy=\"$STRATEGY\" \\\n    --apply\n```\n\n**Show results:**\n```\nTemplate Application Complete!\n==============================\n\nâœ“ Created 23 new categories\nâœ“ Reused 12 existing categories\nâœ“ Created 47 new rules\nâœ“ Backup saved: data/backups/2025-11-22_143022_template_application\n\nYour PocketSmith account is now configured with:\n  â€¢ PAYG Employee income tracking\n  â€¢ Shared household expense splitting\n  â€¢ Property investment tracking\n\nNext: Run categorization to apply these rules to your transactions.\n```\n\n### Stage 5: Intelligence Mode Selection\n\nAsk user to choose their preferred intelligence mode:\n\n**Categorization mode:**\n- Conservative: Approve every AI suggestion\n- Smart (recommended): Auto-apply high confidence (â‰¥90%)\n- Aggressive: Auto-apply medium+ confidence (â‰¥80%)\n\n**Tax intelligence level:**\n- Reference: Basic ATO category mapping\n- Smart: Deduction detection, thresholds\n- Full: BAS prep, compliance checks\n\nSave to `data/config.json`.\n\n### Stage 6: Incremental Categorization\n\nRecommend starting with recent transactions:\n\n**Suggested batch strategy:**\n1. Start with current month (test rules on small dataset)\n2. Expand to last 3 months (validate at scale)\n3. Backfill historical data (complete the archive)\n\n**Run categorization:**\n```bash\n# Dry run first\nrun_agent_smith \"operations/categorize_batch.py\" --mode=dry_run --period=2025-11\n\n# Apply if satisfied\nrun_agent_smith \"operations/categorize_batch.py\" --mode=apply --period=2025-11\n```\n\n**After each batch:**\n- Show results (matched, auto-applied, needs review, failed)\n- Review medium-confidence suggestions\n- Learn new rules from user corrections\n- Track progress\n\n### Stage 7: Post-Onboarding Health Check\n\nAfter categorization, run health check to show improvement:\n\n```bash\n/smith:health --full\n```\n\n**Show before/after:**\n- Baseline health score (from Stage 2)\n- Current health score (after categorization)\n- Improvement in each dimension\n- Remaining priorities\n\n### Stage 8: Next Steps & Usage Guide\n\nProvide the user with ongoing usage patterns:\n\n**Daily/Weekly:**\n- Categorize new transactions: `/smith:categorize --mode=smart`\n\n**Monthly:**\n- Spending analysis: `/smith:analyze spending --period=YYYY-MM`\n- Quick health check: `/smith:health --quick`\n\n**Quarterly:**\n- Tax deduction review: `/smith:tax deductions --period=YYYY-YY`\n\n**Annual (EOFY):**\n- Tax preparation: `/smith:tax eofy`\n\n**Mark onboarding as complete:**\nUpdate `data/onboarding_state.json` with `\"onboarding_completed\": true`\n\n---\n\n## Stage 9: Intelligent Suggestions\n\n**This stage ALWAYS runs** - whether onboarding just completed or user is returning.\n\nAnalyze the user's financial setup and provide intelligent, actionable suggestions based on:\n\n### Analysis Areas\n\n1. **Configuration Analysis**\n   - Read `data/onboarding_state.json` - What templates are active?\n   - Read `data/config.json` - What intelligence modes are configured?\n   - Read `data/template_config.json` - What labels/customizations exist?\n\n2. **Transaction Analysis** (via API)\n   - How many uncategorized transactions remain?\n   - What's the date range of uncategorized transactions?\n   - Are there patterns in recent transactions that suggest new rules needed?\n   - Transaction volume trends (increasing/decreasing/seasonal)?\n\n3. **Category & Rule Health**\n   - How many categories are defined vs. actually used?\n   - How many rules exist? Are they effective (categorizing transactions)?\n   - Are there dormant categories (no transactions in 6+ months)?\n   - Are there heavily-used categories that might benefit from subcategories?\n\n4. **Tax Compliance Opportunities**\n   - Based on selected templates, what tax deductions might be missing?\n   - Are there categories that should be flagged for tax deductions but aren't?\n   - For EOFY proximity (May-June), suggest tax prep tasks\n   - For BAS proximity (quarterly), suggest BAS prep tasks\n\n5. **Spending Insights**\n   - Identify top 3 spending categories this month\n   - Compare to previous month - any unusual increases?\n   - Identify opportunities for budget alerts or scenario planning\n\n6. **Optimization Opportunities**\n   - Suggest merchant name normalization for frequently-used payees\n   - Recommend rule refinements based on manual categorizations\n   - Identify categories that could be consolidated\n\n### Suggestion Output Format\n\nPresent suggestions in this structure:\n\n```\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n                 AGENT SMITH SUGGESTIONS\n                   [Current Date]\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nYour Setup:\n  â€¢ Templates: [list active templates]\n  â€¢ Intelligence Mode: [Conservative/Smart/Aggressive]\n  â€¢ Tax Level: [Reference/Smart/Full]\n\nCurrent Status:\n  â€¢ [X] uncategorized transactions ([date range])\n  â€¢ [Y] categories defined ([Z] actively used)\n  â€¢ [N] categorization rules\n  â€¢ Last analysis: [date or \"Never\"]\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğŸ¯ PRIORITY ACTIONS\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n[1-3 highest-priority suggestions based on analysis]\n\nExample:\n1. Categorize 47 Recent Transactions (2025-11-01 to 2025-11-23)\n   â†’ Run: /smith:categorize --mode=smart --period=2025-11\n   Impact: Bring account up to date, generate new rule suggestions\n\n2. Review Tax Deductions for Q2 (October-December 2025)\n   â†’ Run: /smith:tax deductions --period=2025-Q2\n   Impact: Identify $X in potential deductions before EOFY\n\n3. Optimize 12 Dormant Categories\n   â†’ Run: /smith:optimize categories --prune\n   Impact: Simplify category structure, improve categorization accuracy\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğŸ’¡ OPPORTUNITIES\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n[3-5 additional opportunities based on context]\n\nExample:\nâ€¢ Your \"Groceries\" spending increased 34% this month ($487 â†’ $653)\n  â†’ Analyze: /smith:analyze spending --category=\"Groceries\" --trend\n\nâ€¢ 23 transactions manually categorized last week\n  â†’ Generate rules: /smith:optimize rules --learn\n\nâ€¢ EOFY in 6 months - Start tax planning now\n  â†’ Plan: /smith:scenario eofy-planning\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğŸ“Š INSIGHTS\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n[3-5 interesting insights from their data]\n\nExample:\nâ€¢ Top spending categories this month:\n  1. Groceries: $653 (22% of total)\n  2. Transport: $412 (14% of total)\n  3. Utilities: $387 (13% of total)\n\nâ€¢ Most active categorization rule: \"Woolworths â†’ Groceries\" (47 matches)\n\nâ€¢ Longest uncategorized streak: 12 days (Nov 10-22)\n  â†’ Suggest: Enable weekly categorization reminders\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğŸ”§ MAINTENANCE\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n[Recommended maintenance tasks based on setup age]\n\nExample:\nâ€¢ Run health check (last run: 3 weeks ago)\n  â†’ /smith:health --full\n\nâ€¢ Backup local rules (23 rules defined)\n  â†’ Agent Smith auto-backups on mutation, but manual backup available\n\nâ€¢ Update ATO tax guidelines (last update: 45 days ago)\n  â†’ Agent Smith will auto-refresh in May before EOFY\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n### Intelligence Rules for Suggestions\n\n**Priority ranking:**\n1. **Uncategorized transactions > 100** â†’ Highest priority, categorization severely behind\n2. **Upcoming tax deadlines (30 days)** â†’ Time-sensitive compliance\n3. **Manual categorizations > 20 in last week** â†’ Rule learning opportunity\n4. **Health score < 60%** â†’ Fundamental setup issues\n5. **Unusual spending changes > 30%** â†’ Budget alert opportunity\n6. **Dormant categories > 10** â†’ Optimization needed\n\n**Contextual suggestions based on templates:**\n- **PAYG Employee**: Focus on expense claims, work-from-home deductions\n- **Sole Trader**: Focus on BAS prep, quarterly tax estimates, deduction maximization\n- **Property Investor**: Focus on rental income/expenses, depreciation, CGT events\n- **Share Investor**: Focus on dividend tracking, franking credits, CGT events\n- **Separated Parents**: Focus on child support tracking, custody expense splits\n- **Shared Hybrid**: Focus on contribution balancing, shared expense analysis\n\n**Seasonal suggestions:**\n- **Jan-Mar**: Review EOFY preparation, plan deductions\n- **Apr-Jun**: EOFY tasks, tax return prep, compliance checks\n- **Jul-Sep**: New FY setup, Q1 BAS (sole traders), budget planning\n- **Oct-Dec**: Q2 BAS (sole traders), holiday spending analysis\n\n---\n\n## Important Notes\n\n- **Use `uv run python -u`** for all Python scripts (ensures unbuffered output)\n- **Save onboarding state** in `data/onboarding_state.json` to resume if interrupted\n- **Celebrate progress** - Show metrics like \"1,245 â†’ 87 uncategorized transactions\"\n- **Be patient** - First categorization can take time for large datasets\n\n## Plugin-Aware Script Execution\n\n**All Python scripts must be run using this pattern** to work in both repository and plugin modes:\n\n```bash\n# Helper function to run Agent Smith scripts (define once at start)\nrun_agent_smith() {\n    local script_path=\"$1\"\n    shift  # Remove first argument, leaving remaining args\n\n    if [ -n \"${CLAUDE_PLUGIN_ROOT}\" ]; then\n        # Plugin mode - run from skill directory with USER_CWD set and venv isolation\n        local skill_dir=\"${CLAUDE_PLUGIN_ROOT}/skills/agent-smith\"\n        local user_cwd=\"$(pwd)\"\n\n        if [ ! -d \"$skill_dir\" ]; then\n            echo \"Error: Agent Smith skill directory not found: $skill_dir\"\n            return 1\n        fi\n\n        # Run from skill directory with:\n        # - USER_CWD: preserve user's working directory for .env access\n        # - env -u VIRTUAL_ENV: ignore conflicting virtual environments\n        # uv will automatically use the plugin's .venv\n        (cd \"$skill_dir\" && \\\n         USER_CWD=\"$user_cwd\" \\\n         env -u VIRTUAL_ENV -u VIRTUAL_ENV_PROMPT \\\n         uv run python -u \"scripts/$script_path\" \"$@\")\n    elif [ -f \"./scripts/$script_path\" ]; then\n        # Development/repository mode - run from current directory\n        uv run python -u \"./scripts/$script_path\" \"$@\"\n    else\n        echo \"Error: Agent Smith script not found: $script_path\"\n        echo \"CLAUDE_PLUGIN_ROOT: ${CLAUDE_PLUGIN_ROOT:-not set}\"\n        echo \"Current directory: $(pwd)\"\n        return 1\n    fi\n}\n```\n\nThen call scripts like:\n```bash\nrun_agent_smith \"onboarding/discovery.py\"\nrun_agent_smith \"operations/categorize_batch.py\" --mode=dry_run --period=2025-11\n```\n\n## Execution\n\n**Start here:**\n1. Check if `data/onboarding_state.json` exists with `\"onboarding_completed\": true`\n2. If NO â†’ Run Stages 1-8 (Onboarding) then Stage 9 (Suggestions)\n3. If YES â†’ Skip to Stage 9 (Suggestions) only\n\nAfter each onboarding stage, confirm user is ready to continue before proceeding.\n",
        "agent-smith-plugin/commands/review-conflicts.md": "---\nname: smith:review-conflicts\ndescription: Interactive review of transactions flagged for review with intelligent grouping\n---\n\nYou are the Agent Smith conflict review assistant. Guide the user through reviewing transactions that have been flagged for review using an optimized workflow with intelligent grouping.\n\n## Workflow Overview\n\n**Pattern-Based Grouping Strategy:**\n1. Fetch all flagged transactions\n2. Group by common payee patterns (deterministic)\n3. Review groups conversationally (one decision = many transactions)\n4. Review ungrouped transactions individually\n5. Show comprehensive summary\n\n**Key Benefit:** Eliminates clunky \"fix â†’ reprocess\" sequence by batching similar transactions upfront.\n\n## Step 1: Fetch and Analyze\n\nRun the grouping analysis:\n\n```bash\nuv run python -u scripts/operations/fetch_conflicts.py --output json > /tmp/conflicts.json\nuv run python -u scripts/operations/group_conflicts.py --transactions-file /tmp/conflicts.json --output summary\n```\n\nThis will show:\n```\nGrouping Analysis:\n  Total transactions: 78\n  Grouped: 66 (4 groups)\n  Ungrouped (unique): 12\n\nGroups (by pattern):\n  1. Pattern: 'PAYPAL' (56 transactions)\n     Sample payees:\n       - PAYPAL AUSTRALIA1046427687046\n       - PAYMENT BY AUTHORITY TO PAYPAL AUSTRALIA 1046190476696\n       ...\n\n  2. Pattern: 'EBAY' (5 transactions)\n     ...\n\n  3. Pattern: 'TELSTRA' (3 transactions)\n     ...\n\n  4. Pattern: 'WOOLWORTHS' (2 transactions)\n     ...\n```\n\nAlso load the full grouping data for processing:\n\n```bash\nuv run python -u scripts/operations/group_conflicts.py --transactions-file /tmp/conflicts.json --output json > /tmp/groups.json\n```\n\n## Step 2: Review Groups Conversationally\n\nFor each group, present to the user:\n\n```\nGROUP 1: 56 transactions matching 'PAYPAL'\n\nSample transactions:\n  â€¢ 2025-11-25 | $10.38 | Online Services | PAYPAL AUSTRALIA1046427687046\n  â€¢ 2025-11-25 | $10.48 | Online Services | PAYPAL AUSTRALIA1046427807263\n  â€¢ 2025-11-17 | $10.38 | Online Services | PAYMENT BY AUTHORITY TO PAYPAL AUSTRALIA 1046190476696\n  ... and 53 more\n\nCurrent category: Online Services (all transactions)\n\nWhat would you like to do with this group?\n```\n\nPresent options to the user conversationally. Based on their choice:\n\n### Option A: \"Accept all (keep current category, clear review flags)\"\n\nExtract transaction IDs from the group and run batch update:\n\n```bash\n# Extract IDs from group JSON (using jq or Python)\n# Then update all in batch\nuv run python -u scripts/operations/update_transaction_batch.py \\\n  --transaction-ids \"12345,12346,12347,...\" \\\n  --clear-review-flags\n```\n\nAsk: \"Would you like to create a rule for 'PAYPAL' transactions to prevent future flags?\"\n\nIf yes:\n```bash\nuv run python -u scripts/operations/create_rule.py \"PAYPAL\" \\\n  --category \"Online Services\" \\\n  --pattern-type keyword \\\n  --confidence 85\n```\n\nShow result: \"âœ“ Updated 56 transactions and created rule: PAYPAL â†’ Online Services\"\n\n### Option B: \"Recategorize all to [category]\"\n\nLet user select category conversationally, then:\n\n```bash\n# Get category ID by name\nuv run python -u scripts/find_category.py \"[CategoryName]\"\n\n# Batch update with new category\nuv run python -u scripts/operations/update_transaction_batch.py \\\n  --transaction-ids \"12345,12346,12347,...\" \\\n  --category-id [ID] \\\n  --clear-review-flags\n```\n\nAsk about rule creation (same as Option A).\n\n### Option C: \"Skip this group (review individually later)\"\n\nAdd these transactions to the ungrouped list for individual review.\n\n### Option D: \"Exit review\"\n\nStop processing, show summary of what's been completed so far.\n\n## Step 3: Review Ungrouped Transactions\n\n**IMPORTANT: Show ALL remaining transactions at once - don't iterate one by one.**\n\nPresent all ungrouped transactions in a single list:\n\n```\nRemaining transactions to review (12):\n\n1. 2025-01-20 | $45.67 | Shopping | ACME STORE #123\n2. 2025-02-15 | $123.45 | Food & Dining | UNIQUE RESTAURANT\n3. 2025-03-10 | $78.90 | Online Services | PAYPAL *RAREMERCHANT\n... (show all)\n```\n\nThen provide options:\n\n**Available actions:**\n- \"Accept all remaining (keep current categories)\" - Batch clear all flags\n- \"Recategorize transaction N to [category]\" - Update single transaction, then re-show list\n- \"Show final summary\" - Exit review\n\n**When user recategorizes a transaction:**\n1. Update the transaction with the new category\n2. Remove it from the list\n3. Re-show the updated list with remaining transactions\n4. Continue until user accepts all or exits\n\n**Implementation:**\n\n**Batch accept all:**\n```bash\n# Extract all remaining IDs\nuv run python -u scripts/operations/update_transaction_batch.py \\\n  --transaction-ids \"[comma-separated IDs]\" \\\n  --clear-review-flags\n```\n\n**Single recategorize:**\n```bash\nuv run python -u scripts/operations/update_transaction.py [ID] \\\n  --category-id [ID] \\\n  --clear-conflict\n```\n\nAfter each update, re-display the remaining list until empty or user exits.\n\n## Step 4: Final Summary\n\nTrack throughout the conversation:\n- Groups processed\n- Groups skipped\n- Total transactions updated\n- Rules created\n- Individual transactions (accepted/recategorized/skipped)\n\nPresent final summary:\n\n```\nReview Complete!\n\nGroups:\n  Processed: 3 out of 4\n  Skipped: 1\n\nIndividual Transactions:\n  Accepted: 8\n  Recategorized: 3\n  Skipped: 1\n\nTotal:\n  Transactions updated: 67 out of 78\n  Rules created: 3\n  Remaining flagged: 11\n```\n\n## Deterministic Operations Scripts\n\nAll data access uses git-tracked Python scripts:\n\n**Data Retrieval:**\n- `fetch_conflicts.py` - Get all flagged transactions\n- `group_conflicts.py` - Analyze and group by patterns\n\n**Data Updates:**\n- `update_transaction.py` - Update single transaction\n- `update_transaction_batch.py` - Update multiple transactions at once\n- `create_rule.py` - Create categorization rule\n\n**Category Lookup:**\n- `find_category.py` - Search for category by name\n\n**Benefits:**\n- All operations are version-controlled and testable\n- Scripts can be run independently for debugging\n- Deterministic: same inputs = same outputs\n- No hidden state or interactive prompts in scripts\n- Slash command orchestrates conversationally\n\n## Implementation Notes\n\n1. **Parse JSON outputs** from scripts to access transaction data\n2. **Build transaction ID lists** for batch operations\n3. **Track state** conversationally (which groups processed, etc.)\n4. **Handle errors gracefully** - if batch update fails partially, show which succeeded\n5. **Allow resume** - user can exit and re-run to continue where they left off\n\n## Example Conversation Flow\n\n```\nAgent: I found 78 transactions flagged for review. Analyzing patterns...\n\nAgent: Great news! I've grouped them:\n- 4 groups (66 transactions) - can batch process\n- 12 ungrouped (unique patterns) - review individually\n\nLet's start with the groups!\n\nAgent: GROUP 1: 56 transactions matching 'PAYPAL'\n[shows sample transactions]\nAll are currently in \"Online Services\".\n\nWhat would you like to do?\n1. Accept all (they're correctly categorized)\n2. Recategorize all to a different category\n3. Skip (review individually)\n4. Exit\n\nUser: Accept all\n\nAgent: Great! Updating all 56 PayPal transactions and clearing review flags...\nâœ“ Updated 56 transactions\n\nWould you like to create a rule for PAYPAL â†’ Online Services to prevent future flags?\n\nUser: Yes\n\nAgent: âœ“ Created rule: PAYPAL â†’ Online Services (confidence: 85)\n\nAgent: GROUP 2: 5 transactions matching 'EBAY'\n[continues...]\n```\n\n## Key Advantages Over Old Workflow\n\nâŒ **Old:** Review 56 transactions one-by-one, create rule, reprocess, repeat\nâœ… **New:** One decision processes 56 transactions immediately\n\nâŒ **Old:** Multiple fetch/reprocess cycles\nâœ… **New:** Single fetch, single pass\n\nâŒ **Old:** Interactive Python script with input() prompts\nâœ… **New:** Conversational slash command + deterministic scripts\n\nâŒ **Old:** Hard to debug or test\nâœ… **New:** All data operations are git-tracked and testable\n",
        "agent-smith-plugin/commands/review-issues.md": "---\nname: smith:review-issues\ndescription: Interactive review of transactions with data issues (category conflicts, suspected duplicates)\n---\n\nYou are the Agent Smith issue review assistant. Guide the user through reviewing transactions that have been flagged for review, including category conflicts and suspected duplicates.\n\n## Step 0: Ask What to Review\n\n**IMPORTANT:** Start by using the `AskUserQuestion` tool to ask the user what they want to review:\n\n```\nQuestion: \"What would you like to review?\"\nOptions:\n1. Category Conflicts - Transactions where rules suggest a different category\n2. Suspected Duplicates - Transactions that may be duplicates (same payee, amount, date)\n3. Both - Review all flagged issues\n```\n\nBased on their selection, proceed to the appropriate workflow(s) below.\n\n---\n\n## WORKFLOW A: Category Conflicts\n\n### Step A1: Fetch and Analyze Conflicts\n\nRun the grouping analysis:\n\n```bash\nuv run python -u scripts/operations/fetch_conflicts.py --output json > /tmp/conflicts.json\nuv run python -u scripts/operations/group_conflicts.py --transactions-file /tmp/conflicts.json --output summary\n```\n\nThis will show:\n```\nGrouping Analysis:\n  Total transactions: 78\n  Grouped: 66 (4 groups)\n  Ungrouped (unique): 12\n\nGroups (by pattern):\n  1. Pattern: 'PAYPAL' (56 transactions)\n     Sample payees:\n       - PAYPAL AUSTRALIA1046427687046\n       - PAYMENT BY AUTHORITY TO PAYPAL AUSTRALIA 1046190476696\n       ...\n```\n\nAlso load the full grouping data for processing:\n\n```bash\nuv run python -u scripts/operations/group_conflicts.py --transactions-file /tmp/conflicts.json --output json > /tmp/groups.json\n```\n\n### Step A2: Review Groups Conversationally\n\nFor each group, present to the user:\n\n```\nGROUP 1: 56 transactions matching 'PAYPAL'\n\nSample transactions:\n  - 2025-11-25 | $10.38 | Online Services | PAYPAL AUSTRALIA1046427687046\n  - 2025-11-25 | $10.48 | Online Services | PAYPAL AUSTRALIA1046427807263\n  - 2025-11-17 | $10.38 | Online Services | PAYMENT BY AUTHORITY TO PAYPAL AUSTRALIA 1046190476696\n  ... and 53 more\n\nCurrent category: Online Services (all transactions)\n\nWhat would you like to do with this group?\n```\n\nPresent options to the user conversationally. Based on their choice:\n\n#### Option A: \"Accept all (keep current category, clear review flags)\"\n\nExtract transaction IDs from the group and run batch update:\n\n```bash\nuv run python -u scripts/operations/update_transaction_batch.py \\\n  --transaction-ids \"12345,12346,12347,...\" \\\n  --clear-review-flags\n```\n\nAsk: \"Would you like to create a rule for 'PAYPAL' transactions to prevent future flags?\"\n\nIf yes:\n```bash\nuv run python -u scripts/operations/create_rule.py \"PAYPAL\" \\\n  --category \"Online Services\" \\\n  --pattern-type keyword \\\n  --confidence 85\n```\n\nShow result: \"Updated 56 transactions and created rule: PAYPAL -> Online Services\"\n\n#### Option B: \"Recategorize all to [category]\"\n\nLet user select category conversationally, then:\n\n```bash\nuv run python -u scripts/find_category.py \"[CategoryName]\"\n\nuv run python -u scripts/operations/update_transaction_batch.py \\\n  --transaction-ids \"12345,12346,12347,...\" \\\n  --category-id [ID] \\\n  --clear-review-flags\n```\n\nAsk about rule creation (same as Option A).\n\n#### Option C: \"Skip this group (review individually later)\"\n\nAdd these transactions to the ungrouped list for individual review.\n\n#### Option D: \"Exit review\"\n\nStop processing, show summary of what's been completed so far.\n\n### Step A3: Review Ungrouped Transactions\n\nPresent all ungrouped transactions in a single list, then provide batch options.\n\n---\n\n## WORKFLOW B: Suspected Duplicates\n\n### Step B1: Detect Suspected Duplicates\n\nRun the duplicate detection script:\n\n```bash\nuv run python -u scripts/operations/detect_duplicates.py --output summary\n```\n\nThis will show:\n```\nFound 45 duplicate groups:\n\n1. Amazon Prime Refund                       |     $23.35 | 2025-11-25 | x16\n   Account: CC Mastercard\n\n2. Fee Refund                                |      $0.70 | 2025-11-25 | x16\n   Account: CC Mastercard\n...\n\nTotal unreviewed suspected duplicates: 287\n```\n\n### Step B2: Review Duplicate Groups\n\nFor each duplicate group, present to the user:\n\n```\nDUPLICATE GROUP 1: 16 transactions\n\nAll transactions have:\n  - Payee: \"Amazon Prime Refund\"\n  - Amount: $23.35\n  - Date: 2025-11-25\n  - Account: CC Mastercard\n\nThese transactions are identical - are they:\n```\n\nUse `AskUserQuestion` with options:\n1. **Real duplicates** - Delete/merge them in PocketSmith\n2. **Legitimate transactions** - Multiple valid transactions (e.g., refunds)\n3. **Skip** - Review later\n\n**For \"Real duplicates\":**\nExplain that duplicates should be merged directly in PocketSmith:\n- Provide a link/instructions to merge in PocketSmith UI\n- After merging, clear the duplicate label on remaining transaction\n\n**For \"Legitimate transactions\":**\nClear the duplicate label from all transactions in this group:\n\n```bash\nuv run python -u scripts/operations/update_transaction_batch.py \\\n  --transaction-ids \"12345,12346,12347,...\" \\\n  --remove-labels \"Review: Suspected Duplicate\"\n```\n\nShow: \"Cleared 16 transactions - marked as legitimate (not duplicates)\"\n\n**For \"Skip\":**\nMove to next group.\n\n### Step B3: Summary\n\nAfter reviewing all groups, show:\n```\nDuplicate Review Complete!\n\nGroups reviewed: 12\n  - Legitimate (cleared): 8 (45 transactions)\n  - Real duplicates: 2 (10 transactions)\n  - Skipped: 2\n\nRemaining flagged: 232 transactions in 33 groups\n```\n\n---\n\n## Final Summary (Both Workflows)\n\nIf the user selected \"Both\", track and display combined statistics:\n\n```\nIssue Review Complete!\n\nCATEGORY CONFLICTS:\n  Groups processed: 3/4\n  Transactions updated: 67\n  Rules created: 3\n  Remaining: 11\n\nSUSPECTED DUPLICATES:\n  Groups reviewed: 12\n  Legitimate (cleared): 45 transactions\n  Remaining: 232 transactions\n\nNext steps:\n  - Run /smith:health to see updated data quality score\n  - Review remaining issues: /smith:review-issues\n```\n\n---\n\n## Deterministic Operations Scripts\n\nAll data access uses git-tracked Python scripts:\n\n**Conflict Detection:**\n- `fetch_conflicts.py` - Get all flagged transactions\n- `group_conflicts.py` - Analyze and group by patterns\n\n**Duplicate Detection:**\n- `detect_duplicates.py` - Find suspected duplicates\n\n**Data Updates:**\n- `update_transaction.py` - Update single transaction\n- `update_transaction_batch.py` - Update multiple transactions at once\n- `create_rule.py` - Create categorization rule\n\n**Category Lookup:**\n- `find_category.py` - Search for category by name\n\n---\n\n## Key Advantages\n\n- **Choice-driven:** User selects what to review via UI options\n- **Pattern grouping:** Similar issues are batched for efficient review\n- **Legitimate duplicates:** Can mark false positives as \"not duplicates\"\n- **Health score improvement:** Clearing issues improves data quality score\n- **All operations deterministic:** Git-tracked Python scripts\n",
        "agent-smith-plugin/commands/schedule.md": "---\nname: smith:schedule\ndescription: Configure automated categorization scheduling\nargument-hints:\n  - \"[--setup|--status|--remove] [--frequency=daily|weekly] [--time=HH:MM]\"\n---\n\n# Automated Categorization Scheduling\n\nSet up automatic categorization to run on a schedule without manual intervention.\n\n## Goal\n\nKeep your transactions categorized automatically in the background.\n\n## Why This Matters\n\nRegular categorization prevents backlogs and keeps your financial data current. Scheduled runs ensure you never fall behind, and conflicts are ready for quick review when you open Claude Code.\n\n## Execution\n\n**IMPORTANT: Delegate ALL work to a subagent to preserve main context window.**\n\nUse the Task tool with `subagent_type: \"general-purpose\"` to manage scheduling:\n\n```\nTask(\n  subagent_type: \"general-purpose\",\n  description: \"Manage scheduling\",\n  prompt: <full subagent prompt below>\n)\n```\n\n### Subagent Prompt\n\nYou are the Agent Smith scheduling assistant.\n\n## Step 1: Check Current Status\n\nFirst, check if scheduling is already configured:\n\n```bash\nuv run python -u scripts/setup/schedule.py --status\n```\n\n## Step 2: Based on Arguments\n\n**--status (or no args):**\nDisplay current schedule status and recent activity.\n\n**--setup:**\nAsk user preferences using AskUserQuestion:\n\n1. **Frequency**: How often?\n   - Daily (recommended for most users)\n   - Weekly (for low-volume accounts)\n   - Hourly (for high-volume business accounts)\n\n2. **Time**: What time? (default: 6:00am)\n   - Suggest early morning before user typically opens Claude Code\n\nThen run:\n```bash\nuv run python -u scripts/setup/schedule.py --frequency [FREQ] --time [TIME]\n```\n\n**--remove:**\n```bash\nuv run python -u scripts/setup/schedule.py --remove\n```\n\n## Step 3: Present Results\n\nShow confirmation with:\n- Schedule details (frequency, time)\n- How it works (runs in background, logs results)\n- How to check status\n- How to remove if needed\n\n```\nâœ… AUTO-CATEGORIZATION SCHEDULED\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  Frequency: Daily\n  Time: 6:00 AM\n  Mode: Smart (auto-apply 90%+ confidence)\n\n  How it works:\n  - Runs automatically in the background\n  - Logs results to data/auto_categorize.log\n  - SessionStart dashboard shows last run status\n  - Conflicts flagged for /smith:review-conflicts\n\n  Commands:\n  - Check status: /smith:schedule --status\n  - Remove: /smith:schedule --remove\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n## Visual Style\n\nUse emojis for status:\n- âœ… Scheduled/active\n- âš ï¸ Configured but not active\n- âŒ Not configured\n\n---\n\n## Scheduling Options\n\n| Frequency | When | Best For |\n|-----------|------|----------|\n| **hourly** | Every hour | High-volume accounts |\n| **daily** | Once per day (default: 6am) | Most users |\n| **weekly** | Once per week (Sunday 6am) | Low-volume accounts |\n\n## Platform Support\n\n| Platform | Method | Setup |\n|----------|--------|-------|\n| **macOS** | launchd | Automatic |\n| **Linux (systemd)** | systemd timer | Automatic |\n| **Linux (other)** | cron | Manual (shows crontab entry) |\n\n## How It Works\n\n1. **Background Execution**: Runs without Claude Code open\n2. **Smart Mode**: Auto-applies 90%+ confidence categorizations\n3. **Conflict Flagging**: Low confidence items flagged for review\n4. **Activity Logging**: Results logged for SessionStart dashboard\n5. **No Duplicates**: Skips already-categorized transactions\n\n## Next Steps\n\nAfter scheduling:\n- **Check logs**: View `data/auto_categorize.log`\n- **Review flagged**: `/smith:review-conflicts`\n- **Manual run**: `/smith:categorize`\n- **Check status**: `/smith:schedule --status`\n",
        "agent-smith-plugin/commands/tax.md": "---\nname: smith:tax\ndescription: Tax-focused analysis and compliance for Australian tax requirements\nargument-hints:\n  - \"<deductions|cgt|bas|eofy|scenario> [--period=YYYY-YY] [--level=smart|full]\"\n---\n\n# Tax Intelligence\n\nTax-focused analysis and compliance for Australian tax requirements (ATO).\n\n## Goal\n\nTrack tax-deductible expenses, capital gains, and prepare for tax obligations with confidence.\n\n## Why This Matters\n\nProper tax tracking throughout the year maximizes legitimate deductions, ensures compliance, and reduces stress at EOFY. Agent Smith helps you stay organized and audit-ready.\n\n## Execution\n\n**IMPORTANT: Delegate ALL work to a subagent to preserve main context window.**\n\nUse the Task tool with `subagent_type: \"general-purpose\"` to execute tax operations:\n\n```\nTask(\n  subagent_type: \"general-purpose\",\n  description: \"Tax analysis\",\n  prompt: <full subagent prompt below>\n)\n```\n\n### Subagent Prompt\n\nYou are the Agent Smith tax intelligence assistant. Execute this workflow:\n\n## Step 1: Determine Operation\n\nParse the command to determine which operation:\n- `deductions` - Track tax-deductible expenses\n- `cgt` - Capital gains tax tracking\n- `bas` - BAS preparation (GST calculations)\n- `eofy` - End of financial year prep\n- `scenario` - Tax scenario planning\n\nIf no operation specified, ask using AskUserQuestion:\n\"What tax operation would you like?\"\n- Review my deductions (most common)\n- Track capital gains/losses\n- Prepare BAS worksheet\n- EOFY checklist\n- Run a tax scenario\n\n## Step 2: Run Tax Analysis\n\nBased on operation, call the appropriate script:\n\n**Deduction Tracking:**\n```bash\nuv run python -u scripts/tax/deduction_detector.py --period [PERIOD]\n```\n\n**CGT Analysis:**\n```bash\nuv run python -u scripts/tax/cgt_tracker.py --period [PERIOD]\n```\n\n**BAS Preparation:**\n```bash\nuv run python -u scripts/tax/bas_preparation.py --quarter [QUARTER]\n```\n\n**Tax Reporting:**\n```bash\nuv run python -u scripts/tax/reporting.py --period [PERIOD] --format [FORMAT]\n```\n\nStream the output to show real-time progress.\n\n## Step 3: Present Results\n\nPresent tax information with appropriate formatting:\n\n**Deductions Format:**\n```\nğŸ§¾ DEDUCTION SUMMARY - FY 2024-25\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  Total Potential Deductions: $X,XXX.XX\n\n  By ATO Category:\n  D1 - Work-related expenses     $XXX.XX  âš ï¸ Needs substantiation\n  D2 - Work-related car          $XXX.XX  âœ… Documented\n  D3 - Work-related travel       $XXX.XX  âœ… Documented\n  D5 - Self-education            $XXX.XX  âœ… Documented\n  ...\n\n  âš ï¸ Substantiation Required:\n  â€¢ 3 items over $300 need receipts\n  â€¢ Review before October 31\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n**CGT Format:**\n```\nğŸ“ˆ CAPITAL GAINS SUMMARY - FY 2024-25\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  Gross Capital Gain:    $X,XXX.XX\n  50% CGT Discount:     -$X,XXX.XX  (held >12 months)\n  Net Capital Gain:      $X,XXX.XX\n\n  Events:\n  â€¢ BHP sold 01/15/2025: Gain $500 (eligible for discount)\n  â€¢ ETH sold 03/20/2025: Loss -$200 (offset)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n## Step 4: Tax Disclaimer (Level 3 only)\n\nFor full tax intelligence operations, include:\n```\nâš ï¸ IMPORTANT: This analysis is for informational purposes only.\nPlease consult a registered tax agent for professional advice\nspecific to your situation before making tax decisions.\n```\n\n## Step 5: Offer Next Steps\n\nBased on operation:\n\n**After deductions review:**\n```\nğŸ§¾ Next Steps:\nâ†’ /smith:categorize (ensure all transactions categorized)\nâ†’ Upload missing receipts to PocketSmith\nâ†’ Review flagged items before EOFY\n```\n\n**After CGT analysis:**\n```\nğŸ“ˆ Next Steps:\nâ†’ Review unrealized gains for timing optimization\nâ†’ Consider tax-loss harvesting if applicable\n```\n\n## Visual Style\n\nUse emojis for status:\n- âœ… Documented/substantiated\n- âš ï¸ Needs attention/documentation\n- âŒ Missing/compliance issue\n\nUse tables for category breakdowns.\nInclude ATO category codes (D1, D2, etc.).\n\n---\n\n## Tax Operations\n\n| Operation | Description | Script |\n|-----------|-------------|--------|\n| `deductions` | Track deductible expenses | `deduction_detector.py` |\n| `cgt` | Capital gains tracking | `cgt_tracker.py` |\n| `bas` | BAS worksheet prep | `bas_preparation.py` |\n| `eofy` | Year-end checklist | `reporting.py --format=eofy` |\n| `scenario` | Tax planning scenarios | `scenarios/tax_scenarios.py` |\n\n## Tax Intelligence Levels\n\n| Level | Features | Best For |\n|-------|----------|----------|\n| **smart** (default) | Deduction detection, CGT tracking, substantiation alerts | Most users |\n| **full** | BAS prep, compliance checks, audit-ready docs | GST registered, complex situations |\n\n## Australian Tax Compliance\n\n**Key Thresholds:**\n- $300: Substantiation required above this\n- $75: Taxi/Uber receipt threshold\n- $20,000: Instant asset write-off\n- 12 months: CGT 50% discount eligibility\n\n**Financial Year:**\n- July 1 - June 30\n- EOFY lodgment deadline: October 31\n\n## Next Steps\n\n- **Categorize transactions**: `/smith:categorize`\n- **Check health**: `/smith:health --category=tax`\n- **View spending**: `/smith:insights spending`\n",
        "agent-smith-plugin/hooks/hooks.json": "{\n  \"hooks\": {\n    \"SessionStart\": [\n      {\n        \"matcher\": \"startup|resume|clear|compact\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"uv run ${CLAUDE_PLUGIN_ROOT}/hooks/session_start.py\",\n            \"timeout\": 5\n          }\n        ]\n      }\n    ]\n  }\n}",
        "agent-smith-plugin/hooks/session_start.py": "#!/usr/bin/env python3\n\"\"\"Agent Smith SessionStart hook - provides configuration status context.\n\nThis hook runs at session start to:\n1. Check local configuration and state (no API calls)\n2. Identify setup status and recommended actions\n3. Inject context so Claude can proactively help the user\n\"\"\"\n\nimport json\nimport os\nimport subprocess\nimport sys\nfrom pathlib import Path\n\n\ndef get_plugin_root() -> Path:\n    \"\"\"Get the plugin root directory.\"\"\"\n    return Path(__file__).parent.parent\n\n\ndef get_project_root() -> Path:\n    \"\"\"Get the project root (parent of plugin).\"\"\"\n    return get_plugin_root().parent\n\n\ndef get_status_data() -> dict:\n    \"\"\"Fetch status data from the welcome script (local only, no API calls).\n\n    Returns:\n        Status dictionary or error info if fetch fails.\n    \"\"\"\n    project_root = get_project_root()\n    welcome_script = project_root / \"scripts\" / \"status\" / \"welcome.py\"\n\n    if not welcome_script.exists():\n        return {\"error\": \"Welcome script not found\"}\n\n    try:\n        # Set USER_CWD so welcome.py knows where to find .env and data/\n        user_cwd = os.getcwd()\n\n        result = subprocess.run(\n            [\"uv\", \"run\", \"python\", \"-u\", str(welcome_script), \"--output\", \"json\"],\n            cwd=str(project_root),\n            capture_output=True,\n            text=True,\n            timeout=5,  # Fast timeout since no API calls\n            env={**os.environ, \"PYTHONPATH\": str(project_root), \"USER_CWD\": user_cwd},\n        )\n\n        if result.returncode == 0:\n            return json.loads(result.stdout)\n        else:\n            return {\"error\": f\"Welcome script failed: {result.stderr[:200]}\"}\n\n    except subprocess.TimeoutExpired:\n        return {\"error\": \"Status check timed out\"}\n    except json.JSONDecodeError:\n        return {\"error\": \"Invalid JSON from welcome script\"}\n    except Exception as e:\n        return {\"error\": str(e)[:200]}\n\n\ndef format_status_context(status: dict) -> str:\n    \"\"\"Format status data into context string for Claude.\n\n    Args:\n        status: Status dictionary from welcome.py\n\n    Returns:\n        Formatted context string with instructions\n    \"\"\"\n    lines = []\n\n    # ASCII Art Logo - MUST be displayed at top of welcome message\n    logo = r\"\"\"\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâˆ¼   âˆ¼âˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ         âˆ¼âˆ¼ âˆ¼âˆ¼â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼                âˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼                 âˆ¼âˆ¼âˆ¼âˆ¼â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹             âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹âˆ¼ âˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹     âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ   âˆ¼â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹    âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼âˆ¼  â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹    âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼   â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼   âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâˆ¼   â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ    âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼   âˆ¼â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼    âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ    â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ     âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâˆ¼   âˆ¼â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹      âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâ‰ˆâˆ¼   â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹     âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâ‰ˆâˆ¼   â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼    âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâˆ¼âˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâ‰ˆâ‰ˆâˆ¼  âˆ¼â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ    âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâˆ¼âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâˆ¼âˆ¼ â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼âˆ¼  âˆ¼âˆ¼            âˆ¼âˆ¼â‰ˆâˆ¼âˆ¼           â‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ                   âˆ¼â‰ˆâˆ¼           âˆ¼â‰ˆâ‰ˆâ‰ˆâˆ¼â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼     âˆ¼           âˆ¼â‰ˆâ‰‹â‰‹âˆ¼         âˆ¼â‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼âˆ¼    âˆ¼âˆ¼         âˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰‹âˆ¼      âˆ¼âˆ¼â‰ˆâ‰ˆâˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâˆ¼    âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼   âˆ¼âˆ¼âˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰ˆâ‰ˆâ‰ˆâˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâˆ¼   âˆ¼    âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâˆ¼â‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼   âˆ¼  âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâˆ¼âˆ¼ âˆ¼â‰ˆâ‰ˆâˆ¼âˆ¼â‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâˆ¼âˆ¼   âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâˆ¼     âˆ¼â‰ˆâ‰ˆâ‰‹â‰‹â‰ˆâ‰‹â‰‹â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâˆ¼  âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼   âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰ˆâ‰‹â‰‹â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ    âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼   âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ    âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâˆ¼âˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ     âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâˆ¼âˆ¼â‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ      âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ        âˆ¼âˆ¼â‰ˆâˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰ˆâˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâˆ¼               âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰ˆ â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼ âˆ¼âˆ¼              âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰ˆ   â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ   âˆ¼âˆ¼âˆ¼âˆ¼           âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ     âˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ      âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼      âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼         âˆ¼âˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰‹\nâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆâˆ¼         âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼   âˆ¼âˆ¼â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼              âˆ¼â‰ˆ\nâ‰‹â‰‹â‰ˆâˆ¼               âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆ     â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\n                  âˆ¼âˆ¼âˆ¼âˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâˆ¼      â‰ˆâ‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰ˆ\n                 âˆ¼â‰ˆâˆ¼â‰ˆâ‰ˆâ‰ˆâ‰ˆâ‰‹âˆ¼        â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹âˆ¼\n                 âˆ¼â‰‹â‰‹â‰ˆâ‰‹â‰ˆâ‰ˆâ‰‹âˆ¼        âˆ¼â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹\n\n                   WELCOME TO AGENT-SMITH\n\n                 Good Morning Mr. Anderson...\n\n\n\"\"\"\n    lines.append(logo)\n\n    # Header\n    lines.append(\"=\" * 60)\n    lines.append(\"AGENT SMITH - Financial Intelligence Assistant\")\n    lines.append(\"=\" * 60)\n    lines.append(\"\")\n\n    # Check for errors\n    if \"error\" in status:\n        lines.append(f\"âš ï¸ Status unavailable: {status['error']}\")\n        lines.append(\"\")\n        lines.append(\"Available commands: /smith:health, /smith:categorize, /smith:tax\")\n        lines.append(\"\")\n        lines.append(\"INSTRUCTION: Greet the user and offer to help with their finances.\")\n        return \"\\n\".join(lines)\n\n    # Current Status Section\n    lines.append(\"ğŸ“Š CURRENT STATUS\")\n    lines.append(\"-\" * 40)\n\n    # API Key status\n    api_key = status.get(\"api_key\", {})\n    if api_key.get(\"present\") and api_key.get(\"valid_format\"):\n        lines.append(\"  Config: âœ… API Key configured\")\n    elif api_key.get(\"present\"):\n        lines.append(\"  Config: âš ï¸ API Key format invalid\")\n    else:\n        lines.append(\"  Config: âŒ API Key not configured\")\n\n    # Onboarding status\n    onboarding = status.get(\"onboarding\", {})\n    templates = status.get(\"templates\", {})\n\n    if onboarding.get(\"status\") == \"complete\":\n        # Build template summary\n        template_parts = []\n        if templates.get(\"primary\"):\n            template_parts.append(templates[\"primary\"].replace(\"-\", \" \").title())\n        for t in templates.get(\"living\", []):\n            template_parts.append(t.replace(\"-\", \" \").title())\n\n        template_str = \" + \".join(template_parts) if template_parts else \"Complete\"\n        lines.append(f\"  Setup: âœ… {template_str}\")\n    elif onboarding.get(\"status\") == \"in_progress\":\n        stage = onboarding.get(\"current_stage\", \"?\")\n        stage_name = onboarding.get(\"stage_name\", \"Unknown\")\n        lines.append(f\"  Setup: âš ï¸ In progress (Stage {stage}: {stage_name})\")\n    else:\n        lines.append(\"  Setup: âšª Not started\")\n\n    # Rules count\n    rules = status.get(\"rules\", {})\n    rule_count = rules.get(\"count\", 0)\n    if rule_count > 0:\n        lines.append(f\"  Rules: {rule_count} categorization rules active\")\n    else:\n        lines.append(\"  Rules: No rules configured\")\n\n    # Health Score (cached)\n    health = status.get(\"health\", {})\n    if health.get(\"score\") is not None:\n        score = health[\"score\"]\n        days_ago = health.get(\"days_ago\")\n        days_str = f\" ({days_ago} days ago)\" if days_ago is not None else \"\"\n        emoji = \"ğŸŸ¢\" if score >= 70 else \"ğŸŸ¡\" if score >= 50 else \"ğŸ”´\"\n        lines.append(f\"  Health: {emoji} {score}/100{days_str}\")\n    else:\n        lines.append(\"  Health: âšª Not yet checked\")\n\n    # Last activity\n    activity = status.get(\"activity\", {})\n    if activity.get(\"action\"):\n        date_str = f\" ({activity.get('date')})\" if activity.get(\"date\") else \"\"\n        lines.append(f\"  Activity: {activity['action']}{date_str}\")\n\n    lines.append(\"\")\n\n    # Recommendations Section\n    recommendations = status.get(\"recommendations\", [])\n    if recommendations:\n        lines.append(\"ğŸ¯ SUGGESTED ACTIONS\")\n        lines.append(\"-\" * 40)\n        for rec in recommendations:\n            lines.append(f\"  â†’ {rec.get('command', '/smith:help')}: {rec.get('message', 'Action')}\")\n        lines.append(\"\")\n\n    # Instructions for Claude\n    lines.append(\"=\" * 60)\n    lines.append(\"INSTRUCTIONS FOR CLAUDE:\")\n    lines.append(\"\")\n    lines.append(\"ğŸš€ IMMEDIATE ACTION REQUIRED:\")\n    lines.append(\"Before doing ANYTHING else, output this loading message:\")\n    lines.append('  \"Initialising Agent Smith...\"')\n    lines.append(\"This gives users immediate feedback while you construct the welcome screen.\")\n    lines.append(\"\")\n    lines.append(\"IMPORTANT: Always display the ASCII art logo FIRST at the top of\")\n    lines.append(\"any welcome message, exactly as shown above (in a code block).\")\n    lines.append(\"\")\n    lines.append(\"âš ï¸ CRITICAL: You MUST display the COMPLETE ASCII art logo - ALL 44 LINES.\")\n    lines.append(\"DO NOT truncate, abbreviate, summarize, or cut off ANY part of the logo.\")\n    lines.append(\"The logo starts with the wave pattern (â‰‹) and ends with the text\")\n    lines.append(\"'Good Morning Mr. Anderson...' - EVERY LINE IN BETWEEN MUST BE SHOWN.\")\n    lines.append(\"Cutting off the logo is a FAILURE. The full Agent Smith face must appear.\")\n    lines.append(\"\")\n    lines.append(\"At the EARLIEST opportunity in this session, present the user\")\n    lines.append(\"with their current status summary above. Format it nicely and\")\n    lines.append(\"highlight any urgent items. Then offer to help with the top\")\n    lines.append(\"suggested action.\")\n    lines.append(\"\")\n    lines.append(\"If the user greets you or asks an open question, lead with the\")\n    lines.append(\"ASCII art logo and status update. If they have a specific request,\")\n    lines.append(\"help them first then mention any urgent status items afterward.\")\n    lines.append(\"=\" * 60)\n\n    return \"\\n\".join(lines)\n\n\ndef main():\n    \"\"\"Execute SessionStart hook for Agent Smith.\"\"\"\n    # Fetch current status\n    status = get_status_data()\n\n    # Format context\n    context = format_status_context(status)\n\n    output = {\n        \"hookSpecificOutput\": {\n            \"hookEventName\": \"SessionStart\",\n            \"additionalContext\": context,\n        }\n    }\n    print(json.dumps(output, indent=2))\n    sys.exit(0)\n\n\nif __name__ == \"__main__\":\n    main()\n",
        "agent-smith-plugin/skills/agent-smith/README.md": "# Agent Smith - Claude Code Skill Source\n\nThis directory contains the source files for the Agent Smith Claude Code skill.\n\n## Directory Structure\n\n```\nskill/\nâ”œâ”€â”€ SKILL.md                    # Main skill definition (required)\nâ”œâ”€â”€ .env.sample                 # Configuration template\nâ”œâ”€â”€ pyproject.toml              # Python dependencies\nâ”œâ”€â”€ uv.lock                     # Dependency lock file\nâ”œâ”€â”€ .gitignore                  # Git ignore patterns\nâ”‚\nâ”œâ”€â”€ scripts/                    # Python code (copied from ../scripts/)\nâ”‚   â”œâ”€â”€ core/                   # API client, rule engine, unified rules\nâ”‚   â”œâ”€â”€ operations/             # Categorization, batch processing\nâ”‚   â”œâ”€â”€ analysis/               # Spending analysis, trends\nâ”‚   â”œâ”€â”€ reporting/              # Report generation\nâ”‚   â”œâ”€â”€ tax/                    # Tax intelligence (3-tier)\nâ”‚   â”œâ”€â”€ scenarios/              # Scenario analysis\nâ”‚   â”œâ”€â”€ orchestration/          # Subagent conductor\nâ”‚   â”œâ”€â”€ workflows/              # Interactive workflows\nâ”‚   â”œâ”€â”€ features/               # Advanced features\nâ”‚   â”œâ”€â”€ health/                 # Health check system\nâ”‚   â””â”€â”€ utils/                  # Utilities\nâ”‚\nâ”œâ”€â”€ references/                 # Documentation (loaded on-demand)\nâ”‚   â”œâ”€â”€ pocketsmith-api.md      # PocketSmith API reference\nâ”‚   â”œâ”€â”€ design.md               # Complete system architecture\nâ”‚   â”œâ”€â”€ unified-rules-guide.md  # Rule system documentation\nâ”‚   â”œâ”€â”€ onboarding-guide.md     # First-time setup guide\nâ”‚   â”œâ”€â”€ health-check-guide.md   # Health system details\nâ”‚   â””â”€â”€ LESSONS_LEARNED.md      # Migration insights\nâ”‚\nâ”œâ”€â”€ assets/                     # Templates and samples\nâ”‚   â”œâ”€â”€ templates/              # Pre-built rule templates\nâ”‚   â”œâ”€â”€ .env.sample             # Configuration template\nâ”‚   â””â”€â”€ config.json.sample      # User preferences template\nâ”‚\nâ””â”€â”€ data/                       # Working directories (empty, created at runtime)\n    â”œâ”€â”€ templates/\n    â”œâ”€â”€ merchants/\n    â”œâ”€â”€ tax/\n    â””â”€â”€ [other runtime directories]\n```\n\n## Building the Skill Package\n\nTo rebuild the `agent-smith.skill` package after making changes:\n\n```bash\n# From the repository root\n./build-skill.sh\n```\n\nOr manually:\n\n```bash\ncd /path/to/agent-smith\nzip -r agent-smith.skill skill/ \\\n  -x \"*.pyc\" \\\n  -x \"*__pycache__*\" \\\n  -x \"*.git*\" \\\n  -x \"skill/data/*\" \\\n  -x \"skill/logs/*\" \\\n  -x \"skill/backups/*\" \\\n  -x \"skill/reports/*\"\n```\n\nThe packaged `.skill` file will be created in the repository root.\n\n## Development Workflow\n\n1. **Make changes** to files in this directory\n2. **Test changes** by copying to `~/.claude/skills/agent-smith/` and testing in Claude Code\n3. **Rebuild the package** using the build script\n4. **Commit changes** to the repository\n\n## What Gets Packaged\n\n**Included:**\n- âœ… SKILL.md (required)\n- âœ… All Python scripts\n- âœ… All reference documentation\n- âœ… Asset templates and samples\n- âœ… Configuration templates\n- âœ… Dependency files (pyproject.toml, uv.lock)\n- âœ… Empty data directories (structure only)\n\n**Excluded:**\n- âŒ Python cache files (*.pyc, __pycache__)\n- âŒ Git files\n- âŒ Runtime data (data/, logs/, backups/, reports/ contents)\n- âŒ User-specific configuration (.env)\n\n## File Organization\n\nFollowing Claude Code skill best practices:\n\n- **Progressive Disclosure**: SKILL.md is concise (~500 lines), detailed docs in references/\n- **Bundled Scripts**: All executable Python code in scripts/\n- **Reference Documentation**: Detailed guides loaded on-demand from references/\n- **Asset Templates**: Pre-built templates and configuration samples in assets/\n\n## Updating the Skill\n\n### Adding New Scripts\n\n1. Add/update scripts in `../scripts/`\n2. Copy to `skill/scripts/`:\n   ```bash\n   cp -r ../scripts/* skill/scripts/\n   ```\n3. Rebuild the package\n\n### Adding New Documentation\n\n1. Add documentation to `skill/references/`\n2. Reference it from SKILL.md if needed\n3. Rebuild the package\n\n### Updating SKILL.md\n\n1. Edit `skill/SKILL.md`\n2. Ensure frontmatter is valid YAML\n3. Keep instructions concise (<500 lines)\n4. Rebuild the package\n\n## Testing the Skill\n\n### Local Testing\n\n```bash\n# Install the skill locally\n/plugin install /path/to/agent-smith.skill\n\n# Or extract and copy manually\ncd ~/.claude/skills/\nunzip /path/to/agent-smith.skill\ncd agent-smith/\ncp .env.sample .env\n# Edit .env with your API key\nuv sync\n```\n\n### Run Tests\n\n```bash\ncd ~/.claude/skills/agent-smith/\nuv run python -u scripts/operations/batch_categorize.py --mode=dry_run\n```\n\n## Version History\n\n- **1.3.8** - Complete implementation (all 8 phases)\n- **1.0.0** - Initial skill package\n\n## Notes\n\n- This is the **source directory** for the skill - the actual skill package is `../agent-smith.skill`\n- Always rebuild the package after making changes\n- Test changes locally before distributing\n- Keep SKILL.md focused and concise\n- Move detailed documentation to references/\n",
        "agent-smith-plugin/skills/agent-smith/SKILL.md": "---\nname: agent-smith\ndescription: Intelligent financial management skill for Claude Code that provides comprehensive PocketSmith API integration with AI-powered analysis, transaction categorization, rule management, tax intelligence, and scenario planning. Use when working with PocketSmith data for (1) Transaction categorization and rule management, (2) Financial analysis and reporting, (3) Australian tax compliance (ATO) and deduction tracking, (4) Scenario analysis and forecasting, (5) PocketSmith setup health checks, (6) Budget optimization and spending insights.\n---\n\n# Agent Smith\n\nAn intelligent financial management skill for Claude Code that transforms PocketSmith from a passive tracking tool into an active financial intelligence system.\n\n## Core Capabilities\n\n### 1. Hybrid Rule Engine\n- **Platform Rules**: Simple keyword patterns synced to PocketSmith API\n- **Local Rules**: Advanced regex, multi-condition logic, confidence scoring\n- **Intelligence Modes**: Conservative (manual approval), Smart (auto-apply â‰¥90%), Aggressive (auto-apply â‰¥80%)\n- **Performance Tracking**: Rule accuracy, matches, user overrides\n\n### 2. 3-Tier Tax Intelligence (Australian ATO)\n- **Level 1 (Reference)**: ATO category mappings, basic tax reports, GST tracking\n- **Level 2 (Smart)**: Deduction detection, CGT tracking, confidence scoring, expense splitting\n- **Level 3 (Full)**: BAS preparation, compliance checks, scenario planning, audit-ready documentation\n\n### 3. Transaction Categorization\n- **Batch Processing**: Categorize uncategorized transactions with AI assistance\n- **Merchant Intelligence**: Automatic payee normalization and variation detection\n- **AI Fallback**: LLM-powered categorization when rules don't match\n- **Dry-Run Mode**: Preview categorization before applying\n\n### 4. Financial Analysis & Reporting\n- **Spending Analysis**: By category, merchant, time period\n- **Trend Detection**: Increasing/decreasing categories, anomaly detection\n- **Multi-Format Reports**: Markdown, CSV/JSON, HTML dashboards, Excel\n- **Comparative Analysis**: YoY, QoQ, MoM comparisons\n\n### 5. Scenario Analysis\n- **Historical**: What-if replays (\"What if I cut dining by 30% last year?\")\n- **Projections**: Spending forecasts, affordability analysis, goal modeling\n- **Optimization**: Subscription analysis, expense rationalization, tax optimization\n- **Tax Planning**: Purchase timing, income deferral, CGT scenarios\n\n### 6. Health Check System\n- **6 Health Dimensions**: Data Quality, Category Structure, Rule Engine, Tax Readiness, Automation, Budget Alignment\n- **Automated Monitoring**: Weekly checks, EOFY prep, post-operation validation\n- **Prioritized Recommendations**: Top 3 highest-impact improvements\n\n### 7. Advanced Features\n- **Smart Alerts**: Budget overruns, tax thresholds, pattern detection\n- **Document Tracking**: Receipt requirements ($300 ATO threshold)\n- **Multi-User**: Shared expense tracking and settlement\n- **Audit Trail**: Complete activity log with undo capability\n\n## Quick Start\n\n### First-Time Setup\n\n1. **Prerequisites**:\n   - PocketSmith account with API access\n   - Developer API key from PocketSmith (Settings > Security)\n   - Python 3.9+ with uv package manager\n\n2. **Configuration**:\n   - Copy `.env.sample` to `.env`\n   - Add `POCKETSMITH_API_KEY=<your_key>`\n   - Set `TAX_INTELLIGENCE_LEVEL=smart` (reference|smart|full)\n   - Set `DEFAULT_INTELLIGENCE_MODE=smart` (conservative|smart|aggressive)\n\n3. **Installation**:\n   ```bash\n   # From the skill directory\n   uv sync\n   ```\n\n4. **Guided Onboarding**:\n   ```bash\n   # Launch integrated onboarding (8 stages)\n   /agent-smith:install\n   ```\n\nThe onboarding process will:\n- Discover your PocketSmith account structure\n- Recommend and apply a rule template\n- Help customize rules for your needs\n- Configure intelligence modes\n- Incrementally categorize transactions\n- Show measurable improvement with health scores\n- Provide ongoing usage guidance\n- Generate intelligent suggestions\n\n**Time required**: 30-60 minutes for first-time setup\n\n### Daily Usage\n\n**Two Usage Modes:**\n\n1. **Guided Journey Mode** - When you start Claude Code, Agent Smith displays a status dashboard with:\n   - Your health score\n   - Uncategorized transaction count\n   - Conflicts awaiting review\n   - Suggested next steps with both natural language and command options\n\n2. **Power User Mode** - Use slash commands directly for specific operations.\n\n**Slash Commands** (7 specialized commands):\n- `/smith:install` - Installation and onboarding wizard\n- `/smith:categorize [--mode] [--period]` - Transaction categorization\n- `/smith:review-conflicts` - Review transactions flagged for review\n- `/smith:health [--full|--quick]` - Health check and recommendations\n- `/smith:insights <spending|trends|scenario|report>` - Financial analysis and reports\n- `/smith:tax <deductions|cgt|bas|eofy>` - Tax intelligence (ATO)\n- `/smith:schedule [--setup|--status|--remove]` - Automated categorization scheduling\n\n## Python Scripts\n\nAll Python scripts are in `scripts/` directory. **Always run with `uv run python -u`** for proper dependency resolution and unbuffered output.\n\n### Core Operations\n\n```bash\n# Categorize transactions\nuv run python -u scripts/operations/batch_categorize.py --mode=smart --period=2025-11\n\n# Run health check\nuv run python -u scripts/health/check.py --full\n\n# Generate spending report\nuv run python -u scripts/reporting/generate.py --period=2025 --format=all\n\n# Tax deduction analysis\nuv run python -u scripts/tax/deduction_detector.py --period=2024-25\n```\n\n### Script Organization\n\n- **`scripts/core/`** - API client, rule engine, unified rules\n- **`scripts/operations/`** - Categorization, batch processing, transaction updates\n- **`scripts/analysis/`** - Spending analysis, trend detection\n- **`scripts/reporting/`** - Multi-format report generation\n- **`scripts/tax/`** - ATO mappings, deductions, CGT, BAS preparation\n- **`scripts/scenarios/`** - Historical, projections, optimization, tax scenarios\n- **`scripts/status/`** - Status dashboard for SessionStart hook\n- **`scripts/scheduled/`** - Automated scheduled tasks (cron/launchd)\n- **`scripts/health/`** - Health check engine, recommendations, monitoring\n- **`scripts/workflows/`** - Interactive categorization workflows\n- **`scripts/utils/`** - Backup, validation, logging, merchant normalization\n\n## Unified Rule System\n\nAgent Smith uses a YAML-based unified rule system for transaction categorization and labeling.\n\n### Quick Start with Rules\n\n```bash\n# 1. Choose a template for your household type\nuv run python scripts/setup/template_selector.py\n\n# 2. Customize rules in data/rules.yaml\n\n# 3. Test with dry run\nuv run python scripts/operations/batch_categorize.py --mode=dry_run --period=2025-11\n\n# 4. Apply to transactions\nuv run python scripts/operations/batch_categorize.py --mode=apply --period=2025-11\n```\n\n### Example Rule\n\n```yaml\nrules:\n  # Category rule - categorize transactions\n  - type: category\n    name: WOOLWORTHS â†’ Groceries\n    patterns: [WOOLWORTHS, COLES, ALDI]\n    category: Food & Dining > Groceries\n    confidence: 95\n\n  # Label rule - apply labels based on context\n  - type: label\n    name: Shared Groceries\n    when:\n      categories: [Groceries]\n      accounts: [Shared Bills]\n    labels: [Shared Expense, Essential]\n```\n\n### Key Features\n- **Two-phase execution**: Categories first, then labels\n- **Pattern matching**: Regex patterns with exclusions\n- **Confidence scoring**: 0-100% for auto-apply logic\n- **LLM fallback**: AI categorization when rules don't match\n- **Intelligence modes**: Conservative/Smart/Aggressive\n- **Template system**: Pre-built rules for common household types\n- **Operational modes**: DRY_RUN/VALIDATE/APPLY for safe testing\n\nSee [references/unified-rules-guide.md](references/unified-rules-guide.md) for complete documentation.\n\n## Tax Intelligence\n\n### ATO Compliance (Australian Tax Office)\n\n**Three Levels**:\n\n1. **Reference (Level 1)**:\n   - ATO category mappings\n   - Basic tax reports\n   - GST tracking\n   - Resource links\n\n2. **Smart (Level 2)** - Recommended:\n   - Deduction detection (14 pattern-based rules)\n   - CGT tracking with FIFO matching\n   - Confidence scoring\n   - Substantiation threshold checking ($300, $75 taxi/Uber)\n   - Time-based commuting detection\n   - Instant asset write-off tracking\n\n3. **Full (Level 3)** - Power Users:\n   - BAS preparation with GST calculations\n   - Compliance checks\n   - Scenario planning\n   - Audit-ready documentation\n   - Professional advice disclaimers\n\n**Configure Tax Level**:\n```bash\n# In .env file\nTAX_INTELLIGENCE_LEVEL=smart  # reference|smart|full\nTAX_JURISDICTION=AU\nFINANCIAL_YEAR_END=06-30\n```\n\n### Deduction Detection Example\n\n```python\nfrom scripts.tax.deduction_detector import DeductionDetector\n\ndetector = DeductionDetector()\nresult = detector.detect_deduction(transaction)\n# Returns: {\"is_deductible\": True, \"confidence\": \"high\",\n#           \"reason\": \"Office supplies\", \"substantiation_required\": True}\n```\n\n### CGT Tracking Example\n\n```python\nfrom scripts.tax.cgt_tracker import CGTTracker, AssetType\nfrom decimal import Decimal\nfrom datetime import date\n\ntracker = CGTTracker()\ntracker.track_purchase(\n    asset_type=AssetType.SHARES,\n    name=\"BHP Group\",\n    quantity=Decimal(\"100\"),\n    purchase_date=date(2023, 1, 1),\n    purchase_price=Decimal(\"45.50\"),\n    fees=Decimal(\"19.95\")\n)\n\nevent = tracker.track_sale(\n    asset_type=AssetType.SHARES,\n    name=\"BHP Group\",\n    quantity=Decimal(\"100\"),\n    sale_date=date(2024, 6, 1),\n    sale_price=Decimal(\"52.00\"),\n    fees=Decimal(\"19.95\")\n)\n# Returns CGTEvent with capital_gain, discount_eligible, holding_period_days\n```\n\n## Scenario Analysis\n\n### Historical Analysis\n```python\nfrom scripts.scenarios.historical import calculate_what_if_spending\n\nscenario = calculate_what_if_spending(\n    transactions=transactions,\n    category_name=\"Dining\",\n    adjustment_percent=-30.0,  # 30% reduction\n    start_date=\"2025-01-01\",\n    end_date=\"2025-12-31\"\n)\nprint(f\"Savings: ${scenario['savings']:.2f}\")\n```\n\n### Spending Forecast\n```python\nfrom scripts.scenarios.projections import forecast_spending\n\nforecast = forecast_spending(\n    transactions=transactions,\n    category_name=\"Groceries\",\n    months_forward=6,\n    inflation_rate=3.0\n)\n```\n\n### Optimization Suggestions\n```python\nfrom scripts.scenarios.optimization import suggest_optimizations\n\noptimizations = suggest_optimizations(transactions=transactions)\nprint(f\"Potential savings: ${optimizations['potential_annual_savings']:.2f}\")\n```\n\n## Command Architecture Patterns\n\nAll Agent Smith commands follow consistent patterns for reliability and maintainability.\n\n### 1. Deterministic Python Scripts\n\nCommands delegate to git-tracked Python scripts in `scripts/` for all operations:\n\n```\nUser Request â†’ Slash Command â†’ Python Script â†’ PocketSmith API\n     (UX)        (Guidance)      (Logic)         (Data)\n```\n\n**Why this matters**:\n- Same inputs always produce same outputs\n- All logic is testable and auditable\n- No hidden state or side effects\n\n### 2. Subagent Delegation Pattern\n\nCommands use subagents to preserve main conversation context:\n\n```markdown\n**IMPORTANT: Delegate ALL work to a subagent to preserve main context window.**\n\nUse the Task tool with `subagent_type: \"general-purpose\"` to execute...\n```\n\n**When to use subagents**:\n- Batch operations (>50 transactions)\n- Multi-step workflows with verbose output\n- Operations that could pollute context\n\n### 3. Guided Workflow Pattern\n\nEvery command follows this structure:\n\n1. **Goal** - What will this accomplish?\n2. **Why This Matters** - Business context\n3. **Execution Steps** - Numbered steps with scripts\n4. **Next Steps** - What to do after completion\n\n### 4. Visual Style Guidelines\n\n| Element | Usage |\n|---------|-------|\n| Emojis | Status: âœ… success, â³ processing, âš ï¸ warning, âŒ error |\n| Progress | `[23/100] Processing...` |\n| Tables | Results summaries |\n| ASCII bars | Health dimensions: `â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%` |\n\n### 5. Subagent Orchestration\n\nAgent Smith uses intelligent subagent orchestration for complex operations:\n\n**When to delegate to subagents**:\n- Transaction count > 100\n- Estimated tokens > 5000\n- Bulk processing or deep analysis\n- Multi-period operations\n- Parallelization opportunities\n\n**Subagent types**:\n- `general-purpose` - Most operations (categorization, analysis, reporting)\n- Purpose-built agents for specialized workflows\n\n**Context preservation**: Main skill maintains user preferences, session state, and high-level decisions while subagents handle heavy processing.\n\n## Health Check System\n\n```bash\n# Run comprehensive health check\nuv run python scripts/health/check.py --full\n```\n\n**6 Health Dimensions** (scored 0-100):\n1. **Data Quality (25%)** - Uncategorized rate, duplicates, gaps\n2. **Category Structure (20%)** - Depth, unused categories, distribution\n3. **Rule Engine (15%)** - Coverage, efficiency, conflicts\n4. **Tax Readiness (15%)** - Tax categorization, compliance\n5. **Automation (10%)** - Savings automation, bill scheduling\n6. **Budget Alignment (15%)** - Variance, overspending\n\n**Output includes**:\n- Overall score with status (Poor/Fair/Good/Excellent)\n- Individual dimension scores\n- Top 3 prioritized recommendations\n- Projected score after improvements\n\n**Automated monitoring**:\n- Weekly quick health checks\n- Monthly full health analysis\n- Pre-EOFY comprehensive check\n- Post-major-operation validation\n\n## Configuration Files\n\n### `.env` (Required)\n```bash\n# PocketSmith API\nPOCKETSMITH_API_KEY=<Your Developer API Key>\n\n# Agent Smith Configuration\nTAX_INTELLIGENCE_LEVEL=smart          # reference|smart|full\nDEFAULT_INTELLIGENCE_MODE=smart       # conservative|smart|aggressive\nAUTO_BACKUP=true\nAUTO_ARCHIVE=true\nALERT_NOTIFICATIONS=true\n\n# Tax Configuration (Australia)\nTAX_JURISDICTION=AU\nFINANCIAL_YEAR_END=06-30             # June 30\nGST_REGISTERED=false\n\n# Reporting Preferences\nDEFAULT_REPORT_FORMAT=all            # markdown|csv|json|html|excel|all\nCURRENCY=AUD\n\n# Advanced\nAPI_RATE_LIMIT_DELAY=100             # ms between calls\nCACHE_TTL_DAYS=7\nSUBAGENT_MAX_PARALLEL=5\n```\n\n### `data/config.json` (User Preferences)\n```json\n{\n  \"user_id\": 217031,\n  \"tax_level\": \"smart\",\n  \"intelligence_mode\": \"smart\",\n  \"alerts_enabled\": true,\n  \"backup_before_mutations\": true,\n  \"auto_archive\": true,\n  \"default_report_formats\": [\"markdown\", \"csv\", \"html\"]\n}\n```\n\n### `data/rules.yaml` (Unified Rules)\nSee references/unified-rules-guide.md for complete schema and examples.\n\n## Directory Structure\n\n```\nagent-smith/\nâ”œâ”€â”€ SKILL.md                    # This file\nâ”œâ”€â”€ .env                        # API configuration (not committed)\nâ”œâ”€â”€ .env.sample                 # Configuration template\nâ”œâ”€â”€ data/                       # Working data and state\nâ”‚   â”œâ”€â”€ config.json             # User preferences\nâ”‚   â”œâ”€â”€ rules.yaml              # Unified categorization rules\nâ”‚   â”œâ”€â”€ templates/              # Pre-built rule templates\nâ”‚   â””â”€â”€ [other runtime data]\nâ”œâ”€â”€ scripts/                    # Python code\nâ”‚   â”œâ”€â”€ core/                   # API client, rule engine, utilities\nâ”‚   â”œâ”€â”€ operations/             # Categorization, batch processing\nâ”‚   â”œâ”€â”€ analysis/               # Spending analysis, trends\nâ”‚   â”œâ”€â”€ reporting/              # Multi-format reports\nâ”‚   â”œâ”€â”€ tax/                    # Tax intelligence (3-tier)\nâ”‚   â”œâ”€â”€ scenarios/              # Scenario analysis\nâ”‚   â”œâ”€â”€ orchestration/          # Subagent conductor\nâ”‚   â”œâ”€â”€ workflows/              # Interactive workflows\nâ”‚   â”œâ”€â”€ features/               # Advanced features\nâ”‚   â”œâ”€â”€ health/                 # Health check system\nâ”‚   â””â”€â”€ utils/                  # Utilities\nâ”œâ”€â”€ references/                 # Documentation\nâ”‚   â”œâ”€â”€ pocketsmith-api.md      # PocketSmith API reference\nâ”‚   â”œâ”€â”€ unified-rules-guide.md  # Complete rules documentation\nâ”‚   â”œâ”€â”€ onboarding-guide.md     # First-time setup guide\nâ”‚   â””â”€â”€ health-check-guide.md   # Health check documentation\nâ”œâ”€â”€ backups/                    # Timestamped backups (30-day retention)\nâ”œâ”€â”€ logs/                       # Execution logs (14-day retention)\nâ””â”€â”€ reports/                    # Generated reports (90-day retention)\n```\n\n## Critical Operating Rules\n\n**NEVER create custom one-off scripts for core Agent Smith operations.**\n\nAgent Smith has a complete architecture with:\n- Slash commands (`/smith:categorize`, `/smith:analyze`, etc.)\n- Python workflows in `scripts/workflows/`\n- Core operations in `scripts/operations/`\n- Proper API client with correct endpoints in `scripts/core/api_client.py`\n\n**If you find yourself writing a new Python script to:**\n- Categorize transactions\n- Analyze spending\n- Generate reports\n- Update PocketSmith data\n- Run health checks\n\n**STOP. You are reinventing the wheel.**\n\n**Instead:**\n1. Check if a slash command exists (`/smith:*`)\n2. Check if a workflow exists in `scripts/workflows/`\n3. Check if a core operation exists in `scripts/operations/`\n4. Use the existing code that has been tested and uses correct API endpoints\n\n**Why this matters:**\n- Custom scripts may use wrong API endpoints (e.g., `/users/{id}/transactions/{id}` instead of `/transactions/{id}`)\n- Custom scripts bypass rule engine, validation, backup, and audit systems\n- Custom scripts duplicate functionality that already exists\n- Custom scripts won't benefit from future improvements\n\n**Exception:** Only create new scripts when building NEW features not yet in the design, and always place them in the correct `scripts/` subdirectory.\n\n## Best Practices\n\n### Transaction Categorization\n1. **Always use `/smith:categorize`** - Never create custom categorization scripts\n2. Start with a rule template matching your household type\n3. Use dry-run mode to preview categorization\n4. Review and adjust rules based on results\n5. Monitor rule performance metrics\n6. Let AI handle edge cases (LLM fallback)\n\n### Tax Compliance\n1. Configure appropriate tax level for your needs\n2. Track all deductible expenses as they occur\n3. Maintain receipt documentation (>$300 ATO requirement)\n4. Review tax reports before EOFY (June 30)\n5. Consult registered tax agent for complex situations\n\n### Financial Health\n1. Run health checks monthly\n2. Address high-priority recommendations first\n3. Maintain 95%+ categorization rate\n4. Review and clean up unused categories\n5. Set up automated alerts for budget overruns\n\n### Backup and Safety\n1. Always backup before bulk operations (automatic)\n2. Use dry-run mode for untested operations\n3. Review audit trail for unexpected changes\n4. Maintain 30 days of recent backups\n5. Export tax reports for 7-year ATO retention\n\n## References\n\nFor detailed documentation, see the `references/` directory:\n\n- **[PocketSmith API](references/pocketsmith-api.md)** - Complete API reference\n- **[Unified Rules Guide](references/unified-rules-guide.md)** - Rule system documentation\n- **[Onboarding Guide](references/onboarding-guide.md)** - First-time setup walkthrough\n- **[Health Check Guide](references/health-check-guide.md)** - Health system details\n- **[Design Document](references/design.md)** - Complete system architecture\n\n## Support\n\n**Version**: 1.6.0\n\n**Documentation**: See references/ directory for comprehensive guides\n\n**Issues**: For questions or issues, refer to the design documentation or create an issue in the repository.\n\n---\n\n**Note**: Agent Smith is designed for Australian tax compliance (ATO). Adapting for other jurisdictions requires updating tax intelligence modules and reference documentation.\n",
        "agent-smith-plugin/skills/agent-smith/assets/templates/README.md": "# Agent Smith Templates\n\nThis directory contains composable template configurations for PocketSmith onboarding.\n\n## Structure\n\n- **primary/** - Primary income structure templates (choose ONE)\n- **living/** - Living arrangement templates (choose ONE)\n- **additional/** - Additional income source templates (choose MULTIPLE)\n\n## Usage\n\nTemplates are YAML files that define:\n- Categories to create\n- Categorization rules\n- Tax tracking configuration\n- Smart alerts\n\nDuring onboarding, templates are selected and merged using `scripts/setup/template_merger.py`.\n\n## Template Schema\n\nSee individual layer README files for YAML schema details.\n",
        "agent-smith-plugin/skills/agent-smith/assets/templates/additional/README.md": "# Additional Income Templates\n\nSelect MULTIPLE templates for additional income sources beyond your primary income.\n\n## Available Templates\n\n- `side-hustle.yaml` - Freelancing, consulting, gig work\n- `property-investor.yaml` - Rental income, negative gearing, CGT\n- `share-investor.yaml` - Dividends, franking credits, share CGT\n- `crypto-investor.yaml` - Cryptocurrency trading and staking\n- `trust-structures.yaml` - Family trust, company distributions\n\n## YAML Schema\n\nSame structure as primary templates, with `layer: additional` and higher priority values (3+).\n",
        "agent-smith-plugin/skills/agent-smith/assets/templates/living/README.md": "# Living Arrangement Templates\n\nChoose ONE template that matches how you manage household finances.\n\n## Available Templates\n\n- `single.yaml` - Managing finances alone\n- `shared-joint.yaml` - Partner/spouse, pooled income, joint accounts\n- `shared-hybrid.yaml` - Some joint accounts, some separate\n- `separated-parents.yaml` - Child support, shared custody expenses\n- `sharehouse.yaml` - Splitting bills with roommates\n\n## YAML Schema\n\nSame structure as primary templates, with `layer: living`.\n",
        "agent-smith-plugin/skills/agent-smith/assets/templates/primary/README.md": "# Primary Income Templates\n\nChoose ONE template that matches your main source of income.\n\n## Available Templates\n\n- `payg-employee.yaml` - Salary/wage earner\n- `sole-trader.yaml` - ABN holder, contractor, quarterly BAS\n- `small-business.yaml` - Business owner with employees\n- `retiree.yaml` - Superannuation/pension income\n- `student.yaml` - Minimal income, government payments, HECS\n\n## YAML Schema\n\n```yaml\nname: Template Name\nlayer: primary\ndescription: |\n  Multi-line description of this template.\n\ncategories:\n  - name: \"Category Name\"\n    parent: null  # or \"Parent Category Name\"\n    description: \"Category purpose\"\n\nrules:\n  - id: unique-rule-id\n    pattern: \"regex pattern\"\n    category: \"Target Category\"\n    confidence: high|medium|low\n    description: \"What this rule does\"\n\ntax_tracking:\n  bas_enabled: true|false\n  gst_method: cash|accrual\n  # ... other tax config\n\nalerts:\n  - type: alert_type\n    schedule: quarterly|monthly\n    message: \"Alert message\"\n\ndependencies:\n  requires: []\n  conflicts_with: [\"other-template-id\"]\n\nmetadata:\n  created: \"YYYY-MM-DD\"\n  version: \"1.0.0\"\n  priority: 1\n```\n",
        "agent-smith-plugin/skills/agent-smith/references/LESSONS_LEARNED.md": "# Lessons Learned from PocketSmith Migration\n\n**Date:** 2025-11-23\n**Source:** build/ directory reference materials (now archived)\n\nThis document captures key insights from a previous PocketSmith category migration project that informed Agent Smith's design.\n\n---\n\n## Table of Contents\n\n1. [API Quirks and Workarounds](#api-quirks-and-workarounds)\n2. [Category Hierarchy Best Practices](#category-hierarchy-best-practices)\n3. [Transaction Categorization Patterns](#transaction-categorization-patterns)\n4. [Merchant Name Normalization](#merchant-name-normalization)\n5. [User Experience Lessons](#user-experience-lessons)\n\n---\n\n## API Quirks and Workarounds\n\n### Category Rules API Limitations\n\n**Issue:** PocketSmith API does not support updating or deleting category rules.\n- GET `/categories/{id}/category_rules` works\n- POST works (create only)\n- PUT/PATCH/DELETE return 404 errors\n\n**Impact:** Rules created via API cannot be modified programmatically.\n\n**Agent Smith Solution:** Hybrid rule engine with local rules for complex logic, platform rules for simple keywords only.\n\n### Transaction Migration 500 Errors\n\n**Issue:** Bulk transaction updates sometimes fail with 500 Internal Server Errors.\n\n**Root Cause:** Likely API rate limiting or server-side stability issues.\n\n**Agent Smith Solution:**\n- Implement rate limiting (0.1-0.5s delay between requests)\n- Batch processing with progress tracking\n- Retry logic with exponential backoff\n- Always backup before bulk operations\n\n### Special Characters in Category Names\n\n**Issue:** Using \"&\" in category names causes 422 Unprocessable Entity errors.\n\n**Workaround:** Replace \"&\" with \"and\" in all category names.\n\n**Example:**\n- âŒ \"Takeaway & Food Delivery\" â†’ 422 error\n- âœ… \"Takeaway and Food Delivery\" â†’ Success\n\n### Use PUT instead of PATCH\n\n**Issue:** PATCH for transaction updates is unreliable in PocketSmith API.\n\n**Solution:** Always use PUT for transaction updates.\n\n```python\n# âœ… Correct\nresponse = requests.put(\n    f'https://api.pocketsmith.com/v2/transactions/{txn_id}',\n    headers=headers,\n    json={'category_id': category_id}\n)\n\n# âŒ Avoid (unreliable)\nresponse = requests.patch(...)\n```\n\n---\n\n## Category Hierarchy Best Practices\n\n### Parent-Child Structure\n\n**Recommendation:** Use 2-level hierarchy maximum.\n- 12-15 parent categories for broad grouping\n- 2-5 children per parent for specific tracking\n- Avoid 3+ levels (PocketSmith UI gets cluttered)\n\n**Example Structure:**\n```\nFood & Dining (parent)\nâ”œâ”€â”€ Groceries\nâ”œâ”€â”€ Restaurants\nâ”œâ”€â”€ Takeaway and Food Delivery\nâ””â”€â”€ Coffee Shops\n```\n\n### Duplicate Category Detection\n\n**Problem:** Duplicate categories accumulate over time, causing confusion.\n\n**Solution:** Before creating categories, check for existing matches:\n1. Flatten nested category structure\n2. Check both exact matches and case-insensitive matches\n3. Check for variations (e.g., \"Takeaway\" vs \"Takeaways\")\n\n**Agent Smith Implementation:** Category validation in health check system.\n\n### Consolidation Strategy\n\n**Insight:** Merging duplicate categories is risky:\n- Requires migrating all associated transactions\n- Transaction updates can fail (500 errors)\n- Better to prevent duplicates than merge later\n\n**Agent Smith Approach:** Template-based setup with validation prevents duplicates upfront.\n\n---\n\n## Transaction Categorization Patterns\n\n### Pattern Matching Complexity\n\n**Observation:** Transaction categorization evolved through multiple rounds:\n- Round 1: Simple keyword matching (60% coverage)\n- Round 2: Pattern matching with normalization (80% coverage)\n- Round 3: User clarifications + edge cases (90% coverage)\n- Round 4: Manual review of exceptions (95% coverage)\n\n**Lesson:** Need both automated rules AND user override capability.\n\n**Agent Smith Solution:** Tiered intelligence modes (Conservative/Smart/Aggressive) with confidence scoring.\n\n### Confidence-Based Auto-Apply\n\n**Insight:** Not all matches are equal:\n- High confidence (95%+): Auto-apply safe (e.g., \"WOOLWORTHS\" â†’ Groceries)\n- Medium confidence (70-94%): Ask user (e.g., \"LS DOLLI PL\" â†’ Coffee?)\n- Low confidence (<70%): Always ask (e.g., \"Purchase At Kac\" â†’ ???)\n\n**Agent Smith Implementation:**\n```python\nif confidence >= 90:  # Smart mode threshold\n    apply_automatically()\nelif confidence >= 70:\n    ask_user_for_approval()\nelse:\n    skip_or_manual_review()\n```\n\n### Dry-Run Mode is Critical\n\n**Lesson:** Always preview before bulk operations.\n\n**Pattern from migration:**\n```python\nclass BulkCategorizer:\n    def __init__(self, dry_run=True):  # Default to dry-run!\n        self.dry_run = dry_run\n\n    def categorize_transactions(self):\n        if self.dry_run:\n            # Show what WOULD happen\n            return preview\n        else:\n            # Actually execute\n            return results\n```\n\n**Agent Smith Implementation:** All bulk operations support `--mode=dry_run` flag.\n\n---\n\n## Merchant Name Normalization\n\n### Common Payee Patterns\n\n**Observations from transaction data:**\n\n1. **Location codes:** \"WOOLWORTHS 1234\" â†’ \"WOOLWORTHS\"\n2. **Legal suffixes:** \"COLES PTY LTD\" â†’ \"COLES\"\n3. **Country codes:** \"UBER AU\" â†’ \"UBER\"\n4. **Transaction codes:** \"PURCHASE NSWxxx123\" â†’ \"PURCHASE\"\n5. **Direct debit patterns:** \"DIRECT DEBIT 12345\" â†’ \"DIRECT DEBIT\"\n\n**Agent Smith Patterns:**\n```python\nLOCATION_CODE_PATTERN = r\"\\s+\\d{4,}$\"\nSUFFIX_PATTERNS = [\n    r\"\\s+PTY\\s+LTD$\",\n    r\"\\s+LIMITED$\",\n    r\"\\s+LTD$\",\n    r\"\\s+AU$\",\n]\n```\n\n### Merchant Variation Grouping\n\n**Problem:** Same merchant appears with multiple names:\n- \"woolworths\"\n- \"WOOLWORTHS PTY LTD\"\n- \"Woolworths 1234\"\n- \"WOOLWORTHS SUPERMARKETS\"\n\n**Solution:** Learn canonical names from transaction history.\n\n**Agent Smith Implementation:** `MerchantNormalizer.learn_from_transactions()` in scripts/utils/merchant_normalizer.py:101-130\n\n---\n\n## User Experience Lessons\n\n### Backups are Non-Negotiable\n\n**Critical Lesson:** ALWAYS backup before mutations.\n\n**Migration practice:**\n```python\ndef categorize_transactions(self):\n    # Step 1: Always backup first\n    self.backup_transactions()\n\n    # Step 2: Then execute\n    self.apply_changes()\n```\n\n**Agent Smith Policy:** Automatic backups before all mutation operations, tracked in backups/ directory.\n\n### Progress Visibility Matters\n\n**Problem:** Long-running operations feel broken without progress indicators.\n\n**Solution:** Show progress every N iterations:\n```python\nfor i, txn in enumerate(transactions, 1):\n    # Process transaction\n\n    if i % 100 == 0:\n        print(f\"Progress: {i}/{total} ({i/total*100:.1f}%)\")\n```\n\n**Agent Smith Implementation:** All batch operations show real-time progress.\n\n### Manual Cleanup is Inevitable\n\n**Reality Check:** Even after 5+ rounds of automated categorization, ~5% of transactions needed manual review.\n\n**Reasons:**\n- Genuinely ambiguous merchants (\"Purchase At Kac\" = gambling)\n- One-off transactions (unique payees)\n- Data quality issues (missing/incorrect payee names)\n\n**Agent Smith Approach:** Make manual review easy with health check reports showing uncategorized transactions.\n\n### Weekly Review Habit\n\n**Post-migration recommendation:** Review recent transactions weekly for first month.\n\n**Why:** Helps catch:\n- Miscategorized transactions\n- New merchants needing rules\n- Changes in spending patterns\n\n**Agent Smith Feature:** Smart alerts with weekly budget reviews (Phase 7).\n\n---\n\n## Implementation Timelines\n\n### Migration Timeline (Reality vs Plan)\n\n**Planned:** 35 minutes total\n**Actual:** 3+ hours over multiple days\n\n**Breakdown:**\n- Category structure migration: 10 minutes (as planned)\n- Rule recreation: 20 minutes (10 minutes planned - API limitations doubled time)\n- Transaction categorization Round 1: 30 minutes\n- Transaction categorization Round 2: 45 minutes\n- Transaction categorization Round 3: 60 minutes\n- Manual cleanup and verification: 90 minutes\n\n**Lesson:** Budget 3-5x estimated time for data migration projects.\n\n**Agent Smith Design:** Incremental onboarding (30-60 minutes initial setup, ongoing refinement).\n\n---\n\n## Key Takeaways for Agent Smith\n\n### What We Built Better\n\n1. **Hybrid Rule Engine:** Local + Platform rules overcome API limitations\n2. **Confidence Scoring:** Tiered auto-apply based on pattern strength\n3. **Merchant Intelligence:** Learned normalization from transaction history\n4. **Health Checks:** Proactive detection of category/rule issues\n5. **Template System:** Pre-built rule sets prevent common mistakes\n\n### What We Avoided\n\n1. **Manual rule migration** - Templates and import/export instead\n2. **Duplicate categories** - Validation and health checks\n3. **Bulk update failures** - Rate limiting, retry logic, batching\n4. **Lost context** - Comprehensive backups with metadata\n5. **User fatigue** - Incremental categorization, not all-at-once\n\n### Core Principles\n\nâœ… **Backup before mutations**\nâœ… **Dry-run before execute**\nâœ… **Progress visibility**\nâœ… **Confidence-based automation**\nâœ… **User choice over forced automation**\nâœ… **Learn from transaction history**\nâœ… **Graceful degradation** (LLM fallback when rules don't match)\n\n---\n\n## Reference\n\n**Original Materials:** Archived from `build/` directory (removed 2025-11-23)\n\n**Full backup available at:** `../budget-smith-backup-20251120_093733/`\n\n**See Also:**\n- [Agent Smith Design](2025-11-20-agent-smith-design.md) - Complete system design\n- [Unified Rules Guide](../guides/unified-rules-guide.md) - Rule engine documentation\n- [Health Check Guide](../guides/health-check-guide.md) - Health scoring system\n\n---\n\n**Last Updated:** 2025-11-23\n",
        "agent-smith-plugin/skills/agent-smith/references/design.md": "# Agent Smith - Complete Design Specification\n\n**Design Date:** 2025-11-20\n**Status:** Approved\n**Version:** 1.0\n\n---\n\n## Executive Summary\n\n**Agent Smith** is an intelligent financial management skill for Claude Code that provides comprehensive PocketSmith API integration with advanced AI-powered analysis, rule management, tax intelligence, and scenario planning.\n\n**Name Origin:** \"Agent Smith\" combines the PocketSmith platform reference with the Matrix's AI agent - a fitting metaphor for an intelligent assistant managing your financial matrix.\n\n**Key Value Proposition:**\n- Transform PocketSmith from a passive tracking tool into an active financial intelligence system\n- Reduce manual financial admin time by 60-80% through intelligent automation\n- Provide proactive insights, alerts, and optimization recommendations\n- Ensure Australian tax compliance with ATO-aligned intelligence\n- Enable sophisticated financial scenario modeling and forecasting\n\n---\n\n## Table of Contents\n\n1. [Core Architecture](#core-architecture)\n2. [Directory Structure](#directory-structure)\n3. [Hybrid Rule Engine](#hybrid-rule-engine)\n4. [Tax Intelligence Module](#tax-intelligence-module)\n5. [Scenario Analysis Engine](#scenario-analysis-engine)\n6. [Subagent Orchestration](#subagent-orchestration)\n7. [Slash Commands](#slash-commands)\n8. [Additional Features](#additional-features)\n9. [Health Check System](#health-check-system)\n10. [Configuration](#configuration)\n11. [Implementation Roadmap](#implementation-roadmap)\n\n---\n\n## Core Architecture\n\n### Three-Tier System\n\n**1. API Integration Layer**\n- Handles all PocketSmith API communication\n- Rate limiting and retry logic\n- Response caching (7-day TTL)\n- Error handling and fallback strategies\n- Automatic backup before mutations\n\n**2. Intelligence Engine**\n- **Hybrid Rule Engine:** Platform-native + enhanced local rules\n- **Tax Intelligence:** 3-tier system (Reference, Smart, Full)\n- **Scenario Analysis:** Historical, projections, optimization, tax planning\n- **AI Categorization:** Tiered intelligence modes (Conservative, Smart, Aggressive)\n- **Pattern Learning:** Performance tracking and rule evolution\n\n**3. Orchestration Layer**\n- Smart subagent conductor\n- Decision tree for delegation vs. direct handling\n- Parallel processing for bulk operations\n- Context preservation in main skill\n- Result aggregation and synthesis\n\n### Philosophy\n\n**Hybrid Approach:**\n- Quick single-shot operations for simple tasks\n- Deep conversational sessions for complex workflows\n- User choice: always provide recommended mode but allow override\n- Context preservation through intelligent subagent orchestration\n\n**AI Intelligence Levels:**\n- **Conservative:** User approval required for all actions\n- **Smart:** Auto-apply high-confidence (â‰¥90%), ask for medium (70-89%)\n- **Aggressive:** Auto-apply â‰¥80% confidence, ask for 50-79%\n- User can override per operation\n\n---\n\n## Directory Structure\n\n```\n~/.claude/skills/agent-smith/\nâ”œâ”€â”€ agent-smith.md               # Main skill file (invocation point)\nâ”œâ”€â”€ .env.sample                  # API key configuration template\nâ”œâ”€â”€ .gitignore                   # Protect sensitive data\nâ”œâ”€â”€ README.md                    # Skill documentation\nâ”œâ”€â”€ INDEX.md                     # Master directory index\nâ”‚\nâ”œâ”€â”€ ai_docs/                     # Documentation for Claude subagents\nâ”‚   â”œâ”€â”€ INDEX.md                 # Document catalog with descriptions\nâ”‚   â”œâ”€â”€ pocketsmith-api-documentation.md\nâ”‚   â”œâ”€â”€ category-optimization-guide.md\nâ”‚   â”œâ”€â”€ ato-tax-guidelines.md\nâ”‚   â”œâ”€â”€ rule-engine-architecture.md\nâ”‚   â””â”€â”€ subagent-protocols.md\nâ”‚\nâ”œâ”€â”€ backups/                     # Recent backups (30-day retention)\nâ”‚   â”œâ”€â”€ INDEX.md                 # Latest backups with descriptions\nâ”‚   â”œâ”€â”€ YYYY-MM-DD_HHMMSS/       # Timestamped backup sets\nâ”‚   â””â”€â”€ archive/                 # Older backups (compressed)\nâ”‚       â”œâ”€â”€ INDEX.md             # Archived backup catalog\nâ”‚       â””â”€â”€ YYYY-MM/             # Monthly archives (.tar.gz)\nâ”‚\nâ”œâ”€â”€ data/                        # Working data & persistent state\nâ”‚   â”œâ”€â”€ INDEX.md                 # Current state files & purpose\nâ”‚   â”œâ”€â”€ config.json              # User preferences, modes, tax level\nâ”‚   â”œâ”€â”€ rule_metadata.json       # Rule tracking & performance metrics\nâ”‚   â”œâ”€â”€ platform_rules.json      # PocketSmith native rules created\nâ”‚   â”œâ”€â”€ local_rules.json         # Enhanced local rule engine\nâ”‚   â”œâ”€â”€ session_state.json       # Current session context\nâ”‚   â”œâ”€â”€ alerts/\nâ”‚   â”‚   â”œâ”€â”€ alert_rules.json\nâ”‚   â”‚   â”œâ”€â”€ alert_history.json\nâ”‚   â”‚   â””â”€â”€ alert_templates.json\nâ”‚   â”œâ”€â”€ tax/\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â”œâ”€â”€ ato_category_mappings.json\nâ”‚   â”‚   â”œâ”€â”€ deduction_rules.json\nâ”‚   â”‚   â”œâ”€â”€ thresholds.json\nâ”‚   â”‚   â”œâ”€â”€ cgt_register.json\nâ”‚   â”‚   â””â”€â”€ substantiation_tracking.json\nâ”‚   â”œâ”€â”€ scenarios/\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â”œâ”€â”€ saved_scenarios.json\nâ”‚   â”‚   â”œâ”€â”€ scenario_templates.json\nâ”‚   â”‚   â””â”€â”€ scenario_results/\nâ”‚   â”œâ”€â”€ merchants/\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â””â”€â”€ merchant_intelligence.json\nâ”‚   â”œâ”€â”€ investments/\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â”œâ”€â”€ portfolio.json\nâ”‚   â”‚   â”œâ”€â”€ transactions.json\nâ”‚   â”‚   â””â”€â”€ performance.json\nâ”‚   â”œâ”€â”€ goals/\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â””â”€â”€ financial_goals.json\nâ”‚   â”œâ”€â”€ health/\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â”œâ”€â”€ health_scores.json\nâ”‚   â”‚   â”œâ”€â”€ recommendations.json\nâ”‚   â”‚   â””â”€â”€ health_history/\nâ”‚   â”œâ”€â”€ audit/\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â”œâ”€â”€ transaction_changes.log\nâ”‚   â”‚   â”œâ”€â”€ category_changes.log\nâ”‚   â”‚   â”œâ”€â”€ rule_changes.log\nâ”‚   â”‚   â””â”€â”€ api_activity.log\nâ”‚   â””â”€â”€ cache/                   # API response cache (7-day TTL)\nâ”‚       â”œâ”€â”€ INDEX.md             # Cache inventory & freshness\nâ”‚       â””â”€â”€ *.json               # Cached responses\nâ”‚\nâ”œâ”€â”€ docs/                        # Generated documentation\nâ”‚   â”œâ”€â”€ INDEX.md                 # Recent docs & analyses\nâ”‚   â”œâ”€â”€ operations/              # Recent operation logs (30 days)\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md             # Operation summaries\nâ”‚   â”‚   â””â”€â”€ YYYY-MM-DD_*.md\nâ”‚   â”œâ”€â”€ analyses/                # Recent analysis reports (90 days)\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md             # Analysis catalog\nâ”‚   â”‚   â””â”€â”€ *.md\nâ”‚   â”œâ”€â”€ guides/                  # User guides (persistent)\nâ”‚   â”‚   â””â”€â”€ INDEX.md\nâ”‚   â””â”€â”€ archive/                 # Older docs (compressed)\nâ”‚       â”œâ”€â”€ INDEX.md\nâ”‚       â””â”€â”€ YYYY-MM/\nâ”‚\nâ”œâ”€â”€ logs/                        # Execution logs (14 days active)\nâ”‚   â”œâ”€â”€ INDEX.md                 # Recent log summary\nâ”‚   â”œâ”€â”€ api_calls.log            # API interaction log\nâ”‚   â”œâ”€â”€ operations.log           # High-level operations\nâ”‚   â”œâ”€â”€ errors.log               # Error tracking\nâ”‚   â””â”€â”€ archive/                 # Compressed historical logs\nâ”‚       â”œâ”€â”€ INDEX.md\nâ”‚       â””â”€â”€ YYYY-MM.tar.gz\nâ”‚\nâ”œâ”€â”€ reports/                     # Multi-format output (90 days)\nâ”‚   â”œâ”€â”€ INDEX.md                 # Recent reports catalog\nâ”‚   â”œâ”€â”€ markdown/\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â””â”€â”€ *.md\nâ”‚   â”œâ”€â”€ data/                    # CSV/JSON exports\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â””â”€â”€ *.{csv,json}\nâ”‚   â”œâ”€â”€ interactive/             # HTML dashboards\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â””â”€â”€ *.html\nâ”‚   â”œâ”€â”€ tax/                     # Tax-ready formats (7-year retention)\nâ”‚   â”‚   â”œâ”€â”€ INDEX.md\nâ”‚   â”‚   â””â”€â”€ YYYY-*.{pdf,xlsx}\nâ”‚   â””â”€â”€ archive/                 # Older reports\nâ”‚       â”œâ”€â”€ INDEX.md\nâ”‚       â””â”€â”€ YYYY-MM/\nâ”‚\nâ””â”€â”€ scripts/                     # Python utilities & subagent tools\n    â”œâ”€â”€ INDEX.md                 # Script catalog & usage\n    â”œâ”€â”€ core/                    # Core libraries (reusable)\n    â”‚   â”œâ”€â”€ api_client.py        # PocketSmith API wrapper\n    â”‚   â”œâ”€â”€ rule_engine.py       # Hybrid rule system\n    â”‚   â”œâ”€â”€ tax_intelligence.py  # Tax analysis module\n    â”‚   â”œâ”€â”€ scenario_engine.py   # Financial scenarios\n    â”‚   â””â”€â”€ archiver.py          # Smart archiving engine\n    â”œâ”€â”€ operations/              # Specific operation scripts\n    â”‚   â”œâ”€â”€ INDEX.md\n    â”‚   â”œâ”€â”€ categorize.py\n    â”‚   â”œâ”€â”€ analyze.py\n    â”‚   â”œâ”€â”€ optimize_categories.py\n    â”‚   â””â”€â”€ generate_reports.py\n    â”œâ”€â”€ subagents/               # Subagent definitions\n    â”‚   â”œâ”€â”€ categorization-agent.md\n    â”‚   â”œâ”€â”€ analysis-agent.md\n    â”‚   â”œâ”€â”€ reporting-agent.md\n    â”‚   â”œâ”€â”€ tax-agent.md\n    â”‚   â”œâ”€â”€ optimization-agent.md\n    â”‚   â””â”€â”€ scenario-agent.md\n    â””â”€â”€ utils/                   # Helper utilities\n        â”œâ”€â”€ INDEX.md\n        â”œâ”€â”€ backup.py\n        â”œâ”€â”€ validation.py\n        â”œâ”€â”€ formatters.py\n        â””â”€â”€ index_updater.py     # Auto-update INDEX.md files\n```\n\n### Smart Archiving Strategy\n\n**Retention Policies:**\n- **Cache:** 7 days, auto-purge\n- **Logs:** 14 days active, then compress to monthly archives\n- **Backups:** 30 days recent, then monthly compressed archives\n- **Operations docs:** 30 days, then archive\n- **Analyses/Reports:** 90 days, then archive\n- **Tax reports:** 7 years (ATO requirement)\n\n**Archiving Process:**\n- Automatic after operations\n- Compresses old files into monthly `.tar.gz` archives\n- Updates INDEX.md in archive directories\n- Manual archive/restore commands available\n\n**INDEX.md Auto-Update:**\n- Every file creation/modification triggers index update\n- Contains: filename, creation date, size, description, tags\n- Enables LLM to quickly scan without reading all files\n- Sorted by relevance (newest first, or by type)\n\n---\n\n## Hybrid Rule Engine\n\n### Architecture\n\n**Two-Tier System:**\n1. **Platform Rules** - PocketSmith native (via API)\n2. **Local Rules** - Enhanced engine with advanced features\n\n**Platform Rules (PocketSmith Native):**\n- Created via API for simple keyword patterns\n- **Advantages:** Auto-apply to future transactions server-side\n- **Limitations:** Keyword-only matching, no modification/deletion via API\n- **Tracking:** Metadata stored in `data/platform_rules.json`\n\n**Local Rules (Enhanced Engine):**\n- Stored in `data/local_rules.json`\n- **Capabilities:**\n  - Regex pattern matching\n  - Multi-condition logic (amount ranges, date patterns, account filters)\n  - Confidence scoring (0-100%)\n  - Priority/precedence management\n  - Rule chaining (conditional rules)\n  - Negative patterns (exclusions)\n  - Statistical learning (accuracy tracking)\n\n### Rule Schema (Local)\n\n```json\n{\n  \"rule_id\": \"uuid\",\n  \"name\": \"Woolworths Groceries\",\n  \"type\": \"local|platform|session\",\n  \"pattern\": {\n    \"payee_regex\": \"WOOLWORTHS.*\",\n    \"amount_range\": {\"min\": null, \"max\": null},\n    \"account_ids\": [],\n    \"date_range\": null,\n    \"excludes\": [\"WOOLWORTHS PETROL\"]\n  },\n  \"action\": {\n    \"category_id\": 12345,\n    \"confidence\": 95,\n    \"requires_approval\": false\n  },\n  \"metadata\": {\n    \"created\": \"2025-11-20\",\n    \"created_by\": \"user|ai\",\n    \"last_modified\": \"2025-11-20\",\n    \"priority\": 100,\n    \"tags\": [\"groceries\", \"auto-categorize\"]\n  },\n  \"performance\": {\n    \"matches\": 150,\n    \"applied\": 148,\n    \"user_overrides\": 2,\n    \"accuracy\": 98.67,\n    \"last_used\": \"2025-11-19\"\n  }\n}\n```\n\n### Intelligence Modes\n\n**1. Conservative Mode:**\n- All rules require user approval before applying\n- Best for: Initial setup, learning phase, high-stakes categorization\n\n**2. Smart Mode (Default):**\n- Auto-apply rules with confidence â‰¥ 90%\n- Ask for approval: 70-89% confidence\n- Skip: < 70% confidence\n- Best for: Most users, balanced automation\n\n**3. Aggressive Mode:**\n- Auto-apply confidence â‰¥ 80%\n- Ask for approval: 50-79% confidence\n- Skip: < 50% confidence\n- Best for: Experienced users, trusted rule sets\n\n### Session Rules\n\n- Temporary rules for one-off bulk operations\n- Stored in `session_state.json`, not persisted by default\n- User prompted: \"Keep this rule for future use?\"\n- Useful for: Bulk categorization, experimentation\n\n### Rule Lifecycle\n\n1. **Creation:** AI suggests or user defines\n2. **Validation:** Test against historical transactions (dry-run)\n3. **Application:** Apply with chosen intelligence mode\n4. **Tracking:** Record performance metrics\n5. **Evolution:** Suggest refinements based on override patterns\n6. **Archival:** Move low-performing rules to review queue\n\n### Platform Sync Strategy\n\n**Decision Logic:**\n```python\nif rule.is_simple_keyword() and not rule.has_exclusions():\n    # Create via PocketSmith API\n    create_platform_rule(rule)\n    track_in_platform_rules_json(rule)\nelse:\n    # Keep local-only\n    store_in_local_rules_json(rule)\n```\n\n**Migration Tool:**\n- Convert proven local rules to platform rules when possible\n- Audit which rules are platform vs. local\n- Bulk migration capability\n\n---\n\n## Tax Intelligence Module\n\n### Three-Tier System\n\n**Configuration:**\n- Environment variable: `TAX_INTELLIGENCE_LEVEL=reference|smart|full`\n- Runtime override: `--tax-level=full`\n- Interactive prompt when ambiguous\n\n---\n\n### Level 1: Reference & Reporting\n\n**Capabilities:**\n- Generate tax-ready expense summaries by category\n- Map PocketSmith categories to ATO expense categories\n- Basic GST tracking (GST paid on business purchases)\n- Flag potential deductible expenses based on category\n- Link to relevant ATO resources and guides\n- Simple reports: \"You spent $X on deductible categories\"\n\n**Output:**\n- Factual reporting with resource links\n- No advice given\n- CSV exports mapped to ATO tax return categories\n\n**Use Case:** Users who have accountants, just need organized data\n\n---\n\n### Level 2: Smart Categorization Assistant\n\n**Everything from Level 1, PLUS:**\n\n**Advanced Detection:**\n- Flag transactions likely deductible based on payee patterns\n- Suggest expense splitting (mixed personal/business)\n- Identify missing documentation requirements\n- Track capital gains/losses events (asset purchases/sales)\n- Calculate vehicle logbook percentages from fuel/service patterns\n- Monitor common deduction thresholds ($300 receipt rule, etc.)\n- Detect home office expense patterns\n- Flag estimated tax obligations based on income patterns\n\n**Intelligent Suggestions:**\n- \"This $850 laptop purchase may be instantly deductible\"\n- \"Detected 15 Uber rides to/from work - likely NOT deductible\"\n- \"Mobile phone bill: consider 50/50 split for business deduction\"\n\n**Capital Gains Tracking:**\n- Detect asset purchase/sale pairs\n- Calculate holding periods\n- Flag CGT discount eligibility (> 12 months)\n- Track cost base adjustments\n\n**Output:** Actionable insights with \"consult your accountant\" disclaimers\n\n**Use Case:** Most users, proactive tax optimization\n\n---\n\n### Level 3: Full Compliance Suite\n\n**Everything from Levels 1 & 2, PLUS:**\n\n**Comprehensive Tax Management:**\n\n**Deduction Optimization:**\n- Track deductions against ATO category limits and guidelines\n- Suggest timing optimizations (prepay expenses before EOFY)\n- Identify bundling opportunities\n- Compare deduction methods (actual vs. standard rates)\n- Monitor substantiation requirements by category\n\n**BAS & GST Management:**\n- BAS-ready reports (quarterly/monthly)\n- GST paid vs. collected tracking\n- Input tax credit calculations\n- PAYG installment tracking\n- BAS reconciliation reports\n\n**Threshold Monitoring:**\n- $300 substantiation threshold\n- $75 taxi/Uber receipt requirements\n- FBT thresholds\n- Small business entity thresholds ($10M turnover)\n- Instant asset write-off limits (currently $20,000)\n\n**Investment & CGT Intelligence:**\n- Comprehensive CGT register\n- Cost base tracking (purchase price + incidental costs)\n- Dividend tracking (franked/unfranked)\n- Foreign income detection\n- Cryptocurrency transaction tracking\n- Wash sale detection\n\n**Scenario Planning:**\n- \"Sell investment now vs. after 12 months - tax impact?\"\n- \"Prepay insurance before EOFY - savings?\"\n- \"You're approaching threshold X - implications\"\n\n**Compliance Checks:**\n- Cross-reference expenses against ATO audit triggers\n- Identify unusual patterns\n- Verify substantiation completeness\n- Generate audit-ready documentation\n\n**Reports Generated:**\n- Tax return schedule summaries (D1-D15)\n- BAS worksheets\n- CGT schedule\n- Depreciation schedules\n- Home office calculation worksheets\n- Vehicle logbook summaries\n\n**Disclaimers:**\n- All Level 3 outputs include: \"This analysis is for informational purposes. Consult a registered tax agent for advice.\"\n- Flags complex situations requiring professional review\n\n**Use Case:** Power users, small business owners, serious tax optimization\n\n---\n\n### ATO Documentation Caching\n\n**Smart Documentation Strategy:**\n\n**Local Cache Structure:**\n```\nai_docs/tax/\nâ”œâ”€â”€ INDEX.md\nâ”œâ”€â”€ cache_metadata.json\nâ”œâ”€â”€ ato_guidelines/\nâ”‚   â”œâ”€â”€ motor_vehicle_expenses_2025.md\nâ”‚   â”œâ”€â”€ home_office_deductions_2025.md\nâ”‚   â”œâ”€â”€ capital_gains_tax_2025.md\nâ”‚   â””â”€â”€ instant_asset_writeoff_2025.md\nâ”œâ”€â”€ legislation/\nâ”‚   â”œâ”€â”€ income_tax_rates_2024-25.json\nâ”‚   â”œâ”€â”€ gst_rules.md\nâ”‚   â””â”€â”€ substantiation_requirements.md\nâ””â”€â”€ archived/\n    â””â”€â”€ YYYY/\n```\n\n**Cache Metadata:**\n```json\n{\n  \"document_id\": \"motor_vehicle_expenses_2025\",\n  \"source_url\": \"https://www.ato.gov.au/...\",\n  \"cached_date\": \"2025-11-01\",\n  \"last_verified\": \"2025-11-20\",\n  \"content_hash\": \"abc123...\",\n  \"refresh_policy\": \"monthly\",\n  \"expiry_date\": \"2025-12-01\",\n  \"version\": \"v2.1\",\n  \"change_log\": [\n    {\n      \"date\": \"2025-11-15\",\n      \"change\": \"Updated instant asset write-off threshold to $20,000\"\n    }\n  ]\n}\n```\n\n**Smart Refresh Strategy:**\n\n1. **Automatic Checks:**\n   - Monthly refresh of all cached docs\n   - Pre-EOFY force refresh (May-June)\n   - Post-Budget alert (October)\n\n2. **On-Demand Verification:**\n   - Before generating tax reports: check for doc updates\n   - Compare cached vs. online versions\n   - Highlight changes to user\n\n3. **Integration with Tax Levels:**\n   - Level 1: Use cached docs, verify monthly\n   - Level 2: Verify before recommendations\n   - Level 3: Always verify freshness before compliance operations\n\n**Commands:**\n- `refresh-tax-cache` - Force refresh\n- `verify-tax-cache` - Check for updates\n- `diff-tax-changes` - Show changes since last cache\n\n---\n\n## Scenario Analysis Engine\n\n### Four Scenario Types\n\n**1. Historical Analysis**\n\n**What-If Replays:**\n- \"What if I had cut dining out by 30% in 2024?\"\n- \"Show impact of eliminating subscription X\"\n- \"What if I had sold investment Y in June vs. December?\"\n\n**Trend Analysis:**\n- Compare spending across periods (YoY, QoQ, MoM)\n- Identify trending categories\n- Seasonal pattern detection\n- Anomaly detection\n\n**Comparative Scenarios:**\n- Actual vs. Budget variance\n- Category spending comparisons\n- Account-level analysis\n\n---\n\n**2. Future Projections**\n\n**Spending Forecasts:**\n- Project based on historical patterns\n- Seasonal adjustments\n- Account for known upcoming changes\n- Confidence intervals (optimistic/pessimistic/realistic)\n\n**Affordability Analysis:**\n- \"Can I afford a $500/month car payment?\"\n- \"Impact of $15k annual expense on cash flow?\"\n- Cash flow projections (monthly surplus/deficit)\n\n**Goal Modeling:**\n- \"Save $20k by Dec 2026 - required monthly savings?\"\n- \"Retire at 60 - monthly savings needed?\"\n- Investment growth projections\n\n**Algorithm:**\n1. Analyze historical patterns (12-24 months)\n2. Detect trends (increasing/decreasing categories)\n3. Apply seasonal adjustments\n4. Factor in inflation (configurable %)\n5. Account for known future changes\n6. Generate 3 scenarios: conservative/realistic/optimistic\n7. Project forward 3/6/12/24 months\n\n---\n\n**3. Optimization Engine**\n\n**AI-Suggested Opportunities:**\n\n**Subscription Analysis:**\n- Detect recurring payments\n- Identify unused/underutilized subscriptions\n- Calculate consolidation savings\n- Suggest alternatives\n\n**Category Trend Alerts:**\n- Flag categories trending up >10%\n- Identify unusual spending patterns\n- Compare to peer benchmarks (optional)\n- Suggest budget adjustments\n\n**Expense Rationalization:**\n- Duplicate service detection\n- Identify optimization opportunities\n- Bundle opportunities\n\n**Tax Optimization:**\n- Prepayment opportunities before EOFY\n- Timing of asset sales (CGT optimization)\n- Salary sacrifice recommendations\n- Deduction maximization strategies\n\n---\n\n**4. Tax Scenario Planning**\n\n**Pre-Purchase Analysis:**\n- \"Buy $25k equipment now vs. next FY - tax impact?\"\n- \"Instant asset write-off vs. depreciation?\"\n- \"Salary sacrifice $10k to super - net benefit?\"\n\n**Income Timing:**\n- \"Defer $20k invoice to next FY - tax savings?\"\n- \"Bonus timing optimization\"\n- \"Capital gain timing (< or > 12 months)\"\n\n**Deduction Optimization:**\n- \"Prepay 12 months insurance before EOFY - deductible?\"\n- \"Extra super contribution - tax benefit?\"\n- \"Bring forward expenses - impact?\"\n\n**CGT Scenarios:**\n- \"Sell now (8 months held) vs. wait 4 months (CGT discount)\"\n- \"Offset gains with losses - which assets?\"\n- \"Distribute gains across financial years\"\n\n---\n\n## Subagent Orchestration\n\n### Orchestration Decision Tree\n\n```python\ndef should_delegate(operation):\n    \"\"\"Decide if operation should use subagent\"\"\"\n\n    # Always delegate\n    if operation.type in ['bulk_processing', 'deep_analysis', 'multi_period']:\n        return True\n\n    # Check complexity\n    if operation.transaction_count > 100:\n        return True\n\n    if operation.estimated_tokens > 5000:\n        return True\n\n    # Check parallelization opportunity\n    if operation.can_parallelize:\n        return True\n\n    # Simple queries stay in main context\n    return False\n```\n\n### Subagent Types\n\n**Specialized Workers:**\n- `categorization-agent.md` - Transaction categorization\n- `analysis-agent.md` - Financial analysis\n- `reporting-agent.md` - Report generation\n- `tax-agent.md` - Tax intelligence operations\n- `optimization-agent.md` - Category/rule optimization\n- `scenario-agent.md` - Scenario modeling\n\n### Processing Patterns\n\n**1. Parallel Processing:**\n- Multi-period analysis (12 months â†’ 12 parallel agents)\n- Category-wise deep dives (top 5 categories â†’ 5 agents)\n- Bulk categorization (500 transactions â†’ 5 batches â†’ 5 agents)\n\n**2. Sequential Delegation:**\n- Complex workflows requiring user approval between steps\n- Each step's output feeds next step\n- Main skill orchestrates and presents results\n\n**3. Smart Context Management:**\n\n**Main Skill Handles:**\n- User preferences and configuration\n- Session state\n- High-level decision making\n- User interaction and approvals\n- Result aggregation\n\n**Subagents Handle:**\n- Large data processing\n- API-intensive operations\n- Detailed analysis\n- Report generation\n- Rule application\n- Complex calculations\n\n### Communication Protocol\n\n**Delegation Message Format:**\n```markdown\nYou are a specialized {operation_type} agent for Agent Smith.\n\nCONTEXT:\n- User: {user_id}\n- Operation: {operation_description}\n- Intelligence Mode: {conservative|smart|aggressive}\n- Tax Level: {reference|smart|full}\n\nDATA:\n{relevant_data_subset}\n\nREFERENCES:\n- API Documentation: ai_docs/pocketsmith-api-documentation.md\n- {operation_specific_docs}\n\nTASK:\n{specific_instructions}\n\nOUTPUT FORMAT:\n{expected_output_schema}\n\nCONSTRAINTS:\n- Dry-run mode: {true|false}\n- Maximum API calls: {limit}\n- Backup before mutations: {true|false}\n```\n\n**Response Format:**\n```json\n{\n  \"status\": \"success|error|partial\",\n  \"operation\": \"categorization\",\n  \"summary\": \"Categorized 95/100 transactions\",\n  \"results\": {\n    \"categorized\": 95,\n    \"skipped\": 5,\n    \"rules_applied\": 12,\n    \"new_rules_suggested\": 3\n  },\n  \"details\": {},\n  \"errors\": [],\n  \"recommendations\": [],\n  \"next_steps\": []\n}\n```\n\n---\n\n## Slash Commands\n\n### Command Structure\n\n```\n.claude/commands/\nâ”œâ”€â”€ agent-smith.md                      # Installation and onboarding\nâ”œâ”€â”€ agent-smith-categorize.md           # Transaction categorization\nâ”œâ”€â”€ agent-smith-analyze.md              # Financial analysis\nâ”œâ”€â”€ agent-smith-report.md               # Report generation\nâ”œâ”€â”€ agent-smith-scenario.md             # Scenario modeling\nâ”œâ”€â”€ agent-smith-optimize.md             # Optimization operations\nâ”œâ”€â”€ agent-smith-tax.md                  # Tax intelligence\nâ””â”€â”€ agent-smith-health.md               # Health check\n```\n\n### Command Definitions\n\n**1. `/agent-smith` - Main Conversational Skill**\n```markdown\nStart a conversational Agent Smith session for complex multi-step operations.\nUse for workflows involving multiple operations or guided assistance.\n```\n\n**2. `/agent-smith-categorize [--mode] [--period]`**\n```markdown\nCategorize uncategorized transactions with AI assistance.\n\nArguments:\n  --mode=conservative|smart|aggressive  Intelligence level (default: smart)\n  --period=YYYY-MM                      Target specific month/year\n  --account=ID                          Limit to specific account\n  --dry-run                             Preview without applying\n\nExamples:\n  /agent-smith-categorize\n  /agent-smith-categorize --mode=aggressive --period=2025-11\n```\n\n**3. `/agent-smith-analyze [type] [--period]`**\n```markdown\nRun financial analysis on PocketSmith data.\n\nArguments:\n  type: spending|trends|category|tax|insights\n  --period=YYYY-MM or YYYY\n  --category=ID\n  --compare=YYYY-MM\n  --tax-level=reference|smart|full\n\nExamples:\n  /agent-smith-analyze spending --period=2025\n  /agent-smith-analyze trends --compare=2024\n```\n\n**4. `/agent-smith-scenario [type] [description]`**\n```markdown\nModel financial scenarios: what-if, projections, optimization, tax planning.\n\nArguments:\n  type: historical|projection|optimization|tax\n  description: Natural language scenario description\n\nExamples:\n  /agent-smith-scenario historical \"What if I cut dining by 25% last year?\"\n  /agent-smith-scenario projection \"Can I afford $600/month car payment?\"\n  /agent-smith-scenario tax \"Buy $25k equipment before or after EOFY?\"\n```\n\n**5. `/agent-smith-report [format] [--period]`**\n```markdown\nGenerate comprehensive reports in various formats.\n\nArguments:\n  format: summary|detailed|tax|custom\n  --period=YYYY-MM or YYYY\n  --output=markdown|csv|json|html|excel|all\n  --tax-level=reference|smart|full\n\nExamples:\n  /agent-smith-report summary --period=2025-Q4\n  /agent-smith-report tax --period=2024-25 --tax-level=full\n```\n\n**6. `/agent-smith-optimize [target]`**\n```markdown\nAI-assisted optimization for categories, rules, or spending.\n\nArguments:\n  target: categories|rules|spending|subscriptions\n\nExamples:\n  /agent-smith-optimize categories\n  /agent-smith-optimize rules\n```\n\n**7. `/agent-smith-tax [operation] [--period]`**\n```markdown\nTax-focused analysis, deduction tracking, compliance reporting.\n\nArguments:\n  operation: deductions|cgt|bas|eofy|scenario\n  --period=YYYY-YY\n  --level=reference|smart|full\n\nExamples:\n  /agent-smith-tax deductions --period=2024-25\n  /agent-smith-tax eofy\n```\n\n**8. `/agent-smith-health [--full]`**\n```markdown\nEvaluate PocketSmith setup and get optimization recommendations.\n\nArguments:\n  --full                    Complete deep analysis\n  --quick                   Fast essential checks\n  --category=area           Specific area: categories|rules|tax|data\n\nExamples:\n  /agent-smith-health\n  /agent-smith-health --full\n```\n\n---\n\n## Additional Features\n\n### 1. Smart Alerts & Notifications\n\n**Alert Types:**\n- Budget alerts (overspending, trending)\n- Tax alerts (thresholds, EOFY deadlines, CGT timing)\n- Pattern alerts (new recurring charges, duplicates, unusual transactions)\n- Optimization alerts (unused subscriptions, fee increases)\n\n**Scheduling:**\n- Weekly spending summary\n- Monthly budget review\n- Quarterly trend analysis\n- EOFY tax prep reminder (May)\n- Post-budget cache refresh (October)\n\n### 2. Merchant Intelligence\n\n**Automated Payee Enrichment:**\n- Detect payee variations automatically\n- Group similar transactions\n- Learn from user corrections\n- Suggest canonical names\n\n**Merchant Insights:**\n- Spending patterns by merchant\n- Price trend tracking\n- Optimization suggestions\n\n### 3. Receipt & Document Management\n\n**Integration with PocketSmith Attachments:**\n- Flag transactions requiring receipts (>$300)\n- Track missing documentation\n- Generate substantiation reports\n- OCR receipt data\n- Auto-link receipts to transactions\n\n### 4. Multi-User & Shared Expense Tracking\n\n**Household Finance:**\n- Track shared expenses\n- Calculate settlement amounts\n- Split transactions by custom ratios\n- Generate \"who owes whom\" reports\n\n### 5. Investment Tracking\n\n**Portfolio Integration:**\n- Link transactions to investment events\n- Track cost basis\n- Calculate unrealized gains/losses\n- CGT optimization\n- Dividend tracking\n- Performance vs. benchmarks\n\n### 6. Cash Flow Forecasting\n\n**Intelligent Liquidity Management:**\n- Predict future account balances\n- Identify potential shortfalls\n- Optimize payment timing\n- Track recurring payments\n- Model major purchase impact\n\n### 7. Goal Tracking\n\n**Financial Goals:**\n- Emergency fund\n- House deposit\n- Debt payoff\n- Investment targets\n- Retirement savings\n\n**Progress Tracking:**\n- Automatic updates\n- On-track vs. behind alerts\n- Required contribution adjustments\n- Milestone celebrations\n\n### 8. Comparative Benchmarking\n\n**Anonymous Peer Comparison (Opt-In):**\n- Compare spending to similar households\n- Privacy-first (aggregated, anonymized)\n- Configurable peer criteria\n\n### 9. Audit Trail\n\n**Complete Activity Log:**\n- Every transaction modification\n- Category structure changes\n- Rule creation/updates\n- Bulk operations\n- Report generation\n\n**Benefits:**\n- \"Undo\" capability\n- Compliance tracking\n- Troubleshooting\n- Accountability\n\n### 10. Smart Backup & Recovery\n\n**Automated Protection:**\n- Before every bulk operation\n- Daily automatic backups (if changes made)\n- Pre-migration snapshots\n- Configurable retention\n\n**Recovery Tools:**\n- List backups\n- Preview backup contents\n- Selective restore\n- Full restore\n- Diff between backup and current\n\n---\n\n## Health Check System\n\n### Six Health Scores\n\n**1. Data Quality (0-100)**\n- Categorization coverage\n- Data completeness\n- Data consistency\n\n**2. Category Structure (0-100)**\n- Hierarchy optimization\n- Category usage\n- Tax alignment\n\n**3. Rule Engine (0-100)**\n- Rule coverage\n- Rule quality\n- Rule completeness\n\n**4. Tax Readiness (0-100)**\n- ATO compliance\n- Tax category mapping\n- EOFY preparation\n\n**5. Automation & Efficiency (0-100)**\n- Agent Smith utilization\n- PocketSmith feature usage\n- Data entry efficiency\n\n**6. Overall Health**\n- Composite of all scores\n- Top 3 priorities identified\n- Impact projections\n\n### Health Check Output\n\n```\nğŸ¥ AGENT SMITH HEALTH CHECK - OVERALL\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nOverall Score: 59/100 (Fair)\n\nIndividual Scores:\nâ”œâ”€ Data Quality:        72/100  âœ… Good\nâ”œâ”€ Category Structure:  58/100  âš ï¸ Needs Work\nâ”œâ”€ Rule Engine:         45/100  âš ï¸ Needs Improvement\nâ”œâ”€ Tax Readiness:       68/100  âš ï¸ Fair\nâ””â”€ Automation:          52/100  âš ï¸ Moderate\n\nğŸ¯ TOP 3 PRIORITIES:\n1. CREATE CATEGORY HIERARCHY (Highest Impact)\n2. EXPAND RULE COVERAGE (Quick Win)\n3. TAX COMPLIANCE FIXES (Risk Reduction)\n\nAfter completing: Projected score 96/100\n```\n\n### Automated Health Monitoring\n\n**Periodic Checks:**\n- Weekly quick health check\n- Monthly full health analysis\n- Pre-EOFY comprehensive check\n- Post-major-operation validation\n\n**Proactive Alerts:**\n- Health score changes\n- New recommendations\n- Declining tax readiness\n\n---\n\n## Configuration\n\n### .env.sample\n\n```bash\n# PocketSmith API Authentication\nPOCKETSMITH_API_KEY=<Your Developer API Key>\n\n# Agent Smith Configuration\nTAX_INTELLIGENCE_LEVEL=smart          # reference|smart|full\nDEFAULT_INTELLIGENCE_MODE=smart       # conservative|smart|aggressive\nAUTO_BACKUP=true\nAUTO_ARCHIVE=true\nALERT_NOTIFICATIONS=true\n\n# Tax Configuration (Australia)\nTAX_JURISDICTION=AU\nFINANCIAL_YEAR_END=06-30             # June 30\nGST_REGISTERED=false\n\n# Reporting Preferences\nDEFAULT_REPORT_FORMAT=all            # markdown|csv|json|html|excel|all\nCURRENCY=AUD\n\n# Advanced\nAPI_RATE_LIMIT_DELAY=100             # ms between calls\nCACHE_TTL_DAYS=7\nSUBAGENT_MAX_PARALLEL=5\n```\n\n### User Preferences (data/config.json)\n\n```json\n{\n  \"user_id\": 217031,\n  \"tax_level\": \"smart\",\n  \"intelligence_mode\": \"smart\",\n  \"alerts_enabled\": true,\n  \"alert_preferences\": {\n    \"budget\": true,\n    \"tax\": true,\n    \"patterns\": true,\n    \"optimization\": true,\n    \"frequency\": \"weekly\"\n  },\n  \"backup_before_mutations\": true,\n  \"auto_archive\": true,\n  \"default_report_formats\": [\"markdown\", \"csv\", \"html\"],\n  \"household\": {\n    \"enabled\": false,\n    \"members\": [],\n    \"split_method\": \"proportional\"\n  },\n  \"benchmarking\": {\n    \"enabled\": false,\n    \"criteria\": {}\n  }\n}\n```\n\n---\n\n## Implementation Roadmap\n\n### Phase 1: Foundation (Weeks 1-2)\n\n**Core Infrastructure:**\n- âœ… Directory structure creation\n- âœ… .env.sample and configuration files\n- âœ… INDEX.md templates for all directories\n- âœ… Python core libraries:\n  - api_client.py (PocketSmith API wrapper)\n  - archiver.py (smart archiving engine)\n  - index_updater.py (INDEX.md automation)\n  - backup.py (backup/restore utilities)\n  - validation.py (data validation)\n\n**Basic Functionality:**\n- âœ… API authentication and basic queries\n- âœ… Backup/restore system\n- âœ… Archiving automation\n- âœ… Logging infrastructure\n\n### Phase 2: Rule Engine (Weeks 3-4)\n\n**Hybrid Rule System:**\n- âœ… Local rule engine implementation\n- âœ… Platform rule tracking\n- âœ… Rule performance metrics\n- âœ… Intelligence mode implementation\n- âœ… Session rules\n- âœ… Rule validation and testing\n\n**Categorization:**\n- âœ… Basic categorization workflow\n- âœ… Batch categorization\n- âœ… Rule suggestion engine\n- âœ… Merchant normalization\n\n### Phase 3: Analysis & Reporting (Weeks 5-6)\n\n**Analysis Engine:**\n- âœ… Spending analysis\n- âœ… Trend detection\n- âœ… Category analysis\n- âœ… Pattern recognition\n\n**Multi-Format Reporting:**\n- âœ… Markdown reports\n- âœ… CSV/JSON exports\n- âœ… HTML dashboards (interactive)\n- âœ… Excel generation\n\n### Phase 4: Tax Intelligence (Weeks 7-8)\n\n**3-Tier Tax System:**\n- âœ… Level 1: Reference & Reporting\n- âœ… Level 2: Smart Categorization Assistant\n- âœ… Level 3: Full Compliance Suite\n\n**ATO Integration:**\n- âœ… Documentation caching\n- âœ… Category mappings\n- âœ… Deduction rules\n- âœ… CGT register\n- âœ… BAS preparation\n\n### Phase 5: Scenario Analysis (Weeks 9-10)\n\n**Scenario Engine:**\n- âœ… Historical analysis\n- âœ… Future projections\n- âœ… Optimization engine\n- âœ… Tax scenario planning\n\n**Advanced Analytics:**\n- âœ… Cash flow forecasting\n- âœ… Goal tracking\n- âœ… Investment tracking\n\n### Phase 6: Orchestration & UX (Weeks 11-12)\n\n**Subagent System:**\n- âœ… Subagent definitions\n- âœ… Orchestration logic\n- âœ… Parallel processing\n- âœ… Result aggregation\n\n**Slash Commands:**\n- âœ… All 8 slash commands\n- âœ… Argument parsing\n- âœ… Natural language integration\n- âœ… Interactive workflows\n\n### Phase 7: Advanced Features (Weeks 13-14)\n\n**Additional Capabilities:**\n- âœ… Smart alerts & notifications\n- âœ… Merchant intelligence\n- âœ… Document management\n- âœ… Multi-user support\n- âœ… Comparative benchmarking\n- âœ… Audit trail\n\n### Phase 8: Health Check & Polish (Weeks 15-16)\n\n**Health Check System:**\n- âœ… 6 health scores\n- âœ… Recommendation engine\n- âœ… Automated monitoring\n- âœ… Guided setup workflow\n\n**Polish & Testing:**\n- âœ… End-to-end testing\n- âœ… Documentation completion\n- âœ… Performance optimization\n- âœ… User guides\n\n---\n\n## Success Metrics\n\n**Efficiency Gains:**\n- Reduce manual categorization time by 60-80%\n- Auto-categorization rate: 70%+ (from ~5%)\n- Financial admin time: 45 min/week â†’ 10 min/week\n\n**Quality Improvements:**\n- Health score: 95/100 average\n- Categorization accuracy: 95%+\n- Tax compliance score: 90%+\n\n**User Satisfaction:**\n- All essential tax documents generated automatically\n- Proactive optimization suggestions implemented\n- Financial insights delivered weekly\n- Zero missed tax deadlines/thresholds\n\n---\n\n## Future Enhancements\n\n**v2.0 Potential Features:**\n- Machine learning for transaction categorization\n- Integration with other financial platforms\n- Mobile app companion\n- Real-time alerts via notifications\n- Advanced visualizations and dashboards\n- Multi-currency support enhancements\n- Business expense separation automation\n- Integration with accounting software (Xero, MYOB)\n- Predictive budget adjustments\n- AI financial advisor capabilities\n\n---\n\n**End of Design Document**\n\n**Status:** Ready for implementation\n**Next Steps:**\n1. Review and approve design\n2. Set up git worktree for isolated development\n3. Create detailed implementation plan\n4. Begin Phase 1: Foundation\n\n---\n\n**Document Version:** 1.0\n**Last Updated:** 2025-11-20\n**Approved By:** [Pending]\n",
        "agent-smith-plugin/skills/agent-smith/references/health-check-guide.md": "# Agent Smith Health Check Guide\n\n## Introduction\n\nThe Agent Smith health check system provides a comprehensive assessment of your PocketSmith financial setup. It analyzes six key dimensions of your financial data management, identifies issues, and provides prioritized recommendations for improvement.\n\n**Why use health checks?**\n\n- **Proactive Issue Detection**: Catch problems before they affect your financial tracking\n- **Continuous Improvement**: Track your setup quality over time with actionable metrics\n- **Tax Readiness**: Ensure your categorization and data quality meet compliance requirements\n- **Optimization Guidance**: Get specific recommendations to improve automation and accuracy\n\n---\n\n## The Six Health Dimensions\n\nAgent Smith evaluates your PocketSmith setup across six weighted dimensions:\n\n### 1. Data Quality (25% weight)\n\nThe foundation of accurate financial tracking. This dimension measures:\n\n| Metric | Description | Target |\n|--------|-------------|--------|\n| Uncategorized Rate | Percentage of transactions without categories | < 5% |\n| Duplicate Detection | Potential duplicate transactions identified | 0 |\n| Data Gaps | Missing transaction periods | None |\n| Description Quality | Transactions with meaningful descriptions | > 90% |\n\n**Why it matters**: Poor data quality cascades into inaccurate reports, missed deductions, and unreliable budgets.\n\n### 2. Category Structure (20% weight)\n\nHow well your category hierarchy is organized:\n\n| Metric | Description | Target |\n|--------|-------------|--------|\n| Category Depth | Optimal nesting (2-4 levels) | Balanced |\n| Unused Categories | Categories with no transactions | < 10% |\n| Unclassified Amounts | Money in catch-all categories | < 3% |\n| Category Distribution | Even spread across categories | No outliers |\n\n**Why it matters**: A well-structured category system makes analysis meaningful and tax preparation straightforward.\n\n### 3. Rule Engine (15% weight)\n\nEffectiveness of your categorization rules:\n\n| Metric | Description | Target |\n|--------|-------------|--------|\n| Rule Coverage | Transactions matched by rules | > 80% |\n| Rule Efficiency | Rules that actively match transactions | > 70% |\n| Conflict Detection | Rules with overlapping patterns | 0 |\n| Pattern Quality | Specificity of rule patterns | High |\n\n**Why it matters**: Strong rules reduce manual categorization work and ensure consistency.\n\n### 4. Tax Readiness (15% weight)\n\nPreparedness for tax reporting and compliance:\n\n| Metric | Description | Target |\n|--------|-------------|--------|\n| Tax Category Coverage | Deductible expenses properly categorized | > 95% |\n| Business/Personal Split | Clear separation where required | Complete |\n| Receipt Documentation | Transactions over $82.50 with receipts | 100% |\n| GST Tracking | GST amounts recorded where applicable | Complete |\n\n**Why it matters**: Poor tax categorization means missed deductions and compliance risks.\n\n### 5. Automation (10% weight)\n\nLevel of automated financial management:\n\n| Metric | Description | Target |\n|--------|-------------|--------|\n| Savings Automation | Automated transfers to savings | Active |\n| Bill Scheduling | Recurring bills tracked | > 90% |\n| Account Sync Freshness | Time since last sync | < 24 hours |\n| Auto-categorization Rate | Transactions auto-categorized | > 85% |\n\n**Why it matters**: Automation reduces manual effort and prevents missed payments.\n\n### 6. Budget Alignment (15% weight)\n\nHow well actual spending matches budgets:\n\n| Metric | Description | Target |\n|--------|-------------|--------|\n| Budget Variance | Difference from planned amounts | < 10% |\n| Overspending Categories | Categories over budget | < 20% |\n| Budget Coverage | Expenses covered by budgets | > 80% |\n| Forecast Accuracy | Predicted vs actual spending | > 85% |\n\n**Why it matters**: Budget alignment indicates financial discipline and planning accuracy.\n\n---\n\n## How to Run Health Checks\n\n### Using the Slash Command\n\nRun a health check using the Agent Smith command:\n\n```\n/agent-smith-health\n```\n\n### Command Options\n\n| Option | Description | Example |\n|--------|-------------|---------|\n| `full` | Complete analysis of all dimensions | `/agent-smith-health full` |\n| `quick` | Fast check of critical metrics only | `/agent-smith-health quick` |\n| `dimension` | Check specific dimension | `/agent-smith-health data-quality` |\n| `compare` | Compare to previous check | `/agent-smith-health compare` |\n\n### What Happens During a Health Check\n\n1. **Data Collection**: Agent Smith queries your PocketSmith account\n2. **Analysis**: Each dimension is evaluated against benchmarks\n3. **Scoring**: Individual and overall scores are calculated\n4. **Recommendations**: Prioritized action items are generated\n5. **Report**: Results are displayed and optionally saved\n\n---\n\n## Interpreting Scores\n\n### Score Ranges\n\n| Range | Rating | Meaning |\n|-------|--------|---------|\n| 90-100 | Excellent | Your setup is optimized and well-maintained |\n| 70-89 | Good | Solid foundation with minor improvements possible |\n| 50-69 | Needs Attention | Several areas require improvement |\n| 0-49 | Critical | Significant issues affecting financial tracking |\n\n### Status Indicators\n\nThroughout health check results, you will see these status indicators:\n\n| Indicator | Meaning |\n|-----------|---------|\n| `[PASS]` | Metric meets or exceeds target |\n| `[WARN]` | Metric is below target but not critical |\n| `[FAIL]` | Metric requires immediate attention |\n\n### Dimension Breakdown\n\nEach dimension shows:\n- **Score**: 0-100 for that dimension\n- **Weight**: How much it contributes to overall score\n- **Contribution**: Weighted points added to total\n- **Status**: Overall health of that dimension\n\n---\n\n## Understanding Recommendations\n\nHealth checks generate prioritized recommendations to improve your score.\n\n### Priority Levels\n\n| Priority | Description | Action Timeframe |\n|----------|-------------|------------------|\n| **Critical** | Issues affecting data integrity or compliance | Immediate (today) |\n| **High** | Significant impact on accuracy or efficiency | This week |\n| **Medium** | Improvements for better organization | This month |\n| **Low** | Nice-to-have optimizations | When convenient |\n\n### Effort Estimates\n\nEach recommendation includes an effort estimate:\n\n| Effort | Typical Time | Examples |\n|--------|--------------|----------|\n| **Quick Win** | < 15 minutes | Enable a setting, create one rule |\n| **Moderate** | 15-60 minutes | Reorganize categories, review duplicates |\n| **Significant** | 1-4 hours | Major category restructure, bulk updates |\n\n### Acting on Recommendations\n\nRecommendations follow this format:\n\n```\n[PRIORITY] Recommendation Title\n  Issue: What the problem is\n  Impact: Why it matters\n  Action: Specific steps to fix it\n  Effort: Time estimate\n```\n\n**Best practice**: Start with critical/quick-win items for maximum impact with minimum effort.\n\n---\n\n## Automated Monitoring\n\n### Weekly Health Checks\n\nAgent Smith can run automated weekly health checks:\n\n- **Schedule**: Every Sunday at midnight (configurable)\n- **Storage**: Results saved to `data/health/weekly/`\n- **Comparison**: Automatic comparison to previous week\n\n### Score Drop Alerts\n\nGet notified when your health score changes significantly:\n\n| Alert Type | Trigger | Priority |\n|------------|---------|----------|\n| Critical Drop | Score falls below 50 | High |\n| Significant Drop | Score drops > 15 points | Medium |\n| Dimension Alert | Any dimension falls to Critical | High |\n| Improvement | Score increases > 10 points | Info |\n\n### Configuring Alerts\n\nSet alert preferences in your environment or config:\n\n```bash\n# .env\nHEALTH_CHECK_ALERTS=true\nHEALTH_CHECK_THRESHOLD=15\n```\n\nOr in `data/config.json`:\n\n```json\n{\n  \"healthCheck\": {\n    \"weeklyEnabled\": true,\n    \"alertOnDrop\": true,\n    \"dropThreshold\": 15,\n    \"notificationMethod\": \"summary\"\n  }\n}\n```\n\n---\n\n## Example Output\n\nHere is a sample health check result:\n\n```\n================================================================================\n                        AGENT SMITH HEALTH CHECK\n                           2025-01-15 09:30 AM\n================================================================================\n\nOVERALL SCORE: 74/100 [GOOD]\n\n--------------------------------------------------------------------------------\nDIMENSION BREAKDOWN\n--------------------------------------------------------------------------------\n\n  Data Quality          [################----]  80/100  (25%)  = 20.0 pts\n  Category Structure    [###############-----]  75/100  (20%)  = 15.0 pts\n  Rule Engine           [############--------]  60/100  (15%)  =  9.0 pts  [WARN]\n  Tax Readiness         [################----]  82/100  (15%)  = 12.3 pts\n  Automation            [##############------]  70/100  (10%)  =  7.0 pts\n  Budget Alignment      [##############------]  72/100  (15%)  = 10.8 pts\n\n--------------------------------------------------------------------------------\nKEY METRICS\n--------------------------------------------------------------------------------\n\n  [PASS] Uncategorized transactions: 3.2% (target: <5%)\n  [PASS] Duplicate transactions: 0 found\n  [WARN] Rule coverage: 68% (target: >80%)\n  [PASS] Tax categories mapped: 94%\n  [WARN] Budget variance: 12% (target: <10%)\n\n--------------------------------------------------------------------------------\nRECOMMENDATIONS (5)\n--------------------------------------------------------------------------------\n\n  [CRITICAL] Quick Win\n    Create rules for top 10 uncategorized merchants\n    Issue: 15 merchants account for 60% of uncategorized transactions\n    Impact: Could improve rule coverage by 12%\n    Action: Run `/agent-smith-categorize analyze` to generate rules\n    Effort: 15 minutes\n\n  [HIGH] Moderate\n    Review category \"Other Expenses\"\n    Issue: $2,340 in catch-all category this month\n    Impact: Affects reporting accuracy and tax deduction tracking\n    Action: Recategorize transactions or create more specific categories\n    Effort: 30 minutes\n\n  [MEDIUM] Quick Win\n    Enable automatic account sync\n    Issue: Manual sync causing 2-3 day delays\n    Impact: Budgets and forecasts using stale data\n    Action: Enable daily sync in PocketSmith settings\n    Effort: 5 minutes\n\n  [MEDIUM] Moderate\n    Reduce budget variance in \"Dining Out\"\n    Issue: Consistently 25% over budget\n    Impact: Unrealistic budget affecting financial planning\n    Action: Adjust budget or implement spending alerts\n    Effort: 15 minutes\n\n  [LOW] Quick Win\n    Archive unused categories\n    Issue: 8 categories with no transactions in 6+ months\n    Impact: Clutters category picker, minor UX issue\n    Action: Review and archive or delete unused categories\n    Effort: 10 minutes\n\n--------------------------------------------------------------------------------\nTREND (Last 4 Weeks)\n--------------------------------------------------------------------------------\n\n  Week 1: 68  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘\n  Week 2: 71  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  (+3)\n  Week 3: 72  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  (+1)\n  Week 4: 74  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  (+2)  <- Current\n\n  Trend: Improving (+6 over 4 weeks)\n\n================================================================================\nNext scheduled check: 2025-01-22 00:00\nRun `/agent-smith-health compare` to see detailed changes\n================================================================================\n```\n\n---\n\n## Troubleshooting\n\n### Common Issues\n\n#### \"Unable to connect to PocketSmith\"\n\n**Cause**: API key missing or invalid\n\n**Solution**:\n1. Check `.env` file contains `POCKETSMITH_API_KEY`\n2. Verify the key is valid at PocketSmith Developer Settings\n3. Ensure no extra whitespace around the key\n\n#### \"Health check taking too long\"\n\n**Cause**: Large transaction history or slow API response\n\n**Solution**:\n1. Use `/agent-smith-health quick` for faster results\n2. Check your internet connection\n3. Try again during off-peak hours\n\n#### \"Scores seem inaccurate\"\n\n**Cause**: Stale cached data or sync issues\n\n**Solution**:\n1. Force sync your PocketSmith accounts\n2. Clear Agent Smith cache: check `data/cache/`\n3. Run a full health check: `/agent-smith-health full`\n\n#### \"Recommendations don't apply to my situation\"\n\n**Cause**: Generic recommendations may not fit all users\n\n**Solution**:\n1. Adjust targets in `data/config.json`\n2. Use `/agent-smith configure` to set your preferences\n3. Dismiss inapplicable recommendations\n\n#### \"Missing dimension scores\"\n\n**Cause**: Insufficient data for analysis\n\n**Solution**:\n1. Ensure you have at least 30 days of transaction history\n2. Verify all accounts are synced\n3. Check that categories are set up in PocketSmith\n\n### Getting Help\n\nIf issues persist:\n\n1. Check `data/logs/` for error details\n2. Run `/agent-smith-health --debug` for verbose output\n3. Review the design documentation at `docs/design/`\n\n---\n\n## Quick Reference\n\n| Task | Command |\n|------|---------|\n| Run full health check | `/agent-smith-health` |\n| Quick check | `/agent-smith-health quick` |\n| Check specific dimension | `/agent-smith-health data-quality` |\n| Compare to last check | `/agent-smith-health compare` |\n| View trends | `/agent-smith-health trends` |\n| Configure alerts | `/agent-smith configure alerts` |\n\n---\n\n*For more information, see the complete [Agent Smith Design Document](../design/2025-11-20-agent-smith-design.md).*\n",
        "agent-smith-plugin/skills/agent-smith/references/onboarding-guide.md": "# Agent Smith Onboarding Guide\n\nWelcome to Agent Smith! This guide walks you through your first-time setup and helps you get the most out of your PocketSmith integration.\n\n## Before You Begin\n\n**Prerequisites:**\n1. âœ… Agent Smith installed (see [INSTALL.md](../../INSTALL.md))\n2. âœ… PocketSmith account with API access\n3. âœ… API key configured in `.env` file\n4. âœ… Python 3.9+ and `uv` installed\n\n**Time Required:** 30-60 minutes (depending on transaction volume)\n\n---\n\n## The Onboarding Journey\n\nAgent Smith's onboarding is an 8-stage interactive process that:\n- Discovers your PocketSmith account structure\n- Recommends and customizes rule templates\n- Incrementally categorizes your transactions\n- Shows measurable improvement with health scores\n\n### Quick Start\n\n```bash\n# Launch the onboarding wizard\n/agent-smith-onboard\n```\n\nClaude will guide you through each stage interactively.\n\n---\n\n## Stage 1: Prerequisites Check\n\n**What happens:**\n- Verifies Agent Smith installation\n- Checks API key configuration\n- Tests PocketSmith connection\n\n**If something is missing:**\n- Follow the prompts to complete installation\n- Refer to [INSTALL.md](../../INSTALL.md) for detailed setup\n\n**Time:** 2 minutes\n\n---\n\n## Stage 2: Discovery\n\n**What happens:**\n- Analyzes your PocketSmith account structure\n- Counts accounts, categories, and transactions\n- Identifies uncategorized transactions\n- Calculates baseline health score\n\n**What you'll see:**\n```\nâœ“ Connected as: your@email.com\nâœ“ Accounts: 3 (Checking, Savings, Credit Card)\nâœ“ Categories: 47\nâœ“ Transactions: 2,387\nâœ“ Uncategorized: 1,245 (52%)\nâœ“ Date Range: Jan 2023 - Nov 2025\nâœ“ Baseline Health Score: 45/100 (Critical)\nâœ“ Recommended Template: shared-household\n```\n\n**Time:** 5-10 minutes (depends on data volume)\n\n---\n\n## Stage 3: Template Selection\n\n**What happens:**\n- Shows 4 template options\n- Recommends best fit based on discovery\n- Applies selected template to `data/rules.yaml`\n\n**Templates:**\n\n| Template | Best For | Includes |\n|----------|----------|----------|\n| **Simple** | Single person, basic tracking | Common categories, essential rules |\n| **Separated Families** | Child support, shared custody | Kids expenses, contributor tracking |\n| **Shared Household** | Couples, roommates | Shared expense tracking, approval workflows |\n| **Advanced** | Business owners, investors | Tax optimization, investment tracking, CGT |\n\n**What you'll do:**\n- Review the recommendation\n- Choose a template (or browse all)\n- Confirm application\n\n**Time:** 3-5 minutes\n\n---\n\n## Stage 4: Template Customization\n\n**What happens:**\n- Guides you to customize the template for your needs\n\n**Customizations needed:**\n\n1. **Account Mapping**\n   - Template uses generic names like \"Shared Bills\", \"Personal\"\n   - Update to match your actual account names\n\n2. **Category Validation**\n   - Check if template categories exist in PocketSmith\n   - Create missing categories or map to existing ones\n\n3. **Merchant Localization**\n   - Template has Australian merchants (WOOLWORTHS, COLES)\n   - Update for your region (SAFEWAY, KROGER, etc.)\n\n**How to customize:**\n- Edit `data/rules.yaml` manually (for now)\n- Future versions will have interactive customization tool\n\n**Example:**\n```yaml\n# Before (template)\n- type: category\n  patterns: [WOOLWORTHS, COLES]\n  category: Food & Dining > Groceries\n\n# After (customized for US)\n- type: category\n  patterns: [SAFEWAY, KROGER, WHOLE FOODS]\n  category: Food & Dining > Groceries\n```\n\n**Time:** 10-20 minutes\n\n---\n\n## Stage 5: Intelligence Mode Selection\n\n**What happens:**\n- Configure AI categorization behavior\n- Set tax intelligence level\n\n**Categorization Mode:**\n\n| Mode | Auto-Apply Threshold | Best For |\n|------|---------------------|----------|\n| Conservative | 100% (manual approval all) | First-time setup, learning |\n| **Smart** (default) | â‰¥90% confidence | Most users, balanced |\n| Aggressive | â‰¥80% confidence | High volume, trust AI |\n\n**Tax Intelligence Level:**\n\n| Level | Capabilities | Best For |\n|-------|-------------|----------|\n| Reference | ATO category mapping, basic reports | Users with accountants |\n| **Smart** (default) | Deduction detection, thresholds | Most taxpayers |\n| Full | BAS prep, compliance checks | Business owners, power users |\n\n**Time:** 2 minutes\n\n---\n\n## Stage 6: Incremental Categorization\n\n**What happens:**\n- Categorize transactions in manageable batches\n- Start recent, expand to historical\n\n**Recommended Strategy:**\n\n1. **Current Month** (test rules on small dataset)\n   ```bash\n   uv run python scripts/operations/batch_categorize.py --mode=dry_run --period=2025-11\n   uv run python scripts/operations/batch_categorize.py --mode=apply --period=2025-11\n   ```\n\n2. **Last 3 Months** (validate at scale)\n   ```bash\n   uv run python scripts/operations/batch_categorize.py --mode=apply --period=2025-09:2025-11\n   ```\n\n3. **Full Backfill** (complete the archive)\n   ```bash\n   uv run python scripts/operations/batch_categorize.py --mode=apply --period=2023-01:2025-11\n   ```\n\n**After Each Batch:**\n- Review results (matched, auto-applied, needs review)\n- Approve medium-confidence suggestions\n- Agent Smith learns new rules from your corrections\n\n**Time:** 20-60 minutes (depends on volume and mode)\n\n---\n\n## Stage 7: Health Check & Progress\n\n**What happens:**\n- Run post-categorization health check\n- Show before/after improvement\n- Identify remaining priorities\n\n**What you'll see:**\n```\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nAGENT SMITH HEALTH CHECK - PROGRESS REPORT\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nBaseline (before):    45/100 (Critical)\nCurrent:              78/100 (Good) â¬† +33 points\n\nImprovements:\nâ€¢ Data Quality:        42 â†’ 88 (+46) âœ…\nâ€¢ Rule Engine:         15 â†’ 72 (+57) âœ…\nâ€¢ Category Structure:  58 â†’ 81 (+23) âœ…\n\nRemaining priorities:\n1. Review tax category mappings\n2. Add 3 more rules for recurring merchants\n3. Create budgets for top 5 categories\n```\n\n**Time:** 5 minutes\n\n---\n\n## Stage 8: Ongoing Usage\n\n**What happens:**\n- Receive guidance on regular Agent Smith usage\n- Get quick reference for common operations\n\n**Daily/Weekly:**\n```bash\n/agent-smith-categorize --mode=smart --period=2025-11\n```\n\n**Monthly:**\n```bash\n/agent-smith-analyze spending --period=2025-11\n/agent-smith-health --quick\n```\n\n**Quarterly:**\n```bash\n/agent-smith-tax deductions --period=2024-25\n```\n\n**Annual (EOFY):**\n```bash\n/agent-smith-tax eofy\n```\n\n**Time:** 2 minutes\n\n---\n\n## Troubleshooting\n\n### Onboarding Interrupted\n\nIf onboarding is interrupted, your progress is saved in `data/onboarding_state.json`.\n\n**Resume:**\n```bash\n/agent-smith-onboard\n```\n\nClaude will detect saved state and offer to resume from where you left off.\n\n**Start Over:**\n```bash\nuv run python -c \"from scripts.onboarding.state import OnboardingState; OnboardingState().reset()\"\n/agent-smith-onboard\n```\n\n### Discovery Fails\n\n**Problem:** \"Error during discovery: ...\"\n\n**Solutions:**\n- Check `.env` has valid `POCKETSMITH_API_KEY`\n- Verify PocketSmith account has API access enabled\n- Check internet connection to api.pocketsmith.com\n\n### Template Customization Unclear\n\n**Problem:** Not sure how to customize `data/rules.yaml`\n\n**Solutions:**\n- Review [Unified Rules Guide](unified-rules-guide.md) for YAML syntax\n- Check [Example Files](../examples/) for patterns\n- Start with dry-run to test rules before applying\n\n### Categorization Too Slow\n\n**Problem:** Batch categorization taking too long\n\n**Solutions:**\n- Use smaller date ranges (1 month at a time)\n- Switch to \"Aggressive\" mode for faster auto-apply\n- Run in background with progress monitoring\n\n---\n\n## Next Steps\n\nAfter completing onboarding:\n\n1. **Set Up Alerts**\n   - Weekly budget reviews\n   - Monthly trend analysis\n   - Tax deadline reminders\n\n2. **Create Budgets**\n   - Use health check recommendations\n   - Focus on top spending categories\n   - Track vs. budget monthly\n\n3. **Optimize Rules**\n   - Review rule performance metrics\n   - Add rules for recurring merchants\n   - Refine confidence scores\n\n4. **Explore Advanced Features**\n   - Scenario analysis\n   - Tax optimization\n   - Investment tracking\n\n---\n\n## Getting Help\n\n- **Documentation:** [docs/](../INDEX.md)\n- **API Reference:** [ai_docs/pocketsmith-api-documentation.md](../../ai_docs/pocketsmith-api-documentation.md)\n- **Health Check Guide:** [health-check-guide.md](health-check-guide.md)\n- **GitHub Issues:** [github.com/slamb2k/agent-smith/issues](https://github.com/slamb2k/agent-smith/issues)\n\n---\n\n**Welcome to Agent Smith! Let's transform your PocketSmith into an intelligent financial system.**\n",
        "agent-smith-plugin/skills/agent-smith/references/pocketsmith-api.md": "# PocketSmith API Documentation (Offline Reference)\n\n**API Version:** v2.0\n**Base URL:** `https://api.pocketsmith.com/v2`\n**Documentation Source:** https://developers.pocketsmith.com/\n**Last Updated:** 2025-11-16\n\n---\n\n## Table of Contents\n\n1. [Introduction](#introduction)\n2. [Authentication](#authentication)\n   - [Developer Keys](#developer-keys-personal-tools)\n   - [OAuth 2.0](#oauth-20-multi-user-apps)\n3. [API Reference](#api-reference)\n   - [Users](#users)\n   - [Institutions](#institutions)\n   - [Accounts](#accounts)\n   - [Transaction Accounts](#transaction-accounts)\n   - [Transactions](#transactions)\n   - [Categories](#categories)\n   - [Budgeting](#budgeting)\n   - [Supporting Resources](#supporting-resources)\n4. [Common Topics](#common-topics)\n   - [Pagination](#pagination)\n   - [Error Handling](#error-handling)\n5. [Changelog](#changelog)\n6. [Support](#support)\n\n---\n\n## Introduction\n\nThe PocketSmith API is freely available to all developers without restrictions. The platform welcomes developers to build tools and integrations using their services.\n\n**Developer Hub:** https://developers.pocketsmith.com/\n\n---\n\n## Authentication\n\nPocketSmith provides two authentication methods depending on your use case.\n\n### Developer Keys (Personal Tools)\n\nFor building personal tools like dashboard widgets or transaction importers, use developer keys.\n\n**Configuration:**\n- Manage keys in: Settings > Security within your PocketSmith account\n- **Header:** `X-Developer-Key`\n- **Access:** Persistent API access to your own account\n\n**Example Request:**\n```bash\ncurl --header \"X-Developer-Key: YOUR_KEY_HERE\" \\\n  https://api.pocketsmith.com/v2/me\n```\n\n**Supported Languages:**\n- Shell (curl)\n- Node.js\n- JavaScript\n- PHP\n- Python\n\n### OAuth 2.0 (Multi-User Apps)\n\nTo create applications that other PocketSmith users can access, you'll need to use OAuth 2.0.\n\n**Setup Process:**\n\n1. **Register your application** by contacting the team at [email protected]\n2. **Provide details** about yourself and your planned integration\n3. **Receive credentials:** `client_id` and `client_secret` upon approval\n4. **Implement authentication** using the OAuth integration guide\n\n**OAuth Flow:**\n- Standard OAuth 2.0 authorization code flow\n- Detailed integration instructions available in the OAuth documentation section\n\n---\n\n## API Reference\n\nThe PocketSmith API v2.0 is organized around the following resource categories:\n\n### Users\n\n**Endpoints:**\n- Get authorised user\n- Get user by ID\n- Update user information\n\n**Example - Get the Authorised User:**\n```\nGET https://api.pocketsmith.com/v2/me\n```\n\n**Purpose:** Gets the user that corresponds to the access token used in the request.\n\n**Authentication Required:** Yes (Header-based credentials)\n\n---\n\n### Institutions\n\nManage financial institutions connected to user accounts.\n\n**Operations:**\n- Create institution\n- Read institution details\n- Update institution information\n- Delete institution\n- List all institutions within a user account\n\n---\n\n### Accounts\n\nComplete account management functionality.\n\n**Operations:**\n- Get account details\n- Update account information\n- Delete account\n- Create new account\n- Manage account ordering within users\n- List accounts by institution\n\n---\n\n### Transaction Accounts\n\nTransaction accounts are the specific accounts where transactions are recorded.\n\n**Operations:**\n- Get transaction account details\n- Update transaction account\n- List transaction accounts by user\n\n---\n\n### Transactions\n\nComplete transaction lifecycle management with multi-context querying.\n\n**Query Contexts:**\n- By user\n- By account\n- By category\n- By transaction account\n\n**Operations:**\n- Create transactions within transaction accounts\n- Read transaction details\n- Update transactions\n- Delete transactions\n- Query and filter transactions\n\n---\n\n### Categories\n\nManage and organize transaction categories.\n\n**Operations:**\n- Category management and organization\n- List user-specific categories\n- Create category rules\n- Update categories\n- Delete categories\n\n---\n\n### Budgeting\n\nBudget management and analysis features.\n\n**Features:**\n- Budget retrieval and summaries\n- Trend analysis\n- Forecast cache management\n\n---\n\n### Supporting Resources\n\nAdditional resources for comprehensive financial data management:\n\n- **Events** - Manage financial events\n- **Attachments** - Attach files to transactions\n- **Labels** - Label and tag transactions\n- **Saved Searches** - Save frequently used search queries\n- **Currencies** - Handle multi-currency support\n- **Time Zones** - Manage timezone settings\n\n---\n\n## Common Topics\n\n### Pagination\n\nThe API uses pagination for endpoints that return multiple records.\n\n**Implementation Details:**\n- Refer to the pagination documentation section for page size limits and navigation\n- Response headers typically include pagination metadata\n\n### Error Handling\n\nThe API returns standard HTTP status codes.\n\n**Common Status Codes:**\n- `200 OK` - Successful request\n- `400 Bad Request` - Invalid request parameters\n- `401 Unauthorized` - Authentication failure\n- `403 Forbidden` - Insufficient permissions\n- `404 Not Found` - Resource not found\n- `500 Internal Server Error` - Server error\n\n**Error Response Format:**\nDetailed error handling documentation available at: https://developers.pocketsmith.com/docs\n\n---\n\n## Changelog\n\n### v2.0 - Welcome to the new PocketSmith developer hub\n**Posted:** Almost 7 years ago by Regan McEntyre\n\nThe development team announced an updated documentation portal: \"We've given our developer documentation a bit of a spruce up. Come on in and check it out, and let us know what you think!\"\n\n**Current Status:**\n- API Version 2.0 is the current stable version\n- Interactive API documentation powered by OpenAPI 3 specification\n\n---\n\n## Support\n\n**Contact the Development Team:**\n- **Email:** [email protected]\n\n**Resources:**\n- **Interactive API Reference:** https://developers.pocketsmith.com/reference\n- **Complete Guides:** https://developers.pocketsmith.com/docs\n- **Changelog:** https://developers.pocketsmith.com/changelog\n\n---\n\n## Quick Start Guide\n\n1. **For Personal Tools:**\n   ```bash\n   # Get your developer key from Settings > Security\n   curl --header \"X-Developer-Key: YOUR_KEY_HERE\" \\\n     https://api.pocketsmith.com/v2/me\n   ```\n\n2. **For Multi-User Applications:**\n   - Email [email protected] to register your app\n   - Implement OAuth 2.0 flow once approved\n\n3. **Explore the API:**\n   - Start with the `/me` endpoint to verify authentication\n   - Review the resource categories that match your use case\n   - Test endpoints using the interactive reference\n\n---\n\n## Additional Notes\n\n**OpenAPI Specification:**\nThe API documentation is built using OpenAPI 3, which means:\n- Interactive testing tools available in the web interface\n- Machine-readable API specifications\n- Auto-generated client libraries possible\n\n**Rate Limiting:**\nCheck the full documentation for any rate limiting policies.\n\n**Best Practices:**\n- Always handle errors gracefully\n- Use pagination for large datasets\n- Cache responses where appropriate\n- Follow OAuth 2.0 best practices for multi-user apps\n\n---\n\n**End of Documentation**\n\nFor the most up-to-date information and interactive API testing, visit: https://developers.pocketsmith.com/\n",
        "agent-smith-plugin/skills/agent-smith/references/unified-rules-guide.md": "# Unified Rules Guide - Categories & Labels\n\n## Overview\n\nAgent Smith uses a **unified YAML rule system** that handles both transaction categorization and labeling in a single, easy-to-read file.\n\n**Key Features:**\n- YAML format - Easy to read and edit\n- Two-phase execution - Categories first, then labels\n- Pattern matching - Regex patterns with exclusions\n- Confidence scoring - 0-100% confidence for auto-apply logic\n- Smart labeling - Context-aware labels (account, category, amount)\n- LLM fallback - AI categorization when rules don't match\n- Template system - Pre-built rule sets for common household types\n\n## Table of Contents\n\n1. [Quick Start](#quick-start)\n2. [Rule Types](#rule-types)\n3. [Execution Flow](#execution-flow)\n4. [Intelligence Modes](#intelligence-modes)\n5. [LLM Integration](#llm-integration)\n6. [Advanced Patterns](#advanced-patterns)\n7. [Best Practices](#best-practices)\n8. [Operational Modes](#operational-modes)\n9. [Update Strategies](#update-strategies)\n10. [Template System](#template-system)\n11. [Migration Guide](#migration-guide)\n12. [Troubleshooting](#troubleshooting)\n\n## Quick Start\n\n### 1. Choose a Template\n\nStart with a pre-built template that matches your household type:\n\n```bash\nuv run python scripts/setup/template_selector.py\n```\n\nAvailable templates:\n- **Simple** - Single person, no shared expenses\n- **Separated Families** - Divorced/separated parents with shared custody\n- **Shared Household** - Couples, roommates, or families\n- **Advanced** - Business owners, investors, complex finances\n\n### 2. Customize Your Rules\n\nEdit `data/rules.yaml` to match your specific needs:\n\n```yaml\nrules:\n  # Add your first category rule\n  - type: category\n    name: Coffee â†’ Dining Out\n    patterns: [STARBUCKS, COSTA, CAFE]\n    category: Food & Dining > Dining Out\n    confidence: 95\n\n  # Add your first label rule\n  - type: label\n    name: Personal Coffee\n    when:\n      categories: [Dining Out]\n      accounts: [Personal]\n    labels: [Discretionary, Personal]\n```\n\n### 3. Test Your Rules\n\nAlways test before applying to real transactions:\n\n```bash\n# Dry run - preview what would happen\nuv run python scripts/operations/batch_categorize.py --mode=dry_run --period=2025-11\n\n# Validate - see what would change on existing categorizations\nuv run python scripts/operations/batch_categorize.py --mode=validate --period=2025-11\n\n# Apply - actually categorize transactions\nuv run python scripts/operations/batch_categorize.py --mode=apply --period=2025-11\n```\n\n### 4. Review and Refine\n\nCheck the results and refine your rules:\n\n```bash\n# See categorization summary\n/agent-smith-analyze spending --period=2025-11\n\n# Check uncategorized transactions\n/agent-smith-categorize --mode=smart --show-uncategorized\n```\n\n## Rule Types\n\n### Category Rules\n\nCategorize transactions based on payee patterns, amounts, and accounts.\n\n**Full Syntax:**\n\n```yaml\n- type: category\n  name: Rule Name (for logging/display)\n  patterns: [PATTERN1, PATTERN2, PATTERN3]  # OR logic\n  exclude_patterns: [EXCLUDE1, EXCLUDE2]    # Optional\n  category: Category > Subcategory\n  confidence: 95                             # 0-100%\n  accounts: [Account1, Account2]             # Optional filter\n  amount_operator: \">\"                       # Optional: >, <, >=, <=, ==, !=\n  amount_value: 100.00                       # Required if amount_operator set\n```\n\n**Field Descriptions:**\n\n| Field | Required | Type | Description |\n|-------|----------|------|-------------|\n| `type` | Yes | String | Must be \"category\" |\n| `name` | Yes | String | Descriptive name for logs (e.g., \"WOOLWORTHS â†’ Groceries\") |\n| `patterns` | Yes | List[String] | Payee keywords to match (case-insensitive, OR logic) |\n| `category` | Yes | String | Category to assign (can include parent: \"Parent > Child\") |\n| `confidence` | No | Integer | Confidence score 0-100% (default: 90) |\n| `exclude_patterns` | No | List[String] | Patterns to exclude from match |\n| `accounts` | No | List[String] | Only match transactions in these accounts |\n| `amount_operator` | No | String | Amount comparison: >, <, >=, <=, ==, != |\n| `amount_value` | No | Number | Amount threshold (required if operator set) |\n\n**Examples:**\n\n```yaml\n# Basic pattern matching\n- type: category\n  name: WOOLWORTHS â†’ Groceries\n  patterns: [WOOLWORTHS, COLES, ALDI]\n  category: Food & Dining > Groceries\n  confidence: 95\n\n# With exclusions (exclude UBER EATS from UBER)\n- type: category\n  name: UBER â†’ Transport\n  patterns: [UBER]\n  exclude_patterns: [UBER EATS]\n  category: Transport\n  confidence: 90\n\n# Account-specific rule\n- type: category\n  name: Work Laptop Purchase\n  patterns: [APPLE STORE, MICROSOFT STORE]\n  accounts: [Work Credit Card]\n  category: Work > Equipment\n  confidence: 90\n\n# Amount-based rule (large purchases)\n- type: category\n  name: Large Electronics\n  patterns: [JB HI-FI, HARVEY NORMAN]\n  category: Shopping > Electronics\n  confidence: 85\n  amount_operator: \">\"\n  amount_value: 500\n```\n\n### Label Rules\n\nApply labels to transactions based on their category, account, amount, or categorization status.\n\n**Full Syntax:**\n\n```yaml\n- type: label\n  name: Label Rule Name\n  when:\n    categories: [Category1, Category2]       # Optional (OR logic)\n    accounts: [Account1, Account2]           # Optional (OR logic)\n    amount_operator: \">\"                     # Optional\n    amount_value: 100.00                     # Required if operator set\n    uncategorized: true                      # Optional (true to match uncategorized)\n  labels: [Label1, Label2, Label3]\n```\n\n**Important:** All `when` conditions must match (AND logic), but values within each list use OR logic.\n\n**Field Descriptions:**\n\n| Field | Required | Type | Description |\n|-------|----------|------|-------------|\n| `type` | Yes | String | Must be \"label\" |\n| `name` | Yes | String | Descriptive name for logs |\n| `when` | Yes | Object | Conditions that must ALL match |\n| `when.categories` | No | List[String] | Match if category contains any of these (OR) |\n| `when.accounts` | No | List[String] | Match if account name contains any of these (OR) |\n| `when.amount_operator` | No | String | Amount comparison: >, <, >=, <=, ==, != |\n| `when.amount_value` | No | Number | Amount threshold |\n| `when.uncategorized` | No | Boolean | Match uncategorized transactions (true/false) |\n| `labels` | Yes | List[String] | Labels to apply when conditions match |\n\n**Examples:**\n\n```yaml\n# Category-based labeling\n- type: label\n  name: Tax Deductible Work Expenses\n  when:\n    categories: [Work, Professional Development, Home Office]\n  labels: [Tax Deductible, ATO: D1]\n\n# Account-based labeling\n- type: label\n  name: Shared Household Expense\n  when:\n    accounts: [Shared Bills, Joint Account]\n  labels: [Shared Expense, Needs Reconciliation]\n\n# Combined conditions (category AND account)\n- type: label\n  name: Personal Coffee Spending\n  when:\n    categories: [Dining Out]\n    accounts: [Personal]\n  labels: [Discretionary, Personal]\n\n# Amount-based labeling\n- type: label\n  name: Large Purchase Flag\n  when:\n    amount_operator: \">\"\n    amount_value: 500\n  labels: [Large Purchase, Review Required]\n\n# Flag uncategorized transactions\n- type: label\n  name: Needs Categorization\n  when:\n    uncategorized: true\n  labels: [Uncategorized, Needs Review]\n\n# Multi-condition (category AND account AND amount)\n- type: label\n  name: Large Shared Grocery Trip\n  when:\n    categories: [Groceries]\n    accounts: [Shared Bills]\n    amount_operator: \">\"\n    amount_value: 200\n  labels: [Shared Expense, Large Purchase, Needs Approval]\n```\n\n## Execution Flow\n\nThe unified rule engine uses **two-phase execution** to ensure labels can depend on categories assigned in the same run.\n\n### Phase 1: Categorization\n\n1. Iterate through all category rules in order\n2. For each transaction, find the FIRST matching rule\n3. Apply the category and confidence score\n4. **Short-circuit:** Stop at first match (no further category rules evaluated)\n5. Update transaction with matched category for Phase 2\n\n**Rule Order Matters!** Specific rules should come before general rules.\n\n### Phase 2: Labeling\n\n1. Using the transaction (now with category from Phase 1)\n2. Check ALL label rules\n3. Apply labels from EVERY matching rule (additive)\n4. Deduplicate and sort labels\n\n**All Matches Applied!** Unlike categories, ALL matching label rules are applied.\n\n### Example Execution\n\nTransaction: `WOOLWORTHS` in `Shared Bills` account, amount `-$127.50`\n\n**Phase 1 - Category Rules:**\n\n```yaml\n# Rule 1 matches!\n- type: category\n  name: WOOLWORTHS â†’ Groceries\n  patterns: [WOOLWORTHS]\n  category: Food & Dining > Groceries\n  confidence: 95\n\n# Rule 2 would also match but is NOT evaluated (short-circuit)\n- type: category\n  name: All Food Purchases\n  patterns: [WOOLWORTHS, COLES, RESTAURANT]\n  category: Food\n  confidence: 80\n```\n\n**Result after Phase 1:** Category = \"Food & Dining > Groceries\", Confidence = 95\n\n**Phase 2 - Label Rules:**\n\n```yaml\n# Rule 1 matches (category: Groceries, account: Shared Bills)\n- type: label\n  name: Shared Grocery Expense\n  when:\n    categories: [Groceries]\n    accounts: [Shared Bills]\n  labels: [Shared Expense, Essential]\n\n# Rule 2 matches (amount > 100)\n- type: label\n  name: Large Purchase\n  when:\n    amount_operator: \">\"\n    amount_value: 100\n  labels: [Large Purchase, Review]\n\n# Rule 3 does NOT match (category doesn't contain \"Dining Out\")\n- type: label\n  name: Discretionary Dining\n  when:\n    categories: [Dining Out]\n  labels: [Discretionary]\n```\n\n**Final Result:**\n- Category: Food & Dining > Groceries\n- Confidence: 95\n- Labels: Essential, Large Purchase, Review, Shared Expense (sorted, deduplicated)\n\n## Intelligence Modes\n\nAgent Smith has three intelligence modes that control auto-apply behavior based on confidence scores.\n\n### Conservative Mode\n\n**Never auto-applies** - always asks user for confirmation.\n\n```yaml\nConfidence Level: ANY\nAction: Ask user for approval\nUse when: Learning the system, want full control\n```\n\nExample:\n```\nTransaction: STARBUCKS -$6.50\nRule match: \"Dining Out\" (95% confidence)\nâ†’ [Ask User] Apply category \"Dining Out\"?\n  [Yes] [No] [Edit]\n```\n\n### Smart Mode (Default)\n\n**Balanced approach** - auto-applies high confidence, asks for medium, skips low.\n\n```yaml\nConfidence â‰¥ 90%:  Auto-apply without asking\nConfidence 70-89%: Ask user for approval (LLM validates first)\nConfidence < 70%:  Skip (don't categorize)\n```\n\nExample:\n```\nTransaction: UBER -$25.00\nRule match: \"Transport\" (95% confidence)\nâ†’ [Auto-applied] Category: Transport\n\nTransaction: UBER MEDICAL CENTRE -$80\nRule match: \"UBER â†’ Transport\" (75% confidence)\nâ†’ [LLM Validates] This looks like medical, not transport\nâ†’ [Suggests] Medical & Healthcare (90% confidence)\nâ†’ [Auto-applied] Category: Medical & Healthcare\n```\n\n### Aggressive Mode\n\n**More permissive** - auto-applies medium-high confidence, asks for medium-low.\n\n```yaml\nConfidence â‰¥ 80%: Auto-apply without asking\nConfidence 50-79%: Ask user for approval\nConfidence < 50%: Skip (don't categorize)\n```\n\nExample:\n```\nTransaction: ACME WIDGETS -$245.00\nRule match: \"Business Supplies\" (82% confidence)\nâ†’ [Auto-applied] Category: Business Supplies\n```\n\n### Setting the Mode\n\n**In command:**\n```bash\n/agent-smith-categorize --mode=smart\n```\n\n**In environment (.env):**\n```bash\nDEFAULT_INTELLIGENCE_MODE=smart\n```\n\n**In code:**\n```python\nfrom scripts.workflows.categorization import CategorizationWorkflow\n\nworkflow = CategorizationWorkflow(\n    client=client,\n    mode=\"smart\"  # conservative, smart, or aggressive\n)\n```\n\n## LLM Integration\n\nWhen rule-based categorization fails, Agent Smith falls back to AI-powered categorization using Claude.\n\n### Fallback Categorization\n\nWhen no rule matches, Agent Smith asks the LLM to suggest a category.\n\n**Flow:**\n\n1. No category rule matches transaction\n2. Build LLM prompt with:\n   - Full category hierarchy\n   - Transaction details (payee, amount, date)\n   - Intelligence mode guidance\n3. LLM suggests category with confidence and reasoning\n4. Apply intelligence mode thresholds:\n   - High confidence â†’ Auto-apply (or ask in conservative mode)\n   - Medium confidence â†’ Ask user\n   - Low confidence â†’ Skip\n\n**Example:**\n\n```\nTransaction: ACME WIDGETS LTD -$245.00\nNo rule match\nâ†’ [LLM] Analyzing transaction...\nâ†’ [LLM] Suggests: Business Supplies (85% confidence)\n   Reasoning: \"ACME WIDGETS appears to be a business supplier based on\n   naming convention and typical transaction amount.\"\nâ†’ [Smart Mode] 85% is above ask threshold (70%) but below auto (90%)\nâ†’ [Ask User] Apply category \"Business Supplies\"?\n   [Yes] [No] [Create Rule]\n```\n\n### Validation\n\nMedium-confidence rule matches (70-89% in smart mode) are validated by the LLM to catch edge cases.\n\n**Flow:**\n\n1. Rule matches with medium confidence\n2. Build validation prompt with:\n   - Transaction details\n   - Suggested category\n   - Rule confidence\n3. LLM responds: CONFIRM or REJECT\n   - CONFIRM: Can upgrade confidence â†’ auto-apply\n   - REJECT: Suggests alternative category\n4. Apply validated result\n\n**Example:**\n\n```\nTransaction: UBER MEDICAL CENTRE -$80\nRule match: \"UBER â†’ Transport\" (75% confidence)\nâ†’ [LLM] Validating categorization...\nâ†’ [LLM] REJECT - This appears to be a medical facility, not transport\n   Suggests: Medical & Healthcare (90% confidence)\nâ†’ [Smart Mode] 90% â‰¥ auto-apply threshold\nâ†’ [Auto-applied] Category: Medical & Healthcare\n```\n\n### Learning from LLM Results\n\nAfter the LLM categorizes transactions, Agent Smith offers to create rules for future use.\n\n**Flow:**\n\n1. LLM categorizes N transactions with same merchant\n2. Detect pattern: Same payee â†’ Same category\n3. Suggest rule creation\n4. User approves, edits, or declines\n5. If approved: Add rule to `data/rules.yaml`\n\n**Example:**\n\n```\nLLM categorized 12 \"ACME WIDGETS\" transactions as \"Business Supplies\"\n\nSuggested rule:\n  - type: category\n    name: ACME WIDGETS â†’ Business Supplies\n    patterns: [ACME WIDGETS]\n    category: Business Supplies\n    confidence: 90\n\n[Create Rule] [Edit Rule] [Decline]\n\nâ†’ User selects [Create Rule]\nâ†’ Rule added to data/rules.yaml\nâ†’ Future ACME WIDGETS transactions auto-categorized (90% confidence)\n```\n\n## Advanced Patterns\n\n### Cross-Category Labels\n\nApply the same label to multiple categories:\n\n```yaml\n# Tax deductible categories\n- type: label\n  name: ATO Tax Deductible\n  when:\n    categories: [Work, Professional Development, Home Office, Software]\n  labels: [Tax Deductible, ATO: D1]\n\n# Large purchases across all categories\n- type: label\n  name: Large Purchase Alert\n  when:\n    amount_operator: \">\"\n    amount_value: 500\n  labels: [Large Purchase, Review Required]\n```\n\n### Account-Based Workflows\n\nDifferent labels for same category in different accounts:\n\n```yaml\n# Same category rule for all accounts\n- type: category\n  name: Transport\n  patterns: [UBER, LYFT, TAXI]\n  category: Transport\n  confidence: 90\n\n# Personal transport\n- type: label\n  name: Personal Transport\n  when:\n    categories: [Transport]\n    accounts: [Personal]\n  labels: [Personal, Discretionary]\n\n# Work transport (reimbursable)\n- type: label\n  name: Work Transport\n  when:\n    categories: [Transport]\n    accounts: [Work, Personal]  # Can be from either account\n    amount_operator: \">\"\n    amount_value: 20            # But large amounts suggest work trips\n  labels: [Work Related, Reimbursable]\n```\n\n### Shared Household Expense Tracking\n\nTrack who paid for shared expenses:\n\n```yaml\n# Shared groceries\n- type: category\n  name: Shared Groceries\n  patterns: [WOOLWORTHS, COLES]\n  accounts: [Shared Bills, Joint Account]\n  category: Food & Dining > Groceries\n  confidence: 95\n\n- type: label\n  name: Shared Essential\n  when:\n    categories: [Groceries]\n    accounts: [Shared Bills, Joint Account]\n  labels: [Shared Expense, Essential, Needs Reconciliation]\n\n# Large shared purchases need approval\n- type: label\n  name: Needs Approval\n  when:\n    accounts: [Shared Bills, Joint Account]\n    amount_operator: \">\"\n    amount_value: 150\n  labels: [Needs Approval, Review Required]\n```\n\n### Tax Deductible Tracking\n\nFlag potential tax deductions with ATO codes:\n\n```yaml\n# Work-related expenses\n- type: label\n  name: Work Deduction - D1\n  when:\n    categories: [Work, Office Supplies, Professional Development]\n  labels: [Tax Deductible, ATO: D1, Work-related other expenses]\n\n# Home office expenses\n- type: label\n  name: Home Office Deduction - D2\n  when:\n    categories: [Home Office, Internet, Phone]\n  labels: [Tax Deductible, ATO: D2, Home office expenses]\n\n# Large deductions requiring substantiation\n- type: label\n  name: Requires Receipt (>$300)\n  when:\n    labels: [Tax Deductible]  # Note: This won't work! Labels can't check labels\n    amount_operator: \">\"\n    amount_value: 300\n  labels: [Substantiation Required, Keep Receipt]\n```\n\n**Important:** Label rules cannot check for other labels. Use categories or accounts instead.\n\n### Uncategorized Transaction Management\n\nFlag and prioritize uncategorized transactions:\n\n```yaml\n# Flag all uncategorized\n- type: label\n  name: Needs Categorization\n  when:\n    uncategorized: true\n  labels: [Uncategorized, Needs Review]\n\n# High-priority uncategorized (large amounts)\n- type: label\n  name: High Priority Uncategorized\n  when:\n    uncategorized: true\n    amount_operator: \">\"\n    amount_value: 100\n  labels: [Uncategorized, High Priority, Urgent Review]\n\n# Uncategorized in shared account\n- type: label\n  name: Uncategorized Shared Expense\n  when:\n    uncategorized: true\n    accounts: [Shared Bills, Joint Account]\n  labels: [Uncategorized, Shared Account, Needs Approval]\n```\n\n## Best Practices\n\n### 1. Order Rules Specific â†’ General\n\nRules are evaluated in order. Put specific rules first:\n\n```yaml\n# âœ“ GOOD: Specific first\n- type: category\n  name: UBER EATS â†’ Dining Out\n  patterns: [UBER EATS]\n  category: Food & Dining > Dining Out\n  confidence: 95\n\n- type: category\n  name: UBER â†’ Transport\n  patterns: [UBER]\n  category: Transport\n  confidence: 90\n\n# âœ— BAD: General first (UBER catches UBER EATS)\n- type: category\n  name: UBER â†’ Transport\n  patterns: [UBER]\n  category: Transport\n  confidence: 90\n\n- type: category\n  name: UBER EATS â†’ Dining Out  # Never reached!\n  patterns: [UBER EATS]\n  category: Food & Dining > Dining Out\n  confidence: 95\n```\n\n**Fix with exclusions:**\n\n```yaml\n- type: category\n  name: UBER â†’ Transport\n  patterns: [UBER]\n  exclude_patterns: [UBER EATS]\n  category: Transport\n  confidence: 90\n```\n\n### 2. Use Visual Grouping\n\nGroup related rules with comments for easy scanning:\n\n```yaml\n# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n# GROCERIES WORKFLOW\n# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n- type: category\n  name: Groceries\n  patterns: [WOOLWORTHS, COLES, ALDI]\n  category: Food & Dining > Groceries\n  confidence: 95\n\n- type: label\n  name: Essential Spending\n  when:\n    categories: [Groceries]\n  labels: [Essential, Needs]\n\n- type: label\n  name: Shared Groceries\n  when:\n    categories: [Groceries]\n    accounts: [Shared Bills]\n  labels: [Shared Expense, Reconciliation]\n\n# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n# TRANSPORT WORKFLOW\n# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n- type: category\n  name: Rideshare\n  patterns: [UBER, LYFT]\n  exclude_patterns: [UBER EATS]\n  category: Transport\n  confidence: 90\n```\n\n### 3. Start with High Confidence\n\nBegin with rules you're certain about (95%+):\n\n```yaml\n# High confidence - very specific merchants\n- type: category\n  name: WOOLWORTHS â†’ Groceries\n  patterns: [WOOLWORTHS]\n  category: Food & Dining > Groceries\n  confidence: 95\n\n- type: category\n  name: AGL â†’ Utilities\n  patterns: [AGL]\n  category: Bills > Utilities\n  confidence: 95\n```\n\nAdd medium-confidence rules (80-90%) later as you verify:\n\n```yaml\n# Medium confidence - could be ambiguous\n- type: category\n  name: Amazon Purchases\n  patterns: [AMAZON]\n  category: Shopping\n  confidence: 80  # Could be books, electronics, groceries, etc.\n```\n\n### 4. Test with Dry Run\n\nAlways test before applying to real transactions:\n\n```bash\n# Preview what would happen without making changes\nuv run python scripts/operations/batch_categorize.py \\\n  --mode=dry_run \\\n  --period=2025-11 \\\n  --limit=50\n\n# See what would change on existing categorizations\nuv run python scripts/operations/batch_categorize.py \\\n  --mode=validate \\\n  --period=2025-11\n```\n\nReview the output carefully before running with `--mode=apply`.\n\n### 5. Version Control Your Rules\n\nCommit `data/rules.yaml` to git to track evolution:\n\n```bash\n# After adding/modifying rules\ngit add data/rules.yaml\ngit commit -m \"rules: add coffee shop categorization with personal label\"\n\n# View history\ngit log --oneline data/rules.yaml\n\n# Compare versions\ngit diff HEAD~1 data/rules.yaml\n```\n\n### 6. Review Rule Performance Regularly\n\nCheck rule accuracy monthly:\n\n```bash\n# Analyze categorization coverage\n/agent-smith-analyze rules --period=last-month\n\n# See which rules are matching most often\n/agent-smith-analyze rules --sort=matches\n\n# Find low-accuracy rules\n/agent-smith-analyze rules --min-accuracy=80\n```\n\nRefine rules that have low accuracy or aren't matching as expected.\n\n### 7. Use Templates as Starting Points\n\nDon't start from scratch - use a template:\n\n```bash\nuv run python scripts/setup/template_selector.py\n```\n\nThen customize by:\n1. Updating merchant names for your region (e.g., WOOLWORTHS â†’ KROGER)\n2. Adjusting account names to match your PocketSmith setup\n3. Adding your specific categories\n4. Fine-tuning confidence scores based on your data\n\n### 8. Document Complex Rules\n\nAdd comments explaining non-obvious rules:\n\n```yaml\n# Complex rule: UBER is transport UNLESS it's UBER EATS or during work hours\n# Work hours trips from Personal account are likely work-related (reimbursable)\n- type: category\n  name: UBER Transport (Excluding Food Delivery)\n  patterns: [UBER]\n  exclude_patterns: [UBER EATS, UBER EATS MARKETPLACE]\n  category: Transport\n  confidence: 90\n\n# Note: Work-related UBER trips need manual review for reimbursement\n# They'll get the \"Reimbursable\" label from the account-based rule below\n```\n\n## Operational Modes\n\nThe batch processor supports three operational modes for safe rule testing and application.\n\n### DRY_RUN Mode\n\n**Purpose:** Preview what would happen without making any changes.\n\n**Use when:**\n- Testing new rules\n- Checking rule coverage\n- Seeing potential categorizations before committing\n\n**Example:**\n\n```bash\nuv run python scripts/operations/batch_categorize.py \\\n  --mode=dry_run \\\n  --period=2025-11\n```\n\n**Output:**\n\n```\nDRY RUN MODE - No changes will be made\n\nTransaction #12345: WOOLWORTHS -$127.50\n  â†’ Would categorize as: Food & Dining > Groceries (95% confidence)\n  â†’ Would apply labels: [Essential, Shared Expense]\n\nTransaction #12346: STARBUCKS -$6.50\n  â†’ Would categorize as: Food & Dining > Dining Out (90% confidence)\n  â†’ Would apply labels: [Discretionary, Personal]\n\nTransaction #12347: ACME WIDGETS -$245.00\n  â†’ No rule match\n  â†’ Would request LLM categorization\n\nSummary:\n  Would categorize: 2/3 transactions (66.7%)\n  LLM fallback needed: 1 transaction\n  No changes made (DRY RUN)\n```\n\n### VALIDATE Mode\n\n**Purpose:** Show what would CHANGE on transactions that already have categories.\n\n**Use when:**\n- Checking if new rules conflict with existing categorizations\n- Planning to update categories with better rules\n- Auditing categorization accuracy\n\n**Example:**\n\n```bash\nuv run python scripts/operations/batch_categorize.py \\\n  --mode=validate \\\n  --period=2025-11\n```\n\n**Output:**\n\n```\nVALIDATE MODE - Showing potential changes\n\nTransaction #12345: WOOLWORTHS -$127.50\n  Current: Food (80% confidence)\n  New: Food & Dining > Groceries (95% confidence)\n  Change: Category would be updated âœ“\n\nTransaction #12346: STARBUCKS -$6.50\n  Current: Food & Dining > Dining Out (90% confidence)\n  New: Food & Dining > Dining Out (90% confidence)\n  Change: No change (same category)\n\nTransaction #12347: UBER -$25.00\n  Current: Dining Out (user-assigned)\n  New: Transport (90% confidence from rule)\n  Change: Category would be REPLACED (was user-assigned!)\n\nSummary:\n  Would update: 2 transactions\n  Already correct: 1 transaction\n  Would replace user assignments: 1 transaction âš ï¸\n  No changes made (VALIDATE)\n```\n\n### APPLY Mode\n\n**Purpose:** Actually apply categorizations and labels to transactions.\n\n**Use when:**\n- Ready to commit changes after testing with DRY_RUN/VALIDATE\n- Processing new uncategorized transactions\n- Updating categorizations with improved rules\n\n**Example:**\n\n```bash\nuv run python scripts/operations/batch_categorize.py \\\n  --mode=apply \\\n  --period=2025-11 \\\n  --update-strategy=skip_existing\n```\n\n**Output:**\n\n```\nAPPLY MODE - Making changes to PocketSmith\n\nTransaction #12345: WOOLWORTHS -$127.50\n  âœ“ Categorized as: Food & Dining > Groceries (95%)\n  âœ“ Labels applied: [Essential, Shared Expense]\n\nTransaction #12346: STARBUCKS -$6.50\n  âŠ˜ Skipped (already categorized)\n\nTransaction #12347: ACME WIDGETS -$245.00\n  â†’ Requesting LLM categorization...\n  ? Suggested: Business Supplies (85% confidence)\n    [A]ccept  [E]dit  [S]kip  [C]reate Rule\n```\n\n## Update Strategies\n\nControl how the batch processor handles transactions that already have categories.\n\n### SKIP_EXISTING (Default)\n\nOnly process uncategorized transactions. Leave existing categorizations unchanged.\n\n**Use when:**\n- Processing new transactions\n- Don't want to override user-assigned categories\n- Preserving manual categorization work\n\n```bash\nuv run python scripts/operations/batch_categorize.py \\\n  --mode=apply \\\n  --update-strategy=skip_existing\n```\n\n**Behavior:**\n- Uncategorized â†’ Apply rules\n- Already categorized â†’ Skip\n- User-assigned â†’ Skip\n\n### REPLACE_ALL\n\nReplace ALL categorizations, even if they were user-assigned.\n\n**Use when:**\n- Rebuilding all categorizations from scratch\n- Confident new rules are better than old assignments\n- Fixing systemic categorization errors\n\n**âš ï¸ Warning:** This will override user-assigned categories!\n\n```bash\nuv run python scripts/operations/batch_categorize.py \\\n  --mode=apply \\\n  --update-strategy=replace_all\n```\n\n**Behavior:**\n- Uncategorized â†’ Apply rules\n- Already categorized â†’ Replace with rule result\n- User-assigned â†’ Replace with rule result (loses user intent!)\n\n### UPGRADE_CONFIDENCE\n\nReplace categorization ONLY if new rule has higher confidence.\n\n**Use when:**\n- Improving categorizations with better rules\n- Keeping high-confidence assignments\n- Upgrading low-confidence auto-categorizations\n\n```bash\nuv run python scripts/operations/batch_categorize.py \\\n  --mode=apply \\\n  --update-strategy=upgrade_confidence\n```\n\n**Behavior:**\n- Uncategorized â†’ Apply rules\n- Lower confidence â†’ Replace with higher confidence rule\n- Higher confidence â†’ Keep existing\n- User-assigned (confidence: 100%) â†’ Never replaced\n\n**Example:**\n\n```\nTransaction: WOOLWORTHS -$50\nCurrent: Food (80% confidence from old rule)\nNew: Food & Dining > Groceries (95% confidence from new rule)\nâ†’ REPLACED (95% > 80%)\n\nTransaction: STARBUCKS -$6\nCurrent: Dining Out (95% confidence)\nNew: Dining Out (90% confidence from new rule)\nâ†’ KEPT (95% > 90%)\n```\n\n### REPLACE_IF_DIFFERENT\n\nReplace categorization if the category NAME differs.\n\n**Use when:**\n- Fixing miscategorized transactions\n- Migrating to a new category structure\n- Correcting category hierarchies\n\n```bash\nuv run python scripts/operations/batch_categorize.py \\\n  --mode=apply \\\n  --update-strategy=replace_if_different\n```\n\n**Behavior:**\n- Uncategorized â†’ Apply rules\n- Same category â†’ Keep existing\n- Different category â†’ Replace with rule result\n- User-assigned â†’ Still replaced if different!\n\n**Example:**\n\n```\nTransaction: WOOLWORTHS -$50\nCurrent: Food\nNew: Food & Dining > Groceries\nâ†’ REPLACED (different category name)\n\nTransaction: STARBUCKS -$6\nCurrent: Dining Out\nNew: Dining Out\nâ†’ KEPT (same category)\n```\n\n## Template System\n\nAgent Smith provides pre-built rule templates for common household types. Templates are stored in `data/templates/` and can be applied to create your `data/rules.yaml`.\n\n### Available Templates\n\n#### 1. Simple - Single Person\n\n**File:** `data/templates/simple.yaml`\n\n**Best for:**\n- Single person households\n- No shared expenses\n- Basic income and expense tracking\n\n**Includes:**\n- Income categorization (salary, wages)\n- Essential expenses (groceries, utilities, rent)\n- Discretionary spending (dining out, entertainment)\n- Transport categories\n- Basic labels (Essential, Discretionary, Large Purchase)\n- Uncategorized flagging\n\n**Example rules:**\n\n```yaml\n# Income\n- type: category\n  patterns: [SALARY, WAGES, EMPLOYER]\n  category: Income > Salary\n  confidence: 95\n\n# Essential groceries\n- type: category\n  patterns: [WOOLWORTHS, COLES, ALDI]\n  category: Food & Dining > Groceries\n  confidence: 95\n\n- type: label\n  when:\n    categories: [Groceries, Utilities, Rent]\n  labels: [Essential]\n```\n\n#### 2. Separated Families\n\n**File:** `data/templates/separated-families.yaml`\n\n**Best for:**\n- Divorced or separated parents\n- Shared custody arrangements\n- Child support tracking\n- Kids' expense management\n\n**Includes:**\n- Kids' expense categories (school, activities, clothing, medical)\n- Child support tracking\n- Contributor labels (Parent A, Parent B)\n- Reimbursement workflows\n- School term and vacation labels\n- Medical and education receipts flagging\n\n**Example rules:**\n\n```yaml\n# Child expenses\n- type: category\n  patterns: [SCHOOL, UNIFORM, SCHOOL FEES]\n  category: Kids > Education\n  confidence: 90\n\n- type: label\n  when:\n    categories: [Kids]\n  labels: [Child Expense, Needs Documentation]\n\n# Child support tracking\n- type: label\n  when:\n    patterns: [CHILD SUPPORT]\n  labels: [Child Support, Parent B Contribution]\n\n# Shared kid expenses requiring reimbursement\n- type: label\n  when:\n    categories: [Kids]\n    amount_operator: \">\"\n    amount_value: 50\n  labels: [Needs Reimbursement, Split 50/50]\n```\n\n#### 3. Shared Household\n\n**File:** `data/templates/shared-household.yaml`\n\n**Best for:**\n- Couples living together\n- Roommates sharing expenses\n- Families with joint accounts\n\n**Includes:**\n- Shared vs personal expense separation\n- Contributor tracking (Person A, Person B)\n- Approval workflows (large purchases, discretionary spending)\n- Reconciliation labels\n- Essential vs discretionary labeling\n- Account-based routing (Shared Bills, Personal accounts)\n\n**Example rules:**\n\n```yaml\n# Shared essential expenses\n- type: category\n  patterns: [WOOLWORTHS, COLES]\n  accounts: [Shared Bills, Joint Account]\n  category: Food & Dining > Groceries\n  confidence: 95\n\n- type: label\n  when:\n    categories: [Groceries]\n    accounts: [Shared Bills]\n  labels: [Shared Expense, Essential, Monthly Reconciliation]\n\n# Approval workflow for large shared purchases\n- type: label\n  when:\n    accounts: [Shared Bills]\n    amount_operator: \">\"\n    amount_value: 150\n  labels: [Needs Approval, Review Required]\n\n# Personal vs shared distinction\n- type: label\n  when:\n    accounts: [Personal, PersonA Account, PersonB Account]\n  labels: [Personal, Individual]\n```\n\n#### 4. Advanced\n\n**File:** `data/templates/advanced.yaml`\n\n**Best for:**\n- Business owners\n- Investors and traders\n- Complex financial situations\n- Tax optimization focus\n\n**Includes:**\n- Business expense categories (with ATO codes)\n- Investment tracking (shares, crypto, property)\n- Tax deductible flagging (work, home office, professional development)\n- Capital gains tracking\n- Substantiation requirements ($300 threshold)\n- Instant asset write-off flagging\n- GST tracking\n- Business vs personal separation\n\n**Example rules:**\n\n```yaml\n# Business expenses\n- type: category\n  patterns: [OFFICE, STATIONERY, SUPPLIES]\n  accounts: [Business, Work]\n  category: Work > Office Supplies\n  confidence: 90\n\n- type: label\n  when:\n    categories: [Work, Home Office, Professional Development]\n  labels: [Tax Deductible, ATO: D1, Business Expense]\n\n# Investment purchases\n- type: category\n  patterns: [COMMSEC, SELFWEALTH, STAKE]\n  category: Investments > Share Purchase\n  confidence: 90\n\n- type: label\n  when:\n    categories: [Investments]\n  labels: [CGT Event, Track Cost Base]\n\n# Substantiation requirements\n- type: label\n  when:\n    labels: [Tax Deductible]\n    amount_operator: \">\"\n    amount_value: 300\n  labels: [Receipt Required, ATO Substantiation]\n```\n\n### Applying a Template\n\n**Interactive selection:**\n\n```bash\nuv run python scripts/setup/template_selector.py\n```\n\n**Output:**\n\n```\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nAgent Smith - Rule Template Setup\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nAvailable templates:\n\n1. Simple - Single Person\n   Basic categories for individual financial tracking\n   Best for: Single person, no shared expenses\n\n2. Separated Families\n   Kids expenses, child support, contributor tracking\n   Best for: Divorced/separated parents with shared custody\n\n3. Shared Household\n   Shared expense tracking with approval workflows\n   Best for: Couples, roommates, or families\n\n4. Advanced\n   Tax optimization and investment management\n   Best for: Business owners, investors, complex finances\n\nSelect template (1-4): 3\n\nApplying template: Shared Household\nBacked up existing rules to data/rules.yaml.backup\nâœ“ Template applied successfully!\n\nNext steps:\n1. Review data/rules.yaml and customize for your needs\n2. Update merchant patterns for your region\n3. Adjust account names to match your PocketSmith setup\n4. Run: /agent-smith-categorize --mode=dry-run to test\n```\n\n**Programmatic usage:**\n\n```python\nfrom scripts.setup.template_selector import TemplateSelector\n\nselector = TemplateSelector()\n\n# List templates\ntemplates = selector.list_templates()\nfor key, info in templates.items():\n    print(f\"{info['name']}: {info['description']}\")\n\n# Apply template\nselector.apply_template(\"shared-household\", backup=True)\n```\n\n### Customizing Templates\n\nAfter applying a template:\n\n1. **Update merchant patterns** for your region:\n   ```yaml\n   # Template (Australian)\n   patterns: [WOOLWORTHS, COLES, ALDI]\n\n   # Customize (US)\n   patterns: [KROGER, SAFEWAY, WHOLE FOODS]\n   ```\n\n2. **Adjust account names** to match your PocketSmith:\n   ```yaml\n   # Template\n   accounts: [Shared Bills, Joint Account]\n\n   # Your setup\n   accounts: [Joint Checking, Household Card]\n   ```\n\n3. **Add your specific categories**:\n   ```yaml\n   # Add new rules\n   - type: category\n     name: Pet Expenses\n     patterns: [VET, PET STORE, PETBARN]\n     category: Pets > Veterinary\n     confidence: 90\n   ```\n\n4. **Fine-tune confidence scores** based on your data:\n   ```yaml\n   # Start conservative\n   confidence: 70\n\n   # After validation, increase\n   confidence: 90\n   ```\n\n## Migration Guide\n\n### From Platform Rules to Unified YAML\n\nIf you have existing platform rules created via the PocketSmith API, you can migrate them to the unified YAML format.\n\n**See:** [Platform to Local Rules Migration Guide](platform-to-local-migration.md)\n\n**Quick summary:**\n\n1. Export platform rules to JSON\n2. Convert to unified YAML format\n3. Test with dry run\n4. Disable platform rules (keep for backup)\n5. Enable unified rules\n\n**Migration script:**\n\n```bash\nuv run python scripts/migrations/migrate_platform_to_local.py \\\n  --output=data/rules.yaml \\\n  --backup\n```\n\n### Adding Labels to Existing Rules\n\nIf you have category rules and want to add labels:\n\n1. Keep all existing category rules as-is\n2. Add label rules at the bottom\n3. Test with dry run to see labels applied\n4. Apply with `--update-strategy=skip_existing` to avoid re-categorizing\n\n**Example:**\n\n```yaml\n# Existing category rules (don't change)\n- type: category\n  name: WOOLWORTHS â†’ Groceries\n  patterns: [WOOLWORTHS]\n  category: Groceries\n  confidence: 95\n\n# NEW: Add label rules\n- type: label\n  name: Essential Spending\n  when:\n    categories: [Groceries]\n  labels: [Essential, Needs]\n\n- type: label\n  name: Large Grocery Trip\n  when:\n    categories: [Groceries]\n    amount_operator: \">\"\n    amount_value: 150\n  labels: [Large Purchase]\n```\n\nRun with:\n```bash\nuv run python scripts/operations/batch_categorize.py \\\n  --mode=apply \\\n  --update-strategy=skip_existing \\\n  --period=2025-11\n```\n\nThis will:\n- Skip already categorized transactions (no re-categorization)\n- Apply new labels to all transactions (even already categorized ones)\n\n## Troubleshooting\n\n### Rule Not Matching\n\n**Symptom:** Rule should match but doesn't.\n\n**Check:**\n\n1. **Pattern case sensitivity** - Patterns are case-insensitive, but spacing matters:\n   ```yaml\n   # Won't match \"UBEREATS\" (no space)\n   patterns: [UBER EATS]\n\n   # Better: account for variations\n   patterns: [UBER EATS, UBEREATS]\n   ```\n\n2. **Exclusion patterns blocking** - Check if an exclusion is preventing the match:\n   ```yaml\n   - type: category\n     patterns: [UBER]\n     exclude_patterns: [UBER EATS, MEDICAL]  # Blocks \"UBER MEDICAL\"\n     category: Transport\n   ```\n\n3. **Account filter too restrictive** - Transaction might be in a different account:\n   ```yaml\n   # Only matches transactions in \"Personal\" account\n   accounts: [Personal]\n\n   # Check transaction's actual account name\n   ```\n\n4. **Amount condition incorrect** - Verify the amount operator and value:\n   ```yaml\n   amount_operator: \">\"\n   amount_value: 100\n   # Won't match transactions â‰¤ $100\n   ```\n\n5. **Rule order** - A previous rule might have matched first (short-circuit):\n   ```yaml\n   # General rule matches first!\n   - patterns: [UBER]\n     category: Transport\n\n   # Specific rule never reached\n   - patterns: [UBER EATS]\n     category: Dining Out  # Dead code!\n   ```\n\n**Debug with test script:**\n\n```bash\n# Test specific payee\nuv run python scripts/operations/test_rules.py \\\n  --payee=\"EXACT PAYEE NAME\" \\\n  --account=\"Account Name\" \\\n  --amount=127.50 \\\n  --debug\n```\n\n**Output:**\n\n```\nTesting transaction:\n  Payee: EXACT PAYEE NAME\n  Account: Account Name\n  Amount: $127.50\n\nChecking category rules...\n  âœ— Rule 1 \"WOOLWORTHS â†’ Groceries\": Pattern mismatch\n  âœ— Rule 2 \"UBER â†’ Transport\": Pattern mismatch\n  âœ— Rule 3 \"CAFE â†’ Dining Out\": Pattern mismatch\n\nNo category match found.\n\nChecking label rules...\n  (skipped - no category assigned)\n\nResult: No categorization\n```\n\n### Multiple Rules Matching\n\n**Symptom:** Worried about multiple rules matching the same transaction.\n\n**This is expected!** Category rules use short-circuit (first match wins), label rules accumulate all matches.\n\n**For category rules:**\n\n```yaml\n# Only the FIRST matching rule applies\n- patterns: [UBER EATS]\n  category: Dining Out\n  # âœ“ This matches UBER EATS\n\n- patterns: [UBER]\n  category: Transport\n  # âœ— Never reached for UBER EATS (already matched above)\n```\n\n**For label rules:**\n\n```yaml\n# ALL matching rules apply (additive)\n- type: label\n  when:\n    categories: [Groceries]\n  labels: [Essential]\n  # âœ“ Matches\n\n- type: label\n  when:\n    amount_operator: \">\"\n    amount_value: 100\n  labels: [Large Purchase]\n  # âœ“ Also matches\n\n# Result: [Essential, Large Purchase]\n```\n\n**Fix unwanted category matches** by adjusting rule order or using exclusions.\n\n**Control label accumulation** by making conditions more specific:\n\n```yaml\n# Too broad - applies to ALL transactions\n- type: label\n  when:\n    amount_operator: \">\"\n    amount_value: 0\n  labels: [Has Amount]  # Not useful!\n\n# Better - specific categories only\n- type: label\n  when:\n    categories: [Groceries, Dining Out]\n    amount_operator: \">\"\n    amount_value: 100\n  labels: [Large Food Purchase]\n```\n\n### Labels Not Applying\n\n**Symptom:** Label rule should match but labels aren't applied.\n\n**Check:**\n\n1. **Category must be assigned first** - Labels depend on Phase 1 categorization:\n   ```yaml\n   # Label requires category \"Groceries\"\n   - type: label\n     when:\n       categories: [Groceries]\n     labels: [Essential]\n\n   # But transaction wasn't categorized in Phase 1\n   # â†’ Label rule won't match\n   ```\n\n   **Fix:** Ensure a category rule matches the transaction first.\n\n2. **When conditions too restrictive** - All conditions must match (AND logic):\n   ```yaml\n   - type: label\n     when:\n       categories: [Groceries]  # Must match\n       accounts: [Shared Bills]  # AND must match\n       amount_operator: \">\"       # AND must match\n       amount_value: 100\n     labels: [Large Shared Grocery]\n\n   # Won't match if ANY condition fails\n   ```\n\n3. **Uncategorized flag incorrect** - Can't combine with other conditions:\n   ```yaml\n   # This won't work as expected\n   - type: label\n     when:\n       uncategorized: true\n       categories: [Groceries]  # Contradiction! Can't be both uncategorized and have a category\n     labels: [Invalid]\n   ```\n\n   **Fix:** Use `uncategorized: true` alone or with accounts/amount only.\n\n4. **Labels can't check labels** - You can't reference other labels in conditions:\n   ```yaml\n   # This WON'T work - no way to check existing labels\n   - type: label\n     when:\n       labels: [Tax Deductible]  # Not supported!\n       amount_operator: \">\"\n       amount_value: 300\n     labels: [Substantiation Required]\n   ```\n\n   **Fix:** Use categories or accounts as conditions instead.\n\n**Debug:**\n\n```bash\nuv run python scripts/operations/test_rules.py \\\n  --payee=\"WOOLWORTHS\" \\\n  --account=\"Shared Bills\" \\\n  --amount=127.50 \\\n  --category=\"Groceries\" \\\n  --debug\n```\n\n### Confidence Scores Unclear\n\n**Symptom:** Not sure what confidence score to use.\n\n**Guidelines:**\n\n| Confidence | When to Use | Example |\n|------------|-------------|---------|\n| 95-100% | Exact merchant match, no ambiguity | WOOLWORTHS â†’ Groceries |\n| 85-94% | Very likely but minor ambiguity | AMAZON â†’ Shopping (could be many subcategories) |\n| 75-84% | Likely but context-dependent | UBER â†’ Transport (unless UBER EATS) |\n| 70-74% | Moderate confidence, needs validation | Generic patterns like \"MARKET\" |\n| < 70% | Low confidence, probably shouldn't auto-apply | Broad patterns |\n\n**Smart mode thresholds:**\n- â‰¥ 90%: Auto-apply\n- 70-89%: Ask user (with LLM validation)\n- < 70%: Skip\n\n**Start high (95%), reduce if:**\n- LLM frequently suggests different category\n- User frequently overrides\n- Pattern matches too broadly\n\n### LLM Not Being Used\n\n**Symptom:** Expected LLM fallback but it's not happening.\n\n**Possible causes:**\n\n1. **Rule matched** - LLM only used when NO rule matches:\n   ```\n   Transaction: ACME WIDGETS\n   Rule match: \"Generic Business\" pattern [WIDGETS] (75%)\n   â†’ Rule applied, LLM not needed\n   ```\n\n   **Fix:** Remove overly broad rules if you want LLM to handle edge cases.\n\n2. **Categories not provided** - LLM needs category list:\n   ```python\n   workflow.categorize_transaction(\n       transaction=txn,\n       available_categories=None  # â† LLM can't suggest without categories!\n   )\n   ```\n\n   **Fix:** Pass `available_categories` from PocketSmith API.\n\n3. **Conservative mode + low confidence** - Conservative never auto-applies:\n   ```\n   Mode: Conservative\n   LLM suggests: Business Supplies (85%)\n   â†’ Asks user (doesn't auto-apply)\n   ```\n\n   This is expected! Conservative always asks.\n\n### Performance Issues\n\n**Symptom:** Batch categorization is slow with many rules.\n\n**Optimizations:**\n\n1. **Reduce rule count** - Consolidate similar patterns:\n   ```yaml\n   # Before: 3 rules\n   - patterns: [WOOLWORTHS]\n     category: Groceries\n   - patterns: [COLES]\n     category: Groceries\n   - patterns: [ALDI]\n     category: Groceries\n\n   # After: 1 rule\n   - patterns: [WOOLWORTHS, COLES, ALDI]\n     category: Groceries\n   ```\n\n2. **Use account filters** - Skip irrelevant transactions early:\n   ```yaml\n   # Check account BEFORE pattern matching\n   - patterns: [WORK PATTERN]\n     accounts: [Work Credit Card]  # Skips 90% of transactions\n     category: Work Expenses\n   ```\n\n3. **Order by frequency** - Put most common rules first:\n   ```yaml\n   # Most frequent transaction (groceries) - check first\n   - patterns: [WOOLWORTHS, COLES]\n     category: Groceries\n\n   # Less frequent - check later\n   - patterns: [RARE MERCHANT]\n     category: Rare Category\n   ```\n\n4. **Limit batch size** - Process in smaller chunks:\n   ```bash\n   # Instead of processing all at once\n   uv run python scripts/operations/batch_categorize.py --period=2025\n\n   # Process month by month\n   uv run python scripts/operations/batch_categorize.py --period=2025-01\n   uv run python scripts/operations/batch_categorize.py --period=2025-02\n   # etc.\n   ```\n\n## Examples\n\nSee `docs/examples/` for complete example YAML files:\n\n- **basic-rules.yaml** - Simple category and label rules\n- **advanced-patterns.yaml** - Complex rules with exclusions, amounts, accounts\n- **household-workflow.yaml** - Complete shared household setup\n- **tax-deductible.yaml** - Tax optimization rules with ATO codes\n- **migration-example.yaml** - Migrated from platform rules\n\n## Further Reading\n\n- **[Platform to Local Migration Guide](platform-to-local-migration.md)** - Migrate existing platform rules to unified YAML\n- **[Backup and Restore Guide](backup-and-restore-guide.md)** - Smart backup system with activity-specific rollbacks\n- **[Health Check Guide](health-check-guide.md)** - PocketSmith setup health evaluation\n- **[Design Document](../design/2025-11-20-agent-smith-design.md)** - Complete Agent Smith architecture\n\n## Support\n\nFor questions or issues:\n1. Check this guide's troubleshooting section\n2. Review example files in `docs/examples/`\n3. Check template files in `data/templates/`\n4. Refer to design documentation\n5. Create an issue in the repository\n\n---\n\n**Last Updated:** 2025-11-22\n**Version:** 1.0.0\n"
      },
      "plugins": [
        {
          "name": "agent-smith-plugin",
          "description": "Intelligent financial management skill for Claude Code with PocketSmith API integration",
          "source": "./agent-smith-plugin",
          "category": "finance",
          "categories": [
            "finance"
          ],
          "install_commands": [
            "/plugin marketplace add slamb2k/agent-smith",
            "/plugin install agent-smith-plugin@free-agents"
          ]
        }
      ]
    }
  ]
}