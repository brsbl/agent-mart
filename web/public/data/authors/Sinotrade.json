{
  "author": {
    "id": "Sinotrade",
    "display_name": "Sinopac",
    "type": "Organization",
    "avatar_url": "https://avatars.githubusercontent.com/u/45218684?v=4",
    "url": "https://github.com/Sinotrade",
    "bio": "永豐金證券",
    "stats": {
      "total_marketplaces": 1,
      "total_plugins": 1,
      "total_commands": 0,
      "total_skills": 1,
      "total_stars": 229,
      "total_forks": 19
    }
  },
  "marketplaces": [
    {
      "name": "sinotrade-plugins",
      "version": null,
      "description": "Shioaji Taiwan financial trading API guide for stocks, futures, and options trading",
      "owner_info": {
        "name": "Sinotrade",
        "url": "https://github.com/Sinotrade"
      },
      "keywords": [],
      "repo_full_name": "Sinotrade/Shioaji",
      "repo_url": "https://github.com/Sinotrade/Shioaji",
      "repo_description": "Shioaji all new cross platform api for trading ( 跨平台證券交易API )",
      "homepage": "https://sinotrade.github.io/",
      "signals": {
        "stars": 229,
        "forks": 19,
        "pushed_at": "2026-01-29T08:57:12Z",
        "created_at": "2018-11-21T06:27:12Z",
        "license": null
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 386
        },
        {
          "path": ".claude-plugin/plugin.json",
          "type": "blob",
          "size": 583
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 5691
        },
        {
          "path": "skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/shioaji",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/shioaji/ACCOUNTING.md",
          "type": "blob",
          "size": 11844
        },
        {
          "path": "skills/shioaji/ADVANCED.md",
          "type": "blob",
          "size": 17301
        },
        {
          "path": "skills/shioaji/CONTRACTS.md",
          "type": "blob",
          "size": 7002
        },
        {
          "path": "skills/shioaji/MARKET_DATA.md",
          "type": "blob",
          "size": 11761
        },
        {
          "path": "skills/shioaji/ORDERS.md",
          "type": "blob",
          "size": 18113
        },
        {
          "path": "skills/shioaji/PREPARE.md",
          "type": "blob",
          "size": 9450
        },
        {
          "path": "skills/shioaji/RESERVE.md",
          "type": "blob",
          "size": 4500
        },
        {
          "path": "skills/shioaji/SKILL.md",
          "type": "blob",
          "size": 6986
        },
        {
          "path": "skills/shioaji/STREAMING.md",
          "type": "blob",
          "size": 12073
        },
        {
          "path": "skills/shioaji/TROUBLESHOOTING.md",
          "type": "blob",
          "size": 4216
        }
      ],
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"sinotrade-plugins\",\n  \"owner\": {\n    \"name\": \"Sinotrade\",\n    \"url\": \"https://github.com/Sinotrade\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"shioaji\",\n      \"source\": \"./\",\n      \"description\": \"Shioaji Taiwan financial trading API guide for stocks, futures, and options trading\",\n      \"version\": \"1.3.2\",\n      \"author\": {\n        \"name\": \"Sinotrade\"\n      }\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"shioaji\",\n  \"version\": \"1.3.2\",\n  \"description\": \"Shioaji Taiwan financial trading API guide. Provides comprehensive documentation for stocks, futures, and options trading with real-time market data.\",\n  \"author\": {\n    \"name\": \"Sinotrade\",\n    \"url\": \"https://github.com/Sinotrade\"\n  },\n  \"homepage\": \"https://sinotrade.github.io/\",\n  \"repository\": \"https://github.com/Sinotrade/Shioaji\",\n  \"license\": \"MIT\",\n  \"keywords\": [\n    \"shioaji\",\n    \"trading\",\n    \"taiwan\",\n    \"stocks\",\n    \"futures\",\n    \"options\",\n    \"sinopac\",\n    \"api\"\n  ],\n  \"skills\": \"./skills/\"\n}\n",
        "README.md": "# Shioaji\n![shioaji-logo](https://sinotrade.github.io/images/shioaji-logo-01.png)![sinopac-logo](https://www.sinotrade.com.tw/Images/logo.png)\n\n\n[![PyPI - Status](https://img.shields.io/pypi/v/shioaji.svg?style=for-the-badge)](https://pypi.org/project/shioaji)\n[![PyPI - Python Version](https://img.shields.io/pypi/pyversions/shioaji.svg?style=for-the-badge)]()\n[![PyPI - Downloads](https://img.shields.io/pypi/dm/shioaji.svg?style=for-the-badge)](https://pypi.org/project/shioaji)\n[![Coverage](https://img.shields.io/badge/coverage%20-99%25-yellowgreen.svg?style=for-the-badge)]()\n[![Binder](https://img.shields.io/badge/launch-Tutorial-ff69b4.svg?style=for-the-badge)](https://mybinder.org/v2/gh/Sinotrade/Sinotrade.github.io/master?filepath=tutorial%2Fshioaji_tutorial.ipynb)\n[![doc](https://img.shields.io/badge/docs%20-passing-orange.svg?style=for-the-badge)](https://sinotrade.github.io/)\n[![Telegram](https://img.shields.io/badge/chat-%20on%20telegram-blue.svg?style=for-the-badge)](https://t.me/joinchat/973EyAQlrfthZTk1)\n\nShioaji is a trading API provided by Sinopac that offers a comprehensive and user-friendly platform for accessing the Taiwan financial markets. With Shioaji, you can trade a variety of financial instruments including stocks, futures, and options using your favorite Python packages such as numpy, scipy, pandas, pytorch, or tensorflow to build your own custom trading models. The platform is easy to use and intuitive, with advanced charting tools, real-time market data, and a customizable interface that allows you to tailor your trading experience to your specific needs. Shioaji is fast and efficient, with a high-performance core implemented in C++ and using FPGA event broker technology, and it is the first Python trading API in Taiwan that is compatible with Linux and Mac, making it a truly cross-platform solution. Whether you are a beginner looking to get started in the world of trading or an experienced trader looking for a more powerful platform, Shioaji has something to offer. [Sign up for a free account today and start trading with confidence.](https://sinotrade.github.io/tutor/prepare/open_account)\n\n\n- [Installation](#installation)\n    - [Binaries](#binaries)\n    - [Docker Image](#docker-image)\n- [Quickstarts](#quickstarts)\n- [Communication](#communication)\n- [Releases and Contributing](#releases-and-contributing)\n- [The Team](#the-team)\n\n\n## Installation\n### Binaries\nsimple using pip to install\n```\npip install shioaji\n```\nupdate shioaji with \n\n```\npip install -U shioaji\n```\n\n### uv\nusing uv to install\n```\nuv add shioaji \n```\ninstall speed version\n```\nuv add shioaji --extra speed\n```\n\n### Docker Image\nsimple run with interactive mode in docker \n```\ndocker run -it sinotrade/shioaji:latest\n```\nrun with jupyter lab or notebook \n```\ndocker run -p 8888:8888 sinotrade/shioaji:jupyter\n```\n\n\n## [Quickstarts](https://sinotrade.github.io/quickstart/)\n## Initialization\n\n```python\nimport shioaji as sj\n\napi = sj.Shioaji()\naccounts = api.login(\"YOUR_TOKEN\", \"YOUR_SECRET_KEY\")\napi.activate_ca(\n    ca_path=\"/c/your/ca/path/Sinopac.pfx\",\n    ca_passwd=\"YOUR_CA_PASSWORD\",\n)\n```\nJust import our API library like other popular python library and new the instance to start using our API. Login your account and activate the certification then you can start placing order.\n\n\n## [Streaming Market Data](https://sinotrade.github.io/tutor/market_data/streaming/)\n```python\napi.quote.subscribe(api.Contracts.Stocks[\"2330\"], quote_type=\"tick\")\napi.quote.subscribe(api.Contracts.Stocks[\"2330\"], quote_type=\"bidask\")\napi.quote.subscribe(api.Contracts.Futures[\"TXFC0\"], quote_type=\"tick\")\n```\n\nSubscribe the real time market data. Simplely pass contract into quote `subscribe` function and give the quote type will receive the streaming data.\n\n\n## [Place Order](https://sinotrade.github.io/tutor/order/Stock/)\n\n```python\ncontract = api.Contracts.Stocks[\"2890\"]\norder = api.Order(\n    price=9.6,\n    quantity=1,\n    action=\"Buy\",\n    price_type=\"LMT\",\n    order_type=\"ROD\",\n    order_lot=\"Common\",\n    account=api.stock_account,\n)\n# or\norder = api.Order(\n    price=9.6,\n    quantity=1,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    order_lot=sj.constant.StockOrderLot.Common,\n    account=api.stock_account,\n)\ntrade = api.place_order(contract, order)\n```\n\nLike the above subscribing market data using the contract, then need to define the order. Pass them into `place_order` function, then it will return the trade that describe the status of your order.\n\n## Conclusion\nThis quickstart demonstrates how easy to use our package for native Python users. Unlike many other trading API is hard for Python developer. We focus on making more pythonic trading API for our users. \n\nMore usage detail on document.\n\n[![doc](https://img.shields.io/badge/docs%20-passing-orange.svg?style=for-the-badge)](https://sinotrade.github.io/)\n\n\n## Communication\n[![Telegram](https://img.shields.io/badge/chat-%20on%20telegram-blue.svg?style=for-the-badge)](https://t.me/joinchat/973EyAQlrfthZTk1)\n\n## Releases and Contributing\nShioaji has a 14 day release cycle. See the release [change log](https://sinotrade.github.io/release/). Please let us know if you encounter a bug by [filing an issue](https://github.com/Sinotrade/Shioaji/issues).\n\nWe appreciate all suggestions. If you have any idea want us to implement, please discuss with us in gitter.\n\n## The Team\nShioaji is currently maintained by [Sally](https://github.com/SsallyLin), [Yvictor](https://github.com/Yvictor), [CC.Chiao](https://github.com/luckchiao) and [Po Chien Yang](https://github.com/ypochien) with major contributions.",
        "skills/shioaji/ACCOUNTING.md": "# Accounting 帳務查詢\n\nThis document covers account balance, margin, positions, and P&L queries.\n本文件說明帳戶餘額、保證金、持倉和損益查詢。\n\n---\n\n## Overview 概覽\n\n| Function 函數 | Description 說明 |\n|--------------|------------------|\n| `account_balance()` | Stock account balance 股票帳戶餘額 |\n| `margin()` | Futures margin info 期貨保證金 |\n| `list_positions()` | Unrealized positions 未實現持倉 |\n| `list_position_detail()` | Position details 持倉明細 |\n| `list_profit_loss()` | Realized P&L 已實現損益 |\n| `settlements()` | Settlement schedule 交割資訊 |\n\n---\n\n## Bank Balance 銀行餘額\n\n### Stock Account Balance 股票帳戶餘額\n\n```python\nimport shioaji as sj\n\napi = sj.Shioaji()\napi.login(api_key=\"YOUR_KEY\", secret_key=\"YOUR_SECRET\")\n\n# Query balance (default: stock_account) 查詢餘額（預設：股票帳戶）\nbalance = api.account_balance()\n\n# Query with specific account 指定帳戶查詢\nbalance = api.account_balance(account=api.stock_account)\n```\n\n### account_balance Parameters 參數\n\n| Parameter 參數 | Type 類型 | Description 說明 |\n|---------------|----------|------------------|\n| `account` | `Account` | Account to query (Default: stock_account) 查詢帳戶（預設：股票帳戶）|\n| `timeout` | `int` | Request timeout in ms (Default: 5000) 請求超時毫秒（預設：5000）|\n| `cb` | `Callable` | Callback for async mode 非同步回呼函數 |\n\n### AccountBalance Attributes 餘額屬性\n\n```python\nbalance.date           # str: Query date 查詢日期\nbalance.acc_balance    # Decimal: Available funds 可用餘額\nbalance.status         # str: Status 狀態\n```\n\n---\n\n## Margin 保證金查詢\n\n### Futures Margin 期貨保證金\n\n```python\nmargin = api.margin(api.futopt_account)\n```\n\n### Margin Attributes 保證金屬性\n\n```python\nmargin.yesterday_balance    # Decimal: Yesterday balance 昨日餘額\nmargin.today_balance        # Decimal: Today balance 今日餘額\nmargin.deposit_withdrawal   # Decimal: Deposit/withdrawal 出入金\nmargin.fee                  # Decimal: Fees 手續費\nmargin.tax                  # Decimal: Tax 稅金\nmargin.initial_margin       # Decimal: Initial margin 原始保證金\nmargin.maintenance_margin   # Decimal: Maintenance margin 維持保證金\nmargin.margin_call          # Decimal: Margin call 追繳金額\nmargin.available_margin     # Decimal: Available margin 可用保證金\nmargin.risk_indicator       # Decimal: Risk indicator 風險指標\n\n# P&L related 損益相關\nmargin.future_open_position     # Decimal: Futures open position P&L 期貨未平倉損益\nmargin.option_open_position     # Decimal: Options open position P&L 選擇權未平倉損益\nmargin.option_settle_profitloss # Decimal: Options settlement P&L 選擇權結算損益\nmargin.future_settle_profitloss # Decimal: Futures settlement P&L 期貨結算損益\n```\n\n---\n\n## Positions 持倉查詢\n\n### Stock Positions 股票持倉\n\n```python\nfrom shioaji import StockPosition\n\npositions = api.list_positions(api.stock_account)\n\nfor pos in positions:\n    print(f\"Code: {pos.code}, Qty: {pos.quantity}, P&L: {pos.pnl}\")\n```\n\n### StockPosition Attributes 股票持倉屬性\n\n```python\npos.id              # str: Position ID 持倉 ID\npos.code            # str: Stock code 股票代碼\npos.direction       # str: Long/Short 多空方向\npos.quantity        # int: Holding quantity 持有數量\npos.price           # Decimal: Average cost 平均成本\npos.last_price      # Decimal: Current price 現價\npos.pnl             # Decimal: Unrealized P&L 未實現損益\npos.yd_quantity     # int: Yesterday quantity 昨日數量\npos.cond            # str: Order condition 交易條件 (Cash/MarginTrading/ShortSelling)\npos.margin_purchase_amount  # Decimal: Margin amount 融資金額\npos.collateral      # Decimal: Collateral 擔保品\npos.short_sale_margin       # Decimal: Short margin 融券保證金\n```\n\n### Futures/Options Positions 期貨選擇權持倉\n\n```python\nfrom shioaji import FuturePosition\n\npositions = api.list_positions(api.futopt_account)\n\nfor pos in positions:\n    print(f\"Code: {pos.code}, Qty: {pos.quantity}, P&L: {pos.pnl}\")\n```\n\n### FuturePosition Attributes 期貨持倉屬性\n\n```python\npos.id              # str: Position ID 持倉 ID\npos.code            # str: Contract code 合約代碼\npos.direction       # str: Long/Short 多空方向\npos.quantity        # int: Holding quantity 持有口數\npos.price           # Decimal: Average cost 平均成本\npos.last_price      # Decimal: Current price 現價\npos.pnl             # Decimal: Unrealized P&L 未實現損益\n```\n\n---\n\n## Position Detail 持倉明細\n\n### Get Position Detail 取得持倉明細\n\n```python\nfrom shioaji import StockPositionDetail\n\n# Get all position details 取得所有持倉明細\ndetails = api.list_position_detail(api.stock_account)\n\n# Get specific position detail 取得特定持倉明細\ndetail = api.list_position_detail(api.stock_account, detail_id=\"position_id\")\n```\n\n### StockPositionDetail Attributes 股票持倉明細屬性\n\n```python\ndetail.id              # str: Detail ID 明細 ID\ndetail.code            # str: Stock code 股票代碼\ndetail.quantity        # int: Quantity 數量\ndetail.cost_price      # Decimal: Cost price 成本價\ndetail.entry_date      # str: Entry date 進場日期\ndetail.fee             # Decimal: Fee 手續費\ndetail.cond            # str: Order condition 交易條件\n```\n\n### FuturePositionDetail Attributes 期貨持倉明細屬性\n\n```python\ndetail.id              # str: Detail ID 明細 ID\ndetail.code            # str: Contract code 合約代碼\ndetail.quantity        # int: Quantity 口數\ndetail.cost_price      # Decimal: Cost price 成本價\ndetail.entry_date      # str: Entry date 進場日期\ndetail.fee             # Decimal: Fee 手續費\n```\n\n---\n\n## Profit & Loss 損益查詢\n\n### Realized P&L 已實現損益\n\n```python\nfrom shioaji import ProfitLoss\n\n# Query by date range 依日期範圍查詢\npnl_list = api.list_profit_loss(\n    api.stock_account,\n    begin_date=\"2024-01-01\",\n    end_date=\"2024-01-31\"\n)\n\nfor pnl in pnl_list:\n    print(f\"Code: {pnl.code}, P&L: {pnl.pnl}\")\n```\n\n### ProfitLoss Attributes 損益屬性\n\n```python\npnl.id            # str: P&L ID 損益 ID\npnl.code          # str: Stock/Contract code 代碼\npnl.quantity      # int: Quantity 數量\npnl.buy_price     # Decimal: Buy price 買進價\npnl.sell_price    # Decimal: Sell price 賣出價\npnl.pnl           # Decimal: Profit/Loss 損益\npnl.pr_ratio      # Decimal: Profit ratio % 報酬率\npnl.cond          # str: Order condition 交易條件\npnl.fee           # Decimal: Fee 手續費\npnl.tax           # Decimal: Tax 稅金\npnl.trade_date    # str: Trade date 交易日期\npnl.settle_date   # str: Settlement date 交割日期\n```\n\n### P&L Summary 損益彙總\n\n```python\nfrom shioaji import ProfitLossSummaryTotal\n\nsummary = api.list_profit_loss_summary(\n    api.stock_account,\n    begin_date=\"2024-01-01\",\n    end_date=\"2024-01-31\"\n)\n\nprint(f\"Total P&L: {summary.total_pnl}\")\n```\n\n### ProfitLossSummaryTotal Attributes 損益彙總屬性\n\n```python\nsummary.total_pnl        # Decimal: Total P&L 總損益\nsummary.total_cost       # Decimal: Total cost 總成本\nsummary.total_revenue    # Decimal: Total revenue 總收入\nsummary.total_fee        # Decimal: Total fee 總手續費\nsummary.total_tax        # Decimal: Total tax 總稅金\n```\n\n---\n\n## Settlements 交割資訊\n\n### Query Settlements 查詢交割\n\n```python\nfrom shioaji import SettlementV1\n\nsettlements = api.settlements(api.stock_account)\n\nfor settle in settlements:\n    print(f\"Date: {settle.date}, Amount: {settle.amount}\")\n```\n\n### SettlementV1 Attributes 交割屬性\n\n```python\nsettle.date           # str: Settlement date (T+n) 交割日期\nsettle.amount         # Decimal: Settlement amount 交割金額\nsettle.t_money        # Decimal: T-day amount T 日金額\nsettle.t1_money       # Decimal: T+1 amount T+1 日金額\nsettle.t2_money       # Decimal: T+2 amount T+2 日金額\n```\n\n---\n\n## Trading Limits 交易額度\n\nQuery available trading limits for stock account.\n查詢股票帳戶的交易額度。\n\nNote: Available on trading days from 8:30 to 15:00.\n注意：交易日 8:30 至 15:00 可查詢。\n\n### Query Trading Limits 查詢交易額度\n\n```python\nlimits = api.trading_limits(api.stock_account)\n\nprint(f\"Trading Limit: {limits.trading_limit}\")\nprint(f\"Trading Used: {limits.trading_used}\")\nprint(f\"Trading Available: {limits.trading_available}\")\n```\n\n### TradingLimits Attributes 交易額度屬性\n\n```python\nlimits.status             # FetchStatus: Fetch status 取得狀態\nlimits.trading_limit      # int: Trading limit 交易額度上限\nlimits.trading_used       # int: Trading used 已使用額度\nlimits.trading_available  # int: Trading available 可用額度\n\n# Margin trading 融資\nlimits.margin_limit       # int: Margin limit 融資額度上限\nlimits.margin_used        # int: Margin used 已使用融資\nlimits.margin_available   # int: Margin available 可用融資\n\n# Short selling 融券\nlimits.short_limit        # int: Short limit 融券額度上限\nlimits.short_used         # int: Short used 已使用融券\nlimits.short_available    # int: Short available 可用融券\n```\n\n### Check Available Margin 檢查可用額度\n\n```python\nlimits = api.trading_limits(api.stock_account)\n\nif limits.trading_available >= order_amount:\n    print(\"Sufficient trading limit\")\nelse:\n    print(f\"Insufficient! Available: {limits.trading_available}\")\n```\n\n---\n\n## Query with Polars 使用 Polars 查詢\n\n### Positions to DataFrame 持倉轉 DataFrame\n\n```python\nimport polars as pl\nfrom shioaji import StockPosition\n\npositions = api.list_positions(api.stock_account)\n\ndf = pl.DataFrame([\n    {\n        \"code\": pos.code,\n        \"quantity\": pos.quantity,\n        \"price\": float(pos.price),\n        \"last_price\": float(pos.last_price),\n        \"pnl\": float(pos.pnl),\n    }\n    for pos in positions\n])\n\n# Calculate total P&L 計算總損益\ntotal_pnl = df.select(pl.col(\"pnl\").sum()).item()\n```\n\n### P&L Analysis 損益分析\n\n```python\npnl_list = api.list_profit_loss(\n    api.stock_account,\n    begin_date=\"2024-01-01\",\n    end_date=\"2024-12-31\"\n)\n\ndf = pl.DataFrame([\n    {\n        \"code\": pnl.code,\n        \"pnl\": float(pnl.pnl),\n        \"pr_ratio\": float(pnl.pr_ratio),\n        \"trade_date\": pnl.trade_date,\n    }\n    for pnl in pnl_list\n])\n\n# Group by stock 依股票分組\nby_stock = df.group_by(\"code\").agg([\n    pl.col(\"pnl\").sum().alias(\"total_pnl\"),\n    pl.col(\"pnl\").count().alias(\"trade_count\"),\n    pl.col(\"pr_ratio\").mean().alias(\"avg_return\"),\n])\n```\n\n---\n\n## Rate Limits 速率限制\n\n```python\n# Accounting query limit: 25 requests / 5 seconds\n# 帳務查詢限制：25 次 / 5 秒\n\nimport time\n\n# If making multiple queries 如果需要多次查詢\nfor account in accounts:\n    balance = api.account_balance(account)\n    time.sleep(0.2)  # Respect rate limit 遵守速率限制\n```\n\n---\n\n## Best Practices 最佳實踐\n\n### 1. Cache Positions 快取持倉\n\n```python\nclass PositionCache:\n    def __init__(self, api):\n        self.api = api\n        self._positions = None\n        self._last_update = None\n\n    def get_positions(self, force_refresh: bool = False):\n        import time\n        now = time.time()\n\n        if force_refresh or self._positions is None or (now - self._last_update) > 60:\n            self._positions = self.api.list_positions(self.api.stock_account)\n            self._last_update = now\n\n        return self._positions\n```\n\n### 2. Error Handling 錯誤處理\n\n```python\ntry:\n    positions = api.list_positions(api.stock_account)\nexcept Exception as e:\n    print(f\"Failed to query positions: {e}\")\n    positions = []\n```\n\n---\n\n## Reference 參考資料\n\n- Official docs 官方文檔: https://sinotrade.github.io/tutor/accounting/\n",
        "skills/shioaji/ADVANCED.md": "# Advanced Features 進階功能\n\nThis document covers non-blocking mode, stop orders, historical data, and scanners.\n本文件說明非阻塞模式、觸價委託、歷史數據和掃描器。\n\n---\n\n## Non-blocking Mode 非阻塞模式\n\nNon-blocking mode allows functions to return immediately without waiting for exchange response.\n非阻塞模式讓函數立即返回，無需等待交易所回應。\n\n### Performance 效能\n\n| Mode 模式 | Time 時間 |\n|-----------|-----------|\n| Blocking 阻塞 | ~0.136 sec |\n| Non-blocking 非阻塞 | ~0.012 sec (**12x faster**) |\n\n### Basic Usage 基本用法\n\n```python\n# Set timeout=0 for non-blocking 設定 timeout=0 為非阻塞\ntrade = api.place_order(contract, order, timeout=0)\n# Returns immediately with Inactive status\n# 立即返回，狀態為 Inactive\n```\n\n### Get Results via Callback 透過回調取得結果\n\n```python\nfrom shioaji import Trade\n\n# Method 1: Order callback 委託回報\ndef order_cb(stat, msg):\n    print(f\"Status: {stat}, Message: {msg}\")\n\napi.set_order_callback(order_cb)\n\n# Method 2: Per-order callback 單筆回調\ndef non_blocking_cb(trade: Trade):\n    print(f\"Trade: {trade}\")\n    print(f\"Order ID: {trade.order.id}\")\n    print(f\"Status: {trade.status.status}\")\n\ntrade = api.place_order(contract, order, timeout=0, cb=non_blocking_cb)\n```\n\n### Supported Functions 支援的函數\n\nAll these functions support `timeout=0` for non-blocking:\n以下函數皆支援 `timeout=0` 非阻塞：\n\n- `place_order()` - 下單\n- `update_order()` - 改單\n- `cancel_order()` - 刪單\n- `update_status()` - 更新狀態\n- `list_positions()` - 持倉查詢\n- `list_position_detail()` - 持倉明細\n- `list_profit_loss()` - 損益查詢\n- `margin()` - 保證金查詢\n- `ticks()` - 歷史 Tick\n- `kbars()` - 歷史 K 線\n\n---\n\n## Quote Binding 報價綁定\n\nQuote binding mode allows you to store tick/bidask in queue, push to Redis, or trigger stop orders.\n報價綁定模式讓你可以將 tick/bidask 存入佇列、推送到 Redis 或觸發觸價單。\n\n### Set Context 設定 Context\n\n```python\nfrom collections import defaultdict, deque\nfrom shioaji import Exchange, TickSTKv1\n\n# Create message queue 建立訊息佇列\nmsg_queue = defaultdict(deque)\n\n# Set context 設定 context\napi.set_context(msg_queue)\n```\n\n### Use bind=True 使用 bind=True\n\n```python\n# Method 1: Decorator with bind=True\n# 方法一：使用 bind=True 裝飾器\n@api.on_tick_stk_v1(bind=True)\ndef quote_callback(self, exchange: Exchange, tick: TickSTKv1):\n    # 'self' is the context (msg_queue)\n    # 'self' 就是 context (msg_queue)\n    self[tick.code].append(tick)\n\n# Method 2: Traditional way\n# 方法二：傳統方式\ndef quote_callback(self, exchange: Exchange, tick: TickSTKv1):\n    self[tick.code].append(tick)\n\napi.quote.set_on_tick_stk_v1_callback(quote_callback, bind=True)\n```\n\n### Push to Redis Stream 推送到 Redis\n\n```python\nimport redis\nimport json\nfrom shioaji import Exchange, TickFOPv1\n\n# Redis connection Redis 連線\nr = redis.Redis(host='localhost', port=6379, db=0)\n\n# Set Redis as context 設定 Redis 為 context\napi.set_context(r)\n\n@api.on_tick_fop_v1(bind=True)\ndef quote_callback(self, exchange: Exchange, tick: TickFOPv1):\n    channel = f\"Q:{tick.code}\"\n    # Push to Redis stream 推送到 Redis stream\n    self.xadd(channel, {'tick': json.dumps(tick.to_dict(raw=True))})\n```\n\n### Quote Manager Pattern 報價管理器模式\n\n```python\nfrom typing import List\nimport polars as pl\nfrom shioaji import TickSTKv1, Exchange\n\nclass QuoteManager:\n    def __init__(self, api):\n        self.api = api\n        self.ticks: List[TickSTKv1] = []\n        # Register callback 註冊回調\n        api.quote.set_on_tick_stk_v1_callback(self._on_tick)\n\n    def _on_tick(self, exchange: Exchange, tick: TickSTKv1):\n        self.ticks.append(tick)\n\n    def get_dataframe(self) -> pl.DataFrame:\n        if not self.ticks:\n            return pl.DataFrame()\n\n        return pl.DataFrame([t.to_dict() for t in self.ticks]).select(\n            pl.col(\"datetime\", \"code\"),\n            pl.col(\"close\").cast(pl.Float64).alias(\"price\"),\n            pl.col(\"volume\").cast(pl.Int64),\n            pl.col(\"tick_type\").cast(pl.Int8),\n        )\n\n    def get_kbars(self, unit: str = \"1m\") -> pl.DataFrame:\n        df = self.get_dataframe()\n        if df.is_empty():\n            return df\n\n        return df.group_by(\n            pl.col(\"datetime\").dt.truncate(unit),\n            pl.col(\"code\"),\n            maintain_order=True,\n        ).agg(\n            pl.col(\"price\").first().alias(\"open\"),\n            pl.col(\"price\").max().alias(\"high\"),\n            pl.col(\"price\").min().alias(\"low\"),\n            pl.col(\"price\").last().alias(\"close\"),\n            pl.col(\"volume\").sum().alias(\"volume\"),\n        )\n\n# Usage 使用方式\nqm = QuoteManager(api)\napi.quote.subscribe(api.Contracts.Stocks[\"2330\"], \"tick\")\n\n# Later... 稍後...\ndf = qm.get_kbars(\"5m\")\n```\n\n### With Technical Indicators 搭配技術指標\n\n```python\nimport polars_talib as plta\n\n# Get kbars with indicators 取得帶指標的 K 線\ndf = qm.get_kbars(\"5m\").with_columns([\n    pl.col(\"close\").ta.ema(5).over(\"code\").alias(\"ema5\"),\n    pl.col(\"close\").ta.ema(20).over(\"code\").alias(\"ema20\"),\n    plta.macd(pl.col(\"close\"), 12, 26, 9).over(\"code\").struct.field(\"macd\"),\n])\n```\n\n---\n\n## Stop Orders 觸價委託\n\nStop orders automatically convert to limit/market orders when price reaches trigger level.\n觸價委託在價格達到設定價位時，自動轉為限價單或市價單。\n\n### Implementation 實作\n\n```python\nfrom shioaji import Exchange, TickFOPv1\nfrom typing import List, Dict, Any\n\nclass StopOrderExecutor:\n    def __init__(self, api):\n        self.api = api\n        self._stop_orders: Dict[str, List[Dict[str, Any]]] = {}\n\n    def on_tick(self, exchange: Exchange, tick: TickFOPv1):\n        \"\"\"Handle tick and check stop orders 處理 tick 並檢查觸價\"\"\"\n        code = tick.code\n        if code not in self._stop_orders:\n            return\n\n        price = float(tick.close)\n\n        for stop_order in self._stop_orders[code]:\n            if stop_order[\"executed\"]:\n                continue\n\n            # Check trigger condition 檢查觸發條件\n            is_triggered = False\n            if stop_order[\"stop_price\"] >= stop_order[\"ref_price\"]:\n                # Stop above reference (e.g., buy stop)\n                # 高於參考價觸發（如買進停損）\n                if price >= stop_order[\"stop_price\"]:\n                    is_triggered = True\n            else:\n                # Stop below reference (e.g., sell stop)\n                # 低於參考價觸發（如賣出停損）\n                if price <= stop_order[\"stop_price\"]:\n                    is_triggered = True\n\n            if is_triggered:\n                self.api.place_order(\n                    stop_order[\"contract\"],\n                    stop_order[\"pending_order\"]\n                )\n                stop_order[\"executed\"] = True\n                print(f\"Stop order triggered: {code} @ {price}\")\n\n    def add_stop_order(self, contract, stop_price: float, order):\n        \"\"\"Add a stop order 新增觸價委託\"\"\"\n        code = contract.code\n\n        # Get reference price 取得參考價\n        snap = self.api.snapshots([contract])[0]\n        ref_price = 0.5 * (float(snap.buy_price) + float(snap.sell_price))\n\n        stop_order = {\n            \"code\": code,\n            \"stop_price\": stop_price,\n            \"ref_price\": ref_price,\n            \"contract\": contract,\n            \"pending_order\": order,\n            \"executed\": False,\n        }\n\n        if code not in self._stop_orders:\n            self._stop_orders[code] = []\n        self._stop_orders[code].append(stop_order)\n\n        return stop_order\n```\n\n### Usage 使用方式\n\n```python\nimport shioaji as sj\n\napi = sj.Shioaji()\napi.login(api_key=\"YOUR_KEY\", secret_key=\"YOUR_SECRET\")\n\n# Create stop order executor 建立觸價執行器\nsoe = StopOrderExecutor(api)\n\n# Define contract and order 定義合約和訂單\ncontract = api.Contracts.Futures[\"TXFC0\"]\norder = api.Order(\n    action=sj.constant.Action.Buy,\n    price=18000,\n    quantity=1,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    account=api.futopt_account,\n)\n\n# Add stop order (trigger when price >= 18005)\n# 新增觸價委託（價格 >= 18005 時觸發）\nsoe.add_stop_order(contract=contract, stop_price=18005, order=order)\n\n# Bind callback with context 綁定回調與 context\napi.set_context(soe)\n\n@api.on_tick_fop_v1(bind=True)\ndef on_tick(self, exchange: Exchange, tick: TickFOPv1):\n    self.on_tick(exchange, tick)\n\n# Subscribe to quotes 訂閱行情\napi.quote.subscribe(contract, quote_type=sj.constant.QuoteType.Tick)\n```\n\n---\n\n## Historical Data 歷史數據\n\n### Ticks 逐筆成交\n\n```python\n# Full day ticks 全天 Ticks\nticks = api.ticks(\n    contract=api.Contracts.Stocks[\"2330\"],\n    date=\"2024-01-16\"\n)\n\n# Time range 時間區段\nticks = api.ticks(\n    contract=api.Contracts.Stocks[\"2330\"],\n    date=\"2024-01-16\",\n    query_type=sj.constant.TicksQueryType.RangeTime,\n    time_start=\"09:00:00\",\n    time_end=\"09:30:00\"\n)\n\n# Last N ticks 最後 N 筆\nticks = api.ticks(\n    contract=api.Contracts.Stocks[\"2330\"],\n    query_type=sj.constant.TicksQueryType.LastCount,\n    last_cnt=100\n)\n```\n\n### Ticks Attributes Ticks 屬性\n\n```python\nticks.ts           # List[int]: Timestamps 時間戳\nticks.close        # List[Decimal]: Close prices 成交價\nticks.volume       # List[int]: Volumes 成交量\nticks.bid_price    # List[Decimal]: Bid prices 委買價\nticks.ask_price    # List[Decimal]: Ask prices 委賣價\nticks.bid_volume   # List[int]: Bid volumes 委買量\nticks.ask_volume   # List[int]: Ask volumes 委賣量\nticks.tick_type    # List[int]: 1=Buy, 2=Sell, 0=Unknown\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\ndf = pl.DataFrame({\n    \"ts\": ticks.ts,\n    \"close\": [float(p) for p in ticks.close],\n    \"volume\": ticks.volume,\n    \"tick_type\": ticks.tick_type,\n}).with_columns(\n    pl.col(\"ts\").cast(pl.Datetime(\"ms\"))\n)\n```\n\n---\n\n## K-bars K 線資料\n\n### Query Kbars 查詢 K 線\n\n```python\nkbars = api.kbars(\n    contract=api.Contracts.Stocks[\"2330\"],\n    start=\"2024-01-15\",\n    end=\"2024-01-16\"\n)\n```\n\n### Kbars Attributes K 線屬性\n\n```python\nkbars.ts       # List[int]: Timestamps 時間戳\nkbars.Open     # List[Decimal]: Open prices 開盤價\nkbars.High     # List[Decimal]: High prices 最高價\nkbars.Low      # List[Decimal]: Low prices 最低價\nkbars.Close    # List[Decimal]: Close prices 收盤價\nkbars.Volume   # List[int]: Volumes 成交量\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\ndf = pl.DataFrame({\n    \"ts\": kbars.ts,\n    \"open\": [float(p) for p in kbars.Open],\n    \"high\": [float(p) for p in kbars.High],\n    \"low\": [float(p) for p in kbars.Low],\n    \"close\": [float(p) for p in kbars.Close],\n    \"volume\": kbars.Volume,\n}).with_columns(\n    pl.col(\"ts\").cast(pl.Datetime(\"ms\"))\n)\n```\n\n### Continuous Futures 連續期貨合約\n\nUse R1 (near month), R2 (next month) for continuous data:\n使用 R1（近月）、R2（次月）取得連續數據：\n\n```python\n# Near month continuous contract 近月連續合約\ncontract = api.Contracts.Futures.TXF.TXFR1\nkbars = api.kbars(contract, start=\"2024-01-15\", end=\"2024-01-16\")\n\n# Next month 次月\ncontract = api.Contracts.Futures.TXF.TXFR2\n```\n\n### Data History 資料歷史\n\n| Product 商品 | Available From 可用起始日 |\n|--------------|---------------------------|\n| Index/Stock 指數/股票 | 2020-03-02 |\n| Futures 期貨 | 2020-03-22 |\n\n---\n\n## Snapshots 快照\n\nGet current market data for multiple contracts:\n取得多個合約的當前市場數據：\n\n```python\ncontracts = [\n    api.Contracts.Stocks[\"2330\"],\n    api.Contracts.Stocks[\"2317\"],\n    api.Contracts.Futures[\"TXFC0\"],\n]\n\n# Max 500 contracts 最多 500 個合約\nsnapshots = api.snapshots(contracts)\n\nfor snap in snapshots:\n    print(f\"{snap.code}: {snap.close} ({snap.change_rate}%)\")\n```\n\n### Snapshot Attributes 快照屬性\n\n```python\nsnap.ts              # int: Timestamp 時間戳\nsnap.code            # str: Contract code 合約代碼\nsnap.exchange        # str: Exchange 交易所\nsnap.open            # Decimal: Open price 開盤價\nsnap.high            # Decimal: High price 最高價\nsnap.low             # Decimal: Low price 最低價\nsnap.close           # Decimal: Close/Last price 收盤/最新價\nsnap.volume          # int: Volume 成交量\nsnap.total_volume    # int: Total volume 總成交量\nsnap.amount          # Decimal: Amount 成交金額\nsnap.total_amount    # Decimal: Total amount 總成交金額\nsnap.change_price    # Decimal: Price change 漲跌價\nsnap.change_rate     # Decimal: Change rate % 漲跌幅\nsnap.buy_price       # Decimal: Best bid 最佳買價\nsnap.buy_volume      # int: Bid volume 買量\nsnap.sell_price      # Decimal: Best ask 最佳賣價\nsnap.sell_volume     # int: Ask volume 賣量\nsnap.volume_ratio    # Decimal: Yesterday volume ratio 昨量比\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\ndf = pl.DataFrame([\n    {\n        \"code\": snap.code,\n        \"close\": float(snap.close),\n        \"volume\": snap.total_volume,\n        \"change_rate\": float(snap.change_rate),\n    }\n    for snap in snapshots\n])\n```\n\n---\n\n## Scanners 掃描器\n\nGet ranked market data by various criteria:\n依各種條件取得排行資料：\n\n### Scanner Types 掃描器類型\n\n```python\nimport shioaji as sj\n\n# By change percent 依漲跌幅\nsj.constant.ScannerType.ChangePercentRank\n\n# By change price 依漲跌價\nsj.constant.ScannerType.ChangePriceRank\n\n# By day range (high-low) 依當日振幅\nsj.constant.ScannerType.DayRangeRank\n\n# By volume 依成交量\nsj.constant.ScannerType.VolumeRank\n\n# By amount 依成交金額\nsj.constant.ScannerType.AmountRank\n```\n\n### Query Scanners 查詢掃描器\n\n```python\n# Top 10 gainers 漲幅前 10 名\nscanners = api.scanners(\n    scanner_type=sj.constant.ScannerType.ChangePercentRank,\n    ascending=False,  # Descending 由大到小\n    count=10\n)\n\n# Top 10 losers 跌幅前 10 名\nscanners = api.scanners(\n    scanner_type=sj.constant.ScannerType.ChangePercentRank,\n    ascending=True,  # Ascending 由小到大\n    count=10\n)\n\n# Top 10 by volume 成交量前 10 名\nscanners = api.scanners(\n    scanner_type=sj.constant.ScannerType.VolumeRank,\n    ascending=False,\n    count=10\n)\n```\n\n### Scanner Attributes 掃描器屬性\n\n```python\nscan.date            # str: Trade date 交易日\nscan.code            # str: Stock code 股票代碼\nscan.name            # str: Stock name 股票名稱\nscan.close           # Decimal: Close price 收盤價\nscan.volume          # int: Volume 成交量\nscan.amount          # Decimal: Amount 成交金額\nscan.change_price    # Decimal: Price change 漲跌價\nscan.change_rate     # Decimal: Change rate % 漲跌幅\nscan.bid_orders      # int: Buy-side orders 內盤成交單量\nscan.ask_orders      # int: Sell-side orders 外盤成交單量\nsnap.yesterday_volume # int: Yesterday volume 昨日成交量\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\ndf = pl.DataFrame([\n    {\n        \"code\": scan.code,\n        \"name\": scan.name,\n        \"close\": float(scan.close),\n        \"change_rate\": float(scan.change_rate),\n        \"volume\": scan.volume,\n    }\n    for scan in scanners\n])\n```\n\n---\n\n## Rate Limits 速率限制\n\n| Category 類別 | Limit 限制 |\n|---------------|------------|\n| Quote query 行情查詢 | 50 / 5 sec |\n| Accounting 帳務 | 25 / 5 sec |\n| Orders 委託 | 250 / 10 sec |\n\n---\n\n## Best Practices 最佳實踐\n\n### 1. Use Non-blocking for Batch Orders 批量下單使用非阻塞\n\n```python\norders = [...]  # Multiple orders\ntrades = []\n\nfor contract, order in orders:\n    trade = api.place_order(contract, order, timeout=0)\n    trades.append(trade)\n\n# Handle results in callback 在回調中處理結果\n```\n\n### 2. Minimize Computation in Callbacks 回調中最小化計算\n\n```python\nfrom queue import Queue\n\ntick_queue = Queue()\n\n@api.on_tick_stk_v1()\ndef on_tick(exchange, tick):\n    # Just enqueue, don't process 僅入列，不處理\n    tick_queue.put(tick)\n\n# Process in separate thread 在另一個執行緒處理\ndef process_ticks():\n    while True:\n        tick = tick_queue.get()\n        # Heavy processing here 在這裡做複雜處理\n```\n\n### 3. Use Polars for Multi-symbol Analysis 使用 Polars 進行多商品分析\n\n```python\nimport polars as pl\n\ndef analyze_kbars(symbols: list) -> pl.DataFrame:\n    all_data = []\n\n    for symbol in symbols:\n        contract = api.Contracts.Stocks[symbol]\n        kbars = api.kbars(contract, start=\"2024-01-01\", end=\"2024-01-31\")\n\n        df = pl.DataFrame({\n            \"code\": [symbol] * len(kbars.ts),\n            \"ts\": kbars.ts,\n            \"close\": [float(p) for p in kbars.Close],\n            \"volume\": kbars.Volume,\n        })\n        all_data.append(df)\n\n    return pl.concat(all_data).with_columns([\n        pl.col(\"close\").pct_change().over(\"code\").alias(\"return\"),\n        pl.col(\"close\").rolling_mean(20).over(\"code\").alias(\"sma20\"),\n    ])\n```\n\n---\n\n## Reference 參考資料\n\n- Demo project 範例專案: https://github.com/Sinotrade/sj-trading-demo\n- Official docs 官方文檔: https://sinotrade.github.io/\n",
        "skills/shioaji/CONTRACTS.md": "# Contracts 合約\n\nThis document covers how to access and use contract objects in Shioaji.\n本文件說明如何在 Shioaji 中存取和使用合約物件。\n\n---\n\n## Overview 概覽\n\nContracts are automatically downloaded during login. Access them via `api.Contracts`.\n合約會在登入時自動下載，透過 `api.Contracts` 存取。\n\n```python\nimport shioaji as sj\n\napi = sj.Shioaji()\napi.login(api_key=\"YOUR_KEY\", secret_key=\"YOUR_SECRET\")\n\n# Contracts are now available 合約已可使用\n```\n\n---\n\n## Stock Contracts 股票合約\n\n### Access by Symbol 以代碼存取\n\n```python\n# By stock code 以股票代碼\ntsmc = api.Contracts.Stocks[\"2330\"]      # TSMC 台積電\nhon_hai = api.Contracts.Stocks[\"2317\"]   # Hon Hai 鴻海\n\n# ETF\netf_0050 = api.Contracts.Stocks[\"0050\"]  # Taiwan 50 ETF\n```\n\n### Access by Exchange 以交易所存取\n\n```python\n# TSE (Taiwan Stock Exchange) 上市\ntse_stocks = api.Contracts.Stocks.TSE\n\n# OTC (Over-the-Counter) 上櫃\notc_stocks = api.Contracts.Stocks.OTC\n```\n\n### Contract Attributes 合約屬性\n\n```python\ncontract = api.Contracts.Stocks[\"2330\"]\n\ncontract.code           # Stock code 股票代碼: \"2330\"\ncontract.symbol         # Full symbol 完整代號\ncontract.name           # Company name 公司名稱\ncontract.category       # Category 類別\ncontract.exchange       # Exchange 交易所: \"TSE\" or \"OTC\"\ncontract.limit_up       # Price limit up 漲停價\ncontract.limit_down     # Price limit down 跌停價\ncontract.reference      # Reference price 參考價\ncontract.update_date    # Last update date 更新日期\ncontract.day_trade      # Day trade allowed 可當沖: \"Yes\"/\"No\"\n```\n\n---\n\n## Futures Contracts 期貨合約\n\n### Access Futures 存取期貨\n\n```python\n# By futures code 以期貨代碼\ntx = api.Contracts.Futures[\"TXF\"]     # Taiwan Index Futures 台指期\nmtx = api.Contracts.Futures[\"MXF\"]    # Mini Taiwan Index Futures 小台指\ntxo = api.Contracts.Futures[\"TXO\"]    # Taiwan Index Options 台指選\n\n# Current month contract 當月合約\ntxf_current = api.Contracts.Futures[\"TXFC0\"]  # C0 = current month 近月\n\n# Specific month 指定月份\ntxf_202401 = api.Contracts.Futures[\"TXF202401\"]\n```\n\n### Futures Contract Naming 期貨合約命名規則\n\n| Pattern 格式 | Example 範例 | Description 說明 |\n|--------------|--------------|------------------|\n| `{CODE}C0` | `TXFC0` | Current month 近月 |\n| `{CODE}C1` | `TXFC1` | Next month 次月 |\n| `{CODE}{YYYYMM}` | `TXF202401` | Specific month 指定月份 |\n\n### Futures Attributes 期貨屬性\n\n```python\ncontract = api.Contracts.Futures[\"TXFC0\"]\n\ncontract.code           # Futures code 期貨代碼\ncontract.symbol         # Full symbol 完整代號\ncontract.name           # Contract name 合約名稱\ncontract.category       # Category 類別\ncontract.delivery_month # Delivery month 交割月份\ncontract.delivery_date  # Delivery date 交割日\ncontract.underlying_kind # Underlying type 標的類型\ncontract.limit_up       # Price limit up 漲停價\ncontract.limit_down     # Price limit down 跌停價\ncontract.reference      # Reference price 參考價\ncontract.update_date    # Update date 更新日期\n```\n\n---\n\n## Options Contracts 選擇權合約\n\n### Access Options 存取選擇權\n\n```python\n# Taiwan Index Options 台指選擇權\ntxo = api.Contracts.Options[\"TXO\"]\n\n# Specific contract 指定合約\n# Format: {CODE}{YYYYMM}{C/P}{Strike}\ntxo_call = api.Contracts.Options[\"TXO202401C18000\"]  # Call @ 18000\ntxo_put = api.Contracts.Options[\"TXO202401P17000\"]   # Put @ 17000\n```\n\n### Options Contract Naming 選擇權合約命名\n\n| Part 部分 | Description 說明 | Example 範例 |\n|-----------|------------------|--------------|\n| Code 代碼 | Product code 商品代碼 | `TXO` |\n| YYYYMM | Expiry month 到期月 | `202401` |\n| C/P | Call or Put 買權/賣權 | `C` or `P` |\n| Strike | Strike price 履約價 | `18000` |\n\n### Options Attributes 選擇權屬性\n\n```python\ncontract = api.Contracts.Options[\"TXO202401C18000\"]\n\ncontract.code           # Option code 選擇權代碼\ncontract.symbol         # Full symbol 完整代號\ncontract.name           # Contract name 合約名稱\ncontract.category       # Category 類別\ncontract.delivery_month # Delivery month 到期月份\ncontract.strike_price   # Strike price 履約價\ncontract.option_right   # Call or Put 買權/賣權\ncontract.limit_up       # Price limit up 漲停價\ncontract.limit_down     # Price limit down 跌停價\ncontract.reference      # Reference price 參考價\ncontract.update_date    # Update date 更新日期\n```\n\n---\n\n## Index Contracts 指數合約\n\n### Access Index 存取指數\n\n```python\n# Taiwan Weighted Index 加權指數\ntse_index = api.Contracts.Indexs[\"TSE001\"]\n\n# OTC Index 櫃買指數\notc_index = api.Contracts.Indexs[\"OTC101\"]\n```\n\n---\n\n## Fetching All Contracts 取得所有合約\n\n### List All Stocks 列出所有股票\n\n```python\n# All stocks 所有股票\nall_stocks = [c for c in api.Contracts.Stocks]\n\n# Filter by exchange 依交易所篩選\ntse_stocks = [c for c in api.Contracts.Stocks if c.exchange == \"TSE\"]\notc_stocks = [c for c in api.Contracts.Stocks if c.exchange == \"OTC\"]\n\n# Filter by day trade 依可當沖篩選\nday_trade_stocks = [c for c in api.Contracts.Stocks if c.day_trade == \"Yes\"]\n```\n\n### List All Futures 列出所有期貨\n\n```python\nall_futures = [c for c in api.Contracts.Futures]\n```\n\n### List All Options 列出所有選擇權\n\n```python\nall_options = [c for c in api.Contracts.Options]\n```\n\n---\n\n## Contract Snapshots 合約快照\n\nGet real-time snapshot for contracts:\n取得合約的即時快照：\n\n```python\n# Single contract 單一合約\nsnapshot = api.snapshots([api.Contracts.Stocks[\"2330\"]])\n\n# Multiple contracts (up to 500) 多個合約（最多 500 個）\ncontracts = [\n    api.Contracts.Stocks[\"2330\"],\n    api.Contracts.Stocks[\"2317\"],\n    api.Contracts.Futures[\"TXFC0\"],\n]\nsnapshots = api.snapshots(contracts)\n\nfor snap in snapshots:\n    print(f\"{snap.code}: {snap.close} ({snap.change_price})\")\n```\n\n### Snapshot Attributes 快照屬性\n\n```python\nsnap.ts           # Timestamp 時間戳\nsnap.code         # Contract code 合約代碼\nsnap.exchange     # Exchange 交易所\nsnap.open         # Open price 開盤價\nsnap.high         # High price 最高價\nsnap.low          # Low price 最低價\nsnap.close        # Close/Last price 收盤/最新價\nsnap.change_price # Price change 漲跌\nsnap.change_rate  # Change rate % 漲跌幅\nsnap.volume       # Volume 成交量\nsnap.total_volume # Total volume 總成交量\nsnap.amount       # Amount 成交金額\nsnap.total_amount # Total amount 總成交金額\nsnap.buy_price    # Best bid 最佳買價\nsnap.buy_volume   # Bid volume 買量\nsnap.sell_price   # Best ask 最佳賣價\nsnap.sell_volume  # Ask volume 賣量\n```\n\n---\n\n## Contract Update 合約更新\n\nContracts can be updated manually if needed:\n如需要可手動更新合約：\n\n```python\n# Fetch latest contract info 取得最新合約資訊\napi.fetch_contracts(contract_download=True)\n```\n",
        "skills/shioaji/MARKET_DATA.md": "# Market Data 市場資料\n\nThis document covers historical data, snapshots, credit enquiries, short stock sources, scanners, and disposition/attention stocks.\n本文件說明歷史資料查詢、快照、資券餘額查詢、券源查詢、掃描器排行及處置/注意股。\n\n---\n\n## Historical Ticks 歷史 Tick 資料\n\nQuery historical tick data by date, time range, or last count.\n依日期、時間區間或筆數查詢歷史逐筆資料。\n\n### By Date 依日期\n\n```python\nticks = api.ticks(\n    contract=api.Contracts.Stocks[\"2330\"],\n    date=\"2023-01-16\"\n)\n```\n\n### By Time Range 依時間區間\n\n```python\nimport shioaji as sj\n\nticks = api.ticks(\n    contract=api.Contracts.Stocks[\"2330\"],\n    date=\"2023-01-16\",\n    query_type=sj.constant.TicksQueryType.RangeTime,\n    time_start=\"09:00:00\",\n    time_end=\"09:20:01\"\n)\n```\n\n### Last Count 最後 N 筆\n\n```python\nticks = api.ticks(\n    contract=api.Contracts.Stocks[\"2330\"],\n    date=\"2023-01-16\",\n    query_type=sj.constant.TicksQueryType.LastCount,\n    last_cnt=100,\n)\n```\n\n### Ticks Attributes Tick 屬性\n\n```python\nticks.ts          # List[int]: Timestamps 時間戳\nticks.close       # List[float]: Close prices 成交價\nticks.volume      # List[int]: Volumes 成交量\nticks.bid_price   # List[float]: Bid prices 買價\nticks.bid_volume  # List[int]: Bid volumes 買量\nticks.ask_price   # List[float]: Ask prices 賣價\nticks.ask_volume  # List[int]: Ask volumes 賣量\nticks.tick_type   # List[int]: 1=外盤, 2=內盤, 0=無法判定\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\ndf = pl.DataFrame({**ticks}).with_columns(\n    pl.col(\"ts\").cast(pl.Datetime(\"ns\"))\n)\n```\n\n---\n\n## Historical KBars 歷史 K 棒\n\nQuery historical 1-minute K-bar data.\n查詢歷史 1 分鐘 K 棒資料。\n\n```python\nkbars = api.kbars(\n    contract=api.Contracts.Stocks[\"2330\"],\n    start=\"2023-01-15\",\n    end=\"2023-01-16\",\n)\n```\n\n### KBars Attributes K 棒屬性\n\n```python\nkbars.ts      # List[int]: Timestamps 時間戳\nkbars.Open    # List[float]: Open prices 開盤價\nkbars.High    # List[float]: High prices 最高價\nkbars.Low     # List[float]: Low prices 最低價\nkbars.Close   # List[float]: Close prices 收盤價\nkbars.Volume  # List[int]: Volumes 成交量\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\ndf = pl.DataFrame({**kbars}).with_columns(\n    pl.col(\"ts\").cast(pl.Datetime(\"ns\"))\n)\n```\n\n---\n\n## Continuous Futures 連續期貨\n\nFor historical data of expired futures, use continuous contracts `R1` (near-month) and `R2` (next-to-near-month).\n查詢已過期期貨的歷史資料，使用連續合約 `R1`（近月）和 `R2`（次近月）。\n\n```python\n# Continuous near-month futures 連續近月期貨\nticks = api.ticks(\n    contract=api.Contracts.Futures.TXF.TXFR1,\n    date=\"2023-01-16\"\n)\n\nkbars = api.kbars(\n    contract=api.Contracts.Futures.TXF.TXFR1,\n    start=\"2023-01-15\",\n    end=\"2023-01-16\",\n)\n```\n\n### Historical Data Periods 歷史資料可查詢區間\n\n| Type 類型 | Start Date 起始日 |\n|-----------|-------------------|\n| Index 指數 | 2020-03-02 |\n| Stock 股票 | 2020-03-02 |\n| Futures 期貨 | 2020-03-22 |\n\n---\n\n## Snapshot 即時快照\n\nGet current snapshot for multiple contracts (max 500 per request).\n取得多個合約的當前快照（每次最多 500 個）。\n\n```python\ncontracts = [\n    api.Contracts.Stocks[\"2330\"],\n    api.Contracts.Stocks[\"2317\"],\n]\n\nsnapshots = api.snapshots(contracts)\n```\n\n### Snapshot Attributes 快照屬性\n\n```python\nsnap.ts              # int: Timestamp 時間戳\nsnap.code            # str: Stock code 股票代碼\nsnap.exchange        # str: Exchange 交易所\nsnap.open            # float: Open price 開盤價\nsnap.high            # float: High price 最高價\nsnap.low             # float: Low price 最低價\nsnap.close           # float: Close price 收盤價\nsnap.tick_type       # TickType: Buy/Sell 內外盤\nsnap.change_price    # float: Price change 漲跌價\nsnap.change_rate     # float: Change rate % 漲跌幅\nsnap.change_type     # ChangeType: Up/Down/Unchanged/LimitUp/LimitDown\nsnap.average_price   # float: Average price 均價\nsnap.volume          # int: Last volume 最後成交量\nsnap.total_volume    # int: Total volume 總成交量\nsnap.amount          # int: Last amount 最後成交金額\nsnap.total_amount    # int: Total amount 總成交金額\nsnap.yesterday_volume # float: Yesterday volume 昨日成交量\nsnap.buy_price       # float: Bid price 買價\nsnap.buy_volume      # float: Bid volume 買量\nsnap.sell_price      # float: Ask price 賣價\nsnap.sell_volume     # int: Ask volume 賣量\nsnap.volume_ratio    # float: Volume ratio 量比\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\n# Use BaseModel.dict() to convert 使用 BaseModel.dict() 轉換\ndf = pl.DataFrame([s.dict() for s in snapshots])\n```\n\n---\n\n## Credit Enquiries 資券餘額查詢\n\nQuery margin and short unit information for stocks.\n查詢股票的融資融券餘額資訊。\n\n```python\ncontracts = [\n    api.Contracts.Stocks[\"2330\"],\n    api.Contracts.Stocks[\"2890\"],\n]\n\ncredit_enquires = api.credit_enquires(contracts)\n```\n\n### CreditEnquire Attributes 資券餘額屬性\n\n```python\nenquire.update_time   # str: Update time 更新時間\nenquire.system        # str: System code 系統代碼\nenquire.stock_id      # str: Stock code 股票代碼\nenquire.margin_unit   # int: Margin units 融資餘額\nenquire.short_unit    # int: Short units 融券餘額\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\n# Use BaseModel.dict() to convert 使用 BaseModel.dict() 轉換\ndf = pl.DataFrame([c.dict() for c in credit_enquires])\n```\n\n---\n\n## Short Stock Sources 券源查詢\n\nQuery available short stock sources (借券來源).\n查詢可借券數量。\n\n```python\ncontracts = [\n    api.Contracts.Stocks[\"2330\"],\n    api.Contracts.Stocks[\"2317\"],\n]\n\nshort_sources = api.short_stock_sources(contracts)\n```\n\n### ShortStockSource Attributes 券源屬性\n\n```python\nsource.code               # str: Stock code 股票代碼\nsource.short_stock_source # int: Available shares 可借券數量\nsource.ts                 # int: Timestamp 時間戳\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\n# Use BaseModel.dict() to convert 使用 BaseModel.dict() 轉換\ndf = pl.DataFrame([s.dict() for s in short_sources]).with_columns(\n    pl.col(\"ts\").cast(pl.Datetime(\"ns\"))\n)\n```\n\n---\n\n## Scanners 掃描器排行\n\nGet market rankings by various criteria.\n依各種條件取得市場排行。\n\n### Scanner Types 掃描器類型\n\n```python\nimport shioaji as sj\n\nsj.constant.ScannerType.ChangePercentRank  # 漲跌幅排行\nsj.constant.ScannerType.ChangePriceRank    # 漲跌價排行\nsj.constant.ScannerType.DayRangeRank       # 振幅排行\nsj.constant.ScannerType.VolumeRank         # 成交量排行\nsj.constant.ScannerType.AmountRank         # 成交金額排行\n```\n\n### Query Scanners 查詢排行\n\n```python\n# Top 10 gainers 漲幅前 10 名\nscanners = api.scanners(\n    scanner_type=sj.constant.ScannerType.ChangePercentRank,\n    ascending=False,  # False = descending 由大到小\n    count=10,\n)\n\n# Top 10 losers 跌幅前 10 名\nscanners = api.scanners(\n    scanner_type=sj.constant.ScannerType.ChangePercentRank,\n    ascending=True,  # True = ascending 由小到大\n    count=10,\n)\n\n# Top volume 成交量排行\nscanners = api.scanners(\n    scanner_type=sj.constant.ScannerType.VolumeRank,\n    ascending=False,\n    count=10,\n)\n```\n\n### Scanner Attributes 掃描器屬性\n\n```python\nscan.date            # str: Trade date 交易日\nscan.code            # str: Stock code 股票代碼\nscan.name            # str: Stock name 股票名稱\nscan.ts              # int: Timestamp 時間戳\nscan.open            # float: Open price 開盤價\nscan.high            # float: High price 最高價\nscan.low             # float: Low price 最低價\nscan.close           # float: Close price 收盤價\nscan.price_range     # float: Day range 振幅\nscan.change_price    # float: Price change 漲跌價\nscan.change_type     # int: Change type 漲跌類型\nscan.average_price   # float: Average price 均價\nscan.volume          # int: Last volume 最後成交量\nscan.total_volume    # int: Total volume 總成交量\nscan.amount          # int: Last amount 最後成交金額\nscan.total_amount    # int: Total amount 總成交金額\nscan.yesterday_volume # int: Yesterday volume 昨日成交量\nscan.volume_ratio    # float: Volume ratio 量比\nscan.buy_price       # float: Bid price 買價\nscan.buy_volume      # int: Bid volume 買量\nscan.sell_price      # float: Ask price 賣價\nscan.sell_volume     # int: Ask volume 賣量\nscan.bid_orders      # int: Bid side orders 內盤成交單數\nscan.bid_volumes     # int: Bid side volume 內盤成交量\nscan.ask_orders      # int: Ask side orders 外盤成交單數\nscan.ask_volumes     # int: Ask side volume 外盤成交量\nscan.tick_type       # int: 1=外盤, 2=內盤, 0=無法判定\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\nscanners = api.scanners(\n    scanner_type=sj.constant.ScannerType.ChangePercentRank,\n    count=50,\n)\n\n# Use BaseModel.dict() to convert 使用 BaseModel.dict() 轉換\ndf = pl.DataFrame([s.dict() for s in scanners])\n\n# Filter high volume ratio 篩選量比高的\nhigh_volume = df.filter(pl.col(\"volume_ratio\") > 2)\n```\n\n---\n\n## Disposition Stocks 處置股\n\nQuery stocks under trading restrictions (處置股).\n查詢受交易限制的處置股清單。\n\n```python\npunish = api.punish()\n```\n\n### Punish Attributes 處置股屬性\n\n```python\npunish.code            # List[str]: Stock codes 股票代碼\npunish.start_date      # List[date]: Disposition start date 處置開始日\npunish.end_date        # List[date]: Disposition end date 處置結束日\npunish.updated_at      # List[datetime]: Updated time 更新時間\npunish.interval        # List[str]: Matching interval 撮合間隔 (e.g., \"5分鐘\")\npunish.unit_limit      # List[float]: Single order limit % 單筆限額\npunish.total_limit     # List[float]: Daily order limit % 每日限額\npunish.description     # List[str]: Description 說明\npunish.announced_date  # List[date]: Announced date 公告日\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\n# Punish returns single object with list attributes\n# Punish 回傳單一物件，屬性為 list\ndf = pl.DataFrame(punish.dict())\n```\n\n---\n\n## Attention Stocks 注意股\n\nQuery stocks under attention (注意股).\n查詢受注意的股票清單。\n\n```python\nnotice = api.notice()\n```\n\n### Notice Attributes 注意股屬性\n\n```python\nnotice.code            # List[str]: Stock codes 股票代碼\nnotice.updated_at      # List[datetime]: Updated time 更新時間\nnotice.close           # List[float]: Close price 收盤價\nnotice.reason          # List[str]: Attention reason 注意原因\nnotice.announced_date  # List[date]: Announced date 公告日\n```\n\n### Convert to Polars 轉換為 Polars\n\n```python\nimport polars as pl\n\n# Notice returns single object with list attributes\n# Notice 回傳單一物件，屬性為 list\ndf = pl.DataFrame(notice.dict())\n```\n\n---\n\n## Reference 參考資料\n\n- Historical data 歷史資料: https://sinotrade.github.io/tutor/market_data/historical/\n- Snapshot 快照: https://sinotrade.github.io/tutor/market_data/snapshot/\n- Credit enquiries 資券餘額: https://sinotrade.github.io/tutor/market_data/credit_enquires/\n- Short stock sources 券源: https://sinotrade.github.io/tutor/market_data/short_stock_source/\n- Scanners 掃描器: https://sinotrade.github.io/tutor/market_data/scanners/\n- Disposition/Attention 處置/注意股: https://sinotrade.github.io/tutor/market_data/disposition_attention/\n",
        "skills/shioaji/ORDERS.md": "# Orders 下單\n\nThis document covers placing, modifying, and canceling orders in Shioaji.\n本文件說明如何在 Shioaji 中下單、改單和刪單。\n\n---\n\n## Prerequisites 前置條件\n\nBefore placing orders, ensure CA is activated:\n下單前請確認已啟用憑證：\n\n```python\nimport shioaji as sj\n\napi = sj.Shioaji()\napi.login(api_key=\"YOUR_KEY\", secret_key=\"YOUR_SECRET\")\n\n# Activate CA 啟用憑證 (required 必須)\napi.activate_ca(\n    ca_path=\"/path/to/Sinopac.pfx\",\n    ca_passwd=\"YOUR_PASSWORD\"\n)\n```\n\n---\n\n## Stock Orders 股票下單\n\n### Basic Stock Order 基本股票下單\n\n```python\ncontract = api.Contracts.Stocks[\"2330\"]\n\norder = api.Order(\n    price=580,\n    quantity=1,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    order_lot=sj.constant.StockOrderLot.Common,\n    account=api.stock_account,\n)\n\ntrade = api.place_order(contract, order)\n```\n\n### Order Parameters 訂單參數\n\n| Parameter 參數 | Type 類型 | Description 說明 |\n|----------------|-----------|------------------|\n| `price` | float/int | Order price 委託價格 |\n| `quantity` | int | Order quantity 委託數量 |\n| `action` | Action | Buy/Sell 買/賣 |\n| `price_type` | PriceType | LMT/MKT/MKP 限價/市價/範圍市價 |\n| `order_type` | OrderType | ROD/IOC/FOK 委託條件 |\n| `order_lot` | OrderLot | Common/Odd/IntradayOdd/Fixing 交易單位 |\n| `order_cond` | OrderCond | Cash/MarginTrading/ShortSelling 信用條件 |\n| `account` | Account | Trading account 交易帳戶 |\n| `custom_field` | str | Memo (max 6 chars) 備註（最多6字元）|\n\n### Market Order 市價單\n\n```python\norder = api.Order(\n    price=0,  # Price ignored for MKT 市價單忽略價格\n    quantity=1,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.StockPriceType.MKT,\n    order_type=sj.constant.OrderType.IOC,  # MKT requires IOC/FOK 市價須 IOC/FOK\n    account=api.stock_account,\n)\n```\n\n### Odd Lot Orders 零股下單\n\n```python\n# Intraday odd lot 盤中零股 (9:00-13:30)\norder = api.Order(\n    price=580,\n    quantity=100,  # Less than 1000 shares 小於1000股\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    order_lot=sj.constant.StockOrderLot.IntradayOdd,\n    account=api.stock_account,\n)\n\n# After-hours odd lot 盤後零股 (13:40-14:30)\norder = api.Order(\n    price=580,\n    quantity=100,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    order_lot=sj.constant.StockOrderLot.Odd,\n    account=api.stock_account,\n)\n```\n\n**Note 注意:** IntradayOdd orders cannot update price, only reduce quantity.\n盤中零股委託不能改價，只能減量。\n\n### Margin Trading 融資融券\n\n```python\n# Margin buy 融資買進\norder = api.Order(\n    price=580,\n    quantity=1,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    order_cond=sj.constant.StockOrderCond.MarginTrading,\n    account=api.stock_account,\n)\n\n# Short sell 融券賣出\norder = api.Order(\n    price=580,\n    quantity=1,\n    action=sj.constant.Action.Sell,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    order_cond=sj.constant.StockOrderCond.ShortSelling,\n    account=api.stock_account,\n)\n```\n\n### Day Trading 現股當沖\n\n```python\n# Day trade buy (first leg) 當沖買進（第一筆）\norder = api.Order(\n    price=580,\n    quantity=1,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    daytrade_short=True,  # Enable day trade 啟用當沖\n    account=api.stock_account,\n)\n\n# Day trade sell (close position) 當沖賣出（平倉）\norder = api.Order(\n    price=590,\n    quantity=1,\n    action=sj.constant.Action.Sell,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    daytrade_short=True,\n    account=api.stock_account,\n)\n```\n\n---\n\n## Futures Orders 期貨下單\n\n### Basic Futures Order 基本期貨下單\n\n```python\ncontract = api.Contracts.Futures[\"TXFC0\"]  # Current month 近月\n\norder = api.Order(\n    price=18000,\n    quantity=1,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    octype=sj.constant.FuturesOCType.Auto,  # Auto open/close 自動開平\n    account=api.futopt_account,\n)\n\ntrade = api.place_order(contract, order)\n```\n\n### Futures Parameters 期貨參數\n\n| Parameter 參數 | Type 類型 | Description 說明 |\n|----------------|-----------|------------------|\n| `price` | float/int | Order price 委託價格 |\n| `quantity` | int | Number of contracts 口數 |\n| `action` | Action | Buy/Sell 買/賣 |\n| `price_type` | FuturesPriceType | LMT/MKT/MKP 限價/市價/範圍市價 |\n| `order_type` | OrderType | ROD/IOC/FOK 委託條件 |\n| `octype` | FuturesOCType | Auto/NewPosition/Cover 自動/新倉/平倉 |\n| `account` | Account | Futures account 期貨帳戶 |\n\n### Open/Close Type 開平倉類型\n\n```python\nsj.constant.FuturesOCType.Auto        # Auto 自動 (recommended 推薦)\nsj.constant.FuturesOCType.NewPosition # Open new 新倉\nsj.constant.FuturesOCType.Cover       # Close 平倉\nsj.constant.FuturesOCType.DayTrade    # Day trade 當沖\n```\n\n---\n\n## Options Orders 選擇權下單\n\n### Basic Options Order 基本選擇權下單\n\n```python\n# Buy call option 買進買權\ncontract = api.Contracts.Options[\"TXO202401C18000\"]\n\norder = api.Order(\n    price=100,\n    quantity=1,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account,\n)\n\ntrade = api.place_order(contract, order)\n```\n\n### Sell Options 賣出選擇權\n\n```python\n# Sell put option 賣出賣權\ncontract = api.Contracts.Options[\"TXO202401P17000\"]\n\norder = api.Order(\n    price=50,\n    quantity=1,\n    action=sj.constant.Action.Sell,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account,\n)\n\ntrade = api.place_order(contract, order)\n```\n\n---\n\n## Combo Orders 組合單\n\nCombo orders allow trading multi-leg option strategies (spreads, straddles, strangles).\n組合單可交易多腳選擇權策略（價差、跨式、勒式等）。\n\n### Create Combo Contract 建立組合合約\n\n```python\nfrom shioaji.contracts import ComboContract, ComboBase\n\n# Bull Call Spread 買權多頭價差\n# Buy lower strike, Sell higher strike\n# 買進較低履約價，賣出較高履約價\ncombo_contract = ComboContract(\n    legs=[\n        ComboBase(\n            action=sj.constant.Action.Buy,\n            contract=api.Contracts.Options[\"TXO202401C18000\"],\n        ),\n        ComboBase(\n            action=sj.constant.Action.Sell,\n            contract=api.Contracts.Options[\"TXO202401C18500\"],\n        ),\n    ]\n)\n```\n\n### Place Combo Order 下組合單\n\n```python\ncombo_order = api.ComboOrder(\n    price=50,  # Net price 淨價\n    quantity=1,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account,\n)\n\ntrade = api.place_comboorder(combo_contract, combo_order)\n```\n\n### Combo Order Parameters 組合單參數\n\n| Parameter 參數 | Type 類型 | Description 說明 |\n|----------------|-----------|------------------|\n| `price` | float | Net price of spread 價差淨價 |\n| `quantity` | int | Number of combos 組數 |\n| `price_type` | FuturesPriceType | LMT/MKT 限價/市價 |\n| `order_type` | OrderType | ROD/IOC/FOK 委託條件 |\n| `octype` | FuturesOCType | Auto/NewPosition/Cover 開平倉 |\n\n### Strategy Examples 策略範例\n\n```python\n# Straddle 跨式 (Buy Call + Buy Put same strike)\nstraddle = ComboContract(\n    legs=[\n        ComboBase(\n            action=sj.constant.Action.Buy,\n            contract=api.Contracts.Options[\"TXO202401C18000\"],\n        ),\n        ComboBase(\n            action=sj.constant.Action.Buy,\n            contract=api.Contracts.Options[\"TXO202401P18000\"],\n        ),\n    ]\n)\n\n# Strangle 勒式 (Buy OTM Call + Buy OTM Put)\nstrangle = ComboContract(\n    legs=[\n        ComboBase(\n            action=sj.constant.Action.Buy,\n            contract=api.Contracts.Options[\"TXO202401C18500\"],\n        ),\n        ComboBase(\n            action=sj.constant.Action.Buy,\n            contract=api.Contracts.Options[\"TXO202401P17500\"],\n        ),\n    ]\n)\n```\n\n### Combo Status 組合單狀態\n\n```python\n# Update combo status 更新組合單狀態\napi.update_combostatus(api.futopt_account)\n\n# List all combo trades 列出所有組合單\ncombo_trades = api.list_combotrades()\n\nfor trade in combo_trades:\n    print(f\"Order ID: {trade.order.id}\")\n    print(f\"Status: {trade.status.status}\")\n```\n\n### Cancel Combo Order 取消組合單\n\n```python\napi.cancel_comboorder(trade)\n```\n\n---\n\n## Modify Orders 改單\n\n### Change Price 改價\n\n```python\napi.update_order(trade=trade, price=585)\n```\n\n### Reduce Quantity 減量\n\nNote: Can only reduce, not increase.\n注意：只能減少，不能增加。\n\n```python\napi.update_order(trade=trade, qty=1)\n```\n\n---\n\n## Cancel Orders 刪單\n\n```python\napi.cancel_order(trade)\n\n# Or cancel by trade object 或透過 trade 物件\napi.cancel_order(trade=trade)\n```\n\n---\n\n## Order Status 訂單狀態\n\n### Update Status 更新狀態\n\n```python\n# Update all order status 更新所有訂單狀態\napi.update_status(api.stock_account)\napi.update_status(api.futopt_account)\n```\n\n### List Trades 列出交易\n\n```python\n# List all trades 列出所有交易\ntrades = api.list_trades()\n\nfor trade in trades:\n    print(f\"Order: {trade.order.id}\")\n    print(f\"Status: {trade.status.status}\")\n    print(f\"Deal Quantity: {trade.status.deal_quantity}\")\n```\n\n### Trade Status Values 交易狀態值\n\n| Status 狀態 | Description 說明 |\n|-------------|------------------|\n| `PendingSubmit` | Submitting 傳送中 |\n| `PreSubmitted` | Pre-submitted 預約中 |\n| `Submitted` | Submitted 已送出 |\n| `Failed` | Failed 失敗 |\n| `Cancelled` | Cancelled 已取消 |\n| `Filled` | Fully filled 全部成交 |\n| `PartFilled` | Partially filled 部分成交 |\n\n### Trade Object Attributes 交易物件屬性\n\n```python\ntrade.contract        # Contract 合約\ntrade.order           # Order details 訂單詳情\ntrade.order.id        # Order ID 訂單編號\ntrade.order.seqno     # Sequence number 序號\ntrade.order.action    # Buy/Sell 買賣方向\ntrade.order.price     # Order price 委託價\ntrade.order.quantity  # Order quantity 委託量\ntrade.status          # Status object 狀態物件\ntrade.status.status   # Status value 狀態值\ntrade.status.deal_quantity  # Filled quantity 成交量\ntrade.status.cancel_quantity # Cancelled quantity 取消量\n```\n\n---\n\n## Order Callbacks 訂單回報\n\nOrder and deal events are pushed automatically when orders are submitted or filled.\n委託及成交事件會在下單或成交時主動推送。\n\n### Set Order Callback 設定回報 Callback\n\n```python\ndef order_cb(stat, msg):\n    print(f\"State: {stat}\")\n    print(f\"Message: {msg}\")\n\napi.set_order_callback(order_cb)\n```\n\n### OrderState Types 回報狀態類型\n\n```python\nimport shioaji as sj\n\n# Stock 股票\nsj.constant.OrderState.StockOrder  # 股票委託回報\nsj.constant.OrderState.StockDeal   # 股票成交回報\n\n# Futures/Options 期貨選擇權\nsj.constant.OrderState.FuturesOrder  # 期貨委託回報\nsj.constant.OrderState.FuturesDeal   # 期貨成交回報\n```\n\n### TypedDict Definitions 類型定義\n\nFor better type hints, use these TypedDict definitions:\n使用以下 TypedDict 定義以獲得更好的型別提示：\n\n```python\nfrom typing import TypedDict, Literal\n\nclass OperationDict(TypedDict):\n    op_type: Literal[\"New\", \"Cancel\", \"UpdatePrice\", \"UpdateQty\"]\n    op_code: str  # \"00\" = success, others = fail\n    op_msg: str\n\nclass AccountDict(TypedDict):\n    account_type: Literal[\"S\", \"F\"]  # S=Stock, F=Futures\n    person_id: str\n    broker_id: str\n    account_id: str\n    signed: bool\n\nclass StockOrderDict(TypedDict):\n    id: str\n    seqno: str\n    ordno: str\n    account: AccountDict\n    action: Literal[\"Buy\", \"Sell\"]\n    price: float\n    quantity: int\n    order_type: Literal[\"ROD\", \"IOC\", \"FOK\"]\n    price_type: Literal[\"LMT\", \"MKT\", \"MKP\"]\n    order_cond: Literal[\"Cash\", \"MarginTrading\", \"ShortSelling\"]\n    order_lot: Literal[\"Common\", \"Odd\", \"IntradayOdd\", \"Fixing\"]\n    custom_field: str\n\nclass OrderStatusDict(TypedDict):\n    id: str\n    exchange_ts: float\n    modified_price: float\n    cancel_quantity: int\n    order_quantity: int\n    web_id: str\n\nclass StockContractDict(TypedDict):\n    security_type: Literal[\"STK\"]\n    exchange: str\n    code: str\n    symbol: str\n    name: str\n    currency: str\n\nclass StockOrderEvent(TypedDict):\n    operation: OperationDict\n    order: StockOrderDict\n    status: OrderStatusDict\n    contract: StockContractDict\n\nclass StockDealEvent(TypedDict):\n    trade_id: str\n    seqno: str\n    ordno: str\n    exchange_seq: str\n    broker_id: str\n    account_id: str\n    action: Literal[\"Buy\", \"Sell\"]\n    code: str\n    order_cond: Literal[\"Cash\", \"MarginTrading\", \"ShortSelling\"]\n    order_lot: Literal[\"Common\", \"Odd\", \"IntradayOdd\", \"Fixing\"]\n    price: float\n    quantity: int\n    web_id: str\n    custom_field: str\n    ts: float\n\nclass FuturesOrderDict(TypedDict):\n    id: str\n    seqno: str\n    ordno: str\n    account: AccountDict\n    action: Literal[\"Buy\", \"Sell\"]\n    price: float\n    quantity: int\n    order_type: Literal[\"ROD\", \"IOC\", \"FOK\"]\n    price_type: Literal[\"LMT\", \"MKT\", \"MKP\"]\n    market_type: Literal[\"Day\", \"Night\"]\n    oc_type: Literal[\"New\", \"Cover\", \"Auto\"]\n    subaccount: str\n    combo: bool\n\nclass FuturesContractDict(TypedDict):\n    security_type: Literal[\"FUT\", \"OPT\"]\n    code: str\n    full_code: str\n    exchange: str\n    delivery_month: str\n    delivery_date: str\n    strike_price: float\n    option_right: Literal[\"Future\", \"OptionCall\", \"OptionPut\"]\n\nclass FuturesOrderEvent(TypedDict):\n    operation: OperationDict\n    order: FuturesOrderDict\n    status: OrderStatusDict\n    contract: FuturesContractDict\n\nclass FuturesDealEvent(TypedDict):\n    trade_id: str\n    seqno: str\n    ordno: str\n    exchange_seq: str\n    broker_id: str\n    account_id: str\n    action: Literal[\"Buy\", \"Sell\"]\n    code: str\n    full_code: str\n    price: float\n    quantity: int\n    subaccount: str\n    security_type: Literal[\"FUT\", \"OPT\"]\n    delivery_month: str\n    strike_price: float\n    option_right: Literal[\"Future\", \"OptionCall\", \"OptionPut\"]\n    market_type: Literal[\"Day\", \"Night\"]\n    combo: bool\n    ts: float\n```\n\n### Handle Different Events 處理不同事件\n\nSplit handlers by event type for clear type hints:\n依事件類型拆分 handler 以獲得明確的型別提示：\n\n```python\nimport shioaji as sj\nfrom shioaji.constant import OrderState\n\ndef stock_order_handler(event: StockOrderEvent):\n    \"\"\"Handle stock order event 處理股票委託回報\"\"\"\n    op = event[\"operation\"]\n    order = event[\"order\"]\n    if op[\"op_code\"] == \"00\":\n        print(f\"Stock order {op['op_type']} success: {order['id']}\")\n    else:\n        print(f\"Stock order failed: {op['op_msg']}\")\n\ndef stock_deal_handler(deal: StockDealEvent):\n    \"\"\"Handle stock deal event 處理股票成交回報\"\"\"\n    print(f\"Stock deal: {deal['code']} @ {deal['price']} x {deal['quantity']}\")\n\ndef futures_order_handler(event: FuturesOrderEvent):\n    \"\"\"Handle futures order event 處理期貨委託回報\"\"\"\n    op = event[\"operation\"]\n    order = event[\"order\"]\n    contract = event[\"contract\"]\n    if op[\"op_code\"] == \"00\":\n        print(f\"Futures order {op['op_type']}: {order['action']} {contract['code']}\")\n    else:\n        print(f\"Futures order failed: {op['op_msg']}\")\n\ndef futures_deal_handler(deal: FuturesDealEvent):\n    \"\"\"Handle futures deal event 處理期貨成交回報\"\"\"\n    print(f\"Futures deal: {deal['code']} @ {deal['price']} x {deal['quantity']}\")\n\ndef order_cb(stat: OrderState, msg: dict):\n    \"\"\"Main callback dispatcher 主回調分發器\"\"\"\n    if stat == OrderState.StockOrder:\n        stock_order_handler(msg)\n    elif stat == OrderState.StockDeal:\n        stock_deal_handler(msg)\n    elif stat == OrderState.FuturesOrder:\n        futures_order_handler(msg)\n    elif stat == OrderState.FuturesDeal:\n        futures_deal_handler(msg)\n\napi.set_order_callback(order_cb)\n```\n\n### Note 注意事項\n\nDeal events may arrive before order events due to exchange message priority.\n成交回報可能比委託回報更早到達，因為交易所訊息優先順序不同。\n\n---\n\n## Best Practices 最佳實踐\n\n### 1. Use Callbacks for Real-time Status 使用主動回報獲取即時狀態\n\nPrefer callbacks over `update_status()` to avoid rate limits.\n優先使用主動回報而非 `update_status()` 以避免觸發流量限制。\n\n```python\ndef order_cb(stat: OrderState, msg: dict):\n    if stat == OrderState.StockOrder:\n        if msg[\"operation\"][\"op_code\"] == \"00\":\n            print(f\"Order accepted: {msg['order']['id']}\")\n        else:\n            print(f\"Order rejected: {msg['operation']['op_msg']}\")\n    elif stat == OrderState.StockDeal:\n        print(f\"Filled: {msg['code']} @ {msg['price']} x {msg['quantity']}\")\n\napi.set_order_callback(order_cb)\n```\n\n### 2. Use update_status Only When Needed 僅在必要時使用 update_status\n\nOnly use `update_status()` for:\n僅在以下情況使用 `update_status()`：\n\n- After reconnection 斷線重連後\n- Query historical orders 查詢歷史訂單\n- When callback missed 回報遺漏時\n\n```python\n# Query specific trade only 僅查詢特定訂單\napi.update_status(trade=trade)\n\n# Or query all (use sparingly) 或查詢全部（謹慎使用）\napi.update_status(api.stock_account)\n```\n\n### 3. Handle Errors Gracefully 優雅處理錯誤\n\n```python\ntry:\n    trade = api.place_order(contract, order)\nexcept Exception as e:\n    print(f\"Order error: {e}\")\n",
        "skills/shioaji/PREPARE.md": "# Preparation 準備工作\n\nThis document covers account setup, API key application, and testing environment.\n本文件說明開戶、API 金鑰申請和測試環境設定。\n\n---\n\n## Overview 概覽\n\nBefore using Shioaji, complete these steps:\n使用 Shioaji 前，請完成以下步驟：\n\n1. **Open Account 開立帳戶** - Apply for Sinopac securities account\n2. **Apply API Key 申請金鑰** - Get API Key and Secret Key\n3. **Download Certificate 下載憑證** - Get CA certificate for trading\n4. **Install uv 安裝 uv** - Install Python environment manager\n5. **Create Project 建立專案** - Initialize project with uv\n6. **Configure Environment 設定環境** - Set up environment variables\n7. **Test in Simulation 模擬測試** - Verify setup in simulation mode\n\n---\n\n## Open Account 開立帳戶\n\nApply for a Sinopac securities account:\n申請永豐金證券帳戶：\n\n- **Online Application 線上開戶**: https://sinotrade.github.io/tutor/prepare/open_account\n- Required documents 所需文件: ID card, second ID, bank account\n\n---\n\n## Apply API Key 申請金鑰\n\n### Step 1: Access API Management 進入 API 管理\n\nGo to Sinopac personal service page:\n前往永豐金個人服務頁面：\n\nhttps://www.sinotrade.com.tw/newweb/PythonAPIKey/\n\n### Step 2: Create API Key 建立 API Key\n\n1. Click \"Add API KEY\" 點擊「新增 API KEY」\n2. Complete 2FA verification 完成雙重驗證（手機或 Email）\n3. Configure key settings 設定金鑰選項：\n   - **Expiration 到期時間** - Set key validity period\n   - **Permissions 權限** - Market/Data, Account, Trading\n   - **Accounts 帳戶** - Select allowed accounts\n   - **Production 正式環境** - Enable for live trading\n   - **IP Whitelist IP 白名單** - Restrict allowed IPs (recommended)\n\n### Step 3: Save Keys 保存金鑰\n\nAfter creation, you'll receive:\n建立後會取得：\n\n- **API Key** - Public identifier\n- **Secret Key** - Private key (shown only once! 只顯示一次！)\n\n```python\n# Store in environment variables 存放在環境變數中\nAPI_KEY = \"your_api_key\"\nSECRET_KEY = \"your_secret_key\"\n```\n\n---\n\n## Download Certificate 下載憑證\n\n### Step 1: Download CA Certificate 下載 CA 憑證\n\n1. Go to API management page 進入 API 管理頁面\n2. Click \"Download Certificate\" 點擊「下載憑證」\n3. Save the `.pfx` file 儲存 `.pfx` 檔案\n\n### Step 2: Store Certificate 存放憑證\n\n```python\n# Certificate path and password 憑證路徑與密碼\nCA_CERT_PATH = \"/path/to/Sinopac.pfx\"\nCA_PASSWORD = \"your_ca_password\"\n```\n\n---\n\n## Install uv 安裝 uv\n\nuv is the recommended tool for managing Python environment.\nuv 是推薦的 Python 環境管理工具。\n\n```bash\n# Linux / MacOS\ncurl -LsSf https://astral.sh/uv/install.sh | sh\n\n# Windows (PowerShell)\npowershell -c \"irm https://astral.sh/uv/install.ps1 | iex\"\n```\n\nMore info 更多資訊: https://docs.astral.sh/uv/\n\n---\n\n## Create Project 建立專案\n\n### Step 1: Initialize Project 初始化專案\n\n```bash\n# Create packaged application 建立打包應用程式\nuv init sj-trading --package\n\ncd sj-trading\n```\n\nProject structure 專案結構:\n\n```\nsj-trading/\n├── .python-version\n├── README.md\n├── pyproject.toml\n└── src/\n    └── sj_trading/\n        └── __init__.py\n```\n\n### Step 2: Add Shioaji 加入 Shioaji\n\n```bash\nuv add shioaji\n```\n\n### Step 3: Verify Installation 驗證安裝\n\nEdit `src/sj_trading/__init__.py`:\n編輯 `src/sj_trading/__init__.py`：\n\n```python\nimport shioaji as sj\n\ndef hello():\n    api = sj.Shioaji()\n    print(f\"Shioaji Version: {sj.__version__}\")\n    print(\"Shioaji API created successfully!\")\n    return api\n```\n\nAdd command to `pyproject.toml`:\n在 `pyproject.toml` 加入命令：\n\n```toml\n[project.scripts]\nhello = \"sj_trading:hello\"\n```\n\nRun 執行:\n\n```bash\nuv run hello\n```\n\nOutput 輸出:\n\n```\nShioaji Version: 1.x.x\nShioaji API created successfully!\n```\n\n### Use Jupyter 使用 Jupyter\n\n```bash\n# Add ipykernel to dev dependencies 加入開發依賴\nuv add --dev ipykernel\n\n# Register kernel 註冊 kernel\nuv run ipython kernel install --user --name=sj-trading\n\n# Start Jupyter Lab 啟動 Jupyter Lab\nuv run --with jupyter jupyter lab\n```\n\n---\n\n## Environment Variables 環境變數設定\n\n### Using .env File 使用 .env 檔案\n\nCreate `.env` file in project root:\n在專案根目錄建立 `.env` 檔案：\n\n```\nAPI_KEY=your_api_key\nSECRET_KEY=your_secret_key\nCA_CERT_PATH=/path/to/Sinopac.pfx\nCA_PASSWORD=your_ca_password\n```\n\n### Load Environment Variables 載入環境變數\n\n```python\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\napi_key = os.environ[\"API_KEY\"]\nsecret_key = os.environ[\"SECRET_KEY\"]\nca_path = os.environ[\"CA_CERT_PATH\"]\nca_password = os.environ[\"CA_PASSWORD\"]\n```\n\nInstall python-dotenv 安裝 python-dotenv：\n\n```bash\nuv add python-dotenv\n```\n\n---\n\n## Simulation Mode 模擬環境\n\nTest your setup in simulation mode before live trading:\n在正式交易前，先在模擬環境測試：\n\n```python\nimport shioaji as sj\n\n# Enable simulation mode 啟用模擬模式\napi = sj.Shioaji(simulation=True)\n\n# Login 登入\napi.login(\n    api_key=os.environ[\"API_KEY\"],\n    secret_key=os.environ[\"SECRET_KEY\"],\n)\n\n# Activate CA 啟用憑證\napi.activate_ca(\n    ca_path=os.environ[\"CA_CERT_PATH\"],\n    ca_passwd=os.environ[\"CA_PASSWORD\"],\n)\n\nprint(\"Login successful! 登入成功！\")\n```\n\n### Available APIs in Simulation 模擬環境可用 API\n\n**Data 資料:**\n- `quote.subscribe` / `quote.unsubscribe`\n- `ticks`, `kbars`, `snapshots`\n- `short_stock_sources`, `credit_enquires`, `scanners`\n\n**Order 委託:**\n- `place_order`, `update_order`, `cancel_order`\n- `update_status`, `list_trades`\n\n**Account 帳務:**\n- `list_positions`, `list_profit_loss`\n\n---\n\n## Testing Project 測試專案\n\n### Demo Project 範例專案\n\nClone the official demo project:\n複製官方範例專案：\n\n```bash\ngit clone https://github.com/Sinotrade/sj-trading-demo.git\ncd sj-trading-demo\n```\n\n### Stock Order Testing 股票下單測試\n\n```python\nimport shioaji as sj\nfrom shioaji.constant import Action, StockPriceType, OrderType\nimport os\n\ndef testing_stock_ordering():\n    # Login to simulation 登入模擬環境\n    api = sj.Shioaji(simulation=True)\n    api.login(\n        api_key=os.environ[\"API_KEY\"],\n        secret_key=os.environ[\"SECRET_KEY\"],\n    )\n    api.activate_ca(\n        ca_path=os.environ[\"CA_CERT_PATH\"],\n        ca_passwd=os.environ[\"CA_PASSWORD\"],\n    )\n\n    # Get contract 取得合約\n    contract = api.Contracts.Stocks[\"2890\"]\n    print(f\"Contract: {contract}\")\n\n    # Create order 建立訂單\n    order = sj.order.StockOrder(\n        action=Action.Buy,\n        price=contract.reference,  # Reference price 參考價\n        quantity=1,\n        price_type=StockPriceType.LMT,\n        order_type=OrderType.ROD,\n        account=api.stock_account,\n    )\n\n    # Place order 下單\n    trade = api.place_order(contract=contract, order=order)\n    print(f\"Trade: {trade}\")\n\n    # Update status 更新狀態\n    api.update_status()\n    print(f\"Status: {trade.status}\")\n```\n\n### Futures Order Testing 期貨下單測試\n\n```python\nfrom shioaji.constant import FuturesPriceType, FuturesOCType\n\ndef testing_futures_ordering():\n    api = sj.Shioaji(simulation=True)\n    api.login(\n        api_key=os.environ[\"API_KEY\"],\n        secret_key=os.environ[\"SECRET_KEY\"],\n    )\n    api.activate_ca(\n        ca_path=os.environ[\"CA_CERT_PATH\"],\n        ca_passwd=os.environ[\"CA_PASSWORD\"],\n    )\n\n    # Get futures contract 取得期貨合約\n    contract = api.Contracts.Futures[\"TXFR1\"]  # Near month 近月\n    print(f\"Contract: {contract}\")\n\n    # Create futures order 建立期貨訂單\n    order = sj.order.FuturesOrder(\n        action=Action.Buy,\n        price=contract.reference,\n        quantity=1,\n        price_type=FuturesPriceType.LMT,\n        order_type=OrderType.ROD,\n        octype=FuturesOCType.Auto,\n        account=api.futopt_account,\n    )\n\n    # Place order 下單\n    trade = api.place_order(contract=contract, order=order)\n    print(f\"Trade: {trade}\")\n\n    api.update_status()\n    print(f\"Status: {trade.status}\")\n```\n\n### Run with uv 使用 uv 執行\n\n```bash\n# Add test commands to pyproject.toml\n# 將測試命令加入 pyproject.toml\n\n[project.scripts]\nstock_testing = \"sj_trading.testing_flow:testing_stock_ordering\"\nfutures_testing = \"sj_trading.testing_flow:testing_futures_ordering\"\n\n# Run tests 執行測試\nuv run stock_testing\nuv run futures_testing\n```\n\n---\n\n## Production Environment 正式環境\n\nAfter testing, switch to production:\n測試完成後，切換到正式環境：\n\n```python\n# Remove simulation=True for production\n# 正式環境移除 simulation=True\napi = sj.Shioaji()  # Production mode 正式模式\n\napi.login(\n    api_key=os.environ[\"API_KEY\"],\n    secret_key=os.environ[\"SECRET_KEY\"],\n)\n```\n\n---\n\n## Checklist 檢查清單\n\nBefore going live 上線前確認：\n\n- [ ] Account opened 帳戶已開立\n- [ ] API Key created 已建立 API Key\n- [ ] Certificate downloaded 已下載憑證\n- [ ] Terms signed 已簽署條款\n- [ ] Simulation tested 已完成模擬測試\n- [ ] IP whitelist configured 已設定 IP 白名單\n\n---\n\n## Reference 參考資料\n\n- Account opening 開戶: https://sinotrade.github.io/tutor/prepare/open_account\n- API Key 金鑰: https://sinotrade.github.io/tutor/prepare/token\n- Terms 條款: https://sinotrade.github.io/tutor/prepare/terms\n- Demo project 範例專案: https://github.com/Sinotrade/sj-trading-demo\n",
        "skills/shioaji/RESERVE.md": "# Reserve Orders 預收券款\n\nFor stocks under disposition (處置股), attention (注意股), or warning (警示股), you must reserve shares before trading.\n處置股、注意股或警示股在交易前須預收券款。\n\nService hours: 8:00 - 14:30 on trading days.\n服務時間：交易日 8:00 至 14:30。\n\n---\n\n## Query Reserve Summary 查詢預收券款狀態\n\n```python\nimport shioaji as sj\n\napi = sj.Shioaji()\napi.login(api_key=\"YOUR_KEY\", secret_key=\"YOUR_SECRET\")\n\n# Get reserve summary 取得預收券款摘要\nreserve_summary = api.stock_reserve_summary(api.stock_account)\n\nfor stock in reserve_summary.response.stocks:\n    print(f\"Code: {stock.contract.code}\")\n    print(f\"Available: {stock.available_share}\")\n    print(f\"Reserved: {stock.reserved_share}\")\n```\n\n### ReserveStockSummary Attributes 預收摘要屬性\n\n```python\nstock.contract         # Contract: Stock contract 股票合約\nstock.available_share  # int: Available shares 可預收股數\nstock.reserved_share   # int: Already reserved 已預收股數\n```\n\n---\n\n## Reserve Stock 預收股票\n\n```python\ncontract = api.Contracts.Stocks[\"2890\"]\n\n# Reserve 1000 shares 預收 1000 股\nresp = api.reserve_stock(api.stock_account, contract, 1000)\n\nprint(f\"Status: {resp.response.status}\")\nprint(f\"Share: {resp.response.share}\")\n```\n\n### ReserveOrderResp Attributes 預收回應屬性\n\n```python\nresp.response.contract  # Stock: Stock contract 股票合約\nresp.response.account   # Account: Stock account 股票帳戶\nresp.response.share     # int: Reserved shares 預收股數\nresp.response.status    # bool: Success status 是否成功\nresp.response.info      # str: Info message 資訊訊息\n```\n\n---\n\n## Query Reserve Detail 查詢預收明細\n\n```python\ndetail = api.stock_reserve_detail(api.stock_account)\n\nfor stock in detail.response.stocks:\n    print(f\"Code: {stock.contract.code}\")\n    print(f\"Share: {stock.share}\")\n    print(f\"Status: {stock.status}\")\n    print(f\"Info: {stock.info}\")\n```\n\n### ReserveStockDetail Attributes 預收明細屬性\n\n```python\nstock.contract   # Contract: Stock contract 股票合約\nstock.share      # int: Reserved shares 預收股數\nstock.order_ts   # int: Order timestamp 委託時間戳\nstock.status     # bool: Status 狀態\nstock.info       # str: Info (e.g., \"已完成\") 資訊\n```\n\n---\n\n## Reserve Earmarking 預收款項\n\nFor pre-payment of cash when buying disposition stocks:\n買進處置股時的現金預收款項：\n\n```python\ncontract = api.Contracts.Stocks[\"2890\"]\n\n# Reserve with price 預收並指定價格\nresp = api.reserve_earmarking(api.stock_account, contract, 1000, 15.15)\n\nprint(f\"Amount: {resp.response.amount}\")\nprint(f\"Status: {resp.response.status}\")\n```\n\n### EarmarkingOrderResp Attributes 預收款項回應屬性\n\n```python\nresp.response.contract  # Stock: Stock contract 股票合約\nresp.response.account   # Account: Stock account 股票帳戶\nresp.response.share     # int: Shares 股數\nresp.response.price     # float: Price 價格\nresp.response.amount    # int: Total amount 總金額\nresp.response.status    # bool: Success status 是否成功\nresp.response.info      # str: Info message 資訊訊息\n```\n\n---\n\n## Query Earmarking Detail 查詢預收款項明細\n\n```python\ndetail = api.earmarking_detail(api.stock_account)\n\nfor stock in detail.response.stocks:\n    print(f\"Code: {stock.contract.code}\")\n    print(f\"Share: {stock.share}\")\n    print(f\"Price: {stock.price}\")\n    print(f\"Amount: {stock.amount}\")\n    print(f\"Status: {stock.status}\")\n```\n\n### EarmarkStockDetail Attributes 預收款項明細屬性\n\n```python\nstock.contract   # Contract: Stock contract 股票合約\nstock.share      # int: Shares 股數\nstock.price      # float: Price 價格\nstock.amount     # int: Total amount 總金額\nstock.order_ts   # int: Order timestamp 委託時間戳\nstock.status     # bool: Status 狀態\nstock.info       # str: Info (e.g., \"扣款失敗\") 資訊\n```\n\n---\n\n## Reserve All Available 全部預收\n\n```python\n# Reserve all available shares 預收所有可用股票\nreserve_summary = api.stock_reserve_summary(api.stock_account)\n\nfor stock in reserve_summary.response.stocks:\n    if stock.available_share > 0:\n        resp = api.reserve_stock(\n            api.stock_account,\n            stock.contract,\n            stock.available_share\n        )\n        print(f\"Reserved {stock.contract.code}: {resp.response.status}\")\n```\n\n---\n\n## Reference 參考資料\n\n- Official docs 官方文檔: https://sinotrade.github.io/tutor/order/Reserve/\n",
        "skills/shioaji/SKILL.md": "---\nname: shioaji\ndescription: |\n  Shioaji Taiwan financial trading API guide. Use when trading stocks/futures/options on Taiwan markets, subscribing to real-time market data, querying account info, or building automated trading systems.\n  Shioaji 台灣金融交易 API 指南。適用於：股票/期貨/選擇權交易、即時行情訂閱、帳務查詢、自動交易系統開發。\n---\n\n# Shioaji Trading API\n\nShioaji is SinoPac's Python API for trading Taiwan financial markets (stocks, futures, options).\nShioaji 是永豐金證券提供的 Python 交易 API，支援台灣股票、期貨、選擇權市場。\n\n**Official Docs 官方文檔**: https://sinotrade.github.io/\n**LLM Reference**: https://sinotrade.github.io/llms-full.txt\n\n---\n\n## Navigation 功能導覽\n\n| Topic 主題 | File 檔案 | Description 說明 |\n|------------|-----------|------------------|\n| Preparation 準備 | [PREPARE.md](PREPARE.md) | Account setup, API keys, testing 開戶/金鑰申請/測試 |\n| Contracts 合約 | [CONTRACTS.md](CONTRACTS.md) | Stocks, Futures, Options contracts 股票/期貨/選擇權合約 |\n| Orders 下單 | [ORDERS.md](ORDERS.md) | Place, modify, cancel, combo orders 下單/改單/刪單/組合單 |\n| Reserve 預收 | [RESERVE.md](RESERVE.md) | Reserve orders for disposition stocks 處置股預收券款 |\n| Streaming 行情 | [STREAMING.md](STREAMING.md) | Real-time tick & bidask data 即時 Tick/BidAsk 資料 |\n| Market Data 市場資料 | [MARKET_DATA.md](MARKET_DATA.md) | Historical, snapshot, credit, scanners 歷史資料/快照/資券/掃描器 |\n| Accounting 帳務 | [ACCOUNTING.md](ACCOUNTING.md) | Balance, margin, P&L, trading limits 餘額/保證金/損益/額度 |\n| Advanced 進階 | [ADVANCED.md](ADVANCED.md) | Quote binding, non-blocking, stop orders 報價綁定/非阻塞/觸價 |\n| Troubleshooting 問題排解 | [TROUBLESHOOTING.md](TROUBLESHOOTING.md) | Common issues and solutions 常見問題與解決 |\n\n---\n\n## Quick Start 快速入門\n\n### Installation 安裝\n\n```bash\n# pip\npip install shioaji\n\n# uv (recommended 推薦)\nuv add shioaji\n\n# with speed optimization 速度優化版\nuv add shioaji --extra speed\n\n# Docker\ndocker run -it sinotrade/shioaji:latest\n```\n\n### Login & Activate CA 登入與憑證啟用\n\n```python\nimport shioaji as sj\n\napi = sj.Shioaji()\n\n# Login with API Key 使用 API Key 登入\naccounts = api.login(\n    api_key=\"YOUR_API_KEY\",\n    secret_key=\"YOUR_SECRET_KEY\"\n)\n\n# Activate CA certificate 啟用憑證 (required for placing orders 下單必須)\napi.activate_ca(\n    ca_path=\"/path/to/Sinopac.pfx\",\n    ca_passwd=\"YOUR_CA_PASSWORD\",\n)\n```\n\n### Simulation Mode 模擬模式\n\nTest API without real money. 使用模擬環境測試 API。\n\n```python\nimport shioaji as sj\n\napi = sj.Shioaji(simulation=True)\napi.login(api_key=\"YOUR_KEY\", secret_key=\"YOUR_SECRET\")\n```\n\n**Available in simulation 模擬模式可用功能:**\n- Quote: subscribe, unsubscribe, ticks, kbars, snapshots\n- Order: place_order, update_order, cancel_order, update_status, list_trades\n- Account: list_positions, list_profit_loss\n- Data: short_stock_sources, credit_enquires, scanners\n\n### Simple Order Example 簡單下單範例\n\n```python\n# Get contract 取得合約\ncontract = api.Contracts.Stocks[\"2330\"]  # TSMC 台積電\n\n# Create order 建立訂單\norder = api.Order(\n    price=580,\n    quantity=1,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    account=api.stock_account,\n)\n\n# Place order 下單\ntrade = api.place_order(contract, order)\n```\n\n---\n\n## Common Constants 常用常數\n\n### Action 買賣方向\n```python\nsj.constant.Action.Buy   # 買進\nsj.constant.Action.Sell  # 賣出\n```\n\n### Stock Price Type 股票價格類型\n```python\nsj.constant.StockPriceType.LMT  # Limit 限價\nsj.constant.StockPriceType.MKT  # Market 市價\nsj.constant.StockPriceType.MKP  # Range Market 範圍市價\n```\n\n### Futures Price Type 期貨價格類型\n```python\nsj.constant.FuturesPriceType.LMT  # Limit 限價\nsj.constant.FuturesPriceType.MKT  # Market 市價\nsj.constant.FuturesPriceType.MKP  # Range Market 範圍市價\n```\n\n### Order Type 委託條件\n```python\nsj.constant.OrderType.ROD  # Rest of Day 當日有效\nsj.constant.OrderType.IOC  # Immediate or Cancel 立即成交否則取消\nsj.constant.OrderType.FOK  # Fill or Kill 全部成交否則取消\n```\n\n### Stock Order Lot 股票交易單位\n```python\nsj.constant.StockOrderLot.Common      # Regular 整股 (1000 shares)\nsj.constant.StockOrderLot.Odd         # After-hours odd lot 盤後零股\nsj.constant.StockOrderLot.IntradayOdd # Intraday odd lot 盤中零股\nsj.constant.StockOrderLot.Fixing      # Fixing 定盤\n```\n\n### Order Condition 信用交易條件\n```python\nsj.constant.StockOrderCond.Cash          # Cash 現股\nsj.constant.StockOrderCond.MarginTrading # Margin 融資\nsj.constant.StockOrderCond.ShortSelling  # Short 融券\n```\n\n### Quote Type 報價類型\n```python\nsj.constant.QuoteType.Tick    # Tick data 逐筆成交\nsj.constant.QuoteType.BidAsk  # Bid/Ask data 五檔報價\n```\n\n---\n\n## Account Objects 帳戶物件\n\n```python\n# Stock account 股票帳戶\napi.stock_account\n\n# Futures account 期貨帳戶\napi.futopt_account\n\n# List all accounts 列出所有帳戶\napi.list_accounts()\n```\n\n---\n\n## Rate Limits 流量限制\n\n| Category 類別 | Limit 限制 |\n|---------------|------------|\n| Daily Traffic 每日流量 | 500MB - 10GB (based on trading volume 依交易量) |\n| Quote Query 行情查詢 | 50 requests / 5 sec |\n| Accounting Query 帳務查詢 | 25 requests / 5 sec |\n| Connections 連線數 | 5 per person ID |\n| Daily Logins 每日登入 | 1000 times |\n\n---\n\n## Common Patterns 常用模式\n\n### Subscribe Market Data 訂閱行情\n\n```python\n# Subscribe tick data 訂閱逐筆成交\napi.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"],\n    quote_type=sj.constant.QuoteType.Tick\n)\n\n# Subscribe bidask 訂閱五檔\napi.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"],\n    quote_type=sj.constant.QuoteType.BidAsk\n)\n\n# Set callback 設定回調\n@api.quote.on_quote\ndef quote_callback(topic, quote):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n```\n\n### Query Positions 查詢持倉\n\n```python\n# Stock positions 股票持倉\npositions = api.list_positions(api.stock_account)\n\n# Futures positions 期貨持倉\npositions = api.list_positions(api.futopt_account)\n```\n\n### Cancel Order 刪單\n\n```python\napi.cancel_order(trade)\n```\n\n### Update Order 改單\n\n```python\n# Change price 改價\napi.update_order(trade=trade, price=590)\n\n# Reduce quantity 減量 (can only reduce 只能減少)\napi.update_order(trade=trade, qty=1)\n```\n\n---\n\n## Error Handling 錯誤處理\n\n```python\ntry:\n    trade = api.place_order(contract, order)\nexcept Exception as e:\n    print(f\"Order failed: {e}\")\n\n# Check order status 檢查訂單狀態\napi.update_status(api.stock_account)\nfor trade in api.list_trades():\n    print(trade.status)\n```\n\n---\n\n## Logout 登出\n\n```python\napi.logout()\n```\n",
        "skills/shioaji/STREAMING.md": "# Streaming Market Data 即時行情\n\nThis document covers subscribing to real-time market data in Shioaji.\n本文件說明如何在 Shioaji 中訂閱即時行情資料。\n\n---\n\n## Overview 概覽\n\nShioaji provides real-time streaming data via `api.quote.subscribe()`.\nShioaji 透過 `api.quote.subscribe()` 提供即時串流資料。\n\n**Quote Types 報價類型:**\n- **Tick**: Trade-by-trade data 逐筆成交\n- **BidAsk**: Order book (5 levels) 五檔委託\n\n**Data Classes 資料類別:**\n\n```python\nfrom shioaji import (\n    Exchange,       # 交易所\n    TickSTKv1,      # Stock tick 股票逐筆\n    BidAskSTKv1,    # Stock bidask 股票五檔\n    TickFOPv1,      # Futures/Options tick 期貨選擇權逐筆\n    BidAskFOPv1,    # Futures/Options bidask 期貨選擇權五檔\n)\n```\n\n---\n\n## Subscribe 訂閱行情\n\n### Stock Tick 股票 Tick\n\n```python\nimport shioaji as sj\n\napi = sj.Shioaji()\napi.login(api_key=\"YOUR_KEY\", secret_key=\"YOUR_SECRET\")\n\n# Subscribe tick data 訂閱逐筆成交\napi.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"],\n    quote_type=sj.constant.QuoteType.Tick\n)\n```\n\n### Stock BidAsk 股票五檔\n\n```python\napi.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"],\n    quote_type=sj.constant.QuoteType.BidAsk\n)\n```\n\n### Futures Tick 期貨 Tick\n\n```python\napi.quote.subscribe(\n    api.Contracts.Futures[\"TXFC0\"],\n    quote_type=sj.constant.QuoteType.Tick\n)\n```\n\n### Futures BidAsk 期貨五檔\n\n```python\napi.quote.subscribe(\n    api.Contracts.Futures[\"TXFC0\"],\n    quote_type=sj.constant.QuoteType.BidAsk\n)\n```\n\n### Intraday Odd Lot 盤中零股\n\n```python\napi.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"],\n    quote_type=sj.constant.QuoteType.Tick,\n    intraday_odd=True\n)\n```\n\n---\n\n## Callbacks 行情回調\n\n### Stock Tick Callback 股票 Tick 回調\n\n```python\nfrom shioaji import Exchange, TickSTKv1\n\n# Method 1: Decorator 裝飾器方式\n@api.on_tick_stk_v1()\ndef on_tick(exchange: Exchange, tick: TickSTKv1):\n    print(f\"Exchange: {exchange}, Code: {tick.code}, Close: {tick.close}\")\n\n# Method 2: Set callback 設定回調\napi.quote.set_on_tick_stk_v1_callback(on_tick)\n```\n\n### Stock BidAsk Callback 股票五檔回調\n\n```python\nfrom shioaji import Exchange, BidAskSTKv1\n\n@api.on_bidask_stk_v1()\ndef on_bidask(exchange: Exchange, bidask: BidAskSTKv1):\n    print(f\"Code: {bidask.code}, Bid: {bidask.bid_price[0]}, Ask: {bidask.ask_price[0]}\")\n\n# Or 或\napi.quote.set_on_bidask_stk_v1_callback(on_bidask)\n```\n\n### Futures/Options Tick Callback 期貨選擇權 Tick 回調\n\n```python\nfrom shioaji import Exchange, TickFOPv1\n\n@api.on_tick_fop_v1()\ndef on_tick(exchange: Exchange, tick: TickFOPv1):\n    print(f\"Code: {tick.code}, Close: {tick.close}\")\n\n# Or 或\napi.quote.set_on_tick_fop_v1_callback(on_tick)\n```\n\n### Futures/Options BidAsk Callback 期貨選擇權五檔回調\n\n```python\nfrom shioaji import Exchange, BidAskFOPv1\n\n@api.on_bidask_fop_v1()\ndef on_bidask(exchange: Exchange, bidask: BidAskFOPv1):\n    print(f\"Code: {bidask.code}, Bid: {bidask.bid_price[0]}\")\n\n# Or 或\napi.quote.set_on_bidask_fop_v1_callback(on_bidask)\n```\n\n---\n\n## TickSTKv1 Attributes 股票 Tick 屬性\n\n```python\nfrom shioaji import Exchange, TickSTKv1\nfrom datetime import datetime\nfrom decimal import Decimal\n\n@api.on_tick_stk_v1()\ndef on_tick(exchange: Exchange, tick: TickSTKv1):\n    # Basic info 基本資訊\n    tick.code              # str: Stock code 股票代碼\n    tick.datetime          # datetime: Timestamp 時間戳\n\n    # Price data 價格資料\n    tick.open              # Decimal: Open price 開盤價\n    tick.high              # Decimal: High price 最高價\n    tick.low               # Decimal: Low price 最低價\n    tick.close             # Decimal: Last price 最新價\n    tick.avg_price         # Decimal: Average price 均價\n\n    # Volume data 量能資料\n    tick.volume            # int: Tick volume 單筆成交量\n    tick.total_volume      # int: Total volume 總成交量\n    tick.amount            # Decimal: Tick amount 單筆成交金額\n    tick.total_amount      # Decimal: Total amount 總成交金額\n\n    # Tick type 成交類型\n    tick.tick_type         # int: 1=Buy, 2=Sell, 0=Unknown\n\n    # Change data 漲跌資料\n    tick.chg_type          # int: Change type 漲跌類型\n    tick.price_chg         # Decimal: Price change 漲跌\n    tick.pct_chg           # Decimal: Percent change % 漲跌幅\n\n    # Aggregated 彙總資料\n    tick.bid_side_total_vol  # int: Total bid volume 買方總量\n    tick.ask_side_total_vol  # int: Total ask volume 賣方總量\n    tick.bid_side_total_cnt  # int: Total bid count 買方筆數\n    tick.ask_side_total_cnt  # int: Total ask count 賣方筆數\n```\n\n---\n\n## BidAskSTKv1 Attributes 股票五檔屬性\n\n```python\nfrom shioaji import Exchange, BidAskSTKv1\nfrom typing import List\nfrom decimal import Decimal\n\n@api.on_bidask_stk_v1()\ndef on_bidask(exchange: Exchange, bidask: BidAskSTKv1):\n    bidask.code            # str: Stock code 股票代碼\n    bidask.datetime        # datetime: Timestamp 時間戳\n\n    # 5 levels of bid/ask 五檔買賣價量\n    bidask.bid_price       # List[Decimal]: [買1, 買2, 買3, 買4, 買5]\n    bidask.bid_volume      # List[int]: [買量1, 買量2, ...]\n    bidask.ask_price       # List[Decimal]: [賣1, 賣2, 賣3, 賣4, 賣5]\n    bidask.ask_volume      # List[int]: [賣量1, 賣量2, ...]\n\n    # Volume change 量變化\n    bidask.diff_bid_vol    # List[int]: Bid volume changes 買量變化\n    bidask.diff_ask_vol    # List[int]: Ask volume changes 賣量變化\n\n    # Example: Spread 範例：價差\n    spread = bidask.ask_price[0] - bidask.bid_price[0]\n```\n\n---\n\n## TickFOPv1 Attributes 期貨選擇權 Tick 屬性\n\n```python\nfrom shioaji import Exchange, TickFOPv1\n\n@api.on_tick_fop_v1()\ndef on_tick(exchange: Exchange, tick: TickFOPv1):\n    tick.code              # str: Contract code 合約代碼\n    tick.datetime          # datetime: Timestamp 時間戳\n    tick.open              # Decimal: Open price 開盤價\n    tick.high              # Decimal: High price 最高價\n    tick.low               # Decimal: Low price 最低價\n    tick.close             # Decimal: Last price 最新價\n    tick.volume            # int: Tick volume 單筆量\n    tick.total_volume      # int: Total volume 總量\n    tick.underlying_price  # Decimal: Underlying price 標的價格\n    tick.bid_side_total_vol # int: Buy side total volume 買方總量\n    tick.ask_side_total_vol # int: Sell side total volume 賣方總量\n```\n\n---\n\n## BidAskFOPv1 Attributes 期貨選擇權五檔屬性\n\n```python\nfrom shioaji import Exchange, BidAskFOPv1\n\n@api.on_bidask_fop_v1()\ndef on_bidask(exchange: Exchange, bidask: BidAskFOPv1):\n    bidask.code            # str: Contract code 合約代碼\n    bidask.datetime        # datetime: Timestamp 時間戳\n    bidask.bid_price       # List[Decimal]: Bid prices (5 levels)\n    bidask.bid_volume      # List[int]: Bid volumes (5 levels)\n    bidask.ask_price       # List[Decimal]: Ask prices (5 levels)\n    bidask.ask_volume      # List[int]: Ask volumes (5 levels)\n```\n\n---\n\n## Unsubscribe 取消訂閱\n\n```python\napi.quote.unsubscribe(\n    api.Contracts.Stocks[\"2330\"],\n    quote_type=sj.constant.QuoteType.Tick\n)\n\napi.quote.unsubscribe(\n    api.Contracts.Stocks[\"2330\"],\n    quote_type=sj.constant.QuoteType.BidAsk\n)\n```\n\n---\n\n## Event Callbacks 事件回調\n\n```python\n@api.quote.on_event\ndef event_callback(resp_code: int, event_code: int, info: str, event: str):\n    print(f\"Event Code: {event_code}, Info: {info}\")\n```\n\n| Event Code | Description 說明 |\n|------------|------------------|\n| 0 | Heartbeat 心跳 |\n| 1 | Connected 連線建立 |\n| 2 | Disconnected 斷線 |\n| 3 | Reconnecting 重新連線中 |\n| 4 | Reconnected 重新連線成功 |\n| 16 | Subscribe success 訂閱成功 |\n| 17 | Unsubscribe success 取消訂閱成功 |\n\n---\n\n## Quote Manager with Polars 使用 Polars 的行情管理器\n\nRecommended pattern using Polars for high-performance data processing:\n推薦使用 Polars 進行高效能資料處理：\n\n```python\nimport polars as pl\nfrom shioaji import Exchange, TickSTKv1\nfrom typing import List\n\nclass QuoteManager:\n    def __init__(self):\n        self.ticks: List[dict] = []\n\n    def on_tick(self, exchange: Exchange, tick: TickSTKv1):\n        self.ticks.append({\n            \"code\": tick.code,\n            \"datetime\": tick.datetime,\n            \"price\": float(tick.close),\n            \"volume\": tick.volume,\n            \"total_volume\": tick.total_volume,\n            \"tick_type\": tick.tick_type,\n        })\n\n    def get_df(self) -> pl.DataFrame:\n        return pl.DataFrame(self.ticks)\n\n    def get_kbar(self, unit: str = \"1m\") -> pl.DataFrame:\n        \"\"\"Generate K-bar from ticks 從 tick 產生 K 棒\"\"\"\n        df = self.get_df()\n        return df.group_by(\n            pl.col(\"datetime\").dt.truncate(unit),\n            pl.col(\"code\"),\n        ).agg(\n            pl.col(\"price\").first().alias(\"open\"),\n            pl.col(\"price\").max().alias(\"high\"),\n            pl.col(\"price\").min().alias(\"low\"),\n            pl.col(\"price\").last().alias(\"close\"),\n            pl.col(\"volume\").sum().alias(\"volume\"),\n        )\n\n# Usage 使用方式\nmanager = QuoteManager()\n\n@api.on_tick_stk_v1()\ndef on_tick(exchange: Exchange, tick: TickSTKv1):\n    manager.on_tick(exchange, tick)\n\n# Get 1-minute K-bars 取得 1 分鐘 K 棒\nkbars = manager.get_kbar(\"1m\")\n```\n\n### Technical Indicators with Polars 使用 Polars 計算技術指標\n\nUse `over(\"code\")` to calculate indicators separately for each stock:\n使用 `over(\"code\")` 讓每檔商品分開計算指標：\n\n```python\ndef add_indicators(df: pl.DataFrame, exprs: List[pl.Expr] = []) -> pl.DataFrame:\n    \"\"\"Add technical indicators 加入技術指標\"\"\"\n    base_exprs = [\n        # SMA 簡單移動平均 (per stock 每檔分開計算)\n        pl.col(\"close\").rolling_mean(window_size=5).over(\"code\").alias(\"sma5\"),\n        pl.col(\"close\").rolling_mean(window_size=20).over(\"code\").alias(\"sma20\"),\n\n        # EMA 指數移動平均 (per stock 每檔分開計算)\n        pl.col(\"close\").ewm_mean(span=12).over(\"code\").alias(\"ema12\"),\n        pl.col(\"close\").ewm_mean(span=26).over(\"code\").alias(\"ema26\"),\n    ]\n    return df.with_columns(base_exprs + exprs)\n\n# MACD (per stock 每檔分開計算)\ndef macd(df: pl.DataFrame) -> pl.DataFrame:\n    return df.with_columns([\n        (pl.col(\"ema12\") - pl.col(\"ema26\")).alias(\"macd\"),\n        (pl.col(\"ema12\") - pl.col(\"ema26\")).ewm_mean(span=9).over(\"code\").alias(\"signal\"),\n    ])\n```\n\n---\n\n## Multiple Subscriptions 多重訂閱\n\n```python\ncontracts = [\n    api.Contracts.Stocks[\"2330\"],\n    api.Contracts.Stocks[\"2317\"],\n    api.Contracts.Stocks[\"2454\"],\n]\n\nfor contract in contracts:\n    api.quote.subscribe(contract, quote_type=sj.constant.QuoteType.Tick)\n```\n\n---\n\n## Best Practices 最佳實踐\n\n### 1. Handle Disconnections 處理斷線\n\n```python\n@api.quote.on_event\ndef on_event(resp_code: int, event_code: int, info: str, event: str):\n    if event_code == 2:  # Disconnected\n        print(\"Disconnected...\")\n    elif event_code == 4:  # Reconnected\n        resubscribe_all()\n```\n\n### 2. Rate Limiting 速率限制\n\n```python\n# Limit: 50 requests / 5 seconds\n# 限制：50 次 / 5 秒\n\nimport time\n\nfor i, contract in enumerate(contracts):\n    api.quote.subscribe(contract, quote_type=sj.constant.QuoteType.Tick)\n    if (i + 1) % 50 == 0:\n        time.sleep(5)\n```\n\n### 3. Memory Management 記憶體管理\n\n```python\nfrom collections import deque\nfrom shioaji import Exchange, TickSTKv1\n\nclass QuoteBuffer:\n    def __init__(self, max_size: int = 10000):\n        self.buffer = deque(maxlen=max_size)\n\n    def add(self, exchange: Exchange, tick: TickSTKv1):\n        self.buffer.append({\n            \"code\": tick.code,\n            \"datetime\": tick.datetime,\n            \"price\": float(tick.close),\n            \"volume\": tick.volume,\n        })\n```\n\n---\n\n## Reference 參考資料\n\n- Demo project 範例專案: https://github.com/Sinotrade/sj-trading-demo\n- Official docs 官方文檔: https://sinotrade.github.io/tutor/market_data/streaming/\n",
        "skills/shioaji/TROUBLESHOOTING.md": "# Troubleshooting 常見問題\n\nCommon issues and solutions for Shioaji.\nShioaji 常見問題與解決方案。\n\n---\n\n## Orders 下單相關\n\n### How to place MKT/MKP orders 如何下市價單\n\nMarket orders (MKT/MKP) must use IOC or FOK, not ROD.\n市價單必須使用 IOC 或 FOK，不能用 ROD。\n\n```python\norder = api.Order(\n    action=sj.constant.Action.Buy,\n    price=0,  # MKT/MKP ignores price 市價單忽略價格\n    quantity=1,\n    price_type=sj.constant.FuturesPriceType.MKT,  # or MKP\n    order_type=sj.constant.OrderType.IOC,  # Must be IOC or FOK 必須是 IOC 或 FOK\n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n```\n\n### How to place limit up/down orders 如何掛漲跌停價\n\nGet limit prices from contract:\n從合約取得漲跌停價：\n\n```python\ncontract = api.Contracts.Stocks[\"2330\"]\n\n# Limit up 漲停價\nprice = contract.limit_up\n\n# Limit down 跌停價\nprice = contract.limit_down\n\norder = api.Order(\n    action=sj.constant.Action.Buy,\n    price=price,\n    quantity=1,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    account=api.stock_account\n)\n```\n\n---\n\n## Streaming 行情相關\n\n### Quote stream stops after few ticks 行情只收到幾筆就斷了\n\n**Problem 問題:** Script exits immediately after subscribing.\n訂閱後程式立即結束。\n\n**Solution 解決方案:** Keep the program running with `Event().wait()`:\n使用 `Event().wait()` 讓程式保持運行：\n\n```python\nimport shioaji as sj\nfrom threading import Event\n\napi = sj.Shioaji()\napi.login(api_key=\"YOUR_KEY\", secret_key=\"YOUR_SECRET\")\n\n@api.on_tick_stk_v1()\ndef on_tick(exchange, tick):\n    print(tick)\n\napi.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"],\n    quote_type=sj.constant.QuoteType.Tick\n)\n\n# Keep program alive 保持程式運行\nEvent().wait()\n```\n\n---\n\n## Account 帳戶相關\n\n### Account not acceptable 帳戶無法使用\n\n**Possible causes 可能原因:**\n\n1. **Terms not signed 未簽署條款**\n   - Complete terms signing at Sinopac website\n   - 在永豐金網站完成條款簽署\n\n2. **API test not completed API測試未完成**\n   - Complete API testing flow\n   - 完成 API 測試流程\n\n3. **Using update_status without all accounts signed 使用 update_status 但並非所有帳戶都已簽署**\n   - `update_status()` queries all accounts by default\n   - Specify account: `api.update_status(api.stock_account)`\n   - `update_status()` 預設查詢所有帳號，請指定帳號\n\n---\n\n## Environment 環境設定\n\n### Change log file path 更改 log 檔案路徑\n\nSet environment variable before importing shioaji:\n在 import shioaji 之前設定環境變數：\n\n```python\nimport os\nos.environ[\"SJ_LOG_PATH\"] = \"/path/to/shioaji.log\"\n\nimport shioaji as sj  # Import after setting env\n```\n\nOr in shell:\n或在 shell 中：\n\n```bash\n# Linux/macOS\nexport SJ_LOG_PATH=/path/to/shioaji.log\n\n# Windows\nset SJ_LOG_PATH=C:\\path\\to\\shioaji.log\n```\n\n### Change contracts download path 更改合約下載路徑\n\n```python\nimport os\nos.environ[\"SJ_CONTRACTS_PATH\"] = \"/path/to/contracts\"\n\nimport shioaji as sj\n```\n\n---\n\n## Connection 連線相關\n\n### Rate limit exceeded 超過流量限制\n\n**Limits 限制:**\n\n| Category 類別 | Limit 限制 |\n|---------------|------------|\n| Quote query 行情查詢 | 50 / 5 sec |\n| Accounting 帳務 | 25 / 5 sec |\n| Orders 委託 | 250 / 10 sec |\n| Connections 連線 | 5 per person |\n| Daily logins 每日登入 | 1000 times |\n\n**Solution 解決方案:**\n- Use callbacks instead of polling 使用回調代替輪詢\n- Add delays between requests 請求間加入延遲\n- Cache results when possible 盡可能快取結果\n\n### Connection lost 連線中斷\n\nUse event callback to monitor connection:\n使用事件回調監控連線：\n\n```python\n@api.quote.on_event\ndef event_callback(resp_code: int, event_code: int, info: str, event: str):\n    print(f\"Event: {event_code} - {event}\")\n\n    # Reconnecting\n    if event_code == 12:\n        print(\"Reconnecting...\")\n    # Reconnected\n    elif event_code == 13:\n        print(\"Reconnected!\")\n```\n\n---\n\n## Reference 參考資料\n\n- QA Forum 問答論壇: https://sjapi.tw/\n- Official docs 官方文檔: https://sinotrade.github.io/qa/\n"
      },
      "plugins": [
        {
          "name": "shioaji",
          "source": "./",
          "description": "Shioaji Taiwan financial trading API guide for stocks, futures, and options trading",
          "version": "1.3.2",
          "author": {
            "name": "Sinotrade"
          },
          "categories": [],
          "install_commands": [
            "/plugin marketplace add Sinotrade/Shioaji",
            "/plugin install shioaji@sinotrade-plugins"
          ]
        }
      ]
    }
  ]
}