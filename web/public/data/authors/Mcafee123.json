{
  "author": {
    "id": "Mcafee123",
    "display_name": "Martin Affolter",
    "avatar_url": "https://avatars.githubusercontent.com/u/2026949?u=92cfe99c589df20f4ddacde105d70fcdbee99e0c&v=4"
  },
  "marketplaces": [
    {
      "name": "affolternet-web",
      "version": null,
      "description": "Claude Code plugins for affolterNET.Web authentication and authorization libraries",
      "repo_full_name": "Mcafee123/affolterNET.Web",
      "repo_url": "https://github.com/Mcafee123/affolterNET.Web",
      "repo_description": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2026-01-10T15:45:29Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"affolternet-web\",\n  \"owner\": {\n    \"name\": \"affolterNET\",\n    \"email\": \"info@affolternet.ch\"\n  },\n  \"metadata\": {\n    \"description\": \"Claude Code plugins for affolterNET.Web authentication and authorization libraries\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"affolternet-web-api\",\n      \"source\": \"./plugins/affolternet-web-api\",\n      \"description\": \"API authentication with JWT Bearer tokens and Keycloak integration\",\n      \"version\": \"1.0.0\"\n    },\n    {\n      \"name\": \"affolternet-web-bff\",\n      \"source\": \"./plugins/affolternet-web-bff\",\n      \"description\": \"BFF authentication with cookie-based OIDC, YARP reverse proxy, and SPA integration\",\n      \"version\": \"1.0.0\"\n    }\n  ]\n}\n",
        "README.md": "# affolterNET.Web - Authentication & Authorization Libraries\n\n[![Build and Publish NuGet Packages](https://github.com/Mcafee123/affolterNET.Web/actions/workflows/nuget-packages.yml/badge.svg)](https://github.com/Mcafee123/affolterNET.Web/actions/workflows/nuget-packages.yml)\n\nThis library collection provides flexible authentication and authorization modes for ASP.NET Core applications with YARP reverse proxy integration.\n\n## NuGet Packages\n\n| Package | NuGet | Description |\n|---------|-------|-------------|\n| **affolterNET.Web.Core** | [![NuGet](https://img.shields.io/nuget/v/affolterNET.Web.Core.svg)](https://www.nuget.org/packages/affolterNET.Web.Core/) | Core authentication and authorization components |\n| **affolterNET.Web.Api** | [![NuGet](https://img.shields.io/nuget/v/affolterNET.Web.Api.svg)](https://www.nuget.org/packages/affolterNET.Web.Api/) | API authentication components |\n| **affolterNET.Web.Bff** | [![NuGet](https://img.shields.io/nuget/v/affolterNET.Web.Bff.svg)](https://www.nuget.org/packages/affolterNET.Web.Bff/) | BFF authentication with YARP reverse proxy integration |\n\n### Installation\n\n```bash\n# Core package (required)\ndotnet add package affolterNET.Web.Core\n\n# For API authentication\ndotnet add package affolterNET.Web.Api\n\n# For BFF (Backend-for-Frontend) with YARP\ndotnet add package affolterNET.Web.Bff\n```\n\n## Claude Code Integration\n\nThis library includes Claude Code plugins for AI-assisted configuration. The plugins provide contextual guidance for service registration, authentication setup, YARP configuration, and more.\n\n### Plugin Installation\n\n```bash\n# Add the marketplace\n/plugin marketplace add https://github.com/Mcafee123/affolterNET.Web\n\n# Install for BFF applications\n/plugin install affolternet-web-bff@affolterNET.Web\n\n# Install for API applications\n/plugin install affolternet-web-api@affolterNET.Web\n```\n\n### Available Skills\n\n**BFF Plugin:**\n- `bff-setup` - Service registration and middleware pipeline\n- `keycloak-auth` - Cookie-based OIDC authentication\n- `yarp-proxy` - YARP reverse proxy configuration\n- `spa-integration` - SPA fallback and 401 handling\n- `rpt-permissions` - Permission-based authorization\n- `security` - Headers, CORS, and antiforgery\n- `swagger` - OpenAPI documentation\n- `customization` - Middleware extension hooks\n\n**API Plugin:**\n- `api-setup` - Service registration and middleware\n- `jwt-auth` - JWT Bearer authentication\n- `security` - Headers and CORS\n- `swagger` - OpenAPI documentation\n- `health-checks` - Health check endpoints\n\n## Development\n\n### Building Packages Locally\n\nUse the provided script to build and test packages locally:\n\n```bash\n# Build, test, and pack version 1.0.0\n./manage-packages.sh 1.0.0\n\n# Only build\n./manage-packages.sh 1.0.0 build\n\n# Only pack packages\n./manage-packages.sh 1.0.0 pack\n\n# Publish to local NuGet source for testing\n./manage-packages.sh 1.0.0 publish-local\n```\n\n### CI/CD Pipeline\n\nThe repository includes GitHub Actions workflows for:\n\n- **Continuous Integration**: Build and test on every push/PR\n- **Package Publishing**: Automatic NuGet publishing on releases\n- **Version Management**: Automatic versioning with preview builds\n\nTo publish to NuGet.org:\n1. Add `NUGET_API_KEY` to repository secrets\n2. Create a release with version tag (e.g., `v1.0.0`)\n3. Packages will be automatically published\n\nThis library provides flexible authentication and authorization modes for ASP.NET Core applications with YARP reverse proxy integration.\n\n## Authentication Modes\n\n```\n┌─────────────────────────────────────────────────────────────────────────────────┐\n│                               AUTHENTICATION MODES                              │\n└─────────────────────────────────────────────────────────────────────────────────┘\n\n┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────────────────┐\n│      NONE       │  │   AUTHENTICATE  │  │             AUTHORIZE               │\n│                 │  │     (LOGIN)     │  │                                     │\n│ Anonymous       │  │ Login Required  │  │ Login + Permission Claims Required  │\n│ Access          │  │ No Permissions  │  │ Fine-grained Access Control         │\n└─────────────────┘  └─────────────────┘  └─────────────────────────────────────┘\n\n┌─────────────────────────────────────────────────────────────────────────────────┐\n│                            ALWAYS ENABLED SERVICES                              │\n│                        (Security & Infrastructure)                              │\n├─────────────────────────────────────────────────────────────────────────────────┤\n│ ✅ SecurityHeadersMiddleware     │ CSP, HSTS, X-Frame-Options, etc.             │\n│ ✅ AntiforgeryTokenMiddleware    │ CSRF protection                              │\n│ ✅ HTTP Context Accessor         │ Core infrastructure                          │\n│ ✅ Memory Cache                  │ Performance & caching                        │\n│ ✅ YARP Reverse Proxy            │ Frontend/API proxying                        │\n└─────────────────────────────────────────────────────────────────────────────────┘\n\n┌─────────────────────────────────────────────────────────────────────────────────┐\n│                           MODE-SPECIFIC SERVICES                                │\n└─────────────────────────────────────────────────────────────────────────────────┘\n\nMODE: NONE                    MODE: AUTHENTICATE             MODE: AUTHORIZE\n├─────────────────────┐      ├─────────────────────────┐   ├──────────────────────────┐\n│ Services:           │      │ Services:               │   │ Services:                │\n│ • Basic Routing     │      │ • Cookie Authentication │   │ • Cookie Authentication  │\n│ • Static Files      │      │ • OIDC Integration      │   │ • OIDC Integration       │\n│                     │      │ • Token Refresh         │   │ • Token Refresh          │\n│ Middleware:         │      │ • Claims Enrichment     │   │ • Claims Enrichment      │\n│ • No Auth Pipeline  │      │ • Basic Authorization   │   │ • Permission Policies    │\n│                     │      │                         │   │ • RPT Token Service      │\n│ Use Cases:          │      │ Middleware:             │   │ • Keycloak Integration   │\n│ • Public websites   │      │ • UseAuthentication()   │   │                          │\n│ • Static content    │      │ • UseAuthorization()    │   │ Middleware:              │\n│ • Development       │      │ • RefreshTokenMware     │   │ • UseAuthentication()    │\n└─────────────────────┘      │ • RptMiddleware         │   │ • UseAuthorization()     │\n                             │                         │   │ • RefreshTokenMware      │\n                             │ Use Cases:              │   │ • RptMiddleware          │\n                             │ • Internal tools        │   │                          │\n                             │ • Simple apps           │   │ Use Cases:               │\n                             │ • Prototyping           │   │ • Enterprise apps        │\n                             └─────────────────────────┘   │ • Multi-tenant systems   │\n                                                           │ • Fine-grained access    │\n                                                           └──────────────────────────┘\n\n┌────────────────────────────────────────────────────────────────────────────────┐\n│                               SERVICE MATRIX                                   │\n├─────────────────────────────────┬───────┬────────────────┬─────────────────────┤\n│ Service/Middleware              │ NONE  │ AUTHENTICATE   │ AUTHORIZE           │\n├─────────────────────────────────┼───────┼────────────────┼─────────────────────┤\n│ SecurityHeadersMiddleware       │   ✅   │      ✅        │         ✅          │\n│ AntiforgeryTokenMiddleware      │   ✅   │      ✅        │         ✅          │\n│ HTTP Context Accessor           │   ✅   │      ✅        │         ✅          │\n│ Memory Cache                    │   ✅   │      ✅        │         ✅          │\n│ YARP Reverse Proxy              │   ✅   │      ✅        │         ✅          │\n│ Static Files                    │   ✅   │      ✅        │         ✅          │\n│ API NotFound Handling           │   ✅   │      ✅        │         ✅          │\n├─────────────────────────────────┼───────┼────────────────┼─────────────────────┤\n│ Cookie Authentication           │   ❌   │      ✅        │         ✅          │\n│ OIDC Integration                │   ❌   │      ✅        │         ✅          │\n│ UseAuthentication()             │   ❌   │      ✅        │         ✅          │\n│ UseAuthorization()              │   ❌   │      ✅        │         ✅          │\n│ Session Management              │   ❌   │      ✅        │         ✅          │\n│ Token Refresh Middleware        │   ❌   │      ✅        │         ✅          │\n│ No Unauthorized Redirect        │   ❌   │      ✅        │         ✅          │\n├─────────────────────────────────┼───────┼────────────────┼─────────────────────┤\n│ RPT Token Service               │   ❌   │      ❌        │         ✅          │\n│ Permission Policies             │   ❌   │      ❌        │         ✅          │\n│ Permission Claims Service       │   ❌   │      ❌        │         ✅          │\n└─────────────────────────────────┴───────┴────────────────┴─────────────────────┘\n```\n\n## Configuration\n\nConfigure the authorization mode in your `appsettings.json`:\n\n```json\n{\n  \"Auth\": {\n    \"AuthenticationMode\": \"Authenticate\",\n    \"RequireHttpsMetadata\": true,\n    \"RedirectUri\": \"/signin-oidc\",\n    \"PostLogoutRedirectUri\": \"/\",\n    \"Cookie\": { \n      \"Secure\": true \n    }\n  }\n}\n```\n\n### Available Authentication Modes\n\n- **`None`**: Anonymous access, no authentication required\n- **`Authenticate`**: Login required, no permission checks\n- **`Authorize`**: Login + fine-grained permission validation\n\n## Usage\n\n### 1. Register Services\n\n```csharp\nvar bffOptions = builder.Services.AddBffServices(isDev, builder.Configuration, options =>\n{\n    options.EnableSecurityHeaders = true;\n    options.ConfigureBff = bffOptions =>\n    {\n        bffOptions.AuthMode = AuthenticationMode.Authenticate;\n        bffOptions.EnableSessionManagement = true;\n        bffOptions.EnableTokenRefresh = true;\n    };\n});\n```\n\n### 2. Configure Middleware Pipeline\n\n```csharp\napp.ConfigureBffApp(bffOptions);\n```\n\n## Key Features\n\n- **Progressive Enhancement**: Each mode builds upon the previous one\n- **YARP Integration**: Reverse proxy works seamlessly in all modes\n- **Security First**: CSP, Antiforgery, and Security Headers always enabled\n- **Flexible Configuration**: Easy mode switching via configuration\n- **Clean Service Registration**: Only required services are registered per mode\n- **Swagger Integration**: Built-in OpenAPI documentation support\n- **Multi-Section Configuration**: Separate configuration sections for different concerns\n\n## Usage Pattern\n\nThe library follows a two-step configuration pattern:\n\n1. **Service Registration**: `AddBffServices()` returns configuration object\n2. **Pipeline Configuration**: `ConfigureBffApp()` accepts the configuration object\n\n```csharp\n// Step 1: Register services and get configuration\nvar bffOptions = builder.Services.AddBffServices(isDev, builder.Configuration, options => { /* configure */ });\n\n// Step 2: Configure middleware pipeline\napp.ConfigureBffApp(bffOptions);\n```\n\n## Technical Configuration Switches\n\nThe BFF library provides fine-grained control over features through configuration switches. These can be set in `appsettings.json` or programmatically:\n\n### Core Application Switches (All Modes)\n- **`EnableSecurityHeaders`**: Security headers middleware at application level (default: `true`)\n\n### BFF-Specific Switches\n- **`EnableApiNotFound`**: API 404 handling for unmatched routes (default: `true`)\n- **`EnableAntiforgery`**: CSRF protection with antiforgery tokens (default: `true`) \n- **`EnableHttpsRedirection`**: HTTPS enforcement middleware (default: `true`)\n- **`EnableStaticFiles`**: Static file serving capability (default: `true`)\n- **`EnableYarp`**: Reverse proxy functionality (default: `true`)\n\n### Authentication Switches (Authenticate + Authorize Modes)\n- **`EnableSessionManagement`**: Session handling and management (default: `true`)\n- **`EnableTokenRefresh`**: Automatic token renewal middleware (default: `true`)\n- **`EnableNoUnauthorizedRedirect`**: Prevent API route redirects on 401 (default: `true`)\n- **`RevokeRefreshTokenOnLogout`**: Cleanup tokens on logout (default: `true`)\n\n### Authorization Switches (Authorize Mode Only)  \n- **`EnableRptTokens`**: Resource Permission Token support (default: `true`)\n\n### Configuration Example\n\n```json\n{\n  \"affolterNET.Web\": {\n    \"Bff\": {\n      \"Options\": {\n        \"AuthMode\": \"Authorize\",\n        \"EnableSessionManagement\": true,\n        \"EnableTokenRefresh\": true,\n        \"EnableRptTokens\": true,\n        \"EnableAntiforgery\": true,\n        \"EnableApiNotFound\": true,\n        \"EnableStaticFiles\": true,\n        \"EnableYarp\": true,\n        \"EnableHttpsRedirection\": false,\n        \"RevokeRefreshTokenOnLogout\": true\n      }\n    }\n  }\n}\n```\n\n### Programmatic Configuration\n\n```csharp\nvar bffOptions = builder.Services.AddBffServices(isDev, builder.Configuration, options =>\n{\n    // Core application options\n    options.EnableSecurityHeaders = true;\n    \n    // BFF-specific configuration\n    options.ConfigureBff = bffOptions =>\n    {\n        bffOptions.AuthMode = AuthenticationMode.Authorize;\n        bffOptions.EnableSessionManagement = true;\n        bffOptions.EnableTokenRefresh = true;\n        bffOptions.EnableRptTokens = true;\n        bffOptions.EnableAntiforgery = false; // Disable for APIs\n        bffOptions.EnableHttpsRedirection = false; // For development\n    };\n    \n    // Swagger/OpenAPI configuration (optional)\n    options.ConfigureSwagger = swaggerOptions =>\n    {\n        swaggerOptions.Title = \"My API\";\n        swaggerOptions.Version = \"v1\";\n        swaggerOptions.ConfigureApiDocumentation = app =>\n        {\n            app.UseSwagger();\n            app.UseSwaggerUI();\n        };\n    };\n});\n```\n\n## Architecture\n\n### Core Components\n\n- **affolterNET.Auth.Core**: Base authorization policies, middleware, and services\n- **affolterNET.Auth.Bff**: Backend-for-Frontend pattern with YARP integration\n- **affolterNET.Auth.Api**: API-specific authentication (if needed)\n\n### Security Services (Always Active)\n\n- **SecurityHeadersMiddleware**: Applies CSP, HSTS, X-Frame-Options\n- **AntiforgeryTokenMiddleware**: CSRF protection\n- **YARP Reverse Proxy**: Frontend/API gateway functionality\n\n### Authentication Services (AuthenticatedOnly + PermissionBased)\n\n- **Cookie Authentication**: Secure session management\n- **OIDC Integration**: Keycloak/OAuth2 authentication\n- **Token Refresh**: Automatic token renewal\n- **Claims Enrichment**: User information processing\n\n### Authorization Services (PermissionBased Only)\n\n- **PermissionAuthorizationPolicyProvider**: Dynamic policy creation\n- **PermissionAuthorizationHandler**: Permission validation\n- **RPT Token Service**: Resource Permission Token handling\n- **Keycloak Integration**: Permission claim processing\n\n## Examples\n\n### Development Mode (No Authentication)\n```json\n{\n  \"affolterNET.Web\": {\n    \"Bff\": {\n      \"Options\": {\n        \"AuthMode\": \"None\",\n        \"EnableHttpsRedirection\": false\n      }\n    }\n  }\n}\n```\n\n### Internal Tools (Simple Authentication)\n```json\n{\n  \"affolterNET.Web\": {\n    \"Bff\": {\n      \"Options\": {\n        \"AuthMode\": \"Authenticate\",\n        \"EnableSessionManagement\": true,\n        \"EnableTokenRefresh\": true\n      }\n    }\n  }\n}\n```\n\n### Enterprise Applications (Full Authorization)\n```json\n{\n  \"affolterNET.Web\": {\n    \"Bff\": {\n      \"Options\": {\n        \"AuthMode\": \"Authorize\",\n        \"EnableSessionManagement\": true,\n        \"EnableTokenRefresh\": true,\n        \"EnableRptTokens\": true,\n        \"RevokeRefreshTokenOnLogout\": true\n      }\n    }\n  }\n}\n```"
      },
      "plugins": [
        {
          "name": "affolternet-web-api",
          "source": "./plugins/affolternet-web-api",
          "description": "API authentication with JWT Bearer tokens and Keycloak integration",
          "version": "1.0.0",
          "categories": [],
          "install_commands": [
            "/plugin marketplace add Mcafee123/affolterNET.Web",
            "/plugin install affolternet-web-api@affolternet-web"
          ]
        },
        {
          "name": "affolternet-web-bff",
          "source": "./plugins/affolternet-web-bff",
          "description": "BFF authentication with cookie-based OIDC, YARP reverse proxy, and SPA integration",
          "version": "1.0.0",
          "categories": [],
          "install_commands": [
            "/plugin marketplace add Mcafee123/affolterNET.Web",
            "/plugin install affolternet-web-bff@affolternet-web"
          ]
        }
      ]
    }
  ]
}