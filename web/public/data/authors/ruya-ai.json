{
  "author": {
    "id": "Ruya-AI",
    "display_name": "Ruya AI",
    "avatar_url": "https://avatars.githubusercontent.com/u/189677034?v=4"
  },
  "marketplaces": [
    {
      "name": "cozempic",
      "version": null,
      "description": "2x the effective context with smart weight-loss for Claude Code — prune bloated sessions, protect agent teams from compaction, monitor token usage with MCP tools",
      "repo_full_name": "Ruya-AI/cozempic",
      "repo_url": "https://github.com/Ruya-AI/cozempic",
      "repo_description": "Context cleaning for Claude Code — prune bloated sessions, protect Agent Teams from context loss, auto-guard with tiered pruning",
      "signals": {
        "stars": 89,
        "forks": 3,
        "pushed_at": "2026-02-19T09:56:12Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"cozempic\",\n  \"owner\": {\n    \"name\": \"Ruya AI\",\n    \"email\": \"hello@ruya.ai\"\n  },\n  \"metadata\": {\n    \"description\": \"2x the effective context with smart weight-loss for Claude Code — prune bloated sessions, protect agent teams from compaction, monitor token usage with MCP tools\",\n    \"version\": \"0.7.0\",\n    \"pluginRoot\": \"./plugin\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"cozempic\",\n      \"source\": \"./plugin\",\n      \"description\": \"2x the effective context with smart weight-loss for Claude Code — prune bloated sessions, protect agent teams from compaction, monitor token usage with MCP tools\",\n      \"version\": \"0.7.0\",\n      \"category\": \"productivity\",\n      \"tags\": [\"context\", \"pruning\", \"compaction\", \"agent-teams\", \"tokens\", \"optimization\"]\n    }\n  ]\n}\n",
        "README.md": "# Cozempic\n\nContext cleaning for [Claude Code](https://claude.ai/code) — **remove the bloat, keep everything that matters, protect Agent Teams from context loss**.\n\n### What gets removed\n\nClaude Code context fills up with dead weight that wastes your token budget: hundreds of progress tick messages, repeated thinking blocks and signatures, stale file reads that were superseded by edits, duplicate document injections, oversized tool outputs, and metadata bloat (token counts, stop reasons, cost fields). A typical session carries 8-46MB — most of it noise. Cozempic identifies and removes all of it using 13 composable strategies, while your actual conversation, decisions, tool results, and working context stay untouched.\n\n### Token-aware diagnostics\n\nFile size is a poor proxy for context usage — a 1.1MB JSONL can hold 158K tokens. Cozempic reads the **exact token counts** from Claude's `usage` fields in the session file, so you see real context window usage instead of misleading byte sizes. Every command shows tokens and a context % bar, and guard thresholds can be set in tokens for precise compaction prevention.\n\n### Agent Teams context loss protection\n\nWhen context gets too large, Claude's auto-compaction summarizes away critical state. For **Agent Teams**, this is catastrophic: the lead agent's context is compacted, team coordination messages (TeamCreate, SendMessage, TaskCreate/Update) are discarded, the lead forgets its teammates exist, and subagents are orphaned with no recovery path. ([#23620](https://github.com/anthropics/claude-code/issues/23620), [#23821](https://github.com/anthropics/claude-code/issues/23821), [#24052](https://github.com/anthropics/claude-code/issues/24052), [#21925](https://github.com/anthropics/claude-code/issues/21925))\n\nCozempic prevents this with five layers of protection:\n\n1. **Continuous checkpoint** — saves team state to disk every N seconds so it's always recoverable\n2. **Hook-driven checkpoint** — fires after every Task spawn, TaskCreate/Update, before compaction, and at session end\n3. **Tiered pruning** — soft threshold gently trims bloat without disruption; hard threshold does full prune + optional reload\n4. **Reactive overflow recovery** — kqueue/polling file watcher detects inbox-flood overflow within milliseconds, auto-prunes with escalating prescriptions, and resumes the session (~10s downtime vs permanently dead). Circuit breaker prevents infinite recovery loops. ([#23876](https://github.com/anthropics/claude-code/issues/23876))\n5. **Config.json ground truth** — reads `~/.claude/teams/*/config.json` for authoritative team state (lead, members, models, cwds)\n\n**Zero external dependencies.** Python 3.10+ stdlib only.\n\n## Install\n\n```bash\npip install cozempic\n```\n\nOr run directly:\n\n```bash\ngit clone https://github.com/Ruya-AI/cozempic.git\ncd cozempic\npip install -e .\n```\n\n## Setup\n\nAfter installing, run `init` from your project directory:\n\n```bash\ncd your-project/\ncozempic init\n```\n\nThat's it. This auto-wires everything:\n\n1. **Guard daemon auto-start** — `SessionStart` hook spawns `cozempic guard --daemon` when Claude Code opens. Background process, PID file prevents double-starts, logs to `/tmp/cozempic_guard_*.log`\n2. **Checkpoint hooks** — `PostToolUse[Task|TaskCreate|TaskUpdate]`, `PreCompact`, `Stop` capture team state at every critical moment\n3. **`/cozempic` slash command** — installed to `~/.claude/commands/` for in-session diagnosis and treatment\n\nIdempotent — safe to run multiple times. Existing hooks and settings are preserved. No second terminal needed.\n\n## Quick Start\n\n```bash\n# One-time setup: wire hooks + slash command\ncozempic init\n\n# List all sessions with sizes\ncozempic list\n\n# Auto-detect and diagnose the current session\ncozempic current --diagnose\n\n# Dry-run the standard prescription on current session\ncozempic treat current\n\n# Apply with backup\ncozempic treat current --execute\n\n# Go aggressive on a specific session\ncozempic treat <session_id> -rx aggressive --execute\n\n# Save team/agent state right now (no pruning, instant)\ncozempic checkpoint --show\n\n# Guard auto-starts on session open (after cozempic init)\n# Or run manually with custom thresholds:\ncozempic guard --threshold 50 -rx standard\n\n# Guard with token-based thresholds (fires whichever is hit first):\ncozempic guard --threshold 50 --threshold-tokens 180000\n\n# Run as background daemon (what the SessionStart hook uses):\ncozempic guard --daemon\n\n# Treat + auto-resume in a new terminal\ncozempic reload -rx gentle\n```\n\nSession IDs accept full UUIDs, UUID prefixes, file paths, or `current` for auto-detection based on your working directory.\n\n## How It Works\n\nEach type of bloat has a dedicated **strategy** that knows exactly what to remove and what to keep. Strategies are grouped into **prescriptions** — presets that balance cleaning depth against risk:\n\n| Prescription | Strategies | Risk | Typical Savings |\n|---|---|---|---|\n| `gentle` | 3 | Minimal | 5-8% |\n| `standard` | 7 | Low | 15-20% |\n| `aggressive` | 13 | Moderate | 20-25% |\n\n**Dry-run is the default.** Nothing is modified until you pass `--execute`. Backups are always created automatically.\n\n## Strategies\n\n| # | Strategy | What It Does | Expected |\n|---|----------|-------------|----------|\n| 1 | `progress-collapse` | Collapse consecutive progress tick messages | 40-48% |\n| 2 | `file-history-dedup` | Deduplicate file-history-snapshot messages | 3-6% |\n| 3 | `metadata-strip` | Strip token usage stats, stop_reason, costs | 1-3% |\n| 4 | `thinking-blocks` | Remove/truncate thinking content + signatures | 2-5% |\n| 5 | `tool-output-trim` | Trim large tool results (>8KB or >100 lines) | 1-8% |\n| 6 | `stale-reads` | Remove file reads superseded by later edits | 0.5-2% |\n| 7 | `system-reminder-dedup` | Deduplicate repeated system-reminder tags | 0.1-3% |\n| 8 | `http-spam` | Collapse consecutive HTTP request runs | 0-2% |\n| 9 | `error-retry-collapse` | Collapse repeated error-retry sequences | 0-5% |\n| 10 | `background-poll-collapse` | Collapse repeated polling messages | 0-1% |\n| 11 | `document-dedup` | Deduplicate large document blocks | 0-44% |\n| 12 | `mega-block-trim` | Trim any content block over 32KB | safety net |\n| 13 | `envelope-strip` | Strip constant envelope fields | 2-4% |\n\nRun a single strategy:\n\n```bash\ncozempic strategy progress-collapse <session_id> -v\ncozempic strategy thinking-blocks <session_id> --thinking-mode truncate\n```\n\n## Commands\n\n```\ncozempic init                               Wire hooks + slash command into project\ncozempic list [--project NAME]              List sessions with sizes\ncozempic current [-d]                       Show/diagnose current session (auto-detect)\ncozempic diagnose <session>                 Analyze bloat sources (read-only)\ncozempic treat <session> [-rx PRESET]       Run prescription (dry-run default)\ncozempic treat <session> --execute          Apply changes with backup\ncozempic strategy <name> <session>          Run single strategy\ncozempic reload [-rx PRESET]                Treat + auto-resume in new terminal\ncozempic checkpoint [--show]                Save team/agent state to disk (no pruning)\ncozempic guard [--threshold MB]             Tiered guard: checkpoint + soft/hard prune\ncozempic guard --soft-threshold 25          Custom soft threshold (default: 60% of hard)\ncozempic guard --threshold-tokens 180000    Hard threshold in tokens (alongside --threshold)\ncozempic guard --soft-threshold-tokens N    Soft threshold in tokens\ncozempic guard --no-reactive                Disable reactive overflow recovery\ncozempic doctor [--fix]                     Check for known Claude Code issues\ncozempic formulary                          Show all strategies & prescriptions\n```\n\nUse `current` as the session argument in any command to auto-detect the active session for your working directory.\n\n## Checkpoint — Instant Team State Snapshot\n\nSave your current team/agent state to disk without pruning or modifying anything:\n\n```bash\n# Save team state\ncozempic checkpoint\n\n# Save and print the state\ncozempic checkpoint --show\n```\n\nOutput:\n\n```\n  Checkpoint: 6 subagents, 9 tasks -> team-checkpoint.md\n\nActive agent team: agents\n\nSubagents (6):\n  - af9763f [Explore] — Explore memory system [completed]\n    Result: Complete understanding of the memory system...\n  - aa79e90 [Explore] — Explore platform adapters [completed]\n    Result: Comprehensive technical summary of platform...\n  ...\n\nShared task list:\n  - [COMPLETED] Fix team detection\n  - [IN_PROGRESS] Add continuous checkpoint\n  - [PENDING] Update README\n```\n\n### What gets detected\n\nCozempic scans two data sources and merges them:\n\n**JSONL session file** (runtime state):\n\n| Pattern | Source | What's Extracted |\n|---------|--------|-----------------|\n| `Task` tool calls | Subagent spawns | agent_id, subagent_type, description, prompt |\n| `<task-notification>` | Agent completion messages | status, summary, full result text |\n| `TaskCreate` / `TaskUpdate` | Shared todo list | task_id, subject, status, owner |\n| `TaskOutput` / `TaskStop` | Background agent management | agent status updates |\n| `TeamCreate` / `SendMessage` | Explicit team coordination | team name, teammate roles |\n\n**`~/.claude/teams/*/config.json`** (ground truth):\n\n| Field | What's Extracted |\n|-------|-----------------|\n| `name` | Authoritative team name |\n| `leadAgentId` | Lead agent identifier |\n| `leadSessionId` | Lead agent's session UUID |\n| `members[].model` | Model used by each teammate (e.g., `claude-opus-4-6`) |\n| `members[].cwd` | Working directory for each teammate |\n| `members[].agentType` | Role/type of each teammate |\n\nConfig.json fields are authoritative — they override JSONL-inferred values. JSONL is authoritative for runtime state (subagent progress, task status, results).\n\nThe checkpoint is written to `.claude/projects/<project>/team-checkpoint.md`.\n\n## Guard — Continuous Protection\n\nGuard is a background daemon with two complementary systems:\n\n**Proactive polling loop** (every N seconds):\n\n- **Phase 1: Continuous checkpoint** — extracts team state and writes to disk. Lightweight read-only scan. Team state is always recoverable even if Claude crashes. Also merges `~/.claude/teams/*/config.json` as ground truth for team name, lead agent, member models, and working directories.\n- **Phase 2: Soft prune** (at soft threshold) — when file size crosses the soft threshold, applies a `gentle` prescription to trim easy bloat. **No reload** — the session continues uninterrupted.\n- **Phase 3: Hard prune** (at hard threshold) — applies the full prescription with team-protect, injects recovery messages, and optionally kills + resumes Claude.\n\n**Reactive overflow recovery** (sub-second, enabled by default):\n\nWhen agent team sessions go idle, Claude's InboxPoller can deliver all queued teammate messages at once, spiking the JSONL past the 200k token limit in seconds — faster than the polling loop can react. The reactive watcher uses kqueue (macOS, 0.04ms latency) or stat polling (Linux, 200ms) to detect this overflow within milliseconds. On detection:\n\n1. **Circuit breaker check** — prevents infinite prune → resume → crash loops (max 3 recoveries in 5 minutes)\n2. **Escalating prescription** — recovery #1 uses `gentle`, #2 uses `standard`, #3 uses `aggressive`\n3. **Pre-flight check** — if post-prune estimate is still too large, skips resume\n4. **Team-protected prune** → kill → auto-resume (~10s downtime vs permanently dead session)\n5. **Breaker trip** — after 3 rapid recoveries, halts with a clear message and saves a final checkpoint\n\nDisable with `--no-reactive` if needed. Zero impact on normal sessions — the watcher runs silently and fast-path exits for small files.\n\nThe soft threshold defaults to 60% of the hard threshold. This gives a two-phase degradation: trim early and often, escalate only when needed.\n\n```bash\n# Standard — run in a separate terminal\ncozempic guard\n\n# Custom thresholds and interval\ncozempic guard --threshold 40 --soft-threshold 25 --interval 15 -rx standard\n\n# Without auto-reload (just clean, no restart)\ncozempic guard --threshold 50 --no-reload\n\n# Disable reactive overflow recovery (polling only)\ncozempic guard --no-reactive\n\n# Token-based thresholds (fires whichever is hit first)\ncozempic guard --threshold 50 --threshold-tokens 180000 --soft-threshold-tokens 120000\n\n# Aggressive at hard threshold, gentle at soft (automatic)\ncozempic guard --threshold 30 -rx aggressive\n```\n\nOutput:\n\n```\n  COZEMPIC GUARD v3\n  ===================================================================\n  Session:     abc123.jsonl\n  Size:        5.4MB\n  Soft:        30.0MB (gentle prune, no reload)\n  Hard:        50.0MB (full prune + reload)\n  Soft tokens: 120,000\n  Hard tokens: 180,000\n  Rx:          gentle (soft) / standard (hard)\n  Interval:    30s\n  Team-protect: enabled\n  Checkpoint:  continuous (every 30s)\n  Reactive:    enabled\n\n  Guarding... (Ctrl+C to stop)\n\n  [14:23:01] Checkpoint #1: 6 agents, 9 tasks, 121 msgs (5.4MB)\n  [14:25:31] Checkpoint #2: 8 agents, 12 tasks, 156 msgs (6.1MB)\n  [14:28:01] Checkpoint #3: 8 agents, 12 tasks, 189 msgs (7.2MB)\n  [14:45:01] SOFT THRESHOLD: 121,432 tokens >= 120,000\n             Gentle prune, no reload (cycle #1)\n             Trimmed: 4.1MB saved\n  [15:10:01] HARD THRESHOLD: 50.3MB >= 50.0MB\n             Emergency prune with standard (cycle #1)\n             Pruned: 12.4MB saved\n             Team 'dev-agents' state preserved (87 messages)\n```\n\nOn Ctrl+C, guard writes a final checkpoint before exiting.\n\n### How team-protect works\n\nDuring prune (soft or hard):\n\n1. **Extract** full team state from JSONL + `~/.claude/teams/*/config.json`\n2. **Separate** team messages from non-team messages\n3. **Prune** only non-team messages using the prescription\n4. **Merge** team messages back at their original positions\n5. **Inject** a synthetic message pair confirming team state (Claude *sees* this as conversation history)\n6. **Save** with backup, then optionally reload (hard only)\n\n## Hook Integration\n\nFor the strongest protection, wire `cozempic checkpoint` into Claude Code hooks. This captures team state at every critical moment — not just on a timer.\n\nAdd to your project's `.claude/settings.json`:\n\n```json\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Task\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"cozempic checkpoint 2>/dev/null || true\"\n          }\n        ]\n      },\n      {\n        \"matcher\": \"TaskCreate|TaskUpdate\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"cozempic checkpoint 2>/dev/null || true\"\n          }\n        ]\n      }\n    ],\n    \"PreCompact\": [\n      {\n        \"matcher\": \"\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"cozempic checkpoint 2>/dev/null || true\"\n          }\n        ]\n      }\n    ],\n    \"Stop\": [\n      {\n        \"matcher\": \"\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"cozempic checkpoint 2>/dev/null || true\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nThis checkpoints team state:\n\n| Hook | When | Why |\n|------|------|-----|\n| `PostToolUse[Task]` | After every subagent spawn | Capture new agent immediately |\n| `PostToolUse[TaskCreate\\|TaskUpdate]` | After todo list changes | Track task progress |\n| `PreCompact` | Right before auto-compaction | Last chance to save state |\n| `Stop` | Session end | Final checkpoint |\n\n### Protection layers summary\n\n| Layer | Trigger | What it does |\n|-------|---------|-------------|\n| **Hooks** | Every Task/TaskCreate/TaskUpdate, PreCompact, Stop | Instant checkpoint to disk |\n| **Guard (checkpoint)** | Every N seconds | Extract team state + config.json, write checkpoint |\n| **Guard (soft prune)** | At soft threshold (default 60% of hard) | Gentle prune, no reload, no disruption |\n| **Guard (hard prune)** | At hard threshold | Full prune + team-protect + optional reload |\n| **Guard (reactive)** | Sub-second file watcher (kqueue/polling) | Detect inbox-flood overflow → escalating prune → kill → resume |\n| **Reload** | Manual (`cozempic reload`) | One-shot prune + auto-resume |\n| **Checkpoint** | Manual (`cozempic checkpoint`) | One-shot state save |\n\n## Reload — Treat + Auto-Resume\n\nPrune the current session and automatically resume Claude in a new terminal:\n\n```bash\ncozempic reload -rx gentle\n```\n\nThis:\n1. Treats the current session with the chosen prescription\n2. Generates a compact recap of the conversation\n3. Spawns a watcher that waits for Claude to exit\n4. When you type `/exit`, a new terminal opens with `claude --resume`\n5. The recap is displayed before the resume prompt\n\n## Doctor\n\nBeyond context cleaning, Cozempic can check for known Claude Code configuration issues:\n\n```bash\ncozempic doctor        # Diagnose issues\ncozempic doctor --fix  # Auto-fix where possible\n```\n\nCurrent checks:\n\n| Check | What It Detects |\n|-------|----------------|\n| `trust-dialog-hang` | `hasTrustDialogAccepted=true` in `~/.claude.json` causing resume hangs on Windows |\n| `oversized-sessions` | Session files >50MB likely to hang on resume |\n| `stale-backups` | Old `.bak` files from previous treatments wasting disk |\n| `disk-usage` | Total session storage exceeding healthy thresholds |\n\nThe `--fix` flag auto-applies fixes where safe (e.g., resetting the trust dialog flag, cleaning stale backups). Backups are created before any config modification.\n\n## Claude Code Integration\n\n### Plugin (Recommended)\n\nCozempic ships as a Claude Code plugin with skills, hooks, and an MCP server. The plugin gives Claude direct access to cozempic tools — it can diagnose context pressure, run treatments, and monitor sessions without you running CLI commands.\n\nInstall from the repo:\n\n```bash\ngit clone https://github.com/Ruya-AI/cozempic.git\nclaude --plugin-dir ./cozempic/plugin\n```\n\nThe plugin registers:\n\n**Skills** — invoke from the chat or let Claude trigger automatically:\n\n| Skill | Description |\n|-------|-------------|\n| `/cozempic:diagnose` | Analyze session bloat, token count, context % |\n| `/cozempic:treat [rx]` | Prune session with gentle/standard/aggressive |\n| `/cozempic:reload [rx]` | Treat + auto-resume in new terminal |\n| `/cozempic:guard` | Start background sentinel daemon |\n| `/cozempic:doctor` | Run health checks |\n\n**MCP Tools** — Claude can call these directly as tool use:\n\n| Tool | What It Does |\n|------|-------------|\n| `diagnose_current` | Full session diagnosis with token counts and bloat breakdown |\n| `estimate_tokens` | Quick token count + context % (reads only the tail of the file) |\n| `list_sessions` | All sessions with sizes and token estimates |\n| `treat_session` | Dry-run or apply a prescription |\n| `list_strategies` | Available strategies and prescriptions |\n\n**Hooks** — auto-registered when the plugin is enabled:\n\n| Event | Action |\n|-------|--------|\n| `SessionStart` | Start guard daemon in background |\n| `PostToolUse` (Task/TaskCreate/TaskUpdate) | Checkpoint agent team state |\n| `PreCompact` | Emergency checkpoint before compaction |\n| `Stop` | Final checkpoint on session end |\n\nThe MCP server requires `fastmcp` (installed automatically via `uv`). See [plugin/README.md](plugin/README.md) for details.\n\n### Standalone MCP Server\n\nTo use the MCP tools without the full plugin, add to your project's `.mcp.json`:\n\n```json\n{\n  \"mcpServers\": {\n    \"cozempic\": {\n      \"command\": \"uv\",\n      \"args\": [\n        \"run\",\n        \"--with\", \"fastmcp\",\n        \"--with\", \"cozempic\",\n        \"python\",\n        \"path/to/plugin/servers/cozempic_mcp.py\"\n      ]\n    }\n  }\n}\n```\n\n### Slash Command\n\nCozempic also ships with a `/cozempic` slash command that's automatically installed to `~/.claude/commands/` when you run `cozempic init`. It works in any Claude Code project without the plugin.\n\nType `/cozempic` in any session to get an interactive menu:\n\n1. **Diagnose** — Analyze bloat sources and recommend a prescription (read-only, no changes)\n2. **Treat & Reload** (Recommended) — Diagnose, prune session, and auto-open a new terminal with clean context\n3. **Treat Only** — Diagnose and prune session in-place (you resume manually with `claude --resume`)\n4. **Guard Mode** — Start a background sentinel that auto-prunes before compaction kills agent teams\n\nYou can also skip the menu with arguments: `/cozempic diagnose`, `/cozempic treat`, `/cozempic guard`, or `/cozempic doctor`.\n\nThe slash command is kept up-to-date — running `cozempic init` again after upgrading will update it if a newer version is available.\n\n### SessionStart Hook (Optional)\n\nTo persist the session ID as an environment variable for use in scripts and other hooks:\n\n```bash\ncp .claude/hooks/persist-session-id.sh ~/.claude/hooks/\nchmod +x ~/.claude/hooks/persist-session-id.sh\n```\n\nAdd to your `.claude/settings.json`:\n\n```json\n{\n  \"hooks\": {\n    \"SessionStart\": [{\n      \"hooks\": [{\n        \"type\": \"command\",\n        \"command\": \"~/.claude/hooks/persist-session-id.sh\"\n      }]\n    }]\n  }\n}\n```\n\nThis makes `$CLAUDE_SESSION_ID` available in all Bash commands during the session.\n\n## Safety\n\n- **Always dry-run by default** — `--execute` flag required to modify files\n- **Timestamped backups** — automatic `.bak` files before any modification\n- **Never touches uuid/parentUuid** — conversation DAG stays intact\n- **Never removes summary/queue-operation messages** — structurally important\n- **Team messages are protected** — guard and checkpoint never prune Task, TaskCreate, TaskUpdate, TeamCreate, or SendMessage tool calls\n- **task-notification results preserved** — agent completion results (the actual output) are captured and checkpointed\n- **Strategies compose sequentially** — each runs on the output of the previous, so savings are accurate and don't overlap\n\n## Example Output\n\n```\n  Prescription: aggressive\n  Before: 29.56MB (6602 messages)\n  After:  23.09MB (5073 messages)\n  Saved:  6.47MB (21.9%) — 1529 removed, 4038 modified\n  Tokens: 158.2K -> 121.5K (36.7K freed, 23.2%) (exact)\n\n  Strategy Results:\n    progress-collapse              1.63MB saved  (5.5%)  (1525 removed)\n    file-history-dedup              2.0KB saved  (0.0%)  (4 removed)\n    metadata-strip                693.9KB saved  (2.3%)  (2735 modified)\n    thinking-blocks                 1.11MB saved  (3.8%)  (1127 modified)\n    tool-output-trim               1.72MB saved  (5.8%)  (167 modified)\n    stale-reads                   710.0KB saved  (2.3%)  (176 modified)\n    system-reminder-dedup          27.6KB saved  (0.1%)  (92 modified)\n    envelope-strip                509.2KB saved  (1.7%)  (4657 modified)\n```\n\nDiagnosis output:\n\n```\n  Patient: abc123\n  Weight:  1.01MB (223 messages)\n  Tokens:  83.0K (exact)\n  Context: [========------------] 42%\n\n  Vital Signs:\n    Progress ticks:         41\n    File history snaps:      8\n    ...\n```\n\nThe `list` command also shows a Tokens column for every session:\n\n```\n  Session ID                                     Size   Tokens Messages Modified             Project\n  ──────────────────────────────────────── ────────── ──────── ──────── ────────────────────\n  38cbd1d7-d465-456e-892b-61c7d70725ab        43.88MB   143.2K      828 2026-01-23 20:28     ...\n  547f8a35-8162-4bb0-b727-1fe2f6452c07        12.79MB   152.0K     5102 2026-02-16 20:51     ...\n```\n\n## Contributing\n\nContributions welcome. To add a strategy:\n\n1. Create a function in the appropriate tier file under `src/cozempic/strategies/`\n2. Decorate with `@strategy(name, description, tier, expected_savings)`\n3. Return a `StrategyResult` with a list of `PruneAction`s\n4. Add to the appropriate prescription in `src/cozempic/registry.py`\n\n```python\nfrom cozempic.registry import strategy\nfrom cozempic.types import Message, PruneAction, StrategyResult\n\n@strategy(\"my-strategy\", \"What it does\", \"standard\", \"1-5%\")\ndef my_strategy(messages: list[Message], config: dict) -> StrategyResult:\n    actions = []\n    # ... analyze messages, build PruneAction list ...\n    return StrategyResult(\n        strategy_name=\"my-strategy\",\n        actions=actions,\n        # ...\n    )\n```\n\n## License\n\nMIT - see [LICENSE](LICENSE).\n\nBuilt by [Ruya AI](https://ruya.ai).\n",
        "plugin/README.md": "# Cozempic Plugin for Claude Code\n\nContext weight-loss plugin for Claude Code. Prune bloated sessions, protect agent teams from compaction, and monitor context usage — all from within Claude Code.\n\n## Prerequisites\n\n```bash\npip install cozempic\n```\n\n## Install\n\n```bash\n# Development / testing\nclaude --plugin-dir ./plugin\n\n# From marketplace (once published)\nclaude plugin install cozempic\n```\n\n## Skills\n\n| Skill | Description | Invocation |\n|-------|-------------|------------|\n| `/cozempic:diagnose` | Analyze session bloat, token count, context % | User or Claude (auto) |\n| `/cozempic:treat [rx]` | Prune session with gentle/standard/aggressive | User only |\n| `/cozempic:reload [rx]` | Treat + auto-resume in new terminal | User only |\n| `/cozempic:guard` | Start background sentinel daemon | User only |\n| `/cozempic:doctor` | Run health checks | User or Claude (auto) |\n\n## Hooks\n\nAutomatically registered when the plugin is enabled:\n\n| Event | Action |\n|-------|--------|\n| `SessionStart` | Start guard daemon in background |\n| `PostToolUse` (Task/TaskCreate/TaskUpdate) | Checkpoint agent team state |\n| `PreCompact` | Emergency checkpoint before compaction |\n| `Stop` | Final checkpoint on session end |\n\n## MCP Tools\n\nThe plugin includes an MCP server that gives Claude direct access to cozempic tools:\n\n- `diagnose_current` — Full session diagnosis with token counts\n- `estimate_tokens` — Quick token count + context % check\n- `list_sessions` — All sessions with sizes and tokens\n- `treat_session` — Dry-run or apply a prescription\n- `list_strategies` — Available strategies and prescriptions\n\nClaude can invoke these automatically when it detects context pressure.\n\n## How It Works\n\nThe plugin wraps the `cozempic` CLI and Python package:\n- **Skills** call `cozempic` CLI commands via Bash\n- **Hooks** run `cozempic guard` and `cozempic checkpoint` on lifecycle events\n- **MCP server** imports from the `cozempic` package directly for richer tool integration\n"
      },
      "plugins": [
        {
          "name": "cozempic",
          "source": "./plugin",
          "description": "2x the effective context with smart weight-loss for Claude Code — prune bloated sessions, protect agent teams from compaction, monitor token usage with MCP tools",
          "version": "0.7.0",
          "category": "productivity",
          "tags": [
            "context",
            "pruning",
            "compaction",
            "agent-teams",
            "tokens",
            "optimization"
          ],
          "categories": [
            "agent-teams",
            "compaction",
            "context",
            "optimization",
            "productivity",
            "pruning",
            "tokens"
          ],
          "install_commands": [
            "/plugin marketplace add Ruya-AI/cozempic",
            "/plugin install cozempic@cozempic"
          ]
        }
      ]
    }
  ]
}