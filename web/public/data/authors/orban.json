{
  "author": {
    "id": "orban",
    "display_name": "Ryan Orban",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/332359?u=c330749d553bd397eb2456137fac83f40c2ff7b7&v=4",
    "url": "https://github.com/orban",
    "bio": null,
    "stats": {
      "total_marketplaces": 1,
      "total_plugins": 1,
      "total_commands": 0,
      "total_skills": 9,
      "total_stars": 0,
      "total_forks": 0
    }
  },
  "marketplaces": [
    {
      "name": "orban",
      "version": null,
      "description": "Plugin marketplace for Intent Layer - hierarchical AGENTS.md infrastructure for AI-navigable codebases",
      "owner_info": {
        "name": "Intent Layer Contributors"
      },
      "keywords": [],
      "repo_full_name": "orban/intent-layer",
      "repo_url": "https://github.com/orban/intent-layer",
      "repo_description": "Custom skills for Claude Code CLI - Intent Layer setup and maintenance",
      "homepage": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2026-01-28T05:21:08Z",
        "created_at": "2026-01-21T06:44:01Z",
        "license": null
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 523
        },
        {
          "path": ".claude-plugin/plugin.json",
          "type": "blob",
          "size": 519
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 8605
        },
        {
          "path": "agents",
          "type": "tree",
          "size": null
        },
        {
          "path": "agents/auditor.md",
          "type": "blob",
          "size": 4044
        },
        {
          "path": "agents/explorer.md",
          "type": "blob",
          "size": 2893
        },
        {
          "path": "agents/validator.md",
          "type": "blob",
          "size": 4062
        },
        {
          "path": "eval-harness",
          "type": "tree",
          "size": null
        },
        {
          "path": "eval-harness/README.md",
          "type": "blob",
          "size": 1773
        },
        {
          "path": "hooks",
          "type": "tree",
          "size": null
        },
        {
          "path": "hooks/hooks.json",
          "type": "blob",
          "size": 2503
        },
        {
          "path": "intent-layer",
          "type": "tree",
          "size": null
        },
        {
          "path": "intent-layer/clean",
          "type": "tree",
          "size": null
        },
        {
          "path": "intent-layer/clean/SKILL.md",
          "type": "blob",
          "size": 3326
        },
        {
          "path": "skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/intent-layer-maintenance",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/intent-layer-maintenance/SKILL.md",
          "type": "blob",
          "size": 10491
        },
        {
          "path": "skills/intent-layer-onboarding",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/intent-layer-onboarding/SKILL.md",
          "type": "blob",
          "size": 15166
        },
        {
          "path": "skills/intent-layer-query",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/intent-layer-query/SKILL.md",
          "type": "blob",
          "size": 13241
        },
        {
          "path": "skills/intent-layer",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/intent-layer/SKILL.md",
          "type": "blob",
          "size": 26464
        },
        {
          "path": "skills/intent-layer/git-history",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/intent-layer/git-history/SKILL.md",
          "type": "blob",
          "size": 10383
        },
        {
          "path": "skills/intent-layer/pr-review-mining",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/intent-layer/pr-review-mining/SKILL.md",
          "type": "blob",
          "size": 9466
        },
        {
          "path": "skills/intent-layer/pr-review",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/intent-layer/pr-review/SKILL.md",
          "type": "blob",
          "size": 3013
        },
        {
          "path": "skills/review-mistakes",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/review-mistakes/SKILL.md",
          "type": "blob",
          "size": 5466
        }
      ],
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"orban\",\n  \"owner\": {\n    \"name\": \"Intent Layer Contributors\"\n  },\n  \"metadata\": {\n    \"description\": \"Plugin marketplace for Intent Layer - hierarchical AGENTS.md infrastructure for AI-navigable codebases\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"intent-layer\",\n      \"version\": \"1.0.1\",\n      \"source\": \"./\",\n      \"description\": \"Hierarchical AGENTS.md infrastructure for AI-navigable codebases. Create CLAUDE.md/AGENTS.md files that help AI agents navigate your codebase like senior engineers.\"\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"intent-layer\",\n  \"version\": \"1.0.1\",\n  \"description\": \"Hierarchical AGENTS.md infrastructure for AI-navigable codebases. Create CLAUDE.md/AGENTS.md files that help AI agents navigate your codebase like senior engineers.\",\n  \"author\": {\n    \"name\": \"Intent Layer Contributors\"\n  },\n  \"keywords\": [\n    \"intent-layer\",\n    \"agents-md\",\n    \"claude-md\",\n    \"documentation\",\n    \"codebase-navigation\",\n    \"ai-infrastructure\"\n  ],\n  \"repository\": \"https://github.com/orban/intent-layer\",\n  \"license\": \"MIT\"\n}\n",
        "README.md": "# Intent Layer Plugin\n\nClaude Code plugin for creating and maintaining Intent Layer infrastructure.\n\n## Philosophy\n\nIntent Layers solve a fundamental problem: **AI agents reading raw code lack the tribal knowledge that experienced engineers have.**\n\nSenior engineers know:\n- Where to start for common tasks\n- What patterns are expected\n- What invariants must never be violated\n- What pitfalls to avoid\n\nIntent Layers compress this knowledge into high-signal AGENTS.md/CLAUDE.md files that give agents the same intuition—without reading thousands of lines of code.\n\n### Core Principles\n\n1. **Compression > Verbosity** - Target 100:1 compression. 200k tokens of code → 2k token node.\n2. **Contracts > Comments** - Document invariants and constraints, not obvious code behavior.\n3. **Pitfalls > Patterns** - What catches people matters more than standard patterns.\n4. **Progressive Disclosure** - Start minimal, agents drill down when needed.\n\n## Installation\n\n### From GitHub (recommended)\n\n```bash\n# Add the marketplace\n/plugin marketplace add orban/intent-layer\n\n# Install the plugin\n/plugin install intent-layer@orban\n```\n\nOr using the CLI:\n\n```bash\nclaude plugin marketplace add orban/intent-layer\nclaude plugin install intent-layer@orban\n```\n\n### From local directory\n\n```bash\n# Clone the repository\ngit clone https://github.com/orban/intent-layer.git\n\n# Install from local path\nclaude plugin install ./intent-layer\n```\n\n## Components\n\n### Skills\n\nInteractive workflows invoked via slash commands:\n\n| Skill | Purpose | Command |\n|-------|---------|---------|\n| `intent-layer` | Set up new Intent Layer infrastructure | `/intent-layer` |\n| `intent-layer-maintenance` | Maintain existing Intent Layers | `/intent-layer-maintenance` |\n| `intent-layer-onboarding` | Orient new developers using Intent Layer | `/intent-layer-onboarding` |\n| `intent-layer-query` | Query Intent Layer for answers | `/intent-layer-query` |\n| `review-mistakes` | Interactive review of pending mistake reports | `/review-mistakes` |\n\n### Agents\n\nSpecialized subagents that Claude invokes automatically when appropriate:\n\n| Agent | Purpose |\n|-------|---------|\n| `explorer` | Analyze directories and propose AGENTS.md content |\n| `validator` | Deep validation that nodes accurately reflect codebase |\n| `auditor` | Find drift between nodes and current code state |\n\n### Hooks\n\nAutomatic event handlers that keep the Intent Layer active during development:\n\n| Hook | Event | Purpose |\n|------|-------|---------|\n| `post-edit-check` | PostToolUse | Remind about Intent Layer coverage after edits |\n| `pre-edit-check` | PreToolUse | Inject pitfalls before edits, warn about uncovered dirs |\n| `inject-learnings` | SessionStart | Inject recent learnings, suggest setup if no Intent Layer |\n| `capture-tool-failure` | PostToolUseFailure | Auto-create skeleton mistake reports on Edit/Write failures |\n| Stop prompt | Stop | LLM evaluates session for learnings to capture |\n\n### Learning Loop\n\nThe plugin implements a continuous, mostly-automated learning loop:\n\n```\nAgent makes mistake → PostToolUseFailure auto-creates skeleton\n                              ↓\n                      Skeleton in .intent-layer/mistakes/pending/\n                              ↓\n                      Stop hook evaluates: enrich or discard?\n                              ↓\n                      Next session: Agent offers interactive review\n                      or user runs /review-mistakes\n                              ↓\n                      User decides: Accept / Reject / Discard\n                              ↓ (on accept)\n                      Auto-integrated via lib/integrate_pitfall.sh\n                      Pitfall added to covering AGENTS.md\n                              ↓\n                      Next session: SessionStart injects learnings\n                              ↓\n                      PreToolUse injects relevant pitfalls before edits\n```\n\n**Interactive review**: When pending reports exist, the agent offers to walk you through them conversationally. You can also explicitly run `/review-mistakes` to start a review session.\n\n**Supporting scripts:**\n\n| Script | Purpose |\n|--------|---------|\n| `lib/integrate_pitfall.sh` | Auto-add pitfalls to covering AGENTS.md |\n| `scripts/capture_mistake.sh` | Manual capture (if auto-capture missed something) |\n| `scripts/review_mistakes.sh` | Terminal-based review (alternative to agent) |\n\n## Usage\n\n### Initial Setup\n\n```bash\n# Check if Intent Layer exists\n./scripts/detect_state.sh /path/to/project\n\n# Analyze token distribution\n./scripts/estimate_all_candidates.sh /path/to/project\n\n# Create nodes using the skill\n# Then in Claude Code: /intent-layer /path/to/project\n```\n\n### Maintenance\n\n```bash\n# Detect which nodes need review after changes\n./scripts/detect_changes.sh main HEAD\n\n# Generate pain point capture template\n./scripts/capture_pain_points.sh pain_points.md\n\n# Run maintenance workflow\n# In Claude Code: /intent-layer-maintenance /path/to/project\n```\n\n### Onboarding\n\n```bash\n# Generate orientation overview\n./scripts/generate_orientation.sh /path/to/project\n\n# Or use the skill interactively\n# In Claude Code: /intent-layer-onboarding /path/to/project\n```\n\n## Plugin Structure\n\n```\nintent-layer-plugin/\n├── .claude-plugin/\n│   └── plugin.json          # Plugin manifest\n├── skills/                   # Slash-command skills\n│   ├── intent-layer/\n│   ├── intent-layer-maintenance/\n│   ├── intent-layer-onboarding/\n│   └── intent-layer-query/\n├── agents/                   # Specialized subagents\n│   ├── explorer.md\n│   ├── validator.md\n│   └── auditor.md\n├── hooks/\n│   └── hooks.json            # PostToolUse hook config\n├── scripts/                  # Shared bash scripts\n└── references/               # Templates and guides\n```\n\n## Script Features\n\nAll scripts support:\n- `-h` / `--help` for usage information\n- `set -euo pipefail` for robust error handling\n- Cross-platform compatibility (macOS + Linux)\n- Detailed error messages with remediation hints\n- Consistent exclusion of generated directories (node_modules, dist, etc.)\n\n## When to Use\n\n### intent-layer\n\n**Good for:**\n- New projects that will be touched by AI agents\n- Existing codebases where agents struggle to navigate\n- Monorepos with complex subsystem boundaries\n- Codebases with non-obvious contracts or invariants\n\n**Not good for:**\n- Tiny scripts or single-file projects\n- Projects that change so rapidly the docs would be stale immediately\n- Codebases you won't use AI agents on\n\n### intent-layer-maintenance\n\n**Good for:**\n- Quarterly reviews of existing Intent Layers\n- Post-incident updates (adding pitfalls, updating contracts)\n- Post-refactor updates (moving entry points, changing boundaries)\n- When agents consistently get confused about something\n\n**Not good for:**\n- Initial setup (use `intent-layer` first)\n- Minor cosmetic changes that don't affect behavior\n\n## CI Integration\n\nThe plugin includes `detect_staleness.sh` for automated staleness checks in CI pipelines. The script exits with code 2 when stale nodes are found, making it easy to fail builds or create warnings.\n\n### GitHub Actions\n\n```yaml\n# .github/workflows/intent-layer.yml\nname: Intent Layer Check\n\non:\n  pull_request:\n  push:\n    branches: [main]\n\njobs:\n  staleness:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n        with:\n          fetch-depth: 0  # Needed for git history analysis\n\n      - name: Check Intent Layer staleness\n        run: |\n          ./scripts/detect_staleness.sh --code-changes --threshold 30\n        continue-on-error: true  # Warning only, or remove for hard fail\n```\n\n### GitLab CI\n\n```yaml\n# .gitlab-ci.yml\nintent-layer:check:\n  stage: test\n  script:\n    - ./scripts/detect_staleness.sh --code-changes\n  allow_failure: true  # Warning only\n  only:\n    - merge_requests\n```\n\n### Exit Codes\n\n| Code | Meaning |\n|------|---------|\n| 0 | No stale nodes found |\n| 1 | Error (invalid path, etc.) |\n| 2 | Stale nodes found |\n\n### Useful Options\n\n- `--code-changes`: Flag nodes where code changed more recently than the node\n- `--threshold N`: Days since node update to consider stale (default: 90)\n- `--quiet`: Output only paths (useful for scripting)\n\n### PR Review Integration\n\nFor PR-specific checks, use `review_pr.sh` which validates changes against Intent Layer contracts:\n\n```yaml\n- name: Review PR against Intent Layer\n  if: github.event_name == 'pull_request'\n  run: |\n    ./scripts/review_pr.sh origin/${{ github.base_ref }} HEAD\n```\n",
        "agents/auditor.md": "---\ndescription: >\n  Find drift between Intent Layer nodes and current code state.\n  Use for quarterly maintenance, post-merge review, or when hook flags accumulate.\ncapabilities:\n  - Run validator across all nodes in parallel\n  - Compare node timestamps vs code change timestamps\n  - Identify stale sections where code changed but node didn't\n  - Prioritize findings by impact (contracts > pitfalls > patterns)\n  - Generate comprehensive audit reports\n---\n\n# Intent Layer Auditor\n\nDetects drift between Intent Layer documentation and actual codebase state.\n\n## When to Use\n\n- Quarterly Intent Layer maintenance\n- After major merges or releases\n- When PostToolUse hook has flagged many edits without node updates\n- User asks to \"audit intent layer\" or \"check for stale documentation\"\n\n## Audit Process\n\n### 1. Discover All Nodes\n\nFind all Intent Layer nodes in the codebase:\n\n```bash\n${CLAUDE_PLUGIN_ROOT}/scripts/show_hierarchy.sh\n```\n\nThis produces a tree of all AGENTS.md and CLAUDE.md files.\n\n### 2. Check for Staleness\n\nRun staleness detection to find nodes that may need updates:\n\n```bash\n${CLAUDE_PLUGIN_ROOT}/scripts/detect_staleness.sh\n```\n\nThis compares:\n- Node file modification time vs covered code modification times\n- Git history of covered directories since last node update\n- Number of commits affecting covered files\n\n### 3. Validate Each Node (Parallel)\n\nFor each node identified, spawn the **Validator** agent to perform deep validation.\n\nCollect results and aggregate into a single report.\n\n### 4. Prioritize Findings\n\nRank issues by impact:\n\n| Priority | Category | Rationale |\n|----------|----------|-----------|\n| P0 | Contract failures | May cause incorrect agent behavior |\n| P1 | Entry point failures | Agents can't find starting points |\n| P2 | Pitfall staleness | Outdated warnings, but not actively harmful |\n| P3 | Pattern drift | Style/convention issues |\n\n### 5. Generate Audit Report\n\n```markdown\n## Intent Layer Audit Report\n\n**Date**: YYYY-MM-DD\n**Nodes Audited**: N\n**Overall Health**: GOOD | NEEDS_ATTENTION | CRITICAL\n\n### Executive Summary\n\n- X nodes require immediate attention (P0/P1 issues)\n- Y nodes have minor drift (P2/P3 issues)\n- Z nodes are healthy\n\n### Critical Issues (P0/P1)\n\n| Node | Issue | Impact | Recommended Action |\n|------|-------|--------|-------------------|\n| src/api/AGENTS.md | Contract violation | HIGH | Update auth contract |\n| src/db/AGENTS.md | Entry point missing | MEDIUM | Add new migration entry |\n\n### Minor Issues (P2/P3)\n\n| Node | Issue | Last Updated | Code Changes Since |\n|------|-------|--------------|-------------------|\n| src/utils/AGENTS.md | 3 new commits | 2024-01-15 | 12 files changed |\n\n### Healthy Nodes\n\n[List of nodes that passed validation]\n\n### Coverage Gaps\n\nDirectories with significant code but no Intent Layer coverage:\n- src/legacy/ (450 files, 0 nodes)\n- src/experimental/ (23 files, 0 nodes)\n\n### Recommended Actions\n\n1. **Immediate**: [P0/P1 fixes]\n2. **This sprint**: [P2 updates]\n3. **Backlog**: [P3 improvements, coverage gaps]\n```\n\n## Automation Integration\n\n### With PostToolUse Hook\n\nThe hook tracks edits to files covered by Intent Layer. The auditor can:\n1. Read accumulated flags from hook output\n2. Focus validation on frequently-edited areas\n3. Prioritize nodes covering actively-developed code\n\n### Scheduled Runs\n\nRecommend running auditor:\n- **Weekly**: Quick staleness check (`detect_staleness.sh` only)\n- **Monthly**: Full validation of flagged nodes\n- **Quarterly**: Complete audit of all nodes\n\n## Scripts Reference\n\n| Script | Purpose | When Used |\n|--------|---------|-----------|\n| `show_hierarchy.sh` | List all nodes | Step 1: Discovery |\n| `detect_staleness.sh` | Find outdated nodes | Step 2: Staleness check |\n| `validate_node.sh` | Validate single node | Step 3: Via Validator agent |\n| `show_status.sh` | Health dashboard | Final summary |\n\n## Output Destinations\n\n- **Console**: Summary for interactive use\n- **Markdown file**: Full report for team review\n- **JSON**: Machine-readable for CI integration (future)\n",
        "agents/explorer.md": "---\ndescription: >\n  Analyze a directory and propose AGENTS.md content.\n  Use when setting up new Intent Layer nodes or when a directory is flagged as needing coverage.\ncapabilities:\n  - Analyze directory structure and semantic boundaries\n  - Extract contracts, patterns, and entry points from code\n  - Mine git history for pitfalls and anti-patterns\n  - Propose structured AGENTS.md drafts using templates\n  - Identify cross-cutting concerns for LCA placement\n---\n\n# Intent Layer Explorer\n\nAnalyzes directories and proposes AGENTS.md content for Intent Layer coverage.\n\n## When to Use\n\n- Setting up Intent Layer in a new codebase\n- Adding coverage to a directory that lacks an AGENTS.md\n- User asks to \"add intent layer to X\" or \"create AGENTS.md for Y\"\n\n## Process\n\n### 1. Analyze Directory Structure\n\nRun the structure analysis script to understand boundaries:\n\n```bash\n${CLAUDE_PLUGIN_ROOT}/scripts/analyze_structure.sh <directory>\n```\n\nThis identifies:\n- Package/module boundaries\n- Semantic clusters (related files)\n- Recommended node placement\n\n### 2. Estimate Token Budget\n\nCheck if the directory needs its own node or can be covered by a parent:\n\n```bash\n${CLAUDE_PLUGIN_ROOT}/scripts/estimate_tokens.sh <directory>\n```\n\nTarget: <4k tokens per node, 100:1 compression ratio.\n\n### 3. Mine Git History (if applicable)\n\nFor directories with significant git history (>50 commits), extract pitfalls:\n\n```bash\n${CLAUDE_PLUGIN_ROOT}/scripts/mine_git_history.sh <directory>\n```\n\nThis reveals:\n- Bug patterns from fix commits\n- Anti-patterns from reverts\n- Architecture decisions from refactors\n\n### 4. Draft AGENTS.md\n\nUsing the templates in `${CLAUDE_PLUGIN_ROOT}/references/templates.md`, create a draft with:\n\n**Required sections:**\n- TL;DR (one-line summary)\n- Entry Points (where to start)\n- Contracts (invariants, constraints)\n\n**Optional sections (based on analysis):**\n- Pitfalls (from git history mining)\n- Patterns (if non-obvious)\n- Anti-Patterns (from reverts/fixes)\n\n### 5. Validate Draft\n\nBefore presenting to user, run validation:\n\n```bash\n${CLAUDE_PLUGIN_ROOT}/scripts/validate_node.sh <draft-path>\n```\n\n## Output Format\n\nPresent the draft with confidence scores:\n\n```markdown\n## Proposed AGENTS.md for <directory>\n\n### Confidence Scores\n- Contracts: HIGH (verified in code)\n- Entry Points: HIGH (found in imports)\n- Pitfalls: MEDIUM (mined from 23 commits)\n- Patterns: LOW (inferred, needs review)\n\n### Draft Content\n[AGENTS.md content here]\n\n### Review Notes\n- [Items needing human verification]\n```\n\n## Integration with Other Agents\n\nAfter explorer creates a draft:\n1. **Validator** should verify accuracy against actual code\n2. User reviews and approves\n3. Write the final AGENTS.md\n\n## Templates Reference\n\nLoad templates from: `${CLAUDE_PLUGIN_ROOT}/references/templates.md`\n\nUse compression techniques from: `${CLAUDE_PLUGIN_ROOT}/references/compression-techniques.md`\n",
        "agents/validator.md": "---\ndescription: >\n  Deep validation that an Intent Layer node accurately reflects its codebase.\n  Use after creating/updating nodes or as part of PR review.\ncapabilities:\n  - Compare documented contracts against actual code enforcement\n  - Verify entry points exist and are accurate\n  - Check documented patterns are actually followed\n  - Flag undocumented patterns that appear frequently\n  - Generate validation reports with PASS/WARN/FAIL status\n---\n\n# Intent Layer Validator\n\nValidates that AGENTS.md/CLAUDE.md nodes accurately reflect their covered codebase.\n\n## When to Use\n\n- After creating or updating an Intent Layer node\n- As part of PR review when changes touch covered areas\n- When user asks to \"validate intent layer\" or \"check AGENTS.md accuracy\"\n- Before marking a node as production-ready\n\n## Validation Process\n\n### 1. Load the Node\n\nRead the AGENTS.md file and parse its sections:\n\n```bash\n${CLAUDE_PLUGIN_ROOT}/scripts/validate_node.sh <path-to-agents-md>\n```\n\nThe script provides structural validation. This agent does deep semantic validation.\n\n### 2. Validate Each Section\n\n#### Contracts Validation\n\nFor each documented contract:\n1. Search for enforcement in code (guards, assertions, type checks)\n2. Look for violations that would indicate stale documentation\n3. Check if contract scope matches reality\n\n**Validation criteria:**\n- PASS: Contract enforced in code, no violations found\n- WARN: Contract mentioned but enforcement unclear\n- FAIL: Contract violated in code, or no enforcement exists\n\n#### Entry Points Validation\n\nFor each documented entry point:\n1. Verify file/function exists\n2. Check if it's actually used as an entry point (imported/called)\n3. Look for undocumented entry points\n\n**Validation criteria:**\n- PASS: Entry point exists and is actively used\n- WARN: Entry point exists but usage unclear\n- FAIL: Entry point doesn't exist or is deprecated\n\n#### Pitfalls Validation\n\nFor each documented pitfall:\n1. Check if the pitfall condition still exists in code\n2. Look for recent fixes that might have resolved it\n3. Search for new pitfalls from recent commits\n\n**Validation criteria:**\n- PASS: Pitfall is current and relevant\n- WARN: Pitfall may be outdated (related code changed)\n- FAIL: Pitfall no longer applies (condition removed)\n\n#### Patterns Validation\n\nFor each documented pattern:\n1. Search for pattern usage across covered files\n2. Count adherence vs. violations\n3. Identify undocumented patterns with high usage\n\n**Validation criteria:**\n- PASS: Pattern followed consistently (>80% adherence)\n- WARN: Pattern followed inconsistently (50-80%)\n- FAIL: Pattern not followed (<50%) or contradicted\n\n### 3. Generate Validation Report\n\n```markdown\n## Validation Report: <path-to-node>\n\n### Summary\n- **Overall Status**: PASS | WARN | FAIL\n- **Sections Validated**: N\n- **Issues Found**: X warnings, Y failures\n\n### Section Results\n\n#### Contracts [STATUS]\n| Contract | Status | Evidence |\n|----------|--------|----------|\n| \"Auth required for /api/*\" | PASS | Middleware at api/auth.ts:15 |\n| \"Rate limit 100/min\" | WARN | Config exists but no enforcement found |\n\n#### Entry Points [STATUS]\n| Entry Point | Status | Notes |\n|-------------|--------|-------|\n| src/api/index.ts | PASS | Main API router |\n| src/utils/deprecated.ts | FAIL | File deleted in commit abc123 |\n\n#### Pitfalls [STATUS]\n...\n\n#### Patterns [STATUS]\n...\n\n### Recommendations\n1. [Specific actions to resolve failures]\n2. [Suggestions for warnings]\n3. [Undocumented items to consider adding]\n```\n\n## Integration Points\n\n- **Explorer** → creates draft → **Validator** verifies\n- **Auditor** → spawns **Validator** for each node\n- **PostToolUse hook** → flags files → **Validator** checks affected nodes\n\n## Validation Thresholds\n\n| Status | Meaning | Action Required |\n|--------|---------|-----------------|\n| PASS | Node accurately reflects code | None |\n| WARN | Minor discrepancies or uncertainty | Review recommended |\n| FAIL | Significant inaccuracy detected | Update required |\n\nOverall status is the worst status of any section.\n",
        "eval-harness/README.md": "# Eval Harness\n\nA/B evaluation framework for measuring Claude skill effectiveness.\n\n## Setup\n\n```bash\ncd eval-harness\npython -m venv .venv\nsource .venv/bin/activate\npip install -e \".[dev]\"\n```\n\n## Prerequisites\n\n- Docker running locally\n- `claude` CLI installed and configured\n- Python 3.11+\n\n## Usage\n\n### 1. Scan a repo for bug fix tasks\n\n```bash\neval-harness scan \\\n  --repo https://github.com/expressjs/express \\\n  --output tasks/express.yaml \\\n  --limit 20 \\\n  --docker-image node:20-slim \\\n  --setup \"npm install\" \\\n  --test-command \"npm test\"\n```\n\nReview and curate the generated `tasks/express.yaml` before running evals.\n\n### 2. Run evals\n\n```bash\n# Run with 4 parallel workers\neval-harness run --tasks tasks/express.yaml --parallel 4\n\n# Only simple fixes\neval-harness run --tasks tasks/express.yaml --category simple_fix\n\n# Dry run to see what would run\neval-harness run --tasks tasks/express.yaml --dry-run\n\n# Keep workspaces for debugging\neval-harness run --tasks tasks/express.yaml --keep-workspaces\n```\n\n### 3. View results\n\nResults are written to `results/` as JSON and Markdown:\n\n```bash\ncat results/2026-01-21-143200.md\n```\n\n## Development\n\n```bash\n# Run tests\npytest tests/ -v\n\n# Run with coverage\npytest tests/ -v --cov=lib\n```\n\n## How It Works\n\n1. **Scan**: Mine git history for bug fix commits\n2. **Clone**: Create isolated workspaces per task/condition\n3. **Setup**: Run Docker-based dependency installation\n4. **With Skill**: Generate AGENTS.md via intent-layer skill\n5. **Execute**: Run Claude to fix the bug\n6. **Verify**: Run tests in Docker to check success\n7. **Report**: Generate JSON + Markdown with deltas\n\n## Metrics Captured\n\n- Success rate (test passes)\n- Wall clock time\n- Input/output tokens\n- Tool calls\n- Lines changed\n- Files touched\n",
        "hooks/hooks.json": "{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/post-edit-check.sh \\\"$TOOL_INPUT\\\"\"\n          }\n        ]\n      }\n    ],\n    \"PostToolUseFailure\": [\n      {\n        \"matcher\": \"Edit|Write|NotebookEdit|Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/capture-tool-failure.sh\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"SessionStart\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/inject-learnings.sh\",\n            \"timeout\": 15\n          }\n        ]\n      }\n    ],\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Edit|Write|NotebookEdit\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/pre-edit-check.sh\",\n            \"timeout\": 10\n          }\n        ]\n      }\n    ],\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"prompt\",\n            \"prompt\": \"You are evaluating this session for Intent Layer learnings.\\n\\nContext: $ARGUMENTS\\n\\n## Check 1: Skeleton Reports\\nIf any SKELETON-*.md files were auto-created in .intent-layer/mistakes/pending/ during this session, evaluate each one:\\n- If the failure revealed a genuine gotcha → enrich as pitfall\\n- If just exploratory (typo, expected failure) → discard\\n\\n## Check 2: Other Learnings\\nReview the session for undocumented insights. Consider ALL learning types:\\n\\n1. **Pitfalls** - Things that went wrong, gotchas to avoid\\n2. **Checks** - Verifications needed before certain actions\\n3. **Patterns** - Better approaches discovered, preferred practices\\n4. **Insights** - Important context or background learned\\n\\nLook for:\\n- User corrections to your assumptions\\n- Unexpected behaviors discovered\\n- Better approaches you figured out\\n- Important context that should be documented\\n\\n## Response\\n\\nIf learnings should be captured, respond with:\\n{\\\"ok\\\": false, \\\"reason\\\": \\\"Before ending: run capture_mistake.sh --type [pitfall|check|pattern|insight] to capture: [brief description]\\\"}\\n\\nIf no learnings worth documenting:\\n{\\\"ok\\\": true}\\n\\nBe conservative - only flag genuine documentation gaps. Normal development activities don't need capturing.\",\n            \"timeout\": 30\n          }\n        ]\n      }\n    ]\n  }\n}\n",
        "intent-layer/clean/SKILL.md": "---\nname: clean\ndescription: >\n  Remove the Intent Layer from a repository. Deletes all child AGENTS.md files\n  and removes the Intent Layer section from the root CLAUDE.md.\n---\n\n# Intent Layer Clean\n\nRemove the Intent Layer infrastructure from a repository completely.\n\n## When to Use\n\n- Removing Intent Layer from a project entirely\n- Starting fresh after Intent Layer has drifted beyond repair\n- Cleaning up before a major architectural overhaul\n- Removing experimental Intent Layer setup\n\n## Process\n\n### 1. Find All Intent Layer Files\n\n```bash\n# Find child AGENTS.md files (excluding root)\nfind . -name \"AGENTS.md\" -not -path \"./AGENTS.md\" -type f 2>/dev/null\n\n# Check for root AGENTS.md symlink\nls -la ./AGENTS.md 2>/dev/null\n```\n\n### 2. Detect Intent Layer Section in Root\n\nCheck if CLAUDE.md has an Intent Layer section:\n\n```bash\ngrep -n \"^## Intent Layer\" ./CLAUDE.md 2>/dev/null\n```\n\n### 3. Show What Will Be Changed\n\nPresent the full scope to the user:\n\n```markdown\n## Intent Layer Removal Plan\n\n### Files to Delete\n| Path | Size |\n|------|------|\n| src/api/AGENTS.md | 2.1k |\n| src/core/AGENTS.md | 1.8k |\n| ./AGENTS.md (symlink) | - |\n\n### Root CLAUDE.md Changes\n- Remove \"## Intent Layer\" section (lines 45-89)\n\n**Preserved:** ./CLAUDE.md (without Intent Layer section)\n\nTotal: 3 files deleted, 1 section removed\n```\n\n### 4. Confirm with User\n\nAsk: \"Remove Intent Layer completely? This will delete X files and remove the Intent Layer section from CLAUDE.md.\"\n\n- If user confirms: proceed\n- If user declines: abort\n\n### 5. Execute Removal\n\n#### Delete Child AGENTS.md Files\n\n```bash\nrm [path/to/AGENTS.md]\n```\n\n#### Remove Root AGENTS.md Symlink (if exists)\n\n```bash\nrm ./AGENTS.md  # Only if it's a symlink to CLAUDE.md\n```\n\n#### Remove Intent Layer Section from CLAUDE.md\n\nRemove the `## Intent Layer` section and everything until the next `## ` heading (or end of file).\n\nPattern to match and remove:\n- Starts with `## Intent Layer` (with optional text after)\n- Ends at next `## ` heading or EOF\n- Include any blank lines before the next section\n\n### 6. Report Results\n\n```markdown\n## Intent Layer Removed\n\n### Deleted Files\n- src/api/AGENTS.md\n- src/core/AGENTS.md\n- ./AGENTS.md (symlink)\n\n### Modified Files\n- ./CLAUDE.md (Intent Layer section removed)\n\nTo restore Intent Layer: /intent-layer\n```\n\n## Safety\n\n- **Root CLAUDE.md preserved** - Only the Intent Layer section is removed, other content stays\n- **Requires confirmation** - Shows full plan before any changes\n- **Section detection** - Only removes if `## Intent Layer` heading exists\n- **Symlink-aware** - Only removes root AGENTS.md if it's a symlink\n\n## What Happens\n\n| Item | Action |\n|------|--------|\n| `./CLAUDE.md` | Intent Layer section removed |\n| `./AGENTS.md` | Deleted if symlink to CLAUDE.md |\n| `src/*/AGENTS.md` | Deleted |\n| Other CLAUDE.md content | Preserved |\n\n## Edge Cases\n\n### No Intent Layer Section in CLAUDE.md\nIf the root has no `## Intent Layer` section, skip that step and only delete AGENTS.md files.\n\n### No Child AGENTS.md Files\nIf no child files exist, only remove the section from CLAUDE.md.\n\n### AGENTS.md is Not a Symlink\nIf root AGENTS.md is a real file (not symlink), warn user and ask whether to delete it.\n\n## Output\n\nConfirmation of all deleted files and modified sections, with reminder of how to restore.\n",
        "skills/intent-layer-maintenance/SKILL.md": "---\nname: intent-layer-maintenance\ndescription: >\n  Use when maintaining an existing Intent Layer, during quarterly reviews,\n  after significant code changes, when something confused you, or when\n  user asks to audit/update CLAUDE.md or AGENTS.md files.\nargument-hint: \"[/path/to/project] [--post-incident | --post-refactor | --quarterly]\"\n---\n\n# Intent Layer Maintenance\n\nRun the maintenance flywheel for projects with an existing Intent Layer.\n\n## Prerequisites\n\n- Project must have Intent Layer state = `complete`\n- Run `intent-layer` skill first if state is `none` or `partial`\n\n## Workflow\n\n```dot\ndigraph maintenance {\n  rankdir=TB;\n\n  \"Start\" [shape=ellipse];\n  \"Verify state=complete\" [shape=box];\n  \"State complete?\" [shape=diamond];\n  \"Run intent-layer skill\" [shape=box];\n  \"Measure token growth\" [shape=box];\n  \"Any >20k threshold?\" [shape=diamond];\n  \"Flag child node candidates\" [shape=box];\n  \"Ask pain point questions\" [shape=box];\n  \"Map findings to sections\" [shape=box];\n  \"Present update proposal\" [shape=box];\n  \"User approves?\" [shape=diamond];\n  \"Apply updates\" [shape=box];\n  \"Done\" [shape=ellipse];\n\n  \"Start\" -> \"Verify state=complete\";\n  \"Verify state=complete\" -> \"State complete?\" ;\n  \"State complete?\" -> \"Run intent-layer skill\" [label=\"no\"];\n  \"State complete?\" -> \"Measure token growth\" [label=\"yes\"];\n  \"Run intent-layer skill\" -> \"Done\";\n  \"Measure token growth\" -> \"Any >20k threshold?\";\n  \"Any >20k threshold?\" -> \"Flag child node candidates\" [label=\"yes\"];\n  \"Any >20k threshold?\" -> \"Ask pain point questions\" [label=\"no\"];\n  \"Flag child node candidates\" -> \"Ask pain point questions\";\n  \"Ask pain point questions\" -> \"Map findings to sections\";\n  \"Map findings to sections\" -> \"Present update proposal\";\n  \"Present update proposal\" -> \"User approves?\";\n  \"User approves?\" -> \"Apply updates\" [label=\"yes\"];\n  \"User approves?\" -> \"Done\" [label=\"no\"];\n  \"Apply updates\" -> \"Done\";\n}\n```\n\n## Step 1: Verify State\n\n```bash\n# From intent-layer skill\nscripts/detect_state.sh /path/to/project\n```\n\nIf state is not `complete`, redirect to `intent-layer` skill for initial setup.\n\n## Step 2: Measure Token Growth\n\nUse the consolidated measurement script to analyze all candidates at once:\n\n```bash\n# Recommended: Auto-discover and measure all candidates\nscripts/estimate_all_candidates.sh /path/to/project\n\n# Or measure individual directories manually:\nscripts/estimate_tokens.sh /path/to/project/src\nscripts/estimate_tokens.sh /path/to/project/lib\n```\n\n**Thresholds:**\n- Directory >20k tokens → candidate for child AGENTS.md\n- Directory grew >50% since last audit → review coverage\n\n## Step 3: Ask Pain Point Questions\n\nGenerate a structured template to capture findings:\n\n```bash\nscripts/capture_pain_points.sh pain_points.md\n# Then fill in the generated template\n```\n\nThese questions surface tribal knowledge that should be documented:\n\n### Recent Pitfalls (distinct from Anti-patterns)\n- \"What surprised you in the last 3 months?\"\n- \"What looked deprecated/unused but actually wasn't?\"\n- \"What broke silently when someone made a reasonable assumption?\"\n- \"What implicit assumption bit someone?\"\n\n### Contract Violations\n- \"Did any invariant get violated? Should we document it?\"\n- \"Did external consumers break because of API changes?\"\n- \"Are there new 'must never happen' rules?\"\n\n### Architecture Changes\n- \"Were any significant technical decisions made?\"\n- \"Should we link to new ADRs or design docs?\"\n- \"Did subsystem boundaries shift?\"\n\n### Entry Point Changes\n- \"Are there new common tasks that need routing?\"\n- \"Did any entry points move or get renamed?\"\n\n## Step 4: Map Findings to Sections\n\n| Finding Type | Target Section |\n|--------------|----------------|\n| Surprising behavior | Pitfalls |\n| \"Never do X\" rule | Anti-patterns |\n| Must-be-true constraint | Contracts & Invariants |\n| Technical decision rationale | Architecture Decisions |\n| New common task | Entry Points |\n| New subsystem | Subsystem Boundaries |\n| Relationship to external | Related Context |\n| New/moved child node | Downlinks |\n| Changed parent/sibling | Navigation |\n\n## Step 5: Present Update Proposal\n\nShow user exactly what will change:\n\n```markdown\n## Proposed Updates to CLAUDE.md\n\n### Pitfalls (adding 2)\n+ `config/legacy.json` looks unused but controls feature flags for enterprise clients\n+ Running `make clean` deletes cached auth tokens - must re-authenticate\n\n### Contracts (adding 1)\n+ API v2 endpoints require `X-Request-ID` header (enforced by gateway, not code)\n\n### No changes needed\n- Anti-patterns\n- Architecture Decisions\n- Entry Points\n```\n\n## Step 6: Apply Updates (if approved)\n\nEdit the CLAUDE.md file to add new items to appropriate sections.\n\n**Validation after update:**\n- Node still <4k tokens\n- No duplication with ancestor nodes\n- Relative paths for internal links\n- Downlinks point to existing child nodes\n- Navigation links (parent/siblings) are accurate\n\n## Quick Reference\n\n| Audit Type | Focus |\n|------------|-------|\n| Quarterly review | Full: tokens + all question categories |\n| Post-incident | Pitfalls + Contracts that were violated |\n| After refactor | Entry Points + Subsystem Boundaries |\n| After new feature | Architecture Decisions + Patterns |\n\n## Common Mistakes\n\n| Mistake | Fix |\n|---------|-----|\n| Conflating Pitfalls with Anti-patterns | Pitfalls = surprising truth. Anti-patterns = things to avoid. |\n| Adding every small finding | Only add if it would confuse future agents/engineers |\n| Not measuring before asking | Always measure first - growth data informs questions |\n| Updating without proposal | Show changes, get approval, then apply |\n\n## On Merge/PR: Detect Affected Nodes\n\nWhen code changes (e.g., after merge), identify which Intent Nodes need review:\n\n```bash\nscripts/detect_changes.sh main HEAD\n```\n\nThis outputs affected nodes in leaf-first order. Check each for behavior changes.\n\n---\n\n## Parallel Audit (Large Intent Layers)\n\nFor Intent Layers with 4+ nodes, use parallel subagents to speed up audits.\n\n### When to Use Parallel Audit\n\n| Node Count | Approach |\n|------------|----------|\n| 1-3 nodes | Sequential (standard workflow) |\n| 4-8 nodes | Parallel validation + gap detection |\n| 9+ nodes | Full parallel mode |\n\n### Parallel Validation\n\nValidate all nodes simultaneously with multiple Task calls in a single message:\n\n```\nTask 1 (Explore): \"Validate CLAUDE.md against the codebase. Check:\n                   - Are Entry Points still accurate?\n                   - Are Contracts still enforced?\n                   - Are Pitfalls still relevant?\n                   - Any new patterns not documented?\n                   Return: list of stale items + missing items\"\n\nTask 2 (Explore): \"Validate src/api/AGENTS.md against src/api/. Check:\n                   - Are Entry Points still accurate?\n                   - Are Contracts still enforced?\n                   - Are Pitfalls still relevant?\n                   Return: list of stale items + missing items\"\n\nTask 3 (Explore): \"Validate src/core/AGENTS.md against src/core/. Check:\n                   [same questions]\"\n```\n\n### Parallel Gap Detection\n\nFind undocumented areas across the codebase:\n\n```\nTask 1 (Explore): \"Search for error handling patterns in src/. Find:\n                   - try/catch patterns that aren't documented\n                   - Silent failures that should be Pitfalls\n                   - Error contracts not in any AGENTS.md\"\n\nTask 2 (Explore): \"Search for API contracts in src/. Find:\n                   - Input validation rules not documented\n                   - Response shapes not in Contracts\n                   - Auth/permissions not documented\"\n\nTask 3 (Explore): \"Search for integration points in src/. Find:\n                   - External service calls\n                   - Database access patterns\n                   - Message queue usage\n                   Check if documented in nearest AGENTS.md\"\n```\n\n### Parallel Post-Incident Review\n\nAfter an incident, audit relevant nodes in parallel:\n\n```\nTask 1 (Explore): \"Review [incident area] for Pitfalls. Find:\n                   - What assumption was violated?\n                   - What would have prevented this?\n                   - What should be added to Pitfalls?\"\n\nTask 2 (Explore): \"Review [incident area] for Contract gaps. Find:\n                   - What invariant was broken?\n                   - What constraint should be documented?\n                   - What boundary was crossed?\"\n```\n\n### Synthesizing Parallel Results\n\nAfter parallel agents complete:\n\n1. **Collect all findings** into a unified list\n2. **Deduplicate** items found by multiple agents\n3. **Categorize** by target section (Pitfalls, Contracts, Entry Points)\n4. **Prioritize** by impact (incident-related > gaps > stale items)\n5. **Present proposal** to user for approval\n\n### Parallel Audit Benefits\n\n| Metric | Sequential | Parallel |\n|--------|------------|----------|\n| 5-node audit | ~20 min | ~7 min |\n| 10-node audit | ~40 min | ~10 min |\n| Coverage consistency | Variable | Uniform |\n\n---\n\n## Agent-Driven Capture (Alternative)\n\nFor complex areas where template-based capture (`capture_pain_points.sh`) feels insufficient, use agent-driven capture:\n\n1. Agent examines code, proposes descriptions, asks questions\n2. Human corrects, answers, adds historical context\n3. Iterate until description matches mental model\n\nSee `references/capture-workflow-agent.md` for the full three-phase process.\n\nUse `scripts/capture_state.sh` to generate a tracking template for open questions during capture.\n\n---\n\n## Scripts Location\n\nThis skill uses scripts from the `intent-layer` skill:\n\n| Script | Purpose |\n|--------|---------|\n| `detect_state.sh` | Check state (none/partial/complete) |\n| `estimate_tokens.sh` | Measure single directory |\n| `estimate_all_candidates.sh` | Measure all candidates at once |\n| `capture_pain_points.sh` | Generate pain points template |\n| `capture_state.sh` | Track open questions during capture |\n| `detect_changes.sh` | Find affected nodes on merge/PR |\n| `analyze_structure.sh` | Find semantic boundaries |\n| `validate_node.sh` | Check node quality after updates |\n\n**References:**\n- `references/templates.md` - Templates (S/M/L), three-tier boundaries\n- `references/compression-techniques.md` - Compression techniques, LCA placement, parent node compression\n- `references/capture-workflow-agent.md` - Agent-driven capture workflow\n- `references/agent-feedback-protocol.md` - How agents surface missing context\n\nAll paths: `${CLAUDE_PLUGIN_ROOT}/`\n",
        "skills/intent-layer-onboarding/SKILL.md": "---\nname: intent-layer-onboarding\ndescription: >\n  Get oriented in an unfamiliar codebase using its Intent Layer.\n  Use when joining a new project, exploring a codebase for the first time,\n  or helping someone understand \"where do I start?\" questions.\nargument-hint: \"[/path/to/project] [--role <role>] [--task <first-task>]\"\n---\n\n# Intent Layer Onboarding\n\nUse an existing Intent Layer to quickly orient yourself (or a new team member) in a codebase.\n\n## Prerequisites\n\n- Project must have Intent Layer state = `complete`\n- Run `intent-layer` skill first if state is `none` or `partial`\n\n## Quick Start\n\n```bash\n# Check Intent Layer exists\n${CLAUDE_PLUGIN_ROOT}/scripts/detect_state.sh /path/to/project\n\n# Generate orientation overview\nscripts/generate_orientation.sh /path/to/project\n\n# View hierarchy\n${CLAUDE_PLUGIN_ROOT}/scripts/show_hierarchy.sh /path/to/project\n```\n\n---\n\n## The 15-Minute Orientation\n\nGet productive in a new codebase in 15 minutes using this workflow.\n\n### Step 1: Read the Root (2 min)\n\nRead the root CLAUDE.md or AGENTS.md completely. Focus on:\n\n- **TL;DR** - One sentence project purpose\n- **Subsystem Boundaries** - Major areas and owners\n- **Contracts** - Global rules that apply everywhere\n- **Pitfalls** - Surprises that bite newcomers\n\n```bash\n# Find and display root node\ncat /path/to/project/CLAUDE.md || cat /path/to/project/AGENTS.md\n```\n\n### Step 2: Map the Hierarchy (2 min)\n\nVisualize the full Intent Layer structure:\n\n```bash\n${CLAUDE_PLUGIN_ROOT}/scripts/show_hierarchy.sh /path/to/project\n```\n\nNote:\n- How many child nodes exist\n- Which areas have the most documentation (complexity signals)\n- Depth of hierarchy (shallow = simple, deep = complex)\n\n### Step 3: Identify Your Entry Point (3 min)\n\nBased on your role or first task, find where to start:\n\n| If your role is... | Start with... |\n|-------------------|---------------|\n| Frontend engineer | UI/components AGENTS.md |\n| Backend engineer | API/services AGENTS.md |\n| DevOps/Platform | Infrastructure AGENTS.md |\n| Full-stack | Root node + busiest subsystem |\n\n| If your first task is... | Find... |\n|-------------------------|---------|\n| Bug fix in area X | AGENTS.md closest to X |\n| New feature | Entry Points in relevant subsystem |\n| Understanding flow | Root → follow data path |\n\n### Step 4: Deep-Read Your Area (5 min)\n\nFor your identified entry point:\n\n1. Read the specific AGENTS.md completely\n2. Note the **Entry Points** - these are your starting files\n3. Note the **Contracts** - rules you must follow\n4. Note the **Pitfalls** - traps to avoid\n\n### Step 5: Verify Understanding (3 min)\n\nTest your mental model:\n\n1. Can you explain the project in one sentence?\n2. Do you know where your first change goes?\n3. Do you know what rules apply to that area?\n4. Do you know what NOT to do?\n\nIf any answer is \"no\", re-read the relevant node.\n\n---\n\n## Role-Based Onboarding\n\n### For AI Agents\n\nWhen an AI agent needs to understand a new codebase:\n\n**Minimum context load:**\n1. Root node (always)\n2. Node for target area (if known)\n3. Ancestors of target (for inherited constraints)\n\n**Query pattern:**\n```\n\"I need to [task] in [area]. What should I know?\"\n```\n\n**Response pattern:**\n```markdown\n## Context for [task]\n\n### Relevant Node\n`path/to/AGENTS.md`\n\n### Key Constraints\n- [From local node]\n- [Inherited from ancestors]\n\n### Entry Point\nStart at: `path/to/file.ts`\n\n### Watch Out For\n- [Pitfall 1]\n- [Pitfall 2]\n```\n\n### For New Engineers\n\nWhen a human is joining the team:\n\n**Day 1 Goals:**\n1. Understand project purpose (root TL;DR)\n2. Know major subsystems (root Subsystem Boundaries)\n3. Know global rules (root Contracts)\n4. Know what surprises exist (root Pitfalls)\n\n**Week 1 Goals:**\n1. Deep-read your team's AGENTS.md files\n2. Understand your area's specific contracts\n3. Successfully complete one small task\n4. Know where to ask questions\n\n**Onboarding Checklist:**\n```markdown\n## Onboarding Checklist: [Name]\n\n### Day 1\n- [ ] Read root CLAUDE.md/AGENTS.md\n- [ ] Run show_hierarchy.sh to see structure\n- [ ] Identify which subsystem I'll work in\n- [ ] Read my subsystem's AGENTS.md\n\n### Week 1\n- [ ] Complete first small task\n- [ ] Verify I followed all contracts\n- [ ] Note any confusion for Intent Layer feedback\n- [ ] Ask about anything not documented\n```\n\n### For Code Reviewers\n\nWhen reviewing code in an unfamiliar area:\n\n1. Find AGENTS.md for the changed files\n2. Check Contracts section - are they followed?\n3. Check Pitfalls section - are they avoided?\n4. Check Anti-patterns section - none introduced?\n\n---\n\n## Task-Based Onboarding\n\n### \"I need to fix a bug in X\"\n\n**Workflow:**\n1. Find AGENTS.md nearest to X\n2. Read Pitfalls (often explains the bug)\n3. Read Contracts (constraints on the fix)\n4. Find Entry Point for debugging\n\n**Output:**\n```markdown\n## Bug Fix Context: [area]\n\n**Relevant Node:** `path/to/AGENTS.md`\n\n**Common Pitfalls (check these first):**\n- [Pitfall that might explain bug]\n\n**Fix Constraints:**\n- [Rules the fix must follow]\n\n**Start Debugging At:**\n- `path/to/entry/file.ts`\n```\n\n### \"I need to add a feature to Y\"\n\n**Workflow:**\n1. Find AGENTS.md for Y\n2. Check if feature is in scope (vs out of scope)\n3. Read Entry Points for \"add new...\"\n4. Read Contracts for implementation rules\n5. Check parent nodes for inherited constraints\n\n**Output:**\n```markdown\n## Feature Context: [feature] in [area]\n\n**In Scope:** Yes/No (from AGENTS.md)\n\n**Entry Point:**\n- Start at: `path/to/file.ts`\n- Pattern to follow: [from Entry Points]\n\n**Constraints:**\n- [Local rules]\n- [Inherited rules]\n\n**Related Areas:**\n- [Siblings that might be affected]\n```\n\n### \"I need to understand how Z works\"\n\n**Workflow:**\n1. Find AGENTS.md that owns Z\n2. Read TL;DR for high-level understanding\n3. Read Architecture Decisions for rationale\n4. Follow Entry Points to key files\n5. Read ancestors for broader context\n\n**Output:**\n```markdown\n## Understanding: [Z]\n\n**Owner:** `path/to/AGENTS.md`\n\n**TL;DR:**\n> [From node]\n\n**Why It's Designed This Way:**\n- [From Architecture Decisions]\n\n**Key Files to Read:**\n1. `file1.ts` - [purpose]\n2. `file2.ts` - [purpose]\n\n**Broader Context:**\n- [From parent nodes]\n```\n\n---\n\n## Generating Orientation Documents\n\nFor teams that want a static onboarding doc:\n\n### Quick Overview\n\n```bash\nscripts/generate_orientation.sh /path/to/project --format overview\n```\n\nProduces:\n- Project summary\n- Subsystem map\n- Global rules\n- Common tasks entry points\n\n### Full Onboarding Guide\n\n```bash\nscripts/generate_orientation.sh /path/to/project --format full\n```\n\nProduces:\n- Everything in overview\n- Per-subsystem deep dives\n- Role-based entry points\n- First-week checklist\n\n### Team-Specific\n\n```bash\nscripts/generate_orientation.sh /path/to/project --role backend\n```\n\nProduces:\n- Filtered view for backend engineers\n- Relevant subsystems only\n- Backend-specific entry points\n\n---\n\n## Interactive Onboarding Session\n\nFor a guided, interactive orientation:\n\n### Step 1: Gather Context\n\nAsk the newcomer:\n1. What's your role? (frontend/backend/fullstack/devops/other)\n2. What's your first task? (if known)\n3. What's your experience level? (junior/mid/senior)\n\n### Step 2: Generate Personalized Path\n\nBased on answers, create a reading list:\n\n**Junior + No specific task:**\n```markdown\n## Your Onboarding Path\n\n1. **Start Here:** CLAUDE.md (root) - 10 min read\n2. **Then:** [area matching role]/AGENTS.md - 5 min read\n3. **Exercise:** Find where [simple task] would be done\n4. **Verify:** Explain the project back to me\n```\n\n**Senior + Specific task:**\n```markdown\n## Your Onboarding Path\n\n1. **Quick Scan:** CLAUDE.md TL;DR + Subsystems - 2 min\n2. **Deep Read:** [task area]/AGENTS.md - 5 min\n3. **Context:** Walk ancestors for inherited rules - 3 min\n4. **Start:** [Entry point for task]\n```\n\n### Step 3: Verify Understanding\n\nAfter they complete the path, ask:\n1. \"What does this project do in one sentence?\"\n2. \"Where would you make your first change?\"\n3. \"What rules must you follow there?\"\n4. \"What mistakes should you avoid?\"\n\nIf answers are weak, point them to specific sections.\n\n### Step 4: Capture Gaps\n\nIf they found the Intent Layer confusing or incomplete:\n\n```markdown\n### Intent Layer Feedback\n\n| Type | Location | Finding |\n|------|----------|---------|\n| Unclear | `src/api/AGENTS.md` | Entry Points don't explain X |\n| Missing | `CLAUDE.md` | No mention of Y subsystem |\n```\n\nFeed this back via `intent-layer-maintenance` skill.\n\n---\n\n## Common Questions\n\n### \"Where do I start?\"\n\n1. Run `show_hierarchy.sh` to see structure\n2. Read root node for project overview\n3. Identify your area from Subsystem Boundaries\n4. Read that area's AGENTS.md\n5. Follow its Entry Points\n\n### \"What can I safely change?\"\n\n1. Find AGENTS.md for the area\n2. Check **Contracts** - these are invariants\n3. Check **Anti-patterns** - don't introduce these\n4. Anything not constrained is fair game\n\n### \"Who owns this code?\"\n\n1. Find nearest AGENTS.md (walk up if needed)\n2. Check TL;DR for ownership statement\n3. Check Subsystem Boundaries in parent for team info\n\n### \"Why is it done this way?\"\n\n1. Find AGENTS.md for the area\n2. Check **Architecture Decisions** section\n3. Follow any ADR links\n4. If not documented, flag as feedback\n\n---\n\n## Parallel Onboarding (Teams & Multiple Roles)\n\nFor onboarding multiple people or generating comprehensive multi-role documentation, use parallel subagents.\n\n### When to Use Parallel Onboarding\n\n| Scenario | Approach |\n|----------|----------|\n| Single person, known role | Sequential (standard 15-min workflow) |\n| Single person, exploring roles | Parallel role summaries |\n| Multiple new team members | Parallel per-person paths |\n| Comprehensive onboarding docs | Parallel section generation |\n\n### Parallel Role Summaries\n\nGenerate role-specific orientations simultaneously:\n\n```\nTask 1 (Explore): \"Generate frontend engineer orientation from Intent Layer.\n                   Focus on: UI components, state management, styling patterns.\n                   Return: relevant nodes, key contracts, entry points, pitfalls\"\n\nTask 2 (Explore): \"Generate backend engineer orientation from Intent Layer.\n                   Focus on: API layer, database, services, integrations.\n                   Return: relevant nodes, key contracts, entry points, pitfalls\"\n\nTask 3 (Explore): \"Generate DevOps/platform orientation from Intent Layer.\n                   Focus on: infrastructure, CI/CD, deployment, monitoring.\n                   Return: relevant nodes, key contracts, entry points, pitfalls\"\n```\n\n**Output**: Three role-specific onboarding guides generated in parallel.\n\n### Parallel Comprehensive Documentation\n\nGenerate full onboarding documentation in parallel sections:\n\n```\nTask 1 (Explore): \"Extract project overview from Intent Layer root.\n                   Return: TL;DR, architecture overview, subsystem map\"\n\nTask 2 (Explore): \"Extract all global contracts and pitfalls from Intent Layer.\n                   Return: merged constraints list, common mistakes to avoid\"\n\nTask 3 (Explore): \"Extract all entry points across Intent Layer nodes.\n                   Return: task → starting point mapping for common tasks\"\n\nTask 4 (Explore): \"Identify complexity hotspots from Intent Layer.\n                   Return: areas with most contracts/pitfalls (need careful reading)\"\n```\n\n**Synthesis**: Combine into comprehensive onboarding document.\n\n### Parallel Task-Context Generation\n\nWhen newcomer has multiple potential first tasks:\n\n```\nTask 1 (Explore): \"Generate context for 'fix login bug' task.\n                   Find: relevant node, constraints, pitfalls, entry point\"\n\nTask 2 (Explore): \"Generate context for 'add new API endpoint' task.\n                   Find: relevant node, constraints, pitfalls, entry point\"\n\nTask 3 (Explore): \"Generate context for 'update dashboard component' task.\n                   Find: relevant node, constraints, pitfalls, entry point\"\n```\n\n**Output**: Three task-context summaries, let newcomer pick their starting point.\n\n### Parallel Codebase Exploration\n\nFor AI agents needing to understand unfamiliar codebase quickly:\n\n```\nTask 1 (Explore): \"Read CLAUDE.md root node. Extract: purpose, subsystems,\n                   global constraints, and identify which child nodes exist\"\n\nTask 2 (Explore): \"For each child AGENTS.md, extract: ownership scope,\n                   key contracts, main pitfalls. Return summary table\"\n\nTask 3 (Explore): \"Map data flow through system using Intent Layer.\n                   How does data move between subsystems?\"\n```\n\n**Synthesis**: Complete mental model of codebase in ~5 minutes vs ~15 minutes sequential.\n\n### Example: Parallel Team Onboarding\n\n**Scenario**: 3 new engineers joining (1 frontend, 1 backend, 1 fullstack)\n\n**Parallel execution**:\n```\nTask 1: \"Create onboarding path for frontend engineer.\n         - Identify UI-related AGENTS.md nodes\n         - Extract frontend-specific contracts and pitfalls\n         - List frontend entry points for common tasks\n         - Generate Day 1 and Week 1 checklist\"\n\nTask 2: \"Create onboarding path for backend engineer.\n         - Identify API/service AGENTS.md nodes\n         - Extract backend-specific contracts and pitfalls\n         - List backend entry points for common tasks\n         - Generate Day 1 and Week 1 checklist\"\n\nTask 3: \"Create onboarding path for fullstack engineer.\n         - Identify cross-cutting AGENTS.md nodes\n         - Extract integration contracts and pitfalls\n         - List full-stack entry points\n         - Generate Day 1 and Week 1 checklist\"\n```\n\n**Output**: Three personalized onboarding documents in parallel.\n\n### Parallel Onboarding Benefits\n\n| Scenario | Sequential | Parallel |\n|----------|------------|----------|\n| 3-role documentation | ~30 min | ~10 min |\n| 5-person team onboarding | ~75 min | ~15 min |\n| Comprehensive docs (4 sections) | ~40 min | ~12 min |\n\n---\n\n## Scripts Reference\n\n| Script | Purpose |\n|--------|---------|\n| `generate_orientation.sh` | Create onboarding documents |\n| `show_hierarchy.sh` | Visualize Intent Layer structure |\n| `show_status.sh` | Check Intent Layer health |\n| `query_intent.sh` | Search for specific concepts |\n| `walk_ancestors.sh` | Gather context from hierarchy |\n\nScripts from intent-layer: `${CLAUDE_PLUGIN_ROOT}/scripts/`\nScripts from intent-layer-query: `${CLAUDE_PLUGIN_ROOT}/scripts/`\n\n---\n\n## Anti-Patterns\n\n| Don't Do This | Do This Instead |\n|--------------|-----------------|\n| Skip root, jump to code | Always read root first |\n| Read all nodes exhaustively | Read root + your area |\n| Ignore Pitfalls section | Pitfalls prevent 80% of mistakes |\n| Assume contracts are optional | Contracts are hard requirements |\n| Start coding without reading Entry Points | Entry Points show the correct starting place |\n\n---\n\n## Success Metrics\n\nAfter onboarding, the newcomer should be able to:\n\n1. **Explain** - Describe project purpose in one sentence\n2. **Navigate** - Find the right AGENTS.md for any task\n3. **Comply** - Know constraints that apply to their area\n4. **Avoid** - Know common pitfalls in their area\n5. **Start** - Know exactly which file to open first\n\nIf any of these fail, the Intent Layer may need improvement via maintenance skill.\n",
        "skills/intent-layer-query/SKILL.md": "---\nname: intent-layer-query\ndescription: >\n  Query the Intent Layer to answer questions about the codebase.\n  Use when asking \"what owns X?\", \"where should I put Y?\", \"what constraints apply to Z?\",\n  or navigating an unfamiliar codebase using its AGENTS.md hierarchy.\nargument-hint: \"[/path/to/project] [query]\"\n---\n\n# Intent Layer Query\n\nQuery an existing Intent Layer to answer architectural and navigation questions.\n\n## Prerequisites\n\n- Project must have Intent Layer state = `complete`\n- Run `intent-layer` skill first if state is `none` or `partial`\n\n## Quick Start\n\n```bash\n# Check state first\n${CLAUDE_PLUGIN_ROOT}/scripts/detect_state.sh /path/to/project\n\n# View hierarchy\n${CLAUDE_PLUGIN_ROOT}/scripts/show_hierarchy.sh /path/to/project\n\n# Check health\n${CLAUDE_PLUGIN_ROOT}/scripts/show_status.sh /path/to/project\n```\n\n---\n\n## Query Types\n\n### 1. Ownership Queries\n\n**\"What owns X?\"** - Find responsible component for a concept.\n\n**Process:**\n1. Search all Intent Nodes for the concept\n2. Return the most specific node that claims ownership\n3. Include parent context for full picture\n\n**Example:**\n```\nQ: \"What owns authentication?\"\n\nSearch: grep -r \"authentication\\|auth\" in CLAUDE.md/AGENTS.md files\nResult: src/auth/AGENTS.md owns authentication\nParent: CLAUDE.md references auth as critical subsystem\n```\n\n**Output format:**\n```markdown\n## Ownership: [concept]\n\n**Primary owner:** `path/to/AGENTS.md`\n> [TL;DR from that node]\n\n**Parent context:** `CLAUDE.md`\n> [Relevant excerpt about this area]\n\n**Contracts:**\n- [Any constraints from owner or ancestors]\n```\n\n---\n\n### 2. Placement Queries\n\n**\"Where should I put X?\"** - Find correct location for new code.\n\n**Process:**\n1. Identify the responsibility of X\n2. Find nodes with matching or adjacent responsibilities\n3. Check for explicit \"out of scope\" declarations\n4. Recommend placement with rationale\n\n**Example:**\n```\nQ: \"Where should I put a new payment processor?\"\n\nAnalysis:\n- payments/ exists → check src/payments/AGENTS.md\n- If AGENTS.md says \"owns all payment logic\" → put there\n- If AGENTS.md says \"only Stripe\" → may need new sibling\n```\n\n**Output format:**\n```markdown\n## Placement: [new thing]\n\n**Recommended:** `path/to/directory/`\n**Reason:** [Why this location based on Intent Layer]\n\n**Relevant contracts:**\n- [Constraints that apply to this location]\n\n**Alternatives considered:**\n- `other/path/` - rejected because [reason from Intent Layer]\n```\n\n---\n\n### 3. Constraint Queries\n\n**\"What constraints apply to X?\"** - Gather all rules for an area.\n\n**Process:**\n1. Find the most specific node for X\n2. Walk up to root, collecting constraints\n3. Merge contracts from all ancestors (child overrides parent)\n4. Return unified constraint set\n\n**Example:**\n```\nQ: \"What constraints apply to the API layer?\"\n\nWalk: src/api/AGENTS.md → CLAUDE.md\nCollect:\n- From src/api/AGENTS.md: \"All endpoints must validate auth token\"\n- From CLAUDE.md: \"Never log PII\", \"Use structured logging\"\n```\n\n**Output format:**\n```markdown\n## Constraints: [area]\n\n### From `path/to/specific/AGENTS.md`\n- [Local constraints]\n\n### Inherited from `CLAUDE.md`\n- [Global constraints that apply]\n\n### Effective rules (merged)\n1. [Most important constraint]\n2. [Second constraint]\n...\n```\n\n---\n\n### 4. Entry Point Queries\n\n**\"How do I [task]?\"** - Find starting point for common tasks.\n\n**Process:**\n1. Search Entry Points sections across all nodes\n2. Match task description to documented entry points\n3. Return the most specific match with context\n\n**Example:**\n```\nQ: \"How do I add a new API endpoint?\"\n\nSearch Entry Points for: \"API\", \"endpoint\", \"route\"\nMatch: src/api/AGENTS.md → Entry Points → \"Add endpoint: start at routes/\"\n```\n\n**Output format:**\n```markdown\n## Entry Point: [task]\n\n**Start here:** `path/to/file.ts`\n**From:** `path/to/AGENTS.md`\n\n**Steps:**\n1. [Step from Entry Points section]\n2. [Additional context if available]\n\n**Watch out for:**\n- [Relevant pitfalls from same node]\n```\n\n---\n\n### 5. Pitfall Queries\n\n**\"What can go wrong with X?\"** - Gather warnings for an area.\n\n**Process:**\n1. Find nodes covering X\n2. Collect all Pitfalls sections\n3. Include parent pitfalls that apply\n4. Return consolidated warnings\n\n**Output format:**\n```markdown\n## Pitfalls: [area]\n\n### Critical (from nearest node)\n- [Pitfall 1]\n- [Pitfall 2]\n\n### Inherited (from ancestors)\n- [Global pitfall that applies]\n\n### Related anti-patterns\n- [Things to avoid]\n```\n\n---\n\n### 6. Architecture Queries\n\n**\"Why is X designed this way?\"** - Find rationale for decisions.\n\n**Process:**\n1. Search Architecture Decisions sections\n2. Look for ADR links\n3. Check Related Context for external docs\n\n**Output format:**\n```markdown\n## Architecture: [topic]\n\n**Decision:** [What was decided]\n**Rationale:** [Why, from Architecture Decisions section]\n**Source:** `path/to/AGENTS.md` or linked ADR\n\n**Related:**\n- [Links to ADRs or design docs]\n```\n\n---\n\n## Interactive Query Workflow\n\nFor complex queries, use this interactive process:\n\n### Step 1: Understand the Question\n\nClassify the query:\n- Ownership → \"What owns...\"\n- Placement → \"Where should...\"\n- Constraints → \"What rules...\"\n- Entry Point → \"How do I...\"\n- Pitfalls → \"What can go wrong...\"\n- Architecture → \"Why is...\"\n\n### Step 2: Gather Context\n\n```bash\n# View full hierarchy\n${CLAUDE_PLUGIN_ROOT}/scripts/show_hierarchy.sh /path/to/project\n\n# Search for concept in Intent Nodes\ngrep -r \"concept\" --include=\"CLAUDE.md\" --include=\"AGENTS.md\" /path/to/project\n```\n\n### Step 3: Walk the Hierarchy\n\nFor the relevant node:\n1. Read the specific node\n2. Read each ancestor up to root\n3. Collect relevant sections\n\n### Step 4: Synthesize Answer\n\nCombine findings into the appropriate output format (see Query Types above).\n\n### Step 5: Cite Sources\n\nAlways include:\n- Which nodes provided the answer\n- Line numbers for specific claims\n- Confidence level (explicit vs inferred)\n\n---\n\n## Query Confidence Levels\n\n| Level | Meaning |\n|-------|---------|\n| **Explicit** | Directly stated in Intent Node |\n| **Inferred** | Derived from multiple nodes |\n| **Uncertain** | Not documented, using code analysis |\n\nAlways state confidence:\n```markdown\n**Confidence:** Explicit (from src/auth/AGENTS.md:15)\n```\n\nor\n\n```markdown\n**Confidence:** Inferred (no direct documentation, based on code structure)\n**Recommendation:** Add to Intent Layer via maintenance skill\n```\n\n---\n\n## When Query Fails\n\nIf the Intent Layer doesn't answer the question:\n\n### 1. Document the Gap\n\n```markdown\n### Intent Layer Feedback\n\n| Type | Location | Finding |\n|------|----------|---------|\n| Missing ownership | `CLAUDE.md` | No documented owner for [concept] |\n```\n\n### 2. Answer from Code\n\nFall back to code analysis, but flag uncertainty:\n\n```markdown\n## Answer (from code analysis)\n\n**Confidence:** Uncertain - not documented in Intent Layer\n\n[Answer based on code reading]\n\n**Recommendation:** Document this in [suggested node]\n```\n\n### 3. Trigger Maintenance\n\nIf multiple gaps found, suggest running `intent-layer-maintenance` skill.\n\n---\n\n## Parallel Queries (Large Intent Layers)\n\nFor Intent Layers with 5+ nodes or complex multi-faceted queries, use parallel subagents.\n\n### When to Use Parallel Queries\n\n| Scenario | Approach |\n|----------|----------|\n| Single concept, small Intent Layer | Sequential search |\n| Single concept, large Intent Layer (5+ nodes) | Parallel node search |\n| Multi-faceted query (ownership + constraints + pitfalls) | Parallel aspect search |\n| Cross-cutting concern investigation | Parallel subsystem search |\n\n### Parallel Node Search\n\nSearch all nodes simultaneously for a concept:\n\n```\nTask 1 (Explore): \"Search CLAUDE.md for references to [concept].\n                   Return: any mentions, ownership claims, constraints, pitfalls\"\n\nTask 2 (Explore): \"Search src/api/AGENTS.md for references to [concept].\n                   Return: any mentions, ownership claims, constraints, pitfalls\"\n\nTask 3 (Explore): \"Search src/core/AGENTS.md for references to [concept].\n                   Return: any mentions, ownership claims, constraints, pitfalls\"\n```\n\n**Synthesis**: Combine results, identify primary owner (most specific claim), collect all constraints.\n\n### Parallel Aspect Search\n\nFor complex queries needing multiple perspectives:\n\n```\nQ: \"What do I need to know to add a new payment provider?\"\n\nTask 1 (Explore): \"Search Intent Layer for ownership of payments.\n                   Who owns payment logic? What's in scope/out of scope?\"\n\nTask 2 (Explore): \"Search Intent Layer for payment-related contracts.\n                   What invariants apply? What patterns are required?\"\n\nTask 3 (Explore): \"Search Intent Layer for payment-related pitfalls.\n                   What surprises exist? What has broken before?\"\n\nTask 4 (Explore): \"Search Intent Layer for payment entry points.\n                   How do I add new payment functionality?\"\n```\n\n**Synthesis**: Combine into comprehensive answer covering ownership, constraints, warnings, and starting point.\n\n### Parallel Cross-Cutting Search\n\nFor concepts that span multiple subsystems:\n\n```\nQ: \"How is authentication handled across the system?\"\n\nTask 1 (Explore): \"Search src/api/AGENTS.md for auth mentions.\n                   How does API layer handle auth?\"\n\nTask 2 (Explore): \"Search src/core/AGENTS.md for auth mentions.\n                   How does core layer handle auth?\"\n\nTask 3 (Explore): \"Search src/db/AGENTS.md for auth mentions.\n                   How does data layer handle auth?\"\n```\n\n**Synthesis**: Map auth flow across subsystems, identify gaps in documentation.\n\n### Parallel Query Benefits\n\n| Query Type | Sequential | Parallel |\n|------------|------------|----------|\n| Concept in 8 nodes | ~16 reads | ~3 reads (parallel) |\n| Multi-aspect query | ~12 reads | ~4 reads (parallel) |\n| Cross-cutting search | ~10 reads | ~3 reads (parallel) |\n\n### Example: Parallel Constraint Query\n\n**Query**: \"What constraints apply to the checkout flow?\"\n\n**Parallel execution**:\n```\nTask 1: \"Find all constraints in src/checkout/AGENTS.md\"\nTask 2: \"Find all constraints in src/payments/AGENTS.md\"\nTask 3: \"Find all global constraints in CLAUDE.md that mention checkout, payment, or transaction\"\n```\n\n**Synthesis output**:\n```markdown\n## Constraints: checkout flow\n\n### From `src/checkout/AGENTS.md`\n- Cart must be validated before payment initiation\n- Inventory reserved for 15 minutes during checkout\n\n### From `src/payments/AGENTS.md`\n- All payment calls must be idempotent\n- Failed payments must not leave partial state\n\n### Inherited from `CLAUDE.md`\n- All financial operations must be logged\n- PII never logged in plain text\n\n### Effective rules (merged)\n1. Validate cart → reserve inventory → initiate payment (order matters)\n2. Payment calls must be idempotent\n3. Log all operations, redact PII\n4. 15-minute timeout on reservations\n```\n\n---\n\n## Common Query Patterns\n\n| Question Pattern | Query Type | Key Sections to Check |\n|-----------------|------------|----------------------|\n| \"What handles X?\" | Ownership | TL;DR, Subsystem Boundaries |\n| \"Where does X live?\" | Ownership | Subsystem Boundaries, Downlinks |\n| \"Where should I add X?\" | Placement | Ownership + Out of Scope |\n| \"Can I do X here?\" | Constraints | Contracts, Anti-patterns |\n| \"What rules apply to X?\" | Constraints | Contracts (all ancestors) |\n| \"How do I X?\" | Entry Point | Entry Points section |\n| \"What's dangerous about X?\" | Pitfalls | Pitfalls, Anti-patterns |\n| \"Why X instead of Y?\" | Architecture | Architecture Decisions |\n\n---\n\n## Scripts Reference\n\nThis skill uses scripts from `intent-layer`:\n\n| Script | Query Use |\n|--------|-----------|\n| `show_hierarchy.sh` | Visualize full Intent Layer structure |\n| `show_status.sh` | Check health before querying |\n| `detect_state.sh` | Verify Intent Layer exists |\n\nAll paths: `${CLAUDE_PLUGIN_ROOT}/scripts/`\n\n---\n\n## Examples\n\n### Example 1: Ownership Query\n\n**User:** \"What owns user sessions?\"\n\n**Process:**\n1. `grep -r \"session\" --include=\"*.md\"` in Intent Nodes\n2. Found in `src/auth/AGENTS.md`: \"Owns: authentication, sessions, tokens\"\n3. Parent `CLAUDE.md` confirms: \"Auth subsystem handles all identity\"\n\n**Answer:**\n```markdown\n## Ownership: user sessions\n\n**Primary owner:** `src/auth/AGENTS.md`\n> Owns authentication, session management, and token lifecycle.\n\n**Contracts:**\n- Sessions must expire after 24h inactivity\n- Session tokens never logged\n\n**Confidence:** Explicit (src/auth/AGENTS.md:23)\n```\n\n### Example 2: Placement Query\n\n**User:** \"Where should I add rate limiting?\"\n\n**Process:**\n1. Search for \"rate limit\" - not found\n2. Search for \"middleware\", \"request handling\"\n3. Found `src/api/AGENTS.md` owns \"request pipeline\"\n4. Check if rate limiting is out of scope - no\n5. Check constraints - \"middleware must be stateless\"\n\n**Answer:**\n```markdown\n## Placement: rate limiting\n\n**Recommended:** `src/api/middleware/`\n**Reason:** API layer owns request pipeline, rate limiting is request-level concern\n\n**Constraints from Intent Layer:**\n- Middleware must be stateless (use Redis for counters)\n- All middleware must log to structured logger\n\n**Confidence:** Inferred (no explicit mention, derived from ownership)\n**Recommendation:** Add rate limiting to src/api/AGENTS.md Entry Points\n```\n",
        "skills/intent-layer/SKILL.md": "---\nname: intent-layer\ndescription: >\n  Set up hierarchical Intent Layer (AGENTS.md files) for codebases.\n  Use when initializing a new project, adding context infrastructure to an existing repo,\n  user asks to set up AGENTS.md, add intent layer, make agents understand the codebase,\n  or scaffolding AI-friendly project documentation.\nargument-hint: \"[/path/to/project]\"\n---\n\n# Intent Layer\n\n> **TL;DR**: Create CLAUDE.md/AGENTS.md files that help AI agents navigate your codebase like senior engineers. Run `detect_state.sh` first to see what's needed.\n\nHierarchical AGENTS.md infrastructure so agents navigate codebases like senior engineers.\n\n---\n\n## Sub-Skills\n\nThis skill includes specialized sub-skills that are **automatically invoked** when appropriate:\n\n| Sub-Skill | Location | Auto-Invoke When |\n|-----------|----------|------------------|\n| `git-history` | `git-history/SKILL.md` | Creating nodes for existing code (extracts pitfalls from commits) |\n| `pr-review-mining` | `pr-review-mining/SKILL.md` | Creating nodes for existing code (extracts pitfalls from PR discussions) |\n| `pr-review` | `pr-review/SKILL.md` | Reviewing PRs that touch Intent Layer nodes |\n\n### git-history (Auto-Invoked During Setup)\n\nWhen creating nodes for directories with git history, **automatically run git-history analysis** to pre-populate:\n- **Pitfalls** from bug fix commits\n- **Anti-patterns** from revert commits\n- **Architecture Decisions** from refactor commits\n- **Contracts** from breaking change commits\n\n```\nTrigger: Creating AGENTS.md for directory with >50 commits\nAction: Run git-history analysis before writing node\n```\n\n### pr-review-mining (Auto-Invoked During Setup)\n\nWhen creating nodes for directories with merged PRs, **automatically run PR mining** to pre-populate:\n- **Pitfalls** from PR Risks sections and review warnings\n- **Contracts** from Breaking Changes sections\n- **Architecture Decisions** from Why sections and Alternatives Considered\n- **Anti-patterns** from rejected approaches in reviews\n\n```\nTrigger: Creating AGENTS.md for directory with merged PRs\nAction: Run pr-review-mining alongside git-history, merge findings\n```\n\n### pr-review (Auto-Invoked for PRs)\n\nWhen reviewing PRs that modify code covered by Intent Layer:\n- Verify contracts are respected\n- Check pitfalls are avoided\n- Flag potential Intent Layer updates needed\n\n```\nTrigger: PR touches files under an AGENTS.md\nAction: Run pr-review with --ai-generated if applicable\n```\n\n### learning-loop (Auto-Invoked on Error Discovery)\n\nWhen you discover a non-obvious gotcha during any work (not just Intent Layer setup):\n- Find the nearest AGENTS.md to where the issue occurred\n- Append to its Pitfalls section\n- Keep the Intent Layer alive with real lessons\n\n```\nTrigger: Fix error caused by non-obvious behavior (API format, config quirk, etc.)\nAction: Append pitfall to nearest AGENTS.md\nFormat:\n  ### Short descriptive title\n  **Problem**: What assumption failed\n  **Symptom**: Error message or unexpected behavior\n  **Solution**: Correct approach with code reference\n```\n\n**Example**: After fixing `'list' object has no attribute 'get'` because Claude CLI output format varies:\n```markdown\n### Claude CLI JSON output format varies\n\n**Problem**: `claude --output-format json` can return dict or list\n**Symptom**: `'list' object has no attribute 'get'`\n**Solution**: Check `isinstance(data, list)` before `.get()`. See `lib/claude_runner.py:parse_claude_output()`\n```\n\n---\n\n## Quick Start\n\n### Step 0: Check State\n\n```bash\nscripts/detect_state.sh /path/to/project\n```\n\n| State | Action |\n|-------|--------|\n| `none` | Create root file (continue below) |\n| `partial` | Add Intent Layer section to existing root |\n| `complete` | Use `intent-layer-maintenance` skill instead |\n\n### Step 1: Measure\n\n```bash\n# Auto-discover all candidate directories\nscripts/estimate_all_candidates.sh /path/to/project\n\n# Or analyze structure first\nscripts/analyze_structure.sh /path/to/project\n```\n\n### Step 2: Create Root Node\n\nChoose CLAUDE.md (Anthropic) or AGENTS.md (cross-tool). Pick template by size:\n- **Small** (<50k tokens): `references/templates.md` → Small Project\n- **Medium** (50-150k): `references/templates.md` → Medium Project\n- **Large** (>150k/monorepo): `references/templates.md` → Large Project\n\n### Step 3: Create Child Nodes (if needed)\n\n| Signal | Action |\n|--------|--------|\n| Directory >20k tokens | Create `AGENTS.md` |\n| Responsibility shift | Create `AGENTS.md` |\n| Cross-cutting concern | Document at nearest common ancestor |\n\nUse child template from `references/templates.md`.\n\n### Step 4: Validate\n\n```bash\nscripts/validate_node.sh CLAUDE.md\nscripts/validate_node.sh path/to/AGENTS.md\n```\n\nChecks: token count <4k, required sections, no absolute paths, no TODOs.\n\n### Step 5: Cross-Tool Compatibility\n\n```bash\nln -s CLAUDE.md AGENTS.md  # If CLAUDE.md is primary\n```\n\n---\n\n## Interactive Wizard\n\nStep-by-step guided setup with prompts at each decision point.\n\n### Step 1: Detect State\n\nRun `scripts/detect_state.sh`, then based on result:\n\n| State | Action |\n|-------|--------|\n| `none` | Ask user: \"Create CLAUDE.md or AGENTS.md as root?\" |\n| `partial` | Ask user: \"What's the one-line TL;DR for this project?\" |\n| `complete` | Redirect to `intent-layer-maintenance` skill |\n\n### Step 2: Measure & Decide\n\nRun `scripts/estimate_all_candidates.sh`, then:\n- Present candidates table to user\n- Ask: \"Which directories should get their own AGENTS.md?\"\n\n### Step 3: Mine History (Auto-Invoked)\n\n**Before creating each node**, automatically analyze both git history AND PR discussions using the mining scripts:\n\n```bash\n# Git commit analysis (extracts pitfalls, anti-patterns, decisions, contracts)\n${CLAUDE_PLUGIN_ROOT}/scripts/mine_git_history.sh [directory]\n\n# GitHub PR analysis (requires gh CLI)\n${CLAUDE_PLUGIN_ROOT}/scripts/mine_pr_reviews.sh --limit 50\n\n# Check for stale nodes (during maintenance)\n${CLAUDE_PLUGIN_ROOT}/scripts/detect_staleness.sh --code-changes [directory]\n```\n\n**mine_git_history.sh** extracts from commits:\n1. Bug fixes → Pre-populate Pitfalls\n2. Reverts → Pre-populate Anti-patterns\n3. Refactors → Pre-populate Architecture Decisions\n4. Breaking changes → Pre-populate Contracts\n\n**mine_pr_reviews.sh** extracts from PRs:\n1. Risks sections → Pre-populate Pitfalls\n2. Review warnings → Pre-populate Pitfalls\n3. Breaking Changes → Pre-populate Contracts\n4. Why/Alternatives → Pre-populate Architecture Decisions\n\nPresent merged findings to user: \"History suggests these pitfalls: [list]. Include them?\"\n\n### Step 4: Create Nodes\n\nFor root node:\n- Ask user about project purpose\n- Select template by size (Small/Medium/Large from `references/templates.md`)\n- **Include git-history findings** in appropriate sections\n\nFor each child node:\n- Ask user about directory's responsibility\n- Use child template from `references/templates.md`\n- **Include git-history findings** for that directory\n\n### Step 4b: Add Pre-flight Checks\n\nFor directories with history of mistakes or complex operations:\n\n**Ask**: \"What operations in this directory have caused problems before?\"\n\nFor each risky operation identified:\n1. Ask: \"What would you check before doing [operation]?\"\n2. Convert answer to verifiable check format\n3. Add to Pre-flight Checks section\n\n**Mine from history**:\n```bash\n# Find reverts and fixes that suggest missing checks\n${CLAUDE_PLUGIN_ROOT}/scripts/mine_git_history.sh [directory] | grep -i \"fix\\|revert\"\n```\n\nPresent findings: \"These commits suggest potential checks: [list]. Add any?\"\n\n### Step 5: Validate\n\nRun `scripts/validate_node.sh` on all created nodes:\n- Show validation results\n- Offer to fix warnings/errors\n\n### Step 6: Symlink\n\nAsk user: \"Create symlink for cross-tool compatibility? (AGENTS.md → CLAUDE.md)\"\n\nIf yes: `ln -s CLAUDE.md AGENTS.md`\n\n---\n\n## Parallel Setup (Large Codebases)\n\nFor codebases >200k tokens, use parallel subagents to dramatically speed up exploration.\n\n### When to Use Parallel Mode\n\n| Codebase Size | Approach |\n|---------------|----------|\n| <100k tokens | Sequential (standard workflow) |\n| 100-500k tokens | Parallel exploration, sequential synthesis |\n| >500k tokens | Full parallel mode (explore + validate) |\n\n### Step 1: Identify Subsystems\n\nRun structure analysis first:\n```bash\nscripts/analyze_structure.sh /path/to/project\n```\n\nIdentify 3-6 major subsystems from the output (e.g., `src/api/`, `src/core/`, `src/db/`).\n\n### Step 2: Parallel Exploration + History Mining\n\nSpawn subagents for **code exploration, git history, AND PR mining** in parallel:\n\n```\n# Code exploration (one per subsystem)\nTask 1: \"Analyze src/api/ for Intent Layer setup. Find: code map (find-it-fast\n         + key relationships), public API (exports used by others + core types),\n         external dependencies, data flow, entry points, contracts, patterns,\n         pitfalls. Return structured findings per section.\"\n\nTask 2: \"Analyze src/core/ for Intent Layer setup. Find: code map (find-it-fast\n         + key relationships), public API (exports used by others + core types),\n         external dependencies, data flow, entry points, contracts, patterns,\n         pitfalls. Return structured findings per section.\"\n\nTask 3: \"Analyze src/db/ for Intent Layer setup. Find: code map (find-it-fast\n         + key relationships), public API (exports used by others + core types),\n         external dependencies, data flow, entry points, contracts, patterns,\n         pitfalls. Return structured findings per section.\"\n\n# Git history analysis (parallel with exploration)\nTask 4: \"Run git-history analysis on src/api/. Find bug fixes, reverts,\n         refactors, and breaking changes. Return as Intent Layer findings.\"\n\nTask 5: \"Run git-history analysis on src/core/. Find bug fixes, reverts,\n         refactors, and breaking changes. Return as Intent Layer findings.\"\n\nTask 6: \"Run git-history analysis on src/db/. Find bug fixes, reverts,\n         refactors, and breaking changes. Return as Intent Layer findings.\"\n\n# PR review mining (parallel with above)\nTask 7: \"Run pr-review-mining on src/api/. Extract from PR descriptions\n         and review comments: pitfalls, contracts, architecture decisions.\n         Return as Intent Layer findings with PR numbers.\"\n\nTask 8: \"Run pr-review-mining on src/core/. Extract from PR descriptions\n         and review comments: pitfalls, contracts, architecture decisions.\n         Return as Intent Layer findings with PR numbers.\"\n\nTask 9: \"Run pr-review-mining on src/db/. Extract from PR descriptions\n         and review comments: pitfalls, contracts, architecture decisions.\n         Return as Intent Layer findings with PR numbers.\"\n```\n\n**Critical**: Launch all agents in parallel (single message with multiple Task calls).\n\n### Step 3: Synthesize Results\n\nOnce all agents complete:\n1. **Merge code exploration + git history + PR mining** findings per subsystem\n2. Identify cross-cutting concerns (appear in multiple findings)\n3. Place cross-cutting items in root node\n4. Create child AGENTS.md for each subsystem with all sections:\n   - Purpose + Design Rationale (the \"why\")\n   - Code Map (find-it-fast + key relationships)\n   - Public API (key exports + core types)\n   - External Dependencies (services + failure modes)\n   - Data Flow (request path)\n   - Decisions (from git history + PR mining)\n   - Entry Points, Contracts, Patterns\n   - Pitfalls (from all sources)\n   - Boundaries, Pre-flight Checks\n5. **Deduplicate** where multiple sources found the same insight\n6. **Prefer PR-sourced rationale** for Decisions (richer \"why\" context)\n\n### Step 4: Parallel Validation\n\nValidate all nodes in parallel:\n```\nTask 1: \"Run validate_node.sh on CLAUDE.md, report results\"\nTask 2: \"Run validate_node.sh on src/api/AGENTS.md, report results\"\nTask 3: \"Run validate_node.sh on src/core/AGENTS.md, report results\"\n```\n\n### Example Parallel Exploration Prompt\n\nFor each subsystem, use this structured prompt:\n\n```markdown\nExplore [DIRECTORY] for Intent Layer documentation. Return:\n\n## Design Rationale\n[Why does this module exist? What problem does it solve? What's the core insight?]\n\n## Code Map\n### Find It Fast\n| Looking for... | Go to |\n[What common searches map to which files? Focus on non-obvious locations.]\n\n### Key Relationships\n[Import direction, layer rules, what depends on what]\n\n## Public API\n### Key Exports\n| Export | Used By | Change Impact |\n[What do OTHER modules import from here?]\n\n### Core Types\n[The 3-5 types needed to understand this area]\n\n## External Dependencies\n| Service | Used For | Failure Mode |\n[External services and what happens when down]\n\n## Data Flow\n[How requests/data move through this area - simple diagram]\n\n## Decisions\n| Decision | Why | Rejected |\n[Architectural choices with rationale]\n\n## Entry Points\n| Task | Start Here |\n[Common tasks and where to start]\n\n## Contracts\n[Non-type-enforced invariants]\n\n## Patterns\n[How to do common tasks - sequence and non-obvious steps]\n\n## Pitfalls\n[What looks wrong but isn't? What looks fine but breaks?]\n\nKeep findings specific to this directory. Note cross-cutting concerns separately.\n```\n\n### Parallel Mode Benefits\n\n| Metric | Sequential | Parallel |\n|--------|------------|----------|\n| 500k token codebase | ~30 min | ~10 min |\n| 1M+ token codebase | ~60 min | ~15 min |\n| Subsystem coverage | Variable | Consistent |\n\n---\n\n## Spec-First Workflow (Greenfield)\n\nFor projects WITHOUT existing code. Write Intent Nodes as specs, then scaffold.\n\n### Step 1: Define Scope\n- What's the project vision?\n- What are the major planned subsystems?\n- Who are the stakeholders?\n\n### Step 2: Create Spec Root\nUse \"Spec Root Template\" from `references/templates.md`:\n- Vision statement (not TL;DR of existing code)\n- Planned Subsystems (not discovered from code)\n- Design Constraints (not extracted contracts)\n- Implementation Targets (where to build first)\n\n### Step 3: Create Component Specs\nFor each planned subsystem, create AGENTS.md with:\n- Responsibility Charter (what it will own)\n- Interface Contracts (how others will call it)\n- Acceptance Criteria (how we know it's done)\n\n### Step 4: AI Scaffolding\nAsk Claude to scaffold against the specs:\n- \"Create directory structure matching the Planned Subsystems\"\n- \"Generate interface stubs for the contracts defined\"\n- \"Set up test fixtures based on acceptance criteria\"\n\n### Step 5: Implementation Loop\nBuild incrementally:\n1. Implement against spec\n2. Update spec as requirements clarify\n3. Spec nodes evolve into documentation nodes\n\n### Step 6: Transition to Maintenance\nWhen implementation complete:\n- Fill in discovered Pitfalls\n- Add actual Entry Points\n- Run `validate_node.sh` and transition to maintenance skill\n\n---\n\n## Concepts\n\n<details>\n<summary><strong>Why Intent Layers?</strong> (click to expand)</summary>\n\n### The Problem\nAI agents reading raw code lack the tribal knowledge that experienced engineers have:\n- Where to start for common tasks\n- What patterns are expected\n- What invariants must never be violated\n- What pitfalls to avoid\n\n### The Solution\nIntent Nodes (CLAUDE.md/AGENTS.md files) provide compressed, high-signal context that tells agents *what matters* without reading thousands of lines of code.\n\n### How It Works\n- **Ancestor-based loading**: Reading a child node auto-loads all ancestors (T-shaped knowledge)\n- **Progressive disclosure**: Start minimal, agents drill down when needed\n- **Compression**: 200k tokens of code → 2k token node (100:1 ratio)\n\n</details>\n\n<details>\n<summary><strong>Core Rules</strong> (click to expand)</summary>\n\n### One Root Only\nCLAUDE.md and AGENTS.md should NOT coexist at project root. Pick one and symlink the other for cross-tool compatibility.\n\n### Child Nodes Named AGENTS.md\nSubdirectory nodes should be `AGENTS.md` (not CLAUDE.md) for cross-tool compatibility.\n\n### Token Budgets\n- Each node: <4k tokens (prefer <3k)\n- Target 100:1 compression\n- If you can't compress, scope is too broad → split\n\n### What to Document\nKeep: code map (non-obvious locations), public API (what others depend on), external dependencies, data flow, decisions with rationale, contracts, patterns (non-obvious steps), pitfalls\nDelete: obvious mappings (routes.ts → routes), type-enforced invariants, internal exports, standard patterns, tech stack lists\n\n</details>\n\n<details>\n<summary><strong>Effort Estimates</strong> (click to expand)</summary>\n\n| Codebase Size | Experienced | Newcomer |\n|---------------|-------------|----------|\n| <50k tokens | 1-2 hours | 3-5 hours |\n| 50-150k tokens | 3-5 hours | 6-10 hours |\n| >150k tokens | 5-10 hours | 10-20 hours |\n\nBudget additional time for SME interviews—tribal knowledge takes conversation to extract.\n\n</details>\n\n---\n\n## Resources\n\n### Scripts\n\n| Script | Purpose |\n|--------|---------|\n| `detect_state.sh` | Check Intent Layer state (none/partial/complete) |\n| `analyze_structure.sh` | Find semantic boundaries |\n| `estimate_tokens.sh` | Measure single directory |\n| `estimate_all_candidates.sh` | Measure all candidates at once |\n| `validate_node.sh` | Check node quality before committing |\n| `capture_pain_points.sh` | Generate maintenance capture template |\n| `detect_changes.sh` | Find affected nodes on merge/PR |\n| `show_status.sh` | Health dashboard with metrics and recommendations |\n| `show_hierarchy.sh` | Visual tree display of all nodes |\n| `review_pr.sh` | Review PR against Intent Layer |\n| `capture_mistake.sh` | Generate mistake report for check extraction |\n\n### Sub-Skills\n\n| Sub-Skill | Location | Purpose |\n|-----------|----------|---------|\n| `git-history` | `git-history/SKILL.md` | Extract pitfalls/contracts from commit history |\n| `pr-review-mining` | `pr-review-mining/SKILL.md` | Extract pitfalls/contracts from PR discussions |\n| `pr-review` | `pr-review/SKILL.md` | Review PRs against Intent Layer contracts |\n\n### References\n\n| File | Purpose |\n|------|---------|\n| `templates.md` | Root (S/M/L) and child templates, three-tier boundaries |\n| `node-examples.md` | Real-world examples |\n| `capture-protocol.md` | SME interview questions |\n| `compression-techniques.md` | How to achieve 100:1 compression, LCA placement |\n| `agent-feedback-protocol.md` | Continuous improvement loop |\n\n---\n\n## Capture Questions\n\n> **TL;DR**: Ask these when documenting existing code. Focus on what agents can't infer from code itself.\n\n### Scope & Navigation\n1. What does this area own? What's explicitly out of scope?\n2. Where do developers commonly search? What's in non-obvious locations?\n3. What are the key relationships between modules? (import direction, layers)\n\n### Public Interface\n4. What exports do OTHER modules actually depend on?\n5. What 3-5 types must someone understand to work here?\n\n### External Dependencies\n6. What external services does this area use? What happens when they're down?\n\n### Design Rationale (the \"why\")\n7. What problem drove the creation of this module? What pain point does it solve?\n8. What's the core insight or philosophy? What would you lose if you removed it?\n9. What constraints shaped the design? (performance, compatibility, team size, etc.)\n\n### Understanding & Debugging\n10. How does data flow through this area? (request → response path)\n11. Why were specific technical choices made? What alternatives were rejected?\n\n### Consistency & Safety\n12. What invariants must hold that aren't enforced by types?\n13. What patterns must be followed for common tasks?\n14. What operations require verification before proceeding?\n\n### Pitfalls (highest value)\n15. What repeatedly confuses new engineers?\n16. What looks wrong but is correct? What looks correct but will break?\n\nFor full protocol: `references/capture-protocol.md`\n\n---\n\n## When to Create Child Nodes\n\n> **TL;DR**: >20k tokens or responsibility shift → create. Simple utilities → don't.\n\n| Signal | Action |\n|--------|--------|\n| >20k tokens in directory | Create AGENTS.md |\n| Responsibility shift (different owner/concern) | Create AGENTS.md |\n| Hidden contracts/invariants | Document in nearest ancestor |\n| Cross-cutting concern | Place at lowest common ancestor |\n\n**Do NOT create for**: every directory, simple utilities, test folders (unless complex).\n\n---\n\n## Pre-flight Checks\n\n> **TL;DR**: Testable verifications before risky operations. Add when mistakes reveal missing checks.\n\n### What They Are\n\nPre-flight checks are **verifiable assertions** an agent runs before modifying code. They catch \"I thought I understood\" mistakes.\n\n### When to Add\n\n| Signal | Action |\n|--------|--------|\n| Mistake happened | Write check that would have caught it |\n| PR reviewer flagged missing step | Convert to check |\n| Complex multi-step operation | Add checks for each step |\n| Critical/irreversible operation | Add comprehension + human gate |\n\n### When NOT to Add\n\n- Every operation (over-checking slows agents down)\n- Things covered by Boundaries section (use Always/Never instead)\n- Awareness-only items (use Pitfalls instead)\n\n### Format\n\nSee `references/templates.md` → Writing Pre-flight Checks for the standard format.\n\n### Mining Checks from History\n\n```bash\n# Find commits suggesting missing verifications\nscripts/mine_git_history.sh --since \"6 months ago\" [directory] | grep -E \"fix|broke|forgot\"\n```\n\nLook for patterns like \"forgot to update X\" or \"broke Y because didn't check Z\".\n\n---\n\n## Capture Order (Leaf-First)\n\n> **TL;DR**: Start at leaves, work up to root. Clarity compounds upward.\n\nAlways capture leaf-first, easy-to-hard:\n\n1. **Start with deepest directories** (most concrete)\n   - Leaf nodes compress raw code—patterns are visible\n   - Easier to identify contracts when you see the implementation\n\n2. **Work up to parent nodes** (summarize children)\n   - Parent nodes compress children's Intent Nodes, not raw code\n   - Wait until children are stable before writing parent\n\n3. **Finish with root** (summarize entire hierarchy)\n   - Root references child nodes, provides navigation\n   - Global invariants emerge from seeing all children\n\n**Why this order?**\n- Clarity compounds upward—parent nodes reference stable children\n- Avoids rewriting parents when children change\n- Natural: understand details before summarizing\n\n**Anti-pattern**: Starting at root and working down leads to vague descriptions that need constant revision as you discover what's actually in the code.\n\n---\n\n## Feedback Flywheel\n\n> **TL;DR**: Agents surface missing context during work → humans review → Intent Layer improves → future agents start better.\n\n### Continuous Improvement Loop\n\n```\nAgent works → Finds gap → Surfaces finding → Human reviews → Node updated → Future agents benefit\n```\n\n### During Normal Work\n\nWhen you encounter gaps while working, surface them using the format in `references/agent-feedback-protocol.md`:\n\n```markdown\n### Intent Layer Feedback\n| Type | Location | Finding |\n|------|----------|---------|\n| Missing pitfall | `src/api/AGENTS.md` | Rate limiter fails silently when Redis down |\n```\n\n### On Merge/PR\n\nRun change detection to identify which nodes need review:\n\n```bash\nscripts/detect_changes.sh main HEAD\n```\n\nThis outputs affected nodes in leaf-first order for systematic review.\n\n### Full Protocol\n\nSee `references/agent-feedback-protocol.md` for:\n- When to surface findings\n- Structured feedback format\n- Human review workflow (Accept/Reject/Defer)\n\n### Mistake → Check Pipeline\n\nWhen agents surface mistakes, evaluate for check conversion:\n\n```\nMistake surfaced → \"Would a check have caught this?\"\n                            │\n              ┌─────────────┴─────────────┐\n              │                           │\n             Yes                          No\n              │                           │\n              ▼                           ▼\n    Write Pre-flight Check         Add to Pitfalls\n              │                    (awareness only)\n              ▼\n    Add to AGENTS.md Pre-flight section\n```\n\n**Check conversion template**:\n```markdown\nMistake: [What happened]\nOperation: [What agent was doing]\nCheck: Before [operation] → [verification that would have caught it]\n```\n\nUse `scripts/capture_mistake.sh` to generate structured mistake reports.\n\n---\n\n## Maintenance Flywheel\n\n> **TL;DR**: Update nodes when behavior changes, not just when code changes.\n\nWhen files change (e.g., on merge):\n\n1. **Identify affected nodes** - Run `scripts/detect_changes.sh base head`\n2. **Check behavior change** - Did contracts/invariants change, or just formatting?\n3. **Update if needed** - Behavior change → update affected node\n4. **Consider new nodes** - Patterns emerging → new node or LCA update?\n\nFor full maintenance workflow, use: **`intent-layer-maintenance`** skill\n\n---\n\n## What's Next?\n\nAfter completing initial setup (state = `complete`):\n\n### Immediate Actions\n1. Create symlink for cross-tool compatibility\n2. Test by asking an AI agent to perform a common task\n3. Share with team (note in README or onboarding docs)\n\n### Ongoing Maintenance\n| Trigger | Action |\n|---------|--------|\n| Quarterly | Run `intent-layer-maintenance` skill |\n| Post-incident | Update Pitfalls + Contracts |\n| After refactor | Update Entry Points + Subsystem Boundaries |\n| After new feature | Update Architecture Decisions + Patterns |\n| **PR Review** | **Auto-invoke `pr-review` sub-skill** |\n\n### PR Review Integration (Auto-Invoked)\n\nWhen reviewing PRs that touch files covered by Intent Layer nodes:\n\n```bash\n# Automatically run pr-review\nscripts/review_pr.sh main HEAD --ai-generated\n```\n\nThe `pr-review` sub-skill will:\n- Check PR against contracts in relevant AGENTS.md\n- Flag if PR approaches documented pitfalls\n- Suggest Intent Layer updates if contracts changed\n\n### Optional: CI Integration\n\n```yaml\n- name: Check Intent Layer\n  run: ${CLAUDE_PLUGIN_ROOT}/scripts/detect_state.sh .\n\n- name: PR Review (if Intent Layer exists)\n  if: github.event_name == 'pull_request'\n  run: |\n    ${CLAUDE_PLUGIN_ROOT}/scripts/review_pr.sh origin/main HEAD --exit-code\n```\n\n### Related Skills\n| Skill | Use When |\n|-------|----------|\n| `intent-layer-maintenance` | Quarterly audits, post-incident updates |\n| `intent-layer-query` | Asking questions about the codebase |\n| `intent-layer-onboarding` | Orienting newcomers |\n| `git-history` (sub-skill) | Mining commit history for insights |\n| `pr-review-mining` (sub-skill) | Mining PR discussions for insights |\n| `pr-review` (sub-skill) | Reviewing PRs against Intent Layer |\n",
        "skills/intent-layer/git-history/SKILL.md": "---\nname: git-history\ndescription: >\n  Extract Intent Layer content from git history. Analyzes commits, PRs, and\n  blame to discover pitfalls, contracts, architecture decisions, and entry points\n  that should be documented in AGENTS.md files.\nargument-hint: \"[/path/to/directory] [--since <date>] [--depth <commits>]\"\n---\n\n# Git History Analysis\n\nExtract tribal knowledge from git history to populate Intent Layer nodes.\n\n## Why Git History?\n\nCommit messages and PR descriptions contain valuable context:\n- **Bug fixes** → Pitfalls (what went wrong, what surprised people)\n- **Reverts** → Anti-patterns (what didn't work)\n- **Refactors** → Architecture decisions (why structure changed)\n- **Feature commits** → Entry points (where new things get added)\n- **\"Fix\" commits** → Contracts (invariants that were violated)\n\nThis context is often lost when engineers leave or memories fade.\n\n## Quick Start\n\n```bash\n# Analyze recent history for a directory\ngit log --oneline --since=\"6 months ago\" -- path/to/directory\n\n# Find bug fixes (likely pitfalls)\ngit log --oneline --grep=\"fix\" --grep=\"bug\" --all-match -- path/to/directory\n\n# Find reverts (likely anti-patterns)\ngit log --oneline --grep=\"revert\" -i -- path/to/directory\n\n# Find refactors (likely architecture decisions)\ngit log --oneline --grep=\"refactor\" -i -- path/to/directory\n```\n\n---\n\n## Extraction Workflow\n\n### Step 1: Gather Raw History\n\nFor the target directory, collect:\n\n```bash\n# All commits with full messages\ngit log --since=\"1 year ago\" --pretty=format:\"%h|%s|%b---\" -- [directory]\n\n# Commits that mention \"fix\", \"bug\", \"broken\", \"issue\"\ngit log --since=\"1 year ago\" --grep=\"fix\\|bug\\|broken\\|issue\" -i --pretty=format:\"%h|%s\" -- [directory]\n\n# Commits that mention \"revert\", \"rollback\", \"undo\"\ngit log --since=\"1 year ago\" --grep=\"revert\\|rollback\\|undo\" -i --pretty=format:\"%h|%s\" -- [directory]\n\n# Commits with \"BREAKING\", \"breaking change\", \"migration\"\ngit log --since=\"1 year ago\" --grep=\"BREAKING\\|breaking change\\|migration\" -i --pretty=format:\"%h|%s\" -- [directory]\n```\n\n### Step 2: Categorize by Intent Layer Section\n\n| Commit Pattern | Target Section | Signal |\n|----------------|----------------|--------|\n| `fix:`, `bug`, `broken` | Pitfalls | Something surprised someone |\n| `revert`, `rollback` | Anti-patterns | Something didn't work |\n| `refactor:`, `restructure` | Architecture Decisions | Design changed |\n| `feat:`, `add`, `implement` | Entry Points | New capability added |\n| `BREAKING`, `migration` | Contracts | Invariant changed |\n| `docs:`, `update readme` | (verify existing docs) | May need refresh |\n| `perf:`, `optimize` | Pitfalls or Patterns | Performance matters here |\n| `security:`, `auth`, `vulnerability` | Contracts | Security invariant |\n\n### Step 3: Extract Insights\n\nFor each relevant commit, extract:\n\n**For Pitfalls:**\n```markdown\n- [What the fix addressed] - discovered in [commit hash]\n  - Original issue: [from commit message]\n  - Why it was surprising: [infer from context]\n```\n\n**For Anti-patterns:**\n```markdown\n- Don't [what was reverted] - reverted in [commit hash]\n  - Why it failed: [from revert message or PR]\n```\n\n**For Architecture Decisions:**\n```markdown\n- [Decision]: [rationale from refactor commit]\n  - Changed in: [commit hash]\n  - Previous approach: [if mentioned]\n```\n\n**For Contracts:**\n```markdown\n- [Invariant] - established/changed in [commit hash]\n  - Breaking change note: [from commit]\n```\n\n---\n\n## Parallel History Analysis\n\nFor large directories or deep history, use parallel subagents:\n\n### Parallel Category Search\n\n```\nTask 1 (Explore): \"Search git history for [directory] for bug fixes.\n                   Find commits with 'fix', 'bug', 'broken', 'issue'.\n                   Extract: what broke, why, what the fix was.\n                   Return as potential Pitfalls entries.\"\n\nTask 2 (Explore): \"Search git history for [directory] for reverts.\n                   Find commits with 'revert', 'rollback', 'undo'.\n                   Extract: what was reverted, why it failed.\n                   Return as potential Anti-patterns entries.\"\n\nTask 3 (Explore): \"Search git history for [directory] for refactors.\n                   Find commits with 'refactor', 'restructure', 'reorganize'.\n                   Extract: what changed, why, what was the previous approach.\n                   Return as potential Architecture Decisions entries.\"\n\nTask 4 (Explore): \"Search git history for [directory] for breaking changes.\n                   Find commits with 'BREAKING', 'migration', 'contract'.\n                   Extract: what invariant changed, what consumers need to know.\n                   Return as potential Contracts entries.\"\n```\n\n### Parallel Time-Range Analysis\n\nFor very deep history:\n\n```\nTask 1: \"Analyze git history for [directory] from 2024-01 to 2024-06.\n         Categorize commits by Intent Layer section.\"\n\nTask 2: \"Analyze git history for [directory] from 2024-07 to 2024-12.\n         Categorize commits by Intent Layer section.\"\n\nTask 3: \"Analyze git history for [directory] from 2023-01 to 2023-12.\n         Categorize commits by Intent Layer section.\"\n```\n\n---\n\n## Advanced Techniques\n\n### Git Blame for Hot Spots\n\nFind files with most churn (likely complex/pitfall-prone):\n\n```bash\n# Files with most commits (complexity signal)\ngit log --since=\"1 year ago\" --pretty=format: --name-only -- [directory] | \\\n  sort | uniq -c | sort -rn | head -20\n\n# Recent blame for specific file (who knows this code)\ngit blame --since=\"6 months ago\" [file] | \\\n  awk '{print $2}' | sort | uniq -c | sort -rn\n```\n\n### PR/MR Description Mining\n\nIf using GitHub:\n\n```bash\n# Get PR descriptions for merged PRs affecting directory\ngh pr list --state merged --search \"[directory]\" --json title,body,number --limit 50\n```\n\nExtract from PR descriptions:\n- \"This PR fixes...\" → Pitfalls\n- \"Breaking change:\" → Contracts\n- \"This replaces...\" → Architecture Decisions\n- \"How to test:\" → Entry Points (verification patterns)\n\n### Commit Message Conventions\n\nIf the repo uses conventional commits, leverage the prefixes:\n\n| Prefix | Intent Layer Section |\n|--------|---------------------|\n| `fix:` | Pitfalls |\n| `feat:` | Entry Points |\n| `refactor:` | Architecture Decisions |\n| `perf:` | Pitfalls (performance) |\n| `security:` | Contracts |\n| `revert:` | Anti-patterns |\n| `BREAKING CHANGE:` | Contracts |\n\n---\n\n## Output Format\n\nAfter analysis, present findings for human review:\n\n```markdown\n## Git History Findings for [directory]\n\n### Potential Pitfalls (from bug fixes)\n\n| Commit | Finding | Confidence |\n|--------|---------|------------|\n| abc123 | Config reload doesn't pick up env var changes | High (explicit fix) |\n| def456 | Race condition when multiple workers start | Medium (inferred) |\n\n### Potential Anti-patterns (from reverts)\n\n| Commit | Finding | Confidence |\n|--------|---------|------------|\n| ghi789 | Don't use global state for request context | High (reverted) |\n\n### Potential Architecture Decisions (from refactors)\n\n| Commit | Finding | Confidence |\n|--------|---------|------------|\n| jkl012 | Moved to event-driven updates (from polling) | High (explicit refactor) |\n\n### Potential Contracts (from breaking changes)\n\n| Commit | Finding | Confidence |\n|--------|---------|------------|\n| mno345 | All handlers must return structured errors | High (BREAKING) |\n\n---\n\n**Review needed**: Human should verify these findings before adding to AGENTS.md.\nSome may be outdated, fixed differently, or no longer relevant.\n```\n\n---\n\n## Integration with Other Skills\n\n### With intent-layer (setup)\n\nUse git-history during initial setup to pre-populate nodes:\n\n1. Run structure analysis\n2. For each candidate directory, run git-history analysis\n3. Pre-fill Pitfalls and Architecture Decisions from history\n4. Human reviews and refines\n\n### With intent-layer-maintenance (audits)\n\nUse git-history to find undocumented changes:\n\n1. Run `detect_changes.sh` to find affected nodes\n2. For affected directories, analyze recent git history\n3. Check if new pitfalls/contracts emerged since last audit\n4. Propose updates based on commit analysis\n\n### With intent-layer-query\n\nWhen query returns \"uncertain\" confidence:\n\n1. Fall back to git history for the area\n2. Search for commits mentioning the concept\n3. Extract context from historical changes\n4. Flag as \"inferred from history\" with commit references\n\n---\n\n## Limitations\n\n| Limitation | Mitigation |\n|------------|------------|\n| Poor commit messages | Supplement with PR descriptions if available |\n| Squash merges lose detail | Check PR/MR descriptions for context |\n| Old history may be irrelevant | Default to recent (1 year) history |\n| False positives | Always require human review before adding |\n| Missing context | Flag confidence level, cite commit hash |\n\n---\n\n## Example Session\n\n**Goal**: Populate Pitfalls for `src/api/` directory\n\n**Step 1**: Search for bug fixes\n```bash\ngit log --since=\"1 year ago\" --grep=\"fix\" -i --oneline -- src/api/\n```\n\nOutput:\n```\na1b2c3d fix: handle null response from upstream service\ne4f5g6h fix: rate limiter not resetting after window\ni7j8k9l fix: auth token validation skipped for internal routes\n```\n\n**Step 2**: Extract insights\n\n```markdown\n### Potential Pitfalls\n\n1. **Upstream service can return null** (a1b2c3d)\n   - The external payment API sometimes returns null instead of error\n   - Must check for null before accessing response fields\n\n2. **Rate limiter window edge case** (e4f5g6h)\n   - Rate limit counter doesn't reset exactly at window boundary\n   - Can cause brief period of incorrect rate limiting\n\n3. **Internal routes bypass auth** (i7j8k9l)\n   - Routes marked \"internal\" skip token validation\n   - If internal route exposed externally, auth is bypassed\n```\n\n**Step 3**: Human review and add to `src/api/AGENTS.md`\n\n---\n\n## Scripts Reference\n\nThis skill primarily uses git commands directly. Useful aliases:\n\n```bash\n# Add to ~/.gitconfig\n[alias]\n  pitfalls = log --since='1 year ago' --grep='fix\\\\|bug\\\\|broken' -i --oneline\n  antipatterns = log --since='1 year ago' --grep='revert\\\\|rollback' -i --oneline\n  decisions = log --since='1 year ago' --grep='refactor\\\\|restructure' -i --oneline\n  contracts = log --since='1 year ago' --grep='BREAKING\\\\|migration' -i --oneline\n```\n\nUsage:\n```bash\ngit pitfalls -- src/api/\ngit antipatterns -- src/api/\ngit decisions -- src/api/\ngit contracts -- src/api/\n```\n",
        "skills/intent-layer/pr-review-mining/SKILL.md": "---\nname: pr-review-mining\ndescription: >\n  Extract Intent Layer content from GitHub PR descriptions and review comments.\n  Mines merged PRs for pitfalls, contracts, architecture decisions, and anti-patterns\n  that should be documented in AGENTS.md files.\nargument-hint: \"[/path/to/directory] [--since <date>] [--limit <count>]\"\n---\n\n# PR Review Mining\n\nExtract tribal knowledge from GitHub PR discussions to populate Intent Layer nodes.\n\n## Why PR Reviews?\n\nPR descriptions and review comments contain valuable context that commit messages lack:\n- **Breaking Changes sections** → Contracts (what invariants changed)\n- **\"Why\" sections** → Architecture Decisions (rationale)\n- **Review warnings** → Pitfalls (\"don't forget to handle X\")\n- **Alternatives Considered** → Anti-patterns (what didn't work)\n- **Requested Changes** → Contracts (patterns reviewers enforce)\n\nThis context is richer than commit messages because PRs capture the *discussion* around changes.\n\n## Quick Start\n\n```bash\n# Find merged PRs affecting a directory\ngh pr list --state merged --search \"path/to/directory\" --json number,title,body --limit 50\n\n# Get review comments for a specific PR\ngh api repos/{owner}/{repo}/pulls/{number}/comments\n\n# Get review decisions (APPROVE/REQUEST_CHANGES)\ngh api repos/{owner}/{repo}/pulls/{number}/reviews\n```\n\n---\n\n## Extraction Workflow\n\n### Step 1: Gather PRs\n\nFor the target directory, collect merged PRs:\n\n```bash\n# Get PR metadata\ngh pr list --state merged --search \"[directory]\" --json number,title,body,mergedAt --limit 100\n\n# For time-bounded search\ngh pr list --state merged --search \"[directory] merged:>2024-01-01\" --json number,title,body --limit 100\n```\n\n### Step 2: Parse PR Bodies (Section-Based)\n\nLook for structured sections in PR descriptions:\n\n| PR Section | Intent Layer Section | Signal |\n|------------|---------------------|--------|\n| `## What` / `## Summary` | Entry Points | What capability was added |\n| `## Why` / `## Motivation` | Architecture Decisions | Rationale for change |\n| `## Breaking Changes` | Contracts | Invariants that changed |\n| `## How to Test` | Entry Points | Verification patterns |\n| `## Risks` / `## Concerns` | Pitfalls | Known edge cases |\n| `## Alternatives Considered` | Architecture Decisions / Anti-patterns | Why not other approaches |\n\n### Step 3: Extract Review Comments\n\nFor each PR, fetch review comments:\n\n```bash\n# Top-level review comments\ngh api repos/{owner}/{repo}/pulls/{number}/comments --jq '.[].body'\n\n# Review decisions with comments\ngh api repos/{owner}/{repo}/pulls/{number}/reviews --jq '.[] | select(.body != \"\") | .body'\n```\n\nApply keyword fallback to unstructured content.\n\n### Step 4: Keyword Fallback\n\nFor comments and unstructured PR bodies:\n\n| Pattern | Target Section | Examples |\n|---------|----------------|----------|\n| `don't`, `never`, `avoid`, `careful` | Pitfalls | \"don't forget to handle null\" |\n| `instead of`, `rather than`, `we decided` | Architecture Decisions | \"we use Redis instead of memcached\" |\n| `must`, `always`, `required`, `invariant` | Contracts | \"auth must happen before DB write\" |\n| `broke`, `regression`, `caused`, `issue` | Pitfalls | \"this caused issues in prod\" |\n| `reverted`, `rolled back`, `didn't work` | Anti-patterns | \"we tried X but rolled back\" |\n| `breaking`, `migration`, `deprecate` | Contracts | \"this is a breaking change\" |\n\n### Step 5: Score Confidence\n\n| Confidence | Signal |\n|------------|--------|\n| **High** | Explicit section match (Breaking Changes, Risks) |\n| **High** | REQUEST_CHANGES review with clear pattern |\n| **Medium** | Strong keyword match in context |\n| **Low** | Weak keyword or ambiguous context |\n\n---\n\n## Parallel PR Analysis\n\nFor repos with many PRs, use parallel subagents:\n\n### Parallel by PR Batch\n\n```\nTask 1 (Explore): \"Mine PRs #1-50 for [directory].\n                   Extract: pitfalls from Risks/warnings,\n                   contracts from Breaking Changes,\n                   decisions from Why/Alternatives.\n                   Return as Intent Layer findings.\"\n\nTask 2 (Explore): \"Mine PRs #51-100 for [directory].\n                   Extract: pitfalls from Risks/warnings,\n                   contracts from Breaking Changes,\n                   decisions from Why/Alternatives.\n                   Return as Intent Layer findings.\"\n```\n\n### Parallel by Category\n\n```\nTask 1 (Explore): \"Search PR descriptions for [directory] for Breaking Changes.\n                   Extract contracts and invariants.\n                   Return with PR numbers and confidence.\"\n\nTask 2 (Explore): \"Search PR review comments for [directory] for warnings.\n                   Look for 'don't', 'careful', 'must'.\n                   Return as potential Pitfalls.\"\n\nTask 3 (Explore): \"Search PRs for [directory] for Alternatives Considered.\n                   Extract architecture decisions and anti-patterns.\n                   Return with rationale from PR.\"\n```\n\n---\n\n## Output Format\n\nAfter analysis, present findings for human review:\n\n```markdown\n## PR Review Mining Findings for [directory]\n\n### Potential Pitfalls (from PR discussions)\n\n| PR | Finding | Source | Confidence |\n|----|---------|--------|------------|\n| #234 | Upstream API returns 429 without Retry-After header | Review comment | High |\n| #189 | Cache invalidation race when multiple pods restart | PR body (Risks) | High |\n| #156 | Don't use DELETE cascade on user table | Review comment | Medium |\n\n### Potential Architecture Decisions (from PR rationale)\n\n| PR | Finding | Source | Confidence |\n|----|---------|--------|------------|\n| #201 | Chose event sourcing over CRUD for audit trail | PR body (Why) | High |\n| #178 | Redis over Memcached for pub/sub support | Review thread | Medium |\n\n### Potential Contracts (from breaking changes)\n\n| PR | Finding | Source | Confidence |\n|----|---------|--------|------------|\n| #245 | All API responses must include request_id | PR body (Breaking) | High |\n| #198 | Auth tokens must be validated before any DB write | REQUEST_CHANGES | High |\n\n### Potential Anti-patterns (from rejected approaches)\n\n| PR | Finding | Source | Confidence |\n|----|---------|--------|------------|\n| #212 | Don't store sessions in local memory (doesn't scale) | Alternatives Considered | High |\n| #167 | Avoid synchronous calls to payment API | Review comment | Medium |\n\n---\n\n**Review needed**: Human should verify findings before adding to AGENTS.md.\nLinks: [#234](url) [#189](url) ...\n```\n\n---\n\n## Integration with Other Skills\n\n### With intent-layer (setup)\n\nUse pr-review-mining during initial setup alongside git-history:\n\n1. Run structure analysis\n2. For each candidate directory:\n   - Run git-history analysis (commits)\n   - Run pr-review-mining (PR discussions)\n3. Merge and deduplicate findings\n4. Human reviews and refines\n\n### With git-history (complementary)\n\n| Source | Strength | Weakness |\n|--------|----------|----------|\n| git-history | Covers all changes | Terse commit messages |\n| pr-review-mining | Rich \"why\" context | Only merged PRs with discussions |\n\nUse both for complete coverage:\n- git-history catches changes without PR discussion\n- pr-review-mining provides deeper rationale\n\n### With intent-layer-maintenance (audits)\n\nAfter significant merges:\n\n1. Run `detect_changes.sh` to find affected nodes\n2. Mine recent PRs touching those areas\n3. Check if new pitfalls/contracts emerged\n4. Propose updates based on PR discussions\n\n---\n\n## Limitations\n\n| Limitation | Mitigation |\n|------------|------------|\n| Squash merges lose PR context | Search by merge commit date range |\n| Empty PR descriptions | Fall back to review comments |\n| No PR template | Use keyword fallback |\n| Private repos | Requires `gh` auth with repo access |\n| Rate limits | Use `--limit` flag, batch requests |\n\n---\n\n## Example Session\n\n**Goal**: Populate Pitfalls for `src/api/` directory\n\n**Step 1**: Find relevant PRs\n\n```bash\ngh pr list --state merged --search \"src/api\" --json number,title --limit 20\n```\n\nOutput:\n```\n#234  fix: handle null response from payment API\n#212  refactor: move to event-driven architecture\n#198  feat: add request ID to all responses\n```\n\n**Step 2**: Extract from PR #234\n\n```bash\ngh pr view 234 --json body\n```\n\nBody contains:\n```markdown\n## Why\nThe payment API sometimes returns null instead of an error object.\n\n## Risks\n- Other upstream APIs might have similar behavior\n- Need to audit all external API calls\n```\n\n**Step 3**: Extract from review comments\n\n```bash\ngh api repos/owner/repo/pulls/234/comments --jq '.[].body'\n```\n\nComment: \"Don't forget to add this check to the refund endpoint too\"\n\n**Step 4**: Compile findings\n\n```markdown\n### Potential Pitfalls\n\n1. **Payment API returns null on error** (#234)\n   - Source: PR body (Why section)\n   - Confidence: High\n   - Note: May affect other upstream APIs\n\n2. **Refund endpoint needs same null check** (#234)\n   - Source: Review comment\n   - Confidence: High\n   - Pattern: All external API calls need null handling\n```\n\n**Step 5**: Human review and add to `src/api/AGENTS.md`\n\n---\n\n## Command Reference\n\n```bash\n# List merged PRs for directory\ngh pr list --state merged --search \"[path]\" --json number,title,body,mergedAt\n\n# Get PR body\ngh pr view [number] --json body,title\n\n# Get review comments\ngh api repos/{owner}/{repo}/pulls/{number}/comments\n\n# Get review decisions\ngh api repos/{owner}/{repo}/pulls/{number}/reviews\n\n# Search PRs by date\ngh pr list --state merged --search \"merged:>YYYY-MM-DD [path]\"\n```\n",
        "skills/intent-layer/pr-review/SKILL.md": "---\nname: pr-review\ndescription: >\n  Review PRs against the Intent Layer. Use for reviewing AI-generated PRs\n  or having AI review human PRs. Provides risk scoring, checklists, and\n  contract verification.\nargument-hint: \"[BASE_REF] [HEAD_REF] [--pr NUMBER] [--ai-generated]\"\n---\n\n# PR Review\n\nReview a PR against the Intent Layer for contract compliance, pitfall awareness, and risk assessment.\n\n## Quick Start\n\n```bash\n# Basic review\nscripts/review_pr.sh main HEAD\n\n# Review AI-generated PR\nscripts/review_pr.sh main HEAD --ai-generated\n\n# Review with GitHub PR context\nscripts/review_pr.sh main HEAD --pr 123 --ai-generated\n```\n\n## Interactive Review Workflow\n\n### Step 1: Run Initial Analysis\n\n```bash\nscripts/review_pr.sh main HEAD --ai-generated\n```\n\nReview the output:\n1. **Risk Score** - Is this Low/Medium/High?\n2. **Critical Items** - These MUST be verified\n3. **AI Checks** - Any drift or over-engineering warnings?\n\n### Step 2: Walk Through Critical Items\n\nFor each critical item in the checklist:\n1. Read the contract/invariant\n2. Find the relevant code in the diff\n3. Verify the code respects the constraint\n4. Mark checked: `- [x]` or flag concern\n\n### Step 3: Check AI-Specific Warnings\n\nIf `--ai-generated` was used:\n\n**Over-engineering flags:**\n- New abstractions: Are they necessary?\n- Excessive try/catch: Does error handling add value?\n- New interfaces: Premature abstraction?\n\n**Pitfall proximity:**\n- For each alert, verify the AI handled the edge case\n- If not, flag for fix before merge\n\n**Intent drift:**\n- If PR approach conflicts with documented architecture, escalate\n\n### Step 4: Surface Findings\n\nUse the agent-feedback-protocol format for any discoveries:\n\n```markdown\n### Intent Layer Feedback\n\n| Type | Location | Finding |\n|------|----------|---------|\n| Missing pitfall | `src/api/AGENTS.md` | [description] |\n| Stale contract | `CLAUDE.md` | [description] |\n```\n\n### Step 5: Generate Review Summary\n\nOutput a structured review comment:\n\n```markdown\n## PR Review Summary\n\n**Risk: [Score] ([Level])**\n\n### Verified\n- [x] Auth tokens validated before DB write\n- [x] Rate limiting uses Redis\n\n### Concerns\n- [ ] New abstraction in `utils/helper.ts` may be unnecessary\n\n### Intent Layer Feedback\n[Any findings to update nodes]\n```\n\n## CI Integration\n\n```yaml\n- name: PR Review Check\n  run: |\n    ./intent-layer/scripts/review_pr.sh origin/main HEAD --exit-code --ai-generated\n  # Exit 0 = low risk, 1 = medium, 2 = high\n```\n\n## Output Modes\n\n| Flag | Output |\n|------|--------|\n| `--summary` | Risk score only |\n| `--checklist` | Score + checklist |\n| `--full` | All layers (default) |\n\n## When to Use\n\n- **Before merging AI-generated PRs** - Verify contracts respected\n- **AI reviewing human PRs** - Systematic contract checking\n- **CI gate** - Block high-risk PRs for manual review\n\n## Related\n\n- `detect_changes.sh` - Foundation for affected node discovery\n- `agent-feedback-protocol.md` - Format for surfacing findings\n- `validate_node.sh` - Validate node updates after review\n",
        "skills/review-mistakes/SKILL.md": "---\nname: review-mistakes\ndescription: >\n  Interactive review of pending mistake reports from the learning loop.\n  Walk through each report with the user, accepting/rejecting/discarding as appropriate.\nargument-hint: \"[/path/to/project]\"\n---\n\n# Review Mistakes\n\nInteractively review pending mistake reports from the Intent Layer learning loop.\n\n## Overview\n\nWhen agents make mistakes during development, skeleton reports are auto-captured in `.intent-layer/mistakes/pending/`. This skill helps you and the user review these reports conversationally, deciding which should become pitfalls in the Intent Layer.\n\n## Prerequisites\n\nCheck for pending reports:\n```bash\nls -la ${CLAUDE_PROJECT_DIR:-.}/.intent-layer/mistakes/pending/\n```\n\n## Workflow\n\n### Step 1: List Pending Reports\n\n```bash\nfind \"${CLAUDE_PROJECT_DIR:-.}/.intent-layer/mistakes/pending\" \\\n  \\( -name \"MISTAKE-*.md\" -o -name \"SKELETON-*.md\" \\) \\\n  -type f 2>/dev/null | sort\n```\n\nIf no reports, inform the user there's nothing to review.\n\n### Step 2: For Each Report\n\nRead the report and present a summary:\n\n```markdown\n---\n**Report**: SKELETON-2026-01-23-1234.md\n\n**Directory**: src/auth/\n**Operation**: Edit on login.ts\n**What happened**: Tool Edit failed - old_string not found\n**Covering node**: src/auth/AGENTS.md\n\n**Analysis**: [Your assessment - is this a real mistake or exploratory?]\n---\n```\n\n### Step 3: Ask User Decision\n\nPresent options clearly:\n\n> **What would you like to do with this report?**\n>\n> 1. **Accept** - This is a real gotcha, add as pitfall to AGENTS.md\n> 2. **Reject** - Not useful (I'll ask for a reason)\n> 3. **Discard** - Exploratory failure, not a real mistake\n> 4. **Enrich** - Add more context before deciding\n> 5. **Skip** - Review later\n\n### Step 4: Execute Decision\n\n#### On Accept\n\nRun the integration script:\n\n```bash\n${CLAUDE_PLUGIN_ROOT}/lib/integrate_pitfall.sh \"${CLAUDE_PROJECT_DIR:-.}/.intent-layer/mistakes/pending/<filename>\"\n```\n\nThis will:\n- Find the covering AGENTS.md\n- Extract/generate a pitfall entry\n- Append to the Pitfalls section\n- Move report to `integrated/`\n\n#### On Reject\n\nAsk for rejection reason, then:\n\n```bash\n# Create rejected directory if needed\nmkdir -p \"${CLAUDE_PROJECT_DIR:-.}/.intent-layer/mistakes/rejected\"\n\n# Add rejection reason to file\necho -e \"\\n### Rejection\\n**Reason**: <reason>\\n**Date**: $(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\" >> \"<file>\"\n\n# Move to rejected\nmv \"<file>\" \"${CLAUDE_PROJECT_DIR:-.}/.intent-layer/mistakes/rejected/\"\n```\n\n#### On Discard\n\nSimply delete the skeleton:\n\n```bash\nrm \"<file>\"\n```\n\nConfirm to user: \"Discarded - this was an exploratory failure, not a real mistake.\"\n\n#### On Enrich\n\nOpen the file for editing or help the user add:\n- Better description of what went wrong\n- Root cause analysis\n- Suggested pitfall text\n\nThen return to Step 3.\n\n#### On Skip\n\nMove to the next report. Track skipped files to mention at the end.\n\n### Step 5: Summary\n\nAfter reviewing all reports (or when user wants to stop):\n\n```markdown\n## Review Summary\n\n- **Accepted**: 2 (pitfalls added to AGENTS.md)\n- **Rejected**: 1\n- **Discarded**: 3 (exploratory failures)\n- **Skipped**: 1 (still pending)\n\nRemaining pending: 1 report(s)\n```\n\n---\n\n## Report Types\n\n### Skeleton Reports (SKELETON-*.md)\n\nAuto-created by PostToolUseFailure hook. Contains:\n- Tool and file context\n- Placeholder fields for root cause and suggested fix\n- Often exploratory failures - review carefully\n\n**Common skeleton dispositions:**\n- **Discard** if: Edit failed because string wasn't found (typo, wrong file)\n- **Discard** if: Bash command failed during exploration\n- **Accept** if: Failure revealed a non-obvious gotcha about the codebase\n- **Enrich then Accept** if: Real mistake but needs better description\n\n### Full Reports (MISTAKE-*.md)\n\nCreated manually via `capture_mistake.sh`. Contains:\n- Detailed description from human/agent\n- Root cause analysis\n- Suggested fix\n\n**Common full report dispositions:**\n- **Accept** if: Well-documented, clear pitfall\n- **Reject** if: One-off issue, not worth documenting\n- **Enrich then Accept** if: Good insight but needs clearer pitfall text\n\n---\n\n## Example Conversation\n\n**Agent**: \"I found 3 pending mistake reports. Would you like to review them now?\"\n\n**User**: \"yes\"\n\n**Agent**:\n> ---\n> **Report**: SKELETON-2026-01-23-4521.md\n>\n> **Directory**: src/api/\n> **Operation**: Edit on routes.ts\n> **What happened**: Edit failed - old_string not found\n> **Covering node**: src/api/AGENTS.md\n>\n> **Analysis**: This looks like the Edit tool couldn't find the exact string to replace. This could be:\n> - A typo in the old_string (exploratory)\n> - The file had been modified and the string changed (possible gotcha)\n> ---\n>\n> What would you like to do? (1) Accept (2) Reject (3) Discard (4) Enrich (5) Skip\n\n**User**: \"3 - it was just a typo\"\n\n**Agent**: \"Discarded. Moving to next report...\"\n\n---\n\n## Scripts Reference\n\n| Script | Purpose |\n|--------|---------|\n| `lib/integrate_pitfall.sh` | Auto-add pitfall to covering AGENTS.md |\n| `scripts/capture_mistake.sh` | Manual capture (if needed) |\n\nAll paths: `${CLAUDE_PLUGIN_ROOT}/`\n\n---\n\n## Tips\n\n- **Be conservative with Accept** - Only document genuine gotchas that would trip up future agents\n- **Discard freely** - Most skeletons from exploratory failures should be discarded\n- **Enrich before Accept** - A well-written pitfall is more useful than a vague one\n- **Batch review** - Review all pending reports periodically rather than one at a time\n"
      },
      "plugins": [
        {
          "name": "intent-layer",
          "version": "1.0.1",
          "source": "./",
          "description": "Hierarchical AGENTS.md infrastructure for AI-navigable codebases. Create CLAUDE.md/AGENTS.md files that help AI agents navigate your codebase like senior engineers.",
          "categories": [],
          "install_commands": [
            "/plugin marketplace add orban/intent-layer",
            "/plugin install intent-layer@orban"
          ]
        }
      ]
    }
  ]
}