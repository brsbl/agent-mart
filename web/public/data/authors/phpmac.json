{
  "author": {
    "id": "phpmac",
    "display_name": "a",
    "type": "User",
    "avatar_url": "https://avatars.githubusercontent.com/u/86544347?u=456fecb192bd782b0c09ac26c7f6830762eabd25&v=4",
    "url": "https://github.com/phpmac",
    "bio": null,
    "stats": {
      "total_marketplaces": 1,
      "total_plugins": 1,
      "total_commands": 0,
      "total_skills": 1,
      "total_stars": 0,
      "total_forks": 0
    }
  },
  "marketplaces": [
    {
      "name": "phpmac/skills",
      "version": null,
      "description": "自己的技能库",
      "owner_info": {
        "name": "phpmac",
        "email": "a@vc.sb"
      },
      "keywords": [],
      "repo_full_name": "phpmac/skills",
      "repo_url": "https://github.com/phpmac/skills",
      "repo_description": "claude skills",
      "homepage": null,
      "signals": {
        "stars": 0,
        "forks": 0,
        "pushed_at": "2026-01-29T05:39:59Z",
        "created_at": "2026-01-22T17:48:13Z",
        "license": null
      },
      "file_tree": [
        {
          "path": ".claude-plugin",
          "type": "tree",
          "size": null
        },
        {
          "path": ".claude-plugin/marketplace.json",
          "type": "blob",
          "size": 352
        },
        {
          "path": ".claude-plugin/plugin.json",
          "type": "blob",
          "size": 363
        },
        {
          "path": "README.md",
          "type": "blob",
          "size": 570
        },
        {
          "path": "skills",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/hardhat2-fork-testing",
          "type": "tree",
          "size": null
        },
        {
          "path": "skills/hardhat2-fork-testing/SKILL.md",
          "type": "blob",
          "size": 8114
        }
      ],
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"phpmac/skills\",\n  \"description\": \"自己的技能库\",\n  \"owner\": {\n    \"name\": \"phpmac\",\n    \"email\": \"a@vc.sb\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"skills\",\n      \"description\": \"自己的技能库\",\n      \"version\": \"1.0.0\",\n      \"source\": \"./\",\n      \"author\": {\n        \"name\": \"a\",\n        \"email\": \"a@vc.sb\"\n      }\n    }\n  ]\n}",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"phpmac/skills\",\n  \"description\": \"自己的技能库\",\n  \"version\": \"1.0.0\",\n  \"author\": {\n    \"name\": \"phpmac\",\n    \"email\": \"a@vc.sb\"\n  },\n  \"homepage\": \"https://github.com/phpmac/skills\",\n  \"repository\": \"https://github.com/phpmac/skills\",\n  \"license\": \"MIT\",\n  \"keywords\": [\n    \"skills\",\n    \"claude\",\n    \"development\",\n    \"productivity\"\n  ]\n}",
        "README.md": "# skills\n\n自己的技能库\n\n## 安装使用方法\n\n```bash\n# 插件\n/plugin marketplace add ~/Downloads/skills\n\n# 技能\nbunx skills add ~/Downloads/skills/skills\n\n# 通用,禁止安装第三方未知技能,防止后门\nbunx skills add https://github.com/anthropics/skills --skill skill-creator\nbunx skills add https://github.com/vercel-labs/agent-skills --skill vercel-react-best-practices\nbunx skills add https://github.com/vercel-labs/agent-skills --skill web-design-guidelines\n\n# APP通用\nbunx skills add expo/skills\n\nbunx skills add vercel-labs/agent-skills\n```\n",
        "skills/hardhat2-fork-testing/SKILL.md": "---\nname: hardhat2-fork-testing\ndescription: Use when testing smart contracts with Hardhat v2 ONLY - NOT compatible with Hardhat v3. Use when testing against deployed mainnet/testnet contracts, need to impersonate existing addresses without private keys, or want to test with real chain state\n---\n\n# Hardhat v2 Fork Testing\n\n## Overview\n使用 Hardhat v2 Network 的 fork 功能，在本地环境中模拟主网/测试网状态，无需私钥即可模拟任何地址进行测试。\n\n**注意：Hardhat v3 语法不同，本技能仅适用于 Hardhat v2**\n\n## When to Use\n\n```dot\ndigraph when_fork {\n    \"需要测试已部署合约?\" [shape=diamond];\n    \"没有私钥?\" [shape=diamond];\n    \"需要真实链状态?\" [shape=diamond];\n    \"使用 Fork 测试\" [shape=box];\n    \"使用普通测试\" [shape=box];\n\n    \"需要测试已部署合约?\" -> \"没有私钥?\";\n    \"没有私钥?\" -> \"需要真实链状态?\";\n    \"需要真实链状态?\" -> \"使用 Fork 测试\" [label=\"是\"];\n    \"需要真实链状态?\" -> \"使用普通测试\" [label=\"否\"];\n    \"没有私钥?\" -> \"使用 Fork 测试\" [label=\"是\"];\n    \"没有私钥?\" -> \"使用普通测试\" [label=\"否\"];\n}\n```\n\n**使用场景：**\n- 测试与已部署合约的交互\n- 模拟任意地址（无需私钥）\n- 验证升级后的合约兼容性\n- 在真实链状态上测试复杂交互\n\n**不使用：**\n- 简单的单元测试（使用本地网络即可）\n- 不依赖链状态的逻辑测试\n\n## Core Pattern\n\n**Before (直接连接真实网络):**\n```typescript\n// ❌ 不支持 impersonateAccount\nconst signers = await ethers.getSigners();\nuser = signers[0]; // 只能用配置的账户\n```\n\n**After (使用 fork):**\n```typescript\n// ✅ 可以模拟任何地址\nawait ethers.provider.send(\"hardhat_impersonateAccount\", [TARGET_ADDRESS]);\nuser = await ethers.getSigner(TARGET_ADDRESS);\n```\n\n## Quick Reference\n\n| 操作 | 命令/代码 |\n|------|----------|\n| **启动 fork 测试** | `FORK_ENABLED=true FORK_URL=<RPC_URL> bunx hardhat test --network hardhat` |\n| **模拟账户** | `await ethers.provider.send(\"hardhat_impersonateAccount\", [address])` |\n| **设置账户余额** | `await ethers.provider.send(\"hardhat_setBalance\", [address, balance])` |\n| **推进时间** | `await ethers.provider.send(\"evm_increaseTime\", [seconds])` |\n| **挖出新块** | `await ethers.provider.send(\"evm_mine\", [])` |\n\n## Implementation\n\n### 1. hardhat.config.ts 配置 (Hardhat v2)\n\n```typescript\nnetworks: {\n  hardhat: {\n    chainId: 1337,\n    accounts: {\n      mnemonic: \"test test test test test test test test test test test junk\",\n      count: 400,\n    },\n    forking: {\n      url: process.env.FORK_URL || \"https://bsc-dataseed.binance.org/\",\n      blockNumber: process.env.FORK_BLOCK_NUMBER ? parseInt(process.env.FORK_BLOCK_NUMBER) : undefined,\n      enabled: process.env.FORK_ENABLED === \"true\",\n    },\n  },\n}\n```\n\n### 2. 极简测试模板 (Hardhat v2)\n\n```typescript\nimport { ethers } from \"hardhat\";\nimport { expect } from \"chai\";\nimport { parseEther } from \"ethers\";\n\ndescribe(\"Fork Test\", function () {\n    const CONTRACT_ADDRESS = \"0x...\";\n    const ADMIN_ADDRESS = \"0x...\";  // 合约管理员/部署者\n\n    let contract: any;\n    let admin: any;\n\n    before(async function () {\n        // 模拟管理员\n        await ethers.provider.send(\"hardhat_impersonateAccount\", [ADMIN_ADDRESS]);\n        admin = await ethers.getSigner(ADMIN_ADDRESS);\n\n        // 获取合约\n        contract = await ethers.getContractAt(\"ContractName\", CONTRACT_ADDRESS);\n    });\n\n    it(\"测试场景\", async function () {\n        const tx = await contract.connect(admin).someMethod();\n        await tx.wait();\n    });\n});\n```\n\n### 3. 完整测试模板\n\n```typescript\nimport { ethers } from \"hardhat\";\nimport { expect } from \"chai\";\nimport { parseEther } from \"ethers\";\n\ndescribe(\"Fork test\", function () {\n  const TARGET_ADDRESS = \"0x1234...\";  // 要模拟的地址\n  const CONTRACT_ADDRESS = \"0xabcd...\"; // 已部署的合约地址\n\n  let contract: any;\n  let user: any;\n\n  this.beforeAll(async function () {\n    const network = await ethers.provider.getNetwork();\n    const isHardhat = network.chainId === BigInt(31337) || network.chainId === BigInt(1337);\n\n    // 获取已部署合约\n    const factory = await ethers.getContractFactory(\"ContractName\");\n    contract = factory.attach(CONTRACT_ADDRESS);\n\n    if (isHardhat) {\n      // Fork 环境：模拟账户\n      await ethers.provider.send(\"hardhat_impersonateAccount\", [TARGET_ADDRESS]);\n      user = await ethers.getSigner(TARGET_ADDRESS);\n\n      // 给账户转入 BNB 用于 gas\n      const [signer] = await ethers.getSigners();\n      await signer.sendTransaction({\n        to: TARGET_ADDRESS,\n        value: parseEther(\"1\"),\n      });\n    } else {\n      // 真实网络：使用配置的账户\n      const signers = await ethers.getSigners();\n      user = signers[0];\n    }\n  });\n\n  it(\"测试场景\", async function () {\n    // 使用 user 进行测试\n    const tx = await contract.connect(user).someMethod();\n    await tx.wait();\n  });\n});\n```\n\n### 4. 运行测试 (Hardhat v2)\n\n```bash\n# 使用 bunx (推荐)\nFORK_ENABLED=true FORK_URL=https://your-rpc-url bunx hardhat test test/YourTest.ts --network hardhat\n\n# 或使用 npx\nFORK_ENABLED=true FORK_URL=https://your-rpc-url npx hardhat test test/YourTest.ts --network hardhat\n\n# 或者在 hardhat.config.ts 中预设 URL，只需启用\nFORK_ENABLED=true bunx hardhat test test/YourTest.ts --network hardhat\n```\n\n## Common Mistakes\n\n| 错误 | 原因 | 解决方法 |\n|------|------|----------|\n| `hardhat_impersonateAccount does not exist` | 直接连接真实网络，不是 fork 环境 | 使用 `--network hardhat` 并启用 fork |\n| `missing trie node` | RPC 节点不是归档节点 | 使用 Alchemy/QuickNode 等归档节点 |\n| `insufficient funds for gas` | 模拟账户没有 BNB | 用 `hardhat_setBalance` 或转账 |\n| 测试在真实网络执行 | 使用了 `--network bscTestnet` | 使用 `--network hardhat` |\n| `bad address checksum` | 地址格式错误 | 确保地址校验和正确 |\n| `AccessControlUnauthorizedAccount` | 签名者没有权限 | 模拟合约管理员/部署者地址 |\n\n## Common Pitfalls\n\n| 问题 | 原因 | 解决方法 |\n|------|------|----------|\n| 模拟账户没有代币余额 | Fork 状态中该地址余额为 0 | 从富有的地址转账，或使用已有余额的地址 |\n| 合约调用权限不足 | 使用了非管理员地址 | 模拟部署者/管理员地址 |\n| 用户已有上级/关系 | 再次绑定会失败 | 检查 `getParent()` 或使用 `setParent()` 覆盖 |\n| 测试超时 | RPC 响应慢 | 增加 `this.timeout()` |\n\n## Useful Snippets\n\n```typescript\n// 检查余额\nconst balance = await token.balanceOf(address);\nconsole.log(\"Balance:\", ethers.formatEther(balance));\n\n// 推进时间\nawait ethers.provider.send(\"evm_increaseTime\", [3600]); // 1小时\nawait ethers.provider.send(\"evm_mine\", []);\n\n// 从事件获取数据\nconst event = receipt.logs.find((log: any) => {\n    try {\n        return contract.interface.parseLog(log)?.name === \"EventName\";\n    } catch {\n        return false;\n    }\n});\nconst value = contract.interface.parseLog(event).args.paramName;\n\n// 检查是否在 fork 环境\nconst network = await ethers.provider.getNetwork();\nconst isHardhat = network.chainId === BigInt(1337);\n\n// 转账用于 gas\nawait signer.sendTransaction({\n    to: TARGET_ADDRESS,\n    value: parseEther(\"1\"),\n});\n```\n\n## RPC 节点要求\n\n**必须使用归档节点**，公共节点通常不支持 fork：\n\n| 网络 | 推荐归档节点 |\n|------|-------------|\n| Ethereum | Alchemy, Infura |\n| BSC 主网 | Alchemy, QuickNode |\n| BSC 测试网 | QuickNode (公共节点不支持) |\n| Polygon | Alchemy, QuickNode |\n\n## Hardhat v2 vs v3\n\n| 特性 | Hardhat v2 | Hardhat v3 |\n|------|-----------|-----------|\n| Provider API | `ethers.provider.send()` | `hre.viem.getPublicClient()` |\n| Signer 获取 | `ethers.getSigner()` | `hre.viem.getWalletClient()` |\n| Time 操作 | `evm_increaseTime` | `setNextBlockTimestamp` |\n| Fork 配置 | `networks.hardhat.forking` | 不同配置方式 |\n"
      },
      "plugins": [
        {
          "name": "skills",
          "description": "自己的技能库",
          "version": "1.0.0",
          "source": "./",
          "author": {
            "name": "a",
            "email": "a@vc.sb"
          },
          "categories": [],
          "install_commands": [
            "/plugin marketplace add phpmac/skills",
            "/plugin install skills@phpmac/skills"
          ]
        }
      ]
    }
  ]
}