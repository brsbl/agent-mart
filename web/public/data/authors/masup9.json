{
  "author": {
    "id": "masuP9",
    "display_name": "Soichi Masuda",
    "avatar_url": "https://avatars.githubusercontent.com/u/6724665?u=947bd807373b1797dc5b85b3520a522bee5fe9dd&v=4"
  },
  "marketplaces": [
    {
      "name": "codex-collab",
      "version": null,
      "description": "Claude Code と OpenAI Codex CLI の協調タスク実行プラグイン",
      "repo_full_name": "masuP9/codex-collab",
      "repo_url": "https://github.com/masuP9/codex-collab",
      "repo_description": "Claude Code と OpenAI Codex CLI を協調させてタスクを実行するプラグイン",
      "signals": {
        "stars": 2,
        "forks": 0,
        "pushed_at": "2026-02-17T03:20:51Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"name\": \"codex-collab\",\n  \"owner\": {\n    \"name\": \"masuP9\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"codex-collab\",\n      \"source\": \"./\",\n      \"description\": \"Claude Code と OpenAI Codex CLI の協調タスク実行プラグイン\",\n      \"version\": \"0.29.0\",\n      \"author\": {\n        \"name\": \"masuP9\"\n      }\n    }\n  ]\n}\n",
        ".claude-plugin/plugin.json": "{\n  \"name\": \"codex-collab\",\n  \"version\": \"0.29.0\",\n  \"description\": \"Claude Code と OpenAI Codex CLI の協調タスク実行プラグイン\",\n  \"author\": {\n    \"name\": \"masuP9\"\n  },\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"bash -c 'for d in \\\"${CLAUDE_PLUGIN_ROOT:-}\\\" \\\"$(ls -td ~/.claude/plugins/cache/codex-collab/codex-collab/*/ 2>/dev/null | head -1)\\\"; do [ -f \\\"$d/hooks/enforce-skill-usage.sh\\\" ] && exec bash \\\"$d/hooks/enforce-skill-usage.sh\\\"; done; exit 0'\",\n            \"timeout\": 5\n          }\n        ]\n      }\n    ]\n  }\n}\n",
        "README.md": "# codex-collab\n\nClaude Code と OpenAI Codex CLI を協調させてタスクを実行するプラグイン。\n\n## 概要\n\nこのプラグインは、Claude Code と Codex の強みを組み合わせた協調ワークフローを提供します。`codex exec` によるステートレス実行で Codex と通信し、シンプルなアーキテクチャを実現しています。\n\n**Codex-Leads（従来のレビュー型）:**\n- **Codex**: 計画作成・コードレビュー\n- **Claude Code**: 実装\n\n**Claude-Leads（新規）:**\n- **Claude Code**: 深い分析・計画作成・レビュー\n- **Codex**: 高速実装（workspace-write sandbox）\n\n## インストール\n\n```bash\n# マーケットプレイスを追加\n/plugin marketplace add https://github.com/masuP9/codex-collab\n\n# プラグインをインストール\n/plugin install codex-collab@codex-collab\n```\n\n## 前提条件\n\n- OpenAI Codex CLI (`codex`) がインストールされていること\n- `codex exec` が動作すること（`echo \"test\" | codex exec -s read-only -`）\n- 環境変数 `OPENAI_API_KEY` が設定されていること\n\n## アーキテクチャ\n\nCodex CLI との通信は `codex exec`（ステートレス実行）を使用します:\n\n```\nClaude Code → Bash tool → codex exec → stdout 取得 → パース\n```\n\n- プロンプトを stdin から渡し、結果を stdout で受け取るシンプルな構造\n- 各呼び出しは独立（会話コンテキストはプロンプト内に明示的に含める）\n- `codex_run_exec()` が入出力、ANSI エスケープ除去、exit code ハンドリングを統合処理\n- バックグラウンド実行が必要な場合は Bash tool の `run_in_background: true` を使用\n\n## プロジェクト構造\n\n```\ncodex-collab/\n├── .claude-plugin/\n│   └── plugin.json         # プラグインメタデータ\n├── commands/\n│   ├── codex-collab.md     # /codex-collab コマンド\n│   ├── strong-inference.md # /strong-inference コマンド\n│   └── devils-advocate.md  # /devils-advocate コマンド\n├── scripts/\n│   └── codex-helpers.sh    # 共通ヘルパー関数\n└── skills/\n    ├── codex-collab/\n    │   └── references/     # プロトコル定義\n    ├── strong-inference/\n    │   └── references/     # 仮説テンプレート\n    └── devils-advocate/\n        └── references/     # 評価基準\n```\n\n### ヘルパースクリプト\n\n`scripts/codex-helpers.sh` には、コマンド間で共有される関数が定義されています:\n\n**コア関数（Codex 実行）:**\n- `codex_run_exec()` - codex exec のラッパー（stdin パイプ、ANSI 除去、出力保存、exit code ハンドリング）\n- `codex_build_exec_command()` - codex exec コマンド文字列の構築\n- `codex_write_prompt()` - プロンプトを一時ファイルに書き出し\n- `codex_strip_ansi()` - ANSI エスケープコード除去\n\n**ユーティリティ関数:**\n- `codex_ensure_tmp_dir()` - 一時ディレクトリ管理\n- `codex_tmp_path()` - 一時ディレクトリ内のファイルパス取得\n- `codex_hash_content()` - クロスプラットフォームハッシュ計算\n- `codex_generate_signal()` - ユニークID生成\n- `codex_get_language_directive()` - 言語指示生成\n- `codex_debug()` - デバッグログ出力\n\n**メタデータ抽出:**\n- `codex_extract_metadata()` - 応答末尾のYAMLブロックを抽出\n- `codex_get_field()` - メタデータフィールド取得\n- `codex_get_status()` - status フィールド取得（continue/stop）\n- `codex_get_verdict()` - verdict フィールド取得（pass/conditional/fail）\n\n各コマンドは自動的にヘルパーをsourceします。\n\n## 使い方\n\n### `/codex-collab` コマンド\n\n協調ワークフローを開始します。\n\n```\n/codex-collab 新しい認証機能を実装して\n```\n\n**Codex 呼び出し:**\n- `codex exec` によるステートレス実行（ブロッキング、stdout 出力）\n- 各呼び出しは独立（会話コンテキストはプロンプト内に明示的に含める）\n- Codex CLI が未インストールの場合は Claude-only モードにフォールバック\n\n### `/strong-inference` コマンド\n\nStrong Inference（強い推論）メソッドを使って、仮説駆動でバグ調査を行います。\n\n```\n# 基本的な使い方\n/strong-inference APIが時々500エラーを返す\n\n# モード指定\n/strong-inference --mode claude-only テストがフレーキーな原因を調べて\n```\n\n**特徴:**\n- 2-4個の競合仮説を生成\n- 各仮説を排除する「キラー実験」を設計\n- 仮説ツリーを `tmp/strong-inference/` に保存（調査状態を永続化）\n- codexモードではCodexが仮説生成、Claudeが検証実行\n\n### `/devils-advocate` コマンド\n\nDevil's Advocate（悪魔の代弁者）メソッドを使って、設計案や仮説をストレステストします。\n\n```\n# 基本的な使い方\n/devils-advocate このキャッシュ設計を検証して\n\n# モード指定\n/devils-advocate --mode claude-only マイクロサービス移行は妥当か\n\n# ラウンド数指定\n/devils-advocate --max-rounds 5 この認証設計\n```\n\n**特徴:**\n- Blue Team（提案側）vs Red Team（批判側）の構造化議論\n- 3ラウンド（デフォルト）の反論・再反論\n- 最終評価: APPROVE / CONDITIONAL / REJECT\n- codexモードではCodexがRed Team、ClaudeがBlue Team\n- 議論ログを `tmp/devils-advocate/` に保存\n\n### スキルの自動起動\n\n以下のようなリクエストで自動的にスキルが有効になります:\n- 「Codexと協調してタスクを実行したい」\n- 「Codexにレビューを依頼して」\n- 「Codexに計画を作成させたい」\n- 「このバグの原因を調査して」（Strong Inferenceスキル）\n- 「仮説を立てて検証して」（Strong Inferenceスキル）\n- 「この設計を批判的にレビューして」（Devil's Advocateスキル）\n- 「反論をもらいたい」（Devil's Advocateスキル）\n\n### Strong Inference vs Devil's Advocate の使い分け\n\n両スキルは目的が異なります。以下のガイドを参考にしてください。\n\n#### ユースケース別の推奨スキル\n\n| ユースケース | 推奨スキル | 理由 |\n|-------------|-----------|------|\n| バグの原因調査 | `/strong-inference` | 競合仮説を立て、実験で排除 |\n| パフォーマンス問題の調査 | `/strong-inference` | 原因を絞り込む検証が必要 |\n| なぜ動かないか分からない | `/strong-inference` | 未知の原因を特定する |\n| 設計案のレビュー | `/devils-advocate` | 反論を通じて弱点を発見 |\n| アーキテクチャ決定の検証 | `/devils-advocate` | 議論で合意形成 |\n| リスク評価 | `/devils-advocate` | 批判的視点で穴を見つける |\n| PRのコードレビュー | `/codex-collab` | 実装済みコードの品質確認 |\n\n#### 判断が難しいケース\n\n**「仮説を検証したい」と言われたら？**\n- 原因不明の問題 → `/strong-inference`（実験で仮説を排除）\n- 設計案の妥当性 → `/devils-advocate`（議論で仮説を強化）\n\n**「レビューしてほしい」と言われたら？**\n- 実装済みコード → `/codex-collab`（品質チェック）\n- 設計案・提案 → `/devils-advocate`（批判的検証）\n\n#### 簡単な見分け方\n\n```\n「なぜ？」「原因は？」 → /strong-inference\n「これで良いか？」「弱点は？」 → /devils-advocate\n「実装をチェック」 → /codex-collab\n```\n\n## 設定\n\nプロジェクト固有の設定は `.claude/codex-collab.local.md` に記述できます。\n\n```markdown\n---\nmodel: o4-mini\nsandbox: read-only\n---\n\n# プロジェクト固有の指示\n\nこのプロジェクトでは TypeScript を使用しています。\n```\n\n### 設定オプション\n\n| オプション | デフォルト | 説明 |\n|-----------|-----------|------|\n| `workflow` | `auto` | ワークフロー選択 (auto, codex-leads, claude-leads) |\n| `model` | (Codexデフォルト) | 使用するモデル (o3, o4-mini等) |\n| `sandbox` | `read-only` | サンドボックスモード (read-only, workspace-write, danger-full-access)。codex-leads用 |\n| `exchange.enabled` | `true` | Planning exchangeのグローバルキルスイッチ (codex-leads) |\n| `exchange.max_iterations` | `3` | Planning exchangeの最大ラウンド数 |\n| `exchange.user_confirm` | `on_important` | ユーザー確認タイミング (never, always, on_important) |\n| `exchange.history_mode` | `summarize` | 履歴管理方式: full=全履歴保持, summarize=最新2ラウンドのみ全文 |\n| `review.enabled` | `true` | Review iterationの有効化 (codex-leads) |\n| `review.max_iterations` | `5` | Review iterationの最大ラウンド数（ゴールが明確なので多め） |\n| `review.user_confirm` | `never` | レビュー時は自動でイテレーション |\n| `claude_leads.sandbox` | `workspace-write` | Codex実装用サンドボックス (claude-leads) |\n| `claude_leads.consult_codex` | `true` | 計画の壁打ちフェーズ有効化 (claude-leads) |\n| `claude_leads.safety_checkpoint` | `stash` | 実装前チェックポイント (stash, wip-commit, none) |\n| `claude_leads.review.max_iterations` | `3` | Claudeレビュー修正ループの上限 (claude-leads) |\n\n### 設定の優先順位\n\n```\nコマンド引数 > プロジェクト設定 > グローバル設定 > 安全デフォルト\n```\n\n## ワークフロー\n\n### Codex-Leads（従来）\n\nCodex が計画・レビュー、Claude が実装するワークフロー。推論に優れたモデル（o3, gpt-5等）に最適。\n\n```\n1. ユーザー: /codex-collab \"機能Xを実装して\"\n2. Claude Code: タスク分析・Codex向けプロンプト作成\n3. Codex: 計画作成\n4. Claude Code: 計画確認・実装\n5. Codex: レビュー（Pass/Fail/Conditional）\n6. Claude Code: 修正（必要に応じて）・完了報告\n```\n\n### Claude-Leads（新規）\n\nClaude が計画・レビュー、Codex が実装するワークフロー。高速実行向きモデル（codex-mini, o4-mini等）に最適。\n\n```\n1. ユーザー: /codex-collab \"機能Xを実装して\"\n2. Claude Code: 深いコードベース分析\n3. Claude Code: 詳細な実装計画を作成\n4. (optional) Codex: 計画をレビュー（壁打ち）\n5. ユーザー: 計画を承認\n6. Safety Checkpoint: git stash で状態保存\n7. Codex: 計画に従い実装（workspace-write sandbox）\n8. Claude Code: 変更をレビュー（git diff + Read）\n9. [問題あり?] → Codex修正 → Claude再レビュー\n10. 完了報告\n```\n\n### ワークフロー自動選択\n\n`workflow: auto`（デフォルト）では、常に **codex-leads** を選択します。`claude-leads` は `workflow: claude-leads` を明示的に指定した場合のみ有効です。\n\n### Claude-Leads の責務境界\n\n| 役割 | 責務 |\n|------|------|\n| **Claude** | 品質ゲート: 分析・計画・レビュー・承認 |\n| **Codex** | 実行エンジン: 計画に従った正確な実装 |\n| **ユーザー** | 最終承認: 計画承認と最終判断 |\n\n> **安全メカニズム**: Safety Checkpoint（git stash）+ 計画外ファイル変更の自動検出 + Claude レビュー\n\n## 軽量メタデータプロトコル\n\nClaude Code と Codex CLI 間の議論をサポートする軽量なメタデータ形式を採用しています。\n\n### 設計思想\n\n- **本文は自然言語のまま**: LLM の表現力を制限しない\n- **メタデータは末尾に付加**: 応答の最後に YAML ブロックとして追加\n- **フォールバック可能**: メタデータがなくても本文は読める\n\n### メタデータ形式\n\n応答の末尾に `---` で囲まれた YAML ブロックを付加：\n\n```markdown\n（自然言語の応答本文）\n\n...議論や説明...\n\n---\nstatus: stop\nverdict: conditional\nopen_questions:\n  - 認証方式の選択\nfindings:\n  - severity: medium\n    message: 入力バリデーションが不足\n---\n```\n\n### フィールド一覧\n\n| フィールド | 型 | 説明 |\n|-----------|-----|------|\n| `status` | enum | `continue` / `stop` - 議論を続けるか終了するか |\n| `verdict` | enum | `pass` / `conditional` / `fail` - レビュー判定 |\n| `open_questions` | list | 未解決の質問 |\n| `decisions` | list | 合意した決定事項 |\n| `findings` | list | 発見事項（severity, message） |\n\n### 使用例\n\n**レビュー応答:**\n\n```markdown\nコードを確認しました。全体的に良い実装ですが、改善点があります。\n\n1. `validate_input()` で空文字列のチェックが抜けています\n2. エラーメッセージがハードコードされています\n\n---\nstatus: stop\nverdict: conditional\nfindings:\n  - severity: medium\n    message: validate_input() で空文字列チェックが不足\n  - severity: low\n    message: エラーメッセージのハードコード\n---\n```\n\n**議論応答（継続）:**\n\n```markdown\n認証方式について検討しました。JWT と Session の両方に利点がありますが...\n\nいくつか確認したい点があります：\n- ユーザー数の想定規模は？\n- モバイルアプリからのアクセスは想定していますか？\n\n---\nstatus: continue\nopen_questions:\n  - ユーザー規模の想定\n  - モバイルアプリ対応の有無\ndecisions:\n  - REST API で実装する\n---\n```\n\n### 関連ファイル\n\n詳細な仕様は `skills/codex-collab/references/` にあります：\n\n- `lightweight-metadata.md` - 軽量メタデータプロトコル仕様\n- `planning-prompt.md` - 計画依頼テンプレート\n- `review-prompt.md` - レビュー依頼テンプレート\n- `deprecated/` - 旧構造化プロトコル（参考用）\n\n## ライセンス\n\nMIT\n"
      },
      "plugins": [
        {
          "name": "codex-collab",
          "source": "./",
          "description": "Claude Code と OpenAI Codex CLI の協調タスク実行プラグイン",
          "version": "0.29.0",
          "author": {
            "name": "masuP9"
          },
          "categories": [],
          "install_commands": [
            "/plugin marketplace add masuP9/codex-collab",
            "/plugin install codex-collab@codex-collab"
          ]
        }
      ]
    }
  ]
}