{
  "author": {
    "id": "can1357",
    "display_name": "Can Bölük",
    "avatar_url": "https://avatars.githubusercontent.com/u/11807264?u=c100abe2f20b2a11460804a1651047a5450e2a0e&v=4"
  },
  "marketplaces": [
    {
      "name": "smgrep",
      "version": null,
      "description": "Semantic code search for Claude Code. High-performance Rust implementation with automatic project indexing.",
      "repo_full_name": "can1357/smgrep",
      "repo_url": "https://github.com/can1357/smgrep",
      "repo_description": "Semantic code search tool with GPU acceleration",
      "signals": {
        "stars": 56,
        "forks": 6,
        "pushed_at": "2025-12-01T22:11:46Z"
      },
      "files": {
        ".claude-plugin/marketplace.json": "{\n  \"$schema\": \"https://anthropic.com/claude-code/marketplace.schema.json\",\n  \"name\": \"smgrep\",\n  \"owner\": {\n    \"name\": \"can1357\",\n    \"email\": \"me@can.ac\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"smgrep\",\n      \"source\": \"./plugins/smgrep\",\n      \"description\": \"Semantic code search for Claude Code. High-performance Rust implementation with automatic project indexing.\",\n      \"version\": \"0.1.0\",\n      \"author\": {\n        \"name\": \"can1357\",\n        \"email\": \"me@can.ac\"\n      },\n      \"skills\": [\n        \"./skills/smgrep\"\n      ]\n    }\n  ]\n}\n",
        "README.md": "<div align=\"center\">\n  <a href=\"https://github.com/can1357/smgrep\">\n    <img src=\"assets/logo.png\" alt=\"smgrep\" width=\"128\" height=\"128\" />\n  </a>\n  <h1>smgrep</h1>\n  <p><em>Semantic code search, GPU-accelerated.</em></p>\n  <a href=\"https://crates.io/crates/smgrep\"><img src=\"https://img.shields.io/crates/v/smgrep.svg\" alt=\"Crates.io\" /></a>\n  <a href=\"https://crates.io/crates/smgrep\"><img src=\"https://img.shields.io/crates/d/smgrep.svg\" alt=\"Downloads\" /></a>\n  <a href=\"https://opensource.org/licenses/Apache-2.0\"><img src=\"https://img.shields.io/badge/License-Apache%202.0-blue.svg\" alt=\"License\" /></a>\n</div>\n\nNatural-language search that works like `grep`. Fast, local, GPU-accelerated, and built for coding agents.\n\n- **Semantic:** Finds concepts (\"where do transactions get created?\"), not just strings.\n- **GPU-Accelerated:** CUDA on NVIDIA GPUs, Metal on Apple Silicon.\n- **Local & Private:** 100% local embeddings. No API keys required.\n- **Auto-Isolated:** Each repository gets its own index automatically.\n- **On-Demand Grammars:** Tree-sitter WASM grammars download automatically as needed.\n- **Agent-Ready:** Native MCP server and Claude Code integration.\n\n## Quick Start\n\n1. **Install**\n\n   ```bash\n   cargo install smgrep\n   ```\n\n   Or build from source:\n\n   ```bash\n   git clone https://github.com/can1357/smgrep\n   cd smgrep\n   cargo build --release\n   ```\n\n   For CPU-only builds (no CUDA):\n\n   ```bash\n   cargo build --release --no-default-features\n   ```\n\n2. **Setup (Recommended)**\n\n   ```bash\n   smgrep setup\n   ```\n\n   Downloads embedding models (~500MB) and tree-sitter grammars upfront. If you skip this, models download automatically on first use.\n\n3. **Search**\n\n   ```bash\n   cd my-repo\n   smgrep \"where do we handle authentication?\"\n   ```\n\n   **Your first search will automatically index the repository.** Each repository is automatically isolated with its own index. Switching between repos \"just works\".\n\n## Coding Agent Integration\n\n### Claude Code\n\n1. Run `smgrep claude-install`\n2. Open Claude Code (`claude`) and ask questions about your codebase.\n3. The plugin auto-starts the `smgrep serve` daemon and provides semantic search.\n\n### MCP Server\n\nsmgrep includes a built-in MCP (Model Context Protocol) server:\n\n```bash\nsmgrep mcp\n```\n\nThis exposes a `sem_search` tool that agents can use for semantic code search. The server auto-starts the background daemon if needed.\n\n## Commands\n\n### `smgrep [query]`\n\nThe default command. Searches the current directory using semantic meaning.\n\n```bash\nsmgrep \"how is the database connection pooled?\"\n```\n\n**Options:**\n| Flag | Description | Default |\n| --- | --- | --- |\n| `-m <n>` | Max total results to return | `10` |\n| `--per-file <n>` | Max matches per file | `1` |\n| `-c`, `--content` | Show full chunk content | `false` |\n| `--compact` | Show file paths only | `false` |\n| `--scores` | Show relevance scores | `false` |\n| `-s`, `--sync` | Force re-index before search | `false` |\n| `--dry-run` | Show what would be indexed | `false` |\n| `--json` | JSON output format | `false` |\n| `--no-rerank` | Skip ColBERT reranking | `false` |\n| `--plain` | Disable ANSI colors | `false` |\n\n**Examples:**\n\n```bash\n# General concept search\nsmgrep \"API rate limiting logic\"\n\n# Deep dive (more matches per file)\nsmgrep \"error handling\" --per-file 5\n\n# Just the file paths\nsmgrep \"user validation\" --compact\n\n# JSON for scripting\nsmgrep \"config parsing\" --json\n```\n\n### `smgrep index`\n\nManually indexes the repository.\n\n```bash\nsmgrep index              # Index current dir\nsmgrep index --dry-run    # See what would be indexed\nsmgrep index --reset      # Delete and re-index from scratch\n```\n\n### `smgrep serve`\n\nRuns a background daemon with file watching for instant searches.\n\n- Keeps LanceDB and embedding models resident for fast responses\n- Watches the repo and incrementally re-indexes on change\n- Communicates via Unix socket (or TCP on Windows)\n\n```bash\nsmgrep serve              # Start daemon for current repo\nsmgrep serve --path /repo # Start for specific path\n```\n\n### `smgrep stop` / `smgrep stop-all`\n\nStop running daemons.\n\n```bash\nsmgrep stop               # Stop daemon for current repo\nsmgrep stop-all           # Stop all smgrep daemons\n```\n\n### `smgrep clean`\n\nRemove index data and metadata for a store.\n\n```bash\nsmgrep clean              # Clean current directory's store\nsmgrep clean my-store     # Clean specific store by ID\nsmgrep clean --all        # Clean all stores\n```\n\n### `smgrep status`\n\nShow status of running daemons.\n\n### `smgrep list`\n\nLists all indexed repositories and their metadata.\n\n### `smgrep doctor`\n\nChecks installation health, model availability, and grammar status.\n\n```bash\nsmgrep doctor\n```\n\n## GPU Acceleration\n\nsmgrep uses [candle](https://github.com/huggingface/candle) for ML inference with optional CUDA support.\n\n**With CUDA (default):**\n\nRequires CUDA toolkit installed with environment configured:\n\n```bash\nexport CUDA_ROOT=/usr/local/cuda  # or your CUDA installation path\nexport PATH=\"$CUDA_ROOT/bin:$PATH\"\n\ncargo build --release\n```\n\nEmbedding speed is significantly faster on NVIDIA GPUs.\n\n**CPU-only:**\n\n```bash\ncargo build --release --no-default-features\n```\n\n**Environment variables:**\n\n- `SMGREP_DISABLE_GPU=1` - Force CPU even when CUDA is available\n- `SMGREP_BATCH_SIZE=N` - Override batch size (auto-adapts on OOM)\n\n## Architecture\n\nsmgrep combines several techniques for high-quality semantic search:\n\n1. **Smart Chunking:** Tree-sitter parses code by function/class boundaries, ensuring embeddings capture complete logical blocks. Grammars download on-demand as WASM modules.\n\n2. **Hybrid Search:** Dense embeddings (sentence-transformers) for broad recall, ColBERT reranking for precision.\n\n3. **Quantized Storage:** ColBERT embeddings are quantized to int8 for efficient storage in LanceDB.\n\n4. **Automatic Repository Isolation:** Stores are named by git remote URL or directory hash.\n\n5. **Incremental Indexing:** File watcher detects changes and updates only affected chunks.\n\n**Supported languages (37):** TypeScript, TSX, JavaScript, Python, Go, Rust, C, C++, C#, Java, Kotlin, Scala, Ruby, PHP, Elixir, Haskell, OCaml, Julia, Zig, Lua, Odin, Objective-C, Verilog, HTML, CSS, XML, Markdown, JSON, YAML, TOML, Bash, Make, Starlark, HCL, Terraform, Diff, Regex\n\n## Configuration\n\nsmgrep uses a TOML config file at `~/.smgrep/config.toml`. All options can also be set via environment variables with the `SMGREP_` prefix.\n\n### Config File\n\n```toml\n# ~/.smgrep/config.toml\n\n# ============================================================================\n# Models\n# ============================================================================\n\n# Dense embedding model (HuggingFace model ID)\n# Used for initial semantic similarity search\ndense_model = \"ibm-granite/granite-embedding-small-english-r2\"\n\n# ColBERT reranking model (HuggingFace model ID)\n# Used for precise reranking of search results\ncolbert_model = \"answerdotai/answerai-colbert-small-v1\"\n\n# Model dimensions (must match the models above)\ndense_dim = 384\ncolbert_dim = 96\n\n# Query prefix (some models require a prefix like \"query: \")\nquery_prefix = \"\"\n\n# Maximum sequence lengths for tokenization\ndense_max_length = 256\ncolbert_max_length = 256\n\n# ============================================================================\n# Performance\n# ============================================================================\n\n# Batch size for embedding computation\n# Higher = faster but more memory. Auto-reduces on OOM.\ndefault_batch_size = 48\nmax_batch_size = 96\n\n# Maximum threads for parallel processing\nmax_threads = 32\n\n# Force CPU inference even when CUDA is available\ndisable_gpu = false\n\n# Low-impact mode: reduces resource usage for background indexing\nlow_impact = false\n\n# Fast mode: skip ColBERT reranking for quicker (but less precise) results\nfast_mode = false\n\n# ============================================================================\n# Server\n# ============================================================================\n\n# TCP port for daemon communication\nport = 4444\n\n# Idle timeout: shutdown daemon after this many seconds of inactivity\nidle_timeout_secs = 1800  # 30 minutes\n\n# How often to check for idle timeout\nidle_check_interval_secs = 60\n\n# Timeout for embedding worker operations (milliseconds)\nworker_timeout_ms = 60000\n\n# ============================================================================\n# Debug\n# ============================================================================\n\n# Enable model loading debug output\ndebug_models = false\n\n# Enable embedding debug output\ndebug_embed = false\n\n# Enable profiling\nprofile_enabled = false\n\n# Skip saving metadata (for testing)\nskip_meta_save = false\n```\n\n### Environment Variables\n\nAny config option can be set via environment variable with the `SMGREP_` prefix:\n\n```bash\n# Examples\nexport SMGREP_DISABLE_GPU=true\nexport SMGREP_DEFAULT_BATCH_SIZE=24\nexport SMGREP_IDLE_TIMEOUT_SECS=3600\n```\n\n| Variable                    | Description           | Default       |\n| --------------------------- | --------------------- | ------------- |\n| `SMGREP_STORE`              | Override store name   | auto-detected |\n| `SMGREP_DISABLE_GPU`        | Force CPU inference   | `false`       |\n| `SMGREP_DEFAULT_BATCH_SIZE` | Embedding batch size  | `48`          |\n| `SMGREP_LOW_IMPACT`         | Reduce resource usage | `false`       |\n| `SMGREP_FAST_MODE`          | Skip reranking        | `false`       |\n\n### Ignoring Files\n\nsmgrep respects `.gitignore` and `.smignore` files.\n\nCreate `.smignore` in your repository root:\n\n```\n# Ignore generated files\ndist/\n*.min.js\n\n# Ignore test fixtures\ntest/fixtures/\n```\n\n### Manual Store Management\n\n- **View all stores:** `smgrep list`\n- **Override auto-detection:** `smgrep --store custom-name \"query\"`\n- **Data location:** `~/.smgrep/`\n\n## Troubleshooting\n\n- **Index feels stale?** Run `smgrep index` to refresh.\n- **Weird results?** Run `smgrep doctor` to verify models and grammars.\n- **Need a fresh start?** `smgrep index --reset` or delete `~/.smgrep/`.\n- **GPU OOM?** Batch size auto-reduces, or set `SMGREP_DISABLE_GPU=1`.\n\n## Building from Source\n\n```bash\ngit clone https://github.com/can1357/smgrep\ncd smgrep\ncargo build --release\n\n# Run tests\ncargo test\n```\n\n## Acknowledgments\n\nsmgrep is inspired by [osgrep](https://github.com/Ryandonofrio3/osgrep) and [mgrep](https://github.com/mixedbread-ai/mgrep) by MixedBread.\n\n## License\n\nLicensed under the Apache License, Version 2.0.\nSee [LICENSE](LICENSE) for details.\n"
      },
      "plugins": [
        {
          "name": "smgrep",
          "source": "./plugins/smgrep",
          "description": "Semantic code search for Claude Code. High-performance Rust implementation with automatic project indexing.",
          "version": "0.1.0",
          "author": {
            "name": "can1357",
            "email": "me@can.ac"
          },
          "skills": [
            "./skills/smgrep"
          ],
          "categories": [],
          "install_commands": [
            "/plugin marketplace add can1357/smgrep",
            "/plugin install smgrep@smgrep"
          ]
        }
      ]
    }
  ]
}